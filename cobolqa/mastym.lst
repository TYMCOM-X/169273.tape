    P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 1
    MASTYM.CBL    23-OCT-65  22:20

    0001  * *********************************************************************
    0002  * 
    0003  * 	M A S T E R     I N V E N T O R Y     S Y S T E M
    0004  * 
    0005  * *********************************************************************
    0006  
    0007    IDENTIFICATION DIVISION.
    0008    PROGRAM-ID. MASTYM.
    0009    AUTHOR. JIM WESTLAKE.
    0010    REMARKS. TYMAINT-10 INVENTORY SYSTEM - MASTER ROUTINES.
    0011  
    0012    ENVIRONMENT DIVISION.
    0013    CONFIGURATION SECTION.
    0014    SPECIAL-NAMES.
    0015  	CHANNEL (1) IS TOP.
    0016  
    0017    INPUT-OUTPUT SECTION.
    0018    FILE-CONTROL.
    0019  	SELECT MAST-FILE ASSIGN TO DSK
    0020  	ACCESS MODE IS INDEXED
    0021  	SYMBOLIC KEY IS MAST-KEY
    0022  	RECORD KEY IS M-REC-KEY
    0023  	RECORDING MODE IS SIXBIT.
    0024  
    0025  	SELECT NAME-FILE ASSIGN TO DSK
    0026  	ACCESS MODE IS INDEXED
    0027  	SYMBOLIC KEY IS N-KEY
    0028  	RECORD KEY IS N-SITE-NO
    0029  	RECORDING MODE IS SIXBIT.
    0030  
    0031  	SELECT HIST-FILE ASSIGN TO DSK
    0032  	ACCESS MODE IS INDEXED
    0033  	SYMBOLIC KEY IS HIST-KEY
    0034  	RECORD KEY IS H-REC-KEY
    0035  	RECORDING MODE IS SIXBIT.
    0036      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 2
    MASTYM.CBL    23-OCT-65  22:20

    0037  * *********************************************************************
    0038  * 
    0039  * 	F I L E     D E S C R I P T I O N S
    0040  * 
    0041  * *********************************************************************
    0042    DATA DIVISION.
    0043    FILE SECTION.
    0044  
    0045    FD	MAST-FILE
    0046  	COPY FDMAST.
    0047C       BLOCK CONTAINS 8 RECORDS 
    0048C       RECORD CONTAINS 90 CHARACTERS 
    0049C       LABEL RECORDS ARE STANDARD 
    0050C       VALUE OF IDENTIFICATION IS 'TYM10MIDX'.
    0051C   01  MAST-REC.
    0052C       02      M-REC-KEY.
    0053C         04    M-REC-PN-PL.
    0054C           06  M-PARTNO        PIC X(11).
    0055C           06  M-PL            PIC X.
    0056C       02      M-FLAG          PIC X.
    0057C       02      M-CREF          PIC X.
    0058C       02      M-DESC.
    0059C         04    M-CREF-SEE      PIC X(4).
    0060C         04    M-CREF-PN-PL.
    0061C           06  M-CREF-PARTNO   PIC X(11).
    0062C           06  M-CREF-PL       PIC X.
    0063C         04    FILLER          PIC X(5).
    0064C       02      M-VC            PIC X(2).
    0065C       02      M-VPN           PIC X(14).
    0066C       02      M-REV-CREF.
    0067C         04    M-REV-CREF-PN   PIC X(11).
    0068C         04    M-REV-CREF-PL   PIC X.
    0069C       02      M-PRICE         PIC 9999V99.
    0070C       02      M-RR            PIC X.
    0071C       02      M-REC-QUAN      PIC 9(4).
    0072C       02      M-OPT           PIC X(10).
    0073C       02      M-SITES         PIC 999.
    0074C       02      FILLER          PIC X(3).
    0075                    
    0076      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 3
    MASTYM.CBL    23-OCT-65  22:20

    0077  * *****************************
    0078  * 	FILE DESC (CONT)
    0079  * *****************************
    0080  
    0081    FD	NAME-FILE
    0082  	COPY FDNAME.
    0083C       BLOCK CONTAINS 5 RECORDS 
    0084C       RECORD CONTAINS 150 CHARACTERS 
    0085C       LABEL RECORDS ARE STANDARD 
    0086C       VALUE OF IDENTIFICATION IS 'TYM10NIDX'.
    0087C   01  NAME-REC.
    0088C       02      N-SITE-NO       PIC 99.
    0089C       02      FILLER          PIC X.
    0090C       02      N-NAME          PIC X(30).
    0091C       02      N-ADRS-1        PIC X(30).
    0092C       02      N-ADRS-2        PIC X(30).
    0093C       02      N-CITY          PIC X(24).
    0094C       02      N-ZIP           PIC 9(5).
    0095C       02      N-PHONE.
    0096C         04    N-AC            PIC 9(3).
    0097C         04    N-PHO.
    0098C           06  N-PHO-1         PIC 999.
    0099C           06  N-PHO-2         PIC 9999.
    0100C       02      N-PL            PIC X.
    0101C       02      N-PASS.
    0102C         04    N-PASS-1        PIC X(6).
    0103C         04    N-PASS-2        PIC X(6).
    0104C       02      N-LOCK          PIC 9.
    0105C       02      N-ORD-FM        PIC 99.
    0106C       02      FILLER          PIC XX.
    0107                    
    0108      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 4
    MASTYM.CBL    23-OCT-65  22:20

    0109  * *****************************
    0110  * 	FILE DESC (CONT)
    0111  * *****************************
    0112  
    0113    FD	HIST-FILE
    0114  	COPY FDHIST.
    0115C       BLOCK CONTAINS 21 RECORDS 
    0116C       RECORD CONTAINS 30 CHARACTERS 
    0117C       VALUE OF IDENTIFICATION IS 'TYM10HIDX'.
    0118C   01  HIST-REC.
    0119C       02      H-REC-KEY.
    0120C         04    H-REC-PN-PL.
    0121C           06  H-PARTNO        PIC X(11).
    0122C           06  H-PL            PIC X.
    0123C         04    H-ENTRY-NO      PIC 9999.
    0124C       02      H-SITE-NO       PIC 99.
    0125C       02      H-QUAN          PIC 9999.
    0126C       02      H-DATE          PIC 9999.
    0127C       02      H-XFER          PIC X.
    0128C       02      H-XFER-SITE     PIC 99.
    0129C       02      FILLER          PIC X.
    0130                    
    0131      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 5
    MASTYM.CBL    23-OCT-65  22:20

    0132  * *********************************************************************
    0133  * 
    0134  * 	W O R K I N G     S T O R A G E 
    0135  * 
    0136  * *********************************************************************
    0137  
    0138    WORKING-STORAGE SECTION.
    0139  
    0140  * *****************************
    0141  * 	ACCUMULATORS
    0142  * *****************************
    0143  
    0144    77	I			PIC 999 VALUE ZERO USAGE COMP.
    0145  
    0146  * *****************************
    0147  * 	ISAM FILE KEYS
    0148  * *****************************
    0149  
    0150    01	MAST-KEY.
    0151  	02	M-K-PN-PL.
    0152  	  04	M-K-PARTNO	PIC X(11).
    0153  	  04	M-K-PL		PIC X.
    0154    01	WS-MAST-FLAG		PIC X.
    0155  
    0156    01	N-KEY			PIC 99.
    0157  
    0158    01	HIST-KEY.
    0159  	02	H-K-PN-PL.
    0160  	  04	H-K-PARTNO	PIC X(11).
    0161  	  04	H-K-PL		PIC X.
    0162  	02	H-K-ENTRY-NO	PIC 9999.
    0163    01	WS-HIST-FLAG		PIC X.
    0164  
    0165  * *****************************
    0166  * 	CONTROL FLAGS &
    0167  * 	RESPONSE LOCS
    0168  * *****************************
    0169  
    0170    01	WS-ENA			PIC 9 USAGE DISPLAY-6.
    0171    01	WS-PL			PIC X USAGE DISPLAY-7.
    0172    01	WS-ANS			PIC X USAGE DISPLAY-7.
    0173    01	WS-SUB-OPT		PIC X USAGE DISPLAY-7.
    0174    01	RET-CODE		PIC 9 USAGE COMP.
    0175    01	RET-CODE-SAVE		PIC 9 USAGE COMP.
    0176    01	WS-REWRITE-FLAG		PIC X VALUE SPACES.
    0177    01	WS-MACRO-ARG.
    0178  	02	WS-MACRO-ARG-1.
    0179  	  04	FILLER		PIC X(5) USAGE DISPLAY-6.
    0180  	  04	WS-MACRO-ARG-N	PIC X    USAGE DISPLAY-6.
    0181  	02	WS-MACRO-ARG-2.
    0182  	  04	FILLER		PIC X(5) USAGE DISPLAY-6.
    0183  	  04	WS-MACRO-ARG-EN	PIC X    USAGE DISPLAY-6.
    0184  
    0185    01	ITEM-NAME.
    0186  	02	ITEM-CHAR	PIC X.
    0187  	02	FILLER		PIC XXX.    P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 5-1
    MASTYM.CBL    23-OCT-65  22:20

    0188      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 6
    MASTYM.CBL    23-OCT-65  22:20

    0189  * *****************************
    0190  * 	DATE/TIME CONTROL LOCS.
    0191  * *****************************
    0192    01	WS-TEMP-DATE USAGE DISPLAY-7.
    0193  	02	WSTY		PIC 99.
    0194  	02	WSTM		PIC 99.
    0195  	02	WSTD		PIC 99.
    0196  	02	WSTH		PIC 99.
    0197  	02	WSTMIN		PIC 99.
    0198  	02	WSTSEC		PIC 99.
    0199    01	WS-DATE USAGE DISPLAY-7.
    0200  	02	WS-MONTH	PIC 99.
    0201  	02	FILLER		PIC X VALUE '-'.
    0202  	02	WS-DAY		PIC 99.
    0203  	02	FILLER		PIC X VALUE '-'.
    0204  	02	WS-YEAR.
    0205  		04 WS-YEAR-DIGIT-1	PIC 9.
    0206  		04 WS-YEAR-DIGIT-2	PIC 9.
    0207    01	JULIAN-DATE.
    0208  	02	JULIAN-YEAR	PIC 9.
    0209  	02	JULIAN-DAY	PIC 999.
    0210    01	DATE-TABLE-DATA.
    0211  	02	FILLER		PIC 999 VALUE ZERO.
    0212  	02	FILLER		PIC 999 VALUE 31.
    0213  	02	FILLER		PIC 999 VALUE 59.
    0214  	02	FILLER		PIC 999 VALUE 90.
    0215  	02	FILLER		PIC 999 VALUE 120.
    0216  	02	FILLER		PIC 999 VALUE 151.
    0217  	02	FILLER		PIC 999 VALUE 181.
    0218  	02	FILLER		PIC 999 VALUE 212.
    0219  	02	FILLER		PIC 999 VALUE 243.
    0220  	02	FILLER		PIC 999 VALUE 273.
    0221  	02	FILLER		PIC 999 VALUE 304.
    0222  	02	FILLER		PIC 999 VALUE 334.
    0223  	02	FILLER		PIC 999 VALUE 366.
    0224    01	DATE-TABLE REDEFINES DATE-TABLE-DATA.
    0225  	02	DATE-TBL	PIC 999 OCCURS 13 TIMES.
    0226  
    0227  
    0228  * FOLLOWING TO CONVERT BACK FROM JULIAN DATE
    0229  
    0230    01	WS-JULIAN-DATE.
    0231  	02	WS-CONV-YEAR	PIC 9.
    0232  	02	WS-CONV-DAY	PIC 999.
    0233    01	WS-DATE-OUT.
    0234  	02	WS-MONTH-OUT	PIC 99.
    0235  	02	WS-D-SEP-1	PIC X.
    0236  	02	WS-DAY-OUT	PIC 99.
    0237  	02	WS-D-SEP-2	PIC X.
    0238  	02	WS-YEAR-OUT.
    0239  	  04	WS-YEAR-OUT-1	PIC 9.
    0240  	  04	WS-YEAR-OUT-2	PIC 9.
    0241      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 7
    MASTYM.CBL    23-OCT-65  22:20

    0242  * *****************************
    0243  * 	PARTS DATA LOCATIONS
    0244  * *****************************
    0245  
    0246    01	WS-MAST-KEY-SAVE.
    0247  	02	WS-MAST-PN-PL-SAVE.
    0248  	  04	WS-MAST-PN-SAVE		PIC X(11).
    0249  	  04	WS-MAST-PL-SAVE		PIC X.
    0250    01	WS-PARTNO		PIC X(11).
    0251    01	WS-QUAN			PIC 9999 VALUE ZERO.
    0252    01	WS-BAL			PIC S9999 VALUE ZERO.
    0253    01	WS-ORD-QUAN		PIC S9999.
    0254    01	WS-MAX-EXT		PIC 9999.
    0255    01	WS-AGE			PIC 999.
    0256      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 8
    MASTYM.CBL    23-OCT-65  22:20

    0257  * *****************************
    0258  * 	WORKING COPIES OF MAST-REC
    0259  * *****************************
    0260  
    0261    01	WS-MAST-REC-SAVE	PIC X(90) USAGE DISPLAY-6.
    0262  
    0263    01	WS-MAST-REC
    0264  	COPY WSMAST.
    0265C       02      M1-REC-KEY.
    0266C         04    M1-REC-PN-PL.
    0267C           06  M1-PARTNO       PIC X(11).
    0268C           06  M1-PL           PIC X.
    0269C       02      M1-FLAG         PIC X.
    0270C       02      M1-CREF         PIC X.
    0271C       02      M1-DESC.
    0272C         04    M1-CREF-SEE     PIC X(4).
    0273C         04    M1-CREF-PN-PL.
    0274C           06  M1-CREF-PARTNO  PIC X(11).
    0275C           06  M1-CREF-PL      PIC X.
    0276C         04    FILLER          PIC X(5).
    0277C       02      M1-VC           PIC X(2).
    0278C       02      M1-VPN          PIC X(14).
    0279C       02      M1-REV-CREF.
    0280C         04    M1-REV-CREF-PN  PIC X(11).
    0281C         04    M1-REV-CREF-PL  PIC X.
    0282C       02      M1-PRICE                PIC 9999V99.
    0283C       02      M1-RR           PIC X.
    0284C       02      M1-REC-QUAN     PIC 9(4).
    0285C       02      M1-OPT          PIC X(10).
    0286C       02      M1-SITES                PIC 999.
    0287C       02      FILLER          PIC X(3).
    0288                    
    0289      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 9
    MASTYM.CBL    23-OCT-65  22:20

    0290  * *****************************
    0291  * 	MESSAGES, ETC
    0292  * *****************************
    0293  
    0294    01	PRODUCT-LINE-TABLE.
    0295  	02	PL-DEC		PIC X(3) VALUE 'DEC' USAGE DISPLAY-7.
    0296  	02	PL-IBM		PIC X(3) VALUE 'IBM' USAGE DISPLAY-7.
    0297  	02	PL-XEROX	PIC X(5) VALUE 'XEROX' USAGE DISPLAY-7.
    0298  
    0299    01	MSG-ASTICS	PIC X(30) VALUE '******************************'
    0300  					USAGE IS DISPLAY-7.
    0301    01	MSG-INVALID	PIC X(12) VALUE '** INVALID -' USAGE DISPLAY-7.
    0302    01	MSG-PN-OR-DOT	PIC X(12) VALUE 'P/N OR <.> -' USAGE DISPLAY-7.
    0303    01	WRITE-ERROR-MESSAGE USAGE DISPLAY-7.
    0304  	02	FILLER		PIC X(19) VALUE 'ERROR ATTEMPTING A '.
    0305  	02	W-E-MSG-TYPE	PIC X(7)  VALUE SPACES.
    0306  	02	FILLER		PIC X(18) VALUE ' TO THE PARTS FILE'.
    0307      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 10
    MASTYM.CBL    23-OCT-65  22:20

    0308  * *********************************************************************
    0309  * 
    0310  * 	P R O C E D U R E     D I V I S I O N
    0311  * 
    0312  * *********************************************************************
    0313  
    0314    PROCEDURE DIVISION.
    0315  * *****************************
    0316    DECLARATIVES.
    0317  * *****************************
    0318  
    0319    MAST-BUSY SECTION.
    0320  	USE AFTER STANDARD ERROR PROCEDURE ON MAST-FILE OPEN.
    0321  
    0322    MAST-BUSY-ROUTINE.
    0323  	DISPLAY '<MAST-FILE BUSY - WAITING...>'.
    0324  	ENTER MACRO WAIT.
    0325  
    0326    NAME-BUSY SECTION.
    0327  	USE AFTER STANDARD ERROR PROCEDURE ON NAME-FILE OPEN.
    0328  
    0329    NAME-BUSY-ROUTINE.
    0330  	DISPLAY '<NAME-FILE BUSY - WAITING...>'.
    0331  	ENTER MACRO WAIT.
    0332  
    0333  * *****************************
    0334    END DECLARATIVES.
    0335  * *****************************
    0336      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 11
    MASTYM.CBL    23-OCT-65  22:20

    0337    MAIN-PROGRAM SECTION.
    0338    START-PROGRAM-HERE.
    0339  
    0340  * *****************************
    0341  * 	STARTUP ROUTINE
    0342  * *****************************
    0343  
    0344  	MOVE SPACES TO WS-MACRO-ARG.
    0345  	ENTER MACRO INVINI USING WS-MACRO-ARG.
    0346  	IF WS-MACRO-ARG-1 = 'RUN' AND WS-MACRO-ARG-EN NUMERIC
    0347  		MOVE WS-MACRO-ARG-EN TO WS-ENA;
    0348  	ELSE, ENTER MACRO LOGOFF.
    0349  	DISPLAY 'TYMAINT-10 INVENTORY SYSTEM'.
    0350  	PERFORM DATE.
    0351  	DISPLAY WS-DATE '    <' JULIAN-DATE '>'.
    0352  	DISPLAY ' '.
    0353    GET-PRODUCT-LINE.
    0354  	DISPLAY 'ENTER P/L - (D)EC, (I)BM, (X)EROX, (H)P, (V)ARIAN -'
    0355  		 WITH NO ADVANCING.
    0356  	ACCEPT M-K-PL.
    0357  	IF M-K-PL NOT = "D" AND M-K-PL NOT = 'I' AND M-K-PL NOT = 'X'
    0358  	  AND M-K-PL NOT = 'H' AND M-K-PL NOT = 'V'
    0359  		DISPLAY MSG-INVALID WITH NO ADVANCING
    0360  		GO TO GET-PRODUCT-LINE.
    0361    GET-PRODUCT-LINE-END.
    0362  	MOVE M-K-PL TO WS-PL.
    0363      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 12
    MASTYM.CBL    23-OCT-65  22:20

    0364  * *****************************
    0365  * 	PROCEDURE DISPATCH
    0366  * *****************************
    0367  
    0368    PROC.
    0369  	DISPLAY 'PROCEDURE: ' WITH NO ADVANCING.
    0370  	ACCEPT WS-ANS.
    0371  	IF WS-ANS = 'A' GO TO ADD-RECORD;
    0372  	ELSE, IF WS-ANS = 'C' GO TO CHANGE-ITEM;
    0373  	ELSE, IF WS-ANS = 'D' GO TO DELETE-RECORD;
    0374  	ELSE, IF WS-ANS = 'E' OR WS-ANS = 'Q'
    0375  		IF WS-ENA = ZERO
    0376  			STOP RUN;
    0377  		ELSE, ENTER MACRO LOGOFF;
    0378  	ELSE, IF WS-ANS = 'H' GO TO HISTORY;
    0379  	ELSE, IF WS-ANS = 'L'
    0380  		MOVE 'LISTYM' TO WS-MACRO-ARG
    0381  		MOVE WS-ENA TO WS-MACRO-ARG-EN
    0382  		ENTER MACRO RUNNIT USING WS-MACRO-ARG;
    0383  	ELSE, IF WS-ANS = 'P' GO TO DISPLAY-RECORDS;
    0384  	ELSE, GO TO NEXT-GROUP.
    0385  	GO TO PROC.
    0386    NEXT-GROUP.
    0387  	IF WS-ANS = 'S'
    0388  		MOVE 'SITTYM' TO WS-MACRO-ARG
    0389  		MOVE WS-ENA TO WS-MACRO-ARG-EN
    0390  		ENTER MACRO RUNNIT USING WS-MACRO-ARG;
    0391  	ELSE, IF WS-ANS = 'T' GO TO TYPE-RECORD;
    0392  	ELSE, IF WS-ANS = 'X' GO TO CROSS-REFERENCE;
    0393  	ELSE, IF WS-ANS = 'Y'
    0394  		MOVE 'RECTYM' TO WS-MACRO-ARG
    0395  		MOVE WS-ENA TO WS-MACRO-ARG-EN
    0396  		ENTER MACRO RUNNIT USING WS-MACRO-ARG;
    0397  	ELSE, IF WS-ANS = 'Z'
    0398  		MOVE 'CONTYM' TO WS-MACRO-ARG
    0399  		MOVE WS-ENA TO WS-MACRO-ARG-EN
    0400  		ENTER MACRO RUNNIT USING WS-MACRO-ARG;
    0401  	ELSE, IF WS-ANS = '?' GO TO HELP;
    0402  	ELSE, DISPLAY WS-ANS ' IS INVALID'
    0403  		DISPLAY 'TYPE ? FOR LIST OF VALID COMMANDS'
    0404  		GO TO PROC.
    0405      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 13
    MASTYM.CBL    23-OCT-65  22:20

    0406  * *********************************************************************
    0407  * 
    0408  * 	HELP - TYPE LIST OF VALID COMMANDS AT 'PROC' LEVEL
    0409  * 
    0410  * *********************************************************************
    0411  
    0412    HELP.
    0413  	DISPLAY ' '.
    0414  	DISPLAY 'PROCEDURES:'.
    0415  	DISPLAY '	A	ADD RECORD TO FILE'.
    0416  	DISPLAY '	C	CHANGE ANY ITEM IN MASTER RECORD'.
    0417  	DISPLAY '	D	DELETE MASTER RECORD'.
    0418  	DISPLAY '	E	EXIT'.
    0419  	DISPLAY '	H	USAGE HISTORY LISTING'.
    0420  	DISPLAY '	L	ENTER LISTYM - LISTING PROGRAM'.
    0421  	DISPLAY '	P	DISPLAY PARTS OR HIST RECORDS'
    0422  	DISPLAY '	Q	QUIT (EXIT)'.
    0423  	DISPLAY '	S	ENTER SITTYM (SITE INVENTORY PROGRAM)'.
    0424  	DISPLAY '	T	TYPE MASTER RECORD'.
    0425  	DISPLAY '	X	ADD CROSS-REFERENCE RECORDS'.
    0426  	DISPLAY '	Y	ENTER RECTYM - RECOMMENDED SPARES'.
    0427  	DISPLAY '	Z	ENTER CONTYM - CONTROL PROGRAM'.
     	DISPLAY '	?	TYPE THIS TEXT'.
    0429  	GO TO PROC.
    0430      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 14
    MASTYM.CBL    23-OCT-65  22:20

    0431  * ***********************************************************
    0432  * 	ROUTINE TO ADD RECORDS TO THE MASTER PARTS FILE
    0433  * 	CALLED FROM 'PROC'  (A)
    0434  * ************************************************************
    0435  
    0436    ADD-RECORD.
    0437  	PERFORM NEW-ROUTINE.
    0438  	DISPLAY 'ADD RECORDS TO MASTER FILE'.
    0439    ADD-REC-LOOP.
    0440  	PERFORM CLOSE-MAST-OUT THRU CLOSE-MAST-OUT-END.
    0441  	DISPLAY MSG-PN-OR-DOT WITH NO ADVANCING.
    0442  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0443  	IF RET-CODE = 2
    0444  		GO TO ADD-REC-DOIT.
    0445  	IF RET-CODE = 0 OR RET-CODE = 9
    0446  		GO TO PROC.
    0447  	IF (RET-CODE = 1 OR RET-CODE = 4) AND M-PL NOT = SPACES
    0448  		DISPLAY M-K-PARTNO ' ALREADY EXISTS'
    0449  		GO TO ADD-REC-LOOP.
    0450  	MOVE RET-CODE TO RET-CODE-SAVE.
    0451  	DISPLAY M-K-PARTNO ' EXISTS WITH BLANK P/L - ADD ANOTHER ? '
    0452  		WITH NO ADVANCING.
    0453  	PERFORM YES-NO.
    0454  	IF WS-ANS = 'N'
    0455  		GO TO ADD-REC-LOOP.
    0456  	DISPLAY 'ENTER P/L FOR ORIGINAL ENTRY - ' WITH NO ADVANCING.
    0457    ADD-GET-PREV-PL.
    0458  	PERFORM GET-PRODUCT-LINE.
    0459  	IF M-K-PL = WS-PL
    0460  	    DISPLAY '* CURRENT P/L = ' WS-PL ' PREV MUST BE DIFFERENT'
    0461  		GO TO ADD-GET-PREV-PL.
    0462  	MOVE MAST-KEY TO WS-MAST-KEY-SAVE.
    0463  	MOVE MAST-REC TO WS-MAST-REC.
    0464  	IF RET-CODE-SAVE = 1 AND M-REV-CREF NOT = SPACES
    0465  		GO TO ADD-FIX-TARGET-PTRS.
    0466  	IF RET-CODE-SAVE NOT = 4
    0467  		GO TO ADD-REC-GO.
    0468    ADD-FIX-REV-PTR.
    0469  	MOVE M-CREF-PN-PL TO M-K-PN-PL.
    0470  	READ MAST-FILE INVALID KEY
    0471  		GO TO FWD-CREF-ERROR.
    0472  	IF M-CREF = 'X'
    0473  		GO TO FWD-CREF-ERROR.
    0474      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 15
    MASTYM.CBL    23-OCT-65  22:20

    0475  * *****************************
    0476  * 	ADD (CONT)
    0477  * *****************************
    0478  
    0479    ADD-FIX-REV-PTR-1.
    0480  	IF M-REV-CREF-PN = WS-PARTNO
    0481  		GO TO ADD-FIX-REV-PTR-2;
    0482  	ELSE, IF M-REV-CREF = SPACES
    0483  		GO TO REV-CREF-ERROR.
    0484  	MOVE M-REV-CREF TO M-K-PN-PL.
    0485  	READ MAST-FILE INVALID KEY
    0486  		GO TO REV-CREF-ERROR.
    0487  	GO TO ADD-FIX-REV-PTR-1.
    0488    ADD-FIX-REV-PTR-2.
    0489  	MOVE WS-MAST-PN-PL-SAVE TO M-REV-CREF.
    0490  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0491  	GO TO ADD-REC-GO.
    0492  
    0493    ADD-FIX-TARGET-PTRS.
    0494  	MOVE M-REV-CREF TO M-K-PN-PL.
    0495  	READ MAST-FILE INVALID KEY
    0496  		GO TO REV-CREF-ERROR.
    0497  	MOVE WS-MAST-PL-SAVE TO M-CREF-PL.
    0498  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0499  	IF M-REV-CREF NOT = SPACES
    0500  		GO TO ADD-FIX-TARGET-PTRS.
    0501  
    0502    ADD-REC-GO.
    0503  	MOVE WS-MAST-KEY-SAVE TO MAST-KEY.
    0504  	IF WS-MAST-FLAG NOT = 'O' AND WS-MAST-FLAG NOT = 'B'
    0505  		PERFORM OPEN-IO-MAST-FILE THRU OPEN-IO-MAST-FILE-END.
    0506  	MOVE WS-MAST-REC TO MAST-REC.
    0507  	PERFORM WRITE-MAST-REC THRU WRITE-MAST-REC-END.
    0508  	MOVE SPACES TO MAST-REC M-K-PL.
    0509  	MOVE 1 TO M-FLAG.
    0510  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0511  	MOVE WS-PL TO M-K-PL.
    0512    ADD-REC-DOIT.
    0513  	MOVE SPACES TO MAST-REC.
    0514  	PERFORM ACCEPT-OPT-DESC-VPN-VC.
    0515  	DISPLAY 'PRICE: ' WITH NO ADVANCING.
    0516  	ACCEPT M-PRICE.
    0517  	PERFORM GET-RR-CODE THRU GET-RR-CODE-END.
    0518  	PERFORM VERIFY-OK.
    0519  	IF RET-CODE = 0
    0520  		DISPLAY 'ABORTING THIS RECORD'
    0521  		GO TO ADD-REC-LOOP.
    0522  	PERFORM WRITE-MAST-REC THRU WRITE-MAST-REC-END.
    0523  	GO TO ADD-REC-LOOP.
    0524      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 16
    MASTYM.CBL    23-OCT-65  22:20

    0525  * *********************************************************************
    0526  * 	CHANGE-ITEM - ROUTINE TO CHANGE ANY ITEM IN A SELECTED RECORD.
    0527  * 	CALLED FROM 'PROC'  (C)
    0528  * 
    0529  * 	IF CHANGE PARTNO, NEW PART NUMBER WILL BE PUT INTO EXISTING
    0530  * 	RECORD & MAST-KEY & RECORD WRITTEN. THE OLD RECORD WILL 
    0531  * 	THEN BE DELETED.
    0532  * 
    0533  * *********************************************************************
    0534  
    0535    CHANGE-ITEM.
    0536  	PERFORM NEW-ROUTINE.
    0537  	DISPLAY 'CHANGE RECORDS'.
    0538    CHANGE-LOOP.
    0539  	PERFORM CLOSE-MAST-OUT THRU CLOSE-MAST-OUT-END.
    0540  	DISPLAY ' '.
    0541  	DISPLAY MSG-PN-OR-DOT WITH NO ADVANCING.
    0542  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0543  	IF RET-CODE = 1
    0544  		GO TO CHANGE-CMD;
    0545  	ELSE, IF RET-CODE = 0 OR RET-CODE = 2
    0546  		DISPLAY MAST-KEY ' NON-EXISTANT'
    0547  		GO TO CHANGE-LOOP;
    0548  	ELSE, IF RET-CODE = 4
    0549  		DISPLAY 'THIS IS A CREF RECORD--PROCEED ? '
    0550  			WITH NO ADVANCING
    0551  		PERFORM YES-NO
    0552  		IF WS-ANS = 'Y'
    0553  			GO TO CHANGE-CMD;
    0554  		ELSE, DISPLAY '** ABORTING **'
    0555  			GO TO CHANGE-LOOP;
    0556  	ELSE, IF RET-CODE = 9
    0557  		GO TO PROC.
    0558      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 17
    MASTYM.CBL    23-OCT-65  22:20

    0559  * *****************************
    0560  * 	CHANGE (CONT)
    0561  * *****************************
    0562  
    0563    CHANGE-CMD.
    0564  	DISPLAY 'CHANGE WHAT ? ' WITH NO ADVANCING.
    0565  	ACCEPT ITEM-NAME.
    0566  	IF ITEM-NAME = 'PARTNO' OR ITEM-CHAR = 'P'
    0567  		GO TO CHANGE-PARTNO;
    0568  	ELSE, IF ITEM-CHAR = 'D'
    0569  		IF M-CREF  NOT = SPACES
    0570  			DISPLAY '* CANNOT CHANGE DESC IN CREF RECORD *'
    0571  			GO TO CHANGE-CMD;
    0572  		ELSE, DISPLAY 'DESC = ' M-DESC '   DESC - '
    0573  			WITH NO ADVANCING
    0574  			ACCEPT M-DESC;
    0575  	ELSE, IF ITEM-NAME = 'C' OR ITEM-NAME = 'COST'
    0576  	    DISPLAY 'PRICE = ' M-PRICE '    PRICE - ' WITH NO ADVANCING
    0577  		ACCEPT M-PRICE;
    0578  	ELSE, IF ITEM-NAME = 'VPN'
    0579  		DISPLAY 'VPN = ' M-VPN '    VPN - ' WITH NO ADVANCING
    0580  		ACCEPT M-VPN;
    0581  	ELSE, IF ITEM-NAME = 'VC'
    0582  		DISPLAY 'VC = ' M-VC '    VC - ' WITH NO ADVANCING
    0583  		ACCEPT M-VC;
    0584  	ELSE, IF ITEM-CHAR = 'O'
    0585  	    DISPLAY 'OPTION = ' M-OPT '   OPTION - ' WITH NO ADVANCING
    0586  		ACCEPT M-OPT;
    0587  	ELSE, IF ITEM-CHAR = 'R'
    0588  		DISPLAY 'R/R CODE = ' M-RR '    ' WITH NO ADVANCING
    0589  		PERFORM GET-RR-CODE THRU GET-RR-CODE-END;
    0590  	ELSE, IF ITEM-CHAR = '.' GO TO CHANGE-GO;
    0591  	ELSE, IF ITEM-CHAR = '?' GO TO CHANGE-HELP;
    0592  	ELSE, DISPLAY '* INVALID - TYPE ? FOR HELP *'.
    0593  	GO TO CHANGE-CMD.
    0594  
    0595    CHANGE-HELP.
    0596  	DISPLAY 'VALID FIELDS ARE:'.
    0597  	DISPLAY '(P)ARTNO	PART NUMBER'.
    0598  	DISPLAY '(D)ESC		DESCRIPTION'.
    0599  	DISPLAY 'VPN		VENDOR P/N OR GENERIC'.
    0600  	DISPLAY 'VC		VENDOR CODE'.
    0601  	DISPLAY 'OPT		OPTION USED ON'.
    0602  	DISPLAY 'C		COST (PRICE)'.
    0603  	DISPLAY 'R		R/R CODE'.
    0604  	DISPLAY '.		END OF CHANGES TO THIS P/N'.
    0605  	GO TO CHANGE-CMD.
    0606      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 18
    MASTYM.CBL    23-OCT-65  22:20

    0607  * *****************************
    0608  * 	CHANGE (CONT)
    0609  * *****************************
    0610  
    0611    CHANGE-GO.
    0612  	DISPLAY 'OK?  ' WITH NO ADVANCING.
    0613  	PERFORM YES-NO.
    0614  	IF WS-ANS = 'N'
    0615  		DISPLAY '* ABORTING *'
    0616  		GO TO CHANGE-LOOP.
    0617  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0618  	DISPLAY M-PARTNO ' HAS BEEN CHANGED'.
    0619  	GO TO CHANGE-LOOP.
    0620  
    0621    CHANGE-PARTNO.
    0622  	IF M-CREF = 'X' OR M-REV-CREF NOT = SPACES
    0623  		DISPLAY '** THIS REC IN CREF LINK - CANNOT CHANGE P/N'
    0624  		DISPLAY '** MUST DELETE, THEN ADD NEW NUMBER'
    0625  		GO TO CHANGE-LOOP.
    0626  	MOVE MAST-KEY TO WS-MAST-KEY-SAVE.
    0627  	DISPLAY 'NEW PART NUMBER - ' WITH NO ADVANCING.
    0628  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0629  	IF RET-CODE NOT = 2
    0630  		DISPLAY MAST-KEY ' IS AN EXISTANT PART NUMBER - ABORTED'
    0631  		GO TO CHANGE-LOOP.
    0632  	DISPLAY 'CHANGING ' WS-MAST-KEY-SAVE ' TO ' MAST-KEY ' -- OK? '
    0633  		WITH NO ADVANCING.
    0634  	PERFORM YES-NO.
    0635  	IF WS-ANS = 'N'
    0636  		DISPLAY '** ABORTING**'
    0637  		GO TO CHANGE-LOOP.
    0638  	PERFORM WRITE-MAST-REC THRU WRITE-MAST-REC-END.
    0639  	MOVE WS-MAST-KEY-SAVE TO MAST-KEY.
    0640  	PERFORM DELETE-MAST-REC THRU DELETE-MAST-REC-END.
    0641  	DISPLAY 'CHANGE COMPLETE'.
    0642  	GO TO CHANGE-LOOP.
    0643      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 19
    MASTYM.CBL    23-OCT-65  22:20

    0644  * *********************************************************************
    0645  * 	CROSS-REFERENCE - ROUTINE TO ADD CREF RECORDS TO FILE.
    0646  * 	CALLED FROM 'PROC'.
    0647  * 	WILL DELETE ANY CURRENT RECORD ENTERED AS 'CREF FROM'.
    0648  * *********************************************************************
    0649  
    0650    CROSS-REFERENCE.
    0651  	PERFORM NEW-ROUTINE.
    0652  	DISPLAY 'ADD CROSS-REFERENCE RECORDS TO FILE'.
    0653  	DISPLAY ' '.
    0654    CROSS-REF-LOOP.
    0655  	PERFORM CLOSE-MAST-OUT THRU CLOSE-MAST-OUT-END.
    0656  	DISPLAY 'CREF FROM ' MSG-PN-OR-DOT WITH NO ADVANCING.
    0657  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0658  	IF RET-CODE = 0 OR RET-CODE = 9
    0659  		DISPLAY 'EXIT CREF'
    0660  		GO TO PROC.
    0661  	IF RET-CODE = 1
    0662  		MOVE MAST-REC TO WS-MAST-REC
    0663  		MOVE 'R' TO WS-REWRITE-FLAG;
    0664  	ELSE, IF RET-CODE = 4
    0665  		DISPLAY '* CANNOT CREF A CREF RECORD *'
    0666  		DISPLAY '* MUST DELETE, THEN CREF *'
    0667  		GO TO CROSS-REF-LOOP;
    0668  	ELSE, MOVE SPACES TO WS-MAST-REC
    0669  		MOVE M-K-PARTNO TO M1-REC-PN-PL
    0670  		MOVE 'W' TO WS-REWRITE-FLAG.
    0671  	DISPLAY 'P/N TO REF - ' WITH NO ADVANCING.
    0672  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0673  	IF RET-CODE = 0 OR RET-CODE = 9
    0674  		DISPLAY '**ERROR**'
    0675  		GO TO CROSS-REF-LOOP;
    0676  	ELSE, IF RET-CODE = 2
    0677  		DISPLAY MAST-KEY ' NON-EXISTANT - ABORTING'
    0678  		GO TO CROSS-REF-LOOP;
    0679  	ELSE, IF RET-CODE = 4
    0680  		DISPLAY 'CANNOT CREF TO A *CREF* RECORD'
    0681  		GO TO CROSS-REF-LOOP;
    0682  	ELSE, IF M1-REC-KEY = M-REC-KEY
    0683  		DISPLAY '* CANNOT CREF NUMBER TO ITSELF *'
    0684  		GO TO CROSS-REF-LOOP.
    0685  	IF M-PRICE = ZERO
    0686  		MOVE M1-PRICE TO M-PRICE.
    0687  	IF M-REC-QUAN = ZERO
    0688  		MOVE M1-REC-QUAN TO M-REC-QUAN.
    0689      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 20
    MASTYM.CBL    23-OCT-65  22:20

    0690  * *****************************
    0691  * 	CROSS-REF  (CONT)
    0692  * *****************************
    0693  
    0694  	IF (M-OPT = SPACES OR M-OPT = 'SYSTEM')
    0695  	AND M1-OPT NOT = SPACES
    0696  		MOVE M1-OPT TO M-OPT;
    0697  	ELSE, IF M-OPT = M1-OPT
    0698  		NEXT SENTENCE;
    0699  	ELSE, DISPLAY 'FM OPT= ' M1-OPT ' TO OPT= ' M-OPT
    0700  		DISPLAY 'OPTION - ' WITH NO ADVANCING
    0701  		ACCEPT M-OPT
    0702  		MOVE M-OPT TO M1-OPT.
    0703  	IF M-VC = SPACES
    0704  		MOVE M1-VC TO M-VC.
    0705  	IF M-VPN = SPACES
    0706  		MOVE M1-VPN TO M-VPN.
    0707  	MOVE 'X' TO M1-CREF.
    0708  	MOVE 'SEE' TO M1-CREF-SEE.
    0709  	MOVE M-REC-PN-PL TO M1-CREF-PN-PL.
    0710  	IF M-REV-CREF = SPACES
    0711  		MOVE M1-REC-PN-PL TO M-REV-CREF
    0712  		MOVE ZERO TO RET-CODE;
    0713  	ELSE, MOVE 1 TO RET-CODE.
    0714  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0715  	IF RET-CODE = ZERO
    0716  		GO TO CROSS-REF-GO.
    0717    CREF-REV-LOOP.
    0718  	MOVE M-REV-CREF TO M-K-PN-PL.
    0719  	READ MAST-FILE INVALID KEY
    0720  		DISPLAY '** ERROR IN REV-CREF CHAINING **'
    0721  		GO TO FILE-ERROR-LOCK.
    0722  	IF M-REV-CREF NOT = SPACES
    0723  		GO TO CREF-REV-LOOP.
    0724  	MOVE M1-REC-PN-PL TO M-REV-CREF.
    0725  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0726  
    0727    CROSS-REF-GO.
    0728  	MOVE M1-REC-KEY TO MAST-KEY.
    0729  	MOVE WS-MAST-REC TO MAST-REC.
    0730  	IF WS-REWRITE-FLAG = 'R'
    0731  		PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END;
    0732  	ELSE, PERFORM WRITE-MAST-REC THRU WRITE-MAST-REC-END.
    0733  	GO TO CROSS-REF-LOOP.
    0734      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 21
    MASTYM.CBL    23-OCT-65  22:20

    0735  * ***********************************************************
    0736  * 	ROUTINE TO DELETE RECORDS FROM MASTER FILE
    0737  * 	CALLED FROM 'PROC'  (D)
    0738  * ***********************************************************
    0739  
    0740    DELETE-RECORD.
    0741  	PERFORM NEW-ROUTINE.
    0742  	DISPLAY 'ENTER PART NUMBER(S) <CR> TO DELETE'.
    0743  	DISPLAY 'TYPE <.> WHEN FINISHED'.
    0744    DELETE-REC-LOOP.
    0745  	PERFORM CLOSE-MAST-OUT THRU CLOSE-MAST-OUT-END.
    0746  	DISPLAY 'P/N: ' WITH NO ADVANCING.
    0747  	ACCEPT MAST-KEY.
    0748  	IF MAST-KEY = '.'
    0749  		GO TO PROC.
    0750  	PERFORM OPEN-IO-MAST-FILE THRU OPEN-IO-MAST-FILE-END.
    0751  	READ MAST-FILE INVALID KEY
    0752  		DISPLAY MAST-KEY ' NON-EXISTANT'
    0753  		GO TO DELETE-REC-LOOP.
    0754  	IF M-FLAG NOT = 1
    0755  		GO TO DELETE-REC-PL-BLANK.
    0756  	MOVE WS-PL TO M-K-PL.
    0757  	READ MAST-FILE INVALID KEY
    0758  		DISPLAY MAST-KEY ' NON-EXISTANT'
    0759  		GO TO DELETE-REC-LOOP.
    0760    DELETE-REC-PL-BLANK.
    0761  	IF M-CREF = 'X'
    0762  		DISPLAY '* CREF RECORD DELETED *'
    0763  		GO TO DELETE-LINK-REV-CREF.
    0764  	IF M-REV-CREF NOT = SPACES
    0765  		DISPLAY '* THIS IS A CREF TARGET REC - NOT DELETED'
    0766  		GO TO DELETE-REC-LOOP.
    0767  	IF M-SITES = ZERO
    0768  		GO TO DELETE-REC-DOIT.
    0769  	DISPLAY '*THIS ITEM STOCKED ON ' M-SITES ' SITES - NOT DELETED'.
    0770  	GO TO DELETE-REC-LOOP.
    0771      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 22
    MASTYM.CBL    23-OCT-65  22:20

    0772  * *****************************
    0773  * 	DELETE MASTER (CONT)
    0774  * *****************************
    0775  
    0776    DELETE-LINK-REV-CREF.
    0777  	MOVE M-REV-CREF TO M1-REV-CREF.
    0778  	MOVE MAST-KEY TO WS-MAST-KEY-SAVE.
    0779  	MOVE M-CREF-PN-PL TO M-K-PN-PL.
    0780  	READ MAST-FILE INVALID KEY
    0781  		GO TO FWD-CREF-ERROR.
    0782    DELETE-LINK-REV-CREF-1.
    0783  	IF M-REV-CREF = WS-MAST-PN-PL-SAVE
    0784  		GO TO DELETE-LINK-REV-CREF-2;
    0785  	ELSE, IF M-REV-CREF = SPACES
    0786  		GO TO REV-CREF-ERROR.
    0787  	MOVE M-REV-CREF TO M-K-PN-PL.
    0788  	READ MAST-FILE INVALID KEY
    0789  		GO TO REV-CREF-ERROR.
    0790  	GO TO DELETE-LINK-REV-CREF-1.
    0791    DELETE-LINK-REV-CREF-2.
    0792  	MOVE M1-REV-CREF TO M-REV-CREF.
    0793  	PERFORM REWRITE-MAST-REC THRU REWRITE-MAST-REC-END.
    0794  	MOVE WS-MAST-KEY-SAVE TO MAST-KEY.
    0795  
    0796    DELETE-REC-DOIT.
    0797  	PERFORM DELETE-MAST-REC THRU DELETE-MAST-REC-END.
    0798  	GO TO DELETE-REC-LOOP.
    0799      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 23
    MASTYM.CBL    23-OCT-65  22:20

    0800  * ***********************************************************
    0801  * 	DISPLAY RECORDS - DISPLAYS A SELECTED RECORD FROM
    0802  * 		MASTER OR HISTORY FILE AS IT EXISTS
    0803  * 	CALLED FROM 'PROC'
    0804  * ***********************************************************
    0805  
    0806    DISPLAY-RECORDS.
    0807  	DISPLAY 'ENTER (P)ARTS-REC, (H)IST-REC, OR (E)ND - '
    0808  		WITH NO ADVANCING.
    0809    DISPLAY-REC-LOOP.
    0810  	ACCEPT WS-SUB-OPT.
    0811  	IF WS-SUB-OPT NOT = 'P' AND WS-SUB-OPT NOT = 'H'
    0812  		GO TO PROC.
    0813  	DISPLAY 'P/N- ' WITH NO ADVANCING.
    0814  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0815  	IF RET-CODE NOT = 1 AND RET-CODE NOT = 4
    0816  		DISPLAY M-K-PARTNO ' NOT IN MASTER FILE'
    0817  		GO TO DISPLAY-REC-END.
    0818  	IF WS-SUB-OPT = 'P'
    0819  		DISPLAY MAST-REC
    0820  		GO TO DISPLAY-REC-END.
    0821    DISPLAY-HIST-REC.
    0822  	PERFORM OPEN-HIST-FILE THRU OPEN-HIST-FILE-END.
    0823  	MOVE M-K-PN-PL TO H-K-PN-PL.
    0824  	DISPLAY 'REC# ' WITH NO ADVANCING.
    0825  	ACCEPT H-K-ENTRY-NO.
    0826  	READ HIST-FILE INVALID KEY
    0827  		DISPLAY HIST-KEY ' NON-EXISTANT'
    0828  		GO TO DISPLAY-REC-END.
    0829  	DISPLAY HIST-REC.
    0830    DISPLAY-REC-END.
    0831  	DISPLAY 'TYPE P,H, OR E -' WITH NO ADVANCING.
    0832  	GO TO DISPLAY-REC-LOOP.
    0833      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 24
    MASTYM.CBL    23-OCT-65  22:20

    0834  * *********************************************************************
    0835  * 
    0836  * 	HISTORY FILE CHECK AND LIST ROUTINES
    0837  * 	CALLED FROM 'PROC'  (H)
    0838  * 
    0839  * *********************************************************************
    0840  
    0841    HISTORY.
    0842  	PERFORM NEW-ROUTINE.
    0843  	DISPLAY 'USAGE HISTORY ROUTINES'.
    0844    HISTORY-CHECK.
    0845  	PERFORM OPEN-I-MAST-FILE THRU OPEN-I-MAST-FILE-END.
    0846  	PERFORM OPEN-HIST-FILE THRU OPEN-HIST-FILE-END.
    0847    HISTORY-CHECK-OPT.
    0848  	DISPLAY 'TYPE (E)ACH USAGE, OR (S)UMMARY - ' WITH NO ADVANCING.
    0849  	ACCEPT WS-SUB-OPT.
    0850  	IF WS-SUB-OPT NOT = 'E' AND WS-SUB-OPT NOT = 'S'
    0851  		DISPLAY 'INVALID - RETYPE'
    0852  		GO TO HISTORY-CHECK-OPT.
    0853    HISTORY-CHECK-LOOP.
    0854  	DISPLAY MSG-PN-OR-DOT WITH NO ADVANCING.
    0855  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0856  	IF RET-CODE = 1
    0857  		GO TO HISTORY-CHECK-READ;
    0858  	ELSE, IF RET-CODE = 0 OR RET-CODE = 4
    0859  		GO TO HISTORY-CHECK-LOOP;
    0860  	ELSE, IF RET-CODE = 2
    0861  		MOVE '** NOT IN MASTER FILE' TO M-DESC
    0862  		GO TO HISTORY-CHECK-READ;
    0863  	ELSE, GO TO PROC.
    0864    HISTORY-CHECK-READ.
    0865  	MOVE M-K-PARTNO TO H-K-PARTNO.
    0866  	MOVE ZERO TO H-K-ENTRY-NO.
    0867  	READ HIST-FILE INVALID KEY
    0868  		GO TO HISTORY-CHECK-NO-USAGE.
    0869  	IF H-QUAN = 0
    0870  		GO TO HISTORY-CHECK-NO-USAGE.
    0871  	MOVE ZERO TO WS-QUAN.
    0872  	MOVE H-QUAN TO WS-MAX-EXT.
    0873  	DISPLAY MAST-KEY  '    ' M-DESC.
    0874      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 25
    MASTYM.CBL    23-OCT-65  22:20

    0875  * *****************************
    0876  * 	HISTORY-CHECK  (CONT)
    0877  * *****************************
    0878  
    0879    HISTORY-CHECK-ITEM-LOOP.
    0880  	ADD 1 TO H-K-ENTRY-NO.
    0881  	READ HIST-FILE INVALID KEY
    0882  		GO TO HIST-FILE-SEQ-ERROR.
    0883  	IF WS-SUB-OPT NOT = 'E'
    0884  		GO TO HISTORY-SKIP-EACH.
    0885  	MOVE H-DATE TO WS-JULIAN-DATE.
    0886  	PERFORM DATE-CONV THRU DATE-CONV-END.
    0887  	IF H-XFER = SPACES
    0888  	  DISPLAY 'SITE# ' H-SITE-NO ' USED ' H-QUAN ' ON ' WS-DATE-OUT;
    0889  	ELSE, DISPLAY 'SITE# ' H-SITE-NO ' SHIPPED ' H-QUAN ' TO SITE# '
    0890  - 	 H-XFER-SITE ' ON ' WS-DATE-OUT.
    0891    HISTORY-SKIP-EACH.
    0892  	ADD H-QUAN TO WS-QUAN.
    0893  	IF H-K-ENTRY-NO < WS-MAX-EXT
    0894  		GO TO HISTORY-CHECK-ITEM-LOOP.
    0895  	DIVIDE WS-QUAN BY WS-MAX-EXT GIVING WS-BAL.
    0896  	DISPLAY WS-MAX-EXT ' ENTRIES - TOTAL USED = ' WS-QUAN.
    0897  	DISPLAY 'AVERAGE ITEMS/USAGE = ' WS-BAL.
    0898    HISTORY-CHECK-LAST-LINE.
    0899  	DISPLAY '**************'.
    0900  	GO TO HISTORY-CHECK-LOOP.
    0901    HISTORY-CHECK-NO-USAGE.
    0902  	DISPLAY '** NO USAGE FOR ' MAST-KEY.
    0903  	GO TO HISTORY-CHECK-LAST-LINE.
    0904      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 26
    MASTYM.CBL    23-OCT-65  22:20

    0905  * ***********************************************************
    0906  * 	ROUTINE TO TYPE ALL INFO IN A PARTS RECORD
    0907  * 	CALLED FROM 'PROC'
    0908  * ***********************************************************
    0909  
    0910    TYPE-RECORD.
    0911  	PERFORM OPEN-I-MAST-FILE THRU OPEN-I-MAST-FILE-END.
    0912  	PERFORM OPEN-HIST-FILE THRU OPEN-HIST-FILE-END.
    0913  	PERFORM NEW-ROUTINE.
    0914  	DISPLAY 'TYPE PARTS RECORDS'
    0915    TYPE-REC-LOOP.
    0916  	DISPLAY ' '.
    0917  	DISPLAY MSG-PN-OR-DOT WITH NO ADVANCING.
    0918  	PERFORM SEARCH-PARTNO THRU SEARCH-PARTNO-END.
    0919  	IF RET-CODE = 1
    0920  		GO TO TYPE-REC-DOIT.
    0921  	IF RET-CODE = 4
    0922  		GO TO TYPE-REC-LOOP.
    0923  	IF RET-CODE = 2 OR RET-CODE = 0
    0924  		DISPLAY MAST-KEY ' NON-EXISTANT'
    0925  		GO TO TYPE-REC-LOOP.
    0926  	IF RET-CODE = 9
    0927  		GO TO PROC.
    0928    TYPE-REC-DOIT.
    0929  	DISPLAY 'P/N: ' M-PARTNO '  DESC: ' M-DESC.
    0930  	DISPLAY 'VC: ' M-VC '   V-P/N: ' M-VPN.
    0931  	DISPLAY 'PRICE: ' M-PRICE '    R/R CODE: ' M-RR.
    0932  	MOVE M-K-PN-PL TO H-K-PN-PL.
    0933  	MOVE ZERO TO H-K-ENTRY-NO.
    0934  	READ HIST-FILE INVALID KEY
    0935  		GO TO TYPE-REC-NO-USAGE.
    0936  	IF H-QUAN = ZERO
    0937  		GO TO TYPE-REC-NO-USAGE.
    0938  	MOVE H-QUAN TO H-K-ENTRY-NO.
    0939  	READ HIST-FILE INVALID KEY
    0940  		GO TO HIST-FILE-SEQ-ERROR.
    0941  	MOVE H-DATE TO WS-JULIAN-DATE.
    0942  	PERFORM DATE-CONV THRU DATE-CONV-END.
    0943  	DISPLAY 'LAST USED ON ' WS-DATE-OUT.
    0944  	IF M-REV-CREF = SPACES
    0945  		GO TO TYPE-REC-LOOP.
    0946  	DISPLAY 'POINTED TO BY FOLLOWING PART NUMBERS:'.
    0947    TYPE-REC-CREF.
    0948  	DISPLAY M-REV-CREF.
    0949  	MOVE M-REV-CREF TO MAST-KEY.
    0950  	READ MAST-FILE INVALID KEY
    0951  		DISPLAY '** REVERSE CROSS-REF ERROR **'
    0952  		GO TO TYPE-REC-LOOP.
    0953  	IF M-REV-CREF = SPACES
    0954  		GO TO TYPE-REC-LOOP;
    0955  	ELSE, GO TO TYPE-REC-CREF.
    0956  
    0957    TYPE-REC-NO-USAGE.
    0958  	DISPLAY '* NO RECORDED USAGE *'.
    0959  	GO TO TYPE-REC-LOOP.
    0960      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 27
    MASTYM.CBL    23-OCT-65  22:20

    0961  * ***********************************************************
    0962  * 
    0963  * 	ROUTINE TO ACCEPT A PART NUMBER AND SEE IF IT EXISTS IN FILE
    0964  * 
    0965  * 	RETURN CODES:
    0966  * 	0	PART NUMBER TYPED = SPACES OR <CR>
    0967  * 	1	PART NUMBER EXISTS - RECORD IS IN MAST-REC
    0968  * 	2	PART NUMBER NON-EXISTANT
    0969  * 	4	CROSS-REFERENCE RECORD
    0970  * 	9	'.' WAS TYPED AS PART NUMBER
    0971  * 
    0972  * ***********************************************************
    0973  
    0974    SEARCH-PARTNO.
    0975  	PERFORM OPEN-I-MAST-FILE THRU OPEN-I-MAST-FILE-END.
    0976  	ACCEPT WS-PARTNO.
    0977  	IF WS-PARTNO = SPACES
    0978  		MOVE 0 TO RET-CODE
    0979  		GO TO SEARCH-PARTNO-END.
    0980  	IF WS-PARTNO = '.'
    0981  		MOVE 9 TO RET-CODE
    0982  		GO TO SEARCH-PARTNO-END.
    0983  	MOVE WS-PARTNO TO M-K-PARTNO.
    0984  	MOVE SPACES TO M-K-PL.
    0985    SEARCH-PARTNO-READ.
    0986  	READ MAST-FILE INVALID KEY
    0987  		MOVE 2 TO RET-CODE
    0988  		GO TO SEARCH-PARTNO-END.
    0989  	IF M-FLAG NOT = 1
    0990  		GO TO SEARCH-PARTNO-CHECK-CREF.
    0991  	IF M-K-PL NOT = SPACES
    0992  		GO TO FILE-ERROR-LOCK.
    0993  	MOVE WS-PL TO M-K-PL.
    0994  	GO TO SEARCH-PARTNO-READ.
    0995    SEARCH-PARTNO-CHECK-CREF.
    0996  	IF M-CREF = 'X'
    0997  		DISPLAY 'CREF RECORD -- ' M-DESC
    0998  		MOVE 4 TO RET-CODE
    0999  		GO TO SEARCH-PARTNO-END.
    1000  	MOVE 1 TO RET-CODE.
    1001    SEARCH-PARTNO-END. EXIT.
    1002  
    1003      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 28
    MASTYM.CBL    23-OCT-65  22:20

    1004  * ***********************************************************
    1005  * 
    1006  * 	THE FOLLOWING TWO ROUTINES ACCEPT DATA FOR THE PARTS RECORD
    1007  * 
    1008  * ***********************************************************
    1009  
    1010    ACCEPT-OPT-DESC-VPN-VC.
    1011  	DISPLAY 'DESCRIPTION: ' WITH NO ADVANCING.
    1012  	ACCEPT M-DESC.
    1013  	DISPLAY 'VENDOR P/N: ' WITH NO ADVANCING.
    1014  	ACCEPT M-VPN.
    1015  	DISPLAY 'VC: ' WITH NO ADVANCING.
    1016  	ACCEPT M-VC.
    1017  	DISPLAY 'OPTION: ' WITH NO ADVANCING.
    1018  	ACCEPT M-OPT.
    1019    ACCEPT-OPT-DESC-VPN-VC-END.
    1020  
    1021  
    1022    GET-RR-CODE.
    1023  	DISPLAY 'R/R CODE - ' WITH NO ADVANCING.
    1024  	ACCEPT M-RR.
    1025  	IF M-RR NOT = 'R' AND M-RR NOT = 'E'
    1026  		DISPLAY '* INVALID - VALID CODES ARE:'
    1027  		DISPLAY 'R	REPAIRABLE'
    1028  		DISPLAY 'E	EXPENDABLE'
    1029  		GO TO GET-RR-CODE.
    1030    GET-RR-CODE-END. EXIT.
    1031  
    1032  * ***********************************************************
    1033  * 
    1034  * 	ROUTINES TO GET A RESPONSE AS INDICATED
    1035  * 
    1036  * ***********************************************************
    1037  
    1038    YES-NO.
    1039  	ACCEPT WS-ANS.
    1040  	IF WS-ANS = 'Y' MOVE 1 TO RET-CODE;
    1041  	ELSE, IF WS-ANS = 'N' MOVE 0 TO RET-CODE;
    1042  	ELSE, DISPLAY 'Y OR N ONLY'
    1043  		GO TO YES-NO.
    1044    YES-NO-END. EXIT.
    1045  
    1046    VERIFY-OK.
    1047  	DISPLAY 'OK? ' WITH NO ADVANCING.
    1048  	PERFORM YES-NO.
    1049    VERIFY-OK-END.
    1050      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 29
    MASTYM.CBL    23-OCT-65  22:20

    1051  * ***********************************************************
    1052  * 	ROUTINE TO PRINT ASTICS & A BLANK
    1053  * 		FOR EACH NEW ROUTINE ENTERED
    1054  * ***********************************************************
    1055  
    1056    NEW-ROUTINE.
    1057  	DISPLAY MSG-ASTICS.
    1058  	IF WS-PL = 'D'
    1059  		DISPLAY PL-DEC;
    1060  	ELSE, IF WS-PL = 'I'
    1061  		DISPLAY PL-IBM;
    1062  	ELSE, IF WS-PL = 'X'
    1063  		DISPLAY PL-XEROX;
    1064  	ELSE, DISPLAY '** PRODUCT LINE NOT SET **'.
    1065  	DISPLAY ' '.
    1066    NEW-ROUTINE-END.
    1067      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 30
    MASTYM.CBL    23-OCT-65  22:20

    1068  * ***********************************************************
    1069  * 	DATE - ROUTINE TO FORMAT 'TODAY' AND COMPUTE JULIAN DATE
    1070  * 	CALLED FROM FIRST PHASE OF PROCEDURE DIVISION
    1071  * ***********************************************************
    1072  
    1073    DATE.
    1074  	MOVE TODAY TO WS-TEMP-DATE.
    1075  	MOVE WSTM TO WS-MONTH, I.
    1076  	MOVE WSTD TO WS-DAY.
    1077  	MOVE WSTY TO WS-YEAR.
    1078  	MOVE DATE-TBL (I) TO JULIAN-DAY.
    1079  	ADD WSTD TO JULIAN-DAY.
    1080  	MOVE WS-YEAR-DIGIT-2 TO JULIAN-YEAR.
    1081    DATE-END.
    1082  
    1083  
    1084  * *****************************
    1085  *  ROUTINE TO CONV BACK FM JULIAN
    1086  *  CALLED W/ JULIAN DATE IN WS-JULIAN-DATE
    1087  * *****************************
    1088  
    1089    DATE-CONV.
    1090  	IF WS-CONV-DAY > 365
    1091  		MOVE '*ERROR*' TO WS-DATE-OUT
    1092  		GO TO DATE-CONV-END.
    1093  	MOVE 1 TO I.
    1094    DATE-CONV-LOOP.
    1095  	IF DATE-TBL(I) NOT > WS-CONV-DAY
    1096  		ADD 1 TO I
    1097  		GO TO DATE-CONV-LOOP.
    1098  	SUBTRACT 1 FROM I.
    1099  	MOVE I TO WS-MONTH-OUT.
    1100  	SUBTRACT DATE-TBL(I) FROM WS-CONV-DAY GIVING WS-DAY-OUT.
    1101  	MOVE WS-YEAR-DIGIT-1 TO WS-YEAR-OUT-1.
    1102  	MOVE WS-CONV-YEAR TO WS-YEAR-OUT-2.
    1103  	MOVE '-' TO WS-D-SEP-1 WS-D-SEP-2.
    1104    DATE-CONV-END. EXIT.
    1105      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 31
    MASTYM.CBL    23-OCT-65  22:20

    1106  * *********************************************************************
    1107  * 
    1108  * 	FILE OPEN/CLOSE/READ/WRITE ROUTINES
    1109  * 
    1110  * *********************************************************************
    1111  
    1112    OPEN-I-MAST-FILE.
    1113  	IF WS-MAST-FLAG = 'I' OR WS-MAST-FLAG = 'B'
    1114  		GO TO OPEN-I-MAST-FILE-END.
    1115  	IF WS-MAST-FLAG NOT = SPACES
    1116  		CLOSE MAST-FILE.
    1117  	OPEN INPUT MAST-FILE.
    1118  	MOVE 'I' TO WS-MAST-FLAG.
    1119    OPEN-I-MAST-FILE-END. EXIT.
    1120  
    1121    OPEN-O-MAST-FILE.
    1122  	IF WS-MAST-FLAG = 'O' OR WS-MAST-FLAG = 'B'
    1123  		GO TO OPEN-O-MAST-FILE-END.
    1124  	IF WS-MAST-FLAG NOT = SPACES
    1125  		CLOSE MAST-FILE.
    1126  	MOVE MAST-REC TO WS-MAST-REC-SAVE.
    1127  	OPEN OUTPUT MAST-FILE.
    1128  	MOVE WS-MAST-REC-SAVE TO MAST-REC.
    1129  	MOVE 'O' TO WS-MAST-FLAG.
    1130    OPEN-O-MAST-FILE-END. EXIT.
    1131  
    1132    OPEN-IO-MAST-FILE.
    1133  	IF WS-MAST-FLAG = 'B'
    1134  		GO TO OPEN-IO-MAST-FILE-END.
    1135  	IF WS-MAST-FLAG NOT = SPACES
    1136  		CLOSE MAST-FILE.
    1137  	MOVE MAST-REC TO WS-MAST-REC-SAVE.
    1138  	OPEN I-O MAST-FILE.
    1139  	MOVE WS-MAST-REC-SAVE TO MAST-REC.
    1140  	MOVE 'B' TO WS-MAST-FLAG.
    1141    OPEN-IO-MAST-FILE-END. EXIT.
    1142  
    1143    CLOSE-MAST-OUT.
    1144  	IF WS-MAST-FLAG = 'O' OR WS-MAST-FLAG = 'B'
    1145  		CLOSE MAST-FILE
    1146  		MOVE SPACES TO WS-MAST-FLAG.
    1147    CLOSE-MAST-OUT-END. EXIT.
    1148  
    1149    CLOSE-MAST-FILE.
    1150  	IF WS-MAST-FLAG NOT = SPACES
    1151  		CLOSE MAST-FILE
    1152  		MOVE SPACES TO WS-MAST-FLAG.
    1153    CLOSE-MAST-FILE-END. EXIT.
    1154      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 32
    MASTYM.CBL    23-OCT-65  22:20

    1155  * *****************************
    1156  * 	FILE OPEN/CLOSE/ETC (CONT)
    1157  * *****************************
    1158  
    1159    OPEN-HIST-FILE.
    1160  	IF WS-HIST-FLAG = SPACES
    1161  		OPEN INPUT HIST-FILE
    1162  		MOVE 'I' TO WS-HIST-FLAG.
    1163    OPEN-HIST-FILE-END. EXIT.
    1164  
    1165    CLOSE-HIST-FILE.
    1166  	IF WS-HIST-FLAG NOT = SPACES
    1167  		CLOSE HIST-FILE
    1168  		MOVE SPACES TO WS-HIST-FLAG.
    1169    CLOSE-HIST-FILE-END. EXIT.
    1170  
    1171    WRITE-MAST-REC.
    1172  	IF WS-MAST-FLAG NOT = 'B' AND WS-MAST-FLAG NOT = 'O'
    1173  		PERFORM OPEN-O-MAST-FILE THRU OPEN-O-MAST-FILE-END.
    1174  	WRITE MAST-REC INVALID KEY
    1175  		GO TO WRITE-ERROR.
    1176    WRITE-MAST-REC-END. EXIT.
    1177  
    1178    REWRITE-MAST-REC.
    1179  	PERFORM OPEN-IO-MAST-FILE THRU OPEN-IO-MAST-FILE-END.
    1180  	REWRITE MAST-REC INVALID KEY
    1181  		GO TO REWRITE-ERROR.
    1182    REWRITE-MAST-REC-END. EXIT.
    1183  
    1184    DELETE-MAST-REC.
    1185  	IF WS-MAST-FLAG = 'B'
    1186  		GO TO DELETE-MAST-GO.
    1187  	IF WS-MAST-FLAG NOT = SPACES
    1188  		CLOSE MAST-FILE.
    1189  	OPEN I-O MAST-FILE.
    1190  	MOVE 'B' TO WS-MAST-FLAG.
    1191    DELETE-MAST-GO.
    1192  	DELETE MAST-REC INVALID KEY
    1193  		GO TO DELETE-ERROR.
    1194    DELETE-MAST-REC-END. EXIT.
    1195      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 33
    MASTYM.CBL    23-OCT-65  22:20

    1196  * ***********************************************************
    1197  * 
    1198  * 	**** E R R O R     R O U T I N E S *****
    1199  * 	FOLLOWING ARE ROUTINES CALLED WHEN AN INVALID KEY RETURN
    1200  * 	IS GIVEN ON AN ATTEMPT TO WRITE THE PARTS FILES
    1201  * 
    1202  * ***********************************************************
    1203  
    1204    WRITE-ERROR.
    1205  	MOVE 'WRITE' TO W-E-MSG-TYPE.
    1206  	GO TO X-WRITE-ERROR.
    1207  
    1208    REWRITE-ERROR.
    1209  	MOVE 'REWRITE' TO W-E-MSG-TYPE.
    1210  	GO TO X-WRITE-ERROR.
    1211  
    1212    DELETE-ERROR.
    1213  	MOVE 'DELETE' TO W-E-MSG-TYPE.
    1214  	GO TO X-WRITE-ERROR.
    1215  
    1216    X-WRITE-ERROR.
    1217  	DISPLAY WRITE-ERROR-MESSAGE.
    1218    X-ERROR-ALL.
    1219  	DISPLAY 'MAST-KEY =' MAST-KEY.
    1220  	DISPLAY 'MAST-REC:'.
    1221  	DISPLAY MAST-REC.
    1222  	GO TO FILE-ERROR-LOCK.
    1223  
    1224    HIST-WRITE-ERROR.
    1225  	MOVE 'WRITE' TO W-E-MSG-TYPE.
    1226  	GO TO H-WRITE-ERROR.
    1227  
    1228    HIST-REWRITE-ERROR.
    1229  	MOVE 'REWRITE' TO W-E-MSG-TYPE.
    1230  	GO TO H-WRITE-ERROR.
    1231  
    1232    H-WRITE-ERROR.
    1233  	DISPLAY 'ERROR ATTEMPTING A ' WITH NO ADVANCING.
    1234  	DISPLAY W-E-MSG-TYPE ' TO THE HISTORY FILE'.
    1235    H-ERROR-ALL.
    1236  	DISPLAY 'HIST-KEY =' HIST-KEY.
    1237  	DISPLAY 'HIST-REC =' HIST-REC.
    1238  	GO TO FILE-ERROR-LOCK.
    1239    HIST-FILE-SEQ-ERROR.
    1240  	DISPLAY 'SEQUENCE ERROR IN HISTORY-FILE'.
    1241  	GO TO H-ERROR-ALL.
    1242      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 34
    MASTYM.CBL    23-OCT-65  22:20

    1243  * *********************************************************************
    1244  * 
    1245  * 	CROSS REFERENCE LINKAGE ERROR ROUTINES
    1246  * 
    1247  * *********************************************************************
    1248  
    1249    FWD-CREF-ERROR.
    1250  	DISPLAY '** FORWARD CROSS-REFERENCE ERROR **'.
    1251  	GO TO CREF-ERROR-ALL.
    1252  
    1253    REV-CREF-ERROR.
    1254  	DISPLAY '** REVERSE CROSS-REFERENCE ERROR **'.
    1255    CREF-ERROR-ALL.
    1256  	DISPLAY 'WS-PARTNO = ' WS-PARTNO '	' WITH NO ADVANCING.
    1257  	GO TO X-ERROR-ALL.
    1258      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE 35
    MASTYM.CBL    23-OCT-65  22:20

    1259  * *********************************************************************
    1260  * 
    1261  * 	** PARTS ACCOUNT LOCK ROUTINE **
    1262  * 	CALLED WHENEVER FILE LINKAGE ERRORS ARE DETECTED
    1263  * 	THIS ROUTINE WILL SET THE LOCK BIT FOR ACCT # 00
    1264  * 	LOCKING OUT ALL LOGINS TO THE INVENTORY ACCOUNT
    1265  * 
    1266  * *********************************************************************
    1267  
    1268    FILE-ERROR-LOCK.
    1269  	DISPLAY MSG-ASTICS.
    1270  	DISPLAY '** FILE ERRORS DETECTED - LOCKING INVENTORY ACCT'.
    1271  	OPEN I-O NAME-FILE.
    1272  	MOVE ZERO TO N-KEY.
    1273  	READ NAME-FILE INVALID KEY
    1274  		DISPLAY '* ERROR READING NAME RECORD ZERO *'
    1275  		GO TO LOCK-EXIT.
    1276  	MOVE 9 TO N-LOCK.
    1277  	REWRITE NAME-REC INVALID KEY
    1278  		DISPLAY '** ERROR LOCKING INVENTORY ACCOUNT **'.
    1279    LOCK-EXIT.
    1280  	ENTER MACRO LOGOFF.
    1281      P R O G R A M   M A S T Y M 		COBOL 100A(370001)	11-MAY-77  14:26		PAGE W-1
    MASTYM.CBL    23-OCT-65  22:20

WARNINGS:

    1099  MOST SIGNIFICANT DIGITS TRUNCATED ON WS-MONTH-OUT
    1100  MOST SIGNIFICANT DIGITS TRUNCATED ON WS-DAY-OUT


NO FATAL ERRORS, 2 WARNINGS
 17
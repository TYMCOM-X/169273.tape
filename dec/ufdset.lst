UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84

     1					UNIVERSAL UFDPRM - Parameter file for UFDSET
     2					SUBTTL	D. Mastrovito /DPM	7-Feb-84
     3
     4
     5
     6
     7
     8					;COPYRIGHT (C) 1980,1981,1982,1983,1984 BY
     9					;DIGITAL EQUIPMENT CORPORATION, MAYNARD, MASS.
    10					;
    11					;
    12					;THIS SOFTWARE IS FURNISHED UNDER A LICENSE AND MAY BE USED AND COPIED
    13					;ONLY  IN  ACCORDANCE  WITH  THE  TERMS  OF  SUCH LICENSE AND WITH THE
    14					;INCLUSION OF THE ABOVE COPYRIGHT NOTICE.  THIS SOFTWARE OR ANY  OTHER
    15					;COPIES THEREOF MAY NOT BE PROVIDED OR OTHERWISE MADE AVAILABLE TO ANY
    16					;OTHER PERSON.  NO TITLE TO AND OWNERSHIP OF THE  SOFTWARE  IS  HEREBY
    17					;TRANSFERRED.
    18					;
    19					;THE INFORMATION IN THIS SOFTWARE IS SUBJECT TO CHANGE WITHOUT  NOTICE
    20					;AND  SHOULD  NOT  BE  CONSTRUED  AS A COMMITMENT BY DIGITAL EQUIPMENT
    21					;CORPORATION.
    22					;
    23					;DIGITAL ASSUMES NO RESPONSIBILITY FOR THE USE OR RELIABILITY  OF  ITS
    24					;SOFTWARE ON EQUIPMENT WHICH IS NOT SUPPLIED BY DIGITAL.
    25
    26
    27					; Assembly instructions
    28					;
    29					;	.COMPILE UFDSET.MAC
    30					;
    31					; Produces UFDPRM.UNV and UFDSET.REL
    32
    33
    34					; Version numbers
    35					;
    36			000001			UFDVER==1			;MAJOR VERSION
    37			000000			UFDMIN==0			;MINOR VERSION
    38			000035			UFDEDT==35			;EDIT LEVEL
    39			000000			UFDWHO==0			;WHO DID IT
    40		000100	000035			%%UFDS==<BYTE(3)UFDWHO(9)UFDVER(6)UFDMIN(18)UFDEDT>
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 2
UFDSET	MAC	24-Sep-72 02:32		Edit history

    41					SUBTTL	Edit history
    42
    43
    44					; RCOMP edit History
    45					;
    46					; 1	Initial subroutine to do recomputes for PLRDSK.
    47					;
    48					; 2	Add super mode input to read ribs to speed up things.
    49					;
    50					; 3	Routine FINISH wasn't calling the user supplied typeout subroutine.
    51					;
    52					; 4	Append STR:[PPN] to errors generated by ERRPRC.
    53					;
    54					; 5	Remove extra instruction in routine LOKUFD.
    55					;
    56					; 6	Add routines for search list manipulation and UFD creation.
    57					;
    58					;
    59					; UFDSET edit history
    60					;
    61					;
    62					; 7	Create UFDSET from the remains of RCOMP.
    63					;
    64					; 10	Remove edit 4, it was a bad idea. Enhance text generation code.
    65					;
    66					; 11	Fix bugs in single access code. Remove error code UFCSU% (Can't
    67					;	set UFD interlock) and issue a warning instead. We can't wait for
    68					;	the interlock since PULSAR shouldn't block. If a program really needs
    69					;	this functionality, it should handle the interlock itself and lite
    70					;	the UF.NLK bit.
    71					;
    72					; 12	Add functions .UFDASL and .UFRSL plus about a dozen lines of code
    73					;	to handle system search list changes.
    74					;
    75					; 13	Fix obscrure PATH block pointer problem caused by 702.
    76					;
    77					; 14	Make sure the job and PPN match for MOUNT and DISMOUNT functions.
    78					;
    79					; 15	Fix off-by-one bug in S/L definition size that showed up only when
    80					;	a user dismounted a disk when his S/L was full.
    81					;
    82					; 16	Release any open channels after processing errors at ERRPRC.
    83					;
    84					; 17	Close off UFD channel if create fails to find a UFD.
    85					;
    86					; 20	Don't try to use a released channel when creating UFDs.
    87					;
    88					; 21	Fix up quota checking for zero block logged out quotas.
    89					;
    90					; 22	Enhancementes required for use in LOGIN:
    91					;	1) Clear RP.ERR in the UFD if no error bits found in file RIBs
    92					;	   during recomputing pass.
    93					;	2) Add functions .UFAJL and .UFRJL to only add and remove structures
    94					;	   from a job search list. Needed for the SWITCH.INI handling.
    95					;	3) Add functions .UFSUI and .UFCUI to set and clear the UFD interlock.
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 2-1
UFDSET	MAC	24-Sep-72 02:32		Edit history

    96					;	4) Set current date/time in the RIB and return it in .UFCDT
    97					;	   and .UFCTM words.
    98					;
    99					; 23	Move 'File errors exist' message to the rename code, so if a recomp
   100					;	is done and no errors exist, the message won't be generated.  Also
   101					;	setup PATH block before attempting to a super I/O LOOKUP.  This will
   102					;	allow the correct filespec typeout to occur if file errors exist.
   103					;
   104					; 24	Clear out LKPFIL @SETFIL to prevent junk dates, protections, etc.
   105					;	from being set on ENTERs.
   106					;
   107					; 25	Some files don't get quota checked.  MOVX instead of a MOVE.
   108					;
   109					; 26	Fix bad test that allowed anyone to dismount a structure, even
   110					;	if they were over quota.
   111					;
   112					; 27	RIBUSD can be zero for a non-empty UFD if the monitor hasn't
   113					;	rewritten the RIB yet.  Don't blindly try to delete a UFD
   114					;	without first doing a DISK. UUO to see if the monitor really
   115					;	knows the number of blocks used.
   116					;
   117					; 30	Correct check of "own" job number and fix off by one bug in
   118					;	GOBSTR loop when searching for other jobs in the recomp checking
   119					;	code.  Give UFDSET a real version number too.
   120					;
   121					; 31	Function .UFRDU forgot to LOOKUP the UFD.
   122					;
   123					; 32	Files of the form nnnTEC.TMP print incorrectly.
   124					;
   125					; 33	Fix incorrect block number calculation when doing super I/O on a
   126					;	unit whose cluster size does not divide evenly into the unit size.
   127					;
   128					; 34	Correct test for blocks in use before attempting to delete a UFD
   129					;	on a dismount.
   130					;
   131					; 35	Only change RIBUSD when recomputing disk usage.
   132
   133					;End of edit history
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 3
UFDSET	MAC	24-Sep-72 02:32		Calling sequence and program interface

   134					SUBTTL	Calling sequence and program interface
   135
   136
   137					; Call:	MOVE	T1,address of argument block
   138					;	PUSHJ	P,.UFD##
   139					;	<non-skip>
   140					;	<skip>
   141					;
   142					; Non-skip:	An error has occured. The error code is stored
   143					;		in the argument block.
   144					;
   145					; Skip:		The requested operations performed and argument
   146					;		block updated where necessary.
   147					;
   148					; Argument block
   149					;
   150	000000'					 RELOC	0
   151	000000					 PHASE	0
   152	000000				.UFFLG:! BLOCK	1	;FLAG WORD
   153		400000	000000		   UF.LGI==1B0		   ;ALWAYS SET LOGGED IN (TURN ON RIPLOG)
   154		200000	000000		   UF.LGO==1B1		   ;ALWAYS SET LOGGED OUT (TURN OFF RIPLOG)
   155		100000	000000		   UF.NLK==1B2		   ;DON'T INTERLOCK THE UFD (CALLER ALREADY DID)
   156		040000	000000		   UF.ARD==1B3		   ;ALWAYS RECOMPUTE DISK USAGE
   157		020000	000000		   UF.NRD==1B4		   ;NEVER RECOMPUTE DISK USAGE
   158		010000	000000		   UF.PSL==1B5		   ;ADD TO PASSIVE SEARCH LIST
   159		004000	000000		   UF.SIN==1B6		   ;MOUNT SINGLE ACCESS
   160		002000	000000		   UF.NOQ==1B7		   ;DON'T DO QUOTA CHECKING
   161		001000	000000		   UF.TSP==1B8		   ;TYPE STRUCTURE AND PPN IN QUOTA MESSAGE
   162		000400	000000		   UF.NUE==1B9		   ;NO UFD EXISTS (RETURNED BY UFDSET)
   163		000200	000000		   UF.WLD==1B10		   ;GENERATE A UNIQUE WILD PROGRAMMER NUMBER [10,#]
   164		000100	000000		   UF.NDL==1B11		   ;RIPNDL IS TURNED ON FOR THIS UFD
   165		000040	000000		   UF.AIS==1B12		   ;STRUCTURE IS ALREADY IN S/L (FOR LOGIN)
   166			000017		   UF.FNC==17B35	   ;FUNCTION CODE
   167			000001		      .UFMNT==1		      ;MOUNT
   168			000002		      .UFDMO==2		      ;DISMOUNT
   169			000003		      .UFRDU==3		      ;RECOMPUTE
   170			000004		      .UFASL==4		      ;ADD STR TO SSL
   171			000005		      .UFRSL==5		      ;REMOVE STR FROM SSL
   172			000006		      .UFAJL==6		      ;ADD STR TO JSL
   173			000007		      .UFRJL==7		      ;REMOVE STR FROM JSL
   174			000010		      .UFSUI==10	      ;SET UFD INTERLOCK
   175			000011		      .UFCUI==11	      ;CLEAR UFD INTERLOCK
   176			000011		      .UFMAX==.UFCUI	      ;MAXIMUM FUNCTION CODE
   177	000001				.UFSTR:! BLOCK	1	;SIXBIT STRUCTURE NAME
   178	000002				.UFPPN:! BLOCK	1	;PPN
   179	000003				.UFJOB:! BLOCK	1	;JOB NUMBER
   180	000004				.UFPRO:! BLOCK	1	;UFD PROTECTION TO SET (RIGHT JUSTIFIED)
   181	000005				.UFDED:! BLOCK	1	;DIRECTORY EXPIRATION DATE TO SET
   182	000006				.UFQTF:! BLOCK	1	;FCFS LOGGED-IN QUOTA
   183	000007				.UFQTO:! BLOCK	1	;LOGGED-OUT QUOTA
   184	000010				.UFQTR:! BLOCK	1	;RESERVED QUOTA
   185	000011				.UFSTS:! BLOCK	1	;FILE STRUCTURE STATUS BITS (FROM AUXACC)
   186	000012				.UFUSD:! BLOCK	1	;BLOCKS USED
   187	000013				.UFLOK:! BLOCK	1	;LH:= # SECS TO WAIT FOR INTERLOCK, RH:= # SECS FOR MSG
   188	000014				.UFCDT:! BLOCK	1	;UFD CREATION DATE IN 15 BIT FORMAT
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 3-1
UFDSET	MAC	24-Sep-72 02:32		Calling sequence and program interface

   189	000015				.UFCTM:! BLOCK	1	;UFD CREATION TIME IN MINUTES SINCE MIDNIGHT
   190	000016				.UFERR:! BLOCK	1	;ERROR CODE RETURNED ON FAILURE
   191	000017				.UFTYO:! BLOCK	1	;ADDRESS OF TYPE OUT ROUTINE
   192	000020				.UFPFX:! BLOCK	1	;LH:= SEVERITY CHARACTER, RH:= SIXBIT PREFIX
   193	000021				.UFTXT:! BLOCK	1	;ADDRESS OF TEXT
   194	000022				.UFSIZ:!		;SIZE OF BLOCK
   195	000022'					 DEPHASE
   196	000000'					 RELOC	0
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 4
UFDSET	MAC	24-Sep-72 02:32		Calling sequence and program interface

   197					; Error codes
   198					;
   199			000001		UFIDV%==1		;ILLEGAL DEVICE
   200			000002		UFISN%==2		;IMPROPER STRUCTURE NAME
   201			000003		UFIOE%==3		;DIRECTORY I/O ERROR
   202			000004		UFCAD%==4		;CAN'T ACCESS DIRECTORY TO RECOMPUTE DISK USAGE
   203			000005		UFLFU%==5		;LOOKUP FAILED FOR UFD DURING UPDATE
   204			000006		UFRFU%==6		;RENAME FAILED FOR UFD DURING UPDATE
   205			000007		UFCRS%==7		;CAN'T READ SEARCH LIST
   206			000010		UFIFC%==10		;ILLEGAL FUNCTION CODE
   207			000011		UFEFU%==11		;ENTER FAILED FOR UFD
   208			000012		UFCCS%==12		;CAN'T CHANGE SEARCH LIST
   209			000013		UFCSO%==13		;CAN'T RESET ORIGINAL S/L AFTER SINGLE ACCESS FAILED
   210			000014		UFCSS%==14		;CAN'T MOUNT STRUCTURE SINGLE ACCESS
   211			000015		UFSND%==15		;STRUCTURE NOT DISMOUNTED
   212			000016		UFUBT%==16		;UFD INTERLOCK IS BUTY FOR TOO LONG
   213			000017		UFUIC%==17		;UFD INTERLOCK CANNOT BE CLEARED
   214			000020		UFPGF%==20		;PROGRAMMER NUMBER GENERATION FAILED
   215
   216
   217						PRGEND

NO ERRORS DETECTED

PROGRAM BREAK IS 000022
CPU TIME USED 01:20.759

42P CORE USED
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page S-1
UFDSET	MAC	24-Sep-72 02:32		SYMBOL TABLE

UF.AIS	000040	000000	spd	.UFRJL		000007	spd	
UF.ARD	040000	000000	spd	.UFRSL		000005	spd	
UF.FNC		000017	spd	.UFSIZ		000022	spd	
UF.LGI	400000	000000	spd	.UFSTR		000001	spd	
UF.LGO	200000	000000	spd	.UFSTS		000011	spd	
UF.NDL	000100	000000	spd	.UFSUI		000010	spd	
UF.NLK	100000	000000	spd	.UFTXT		000021	spd	
UF.NOQ	002000	000000	spd	.UFTYO		000017	spd	
UF.NRD	020000	000000	spd	.UFUSD		000012	spd	
UF.NUE	000400	000000	spd	
UF.PSL	010000	000000	spd	
UF.SIN	004000	000000	spd	
UF.TSP	001000	000000	spd	
UF.WLD	000200	000000	spd	
UFCAD%		000004	spd	
UFCCS%		000012	spd	
UFCRS%		000007	spd	
UFCSO%		000013	spd	
UFCSS%		000014	spd	
UFDEDT		000035	spd	
UFDMIN		000000	spd	
UFDVER		000001	spd	
UFDWHO		000000	spd	
UFEFU%		000011	spd	
UFIDV%		000001	spd	
UFIFC%		000010	spd	
UFIOE%		000003	spd	
UFISN%		000002	spd	
UFLFU%		000005	spd	
UFPGF%		000020	spd	
UFRFU%		000006	spd	
UFSND%		000015	spd	
UFUBT%		000016	spd	
UFUIC%		000017	spd	
%%UFDS	000100	000035	spd	
.UFAJL		000006	spd	
.UFASL		000004	spd	
.UFCDT		000014	spd	
.UFCTM		000015	spd	
.UFCUI		000011	spd	
.UFDED		000005	spd	
.UFDMO		000002	spd	
.UFERR		000016	spd	
.UFFLG		000000	spd	
.UFJOB		000003	spd	
.UFLOK		000013	spd	
.UFMAX		000011	spd	
.UFMNT		000001	spd	
.UFPFX		000020	spd	
.UFPPN		000002	spd	
.UFPRO		000004	spd	
.UFQTF		000006	spd	
.UFQTO		000007	spd	
.UFQTR		000010	spd	
.UFRDU		000003	spd	
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 5
UFDSET	MAC	24-Sep-72 02:32	

   218					TITLE	UFDSET - Perform UFD and search list operations
   219
   220
   221						SALL				;FOR CLEAN LISTINGS
   222						.DIRECT	FLBLST			;FOR CLEANER LISTINGS
   223
   224						SEARCH	JOBDAT			;TOPS-10 JOB DATA LOCATIONS
   225						SEARCH	MACTEN			;TOPS-10 MACROS
   226						SEARCH	UUOSYM			;TOPS-10 UUO SYMBOLS
   227						SEARCH	UFDPRM			;UFDSET SYMBOLS
   228
   229		043200	000454			%%JOBD==%%JOBD			;PUT JOBDAT VERSION IN SYMBOL TABLE
   230		000400	000045			%%MACT==%%MACT			;PUT MACTEN VERSION IN SYMBOL TABLE
   231		001600	000773			%%UUOS==%%UUOS			;PUT UUOSYM VERSION IN SYMBOL TABLE
   232		000100	000035			%%UFDS==%%UFDS			;PUT UFDSET VERSION IN SYMBOL TABLE
   233
   234
   235					.BCOPY
   236	000000	103 117 120 131 122 	COPYRIGHT (C) DIGITAL EQUIPMENT CORPORATION 1980,1981,1982,1983,1984.
   237					.ECOPY
   238
   239	400000'					TWOSEG				;MAKE US SHARABLE
   240	400000'					RELOC	.JBHGH			;START LOADING HIGH SEGMENT HERE
   241
   242						ENTRY	.UFD			;ENTRY POINT
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 6
UFDSET	MAC	24-Sep-72 02:32		Definitions

   243					SUBTTL	Definitions
   244
   245
   246					; Accumulators
   247					;
   248			000001			T1=1				;4 TEMPORARY ACS
   249			000002			T2=T1+1
   250			000003			T3=T2+1
   251			000004			T4=T3+1
   252			000005			P1=5				;4 PERMINENT ACS
   253			000006			P2=P1+1
   254			000007			P3=P2+1
   255			000010			P4=P3+1
   256			000011			L=11				;DIRECTORY LEVEL
   257			000012			BP=12				;BYTE POINTER
   258			000016			AP=16				;ARGUMENT BLOCK POINTER
   259			000017			P=17				;PDL
   260
   261			000001			.AP==T1				;USER AC THAT POINTS TO ARGUMENT BLOCK
   262
   263
   264					; Assembly parameters
   265					;
   266			000005			SFDMAX==5			;MAXIMUM NUMBER OF SFDS
   267			000006			DIRLVL==SFDMAX+1		;MAXIMUM NUMBER OF DIRECTORY LEVELS
   268			000200			BLKSIZ==200			;SIZE OF A DISK BLOCK IN PAGES
   269			000033			BUFSIZ==<^D132/5>+1		;TEXT BUFFER SIZE
   270			000011			FOPSIZ==.FOMAX			;LENGTH OF FILOP BLOCK TO USE
   271			000050			RIBSIZ==.RBMAX			;LENGTH OF RIB TO USE
   272			000011			PTHSIZ==.PTMAX			;LENGTH OF PATH BLOCK TO USE
   273			000032			DCHSIZ==.DCMAX			;DSKCHR BLOCK SIZE
   274			000013			STRMAX==^D10+1			;MAXIMUM NUMBER OF STRS = 10 + FENCE
   275			000046			SLSIZE==.FSDSO+<.DFJBL*STRMAX>+1 ;LENGTH OF A SEARCH LIST
   276			000002			LOKTIM==2			;# SECS BETWEEN TRIES FOR UFD INTERLOCK
   277
   278
   279					; Macro to make life easier
   280					;
   281					DEFINE	$ERR	(CODE),<
   282						PUSHJ	P,ERRPRC		;;CALL THE ERROR PROCESSOR
   283						CAI	UF'CODE'%		;;STORE ERROR CODE HERE
   284					>
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 7
UFDSET	MAC	24-Sep-72 02:32		Subroutine entry and exit

   285					SUBTTL	Subroutine entry and exit
   286
   287
   288	400000'					RELOC	.JBHGH
   289
   290	400000'	202 00 0 00 000000'	.UFD::	MOVEM	0,USRACS+0		;SAVE AC 0
   291	400001'	200 00 0 00 402276'		MOVE	0,[1,,USRACS+1]		;SET UP BLT
   292	400002'	251 00 0 00 000017'		BLT	0,USRACS+17		;SAVE ACS 1 - 17
   293	400003'	200 00 0 00 000000'		MOVE	0,USRACS+0		;RELOAD AC 0
   294	400004'	200 16 0 00 000001 		MOVE	AP,.AP			;GET ADDRESS OF USER'S ARGUMENT BLOCK
   295
   296	400005'	260 17 0 00 400153'		PUSHJ	P,INITIA		;INITIALIZE THE WORLD, GET FUNCT CODE
   297	400006'	260 17 1 01 400014'		PUSHJ	P,@FNCTAB-1(T1)		;DISPATCH
   298
   299	400007'	200 00 0 00 402277'	ERRXIT:	MOVE	0,[USRACS+1,,1]		;SET UP BLT
   300	400010'	251 00 0 00 000017 		BLT	0,17			;RESTORE ACS 1 - 17
   301	400011'	200 00 0 00 000000'		MOVE	0,USRACS+0		;RELOAD AC 0
   302	400012'	336 00 0 01 000016 		SKIPN	.UFERR(.AP)		;DID WE RETURN AN ERROR CODE?
   303	400013'	350 00 0 17 000000 	CPOPJ1:	AOS	(P)			;NO - FORCE SKIP RETURN
   304	400014'	263 17 0 00 000000 	CPOPJ:	POPJ	P,			;RETURN
   305
   306
   307	400015'	000000	400026'		FNCTAB:	EXP	$MOUNT			;(01) MOUNT A STRUCTURE
   308	400016'	000000	400047'			EXP	$DISMOUNT		;(02) DISMOUNT A STRUCTURE
   309	400017'	000000	400071'			EXP	$RECOMPUTE		;(03) RECOMPUTE DISK USAGE
   310	400020'	000000	400105'			EXP	$ASSL			;(04) ADD STR TO SSL
   311	400021'	000000	400111'			EXP	$RSSL			;(05) REMOVE STR FROM SSL
   312	400022'	000000	400115'			EXP	$AJSL			;(06) ADD STR TO JSL
   313	400023'	000000	400121'			EXP	$RJSL			;(07) REMOVE STR FROM JSL
   314	400024'	000000	400125'			EXP	$UFDLOK			;(10) SET UFD INTERLOCK
   315	400025'	000000	400147'			EXP	$UFDCLR			;(11) CLEAR UFD INTERLOCK
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 8
UFDSET	MAC	24-Sep-72 02:32		Mount a structure (function 1)

   316					SUBTTL	Mount a structure (function 1)
   317
   318
   319	400026'	260 17 0 00 400244'	$MOUNT:	PUSHJ	P,FIXPPN		;FIX UP THE PPN
   320	400027'	260 17 0 00 400575'		PUSHJ	P,READSL		;READ THE JOB'S SEARCH LIST
   321	400030'	260 17 0 00 401177'		PUSHJ	P,CREUFD		;CREATE A UFD IF NECESSARY
   322	400031'	260 17 0 00 401613'		PUSHJ	P,LOKUFD		;GET UFD INTERLOCK
   323	400032'	260 17 0 00 401654'		PUSHJ	P,RCPCHK		;SEE IF WE NEED TO RECOMPUTE
   324	400033'	254 00 0 00 400042'		  JRST	MOUN.1			;NO
   325	400060 17 0 00 401560'		PUSHJ	P,RCPMSG		;ISSUE RECOMPUTING DISK USAGE MESSAGE
   326	400035'	260 17 0 00 401453'		PUSHJ	P,COMPRS		;COMPRESS THE UFD
   327	400036'	260 17 0 00 400506'		PUSHJ	P,SETSUP		;OPEN THINGS FOR SUPER I/O
   328	400037'	260 17 0 00 400255'		PUSHJ	P,RECOMP		;RECOMPURE DISK USAGE
   329	400040'	260 17 0 00 400521'		PUSHJ	P,FINSUP		;CLEANUP SUPER I/O CHANNEL
   330	400041'	260 17 0 00 401563'		PUSHJ	P,QTAMSG		;OUTPUT FINAL QUOTA MESSAGE
   331
   332	400042'	260 17 0 00 400642'	MOUN.1:	PUSHJ	P,ADDJSL		;ADD THE STR TO THE JOB SEARCH LIST
   333	400043'	260 17 0 00 401023'		PUSHJ	P,DEFJSL		;DEFINE THE NEW JOB SEARCH LIST
   334	400044'	260 17 0 00 401324'		PUSHJ	P,RENUFD		;RENAME THE UFD
   335	400045'	260 17 0 00 401625'		PUSHJ	P,CLRUFD		;CLEAR UFD INTERLOCK
   336	400046'	324 17 0 00 401552'		PJRST	MNTMSG			;ISSUE MOUNT MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 9
UFDSET	MAC	24-Sep-72 02:32		Dismount a structure (function 2)

   337					SUBTTL	Dismount a structure (function 2)
   338
   339
   340	400047'				$DISMOUNT:
   341	400047'	260 17 0 00 400244'		PUSHJ	P,FIXPPN		;FIX UP THE PPN
   342	400050'	260 17 0 00 400575'		PUSHJ	P,READSL		;READ THE JOB'S SEARCH LIST
   343	400051'	260 17 0 00 401613'		PUSHJ	P,LOKUFD		;GET UFD INTERLOCK
   344	400052'	260 17 0 00 401275'		PUSHJ	P,REDUFD		;READ QUOTAS FROM THE UFD
   345	400053'	260 17 0 00 401654'		PUSHJ	P,RCPCHK		;SEE IF WE NEED TO RECOMPUTE
   346	400054'	254 00 0 00 400063'		  JRST	DISM.1			;NO
   347	400055'	260 17 0 00 401560'		PUSHJ	P,RCPMSG		;ISSUE RECOMPUTING DISK USAGE MESSAGE
   348	400056'	260 17 0 00 401453'		PUSHJ	P,COMPRS		;COMPRESS THE UFD
   349	400057'	260 17 0 00 400506'		PUSHJ	P,SETSUP		;OPEN THINGS FOR SUPER I/O
   350	400060'	260 17 0 00 400255'		PUSHJ	P,RECOMP		;RECOMPURE DISK USAGE
   351	400061'	260 17 0 00 400521'		PUSHJ	P,FINSUP		;CLEANUP SUPER I/O CHANNEL
   352	400062'	260 17 0 00 401563'		PUSHJ	P,QTAMSG		;OUTPUT FINAL QUOTA MESSAGE
   353
   354	400063'	260 17 0 00 401726'	DISM.1:	PUSHJ	P,QTACHK		;CHECK FOR BEING OVER QUOTA
   355	400064'	260 17 0 00 401005'		PUSHJ	P,DELJSL		;DELETE STR FROM THE JOB SEARCH LIST
   356	400065'	260 17 0 00 401023'		PUSHJ	P,DEFJSL		;DEFINE THE NEW JOB SEARCH LIST
   357	400066'	260 17 0 00 401324'		PUSHJ	P,RENUFD		;RENAME (MAYBE DELETE) THE UFD
   358	400067'	260 17 0 00 401625'		PUSHJ	P,CLRUFD		;CLEAR UFD INTERLOCK
   359	400070'	324 17 0 00 401555'		PJRST	DMOMSG			;ISSUE DISMOUNT MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 10
UFDSET	MAC	24-Sep-72 02:32		Recompute disk usage (function 3)

   360					SUBTTL	Recompute disk usage (function 3)
   361
   362
   363	400071'				$RECOMPUTE:
   364	400071'	260 17 0 00 401613'		PUSHJ	P,LOKUFD		;GET UFD INTERLOCK
   365	400072'	260 17 0 00 401275'		PUSHJ	P,REDUFD		;READ QUOTAS FROM THE UFD
   366	400073'	260 17 0 00 401654'		PUSHJ	P,RCPCHK		;SEE IF WE NEED TO RECOMPUTE
   367	400074'	254 00 0 00 400102'		  JRST	RECOM1			;NO
   368	400075'	260 17 0 00 401453'		PUSHJ	P,COMPRS		;COMPRESS UFD
   369	400076'	260 17 0 00 401613'		PUSHJ	P,LOKUFD		;SET UFD INTERLOCK
   370	400077'	260 17 0 00 400506'		PUSHJ	P,SETSUP		;OPEN THINGS FOR SUPER I/O
   371	400100'	260 17 0 00 400255'		PUSHJ	P,RECOMP		;RECOMPURE DISK USAGE
   372	400101'	260 17 0 00 400521'		PUSHJ	P,FINSUP		;CLEANUP SUPER I/O CHANNEL
   373
   374	400102'	260 17 0 00 401324'	RECOM1:	PUSHJ	P,RENUFD		;RENAME AND SET QUOTAS IN THE UFD
   375	400103'	260 17 0 00 401625'		PUSHJ	P,CLRUFD		;CLEAR UFD INTERLOCK
   376	400104'	324 17 0 00 401563'		PJRST	QTAMSG			;ISSUE QUOTA MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 11
UFDSET	MAC	24-Sep-72 02:32		Add a structure to the system search list (function 4)

   377					SUBTTL	Add a structure to the system search list (function 4)
   378
   379
   380	400105'	260 17 0 00 400575'	$ASSL:	PUSHJ	P,READSL		;READ THE SEARCH LIST
   381	400106'	260 17 0 00 400642'		PUSHJ	P,ADDJSL		;ADD STR TO SEARCH LIST
   382	400107'	260 17 0 00 401023'		PUSHJ	P,DEFJSL		;DEFINE A NEW SEARCH LIST
   383	400110'	324 17 0 00 401577'		PJRST	ASLMSG			;ISSUE MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 12
UFDSET	MAC	24-Sep-72 02:32		Remove a structure from the system search list (function 5)

   384					SUBTTL	Remove a structure from the system search list (function 5)
   385
   386
   387	400111'	260 17 0 00 400575'	$RSSL:	PUSHJ	P,READSL		;READ THE SEARCH LIST
   388	400112'	260 17 0 00 401005'		PUSHJ	P,DELJSL		;REMOVE STR FROM SEARCH LIST
   389	400113'	260 17 0 00 401023'		PUSHJ	P,DEFJSL		;DEFINE A NEW SEARCH LIST
   390	400114'	324 17 0 00 401602'		PJRST	RSLMSG			;ISSUE MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 13
UFDSET	MAC	24-Sep-72 02:32		Add a structure to a job search list (function 6)

   391					SUBTTL	Add a structure to a job search list (function 6)
   392
   393
   394	400115'	260 17 0 00 400575'	$AJSL:	PUSHJ	P,READSL		;READ THE SEARCH LIST
   395	400116'	260 17 0 00 400642'		PUSHJ	P,ADDJSL		;ADD STR TO SEARCH LIST
   396	400117'	260 17 0 00 401023'		PUSHJ	P,DEFJSL		;DEFINE A NEW SEARCH LIST
   397	400120'	324 17 0 00 401605'		PJRST	AJLMSG			;ISSUE MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 14
UFDSET	MAC	24-Sep-72 02:32		Remove a structure from a job search list (function 7)

   398					SUBTTL	Remove a structure from a job search list (function 7)
   399
   400
   401	400121'	260 17 0 00 400575'	$RJSL:	PUSHJ	P,READSL		;READ THE SEARCH LIST
   402	400122'	260 17 0 00 401005'		PUSHJ	P,DELJSL		;REMOVE STR FROM SEARCH LIST
   403	400123'	260 17 0 00 401023'		PUSHJ	P,DEFJSL		;DEFINE A NEW SEARCH LIST
   404	400124'	324 17 0 00 401610'		PJRST	RJLMSG			;ISSUE MESSAGE AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 15
UFDSET	MAC	24-Sep-72 02:32		Set the UFD interlock (function 10)

   405					SUBTTL	Set the UFD interlock (function 10)
   406
   407
   408	400125'	554 05 0 16 000013 	$UFDLOK:HLRZ	P1,.UFLOK(AP)		;GET TIME TO WAIT FOR INTERLOCK
   409	400126'	550 06 0 16 000013 		HRRZ	P2,.UFLOK(AP)		;GET TIME TO WAIT FOR MESSAGE
   410
   411	400127'	260 17 0 00 401636'	UFDL.1:	PUSHJ	P,ULOCK			;TRY TO INTERLOCK THE UFD
   412	400130'	334 00 0 00 000000 		  SKIPA				;CAN'T
   413	400131'	263 17 0 00 000000 		POPJ	P,			;RETURN
   414	400132'	323 06 0 00 400140'		JUMPLE	P2,UFDL.2		;ALREADY OUTPUT THE MESSAGE?
   415	400133'	275 06 0 00 000002 		SUBI	P2,LOKTIM		;COUNT DOWN TIME UNTIL MESSAGE
   416	400134'	327 06 0 00 400140'		JUMPG	P2,UFDL.2		;NOT TIME FOR IT
   417	400135'	200 01 0 00 402300'		MOVE	T1,["[",,'UIB']		;GET SEVEREITY CHARACTER AND PREFIX
   418	400136'	201 02 0 00 402301'		MOVEI	T2,[ASCIZ |UFD interlock is busy for @A; please wait|]
   419	400137'	260 17 0 00 401770'		PUSHJ	P,TEXT			;GENERATE TEXT
   420
   421	400140'	275 05 0 00 000002 	UFDL.2:	SUBI	P1,LOKTIM		;COUNT DOWN THE SECONDS
   422	400141'	323 05 0 00 400145'		JUMPLE	P1,UFDL.3		;CAN'T GET INTERLOCK
   423	400142'	201 01 0 00 000002 		MOVEI	T1,LOKTIM		;GET SECONDS TO WAIT BETWEEN TRIES
   424	400143'	047 01 0 00 000031 		SLEEP	T1,			;ZZZZZZ
   425	400144'	254 00 0 00 400127'		JRST	UFDL.1			;TRY IT AGAIN
   426
   427	400145'	260 17 0 00 402225'	UFDL.3:	$ERR	(UBT)			;? UFD INTERLOCK BUSY
   428	400146'	300 00 0 00 000016 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 16
UFDSET	MAC	24-Sep-72 02:32		Clear the UFD interlock (function 11)

   429					SUBTTL	Clear the UFD interlock (function 11)
   430
   431
   432	400147'	260 17 0 00 401645'	$UFDCLR:PUSHJ	P,UNLOCK		;UNLOCK THE UFD
   433	400150'	260 17 0 00 402225'		  $ERR	(UIC)			;? UFD INTERLOCK CANNOT BE CLEARED
   434	400151'	300 00 0 00 000017 
   435	400152'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 17
UFDSET	MAC	24-Sep-72 02:32		Initialization

   436					SUBTTL	Initialization
   437
   438
   439	400153'	402 00 0 00 000020'	INITIA:	SETZM	ZBEG			;CLEAR A WORD
   440	400154'	200 01 0 00 402312'		MOVE	T1,[ZBEG,,ZBEG+1]	;SET UP BLT
   441	400155'	251 01 0 00 001535'		BLT	T1,ZEND-1		;CLEAR OUR DATA BASE
   442	400156'	402 00 0 16 000012 		SETZM	.UFUSD(AP)		;CLEAR BLOCKS USED
   443	400157'	200 01 0 00 402313'		MOVE	T1,[%NSHJB]		;ARGUMENT TO RETURN THE
   444	400160'	047 01 0 00 000041 		GETTAB	T1,			;HIGHEST JOB NUMBER IN USE
   445	400161'	201 01 0 00 000777 		  MOVEI	T1,^D511		;SICK MONITOR
   446	400162'	202 01 0 00 000022'		MOVEM	T1,HGHJOB		;SAVE IT
   447	400163'	200 01 0 00 402314'		MOVE	T1,[%LDMFD]		;GET THE MFD PPN
   448	400164'	047 01 0 00 000041 		GETTAB	T1,			;FROM THE MONITOR
   449	400165'	200 01 0 00 402315'		  MOVE	T1,[1,,1]		;BUT IT WON'T TELL US
   450	400166'	202 01 0 00 000020'		MOVEM	T1,MFDPPN		;REMEMBER IT
   451	400167'	200 01 0 00 402316'		MOVE	T1,[%LDSYS]		;GET THE SYS PPN
   452	400170'	047 01 0 00 000041 		GETTAB	T1,			;FROM THE MONITOR
   453	400171'	200 01 0 00 402317'		  MOVE	T1,[1,,4]		;LEVEL D DEFAULT
   454	400172'	202 01 0 00 000021'		MOVEM	T1,SYSPPN		;SAVE IT
   455	400173'	201 01 0 00 001146'		MOVEI	T1,TXTBUF		;POINT TO START OF STRING
   456	400174'	202 01 0 16 000021 		MOVEM	T1,.UFTXT(AP)		;STORE FOR CALLER
   457	400175'	200 01 0 16 000003 		MOVE	T1,.UFJOB(AP)		;GET TARGET JOB NUMBER
   458	400176'	047 02 0 00 000030 		PJOB	T2,			;GET OUR JOB NUMBER
   459	400177'	316 01 0 00 402320'		CAMN	T1,[-1]			;DEFAULTED?
   460	400200'	200 01 0 00 000002 		MOVE	T1,T2			;MAKE IT OUR JOB
   461	400201'	316 01 0 00 000002 		CAMN	T1,T2			;IS IT US?
   462	400202'	476 00 0 00 000023'		SETOM	SLFFLG			;YES - REMEMBER FOR LATER
   463	400203'	202 01 0 16 000003 		MOVEM	T1,.UFJOB(AP)		;RESET INCASE IT WAS DEFAULTED
   464	400204'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET TARGET PPN
   465	400205'	316 01 0 00 402320'		CAMN	T1,[-1]			;DEFAULTED?
   466	400206'	047 01 0 00 000024 		GETPPN	T1,			;MAKE IT OUR PPN
   467	400207'	255 00 0 00 000000 		  JFCL				;JACCT
   468	400210'	202 01 0 16 000002 		MOVEM	T1,.UFPPN(AP)		;RESET IT INCASE IT WAS DEFAULTED
   469	400211'	135 01 0 00 402321'		LDB	T1,[POINTR (.UFFLG(AP),UF.FNC)] ;GET FUNCTION CODE
   470	400212'	303 01 0 00 000000 		CAILE	T1,0			;RANGE
   471	400213'	303 01 0 00 000011 		CAILE	T1,.UFMAX		; CHECK IT
   472	400214'	260 17 0 00 402225'		  $ERR (IFC)			;ILLEGAL FUNCTION CODE
   473	400215'	300 00 0 00 000010 
   474	400216'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STRUCTURE
   475	400217'	202 01 0 00 000541'		MOVEM	T1,DCHBLK+.DCNAM	;STORE NAME
   476	400220'	200 01 0 00 402322'		MOVE	T1,[DCHSIZ,,DCHBLK]	;POINT TO DSKCHR BLOCK
   477	400221'	047 01 0 00 200045 		DSKCHR	T1,UU.PHY		;READ DISK CHARACTERISTICS
   478	400222'	260 17 0 00 402225'		  $ERR	(IDV)			;ILLEGAL DEVICE
   479	400223'	300 00 0 00 000001 
   480	400224'	135 01 0 00 402323'		LDB	T1,[POINTR (T1,DC.TYP)]	;SEE WHAT KINDA JUNK HE GAVE US
   481	400225'	302 01 0 00 000002 		CAIE	T1,.DCTFS		;ONLY WANT A FULL STRUCTURE NAME
   482	400226'	260 17 0 00 402225'		  $ERR	(ISN)			;IMPROPER STRUCTURE NAME
   483	400227'	300 00 0 00 000002 
   484	400230'	135 01 0 00 402324'		LDB	T1,[POINTR (DCHBLK+.DCUCH,DC.UCC)];GET BLOCKS PER CLUSTER
   485	400231'	202 01 0 00 001201'		MOVEM	T1,BPC			;SAVE FOR CFP COMPUTATION
   486	400232'	260 17 0 00 401103'		PUSHJ	P,SETFIL		;SET UP FILE BLOCKS
   487	400233'	476 00 0 00 000031'		SETOM	LEVEL			;INDICATE NO CHANNELS OPEN
   488	400234'	201 11 0 00 000000 		MOVEI	L,0			;POINT TO TOP LEVEL
   489	400235'	260 17 0 00 401145'		PUSHJ	P,SETBLK		;SET UP SOME BLOCKS
   490	400236'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET THE PPN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 17-1
UFDSET	MAC	24-Sep-72 02:32		Initialization

   491	400237'	202 01 0 06 000130'		MOVEM	T1,LKPBLK+.RBNAM(P2)	;STORE AS THE FILE NAME
   492	400240'	200 01 0 00 402325'		MOVE	T1,[IOWD BLKSIZ,DSKBUF]	;POINT TO DISK BUFFER
   493	400241'	202 01 0 00 000573'		MOVEM	T1,IOLIST		;STORE IOWD
   494	400242'	135 01 0 00 402321'		LDB	T1,[POINTR (.UFFLG(AP),UF.FNC)] ;GET FUNCTION CODE AGAIN
   495	400243'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 18
UFDSET	MAC	24-Sep-72 02:32		PPN fixup

   496					SUBTTL	PPN fixup
   497
   498
   499					; Here to on MOUNT and DISMOUNT functions to insure the job number
   500					; and the PPN match. They might not, due to races between the user's
   501					; job, QUASAR, and PULSAR. Typically this will happen when some
   502					; Bozo changes his S/L and immediately changes his PPN too. QUASAR
   503					; will get the S/L change message and GETTAB the PPN of the job,
   504					; remembering it forever more. The guy then changes his PPN back
   505					; and types DISMOUNT FOO. PULSAR gets the error return from UFDSET
   506					; (because a STRUUO failed) and starts bitching at the operator.
   507					;
   508	400244'	205 01 0 00 000200 	FIXPPN:	MOVX	T1,UF.WLD		;GET WILD PROGRAMMER NUMBER BIT
   509	400245'	612 01 0 16 000000 		TDNE	T1,.UFFLG(AP)		;WANT US TO GENERATE A PPN?
   510	400246'	263 17 0 00 000000 		POPJ	P,			;YES - DO NOTHING FOR NOW
   511	400247'	514 01 0 16 000003 		HRLZ	T1,.UFJOB(AP)		;GET THE JOB NUMBER
   512	400250'	541 01 0 00 000002 		HRRI	T1,.GTPPN		;GETTAB TABLE
   513	400251'	047 01 0 00 000041 		GETTAB	T1,			;READ THE JOB'S PPN
   514	400252'	334 00 0 00 000000 		  SKIPA				;CAN'T
   515	400253'	202 01 0 16 000002 		MOVEM	T1,.UFPPN(AP)		;RESET IT
   516	400254'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 19
UFDSET	MAC	24-Sep-72 02:32		Directory searching and recomputing logic

   517					SUBTTL	Directory searching and recomputing logic
   518
   519
   520	400255'	317 11 0 00 000031'	RECOMP:	CAMG	L,LEVEL			;CURRENT LEVEL HAVE A FILE OPEN?
   521	400256'	254 00 0 00 400355'		JRST	RECO.4			;YES - PROCEED
   522	400257'	350 00 0 00 000031'		AOS	LEVEL			;POINT TO NEXT LEVEL
   523	400260'	551 01 0 05 000040'		HRRZI	T1,FOPBLK(P1)		;GET ADDRESS OF FILOP BLOCK
   524	400261'	505 01 0 00 000011 		HRLI	T1,FOPSIZ		;GET LENGTH OF BLOCK
   525	400262'	047 01 0 00 000155 		FILOP.	T1,			;OPEN THE FILE
   526	400263'	254 00 0 00 400326'		  JRST	RECO.2			;CAN'T - FORGET THIS DIRECTORY
   527	400264'	200 01 0 05 000040'		MOVE	T1,FOPBLK+.FOFNC(P1)	;GET ORIGINAL FUNCTION WORD
   528	400265'	630 01 0 00 402326'		ANDX	T1,FO.CHN		;KEEP JUST THE CHANNEL NUMBER
   529	400266'	541 01 0 00 000017 		HRRI	T1,.FOINP		;LOAD FUNCTION CODE TO READ
   530	400267'	202 01 0 11 000032'		MOVEM	T1,FUNBLK(L)		;SAVE FUNCTION WORD FOR LATER
   531	400270'	200 01 0 06 000130'		MOVE	T1,LKPBLK+.RBNAM(P2)	;GET DIRECTORY FILE NAME
   532	400271'	202 01 0 11 000532'		MOVEM	T1,PTHBLK+.PTPPN(L)	;ADD TO THE END OF THE PATH SPEC
   533	400272'	402 00 0 11 000514'		SETZM	DIRBLK(L)		;CLEAR DIRECTORY BLOCK NUMBER
   534	400273'	326 11 0 00 400300'		JUMPN	L,RECO.1		;CHECK FOR TOP LEVEL
   535	400274'	260 17 0 00 400527'		PUSHJ	P,UOQINI		;SET UP .UFQ??
   536	400275'	402 00 0 16 000012 		SETZM	.UFUSD(AP)		;INIT BLOCKS USED COUNTER
   537	400276'	254 00 0 00 400300'		JRST	RECO.1			;CONTINUE
   538
   539	400277'	374 00 0 11 000514'	RECO.0:	SOSA	DIRBLK(L)		;ADJUST BLOCK NUMBER FOR RE-READ
   540
   541	400300'	402 00 0 11 000522'	RECO.1:	SETZM	IDXBLK(L)		;CLEAR INDEX INTO BUFFER
   542	400301'	200 01 0 00 402327'		MOVE	T1,[2,,T2]		;SET UP AC
   543	400302'	200 02 0 05 000040'		MOVE	T2,FOPBLK+.FOFNC(P1)	;GET FUNCTION WORD
   544	400303'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL NUMBER
   545	400304'	541 02 0 00 000011 		HRRI	T2,.FOUSI		;GET USETI FUNCTION
   546	400305'	350 03 0 11 000514'		AOS	T3,DIRBLK(L)		;GET BLOCK NUMBER
   547	400306'	047 01 0 00 000155 		FILOP.	T1,			;POSITION FOR INPUT
   548	400307'	254 00 0 00 400320'		  JRST	RECO.A			;CAN'T
   549	400310'	200 01 0 00 402327'		MOVE	T1,[2,,T2]		;SET UP AC
   550	400311'	200 02 0 05 000040'		MOVE	T2,FOPBLK+.FOFNC(P1)	;GET FUNCTION WORD
   551	400312'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL NUMBER
   552	400313'	541 02 0 00 000017 		HRRI	T2,.FOINP		;GET USETI FUNCTION
   553	400314'	201 03 0 00 000573'		MOVEI	T3,IOLIST		;POINT TO I/O COMMAND LIST
   554	400315'	047 01 0 00 000155 		FILOP.	T1,			;READ A BLOCK
   555	400316'	334 00 0 00 000000 		  SKIPA				;CAN'T - ANALYZE ERROR
   556	400317'	254 00 0 00 400355'		JRST	RECO.4			;PROCEED
   557	400320'	602 01 0 00 020000 	RECO.A:	TXNE	T1,IO.EOF		;CHECK FOR ERRORS
   558	400321'	254 00 0 00 400331'		JRST	RECO.3			;JUST CLOSE CHANNEL ON EOF
   559	400322'	260 17 0 00 401753'		PUSHJ	P,DIRIOE		;REPORT DIRECTORY I/O ERROR
   560	400323'	337 00 0 00 000011 		SKIPG	L			;TOPLEVEL DIRECTORY?
   561	400324'	350 00 0 00 000030'		AOS	TOPERR			;YES - INDICATE I/O ERROR
   562	400325'	254 00 0 00 400331'		JRST	RECO.3			;ONE ERROR IS ENOUGH
   563
   564	400326'	260 17 0 00 401762'	RECO.2:	PUSHJ	P,DIRERR		;REPORT DIRECTORY ERROR
   565	400327'	337 00 0 00 000011 		SKIPG	L			;TOPLEVEL DIRECTORY?
   566	400330'	370 00 0 00 000030'		SOS	TOPERR			;YES - INDICATE LOOKUP ERROR
   567
   568	400331'	200 01 0 00 402330'	RECO.3:	MOVE	T1,[1,,T2]		;SET UP AC
   569	400332'	200 02 0 05 000040'		MOVE	T2,FOPBLK+.FOFNC(P1)	;GET FUNCTION WORD
   570	400333'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL
   571	400334'	541 02 0 00 000023 		HRRI	T2,.FOREL		;LOAD RELEASE FUNCTION
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 19-1
UFDSET	MAC	24-Sep-72 02:32		Directory searching and recomputing logic

   572	400335'	047 01 0 00 000155 		FILOP.	T1,			;RELEASE THE CHANNEL
   573	400336'	255 00 0 00 000000 		  JFCL				;IGNORE ERRORS
   574	400337'	205 01 0 00 000777 		MOVX	T1,FO.CHN		;GET CHANNEL FIELD
   575	400340'	412 01 0 05 000040'		ANDCAM	T1,FOPBLK+.FOFNC(P1)	;CLEAR FOR NEXT TIME
   576	400341'	402 00 0 11 000532'		SETZM	PTHBLK+.PTPPN(L)	;TERMINATE PATH PROPERLY
   577	400342'	370 11 0 00 000031'		SOS	L,LEVEL			;BACKUP A LEVEL
   578	400343'	260 17 0 00 401140'		PUSHJ	P,SETPTR		;SET UP POINTERS
   579	400344'	336 01 0 00 000030'		SKIPN	T1,TOPERR		;WAS THERE A TOPLEVEL DIRECTORY ERROR?
   580	400345'	325 11 0 00 400277'		JUMPGE	L,RECO.0		;NO - CONTINUE
   581	400346'	306 01 0 00 000001 		CAIN	T1,1			;I/O ERROR?
   582	400347'	260 17 0 00 402225'		  $ERR	(IOE)			;YES
   583	400350'	300 00 0 00 000003 
   584	400351'	316 01 0 00 402320'		CAMN	T1,[-1]			;LOOKUP ERROR?
   585	400352'	260 17 0 00 402225'		  $ERR	(CAD)			;YES
   586	400353'	300 00 0 00 000004 
   587	400354'	263 17 0 00 000000 		POPJ	P,			;RETURN
   588
   589	400355'	335 00 0 11 000514'	RECO.4:	SKIPGE	DIRBLK(L)		;NEED TO RE-READ BLOCK?
   590	400356'	254 00 0 00 400277'		JRST	RECO.0			;YES
   591	400357'	200 04 0 11 000522'		MOVE	T4,IDXBLK(L)		;GET INDEX INTO BUFFER
   592	400360'	301 04 0 00 000200 		CAIL	T4,BLKSIZ		;END OF BUFFER?
   593	400361'	254 00 0 00 400300'		JRST	RECO.1			;YES - READ ANOTHER BLOCK
   594	400362'	200 01 0 04 000575'		MOVE	T1,DSKBUF+0(T4)		;GET FILE NAME
   595	400363'	510 02 0 04 000576'		HLLZ	T2,DSKBUF+1(T4)		;GET EXTENSION
   596	400364'	550 03 0 04 000576'		HRRZ	T3,DSKBUF+1(T4)		;GET COMPRESSED FILE POINTER
   597	400365'	201 04 0 00 000002 		MOVEI	T4,2			;ACCOUNT FOR TWO WORD ENTRIES
   598	400366'	272 04 0 11 000522'		ADDM	T4,IDXBLK(L)		;POINT PAST THE WORDS WE JUST READ
   599	400367'	322 01 0 00 400355'		JUMPE	T1,RECO.4		;FLUSH NULL ENTRIES
   600
   601	400370'	202 01 0 00 001013'	RECO.5:	MOVEM	T1,LKPFIL+.RBNAM	;STORE FILE NAME
   602	400371'	202 02 0 00 001014'		MOVEM	T2,LKPFIL+.RBEXT	;STORE EXTENSION
   603	400372'	200 01 0 06 000130'		MOVE	T1,LKPBLK+.RBNAM(P2)	;GET CURRENT DIRECTORY NAME
   604	400373'	202 01 0 11 001064'		MOVEM	T1,PTHFIL+.PTPPN(L)	;STORE AT THE END OF THE PATH SPEC
   605	400374'	402 00 0 11 001065'		SETZM	PTHFIL+.PTSFD(L)	;MAKE SURE PATH IS TERMINATED
   606	400375'	200 01 0 00 000003 		MOVE	T1,T3			;COPY CFP
   607	400376'	260 17 0 00 400435'		PUSHJ	P,RIBSUP		;READ RIB WITH SUPER I/O IF WE CAN
   608	400377'	334 01 0 00 402331'		  SKIPA	T1,[FOPSIZ,,FOPFIL]	;CAN'T - SET UP FILOP
   609	400400'	254 00 0 00 400403'		JRST	RECO.9			;SAVE FILSER SOME WORK
   610	400401'	047 01 0 00 000155 		FILOP.	T1,			;LOOKUP A FILE
   611	400402'	254 00 0 00 400411'		  JRST	RECO.6			;CAN'T
   612	400403'	200 01 0 00 001022'	RECO.9:	MOVE	T1,LKPFIL+.RBALC	;GET BLOCKS ALLOCATED TO THIS FILE
   613	400404'	201 02 0 00 002000 		MOVX	T2,RP.NQC		;NON-QUOTA CHECKED FILE BIT
   614	400405'	616 02 0 00 001030'		TDNN	T2,LKPFIL+.RBSTS	;DO QUOTA CHECKING ON THIS FILE?
   615	400406'	272 01 0 16 000012 		ADDM	T1,.UFUSD(AP)		;YES - ADD TO TOTAL SO FAR
   616	400407'	260 17 0 00 400541'		PUSHJ	P,RIBCHK		;CHECK FOR FILE ERRORS
   617	400410'	254 00 0 00 400413'		JRST	RECO.7			;ALLS WELL SO FAR
   618
   619	400411'	260 17 0 00 401761'	RECO.6:	PUSHJ	P,FILERR		;REPORT FILE ERRORS
   620	400412'	402 00 0 00 001014'		SETZM	LKPFIL+.RBEXT		;CLEAR SO WE DON'T DO EXTRA LOOKUP
   621
   622	400413'	200 01 0 00 402330'	RECO.7:	MOVE	T1,[1,,T2]		;SET UP AC
   623	400414'	200 02 0 00 001000'		MOVE	T2,FOPFIL+.FOFNC	;GET FUNCTION WORD
   624	400415'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL NUMBER
   625	400416'	541 02 0 00 000023 		HRRI	T2,.FOREL		;LOAD NEW FUNCTION CODE
   626	400417'	047 01 0 00 000155 		FILOP.	T1,			;RELEASE THE CHANNEL
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 19-2
UFDSET	MAC	24-Sep-72 02:32		Directory searching and recomputing logic

   627	400420'	255 00 0 00 000000 		  JFCL				;IGNORE ERRORS
   628	400421'	200 01 0 00 402332'		MOVX	T1,FO.PRV!FO.ASC+.FORED	;USE PRIVS/ASSIGN CHANNEL/READ
   629	400422'	202 01 0 00 001000'		MOVEM	T1,FOPFIL+.FOFNC	;RESET FOR ENXT TIME
   630	400423'	554 01 0 00 001014'		HLRZ	T1,LKPFIL+.RBEXT	;GET THE EXTENSION
   631	400424'	306 01 0 00 634644 		CAIN	T1,'SFD'		;LOWER LEVEL DIRECTORY?
   632	400425'	354 00 0 00 000011 		AOSA	L			;YES - DROP DOWN A LEVEL
   633	400426'	254 00 0 00 400255'		JRST	RECOMP			;GO BACK AND DO ANOTHER FILE
   634
   635	400427'	260 17 0 00 401145'	RECO.8:	PUSHJ	P,SETBLK		;SET UP BLOCKS AND POINTERS
   636	400430'	200 01 0 00 001013'		MOVE	T1,LKPFIL+.RBNAM	;GET A DIRECTORY NAME
   637	400431'	202 01 0 06 000130'		MOVEM	T1,LKPBLK+.RBNAM(P2)	;STORE IT
   638	400432'	510 01 0 00 001014'		HLLZ	T1,LKPFIL+.RBEXT	;GET IT'S EXTENSION
   639	400433'	202 01 0 06 000131'		MOVEM	T1,LKPBLK+.RBEXT(P2)	;STORE IT TOO
   640	400434'	254 00 0 00 400255'		JRST	RECOMP			;GO BACK AND DO ANOTHER FILE
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 20
UFDSET	MAC	24-Sep-72 02:32		RIBSUP - Read and verify a rib

   641						SUBTTL	RIBSUP - Read and verify a rib
   642
   643
   644					; Call:	T1/ CFP
   645					; error return if not a good rib, normal return if verified
   646					;
   647					; Note:	Unit of RIB = (CFP/CPU)
   648					;	Block on unit = (CFP - (unit of RIB * CPU)) * BPC
   649					;	Block of RIB = (USZ * unit of RIB) + block on unit
   650					;
   651					; CFP - Compressed File Pointer
   652					; CPU - Clusters Per Unit
   653					; BPC - Blocks per cluster
   654					; USZ - Number of blocks on a unit
   655
   656	400435'	200 02 0 00 000001 	RIBSUP:	MOVE	T2,T1			;COPY CFP FOR LATER
   657	400436'	230 02 0 00 001203'		IDIV	T2,CPU			;COMPUTE UNIT WE ARE WORKING WITH
   658	400437'	200 03 0 00 001203'		MOVE	T3,CPU			;GET THE CLUSTERS PER UNIT
   659	400440'	221 03 0 02 000000 		IMULI	T3,(T2)			;COMPUTE THE NUMBER OF CLUSTERS
   660										; BEFORE THIS UNIT
   661	400441'	274 01 0 00 000003 		SUB	T1,T3			;COMPUTE CLUSTER WITHIN UNIT
   662	400442'	220 01 0 00 001201'		IMUL	T1,BPC			;DETERMINE BLOCK WITHIN UNIT
   663	400443'	220 02 0 00 001202'		IMUL	T2,USZ			;DETERMINE BLOCKS BEFORE THIS UNIT
   664	400444'	270 01 0 00 000002 		ADD	T1,T2			;DETERMINE BLOCK WITHIN STRUCTURE
   665	400445'	202 01 0 00 001405'		MOVEM	T1,SUPFOP+1		;STORE ARG
   666	400446'	201 01 0 00 000011 		MOVEI	T1,.FOUSI		;USETI
   667	400447'	137 01 0 00 402333'		DPB	T1,[POINTR (SUPFOP+.FOFNC,FO.FNC)];STORE FUNCTION
   668	400450'	200 01 0 00 402334'		MOVE	T1,[2,,SUPFOP]		;POINT TO FILOP. BLOCK
   669	400451'	047 01 0 00 000155 		FILOP.	T1,			;SHOOT
   670	400452'	263 17 0 00 000000 		 POPJ	P,			;FAILED
   671	400453'	201 01 0 00 000017 		MOVEI	T1,.FOINP		;INPUT
   672	400454'	137 01 0 00 402333'		DPB	T1,[POINTR (SUPFOP+.FOFNC,FO.FNC)];STORE FUNCTION
   673	400455'	200 01 0 00 402335'		MOVE	T1,[IOWD BLKSIZ,RIBBLK]	;POINT TO A RIB
   674	400456'	201 02 0 00 000000 		MOVEI	T2,0			;CLEAR IO LIST
   675	400457'	201 03 0 00 000001 		MOVEI	T3,T1			;ADDRESS OF I/O LIST
   676	400460'	202 03 0 00 001405'		MOVEM	T3,SUPFOP+1		;STORE
   677	400461'	200 03 0 00 402334'		MOVE	T3,[2,,SUPFOP]		;POINT TO FILOP. BLOCK
   678	400462'	047 03 0 00 000155 		FILOP.	T3,			;READ THE RIB
   679	400463'	263 17 0 00 000000 		 POPJ	P,			;CANT
   680
   681					;Now verify RIB
   682
   683	400464'	200 01 0 00 001013'		MOVE	T1,LKPFIL+.RBNAM	;GET DESIRED NAME
   684	400465'	312 01 0 00 001206'		CAME	T1,RIBBLK+.RBNAM	;MATCH RIB?
   685	400466'	263 17 0 00 000000 		 POPJ	P,			;NO
   686	400467'	510 01 0 00 001014'		HLLZ	T1,LKPFIL+.RBEXT	;GET EXTENSION
   687	400470'	510 02 0 00 001207'		HLLZ	T2,RIBBLK+.RBEXT	;AND FROM RIB
   688	400471'	312 01 0 00 000002 		CAME	T1,T2			;MATCH?
   689	400472'	263 17 0 00 000000 		 POPJ	P,			;NO
   690	400473'	200 01 0 00 000532'		MOVE	T1,PTHBLK+.PTPPN	;GET PPN?
   691	400474'	312 01 0 00 001205'		CAME	T1,RIBBLK+.RBPPN	;MATCH?
   692	400475'	263 17 0 00 000000 		 POPJ	P,			;NO
   693
   694					;Now copy RIB
   695
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 20-1
UFDSET	MAC	24-Sep-72 02:32		RIBSUP - Read and verify a rib

   696	400476'	261 17 0 00 001012'		PUSH	P,LKPFIL+.RBPPN		;SAVE PATH POINTER
   697	400477'	261 17 0 00 001011'		PUSH	P,LKPFIL+.RBCNT		;SAVE COUNTER
   698	400500'	200 01 0 00 402336'		MOVE	T1,[RIBBLK,,LKPFIL]	;SETUP BLT
   699	400501'	251 01 0 00 001061'		BLT	T1,LKPFIL+RIBSIZ	;MOVE THE RIB OVER
   700	400502'	262 17 0 00 001011'		POP	P,LKPFIL+.RBCNT		;FUDGE THEM BACK
   701	400503'	262 17 0 00 001012'		POP	P,LKPFIL+.RBPPN		;...
   702	400504'	350 00 0 17 000000 		AOS	(P)			;SKIP RETURN
   703	400505'	263 17 0 00 000000 		POPJ	P,			;TO CALLER
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 21
UFDSET	MAC	24-Sep-72 02:32		SETSUP - Setup for super I/O

   704						SUBTTL	SETSUP - Setup for super I/O
   705
   706	400506'	200 01 0 00 402337'	SETSUP:	MOVE	T1,[FO.ASC+.FOSIO]	;SUPER MODE
   707	400507'	202 01 0 00 001404'		MOVEM	T1,SUPFOP+.FOFNC	;STORE
   708	400510'	201 01 0 00 000017 		MOVEI	T1,.IODMP		;DUMP MODE
   709	400511'	202 01 0 00 001405'		MOVEM	T1,SUPFOP+.FOIOS	;STORE
   710	400512'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STR
   711	400513'	202 01 0 00 001406'		MOVEM	T1,SUPFOP+.FODEV	;STORE DEVICE
   712	400514'	200 01 0 00 402340'		MOVE	T1,[4,,SUPFOP]		;POINT TO BLOCK
   713	400515'	047 01 0 00 000155 		FILOP.	T1,			;OPEN IT UP
   714	400516'	260 17 0 00 402225'		 $ERR	(IDV)			;??
   715	400517'	300 00 0 00 000001 
   716	400520'	263 17 0 00 000000 		POPJ	P,			;AND RETURN
   717
   718						SUBTTL	FINSUP - Finish up super I/O
   719
   720	400521'	201 01 0 00 000023 	FINSUP:	MOVEI	T1,.FOREL		;RELEASE FUNCTION
   721	400522'	137 01 0 00 402333'		DPB	T1,[POINTR (SUPFOP+.FOFNC,FO.FNC)];STORE
   722	400523'	200 01 0 00 402341'		MOVE	T1,[1,,SUPFOP]		;POINT TO BLOCK
   723	400524'	047 01 0 00 000155 		FILOP.	T1,			;RELEASE CHANNEL
   724	400525'	255 00 0 00 000000 		 JFCL				;OH WELL
   725	400526'	263 17 0 00 000000 		POPJ	P,			;AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 22
UFDSET	MAC	24-Sep-72 02:32		Set up .UFQ??

   726					SUBTTL	Set up .UFQ??
   727
   728
   729					; Here to set up .UFQTF, .UFQTO, .UFQTR and .UFUSD
   730					;
   731	400527'	335 01 0 16 000006 	UOQINI:	SKIPGE	T1,.UFQTF(AP)		;GET QUOTA TO SET
   732	400530'	200 01 0 06 000150'		MOVE	T1,LKPBLK+.RBQTF(P2)	;GET LOGGED-IN QUOTA
   733	400531'	202 01 0 16 000006 		MOVEM	T1,.UFQTF(AP)		;STORE IT
   734	400532'	335 01 0 16 000007 		SKIPGE	T1,.UFQTO(AP)		;GET QUOTA TO SET
   735	400533'	200 01 0 06 000151'		MOVE	T1,LKPBLK+.RBQTO(P2)	;GET LOGGED-OUT QUOTA
   736	400534'	202 01 0 16 000007 		MOVEM	T1,.UFQTO(AP)		;STORE IT
   737	400535'	335 01 0 16 000010 		SKIPGE	T1,.UFQTR(AP)		;SET QUOTA TO SET
   738	400536'	200 01 0 06 000152'		MOVE	T1,LKPBLK+.RBQTR(P2)	;GET RESERVED QUOTA
   739	400537'	202 01 0 16 000010 		MOVEM	T1,.UFQTR(AP)		;STORE IT
   740	400540'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 23
UFDSET	MAC	24-Sep-72 02:32		Check for file errors

   741					SUBTTL	Check for file errors
   742
   743
   744					; Here to check for file errors (error bits in RIBSTS)
   745					;
   746	400541'	201 01 0 00 000715 	RIBCHK:	MOVX	T1,RP.ERR		;GET MASK OF ALL FILE ERRORS
   747	400542'	616 01 0 00 001030'		TDNN	T1,LKPFIL+.RBSTS	;ANY SET
   748	400543'	263 17 0 00 000000 		POPJ	P,			;NO
   749	400544'	350 00 0 00 000027'		AOS	RIBERR			;COUNT ERROR BITS
   750	400545'	336 00 0 16 000017 		SKIPN	.UFTYO(AP)		;CALLING PROGRAM WANT TO SEE MESSAGE?
   751	400546'	263 17 0 00 000000 		POPJ	P,			;NO
   752	400547'	261 17 0 00 000005 		PUSH	P,P1			;SAVE P1
   753	400550'	201 05 0 00 000000 		MOVEI	P1,0			;CLEAR INDEX
   754
   755	400551'	550 01 0 05 400567'	RIBC.1:	HRRZ	T1,RIBTAB(P1)		;GET BIT TO TEST
   756	400552'	616 01 0 00 001030'		TDNN	T1,LKPFIL+.RBSTS	;BIT ON?
   757	400553'	254 00 0 00 400563'		JRST	RIBC.2			;NO - TRY ANOTHER
   758	400554'	201 01 0 00 001000'		MOVEI	T1,FOPFIL		;GET FILOP BLOCK ADDRESS
   759	400555'	202 01 0 00 000776'		MOVEM	T1,FOPADR		;SAVE IT
   760	400556'	554 01 0 05 400567'		HLRZ	T1,RIBTAB(P1)		;GET TEXT ADDRESS
   761	400557'	202 01 0 00 001145'		MOVEM	T1,TXTADR		;SAVE IT
   762	400560'	200 01 0 00 402342'		MOVE	T1,["%",,'FLE']		;FLAG AS WARNING
   763	400561'	201 02 0 00 402343'		MOVEI	T2,[ASCIZ |Error on @J; @K|] ;GET TEXT
   764	400562'	260 17 0 00 401770'		PUSHJ	P,TEXT			;GENERATE TEXT
   765
   766	400563'	305 05 0 00 000005 	RIBC.2:	CAIGE	P1,RIBMAX-1		;DONE CHECKING?
   767	400564'	344 05 0 00 400551'		AOJA	P1,RIBC.1		;NO - LOOP
   768	400565'	262 17 0 00 000005 		POP	P,P1			;RESTORE P1
   769	400566'	263 17 0 00 000000 		POPJ	P,			;RETURN
   770
   771
   772					; Macro to build RIBTAB
   773					;
   774					DEFINE	$RIB	(BIT,TXT),<[ASCIZ |TXT|],,RP.'BIT>
   775
   776
   777					; Table of RIB bits and error messages
   778					;
   779	400567'	402347'	000001		RIBTAB:	$RIB	(BDA,<file damage>)
   780	400570'	402352'	000004			$RIB	(CRH,<closed after a crash>)
   781	400571'	402357'	000010			$RIB	(BFA,<tape read error restoring file>)
   782	400572'	402366'	000100			$RIB	(FRE,<hard data read error>)
   783	400573'	402373'	000200			$RIB	(FWE,<hard data write error>)
   784	400574'	402400'	000400			$RIB	(FCE,<software detected checksum error>)
   785			000006		RIBMAX==.-RIBTAB
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 24
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Read a S/L

   786					SUBTTL	Search list routines -- Read a S/L
   787
   788
   789					; Read a search list
   790					;
   791	400575'	201 02 0 00 000001 	READSL:	MOVEI	T2,.FSDSL		;GET FUNCTION CODE
   792	400576'	202 02 0 00 001415'		MOVEM	T2,OLDSL+.FSFCN		;SAVE IT
   793	400577'	200 01 0 16 000003 		MOVE	T1,.UFJOB(AP)		;GET JOB NUMBER
   794	400600'	202 01 0 00 001416'		MOVEM	T1,OLDSL+.FSDJN		;SAVE IT
   795	400601'	202 01 0 00 001531'		MOVEM	T1,GOBBLK+.DFGJN	;HERE TOO
   796	400602'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET PPN
   797	400603'	202 01 0 00 001417'		MOVEM	T1,OLDSL+.FSDPP		;SAVE IT
   798	400604'	402 00 0 00 001420'		SETZM	OLDSL+.FSDFL		;CLEAR FLAG WORD
   799	400605'	201 02 0 00 001421'		MOVEI	T2,OLDSL+.FSDSO		;POINT TO FIRST STR BLOCK
   800	400606'	402 00 0 00 001532'		SETZM	GOBBLK+.DFGPP		;NO PPN
   801	400607'	476 00 0 00 001533'		SETOM	GOBBLK+.DFGNM		;START WITH THE FIRST STRUCTURE
   802
   803	400610'	200 01 0 00 402407'	READ.1:	MOVE	T1,[.DFGST+1,,GOBBLK]	;SET UP UUO
   804	400611'	200 03 0 00 402410'		MOVE	T3,[GOBSTR T1,]		;ASSUME ANY JOB
   805	400612'	336 00 0 00 000023'		SKIPN	SLFFLG			;OUR JOB?
   806	400613'	254 00 0 00 400616'		JRST	READ.2			;NO
   807	400614'	200 01 0 00 402411'		MOVE	T1,[.DFJBL,,GOBBLK+2]	;ADJUST ARGUMENT
   808	400615'	200 03 0 00 402412'		MOVE	T3,[JOBSTR T1,]		;FOR OUR JOB
   809
   810	400616'	256 00 0 00 000003 	READ.2:	XCT	T3			;GET THE NEXT STRUCTURE IN S/L
   811	400617'	260 17 0 00 402225'		  $ERR	(CRS)			;CAN'T READ S/L
   812	400620'	300 00 0 00 000007 
   813	400621'	205 01 0 00 001533'		MOVSI	T1,GOBBLK+.DFGNM	;POINT TO ARGUMENTS RETURNED
   814	400622'	541 01 0 02 000000 		HRRI	T1,(T2)			;BUILD BLT POINTER
   815	400623'	251 01 0 02 000002 		BLT	T1,.DFJBL-1(T2)		;COPY THEM
   816	400624'	271 02 0 00 000003 		ADDI	T2,.DFJBL		;POINT TO NEXT STR BLOCK
   817	400625'	200 01 0 00 001533'		MOVE	T1,GOBBLK+.DFGNM	;GET LAST STR RETURNED
   818	400626'	346 01 0 00 400610'		AOJN	T1,READ.1		;LOOP IF NOT END OF S/L
   819	400627'	201 01 0 00 001415'		MOVEI	T1,OLDSL		;GET S/L BLOCK ADDRESS
   820	400630'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 25
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Find a structure in a S/L

   821					SUBTTL	Search list routines -- Find a structure in a S/L
   822
   823
   824
   825					; Find a search list entry in either OLDSL or NEWSL
   826					; Call:	MOVE	T1, STR
   827					;	PUSHJ	P,FINDOS	;OLDSL
   828					;	PUSHJ	P,FINDNS	;NEWSL
   829					;	<NON-SKIP>		;ENTRY NOT FOUND
   830					;	<SKIP>			;ENTRY FOUND, T2:= ENTRY ADDRESS
   831					;
   832	400631'	334 02 0 00 402413'	FINDOS:	SKIPA	T2,[OLDSL]		;POINT TO OLD S/L
   833	400632'	201 02 0 00 001463'	FINDNS:	MOVEI	T2,NEWSL		;POINT TO NEW S/L
   834	400633'	271 02 0 00 000004 		ADDI	T2,.FSDSO		;POINT TO FIRST STRUCTURE
   835
   836	400634'	200 03 0 02 000000 	FIND.1:	MOVE	T3,.DFJNM(T2)		;GET A STRUCTURE FROM THE S/L
   837	400635'	316 03 0 00 000001 		CAMN	T3,T1			;FOUND WHAT WE'RE LOOKING FOR?
   838	400636'	254 00 0 00 400013'		JRST	CPOPJ1			;YES - RETURN T2:= ADDRESS
   839	400637'	342 03 0 00 400014'		AOJE	T3,CPOPJ		;CHECK FOR END OF S/L
   840	400640'	271 02 0 00 000003 		ADDI	T2,.DFJBL		;POINT TO NEXT ENTRY
   841	400641'	254 00 0 00 400634'		JRST	FIND.1			;TRY THE NEXT
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 26
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Add a structure

   842					SUBTTL	Search list routines -- Add a structure
   843
   844
   845	400642'	200 01 0 00 402414'	ADDJSL:	MOVE	T1,[OLDSL,,NEWSL]	;SET UP BLT
   846	400643'	251 01 0 00 001466'		BLT	T1,NEWSL+.FSDFL		;COPY HEADER STUFF
   847	400644'	201 05 0 00 001421'		MOVEI	P1,OLDSL+.FSDSO		;POINT TO FIRST STR IN OLD S/L
   848	400645'	201 06 0 00 001467'		MOVEI	P2,NEWSL+.FSDSO		;POINT TO FIRST STR IN NEW S/L
   849	400646'	200 07 0 16 000000 		MOVE	P3,.UFFLG(AP)		;GET FLAGS
   850	400647'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STRUCTURE
   851	400650'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT
   852	400651'	254 00 0 00 400671'		  JRST	ADDJ.1			;ADD IT SOMEWHERE IN THE S/L
   853	400652'	200 10 0 00 000002 		MOVE	P4,T2			;SAVE ADDRESS
   854	400653'	201 01 0 00 000000 		MOVEI	T1,0			;FENCE
   855	400654'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT
   856	400655'	263 17 0 00 000000 		  POPJ	P,			;CAN'T HAPPEN
   857	400656'	607 07 0 00 010000 		TXNN	P3,UF.PSL		;WANT ACTIVE?
   858	400657'	311 10 0 00 000002 		CAML	P4,T2			;ALREADY ON THE ACTIVE SIDE?
   859	400660'	334 00 0 00 000000 		  SKIPA				;NO TO EITHER
   860	400661'	254 00 0 00 400704'		JRST	ADDJ.2			;YES - LEAVE IT WHERE IT IS
   861	400662'	603 07 0 00 010000 		TXNE	P3,UF.PSL		;WANT PASSIVE?
   862	400663'	317 10 0 00 000002 		CAMG	P4,T2			;ALREADY ON THE PASSIVE SIDE?
   863	400664'	334 00 0 00 000000 		  SKIPA				;NO TO EITHER
   864	400665'	254 00 0 00 400704'		JRST	ADDJ.2			;YES - THEN LEAVE IT WHERE IT IS
   865	400666'	607 07 0 00 010000 		TXNN	P3,UF.PSL		;WHERE DO WE WANT IT?
   866	400667'	254 00 0 00 400712'		JRST	ADDJ.3			;PUT IN THE ACTIVE S/L
   867	400670'	254 00 0 00 400727'		JRST	ADDJ.4			;PUT IN THE PASSIVE S/L
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 27
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Add a structure

   868					; Here to add a new structure
   869					;
   870	400671'	607 07 0 00 010000 	ADDJ.1:	TXNN	P3,UF.PSL		;WHERE TO WE WANT IT
   871	400672'	634 01 0 00 000001 		TDZA	T1,T1			;PUT IN THE ACTIVE S/L
   872	400673'	561 01 0 00 777777 		MOVX	T1,-1			;PUT IN THE PASSIVE S/L
   873	400674'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND THE FENCE OR END
   874	400675'	263 17 0 00 000000 		  POPJ	P,			;SHOULDN'T FAIL
   875	400676'	201 01 0 02 000000 		MOVEI	T1,(T2)			;COMPUTE WORDS TO MOVE
   876	400677'	275 01 0 05 000000 		SUBI	T1,(P1)			;FROM BEGINING TO END
   877	400700'	260 17 0 00 400760'		PUSHJ	P,MOVSTR		;MOVE THEM
   878	400701'	260 17 0 00 400745'		PUSHJ	P,ADDSTR		;ADD STR TO END OF ACTIVE OR PASSIVE
   879	400702'	260 17 0 00 400772'		PUSHJ	P,FINSTR		;FINISH COPYING THE S/L
   880	400703'	263 17 0 00 000000 		POPJ	P,			;RETURN
   881
   882
   883					; Here to copy an existing structure
   884					;
   885	400704'	201 01 0 10 000000 	ADDJ.2:	MOVEI	T1,(P4)			;GET STR ADDRESS
   886	400705'	275 01 0 05 000000 		SUBI	T1,(P1)			;COMPUTE WORDS TO COPY
   887	400706'	260 17 0 00 400760'		PUSHJ	P,MOVSTR		;MOVE THEM
   888	400707'	260 17 0 00 400744'		PUSHJ	P,CPYSTR		;COPY STR TO NEW S/L
   889	400710'	260 17 0 00 400772'		PUSHJ	P,FINSTR		;FINISH COPYING THE S/L
   890	400711'	263 17 0 00 000000 		POPJ	P,			;RETURN
   891
   892
   893					; Here to put a structure in the active S/L
   894					;
   895	400712'	201 01 0 00 000000 	ADDJ.3:	MOVEI	T1,0			;FENCE
   896	400713'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT
   897	400714'	263 17 0 00 000000 		  POPJ	P,			;CAN'T HAPPEN
   898	400715'	201 01 0 02 000000 		MOVEI	T1,(T2)			;GET ADDRESS OF FENCE
   899	400716'	275 01 0 05 000000 		SUBI	T1,(P1)			;COMPUTE WORDS TO MOVE
   900	400717'	260 17 0 00 400760'		PUSHJ	P,MOVSTR		;MOVE THEM
   901	400720'	260 17 0 00 400745'		PUSHJ	P,ADDSTR		;ADD THE STRUCTURE TO ACTIVE S/L
   902	400721'	201 01 0 10 000000 		MOVEI	T1,(P4)			;GET STR ADDRESS
   903	400722'	275 01 0 05 000000 		SUBI	T1,(P1)			;COMPUTE WORDS TO MOVE
   904	400723'	260 17 0 00 400760'		PUSHJ	P,MOVSTR		;MOVE THEM
   905	400724'	271 05 0 00 000003 		ADDI	P1,.DFJBL		;POINT BEYOND THE STR
   906	400725'	260 17 0 00 400772'		PUSHJ	P,FINSTR		;FINISH UP
   907	400726'	263 17 0 00 000000 		POPJ	P,			;RETURN
   908
   909
   910					; Here to put a structure in the passive S/L
   911					;
   912	400727'	201 01 0 10 000000 	ADDJ.4:	MOVEI	T1,(P4)			;GET POSITION OF STR IN OLD S/L
   913	400730'	275 01 0 05 000000 		SUBI	T1,(P1)			;COMPUTE WORDS TO COPY
   914	400731'	260 17 0 00 400760'		PUSHJ	P,MOVSTR		;MOVE THAT MANY WORDS
   915	400732'	271 05 0 00 000003 		ADDI	P1,.DFJBL		;SKIP OVER THE STR
   916	400733'	561 01 0 00 777777 		MOVX	T1,-1			;END OF S/L
   917	400734'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT
   918	400735'	263 17 0 00 000000 		  POPJ	P,			;CAN'T HAPPEN
   919	400736'	201 01 0 02 000000 		MOVEI	T1,(T2)			;GET ADDRESS OF END OF S/L
   920	400737'	275 01 0 05 000000 		SUBI	T1,(P1)			;COMPUTE WORDS TO MOVE
   921	400740'	260 17 0 00 400760'		PUSHJ	P,MOVSTR		;MOVE THAT MANY WORDS
   922	400741'	260 17 0 00 400745'		PUSHJ	P,ADDSTR		;NOW ADD THE STRUCTURE
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 27-1
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Add a structure

   923	400742'	260 17 0 00 400772'		PUSHJ	P,FINSTR		;FINISH UP
   924	400743'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 28
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Add a structure

   925					; Copy a structure block from the old S/L to the new S/L
   926					;
   927	400744'	634 01 0 00 000001 	CPYSTR:	TDZA	T1,T1			;INDICATE COPY
   928
   929
   930					; Add a new structure block to the new S/L
   931					;
   932	400745'	334 01 0 00 400745'	ADDSTR:	SKIPA	T1,.			;INDICATE ADD
   933	400746'	334 02 0 05 000000 		SKIPA	T2,.DFJNM(P1)		;GET STR TO COPY
   934	400747'	200 02 0 16 000001 		MOVE	T2,.UFSTR(AP)		;GET STR TO ADD
   935	400750'	202 02 0 06 000000 		MOVEM	T2,.DFJNM(P2)		;SAVE STR IN NEW S/L
   936	400751'	402 00 0 06 000001 		SETZM	.DFJDR(P2)		;CLEAR DIRECTORY
   937	400752'	200 02 0 16 000011 		MOVE	T2,.UFSTS(AP)		;GET FILE STRUCTURE STATUS BITS
   938	400753'	202 02 0 06 000002 		MOVEM	T2,.DFJST(P2)		;SAVE THEM
   939	400754'	336 00 0 00 000001 		SKIPN	T1			;ADDING?
   940	400755'	271 05 0 00 000003 		ADDI	P1,.DFJBL		;POINT TO NEXT OLD STR BLOCK IF COPY
   941	400756'	271 06 0 00 000003 		ADDI	P2,.DFJBL		;POINT TO NEXT NEW STR BLOCK
   942	400757'	263 17 0 00 000000 		POPJ	P,			;RETURN
   943
   944
   945					; Move structure blocks from the old S/L to the new S/L
   946					;
   947	400760'	336 00 0 00 000001 	MOVSTR:	SKIPN	T1			;ANYTHING TO MOVE?
   948	400761'	263 17 0 00 000000 		POPJ	P,			;NO
   949	400762'	205 02 0 05 000000 		MOVSI	T2,(P1)			;GET OLD S/L ADDRESS
   950	400763'	541 02 0 06 000000 		HRRI	T2,(P2)			;GET NEW S/L ADDRESS
   951	400764'	201 03 0 06 000000 		MOVEI	T3,(P2)			;GET CURRENT POSITION
   952	400765'	271 03 0 01 000000 		ADDI	T3,(T1)			;PLUS THE NUMBER OF WORDS TO MOVE
   953	400766'	251 02 0 03 777777 		BLT	T2,-1(T3)		;COPY PART OF THE S/L
   954	400767'	271 05 0 01 000000 		ADDI	P1,(T1)			;INCREMENT OLD S/L POINTER
   955	400770'	271 06 0 01 000000 		ADDI	P2,(T1)			;INCREMENT NEW S/L POINTER
   956	400771'	263 17 0 00 000000 		POPJ	P,			;RETURN
   957
   958
   959					; Finish copying structures from the old S/L to the new S/L
   960					;
   961	400772'	561 01 0 00 777777 	FINSTR:	MOVX	T1,-1			;FENCE
   962	400773'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT
   963	400774'	263 17 0 00 000000 		  POPJ	P,			;CAN'T HAPPEN
   964	400775'	316 02 0 00 000005 		CAMN	T2,P1			;ALREADY POINTING AT IT?
   965	400776'	271 02 0 00 000001 		ADDI	T2,1			;YES
   966	400777'	275 02 0 05 000000 		SUBI	T2,(P1)			;GET OFFSET TO END OF OLD S/L
   967	401000'	271 02 0 06 000000 		ADDI	T2,(P2)			;COMPUTE FINAL BLT ADDRESS
   968	401001'	205 01 0 05 000000 		MOVSI	T1,(P1)			;GET OLD S/L ADDRESS
   969	401002'	541 01 0 06 000000 		HRRI	T1,(P2)			;GET NEW S/L ADDRESS
   970	401003'	251 01 0 02 000000 		BLT	T1,(T2)			;COPY REMANINDER IF S/L
   971	401004'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 29
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Delete a structure

   972					SUBTTL	Search list routines -- Delete a structure
   973
   974
   975	401005'	561 01 0 00 777777 	DELJSL:	MOVX	T1,-1			;GET END OF S/L INDICATOR
   976	401006'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT
   977	401007'	263 17 0 00 000000 		  POPJ	P,			;CAN'T HAPPEN
   978	401010'	201 05 0 02 000000#		MOVEI	P1,-OLDSL(T2)		;GET LENGTH IN WORDS
   979	401011'	200 01 0 00 402414'		MOVE	T1,[OLDSL,,NEWSL]	;SET UP BLT
   980	401012'	251 01 0 05 001463'		BLT	T1,NEWSL(P1)		;COPY S/L
   981	401013'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STR TO REMOVE
   982	401014'	260 17 0 00 400632'		PUSHJ	P,FINDNS		;FIND IT IN THE NEW SEARCH LIST
   983	401015'	263 17 0 00 000000 		  POPJ	P,			;CAN'T - SAY WE DID IT
   984	401016'	275 02 0 00 001463'		SUBI	T2,NEWSL		;GET OFFSET
   985	401017'	205 01 0 02 001420'		MOVSI	T1,OLDSL+.DFJBL(T2)	;GET ADDRESS BEYOND STR BLOCK
   986	401020'	541 01 0 02 001463'		HRRI	T1,NEWSL(T2)		;POINT TO STR BLOCK IN NEW S/L
   987	401021'	251 01 0 05 001460'		BLT	T1,NEWSL-.DFJBL(P1)	;SLIDE S/L UP BY ONE STR BLOCK
   988	401022'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 30
UFDSET	MAC	24-Sep-72 02:32		Search list routines -- Define a S/L

   989					SUBTTL	Search list routines -- Define a S/L
   990
   991
   992	401023'	201 01 0 00 000001 	DEFJSL:	MOVX	T1,DF.SRM		;GET A BIT
   993	401024'	202 01 0 00 001466'		MOVEM	T1,NEWSL+.FSDFL		;REMOVE STRS NOT IN NEW S/L
   994	401025'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET PPN INCASE WE GENERATED ONE
   995	401026'	202 01 0 00 001465'		MOVEM	T1,NEWSL+.FSDPP		;UPDATE IT
   996	401027'	561 01 0 00 777777 		MOVX	T1,-1			;GET END OF LIST
   997	401030'	260 17 0 00 400632'		PUSHJ	P,FINDNS		;FIND IT
   998	401031'	260 17 0 00 402225'		  $ERR	(CCS)			;CAN'T HAPPEN, BUT...
   999	401032'	300 00 0 00 000012 
  1000	401033'	205 01 0 02 000000#		MOVSI	T1,-NEWSL(T2)		;GET LENGTH
  1001	401034'	541 01 0 00 001463'		HRRI	T1,NEWSL		;GET ADDRESS
  1002	401035'	047 01 0 00 000050 		STRUUO	T1,			;DEFINE A NEW SEARCH LIST
  1003	401036'	260 17 0 00 402225'		  $ERR	(CCS)			;? CAN'T ADD STR TO SEARCH LIST
  1004	401037'	300 00 0 00 000012 
  1005	401040'	135 01 0 00 402321'		LDB	T1,[POINTR (.UFFLG(AP),UF.FNC)] ;GET FUNCTION CODE
  1006	401041'	332 00 0 16 000003 		SKIPE	.UFJOB(AP)		;SCREWING AROUND WITH THE SSL?
  1007	401042'	306 01 0 00 000002 		CAIN	T1,.UFDMO		;DISMOUNT?
  1008	401043'	263 17 0 00 000000 		POPJ	P,			;YES - THEN NOTHING ELSE TO DO
  1009	401044'	200 01 0 00 402322'		MOVE	T1,[.DCMAX,,DCHBLK]	;SET UP UUO
  1010	401045'	047 01 0 00 000045 		DSKCHR	T1,			;GET UPDATED DISK CHARACTERISTICS
  1011	401046'	263 17 0 00 000000 		  POPJ	P,			;STRANGE
  1012	401047'	550 01 0 00 000554'		HRRZ	T1,DCHBLK+.DCSAJ	;GET JOB # THAT MIGHT HAVE STR MOUNTED
  1013	401050'	312 01 0 16 000003 		CAME	T1,.UFJOB(AP)		;IS IT THE JOB WE'RE DOING THINGS FOR?
  1014	401051'	263 17 0 00 000000 		POPJ	P,			;NO - CAN'T CHANGE STATUS
  1015	401052'	201 01 0 00 000003 		MOVEI	T1,.FSRDF		;GET FUNCTION CODE
  1016	401053'	202 01 0 00 001463'		MOVEM	T1,NEWSL+.FSFCN		;SAVE IT
  1017	401054'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STRUCTURE NAME
  1018	401055'	202 01 0 00 001466'		MOVEM	T1,NEWSL+.FSRNM		;SAVE IT
  1019	401056'	205 01 0 00 004000 		MOVX	T1,UF.SIN		;GET SINGLE ACCESS BIT
  1020	401057'	616 01 0 16 000000 		TDNN	T1,.UFFLG(AP)		;WHAT KIND OF ACCESS DO WE WANT?
  1021	401060'	634 01 0 00 000001 		TDZA	T1,T1			;MULTI ACCESS
  1022	401061'	205 01 0 00 200000 		MOVX	T1,FS.RSA		;SINGLE ACCESS
  1023	401062'	202 01 0 00 001467'		MOVEM	T1,NEWSL+.FSRST		;SAVE THE CODE
  1024	401063'	200 01 0 00 402415'		MOVE	T1,[.FSRST+1,,NEWSL]	;SET UP AC
  1025	401064'	047 01 0 00 000050 		STRUUO	T1,			;MAKE STR SINGLE ACCESS
  1026	401065'	334 01 0 00 402416'		  SKIPA	T1,[DF.SRM]		;CAN'T - WE'RE IN TROUBLE NOW
  1027	401066'	263 17 0 00 000000 		POPJ	P,			;DONE
  1028	401067'	202 01 0 00 001420'		MOVEM	T1,OLDSL+.FSDFL		;YES - REMOVE STR FROM S/L
  1029	401070'	561 01 0 00 777777 		MOVX	T1,-1			;FENCE
  1030	401071'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;FIND IT IN THE OLD S/L
  1031	401072'	260 17 0 00 402225'		  $ERR	(CSO)			;CAN'T HAPPEN, BUT...
  1032	401073'	300 00 0 00 000013 
  1033	401074'	205 01 0 02 000000#		MOVSI	T1,-OLDSL(T2)		;GET LENGTH
  1034	401075'	541 01 0 00 001415'		HRRI	T1,OLDSL		;GET ADDRESS
  1035	401076'	047 01 0 00 000050 		STRUUO	T1,			;TRY TO RESET THE ORIGINAL S/L
  1036	401077'	260 17 0 00 402225'		  $ERR	(CSO)			;? CANNOT RESET ORIGINAL SEARCH LIST
  1037	401100'	300 00 0 00 000013 
  1038	401101'	260 17 0 00 402225'		$ERR	(CSS)			;? CANNOT CHANGE STRUCTURE STATUS
  1039	401102'	300 00 0 00 000014 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 31
UFDSET	MAC	24-Sep-72 02:32		Set up file FILOP, LOOKUP, and PATH block

  1040					SUBTTL	Set up file FILOP, LOOKUP, and PATH block
  1041
  1042
  1043	401103'	200 01 0 00 402332'	SETFIL:	MOVX	T1,FO.PRV!FO.ASC+.FORED	;USE PRIVS/ASSIGN CHANNEL/READ
  1044	401104'	202 01 0 00 001000'		MOVEM	T1,FOPFIL+.FOFNC	;STORE IT
  1045	401105'	200 01 0 00 402417'		MOVX	T1,UU.PHS+.IODMP	;PHYSICAL ONLY/DUMP MODE
  1046	401106'	202 01 0 00 001001'		MOVEM	T1,FOPFIL+.FOIOS	;STORE IT
  1047	401107'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STRUCTURE NAME
  1048	401110'	202 01 0 00 001002'		MOVEM	T1,FOPFIL+.FODEV	;STORE IT
  1049	401111'	402 00 0 00 001003'		SETZM	FOPFIL+.FOBRH		;NO BUFFER RING HEADERS
  1050	401112'	402 00 0 00 001004'		SETZM	FOPFIL+.FONBF		;THEREFORE, NO BUFFERS
  1051	401113'	402 00 0 00 001006'		SETZM	FOPFIL+.FOPAT		;NO NEED FOR A PATH BLOCK
  1052	401114'	402 00 0 00 001007'		SETZM	FOPFIL+.FOPPN		;CLEAR IN-YOUR-BEHALF PPN
  1053	401115'	201 01 0 00 001011'		MOVEI	T1,LKPFIL		;GET ADDRESS OF LOOKUP BLOCK
  1054	401116'	202 01 0 00 001005'		MOVEM	T1,FOPFIL+.FOLEB	;STORE IT
  1055	401117'	201 01 0 00 000050 		MOVEI	T1,RIBSIZ		;GET LOOKUP BLOCK LENGTH
  1056	401120'	202 01 0 00 001011'		MOVEM	T1,LKPFIL+.RBCNT	;STORE IT
  1057	401121'	201 01 0 00 001062'		MOVEI	T1,PTHFIL		;GET ADDRESS OF PATH BLOCK
  1058	401122'	202 01 0 00 001012'		MOVEM	T1,LKPFIL+.RBPPN	;PUT IN THE LOOKUP BLOCK TOO
  1059	401123'	402 00 0 00 001015'		SETZM	LKPFIL+.RBPRV		;CLEAR A WORD
  1060	401124'	200 01 0 00 402420'		MOVE	T1,[LKPFIL+.RBPRV,,LKPFIL+.RBPRV+1] ;SET UP BLT
  1061	401125'	251 01 0 00 001060'		BLT	T1,LKPFIL+RIBSIZ-1	;CLEAR REMAINDER OF BLOCK
  1062	401126'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 32
UFDSET	MAC	24-Sep-72 02:32		Set up file FILOP, LOOKUP, and PATH block for a UFD

  1063					SUBTTL	Set up file FILOP, LOOKUP, and PATH block for a UFD
  1064
  1065
  1066	401127'	260 17 0 00 401103'	SETUFD:	PUSHJ	P,SETFIL		;SET UP THE FILE BLOCKS
  1067	401130'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET FILE NAME (PPN)
  1068	401131'	202 01 0 00 001013'		MOVEM	T1,LKPFIL+.RBNAM	;STORE IT
  1069	401132'	515 01 0 00 654644 		HRLZI	T1,'UFD'		;GET EXTENSION (UFD)
  1070	401133'	202 01 0 00 001014'		MOVEM	T1,LKPFIL+.RBEXT	;STORE IT
  1071	401134'	200 01 0 00 000020'		MOVE	T1,MFDPPN		;GET MFD PPN
  1072	401135'	202 01 0 00 001064'		MOVEM	T1,PTHFIL+.PTPPN	;STORE IT
  1073	401136'	402 00 0 00 001065'		SETZM	PTHFIL+.PTSFD		;TERMINATE PATH
  1074	401137'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 33
UFDSET	MAC	24-Sep-72 02:32		Set up block pointers

  1075					SUBTTL	Set up block pointers
  1076
  1077
  1078	401140'	200 05 0 00 000011 	SETPTR:	MOVE	P1,L			;GET LEVEL
  1079	401141'	221 05 0 00 000011 		IMULI	P1,FOPSIZ		;INDEX INTO FOPBLK
  1080	401142'	200 06 0 00 000011 		MOVE	P2,L			;GET LEVEL
  1081	401143'	221 06 0 00 000050 		IMULI	P2,RIBSIZ		;INDEX INTO LKPBLK
  1082	401144'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 34
UFDSET	MAC	24-Sep-72 02:32		Set up a directory FILOP, LOOKUP, and PATH blocks

  1083					SUBTTL	Set up a directory FILOP, LOOKUP, and PATH blocks
  1084
  1085
  1086	401145'	260 17 0 00 401140'	SETBLK:	PUSHJ	P,SETPTR		;SET UP THE POINTERS
  1087	401146'	200 01 0 00 402332'		MOVX	T1,FO.PRV!FO.ASC+.FORED	;USE PRIVS/ASSIGN CHANNEL/READ
  1088	401147'	202 01 0 05 000040'		MOVEM	T1,FOPBLK+.FOFNC(P1)	;STORE IT
  1089	401150'	200 01 0 00 402417'		MOVX	T1,UU.PHS+.IODMP	;PHYSICAL ONLY/DUMP MODE
  1090	401151'	202 01 0 05 000041'		MOVEM	T1,FOPBLK+.FOIOS(P1)	;STORE IT
  1091	401152'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;GET STRUCTURE NAME
  1092	401153'	202 01 0 05 000042'		MOVEM	T1,FOPBLK+.FODEV(P1)	;STORE IT
  1093	401154'	402 00 0 05 000043'		SETZM	FOPBLK+.FOBRH(P1)	;NO BUFFER RING HEADERS
  1094	401155'	402 00 0 05 000044'		SETZM	FOPBLK+.FONBF(P1)	;THEREFORE, NO BUFFERS
  1095	401156'	402 00 0 05 000046'		SETZM	FOPBLK+.FOPAT(P1)	;NO NEED FOR A PATH BLOCK
  1096	401157'	402 00 0 05 000047'		SETZM	FOPBLK+.FOPPN(P1)	;CLEAR IN-YOUR-BEHALF PPN
  1097
  1098	401160'	201 01 0 00 000050 		MOVEI	T1,RIBSIZ		;GET LENGTH OF LOOKUP BLOCK
  1099	401161'	202 01 0 06 000126'		MOVEM	T1,LKPBLK+.RBCNT(P2)	;STORE IT
  1100	401162'	201 01 0 06 000126'		MOVEI	T1,LKPBLK(P2)		;GET ADDRESS OF LOOKUP BLOCK
  1101	401163'	202 01 0 05 000045'		MOVEM	T1,FOPBLK+.FOLEB(P1)	;STORE IT
  1102
  1103	401164'	201 01 0 00 000530'		MOVEI	T1,PTHBLK		;GET ADDRESS OF PATH BLOCK
  1104	401165'	202 01 0 06 000127'		MOVEM	T1,LKPBLK+.RBPPN(P2)	;STORE IN LOOKUP BLOCK
  1105	401166'	200 01 0 00 000020'		MOVE	T1,MFDPPN		;GET THE MFD PPN
  1106	401167'	332 00 0 00 000011 		SKIPE	L			;TOP LEVEL?
  1107	401170'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;NO - GET THE UFD PPN
  1108	401171'	202 01 0 00 000532'		MOVEM	T1,PTHBLK+.PTPPN	;SET UP A PPN
  1109	401172'	515 01 0 00 654644 		HRLZI	T1,'UFD'		;GET THE UFD EXTENSION
  1110	401173'	332 00 0 00 000011 		SKIPE	L			;TOP LEVEL?
  1111	401174'	515 01 0 00 634644 		HRLZI	T1,'SFD'		;NO - GET A DIFFERENT EXTENSION
  1112	401175'	202 01 0 06 000131'		MOVEM	T1,LKPBLK+.RBEXT(P2)	;STORE IT
  1113	401176'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 35
UFDSET	MAC	24-Sep-72 02:32		Create a UFD

  1114					SUBTTL	Create a UFD
  1115
  1116
  1117	401177'	205 01 0 00 000200 	CREUFD:	MOVX	T1,UF.WLD		;GET WILD PROGRAMMER NUMBER FLAG
  1118	401200'	612 01 0 16 000000 		TDNE	T1,.UFFLG(AP)		;WANT US TO GENERATE A PPN?
  1119
  1120	401201'	260 17 0 00 401257'	CREU.0:	PUSHJ	P,CREPRG		;YES
  1121	401202'	260 17 0 00 401127'		PUSHJ	P,SETUFD		;SET UP FOR UFD LOOKUP
  1122	401203'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP UUO
  1123	401204'	047 01 0 00 000155 		FILOP.	T1,			;TRY TO LOOKUP THE UFD
  1124	401205'	254 00 0 00 401213'		  JRST	CREU.1			;CAN'T
  1125	401206'	205 01 0 00 000200 		MOVX	T1,UF.WLD		;GET WILD PROGRAMMER NUMBER FLAG
  1126	401207'	616 01 0 16 000000 		TDNN	T1,.UFFLG(AP)		;WANT US TO GENERATE A PPN?
  1127	401210'	324 17 0 00 401301'		PJRST	REDU.1			;NO - GO READ UFD QUOTAS, ETC.
  1128	401211'	260 17 0 00 401444'		PUSHJ	P,RELUFD		;CLOSE THE CHANNEL
  1129	401212'	254 00 0 00 401201'		JRST	CREU.0			;AND TRY AGAIN
  1130
  1131	401213'	261 17 0 00 000001 	CREU.1:	PUSH	P,T1			;SAVE T1
  1132	401214'	260 17 0 00 401444'		PUSHJ	P,RELUFD		;CLOSE OF CHANNEL
  1133	401215'	262 17 0 00 000001 		POP	P,T1			;GET ERROR CODE BACK
  1134	401216'	302 01 0 00 000000 		CAIE	T1,ERFNF%		;FILE NOT FOUND?
  1135	401217'	260 17 0 00 402225'		  $ERR	(LFU)			;LOOKUP FAILED FOR UFD
  1136	401220'	300 00 0 00 000005 
  1137	401221'	400 01 0 00 000000 		SETZ	T1,			;CLEAR AN AC
  1138	401222'	331 00 0 16 000006 		SKIPL	.UFQTF(AP)		;WANT TO SET LOGGED IN QUOTA?
  1139	401223'	434 01 0 16 000006 		IOR	T1,.UFQTF(AP)		;YES
  1140	401224'	331 00 0 16 000007 		SKIPL	.UFQTO(AP)		;WANT TO SET LOGGED OUT QUOTA?
  1141	401225'	434 01 0 16 000007 		IOR	T1,.UFQTO(AP)		;YES
  1142	401226'	331 00 0 16 000010 		SKIPL	.UFQTR(AP)		;WANT TO SET RESERVED QUOTA?
  1143	401227'	434 01 0 16 000010 		IOR	T1,.UFQTR(AP)		;YES
  1144	401230'	326 01 0 00 401236'		JUMPN	T1,CREU.2		;IF SETTING QUOTAS, THEN CREATE A UFD
  1145	401231'	205 01 0 00 000400 		MOVX	T1,UF.NUE		;GET NO UFD EXISTS BIT
  1146	401232'	436 01 0 16 000000 		IORM	T1,.UFFLG(AP)		;SAVE FOR CURIOUS PROGRAMS
  1147	401233'	200 01 0 00 402421'		MOVE	T1,["%",,'NUC']		;GET SEVERITY CHARACTER AND PREFIX
  1148	401234'	201 02 0 00 402422'		MOVEI	T2,[ASCIZ |No UFD created on @A|]
  1149	401235'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1150
  1151	401236'	260 17 0 00 401127'	CREU.2:	PUSHJ	P,SETUFD		;SET UP FOR UFD ENTER
  1152	401237'	201 01 0 00 000003 		MOVEI	T1,.FOWRT		;GET WRITE FUNCTION CODE
  1153	401240'	542 01 0 00 001000'		HRRM	T1,FOPFIL+.FOFNC	;STORE IT
  1154	401241'	201 01 0 00 400000 		MOVX	T1,RP.DIR		;GET DIRECTORY BIT
  1155	401242'	202 01 0 00 001030'		MOVEM	T1,LKPFIL+.RBSTS	;SAVE FILE STATUS BITS
  1156	401243'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP UUO
  1157	401244'	047 01 0 00 000155 		FILOP.	T1,			;TRY TO LOOKUP THE UFD
  1158	401245'	260 17 0 00 402225'		  $ERR	(EFU)			;?ENTER FAILED FOR UFD
  1159	401246'	300 00 0 00 000011 
  1160	401247'	201 01 0 00 000012 		MOVEI	T1,.FOUSO		;USETO FUNCTION
  1161	401250'	542 01 0 00 001000'		HRRM	T1,FOPFIL+.FOFNC	;SAVE IT
  1162	401251'	201 01 0 00 000002 		MOVEI	T1,2			;2 BLOCKS
  1163	401252'	202 01 0 00 001001'		MOVEM	T1,FOPFIL+.FOIOS	;ALLOCATE THIS MUCH
  1164	401253'	200 01 0 00 402427'		MOVE	T1,[2,,FOPFIL]		;SET UP UUO
  1165	401254'	047 01 0 00 000155 		FILOP.	T1,			;ALLOCATE SOME BLOCK
  1166	401255'	255 00 0 00 000000 		  JFCL				;IGNORE ERRORS
  1167	401256'	324 17 0 00 401444'		PJRST	RELUFD			;RELEASE CHANNEL AND RETURN
  1168
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 35-1
UFDSET	MAC	24-Sep-72 02:32		Create a UFD

  1169
  1170					; Here to create a unique programmer number if necessary
  1171					;
  1172	401257'	550 01 0 16 000002 	CREPRG:	HRRZ	T1,.UFPPN(AP)		;GET PROGRAMMER NUMBER
  1173	401260'	326 01 0 00 401264'		JUMPN	T1,CREP.1		;FIRST TIME THROUGH?
  1174	401261'	047 01 0 00 000023 		MSTIME	T1,			;GET TIME IN MILLISECONDS
  1175	401262'	620 01 0 00 700000 		TRZ	T1,7B20			;CLEAR A DIGIT
  1176	401263'	664 01 0 00 400000 		TROA	T1,1B18			;SET FIRST DIGIT TO 4
  1177
  1178	401264'	271 01 0 00 000001 	CREP.1:	ADDI	T1,1			;CHANGE IT
  1179	401265'	542 01 0 16 000002 		HRRM	T1,.UFPPN(AP)		;SAVE NEW PROGRAMMER NUMBER
  1180	401266'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET FULL PPN
  1181	401267'	047 01 0 00 000074 		CHGPPN	T1,			;CHANGE TO THE NEW PPN
  1182	401270'	260 17 0 00 402225'		  $ERR	(PGF)			;? PROGRAMMER GENERATION FAILED
  1183	401271'	300 00 0 00 000020 
  1184	401272'	047 01 0 00 000024 		GETPPN	T1,			;OTHER USERS LOGGED IN WITH NEW PPN?
  1185	401273'	263 17 0 00 000000 		  POPJ	P,			;NO - RETURN
  1186	401274'	254 00 0 00 401264'		JRST	CREP.1			;TRY A DIFFERENT PROGRAMMER NUMBER
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 36
UFDSET	MAC	24-Sep-72 02:32		Read a UFD

  1187					SUBTTL	Read a UFD
  1188
  1189
  1190	401275'	260 17 0 00 401127'	REDUFD:	PUSHJ	P,SETUFD		;SET UP FOR UFD LOOKUP
  1191	401276'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP UUO
  1192	401277'	047 01 0 00 000155 		FILOP.	T1,			;TRY TO LOOKUP THE UFD
  1193	401300'	254 00 0 00 401316'		  JRST	REDU.2			;CAN'T
  1194
  1195	401301'	335 01 0 16 000006 	REDU.1:	SKIPGE	T1,.UFQTF(AP)		;DEFAULTING FCFS?
  1196	401302'	200 01 0 00 001033'		MOVE	T1,LKPFIL+.RBQTF	;GET FCFS QUOTA FROM RIB
  1197	401303'	202 01 0 16 000006 		MOVEM	T1,.UFQTF(AP)		;SAVE IT
  1198	401304'	335 01 0 16 000007 		SKIPGE	T1,.UFQTO(AP)		;DEFAULTING LOGGED-OUT QUOTA?
  1199	401305'	200 01 0 00 001034'		MOVE	T1,LKPFIL+.RBQTO	;GET LOGGED-OUT QUOTA FROM RIB
  1200	401306'	202 01 0 16 000007 		MOVEM	T1,.UFQTO(AP)		;SAVE IT
  1201	401307'	335 01 0 16 000010 		SKIPGE	T1,.UFQTR(AP)		;DEFAULTING RESERVED QUOTA?
  1202	401310'	200 01 0 00 001035'		MOVE	T1,LKPFIL+.RBQTR	;GET RESERVED QUOTA FROM RIB
  1203	401311'	202 01 0 16 000010 		MOVEM	T1,.UFQTR(AP)		;SAVE IT
  1204	401312'	200 01 0 00 001036'		MOVE	T1,LKPFIL+.RBUSD	;GET BLOCKS USED FROM RIB
  1205	401313'	202 01 0 16 000012 		MOVEM	T1,.UFUSD(AP)		;SAVE IT
  1206	401314'	260 17 0 00 401532'		PUSHJ	P,GETDTM		;EXTRACT UFD CREATION DATE/TIME
  1207	401315'	324 17 0 00 401444'		PJRST	RELUFD			;RELEASE CHANNEL AND RETURN
  1208
  1209	401316'	205 02 0 00 000400 	REDU.2:	MOVX	T2,UF.NUE		;GET NO UFD EXISTS BIT
  1210	401317'	436 02 0 16 000000 		IORM	T2,.UFFLG(AP)		;SET IT
  1211	401320'	306 01 0 00 000000 		CAIN	T1,ERFNF%		;FILE NOT FOUND?
  1212	401321'	324 17 0 00 401444'		PJRST	RELUFD			;THATS OK
  1213	401322'	260 17 0 00 402225'		$ERR	(LFU)			;LOOKUP FAILED FOR UFD
  1214	401323'	300 00 0 00 000005 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 37
UFDSET	MAC	24-Sep-72 02:32		Rename the UFD

  1215					SUBTTL	Rename the UFD
  1216
  1217
  1218	401324'	205 01 0 00 000400 	RENUFD:	MOVX	T1,UF.NUE		;GET THE NO FD CREATED BIT
  1219	401325'	612 01 0 16 000000 		TDNE	T1,.UFFLG(AP)		;DID WE SET IT?
  1220	401326'	263 17 0 00 000000 		POPJ	P,			;YES - THEN CAN'T RENAME THE UFD
  1221	401327'	260 17 0 00 401127'		PUSHJ	P,SETUFD		;SET UP BLOCKS FOR UFD
  1222	401330'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP AC
  1223	401331'	047 01 0 00 000155 		FILOP.	T1,			;LOOKUP FILE
  1224	401332'	260 17 0 00 402225'		  $ERR	(LFU)			;?LOOKUP FAILED FOR UFD
  1225	401333'	300 00 0 00 000005 
  1226	401334'	201 01 0 00 000013 		MOVEI	T1,.FORNM		;GET REMANE FUNCTION
  1227	401335'	542 01 0 00 001000'		HRRM	T1,FOPFIL+.FOFNC	;STORE IT
  1228	401336'	200 01 0 00 402430'		MOVE	T1,[LKPFIL,,LKPBLK]	;SET UP BLT
  1229	401337'	251 01 0 00 000175'		BLT	T1,LKPBLK+RIBSIZ-1	;COPY THE ENTIRE RIB
  1230	401340'	200 01 0 00 402431'		MOVE	T1,[PTHFIL,,PTHBLK]	;SET UP BLT
  1231	401341'	251 01 0 00 000540'		BLT	T1,PTHBLK+PTHSIZ-1	;COPY THE ENTIRE PATH
  1232
  1233	401342'	201 01 0 00 000126'	RENU.1:	MOVEI	T1,LKPBLK		;GET ADDRESS OF RENAME BLOCK
  1234	401343'	506 01 0 00 001005'		HRLM	T1,FOPFIL+.FOLEB	;STORE IT
  1235	401344'	201 01 0 00 001062'		MOVEI	T1,PTHFIL		;GET ADDRESS OF PATH BLOCK
  1236	401345'	202 01 0 00 000127'		MOVEM	T1,LKPBLK+.RBPPN	;STORE IT
  1237
  1238	401346'	331 01 0 16 000004 		SKIPL	T1,.UFPRO(AP)		;GET PROTECTION CODE TO SET
  1239	401347'	137 01 0 00 402432'		DPB	T1,[POINTR (LKPBLK+.RBPRV,RB.PRV)] ;STORE IT
  1240	401350'	331 01 0 16 000006 		SKIPL	T1,.UFQTF(AP)		;GET LOGGED-IN QUOTA
  1241	401351'	202 01 0 00 000150'		MOVEM	T1,LKPBLK+.RBQTF	;STORE IT
  1242	401352'	331 01 0 16 000007 		SKIPL	T1,.UFQTO(AP)		;GET LOGGED IN QUOTA
  1243	401353'	202 01 0 00 000151'		MOVEM	T1,LKPBLK+.RBQTO	;STORE IT
  1244	401354'	331 01 0 16 000010 		SKIPL	T1,.UFQTR(AP)		;GET RESERVED QUOTA
  1245	401355'	202 01 0 00 000152'		MOVEM	T1,LKPBLK+.RBQTR	;STORE IT
  1246	401356'	200 01 0 16 000012 		MOVE	T1,.UFUSD(AP)		;GET BLOCKS USED
  1247	401357'	202 01 0 00 000153'		MOVEM	T1,LKPBLK+.RBUSD	;STORE IT
  1248	401360'	331 01 0 16 000005 		SKIPL	T1,.UFDED(AP)		;GET DIRECTORY EXPIRATION DATE
  1249	401361'	202 01 0 00 000165'		MOVEM	T1,LKPBLK+.RBDED	;STORE IT
  1250	401362'	200 01 0 00 000145'		MOVE	T1,LKPBLK+.RBSTS	;GET STATUS WORD
  1251	401363'	606 01 0 00 200000 		TXNN	T1,RP.NDL		;NO-DELETE TURNED ON?
  1252	401364'	254 00 0 00 401370'		JRST	RENU.2			;NO
  1253	401365'	205 02 0 00 000100 		MOVX	T2,UF.NDL		;GET THE NDL BIT
  1254	401366'	436 02 0 16 000000 		IORM	T2,.UFFLG(AP)		;SET IT SO THE CALLER KNOWS THIS
  1255	401367'	324 17 0 00 401444'		PJRST	RELUFD			;AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 38
UFDSET	MAC	24-Sep-72 02:32		Rename the UFD

  1256	401370'	200 02 0 16 000000 	RENU.2:	MOVE	T2,.UFFLG(AP)		;GET FLAG WORD
  1257	401371'	135 03 0 00 402433'		LDB	T3,[POINTR (T2,UF.FNC)]	;GET FUNCTION CODE
  1258	401372'	306 03 0 00 000001 		CAIN	T3,.UFMNT		;MOUNT?
  1259	401373'	205 02 0 00 400000 		MOVX	T2,UF.LGI		;SET RIPLOG
  1260	401374'	306 03 0 00 000002 		CAIN	T3,.UFDMO		;DISMOUNT?
  1261	401375'	205 02 0 00 200000 		MOVX	T2,UF.LGO		;CLEAR RIPLOG
  1262	401376'	603 02 0 00 400000 		TXNE	T2,UF.LGI		;LOGGING IN?
  1263	401377'	661 01 0 00 400000 		TXO	T1,RP.LOG		;YES
  1264	401400'	603 02 0 00 200000 		TXNE	T2,UF.LGO		;LOGGIN OUT?
  1265	401401'	621 01 0 00 400000 		TXZ	T1,RP.LOG		;YES
  1266	401402'	335 00 0 00 000027'		SKIPGE	RIBERR			;FIND ANY FILES WITH ERROR BITS ON?
  1267	401403'	630 01 0 00 402434'		TDZ	T1,[RP.ERR,,RP.ERR]	;NO - CLEAR ERRORS
  1268	401404'	202 01 0 00 000145'		MOVEM	T1,LKPBLK+.RBSTS	;STORE UPDATED STATUS BITS
  1269	401405'	607 01 0 00 000715 		TLNN	T1,RP.ERR		;ANY FILE ERRORS IN THIS UFD?
  1270	401406'	254 00 0 00 401412'		JRST	RENU.3			;NOPE
  1271	401407'	200 01 0 00 402435'		MOVE	T1,["%",,'FEE']		;GET SEVERITY CHARACTER AND PREFIX
  1272	401410'	201 02 0 00 402436'		MOVEI	T2,[ASCIZ |@A file errors exist|]
  1273	401411'	260 17 0 00 401770'		PUSHJ	P,TEXT			;GENERATE TEXT
  1274
  1275	401412'	260 17 0 00 401542'	RENU.3:	PUSHJ	P,PUTDTM		;SET UFD CREATION DATE/TIME
  1276	401413'	302 03 0 00 000002 		CAIE	T3,.UFDMO		;DISMOUNTING?
  1277	401414'	254 00 0 00 401433'		JRST	RENU.4			;NOPE
  1278	401415'	200 01 0 00 402443'		MOVE	T1,[.DUFRE,,T2]		;SET UP UUO
  1279	401416'	200 02 0 16 000001 		MOVE	T2,.UFSTR(AP)		;GET STR NAME
  1280	401417'	200 03 0 16 000002 		MOVE	T3,.UFPPN(AP)		;GET PPN
  1281	401420'	200 04 0 00 001033'		MOVE	T4,LKPFIL+.RBQTF	;GET LOGGED IN QUOTA
  1282	401421'	270 04 0 00 001035'		ADD	T4,LKPFIL+.RBQTR	;INCLUDE THE RESERVED QUOTA TOO
  1283	401422'	274 04 0 00 001036'		SUB	T4,LKPFIL+.RBUSD	;COMPUTE BLOCKS FREE IF LOGGED OUT PPN
  1284	401423'	047 01 0 00 000121 		DISK.	T1,			;RETURN FREE SPACE IN THE UFD
  1285	401424'	334 00 0 00 000000 		  SKIPA				;CAN'T
  1286	401425'	316 01 0 00 402444'		CAMN	T1,[1B0]		;LOGGED IN PPN?
  1287	401426'	200 01 0 00 000004 		MOVE	T1,T4			;NO--USE ASSUMED VALUE
  1288	401427'	312 01 0 00 001033'		CAME	T1,LKPFIL+.RBQTF	;REMAING = FCFS QUOTA?
  1289	401430'	254 00 0 00 401433'		JRST	RENU.4			;DON'T ATTEMPT DELETE IF BLOCKS USED
  1290	401431'	201 01 0 00 000014 		MOVEI	T1,.FODLT		;GET DELETE FUNCTION
  1291	401432'	542 01 0 00 001000'		HRRM	T1,FOPFIL+.FOFNC	;SET IT
  1292
  1293	401433'	336 00 0 00 000026'	RENU.4:	SKIPN	RCPFLG			;DID WE RECOMPUTE?
  1294	401434'	476 00 0 00 001036'		SETOM	LKPFIL+.RBUSD		;NO--DON'T CHANGE BLOCKS USED
  1295	401435'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP AC
  1296	401436'	047 01 0 00 000155 		FILOP.	T1,			;RENAME THE UFD
  1297	401437'	334 00 0 00 000000 		  SKIPA				;CAN'T
  1298	401440'	324 17 0 00 401444'		PJRST	RELUFD			;RELEASE THE CHANNEL AND RETURN
  1299	401441'	202 01 0 00 000777'		MOVEM	T1,FOPERR		;SAVE THE ERROR CODE
  1300	401442'	260 17 0 00 402225'		$ERR	(RFU)			;? RENAME FAILED TO UPDATE UFD
  1301	401443'	300 00 0 00 000006 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 39
UFDSET	MAC	24-Sep-72 02:32		Release a UFD channel

  1302					SUBTTL	Release a UFD channel
  1303
  1304
  1305	401444'	200 01 0 00 402330'	RELUFD:	MOVE	T1,[1,,T2]		;SET UP AC
  1306	401445'	200 02 0 00 001000'		MOVE	T2,FOPFIL+.FOFNC	;GET FUNCTION WORD
  1307	401446'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL NUMBER
  1308	401447'	541 02 0 00 000023 		HRRI	T2,.FOREL		;GET NEW FUNCTION CODE
  1309	401450'	047 01 0 00 000155 		FILOP.	T1,			;RELEASE THE CHANNEL
  1310	401451'	255 00 0 00 000000 		  JFCL				;IGNORE ERRORS
  1311	401452'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 40
UFDSET	MAC	24-Sep-72 02:32		Compress UFD

  1312					SUBTTL	Compress UFD
  1313
  1314
  1315					; Perform UFD compression
  1316					;
  1317	401453'	260 17 0 00 401103'	COMPRS:	PUSHJ	P,SETFIL		;SET UP SOME BLOCKS
  1318	401454'	201 01 0 00 000002 		MOVEI	T1,.FOCRE		;CREATE FILE (NEVER SUPERSEDE)
  1319	401455'	542 01 0 00 001000'		HRRM	T1,FOPFIL+.FOFNC	;STORE FUNCTION CODE
  1320	401456'	047 01 0 00 000023 		MSTIME	T1,			;GET TIME IN MILLISECONDS
  1321	401457'	404 01 0 00 402445'		AND	T1,[070707,,070707]	;MAKE IT NUMERIC
  1322	401460'	670 01 0 00 402446'		TDO	T1,[SIXBIT/000000/]	;TURN ON SOME BITS
  1323	401461'	202 01 0 00 001013'		MOVEM	T1,LKPFIL+.RBNAM	;STORE AS THE FILE NAME
  1324	401462'	515 01 0 00 645560 		HRLZI	T1,'TMP'		;A TEMPORARY EXTENSION
  1325	401463'	202 01 0 00 001014'		MOVEM	T1,LKPFIL+.RBEXT	;STORE IT
  1326	401464'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET THE PPN
  1327	401465'	202 01 0 00 001064'		MOVEM	T1,PTHFIL+.PTPPN	;STORE IT
  1328	401466'	402 00 0 00 001065'		SETZM	PTHFIL+.PTSFD		;TERMINATE PATH
  1329	401467'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP AC
  1330	401470'	047 01 0 00 000155 		FILOP.	T1,			;CREATE THE FILE
  1331	401471'	334 00 0 00 000000 		  SKIPA				;CAN'T
  1332	401472'	254 00 0 00 401476'		JRST	COMP.0			;ONWARD
  1333	401473'	306 01 0 00 000014 		CAIN	T1,ERNRM%		;NO ROOM?
  1334	401474'	254 00 0 00 401523'		JRST	COMP.3			;WE MUST HAVE JUST CREATED THE UFD
  1335	401475'	254 00 0 00 401511'		JRST	COMP.1			;ELSE WE HAVE A REAL ERROR
  1336
  1337	401476'	200 01 0 00 402447'	COMP.0:	MOVE	T1,[.DUUFD,,T2]		;SET UP AC
  1338	401477'	135 02 0 00 402450'		LDB	T2,[POINTR (FOPFIL+.FOFNC,FO.CHN)] ;GET CHANNEL NUMBER
  1339	401500'	047 01 0 00 000121 		DISK.	T1,			;TELL MONITOR UFD COMPRESSION WANTED
  1340	401501'	254 00 0 00 401511'		  JRST	COMP.1			;CAN'T
  1341	401502'	200 01 0 00 402330'		MOVE	T1,[1,,T2]		;SET UP AC
  1342	401503'	200 02 0 00 001000'		MOVE	T2,FOPFIL+.FOFNC	;GET FUNCTION WORD
  1343	401504'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL
  1344	401505'	541 02 0 00 000023 		HRRI	T2,.FOREL		;LOAD FUNCTION CODE
  1345	401506'	047 01 0 00 000155 		FILOP.	T1,			;RELEASE CHANNEL AND COMPRESS UFD
  1346	401507'	254 00 0 00 401511'		  JRST	COMP.1			;CAN'T
  1347	401510'	254 00 0 00 401514'		JRST	COMP.2			;FINISH UP
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 41
UFDSET	MAC	24-Sep-72 02:32		Compress UFD

  1348	401511'	200 01 0 00 402451'	COMP.1:	MOVE	T1,["%",,'CCU']		;FLAG AS WARNING
  1349	401512'	201 02 0 00 402452'		MOVEI	T2,[ASCIZ |Could not perform UFD compression on @D.UFD|]
  1350	401513'	260 17 0 00 401770'		PUSHJ	P,TEXT			;GENERATE TEXT
  1351
  1352	401514'	200 01 0 00 402463'	COMP.2:	MOVE	T1,[FO.PRV!FO.ASC+.FODLT] ;GET RENAME FUNCTION
  1353	401515'	202 01 0 00 001000'		MOVEM	T1,FOPFIL+.FOFNC	;STORE IT
  1354	401516'	201 01 0 00 001073'		MOVEI	T1,RENFIL		;POINT TO RENAME BLOCK
  1355	401517'	506 01 0 00 001005'		HRLM	T1,FOPFIL+.FOLEB	;STORE IT
  1356	401520'	200 01 0 00 402331'		MOVE	T1,[FOPSIZ,,FOPFIL]	;SET UP AC
  1357	401521'	047 01 0 00 000155 		FILOP.	T1,			;DELETE THE FILE
  1358	401522'	255 00 0 00 000000 		  JFCL
  1359
  1360	401523'	200 01 0 00 402330'	COMP.3:	MOVE	T1,[1,,T2]		;SET UP AC
  1361	401524'	200 02 0 00 001000'		MOVE	T2,FOPFIL+.FOFNC	;GET FUNCTION WORD
  1362	401525'	630 02 0 00 402326'		ANDX	T2,FO.CHN		;KEEP JUST THE CHANNEL
  1363	401526'	541 02 0 00 000023 		HRRI	T2,.FOREL		;LOAD FUNCTION CODE
  1364	401527'	047 01 0 00 000155 		FILOP.	T1,			;RELEASE CHANNEL
  1365	401530'	255 00 0 00 000000 		  JFCL				;IGNORE ERRORS
  1366	401531'	324 17 0 00 401103'		PJRST	SETFIL			;RESET FILE BLOCKS AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 42
UFDSET	MAC	24-Sep-72 02:32		UFD date/time handling

  1367					SUBTTL	UFD date/time handling
  1368
  1369
  1370					; Get the UFD creation date/time
  1371					;
  1372	401532'	135 01 0 00 402464'	GETDTM:	LDB	T1,[POINTR (LKPFIL+.RBPRV,RB.CRD)] ;GET LOW DATE
  1373	401533'	135 02 0 00 402465'		LDB	T2,[POINTR (LKPFIL+.RBPRV,RB.CRT)] ;GET TIME
  1374	401534'	135 03 0 00 402466'		LDB	T3,[POINTR (LKPFIL+.RBEXT,RB.CRX)] ;GET HIGH DATE
  1375	401535'	242 03 0 00 000014 		LSH	T3,^D12			;SHIFT IT OVER
  1376	401536'	435 01 0 03 000000 		IORI	T1,(T3)			;OR INTO RESULT
  1377	401537'	202 01 0 16 000014 		MOVEM	T1,.UFCDT(AP)		;SAVE THE DATE
  1378	401540'	202 02 0 16 000015 		MOVEM	T2,.UFCTM(AP)		;SAVE THE TIME
  1379	401541'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1380
  1381
  1382					; Store the UFD creation date/time
  1383					;
  1384	401542'	047 01 0 00 000014 	PUTDTM:	DATE	T1,			;GET DATE IN 15 BIT FORMAT
  1385	401543'	137 01 0 00 402467'		DPB	T1,[POINTR (LKPBLK+.RBPRV,RB.CRD)] ;SAVE LOW DATE
  1386	401544'	242 01 0 00 777764 		LSH	T1,-^D12		;SHIFT OFF 12 BITS
  1387	401545'	137 01 0 00 402470'		DPB	T1,[POINTR (LKPBLK+.RBEXT,RB.CRX)] ;SAVE HIGH DATE
  1388	401546'	047 01 0 00 000023 		MSTIME	T1,			;GET CURRENT TIME IN MILLISECONDS
  1389	401547'	231 01 0 00 165140 		IDIVI	T1,^D60000		;CONVERT TO MINUTES
  1390	401550'	137 01 0 00 402471'		DPB	T1,[POINTR (LKPBLK+.RBPRV,RB.CRT)] ;SAVE TIME
  1391	401551'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 43
UFDSET	MAC	24-Sep-72 02:32		Random messages

  1392					SUBTTL	Random messages
  1393
  1394
  1395	401552'	200 01 0 00 402472'	MNTMSG:	MOVE	T1,["[",,'MNT']		;GET SEVERITY CHARACTER AND PREFIX
  1396	401553'	201 02 0 00 402473'		MOVEI	T2,[ASCIZ |Structure @A mounted|]
  1397	401554'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1398
  1399
  1400	401555'	200 01 0 00 402500'	DMOMSG:	MOVE	T1,["[",,'DMO']		;GET SEVERITY CHARACTER AND PREFIX
  1401	401556'	201 02 0 00 402501'		MOVEI	T2,[ASCIZ |Structure @A dismounted|]
  1402	401557'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1403
  1404
  1405	401560'	200 01 0 00 402506'	RCPMSG:	MOVE	T1,["[",,'RDU']		;GET SEVERITY CHARACTER AND PREFIX
  1406	401561'	201 02 0 00 402507'		MOVEI	T2,[ASCIZ |Recomputing disk usage|]
  1407	401562'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1408
  1409
  1410	401563'	200 01 0 16 000000 	QTAMSG:	MOVE	T1,.UFFLG(AP)		;GET FLAG WORD
  1411	401564'	603 01 0 00 000400 		TXNE	T1,UF.NUE		;DOES A UFD EXIST?
  1412	401565'	254 00 0 00 401574'		JRST	NUSMSG			;NO UFD ON STRUCTURE
  1413	401566'	200 01 0 00 402514'		MOVE	T1,["[",,'QTA']		;GET SEVERITY CHARACTER AND PREFIX
  1414	401567'	201 02 0 00 402515'		MOVEI	T2,[ASCIZ |@A@I|]	;GET TEXT
  1415	401570'	205 03 0 00 001000 		MOVX	T3,UF.TSP		;GET A BIT
  1416	401571'	612 03 0 16 000000 		TDNE	T3,.UFFLG(AP)		;WANT BOTH STR AND PPN IN MESSAGE?
  1417	401572'	201 02 0 00 402516'		MOVEI	T2,[ASCIZ |@D@I|]	;YES
  1418	401573'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1419
  1420	401574'	200 01 0 00 402517'	NUSMSG:	MOVE	T1,["%",,'NUS']		;GET SEVERITY CHARACTER AND PREFIX
  1421	401575'	201 02 0 00 402520'		MOVEI	T2,[ASCIZ |No UFD exists on structure @A|]
  1422	401576'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1423
  1424
  1425	401577'	200 01 0 00 402526'	ASLMSG:	MOVE	T1,["[",,'ASL']		;GET SEVERITY CHARACTER AND PREFIX
  1426	401600'	201 02 0 00 402527'		MOVEI	T2,[ASCIZ |Structure @A added to the system search list|]
  1427	401601'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1428
  1429
  1430	401602'	200 01 0 00 402540'	RSLMSG:	MOVE	T1,["[",,'RSL']		;GET SEVERITY CHARACTER AND PREFIX
  1431	401603'	201 02 0 00 402541'		MOVEI	T2,[ASCIZ |Structure @A removed from the system search list|]
  1432	401604'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1433
  1434
  1435	401605'	200 01 0 00 402553'	AJLMSG:	MOVE	T1,["[",,'AJL']		;GET SEVERITY CHARACTER AND PREFIX
  1436	401606'	201 02 0 00 402554'		MOVEI	T2,[ASCIZ |Structure @A added to the search list of job @F|]
  1437	401607'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1438
  1439
  1440	401610'	200 01 0 00 402566'	RJLMSG:	MOVE	T1,["[",,'RJL']		;GET SEVERITY CHARACTER AND PREFIX
  1441	401611'	201 02 0 00 402567'		MOVEI	T2,[ASCIZ |Structure @A removed from the search list of job @F|]
  1442	401612'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 44
UFDSET	MAC	24-Sep-72 02:32		Set and clear UFD interlocks

  1443					SUBTTL	Set and clear UFD interlocks
  1444
  1445
  1446					; Set UFD interlock
  1447					;
  1448	401613'	205 01 0 00 100000 	LOKUFD:	MOVX	T1,UF.NLK		;WANT TO INTERLOCK THE UFD?
  1449	401614'	612 01 0 16 000000 		TDNE	T1,.UFFLG(AP)		;CHECK
  1450	401615'	263 17 0 00 000000 		POPJ	P,			;NOPE - CALLER SHOULD HAVE DONE IT
  1451	401616'	260 17 0 00 401636'		PUSHJ	P,ULOCK			;INTERLOCK THE UFD
  1452	401617'	254 00 0 00 401622'		  JRST	LOKU.1			;CAN'T
  1453	401620'	350 00 0 00 000024'		AOS	LOKFLG			;REMEMBER UFD INTERLOCKED
  1454	401621'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1455
  1456	401622'	200 01 0 00 402602'	LOKU.1:	MOVE	T1,["%",,'CSU']		;GET SEVERITY CHARACTER AND PREFIX
  1457	401623'	201 02 0 00 402603'		MOVEI	T2,[ASCIZ |Can't set UFD interlock for @D|]
  1458	401624'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1459
  1460
  1461					; Clear UFD interlock
  1462					;
  1463	401625'	336 00 0 00 000024'	CLRUFD:	SKIPN	LOKFLG			;HAVE THE INTERLOCK?
  1464	401626'	263 17 0 00 000000 		POPJ	P,			;NO
  1465	401627'	260 17 0 00 401645'		PUSHJ	P,UNLOCK		;RELEASE THE UFD INTERLOCK
  1466	401630'	254 00 0 00 401633'		  JRST	CLRU.1			;CAN'T
  1467	401631'	402 00 0 00 000024'		SETZM	LOKFLG			;CLEAR INTERLOCK FLAG
  1468	401632'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1469
  1470	401633'	200 01 0 00 402451'	CLRU.1:	MOVE	T1,["%",,'CCU']		;GET SEVERITY CHARACTER AND PREFIX
  1471	401634'	201 02 0 00 402612'		MOVEI	T2,[ASCIZ |Can't clear UFD interlock for @D|]
  1472	401635'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1473
  1474
  1475					; Set the UFD interlock (called only by UFDLOK and LOKUFD)
  1476					;
  1477	401636'	200 01 0 00 402621'	ULOCK:	MOVE	T1,[3,,T2]		;SET UP AC
  1478	401637'	201 02 0 00 000006 		MOVX	T2,.FSULK		;GET FUNCTION CODE
  1479	401640'	200 03 0 16 000001 		MOVE	T3,.UFSTR(AP)		;GET STRUCTURE NAME
  1480	401641'	200 04 0 16 000002 		MOVE	T4,.UFPPN(AP)		;GET PPN
  1481	401642'	047 01 0 00 000050 		STRUUO	T1,			;SET INTERLOCK
  1482	401643'	263 17 0 00 000000 		  POPJ	P,			;RETURN
  1483	401644'	254 00 0 00 400013'		JRST	CPOPJ1			;RETURN
  1484
  1485
  1486					; Clear the UFD interlock (called only by UFDCLR and CLRUFD)
  1487					;
  1488	401645'	200 01 0 00 402621'	UNLOCK:	MOVE	T1,[3,,T2]		;SET UP AC
  1489	401646'	201 02 0 00 000007 		MOVX	T2,.FSUCL		;GET FUNCTION CODE
  1490	401647'	200 03 0 16 000001 		MOVE	T3,.UFSTR(AP)		;GET STRUCTURE NAME
  1491	401650'	200 04 0 16 000002 		MOVE	T4,.UFPPN(AP)		;GET PPN
  1492	401651'	047 01 0 00 000050 		STRUUO	T1,			;CLEAR INTERLOCK
  1493	401652'	263 17 0 00 000000 		  POPJ	P,			;CAN'T
  1494	401653'	254 00 0 00 400013'		JRST	CPOPJ1			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 45
UFDSET	MAC	24-Sep-72 02:32		Recompute checking

  1495					SUBTTL	Recompute checking
  1496
  1497
  1498					; Here to see if we need to recompute disk usage.
  1499					; Call:	PUSHJ	P,RCPCHK
  1500					;	<NON-SKIP>	;RECOMPUTING NOT NECESSARY
  1501					;	<SKIP>		;NEED TO RECOMPUTE
  1502					;
  1503	401654'	200 01 0 16 000000 	RCPCHK:	MOVE	T1,.UFFLG(AP)		;GET FLAG WORD
  1504	401655'	603 01 0 00 000400 		TXNE	T1,UF.NUE		;DOES A UFD EXIST?
  1505	401656'	263 17 0 00 000000 		POPJ	P,			;THEN WE CAN'T RECOMPUTE
  1506	401657'	603 01 0 00 040000 		TXNE	T1,UF.ARD		;ALWAYS RECOMPUTE DISK USAGE?
  1507	401660'	254 00 0 00 401723'		JRST	RCPC.5			;YES
  1508	401661'	603 01 0 00 020000 		TXNE	T1,UF.NRD		;NEVER RECOMPUTE DISK USAGE?
  1509	401662'	263 17 0 00 000000 		POPJ	P,			;THATS RIGHT
  1510	401663'	603 01 0 00 000040 		TXNE	T1,UF.AIS		;STR ALREADY IN S/L?
  1511	401664'	254 00 0 00 401671'		JRST	RCPC.2			;YES
  1512
  1513	401665'	200 01 0 16 000001 	RCPC.1:	MOVE	T1,.UFSTR(AP)		;GET STR NAME
  1514	401666'	135 02 0 00 402321'		LDB	T2,[POINTR (.UFFLG(AP),UF.FNC)] ;GET FUNCTION CODE
  1515	401667'	302 02 0 00 000003 		CAIE	T2,.UFRDU		;JUST RECOMPUTING DISK USAGE?
  1516	401670'	260 17 0 00 400631'		PUSHJ	P,FINDOS		;SEE IF IT'S IN OUR SEARCH LIST ALREADY
  1517
  1518	401671'	334 01 0 00 402444'	RCPC.2:	SKIPA	T1,[RP.LOG]		;IT ISN'T - GET LOGGED IN BIT
  1519	401672'	400 01 0 00 000000 		SETZ	T1,			;SKIP RIPLOG TEST SINCE ALREADY MOUNTED
  1520	401673'	335 02 0 16 000007 		SKIPGE	T2,.UFQTO(AP)		;GET DESIRED LOGGED-OUT QUOTA
  1521	401674'	200 02 0 00 001034'		MOVE	T2,LKPFIL+.RBQTO	;IT'S DEFAULTED - USE WHAT THE RIB HAS
  1522	401675'	135 03 0 00 402321'		LDB	T3,[POINTR (.UFFLG(AP),UF.FNC)] ;GET FUNCTION CODE
  1523	401676'	306 03 0 00 000001 		CAIN	T3,.UFMNT		;TEST RIPLOG ONLY ON A MOUNT
  1524	401677'	616 01 0 00 001030'		TDNN	T1,LKPFIL+.RBSTS	;WAS LAST USE LOGGED-OUT CLEANLY?
  1525	401700'	335 01 0 00 001036'		SKIPGE	T1,LKPFIL+.RBUSD	;GET BLOCKS USED
  1526	401701'	200 01 0 00 402622'		MOVE	T1,[377777,,777777]	;GET +INFINITY TO FORCE RECOMP
  1527	401702'	317 01 0 00 000002 		CAMG	T1,T2			;USED MORE THAN LOGGED-OUT QUOTA?
  1528	401703'	263 17 0 00 000000 		POPJ	P,			;NO - THEN WE'RE OK
  1529
  1530	401704'	200 01 0 16 000001 	RCPC.3:	MOVE	T1,.UFSTR(AP)		;GET STR NAME
  1531	401705'	202 01 0 00 001533'		MOVEM	T1,GOBBLK+.DFGNM	;SAVE IT
  1532	401706'	200 01 0 16 000002 		MOVE	T1,.UFPPN(AP)		;GET THE PPN
  1533	401707'	202 01 0 00 001532'		MOVEM	T1,GOBBLK+.DFGPP	;SAVE IT
  1534	401710'	210 01 0 00 000022'		MOVN	T1,HGHJOB		;GET -NUMBER OF JOBS
  1535	401711'	517 00 0 00 000001 		HRLZS	T1			;MAKE AN AOBJN POINTER
  1536	401712'	271 01 0 00 000001 		ADDI	T1,1			;START WITH JOB 1
  1537	401713'	200 02 0 16 000003 		MOVE	T2,.UFJOB(AP)		;GET JOB NUMBER
  1538
  1539	401714'	552 01 0 00 001531'	RCPC.4:	HRRZM	T1,GOBBLK+.DFGJN	;SAVE THE JOB NUMBER
  1540	401715'	200 03 0 00 402623'		MOVE	T3,[.DFGNM+1,,GOBBLK]	;SET UP UUO
  1541	401716'	302 02 0 01 000000 		CAIE	T2,0(T1)		;WANT TO IGNORE THIS JOB?
  1542	401717'	047 03 0 00 000066 		GOBSTR	T3,			;IS THE STR IN THIS JOB'S S/L?
  1543	401720'	253 01 0 00 401714'		  AOBJN	T1,RCPC.4		;NO - ONTO THE NEXT JOB
  1544	401721'	335 00 0 00 000001 		SKIPGE	T1			;FOUND ANOTHER USER USING THE STR?
  1545	401722'	263 17 0 00 000000 		POPJ	P,			;NO
  1546
  1547	401723'	476 00 0 00 000027'	RCPC.5:	SETOM	RIBERR			;INIT ERROR BIT COUNTER
  1548	401724'	476 00 0 00 000026'		SETOM	RCPFLG			;FLAG RECOMPUTING
  1549	401725'	254 00 0 00 400013'		JRST	CPOPJ1			;RETURN AND RECOMPUTE DISK USAGE
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 46
UFDSET	MAC	24-Sep-72 02:32		Check for over quota on dismount

  1550					SUBTTL	Check for over quota on dismount
  1551
  1552
  1553	401726'	200 01 0 00 402443'	QTACHK:	MOVE	T1,[.DUFRE,,T2]		;SET UP UUO
  1554	401727'	200 02 0 16 000001 		MOVE	T2,.UFSTR(AP)		;GET STR NAME
  1555	401730'	200 03 0 16 000002 		MOVE	T3,.UFPPN(AP)		;GET PPN
  1556	401731'	047 01 0 00 000121 		DISK.	T1,			;RETURN FREE SPACE IN THE UFD
  1557	401732'	263 17 0 00 000000 		  POPJ	P,			;CAN'T - BYPASS QUOTA CHECK
  1558	401733'	316 01 0 00 402444'		CAMN	T1,[1B0]		;LOGGED IN PPN?
  1559	401734'	263 17 0 00 000000 		POPJ	P,			;NO - BYPASS QUOTA CHECK
  1560	401735'	213 00 0 00 000001 		MOVNS	T1			;MAKE IT NEGATIVE
  1561	401736'	270 01 0 16 000006 		ADD	T1,.UFQTF(AP)		;BLOCKS USED = FCFS - FREE
  1562					;	ADD	T1,.UFQTR(AP)		;INCLUDE RESERVED BLOCKS
  1563	401737'	202 01 0 16 000012 		MOVEM	T1,.UFUSD(AP)		;SAVE BLOCKS USED
  1564	401740'	274 01 0 16 000007 		SUB	T1,.UFQTO(AP)		;TAKE OFF LOGGED-OUT QUOTA
  1565	401741'	323 01 0 00 400014'		JUMPLE	T1,CPOPJ		;RETURN IF NOT OVER QUOTA
  1566
  1567	401742'	202 01 0 00 000025'	QTAC.1:	MOVEM	T1,OVRQTA		;SAVE AMOUNT WE'RE OVER QUOTA BY
  1568	401743'	200 01 0 00 402624'		MOVE	T1,["%",,'OVQ']		;GET SEVERITY CHARACTER AND PREFIX
  1569	401744'	201 02 0 00 402625'		MOVEI	T2,[ASCIZ |Over quota by @H blocks|] ;GET TEXT
  1570	401745'	260 17 0 00 401770'		PUSHJ	P,TEXT			;GENERATE TEXT
  1571	401746'	205 01 0 00 002000 		MOVX	T1,UF.NOQ		;GET NO QUOTA CHECKING BIT
  1572	401747'	612 01 0 16 000000 		TDNE	T1,.UFFLG(AP)		;FORCE DISMOUNT ANYWAY?
  1573	401750'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1574	401751'	260 17 0 00 402225'		$ERR	(SND)			;? STRUCTURE NOT DISMOUNTED
  1575	401752'	300 00 0 00 000015 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 47
UFDSET	MAC	24-Sep-72 02:32		Directory and File error processing

  1576					SUBTTL	Directory and File error processing
  1577
  1578
  1579					; Here on a directory I/O error
  1580					;
  1581	401753'	202 01 0 00 000775'	DIRIOE:	MOVEM	T1,IOS			;SAVE I/O STATUS
  1582	401754'	201 01 0 05 000040'		MOVEI	T1,FOPBLK(P1)		;GET FILOP BLOCK ADDRESS
  1583	401755'	202 01 0 00 000776'		MOVEM	T1,FOPADR		;SAVE IT
  1584	401756'	200 01 0 00 402632'		MOVE	T1,["%",,'IOE']		;FLAG I/O ERROR AS WARNING
  1585	401757'	201 02 0 00 402633'		MOVEI	T2,[ASCIZ |Directory I/O error @B for @J|]
  1586	401760'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
  1587
  1588
  1589					; Here when a file lookup fails
  1590					;
  1591	401761'	334 02 0 00 402641'	FILERR:	SKIPA	T2,[FOPFIL]		;POINT TO FILOP BLOCK
  1592
  1593
  1594					; Here when a directory lookup fails
  1595					;
  1596	401762'	201 02 0 05 000040'	DIRERR:	MOVEI	T2,FOPBLK(P1)		;POINT TO FILOP BLOCK
  1597	401763'	202 02 0 00 000776'		MOVEM	T2,FOPADR		;SAVE ADDRESS
  1598	401764'	202 01 0 00 000777'		MOVEM	T1,FOPERR		;SAVE FILOP ERROR CODE
  1599	401765'	200 01 0 00 402642'		MOVE	T1,["%",,'LKP']		;FLAG LOOKUP ERROR AS A WARNING
  1600	401766'	201 02 0 00 402643'		MOVEI	T2,[ASCIZ |LOOKUP error (@E) for @J|]
  1601	401767'	324 17 0 00 401770'		PJRST	TEXT			;GENERATE TEXT AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 48
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1602					SUBTTL	Text generation routines
  1603
  1604
  1605
  1606					; Build a text message
  1607					; Call:	MOVE	T1, severity chr,,prefix
  1608					;	MOVEI	T2, address of ASCIZ text
  1609					;	PUSHJ	P,TEXT
  1610					;
  1611	401770'	202 01 0 16 000020 	TEXT:	MOVEM	T1,.UFPFX(AP)		;SAVE PREFIX
  1612	401771'	200 01 0 00 402650'		MOVE	T1,[TXTBUF,,TXTBUF+1]	;SET UP BLT
  1613	401772'	402 00 0 00 001146'		SETZM	TXTBUF			;CLEAR THE FIRST WORD
  1614	401773'	251 01 0 00 001200'		BLT	T1,TXTBUF+BUFSIZ-1	;CLEAR TEH ENTIRE BLOCK
  1615	401774'	200 12 0 00 402651'		MOVE	BP,[POINT 7,TXTBUF]	;SET UP BYTE POINTER
  1616	401775'	505 02 0 00 440700 		HRLI	T2,(POINT 7,)		;MAKE A BYTE POINTER
  1617	401776'	202 02 0 00 001144'		MOVEM	T2,TXTPTR		;SAVE IT
  1618
  1619	401777'	134 01 0 00 001144'	TEXT.1:	ILDB	T1,TXTPTR		;GET A CHARACTER
  1620	402000'	322 01 0 00 402012'		JUMPE	T1,TEXT.3		;DONE IF END OF STRING
  1621	402001'	306 01 0 00 000100 		CAIN	T1,"@"			;SPECIAL FLAG CHARACTER?
  1622	402002'	254 00 0 00 402005'		JRST	TEXT.2			;YES
  1623	402003'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;TYPE NORMAL CHARACTER
  1624	402004'	254 00 0 00 401777'		JRST	TEXT.1			;LOOP
  1625
  1626	402005'	134 01 0 00 001144'	TEXT.2:	ILDB	T1,TXTPTR		;GET NEXT CHARACTER
  1627	402006'	322 01 0 00 402012'		JUMPE	T1,TEXT.3		;SHOULDN'T NEED THIS CHECK
  1628	402007'	275 01 0 00 000101 		SUBI	T1,"A"			;COMPUTE INDEX
  1629	402010'	260 17 1 01 402015'		PUSHJ	P,@TXTTAB(T1)		;PROCESS SPECIAL TYPEOUT
  1630	402011'	254 00 0 00 401777'		JRST	TEXT.1			;LOOP
  1631
  1632	402012'	332 00 0 16 000017 	TEXT.3:	SKIPE	.UFTYO(AP)		;WANT TO SEE THIS?
  1633	402013'	260 17 1 16 000017 		PUSHJ	P,@.UFTYO(AP)		;INFORM CALLING PROGRAM
  1634	402014'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1635
  1636
  1637	402015'	000000	402103'		TXTTAB:	EXP	TSTRUC			;A - STRUCTURE
  1638	402016'	000000	402147'			EXP	TIOS			;B - I/O STATUS
  1639	402017'	000000	402111'			EXP	TPPN			;C - PPN
  1640	402020'	000000	402105'			EXP	TSTPPN			;D - STR:[PPN]
  1641	402021'	000000	402113'			EXP	TFOPER			;E - FILOP ERROR
  1642	402022'	000000	402115'			EXP	TJOBN			;F - JOB NUMBER
  1643	402023'	000000	402117'			EXP	TFUNCT			;G - FUNCTION CODE
  1644	402024'	000000	402121'			EXP	TOVERQ			;H - OVER QUOTA
  1645	402025'	000000	402123'			EXP	TQUOTA			;I - QUOTAS
  1646	402026'	000000	402161'			EXP	TFILE			;J - FILESPEC
  1647	402027'	000000	402145'			EXP	TTEXT			;K - TEXT
  1648
  1649
  1650					; Character output
  1651					;
  1652	402030'	312 12 0 00 402652'	TCHAR:	CAME	BP,[POINT 7,TXTBUF+BUFSIZ-1,27] ;BUFFER FULL?
  1653	402031'	136 01 0 00 000012 		IDPB	T1,BP			;NO - STORE CHARACTER
  1654	402032'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1655
  1656
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 48-1
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1657					; Sixbit output
  1658					;
  1659	402033'	336 02 0 00 000001 	TSIXW:	SKIPN	T2,T1			;PUT IN A BETTER PALCE
  1660	402034'	263 17 0 00 000000 		POPJ	P,			;NOTHING TO OUTPUT
  1661	402035'	246 01 0 00 000006 	TSIX.1:	LSHC	T1,6			;SHIFT IN A CHARACTER
  1662	402036'	405 01 0 00 000077 		ANDI	T1,77			;STRIP OFF JUNK
  1663	402037'	271 01 0 00 000040 		ADDI	T1," "			;MAKE IT ASCII
  1664	402040'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;STORE IT
  1665	402041'	326 02 0 00 402035'		JUMPN	T2,TSIX.1		;CONTINUE IF MORE
  1666	402042'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1667
  1668
  1669					; String output routine
  1670					;
  1671	402043'	661 01 0 00 440700 	TSTRG:	TXO	T1,<POINT 7>		;MAKE A BYTE POINTER
  1672	402044'	261 17 0 00 000001 		PUSH	P,T1			;SAVE IT
  1673	402045'	134 01 0 17 000000 	TSTR.1:	ILDB	T1,(P)			;GET A CHARACTER
  1674	402046'	322 01 0 00 402051'		JUMPE	T1,TSTR.2		;DONE?
  1675	402047'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;STORE CHARACTER
  1676	402050'	254 00 0 00 402045'		JRST	TSTR.1			;LOOP
  1677	402051'	262 17 0 00 000001 	TSTR.2:	POP	P,T1			;TRIM STACK
  1678	402052'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1679
  1680
  1681					; Decimal and octal output
  1682					;
  1683	402053'	334 03 0 00 402653'	TDECW:	SKIPA	T3,[12]			;RADIX 10
  1684	402054'	201 03 0 00 000010 	TOCTW:	MOVEI	T3,10			;RADIX 8
  1685	402055'	231 01 0 03 000000 	TRDXW:	IDIVI	T1,(T3)			;DIVIDE BY RADIX
  1686	402056'	506 02 0 17 000000 		HRLM	T2,(P)			;STORE REMAINDER ON STACK
  1687	402057'	332 00 0 00 000001 		SKIPE	T1			;DONE?
  1688	402060'	260 17 0 00 402055'		PUSHJ	P,TRDXW			;NO - RECURSE
  1689	402061'	554 01 0 17 000000 		HLRZ	T1,(P)			;GET A CHARACTER
  1690	402062'	271 01 0 00 000060 		ADDI	T1,"0"			;MAKE IT ASCII
  1691	402063'	324 17 0 00 402030'		PJRST	TCHAR			;STORE TI AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 49
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1692					; PPN output
  1693					;
  1694	402064'	261 17 0 00 000001 	TPPNW:	PUSH	P,T1			;SAVE PPN
  1695	402065'	201 01 0 00 000133 		MOVEI	T1,"["			;GET BRACKET
  1696	402066'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;TYPE IT
  1697	402067'	262 17 0 00 000001 		POP	P,T1			;GET PPN
  1698	402070'	260 17 0 00 402073'		PUSHJ	P,THLFW			;TYPE HALF WORDS
  1699	402071'	201 01 0 00 000135 		MOVEI	T1,"]"			;GET BRACKET
  1700	402072'	324 17 0 00 402030'		PJRST	TCHAR			;TYPE IT AND RETURN
  1701
  1702					; Type word as half words
  1703					;
  1704	402073'	261 17 0 00 000001 	THLFW:	PUSH	P,T1			;SAVE WORD
  1705	402074'	557 00 0 00 000001 		HLRZS	T1			;GET LH
  1706	402075'	260 17 0 00 402054'		PUSHJ	P,TOCTW			;TYPE IT
  1707	402076'	201 01 0 00 000054 		MOVEI	T1,","			;SET SEPARATOR
  1708	402077'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;TYPE IT
  1709	402100'	262 17 0 00 000001 		POP	P,T1			;GET WORD BACK
  1710	402101'	553 00 0 00 000001 		HRRZS	T1			;GET RH
  1711	402102'	324 17 0 00 402054'		PJRST	TOCTW			;TYPE IT AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 50
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1712					; Structure output
  1713					;
  1714	402103'	200 01 0 16 000001 	TSTRUC:	MOVE	T1,.UFSTR(AP)		;GET STR NAME
  1715	402104'	324 17 0 00 402033'		PJRST	TSIXW			;TYPE IT AND RETURN
  1716
  1717
  1718					; Type STR:[PPN]
  1719					;
  1720	402105'	200 01 0 16 000001 	TSTPPN:	MOVE	T1,.UFSTR(AP)		;GET STRUCTURE NAME
  1721	402106'	260 17 0 00 402033'		PUSHJ	P,TSIXW			;TYPE IT
  1722	402107'	201 01 0 00 000072 		MOVEI	T1,":"			;GET A COLON
  1723	402110'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;SEPARATE FROM PPN
  1724
  1725
  1726					; Type [PPN] from argument block
  1727					;
  1728	402111'	200 01 0 16 000002 	TPPN:	MOVE	T1,.UFPPN(AP)		;GET PPN
  1729	402112'	324 17 0 00 402064'		PJRST	TPPNW			;TYPE IT AND RETURN
  1730
  1731
  1732					; Type FILOP. UUO error code
  1733					;
  1734	402113'	200 01 0 00 000777'	TFOPER:	MOVE	T1,FOPERR		;GET FILOP ERROR
  1735	402114'	324 17 0 00 402054'		PJRST	TOCTW			;TYPE IT AND RETURB
  1736
  1737					; Type job nnn
  1738					;
  1739	402115'	200 01 0 16 000003 	TJOBN:	MOVE	T1,.UFJOB(AP)		;GET JOB NUMBER
  1740	402116'	324 17 0 00 402053'		PJRST	TDECW			;TYPE IT AND RETURN
  1741
  1742
  1743					; Type function code
  1744					;
  1745	402117'	135 01 0 00 402321'	TFUNCT:	LDB	T1,[POINTR (.UFFLG(AP),UF.FNC)] ;GET FUNCTION CODE
  1746	402120'	324 17 0 00 402054'		PJRST	TOCTW			;TYPE IT AND RETURN
  1747
  1748
  1749					; Type blocks over quota
  1750					;
  1751	402121'	200 01 0 00 000025'	TOVERQ:	MOVE	T1,OVRQTA		;GET NUMBER OF BLOCKS
  1752	402122'	324 17 0 00 402053'		PJRST	TDECW			;TYPE IT AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 51
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1753					; Type quotas
  1754					;
  1755	402123'	201 04 0 00 000000 	TQUOTA:	MOVEI	T4,0			;CLEAR COUNTER
  1756
  1757	402124'	550 01 0 04 402142'	TQUO.1:	HRRZ	T1,QTATAB(T4)		;GET SOME TEXT
  1758	402125'	260 17 0 00 402043'		PUSHJ	P,TSTRG			;TYPE IT
  1759	402126'	554 01 0 04 402142'		HLRZ	T1,QTATAB(T4)		;GET AN INDEX
  1760	402127'	271 01 0 16 000000 		ADDI	T1,(AP)			;OFFSET INTO BLOCK
  1761	402130'	200 01 0 01 000000 		MOVE	T1,(T1)			;GET A NUMBER
  1762	402131'	316 01 0 00 402622'		CAMN	T1,[.INFIN]		;+INFINITY?
  1763	402132'	254 00 0 00 402135'		JRST	TQUO.2			;YES - MAKE IT PRETTY
  1764	402133'	260 17 0 00 402053'		PUSHJ	P,TDECW			;TYPE IT
  1765	402134'	254 00 0 00 402137'		JRST	TQUO.3			;SEE IF WE'RE FINISHED
  1766
  1767	402135'	201 01 0 00 402654'	TQUO.2:	MOVEI	T1,[ASCIZ |infinity|]	;LOOKS BETTER THAN A LARGE NUMBER
  1768	402136'	260 17 0 00 402043'		PUSHJ	P,TSTRG			;TYPE TEXT
  1769
  1770	402137'	305 04 0 00 000002 	TQUO.3:	CAIGE	T4,QTAMAX		;DONE?
  1771	402140'	344 04 0 00 402124'		AOJA	T4,TQUO.1		;NO - GO ON
  1772	402141'	263 17 0 00 000000 		POPJ	P,			;RETURN
  1773
  1774					; Macro to build QTATAB
  1775					;
  1776					DEFINE	$QTA	(IDX,TXT),<XWD	.UF'IDX,[ASCIZ | 'TXT':|]>
  1777
  1778
  1779					; Table of quota indicies and text strings
  1780					;
  1781	402142'	000006	402656'		QTATAB:	$QTA	(QTF,<In>)		;LOGGED-IN
  1782	402143'	000007	402657'			$QTA	(QTO,<Out>)		;LOGGED-OUT
  1783					;	$QTA	(QTR,<Reserved>)	;RESERVED
  1784	402144'	000012	402661'			$QTA	(USD,<Used>)		;USED
  1785			000002		QTAMAX==.-QTATAB-1			;LENGTH OF TABLE
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 52
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1786					; Type text
  1787					;
  1788	402145'	200 01 0 00 001145'	TTEXT:	MOVE	T1,TXTADR		;GET ADDRESS
  1789	402146'	324 17 0 00 402043'		PJRST	TSTRG			;TYPE IT AND RETURN
  1790
  1791
  1792					; Type I/O status
  1793					;
  1794	402147'	201 01 0 00 000050 	TIOS:	MOVEI	T1,"("			;GET LEFT PARENTHESIS
  1795	402150'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;TYPE IT
  1796	402151'	514 01 0 00 000775'		HRLZ	T1,IOS			;GET I/O STATUS WORD
  1797	402152'	243 01 0 00 402153'		JFFO	T1,.+1			;GET NUMBER OF LEADING ZEROS
  1798	402153'	231 02 0 00 000003 		IDIVI	T2,3			;GET NUMBER OF LEADING DIGITS
  1799	402154'	334 01 0 00 402663'		SKIPA	T1,["0"]		;MAKE ZERO THE LEADING DIGIT
  1800	402155'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;TYPE A ZERO
  1801	402156'	365 02 0 00 402155'		SOJGE	T2,.-1			;LOOP
  1802	402157'	201 01 0 00 000051 		MOVEI	T1,")"			;GET RIGHT PARENTHESIS
  1803	402160'	324 17 0 00 402030'		PJRST	TCHAR			;TYPE IT AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 53
UFDSET	MAC	24-Sep-72 02:32		Text generation routines

  1804					; Filespec output
  1805					;
  1806	402161'	200 04 0 00 000776'	TFILE:	MOVE	T4,FOPADR		;COPY FILOP BLOCK ADDRESS
  1807	402162'	200 01 0 16 000001 		MOVE	T1,.UFSTR(AP)		;ALWAYS GET STRUCTURE NAME FROM HERE
  1808	402163'	260 17 0 00 402033'		PUSHJ	P,TSIXW			;TYPE IT
  1809	402164'	201 01 0 00 000072 		MOVEI	T1,":"			;TERMINATE IT PROPERLY
  1810	402165'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;STORE COLON
  1811	402166'	200 01 0 04 000005 		MOVE	T1,.FOLEB(T4)		;POINT TO LOOKUP BLOCK
  1812	402167'	201 02 0 00 402033'		MOVEI	T2,TSIXW		;ASSUME SIXBIT
  1813	402170'	554 03 0 01 000003 		HLRZ	T3,.RBEXT(T1)		;GET EXTENSION
  1814	402171'	200 01 0 01 000002 		MOVE	T1,.RBNAM(T1)		;AND FILE NAME
  1815	402172'	306 03 0 00 654644 		CAIN	T3,'UFD'		;A DIRECTORY?
  1816	402173'	201 02 0 00 402064'		MOVEI	T2,TPPNW		;ITS A PPN
  1817	402174'	260 17 0 02 000000 		PUSHJ	P,(T2)			;TYPE FILE NAME
  1818
  1819	402175'	201 01 0 00 000056 		MOVEI	T1,"."			;GET A PERIOD
  1820	402176'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;STORE IT
  1821	402177'	200 01 0 04 000005 		MOVE	T1,.FOLEB(T4)		;POINT TO LOOKUP BLOCK
  1822	402200'	510 01 0 01 000003 		HLLZ	T1,.RBEXT(T1)		;GET EXTENSION
  1823	402201'	260 17 0 00 402033'		PUSHJ	P,TSIXW			;TYPE IT
  1824	402202'	554 01 0 01 000003 		HLRZ	T1,.RBEXT(T1)		;GET EXTENSION AGAIN
  1825	402203'	306 01 0 00 654644 		CAIN	T1,'UFD'		;A UFD?
  1826	402204'	263 17 0 00 000000 		POPJ	P,			;YES - ALL DONE
  1827	402205'	200 01 0 04 000005 		MOVE	T1,.FOLEB(T4)		;POINT TO LOOKUP BLOCK
  1828	402206'	200 04 0 01 000001 		MOVE	T4,.RBPPN(T1)		;POINT TO PATH BLOCK
  1829	402207'	201 01 0 00 000133 		MOVEI	T1,"["			;GET BRACKET
  1830	402210'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;TYPE IT
  1831	402211'	200 01 0 04 000002 		MOVE	T1,.PTPPN(T4)		;GET PPN
  1832	402212'	260 17 0 00 402073'		PUSHJ	P,THLFW			;TYPE AS HALF WORDS
  1833	402213'	201 04 0 04 000003 		MOVEI	T4,.PTSFD(T4)		;POINT TO START OF SFDS
  1834
  1835	402214'	336 00 0 04 000000 	TFIL.2:	SKIPN	(T4)			;HAVE AN SFD?
  1836	402215'	254 00 0 00 402223'		JRST	TFIL.3			;NO - DONE
  1837	402216'	201 01 0 00 000054 		MOVEI	T1,","			;GET A COMMA
  1838	402217'	260 17 0 00 402030'		PUSHJ	P,TCHAR			;STORE IT
  1839	402220'	200 01 0 04 000000 		MOVE	T1,(T4)			;GET SFD
  1840	402221'	260 17 0 00 402033'		PUSHJ	P,TSIXW			;TYPE IT
  1841	402222'	344 04 0 00 402214'		AOJA	T4,TFIL.2		;LOOP FOR MORE
  1842
  1843	402223'	201 01 0 00 000135 	TFIL.3:	MOVEI	T1,"]"			;GET A BRACKET
  1844	402224'	324 17 0 00 402030'		PJRST	TCHAR			;TERMINATE PATH PROPERLY AND RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 54
UFDSET	MAC	24-Sep-72 02:32		Error processing

  1845					SUBTTL	Error processing
  1846
  1847
  1848	402225'	201 01 1 17 000000 	ERRPRC:	MOVEI	T1,@(P)			;GET CALLER'S PC
  1849	402226'	550 01 0 01 000000 		HRRZ	T1,(T1)			;GET ERROR CODE IN RH
  1850	402227'	202 01 0 16 000016 		MOVEM	T1,.UFERR(AP)		;STORE IN ARGUMENT BLOCK
  1851	402230'	554 01 0 01 402255'		HLRZ	T1,ERRTAB-1(T1)		;GET PERFIX
  1852	402231'	505 01 0 00 000077 		HRLI	T1,"?"			;FLAG IT AS FATAL
  1853	402232'	200 02 0 16 000016 		MOVE	T2,.UFERR(AP)		;GET THE ERROR CODE
  1854	402233'	550 02 0 02 402255'		HRRZ	T2,ERRTAB-1(T2)		;GET ERROR TEXT ADDRESS
  1855	402234'	260 17 0 00 401770'		PUSHJ	P,TEXT			;GENERATE TEXT
  1856	402235'	260 17 0 00 402240'		PUSHJ	P,KILCHN		;KILL OFF ANY OPEN CHANNELS
  1857	402236'	260 17 0 00 401625'		PUSHJ	P,CLRUFD		;CLEAR ANY UFD INTERLOCK WE MIGHT OWN
  1858	402237'	254 00 0 00 400007'		JRST	ERRXIT			;MAKE A QUICK EXIT
  1859
  1860
  1861					; Kill off any open channels the might be left around when
  1862					; an error occurs
  1863					;
  1864	402240'	201 01 0 00 000040'	KILCHN:	MOVEI	T1,FOPBLK		;POINT TO START OF FILOP BLOCKS
  1865	402241'	201 02 0 00 000006 		MOVEI	T2,DIRLVL		;GET DIRECTORY LEVEL COUNT
  1866
  1867	402242'	200 03 0 00 402317'	KILC.1:	MOVE	T3,[1,,T4]		;SET UP AC
  1868	402243'	200 04 0 01 000000 		MOVE	T4,.FOFNC(T1)		;GET FUNCTION WORD
  1869	402244'	630 04 0 00 402326'		ANDX	T4,FO.CHN		;KEEP JUST THE CHANNEL NUMBER
  1870	402245'	322 04 0 00 402251'		JUMPE	T4,KILC.2		;WE NEVER USE CHANNEL 0
  1871	402246'	541 04 0 00 000023 		HRRI	T4,.FOREL		;GET NEW FUNCTION CODE
  1872	402247'	047 03 0 00 000155 		FILOP.	T3,			;RELEASE THE CHANNEL
  1873	402250'	255 00 0 00 000000 		  JFCL				;IGNORE ERRORS
  1874
  1875	402251'	271 01 0 00 000011 	KILC.2:	ADDI	T1,FOPSIZ		;POINT TO NEXT FILOP BLOCK
  1876	402252'	367 02 0 00 402242'		SOJG	T2,KILC.1		;LOOP
  1877	402253'	201 01 0 00 001000'		MOVEI	T1,FOPFIL		;POINT TO SPECIAL FILOP BLOCK
  1878	402254'	322 02 0 00 402242'		JUMPE	T2,KILC.1		;RELEASE THAT CHANNEL TOO
  1879	402255'	263 17 0 00 000000 		POPJ	P,			;RETURN
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 55
UFDSET	MAC	24-Sep-72 02:32		Error processing

  1880					; Macro to build ERRTAB
  1881					;
  1882					DEFINE	$ERRS	(PFX,TXT),<''PFX'',,[ASCIZ |TXT|]>
  1883
  1884
  1885					; Table of error strings
  1886					;
  1887	402256'				ERRTAB:
  1888	402256'	514466	402664'		$ERRS	(IDV,<Illegal device "@A">)			;(01) UFIDV%
  1889	402257'	516356	402670'		$ERRS	(ISN,<Improper structure name "@A">)		;(02) UFISN%
  1890	402260'	515745	402676'		$ERRS	(IOE,<Directory I/O error @B>)			;(03) UFIOE%
  1891	402261'	434144	402703'		$ERRS	(CAD,<Can't access directory>)			;(04) UFCAD%
  1892	402262'	544665	402710'		$ERRS	(LFU,<LOOKUP error (@E) for @D.UFD>)		;(05) UFLFU%
  1893	402263'	624665	402716'		$ERRS	(RFU,<RENAME error (@E) for @D.UFD>)		;(06) UFLFU%
  1894	402264'	436263	402724'		$ERRS	(CRS,<Can't read search list for job @F>)	;(07) UFCRS%
  1895	402265'	514643	402733'		$ERRS	(IFC,<Illegal function code (@G)>)		;(10) UFIFC%
  1896	402266'	454665	402741'		$ERRS	(EFU,<ENTER error (@E) for @D.UFD>)		;(11) UFEFU%
  1897	402267'	434363	402747'		$ERRS	(CCS,<Can't change search list>)	 	;(12) UFCCS%
  1898					$ERRS	(CSO,<Can't reset original search list after structure status change failed>) ;(14) 
  1899	402270'	436357	402754'		UFCSO%
  1900	402271'	436363	402772'		$ERRS	(CSS,<Can't change structure status for @D>)	;(14) UFCSS%
  1901	402272'	635644	403002'		$ERRS	(SND,<Structure @A not dismounted>)		;(15) UFSND%
  1902	402273'	654264	403010'		$ERRS	(UBT,<UFD interlock for @A is busy too long>)	;(16) UFUBT%
  1903	402274'	655143	403020'		$ERRS	(UIC,<UFD interlock for @A cannot be cleared>)	;(17) UFUIC%
  1904	402275'	604746	403030'		$ERRS	(PGF,<Programmer number generation failed>)	;(20) UFPGF%
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56
UFDSET	MAC	24-Sep-72 02:32		Data storage

  1905					SUBTTL	Data storage
  1906
  1907
  1908	402276'					LIT
  1909	402276'	000001	000001'
  1910	402277'	000001'	000001
  1911	402300'	000133	655142
  1912	402301'	125 106 104 040 151 
  1913	402302'	156 164 145 162 154 
  1914	402303'	157 143 153 040 151 
  1915	402304'	163 040 142 165 163 
  1916	402305'	171 040 146 157 162 
  1917	402306'	040 100 101 073 040 
  1918	402307'	160 154 145 141 163 
  1919	402310'	145 040 167 141 151 
  1920	402311'	164 000 000 000 000 
  1921	402312'	000020'	000021'
  1922	402313'	000020	000012
  1923	402314'	000000	000016
  1924	402315'	000001	000001
  1925	402316'	000001	000016
  1926	402317'	000001	000004
  1927	402320'	777777	777777
  1928	402321'	000416	000000
  1929	402322'	000032	000541'
  1930	402323'	220300	000001
  1931	402324'	331100	000546'
  1932	402325'	777600	000574'
  1933	402326'	777000	777777
  1934	402327'	000002	000002
  1935	402330'	000001	000002
  1936	402331'	000011	001000'
  1937	402332'	600000	000001
  1938	402333'	002200	001404'
  1939	402334'	000002	001404'
  1940	402335'	777600	001203'
  1941	402336'	001204'	001011'
  1942	402337'	200000	000016
  1943	402340'	000004	001404'
  1944	402341'	000001	001404'
  1945	402342'	000045	465445
  1946	402343'	105 162 162 157 162 
  1947	402344'	040 157 156 040 100 
  1948	402345'	112 073 040 100 113 
  1949	402346'	000 000 000 000 000 
  1950	402347'	146 151 154 145 040 
  1951	402350'	144 141 155 141 147 
  1952	402351'	145 000 000 000 000 
  1953	402352'	143 154 157 163 145 
  1954	402353'	144 040 141 146 164 
  1955	402354'	145 162 040 141 040 
  1956	402355'	143 162 141 163 150 
  1957	402356'	000 000 000 000 000 
  1958	402357'	164 141 160 145 040 
  1959	402360'	162 145 141 144 040 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-1
UFDSET	MAC	24-Sep-72 02:32		Data storage

  1960	402361'	145 162 162 157 162 
  1961	402362'	040 162 145 163 164 
  1962	402363'	157 162 151 156 147 
  1963	402364'	040 146 151 154 145 
  1964	402365'	000 000 000 000 000 
  1965	402366'	150 141 162 144 040 
  1966	402367'	144 141 164 141 040 
  1967	402370'	162 145 141 144 040 
  1968	402371'	145 162 162 157 162 
  1969	402372'	000 000 000 000 000 
  1970	402373'	150 141 162 144 040 
  1971	402374'	144 141 164 141 040 
  1972	402375'	167 162 151 164 145 
  1973	402376'	040 145 162 162 157 
  1974	402377'	162 000 000 000 000 
  1975	402400'	163 157 146 164 167 
  1976	402401'	141 162 145 040 144 
  1977	402402'	145 164 145 143 164 
  1978	402403'	145 144 040 143 150 
  1979	402404'	145 143 153 163 165 
  1980	402405'	155 040 145 162 162 
  1981	402406'	157 162 000 000 000 
  1982	402407'	000005	001531'
  1983	402410'	047 01 0 00 000066 
  1984	402411'	000003	001533'
  1985	402412'	047 01 0 00 000047 
  1986	402413'	000000	001415'
  1987	402414'	001415'	001463'
  1988	402415'	000005	001463'
  1989	402416'	000000	000001
  1990	402417'	400000	000017
  1991	402420'	001015'	001016'
  1992	402421'	000045	566543
  1993	402422'	116 157 040 125 106 
  1994	402423'	104 040 143 162 145 
  1995	402424'	141 164 145 144 040 
  1996	402425'	157 156 040 100 101 
  1997	402426'	000 000 000 000 000 
  1998	402427'	000002	001000'
  1999	402430'	001011'	000126'
  2000	402431'	001062'	000530'
  2001	402432'	331100	000132'
  2002	402433'	000400	000002
  2003	402434'	000715	000715
  2004	402435'	000045	464545
  2005	402436'	100 101 040 146 151 
  2006	402437'	154 145 040 145 162 
  2007	402440'	162 157 162 163 040 
  2008	402441'	145 170 151 163 164 
  2009	402442'	000 000 000 000 000 
  2010	402443'	000016	000002
  2011	402444'	400000	000000
  2012	402445'	070707	070707
  2013	402446'	20 20 20 20 20 20 
  2014	402447'	000007	000002
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-2
UFDSET	MAC	24-Sep-72 02:32		Data storage

  2015	402450'	221100	001000'
  2016	402451'	000045	434365
  2017	402452'	103 157 165 154 144 
  2018	402453'	040 156 157 164 040 
  2019	402454'	160 145 162 146 157 
  2020	402455'	162 155 040 125 106 
  2021	402456'	104 040 143 157 155 
  2022	402457'	160 162 145 163 163 
  2023	402460'	151 157 156 040 157 
  2024	402461'	156 040 100 104 056 
  2025	402462'	125 106 104 000 000 
  2026	402463'	600000	000014
  2027	402464'	001400	001015'
  2028	402465'	141300	001015'
  2029	402466'	170300	001014'
  2030	402467'	001400	000132'
  2031	402470'	170300	000131'
  2032	402471'	141300	000132'
  2033	402472'	000133	555664
  2034	402473'	123 164 162 165 143 
  2035	402474'	164 165 162 145 040 
  2036	402475'	100 101 040 155 157 
  2037	402476'	165 156 164 145 144 
  2038	402477'	000 000 000 000 000 
  2039	402500'	000133	445557
  2040	402501'	123 164 162 165 143 
  2041	402502'	164 165 162 145 040 
  2042	402503'	100 101 040 144 151 
  2043	402504'	163 155 157 165 156 
  2044	402505'	164 145 144 000 000 
  2045	402506'	000133	624465
  2046	402507'	122 145 143 157 155 
  2047	402510'	160 165 164 151 156 
  2048	402511'	147 040 144 151 163 
  2049	402512'	153 040 165 163 141 
  2050	402513'	147 145 000 000 000 
  2051	402514'	000133	616441
  2052	402515'	100 101 100 111 000 
  2053	402516'	100 104 100 111 000 
  2054	402517'	000045	566563
  2055	402520'	116 157 040 125 106 
  2056	402521'	104 040 145 170 151 
  2057	402522'	163 164 163 040 157 
  2058	402523'	156 040 163 164 162 
  2059	402524'	165 143 164 165 162 
  2060	402525'	145 040 100 101 000 
  2061	402526'	000133	416354
  2062	402527'	123 164 162 165 143 
  2063	402530'	164 165 162 145 040 
  2064	402531'	100 101 040 141 144 
  2065	402532'	144 145 144 040 164 
  2066	402533'	157 040 164 150 145 
  2067	402534'	040 163 171 163 164 
  2068	402535'	145 155 040 163 145 
  2069	402536'	141 162 143 150 040 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-3
UFDSET	MAC	24-Sep-72 02:32		Data storage

  2070	402537'	154 151 163 164 000 
  2071	402540'	000133	626354
  2072	402541'	123 164 162 165 143 
  2073	402542'	164 165 162 145 040 
  2074	402543'	100 101 040 162 145 
  2075	402544'	155 157 166 145 144 
  2076	402545'	040 146 162 157 155 
  2077	402546'	040 164 150 145 040 
  2078	402547'	163 171 163 164 145 
  2079	402550'	155 040 163 145 141 
  2080	402551'	162 143 150 040 154 
  2081	402552'	151 163 164 000 000 
  2082	402553'	000133	415254
  2083	402554'	123 164 162 165 143 
  2084	402555'	164 165 162 145 040 
  2085	402556'	100 101 040 141 144 
  2086	402557'	144 145 144 040 164 
  2087	402560'	157 040 164 150 145 
  2088	402561'	040 163 145 141 162 
  2089	402562'	143 150 040 154 151 
  2090	402563'	163 164 040 157 146 
  2091	402564'	040 152 157 142 040 
  2092	402565'	100 106 000 000 000 
  2093	402566'	000133	625254
  2094	402567'	123 164 162 165 143 
  2095	402570'	164 165 162 145 040 
  2096	402571'	100 101 040 162 145 
  2097	402572'	155 157 166 145 144 
  2098	402573'	040 146 162 157 155 
  2099	402574'	040 164 150 145 040 
  2100	402575'	163 145 141 162 143 
  2101	402576'	150 040 154 151 163 
  2102	402577'	164 040 157 146 040 
  2103	402600'	152 157 142 040 100 
  2104	402601'	106 000 000 000 000 
  2105	402602'	000045	436365
  2106	402603'	103 141 156 047 164 
  2107	402604'	040 163 145 164 040 
  2108	402605'	125 106 104 040 151 
  2109	402606'	156 164 145 162 154 
  2110	402607'	157 143 153 040 146 
  2111	402610'	157 162 040 100 104 
  2112	402611'	000 000 000 000 000 
  2113	402612'	103 141 156 047 164 
  2114	402613'	040 143 154 145 141 
  2115	402614'	162 040 125 106 104 
  2116	402615'	040 151 156 164 145 
  2117	402616'	162 154 157 143 153 
  2118	402617'	040 146 157 162 040 
  2119	402620'	100 104 000 000 000 
  2120	402621'	000003	000002
  2121	402622'	377777	777777
  2122	402623'	000003	001531'
  2123	402624'	000045	576661
  2124	402625'	117 166 145 162 040 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-4
UFDSET	MAC	24-Sep-72 02:32		Data storage

  2125	402626'	161 165 157 164 141 
  2126	402627'	040 142 171 040 100 
  2127	402630'	110 040 142 154 157 
  2128	402631'	143 153 163 000 000 
  2129	402632'	000045	515745
  2130	402633'	104 151 162 145 143 
  2131	402634'	164 157 162 171 040 
  2132	402635'	111 057 117 040 145 
  2133	402636'	162 162 157 162 040 
  2134	402637'	100 102 040 146 157 
  2135	402640'	162 040 100 112 000 
  2136	402641'	000000	001000'
  2137	402642'	000045	545360
  2138	402643'	114 117 117 113 125 
  2139	402644'	120 040 145 162 162 
  2140	402645'	157 162 040 050 100 
  2141	402646'	105 051 040 146 157 
  2142	402647'	162 040 100 112 000 
  2143	402650'	001146'	001147'
  2144	402651'	44 07 0 00 001146'
  2145	402652'	10 07 0 00 001200'
  2146	402653'	000000	000012
  2147	402654'	151 156 146 151 156 
  2148	402655'	151 164 171 000 000 
  2149	402656'	040 111 156 072 000 
  2150	402657'	040 117 165 164 072 
  2151	402660'	000 000 000 000 000 
  2152	402661'	040 125 163 145 144 
  2153	402662'	072 000 000 000 000 
  2154	402663'	000000	000060
  2155	402664'	111 154 154 145 147 
  2156	402665'	141 154 040 144 145 
  2157	402666'	166 151 143 145 040 
  2158	402667'	042 100 101 042 000 
  2159	402670'	111 155 160 162 157 
  2160	402671'	160 145 162 040 163 
  2161	402672'	164 162 165 143 164 
  2162	402673'	165 162 145 040 156 
  2163	402674'	141 155 145 040 042 
  2164	402675'	100 101 042 000 000 
  2165	402676'	104 151 162 145 143 
  2166	402677'	164 157 162 171 040 
  2167	402700'	111 057 117 040 145 
  2168	402701'	162 162 157 162 040 
  2169	402702'	100 102 000 000 000 
  2170	402703'	103 141 156 047 164 
  2171	402704'	040 141 143 143 145 
  2172	402705'	163 163 040 144 151 
  2173	402706'	162 145 143 164 157 
  2174	402707'	162 171 000 000 000 
  2175	402710'	114 117 117 113 125 
  2176	402711'	120 040 145 162 162 
  2177	402712'	157 162 040 050 100 
  2178	402713'	105 051 040 146 157 
  2179	402714'	162 040 100 104 056 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-5
UFDSET	MAC	24-Sep-72 02:32		Data storage

  2180	402715'	125 106 104 000 000 
  2181	402716'	122 105 116 101 115 
  2182	402717'	105 040 145 162 162 
  2183	402720'	157 162 040 050 100 
  2184	402721'	105 051 040 146 157 
  2185	402722'	162 040 100 104 056 
  2186	402723'	125 106 104 000 000 
  2187	402724'	103 141 156 047 164 
  2188	402725'	040 162 145 141 144 
  2189	402726'	040 163 145 141 162 
  2190	402727'	143 150 040 154 151 
  2191	402730'	163 164 040 146 157 
  2192	402731'	162 040 152 157 142 
  2193	402732'	040 100 106 000 000 
  2194	402733'	111 154 154 145 147 
  2195	402734'	141 154 040 146 165 
  2196	402735'	156 143 164 151 157 
  2197	402736'	156 040 143 157 144 
  2198	402737'	145 040 050 100 107 
  2199	402740'	051 000 000 000 000 
  2200	402741'	105 116 124 105 122 
  2201	402742'	040 145 162 162 157 
  2202	402743'	162 040 050 100 105 
  2203	402744'	051 040 146 157 162 
  2204	402745'	040 100 104 056 125 
  2205	402746'	106 104 000 000 000 
  2206	402747'	103 141 156 047 164 
  2207	402750'	040 143 150 141 156 
  2208	402751'	147 145 040 163 145 
  2209	402752'	141 162 143 150 040 
  2210	402753'	154 151 163 164 000 
  2211	402754'	103 141 156 047 164 
  2212	402755'	040 162 145 163 145 
  2213	402756'	164 040 157 162 151 
  2214	402757'	147 151 156 141 154 
  2215	402760'	040 163 145 141 162 
  2216	402761'	143 150 040 154 151 
  2217	402762'	163 164 040 141 146 
  2218	402763'	164 145 162 040 163 
  2219	402764'	164 162 165 143 164 
  2220	402765'	165 162 145 040 163 
  2221	402766'	164 141 164 165 163 
  2222	402767'	040 143 150 141 156 
  2223	402770'	147 145 040 146 141 
  2224	402771'	151 154 145 144 000 
  2225	402772'	103 141 156 047 164 
  2226	402773'	040 143 150 141 156 
  2227	402774'	147 145 040 163 164 
  2228	402775'	162 165 143 164 165 
  2229	402776'	162 145 040 163 164 
  2230	402777'	141 164 165 163 040 
  2231	403000'	146 157 162 040 100 
  2232	403001'	104 000 000 000 000 
  2233	403002'	123 164 162 165 143 
  2234	403003'	164 165 162 145 040 
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-6
UFDSET	MAC	24-Sep-72 02:32		Data storage

  2235	403004'	100 101 040 156 157 
  2236	403005'	164 040 144 151 163 
  2237	403006'	155 157 165 156 164 
  2238	403007'	145 144 000 000 000 
  2239	403010'	125 106 104 040 151 
  2240	403011'	156 164 145 162 154 
  2241	403012'	157 143 153 040 146 
  2242	403013'	157 162 040 100 101 
  2243	403014'	040 151 163 040 142 
  2244	403015'	165 163 171 040 164 
  2245	403016'	157 157 040 154 157 
  2246	403017'	156 147 000 000 000 
  2247	403020'	125 106 104 040 151 
  2248	403021'	156 164 145 162 154 
  2249	403022'	157 143 153 040 146 
  2250	403023'	157 162 040 100 101 
  2251	403024'	040 143 141 156 156 
  2252	403025'	157 164 040 142 145 
  2253	403026'	040 143 154 145 141 
  2254	403027'	162 145 144 000 000 
  2255	403030'	120 162 157 147 162 
  2256	403031'	141 155 155 145 162 
  2257	403032'	040 156 165 155 142 
  2258	403033'	145 162 040 147 145 
  2259	403034'	156 145 162 141 164 
  2260	403035'	151 157 156 040 146 
  2261	403036'	141 151 154 145 144 
  2262	403037'	000 000 000 000 000 
  2263
  2264
  2265	000000'					RELOC	0
  2266
  2267	000000'				USRACS:	BLOCK	20			;USER ACS
  2268
  2269	000020'				ZBEG:!					;START OF BLOCK TO CLEAR
  2270
  2271	000020'				MFDPPN:	BLOCK	1			;MFD PPN
  2272	000021'				SYSPPN:	BLOCK	1			;SYS PPN
  2273	000022'				HGHJOB:	BLOCK	1			;HIGHEST JOB NUMBER IN USE
  2274	000023'				SLFFLG:	BLOCK	1			;SELF (OUR JOB)
  2275	000024'				LOKFLG:	BLOCK	1			;UFD INTERLOCK FLAG
  2276	000025'				OVRQTA:	BLOCK	1			;BLOCKS OVER QUOTA
  2277	000026'				RCPFLG:	BLOCK	1			;RECOMPUTING FLAG
  2278	000027'				RIBERR:	BLOCK	1			;COUNTER OF ERRORS FOUND IN RIBS
  2279	000030'				TOPERR:	BLOCK	1			;TOPLEVEL DIRECTORY ERROR CODE
  2280	000031'				LEVEL:	BLOCK	1			;CURRENT LEVEL
  2281	000032'				FUNBLK:	BLOCK	DIRLVL			;FILOP FUNCTION WORDS
  2282	000040'				FOPBLK:	BLOCK	FOPSIZ*DIRLVL		;FILOP BLOCKS
  2283	000126'				LKPBLK:	BLOCK	<RIBSIZ+1>*DIRLVL	;LOOKUP BLOCKS
  2284	000514'				DIRBLK:	BLOCK	DIRLVL			;CURRENT DIRECTORY BLOCK NUMBER
  2285	000522'				IDXBLK:	BLOCK	DIRLVL			;INDEX INTO BUFFER
  2286	000530'				PTHBLK:	BLOCK	PTHSIZ			;PATH BLOCK
  2287	000541'				DCHBLK:	BLOCK	DCHSIZ			;DSKCHR BLOCK
  2288	000573'				IOLIST:	BLOCK	2			;I/O COMMAND LIST
  2289	000575'				DSKBUF:	BLOCK	BLKSIZ			;DISK BUFFER
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 56-7
UFDSET	MAC	24-Sep-72 02:32		Data storage

  2290
  2291	000775'				IOS:	BLOCK	1			;I/O STATUS ON INPUT ERRORS
  2292	000776'				FOPADR:	BLOCK	1			;FILOP BLOCK ADDRESS FOR TYPEOUT
  2293	000777'				FOPERR:	BLOCK	1			;FILOP ERROR CODE
  2294	001000'				FOPFIL:	BLOCK	FOPSIZ			;FILOP BLOCK FOR FILE LOOKUPS
  2295	001011'				LKPFIL:	BLOCK	RIBSIZ+1		;LOOKUP BLOCK FOR FILE LOOKUPS
  2296	001062'				PTHFIL:	BLOCK	PTHSIZ			;PATH BLOCK FOR FILE LOOKUPS
  2297	001073'				RENFIL:	BLOCK	RIBSIZ+1		;LOOKUP BLOCK FOR FILE RENAMES
  2298
  2299	001144'				TXTPTR:	BLOCK	1			;TEXT PROCESSOR BYTE POINTER
  2300	001145'				TXTADR:	BLOCK	1			;ASCIZ TEXT STRING ADDRESS
  2301	001146'				TXTBUF:	BLOCK	BUFSIZ			;TEXT BUFFER
  2302
  2303	001201'				BPC:	BLOCK	1			;BLOCKS PER CLUSTER
  2304	001202'				USZ:	BLOCK	1			;UNIT SIZE
  2305	001203'				CPU:	BLOCK	1			;CLUSTERS PER UNIT
  2306	001204'				RIBBLK:	BLOCK	BLKSIZ			;HOLDS A RIB
  2307	001404'				SUPFOP:	BLOCK	FOPSIZ			;FILOP BLOCK FOR SUPER I/O
  2308
  2309	001415'				OLDSL:	BLOCK	SLSIZE			;OLD SEARCH LIST BLOCK
  2310	001463'				NEWSL:	BLOCK	SLSIZE			;NEW SEARCH LIST BLOCK
  2311	001531'				GOBBLK:	BLOCK	.DFGST+1		;GOBSTR UUO BLOCK
  2312
  2313	001536'				ZEND:!					;END OF BLOCK TO CLEAR
  2314
  2315						END

NO ERRORS DETECTED

HI-SEG. BREAK IS 403047
PROGRAM BREAK IS 001536
CPU TIME USED 01:55.317

44P CORE USED
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page S-2
UFDSET	MAC	24-Sep-72 02:32		SYMBOL TABLE

ADDJ.1		400671'		FIND.1		400634'		PJOB	047000	000030		RIBSIZ		000050	spd	
ADDJ.2		400704'		FINDNS		400632'		PJRST	324740	000000		RIBSUP		400435'		
ADDJ.3		400712'		FINDOS		400631'		PTHBLK		000530'		RIBTAB		400567'		
ADDJ.4		400727'		FINSTR		400772'		PTHFIL		001062'		RJLMSG		401610'		
ADDJSL		400642'		FINSUP		400521'		PTHSIZ		000011	spd	RP.BDA		000001	spd	
ADDSTR		400745'		FIXPPN		400244'		PUTDTM		401542'		RP.BFA		000010	spd	
AJLMSG		401605'		FNCTAB		400015'		QTAC.1		401742'		RP.CRH		000004	spd	
AP		000016		FO.ASC	200000	000000	spd	QTACHK		401726'		RP.DIR		400000	spd	
ASLMSG		401577'		FO.CHN	000777	000000	spd	QTAMAX		000002	spd	RP.ERR		000715	spd	
BLKSIZ		000200	spd	FO.FNC		777777	spd	QTAMSG		401563'		RP.FCE		000400	spd	
BP		000012		FO.PRV	400000	000000	spd	QTATAB		402142'		RP.FRE		000100	spd	
BPC		001201'		FOPADR		000776'		RB.CRD		007777	spd	RP.FWE		000200	spd	
BUFSIZ		000033	spd	FOPBLK		000040'		RB.CRT	000037	770000	spd	RP.LOG	400000	000000	spd	
CHGPPN	047000	000074		FOPERR		000777'		RB.CRX		700000	spd	RP.NDL		200000	spd	
CLRU.1		401633'		FOPFIL		001000'		RB.PRV	777000	000000	spd	RP.NQC		002000	spd	
CLRUFD		401625'		FOPSIZ		000011	spd	RCPC.1		401665'		RSLMSG		401602'		
COMP.0		401476'		FS.RSA	200000	000000	spd	RCPC.2		401671'		SETBLK		401145'		
COMP.1		401511'		FUNBLK		000032'		RCPC.3		401704'		SETFIL		401103'		
COMP.2		401514'		GETDTM		401532'		RCPC.4		401714'		SETPTR		401140'		
COMP.3		401523'		GETPPN	047000	000024		RCPC.5		401723'		SETSUP		400506'		
COMPRS		401453'		GETTAB	047000	000041		RCPCHK		401654'		SETUFD		401127'		
CPOPJ		400014'		GOBBLK		001531'		RCPFLG		000026'		SFDMAX		000005	spd	
CPOPJ1		400013'		GOBSTR	047000	000066		RCPMSG		401560'		SLEEP	047000	000031		
CPU		001203'		HGHJOB		000022'		READ.1		400610'		SLFFLG		000023'		
CPYSTR		400744'		IDXBLK		000522'		READ.2		400616'		SLSIZE		000046	spd	
CREP.1		401264'		INITIA		400153'		READSL		400575'		STRMAX		000013	spd	
CREPRG		401257'		IO.EOF		020000	spd	RECO.0		400277'		STRUUO	047000	000050		
CREU.0		401201'		IOLIST		000573'		RECO.1		400300'		SUPFOP		001404'		
CREU.1		401213'		IOS		000775'		RECO.2		400326'		SYSPPN		000021'		
CREU.2		401236'		JOBSTR	047000	000047		RECO.3		400331'		T1		000001		
CREUFD		401177'		KILC.1		402242'		RECO.4		400355'		T2		000002		
DATE	047000	000014		KILC.2		402251'		RECO.5		400370'		T3		000003		
DC.TYP	000007	000000	spd	KILCHN		402240'		RECO.6		400411'		T4		000004		
DC.UCC	777000	000000	spd	L		000011		RECO.7		400413'		TCHAR		402030'		
DCHBLK		000541'		LEVEL		000031'		RECO.8		400427'		TDECW		402053'		
DCHSIZ		000032	spd	LKPBLK		000126'		RECO.9		400403'		TEXT		401770'		
DEFJSL		401023'		LKPFIL		001011'		RECO.A		400320'		TEXT.1		401777'		
DELJSL		401005'		LOKFLG		000024'		RECOM1		400102'		TEXT.2		402005'		
DF.SRM		000001	spd	LOKTIM		000002	spd	RECOMP		400255'		TEXT.3		402012'		
DIRBLK		000514'		LOKU.1		401622'		REDU.1		401301'		TFIL.2		402214'		
DIRERR		401762'		LOKUFD		401613'		REDU.2		401316'		TFIL.3		402223'		
DIRIOE		401753'		MFDPPN		000020'		REDUFD		401275'		TFILE		402161'		
DIRLVL		000006	spd	MNTMSG		401552'		RELUFD		401444'		TFOPER		402113'		
DISK.	047000	000121		MOUN.1		400042'		RENFIL		001073'		TFUNCT		402117'		
DISM.1		400063'		MOVSTR		400760'		RENU.1		401342'		THLFW		402073'		
DMOMSG		401555'		MSTIME	047000	000023		RENU.2		401370'		TIOS		402147'		
DSKBUF		000575'		NEWSL		001463'		RENU.3		401412'		TJOBN		402115'		
DSKCHR	047000	000045		NUSMSG		401574'		RENU.4		401433'		TOCTW		402054'		
ERFNF%		000000	spd	OLDSL		001415'		RENUFD		401324'		TOPERR		000030'		
ERNRM%		000014	spd	OVRQTA		000025'		RIBBLK		001204'		TOVERQ		402121'		
ERRPRC		402225'		P		000017		RIBC.1		400551'		TPPN		402111'		
ERRTAB		402256'		P1		000005		RIBC.2		400563'		TPPNW		402064'		
ERRXIT		400007'		P2		000006		RIBCHK		400541'		TQUO.1		402124'		
FILERR		401761'		P3		000007		RIBERR		000027'		TQUO.2		402135'		
FILOP.	047000	000155		P4		000010		RIBMAX		000006	spd	TQUO.3		402137'		
UFDSET - Perform UFD and search list operations	MACRO %53B(1155)-2 14:19 10-Jun-85 Page S-3
UFDSET	MAC	24-Sep-72 02:32		SYMBOL TABLE

TQUOTA		402123'		ZEND		001536'	spd	.FSDSL		000001	spd	
TRDXW		402055'		$AJSL		400115'		.FSDSO		000004	spd	
TSIX.1		402035'		$ASSL		400105'		.FSFCN		000000	spd	
TSIXW		402033'		$DISMO		400047'		.FSRDF		000003	spd	
TSTPPN		402105'		$MOUNT		400026'		.FSRNM		000003	spd	
TSTR.1		402045'		$RECOM		400071'		.FSRST		000004	spd	
TSTR.2		402051'		$RJSL		400121'		.FSUCL		000007	spd	
TSTRG		402043'		$RSSL		400111'		.FSULK		000006	spd	
TSTRUC		402103'		$UFDCL		400147'		.GTPPN		000002	spd	
TTEXT		402145'		$UFDLO		400125'		.INFIN	377777	777777	spd	
TXTADR		001145'		%%JOBD	043200	000454	spd	.IODMP		000017	spd	
TXTBUF		001146'		%%MACT	000400	000045	spd	.JBHGH		400000	spd	
TXTPTR		001144'		%%UFDS	000100	000035	spd	.PTMAX		000011	spd	
TXTTAB		402015'		%%UUOS	001600	000773	spd	.PTPPN		000002	spd	
UF.AIS	000040	000000	spd	%LDMFD		000016	spd	.PTSFD		000003	spd	
UF.ARD	040000	000000	spd	%LDSYS	000001	000016	spd	.RBALC		000011	spd	
UF.FNC		000017	spd	%NSHJB	000020	000012	spd	.RBCNT		000000	spd	
UF.LGI	400000	000000	spd	.AP		000001	spd	.RBDED		000037	spd	
UF.LGO	200000	000000	spd	.DCMAX		000032	spd	.RBEXT		000003	spd	
UF.NDL	000100	000000	spd	.DCNAM		000000	spd	.RBMAX		000050	spd	
UF.NLK	100000	000000	spd	.DCSAJ		000013	spd	.RBNAM		000002	spd	
UF.NOQ	002000	000000	spd	.DCTFS		000002	spd	.RBPPN		000001	spd	
UF.NRD	020000	000000	spd	.DCUCH		000005	spd	.RBPRV		000004	spd	
UF.NUE	000400	000000	spd	.DFGJN		000000	spd	.RBQTF		000022	spd	
UF.PSL	010000	000000	spd	.DFGNM		000002	spd	.RBQTO		000023	spd	
UF.SIN	004000	000000	spd	.DFGPP		000001	spd	.RBQTR		000024	spd	
UF.TSP	001000	000000	spd	.DFGST		000004	spd	.RBSTS		000017	spd	
UF.WLD	000200	000000	spd	.DFJBL		000003	spd	.RBUSD		000025	spd	
UFCAD%		000004	spd	.DFJDR		000001	spd	.UFCDT		000014	spd	
UFCCS%		000012	spd	.DFJNM		000000	spd	.UFCTM		000015	spd	
UFCRS%		000007	spd	.DFJST		000002	spd	.UFD		400000'	ent	
UFCSO%		000013	spd	.DUFRE		000016	spd	.UFDED		000005	spd	
UFCSS%		000014	spd	.DUUFD		000007	spd	.UFDMO		000002	spd	
UFDL.1		400127'		.FOBRH		000003	spd	.UFERR		000016	spd	
UFDL.2		400140'		.FOCRE		000002	spd	.UFFLG		000000	spd	
UFDL.3		400145'		.FODEV		000002	spd	.UFJOB		000003	spd	
UFEFU%		000011	spd	.FODLT		000014	spd	.UFLOK		000013	spd	
UFIDV%		000001	spd	.FOFNC		000000	spd	.UFMAX		000011	spd	
UFIFC%		000010	spd	.FOINP		000017	spd	.UFMNT		000001	spd	
UFIOE%		000003	spd	.FOIOS		000001	spd	.UFPFX		000020	spd	
UFISN%		000002	spd	.FOLEB		000005	spd	.UFPPN		000002	spd	
UFLFU%		000005	spd	.FOMAX		000011	spd	.UFPRO		000004	spd	
UFPGF%		000020	spd	.FONBF		000004	spd	.UFQTF		000006	spd	
UFRFU%		000006	spd	.FOPAT		000006	spd	.UFQTO		000007	spd	
UFSND%		000015	spd	.FOPPN		000007	spd	.UFQTR		000010	spd	
UFUBT%		000016	spd	.FORED		000001	spd	.UFRDU		000003	spd	
UFUIC%		000017	spd	.FOREL		000023	spd	.UFSTR		000001	spd	
ULOCK		401636'		.FORNM		000013	spd	.UFSTS		000011	spd	
UNLOCK		401645'		.FOSIO		000016	spd	.UFTXT		000021	spd	
UOQINI		400527'		.FOUSI		000011	spd	.UFTYO		000017	spd	
USRACS		000000'		.FOUSO		000012	spd	.UFUSD		000012	spd	
USZ		001202'		.FOWRT		000003	spd	
UU.PHS	400000	000000	spd	.FSDFL		000003	spd	
UU.PHY		200000	spd	.FSDJN		000001	spd	
ZBEG		000020'	spd	.FSDPP		000002	spd	

UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

ADDJ.1	   852	   870#
ADDJ.2	   860	   864	   885#
ADDJ.3	   866	   895#
ADDJ.4	   867	   912#
ADDJSL	   332	   381	   395	   845#
ADDSTR	   878	   901	   922	   932#
AJLMSG	   397	  1435#
AP	   258#	   294	   408	   409	   442	   456	   457	   463	   464	   468	   469	   474	   490	   494
	   509	   511	   515	   536	   615	   710	   731	   733	   734	   736	   737	   739	   750	   793
	   796	   849	   850	   934	   937	   981	   994	  1005	  1006	  1013	  1017	  1020	  1047	  1067
	  1091	  1107	  1118	  1126	  1138	  1139	  1140	  1141	  1142	  1143	  1146	  1172	  1179	  1180
	  1195	  1197	  1198	  1200	  1201	  1203	  1205	  1210	  1219	  1238	  1240	  1242	  1244	  1246
	  1248	  1254	  1256	  1279	  1280	  1326	  1377	  1378	  1410	  1416	  1449	  1479	  1480	  1490
	  1491	  1503	  1513	  1514	  1520	  1522	  1530	  1532	  1537	  1554	  1555	  1561	  1563	  1564
	  1572	  1611	  1632	  1633	  1714	  1720	  1728	  1739	  1745	  1760	  1807	  1850	  1853
ASLMSG	   383	  1425#
BLKSIZ	   268#	   492	   592	   673	  2289	  2306
BP	   257#	  1615	  1652	  1653
BPC	   485	   662	  2303#
BUFSIZ	   269#	  1614	  1652	  2301
CLRU.1	  1466	  1470#
CLRUFD	   335	   358	   375	  1463#	  1857
COMP.0	  1332	  1337#
COMP.1	  1335	  1340	  1346	  1348#
COMP.2	  1347	  1352#
COMP.3	  1334	  1360#
COMPRS	   326	   348	   368	  1317#
CPOPJ	   304#	   839	  1565
CPOPJ1	   303#	   838	  1483	  1494	  1549
CPU	   657	   658	  2305#
CPYSTR	   888	   927#
CREP.1	  1173	  1178#	  1186
CREPRG	  1120	  1172#
CREU.0	  1120#	  1129
CREU.1	  1124	  1131#
CREU.2	  1144	  1151#
CREUFD	   321	  1117#
DC.TYP	   480
DC.UCC	   484
DCHBLK	   475	   476	   484	  1009	  1012	  2287#
DCHSIZ	   273#	   476	  2287
DEFJSL	   333	   356	   382	   389	   396	   403	   992#
DELJSL	   355	   388	   402	   975#
DF.SRM	   992	  1026
DIRBLK	   533	   539	   546	   589	  2284#
DIRERR	   564	  1596#
DIRIOE	   559	  1581#
DIRLVL	   267#	  1865	  2281	  2282	  2283	  2284	  2285
DISM.1	   346	   354#
DMOMSG	   359	  1400#
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

DSKBUF	   492	   594	   595	   596	  2289#
ERFNF%	  1134	  1211
ERNRM%	  1333
ERRPRC	   427	   433	   472	   478	   482	   582	   585	   714	   811	   998	  1003	  1031	  1036	  1038
	  1135	  1158	  1182	  1213	  1224	  1300	  1574	  1848#
ERRTAB	  1851	  1854	  1887#
ERRXIT	   299#	  1858
FILERR	   619	  1591#
FIND.1	   836#	   841
FINDNS	   833#	   982	   997
FINDOS	   832#	   851	   855	   873	   896	   917	   962	   976	  1030	  1516
FINSTR	   879	   889	   906	   923	   961#
FINSUP	   329	   351	   372	   720#
FIXPPN	   319	   341	   508#
FNCTAB	   297	   307#
FO.ASC	   628	   706	  1043	  1087	  1352
FO.CHN	   528	   544	   551	   570	   574	   624	  1307	  1338	  1343	  1362	  1869
FO.FNC	   667	   672	   721
FO.PRV	   628	  1043	  1087	  1352
FOPADR	   759	  1583	  1597	  1806	  2292#
FOPBLK	   523	   527	   543	   550	   569	   575	  1088	  1090	  1092	  1093	  1094	  1095	  1096	  1101
	  1582	  1596	  1864	  2282#
FOPERR	  1299	  1598	  1734	  2293#
FOPFIL	   608	   623	   629	   758	  1044	  1046	  1048	  1049	  1050	  1051	  1052	  1054	  1122	  1153
	  1156	  1161	  1163	  1164	  1191	  1222	  1227	  1234	  1291	  1295	  1306	  1319	  1329	  1338
	  1342	  1353	  1355	  1356	  1361	  1591	  1877	  2294#
FOPSIZ	   270#	   524	   608	  1079	  1122	  1156	  1191	  1222	  1295	  1329	  1356	  1875	  2282	  2294
	  2307
FS.RSA	  1022
FUNBLK	   530	  2281#
GETDTM	  1206	  1372#
GOBBLK	   795	   800	   801	   803	   807	   813	   817	  1531	  1533	  1539	  1540	  2311#
HGHJOB	   446	  1534	  2273#
IDXBLK	   541	   591	   598	  2285#
INITIA	   296	   439#
IO.EOF	   557
IOLIST	   493	   553	  2288#
IOS	  1581	  1796	  2291#
KILC.1	  1867#	  1876	  1878
KILC.2	  1870	  1875#
KILCHN	  1856	  1864#
L	   256#	   488	   520	   530	   532	   533	   534	   539	   541	   546	   560	   565	   576	   577
	   580	   589	   591	   598	   604	   605	   632	  1078	  1080	  1106	  1110
LEVEL	   487	   520	   522	   577	  2280#
LKPBLK	   491	   531	   603	   637	   639	   732	   735	   738	  1099	  1100	  1104	  1112	  1228	  1229
	  1233	  1236	  1239	  1241	  1243	  1245	  1247	  1249	  1250	  1268	  1385	  1387	  1390	  2283#
LKPFIL	   601	   602	   612	   614	   620	   630	   636	   638	   683	   686	   696	   697	   698	   699
	   700	   701	   747	   756	  1053	  1056	  1058	  1059	  1060	  1061	  1068	  1070	  1155	  1196
	  1199	  1202	  1204	  1228	  1281	  1282	  1283	  1288	  1294	  1323	  1325	  1372	  1373	  1374
	  1521	  1524	  1525	  2295#
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

LOKFLG	  1453	  1463	  1467	  2275#
LOKTIM	   276#	   415	   421	   423
LOKU.1	  1452	  1456#
LOKUFD	   322	   343	   364	   369	  1448#
MFDPPN	   450	  1071	  1105	  2271#
MNTMSG	   336	  1395#
MOUN.1	   324	   332#
MOVSTR	   877	   887	   900	   904	   914	   921	   947#
NEWSL	   833	   845	   846	   848	   979	   980	   984	   986	   987	   993	   995	  1000	  1001	  1016
	  1018	  1023	  1024	  2310#
NUSMSG	  1412	  1420#
OLDSL	   792	   794	   797	   798	   799	   819	   832	   845	   847	   978	   979	   985	  1028	  1033
	  1034	  2309#
OVRQTA	  1567	  1751	  2276#
P	   259#	   296	   297	   303	   304	   319	   320	   321	   322	   323	   325	   326	   327	   328
	   329	   330	   332	   333	   334	   335	   341	   342	   343	   344	   345	   347	   348	   349
	   350	   351	   352	   354	   355	   356	   357	   358	   364	   365	   366	   368	   369	   370
	   371	   372	   374	   375	   380	   381	   382	   387	   388	   389	   394	   395	   396	   401
	   402	   403	   411	   413	   419	   427	   432	   433	   435	   472	   478	   482	   486	   489
	   495	   510	   516	   535	   559	   564	   578	   582	   585	   587	   607	   616	   619	   635
	   670	   679	   685	   689	   692	   696	   697	   700	   701	   702	   703	   714	   716	   725
	   740	   748	   751	   752	   764	   768	   769	   811	   820	   851	   855	   856	   873	   874
	   877	   878	   879	   880	   887	   888	   889	   890	   896	   897	   900	   901	   904	   906
	   907	   914	   917	   918	   921	   922	   923	   924	   942	   948	   956	   962	   963	   971
	   976	   977	   982	   983	   988	   997	   998	  1003	  1008	  1011	  1014	  1027	  1030	  1031
	  1036	  1038	  1062	  1066	  1074	  1082	  1086	  1113	  1120	  1121	  1128	  1131	  1132	  1133
	  1135	  1151	  1158	  1182	  1185	  1190	  1206	  1213	  1220	  1221	  1224	  1273	  1275	  1300
	  1311	  1317	  1350	  1379	  1391	  1450	  1451	  1454	  1464	  1465	  1468	  1482	  1493	  1505
	  1509	  1516	  1528	  1545	  1557	  1559	  1570	  1573	  1574	  1623	  1629	  1633	  1634	  1654
	  1660	  1664	  1666	  1672	  1673	  1675	  1677	  1678	  1686	  1688	  1689	  1694	  1696	  1697
	  1698	  1704	  1706	  1708	  1709	  1721	  1723	  1758	  1764	  1768	  1772	  1795	  1800	  1808
	  1810	  1817	  1820	  1823	  1826	  1830	  1832	  1838	  1840	  1848	  1855	  1856	  1857	  1879
P1	   252#	   253	   408	   421	   422	   523	   527	   543	   550	   569	   575	   752	   753	   755
	   760	   766	   767	   768	   847	   876	   886	   899	   903	   905	   913	   915	   920	   933
	   940	   949	   954	   964	   966	   968	   978	   980	   987	  1078	  1079	  1088	  1090	  1092
	  1093	  1094	  1095	  1096	  1101	  1582	  1596
P2	   253#	   254	   409	   414	   415	   416	   491	   531	   603	   637	   639	   732	   735	   738
	   848	   935	   936	   938	   941	   950	   951	   955	   967	   969	  1080	  1081	  1099	  1100
	  1104	  1112
P3	   254#	   255	   849	   857	   861	   865	   870
P4	   255#	   853	   858	   862	   885	   902	   912
PTHBLK	   532	   576	   690	  1103	  1108	  1230	  1231	  2286#
PTHFIL	   604	   605	  1057	  1072	  1073	  1230	  1235	  1327	  1328	  2296#
PTHSIZ	   272#	  1231	  2286	  2296
PUTDTM	  1275	  1384#
QTAC.1	  1567#
QTACHK	   354	  1553#
QTAMAX	  1770	  1785#
QTAMSG	   330	   352	   376	  1410#
QTATAB	  1757	  1759	  1781#	  1785
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

RB.CRD	  1372	  1385
RB.CRT	  1373	  1390
RB.CRX	  1374	  1387
RB.PRV	  1239
RCPC.1	  1513#
RCPC.2	  1511	  1518#
RCPC.3	  1530#
RCPC.4	  1539#	  1543
RCPC.5	  1507	  1547#
RCPCHK	   323	   345	   366	  1503#
RCPFLG	  1293	  1548	  2277#
RCPMSG	   325	   347	  1405#
READ.1	   803#	   818
READ.2	   806	   810#
READSL	   320	   342	   380	   387	   394	   401	   791#
RECO.0	   539#	   580	   590
RECO.1	   534	   537	   541#	   593
RECO.2	   526	   564#
RECO.3	   558	   562	   568#
RECO.4	   521	   556	   589#	   599
RECO.5	   601#
RECO.6	   611	   619#
RECO.7	   617	   622#
RECO.8	   635#
RECO.9	   609	   612#
RECO.A	   548	   557#
RECOM1	   367	   374#
RECOMP	   328	   350	   371	   520#	   633	   640
REDU.1	  1127	  1195#
REDU.2	  1193	  1209#
REDUFD	   344	   365	  1190#
RELUFD	  1128	  1132	  1167	  1207	  1212	  1255	  1298	  1305#
RENFIL	  1354	  2297#
RENU.1	  1233#
RENU.2	  1252	  1256#
RENU.3	  1270	  1275#
RENU.4	  1277	  1289	  1293#
RENUFD	   334	   357	   374	  1218#
RIBBLK	   673	   684	   687	   691	   698	  2306#
RIBC.1	   755#	   767
RIBC.2	   757	   766#
RIBCHK	   616	   746#
RIBERR	   749	  1266	  1547	  2278#
RIBMAX	   766	   785#
RIBSIZ	   271#	   699	  1055	  1061	  1081	  1098	  1229	  2283	  2295	  2297
RIBSUP	   607	   656#
RIBTAB	   755	   760	   779#	   785
RJLMSG	   404	  1440#
RP.BDA	   779
RP.BFA	   781
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

RP.CRH	   780
RP.DIR	  1154
RP.ERR	   746	  1267	  1269
RP.FCE	   784
RP.FRE	   782
RP.FWE	   783
RP.LOG	  1263	  1265	  1518
RP.NDL	  1251
RP.NQC	   613
RSLMSG	   390	  1430#
SETBLK	   489	   635	  1086#
SETFIL	   486	  1043#	  1066	  1317	  1366
SETPTR	   578	  1078#	  1086
SETSUP	   327	   349	   370	   706#
SETUFD	  1066#	  1121	  1151	  1190	  1221
SFDMAX	   266#	   267
SLFFLG	   462	   805	  2274#
SLSIZE	   275#	  2309	  2310
STRMAX	   274#	   275
SUPFOP	   665	   667	   668	   672	   676	   677	   707	   709	   711	   712	   721	   722	  2307#
SYSPPN	   454	  2272#
T1	   248#	   249	   261	   297	   417	   423	   424	   440	   441	   443	   444	   445	   446	   447
	   448	   449	   450	   451	   452	   453	   454	   455	   456	   457	   459	   460	   461	   463
	   464	   465	   466	   468	   469	   470	   471	   474	   475	   476	   477	   480	   481	   484
	   485	   490	   491	   492	   493	   494	   508	   509	   511	   512	   513	   515	   523	   524
	   525	   527	   528	   529	   530	   531	   532	   542	   547	   549	   554	   557	   568	   572
	   574	   575	   579	   581	   584	   594	   599	   601	   603	   604	   606	   608	   610	   612
	   615	   622	   626	   628	   629	   630	   631	   636	   637	   638	   639	   656	   661	   662
	   664	   665	   666	   667	   668	   669	   671	   672	   673	   675	   683	   684	   686	   688
	   690	   691	   698	   699	   706	   707	   708	   709	   710	   711	   712	   713	   720	   721
	   722	   723	   731	   732	   733	   734	   735	   736	   737	   738	   739	   746	   747	   755
	   756	   758	   759	   760	   761	   762	   793	   794	   795	   796	   797	   803	   804	   807
	   808	   813	   814	   815	   817	   818	   819	   837	   845	   846	   850	   854	   871	   872
	   875	   876	   885	   886	   895	   898	   899	   902	   903	   912	   913	   916	   919	   920
	   927	   932	   939	   947	   952	   954	   955	   961	   968	   969	   970	   975	   979	   980
	   981	   985	   986	   987	   992	   993	   994	   995	   996	  1000	  1001	  1002	  1005	  1007
	  1009	  1010	  1012	  1013	  1015	  1016	  1017	  1018	  1019	  1020	  1021	  1022	  1023	  1024
	  1025	  1026	  1028	  1029	  1033	  1034	  1035	  1043	  1044	  1045	  1046	  1047	  1048	  1053
	  1054	  1055	  1056	  1057	  1058	  1060	  1061	  1067	  1068	  1069	  1070	  1071	  1072	  1087
	  1088	  1089	  1090	  1091	  1092	  1098	  1099	  1100	  1101	  1103	  1104	  1105	  1107	  1108
	  1109	  1111	  1112	  1117	  1118	  1122	  1123	  1125	  1126	  1131	  1133	  1134	  1137	  1139
	  1141	  1143	  1144	  1145	  1146	  1147	  1152	  1153	  1154	  1155	  1156	  1157	  1160	  1161
	  1162	  1163	  1164	  1165	  1172	  1173	  1174	  1175	  1176	  1178	  1179	  1180	  1181	  1184
	  1191	  1192	  1195	  1196	  1197	  1198	  1199	  1200	  1201	  1202	  1203	  1204	  1205	  1211
	  1218	  1219	  1222	  1223	  1226	  1227	  1228	  1229	  1230	  1231	  1233	  1234	  1235	  1236
	  1238	  1239	  1240	  1241	  1242	  1243	  1244	  1245	  1246	  1247	  1248	  1249	  1250	  1251
	  1263	  1265	  1267	  1268	  1269	  1271	  1278	  1284	  1286	  1287	  1288	  1290	  1291	  1295
	  1296	  1299	  1305	  1309	  1318	  1319	  1320	  1321	  1322	  1323	  1324	  1325	  1326	  1327
	  1329	  1330	  1333	  1337	  1339	  1341	  1345	  1348	  1352	  1353	  1354	  1355	  1356	  1357
	  1360	  1364	  1372	  1376	  1377	  1384	  1385	  1386	  1387	  1388	  1389	  1390	  1395	  1400
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

	  1405	  1410	  1411	  1413	  1420	  1425	  1430	  1435	  1440	  1448	  1449	  1456	  1470	  1477	  1481
	  1488	  1492	  1503	  1504	  1506	  1508	  1510	  1513	  1518	  1519	  1524	  1525	  1526	  1527
	  1530	  1531	  1532	  1533	  1534	  1535	  1536	  1539	  1541	  1543	  1544	  1553	  1556	  1558
	  1560	  1561	  1563	  1564	  1565	  1567	  1568	  1571	  1572	  1581	  1582	  1583	  1584	  1598
	  1599	  1611	  1612	  1614	  1619	  1620	  1621	  1626	  1627	  1628	  1629	  1653	  1659	  1661
	  1662	  1663	  1671	  1672	  1673	  1674	  1677	  1685	  1687	  1689	  1690	  1694	  1695	  1697
	  1699	  1704	  1705	  1707	  1709	  1710	  1714	  1720	  1722	  1728	  1734	  1739	  1745	  1751
	  1757	  1759	  1760	  1761	  1762	  1767	  1788	  1794	  1796	  1797	  1799	  1802	  1807	  1809
	  1811	  1813	  1814	  1819	  1821	  1822	  1824	  1825	  1827	  1828	  1829	  1831	  1837	  1839
	  1843	  1848	  1849	  1850	  1851	  1852	  1864	  1868	  1875	  1877
T2	   249#	   250	   418	   458	   460	   461	   542	   543	   544	   545	   549	   550	   551	   552
	   568	   569	   570	   571	   595	   602	   613	   614	   622	   623	   624	   625	   656	   657
	   659	   663	   664	   674	   687	   688	   763	   791	   792	   799	   814	   815	   816	   832
	   833	   834	   836	   840	   853	   858	   862	   875	   898	   919	   933	   934	   935	   937
	   938	   949	   950	   953	   964	   965	   966	   967	   970	   978	   984	   985	   986	  1000
	  1033	  1148	  1209	  1210	  1253	  1254	  1256	  1257	  1259	  1261	  1262	  1264	  1272	  1278
	  1279	  1305	  1306	  1307	  1308	  1337	  1338	  1341	  1342	  1343	  1344	  1349	  1360	  1361
	  1362	  1363	  1373	  1378	  1396	  1401	  1406	  1414	  1417	  1421	  1426	  1431	  1436	  1441
	  1457	  1471	  1477	  1478	  1488	  1489	  1514	  1515	  1520	  1521	  1527	  1537	  1541	  1553
	  1554	  1569	  1585	  1591	  1596	  1597	  1600	  1616	  1617	  1659	  1665	  1686	  1798	  1801
	  1812	  1816	  1817	  1853	  1854	  1865	  1876	  1878
T3	   250#	   251	   546	   553	   596	   606	   658	   659	   661	   675	   676	   677	   678	   804
	   808	   810	   836	   837	   839	   951	   952	   953	  1257	  1258	  1260	  1276	  1280	  1374
	  1375	  1376	  1415	  1416	  1479	  1490	  1522	  1523	  1540	  1542	  1555	  1683	  1684	  1685
	  1813	  1815	  1867	  1872
T4	   251#	   591	   592	   594	   595	   596	   597	   598	  1281	  1282	  1283	  1287	  1480	  1491
	  1755	  1757	  1759	  1770	  1771	  1806	  1811	  1821	  1827	  1828	  1831	  1833	  1835	  1839
	  1841	  1867	  1868	  1869	  1870	  1871
TCHAR	  1623	  1652#	  1664	  1675	  1691	  1696	  1700	  1708	  1723	  1795	  1800	  1803	  1810	  1820
	  1830	  1838	  1844
TDECW	  1683#	  1740	  1752	  1764
TEMP%%	   529	   545	   552	   571	   625	  1308	  1344	  1363	  1870
TEXT	   419	   764	  1149	  1273	  1350	  1397	  1402	  1407	  1418	  1422	  1427	  1432	  1437	  1442
	  1458	  1472	  1570	  1586	  1601	  1611#	  1855
TEXT.1	  1619#	  1624	  1630
TEXT.2	  1622	  1626#
TEXT.3	  1620	  1627	  1632#
TFIL.2	  1835#	  1841
TFIL.3	  1836	  1843#
TFILE	  1646	  1806#
TFOPER	  1641	  1734#
TFUNCT	  1643	  1745#
THLFW	  1698	  1704#	  1832
TIOS	  1638	  1794#
TJOBN	  1642	  1739#
TOCTW	  1684#	  1706	  1711	  1735	  1746
TOPERR	   561	   566	   579	  2279#
TOVERQ	  1644	  1751#
TPPN	  1639	  1728#
TPPNW	  1694#	  1729	  1816
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

TQUO.1	  1757#	  1771
TQUO.2	  1763	  1767#
TQUO.3	  1765	  1770#
TQUOTA	  1645	  1755#
TRDXW	  1685#	  1688
TSIX.1	  1661#	  1665
TSIXW	  1659#	  1715	  1721	  1808	  1812	  1823	  1840
TSTPPN	  1640	  1720#
TSTR.1	  1673#	  1676
TSTR.2	  1674	  1677#
TSTRG	  1671#	  1758	  1768	  1789
TSTRUC	  1637	  1714#
TTEXT	  1647	  1788#
TXTADR	   761	  1788	  2300#
TXTBUF	   455	  1612	  1613	  1614	  1615	  1652	  2301#
TXTPTR	  1617	  1619	  1626	  2299#
TXTTAB	  1629	  1637#
UF.AIS	   165#	  1510
UF.ARD	   156#	  1506
UF.FNC	   166#	   469	   494	  1005	  1257	  1514	  1522	  1745
UF.LGI	   153#	  1259	  1262
UF.LGO	   154#	  1261	  1264
UF.NDL	   164#	  1253
UF.NLK	   155#	  1448
UF.NOQ	   160#	  1571
UF.NRD	   157#	  1508
UF.NUE	   162#	  1145	  1209	  1218	  1411	  1504
UF.PSL	   158#	   857	   861	   865	   870
UF.SIN	   159#	  1019
UF.TSP	   161#	  1415
UF.WLD	   163#	   508	  1117	  1125
UFCAD%	   202#	   586
UFCCS%	   208#	   999	  1004
UFCRS%	   205#	   812
UFCSO%	   209#	  1032	  1037
UFCSS%	   210#	  1039
UFDEDT	    38#	    40
UFDL.1	   411#	   425
UFDL.2	   414	   416	   421#
UFDL.3	   422	   427#
UFDMIN	    37#	    40
UFDVER	    36#	    40
UFDWHO	    39#	    40
UFEFU%	   207#	  1159
UFIDV%	   199#	   479	   715
UFIFC%	   206#	   473
UFIOE%	   201#	   583
UFISN%	   200#	   483
UFLFU%	   203#	  1136	  1214	  1225
UFPGF%	   214#	  1183
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

UFRFU%	   204#	  1301
UFSND%	   211#	  1575
UFUBT%	   212#	   428
UFUIC%	   213#	   434
ULOCK	   411	  1451	  1477#
UNLOCK	   432	  1465	  1488#
UOQINI	   535	   731#
USRACS	   290	   291	   292	   293	   299	   301	  2267#
USZ	   663	  2304#
UU.PHS	  1045	  1089
UU.PHY	   477
ZBEG	   439	   440	  2269#
ZEND	   441	  2313#
$AJSL	   312	   394#
$ASSL	   310	   380#
$DISMO	   308	   340#
$MOUNT	   307	   319#
$RECOM	   309	   363#
$RJSL	   313	   401#
$RSSL	   311	   387#
$UFDCL	   315	   432#
$UFDLO	   314	   408#
%%JOBD	   229	   229#
%%MACT	   230	   230#
%%UFDS	    40#	   232	   232#
%%UUOS	   231	   231#
%LDMFD	   447
%LDSYS	   451
%NSHJB	   443
.....X	   238#	   238
.AP	   261#	   294	   302
.DCMAX	   273	  1009
.DCNAM	   475
.DCSAJ	  1012
.DCTFS	   481
.DCUCH	   484
.DFGJN	   795	  1539
.DFGNM	   801	   813	   817	  1531	  1540
.DFGPP	   800	  1533
.DFGST	   803	  2311
.DFJBL	   275	   807	   815	   816	   840	   905	   915	   940	   941	   985	   987
.DFJDR	   936
.DFJNM	   836	   933	   935
.DFJST	   938
.DUFRE	  1278	  1553
.DUUFD	  1337
.FOBRH	  1049	  1093
.FOCRE	  1318
.FODEV	   711	  1048	  1092
.FODLT	  1290	  1352
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

.FOFNC	   527	   543	   550	   569	   575	   623	   629	   667	   672	   707	   721	  1044	  1088	  1153
	  1161	  1227	  1291	  1306	  1319	  1338	  1342	  1353	  1361	  1868
.FOINP	   529	   552	   671
.FOIOS	   709	  1046	  1090	  1163
.FOLEB	  1054	  1101	  1234	  1355	  1811	  1821	  1827
.FOMAX	   270
.FONBF	  1050	  1094
.FOPAT	  1051	  1095
.FOPPN	  1052	  1096
.FORED	   628	  1043	  1087
.FOREL	   571	   625	   720	  1308	  1344	  1363	  1871
.FORNM	  1226
.FOSIO	   706
.FOUSI	   545	   666
.FOUSO	  1160
.FOWRT	  1152
.FSDFL	   798	   846	   993	  1028
.FSDJN	   794
.FSDPP	   797	   995
.FSDSL	   791
.FSDSO	   275	   799	   834	   847	   848
.FSFCN	   792	  1016
.FSRDF	  1015
.FSRNM	  1018
.FSRST	  1023	  1024
.FSUCL	  1489
.FSULK	  1478
.GTPPN	   512
.INFIN	  1762
.IODMP	   708	  1045	  1089
.JBHGH	   240	   288
.PTMAX	   272
.PTPPN	   532	   576	   604	   690	  1072	  1108	  1327	  1831
.PTSFD	   605	  1073	  1328	  1833
.RBALC	   612
.RBCNT	   697	   700	  1056	  1099
.RBDED	  1249
.RBEXT	   602	   620	   630	   638	   639	   686	   687	  1070	  1112	  1325	  1374	  1387	  1813	  1822
	  1824
.RBMAX	   271
.RBNAM	   491	   531	   601	   603	   636	   637	   683	   684	  1068	  1323	  1814
.RBPPN	   691	   696	   701	  1058	  1104	  1236	  1828
.RBPRV	  1059	  1060	  1239	  1372	  1373	  1385	  1390
.RBQTF	   732	  1196	  1241	  1281	  1288
.RBQTO	   735	  1199	  1243	  1521
.RBQTR	   738	  1202	  1245	  1282
.RBSTS	   614	   747	   756	  1155	  1250	  1268	  1524
.RBUSD	  1204	  1247	  1283	  1294	  1525
.UFAJL	   172#
.UFASL	   170#
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Symbol cross reference

.UFCDT	   188#	  1377
.UFCTM	   189#	  1378
.UFCUI	   175#	   176
.UFD	   242	   290#
.UFDED	   181#	  1248
.UFDMO	   168#	  1007	  1260	  1276
.UFERR	   190#	   302	  1850	  1853
.UFFLG	   152#	   469	   494	   509	   849	  1005	  1020	  1118	  1126	  1146	  1210	  1219	  1254	  1256
	  1410	  1416	  1449	  1503	  1514	  1522	  1572	  1745
.UFJOB	   179#	   457	   463	   511	   793	  1006	  1013	  1537	  1739
.UFLOK	   187#	   408	   409
.UFMAX	   176#	   471
.UFMNT	   167#	  1258	  1523
.UFPFX	   192#	  1611
.UFPPN	   178#	   464	   468	   490	   515	   796	   994	  1067	  1107	  1172	  1179	  1180	  1280	  1326
	  1480	  1491	  1532	  1555	  1728
.UFPRO	   180#	  1238
.UFQTF	   182#	   731	   733	  1138	  1139	  1195	  1197	  1240	  1561	  1781
.UFQTO	   183#	   734	   736	  1140	  1141	  1198	  1200	  1242	  1520	  1564	  1782
.UFQTR	   184#	   737	   739	  1142	  1143	  1201	  1203	  1244
.UFRDU	   169#	  1515
.UFRJL	   173#
.UFRSL	   171#
.UFSIZ	   194#
.UFSTR	   177#	   474	   710	   850	   934	   981	  1017	  1047	  1091	  1279	  1479	  1490	  1513	  1530
	  1554	  1714	  1720	  1807
.UFSTS	   185#	   937
.UFSUI	   174#
.UFTXT	   193#	   456
.UFTYO	   191#	   750	  1632	  1633
.UFUSD	   186#	   442	   536	   615	  1205	  1246	  1563	  1784
UFDPRM - Parameter file for UFDSET	MACRO %53B(1155)-2 14:19 10-Jun-85 Page 1
UFDSET	MAC	24-Sep-72 02:32		D. Mastrovito /DPM	7-Feb-84


Macro/Opdef cross reference

ANDX	   528	   544	   551	   570	   624	  1307	  1343	  1362	  1869
CHGPPN	  1181
COPYRI	   236
DATE	  1384
DISK.	  1284	  1339	  1556
DSKCHR	   477	  1010
FILOP.	   525	   547	   554	   572	   610	   626	   669	   678	   713	   723	  1123	  1157	  1165	  1192
	  1223	  1296	  1309	  1330	  1345	  1357	  1364	  1872
GETPPN	   466	  1184
GETTAB	   444	   448	   452	   513
GOBSTR	   804	  1542
JOBSTR	   808
MOVX	   508	   574	   613	   628	   746	   872	   916	   961	   975	   992	   996	  1019	  1022	  1029
	  1043	  1045	  1087	  1089	  1117	  1125	  1145	  1154	  1209	  1218	  1253	  1259	  1261	  1415
	  1448	  1478	  1489	  1571
MSTIME	  1174	  1320	  1388
PJOB	   458
PJRST	   336	   359	   376	   383	   390	   397	   404	  1127	  1149	  1167	  1207	  1212	  1255	  1298
	  1366	  1397	  1402	  1407	  1418	  1422	  1427	  1432	  1437	  1442	  1458	  1472	  1586	  1601
	  1691	  1700	  1711	  1715	  1729	  1735	  1740	  1746	  1752	  1789	  1803	  1844
POINTR	   469	   480	   484	   494	   667	   672	   721	  1005	  1239	  1257	  1338	  1372	  1373	  1374
	  1385	  1387	  1390	  1514	  1522	  1745
POS	   469	   480	   484	   494	   667	   672	   721	  1005	  1239	  1257	  1338	  1372	  1373	  1374
	  1385	  1387	  1390	  1514	  1522	  1745
SLEEP	   424
STRUUO	  1002	  1025	  1035	  1481	  1492
TXNE	   557	   861	  1262	  1264	  1411	  1504	  1506	  1508	  1510
TXNN	   857	   865	   870	  1251
TXO	  1263	  1671
TXZ	   528	   544	   551	   570	   624	  1265	  1307	  1343	  1362	  1869
WID	   469	   480	   484	   494	   667	   672	   721	  1005	  1239	  1257	  1338	  1372	  1373	  1374
	  1385	  1387	  1390	  1514	  1522	  1745
$ERR	   281#	   427	   433	   472	   478	   482	   582	   585	   714	   811	   998	  1003	  1031	  1036
	  1038	  1135	  1158	  1182	  1213	  1224	  1300	  1574
$ERRS	  1882#	  1888	  1889	  1890	  1891	  1892	  1893	  1894	  1895	  1896	  1897	  1898	  1900	  1901
	  1902	  1903	  1904
$QTA	  1776#	  1781	  1782	  1784
$RIB	   774#	   779	   780	   781	   782	   783	   784
.BCOPY	   235
.ECOPY	   237   $ ]k
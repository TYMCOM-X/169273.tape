;*	Program to pretty up MACRO output from FASBOL
;*	Edward C. Mulrean	Version 1(1)	28-May-76
;*
;*-CROSREF
;*	DECLARE('SNOBOL.MAIN','PRTYUP')
;	&ANCHOR = 1
TITLE .MAIN.


Q10002: JSP 14,S$$ILZ##
XWD ^D0,Q10000
JRST Q10003
JSP 14,S$$STE##
XWD ^D1,
MOVE ^D1,^D1(1000)
MOVEM 1,S$$KWD##+^D9
;	COMMENT = 0
JSP 14,S$$STE##
XWD ^D2,Q10004
MOVE 1,I10088
MOVEM 1,@N10087
Q10004:
;	OCTAL = '01234567'
JSP 14,S$$STE##
XWD ^D3,Q10005
MOVE 1,S10090
MOVEM 1,@N10089
Q10005:
;	DECIMAL = '0123456789'
JSP 14,S$$STE##
XWD ^D4,Q10006
MOVE 1,S10092
MOVEM 1,@N10091
Q10006:
;	ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
JSP 14,S$$STE##
XWD ^D5,Q10007
MOVE 1,S10094
MOVEM 1,@N10093
Q10007:
;	TAB = SUBSTR(&ALPHABET,1,9)
JSP 14,S$$STE##
XWD ^D6,Q10008
MOVE 1,S$$KWD##+^D7
PUSH 16,1
MOVE 1,I10086
PUSH 16,1
MOVE 1,I10095
3B8 ^D3,F10081
MOVEM 1,@N10030
Q10008:
;	VERSION = '1(1)'
JSP 14,S$$STE##
XWD ^D7,Q10009
MOVE 1,S10097
MOVEM 1,@N10096
Q10009:
;*
;	DEFINE('OPT(PATTERN)')				:(PATTERNS)
JSP 14,S$$STE##
XWD ^D8,L10099
MOVE 1,S10098
3B8 ^D1,F10066
JRST L10099
;OPT	OPT = PATTERN ! NULL				:(RETURN)
L10100:
JSP 14,S$$STE##
XWD ^D9,S$$SRT##
MOVE 1,@N10101
JSP 11,S$$MKP##
PUSH 16,1
MOVE 1,@N10102
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D-3,Q10012
JSP 11,S$$APS##
XWD .-.,Q10011
MOVE 1,^D1(15)
JSP 11,S$$PTX##
JRST Q10010
Q10011:
JSP 11,S$$APF##
MOVE 1,^D2(15)
JSP 11,S$$PTX##
Q10010:
JRST S$$PTS##
Q10012:
MOVEM 1,@N10100
JRST S$$SRT##
;*
;PATTERNS LABEL.PAT = OPT(ANY(ALPHA) OPT(SPAN(ALPHA DECIMAL)) ':')
;+		. LABEL OPT(' ') REM . STMT
L10099:
JSP 14,S$$STE##
XWD ^D10,Q10016
MOVE 1,@N10093
JSP 11,S$$MBT##
.
PUSH 16,1
MOVE 1,@N10093
PUSH 16,1
MOVE 1,@N10091
JSP 14,S$$CNC##
^D2
JSP 11,S$$MBT##
.
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D2,Q10013
MOVE 1,^D1(15)
JSP 11,S$$SPN##
JRST S$$PTS##
Q10013:
3B8 ^D1,F10100
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D3,Q10014
MOVE 1,^D1(15)
JSP 11,S$$ANY##
MOVE 1,^D2(15)
JSP 11,S$$PTX##
MOVE 1,S10104
JSP 11,S$$MST##
JRST S$$PTS##
Q10014:
3B8 ^D1,F10100
JSP 11,S$$MKP##
PUSH 16,1
MOVE 1,S10106
3B8 ^D1,F10100
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D-3,Q10015
JSP 11,S$$VAS##
MOVE 1,^D1(15)
JSP 11,S$$PTX##
MOVE 1,N10105
JSP 11,S$$CVA##
MOVE 1,^D2(15)
JSP 11,S$$PTX##
JSP 11,S$$VAS##
JSP 11,S$$REM##
MOVE 1,N10107
JSP 11,S$$CVA##
JRST S$$PTS##
Q10015:
MOVEM 1,@N10103
Q10016:
;	D.PAT = BREAK('^') . STMT.1 '^D' ANY(OCTAL) . D.EXP
;+		OPT(NOTANY(DECIMAL) REM) . STMT.2 RPOS(0)
JSP 14,S$$STE##
XWD ^D11,Q10019
MOVE 1,@N10089
JSP 11,S$$MBT##
.
PUSH 16,1
MOVE 1,@N10091
JSP 11,S$$MBT##
.
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D2,Q10017
MOVE 1,^D1(15)
JSP 11,S$$NTA##
JSP 11,S$$REM##
JRST S$$PTS##
Q10017:
3B8 ^D1,F10100
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D-3,Q10018
JSP 11,S$$VAS##
MOVEI 1,B10109
JSP 11,S$$BRK##
MOVE 1,N10110
JSP 11,S$$CVA##
MOVE 1,S10111
JSP 11,S$$MST##
JSP 11,S$$VAS##
MOVE 1,^D1(15)
JSP 11,S$$ANY##
MOVE 1,N10112
JSP 11,S$$CVA##
JSP 11,S$$VAS##
MOVE 1,^D2(15)
JSP 11,S$$PTX##
MOVE 1,N10113
JSP 11,S$$CVA##
HRRZ 1,^D0(1000)
CAIE 1,(13)
POPJ 16,
JRST S$$PTS##
Q10018:
MOVEM 1,@N10108
Q10019:
;	OP.PAT = SPAN(ALPHA DECIMAL) . STMT.1 ' ' REM . STMT.2
JSP 14,S$$STE##
XWD ^D12,Q10021
MOVE 1,@N10093
PUSH 16,1
MOVE 1,@N10091
JSP 14,S$$CNC##
^D2
JSP 11,S$$MBT##
.
PUSH 16,1
JSP 14,S$$GPB##
XWD ^D-2,Q10020
JSP 11,S$$VAS##
MOVE 1,^D1(15)
JSP 11,S$$SPN##
MOVE 1,N10110
JSP 11,S$$CVA##
MOVE 1,S10106
JSP 11,S$$MST##
JSP 11,S$$VAS##
JSP 11,S$$REM##
MOVE 1,N10113
JSP 11,S$$CVA##
JRST S$$PTS##
Q10020:
MOVEM 1,@N10114
Q10021:
;*
;*	FREEZE()
;	EXIT(-1)
JSP 14,S$$STE##
XWD ^D13,Q10022
MOVN ^D1,^D1(1000)
TLO 1,1B18
TLZ 1,1B19
3B8 ^D1,F10115
Q10022:
;*	OUTPUTC = 'FASBOL file: '
;	TTY = 'FASBOL file: '
JSP 14,S$$STE##
XWD ^D14,Q10023
MOVE 1,S10117
MOVEM 1,@N10116
Q10023:
;*	FASBOL.FILE = INPUT				:F(END)
;	FASBOL.FILE = TTY				:F(END)
JSP 14,S$$STE##
XWD ^D15,S$$SXT##
MOVE 1,@N10116
MOVEM 1,@N10118
;*	OPEN('DSK(0,2)',1)
;*	LOOKUP(FASBOL.FILE,1)
;*	INPUT('IN',1,132)
;	INPUT('IN',FASBOL.FILE)
JSP 14,S$$STE##
XWD ^D16,Q10024
MOVE 1,S10119
PUSH 16,1
MOVE 1,@N10118
3B8 ^D2,F10000
Q10024:
;*	OPEN('DSK(2)',2)
;*	ENTER(FASBOL.FILE,2)
;*	OUTPUT('OUT',2,132)
;	OUTPUT('OUT','XXXX.MAC')
JSP 14,S$$STE##
XWD ^D17,Q10025
MOVE 1,S10120
PUSH 16,1
MOVE 1,S10121
3B8 ^D2,F10002
Q10025:
;LOOP	LINE = IN					:F(DONE)
L10122:
JSP 14,S$$STE##
XWD ^D18,L10124
MOVE 1,@N10119
MOVEM 1,@N10123
;	NE(COMMENT)					:S(DOING.COM)
JSP 14,S$$STE##
XWD ^D19,Q10026
MOVE 1,@N10087
3B8 ^D1,F10076
JRST L10125
Q10026:
;	LINE ';'					:F(NO.COMMENT)
JSP 14,S$$STE##
XWD ^D20,L10127
MOVE 1,@N10123
PUSH 16,1
JSP 14,S$$MTX##
XWD ^D-1,0
BYTE (2)2(16)1(18).+1
MOVE 1,S10126
JSP 11,S$$MST##
JSP 11,S$$MTS##
;	OUT = ';'
JSP 14,S$$STE##
XWD ^D21,Q10027
MOVE 1,S10126
MOVEM 1,@N10120
Q10027:
;	COMMENT = -1
JSP 14,S$$STE##
XWD ^D22,Q10028
MOVN ^D1,^D1(1000)
TLO 1,1B18
TLZ 1,1B19
MOVEM 1,@N10087
Q10028:
;DUMP.LINE OUT = LINE					:(LOOP)
L10128:
JSP 14,S$$STE##
XWD ^D23,L10122
MOVE 1,@N10123
MOVEM 1,@N10120
JRST L10122
;DOING.COM LINE ';'					:S(DUMP.LINE)
L10125:
JSP 14,S$$STE##
XWD ^D24,Q10029
MOVE 1,@N10123
PUSH 16,1
JSP 14,S$$MTX##
XWD ^D-1,0
BYTE (2)2(16)1(18).+1
MOVE 1,S10126
JSP 11,S$$MST##
JSP 11,S$$MTS##
JRST L10128
Q10029:
;	OUT = ';'
JSP 14,S$$STE##
XWD ^D25,Q10030
MOVE 1,S10126
MOVEM 1,@N10120
Q10030:
;	COMMENT = 0
JSP 14,S$$STE##
XWD ^D26,Q10031
MOVE 1,I10088
MOVEM 1,@N10087
Q10031:
;NO.COMMENT LINE LABEL.PAT				:F(DUMP.LINE)
L10127:
JSP 14,S$$STE##
XWD ^D27,L10128
MOVE 1,@N10123
PUSH 16,1
MOVE 1,@N10103
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$MTX##
XWD ^D2,0
MOVE 1,^D1(15)
JSP 11,S$$PTX##
JSP 11,S$$MTS##
;DROP.D	STMT D.PAT = STMT.1 D.EXP STMT.2		:S(DROP.D)
L10129:
JSP 14,S$$STE##
XWD ^D28,Q10032
MOVE 1,@N10107
PUSH 16,1
MOVE 1,@N10108
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$MTX##
XWD ^D2,0
MOVE 1,^D1(15)
JSP 11,S$$PTX##
JSP 11,S$$RPS##
MOVE 1,@N10110
PUSH 16,1
MOVE 1,@N10112
PUSH 16,1
MOVE 1,@N10113
JSP 14,S$$CNC##
^D3
JSP 14,S$$RPL##
MOVEM 1,@N10107
JRST L10129
Q10032:
;	STMT OP.PAT = STMT.1 TAB STMT.2
JSP 14,S$$STE##
XWD ^D29,Q10033
MOVE 1,@N10107
PUSH 16,1
MOVE 1,@N10114
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$MTX##
XWD ^D2,0
MOVE 1,^D1(15)
JSP 11,S$$PTX##
JSP 11,S$$RPS##
MOVE 1,@N10110
PUSH 16,1
MOVE 1,@N10030
PUSH 16,1
MOVE 1,@N10113
JSP 14,S$$CNC##
^D3
JSP 14,S$$RPL##
MOVEM 1,@N10107
Q10033:
;	OUT = LABEL TAB STMT				:(LOOP)
JSP 14,S$$STE##
XWD ^D30,L10122
MOVE 1,@N10105
PUSH 16,1
MOVE 1,@N10030
PUSH 16,1
MOVE 1,@N10107
JSP 14,S$$CNC##
^D3
MOVEM 1,@N10120
JRST L10122
;*DONE	RELEASE(1) RELEASE(2)
;DONE	ENDFILE(FASBOL.FILE) ENDFILE('XXXX.MAC')
L10124:
JSP 14,S$$STE##
XWD ^D31,Q10034
MOVE 1,@N10118
3B8 ^D1,F10130
PUSH 16,1
MOVE 1,S10121
3B8 ^D1,F10130
JSP 11,S$$MKP##
PUSH 16,1
JSP 14,S$$MTX##
XWD ^D2,0
MOVE 1,^D1(15)
JSP 11,S$$PTX##
JSP 11,S$$MTS##
Q10034:
;*	OUTPUT = 'PRTYUP %' VERSION ' task completed.'
;	TTY = 'PRTYUP %' VERSION ' task completed.'
JSP 14,S$$STE##
XWD ^D32,Q10035
MOVE 1,S10131
PUSH 16,1
MOVE 1,@N10096
PUSH 16,1
MOVE 1,S10132
JSP 14,S$$CNC##
^D3
MOVEM 1,@N10116
Q10035:
;END
Q10003=Q10002+3
JRST S$$SXT##
Q10001: BLOCK ^D0
I10086: ^D1!1B0
I10088: ^D0!1B0
I10095: ^D9!1B0
A10000: BYTE (2)2(16)^D1+1(18)^D5
ASCII'INPUT'
A10002: BYTE (2)2(16)^D2+1(18)^D6
ASCII'OUTPUT'
A10030: BYTE (2)2(16)^D1+1(18)^D3
ASCII'TAB'
A10066: BYTE (2)2(16)^D2+1(18)^D6
ASCII'DEFINE'
A10076: BYTE (2)2(16)^D1+1(18)^D2
ASCII'NE'
A10081: BYTE (2)2(16)^D2+1(18)^D6
ASCII'SUBSTR'
A10085: BYTE (2)2(16)^D2+1(18)^D6
ASCII'.MAIN.'
A10087: BYTE (2)2(16)^D2+1(18)^D7
ASCII'COMMENT'
A10089: BYTE (2)2(16)^D1+1(18)^D5
ASCII'OCTAL'
S10090: POINT 7,A10090,35
A10090: BYTE (2)2(16)^D2+1(18)^D8
ASCII'01234567'
A10091: BYTE (2)2(16)^D2+1(18)^D7
ASCII'DECIMAL'
S10092: POINT 7,A10092,35
A10092: BYTE (2)2(16)^D2+1(18)^D10
ASCII'0123456789'
A10093: BYTE (2)2(16)^D1+1(18)^D5
ASCII'ALPHA'
S10094: POINT 7,A10094,35
A10094: BYTE (2)2(16)^D6+1(18)^D26
ASCII'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
A10096: BYTE (2)2(16)^D2+1(18)^D7
ASCII'VERSION'
S10097: POINT 7,A10097,35
A10097: BYTE (2)2(16)^D1+1(18)^D4
ASCII'1(1)'
S10098: POINT 7,A10098,35
A10098: BYTE (2)2(16)^D3+1(18)^D12
ASCII'OPT(PATTERN)'
A10099: BYTE (2)2(16)^D2+1(18)^D8
ASCII'PATTERNS'
A10100: BYTE (2)2(16)^D1+1(18)^D3
ASCII'OPT'
A10101: BYTE (2)2(16)^D2+1(18)^D7
ASCII'PATTERN'
A10102: BYTE (2)2(16)^D1+1(18)^D4
ASCII'NULL'
A10103: BYTE (2)2(16)^D2+1(18)^D9
ASCII'LABEL.PAT'
S10104: POINT 7,A10104,35
A10104: BYTE (2)2(16)^D1+1(18)^D1
ASCII':'
A10105: BYTE (2)2(16)^D1+1(18)^D5
ASCII'LABEL'
S10106: POINT 7,A10106,35
A10106: BYTE (2)2(16)^D1+1(18)^D1
ASCII' '
A10107: BYTE (2)2(16)^D1+1(18)^D4
ASCII'STMT'
A10108: BYTE (2)2(16)^D1+1(18)^D5
ASCII'D.PAT'
B10109: ^D0
XWD ^D0,^D0
XWD ^D0,^D32768
XWD ^D0,^D0
A10109: BYTE (2)2(16)^D1+1(18)^D1
ASCII'^'
A10110: BYTE (2)2(16)^D2+1(18)^D6
ASCII'STMT.1'
S10111: POINT 7,A10111,35
A10111: BYTE (2)2(16)^D1+1(18)^D2
ASCII'^D'
A10112: BYTE (2)2(16)^D1+1(18)^D5
ASCII'D.EXP'
A10113: BYTE (2)2(16)^D2+1(18)^D6
ASCII'STMT.2'
A10114: BYTE (2)2(16)^D2+1(18)^D6
ASCII'OP.PAT'
A10115: BYTE (2)2(16)^D1+1(18)^D4
ASCII'EXIT'
A10116: BYTE (2)2(16)^D1+1(18)^D3
ASCII'TTY'
S10117: POINT 7,A10117,35
A10117: BYTE (2)2(16)^D3+1(18)^D13
ASCII'FASBOL file: '
A10118: BYTE (2)2(16)^D3+1(18)^D11
ASCII'FASBOL.FILE'
A10119: BYTE (2)2(16)^D1+1(18)^D2
ASCII'IN'
A10120: BYTE (2)2(16)^D1+1(18)^D3
ASCII'OUT'
S10121: POINT 7,A10121,35
A10121: BYTE (2)2(16)^D2+1(18)^D8
ASCII'XXXX.MAC'
A10122: BYTE (2)2(16)^D1+1(18)^D4
ASCII'LOOP'
A10123: BYTE (2)2(16)^D1+1(18)^D4
ASCII'LINE'
A10124: BYTE (2)2(16)^D1+1(18)^D4
ASCII'DONE'
A10125: BYTE (2)2(16)^D2+1(18)^D9
ASCII'DOING.COM'
S10126: POINT 7,A10126,35
A10126: BYTE (2)2(16)^D1+1(18)^D1
ASCII';'
A10127: BYTE (2)2(16)^D2+1(18)^D10
ASCII'NO.COMMENT'
A10128: BYTE (2)2(16)^D2+1(18)^D9
ASCII'DUMP.LINE'
A10129: BYTE (2)2(16)^D2+1(18)^D6
ASCII'DROP.D'
A10130: BYTE (2)2(16)^D2+1(18)^D7
ASCII'ENDFILE'
S10131: POINT 7,A10131,35
A10131: BYTE (2)2(16)^D2+1(18)^D8
ASCII'PRTYUP %'
S10132: POINT 7,A10132,35
A10132: BYTE (2)2(16)^D4+1(18)^D16
ASCII' task completed.'
Q10036: BYTE (2)2(16)^D22+1(18)0
REPEAT ^D22,<0>
Q10037: BYTE (2)2(16)^D38*4+1(18)-^D38
0
BYTE (5)5(31)0
POINT 7,A10130,35
F10130: BYTE (4)4(4)0(5)20(5)0(18)S$$UDF##
0
BYTE (5)3(31)0
POINT 7,A10129,35
JRST L10129
0
BYTE (5)3(31)0
POINT 7,A10128,35
JRST L10128
0
BYTE (5)3(31)0
POINT 7,A10127,35
JRST L10127
0
BYTE (5)3(31)0
POINT 7,A10125,35
JRST L10125
0
BYTE (5)3(31)0
POINT 7,A10124,35
JRST L10124
0
BYTE (5)1(31)0
POINT 7,A10123,35
N10123: BYTE (4)4(14)0(18)Q10036+^D22
0
BYTE (5)3(31)0
POINT 7,A10122,35
JRST L10122
0
BYTE (5)1(31)0
S10120: POINT 7,A10120,35
N10120: BYTE (4)4(14)0(18)Q10036+^D21
0
BYTE (5)1(31)0
S10119: POINT 7,A10119,35
N10119: BYTE (4)4(14)0(18)Q10036+^D20
0
BYTE (5)1(31)0
POINT 7,A10118,35
N10118: BYTE (4)4(14)0(18)Q10036+^D19
0
BYTE (5)1(31)0
POINT 7,A10116,35
N10116: BYTE (4)4(14)0(18)Q10036+^D18
0
BYTE (5)5(31)0
POINT 7,A10115,35
F10115: BYTE (4)4(4)0(5)20(5)0(18)S$$UDF##
0
BYTE (5)1(31)0
POINT 7,A10114,35
N10114: BYTE (4)4(14)0(18)Q10036+^D17
0
BYTE (5)1(31)0
POINT 7,A10113,35
N10113: BYTE (4)4(14)0(18)Q10036+^D16
0
BYTE (5)1(31)0
POINT 7,A10112,35
N10112: BYTE (4)4(14)0(18)Q10036+^D15
0
BYTE (5)1(31)0
POINT 7,A10110,35
N10110: BYTE (4)4(14)0(18)Q10036+^D14
0
BYTE (5)1(31)0
POINT 7,A10108,35
N10108: BYTE (4)4(14)0(18)Q10036+^D13
0
BYTE (5)1(31)0
POINT 7,A10107,35
N10107: BYTE (4)4(14)0(18)Q10036+^D12
0
BYTE (5)1(31)0
POINT 7,A10105,35
N10105: BYTE (4)4(14)0(18)Q10036+^D11
0
BYTE (5)1(31)0
POINT 7,A10103,35
N10103: BYTE (4)4(14)0(18)Q10036+^D10
0
BYTE (5)1(31)0
POINT 7,A10102,35
N10102: BYTE (4)4(14)0(18)Q10036+^D9
0
BYTE (5)1(31)0
POINT 7,A10101,35
N10101: BYTE (4)4(14)0(18)Q10036+^D8
0
BYTE (5)5(31)0
POINT 7,A10100,35
F10100: BYTE (4)4(4)0(5)20(5)0(18)S$$UDF##
0
BYTE (5)3(31)0
POINT 7,A10100,35
JRST L10100
0
BYTE (5)1(31)0
POINT 7,A10100,35
N10100: BYTE (4)4(14)0(18)Q10036+^D7
0
BYTE (5)3(31)0
POINT 7,A10099,35
JRST L10099
0
BYTE (5)1(31)0
POINT 7,A10096,35
N10096: BYTE (4)4(14)0(18)Q10036+^D6
0
BYTE (5)1(31)0
POINT 7,A10093,35
N10093: BYTE (4)4(14)0(18)Q10036+^D5
0
BYTE (5)1(31)0
POINT 7,A10091,35
N10091: BYTE (4)4(14)0(18)Q10036+^D4
0
BYTE (5)1(31)0
POINT 7,A10089,35
N10089: BYTE (4)4(14)0(18)Q10036+^D3
0
BYTE (5)1(31)0
POINT 7,A10087,35
N10087: BYTE (4)4(14)0(18)Q10036+^D2
0
BYTE (5)5(31)0
POINT 7,A10081,35
F10081: BYTE (4)4(4)0(5)^D3(5)0(18)P$$SBS##
0
BYTE (5)5(31)0
POINT 7,A10076,35
F10076: BYTE (4)4(4)0(5)^D2(5)0(18)P$$NEP##
0
BYTE (5)5(31)0
POINT 7,A10066,35
F10066: BYTE (4)4(4)0(5)^D2(5)0(18)P$$DEF##
0
BYTE (5)1(31)0
POINT 7,A10030,35
N10030: BYTE (4)4(14)0(18)Q10036+^D1
0
BYTE (5)5(31)0
POINT 7,A10002,35
F10002: BYTE (4)4(4)0(5)^D3(5)0(18)P$$OUT##
0
BYTE (5)5(31)0
POINT 7,A10000,35
F10000: BYTE (4)4(4)0(5)^D3(5)0(18)P$$INP##
POINT 7,A10085,35
Q10000: XWD 0,Q10036
XWD Q10037,^D0
Q10037
END Q10002
 
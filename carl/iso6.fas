*
*	ISO6	Convert SOLO Consat
*	 to	I2IS 11.33
*		TII   5.33
*		ISCS  6.33
*
	&STLIMIT  = 99999999
	&ANCHOR = 1
	OUTPUT("TTY",0,-1)
	INPUT("INTTY",0,80)
*
*		PATTERNS NECESSARY FOR FUNCTIONS
*
	NULL	=

	DEFINE('OPT(PAT)')
	DEFINE('CHR(NUM)')
+							:(SETUP)

OPT	OPT	=	PAT ! NULL			:(RETURN)
*
*
CHR	&ALPHABET LEN(NUM) LEN(1) . CHR			:(RETURN)
*
*

SETUP
	UPPER	=	'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
	LOWER	=	'abcdefghijklmnopqrstuvwxyz'
	ALPHA	=	UPPER LOWER
	OCTAL	=	'01234567'
	DIGITS	=	'0123456789'
	DIGIT	=	ANY(DIGITS)
	CHAR	=	ANY(DIGITS ALPHA)
	SIGN	=	"+" ! "-"
	QUOTE	=	ANY("'|" '"')
	TAB	=	CHR(9)
	CRLF	=	CHR(13) CHR(10)
	SEP	=	NSPAN(",; " TAB)
	MONTAB	=	"JanFebMarAprMayJunJulAugSepOctNovDec"
	DATE()	BREAK(DIGITS) SPAN(DIGITS) . MONTH '/' SPAN(DIGITS) . DAY
+			'/' REM . YEAR
	MONTAB	LEN((MONTH - 1) * 3) LEN(3) . MON
	TODAY	= DAY '-' MON '-' YEAR
	MONTHS	=	( ANY("Jj") ANY("Aa") ANY("Nn") )
+		!	( ANY("Ff") ANY("Ee") ANY("Bb") )
+		!	( ANY("Mm") ANY("Aa") ANY("RrYy") )
+		!	( ANY("Aa") ANY("Pp") ANY("Rr") )
+		!	( ANY("Jj") ANY("Uu") ANY("NnLl") )
+		!	( ANY("Aa") ANY("Uu") ANY("Gg") )
+		!	( ANY("Ss") ANY("Ee") ANY("Pp") )
+		!	( ANY("Oo") ANY("Cc") ANY("Tt") )
+		!	( ANY("Nn") ANY("Oo") ANY("Vv") )
+		!	( ANY("Dd") ANY("Ee") ANY("Cc") )

	DATES	= SPAN(DIGITS) ANY("-/") (MONTHS ! SPAN(DIGITS))
+				 ANY("-/") SPAN(DIGITS)

* 
*		PATTERNS FOR PARSING INPUT FILES
*
	SOSNUM	=	POS(0) DIGIT DIGIT DIGIT DIGIT DIGIT TAB            
 

START	INCHAN  = OPEN("DSK(0,2)")
	OUTCHAN = OPEN("DSK(2,0)")
	TXXCHAN = OPEN("DSK(2,0)")

NEXT	TTY = CRLF
	TTY = 'Solo, khost, initials: '
AGAIN	MYLINE = INTTY					:F(END)
	MYLINE	POS(0) RPOS(0)				:S(END)
	MYLINE	SPAN(OCTAL) . NODE
+		BREAK(', ' TAB) SPAN(', ' TAB) SPAN(DIGITS) . KHOST
+		BREAK(', ' TAB) SPAN(', ' TAB) REM . INITIALS
+							:S(OKNODE)
	TTY = '?Incorrect input!  Please enter an octal node number' CRLF
	TTY = '?A kernel host and your initials: '	:(AGAIN)

NOTYM	TTY = "?Cannot find " TYM CRLF			:(NEXT)


OKNODE	NODE = LPAD(NODE,5,'0')
	SLOT = '01'
	NODE LEN(1) . FIRST REM . NODE
	FIRST '0'					:F(ADDN)
	FIRST = 'D'
ADDN	NODE = 'N' FIRST NODE


	TYM = NODE '.TYM'
	INPUT("IN",LOOKUP(TYM,INCHAN),160)		:F(NOTYM)

	MACHNM.EQ.PAT = ANY('Mm') ANY('Aa') ANY('Cc') ANY('Hh') ANY('Nn')
+		ANY('Mm') SPAN(' ' TAB) ANY('Ee') ANY('Qq')
+		SPAN(' $8' TAB) SPAN(OCTAL) . MNODE
	NASYNC.EQ.PAT = (ARB '(' ANY('Aa') ANY('Ss') ANY('Yy') ANY('Nn')
+		ANY('Cc') ',') SPAN(DIGITS) . ASYNC
	DAUGHTERS.PAT = POS(0) ':# OF DAUGHTER CARDS INSTALLED' . DAUGHTER
	NLINES.EQ.PAT = POS(0) ANY('Nn') ANY('Ll') ANY('Ii') ANY('Nn')
+		ANY('Ee') ANY('Ss') SPAN(' ' TAB) ANY('Ee') ANY('Qq')
+		SPAN(' $Aa' TAB) SPAN(DIGITS) . NLINES
	NACARD.EQ.PAT = POS(0) ANY('Nn') ANY('Aa') ANY('Cc') ANY('Aa')
+		ANY('Rr') ANY('Dd') SPAN(' ' TAB) ANY('Ee') ANY('Qq')
+		SPAN(' $Aa' TAB) SPAN(DIGITS) . NACARD
	NMCARD.EQ.PAT = POS(0) ANY('Mm') '.' ANY('Nn') ANY('Pp')
+		SPAN(DIGITS) . NMCARD SPAN(' ' TAB)
	TIILNK.EQ.PAT = POS(0) SPAN(' ' TAB) ANY('Tt') ANY('Ii') ANY('Ii')
+		ANY('Ll') ANY('Nn') ANY('Kk') '(' ARB
+		('8' ! '12' ! '16' ! (ANY('Mm') ANY('Ss')) ) . TIITYPE ')'
	PHSIZE.EQ.PAT = POS(0) ANY('Pp') ANY('Hh1') . PHSIZE
+		ANY('Ss') ANY('Ii') ANY('Zz') ANY('Ee')
	MNODE  =
	ISSOLO =
	NMCARD =
	COMMENTS =
	DAUGHTER =

	PHSIZE = 0
	HEADSZ = 0
	ALLSIZ = 0
	NACARD = 0
	M.NCARD = 0
	ASYNC  = 0
	NSYNC  = 0
	SILINS = 0
	NLINES = 0
	LINES  = 0


TYMRL	LINE = IN					:F(TYMRF)
	LINES = LINES + 1
	LINE POS(0) ':' SPAN(' ' TAB) 'MEMORY:'		:S(RMPAT)
	LINE POS(0) ':' SPAN(' ' TAB) 'CONSAT PAR'	:S(RCPAT)
	LINE POS(0) 'SOLOCS' . ISSOLO			:S(TYMRL)
	LINE NLINES.EQ.PAT				:S(TYMRL)
	LINE NACARD.EQ.PAT				:S(TYMRL)
	LINE NMCARD.EQ.PAT				:S(TYMRL)
	LINE DAUGHTERS.PAT				:S(TYMRL)
	LINE MACHNM.EQ.PAT				:S(TYMRL)
	LINE PHSIZE.EQ.PAT				:S(TYMRL)
	LINE NASYNC.EQ.PAT				:S(TYMRL)
	LINE TIILNK.EQ.PAT				:F(TYMRL)
	TIITYPE '8'					:S(TSYNC)
	SILINS = SILINS + 1				:(TYMRL)

TSYNC	NSYNC  = NSYNC  + 1				:(TYMRL)
RMPAT	HEADSZ = LINES  - 1				:(TYMRL)
RCPAT	ALLSIZ = LINES  - 1				:(TYMRL)

NOSOLO	TTY = '?Not a SOLO-CONSAT TYM file, please verify' CRLF :(NEXT)
NOASYNC	TTY = '?No DECLARE(ASYNC,___) parameter, please verify' CRLF :(NEXT)
NOLINKS	TTY = '?No TIILNK parameters, please verify' CRLF :(NEXT)

TYMRF	CLOSE(INCHAN)
	ISSOLO POS(0) RPOS(0)				:S(NOSOLO)
	GT(ASYNC,0)					:F(NOASYNC)
	NLINKS = NSYNC + SILINS
	GT(NLINKS,0)					:F(NOLINKS)
	NLU = NLINKS
	NLU = LT(NLU,ASYNC / 16) ASYNC / 16
	M.NCARD = GT( SIZE(NMCARD),0 ) NMCARD + 1

	INPUT("IN",LOOKUP(TYM,INCHAN),160)		:F(NOTYM)
	OUTPUT("OUT",ENTER(TYM,OUTCHAN),160)		:F(NOTYM)
	TTY = TYM CRLF

	KERNEL.EQ.PAT = ANY('Hh') ANY('Ss') ANY('Tt') '0' SPAN(' ' TAB)
+		ANY('Ee') ANY('Qq') SPAN(' $Aa' TAB) SPAN(DIGITS)
	LOAD.PAT = (ARB "LOAD DATE" BREAK(DIGITS)) . BEG DATES REM . GEB
	NSLOT.EQ.PAT =  ANY('Nn') ANY('Ss') ANY('Ll') ANY('Oo') ANY('Tt')
+			SPAN(' ' TAB) ANY('Ee') ANY('Qq')
+			SPAN(' ' TAB) SPAN(DIGITS) . NSLOT
	NDCARD.EQ.PAT = POS(0) ANY('Mm') '.' ANY('Nn') ANY('Pp')
+		NMCARD SPAN(' ' TAB)
	ORDER.NO.PAT =  ':' SPAN(' ' TAB) ANY('Oo') ANY('Rr') ANY('Dd')
+			ANY('Er') ANY('Rr') ' #:'
	REJECTS = POS(0) ( 'SOLOCS' ! 'NBRK'  ! 'MEMRMK' ! 'ASYNDA'
+			 ! 'LBOOT'  ! 'ZITEL' ! 'REBTST' ! 'NETID' )
	NXLGCS.EQ.PAT = POS(0) 'NXLGCS'
	PASTHR.EQ.PAT = POS(0) 'NPTHR'

TYMLH	LINE = IN					:F(TYMF)
	ALLSIZ = ALLSIZ - 1
	HEADSZ = GT(HEADSZ,1) HEADSZ - 1		:S(TYMLH)

	OUT = ':' TAB 'ISIS-II T-II  DEFINITION PARAMETERS' TAB TODAY TAB INITIALS
	OUT = ':' TAB 'KERNEL CODE: 11.33' TAB 'NODE CODE: 5.33'

TYML	ALLSIZ = GE(ALLSIZ,1) ALLSIZ - 1		:F(TYMLX)
	LINE = IN					:F(TYMF)
	LINE SOSNUM =
* 
*		TYM file pattern matches go here
*
TYMM	LINE REJECTS					:S(TYML)
	LINE LOAD.PAT					:S(LPAT)
	LINE ARB . BEG DATES REM . GEB			:S(DPAT)
	LINE ORDER.NO.PAT				:S(OPAT)
	LINE KERNEL.EQ.PAT				:S(KPAT)
	LINE NDCARD.EQ.PAT				:S(NDPAT)
	LINE NLINES.EQ.PAT				:S(NLPAT)
	LINE NACARD.EQ.PAT				:S(NAPAT)
	LINE NXLGCS.EQ.PAT				:S(NXPAT)
	LINE PASTHR.EQ.PAT				:S(PSPAT)
TYMO	OUT = LINE					:(TYML)


LPAT	OUT = BEG TODAY GEB				:(TYML)
DPAT	OUT = BEG TODAY GEB '/' INITIALS		:(TYML)
OPAT	OUT = ':' TAB 'ORDER #: ISIS 11.33, ISCS 6.33, TII 5.33 DEPLOYMENT'
+							:(TYML)
KPAT	OUT = 'HST0' TAB 'EQ' TAB '$A ' KHOST		:(TYML)

NAPAT	OUT = 'N.ADA	EQ	1		:* 1 IF NEW ASYNC ADDRESSING'
	OUT = 'NASYNG	EQ	' NACARD * 2 '		:* NO. OF ASYNC GROUPS (2 GRP/CD)'
	OUT = 'M.NCARD	EQ	' M.NCARD TAB TAB ':* OF SIO MOTHER BOARDS'
+							:(TYML)

NDPAT	OUT = LINE
	ALLSIZ = GE(ALLSIZ,1) ALLSIZ - 1		:F(TYMLX)
	LINE = IN					:F(TYMF)
	LINE SOSNUM =
	LINE POS(0) ":" . COMMENTS			:S(NDPAT)

NBPAT	OUT = 'LBOOT	EQ	1		:  NEW BOOT PROM'
	OUT = 'ZITEL	EQ	1'
	OUT =
	OUT = ':		ISIS CONFIGURATION CONSTRAINTS'
	OUT = 'NSLOT	EQ	1		:  NO. OF SLOTS TO CONNECT'
	OUT = 'NLU	EQ	$A ' NLU TAB '	:  MAX. NO. OF LOGICAL UNITS/SLOT'
	OUT = 'NDP	EQ	$A 256		:  NUMBER OF DISPATCHER PORTS'
	OUT =
	OUT = ':		NODE CONFIGURATION'
	OUT = 'TII	EQ	1		:* 1 IF TYMNET-II ON NODE'
	OUT = 'TIINEW	EQ	1		:* 1 IF VERSION 4.00 OR ABOVE'
	OUT = 'REBTST	EQ	1'
	OUT = 'NETID	EQ	1'
	OUT = 'MACHIN	EQ	1'
	OUT = 'IKNRNG	EQ	1'
	COMMENTS POS(0) RPOS(0)				:F(TYML)S(TYMM)

NLPAT	OUT = LINE
	OUT = 'SILINS	EQ	' SILINS '		:  NO. OF SIO LINES'
	OUT = 'ASYNEW	EQ	1		:*0=OLD DRIVER,2=NEW DRIVER,1=BOTH'
	OUT = 'CONSAT	EQ	1		:'
	OUT = 'SPAM	EQ	1		:* ENABLE PERFORMANCE MONITOR'
	GT(NSLOT,1)					:S(CPAT0)
	OUT = 'TII.FG	EQ	0		:  SET TO  0  IF ONLY CONSAT SLOT'
+							:(CPAT1)
CPAT0	OUT = 'TII.FG	EQ	1		:  SET TO  0  IF ONLY CONSAT SLOT'
CPAT1	OUT = '				:  SET TO  1  IF ANY OTHER SLOTS'
	OUT = 'FGFREQ	EQ	$A 10		:  FASTER FG FREQUENCY FOR DEDICATED CONSATS'
+							:(TYML)

NXPAT	GT( SIZE(PHSIZE),0 )				:S(TYML)
	OUT = 'P1SIZE	EQ	$0 800'
	OUT = 'PHSIZE	EQ	$0 400'			:(TYML)

PSPAT	GT(NSYNC,0)					:S(PSADD)
	OUT = 'PTHRU	EQ	1		:* IF PASSTHROUGH INHIBITED'
	OUT = 'NPTHR	EQ	$A 0		:  NO. OF PASSTHROUGHS'
+							:(TYML)
PSADD	OUT = 'PTHRU	EQ	0		:* IF PASSTHROUGH INHIBITED'
	OUT = 'NPTHR	EQ	$A 128		:  NO. OF PASSTHROUGHS'
+							:(TYML)

TYMLX	OUT =
	OUT =
	OUT = ':	SLOT 0 - THE NODE CODE'
	OUT = 'S0CORE	EQ	$A 250'
	OUT = 'NLUS0	EQ	$A ' NLINKS
	MEF = 0
	REF = 0
SREF	GT(NSYNC,REF)					:F(MREF)
	OUT = 'S0L' REF '	S.REF(' REF ')'
	REF = REF + 1					:(SREF)
MREF	GT(NLINKS,REF)					:F(XREF)
	OUT = 'S0L' REF '	M.REF(0,' MEF ')'
	MEF = MEF + 1
	REF = REF + 1					:(MREF)
XREF	OUT =
	OUT = ':	SLOT 1 - ATI-' ASYNC
	OUT = 'S1CORE	EQ	$A ' ASYNC + 45 + ((ASYNC / 16 ) * 2)
	OUT = 'S1LIC	EQ	0'
	OUT = 'NLUS1	EQ	$A ' ASYNC / 16
	REF = 0
AREF	OUT = 'S1L' REF / 16 '	A.REF(' REF / 16 ')'
	REF = REF + 16
	GT(ASYNC,REF)					:S(AREF)
	OUT =
	OUT =
	OUT = '	END'
	CLOSE(OUTCHAN)

	T01 = NODE '.T01'
	OUTPUT("TXX",ENTER(T01,TXXCHAN),160)		:F(NOT01)
	TTY = T01 CRLF

	TXX = ':' TAB 'TYMNET(R)' TAB TAB TODAY TAB INITIALS
	TXX =
	TXX = 'LOCATION(' MNODE ',1)' TAB TAB ': NODE NUMBER, SLOT'
	
	MPVC.PAT = (ARB '(' ANY('Mm') ANY('Pp') ANY('Vv') ANY('Cc') ',') . BEG
+		   SPAN(DIGITS) BREAK(')') REM . GEB

T01L	LINE = IN					:F(T01F)
	LINE SOSNUM =
* 
*		T01 file pattern matches go here
*
	LINE POS(0) SPAN(' ' TAB) =
	LINE POS(0) ':' SPAN(' ' TAB) 'CONSAT PAR'	:S(T01L)
	LINE MPVC.PAT					:S(MPAT)
T01O	LINE = LT( SIZE(LINE), 8 ) LINE TAB
	LINE = LT( SIZE(LINE),16 ) LINE TAB
	LINE = LT( SIZE(LINE),24 ) LINE TAB
	LINE = LT( SIZE(LINE),32 ) LINE TAB
	LINE = LINE ': '
	TXX = LINE					:(T01L)

MPAT	LINE = BEG '11' GEB				:(T01O)

NOT01	TTY = "?Cannot create " T01 CRLF		:(T01F)
TYMF	CLOSE(OUTCHAN)
T01F	CLOSE(INCHAN)
	CLOSE(TXXCHAN)

	C01 = NODE '.C' SLOT
	OUTPUT("OUT",ENTER(C01,OUTCHAN),160)		:S(DOC01)
	TTY = "?Cannot find " C01 CRLF			:(C01F)
DOC01	TTY = C01 CRLF
	OUT = ';; UPDATED ' TODAY ' ' NODE ' ISCS ' INITIALS
	OUT = ';@(NTS)ISCS06.I35'
	OUT = ';A' NODE '.T' SLOT
	OUT = ';@MPVC8.DEF'
	OUT = ';@(NTS)ISCS06.R35'
	OUT = ';@(ASYNCPAT)MPVVID.603'
	OUT = '1;F' NODE '.N' SLOT
	OUT = 'CTA,CTASIZ;PSEG0,S0SIZE;PSEG1,S1SIZE;PSEGD,SDSIZE;P%P%Q'
C01F	CLOSE(OUTCHAN)

	C00 = NODE '.C00'
	OUTPUT("OUT",ENTER(C00,OUTCHAN),160)		:S(DOC00)
	TTY = "?Cannot find " C00 CRLF
DOC00	TTY = C00 CRLF
	OUT = ';; UPDATED ' TODAY ' ' NODE ' ISIS-II T-II ' INITIALS
	OUT = ';@(NTS)TII05.I33'
	OUT = ';A' NODE '.TYM'
	OUT = ';AISXRAY.GGY'
	OUT = ';@(NTS)TII05.R33'
	OUT = '1;F' NODE '.N00'
	OUT = ';X(SOURCE)TIII05.WRT'
C00F	CLOSE(OUTCHAN)

	CMD = NODE '.CMD'
	OUTPUT("OUT",ENTER(CMD,OUTCHAN),160)		:S(DOCMD)
	TTY = "?Cannot find " CMD CRLF			:(CMDF)
DOCMD	TTY = CMD CRLF
	OUT = ';; UPDATED ' TODAY ' ' NODE ' ISIS-II T-II ' INITIALS
	OUT = ';@(SOURCE)I2IS11.I01'
	OUT = ';A' NODE '.TYM'
	OUT = ';AGOODGY.NQA'
	OUT = ';@(NTS)I2IS11.R33'
	OUT = '1;F' NODE '.NIB'
	OUT = '70;T0,CRCT;PINTLEN,IEND-INTLEN;P%PSEGF,SFSIZE;P%Q'
CMDF	CLOSE(OUTCHAN)					:(NEXT)


END
   
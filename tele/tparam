;PROGRAM CAPABILITIES
ACRCAP==:100                 ;I MAY RECEIVE RANK COMPRESSED DATA RECORD
KATCAP==:40                  ;I MAY RECEIVE KATAKANA DATA
BINCAP==:20                  ;I MAY RECEIVE BINARY DATA
UPDCAP==:10                  ;I MAY RECEIVE BINARY UPDATE MODE DATA
;ASSEMBLY AND TEST SWITCHES
TESTNG== 1                   ;PRINT LOGIN MESSAGES FROM SLAVE HOST
;PROTOCOL VERSION
VERNUM==:1
;MESSAGE TYPES
MBOT== 100      ;LOWER BOUND FOR MESSAGE TYPES
DNRCOD== 101 ;REQUEST SLAVE TO BE DONOR.  NO RESPONSE.
RCVCOD== 102 ;REQUEST SLAVE TO BE RECEIVER.  NO RESPONSE.
FLKCOD== 103 ;ASCII FILE NAME FOLLOWS AFTER 1 BYTE GIVING COUNT.
;              (RETURNS FAILCD IF FILE NOT FOUND OR FLKSCD IF FILE FOUND.
;              (IF THE SLAVE & CONTROLLER ARE BOTH 940 THEN THE USUAL
;              (SECURITY RULES ARE RELAXEED AND THE LOOKUP SUCCEEDS
;              (IF THE FILE IS PRESENT, RETURNING 9 BYTES CONTAINING
;              (INFORMATION FROM THE FIRST 3 WORDS OF THE FD ENTRY.
SUCCOD== 104 ;OPTION ACCEPTED
ULKCOD== 105 ;ASCII USERNAME FOLLOWS AFTER 1 BYTE GIVING COUNT.
;              (LOOKS UP THE USER NAME IN THE LUD AND RETURNS A ULKSCD IF
;              (FOUND AND A ULKRCD IF NOT FOUND.  IF THE SLAVE & CONTROLLER
;              (ARE BOTH 940 THEN A SUPER GFD IS PERFORMED TO REACH THE
;              (FILE DIRECTORY OF THE SPECIFIED USER, AND GAN, FDPT, AND UUN
;              (FROM THE LUD ENTRY ARE RETURNED AS 9 BYTES.
FLKFCD== 106 ;FILE NOT FOUND--NOT CONSIDERED AN ERROR
ABTCOD==: 107 ;STOP WHAT YOU ARE DOING, ABORT
BCMCOD== 110 ;START DATA RECORD, BINARY COMPRESSION METHOD
ACMCOD== 111 ;START DATA RECORD, ASCII COMPRESSION METHOD
ACKCOD== 112 ;ACKNOWLEDGEE RECORD CHECKSUM AND BYTECOUNT MATCH
NAKCOD== 113 ;CHECKSUM AND/OR BYTECOUNT DO NOT MATCH
FINCD1== 114 ;DONOR HAS SENT ALL RECORDS IN FILE AND IS HAPPY.  FOLLOWED
;              (BY 1 BYTE COUNT OF BYTES FOLLOWING  TOTAL FILE BYTES SENT
;              (BY DONOR.  USED BY UPDATE MODE CLOSE TO TRUNCATE FILE TO
;              (THE CORRECT DATA LENGTH.  WHEN DONOR AND RECEIVER
;              (ARE BOTH 940 THIS WILL BE 3 BYTES CONTAINING CPTOP.
FINCD2== 115 ;RECEIVER HAS WRITTEN AND CLOSED FILE SUCCESSFULLY
FPFCOD== 116 ;FILE PROTECTION FAILURE
OPFCOD== 117 ;OPEN FAILURE
BZCOD==  120 ;BUFFER ZAPPED
; OPTION TYPES 121-130 RESPOND 104 OR 133 IF NOT IMPLEMENTED
CPACOD== 121 ;SPECIFY COMPRESSION.  FOLLOWED BY 1 BYTE
;              (0= NONE
;              (1= BINARY
;              (2= ASCII
;              (3= ASCII AUTO
ONLCOD== 122 ;ON LOWER CASE.  FOLLOWED BY A BYTE OF ALL 1'S TO PERMIT
;              (LOWER CASE, ALL 0'S TO CONVERT LOWER TO UPPER CASE
;              (DEFAULT IS TO PERMIT LOWER CASE
TRUCOD== 124 ;FOLLOWED BY 1 BYTE INDICATING COLUMN TO BEGIN
;              (TRUNCATION.  IF 0 THEN TURN OFF TRUNCATION.
TRICOD== 125 ;REMOVE TRAILING BLANKS.  FOLLOWED BY A BYTE OF ALL 1'S
;              (TO SUPPRESS TRAILING BLANKS OR A BYTE OF ALL 0'S TO KEEP
;              (TRAILING BLANKS  (DEFAULT)
VARCOD== 127 ;PRODUCE VARIABLE LENGTH RECORDS (DEFAULT)
;              (FOLLOWED BY 4 BYTES GIVING MAXIMUM RECORD SIZE
FIXCOD== 130 ;PAD WITH BLANKS TO MAKE FIXED LENGTH RECORDS.
;              (FOLLOWED BY 4 BYES OF RECORD LENGTH.
LOGCOD==:131 ;TELL SLAVE TO LOG OFF
CHKCOD== 132 ;START DATA CHECKSUM RECORD
NICOD==  133 ;REQUESTED OPERATION IS NOT IMPLEMENTED
EORCOD== 134 ;END OF TRANSMISSION RECORD
EOTCOD== 135 ;TRANSMISSION RECORD IS LAST IN FILE
QUICOD==:136 ;ABORT THE CURRENT OPERATION, QUIT SLAVE, AND RETURN
;              (TO OPERATING SYSTEM COMMAND LEVEL.
OPNCOD== 137 ;REQUEST SLAVE OPEN FILE FOR DATA TRANSFER (DIRECTION
;              (DETERMINED BY PREVIOUS 101 OR 102 CODE.  FOLLOWED BY 1 BYTE
;              (TRANSMISSION TYPE, AND POSSIBLY, OTHER BYTES
;              (TYPE = 1 ASCII MODE TRANSFER.  NO BYTES FOLLOW
;              (TYPE = 2 EBCDIC MODE TRANSFER.  NO BYTES FOLLOW
;              (TYPE = 3 BINARY MODE TRANSFER.  THE RECEIVE FILE, IF
;              (PRESENT, IS TO BE ERASED.  FOLLOWED BY 1 BYTE OF BINARY
;              (PARAMETERS.
;              (TYPE = 4 BINARY UPDATE MODE TRANSFER.  DONOR AND RECEIVER
;              (WILL EXCHANGE CHECK RECORDS.  FOLLOWED BY 1 BYTE OF BINARY
;              (PARAMETERS AND 2 BYTES OF UPDATE MODE BLOCKSIZE.
;              (TYPE = 5 KATAKANA MODE TRANSFER.  NO BYTES FOLLOW
;              (TYPE = 6 IMAGE MODE TRANSFER.  NO BYTES FOLLOW
;              (POSSIBLE RESPONSES ARE  133 (UPDATE MODE NOT IMPLEMENTED
;              (OR PARAMETERS NOT ACCEPTABLE), 104 (FILE OPENED), 116
;              (FILE PROTECTION FAILURE), OR 117 (FILE OPEN FAILURE).
FENQCD== 140 ;REQUEST SLAVE DONOR TO SEND FILE ATTRIBUTES.  RETURNS 104
;              (PLUS 1 BYTE COUNT OF BYTES FOLLOWING.
FATTCD== 141 ;PREPARE SLAVE RECEIVER TO OPEN FILE.  FOLLOWED BY 1 BYTE
;              (COUNT OF BYTES FOLLOWING.  WHEN DONOR AND RECEIVER ARE BOTH
;              (940 SEND 9 BYTES  3 BYTES FFDPT, 3 BYTES FDWD0, AND
;              (3 BYTES FDWD2.  NO RESPONSE IS GIVEN.
INSCOD== 142 ;SET INSTALLER LICENSE.  FOLLOWED BY 6 BYTE CIPHER.
WHYCOD==: 143 ;SOLICIT EXPLANATION OF LATEST ERROR
RSPCOD==: 144 ;CODE FOLLOWED BY ASCII STRING TO BE PRINTED AT TERMINAL
;              (STRING TERMINATED BY A NUL BYTE OR ANY CONTROL CODE.
BADCOD== 145 ;UNEXPECTED CONTROL CODE RECEIVED
ERRCOD== 146 ;FILE SYSTEM ERROR WRITING OR READING FILE
PERCOD== 147 ;FILE SYSTEM ERROR POSITIONING FILE
ERASCD== 150 ;FILE SYSTEM ERROR ERASING RECEIVE FILE
TRPCOD== 152 ;PROGRAM TRAP
FLKRCD== 153 ;LOOKUP FAILURE--PROBABLY SYNTAX
ULKFCD== 154 ;GFD FAILURE
ULKSCD== 160 ;GFD SUCCESS
FLKSCD== 161 ;FILE LOOKUP SUCCESS
MTOP== 177      ;UPPER BOUND FOR MESSAGE TYPES
;TRANSMISSION PARAMETERS
MAXRS== ^D512*^D40             ;MAXIMUM RECORD SIZE--40 PAGES
MINRS== ^D512*^D8            ;MININUM RECORD SIZE--8 PAGES
TSTRS== ^D6144                 ;SAMPLE SIZE FOR STATISTICS (CONSTANT)
;                               WILL BE 2 PAGES FOR BF=6
;BINARY PARAMETERS FOR ASCII, KATAKANA, AND IMAGE MODE
KMODE==:  407                   ;1000+0011+1=BYTESIZE=9,BLOCKING=4,FILL=LEFT
SMODE==: 1000                   ;000+0000+0  INDICATES SERIAL MODE
IXMODE==: 345            ;111+0010+1==BYTESIZE=8,BLOCKING=3,FILL=LEFT
XMODE==: 351            ;111+0100+1==BYTESIZE=8,BLOCKING=5,FILL=LEFT
AMODE==: 311            ;110+0100+1==BYTESIZE=7,BLOCKING=5,FILL=LEFT
;ASCII CHARACTER VALUES
TABSIZ== 10
ETX==: 3        ;CONTROL-C
HT== 11
LF== 12
CR== 15
CAN==: 30
EM==: 31
ESC==: 33
RS== 36
US==: 37
BL== 40
LPAREN== 50
RPAREN== 51
COLON== 72
;COMPRESSION OPTIONS
AUTO==:1
ASCII==:2
NONE==: 400  ;NO OPTIONS, SET TO KEEP COPT NON-ZERO
;REPEATED CHAR COMPRESSION PARAMETERS
BIASP== 200                ;BIAS FOR PREFERRED CHARACTER COMPRESSION CODE
MAXP== ^D130                 ;MAXIMUM COUNT FOR PREFERRED CHARACTER
MINP== 3                   ;MININUM COUNT FOR PREFERRED CHARACTER
BIASC== 10                 ;BIAS FOR REPEATED CHARACTER COMPRESSION CODE
MAXC== ^D59                  ;MAXIMUM COUNT FOR REPEATED CHARACTER
MINC== 4                   ;MININUM COUNT FOR REPEATED CHARACTER
;RANK COMPRESSION PARAMETERS
BIASPA== 10                  ;BIAS FOR PREFERRED BYTE COMPRESSION CODE
MAXPA== ^D17                  ;MAXIMUM COUNT FOR PREFERRED BYTE
MINPA== 2                   ;MININUM COUNT FOR PREFERRED BYTE
BIASA== 32                 ;BIAS FOR ALL TRANSLATING CHARACTERS
NM== ^D8                   ;MASTER CHARACTERS-- 32 THRU 41
LM== NM-1
NC== ^D21                  ;COMBINING CHARACTERS-- 32 THRU 56
LC== NC-1
NT== ^D62                    ;TRANSLATING CHARACTERS-- 32 THRU 127
LT== NT-1
; CHECK BLOCK LAYOUT
FCK1== 0
FCK2== ^D256
FCK3== ^D512
; DONOR AND RECEIVER FILENAME INDEXES
FSIZE== -1
FEXT== 3
UNAME== 15
SYS== 17
FNAME== 20
; AUXCAL DEFINITIONS
IICHW== 0       ;INPUT IMAGE CHAR, WAIT
IICHS== 1       ;INPUT IMAGE CHAR, SKIP
OICH== 3        ;OUTPUT IMAGE CHAR
OICHI== 4       ;OUTPUT IMAGE CHAR IMMEDIATE
CLRBO==:7       ;CLEAR OUTPUT BUFFER
YELLOW==: 12     ;SEND YELLOW BALL
SDVIOS== 32     ;SET DEVIOS
IBIO== 34       ;INITIATE BLOCK I/O MODE
INBW== 35       ;INPUT A BLOCK (WAIT)
INBS== 36       ;INPUT A BLOCK (SKIP)
OB== 37         ;OUTPUT A BLOCK
TBI== 40        ;TERMINATE BLOCK INPUT
TBO== 41        ;TERMINATE BLOCK OUTPUT
LBIO== 42       ;LEAVE BLOCK I/O MODE
SLVPRT== 43     ;SLAVE COMMAND PORT
ASCSTG== 52     ;OUTPUT ASCII STRING
; DEVIOS BITS
IOMOD==14       ;BINARY MODE
IODEND==20000   ;MASK FOR IODEND BIT (BIT 22)
NOECHO==200     ;NO ECHO BIT (AFFECTS COMMAND PORT)
; UUO DEFINITIONS
IFDEF UUOFLG<UUOTAB: BLOCK 0>
DEFINE  OPD     (A,B) <U==U+1
OPDEF A [U*1000000000]
IFDEF UUOFLG<JRST B>>
U==0
 OPD OUTSTR,OSTRUU
 OPD INCHWL,INCHUU
 OPD OUTCHR,OCHRUU
 OPD OUTCHI,OCHIUU
 OPD CLRBFO,CLROUU
 OPD CLRBFI,CLRIUU
  
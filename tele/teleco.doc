
               REVISED TELECOPY DOCUMENT (05/26/77)


INTRODUCTION
------------

THIS DOCUMENT OUTLINES COMPRESSION SCHEMES AND PROTOCOL FOR A
REVISED TELECOPY FACILITY UTILIZING BUFFERED TERMINAL I/O ON
THE TYMCOM IX, X, AND 370 OPERATING SYSTEMS.  ALL NUMBERS ARE
EXPRESSED IN THE OCTAL RADIX UNLESS OTHERWISE NOTED.

TALK MODE
---------

TELECOPY CONSISTS OF TWO PROGRAMS, A CONTROLLER AND SLAVE.  THE
CONTROLLER IS OPERATED BY, OR CAUSED TO OPERATE, BY THE
USER.  IT HAS A COMMAND PARSER FOR ACCEPTING FILENAMES AND COMMANDS.
IT BUILDS AN AUXILLIARY CIRCUIT TO A SYSTEM OTHER THAN THE ONE
WHERE THE CONTROLLER IS RUNNING, WHERE IT USUALLY STARTS THE SLAVE
PROGRAM WHICH CAN COMMUNICATE WITH THE CONTROLLER.

IT IS SOMETIMES USEFUL TO INTERACT DIRECTLY WITH THE SLAVE SYSTEM
IN ORDER TO ALTER THE SLAVE MACHINE'S USER ENVIRONMENT.  AN EXAMPLE
IS THE REQUIREMENT TO LINK TO OTHER DISCS OR TO SEARCH FOR A FILENAME
SO THAT TELECOPY CAN BE USED.  THE "TALK" FACILITY IN TELECOPY PERMITS
THE USER TO ENTER TEXT FROM HIS KEYBOARD AND HAVE IT SENT TO THE
SLAVE SYSTEM.

THE TALK COMMAND IN TELECOPY TAKES AN OPTIONAL SYSTEM NO.  IF THE
SYSTEM NO. IS OMITTED, THEN THE EXISTING AUXILLIARY CIRCUIT
IS USED (AN ERROR CONDITION IS REPORTED IF NO CIRCUIT YET EXISTS)
TO SEND A QUIT CODE TO THE TELECOPY SLAVE (CODE 136).  ECHOING
IS DONE BY THE CONTROLLER, SO THAT DOUBLE ECHO MAY BE EXPECTED.

WHEN THE SYSTEM NO. IS SPECIFIED WITH THE TALK COMMAND, THE ACTION
IS THE SAME AS DESCRIBED ABOVE IF THE SYSTEM NO. IS THE SAME AS
THE SYSTEM TO WHICH AN EXISTING CIRCUIT IS BUILT.  IF NO CIRCUIT
CURRENTLY EXISTS OR A DIFFERENT SYSTEM NO. IS SPECIFIED, THEN
THE EXISTING CIRCUIT IS BROKEN AND A NEW CIRCUIT IS BUILT TO
THE LOGGED-IN USERID ON THE NEW SYSTEM.  THE TELECOPY SLAVE
IS NOT STARTED AT THIS TIME, BUT ONLY AFTER TALK MODE HAS BEEN
EXITED AND SOME OTHER TELECOPY FACILITY IS INVOKED.

TALK MODE CAN BE EXITED BY TYPING A %%F AT THE KEYBOARD.

IF THE USER QUITS THE TELECOPY CONTROLLER, ALL CIRCUITS ARE BROKEN.

DATA MODES
----------

TELECOPY SUPPORTS SEVERAL DATA AND COMPRESSION MODES.  THE CONTROLLER
KEEPS A LIST OF TRANSMITTER AND RECEIVER PARAMETERS.  THE TRANSMIT
PARAMETERS ARE SENT TO THE SLAVE WHEN THE SLAVE IS THE DONOR.  THE 
RECEIVE PARAMETERS ARE SENT TO THE SLAVE WHEN THE SLAVE IS THE
RECEIVER.

THE DEFAULT TRANSMIT AND RECEIVE PARAMETERS ARE DETERMINED BY CONTROLLER
AND SLAVE TYPE.  WHEN THESE ARE UNEQUAL, THE PARAMETERS WILL BE INITIALIZED
TO PROVIDE ASCII TRANSMISSION WITH RANK COMPRESSION.  WHEN THE CONTROLLER/
SLAVE TYPES ARE EQUAL, THEN THE FOLLOWING PARAMETERS PREVAIL:

       1.  940 TRANSMIT        RECEIVE
               BINARY          BINARY
               BYTESIZE=8      BYTESIZE=8
               BLOCKING=3      BLOCKING=3
               FILL=LEFT       FILL=LEFT
               RANK AUTO COM-  RANK AUTO COM-
               PRESSION.       PRESSION.

       2.  10  TRANSMIT        RECEIVE
               BINARY          BINARY
               BYTESIZE=7      BYTESIZE=7
               BLOCKING=5      BLOCKING=5
               FILL=LEFT       FILL=LEFT
               RANK AUTO COM-  RANK AUTO COM-
               PRESSION.       PRESSION.

       3.  370 TRANSMIT        RECEIVE

               BINARY          BINARY
               BLOCKING=4      BLOCKING=4
               BYTESIZE=8      BYTESIZE=8
               DUPLICATE       DUPLICATE
               PRESSION        PRESSION
               METHOD          METHOD

THERE WILL BE A MODE COMMAND WHICH ALLOWS THE USER TO OVERRIDE THE
TRANSMIT AND RECEIVE PARAMETERS WITH HIS OWN SELECTION.  THE FORMAT OF
THIS COMMAND IS:

                [ ASCII  ]
                [ EBCDIC ]
MODE [TRANSMIT] [ BINARY ] [BYTESIZE=N] [BLOCKING=N] [FILL=LEFT/RIGHT]
     [RECEIVE ] [KATAKANA]
                [ SERIAL ]
                [ IMAGE  ]

WHEN [TRANSMIT/RECEIVE] ARE OMITTED, BOTH SETS OF PARAMETERS ARE UPDATED.
AT RUN TIME THE TRANSMIT AND RECEIVE TABLES WILL BE CHECKED AND NO
TRANSMISSION WILL TAKE PLACE IF MIXED MODE IS DETECTED.  NOTE THAT IN
BINARY MODE, THE TRANSMITTER AND RECEIVER MAY HAVE DIFFERENT BYTESIZE
AND/OR FILL AND/OR BLOCKING SPECIFICATIONS.


IN ORDER TO OVERRIDE THE DEFAULT COMPRESSION MODES, A COMPRESSION
COMMAND WILL BE IMPLEMENTED.  THE FORMAT OF THIS COMMAND IS AS FOLLOWS:

COMPRESS [    OFF ]
         [ DUPLICATE ]
         [  RANK ] [ AUTO ]

MODES OF DATA TRANSMISSION
--------------------------

BINARY MODE--  THE DONOR PRECEDES TRANSMISSION WITH AN 8-BIT BYTE WHICH
               CONTAINS THE FOLLOWING THREE PARAMETERS:
       BYTESIZE - 3 BITS - FROM 1 TO 8 BITS.  DATA IS ALWAYS TRANSMITTED
               IN 8-BIT BYTES THROUGH TYMNET.  ONLY THE LEAST
               SIGNIFICANT "BYTESIZE" BITS OF THE BYTE CONTAIN DATA.
       BLOCKING FACTOR - 4 BITS - THE NO. OF BYTES TO BE STORED IN THE
               RECEIVER'S MACHINE WORD.
       LEFT/RIGHT FILL - 1 BIT - IF ONE, THEN FILL IS FROM THE LEFT.  IF
               NOTE:  WHEN THE RECEIVER'S WORDSIZE IS NOT AN EVEN MULTIPLE
               OF THE BYTESIZE, A PARTIAL BYTE MAY EXIST TO THE RIGHT
               (LEFT) OF THE BLOCKED DATA WHEN LEFT(RIGHT)
               FILL IS USED.  THIS PARTIAL BYTE SHOULD BE ZEROED BY
               THE RECEIVER.
               ANY UNFILLED BYTES IN THE RECEIVER'S WORD ARE TO BE ZEROED.

SERIAL--       THE DONOR TRANSMITS THE CONTENTS OF THE SEND FILE BITWISE,
               WHICH WILL BE STORED SERIALLY IN THE RECEIVER'S FILE.
               A COUNT OF THE TOTAL NO. OF BITS IN THE FILE IS SENT AT
               THE END OF TRANSMISSION TO AID IN TRUNCATING A FILE TO
               THE CORRECT SIZE.
               NO INFORMATION ABOUT THE STRUCTURE OF THE
               FILE (E.G. RECORD LENGTHS) OR OTHER THAN DATA ACTUALLY
               CONTAINED IN THE FILE, WILL BE TRANSMITTED.  IF STRUCTURAL
               INFORMATION MUST BE SENT, IT SHOULD BE ADDED TO THE CONTENTS
               OF THE FILE BY SOME PROCEDURE BEFORE SENDING.

IMAGE--        SAME AS SERIAL MODE, BUT THE DATA PRESENTS AN IMAGE OF A
               HYPOTHETICAL FILE SYSTEM WHEREIN VARIABLE-LENGTH RECORDS
               ARE REPRESENTED AS TWO BYTES CONTAINING THE DATA LENGTH
               (IN 8-BIT BYTES) OF A DATA STRING WHICH FOLLOWS.  THE
               TYMCOM 370 WILL USE THIS INFORMATION
               TO CREATE A V-FORMAT FILE WITH THE INDICATED RECORD LENGTHS,
               AND WILL USE THIS MODE TO COPY AN IMAGE OF A V-FORMATTED FILE
               TO THE TYMCOM IX OR X.

ASCII--        THE DONOR CONVERTS ITS DATA STREAM TO EXTERNAL ASCII
               WITHOUT PARITY (BYTESIZE=7).  TABS ARE CONVERTED TO BLANKS.
               A RECORD SEPARATOR (RS=36) REPLACES THE END-OF-RECORD
               CHARACTER SEQUENCE.  AN ESCAPE CODE (ESC=33) PREFIXES
               THE CHARACTERS ESC=33 AND RS=36.  NOTE:  CR ONLY (OVERPRINT)
               IS SENT AS CR=15.

KATAKANA--     LIKE ASCII EXCEPT THAT THE DONOR CONVERTS ITS DATA STREAM
               TO THE KATAKANA CHARACTER SET (SOMEWHAT LARGER THAN ASCII).

EBCDIC--       LIKE ASCII EXCEPT THAT BYTESIZE=8 AND TABS ARE NOT
               EXPANDED.  PROVIDES A CONVENIENT METHOD FOR IMAGE COPY
               OF A FILE WITH VARIABLE-LENGTH RECORDS FROM ONE EBCDIC
               MACHINE TO ANOTHER.

BANDWIDTH OPTIMIZATION
------------------------

DUPLICATE COMPRESSION-- THE DONOR WILL COMPRESS ANY BYTE REPEATED MORE THAN
               THREE TIMES WITH THREE BYTES:
               CONTROL ESCAPE CODE-- EM=31
               CONTROL CODE-- BS=10 THRU ?=77.  REPEAT COUNT BIASED BY 4.
               DATA BYTE TO BE REPEATED

               IN ADDITION, THE DONOR SETS A PREFERED COMPRESSION
               CHARACTER (USUALLY NUL=0 OR BLANK=40) SO THAT ANY
               PREFERED CHARACTER REPEATED MORE THAN TWICE MAY
               BE REPRESENTED BY TWO BYTES:
               CONTROL ESCAPE CODE-- EM=31
               CONTROL CODE-- 200 THRU 377.  REPEAT COUNT BIASED BY 125.

               ONE CODE, CAN=30, IS USED TO ESCAPE CAN =30 AND EM=31
               EXCEPT WHEN THESE
               BYTES ARE PROPERLY ESCAPED BY THE REPEATED BYTE SEQUENCE.


               DUPLICATE COMPRESSION IS THE DEFAULT COMPRESSION MODE FOR
               BOTH ASCII AND BINARY TRANSMISSION.

RANK COMPRESSION-- THE DONOR HAS THE OPTION OF INVOKING RANK COMPRESSION
               MODE.  BYTESIZE IS GENERALLY 7 OR 8.

               WHEN A FILE IS TRANSMITTED THE FIRST FEW SECONDS
               OF TRANSMISSSION WILL BE SENT USING DUPLICATE COMPRESSION.
               THIS PERIOD WILL BE USED TO BUILD A RANK TABLE FOR
               THE CHARACTER SET.  THE DONOR THEN SENDS A LOGICAL RECORD
               CONTAINING THE FIRST 62 BYTES OF THE TRANSPOSE OF THE RANK
               VECTOR.  ON RECEIPT OF THIS LOGICAL RECORD THE RECEIVER
               ENTERS RANK DECOMPRESSION MODE.

               THERE ARE 8 MASTER CHARACTERS, 21 COMBINING CHARACTERS,
               AND 62 TRANSLATING CHARACTERS IN THE COMPRESSION
               ALGORITHM.  CODES THAT CANNOT BE HANDLED WILL BE
               ESCAPED BY PRECEDING THEM WITH THE DATA ESCAPE CODE
               CAN=30.  THE CONTROL ESCAPE CODE WILL BE EM=31.
               168 CODES ARE REQUIRED FOR REPRESENTING CHARACTER
               COMBINATIONS (8*21).  THESE ARE CODES 130-377.  THE
               HIGHEST RANKING 8 CHARACTERS WILL OCCUPY CODES 32-41.
               THE COMBINING CHARACTERS OCCUPY CODES 32-56.  THE
               TRANSLATING CHARACTERS OCCUPY 32-127.

               ONE CODE, CAN=30, IS USED TO ESCAPE ALL BYTES WHICH
               CANNOT BE TRANSLATED OR COMBINED.

               AFTER COMPACTION, THE ALGORTITHM LOOKS FOR REPEATING
               BYTES AND REPRESENTS THEM USING THE EM=31 CODE
               TO PREFIX THE COUNT AND THE BYTE TO BE REPEATED.
               THE MOST COMMONLY OCCURING CHARACTER AFTER COMPACTION
               SHOULD BE 130.  CODES BS=10 THRU ETB=27 ARE USED
               TO REPRESENT 2 THRU 17 OF THE MOST COMMONLY OCCURING
               PAIR, TYPICALLY 4 THRU 34 BLANKS.

               THE EM-- 200 THRU 377 SEQUENCE IS NOT NEEDED HERE AS IN
               DUPLICATE COMPRESSION.  CONCEIVABLY THE SEQUENCE COULD BE
               USED TO REPRESENT MORE THAN 68 BLANKS.

OCTAL  DECIMAL   DUPLICATE COMPRESSION  RANK COMPRESSION
0-7    0-7         NOT USED            DATA
10     8           2 OF MOST COMMON    DATA
11                 3      CHARACTER    DATA
12     10          4    COMBINATION.   DATA
13     11          5                   DATA
14     12          6                   DATA
15     13          7                   DATA
16     14          8                   DATA
17     15          9                   DATA
20     16          10                  DATA
21     17          11                  DATA
22     18          12                  DATA
23     19          13                  DATA
24     20          14                  DATA
25     21          15                  DATA
26     2           16                  DATA
27     23          17                  DATA
30     24          DATA ESCAPE         DATA ESCAPE--PRECEDES 30,31
31     25          CONTROL ESCAPE      CONTROL ESCAPE--PRECEDES COUNT OR
                                       CONTROL CODE.
                   COUNT 10-77         COUNT 10-77 REPEAT FOR FOLLOWING
                                       CHARACTER.  BIASED BY 8-4=4
                   COUNT 100-177       COUNT 100-177 RESERVED FOR CONTROL
                   COUNT 200-377       COUNT 200-377 REPEAT FOR PREFERED CHAR.
                   NOT USED.           BIASED BY 128-3=125
32     26          MASTER CHAR OF      DATA
                   RANK 0.
33     27          MASTER CHAR OF      DATA
                   RANK 1.
34     28          MASTER CHAR OF      DATA
                   RANK 2.
35     29          MASTER CHAR OF      DATA
                   RANK 3.
36     30          MASTER CHAR OF      DATA
                   RANK 4.
37     31          MASTER CHAR OF      DATA
                   RANK 5.
40     32          MASTER CHAR OF      DATA
                   RANK 6.
41     33          MASTER CHAR OF      DATA
                   RANK 7.
42-56  34-46       COMBINING CHARS.    DATA
57-127 47-87       TRANSLATING CHARS.  DATA
130-
   377 88-255      COMBINING CHARS.    DATA



CONTROLLER/SLAVE TYPE
---------------------

THE CONTROLLER AND THE SLAVE PERFORM AN INITIAL HANDSHAKE WHICH IS
FOLLOWED BY 1 BYTE WHICH IDENTIFIES THE TYPE OF CONTROLLER OR
SLAVE AND 1 BYTE CONTAINING THE PROTOCOL VERSION NO.

THE FORMAT OF THE SLAVETYPE BYTE IS AS FOLLOWS:
BIT 0 - RESERVED
BIT 1 - I MAY RECEIVE DATA TRANSMITTED WITH RANK COMPRESSION
BIT 2 - I MAY RECEIVE KATAKANA DATA (MODE=5)
BIT 3 - I MAY RECEIVE BINARY DATA
BIT 4 - I MAY RECEIVE BINARY DATA IN UPDATE MODE
BITS 5-7 MACHINE TYPE: 1=940; 3=PDP-10; 4=370

AT LEAST ONE OF THE CAPABILITIES IMPLIED BY BITS 1-4 MUST BE
IMPLEMENTED TO INVOKE THE PROTOCOL DESCRIBED IN THIS DOCUMENT.  IN ADDITION,
IT MAY BE ASSUMED THAT ALL CONTROLLERS AND SLAVES ARE CAPABLE OF ASCII MODE
(MODE=1) AND MAY RECEIVE DUPLICATE COMPRESSED DATA RECORDS.


SUMMARY OF CONTROL CODES   (ALL PRECEDED BY CONTROL ESCAPE CODE (EM))
------------------------

DNRCOD
101    REQUEST SLAVE TO BE THE DONOR.  NO RESPONSE WILL BE GIVEN.
RCVCOD
102    REQUEST SLAVE TO BE THE RECEIVER.  NO RESPONSE WILL BE GIVEN.
FLKCOD
103    FILE NAME FOLLOWS AFTER 1 BYTE WHICH TELLS HOW MANY BYTES FOLLOW
       THE FILE NAME STRING BEGINS WITH USER NAME ENCLOSED IN PARENTHESES.
       THE SLAVE LOOKS UP THE USER NAME IN THE LUD AND RETURNS A
       ULKSCD IF FOUND OR A ULKFCD IF NOT FOUND.  IF THE SLAVE AND CONTROLLER
       TYPE ARE BOTH 940 THEN A SUPER GFD IS PERFORMED TO REACH THE
       FILE DIRECTORY OF THE SPECIFIED USER, AND GAN,FDPT, AND UUN FROM
       THE LUD ENTRY ARE RETURNED AS 9 BYTES.  THEN:
       SLAVE LOOKS UP THE FILE.  IF THE SLAVE TYPE AND CONTROLLER
       TYPE ARE BOTH 940 THEN THE USUAL SECURITY RULES ARE RELAXED
       AND THE LOOKUP SUCCEEDS IF THE FILE IS PRESENT, RETURNING 9
       BYTES CONTAINING INFORMATION FROM THE FIRST 3 WORDS OF THE
       FILE DIRECTORY ENTRY.
SUCCOD
104    OPTION ACCEPTED
FLKFCD
106    FILE NOT FOUND (NOT AN ERROR)
ABTCOD
107    STOP WHAT YOU ARE DOING, ABORT
BCMCOD
110    START DATA RECORD, BINARY COMPRESSION METHOD
ACMCOD
111    START DATA RECORD, RANK COMPRESSION METHOD
ACKCOD
112    ACKNOWLEDGEMENT THAT RECORD CHECKSUM AND BYTECOUNT MATCH
NAKCOD
113    CHECKSUM OR BYTECOUNT DO NOT MATCH--RESEND RECORD
FINCD1
114    DONOR HAS SENT ALL RECORDS IN FILE AND IS HAPPY.  FOLLOWED BY
       CPTOP1 AND CPTOP2 FOR RENAMING A FILE TO THE PROPER LENGTH IN
       BINARY MODE.  CPTOP1 IS SENT WITH A 1 BYTE HEADER CONTAINING BYTE
       COUNT FOR REMAINDER OF CPTOP1.  CPTOP2 IS SENT AS A SINGLE BYTE.
       CPTOP1 IS THE NUMBER OF WHOLE 8-BIT BYTES, AND CPTOP2 IS THE NO.
       OF BITS REMAINING.  WHEN DONOR AND RECEIVER ARE BOTH 940 CPTOP2=0
       AND CPTOP1 WILL BE SENT AS FOUR BYTES: 3 X X X.
FINCD2
115    RECEIVER HAS WRITTEN AND CLOSED FILE SUCCESSFULLY
FPFCOD
116    FILE PROTECTION FAILURE
OPFCOD
117    OPEN FAILURE
*      CODES 120-130 SPECIFY OPTIONS TO THE SLAVE.  RESPONSE IS 104
*      TO ACKNOWLEDGE OR 133 IF THE REQUESTED MODE IS NOT SUPPORTED.
*      133 IS NOT CONSIDERED TO BE AN ERROR.
120    RESERVED
CPACOD
121    SPECIFY COMPRESSION.  FOLLOWED BY 1 BYTE:
       0= NONE
       1= BINARY (DEFAULT)
       2= RANK
       3= RANK AUTO (THE DONOR COMPRESSION ALGORITHM MAY DECIDE
       FOR ITSELF WHETHER OR NOT TO INVOKE RANK COMPRESSION)
ONLCOD
122    ON LOWER CASE
       FOLLOWED BY ONE BYTE (ALL 1'S) TO PERMIT LOWER CASE (DEFAULT)
       IF THE BYTE FOLLOWING IS ALL 0'S THEN CONVERT LOWER TO UPPER CASE.
123    RESERVED.
TRUCOD
124    THIS CODE FOLLOWED BY ONE BYTE WHICH INDICATES TRUNCATE RECORD
       STARTING WITH COLUMN INDICATED BY VALUE OF BYTE.  IF VALUE OF
       BYTE IS 0 TURN OFF TRUNCATION.
TRICOD
125    SUPPRESS TRAILING BLANKS (TRIM)
       FOLLOWED BY ONE BYTE (ALL 1'S) TO SUPPRESS TRAILING BLANKS
       IF THE BYTE FOLLOWING IS ALL 0'S THEN DO NOT SUPPRESS (DEFAULT).
126    RESERVED
VARCOD
127    PRODUCE VARIABLE LENGTH RECORDS (DEFAULT)
       FOLLOWED BY 4 BYTES GIVING MAXIMUM RECORD SIZE (TYPICALLY 65535)
FIXCOD
130    PAD WITH BLANKS TO MAKE FIXED LENGTH RECORDS.
       FOLLOWED BY 4 BYTES OF RECORD LENGTH.
LOGCOD
131    TELL SLAVE TO LOG OFF
CHKCOD
132    START FILE DATA CHECKSUM RECORD
NICOD
133    REQUESTED OPERATION NOT IMPLEMENTED
EORCOD
134    END OF TRANSMISSION RECORD
EOTCOD
135    TRANSMISSION RECORD IS LAST IN FILE
QUICOD
136    ABORT THE CURRENT OPERATION (LIKE 107).  QUIT THE SLAVE AND
       RETURN TO THE OPERATING SYSTEM COMMAND LEVEL.
OPNCOD
137    REQUEST SLAVE OPEN FILE FOR DATA TRANSFER (DIRECTION
       DETERMINED BY PREVIOUS 101 OR 102 CODE.  FOLLOWED BY 1 BYTE
       TRANSMISSION TYPE, AND POSSIBLY, OTHER BYTES:
       TYPE = 1 ASCII MODE TRANSFER.  NO BYTES FOLLOW.
       TYPE = 2 EBCDIC MODE TRANSFER.  NO BYTES FOLLOW.
       TYPE = 3 BINARY MODE TRANSFER.  THE RECEIVE FILE, IF PRESENT,
       IS TO BE ERASED.  FOLLOWED BY 1 BYTE OF BINARY PARAMETERS.
       TYPE = 4 BINARY UPDATE MODE.  DONOR AND RECEIVER WILL EXCHANGE
       CHECK RECORDS.  FOLLOWED BY 1 BYTE OF BINARY PARAMETERS AND 2
       BYTES OF UPDATE MODE BLOCKSIZE.
       TYPE = 5 KATAKANA MODE TRANSFER.  LIKE ASCII MODE.
       TYPE = 6 IMAGE MODE.  SERIAL DATA TO BE SPECIALLY INTERPRETTED.
               (SEE DESCRIPTION ABOVE).
       POSSIBLE RESPONSES ARE:  133 (UPDATE MODE NOT IMPLEMENTED OR
       PARAMETERS NOT ACCEPTABLE), 104 (FILE OPENED), 116 (FILE PROTECTION
       FAILURE), OR 117 (FILE OPEN FAILURE).
FENQCD
140    REQUEST SLAVE DONOR TO SEND FILE ATTRIBUTES.  RETURNS 104 PLUS 1
       BYTE CONTAINING COUNT OF BYTES FOLLOWING.
FATTCD
141    PREPARE SLAVE RECEIVER TO OPEN FILE.  FOLLOWED BY 1 BYTE CONTAIN
       COUNT OF BYTES FOLLOWING.  WHEN DONOR ANEIVER ARE BOTH 940
       TYPE SEND 9 BYTES:  3 BYTES FFDPT (FILE DIR POINTER OF SEND FILE),
       3 BYTES FDWD0, AND 3 BYTES FDWD2.
       NO RESPONSE WILL BE GIVEN.
INSCOD
142    CODE FOLLOWED BY 6 BYTES TO SET INSTALLER'S LICENSE BIT
       NO RESPONSE WILL BE GIVEN.
WHYCOD
143    SOLICIT EXPLANATION OF LATEST ERROR
RSPCOD
144    CODE FOLLOWED BY ASCII STRING TERMINATED BY A NUL OR ANY
       CONTROL CODE (PREFRABLY ABTCOD).
BADCOD
145    UNEXPECTED CONTROL CODE.  FOLLOWED BY 1 BYTE CONTAINING THE OFFENDING
       CODE.
ERRCOD
146    FILE SYSTEM ERROR READING OR WRITING FILE
PERCOD
147    FILE SYSTEM ERROR POSITIONING FILE
ERASCD
150    FILE SYSTEM ERROR ERASING RECEIVE FILE
TRPCOD
152    PROGRAM TRAP
FLKRCD
153    FILE LOOKUP FAILURE (OTHER THAN PROTECTION FAILURE OR FILE MISSING)

A NOTE ON ERROR PROCESSING:  A PROGRAM THAT DETECTS AN ERROR
SENDS ONE OF THE ERROR CODES (106,113,116,117,120,133,145-153)
EXPECTS ACKNOWLEDGEMENT, GENERALLY IN THE FORM OF AN ABTCOD
TO INDICATE THAT THE OTHER END HAS BEEN NOTIFIED AND HAS RESET
(BUT NOT ZAPPED) THE CIRCUIT.  IF NO ACKNOWLEDGEMENT IS RECEIVED
IN 30 SECONDS THE PROGRAM WHICH DETECTED THE ERROR SHOULD ZAP THE
CIRCUIT.
NOTE THAT NAKCOD=133 IS ACKNOWLEDGED BY A RETRANSMISSION OF A DATA
OR CHECK RECORD.

SOME SITUATIONS ARE NOT CONSIDERED TO BE AN ERROR.  IT IS PERFECTLY
ACCEPTABLE TO SEND A FAILCD ON A FILE LOOKUP OR A NICOD ON AN OPTION.
USE FLKRCD FOR AN UNEXPECTED ERROR ON A FILE LOOKUP.

NICOD IN RESPONSE TO AN OPNCOD INDICATES THAT THE MODE REQUIRED IS
NOT IMPLEMENTED.  THIS SHOULD BE TREATED AS AN ERROR.  THE REQUESTED
MODE SHOULD NOT HAVE BEEN REQUESTED SINCE THE CAPABILITIES OF THE
PROGRAM ARE KNOWN TO THE OTHER END.






RULES GOVERNING FILE TRANSMISSION
---------------------------------

1.  THE RECEIVER GOES INTO BLOCK INPUT MODE AND SENDS A 104 (SUCCESSFUL
FILE OPEN) IF IT IS THE SLAVE, OR A FILE OPEN COMMAND (137) IF IT
IS THE CONTROLLER.  THE 104 OR 137 CODE INDICATES THAT THE RECEIVER
IS READY TO ACCEPT DATA RECORDS FROM THE DONOR.

2.  THE RECEIVER REMAINS IN BLOCK INPUT MODE UNTIL IT RECEIVES AN
ABORT (107) CODE, LOGOFF (131) CODE, END-OF-FILE (135) CODE, END-
OF TRANSMISSION (114) CODE, OR UNSUCCESSFUL FILE OPEN (116 OR 117) CODE.
NOTE THAT END-OF-FILE (135) DOES NOT TERMINATE BLOCK INPUT MODE IF THE
RECORD CHECKSUM AND BYTECOUNT ARE INVALIDATED BY THE RECEIVER.

3.  ALL CONTROL MESSAGES AND RECORDS RECEIVED WHILE IN BLOCK INPUT MODE
MUST BE TERMINATED WITH A YELLOW BALL WHICH THE BASE SEES AS A TERMINATION
CONDITION FOR THE CURRENT I/O OPERATION.  THE PROTOCOL IS DESIGNED SO
THAT SHORT MESSAGES CAN BE AVOIDED.  AN EXCEPTION IS THE RECEIPT OF A
FILE OPENING ERROR (116 OR 117) CODE WHEN THE DONOR IS THE SLAVE PROGRAM.
ANOTHER POSSIBLE EXCEPTION IS IN UPDATE MODE AFTER RECEIVING THE LAST
CHECK RECORD FROM THE RECEIVER.  IF THE DONOR FINDS NO DIFFERENCES,
IT WILL SEND AN END-OF-TRANSMISSION (114) CODE TO THE RECEIVER WHICH
IS IN BLOCK MODE AWAITING SHIPMENT OF A DATA RECORD.

PHYSICAL RECORD LENGTHS SHOULD BE AS LONG AS POSSIBLE TO ELIMINATE LOST 
BANDWIDTH DUE TO TURNAROUND DELAYS.  A 4 SECOND TURNAROUND DELAY ON AN 
ACKNOWLEDGEMENT COSTS ABOUT 1600 DATA CHARACTERS.  THE 940 WILL USE A RECORD
SIZE OF 122,880 CHARACTERS, SO THAT THE TURNAROUND WILL COST 1.3% OF BANDWIDTH.
IF A RECORD RETRANSMISSION SHOULD BE REQUIRED, THIS RECORD SIZE WILL
REQUIRE AT LEAST 5 MINUTES ADDITIONAL TRANSMISSION TIME.

IN GENERAL, ALL RECORDS HAVE THE SAME FORMAT:

       LOGICAL RECORD

1 BYTE CONTROL ESCAPE (EM)
1 BYTE RECORD TYPE (110,111,132)
N DATA BYTES
       
       LOGICAL RECORD

       .

       .

1 BYTE CONTROL ESCAPE (EM)
1 BYTE RECORD TERMINATION TYPE (END-OF-RECORD = 134 OR END-OF-FILE = 135)
3 BYTES RECORD CHECKSUM
3 BYTES RECORD BYTECOUNT
YELLOW BALL  (MAY OR MAY NOT BE REFLECTED)

THE MAXIMUM BYTE COUNT THAT MAY BE SENT IS 2**23-1 BYTES.  THE RECORD
SIZE IS ARBITRARILY ESTABLISHED AT THE CONVENIENCE OF THE DONOR PROGRAM.
THE CHECKSUM IS CALCULATED BY ADDING EACH DATA BYTE INTO A 24 BIT
ACCUMULATOR, IGNORING OVERFLOW.  ALL BYTES (INCLUDING THE INITIAL CONTROL
ESCAPE CODE) ARE INCLUDED IN THE RECORD CHECKSUM.  ONLY THE SIX BYTES
FOLLOWING END-OF-RECORD ARE NOT INCLUDED.

4.  PHYSICAL RECORDS WILL BE ACKNOWLEDGED WITH A 112 CODE IF THE RECORD
CHECKSUM AND BYTECOUNT ACCUMULATED BY THE RECEIVER AGREE WITH THE DONOR.
AN EXCEPTION IS THE CHECK (132) TYPE RECORD, WHICH IS ACKNOWLEDGED
WITH A CHECK (132) RECORD FROM THE RECEIVER.  THE RECEIVER'S CHECK RECORD
IS ACKNOWLEGED BY RECEIPT OF A DATA RECORD TYPE (110,111), ANOTHER
CHECK RECORD, OR A END-OF-TRANSMISSION (114).

5.  AFTER THE LAST RECORD IN THE FILE HAS BEEN SENT AND ACKNOWLEDGED,
THE DONOR SENDS A END-OF-TRANSMISSION (114) CODE.  THE RECEIVER
ACKNOWLEDGES THAT IT HAS SUCCESSFULLY CLOSED THE FILE BY SENDING A
CLOSURE CODE (115).  THE RECEIVER IS NOW AT ITS COMMAND LEVEL AND
NOT IN BLOCK INPUT MODE.


LOGICAL RECORD TYPES
--------------------

A.  DATA RECORDS

TYPE 1 -       ANY MODE, BINARY COMPRESSION

1 BYTE CONTROL ESCAPE (EM)
1 BYTE RECORD TYPE (110)
1 BYTE PREFERRED CHARACTER
N BYTES FILE DATA


TYPE 2 -       ANY MODE, RANK COMPRESSION

1 BYTE CONTROL ESCAPE (EM)
1 BYTE RECORD TYPE (111)
62 BYTES RANK TABLE
N BYTES FILE DATA


B.  CHECK RECORD

1 BYTE CONTROL ESCAPE (EM)
1 BYTE RECORD TYPE (132)
1 BYTE BLOCK COUNT (1 TO 63 BLOCKS).  0= 1 BLOCK.
M BYTES CHECKSUM INFORMATION (9 BYTES/BLOCK)


ESCAPE CHARACTERS
-----------------

A DATA ESCAPE CHARACTER (CAN=30) PRECEEDS DATA BYTES WHICH MIGHT
OTHERWISE BE INTERPRETED AS CONTROL INFORMATION.  IT OCCURS VERY COMMONLY
IN RANK COMPRESSED DATA.  NOTE THAT NO DATA ESCAPE CHARACTER IS NEEDED
WHENEVER A KNOWN NUMBER OF BYTES FOLLOWS A CONTROL CODE.  THUS IT IS
NOT NECESSARY TO USE DATA ESCAPE IN RECORD CHECKSUMS OR RECORD BYTE COUNTS.


UPDATE FILEMODE
---------------

BINARY TRANSMISSION BETWEEN LIKE HOST MACHINES CAN BE AIDED BY
COMPARING FILES AND TRANSMITTING ONLY BLOCKS WHICH ARE DIFFERENT.
THE DONOR AND RECEIVER EXCHANGE CHECKSUM RECORDS FOR
BLOCKS OF SIZE KNOWN TO BOTH (THE UPDATE MODE BLOCKSIZE SENT WITH
CONTROL CODE 137).

ALL MACHINES MUST USE THE SAME CHECKSUM ALGORITHM TO FOLD THE SPECIFIED
NO. OF BYTES INTO A 69-BIT CHECKSUM FOR COMPARISON.  EACH BLOCK CHECKSUM
CONTAINS THE SAME NO. OF BYTES, ASSUMING THAT BYTES READ PAST THE END
OF THE FILE ARE ZERO.  THE ALGORITHM COMPUTES C = P1*2**46+P2*2**23+P3
WHERE P1 = P1*13 + DATA BYTE, P2 = P2*17 + DATA BYTE, AND P3 =
P3*19 + DATA BYTE.  ONLY 23 BITS OF INTEGER PRODUCTS ARE KEPT.
THE DONOR BUILDS A CHECK RECORD BY READING THE DATA FILE AND
COMPUTING BLOCK CHECKSUMS UNTIL 256 BLOCKS HAVE BEEN READ OR END-OF-FILE.
THE DONOR SENDS THE COMPLETED CHECK RECORD TO THE RECEIVER, WHICH
THEN BUILDS A CHECK RECORD FOR THE SAME NO. OF BLOCKS FROM THE RECEIVE
FILE.  THE RECEIVER RETURNS ITS CHECK RECORD AND WAITS FOR DATA
OR ANOTHER CHECK RECORD TO FOLLOW.

DONOR CHECK RECORDS ARE ALWAYS TERMINATED WITH AN END-OF-RECORD
CODE SO THAT THE RECEIVER REMAINS IN BLOCK INPUT MODE, AWAITING EITHER
A CHECK OR DATA RECORD.  RECEIVER CHECK RECORDS ARE ALWAYS TERMINATED
WITH A END-OF-FILE CODE SO THAT THE DONOR WILL GET OUT OF BLOCK INPUT
MODE AFTER RECEIPT OF EACH RECEIVER CHECK RECORD.
THE DONOR COMPARES ITS CHECK RECORD AGAINST THAT FROM THE RECEIVER,
AND BUILDS DATA RECORDS FOR THE BLOCKS THAT DIFFER.  WHEN THESE
ARE READ BY THE RECEIVER, IT UPDATES THE FILE BY COMPARING ITS
CHECK RECORD AGAINST THE DONOR'S CHECK RECORD.

AT END-OF-FILE THE DONOR SENDS AN END-OF-TRANSMISSION CODE WHICH
CAUSES THE RECEIVE FILE TO BE RENAMED TO THE CORRECT DATA LENGTH.
THE DATA LENGTH IN BITS MAY BE CALCULATED FROM CPTOP1*8+CPTOP2.
 T w4
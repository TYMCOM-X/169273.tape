	SEXTERN DDT

	DPTR=1		;DATA BUFFER POINTER
	CPTR=2	;CORE LOAD POINTER
	D=3		;DATA WORD AC

	.MTREW==1
	.MTSKF==16
	.MTWAT==0
	.MTDEC==100
	LOC	140
	BLOCK	50000

	LOC	100000
ST:	JFCL


INIT:	OPEN	1,OPNBLK	;OPEN TAPE CHANNEL
	 JSR	ERROR
	MTAPE	1,.MTDEC	;DEC 9CH MODE
	MTAPE	1,.MTREW	;REWIND
	MTAPE	1,.MTSKF	;SKIP 3 FILES
	MTAPE	1,.MTSKF
	MTAPE	1,.MTSKF
	MTAPE	1,.MTSKF
	MTAPE	1,.MTSKF	;
	MTAPE	1,.MTSKF	;
	MTAPE	1,.MTWAT	;WAIT FOR COMPLETION
	MOVE	10,[IOWD ^D512,BUFF]
	MOVEM	10,INBLK
	IN	1,INBLK		;READ FILE
	JRST	.+2
	 JSR	ERROR
	ADDI	10,^D512
	JRST	.-5
	JRST	STACK		;GO STACK DATA IN CORE
	 JSR	ERROR

STACK:	MOVEI	DPTR,BUFF	;GET POINTER TO DATA BUFFER
	
PTR:	MOVE	CPTR,(DPTR)	;GET POINTER WORD
	SKIPL	CPTR		;SKIP IF NEG (PTR)
	 JRST	XFRWD		;MUST BE XFER WORD
DLOOP:	AOS	DPTR		;INCR DATA PTR
	MOVE	D,(DPTR)	;GET DATA WORD
	MOVEM	D,1(CPTR)	;PUT IN CORE
	AOBJN	CPTR,DLOOP	;LOOP FOR MORE
	AOS	DPTR		;INNCR DATA BUFFER PTR
	JRST	PTR		;GO GET NEW POINTER

XFRWD:	JRST	DDT


OPNBLK:	17			;DUMP MODE
	SIXBIT/T/		;DEV NAME
	Z			;NNOT BUFFERED MODE

ERROR:	0			;ERROR ROUTINE
	OUTSTR	[ASCIZ/
** MAGTAPE ERROR - STATUS IN ACO **
		 - WORD COUNT IN AC5
/]
	GETSTS	1,0
	MOVE	6,[1,,0]
	UGETF	1,6
	JRST	DDT

INBLK:	IOWD	5000,BUFF
	Z
BUFF:	BLOCK	10000

	END	ST

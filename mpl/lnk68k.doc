                                                                August 17, 1983








                      *     *   * *   *  ****  ***  *   *
                      *     **  * *  *  *     *   * *  * 
                      *     * * * * *   ****   ***  ***  
                      *     *  ** *  *  *   * *   * *  * 
                      ***** *   * *   *  ***   ***  *   *


               -- LINK-LOADER FOR THE M68000 MICRO-PROCESSOR --



                              Manual Prepared by:
                                   MICROTEC

                                  Revised by:
                                   John Kopf
                          NETWORK TECHNOLOGY DIVISION
                                August 17, 1983










     ====================================================================
     |       THIS DOCUMENT IS THE SOLE PROPERTY AND CONFIDENTIAL        |
     |       INFORMATION  OF  TYMSHARE,  INC.,  AND  MAY  NOT BE        |
     |       COPIED  IN  WHOLE OR IN PART  OR  DISCLOSED  TO ANY        |
     |       THIRD PARTY  WITHOUT THE PRIOR  WRITTEN  CONSENT OF        |
     |       TYMSHARE.                                                  |
     ====================================================================













                             M68000 Linking Loader Manual            LNK68K.DOC
                                                                August 17, 1983







                                   TABLE OF CONTENTS

        Section                                                            Page



        1.   INTRODUCTION                                                     1


        2.   LOADER OPERATION                                                 2
          2.1   Absolute Section                                              2
          2.2   Relocatable Section                                           3
          2.3   Noncommon Section                                             3
          2.4   Common Section                                                3
          2.5   Short Section                                                 4
          2.6   Long Section                                                  4
          2.7   Relocation Types                                              6


        3.   LOADER COMMANDS                                                  7
          3.1   SECT  -  Set Section Load Address                             9
          3.2   COMMON  -  Set Common Section Load Address                    9
          3.3   PAGE  -  Set Noncommon Section to be Page Relocatable        10
          3.4   CPAGE  -  Set Common Section to be Page Relocatable          11
          3.5   NOPAGE  -  Turn Off Page Relocatability                      12
          3.6   ORDER   -   Specify Long Section Order                       12
          3.7   SORDER  -   Specify Short Section Order                      12
          3.8   START  -  Specify Output Module Starting Address             14
          3.9   BASE  - Specify Base Address for Program or Overlay          15
          3.10  NAME  -  Specify Output Module Name                          16
          3.11  PRINT  -  Specify Listing-output File-name                   17
          3.12  LOAD  -  Load Specified Object Modules                       17
          3.13  PUBLIC  -  Specify Public Symbols (External Definitions)     19
          3.14  LIST  -  List Specified Elements                             20
          3.15  NLIST  -  Do Not List Specified Elements                     20
          3.16  OVY - Begin Definition of an Overlay                         21
          3.17  ENDOVY - End Overlay Definition                              21
          3.18  BUILD - Build an Overlay                                     22
          3.19  EXIT  -  Exit Loader                                         23
          3.20  END  -  End Command Stream and Finish Loader                 23
          3.21  Comment  -  Specify Loader Comment                           23


        4.   How To Use the Loader                                           24
          4.1   Invocation                                                   24
             4.1.1    Example                                                26

          4.2   Loader Listing                                               26

                             M68000 Linking Loader Manual            LNK68K.DOC
                                                                August 17, 1983


          4.3   Common Problems, or Ways to Screw Up!                        34
             4.3.1    Mis-declared XREF                                      34


                                     APPENDICES
                                     ==========


        I.   LOADER MESSAGES                                                 37
          I-1   COMMAND MESSAGES                                             37
          I-2   LOAD MESSAGES                                                39


                                      INDEX
                                      =====                                  42







































                             M68000 Linking Loader Manual            LNK68K.DOC
        INTRODUCTION                                            August 17, 1983






                                   1 -  INTRODUCTION


             This  manual  describes  Microtec's  68000  Linking   Loader  that
        accompanies the 68000 Relocatable Assembler.  The Linking Loader can be
        used  to  combine several  independently  assembled  relocatable object
        modules  into a  single  absolute object  module.   External references
        between  modules  are  resolved and  the  final  absolute  symbol value
        substituted for each reference.

             The Loader not  only provides for  the linking of  several modules
        and adjusting  the relocatable addresses  into absolute  addresses, but
        allows the program section load addresses to be specified, XDEF symbols
        to be defined, the final starting address and section loading  order to
        be specified.  An optional cross reference listing displays the modules
        in which each XDEF and XREF is defined and/or reference.

             This Linking Loader has the ability to load object modules  from a
        Library.  Microtec's Library Maintenance Program must be used initially
        to create such a library.  Users with small amounts of memory  or large
        programs may divide their absolute object module into several overlays,
        a feature which permits great flexibility in planning memory usage.




























        1                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER OPERATION                                        August 17, 1983






                                 2 -  LOADER OPERATION


             Many programs are  too long to  conveniently assemble as  a single
        module.  To avoid long assembly  times, or to reduce the  required size
        of the Assembler symbol table, programs can be subdivided  into smaller
        modules,  assembled  separately,  and linked  together  by  this loader
        program.  After the separate  program modules are linked and  loaded by
        this program, the output module  functions as if it had  been generated
        by a single absolute assembly.

             The primary functions of the Linking Loader are:

               o       To  resolve external  references  between modules
                       and check for undefined references (linking)

               o       To adjust all relocatable addresses to the proper
                       absolute addresses (loading)

               o       To output the final absolute object module(s)

               o       To  separate  absolute object  code  into overlay
                       files as specified by the user

             To understand the  loading process and to  enable the user  to use
        the Assembler and Linking Loader (hereafter called Loader) effectively,
        the user  should understand  the various  program sections  and section
        load   addresses.    Although  described   in   the   Assembler  Manual
        (ASM68K.DOC), program sections are summarized below.






                                 2.1  Absolute Section


             This section is that part of the assembly program that contains no
        relocatable information but is to  be loaded at fixed locations  in the
        user's memory.  Absolute code is placed into the output  module exactly
        where  specified by  the input  object modules.   Note that  only those
        bytes of memory which actually contain data are considered to be within
        the absolute section;  areas skipped by  a DS directive,  for instance,
        are not included.





        2                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER OPERATION                                        August 17, 1983


                               2.2  Relocatable Section


             This is one of sixteen general purpose sections which  may contain
        both instructions and/or data.   Typically each section is  a logically
        distinct part of  the total program.   Instructions in one  section can
        make reference to any other sections.  Each section is identified  by a
        symbolic  name.   The  same  section  name  may  appear   in  different
        relocatable object  modules.  The  section, as a  whole, refers  to the
        totality of code from all  object modules which is associated  with the
        section  name.   On occasion  it  will  be necessary  to  refer  to the
        individual pieces of code from various modules which make up a section;
        these will be called subsections.

             Each relocatable section has two attributes:  the common/noncommon
        attribute and the short/long attribute.






                                2.3  Noncommon Section


             These  sections  are  the  only  type  available  for  code.   The
        subsections of a noncommon  section are loaded into a  contiguous block
        of memory and do not overlap.   The size of a noncommon section  is the
        sum of the sizes of all its subsections.






                                  2.4  Common Section


             These sections  contain variables that  may be referenced  by each
        module.   All  common  subsections are  loaded  beginning  at  the same
        address providing an effective communication area.  This is  similar to
        FORTRAN Common.  Common sections contain no code.  Variables  in common
        sections may not be initialized.  The length of a common section is the
        size of its largest subsection.










        3                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER OPERATION                                        August 17, 1983


                                  2.5  Short Section


             A section which  may be referenced  by the absolute  short address
        mode and which therefore must be loaded into the areas of  memory which
        can be reached by a 16-bit sign-extended address.  These areas are from
        0  to $7FFF  inclusive,  and from  $FF8000 to  $FFFFFF  inclusive.  The
        loader never puts a short  section in an inappropriate area  of memory.
        A section is designated as  short if any of its subsections  are short,
        or if it appears in a SORDER directive in the Loader commands.






                                   2.6  Long Section


             A section which is not  short and which can be placed  anywhere in
        memory.

             Users with  programs larger than  the available memory  may divide
        the absolute object module into several disjoint overlays.  As the term
        is used in  this manual, an OVERLAY  is one of several  absolute object
        modules  output by  the Loader.   Each relocatable  section  present in
        Loader input will be placed  in exactly one overlay.  A  section cannot
        be  divided  among  overlays.   Sections  within  an  overlay  will not
        overlap, but  sections in different  overlays may  overlap.  Typically,
        one overlay called the root will be present in memory at all  times and
        will contain the necessary code for bringing in other overlays  as they
        are required.  This code must  be provided by the user.   In Microtec's
        Loader, the term root has  a somewhat different meaning than  the usage
        above (which is the 'standard'  meaning): the root is simply  the first
        overlay specified  by the user.   This overlay is  special in  that all
        absolute code, and all relocatable sections which are not  specified to
        be in any overlay, are placed in the root.

             Sections are  assigned space in  memory in an  order which  can be
        controlled by the  user.  Also, the  initial address (Load  Address) of
        any or all sections may be specified; this does not alter the  order in
        which  sections are  assigned  space, but  it affects  the  location in
        memory  of  following  sections  which  do  not  have   Load  Addresses
        specified.

             Several different kinds of  addresses will be referred to  in this
        manual.  It may be useful to define a few terms at this point.   A Load
        Address is the memory address at which the lowest byte of a  section is
        placed.  A Base  Address is the  lowest address considered  for loading
        relocatable sections; either for the absolute object module as a whole,
        or for an  overlay.  Note that  an overlay need  not begin at  its Base
        Address if SECT and/or COMMON commands are used.  A Starting Address is
        the location at which execution will begin.

        4                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER OPERATION                                        August 17, 1983


             A description of the algorithm used to allocate memory follows.

             These  two steps  are performed  within each  overlay, or  once if
        there are no overlays:

               1) Allocate short sections (=Group I)

               2) Allocate long sections (=Group II)

             The order in which sections are assigned memory within their group
        is as follows:

           1)  Any sections named in the  last ORDER command (for Group  II) or
               SORDER command (for Group I), in the sequence in which they were
               named in that command.  If overlays are present, only  the ORDER
               and/or SORDER commands for the current overlay are considered.
           2)  Any other sections  belonging to the  group, in the  sequence in
               which their names were  encountered by the Loader.   If overlays
               are present, all such  sections are placed in the  first overlay
               (the root).  The Loader encounters  a name when it appears  in a
               user command or when a module is loaded (with the  LOAD command)
               which refers to that  name.  Names appear in  relocatable object
               modules  produced by  Microtec's  assembler in  the  sequence in
               which they appeared in directives in the assembler source input.
               Note: Library relocatable object modules which are  not selected
               for inclusion in  the absolute object  module do not  have their
               section names examined by the Loader.

             To assign memory to a section, it is necessary to assign it a Load
        Address.  For those sections whose Load Addresses were specified by the
        user  (in  a SECT  or  COMMON  directive) nothing  more  need  be done.
        Otherwise:

           1)  The  first  short section  is  loaded at  the  Base  Address, as
               specified by  the BASE command.   If overlays are  present, only
               the BASE command for  the current overlay is considered.   If no
               BASE command is given  and no overlays are present,  the default
               Base Address is 0.  If no BASE command is given for  the current
               overlay when overlays are  present, the default Base  Address of
               the  overlay is  0 for  the root  and the  end of  the preceding
               overlay for all other overlays.
           2)  Subsequent  short  sections  are  loaded  immediately  above the
               preceding section, unless this  would cause the high end  of the
               section  to extend  above $7FFF,  in which  case the  section is
               loaded at $FF8000.   The Loader will  not split a  short section
               between low and high memory.
           3)  The first  long section  is loaded  immediately above  the short
               section  most  recently  loaded  into  low  memory.   Caution is
               required because an earlier short section might have been loaded
               into memory above the  most recently loaded short section  (if a
               SECT or COMMON command was used) which will now overlap the long
               section.   The first  long section  will be  loaded at  the Base


        5                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER OPERATION                                        August 17, 1983


               Address,  as  specified in  1)  above, if  there  were  no short
               sections.
           4)  Subsequent long sections  start immediately above  the precedi              long section.






                                 2.7  Relocation Types


             By default,  sections are  word relocatable.   That is,  they must
        begin on an even location.  (This  is true even if an odd  Load Address
        is specified; in  this case the  user-supplied address will  be rounded
        up.) The  user, however, may  specify via the  PAGE and  CPAGE commands
        that certain sections are page relocatable, meaning that their starting
        address is rounded up to be a multiple of $100.  Furthermore, this page
        relocatability  can be  turned  on and  off between  modules,  which in
        effect  allows  the  user  to  control  the  relocation  type  of  each
        subsection.

             Page  relocation  is  useful  for  debugging  since  it  means the
        absolute  addresses assigned  by  the Loader  will match  the  last two
        digits of the relocatable addresses shown on the Assembler Listing.

             In the  typical load sequence,  the Loader places  contiguously in
        memory  all  subsections of  the  first section  it  assigns.   This is
        followed immediately  by all  subsections of  the second  section, etc.
        There are no extra  bytes between the subsections (unless  a subsection
        contains an  odd number of  bytes, in  which case one  byte is  left in
        between the subsections in  order that the next higher  subsection will
        start  on an  even address.)  If any  of the  subsections  specify Page
        relocation, however, the  Loader will start  that subsection at  a page
        boundary to  preserve relocation.   Due to the  internal design  of the
        Loader,whenever any  subsection of a  section is page  relocatable, the
        first subsection in that section starts on a page boundary,  unless the
        section has a Load Address specified.  To avoid wasting memory the user
        can always specify section Load Addresses.  (If paging is in  effect at
        the time the first subsection of a section is LOADed, even  a specified
        Load Address will be rounded up.)

             Since  all  subsections of  a  common section  start  at  the same
        location, specifying page relocation for any common  subsection results
        in page relocation for the section.








        6                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983






                                 3 -  LOADER COMMANDS


             The  Loader  reads a  sequence  of commands  from  the Controlling
        terminal, or alternatively from a command-file.  The commands are input
        in an interactive mode if the source is the controlling  terminal.  The
        last command must be either an EXIT or END command.

             The  object modules  are  read from  files specified  on  the LOAD
        command.

             The output  of the Loader  consists of one  or more  absolute load
        modules suitable for loading into an actual microprocessor.  The output
        module  is written  to  the object  module  output device  in  a format
        described in the Assembler Manual.

             All  commands must  begin in  column one.   Command  arguments may
        begin in any column and must be separated from the command by  at least
        one  blank.  Comments  may  be placed  in  the command  stream  and are
        indicated by an asterisk in column 1.

             The following pages describe the Loader commands.  In  the command
        descriptions, brackets "{ }", are used to indicate  optional arguments.
        A summary of the commands is given below:


                SECT            Set Noncommon Section Load Address
                COMMON          Set Common Section Load Address
                PAGE            Set Paging for Noncommon Section
                CPAGE           Set Paging for Common Section
                NOPAGE          Turn off Paging for Section
                ORDER           Specify Long Section Order
                SORDER          Specify Short Section Order
                START           Specify Output Module Starting Address
                BASE            Specify Location at which to begin Loading
                NAME            Specify Output-module File-name
                PRINT           Specify Listing file name
                LOAD            Load Specified Object Modules
                PUBLIC          Specify PUBLIC symbols (External Definitions)
                LIST            List specified Elements
                NLIST           Do not list specified Elements
                OVY             Begin description of an Overlay
                ENDOVY          End description of an Overlay
                BUILD           Build an Overlay File
                EXIT            Exit Loader
                END             End Command stream and finish loading
                *               Comment



        7                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


             Command  arguments  that  are numeric  may  be  either  decimal or
        hexadecimal.  Hexadecimal constants are preceded by a $ (e.g., $1F) and
        need not have  a leading zero even  if they start with  the hexadecimal
        characters A - F.

             Symbols,  section  names and  overlay  names must  all  follow the
        syntax rules  for symbols  given in the  assembler manual:   i.e., they
        must begin with a letter, "?", or "_", and subsequent characters may be
        any of these or a number.  As in the assembler, lower case  letters are
        mapped to upper case everywhere.

             The order in which commands are specified is  reasonably flexible;
        however, these rules must be followed:

               1)      All  SECT and  COMMON commands  must  precede any
                       LOAD commands.

               2)      Overlay specification is by means of the  pair of
                       commands OVY and ENDOVY.  All LOAD  commands must
                       precede the first OVY command.  Following  an OVY
                       command, an ENDOVY  must appear before an  END or
                       another OVY command.

               3)      If  overlays  are present,  the  BASE,  ORDER and
                       SORDER  commands  may  appear  only   between  an
                       OVY...ENDOVY  pair.  The  last usage  of  each of
                       these  commands   within  an   OVY...ENDOVY  pair
                       determines the parameters for that overlay only.

               4)      Following  the last  ENDOVY command,  exactly one
                       BUILD  command  for  each  each  of  the overlays
                       specified  by OVY...ENDOVY  pairs must  be given.
                       Furthermore, the  first BUILD command  applies to
                       the  first  overlay specified,  the  second BUILD
                       command to the second overlay, and so  forth.  No
                       commands other than  BUILD are allowed  after the
                       first BUILD  command, except  the final  END.  If
                       overlays  are not  present, no  BUILD  command is
                       needed or accepted.

             Except  for  the above,  commands  may be  specified  as  often as
        desired,  but  the  last  use  of  a  command  determines  the  command
        parameters and wipes out all previous uses.











        8                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


                        3.1  SECT  -  Set Section Load Address


             The  SECT  command  is  used to  specify  the  load  address  of a
        noncommon Relocatable section.  If this is the first occurrence  of the
        section name, it is given  the attributes noncommon and long.   Any use
        of this command must precede any LOAD commands.

             The user specifies the section name followed by the address of the
        location at which to start loading the section.  The  specified address
        will be rounded up to the  next word boundary in all cases, and  to the
        next page boundary if paging  is in effect for the first  subsection of
        the section.

             Example:

                                        SECT    SECT1,$400
                                        SECT    SECT2=$1320

             The general form is:

                SECT    sname,value
                SECT    sname=value
                SECT    sname value

             where:

               sname - specifies the section name

               value - specifies the load address of the section.


               NOTE:   The value is separated from the section name by a
                       blank, comma, or equal sign.

               NOTE:   Multiple SECT commands with the same section name
                       are accepted without a warning, but only the last
                       one will be used.






                    3.2  COMMON  -  Set Common Section Load Address


             This  command is  used to  specify the  load address  of  a common
        section.  If this command is used it must be specified before  any LOAD
        commands.  If this is the  first occurrence of this section name  it is
        given the attributes common and long.



        9                    M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


             The user  specifies the  section name followed  by the  address at
        which to begin loading  the section.  The address specified  is rounded
        up to  the next  higher word  boundary in  all cases,  and to  the next
        higher page boundary if paging is specified for this common section.

             Example:

                                        COMMON  COMSEC,2048

             The general form is:

                COMMON  sname,value
                COMMON  sname=value
                COMMON  sname value

             where:

               sname - specifies the section name

               value - specifies the load address of the common section.


               NOTE:   The value is separated from the section name by a
                       blank, comma, or equal sign.

               NOTE:   Multiple  COMMON commands  with the  same section
                       name are accepted without a warning, but only the
                       last one will be used.






              3.3  PAGE  -  Set Noncommon Section to be Page Relocatable


             This  command may  be  used to  modify  the relocation  type  of a
        section(s) in the  input object modules to  Page.  As explained  in the
        section titled Relocation  Types, all sections  are assumed to  be Word
        Relocatable at  first.  This  command allows the  user to  override the
        default  relocation  type.   After  the  PAGE  command  is  read,  each
        subsection  of the  specified section  loaded thereafter  will  be Page
        Relocatable until a NOPAGE command for the section is encountered.

             The typical use of this command is to allow the user to begin each
        section on a page boundary, for ease of debugging.  After  debugging is
        completed the Page commands are removed to avoid wasted memory space.

             The  user  specifies  the  section name.   If  this  is  the first
        occurrence of this  section name it  is given the  attributes noncommon
        and long.


        10                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


             Example:

                                        PAGE    SECT1
                                        PAGE    SECT2

             The general form is:

                PAGE    sname

             where:

               sname - Is a section name.






               3.4  CPAGE  -  Set Common Section to be Page Relocatable


             This command may be used  to modify the relocation type  of common
        section(s) in the input object modules to Page.  It allows the  user to
        override the default relocation type of Word for a common section.

             Since all subsections of a  common section are loaded at  the same
        address, the CPAGE  command need only be  used once per section  at the
        beginning of the  loading process.  Once  Page Relocation is  turned on
        for a common section, it cannot be turned off for later  subsections of
        the section.

             The  user  specifies  the  section name.   If  this  is  the first
        occurrence of the  section name, it  is assigned the  attributes common
        and long.

             Example:

                                        CPAGE   P

             The general form is:

                CPAGE   sname

             where:

               sname - is a section name.








        11                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


                     3.5  NOPAGE  -  Turn Off Page Relocatability


             This directive restores the Relocation Type of a section  to Word.
        It is legal but unnecessary unless the specified section has previously
        appeared in a PAGE or CPAGE command.

             A section name appearing here  for the first time is  assigned the
        long attribute  but is  assigned neither the  common nor  the noncommon
        attribute.

             The typical use for this command is to turn off paging for modules
        which are already known to work correctly (libraries, for instance), in
        order to save memory space.

             Example:

                                        NOPAGE  ZOT

             The general form is:

                NOPAGE  sname

             where:

               sname -  is a section name, which should  have previously
                       appeared in a PAGE or CPAGE directive.






                      3.6  ORDER   -   Specify Long Section Order







                     3.7  SORDER  -   Specify Short Section Order


             These  commands  have  two  purposes.   When  overlays  are  being
        created, they are used to specify which sections go in  which overlays.
        And whether or not overlays are being created, these commands alter the
        default order of assigning Load Addresses to sections.

             If overlays are in use,  the user must specify which  sections are
        to be placed in each overlay by placing an ORDER and/or  SORDER command
        between the OVY and  ENDOVY commands for that overlay.   Sections which


        12                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


        do not appear in  any ORDER or SORDER  command are placed in  the first
        overlay (the root).  If overlays are in use, no ORDER or SORDER command
        is allowed outside an OVY...ENDOVY pair.

             As  described  under Loader  Operation,  the normal  order  of the
        sections in each group (the groups are [I] short sections and [II] long
        sections)  is just  the  order in  which the  Loader  encountered their
        names.  The ORDER and SORDER commands are designed for users who do not
        need to  specify load  addresses for  each section  but would  like the
        sections to  be placed  in memory in  a different  order.  If  the user
        specifies load addresses  for the sections,  the order of  the sections
        may be of no particular  importance.  Keep in mind, however,  that even
        if a  load address  is specified  for a  certain section,  any sections
        assigned memory  space after that  section will be  loaded at  the next
        available address.  If, for example, the user wanted long section SECT2
        to  begin at  $FFFF00, and  all the  other long  sections to  be placed
        together in lower  memory, the ORDER  command should be  specified with
        section SECT2 being the last  argument.  If this is not done,  then any
        sections  which,  by  happenstance,  are  assigned  memory  space after
        section  SECT2 is  assigned memory  space will  reside in  upper memory
        above section SECT2.

             While the information necessary to determine the default  order of
        the sections  is available  to the user,  in complex  cases it  will be
        simpler to use the ORDER command than to figure out the default order.

             The ORDER command applies to long sections; the SORDER  command to
        short sections.  If  a section name appears  in these commands  for the
        first time it is  assigned the appropriate shortness attribute,  but it
        is  assigned neither  the common  nor the  noncommon attribute  so that
        subsequently it  may turn out  to be  either.  If the  name of  a short
        section appears  in the  long version of  the ORDER  command this  is a
        fatal  error; however  the final  determination of  which  sections are
        short cannot be made until all modules have been read, since  any short
        subsection declaration makes  a section short.  If  the name of  a long
        section appears in the short version of the ORDER command a  warning is
        printed  and the  section is  given Opthe  short attribute.   (This may
        occur if a SECT, COMMON, PAGE, CPAGE, or NOPAGE directive  precedes the
        SORDER command, since these directives assign newly found  sections the
        long attribute.)

             The user specifies the order of the sections within each  group by
        specifying section names  separated by commas.  Any  sections remaining
        within  the group  will  be assigned  memory space  after  the sections
        specified in the command in  the order their names were  encountered by
        the Loader; if overlays are in use, all such sections are placed in the
        first overlay (root).

             Example:

                                        ORDER   SEC1,COMSEG
                                        SORDER  SEC2,SHORTSEC


        13                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


             An ORDER or  SORDER command may be  continued to the next  line by
        terminating it with a dollar sign ($).  This character must  go between
        section names, like a comma.

             Example:

                                        ORDER   SECT1$
                                                SECT2,SECT3$
                                                SECT4

             Spaces are not permitted between  the last name on a line  and the
        following $;  they are permitted only at the beginning  of continuation
        lines.

             The general form is:

                ORDER   lname{,lname...}
                SORDER  sname{,sname...}

             where:

               lname - is the name of a section with the long attribute.

               sname - is  the  name   of  a  section  with   the  short
                       attribute.


               NOTE:   The same section name may not appear twice  on an
                       ORDER or SORDER command.  If overlays are  in use
                       the  same  section  name may  not  appear  in two
                       different overlays.

               NOTE:   Multiple  ORDER or  SORDER commands  are accepted
                       without a warning, but only the last one  of each
                       (within an overlay, if overlays are in  use) will
                       be used.






                 3.8  START  -  Specify Output Module Starting Address


             This command is used  to specify the absolute starting  address to
        be  placed in  the  terminator record  of  the object  module.   If not
        specified the starting address is  obtained from the END record  of the
        main program of the input Opmodules.  If no main program has been read,
        the starting address will be zero.

             Evidently this  directive should not  be used unless  the starting


        14                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


        address falls in an absolute section or in a relocatable section with a
        specified load address.   In the latter case,  be warned that  when the
        load address is rounded upwards to lie on a word or page  boundary, the
        starting address is not likewise rounded.

             The starting  address will  be placed  in the  END record  of each
        overlay, when overlays are in use.  This way the Loader need  not worry
        about which overlay contains  the starting address, and since  only one
        overlay will be downloaded and started there is no ambiguity.   In most
        practical applications  the starting address  should fall in  the root,
        although the Loader does not require this.

             Example:

                                        START   $7FC

             The general form is:

                START   value

             where:

               value - specifies the starting address be be used  in the
                       output object module.






               3.9  BASE  - Specify Base Address for Program or Overlay


             The  BASE command  is  used to  specify  the Base  Address  of the
        current overlay, if  overlays are present, or  of the entire  module if
        there are  no overlays.  If  overlays are in  use the BASE  command may
        appear only between an OVY...ENDOVY pair.  A Base Address is the lowest
        address that  will be considered  for placing the  first section  in an
        overlay (module), provided this section does not have its  Load Address
        specified in a SECT or COMMON command.  Users without overlays may find
        the BASE command  useful to avoid  collision with an  operating system,
        for example, in low memory.

             For non-overlaid  modules, the  BASE must  be an  absolute number.
        For overlays,  the BASE may  be specified in  three different  ways: an
        absolute address, a symbol, or an overlay name.  When a symbol is used,
        the symbol  must either  be absolute  or must  be relocatable  within a
        section which was specified (on an ORDER or SORDER command) to  be part
        of a  previously specified overlay.   A symbol is  most useful  when it
        lies at the end  of a previously loaded  section; such a symbol  can be
        defined by placing the following assembler directives at the end of the
        section:


        15                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


                        DS      0 ; align location counter - necessary only
                                  ; following a DC.B, DS.B or DCB.B with odd
                                  ; number of bytes
                SYMBOL  EQU     *
                        PUBLIC  SYMBOL
                        END

             An overlay  name is distinguished  from a symbol  by having  a "@"
        (commercial at sign) character precede the name.  Again, the definition
        of this overlay name must precede its use in a BASE command.

             Examples:

                                        BASE    $400
                                        BASE    SYMBOL
                                        BASE    @OVNAME

             The general form is:

                BASE    number
                BASE    symbol  ; these forms legal only between
                BASE    @ovname ; OVY and ENDOVY

             where:

               number - is an absolute number

               symbol - is  a symbol  that must  be either  absolute, or
                       relocatable  in  a section  which  was previously
                       specified to lie in a different overlay

               ovname - is the name of an overlay which must precede the
                       current overlay






                       3.10  NAME  -  Specify Output Module Name


             The NAME command is used  to specify the name of the  final output
        object module.

             The  user-specified  name  may  be any  standard  symbol  up  to 6
        characters long.  The file is opened with the extension ".OBJ".   If no
        NAME is specified, the file "FOR04.DAT" will be written.

             Example:

                                        NAME    READER


        16                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


             will cause creation of, and output to, file "READER.OBJ".

             The general form is:

                NAME    name

             where:

               name - is a symbol that specifies the object module name.






                   3.11  PRINT  -  Specify Listing-output File-name


             The PRINT  command is  used to  specify the  name of  the listing-
        output file name.  If specified, the load map and symbol-tables will be
        output to this file;  if not, they will appear at the terminal.

             The  user-specified  file-name  may  be  any  standard  file name,
        including optional "(DIRECTORY)" and ".EXT".

             Example:

                                        PRINT   LOAD.MAP

             will cause creation of, and output to, file "LOAD.MAP".

             The general form is:

                PRINT   file

             where:

               file - is a file name for print output.






                     3.12  LOAD  -  Load Specified Object Modules


             The  LOAD command  is used  to specify  one or  more  input object
        modules to  be loaded.   The command operand  is assumed  to be  a file
        name,  and the  object module  will  be read  from that  file.   If any
        operand is preceded by a minus sign, it indicates that  multiple object
        modules should be read from the specified file until a hardware end-of-


        17                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


        file  (EOF) condition  is detected.   In this  case the  user  need not
        specify an operand for each object module.

             The device or file specified may contain either relocatable object
        modules (output of the Microtec Assembler) or libraries (output  of the
        Microtec Library Maintenance Program).  They are differentiated  on the
        basis of their internal format and are handled identically by  users of
        the Loader with the following exceptions:

           1)  Libraries should be  loaded after all  non-libraries.  Libraries
               will  load only  those modules  which are  necessary  to resolve
               undefined XREFs, even if the library file or device  is preceded
               by a minus sign.   Backward XREFs within a library  are resolved
               correctly.   However, XREFs  to  a library  from  a subsequently
               LOADed file are generally not resolved correctly,  and therefore
               libraries should be LOADed last.  In the case where each  of two
               libraries  makes  XREFs  to  the  other,  it  will  generally be
               necessary  to  LOAD  one  of  them  twice  (for   example,  LOAD
               LIBA,LIBB,LIBA) to pick up all necessary modules.
           2)  A library should always be the first item on its file or device.
               Multiple passes of a library are performed; to start a  new pass
               a REWIND  statement is executed.   If a library  follows another
               item on its file or device, this REWIND will not go back  to the
               beginning of the library as it ought to.

             Object modules  may be read  from a combination  of files  and I/O
        devices and may or may not  be read until the EOF.  The  object modules
        are  loaded in  the order  specified with  each subsection  within each
        module being loaded into memory at a higher address than  all preceding
        subsections within its section.  A  user may use as many  LOAD commands
        as needed.

             Example:

                                        LOAD    FILE,-FILE1     Three modules
                                                                are to be
                                                                loaded -- The
                                                                first from FILE
                                                                and the next
                                                                two from FILE1
                                                                until an EOF.

             The general form is:

                LOAD    module1{,module2,...,moduleN}

             where:

               module - specifies the name of  a disk file on  which the
                       object module or library resides.  Any  module or
                       library  specification preceded  by a  minus sign
                       will cause object modules or libraries to be read


        18                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


                       until a hardware EOF is detected on the device or
                       file.  Operands are separated by commas.






            3.13  PUBLIC  -  Specify Public Symbols (External Definitions)


             This  command is  used to  define and/or  change the  value  of an
        external definition (XDEF).  If  a symbol specified by this  command is
        already an external definition (from an input object module  defined by
        the Assembler), the value of the symbol is changed to that specified by
        the user.   If the symbol  is not already  defined, it will  be entered
        into the Loader's symbol table along with the specified value  and will
        then be available to  satisfy external references from  object modules.
        Any symbol defined by this  command is considered to be  absolute (i.e.
        it does not lie in any relocatable section).

             This command allows the user to specify the value of some external
        symbols at Load time and possibly to avoid a reassembly.  To change the
        value of a symbol that  is an external definition in an  object module,
        this command must be specified after the object module has  been loaded
        via the LOAD  command.  This may be  done by specifying  this directive
        immediately before the END command.

             Example:

                                        PUBLIC  INPUT=$2F,OUTPUT=$200

             The general form is:

                PUBLIC  sym1=value{,sym2=value,...,symN=value}

             where:

               sym -   is a user defined external definition symbol

               value - is the value of the symbol













        19                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


                        3.14  LIST  -  List Specified Elements







                    3.15  NLIST  -  Do Not List Specified Elements


             The LIST command is used to select output options.

             The NLIST command is the opposite of the LIST command and  is used
        to suppress the listing of the elements specified.  The elements may be
        turned back on with the LIST command.

             Example:

                                        LIST    T,X     list both local and
                                                        definition symbol
                                                        tables
                                        NLIST   O       don't produce an
                                                        object module

             The general form is:

                LIST    {D,O,P,S,T,X,C}
                NLIST   {D,O,P,S,T,X,C}

             where:

               D -     specifies if PUBLIC symbols should be placed into
                       the output object module.  (default=NLIST)

               O -     specifies  if output  module is  to  be produced.
                       This   is    useful   to   check    for   errors.
                       (Default=LIST)

               P -     specifies  if any  local symbols  present  in the
                       input  object  modules should  be  placed  in the
                       Loader symbol  table.  This  is useful  when many
                       modules are being loaded and the symbol table may
                       become full.  Of  course these local  symbols may
                       not be listed in a a symbol table. (Default=LIST)

               S -     specifies  if the  local symbol  table  should be
                       written to the object module.  (default=NLIST)

               T -     specifies  if the  local symbol  table  should be
                       listed    on    the    list     output    device.
                       (default=NLIST)


        20                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


               X -     specifies if  the PUBLIC  symbol table  should be
                       listed    on    the    list     output    device.
                       (default=NLIST)

               C -     specifies that the symbol tables be output in the
                       form  of a  cross-reference list.   If specified,
                       each symbol name  will have associated with  it a
                       list  of modules  within which  it is  XDEF'ed or
                       XREF'ed.  (Default=NLIST)






                      3.16  OVY - Begin Definition of an Overlay


             The OVY command  starts the definition  of an overlay.   All BASE,
        ORDER  and SORDER  commands  found after  this command  and  before the
        corresponding ENDOVY  apply to  this overlay  only.  Each  overlay must
        have a name for internal use.  These names are stored  differently from
        symbols  or module  names  within the  Loader, and  may  duplicate them
        without conflict; however, no two overlays may have the same name.

             Example:

                                        OVY     OVERLAYONE

             The general form is:

                OVY     ovname

             where:

               ovname - is a symbol that specifies the overlay name.






                         3.17  ENDOVY - End Overlay Definition


             The  ENDOVY  command terminates  the  current  overlay definition.
        Each OVY must have a corresponding ENDOVY before any more  OVY commands
        can be specified.  The ENDOVY command has no parameters.

             Example

                                                ENDOVY


        21                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


             The general form is:

                ENDOVY






                            3.18  BUILD - Build an Overlay


             In  addition to  an OVY...ENDOVY  pair, each  overlay must  have a
        BUILD  command   specified.   The  BUILD   commands  must   follow  all
        OVY...ENDOVY pairs and they must appear in the same order in  which the
        overlay definitions appeared.  Thus the first BUILD command  causes the
        first overlay specified to be built and so forth.

             If the command operand is  a number, the output module  is written
        to that logical I/O device.  If the command operand is not a number, it
        is assumed the name of a file is being specified, and the object module
        is written to that file.

             Example:

                                        ...
                                        ENDOVY
                                        BUILD   7       ; writes first overlay
                                        BUILD FILE2.ABS ; writes second overlay

             The general form is:

                BUILD   file-or-device

             where:

               file-or-device - is the number of a logical output device
                       or the name  of a disk  file on which  the object
                       module is to reside.















        22                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER COMMANDS                                         August 17, 1983


                              3.19  EXIT  -  Exit Loader


             The  EXIT command  is used  in the  interactive mode  to  exit the
        Loader.  This command is useful when the user finds an error  that will
        require leaving the Loader (return to the operating system) to fix.  It
        acts like an END command except that the final load does not take place
        and an output object module is not produced.  This command may  also be
        used in the  batch mode by  making it the  last command in  the command
        stream.  In this case the final load will not take place but the object
        modules and commands will be read and checked for errors.

             In the interactive mode, most command errors are  recoverable, but
        errors  that  occur  due   to  the  LOAD  command  are   generally  not
        recoverable.

             The general form is:

                EXIT






                  3.20  END  -  End Command Stream and Finish Loader


             This command should  be the last  command in every  command stream
        unless the EXIT  command is used as  described under that  command.  It
        initiates the final steps in the load process.

             The general form is:

                END






                       3.21  Comment  -  Specify Loader Comment


             An  asterisk may  be  used to  specify  a comment  in  the command
        stream.  Comments  may be  used to  document Loader  command sequences.
        The asterisk must be in column one.

             Example:

                                        *  LOADER EXAMPLE



        23                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983






                              4 -  How To Use the Loader


             This is a two pass loader in which the commands and object modules
        are checked  for errors  during the first  pass and  a symbol  table is
        formed.   Errors detected  during  this phase  of the  program  will be
        displayed on the listing, and at the user terminal as well.  Only those
        errors  found  in the  object  modules will  cause  termination  of the
        loading process, with the message 'LOAD NOT COMPLETED'.

             During  Pass two  of the  Loader, the  final object  module(s) are
        produced along with a Load Map and a listing of any  undefined external
        references.  A symbol  table and/or cross  reference table may  also be
        listed.

             When executing the Loader, the user should either type in commands
        on his terminal, or  specify a command-file.  Of  particular importance
        is that  the user  specify on the  LOAD command  the correct  number of
        modules to be load.  It is  extremely useful to use the Load  until EOF
        option on the LOAD command if the end-of-file condition can be detected
        on the particular computer.






                                    4.1  Invocation


             In order to run the linking loader, it is necessary to  provide it
        with the names of the file to be linked.  There are two valid  forms of
        invoking the linking loader:

                Either- -R (2311DOC)LNK68K;COMMAND
                                -or-
                        -R (2311DOC)LNK68K

             The latter form  will then prompt for  a command;  in  both cases,
        COMMAND will be of the same format:

                either- COMAND
                        -or-
                        @CMD.FIL

             In  the latter  case,  further input  is taken  from  CMD.FIL (the
        command file;  this will  contain further instances of  COMAND.  Nested
        command files are supported;  CMD.FIL can contain further  instances of
        "@".  Command files may be nested to 4 levels.).

        24                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


             COMAND can in turn have several formats:

                Either- /OPTIONS
                                -or-
                        @CMD.FIL /OPTIONS
                                -or-
                        /OPTIONS @CMD.FIL

               NOTE:   The  options field  of the  command  is optional;
                       however, if present, it should be  seperated from
                       the FILE field by at least one  delimiter (blank,
                       TAB).

             @CMD.FIL is the command-file specification:

                        [(DIRECTORY)]CFILE[.EXT]

               In this case, [...] are optional;  the specified file  is opened
               as the command file.

             OPTIONS specifications are of the format:

                        /ABC-DEF

             The "-" turns  the following options  OFF;  a subsequent  "/" will
        turn the  following options ON.   Unrecognized options are  reported to
        the terminal and are then ignored.  Options are scanned left  to right,
        and the  last usage  selected is  used.  The  available options  are as
        described in the manual, and are reported here ("*" means normally ON):

               D* -    specifies that PUBLIC symbols will not  be placed
                       into the output object module.

               O  -    specifies  that  no   output  module  is   to  be
                       produced.  This is useful to check for errors.

               P  -    specifies that any  local symbols present  in the
                       input object modules not be placed in  the Loader
                       symbol table.  This  is useful when  many modules
                       are being loaded and the symbol table  may become
                       full.  Of course  these local symbols may  not be
                       listed in a a symbol table.

               S* -    specifies  that  the local  symbol  table  not be
                       written to the object module.

               T* -    specifies  that  the local  symbol  table  not be
                       listed on the list output device.

               X* -    specifies  that the  PUBLIC symbol  table  not be
                       listed on the list output device.



        25                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


               Z  -    specifies if the  symbol tables be output  in the
                       form  of a  cross-reference list.   If specified,
                       each symbol name  will have associated with  it a
                       list  of modules  within which  it is  XDEF'ed or
                       XREF'ed.





                    4.1.1  Example

             The command:

                        -R (2311DOC)LNK68K;/P LINK.CMD

             performs the following functions:

           1.  Runs the linking loader ("LNK68K"),
           2.  Sets no local-symbols be retained ("/P"),
           3.  Opens  the  file  "LINK.CMD" (in  the  current  directory)  as a
               command file,
           4.  In addition, the linking loader opens several unique  .TMP files
               for additional storage during execution;  these are deleted upon
               exit.






                                  4.2  Loader Listing


             The following pages show two sample listings from the Loader which
        are used to describe both  the output listing and the  loading process.
        The first of  these examples is also  used as the Loader  Test Program.
        The second example is  composed of the same relocatable  object modules
        as the first, but illustrates the use of the overlay commands.

             The first page  of the listing shows  all commands entered  by the
        user up to and including the first BUILD command along with any command
        errors that occur.  Following this would be any load module errors that
        occurred in the modules loaded via the LOAD command.

             If no  fatal errors occur  up to  this point, then  a Load  Map is
        displayed which displays the names of all sections encountered if there
        are no  overlays, or  the names of  the sections  present in  the first
        overlay  if there  are  overlays, along  with  the names  of  all input
        modules followed by the starting addresses of all subsections  for that
        module.  Each  section has its  attributes displayed in  the form  of a
        numeric code with the following meaning:


        26                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


            0= short, noncommon
            1= long, noncommon
            2= short, common
            3= long, common
            4= short, known only from XREF's (error)
            5= long, known only from XREF's (error)

             If a certain  module does not make  use of a certain  section, the
        space for the starting address of that subsection is left  blank.  Each
        subsection  of a  common  section has  the same  starting  address.  Of
        course  each module  need  not use  all sixteen  sections.   The ending
        address+1 for each section is  displayed at the end of all  modules and
        is indicated by //.  The Load Map may be interrupted by error messages.

             If the  subsections for  a module will  not all  fit on  one line,
        continuation lines are produced with blanks for the module name and a +
        after these  blanks.  Both continuation  lines and normal  module lines
        may have the flag L  betweeen the module name and the  first subsection
        address; this indicates a Library module.  This L flag may be incorrect
        if duplicate module names are present.

             Following the section addresses for the relocatable sections  is a
        list of all  absolute sections in the  object modules along  with their
        starting and  ending addresses.  These  are listed in  numerical order.
        Since absolute  sections are  always placed in  the first  overlay when
        overlays are present, the display of absolute sections is given for the
        first  overlay  only.   If  certain Loader  tables  become  full  it is
        possible that not  all absolute sections will  be shown.  In  this case
        absolute code will be  processed correctly but those sections  with the
        highest  addresses are  not displayed  on the  Load Map,  nor  are they
        checked  for  overlap.   The  number of  sections  which  can  be fully
        processed can  be increased  at compile  time; see  Installation Notes.
        Recall that only those  bytes of memory containing data  are considered
        part of an absolute section;  areas skipped by the DS directive  do not
        count.

             Following the absolute sections, the starting address is displayed
        for the first overlay only.   Although the loader does not  require the
        starting  address to  lie in  the first  overlay, in  practical  use it
        usually will.

             Following  the  Load  Map  is a  list  of  all  undefined external
        references (following the first overlay only, if overlays are present).
        If the user specified the appropiate LIST command option(s), all PUBLIC
        symbols and/or  all Local  symbols (only those  defined in  the current
        overlay, if  overlays are  present) are  displayed next.   All absolute
        symbols are considered part  of the first overlay.  PUBLIC  symbols are
        those declared as  XDEF in the assembler  and those declared  in PUBLIC
        commands to the Loader.   During an assembly, all symbols  not declared
        XDEFs  are Local.   Local  symbols are  included in  the  output object
        module if  the OPT D  directive is specified  at assembly  time.  Local
        symbols may be used for debugging, but serve no function in the Loader.


        27                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


             If  overlays are  present,  the display  of  relocatable sections,
        module  names  and  subsection load  addresses,  and  PUBLIC  and Local
        symbols  is repeated  for all  remaining overlays.   Also shown  is the
        BUILD command for each overlay.

             Following the displays for  all overlays, a cross  reference table
        is printed if requested  by the user.  The "references"  field contains
        module names.  A  module name preceded by  a minus sign  indicates that
        the  symbol was  defined in  that module;  no minus  sign  indicates an
        external  reference to  the symbol.   The characters  "$$"  indicate a
        symbol defined in a PUBLIC command.

             The end of the Load  Program is indicated by the  "LOAD COMPLETED"
        or "LOAD NOT COMPLETED" message.

                                68000 LINKING LOADER VER 3.0
         
           **LOADER COMMANDS
         
         
         LIST T,S,X
         COMMON COMSEC=$1080
         ORDER SECT2,SECT3,COMSEC
         PAGE SECT2
         LOAD LDTST1
         LOAD LDTST2
         LOAD LDTST3
         END

                                      Figure 4.1.


             Figure  4.1.  shows  the  initial  Linker  output,  including  the
        commands.

             Figure 4.2. shows the load map, and the symbol tables output.


















        28                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


                                      Figure 4.2.

           **LOAD MAP**
         
         
        MODULE                    <----------------- SECTION ----------------->
                                   SECT1 :0  SECT2 :1  SECT3 :1  COMSEC:3
         
         
         
         MAIN1                      000000    000100
         READ                       000052    000200              001080
         VERYVERYLONGMODULENAME               000300    000326    001080
          //                        000054    000326    000340    001082
         
         
             ABSOLUTE SECTIONS
         
                       000400 TO 000405
                       001000 TO 001009
         
         
            STARTING ADDRESS= $000100
         
           ***UNDEFINED EXTERNALS
         
         
         SCAN
         
         
         
           **PUBLIC SYMBOLS
         
         
         CRLF      00014A    DLETE     007FFF    ECHO      000050
         INBUF     000000    INBUFEND  000050    READ      000200
         TIN       00011C    TOUT      000136
         
         
         
           **LOCAL SYMBOLS
         
         
         ASCR      00000D    ASCR      00000D    ASLF      00000A
         BLNK      000020    BLNK      000020    BSPA      000008
         COUNT     000052    CRLF      00014A    DLETE     007FFF
         ECHO      000050    IN8       00011C    INBUF     000000
         INBUFEND  000050    LENGTH    001080    MAIN10    00010C
         MAIN2     000100    OUT8      000136    PROC      001004
         READ      000200    READ10    00020A    READ20    000220
         READ30    000238    READ40    000246    READ50    00025C
         READ60    00026C    READ70    000272    READ80    00027C
         TAB       000009    TIN       00011C    TOUT      000136

        29                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


         UDATIN    F70019    UDATOUT   F7001F    USTAT     F70031
         
         
         
           **LOAD COMPLETED

             Figure 4.3. shows the object symbols

                                      Figure 4.3.

        $$
         SCAN $00000000 DLETE $00007FFF ECHO $00000050 INBUFEND $00000050
         INBUF $00000000 CRLF $0000014A TOUT $00000136 TIN $0000011C
         PROC $00001004 USTAT $00F70031 ASLF $0000000A UDATOUT $00F7001F
         BLNK $00000020 UDATIN $00F70019 ASCR $0000000D IN8 $0000011C
         OUT8 $00000136 MAIN2 $00000100 MAIN10 $0000010C TAB $00000009
         BSPA $00000008 BLNK $00000020 ASCR $0000000D COUNT $00000052
         READ60 $0000026C READ70 $00000272 READ10 $0000020A
         READ80 $0000027C READ20 $00000220 READ30 $00000238
         READ40 $00000246 READ $00000200 READ50 $0000025C
         LENGTH $00001080

             Figure 4.4. shows the same information, for overlays.

               NOTE:   Overlays are not supported in our implementation!





























        30                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


                                      Figure 4.4.

                        68000 LINKING LOADER VER 3.0
         
           **LOADER COMMANDS
         
         
         LIST T,S,X,C
         COMMON COMSEC=$1080
         PAGE SECT2
         LOAD LDTST1
         LOAD LDTST2
         LOAD LDTST3
         OVY ROOT
         ORDER SECT3
         * BASE 0 ASSUMED
         * COMSEC AND ABSOLUTE CODE ALSO PLACED IN ROOT BY DEFAULT
         ENDOVY
         OVY FIRSTOVY
         ORDER SECT2
         * BASE @ROOT ASSUMED (BUT SECT2 ROUNDED UP TO PAGE BOUNDARY)
         ENDOVY
         OVY SECONDOVY
         SORDER SECT1
         BASE @ROOT
         ENDOVY
         BUILD BENCHLOV1
           **LOAD MAP**
         
         
            *** OVERLAY ROOT
         
         
        MODULE                    <----------------- SECTION ----------------->
                                   SECT3 :1  COMSEC:3
         
         
         
         READ                                 001080
         VERYVERYLONGMODULENAME     000000    001080
          //                        00001A    001082
         
         
             ABSOLUTE SECTIONS
         
                       000400 TO 000405
                       001000 TO 001009
         
         
            STARTING ADDRESS= $001100
         
           ***UNDEFINED EXTERNALS
         

        31                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


         
         SCAN
         
         
         
           **PUBLIC SYMBOLS
         
         
         DLETE     007FFF
         
         
         
           **LOCAL SYMBOLS
         
         
         ASCR      00000D    ASCR      00000D    ASLF      00000A
         BLNK      000020    BLNK      000020    BSPA      000008
         DLETE     007FFF    LENGTH    001080    PROC      001004
         TAB       000009    UDATIN    F70019    UDATOUT   F7001F
         USTAT     F70031
         
         BUILD BENCHLOV2
         
         
            *** OVERLAY FIRSTOVY
         
         
        MODULE                    <----------------- SECTION ----------------->
                                   SECT2 :1
         
         
         
         MAIN1                      001100
         READ                       001200
         VERYVERYLONGMODULENAME     001300
          //                        001326
         
         
         
         
           **PUBLIC SYMBOLS
         
         
         CRLF      00114A    READ      001200    TIN       00111C
         TOUT      001136
         
         
         
           **LOCAL SYMBOLS
         
         
         CRLF      00114A    IN8       00111C    MAIN10    00110C
         MAIN2     001100    OUT8      001136    READ      001200

        32                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


         READ10    00120A    READ20    001220    READ30    001238
         READ40    001246    READ50    00125C    READ60    00126C
         READ70    001272    READ80    00127C    TIN       00111C
         TOUT      001136
         
         BUILD BENCHLOV3
         
         
            *** OVERLAY SECONDOVY
         
         
        MODULE                    <----------------- SECTION ----------------->
                                   SECT1 :0
         
         
         
         MAIN1                      001082
         READ                       0010D4
          //                        0010D6
         
         
         
         
           **PUBLIC SYMBOLS
         
         
         ECHO      0010D2    INBUF     001082    INBUFEND  0010D2
         
         
         
           **LOCAL SYMBOLS
         
         
         COUNT     0010D4    ECHO      0010D2    INBUF     001082
         INBUFEND  0010D2
         
         END
                                      CROSS REFERENCE
         
         LABEL    VALUE         REFERENCES
         
         
         CRLF     00114A        -MAIN1  READ
         DLETE    007FFF        -MAIN1  READ
         ECHO     0010D2        -MAIN1  READ
         INBUF    001082        -MAIN1  READ
         INBUFEND 0010D2        -MAIN1  READ
         READ     001200        -READ  MAIN1
         SCAN     000000        MAIN1
         TIN      00111C        -MAIN1  READ
         TOUT     001136        -MAIN1  READ
         
         

        33                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


           **LOAD COMPLETED

        $$
         SCAN $00000000 DLETE $00007FFF PROC $00001004 USTAT $00F70031
         ASLF $0000000A UDATOUT $00F7001F BLNK $00000020 UDATIN $00F70019
         ASCR $0000000D TAB $00000009 BSPA $00000008 BLNK $00000020
         ASCR $0000000D LENGTH $00001080
        $$
        S00600004844521B
        S20E00100060024E712E7C0000100006
        S214000000227C00000400321966084E714EB90000CA
        S20E000010131C0000131C000004007F
        S20A0004000506131C4E71F8
        S5030004F8
        S804001100EA

        $$
         CRLF $0000114A TOUT $00001136 TIN $0000111C IN8 $0000111C
         OUT8 $00001136 MAIN2 $00001100 MAIN10 $0000110C READ60 $0000126C
         READ70 $00001272 READ10 $0000120A READ80 $0000127C
         READ20 $00001220 READ30 $00001238 READ40 $00001246
         READ $00001200 READ50 $0000125C






                      4.3  Common Problems, or Ways to Screw Up!


             There are certain  types of errors which  are not at  all obvious,
        based upon LNK68K's error messages.  These are shown in this section.





                    4.3.1  Mis-declared XREF

             In the following three modules (A, B, and C), there is a bug:

        A       IDNT
                XREF.S  SYMBOL
                SECT.S  SHORT
                MOVE.W  SYMBOL,D0
                END

        B       IDNT
                XDEF    SYMBOL
                SECT    LONG
        SYMBOL  DC.W    0
                END

        34                   M68000 Linking Loader Manual            LNK68K.DOC
        How To Use the Loader                                   August 17, 1983


        C       IDNT
                SECT    LONG
                DC.L    -1
                END

             The problem  is that the  symbol SYMBOL is  declared short  in the
        XREF in A.  It is, however, declared long in B.

             This has the  problem that A has  been already loaded,  with short
        references  to  SYMBOL,  at  the  time  that  the  long  declaration in
        encountered in B.  LNK68K resolves this by forcing section  LONG, which
        contains  SYMBOL,  to  be   a  short  section  (thereby   matching  the
        declaration for SYMBOL).

             A diagnostic "Section  Mismatch on shortness Attribute"  is issued
        for section B.  IT IS REPEATED FOR SECTION "C"!!

             The solution is  to locate the  first instance of  the diagnostic,
        and  verify that  SYMBOL is  properly declared.   If not,  fix  it.  If
        correct, then one must proceed through ALL preceding sections loaded to
        determine  within which  one has  the incorrect  reference.  As  a last
        resort, you can load each module separately (i.e., one at a  time), and
        examine the load-map to determine which module is at fault.

             In any case, this can be a very subtle bug to track down!





























        35                   M68000 Linking Loader Manual            LNK68K.DOC
                                                                August 17, 1983



























                      *   ****  ****  ***** *   * ****  ***** *   *
                     * *  *   * *   * *     **  * *   *   *    * * 
                    ***** ****  ****  ****  * * * *   *   *     *  
                    *   * *     *     *     *  ** *   *   *    * * 
                    *   * *     *     ***** *   * ****  ***** *   *
























        36                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER MESSAGES                                         August 17, 1983






                             APPENDIX I.   LOADER MESSAGES



             Messages  from the  Loader may  be classified  into  Command Error
        Messages and Load Messages.  Command errors are due to invalid commands
        or  command parameters  and usually  cause termination  of  the loading
        process in  the batch  mode.  Command messages  are listed  beneath the
        actual  command.   Load messages  occur  during the  loading  of object
        modules initiated by the LOAD command.  These messages may be  fatal or
        informative.  For most  load messages, the  message is followed  by the
        record number in the input module and the actual record in  error.  For
        a particular module the module name is also listed at the start  of the
        messages.

             Most  load errors  should  not occur.   If  they do,  the  user is
        advised to first reassemble the  program then to reload.  If  the error
        persists, the user should contact Microtec.






                                 I-1  COMMAND MESSAGES



           Invalid Command  - A command  specified by the  user is not  a legal
               Loader command.

           Invalid  Operand  -  An operand  specified  for  a  command contains
               invalid characters, does not exist, or is too large.

           Command Not Allowed - This  command is not allowed at this  point in
               the  program.   For example:  a  SECT command  following  a LOAD
               command, an  END command following  an ENDOVY command  (BUILD is
               missing), or more BUILD commands than OVY...ENDOVY pairs.

           Symbol Table Full - User specified a PUBLIC command and no more room
               exists in the symbol table.

           Section  Name Table  Full -  User specified  a PAGE,  CPAGE, NOPAGE,
               SECT, COMMON, ORDER, or  SORDER command and no more  room exists
               in the section name table.

           Too Many  Overlays - The  Overlay Name Table  is full, yet  the user
               specified another overlay.


        37                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER MESSAGES                                         August 17, 1983


           Module Greater  than 16M  - At final  load time  the lengths  of all
               programs  sections is  greater  than 16  megabytes,  the maximum
               memory size.

           File Not Found - A file specified on the LOAD command does not exist
               or possibly an invalid LOAD command operand was specified.

           Invalid Symbol - A PUBLIC or NAME command is specified that contains
               an invalid symbol.  A PAGE, CPAGE, NOPAGE, SECT,  COMMON, ORDER,
               or SORDER command is specified that contains an  invalid section
               name.  An OVY command contains an invalid overlay name.

           Unconditional  Load  Follows  Library Load  -  A  relocatable object
               module was specified in a LOAD command and a library  was LOADed
               previously.  Backward references to the library will usually not
               be resolved correctly.  Warning; loading continues.

           Section in Illegal  Form of Order Command  - A section  specified in
               the ORDER command (not SORDER) is a short section.  This message
               appears after the END command since all short sections cannot be
               determined with certainty until then.  Fatal.

           Illegal Load Address  Specified for Short  Section - A  Load Address
               has  been specified  for  a short  section that  results  in the
               section  extending  outside  the  area  addressable   by  16-bit
               addresses.  This message appears below the END command since all
               short sections cannot be identified with certainty  before that.
               Fatal.

           Section Mismatch on Common Attribute - A section was typed common in
               one place and noncommon in another.  Fatal error.

           Section Mismatch on Shortness Attribute - A section was  typed short
               in one place and  long in another.  Warning;  loading continues;
               section  will  be  short  hereafter.   This  message  may  arise
               spuriously if  a section is  mentioned for the  first time  in a
               SECT, COMMON, PAGE, CPAGE, or NOPAGE command, as  these commands
               assign the long attribute to newfound sections.

           Bad Base for  Overlay - The overlay  whose name is displayed  has an
               illegal BASE  specified.  Typically  this is  a symbol  which is
               neither absolute  nor relocatable in  a previous overlay,  or an
               overlay name which does  not precede the current  overlay.  This
               message often follows the first BUILD command.










        38                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER MESSAGES                                         August 17, 1983


                                  I-2  LOAD MESSAGES



           Invalid Hex  Digit -  A character  in the  record shown  contains an
               invalid hexadecimal character.  Some records contain  symbols as
               well as  hexadecimal numbers.   This message  does not  apply to
               those symbols.

           Invalid  Checksum -  The record  has a  checksum error  and probably
               contains some changed characters.  Possibly a  computer hardware
               error.

           Header Record Error  - A header record  was not the first  record in
               the object module or a  header record was found after  the first
               record.

           Record  Too Large  -  A record  specifies  a record  length  that is
               greater than 72 characters.

           Invalid Record Type - A record specifies a record type that does not
               exist in the  Loader.  The record  type found should  be present
               only  in  libraries, yet  the  current object  module  is  not a
               library.

           Invalid ID  or Type -  Some internal parameters  on this  record are
               illegal.

           Address Out of Range  - A relocation record specifies  relocation at
               an  address outside  the range  of relocation  specified  on the
               header record or on the preceding record.  Possibly  records are
               out of sequence.

           External Index Out  of Range - An  External Reference is made  to an
               external symbol that does not exist in this object module.

           External Table Full - Current object module specifies  more external
               symbols then may be contained in external table.  The table size
               needs to be increased.

           Record Out of  Sequence - An object  module record was read  that is
               out of sequence in the module or the user may  have inadvertenly
               mixed the records if they are on cards.

           Symbol Table Full - A PUBLIC object module record is being processed
               and  the symbol  table  is full.   The  table size  needs  to be
               increased.

           Section Name Table Full - A header record is being processed and the
               section  name  table  is  full.   The  table  size  needs  to be
               increased.



        39                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER MESSAGES                                         August 17, 1983


           Duplicate Public Name - A PUBLIC is defined that was already defined
               in another module.  Loading will continue and the symbol will be
               listed.

           Module Greater  than 16M -  During initial loading,  the sum  of all
               section lengths exceeds the 16 megabyte memory size.

           Section  Overlap  - Due  to  user specified  addresses,  or absolute
               sections,  one or  more  of the  sections overlap.   This  is an
               informative message and loading continues.  The address at which
               overlap was  detected, and  the containing  overlay if  any, are
               printed.   Sections in  different overlays  are not  checked for
               overlap.  Each occurrence of this message represents one pair of
               sections that  overlap; thus  if four  sections occupy  the same
               location, 6 messages would result, for instance.

           Section Mismatch on Common Attribute - A section was typed common in
               one place and noncommon in another.  Fatal error.

           Section Mismatch on Shortness Attribute - A section was  typed short
               in one place and  long in another.  Warning;  loading continues;
               section  will  be  short  hereafter.   This  message  may  arise
               spuriously if  a section is  mentioned for the  first time  in a
               SECT, COMMON, PAGE, CPAGE, or NOPAGE command, as  these commands
               assign the long attribute to newfound sections.

           Unexpected End of Module - A relocatable object module did  not have
               an end record at the end;  a library did not have an  eof record
               at the end.

           Relocated  16-bit Address  Out  of Range  - A  16-bit  field, either
               displacement  from  the  program counter  in  PC  + displacement
               address mode, an immediate value, or an absolute  short address,
               has  too  large  a value.   Loading  continues  but  because the
               displacement is an incorrect value the loaded program won't run.
               Try using a different address mode.  This message interrupts the
               Load Map when it appears.  The section and location  relative to
               the beginning of the subsection (i.e., the address  that appears
               on the  assembler listing) are  given for each  occurrence.  The
               location shown is the  low-order byte of the 16-bit  field.  The
               module is shown in the preceding line of the Load Map.

           Section Mismatch Between  Symbol Def and Ref  or Two Refs -  An XREF
               from the assembler had  a section associated with it  which does
               not match the  section of the XDEF  with the same name,  or does
               not match  the section  associated with a  previous XREF  to the
               same symbol.  Unspecified  sections are considered to  match any
               section  name.   The  symbol  is  treated  as  undefined.  (This
               message may occur in the case of duplicate XDEFs as well.)



           XDEF or XREF Found in Lib Module but not Library Header-

        40                   M68000 Linking Loader Manual            LNK68K.DOC
        LOADER MESSAGES                                         August 17, 1983


           Wrong Count of XDEFs or XREFs in Library Header -

           Some XREFs in Library  Header are not in Module -

           XDEF in Library Header is not in Module -

                   -  These four messages  indicate problems within  a library.
               A library file may have been corrupted.



               NOTE:   Several errors require that "the table size needs
                       to be increased".  Refer to the original MICROTEC
                       installation    manual    to     determine    the
                       modifications required if any of these conditions
                       occur.






































        41                   M68000 Linking Loader Manual            LNK68K.DOC
        INDEX                                                   August 17, 1983


                                         INDEX

        Absolute Section  2@


        Base Address  4


        command-file  7
        Common Section  3@


        Load Address  4
        Long Section  4@


        Noncommon Section  3@


        program sections  2


        Relocatable Section  3@
        root  4


        Short Section  4@
        Starting Address  4


























        42                   M68000 Linking Loader Manual            LNK68K.DOC
 t 
O
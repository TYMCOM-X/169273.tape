MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH FOONLY PARAMETER FILE - F3SYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST F3SYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE	MONBTS - Monitor resident BOOTStrap
     9
    10					STOPCD(,ENTRY,MONBTS)^
    11					ENTRY	MONBTS		;For library searches
    12	000000'	260040	000010	MONBTS::PUSHJ	P,DIE		;**** Default stopcode for "MONBTS" ****
    13	000001'	555756	426463		SIXBIT	/MONBTS/  	;Title of module
    14	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "MONBTS+nnn(nnnnnn)"
    15			000000'	S$NAME==MONBTS			;For STOPCDs with no arguments
    16					SALL>
    17				^
    18
    19				PRINTF(<[Need to implement BUGDMP for CRASH.EXE]>)
    20	000003'	260040	000000*	BUGDMP::PUSHJ	P,INLMES##	;Dump core into SYS:CRASH.EXE
    21					 ASCIZ /
    22	000004'	064250	252616	BUGDMP - No crash dump for this stopcode
	000005'	422332	020132
	000006'	202355	720306
	000007'	713036	364100
	000010'	623535	570100
	000011'	633376	220350
	000012'	643236	320346
	000013'	723376	061736
    23	000014'	623121	505000	/
    24	000015'	263040	000000		POPJ	P,		;Return to DIE in ERRCON
    25
    26	000016'	260040	000003'	REBOOT:	PUSHJ	P,BUGDMP	;Dump core into SYS:CRASH.EXE
    27	000017'	254000	000030'		JRST	NEWMON		;Reload the monitor
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

    28				SUBTTL	Load BOOTS from the disk
    29
    30				IFCPU(<KS,F3>),<EXTERN UPT.PN,EPT.PN	;Here from a 146 restart
    31	000020'	700600	000400	BOTLOD::SYSPIF			;Turn off PI system
    32	000021'	701140	000243'		WRUBR	[LG.LAB+LG.LUB+0B8+0B11+400000+UPT.PN];Select AC block 0
    33	000022'	701200	000000*		WREBR	EPT.PN		;Turn off paging (bit 22 is off)
    34	000023'	402000	000000*		SETZM	BTSTR##		;Flag to not do /D
    35	000024'	744000	000000	IFCPU (F3),<TNCONO 0>		;Reset interface to node
    36	000025'	700540	000244'	IFCPU (F3),<DATAO PI,[-1]>	;Turn on all the lights
    37	000026'	700140	000245'	IFNCPU(KS),<WRADB [0]>		;Clear address break
    38	000027'	200040	000000*		MOVE	P,.CPEPD##	;Reset stack
    39					PFALL	NEWMON
    40				> ;END IFCPU(<KS,F3>)
    41
    42			775000		BOOTS=:1000000-3000	;BOOTS resides in the top 3 pages of core
    43
    44	000030'	201200	775000	NEWMON::MOVEI	F,BOOTS		;Load BOOTS into pages 775,776,777
    45	000031'	542200	000056'		HRRM	F,BOOTCL	; ...
    46
    47				IFCPU(<KI,KL>),<;LOOK FOR BOOTS ON 3330 DRIVES.
    48					MOVSI	J,-7		;INIT CHANNEL COUNTER
    49				BPBR0:	SETZ	W,		;INITIAL DEVICE
    50				BPBR2:	MOVE	PG,BTADR	;<# OF WORDS,,DISK PAGE ADDR> FOR BOOTS
    51					HRRZ	F,BOOTCL	;BOOTS CORE ADDRESS (as set up by CRSDEV)
    52					PUSHJ	P,SAXPRD	;PROCURE BOOTS
    53					 JRST	BPBR		;COULD NOT GET IT
    54					JSP	T4,ISBOOT	;HAS BOOTS BEEN LOADED?
    55				BPBR:	MOVEI	W,1(M)		;NO: INCREMENT DEVICE COUNTER
    56					CAIG	W,77		;HAS MAXIMUM BEEN REACHED?
    57					 JRST	BPBR2		;NO: TRY NEXT UNIT
    58					AOBJN	J,BPBR0		;CONTINUE IF MORE CHANNELS TO TRY
    59					JRST	BOTLOD##	;Try the paper-tape/DECtape routine, BOTLOD.MAC
    60				> ;END IFCPU(<KI,KL>)
    61
    62				IFCPU (<KS,F3>),<;READ BOOTS FROM KS OR F3 UNITS
    63	000032'	205500	777770		MOVSI	W,-8		;INIT UNIT COUNTER
    64	000033'	200140	000055'	RMXPBT:	MOVE	PG,BTADR	;<# OF WORDS,,DISK PAGE ADDR> FOR BOOTS
    65	000034'	550200	000056'		HRRZ	F,BOOTCL	;BOOTS CORE ADDRESS (as set up by BTPREP)
    66	000035'	260040	000155'	IFCPU(F3),<PUSHJ P,APXPRD>
    67				IFCPU(KS),<PUSHJ P,RMXPRD>
    68	000036'	334000	000000		  SKIPA			;FAILED
    69	000037'	265440	000044'		JSP	T4,ISBOOT	;GOT SOMETHING, SEE IF BOOTS
    70	000040'	253500	000033'		AOBJN	W,RMXPBT	;NOT BOOTS, TRY NEXT UNIT IF ONE
    71				IFCPU (KS),<
    72					MOVSI	W,-8		;Try alternate location
    73				RMXBT1:	MOVE	PG,[1600,,11]	;Location of KS boots prior to P034/P20
    74					HRRZ	F,BOOTCL	;Core address
    75					PUSHJ	P,RMXPRD
    76					  SKIPA			;Not there either
    77					JSP	T4,ISBOOT	;Double check
    78					AOBJN	W,RMXBT1
    79				> ;END IFCPU(KS)
    80	000041'	201600	000246'	NOBOOT:	MOVEI	P1,[ASCIZ / ?Can't read BOOTS!! /]
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 2-2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

    81	000042'	265300	000000*		JSP	T1,CTYTYP##	;Type out message
    82	000043'	254200	000020'		HALT	BOTLOD		;Can't find BOOTS anywhere
    83				> ;END IFCPU(<KS,F3>)
    84
    85	000044'	550340	000056'	ISBOOT:	HRRZ	T2,BOOTCL	;GET BOOTS STARTING ADDR
    86	000045'	200407	000000		MOVE	T3,(T2)		;GET FIRST WORD OF BOOTS
    87	000046'	312400	000060'		CAME	T3,BOOTFI	;IS IT CORRECT?
    88	000047'	254011	000000		 JRST	(T4)		;NO: RETURN
    89					MOVEI	P1,[ASCIZ /
    90				"BOOTS loaded"
    91	000050'	201600	000253'	  /]
    92	000051'	265300	000042*		JSP	T1,CTYTYP##	;TYPE OUT MESSAGE
    93	000052'	201040	000023*		MOVEI	1,BTSTR##	;GET ADDR OF BOOTS COMMAND STRING
    94	000053'	550100	000056'		HRRZ	2,BOOTCL	;GET BOOTS STARTING ADDR
    95	000054'	254002	000005		JRST	5(2)		;PASS CONTROL TO BOOTS
    96
    97			002600	BCDSZ==3000-200			;SIZE OF BOOTS CODE (was 7 blocks)
    98			003000	BCDSSZ==BCDSZ+200		;SIZE OF BOOTS + SAX SAVE AREA
    99	000055'	002600	000003	BTADR:	BCDSZ,,3		;SIZE OF BOOTS, DISK ADDR
   100	000056'	775200	775000	BOOTCL:	XWD -BCDSZ,BOOTS
   101	000057'	000000	000000		0
   102
   103	000060'	700200	200000	BOOTFI:	WRAPR	200000		;First word of BOOTS is CONO APR,200000
   104
   105
   106				;PRIMITIVE DISK READ SET UP AND DISPATCH
   107	000061'	260040	000067'	PMDRD::	PUSHJ	P,PMDSET	;SET UP TO READ
   108	000062'	550306	000075'		HRRZ	T1,PMDDSP(T1)	;GET READ ADDRESS
   109	000063'	324746	000000		PJRST	(T1)		;READ FROM SELECTED UNIT
   110
   111				;PRIMITIVE DISK WRITE SET UP AND DISPATCH
   112	000064'	260040	000067'	PMDWT::	PUSHJ	P,PMDSET	;SET UP TO WRITE
   113	000065'	554306	000075'		HLRZ	T1,PMDDSP(T1)	;GET WRITE ADDRESS
   114	000066'	324746	000000		PJRST	(T1)		;WRITE TO SELECTED UNIT
   115
   116				;SET UP FOR PRIMITIVE DISK ROUTINES
   117	000067'	135100	000000*	PMDSET:	LDB	J,UNYSCN##	;GET CHANNEL NUMBER
   118	000070'	135500	000000*		LDB	W,UNYPUN##	;GET UNIT NUMBER OFFSET
   119	000071'	135300	000000*		LDB	T1,UNYKTP##	;GET DEVICE TYPE
   120	000072'	607140	777777		TLNN	PG,-1		;IS # OF WORDS SPECIFIED?
   121	000073'	661140	001000		 TLO	PG,1000		;NO: DEFAULT TO ONE PAGE
   122				IFCPU(<KI,KL>),<
   123					LDB	T2,UNYBPR##	;Get blocks per record
   124					CAIE	T2,4		;Record size set to 4 blocks to a page
   125					SKIPGE	UNICHR##(U)	;Formatted in pages? (sign bit set)
   126					 JRST	PMDST1		;Yes, formatted in pages
   127					MOVEI	T2,200		;Formatted in blocks if UNICHR is positive
   128					MOVEM	T2,SAWPR	;Words per record
   129					LDB	T2,UNYBPT##	;Blocks per track
   130					MOVEM	T2,SARPT	;Records per track
   131					LDB	T2,UNYBPY##	;Blocks per track
   132					MOVEM	T2,SARPC	;Records per cylinder
   133					POPJ	P,
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 2-3
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   134				PMDST1:	MOVEI	T2,1000		;Formatted in pages if UNICHR is negative
   135					MOVEM	T2,SAWPR	;Words per record
   136					LDB	T2,UNYPPT##	;Pages per track
   137					MOVEM	T2,SARPT	;Records per track
   138					LDB	T2,UNYPPY##	;Pages per cylinder
   139					MOVEM	T2,SARPC	;Records per cylinder
   140				>  ;End IFCPU(KI,KL)
   141	000074'	263040	000000		POPJ	P,
   142
   143				;PRIMITIVE DRIVER DISPATCH TABLE
   144	000075'			PMDDSP:	;WRITER,,READER
   145	000075'	000104'	000104'		XWD BADPWT,BADPRD	;0  DR
   146	000076'	000104'	000104'		XWD BADPWT,BADPRD	;1  FH
   147	000077'	000104'	000104'		XWD BADPWT,BADPRD	;2  DP
   148	000100'	000104'	000104'		XWD BADPWT,BADPRD	;3  MD
   149	000101'	000104'	000104'		XWD SAXPWT,SAXPRD	;4  SAX
   150	000102'	000104'	000104'		XWD RMXPWT,RMXPRD	;5  RM/RP
   151	000103'	000156'	000155'		XWD APXPWT,APXPRD	;6  F3 CDC/AMPEX DRIVES
   152
   153	000104'			IFNCPU(KS),<RMXPWT: RMXPRD:>
   154				IFNCPU(F3),<APXPWT: APXPRD:>
   155	000104'			IFNCPU(<KI,KL>),<SAXPWT: SAXPRD:>
   156	000104'			BADPWT:
   157				BADPRD:	MOVEI	P1,[ASCIZ /?Unit data block messed up
   158	000104'	201600	000260'	/]
   159	000105'	265300	000051*		JSP	T1,CTYTYP##
   160	000106'	263040	000000		POPJ	P,
   161	000107'	350001	000000	CPOPJ1:	AOS	(P)		;SKIP RETURN
   162	000110'	263040	000000	CPOPJ:	POPJ	P,		;NO SKIP RETURN
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 3
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   163				IFCPU(<KI,KL>),<SUBTTL	Primitive READ/WRITE routines for SA-10
   164				
   165				COMMENT !PRIMITIVE ROUTINES TO READ OR WRITE A SPECIFIED NUMBER OF
   166					 WORDS STARTING AT AN ARBITRARY DISK PAGE FROM/TO ANY 3330
   167					 TYPE DRIVE CONNECTED TO AN SA-10.
   168					 PARAMETERS:	PG/ # OF WORDS,,DISK PAGE
   169							F/ CORE ADDR (NOT NECESSARILY ON PG BOUNDARY)
   170							J/ 1B33  SA-10
   171							   3B35  SUB-CHANNEL
   172							W/ UNIT
   173					 CALL:	PUSHJ P,SAXPRD  TO READ
   174						PUSHJ P,SAXPWT  TO WRITE
   175					 RETURN:	SUCCESS: M=W, SKIP RETURN
   176							ERROR: NON-SKIP RETURN
   177							       M=W OR 77  IF CHANNEL NOT AVAILABLE
   178								=W OR 7  IF NO MORE UNITS ON THIS
   179									 KONTROLLER
   180								=W  IF UNIT NUMBER GOOD BUT OTHER ERROR
   181					 ACS ALTERED:	T1-T4,M,P1-P3
   182				!
   183				
   184				SAXPWT:	MOVEI	P1,SAXWCD
   185					SKIPA
   186				SAXPRD:	MOVEI	P1,SAXRCD
   187					DPB	P1,SAYBB	;STORE READ OR WRITE CODE
   188				    ;STORE DEVICE ADDRESS IN COMMANDS.
   189					MOVEI	T1,SAUN0(W)	;COMPUTE DEVICE ADDRESS
   190					MOVE	M,[POINT 8,SACLST,23] ;B HOLDS PNTR.
   191					DPB	T1,M		;DEV ADDR TO SEEK
   192					HRRI	M,2(M)		;
   193					DPB	T1,M		;DEV ADDR TO SEARCH ID EQUAL.
   194					HRRI	M,3(M)		;
   195					DPB	T1,M		;DEV ADDR TO READ/WRITE CMD.
   196				
   197					MOVN	T1,SAWPR	;Negative of words per record
   198					LSH	T1,^D24		;Put in bits 0-11, zero bits 12-17
   199					HRR	T1,F		;Physical address (24 bits)
   200					MOVEM	T1,SACADR	;SET INIT DESTINATION ADDR
   201				
   202				;PG has # of words in LH, disk page address in RH
   203				
   204					SETZ	P3,		;INIT RECORD INDEX
   205				NEXREC:	HRRZ	T1,PG		;COPY PAGE NUM
   206					LSH	T1,P2WLSH	;PAGES TO WORDS
   207					IDIV	T1,SAWPR	;CONVERT TO RECORD NUM
   208					ADD	T1,P3		;COMPUTE CURRENT RECORD NUM
   209					IDIV	T1,SARPC	;COMPUTE CYLINDER,
   210					IDIV	T2,SARPT	; HEAD,
   211					ADDI	T3,1		; AND RECORD NUMBERS
   212					DPB	T1,SAYCC	;STORE CYLINDER NUMBER
   213					DPB	T2,SAYCC+1	;STORE HEAD NUMBER
   214					DPB	T3,SAYCC+2	;STORE RECORD NUMBER
   215				
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 3-2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   216					MOVEI	P1,SAX1AD	;GET ADDR OF SA-10 1
   217					TRNE	J,4		;SKIP IF SELECTED SA-10
   218					 MOVEI	P1,SAX2AD	;GET ADDR OF SA-10 2
   219					HRRZ	M,J		;WHICH SA-10?
   220					LSH	M,2
   221					ADDI	M,SAXREG	;NOW HAVE BASE FOR THIS CHANNEL
   222					MOVEI	T1,SACLST
   223					HRLI	T1,200000	;TIC COMMAND
   224					MOVEM	T1,(M)		;STORE IN BASE AREA
   225					MOVEI	P2,1		;SET A UNIQUE BIT IN P2 THAT CORR. TO
   226					LSH	P2,(J)		; THE SA-10, SUB-CHAN BEING REFERENCED
   227					TDNE	P2,CHNFLG	;DO WE KNOW ITS NOT THERE
   228					 JRST	STRT4A		;YES, GIVE UP ON IT
   229					MOVEI	T1,21
   230					SETCMI	T2,(J)
   231					ORI	T2,-4		;ZERO EXTRANEOUS BIT IF SET
   232					LSH	T1,7(T2)	;SET UP BIT FOR STAT FLAG FOR THIS CHAN
   233					SETCA	T2,		;RECOVER CHANNEL NUMBER
   234					LSH	T2,3		;CONVERT TO CORRECT POSITION FOR CONO
   235					HRL	T2,T1		;SAVE STATUS BIT IN LEFT HALF
   236				RESTAR:	PUSHJ	P,IOCNI		;READ STATUS
   237					JUMPE	T4,STRT4	;JUMP IF SA-10 IS MISSING
   238					MOVEI	T1,640(T2)
   239					PUSHJ	P,IOCNO		;SET STATUS BIT
   240					MOVEI	T1,440(T2)
   241					PUSHJ	P,IOCNO		;AND GO FLAG
   242					MOVEI	T1,600(T2)
   243					PUSHJ	P,IOCNO		;AND THEN CLEAR STATUS
   244					MOVEI	T4,^D100000
   245					HLRZ	T1,T2		;GET STATUS BIT
   246					PUSHJ	P,IOCNSO	;AND DO THE CONSO
   247					 SOJG	T4,.-1
   248					JUMPE	T4,STRT4	;JUMP ON TIMEOUT
   249					MOVE	T4,1(M)		;GET STATUS
   250					TLNE	T4,(1B2)
   251					 JRST	STRT4A		;SELECT ERROR
   252					MOVEI	T1,400000	;IN CASE WE HAVE TO RESET
   253					TLNN	T4,BSY
   254					 JRST	STRT3		;NOT BUSY
   255					TLNE	T4,SM		;BUSY+STATUS MODIFIER?
   256					 JRST	STRT2		;YES
   257					TLNE	T4,CUE
   258					 JRST	RESTAR		;JUMP ON BUSY+CU END
   259				STRT3:	TLNN	T4,CE+DE	;CHANNEL END AND DEVICE END?
   260					 JRST	STRT5		;NO. ERROR
   261					TLNN	T4,175114	;OTHER ERRORS?
   262					 JRST	NEXRC1		;THIS RECORD PROC. OK, CONTINUE
   263				STRT5:	PUSHJ	P,IOCNO		;T1 IS LOADED WITH BIT 18
   264					HRRZ	M,W		;UNIT NUM SUPPLIED WAS GOOD
   265					POPJ	P,
   266				
   267				STRT4:	IORM	P2,CHNFLG	;MARK CHANNEL NOT THERE
   268					MOVEI	T1,77		;AND WORD FOR BAD CHANNEL
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 3-3
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   269					SKIPA
   270				STRT4A:	MOVEI	T1,7		;AND WORD FOR NO MORE DEV ON KONT
   271					MOVE	M,W		;COPY UNIT NUMBER
   272					TDO	M,T1		;SET TO TOP OF MULT OF 10
   273					POPJ	P,
   274				
   275				STRT2:	MOVEI	T1,600(T2)
   276					PUSHJ	P,IOCNO		;CLEAR STATUS
   277					HLR	T1,T2		;NO WAIT FOR STATUS BIT
   278					PUSHJ	P,IOCNSO
   279					 JRST	.-1
   280					MOVE	T4,1(M)
   281					TLNE	T4,CUE
   282					 JRST	RESTAR
   283					JRST	STRT2
   284				
   285				NEXRC1:	MOVE	T1,SAWPR	;LOAD RECORD SIZE
   286					ADDM	T1,SACADR	;POINT TO NEXT RECORD LOCATION IN CORE
   287					ADDI	P3,1		;INCREMENT RECORD COUNTER
   288					HLRZ	T1,PG		;Get requested number of words
   289					IDIV	T1,SAWPR	;Convert to number of records
   290					CAMGE	P3,T1		;Done all of them?
   291					 JRST	NEXREC		;NO: DO NEXT RECORD
   292					MOVE	M,W		;UNIT NUM SUPPLIED WAS GOOD
   293					JRST	CPOPJ1		;SUCCESS RETURN
   294				
   295				IOCNSO:	MOVSI	T3,(CONSO (T1))	;SETUP IO INSTR.
   296				IOXCT:	DPB	P1,[POINT 7,T3,9];PUT IN I/O DEVICE FIELD
   297					XCT	T3		;DO THE IO
   298					 POPJ	P,		;NO SKIP RETURN
   299					JRST	CPOPJ1
   300				
   301				IOCNI:	SKIPA	T3,[CONI T4]	;FOR SA-10
   302				IOCNO:	MOVSI	T3,(CONO (T1))
   303					JRST	IOXCT
   304				
   305				; SA-10 COMMAND LIST AND DEFINITIONS
   306				
   307				CMDLST:
   308				SACLST:	BYTE	(8)72,7		;SEEK
   309					BYTE	(12)-6(24)SACARG
   310				SACIDE:	BYTE	(8)73,61	;SEARCH ID EQUAL
   311					BYTE	(12)-5(24)SACARG
   312				SACTIC:	XWD	200000,SACIDE	;TIC
   313				SACCMD:	BYTE	(8)160		;READ OR WRITE
   314				SACADR:	BYTE	(12)-1(24)0	;-WORD COUNT(SAWPR), START ADDRESS
   315					0			;Zero terminates command list
   316				
   317				SACARG:	BLOCK	2		;SEEK/SEARCH BLOCK
   318				
   319				SAYBB:	POINT	8,SACCMD,15
   320				SAYCC:	POINT	32,SACARG,31
   321					POINT	16,SACARG+1,15
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 3-4
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   322					POINT	8,SACARG+1,23
   323				
   324				CHNFLG:	Z			;DEFECTIVE CHANNEL FLAG WORD
   325				
   326				;These 3 locations will be updated by PMDSET to the correct values
   327				; The values here are defaults for loading BOOTS from 3330 formatted in blocks.
   328				; Note that if the disk does not match these values, control will eventually
   329				; go to BOTLOD, which is capable of reading all four formats.
   330				SAWPR:	DEC 128		;Words per record       ( 512, 512, 128)
   331				SARPT:	DEC  18		;Records per track      (   5,   7,  25)
   332				SARPC:	DEC 18*19-2	;Records per cylinder   (5*19,7*30,25*30-2)
   333				
   334				SAXWCD==5	;Disk write code
   335				SAXRCD==6	;Disk read code
   336				SAUN0==300	;Unit 0 at X'C0'
   337				SAXREG==300
   338				SAX1AD==274_-2		;SA-10 1
   339				SAX2AD==400_-2		;SA-10 2
   340				BSY==(BYTE (8)0,20)
   341				CUE==(BYTE (8)0,40)
   342				SM==(BYTE (8)0,100)
   343				CE==(BYTE (8)0,10)
   344				DE==(BYTE (8)0,4)
   345				> ;END IFCPU(<KI,KL>)
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 4
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   346				IFCPU (KS),<SUBTTL	Primitive READ/WRITE routines for RM03/RP06
   347				
   348				COMMENT	!PRIMITIVE ROUTINES TO READ OR WRITE A SPECIFIED NUMBER OF
   349					 WORDS STARTING AT AN ARBITRARY DISK PAGE FROM/TO AN
   350					 RM03/RP06 DISK DRIVE INTERFACED TO A KS THRU A UBA.
   351					 PARAMETERS:	PG/ # OF WORDS,,DISK PAGE
   352							F/ CORE ADDR (NOT NECESSARILY ON PAGE BOUNDARY)
   353							W/ UNIT
   354					 CALL:	PUSHJ P,RMXPRD	TO READ
   355						PUSHJ P,RMXPWT	TO WRITE
   356					 RETURN:	SUCCESS: SKIP
   357							FAILURE: NON-SKIP
   358					 ACS ALTERED:	T1-T4,P1-P2
   359				!
   360				
   361				DEFINE	RDREG(DEST,REG)	;EXPECTS THE UBA NUMBER IN T2
   362				<	RDIO	DEST,REG'ADR(T2)>
   363				
   364				DEFINE	WRREG(SRC,REG)	;EXPECTS THE UBA NUMBER IN T2
   365				<	WRIO	SRC,REG'ADR(T2)>
   366				
   367				
   368				RMXPRD:	SKIPA	P1,[F.RD]	;DO DISK READ
   369				RMXPWT:	MOVEI	P1,F.WD		;DO DISK WRITE
   370					HRLZI	T2,UA1	;SET THE ADDRESS TO UBA1
   371					MOVEI T3,CS2CLR
   372					WRREG T3,CS2;			CLEAR RH11
   373					WRREG W,CS2;			SELECT UNIT
   374					RDREG T4,DS;			DRIVE EXISTS?
   375					RDREG T3,CS2
   376					TRNN T3,CS2NED
   377					  TRNN T4,DSMOL
   378				OPJ	P,
   379					MOVEI T4,F.RIP			;READ IN PRESET
   380					WRREG T4,CS1
   381					MOVEI T4,^D100000
   382					MOVEI T3,DSDRY		;WAIT UNTIL INITIALIZATION DONE
   383					TION  T3,DSADR(T2)
   384					  SOJG T4,.-1
   385					JUMPLE	T4,RMPOPJ
   386					RDREG T4,DS
   387					TRNE T4,DSERR
   388					  POPJ	P,
   389					MOVEI T4,F.RECA
   390					WRREG T4,CS1;			ISSUE RECALIBRATE
   391					MOVEI T3,^D100000
   392					RDREG T4,DS
   393					TRNN T4,DSDRY
   394					 SOJG T3,.-2
   395					JUMPLE T3,RMPOPJ
   396					TRNE T4,DSERR
   397					 POPJ	P,
   398				;TRY UNIT
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 4-2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   399					RDREG	P2,DT
   400					ANDI	P2,2		;Adr is function of unit type.
   401					LSH	P2,-1		;0:RM03, 1:RP06
   402					MOVEI	T1,^D148	;CALCULATE
   403					CAIE	P2,0		; ABSOLUTE
   404					 MOVEI	T1,^D380	; DISK
   405					HRRZ	T3,PG		; SECTOR
   406					LSH	T3,2		; ADDR
   407					IDIV	T3,T1		; FROM
   408					WRREG	(T3,DC)		; UNIT
   409					MOVE	T3,T4		; RELATIVE
   410					MOVEI	T1,^D30		; PAGE
   411					CAIE	P2,0		; NUMBER
   412					MOVEI	T1,^D20		; AND
   413					IDIV	T3,T1		; PASS
   414					DPB	T3,[POINT 5,T4,27]	; TO
   415					WRREG	(T4,DA)		; DRIVE
   416					HLRZ	T3,PG		;SET WORD COUNT
   417					LSH	T3,1		;(2 UNIBUS words per KS10 word)
   418					MOVNS	T3
   419					WRREG T3,WC
   420					MOVE T4,F		;SET VIRTUAL CORE ADDRESS
   421					SETZ T3,		;SET VIRTUAL CORE ADR
   422					ROTC T3,-9
   423					ROT T3,13
   424					WRREG T3,BA
   425					MOVE T3,[UA1,,PGRADR]
   426					TRO T4,PGRFST+PGRVAL		;SET PHYSICAL CORE ADR
   427					WRIO T4,@T3
   428					AOJ T4,
   429					AOJ T3,
   430					WRIO T4,@T3
   431					WRREG P1,CS1
   432					movei	t3,^D100	;busy wait loop index
   433				rmp1:	movei	t4,^D2000	;bus saturation avoidance loop index
   434					sojg	t4,.		;only do read every few ms to avoid
   435								; saturating the bus
   436					RDREG T4,CS1
   437					TRNN T4,CS1RDY		;done?
   438					 sojg	t3,rmp1		;no, try again if haven't timed out
   439					JUMPLE	T3,RMPOPJ
   440					TRNN	T4,CS1TRE	;ANY ERRORS?
   441					AOS	(P)		;NO: READ/WRITE SUCCEEDED
   442				RMPOPJ:	POPJ	P,
   443				>;END IFCPU KS
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY

   444				IFCPU(F3),<	SUBTTL	Primitive READ/WRITE routines for FOONLY
   445
   446			020000	RTYCNT==20000
   447
   448			000001	DRVTYP==CDC
   449			000001	CDC==1
   450			000000	AMPEX==0
   451
   452				IFE DRVTYP-CDC,<
   453			000010	SPT==^D8		;SECTORS PER TRACK (DEPENDS ON HOW FORMATTED)
   454			000012	TPC==^D10		;TRACKS PER CYLINDER (NUMBER OF HEADS)
   455			001455	CPU==^D823-^D10		;CYLINDERS PER UNIT (TAKE AWAY SOME FOR MAINTAINENCE)
   456				>
   457				IFE DRVTYP-AMPEX,<
   458				SPT==^D8		;SECTORS PER TRACK
   459				TPC==^D5		;TRACKS PER CYL (NUMBER OF HEADS)
   460				CPU==^D815-^D5		;CYLINDERS PER UNIT (TAKE AWAY SOME FOR MAINTAINENCE)
   461				>;END IFN AMPEX
   462			000120	PPC==SPT*TPC		;PAGES PER CYLINDER
   463			000500	BPC==PPC*4		;BLOCKS PER CYLINDER
   464			177020	PPU==PPC*CPU		;PAGES PER UNIT
   465			000010	SPT==^D8		;SECTORS PER TRACK
   466			000040	BPT==SPT*^D4		;BLOCKS PER TRACK
   467			041624	USPR==^D17300		;MICROSECONDS PER REVOLUTION.
   468
   469				;DISK IOTS AND REGISTER BIT NAMES.
   470				PRINTF(<[F3 disk definitions are duplicated in MONBTS and APXKON]>)
   471
   472				OPDEF RCMD	[715000000000]	;READ COMMAND REGISTER
   473		400000	000000		SUNT==1B0		;SELECTED UNIT NOT THERE (SELECT ERROR)
   474		200000	000000		SUWP==1B1		;SELECTED UNIT WRITE PROTECT
   475		100000	000000		SUNR==1B2		;SELECTED UNIT NOT READY
   476				;---
   477		040000	000000		SUOC==1B3		;SELECTED UNIT ON CYLINDER
   478								; SHOULD ALWAYS BE SET EXCEPT AFTER RECAL UNTIL HEADS ALIGN
   479		020000	000000		SUSE==1B4		;SELECTED UNIT SEEK ERROR (DETECTED BY DRIVE)
   480								; RECAL MANDATORY AFTER THIS ERROR, FAULT CLEAR WILL NOT TURN T
   481				HIS OFF.
   482		010000	000000		SUF==1B5		;SELECTED UNIT FAULT (DETECTED BY DRIVE)
   483				;---
   484		004000	000000		SUA==1B6		;SELECTED UNIT ATTENTION
   485								; SET BY LEADING EDGE OF ON CYLINDER (BIT 3)
   486		002000	000000		HDECC==1B7		;ECC ERROR ON HEADER
   487		001000	000000		CI==1B8			;CONTROL IDLE (ONLY IF NO DATA XFER AND NO SEEKS OR RECALS GOIN

   488				G)
   489				;---
   490		000400	000000		SECC==1B9		;SOFT ECC ERROR (NOT YET IMPLEMENTED IN F3 MICROCODE)
   491		000200	000000		HECC==1B10		;ECC UNRECOVERABLE ERROR
   492
   493				;FOLLOWING BITS ARE DETECTED BY CONTROLLER:
   494		000100	000000		ROE==1B11		;READ OVERRUN ERROR
   495				;---
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5-2
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY

   496		000040	000000		WOE==1B12		;WRITE OVERRUN ERROR
   497		000020	000000		SOE==1B13		;SECTOR OVERRUN ERROR
   498		000010	000000		IPE==1B14		;INTERNAL PARITY ERROR (ONLY VALID IF AE, BIT 28, IS ZERO)
   499				;---
   500
   501				;FOLLOWING ARE FROM LAST LCMD
   502
   503		000004	000000		USC==1B15		;USE SECTOR COUNTER (FOR RPS, TELLS
   504								; CONTROLLER TO LISTEN TO DRIVE POSITION)
   505		000002	000000		REL==1B16		;RELEASE (FOR MULTI-PROCESSOR INTERLOCKING)
   506		000001	000000		RECAL==1B17		;RECALIBRATE (RESETS SEEK ERROR) (USE WITH COMMAND 4)
   507				;---
   508			400000		FC==1B18		;FAULT CLEAR (RESETS SEL UNIT FAULT - USE COMMAND 4)
   509				;	19 UNUSED
   510				;	20 UNUSED
   511				;---
   512			040000		SOM==1B21		;SERVO OFFSET MINUS
   513			020000		SOP==1B22		;SERVO OFFSET PLUS (OFFSET ONLY ON AMPEX DRIVES, NOT CDC)
   514			010000		CFM==1B23		;COMMAND FROM MEMORY
   515								; SENDS DATA FROM MEMORY TO DISK (USE WITH WRITE COMMANDS)
   516				;---
   517			004000		CMD0==1B24		;COMMAND BITS
   518			002000		CMD1==1B25
   519			001000		CMD2==1B26
   520				;---
   521			000400		CMD32==1B27		;32 BIT MODE PACKING
   522			000000			READ==0B26		;READ PAGE
   523			011000			WRITE==CFM+1B26	;WRITE PAGE (WITH CFM FOR CONVENIENCE)
   524			003000			WRITEA==3B26	;WRITE ALL (SECTOR AND FORMAT DATA)
   525			004000			CF==4B26		;CONTROL FUNCTION
   526				;		SEEK==5B26		;SEEK. (NOT IMPLEMENTED YET . . .)
   527
   528				;END OF FROM RCMD BITS
   529			000200		AE==1B28		;ANY  ERROR (EXCEPT IPE, BIT 14)
   530			000100		AA==1B29		;ANY UNIT ATTENTION
   531				;---
   532
   533				;FROM LCMD
   534			000040		AAIE==1B30		;ANY ATTENTION INTERRUPT ENABLE
   535
   536			000020		NA==1B31		;NOT ACTIVE
   537			000010		DIE==1B32		;DONE INTERRUPT ENABLE (SET BY DCONO WITH NOZERO PI ASSIGNMENT)

   538
   539				;---
   540				;BITS 33, 34 NOT IMPLEMENTED.
   541
   542			000001		MPE==1B35		;MEMORY PARITY ERROR
   543				;---
   544				OPDEF RMA	[716000000000]	;READ MEMORY ADDRESS
   545				OPDEF RDA	[717000000000]	;READ DISK ADDRESS (IN PAGES)
   546			000003		AMSUNI==^D3		;SIZE OF UNIT BYTE
   547			000006		AMPUNI==^D6		;RIGHTMOST BIT
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5-3
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY

   548		777777	777771		ROTUNI==-<AMPUNI+1>	;NUMBER OF PLACES TO ROTATE TO GET UNIT FIELD IN
   549			000014		AMSCYL==^D12
   550			000023		AMPCYL==^D19
   551			000010		AMSTRK==^D8
   552			000033		AMPTRK==^D27
   553			000010		AMSSEC==^D8
   554			000043		AMPSEC==^D35
   555		034000	177400		LDAMSK==034000,,177400	;MASK FOR $0% AND $0O IN DDT
   556				OPDEF RECC	[720000000000]	;READ CONTROL REGISTER
   557				OPDEF LCMD	[721000000000]	;LOAD COMMAND REGISTER
   558		000004	000000		USC==1B15		;USE SECTOR COUNTER (FOR RPS, TELLS
   559								; CONTROLLER TO LISTEN TO DRIVE POSITION)
   560		000002	000000		REL==1B16		;RELEASE (FOR MULTI-PROCESSOR INTERLOCKING)
   561		000001	000000		RECAL==1B17		;RECALIBRATE (RESETS SEEK ERROR) (USE WITH COMMAND 4)
   562			400000		FC==1B18		;FAULT CLEAR (RESETS SEL UNIT FAULT - USE COMMAND 4)
   563			040000		SOM==1B21		;SERVO OFFSET MINUS
   564			020000		SOP==1B22		;SERVO OFFSET PLUS (OFFSET ONLY ON AMPEX DRIVES, NOT CDC)
   565			010000		CFM==1B23		;COMMAND FROM MEMORY
   566								; SENDS DATA FROM MEMORY TO DISK (USE WITH WRITE COMMANDS)
   567			004000		CMD0==1B24		;COMMAND BITS
   568			002000		CMD1==1B25
   569			001000		CMD2==1B26
   570			000400		CMD32==1B27		;32 BIT MODE PACKING
   571			000000			READ==0B26		;READ PAGE
   572			011000			WRITE==CFM+1B26	;WRITE PAGE (WITH CFM FOR CONVENIENCE)
   573			003000			WRITEA==3B26	;WRITE ALL (SECTOR AND FORMAT DATA)
   574			004000			CF==4B26		;CONTROL FUNCTION
   575				;		SEEK==5B26		;SEEK. (NOT IMPLEMENTED YET . . .)
   576			000040		AAIE==1B30		;ANY ATTENTION INTERRUPT ENABLE
   577			000010		DIE==1B32		;DONE INTERRUPT ENABLE (SET BY DCONO WITH NOZERO PI ASSIGNMENT)

   578
   579				OPDEF LMA	[722000000000]	;LOAD MEMORY ADDRESS
   580				OPDEF LDA	[723000000000]	;LOAD DISK ADDRESS
   581		002000	000000		SU==1B7			;SELECT UNIT
   582								;MUST BE CLEARED AND SET TO SELECT A UNIT.
   583				OPDEF LECC	[724000000000]	;CLEARS ECC LOGIC, STARTS AND INITS CONTROL.
   584			000001		SC==1			;START CONTROL
   585			000002		IC==2			;INIT CONTROL (SEND BEFORE STARTING CMD)
   586				OPDEF DCONO	[740000000000]	;CONO TO DISK CONTROL TO SET PI ASSIGNMENT
   587				OPDEF DCONI	[741000000000]	;CONI FROM DISK CONTROL OPCODE
   588			000010		DIDLE==10		;SET IF CONTROL IS IDLE
   589			000007		DPIA==7B35		;PI ASSIGNMENT.
   590								;NOTE THAT NONZERO PI ASSIGNMENT SETS DIE (SEE LCMD)
   591				OPDEF DCONSO	[742000000000]
   592				OPDEF DCONSZ	[743000000000]
   593
   594				;ROUTINE TO START A FUNCTION UP ON CONTROL
   595
   596	000111'	724000	000266'	DOKON:	LECC	[IC]		;INIT CONTROL
   597	000112'	721000	000006		LCMD	T1		;DO THE COMMAND
   598	000113'	724000	000267'		LECC	[SC]		;START CONTROLLER
   599	000114'	263040	000000		POPJ	P,		;AND RETURN.
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5-4
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY

   600
   601	000115'	200300	000270'	CLRKON:	MOVE	T1,[CF+FC]	;COMMAND FUNCTION FAULT CLEAR
   602	000116'	260040	000111'	DOWKON:	PUSHJ	P,DOKON		;DO THE COMMAND AND THEN
   603	000117'	201340	020000	WATKON:	MOVEI	T2,RTYCNT	;NUMBER OF TIMES TO WAIT
   604	000120'	715000	000006		RCMD	T1
   605	000121'	607300	001000		TLNN	T1,(CI)		;CONTLOL IDLE YET?
   606	000122'	367340	000120'		SOJG	T2,.-2		;NO
   607	000123'	327340	000107'		JUMPG	T2,CPOPJ1	;JUMP IF IT WENT IDLE
   608	000124'	263040	000000		POPJ	P,		;DIDN'T.
   609
   610	000125'	550300	000012	APINI:	HRRZ	T1,W	;GET UNIT SELECTED
   611	000126'	241300	777771		ROT	T1,ROTUNI
   612	000127'	723000	000006		LDA	T1
   613	000130'	661300	002000		TLO	T1,(<SU>)
   614	000131'	723000	000006		LDA	T1
   615	000132'	260040	000115'		PUSHJ	P,CLRKON	;CLEAR CONTROL
   616	000133'	255000	000000		  JFCL			;IGNORE ERRORS FOR NOW
   617	000134'	715000	000006		RCMD	T1		;GET STATUS
   618	000135'	603300	500000		TLNE	T1,(<SUNT!SUNR>) ;NON-SKIP IF NOT THERE OR NOT READY
   619	000136'	263040	000000		POPJ	P,
   620	000137'	260040	000115'		PUSHJ	P,CLRKON	;CLEAR OUT CONTROL AGAIN
   621	000140'	263040	000000		  POPJ	P,		;TIMEOUT
   622	000141'	200300	000271'		MOVE	T1,[CF+FC+RECAL]
   623	000142'	260040	000116'		PUSHJ	P,DOWKON	;DO A RECAL IN CASE IT HAD SEEK ERROR
   624	000143'	263040	000000		  POPJ	P,		;NO GOOD.
   625	000144'	205300	000012		MOVSI	T1,^D10		;WAIT A LONG TIME
   626	000145'	715000	000007		RCMD	T2
   627	000146'	606340	000020		TRNN	T2,NA		;SKIP IF NOT ACTIVE ANYMORE.
   628	000147'	367300	000145'		SOJG	T1,.-2
   629	000150'	322300	000110'		JUMPE	T1,CPOPJ	;GO IF TIMED OUT
   630	000151'	715000	000006		RCMD	T1		;GET STATUS BITS AGAIN
   631	000152'	606300	000200		TRNN	T1,AE		;ERROR RETURN IF ANY ERRORS
   632	000153'	350001	000000		AOS	(P)		;NO ERRORS
   633	000154'	263040	000000		POPJ	P,
   634
   635				COMMENT ! PRIMITIVE ROUTINES TO READ OR WRITE A SPECIFIED NUMBER OF
   636					 WORDS STARTING AT AN ARBITRARY DISK PAGE FROM/TO AN
   637					 AMPEX OR CDC DISK DRIVE ON A FOONLY-F3.
   638					 PARAMETERS:	PG/ # OF WORDS,,DISK PAGE
   639							F/ CORE ADDR (NOT NECESSARILY ON PAGE BOUNDARY)
   640							W/ UNIT
   641					 CALL:	PUSHJ P,APXPRD	TO READ
   642						PUSHJ P,APXPWT	TO WRITE
   643					 RETURN:	SUCCESS: SKIP
   644							FAILURE: NON-SKIP
   645					 ACS ALTERED:	T1-T4,P1-P2
   646				!
   647
   648	000155'	334640	000272'	APXPRD:	SKIPA	P2,[APREAD]
   649	000156'	201640	000201'	APXPWT:	MOVEI	P2,APWRIT	;APPROPRIATE ROUTINE TO CALL.
   650	000157'	260040	000125'		PUSHJ	P,APINI		;INIT THE UNIT
   651	000160'	263040	000000		  POPJ	P,		;COULDN'T INIT THE DRIVE.
   652	000161'	261040	000003		PUSH	P,PG		;NEED TO SAVE THIS
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5-5
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY

   653	000162'	261040	000004		PUSH	P,F		;SO CAN DO MORE THAN ONE REC AND PRESERVE ARGS.
   654	000163'	554300	000003		HLRZ	T1,PG		;GET COUNT OF WORDS WANTED.
   655	000164'	622300	000777		TRZE	T1,777		;If not a multiple of 1000
   656	000165'	271300	001000		 ADDI	T1,1000		; round up
   657	000166'	242300	777767		LSH	T1,-9		;TURN INTO PAGES.
   658	000167'	213000	000006		MOVNS	T1		;- COUNT
   659	000170'	504140	000006		HRL	PG,T1		;MAKE INTO AN AOBJN POINTER
   660	000171'	260055	000000	APXPX1:	PUSHJ	P,(P2)		;CALL THE ROUTINE TO DO ONE PAGE
   661	000172'	254000	000176'		  JRST	APXPER		;NO GOOD.
   662	000173'	271200	001000		ADDI	F,1000		;ADVANCE MEMORY ADDRESS
   663	000174'	253140	000171'		AOBJN	PG,APXPX1
   664	000175'	350001	777776		AOS	-2(P)		;OK, GIVE SUCCESS RETURN.
   665
   666	000176'	262040	000004	APXPER:	POP	P,F
   667	000177'	262040	000003		POP	P,PG
   668	000200'	263040	000000		POPJ	P,
   669
   670				;HERE TO READ OR WRITE ONE PAGE WITH RH(PG) CONTAINING THE BLOCK NUMBER
   671				; W CONTAINING THE UNIT NUMBER AND F CONTANING THE MEMORY ADDRESS.
   672
   673	000201'	334600	000273'	APWRIT:	SKIPA	P1,[WRITE]
   674	000202'	201600	000000	APREAD:	 MOVEI	P1,READ
   675	000203'	550300	000003		HRRZ	T1,PG		;GET PAGE NUMBER
   676	000204'	231300	000120		IDIVI	T1,PPC		;GET T1/CYL, T2/PAGES INTO CYL
   677	000205'	231340	000010		IDIVI	T2,SPT		;GET T2/TRACK, T3/SECTOR IN TRACK
   678	000206'	137340	000274'		DPB	T2,[POINT AMSTRK,T3,AMPTRK]
   679	000207'	137300	000275'		DPB	T1,[POINT AMSCYL,T3,AMPCYL]
   680	000210'	550300	000012		HRRZ	T1,W
   681	000211'	241300	777771		ROT	T1,ROTUNI	;GET UNIT NUMBER INTO POSITION
   682	000212'	670400	000006		TDO	T3,T1
   683	000213'	723000	000010		LDA	T3
   684	000214'	661400	002000		TLO	T3,(<SU>)
   685	000215'	723000	000010		LDA	T3
   686	000216'	260040	000115'		PUSHJ	P,CLRKON	;CLEAR OUT CONTROL
   687	000217'	255000	000000		  JFCL			;IGNORE, WILL CATCH LATER.
   688	000220'	722000	000004		LMA	F		;LOAD MEMORY ADDRESS
   689								;NUMBER OF WORDS IS ALWAYS 1000
   690	000221'	200300	000014		MOVE	T1,P1		;GET COMMAND INTO T1 FOR DOKON
   691	000222'	260040	000111'		PUSHJ	P,DOKON	;START THE TRANSFER
   692	000223'	205300	000012		MOVSI	T1,^D10		;TIMEOUT IS ABOUT 10 SECONDS.
   693	000224'	715000	000007		RCMD	T2
   694	000225'	606340	000020		TRNN	T2,NA
   695	000226'	367300	000224'		 SOJG	T1,.-2
   696	000227'	322300	000110'		JUMPE	T1,CPOPJ	;TIMED OUT, ERROR
   697	000230'	715000	000006		RCMD	T1		;OK, GET COMMAND
   698	000231'	602300	000200		TRNE	T1,AE		;MAKE SURE NO ERROR BITS ON
   699	000232'	263040	000000		 POPJ	P,		;SORRY.
   700	000233'	603300	000010		TLNE	T1,(<IPE>)	;THIS IS ONLY VALID IF AE OFF
   701	000234'	263040	000000		POPJ	P,		;NO GOOD.
   702	000235'	716000	000006		RMA	T1
   703	000236'	621300	777774		TLZ	T1,777774	;CLEAR UNUSED BITS
   704	000237'	274300	000004		SUB	T1,F		;GET NUMBER OF WORDS XFERRED
   705	000240'	302300	001000		CAIE	T1,1000
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5-6
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY

   706	000241'	263040	000000		 POPJ	P,		;WRONG COUNT
   707	000242'	254000	000107'		JRST	CPOPJ1		;OK, SUCCESSFUL XFER.
   708				>;END IFCPU (F3)
   709
   710	000243'	500000	400000*		$END	(BTS)

   711	000244'	777777	777777

   712	000245'	000000	000000

   713	000246'	200167	741702

   714	000247'	671176	420344

   715	000250'	627034	420204

   716	000251'	476372	451502

   717	000252'	204164	000000

   718	000253'	064244	241236

   719	000254'	476512	320330

   720	000255'	677034	462710

   721	000256'	210321	220100

   722	000257'	000000	000000

   723	000260'	376535	664750

   724	000261'	203114	172302

   725	000262'	203055	467706

   726	000263'	655015	562746

   727	000264'	717134	420352

   728	000265'	700321	200000

   729	000266'	000000	000002

   730	000267'	000000	000001

   731	000270'	000000	404000

   732	000271'	000001	404000

   733	000272'	000000	000202'

   734	000273'	000000	011000
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 5-7
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for FOONLY


   735	000274'	101000	000010

   736	000275'	201400	000010

   737						;End of MONBTS (BTSLIT: BTSEND:)
   738
NO ERRORS DETECTED
PROGRAM BREAK IS 000276
7K CORE USED
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88 PAGE 6
MONBTS.MAC	20-SEP-87 13:43		SYMBOL TABLE

AA		000100	SPD	CTYTYP		000105'	EXT	RMA	716000	000000		
AAIE		000040	SPD	DCONI	741000	000000		RMXPBT		000033'		
AE		000200	SPD	DCONO	740000	000000		RMXPRD		000104'		
AMPCYL		000023	SPD	DCONSO	742000	000000		RMXPWT		000104'		
AMPEX		000000	SPD	DCONSZ	743000	000000		ROE	000100	000000	SPD	
AMPSEC		000043	SPD	DIDLE		000010	SPD	ROTUNI	777777	777771	SPD	
AMPTRK		000033	SPD	DIE		000010	SPD	RTYCNT		020000	SPD	
AMPUNI		000006	SPD	DOKON		000111'		S$ENTR	777777	777775	SIN	
AMSCYL		000014	SPD	DOWKON		000116'		S$HALT	777777	777777	SIN	
AMSSEC		000010	SPD	DPIA		000007	SPD	S$NAME		000000'	SPD	
AMSTRK		000010	SPD	DRVTYP		000001	SPD	S$NONA		000000	SIN	
AMSUNI		000003	SPD	EPT.PN		000022'	EXT	S$TEMP	777775	000000	SPD	
APINI		000125'		F		000004	INT	S$XCT	777777	777776	SIN	
APREAD		000202'		FC		400000	SPD	SAXPRD		000104'		
APWRIT		000201'		HDECC	002000	000000	SPD	SAXPWT		000104'		
APXPER		000176'		HECC	000200	000000	SPD	SC		000001	SPD	
APXPRD		000155'		IC		000002	SPD	SECC	000400	000000	SPD	
APXPWT		000156'		INLMES		000003'	EXT	SOE	000020	000000	SPD	
APXPX1		000171'		IPE	000010	000000	SPD	SOM		040000	SPD	
BADPRD		000104'		ISBOOT		000044'		SOP		020000	SPD	
BADPWT		000104'		J		000002	INT	SPT		000010	SPD	
BCDSSZ		003000	SPD	LCMD	721000	000000		SU	002000	000000	SPD	
BCDSZ		002600	SPD	LDA	723000	000000		SUA	004000	000000	SPD	
BOOTCL		000056'		LDAMSK	034000	177400	SPD	SUF	010000	000000	SPD	
BOOTFI		000060'		LECC	724000	000000		SUNR	100000	000000	SPD	
BOOTS		775000	INT	LG.LAB	400000	000000	SPD	SUNT	400000	000000	SPD	
BOTLOD		000020'	INT	LG.LUB	100000	000000	SPD	SUOC	040000	000000	SPD	
BPC		000500	SPD	LMA	722000	000000		SUSE	020000	000000	SPD	
BPT		000040	SPD	MONBTS		000000'	ENT	SUWP	200000	000000	SPD	
BTADR		000055'		MPE		000001	SPD	T1		000006	INT	
BTSEND		000275'	INT	NA		000020	SPD	T2		000007	INT	
BTSLIT		000243'	INT	NEWMON		000030'	INT	T3		000010	INT	
BTSTR		000052'	EXT	NOBOOT		000041'		T4		000011	INT	
BUGDMP		000003'	INT	P		000001	INT	TNCONO	744000	000000		
CDC		000001	SPD	P1		000014	INT	TPC		000012	SPD	
CF		004000	SPD	P2		000015	INT	UNYKTP		000071'	EXT	
CFM		010000	SPD	PG		000003	INT	UNYPUN		000070'	EXT	
CI	001000	000000	SPD	PI		000004	SPD	UNYSCN		000067'	EXT	
CLRKON		000115'		PI.OFF		000400	SPD	UPT.PN		000000	EXT	
CMD0		004000	SPD	PJRST	324740	000000		USC	000004	000000	SPD	
CMD1		002000	SPD	PMDDSP		000075'		USPR		041624	SPD	
CMD2		001000	SPD	PMDRD		000061'	INT	W		000012	INT	
CMD32		000400	SPD	PMDSET		000067'		WATKON		000117'		
CPOPJ		000110'		PMDWT		000064'	INT	WOE	000040	000000	SPD	
CPOPJ1		000107'		PPC		000120	SPD	WRADB	700140	000000		
CPU		001455	SPD	PPU		177020	SPD	WRAPR	700200	000000		
CPUF3		000004	SPD	RCMD	715000	000000		WREBR	701200	000000		
CPUKI		000001	SPD	RDA	717000	000000		WRITE		011000	SPD	
CPUKL		000002	SPD	READ		000000	SPD	WRITEA		003000	SPD	
CPUKS		000003	SPD	REBOOT		000016'		WRUBR	701140	000000		
CPUTYP		000004	SPD	RECAL	000001	000000	SPD	.CPEPD		000027'	EXT	
CPZZ		000001	SPD	RECC	720000	000000		

MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Symbol cross reference

AA	   530#
AAIE	   534#	   576#
AE	   529#	   631	   698
AMPCYL	   550#	   679
AMPEX	   450#	   457
AMPSEC	   554#
AMPTRK	   552#	   678
AMPUNI	   547#	   548
AMSCYL	   549#	   679
AMSSEC	   553#
AMSTRK	   551#	   678
AMSUNI	   546#
APINI	   610#	   650
APREAD	   648	   674#
APWRIT	   649	   673#
APXPER	   661	   666#
APXPRD	    66	   151	   648#
APXPWT	   151	   649#
APXPX1	   660#	   663
BADPRD	   145	   146	   147	   148	   157#
BADPWT	   145	   146	   147	   148	   156#
BCDSSZ	    98#
BCDSZ	    97#	    98	    99	   100
BOOTCL	    45	    65	    85	    94	   100#
BOOTFI	    87	   103#
BOOTS	    42#	    44	   100
BOTLOD	    31#	    82
BPC	   463#
BPT	   466#
BTADR	    64	    99#
BTSEND	   737#
BTSLIT	   710#
BTSTR	    34%	    34	    93%	    93
BUGDMP	    20#	    26
CDC	   448	   449#	   452
CF	   525#	   574#	   601	   622
CFM	   514#	   523	   565#	   572
CI	   487#	   605
CLRKON	   601#	   615	   620	   686
CMD0	   517#	   567#
CMD1	   518#	   568#
CMD2	   519#	   569#
CMD32	   521#	   570#
CPOPJ	   162#	   629	   696
CPOPJ1	   161#	   607	   707
CPU	   455#	   464
CPUF3	    30	    35	    36	    62	    66	   154	   444
CPUKI	    47	   122	   155	   163
CPUKL	    47	   122	   155	   163
CPUKS	    30	    37	    62	    67	    71	   153	   346
CPUTYP	    30	    35	    36	    37	    47	    62	    66	    67	    71	   122	   153	   154	   155	   163
	   346	   444
CPZZ	    30#	    30	    35#	    35	    36#	    36	    37#	    37	    47#	    47	    62#	    62	    66#	    66
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Symbol cross reference

	    67#	    67	    71#	    71	   122#	   122	   153#	   153	   154#	   154	   155#	   155	   163#	   163	   346#
	   346	   444#	   444
CTYTYP	    81%	    81	    92%	    92	   159%	   159
DIDLE	   588#
DIE	    11	    12	   537#	   577#
DOKON	   596#	   602	   691
DOWKON	   602#	   623
DPIA	   589#
DRVTYP	   448#	   452	   457
EPT.PN	    30%	    33
F	    44	    45	    65	   653	   662	   666	   688	   704
FC	   508#	   562#	   601	   622
HDECC	   486#
HECC	   491#
IC	   585#	   596
INLMES	    20%	    20
IPE	   498#	   700
ISBOOT	    69	    85#
J	   117
LDAMSK	   555#
LG.LAB	    32
LG.LUB	    32
LISTSN	     3	     6
MONBTS	    11	    12#	    15
MPE	   542#
NA	   536#	   627	   694
NEWMON	    27	    39	    44#
NOBOOT	    80#
P	    12	    20	    24	    26	    38	    66	   107	   112	   141	   160	   161	   162	   599	   602
	   608	   615	   619	   620	   621	   623	   624	   632	   633	   650	   651	   652	   653	   660
	   664	   666	   667	   668	   686	   691	   699	   701	   706
P1	    80	    89	   157	   673	   674	   690
P2	   648	   649	   660
PG	    64	   120	   121	   652	   654	   659	   663	   667	   675
PI	    31	    36
PI.OFF	    31
PMDDSP	   108	   113	   144#
PMDRD	   107#
PMDSET	   107	   112	   117#
PMDWT	   112#
PPC	   462#	   463	   464	   676
PPU	   464#
READ	   522#	   571#	   674
REBOOT	    26#
RECAL	   506#	   561#	   622
REL	   505#	   560#
RMXPBT	    64#	    70
RMXPRD	   150	   153#
RMXPWT	   150	   153#
ROE	   494#
ROTUNI	   548#	   611	   681
RTYCNT	   446#	   603
S$ENTR	    11	    17
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Symbol cross reference

S$HALT	    11
S$NAME	    15#
S$NONA	    14	    17
S$TEMP	    11#	    11
S$XCT	    17
SAXPRD	   149	   155#
SAXPWT	   149	   155#
SC	   584#	   598
SECC	   490#
SOE	   497#
SOM	   512#	   563#
SOP	   513#	   564#
SPT	   453#	   462	   465#	   466	   677
SU	   581#	   613	   684
SUA	   484#
SUF	   482#
SUNR	   475#	   618
SUNT	   473#	   618
SUOC	   477#
SUSE	   479#
SUWP	   474#
T1	    81	    92	   108	   109	   113	   114	   119	   159	   597	   601	   604	   605	   610	   611
	   612	   613	   614	   617	   618	   622	   625	   628	   629	   630	   631	   654	   655	   656
	   657	   658	   659	   675	   676	   679	   680	   681	   682	   690	   692	   695	   696	   697
	   698	   700	   702	   703	   704	   705
T2	    85	    86	   603	   606	   607	   626	   627	   677	   678	   693	   694
T3	    86	    87	   678	   679	   682	   683	   684	   685
T4	    69	    88
TPC	   454#	   462
UNYKTP	   119%	   119
UNYPUN	   118%	   118
UNYSCN	   117%	   117
UPT.PN	    30%	    32
USC	   503#	   558#
USPR	   467#
W	    63	    70	   118	   610	   680
WATKON	   603#
WOE	   496#
WRITE	   523#	   572#	   673
WRITEA	   524#	   573#
.CPEPD	    38%	    38
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:55 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Macro/Opdef cross reference

DCONI	   587#
DCONO	   586#
DCONSO	   591#
DCONSZ	   592#
IFCPU	    30	    35	    36	    47	    62	    66	    67	    71	   122	   163	   346	   444
IFNCPU	    37	   153	   154	   155
LCMD	   557#	   597
LDA	   580#	   612	   614	   683	   685
LECC	   583#	   596	   598
LMA	   579#	   688
PFALL	    39
PJRST	   109	   114
PRINTF	    19	   470
RCMD	   472#	   604	   617	   626	   630	   693	   697
RDA	   545#
RECC	   556#
RMA	   544#	   702
STOPCD	    10
SYSPIF	    31
TNCONO	    35
WRADB	    37
WRAPR	   103
WREBR	    33
WRUBR	    32
$END	   710 J U+
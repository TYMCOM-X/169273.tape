LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KSSYM.MAC IN COMMON ONLY
     7					.CREF
     8									TAPE>>
     9				; This file is PRINTF.MAC
    10				DEFINE PRINTF(A,B,C,D),<IF2,<;;Output message on MONKS build only
    11				PRINTX A B C D>>
    12
    13				TITLE LP2SER Line printer service for LP20 controller.
    14				SUBTTL DSB
    15					STOPCD(,ENTRY,LPTSER)^
    16					ENTRY	LPTSER		;For library searches
    17	000000'	260040	000000*	LPTSER::PUSHJ	P,DIE		;**** Default stopcode for "LPTSER" ****
    18	000001'	546064	634562		SIXBIT	/LPTSER/  	;Title of module
    19	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "LPTSER+nnn(nnnnnn)"
    20			000000'	S$NAME==LPTSER			;For STOPCDs with no arguments
    21					SALL>
    22				^
    23
    24				OPDEF CALL [PUSHJ P,]
    25				OPDEF RET [POPJ P,]
    26
    27				;Device registers
    28				DEFINE IOREG(REGNAME,OFFSET,BITLST,MSB)
    29				<ZZ==100000
    30				IFNB <MSB>,<ZZ==MSB>
    31				REGNAME'OFS==OFFSET
    32				IRP BITLST,<REGNAME'BITLST==ZZ
    33				ZZ==ZZ/2
    34				>>
    35				IOREG(CSA,0,<ERR,PZ,UC,DR,OL,DH,ER,LI,DON,IE,A17,A16,DL,TM,PE,GO>)
    36				    ;Function codes
    37			000000		F.PD==0		;Print data mode.
    38			000010		F.LV==CSADL	;Load VFU mode.
    39				IOREG(CSB,2,<VD,,PNR,LDP,OO,T02,T01,T00,OL,DNR,LPE,MPE,RPE,MTE,DTE,GE>)
    40			000377	    ANYRBE==CSBDNR+CSBLPE+CSBMPE+CSBRPE+CSBMTE+CSBDTE+CSBGE+CSBOL
    41				IOREG(BA,4)
    42				IOREG(BC,6)
    43				IOREG(PC,10)
    44				IOREG(RDR,12,<RAP,INT,DEL,TRA,PI>,10000)
    45				IOREG(CC,15)
    46				IOREG(CB,14)
    47				IOREG(CKS,17)
    48				IOREG(PD,16)
    49			000010	NLP20R==10		;Number of LP20 registers.
    50				IOREG(PGR,763000,<REV,DIS,FST,VAL>,400000)
    51
    52				EXTERN CPOPJ1,CPOPJ,SETIOD,HNGSTP,ERROCI,STOIOS,DEVERR
    53				EXTERN SETACT,WAIT1
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 1
LP2SER.MAC	30-OCT-87 16:49		DSB

    54				EXTERN LPVLPT,LPCFPT,LP0DDB,LPTSB,NXDLPT
    55				EXTERN LPT11A,LPTBA,LPTEC,LPTFUN,LPTSTS,LPTWC,SIZLPT,LPTLBA
    56
    57				;Data structures.
    58				;Data is moved by LPTXFR from the
    59				;user ring buffers into the monitor ring buffer in
    60				;response to the OUT UUO.  Before initiating
    61				;a transfer, SOP copies the next block
    62				;of data to be output from the monitor buffer into the LPT buffer
    63				;moving the bytes around as required for byte accesses
    64				;made by the UBA.
    65				;The format of the user buffers is irrelevant to
    66				; this module.
    67				;The format of the monitor ring buffer is:
    68				; DEVCLS of the DDB points to the first location
    69				; in the buffer.  the first word before the
    70				; buffer is the address of the first word above the
    71				; buffer.  The second word before the buffer contains
    72				; the In pointer in the left half, the Out pointer
    73				; in the right half.  The in pointer is adjusted by UUOCON,
    74				; the Out pointer by this module.
    75				;The LPT buffer is pointed at by LPTLBA in the DDB.
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 2
LP2SER.MAC	30-OCT-87 16:49		DSB

    76
    77
    78				;LINE PRINTER DEVICE DEPENDENT I/O STATUS MNEMONIC DEFINITIONS
    79
    80			400000	LPTEND==400000		;CLOSE UUO has been done.
    81			200000	LPTRBL==200000		;LPT trouble detected at I-level.
    82			100000	LPTPAR==100000		;Partial buffer already output.
    83			040000	LPTRAM==40000		;LP20 RAM not loaded.
    84			020000	LPTVFU==20000		;Printer DAVFU not loaded.
    85			010000	LPTMO==10000		;Internal output done.
    86
    87				;BITS IN RH OF S
    88			000100	LPTNFF==100		;Suppress FFs before, after output.
    89
    90				;LINE PRINTER SERVICE DISPATCH TABLE
    91
    92	000000			LPTDSP::PHASE 0
    93	000003'	000000	000014	DDXZ:	DSPSIZ
    94	000004'	263040	000000	DDINT:	RET
    95	000005'	004400	004400	DBYT:	4400,,4400
    96	000006'	201300	000000*	DVSIZ:	MOVEI T1,SIZLPT
    97	000007'	254000	000020'	DINI:	JRST LPTINI
    98	000010'	254000	000032'	DHNG:	JRST LPTHNG
    99	000011'	254000	000033'	DRL:	JRST LPTREL
   100	000012'	254000	000463'	DCL:	JRST LPTCLS
   101	000013'	254000	000271'	DOU:	JRST LPTOUT
   102	000014'	254000	000000*	DIN:	JRST ERROCI
   103	000015'	254000	000475'	DXFR:	JRST LPTXFR
   104	000016'	263040	000000	DGTRO:	POPJ P,		;UNDEFINED
   105	000017'	254000	000044'	DMT:	JRST INIVFU	;VFU INITIALIZATION UUO
   106			000014		DSPSIZ==.-1
   107	000020'				DEPHASE
   108
   109
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 3
LP2SER.MAC	30-OCT-87 16:49		DSB

   110
   111
   112				SUBTTL LPTINI, LPTHNG, LPTREL - init, hung device, release
   113
   114				;LPTINI.  Called at system start time.
   115				;	 The code skip returns to force calling for each
   116				;	 configured LPT.
   117
   118				;LPTHNG.  Called by DEVCHK&UUOCON when hung device count
   119				;	  is decremented to 0.
   120
   121				;LPTREL.  Called by RELEA1&UUCON in response to user RELEAS uuo.
   122
   123				;All are passed the LPT's DDB in F and must clear the printer.
   124				; LPTHNG and LPTINI mark the RAM and DAVFU for loading in
   125				; the theory that the printer may have dropped off line.
   126
   127
   128	000020'	661000	060000	LPTINI::TLO S,LPTRAM+LPTVFU	;Flag RAM, VFU need loading.
   129	000021'	260040	000033'		CALL LPTREL		;Clear LPT, save S.
   130	000022'	332000	000000*		SKIPE NXDLPT		;Does this system have an LP20?
   131	000023'	254000	000000*		 JRST	CPOPJ1		;No, quit now
   132	000024'	135300	000717'		LDB T1,[130700+F,,LPTLBA]	;-11 page of buffer
   133	000025'	270300	000720'		ADD T1,[3,,PGROFS]	;Paging RAM entry for buffer.
   134	000026'	135340	000721'		LDB T2,[POINT 9,LPTLBA(F),8]	;-10 page of buffer
   135	000027'	660340	040000		TRO T2,PGRVAL
   136	000030'	713346	000000		WRIO T2,(T1)		;Map -11 page into -10 buffer.
   137	000031'	254000	000023*		JRST CPOPJ1
   138
   139	000032'	661000	060000	LPTHNG::TLO S,LPTRAM+LPTVFU
   140	000033'	200304	000000*	LPTREL::MOVE T1,LPTBA(F)	;Base adr of LP20 registers
   141	000034'	260040	000000*		PUSHJ P,UBGOOD##	;See if LP20 is plugged in
   142					 JRST [SETZM NXDLPT	;Printer does not exist
   143	000035'	254000	000722'		       POPJ P,]		;Not there
   144	000036'	201340	000400		MOVEI T2,CSALI		;Local init.
   145	000037'	713346	000000		WRIO T2,CSAOFS(T1)
   146	000040'	201340	001000		MOVEI T2,CSAER		;Clear error indicators.
   147	000041'	714346	000000		BSIO T2,CSAOFS(T1)
   148	000042'	621000	300000		TLZ S,LPTRBL+LPTPAR	;No error, no partial buffer out.
   149	000043'	254000	000000*		JRST STOIOS
   150
   151			000000		VFUBUF==LPVLPT	;our symbol for the COMMOD buffer
   152			000217		MAXC==^D143	;allow no more commands than max DAVFU lines
   153			000130		MAXLN==^D88	;only allow 88 lines for now
   154	000044'	336000	000022*	INIVFU::SKIPN	NXDLPT
   155	000045'	254000	000000*		  JRST	CPOPJ
   156	000046'	200304	000033*		MOVE T1,LPTBA(F)	;Base adr of LP20 registers.
   157	000047'	712346	000002		RDIO T2,CSBOFS(T1)      ;Read status register
   158	000050'	602340	000200		TRNE T2,CSBOL		;Printer offline?
   159	000051'	254000	000045*		  JRST	CPOPJ		;Error return if off line.
   160	000052'	260040	000000*		CALL WAIT1	;Wait for IOACT to go off
   161	000053'	551553	000000		HRRZI M,(M)	;M points to current(the first for now) command
   162							;FIRST TEST FOR A SINGLE RESET TOF COMMAND
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 3-2
LP2SER.MAC	30-OCT-87 16:49		LPTINI, LPTHNG, LPTREL - init, hung device, release

   163	000054'	256200	000724'	PXCT 4,[HLRZ	T3,(M)]	;T3/cmd op and channel mask
   164	000055'	405400	300000		ANDI	T3,(3B2);T3/cmd op
   165	000056'	302400	200000		CAIE	T3,(1B1);skip if RESET TOF cmd
   166	000057'	254000	000062'		  JRST	CMDLST	;  else go process the reload command list
   167	000060'	200300	000267'		MOVE T1,NEWTOF	;set up for a one byte (357) LODVFU
   168	000061'	254000	000446'		JRST	LPTFLV	;go into LODVFU routine
   169							;----------------------------------------------
   170	000062'	260040	000154'	CMDLST:	CALL ERRSCN	;scan command list for errors
   171	000063'	263040	000000		  POPJ	P,	;NON-SKIP RETURN! (bad command list)
   172	000064'	260040	000143'	CMDLUP:	CALL GETCMD	;T3/op + chan mask; T2/last line; T1/first line
   173	000065'	623400	200000		TLZE	T3,(1B1);test 'this is the final command' bit
   174	000066'	254000	000101'		  JRST	RLDVFU	;  if set go and RELOAD VFU
   175	000067'	260040	000174'	VFULUP:	CALL FETCH	;else fetch the channel stops for current line
   176	000070'	603400	100000		TLNE	T3,(1B2);command bit tells wether to set or reset the
   177	000071'	436400	000006		  IORM	T3,T1	;	masked channels.  IORM sets them.
   178	000072'	607400	100000		TLNN	T3,(1B2);skip if bit 2 is set
   179	000073'	412400	000006		  ANDCAM T3,T1	;	reset masked bits.
   180	000074'	260040	000213'		CALL STORE	;store bits 6-17 of T1 as channel stops 12-1
   181	000075'	271300	000001		ADDI	T1,1	;increment current line
   182	000076'	307307	000000		CAIG 	T1,(T2)	;if current line .GE. last line skip out of loop
   183	000077'	254000	000067'		  JRST	VFULUP	;else process the new current line
   184	000100'	344540	000064'		AOJA	M,CMDLUP;increment command pointer and loop back
   185
   186	000101'	515400	004000	RLDVFU:	HRLZI	T3,4000	;channel 12 mask bit
   187	000102'	260040	000174'		CALL FETCH	;fetch channel stops for bottom line of page
   188	000103'	436400	000006		IORM	T3,T1	;set channel 12 "bottom of form" stop
   189	000104'	260040	000213'		CALL STORE
   190	000105'	515400	000001		HRLZI	T3,1	;channel 1 mask bit
   191	000106'	201300	000000		MOVEI	T1,0	;set current line pointer to zero
   192	000107'	260040	000174'		CALL FETCH
   193	000110'	436400	000006		IORM	T3,T1	;set channel 1 "top of form" stop
   194	000111'	260040	000213'		CALL STORE
   195	000112'	201400	000356		MOVEI	T3,356
   196	000113'	200440	000725'		MOVE	T4,[POINT 18,VFUBUF+1]	;skip 2 bits
   197	000114'	136400	000011		IDPB T3,T4	;put start byte (356) in first byte position.
   198	000115'	242340	000001		LSH	T2,1	;T2/(form length -1)*2
   199	000116'	271340	000002		ADDI	T2,2	;T2/number of bytes to be sent to printer davfu
   200	000117'	201307	000000		MOVEI	T1,(T2)	;T1/T2
   201	000120'	133300	000264'		ADJBP T1,VFUPTR	;T1/byte pointer to last byte to be sent
   202	000121'	201400	000357		MOVEI	T3,357
   203	000122'	261040	000014		PUSH	P,P1
   204	000123'	200600	000006		MOVE	P1,T1
   205	000124'	260040	000233'		CALL FWADJ
   206	000125'	136400	000014		IDPB	T3,P1	;put stop byte (357) in last byte position.
   207	000126'	201400	000000		MOVEI	T3,0	;zero T3
   208	000127'	136400	000014		IDPB	T3,P1
   209	000130'	136400	000014		IDPB	T3,P1
   210	000131'	136400	000014		IDPB	T3,P1	;once more just to be sure
   211	000132'	200600	000006		MOVE	P1,T1
   212	000133'	260040	000240'		CALL HWADJ
   213	000134'	262040	000014		POP	P,P1
   214	000135'	201307	000004		MOVEI	T1,4(T2);T1/number of bytes to be sent plus 3(+1)
   215	000136'	242300	000020		LSH	T1,^D16	;T1/number of words to be sent,,?
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 3-3
LP2SER.MAC	30-OCT-87 16:49		LPTINI, LPTHNG, LPTREL - init, hung device, release

   216	000137'	541307	000000		HRRI	T1,(T2)	;T1/# of words,,# of bytes
   217	000140'	502300	000000*		HLLM T1,VFUBUF	;put number of words in left half of vfubuf
   218	000141'	350001	000000		AOS	0,(P)
   219	000142'	254000	000441'		JRST LODVFU	;LOAD THE VFU AND RETURN!
   220
   221
   222	000143'	256200	000726'	GETCMD:	PXCT 4,[HLLZ T3,(M)]	;T3/cmd op and channel mask,,0
   223	000144'	256200	000727'		PXCT 4,[HRRZ T2,(M)]	;T2 will hold "last line"
   224	000145'	200300	000007		MOVE	T1,T2
   225	000146'	242300	777767		LSH	T1,-9	;T1 will hold "current line"
   226	000147'	275340	000001		SUBI	T2,1
   227	000150'	275300	000001		SUBI	T1,1
   228	000151'	405340	000377		ANDI	T2,377	;T2/last line
   229	000152'	405300	000377		ANDI	T1,377	;T1/current line
   230	000153'	263040	000000		RET
   231
   232	000154'	261040	000013	ERRSCN:	PUSH	P,M	;save command pointer
   233	000155'	505540	777561		HRLI	M,-MAXC	;M/-max command count,,command pointer
   234	000156'	260040	000143'	ERRLUP:	CALL GETCMD	;T3/cmd & mask; T1/current line; T2/last line
   235	000157'	303340	000130		CAILE	T2,MAXLN
   236	000160'	254000	000172'		  JRST	VFUERR	;last line must be .LE. max lines in VFUBUF
   237	000161'	303307	000000		CAILE	T1,(T2)
   238	000162'	254000	000172'		  JRST	VFUERR	;starting line must be .LE. last line
   239	000163'	607400	200000		TLNN	T3,(1B1);test 'this is the final command' bit
   240	000164'	254000	000171'		  JRST	TSTMAX	;if bit is 0 go see if we should loop again
   241	000165'	607400	100000		TLNN	T3,(1B2);bit 2 must be set for a RELOAD DAVFU cmd
   242	000166'	254000	000172'		  JRST	VFUERR	;RESET TOF is an illegal list terminator
   243	000167'	262040	000013		POP	P,M	;restore initial command pointer
   244	000170'	254000	000031*		JRST	CPOPJ1	;SKIP RETURN! all commands are good.
   245	000171'	253540	000156'	TSTMAX:	AOBJN M,ERRLUP	;go check next cmd (unless we've exceeded MAXC)
   246	000172'	262040	000013	VFUERR:	POP	P,M	;restore the stack
   247	000173'	263040	000000		RET		;NON-SKIP RETURN! (bad or too many commands)
   248
   249	000174'	261040	000014	FETCH:	PUSH	P,P1
   250	000175'	201606	000000		MOVEI	P1,(T1)	;P1/current line
   251	000176'	242600	000001		LSH	P1,1	;P1/byte offset into vfubuf
   252	000177'	271600	000002		ADDI	P1,2	;skip two for the start byte
   253	000200'	133600	000264'		ADJBP P1,VFUPTR	;P1=pointer to byte just before this line's
   254	000201'	261040	000014		PUSH	P,P1
   255	000202'	260040	000233'		CALL FWADJ	;pack bytes of 2 words at (P1) left justified
   256	000203'	134440	000014		ILDB	T4,P1	;get channel stops 6-1 of current line
   257	000204'	137440	000265'		DPB T4,C6TO1	;deposit them in bits 12-17 of T1.
   258	000205'	134440	000014		ILDB	T4,P1	;get channel stops 12-7 of current line
   259	000206'	137440	000266'		DPB T4,C12TO7	;deposit them in bits 6-11 of T1.
   260	000207'	262040	000014		POP	P,P1	;P1/ as it was before the ILDB's
   261	000210'	260040	000240'		CALL HWADJ	;re-adjust the bytes into 16 bit half words
   262	000211'	262040	000014		POP	P,P1
   263	000212'	263040	000000		RET
   264
   265	000213'	261040	000014	STORE:	PUSH	P,P1
   266	000214'	201606	000000		MOVEI	P1,(T1)
   267	000215'	242600	000001		LSH	P1,1
   268	000216'	271600	000002		ADDI	P1,2	;skip two for the start byte
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 3-4
LP2SER.MAC	30-OCT-87 16:49		LPTINI, LPTHNG, LPTREL - init, hung device, release

   269	000217'	133600	000264'		ADJBP P1,VFUPTR	;P1=pointer to byte just before this line's
   270	000220'	261040	000014		PUSH	P,P1
   271	000221'	260040	000233'		CALL FWADJ	;pack bytes of 2 words at (P1) left justified
   272	000222'	135440	000265'		LDB T4,C6TO1	;T4/six bits from T1 positions 12-17
   273	000223'	136440	000014		IDPB	T4,P1	;put chan stops 6-1 for current line in vfubuf
   274	000224'	135440	000266'		LDB T4,C12TO7	;T4/six bits from T1 positions 6-11
   275	000225'	136440	000014		IDPB	T4,P1	;put chan stops 12-7 for current line in vfubuf
   276	000226'	262040	000014		POP	P,P1	;P1/ as it was before the ILDB's
   277	000227'	260040	000240'		CALL HWADJ	;re-adjust the bytes into 16 bit half words
   278	000230'	405300	000377		ANDI	T1,377	;T1/0,,current line
   279	000231'	262040	000014		POP	P,P1
   280	000232'	263040	000000		RET
   281
   282	000233'	261040	000014	FWADJ:	PUSH	P,P1
   283	000234'	260040	000245'		CALL FW
   284	000235'	260040	000245'		CALL FW		;pack the next word
   285	000236'	262040	000014		POP	P,P1
   286	000237'	263040	000000		RET
   287
   288	000240'	261040	000014	HWADJ:	PUSH	P,P1
   289	000241'	260040	000254'		CALL HW
   290	000242'	260040	000254'		CALL HW		;pack the next word
   291	000243'	262040	000014		POP	P,P1
   292	000244'	263040	000000		RET
   293
   294	000245'	200454	000000	FW:	MOVE	T4,(P1)	;T4/ x x 16 bits,, x x 16 bits
   295	000246'	242440	000002		LSH	T4,2
   296	000247'	500454	000000		HLL	T4,(P1)	;T4/ x x 16 bits,,16 bits 0 0
   297	000250'	242440	000002		LSH	T4,2	;T4/ four 8 bit bytes then four bits of 0
   298	000251'	202454	000000		MOVEM	T4,(P1)
   299	000252'	271600	000001		ADDI	P1,1	;increment P1
   300	000253'	263040	000000		RET
   301
   302	000254'	200454	000000	HW:	MOVE	T4,(P1)	;T4/ four left justified 8 bit bytes
   303	000255'	242440	777776		LSH	T4,-2
   304	000256'	502454	000000		HLLM	T4,(P1)	;(P1)/ 0 0 16 bits,,xxxxxxxxxxxxxxxxxx
   305	000257'	550440	000011		HRRZ	T4,T4	;zero left half of T4
   306	000260'	242440	777776		LSH	T4,-2	;T4/ 0,,0 0 two bytes
   307	000261'	542454	000000		HRRM	T4,(P1) ;(P1)/ 0 0 two bytes,,0 0 two bytes
   308	000262'	271600	000001		ADDI	P1,1	;increment P1
   309	000263'	263040	000000		RET
   310
   311
   312	000264'	441000	000001*	VFUPTR:	POINT 8,VFUBUF+1
   313	000265'	220600	000006	C6TO1:	POINT 6,T1,17
   314	000266'	300600	000006	C12TO7:	POINT 6,T1,11
   315	000267'	000001	000000*	NEWTOF:	XWD	1,<<.&777>_2>+4	;MOVE TO LPTBUF PAGE IN COMMOD
   316	000270'	776000	000000		BYTE (8) 377,0
   317
   318
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 4
LP2SER.MAC	30-OCT-87 16:49		LPTINI, LPTHNG, LPTREL - init, hung device, release

   319
   320				SUBTTL LPTOUT, LPTCLS - output, close UUOs
   321
   322				;LPT Called when the LPT is stopped and there is data
   323				; to be transferred.  IOBEG is on if this is the very
   324				; first block of data to be sent.
   325
   326	000271'	336000	000044*	LPTOUT::SKIPN	NXDLPT
   327	000272'	254000	000051*		  JRST	CPOPJ
   328	000273'	200304	000046*		MOVE T1,LPTBA(F)	;Base adr of LP20 registers.
   329	000274'	712346	000002		RDIO T2,CSBOFS(T1)	;Read status register.
   330	000275'	602340	000100		TRNE T2,CSBDNR		;VFU need loading?
   331	000276'	661000	020000		 TLO S,LPTVFU		;Y.  Remember for later.
   332	000277'	606340	000200		TRNN T2,CSBOL		;Printer offline?
   333	000300'	603000	200000		 TLNE S,LPTRBL		;Error detected previously?
   334	000301'	254000	000457'		  JRST LPTHAN		;YvY: stop user.
   335	000302'	623000	040000		TLZE S,LPTRAM		;RAM need loading?
   336	000303'	260040	000376'		 CALL LODRAM		;Y
   337	000304'	623000	020000		TLZE S,LPTVFU		;DAVFU need loading?
   338	000305'	260040	000441'		 CALL LODVFU		;Y
   339	000306'	623000	000002		TLZE S,IOBEG		;First output?
   340	000307'	602000	000100		 TRNE S,LPTNFF		;NFF off?
   341	000310'	334000	000000		  SKIPA			;NvN, start user data out.
   342	000311'	260040	000332'		   CALL LPTCF		;Y&Y.  Send CRFF first.
   343	000312'	260040	000340'		CALL SOP		;T1:=pointer to next block
   344	000313'	263040	000000		 RET			;Jrst return if nothing to do.
   345	000314'	201340	000000		MOVEI T2,F.PD		;Print data function.
   346	000315'	260040	000356'		CALL SLP20R		;Setup BC,BA,PC registers.
   347	000316'	625000	010000	LPTUGO:	TLZA S,LPTMO		;Flag sending user data.
   348	000317'	661000	010000	LPTMGO:	 TLO S,LPTMO		;Flag sending monitor data.
   349	000320'	260040	000000*		CALL SETACT		;Set IOACT, hung timeout.
   350	000321'	200004	000002		MOVE S,DEVIOS(F)
   351	000322'	200304	000273*		MOVE T1,LPTBA(F)	;Base adr of LP20 registers.
   352	000323'	201340	001000		MOVEI T2,CSAER		;Ensure CSAER off.  Also sets CSADON.
   353	000324'	714346	000000		BSIO T2,CSAOFS(T1)
   354	000325'	712346	000006		RDIO T2,BCOFS(T1)	;Clear CSADON.
   355	000326'	713346	000006		WRIO T2,BCOFS(T1)
   356	000327'	201340	000103		MOVEI T2,CSAIE+CSAPE+CSAGO
   357	000330'	714346	000000		BSIO T2,CSAOFS(T1)	;Start controller.
   358	000331'	263040	000000		RET
   359
   360				;Here before first or after last transfer when LPTNFF is off.
   361				;Send a CRFF.
   362	000332'	200300	000000*	LPTCF:	MOVE T1,LPCFPT		;Output pointer to CRFF
   363	000333'	201340	000000		MOVEI T2,F.PD		;Print data.
   364	000334'	260040	000356'		CALL SLP20R
   365	000335'	254000	000451'		JRST LPTMG1
   366
   367				;SOP.  Set T1.Lh= # -10 words to be sent to device.
   368				; Set T1.Rh = -11 address which will map to start of data.
   369				; Set T3 = # -10 words of monitor buffer this xfr will do.
   370				; Single return if no data to be output; skip otherwise.
   371				EXTERN LPTEPT
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 4-2
LP2SER.MAC	30-OCT-87 16:49		LPTOUT, LPTCLS - output, close UUOs

   372	000336'	200300	000000*	DEBSOP:	MOVE T1,LPTEPT
   373	000337'	254000	000170*		JRST CPOPJ1
   374	000340'	550404	000011	SOP:	HRRZ T3,DEVCLS(F)
   375	000341'	554310	777776		HLRZ T1,-2(T3)
   376	000342'	550350	777776		HRRZ T2,-2(T3)
   377	000343'	274300	000007		SUB T1,T2		;T1:=IN - OUT
   378	000344'	325300	000347'		JUMPGE T1,SOP1		;(J-IN)=OUT
   379	000345'	550310	777777		HRRZ T1,-1(T3)
   380	000346'	274300	000007		SUB T1,T2		;T1:=LAST-OUT
   381	000347'	322300	000272*	SOP1:	JUMPE T1,CPOPJ
   382	000350'	261040	000006		PUSH P,T1
   383	000351'	260040	000477'		CALL LPTCVT		;move & convert data.
   384	000352'	262040	000010		POP P,T3
   385	000353'	517000	000006		HRLZS T1
   386	000354'	540304	000000*		HRR T1,LPTLBA(F)
   387	000355'	254000	000337*		JRST CPOPJ1
   388
   389				;SLP20R.  Setup LP20 registers for data transfer according to
   390				; output pointer in T1.  T1.Lh=-10 words to send
   391				; T1.Rh=-11 adr of start of block to be sent.
   392				; T2.Rh = function bits for command.
   393				; T3 = # 10 words of monitor buffer used, if applicable.
   394	000356'	202344	000000*	SLP20R:	MOVEM T2,LPTFUN(F)
   395	000357'	202404	000000*		MOVEM T3,LPTWC(F)	;Monitor buffer this one does.
   396	000360'	200404	000322*		MOVE T3,LPTBA(F)	;T3:=base adr of LP20 registers.
   397	000361'	554340	000006		HLRZ T2,T1		;T2:=+ word count in LPT buffer.
   398	000362'	242340	000002		LSH T2,2		;+ byte count
   399	000363'	213000	000007		MOVNS T2
   400	000364'	405340	007777		ANDI T2,7777
   401	000365'	713350	000006		WRIO T2,BCOFS(T3)
   402	000366'	713310	000004		WRIO T1,BAOFS(T3)
   403	000367'	201340	007777		MOVEI T2,7777		;Set page counter to maximum
   404	000370'	713350	000010		WRIO T2,PCOFS(T3)
   405	000371'	201340	000014		MOVEI T2,CSADL+CSATM
   406	000372'	715350	000000		BCIO T2,CSAOFS(T3)
   407	000373'	200344	000356*		MOVE T2,LPTFUN(F)
   408	000374'	714350	000000		BSIO T2,CSAOFS(T3)
   409	000375'	263040	000000		RET
   410
   411				;LODRAM.  Load the LP20 translation RAM
   412				; with the standard values.
   413	000376'	200304	000360*	LODRAM:	MOVE T1,LPTBA(F)	;T1:=base adr of LP20 registers
   414	000377'	201340	000377		MOVEI T2,377		;Zero all RAM entries.
   415	000400'	400400	000000		SETZ T3,
   416	000401'	723346	000014	LODRA1:	WRIOB T2,CBOFS(T1)
   417	000402'	713406	000012		WRIO T3,RDROFS(T1)
   418	000403'	365340	000401'		SOJGE T2,LODRA1
   419				;;;;;;;	MOVE T2,[-100,,RDRTRA+40]	;40-137 xlate into themselves
   420	000404'	200340	000730'		MOVE T2,[-400,,RDRTRA]	;EVERY THING TRANSLATES TO ITSELF
   421	000405'	723346	000014	LODR1A:	WRIOB T2,CBOFS(T1)
   422	000406'	713346	000012		WRIO T2,RDROFS(T1)
   423	000407'	253340	000405'		AOBJN T2,LODR1A
   424	000410'	263040	000000		RET			;FORGET THE FANCY STUFF BELOW
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 4-3
LP2SER.MAC	30-OCT-87 16:49		LPTOUT, LPTCLS - output, close UUOs

   425
   426	000411'	205340	777770		MOVSI T2,-SREITL	;Special RAM entry init table len
   427	000412'	554407	000431'	LODRA2:	HLRZ T3,SREIT(T2)
   428	000413'	723406	000014		WRIOB T3,CBOFS(T1)	;special character
   429	000414'	550407	000431'		HRRZ T3,SREIT(T2)
   430	000415'	713406	000012		WRIO T3,RDROFS(T1)
   431	000416'	253340	000412'		AOBJN T2,LODRA2
   432	000417'	201340	600000		MOVEI T2,600000
   433	000420'	612344	000012		TDNE T2,DEVSTS(F)	;Lower case printer?
   434	000421'	263040	000000		 RET			;Yes.
   435	000422'	201340	000036		MOVEI T2,36		;Have LP20 map l.c. into u.c.
   436	000423'	201407	000140	LODRA3:	MOVEI T3,140(T2)
   437	000424'	723406	000014		WRIOB T3,CBOFS(T1)
   438	000425'	201407	001100		MOVEI T3,RDRTRA+100(T2)
   439	000426'	713406	000012		WRIO T3,RDROFS(T1)
   440	000427'	365340	000423'		SOJGE T2,LODRA3
   441	000430'	263040	000000		RET
   442
   443				;Special RAM entry initialization table.
   444				;	Char,,RAM entry		Char	VFU channel
   445	000431'	000012	001407	SREIT:	  12,,RDRTRA+RDRPI+7	;LF	8
   446	000432'	000013	001406		  13,,RDRTRA+RDRPI+6	;VT	7
   447	000433'	000014	001400		  14,,RDRTRA+RDRPI+0	;FF	1
   448	000434'	000020	001401		  20,,RDRTRA+RDRPI+1	;DLE	2
   449	000435'	000021	001402		  21,,RDRTRA+RDRPI+2	;DC1	3
   450	000436'	000022	001403		  22,,RDRTRA+RDRPI+3	;DC2	4
   451	000437'	000023	001404		  23,,RDRTRA+RDRPI+4	;DC3	5
   452	000440'	000024	001405		  24,,RDRTRA+RDRPI+5	;DC4	6
   453			000010	SREITL==.-SREIT
   454
   455				;LODVFU.  Load the VFU with the standard assignments.
   456	000441'	200304	000376*	LODVFU:	MOVE T1,LPTBA(F)
   457	000442'	712306	000002		RDIO T1,CSBOFS(T1)
   458	000443'	602300	004000		TRNE T1,CSBOO		;This printer has a DAVFU?
   459	000444'	263040	000000		 RET			;N.
   460	000445'	200300	000140*		MOVE T1,LPVLPT		;Pointer to VFU data
   461	000446'	201340	000010	LPTFLV:	MOVEI T2,F.LV		;Load VFU.
   462	000447'	260040	000356'		CALL SLP20R
   463	000450'	402004	000357*		SETZM LPTWC(F)
   464	000451'	260040	000317'	LPTMG1:	CALL LPTMGO		;Start VFU load.
   465	000452'	202004	000002		MOVEM S,DEVIOS(F)
   466	000453'	260040	000052*		CALL WAIT1		;Reschedule until finished.
   467	000454'	603000	200000		TLNE S,LPTRBL		;Hang if error.
   468	000455'	254000	000457'		 JRST LPTHAN
   469	000456'	263040	000000		RET			;None, continue with output.
   470
   471				;LPTHAN.  Stop user job, informing operator and user of
   472				; problem with LPT.  If continued, retry operation.
   473	000457'	621000	200000	LPTHAN:	TLZ S,LPTRBL		;Clear error flag.
   474	000460'	202004	000002		MOVEM S,DEVIOS(F)
   475	000461'	260040	000000*		CALL HNGSTP
   476	000462'	254000	000271'		JRST LPTOUT		;Try again if user continues.
   477
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 4-4
LP2SER.MAC	30-OCT-87 16:49		LPTOUT, LPTCLS - output, close UUOs

   478				;LPTCLS - Close UUO.  Do OUTPUT, wait for buffers to
   479				; be sent, then output CRFF unless LPTNFF is set.
   480	000463'	336000	000271*	LPTCLS:	SKIPN	NXDLPT
   481	000464'	254000	000347*		  JRST CPOPJ
   482	000465'	260040	000271'		CALL LPTOUT
   483	000466'	260040	000453*		CALL WAIT1		;Wait until output finished.
   484	000467'	603000	200000		TLNE S,LPTRBL
   485	000470'	254000	000457'		 JRST LPTHAN		;Hang on errors.
   486	000471'	602000	000100		TRNE S,LPTNFF
   487	000472'	263040	000000		 RET			;Finished.
   488	000473'	661000	400000		TLO S,LPTEND
   489	000474'	254000	000332'		JRST LPTCF
   490
   491
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 5
LP2SER.MAC	30-OCT-87 16:49		LPTOUT, LPTCLS - output, close UUOs

   492
   493
   494				SUBTTL LPTXFR, LPTCVT - move data between buffers.
   495
   496				;LPTXFR.  Supplied by UUOCON with
   497				; T2.Lh, start of data in user's buffer, interpreted as 7 bit bytes
   498				; T2.Rh, address of next block in monitor buffer
   499				; T3, Last address +1 in monitor buffer to be transferred to.
   500				; T1, Number of words to be moved.
   501				;Returns in T1 the number of words actually moved.
   502
   503	000475'	256040	000731'	LPTXFR:	XCTFU <BLT T2,-1(T3)>
   504	000476'	254000	000355*		JRST CPOPJ1
   505
   506				;LPTCVT.  Move T1 words out of monitor buffer pointed
   507				; at by T2 into LPT buffer for this printer.
   508				; Repack data in -11 format: 8 bit bytes, four per word,
   509				; stored in order: 10-17,2-9,28-35,20-27.
   510				;Returns in T1.Rh: # words of LPT buffer used,
   511				;This code borrowed from T10 module LP2SER.
   512	000477'	201440	000005	LPTCVT:	MOVEI T4,5
   513	000500'	223440	000006		IMULB T4,T1		;# bytes to move.
   514	000501'	303440	002400		CAILE T4,^D1280		;Never more than 400 wordsworth
   515	000502'	256000	000732'		 STOPCD (CPOPJ,DEBUG,LPTTMB,,<Too many bytes>)
   516	000503'	241300	777776		ROT T1,-2		;Compute words used in LPT buffer.
   517	000504'	623300	600000		TLZE T1,600000		;Any remainder?
   518	000505'	271300	000001		 ADDI T1,1		;Yes, takes whole word.
   519	000506'	554404	000354*		HLRZ T3,LPTLBA(F)	;-10 adr of LPT buffer
   520	000507'	505340	440700		HRLI T2,440700
   521	000510'	361440	000464*	LPTXF1:	SOJL T4,CPOPJ
   522	000511'	134600	000007		ILDB P1,T2
   523	000512'	361440	000527'		SOJL T4,LPTXF2
   524	000513'	134640	000007		ILDB P2,T2
   525	000514'	242640	000010		LSH P2,10
   526	000515'	434640	000014		IOR P2,P1
   527	000516'	516650	000000		HRLZM P2,(T3)
   528	000517'	361440	000510*		SOJL T4,CPOPJ
   529	000520'	134600	000007		ILDB P1,T2
   530	000521'	361440	000531'		SOJL T4,LPTXF3
   531	000522'	134640	000007		ILDB P2,T2
   532	000523'	242640	000010		LSH P2,10
   533	000524'	434640	000014		IOR P2,P1
   534	000525'	542650	000000		HRRM P2,(T3)
   535	000526'	344400	000510'		AOJA T3,LPTXF1
   536	000527'	516610	000000	LPTXF2:	HRLZM P1,(T3)
   537	000530'	263040	000000		RET
   538	000531'	542610	000000	LPTXF3:	HRRM P1,(T3)
   539	000532'	263040	000000		RET
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 6
LP2SER.MAC	30-OCT-87 16:49		LPTXFR, LPTCVT - move data between buffers.

   540
   541
   542				SUBTTL LPTINT - LP20 interrupt service
   543
   544
   545				;LPTINT.  Come here with acs saved, stack setup,
   546				; F=DDB of interrupting LP20, T1=base
   547				; address of interrupting LP20, S=DEVIOS(F).
   548
   549	000533'	000000	000000	LPRINT::0
   550	000534'	202740	000665'		MOVEM 17,LPTACS+17
   551	000535'	201740	000646'		MOVEI 17,LPTACS
   552	000536'	251740	000664'		BLT 17,LPTACS+16
   553	000537'	200040	000666'		MOVE P,LPTPDP
   554	000540'	201200	000000*		MOVEI F,LP0DDB
   555	000541'	200004	000002		MOVE S,DEVIOS(F)
   556	000542'	200304	000441*		MOVE T1,LPTBA(F)
   557	000543'	260040	000547'		CALL LPTINT
   558	000544'	205740	000646'		MOVSI 17,LPTACS
   559	000545'	251740	000017		BLT 17,17
   560	000546'	254520	000533'		JEN @LPRINT
   561	000547'	712346	000000	LPTINT:	RDIO T2,CSAOFS(T1)	;See why LP20 interrupted.
   562	000550'	606340	000200		TRNN T2,CSADON		;Done interrupt?
   563	000551'	254000	000605'		 JRST LPTERR		;Nope, some error.
   564	000552'	712406	000002		RDIO T3,CSBOFS(T1)
   565	000553'	606340	060000		TRNN T2,CSAPZ+CSAUC	;Shouldn't have done&error.
   566	000554'	602400	000377		 TRNE T3,ANYRBE
   567	000555'	254000	000605'		  JRST LPTERR		;BUT WE DO SOMETIMES!
   568	000556'	603000	010000	LPTIN0:	TLNE S,LPTMO		;Internal output (CRFF or DAVFU ld)
   569	000557'	254000	000601'		 JRST LPTDON		;Y.  Restart user.
   570	000560'	550444	000011		HRRZ T4,DEVCLS(F)	;Advance output pointer over data
   571								; just printed.
   572	000561'	550411	777776		HRRZ T3,-2(T4)		;Start of data just transferred
   573	000562'	270404	000450*		ADD T3,LPTWC(F)		;First word after data just transferred
   574	000563'	311411	777777		CAML T3,-1(T4)		;Past end of ring buffer?
   575	000564'	550404	000011		 HRRZ T3,DEVCLS(F)	;Yes, next xfr starts at ring start.
   576	000565'	542411	777776		HRRM T3,-2(T4)		;New ring taker
   577	000566'	260040	000340'		CALL SOP		;Setup next output pointer
   578	000567'	254000	000601'		 JRST LPTDON		;Nothing more to print
   579	000570'	261040	000006		PUSH P,T1
   580	000571'	261040	000010		PUSH P,T3
   581	000572'	260040	000602'		CALL LPTDO1		;Start user after every block.
   582	000573'	262040	000010		POP P,T3
   583	000574'	262040	000006		POP P,T1
   584	000575'	200004	000002		MOVE S,DEVIOS(F)
   585	000576'	201340	000000		MOVEI T2,F.PD
   586	000577'	260040	000356'		CALL SLP20R
   587	000600'	254000	000316'		JRST LPTUGO
   588	000601'	620000	010000	LPTDON:	TRZ S,IOACT		;Output has stopped
   589	000602'	623000	000001	LPTDO1:	TLZE S,IOW
   590	000603'	260040	000000*		 CALL SETIOD		;Wake user
   591	000604'	254000	000043*		JRST STOIOS
   592
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 6-2
LP2SER.MAC	30-OCT-87 16:49		LPTINT - LP20 interrupt service

   593				;LPTERR.  Here when device interrupted because of
   594				; some error condition.  T2 has CSRA contents.
   595	000605'	602340	040000	LPTERR:	TRNE T2,CSAPZ		;Page counter 0?
   596	000606'	260040	000627'		 CALL LPTPZE
   597	000607'	712406	000002		RDIO T3,CSBOFS(T1)
   598	000610'	606340	020000		TRNN T2,CSAUC
   599	000611'	602400	000377		 TRNE T3,ANYRBE
   600	000612'	334000	000000		  SKIPA
   601	000613'	254000	000556'		   JRST LPTIN0		;Must be PZE.
   602	000614'	602400	000100		TRNE T3,CSBDNR
   603	000615'	661000	020000		 TLO S,LPTVFU
   604	000616'	260040	000634'		CALL SAVSTS		;Save all registers.
   605	000617'	661000	300000		TLO S,LPTRBL+LPTPAR	;Flag error.
   606	000620'	201340	001000		MOVEI T2,CSAER		;Reset error flags
   607	000621'	714346	000000		BSIO T2,CSAOFS(T1)
   608	000622'	620000	010000		TRZ S,IOACT
   609	000623'	623000	000001		TLZE S,IOW
   610	000624'	260040	000603*		 CALL SETIOD		;Wake user
   611	000625'	260040	000604*		CALL STOIOS
   612	000626'	254000	000000*		JRST DEVERR		;Have UUOCON retry.
   613				;Here on page counter decremented to zero interrupt.  Set
   614				; the counter to 7777, clear the error flag, and return.
   615	000627'	201400	007777	LPTPZE:	MOVEI T3,7777
   616	000630'	713406	000010		WRIO T3,PCOFS(T1)
   617	000631'	201400	040000		MOVEI T3,CSAPZ
   618	000632'	715406	000000		BCIO T3,CSAOFS(T1)
   619	000633'	263040	000000		RET
   620
   621				;SAVSTS.  Increment LPT error count and save all registers
   622				; in the DDB.
   623	000634'	350004	000000*	SAVSTS:	AOS LPTEC(F)		;One more LPT error
   624	000635'	200340	000735'		MOVE T2,[POINT 18,LPTSB(F)]
   625						;THE CODE BELOW IS SUPPOSED TO SET UP THE DDB TO
   626						; SO THAT THE PORTION OF THE BUFFER NOT YET PRINTED
   627						; WHEN THE ERROR OCCURED WILL NOT BE LOST.
   628	000636'	263040	000000		RET ;;;;; UNFORTUNATELY IT HAS A BUG WHICH KILLS US SO SKIPIT.
   629	000637'	205400	777770		MOVSI T3,-NLP20R
   630	000640'	712006	000000	SAVST1:	RDIO (T1)
   631	000641'	136440	000007		IDPB T4,T2
   632	000642'	271300	000002		ADDI T1,2
   633	000643'	253400	000640'		AOBJN T3,SAVST1
   634	000644'	275300	000020		SUBI T1,NLP20R*2
   635	000645'	263040	000000		RET
   636
   637				;LPTACS, LPTPDP.  Save user Acs here, set up I level PDL
   638				; using LPTPDP
   639	000646'			LPTACS:	BLOCK 20
   640	000666'	777750	000666'	LPTPDP:	-30,,.
   641	000667'				BLOCK 30
   642
   643
   644				REPEAT 0,<;The following must be defined if no lineprinter
   645				LPRINT::STOPCD (CPOPJ,DEBUG,LPTNON,,<No line printer>)
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 6-3
LP2SER.MAC	30-OCT-87 16:49		LPTINT - LP20 interrupt service

   646				LPRINI::POPJ	P,	;DO NOTHING, JUST RETURN
   647				LPRDDB::BLOCK	15
   648				RELOC LPRDDB+DEVSER
   649				LPRINI
   650				RELOC
   651				LPRDDS==:15
   652				>  ;End of REPEAT 0
   653
   654	000717'	130704	000506*		$END	(LP2)

   655	000720'	000003	763000

   656	000721'	331104	000717*

   657	000722'	402000	000463*

   658	000723'	263040	000000

   659	000724'	554413	000000

   660	000725'	442200	000001*

   661	000726'	510413	000000

   662	000727'	550353	000000

   663	000730'	777400	001000

   664	000731'	251350	777777

   665	000732'	260040	000000*

   666	000733'	546064	645542

   667	000734'	000003	000517*

   668	000735'	442204	000000*

   669						;End of LP2SER (LP2LIT: LP2END:)
   670
NO ERRORS DETECTED
PROGRAM BREAK IS 000736
7K CORE USED
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88 PAGE 7
LP2SER.MAC	30-OCT-87 16:49		SYMBOL TABLE

ADJBP	133000	000000		DDINT		000001	SIN	LPTDSP		000003'	INT	PX.MEM		000004	SPD
ANYRBE		000377	SPD	DDXZ		000000	SIN	LPTEC		000634'	EXT	PX.SRC		000001	SPD
BAOFS		000004	SPD	DEBSOP		000336'		LPTEND		400000	SPD	PXCT	256000	000000	
BCIO	715000	000000		DEVCLS		000011	SIN	LPTEPT		000336'	EXT	RDIO	712000	000000	
BCOFS		000006	SPD	DEVERR		000626'	EXT	LPTERR		000605'		RDRDEL		002000	SPD
BSIO	714000	000000		DEVIOS		000002	SIN	LPTFLV		000446'		RDRINT		004000	SPD
C12TO7		000266'		DEVSTS		000012	SIN	LPTFUN		000373'	EXT	RDROFS		000012	SPD
C6TO1		000265'		DGTRO		000013		LPTHAN		000457'		RDRPI		000400	SPD
CALL	260040	000000		DHNG		000005	SIN	LPTHNG		000032'	INT	RDRRAP		010000	SPD
CBOFS		000014	SPD	DIE		000732'	EXT	LPTIN0		000556'		RDRTRA		001000	SPD
CCOFS		000015	SPD	DIN		000011	SIN	LPTINI		000020'	INT	RET	263040	000000	
CKSOFS		000017	SPD	DINI		000004	SIN	LPTINT		000547'		RLDVFU		000101'	
CMDLST		000062'		DMT		000014	SIN	LPTLBA		000721'	EXT	S		000000	INT
CMDLUP		000064'		DOU		000010	SIN	LPTMG1		000451'		S$DEBU		000003	SIN
CPOPJ		000734'	EXT	DRL		000006	SIN	LPTMGO		000317'		S$ENTR	777777	777775	SIN
CPOPJ1		000476'	EXT	DSPSIZ		000014	SPD	LPTMO		010000	SPD	S$EVEN		000006	SIN
CSAA16		000020	SPD	DVSIZ		000003	SIN	LPTNFF		000100	SPD	S$HALT	777777	777777	SIN
CSAA17		000040	SPD	DXFR		000012	SIN	LPTOUT		000271'	INT	S$INFO		000005	SIN
CSADH		002000	SPD	ERRLUP		000156'		LPTPAR		100000	SPD	S$NAME		000000'	SPD
CSADL		000010	SPD	ERROCI		000014'	EXT	LPTPDP		000666'		S$NONA		000000	SIN
CSADON		000200	SPD	ERRSCN		000154'		LPTPZE		000627'		S$PATC		000007	SIN
CSADR		010000	SPD	F		000004	INT	LPTRAM		040000	SPD	S$TEMP	000003	000000	SPD
CSAER		001000	SPD	F.LV		000010	SPD	LPTRBL		200000	SPD	S$XCT	777777	777776	SIN
CSAERR		100000	SPD	F.PD		000000	SPD	LPTREL		000033'	INT	SAVST1		000640'	
CSAGO		000001	SPD	FETCH		000174'		LPTSB		000735'	EXT	SAVSTS		000634'	
CSAIE		000100	SPD	FW		000245'		LPTSER		000000'	ENT	SETACT		000320'	EXT
CSALI		000400	SPD	FWADJ		000233'		LPTSTS		000000	EXT	SETIOD		000624'	EXT
CSAOFS		000000	SPD	GETCMD		000143'		LPTTMB		000502'	INT	SIZLPT		000006'	EXT
CSAOL		004000	SPD	HNGSTP		000461'	EXT	LPTUGO		000316'		SLP20R		000356'	
CSAPE		000002	SPD	HW		000254'		LPTVFU		020000	SPD	SOP		000340'	
CSAPZ		040000	SPD	HWADJ		000240'		LPTWC		000562'	EXT	SOP1		000347'	
CSATM		000004	SPD	INIVFU		000044'	INT	LPTXF1		000510'		SREIT		000431'	
CSAUC		020000	SPD	IOACT		010000	SIN	LPTXF2		000527'		SREITL		000010	SPD
CSB		040000	SPD	IOBEG		000002	SIN	LPTXF3		000531'		STOIOS		000625'	EXT
CSBDNR		000100	SPD	IOW		000001	SIN	LPTXFR		000475'		STORE		000213'	
CSBDTE		000002	SPD	LODR1A		000405'		LPVLPT		000445'	EXT	T1		000006	INT
CSBGE		000001	SPD	LODRA1		000401'		M		000013	INT	T2		000007	INT
CSBLDP		010000	SPD	LODRA2		000412'		MAXC		000217	SPD	T3		000010	INT
CSBLPE		000040	SPD	LODRA3		000423'		MAXLN		000130	SPD	T4		000011	INT
CSBMPE		000020	SPD	LODRAM		000376'		NEWTOF		000267'		TSTMAX		000171'	
CSBMTE		000004	SPD	LODVFU		000441'		NLP20R		000010	SPD	UBGOOD		000034'	EXT
CSBOFS		000002	SPD	LP0DDB		000540'	EXT	NODIE		000000	EXT	VFUBUF		000000	SPD
CSBOL		000200	SPD	LP2END		000735'	INT	NXDLPT		000722'	EXT	VFUERR		000172'	
CSBOO		004000	SPD	LP2LIT		000717'	INT	P		000001	INT	VFULUP		000067'	
CSBPNR		020000	SPD	LPCFPT		000332'	EXT	P1		000014	INT	VFUPTR		000264'	
CSBRPE		000010	SPD	LPRINT		000533'	INT	P2		000015	INT	WAIT1		000466'	EXT
CSBT00		000400	SPD	LPT11A		000000	EXT	PCOFS		000010	SPD	WRIO	713000	000000	
CSBT01		001000	SPD	LPTACS		000646'		PDOFS		000016	SPD	WRIOB	723000	000000	
CSBT02		002000	SPD	LPTBA		000542'	EXT	PGRDIS		200000	SPD	ZZ		425464	SPD
CSBVD		100000	SPD	LPTCF		000332'		PGRFST		100000	SPD	
DBYT		000002	SIN	LPTCLS		000463'		PGROFS		763000	SPD	
DCL		000007	SIN	LPTCVT		000477'		PGRREV		400000	SPD	
DDINT		000001	SIN	

LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88
LP2SER.MAC	30-OCT-87 16:49		Symbol cross reference

ANYRBE	    40#	   566	   599
BAOFS	    41#	   402
BCOFS	    42#	   354	   355	   401
C12TO7	   259	   274	   314#
C6TO1	   257	   272	   313#
CBOFS	    46#	   416	   421	   428	   437
CCOFS	    45#
CKSOFS	    47#
CMDLST	   166	   170#
CMDLUP	   172#	   184
CPOPJ	    52%	   155	   159	   327	   381	   481	   515	   521	   528
CPOPJ1	    52%	   131	   137	   244	   373	   387	   504
CSAA16	    35#
CSAA17	    35#
CSADH	    35#
CSADL	    35#	    38	   405
CSADON	    35#	   562
CSADR	    35#
CSAER	    35#	   146	   352	   606
CSAERR	    35#
CSAGO	    35#	   356
CSAIE	    35#	   356
CSALI	    35#	   144
CSAOFS	    35#	   145	   147	   353	   357	   406	   408	   561	   607	   618
CSAOL	    35#
CSAPE	    35#	   356
CSAPZ	    35#	   565	   595	   617
CSATM	    35#	   405
CSAUC	    35#	   565	   598
CSB	    39#
CSBDNR	    39#	    40	   330	   602
CSBDTE	    39#	    40
CSBGE	    39#	    40
CSBLDP	    39#
CSBLPE	    39#	    40
CSBMPE	    39#	    40
CSBMTE	    39#	    40
CSBOFS	    39#	   157	   329	   457	   564	   597
CSBOL	    39#	    40	   158	   332
CSBOO	    39#	   458
CSBPNR	    39#
CSBRPE	    39#	    40
CSBT00	    39#
CSBT01	    39#
CSBT02	    39#
CSBVD	    39#
DBYT	    95#
DCL	   100#
DDINT	    94#
DDXZ	    93#
DEBSOP	   372#
DEVCLS	   374	   570	   575
DEVERR	    52%	   612
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88
LP2SER.MAC	30-OCT-87 16:49		Symbol cross reference

DEVIOS	   350	   465	   474	   555	   584
DEVSTS	   433
DGTRO	   104#
DHNG	    98#
DIE	    16	    16%	    17	   515
DIN	   102#
DINI	    97#
DMT	   105#
DOU	   101#
DRL	    99#
DSPSIZ	    93	   106#
DVSIZ	    96#
DXFR	   103#
ERRLUP	   234#	   245
ERROCI	    52%	   102
ERRSCN	   170	   232#
F	   132	   134	   140	   156	   328	   350	   351	   374	   386	   394	   395	   396	   407	   413
	   433	   456	   463	   465	   474	   519	   554	   555	   556	   570	   573	   575	   584	   623
	   624
F.LV	    38#	   461
F.PD	    37#	   345	   363	   585
FETCH	   175	   187	   192	   249#
FW	   283	   284	   294#
FWADJ	   205	   255	   271	   282#
GETCMD	   172	   222#	   234
GINST	   503#	   503	   504
HNGSTP	    52%	   475
HW	   289	   290	   302#
HWADJ	   212	   261	   277	   288#
INIVFU	   105	   154#
IOACT	   588	   608
IOBEG	   339
IOW	   589	   609
LISTSN	     3	     6
LODR1A	   421#	   423
LODRA1	   416#	   418
LODRA2	   427#	   431
LODRA3	   436#	   440
LODRAM	   336	   413#
LODVFU	   219	   338	   456#
LP0DDB	    54%	   554
LP2END	   669#
LP2LIT	   654#
LPCFPT	    54%	   362
LPRINT	   549#	   560
LPT11A	    55%
LPTACS	   550	   551	   552	   558	   639#
LPTBA	    55%	   140	   156	   328	   351	   396	   413	   456	   556
LPTCF	   342	   362#	   489
LPTCLS	   100	   480#
LPTCVT	   383	   512#
LPTDO1	   581	   589#
LPTDON	   569	   578	   588#
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88
LP2SER.MAC	30-OCT-87 16:49		Symbol cross reference

LPTDSP	    92#
LPTEC	    55%	   623
LPTEND	    80#	   488
LPTEPT	   371%	   372
LPTERR	   563	   567	   595#
LPTFLV	   168	   461#
LPTFUN	    55%	   394	   407
LPTHAN	   334	   468	   473#	   485
LPTHNG	    98	   139#
LPTIN0	   568#	   601
LPTINI	    97	   128#
LPTINT	   557	   561#
LPTLBA	    55%	   132	   134	   386	   519
LPTMG1	   365	   464#
LPTMGO	   348#	   464
LPTMO	    85#	   347	   348	   568
LPTNFF	    88#	   340	   486
LPTOUT	   101	   326#	   476	   482
LPTPAR	    82#	   148	   605
LPTPDP	   553	   640#
LPTPZE	   596	   615#
LPTRAM	    83#	   128	   139	   335
LPTRBL	    81#	   148	   333	   467	   473	   484	   605
LPTREL	    99	   129	   140#
LPTSB	    54%	   624
LPTSER	    16	    17#	    20
LPTSTS	    55%
LPTTMB	   515#
LPTUGO	   347#	   587
LPTVFU	    84#	   128	   139	   331	   337	   603
LPTWC	    55%	   395	   463	   573
LPTXF1	   521#	   535
LPTXF2	   523	   536#
LPTXF3	   530	   538#
LPTXFR	   103	   503#
LPVLPT	    54%	   151	   460
M	   161	   163	   184	   222	   223	   232	   233	   243	   245	   246
MAXC	   152#	   233
MAXLN	   153#	   235
NEWTOF	   167	   315#
NLP20R	    49#	   629	   634
NODIE	    16%
NXDLPT	    54%	   130	   142	   154	   326	   480
P	    17	    24	    25	   104	   141	   143	   171	   203	   213	   218	   232	   243	   246	   249
	   254	   260	   262	   265	   270	   276	   279	   282	   285	   288	   291	   382	   384	   515
	   553	   579	   580	   582	   583
P1	   203	   204	   206	   208	   209	   210	   211	   213	   249	   250	   251	   252	   253	   254
	   256	   258	   260	   262	   265	   266	   267	   268	   269	   270	   273	   275	   276	   279
	   282	   285	   288	   291	   294	   296	   298	   299	   302	   304	   307	   308	   522	   526
	   529	   533	   536	   538
P2	   524	   525	   526	   527	   531	   532	   533	   534
PCOFS	    43#	   404	   616
PDOFS	    48#
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88
LP2SER.MAC	30-OCT-87 16:49		Symbol cross reference

PGRDIS	    50#
PGRFST	    50#
PGROFS	    50#	   133
PGRREV	    50#
PGRVAL	    50#	   135
PX.MEM	   503
PX.SRC	   503
RDRDEL	    44#
RDRINT	    44#
RDROFS	    44#	   417	   422	   430	   439
RDRPI	    44#	   445	   446	   447	   448	   449	   450	   451	   452
RDRRAP	    44#
RDRTRA	    44#	   420	   438	   445	   446	   447	   448	   449	   450	   451	   452
RLDVFU	   174	   186#
S	   128	   139	   148	   331	   333	   335	   337	   339	   340	   347	   348	   350	   465	   467
	   473	   474	   484	   486	   488	   555	   568	   584	   588	   589	   603	   605	   608	   609
S$DEBU	   515	   516
S$ENTR	    16	    22	   516
S$EVEN	   515
S$HALT	    16	   515
S$INFO	   515
S$NAME	    20#
S$NONA	    19	    22	   516
S$PATC	   515
S$TEMP	    16#	    16	   515#	   515
S$XCT	    22	   516
SAVST1	   630#	   633
SAVSTS	   604	   623#
SETACT	    53%	   349
SETIOD	    52%	   590	   610
SIZLPT	    55%	    96
SLP20R	   346	   364	   394#	   462	   586
SOP	   343	   374#	   577
SOP1	   378	   381#
SREIT	   427	   429	   445#	   453
SREITL	   426	   453#
STOIOS	    52%	   149	   591	   611
STORE	   180	   189	   194	   265#
T1	    96	   132	   133	   136	   140	   145	   147	   156	   157	   167	   177	   179	   181	   182
	   188	   191	   193	   200	   201	   204	   211	   214	   215	   216	   217	   224	   225	   227
	   229	   237	   250	   266	   278	   313	   314	   328	   329	   351	   353	   354	   355	   357
	   362	   372	   375	   377	   378	   379	   380	   381	   382	   385	   386	   397	   402	   413
	   416	   417	   421	   422	   428	   430	   437	   439	   456	   457	   458	   460	   513	   516
	   517	   518	   556	   561	   564	   579	   583	   597	   607	   616	   618	   630	   632	   634
T2	   134	   135	   136	   144	   145	   146	   147	   157	   158	   182	   198	   199	   200	   214
	   216	   223	   224	   226	   228	   235	   237	   329	   330	   332	   345	   352	   353	   354
	   355	   356	   357	   363	   376	   377	   380	   394	   397	   398	   399	   400	   401	   403
	   404	   405	   406	   407	   408	   414	   416	   418	   420	   421	   422	   423	   426	   427
	   429	   431	   432	   433	   435	   436	   438	   440	   461	   503	   520	   522	   524	   529
	   531	   561	   562	   565	   585	   595	   598	   606	   607	   624	   631
T3	   163	   164	   165	   173	   176	   177	   178	   179	   186	   188	   190	   193	   195	   197
	   202	   206	   207	   208	   209	   210	   222	   239	   241	   374	   375	   376	   379	   384
	   395	   396	   401	   402	   404	   406	   408	   415	   417	   427	   428	   429	   430	   436
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88
LP2SER.MAC	30-OCT-87 16:49		Symbol cross reference

	   437	   438	   439	   503	   519	   527	   534	   535	   536	   538	   564	   566	   572	   573	   574
	   575	   576	   580	   582	   597	   599	   602	   615	   616	   617	   618	   629	   633
T4	   196	   197	   256	   257	   258	   259	   272	   273	   274	   275	   294	   295	   296	   297
	   298	   302	   303	   304	   305	   306	   307	   512	   513	   514	   521	   523	   528	   530
	   570	   572	   574	   576	   631
TSTMAX	   240	   245#
UBGOOD	   141%	   141
VFUBUF	   151#	   196	   217	   312
VFUERR	   236	   238	   242	   246#
VFULUP	   175#	   183
VFUPTR	   201	   253	   269	   312#
WAIT1	    53%	   160	   466	   483
ZZ	    35#	    35	    39#	    39	    41#	    42#	    43#	    44#	    44	    45#	    46#	    47#	    48#	    50#
	    50	   503#	   503
ZZ1	   503#	   503
LP2SER Line printer service for LP20 controller.	MACRO 12.5-46.0 14:17 13-JAN-88
LP2SER.MAC	30-OCT-87 16:49		Macro/Opdef cross reference

ADJBP	   201	   253	   269
BCIO	   406	   618
BSIO	   147	   353	   357	   408	   607
CALL	    24#	   129	   160	   170	   172	   175	   180	   187	   189	   192	   194	   205	   212	   234
	   255	   261	   271	   277	   283	   284	   289	   290	   336	   338	   342	   343	   346	   349
	   364	   383	   462	   464	   466	   475	   482	   483	   557	   577	   581	   586	   590	   596
	   604	   610	   611
IOREG	    29#	    35	    39	    41	    42	    43	    44	    45	    46	    47	    48	    50
PRINTF	    10#
PXCT	   163	   222	   223	   503
PXGEN	   503
RDIO	   157	   329	   354	   457	   561	   564	   597	   630
RET	    25#	    94	   230	   247	   263	   280	   286	   292	   300	   309	   344	   358	   409	   424
	   434	   441	   459	   469	   487	   537	   539	   619	   628	   635
STOPCD	    15	   515
WRIO	   136	   145	   355	   401	   402	   404	   417	   422	   430	   439	   616
WRIOB	   416	   421	   428	   437
XCTFU	   503
$END	   654  "L5-W
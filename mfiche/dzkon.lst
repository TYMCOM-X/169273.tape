DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KSSYM.MAC IN COMMON ONLY
     7					.CREF
     8									TAPE>>
     9				; This file is PRINTF.MAC
    10				DEFINE PRINTF(A,B,C,D),<IF2,<;;Output message on MONKS build only
    11				PRINTX A B C D>>
    12
    13				TITLE DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY
    14				SUBTTL DSB
    15
    16					STOPCD(,ENTRY,DZKON)^
    17					ENTRY	DZKON		;For library searches
    18	000000'	260040	000000*	DZKON::PUSHJ	P,DIE		;**** Default stopcode for "DZKON" ****
    19	000001'	447253	575600		SIXBIT	/DZKON/  	;Title of module
    20	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "DZKON+nnn(nnnnnn)"
    21			000000'	S$NAME==DZKON			;For STOPCDs with no arguments
    22					SALL>
    23				^
    24					ENTRY	DZINI
    25
    26				;This hack written by Daniel S. Blom, based on the CTYSIM program by WFW.
    27				;The description of the Tymnet protocol used was the paper,
    28				; "Tymnet Interface Guide," Charles Landau, 11/77, Tymshare internal
    29				; publication, and the source code for the PDP-10 Host-Base interface.
    30
    31				;Configuration information:
    32			000001	DZNUM==1			;Number of DZ-11s on the system
    33			000004	MAXDZ==4			;Maximum number of DZ-11s hardware will support
    34
    35			000011	IFKMC<	BYP1==^D9		;RIGHTMOST BIT POSITION OF FIRST BYTE
    36			000021		BYP2==^D17	;   0F SECOND BYTE OF A BUFFER RING WORD
    37			000033		BYP3==^D27	;      THIRD BYTE
    38			000043		BYP4==^D35	;      LAST BYTE POSITION IN A BUF RING WD
    39					OPDEF	UUILDB	[101000,,0]	;KMC ILDB
    40					OPDEF	UUIDPB	[102000,,0]	;KMC IDPB
    41					DEFINE	TYPI(TYPE)		;FOR LOADING TYPES WITH A
    42					<TYPE_^D8>			;	MOVSI INSTR
    43				>;END IFKMC
    44				IFNKMC<	BYP1==^D7		;RIGHTMOST BIT POSITION OF FIRST BYTE
    45					BYP2==^D15	;   0F SECOND BYTE OF A BUFFER RING WORD
    46					BYP3==^D23	;      THIRD BYTE
    47					BYP4==^D31	;      LAST BYTE POSITION IN A BUF RING WD
    48					OPDEF	UUILDB	[ILDB 0]	;NORMAL ILDB
    49					OPDEF	UUIDPB	[IDPB 0]	;NORMAL IDPB
    50					DEFINE	TYPI(TYPE)		;FOR LOADING TYPES WITH A
    51					<TYPE_^D10>			;	MOVSI INSTR
    52				>;END IFNKMC
    53
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1
DZKON.MAC	30-OCT-87 17:11		DSB

    54				;The DZ-11 configuration table consists of one word entries for
    55				; each line on each DZ-11. It should be built using the DZLIN
    56				; macro to define an entry; its arguments are named as follows:
    57				; REMOTE: 1 iff this is a dial in line (should test for CAR on/off).
    58				; DZN: DZ-11 number of this port.
    59				; LN: Line number within DZ-11 of this port.
    60				; SPEED: Number representing the speed of the line as follows:
    61				;	Number	Speed in baud
    62				;	  0	    50
    63				;	  1	    75
    64				;	  2	   110
    65				;	  3	   134.5
    66				;	  4	   150
    67				;	  5	   300
    68				;	  6	   600
    69				;	  7	  1200
    70				;	 10	  1800
    71				;	 11	  2000
    72				;	 12	  2400
    73				;	 13	  3600
    74				;	 14	  4800
    75				;	 15	  7200
    76				;	 16	  9600
    77				; FILL: Number of fill characters to send on this line after a CR has
    78				;	been sent.  This number must be in the range 0:15.
    79				DEFINE DZLIN (DZN,LN,REMOTE,SPEED,FILL) <
    80					BYTE (1) REMOTE (3) DZN,LN (4) SPEED,FILL
    81				>
    82	000003'	401200	000000	DCTABL:	DZLIN 0,0,1,5,0
    83	000004'	405200	000000		DZLIN 0,1,1,5,0
    84	000005'	011200	000000		DZLIN 0,2,0,5,0
    85	000006'	015600	000000		DZLIN 0,3,0,7,0
    86	000007'	023400	000000		DZLIN 0,4,0,16,0
    87	000010'	027400	000000		DZLIN 0,5,0,16,0
    88	000011'	033400	000000		DZLIN 0,6,0,16,0
    89	000012'	037400	000000		DZLIN 0,7,0,16,0
    90			000010	NCDLIN==.-DCTABL
    91
    92	000013'	400306	000003'	DCTDN:	POINT 3,DCTABL(T1),3
    93	000014'	350306	000003'	DCTLN:	POINT 3,DCTABL(T1),6
    94	000015'	310406	000003'	DCTSPE:	POINT 4,DCTABL(T1),10
    95	000016'	250406	000003'	DCTFIL:	POINT 4,DCTABL(T1),14
    96
    97			000170	TBCC==2*74		;Ticks between polling state of carrier on Dz-11s.
    98			000020	TBSC==20		;Ticks between polling the Dz-11 silos.
    99			000264	TBDEC==3*74		;Ticks between checks for entering deferred
   100							; echo mode.
   101
   102				OPDEF CALL [PUSHJ P,]
   103				OPDEF RET [POPJ P,]
   104				OPDEF SAVE [PUSH P,]
   105				OPDEF REST [POP P,]
   106				OPDEF ADJSP [105000000000]
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-2
DZKON.MAC	30-OCT-87 17:11		DSB

   107
   108				;Macros which generate code to save/restore acs in right place on entering
   109				; an interrupt routine.
   110				DEFINE SAVEAC(NAME)<
   111					TBSAVE NAME'TBV
   112					MOVEM 17,NAME'SV+17
   113					HRRZI 17,NAME'SV
   114					BLT 17,NAME'SV+16
   115					MOVE P,NAME'PDP
   116				>
   117				DEFINE RESTAC(NAME)<
   118					MOVSI 17,NAME'SV
   119					BLT 17,17
   120					TBSET NAME'TBV
   121				>
   122
   123				DEFINE IOREG(REGISTERNAME,OFFSET,BITNAMES,MSB)
   124				<BIT==100000
   125				IFNB <MSB>,<BIT==MSB>
   126				IFNB <OFFSET>,<REGISTERNAME'OFS==OFFSET>
   127				IRP BITNAMES,<REGISTERNAME'BITNAMES==BIT
   128				BIT==BIT/2
   129				>>
   130
   131				;DZ-11 register offsets, bit assignments.  See DZ11 user's guide
   132				; (EK-DZ110-UG-001) for semantics.
   133				IOREG (CSR,0,<TRDY,TIE,SA,SAE,,,,,RDONE,RIE,MSE,CLR,MAINT>)
   134				IOREG (RBU,2,<DV,OVE,FE,PE>)
   135				IOREG (LPR,2,<RO,FD,FC,FB,FA,OP,PE,SC,CLB,CLA,LC,LB,LA>,10000)
   136				IOREG (TCR,4,<>)
   137				IOREG (TDR,6,<>)
   138				IOREG (MSR,6,<>)
   139
   140				EXTERN CTYIWD,CTYOWD,TIBTBL,APRCHN,BITTBL
   141				EXTERN MSKORG,MSKIRG,IRING,ORING,ORP620,IRP620
   142				EXTERN ORPPDP,IRPPDP,CH6,CH7,KEYSET
   143				EXTERN CPOPJ,CPOPJ1,CONFIG,EPT
   144
   145
   146				;This code is called once every CH7 interrupt and decides when it's
   147				; time to perform various polling tasks:
   148				; 1. Start processing the output ring if necessary;
   149				; 2. Check for carrier lost or new connection made (every TBCC interrupts);
   150				; 3. Empty the silo into the input ring if necessary (every TBSC interrupts);
   151				; 4. Check for block mode input timeouts (not yet implemented).
   152				; 5. Check for lines which can enter deferred echo mode (every
   153				;    TBDEC interrupts).
   154				;CH7 interrupts at least once every tick.
   155	000017'	334000	000000	DZPINT::SKIPA
   156	000020'	000000	000000		 0
   157	000021'	702200	001726'		SAVEAC(DZP)
   158	000022'	202740	001725'
   159	000023'	551740	001706'
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-3
DZKON.MAC	30-OCT-87 17:11		DSB

   160	000024'	251740	001724'
   161	000025'	200040	001730'
   162				;1. Is there anything in the output ring?
   163	000026'	200300	000000*		MOVE T1,ORPPDP		;Note race here is irrelevant.
   164	000027'	336000	001700'		SKIPN TTACT		;Any lines active?
   165	000030'	316300	000000*		 CAMN T1,ORP620		;Output ring empty?
   166	000031'	254000	000034'		  JRST DZPLK2		;YvY.  Nothing to do-I-level will handle.
   167	000032'	476000	001671'		SETOM SOTFLG		;Remember what event occurred.
   168	000033'	476000	001670'		SETOM PERFLG
   169				;2. Check for carrier lost or new connection.
   170	000034'	371000	001703'	DZPLK2:	SOSL TBNCC		;Time to check?
   171	000035'	254000	000042'		 JRST DZPLK3		;No.
   172	000036'	201300	000170		MOVEI T1,TBCC
   173	000037'	202300	001703'		MOVEM T1,TBNCC
   174	000040'	476000	001672'		SETOM CARFLG
   175	000041'	476000	001670'		SETOM PERFLG
   176	000042'	371000	001704'	DZPLK3:	SOSL TBNSC		;Time to check for carrier transitions?
   177	000043'	254000	000050'		 JRST DZPLK4
   178	000044'	201300	000020		MOVEI T1,TBSC
   179	000045'	202300	001704'		MOVEM T1,TBNSC
   180	000046'	476000	001673'		SETOM SILFLG
   181	000047'	476000	001670'		SETOM PERFLG
   182				;4. Check for block mode input timeouts.
   183	000050'			DZPLK4:
   184				;5. Check for lines which can switch to deferred echo mode.
   185	000050'	371000	001705'	DZPLK5:	SOSL TBNDEC		;Time for enter de check?
   186	000051'	254000	000056'		 JRST DZPLK6
   187	000052'	201300	000264		MOVEI T1,TBDEC
   188	000053'	202300	001705'		MOVEM T1,TBNDEC
   189	000054'	476000	001674'		SETOM DEFLG
   190	000055'	476000	001670'		SETOM PERFLG
   191	000056'	332000	001670'	DZPLK6:	SKIPE PERFLG 		;Anything to do?
   192	000057'	700600	004002		 WRPI LI.REQ+1_<7-6>	;Y, initiate level 6 interrupt.
   193	000060'	205740	001706'		RESTAC(DZP)
   194	000061'	251740	000017
   195	000062'	702600	001726'
   196	000063'	254000	000020'		JRST DZPINT+1
   197
   198				;This routine runs at level 6 and is initiated by the level 7 routine when
   199				; it decides some periodic action must be taken.
   200	000064'	336000	001670'	PERINT::SKIPN PERFLG		;Is this for us?
   201	000065'	000000	000000		 0
   202	000066'	702200	001771'		SAVEAC(PER)
   203	000067'	202740	001770'
   204	000070'	551740	001751'
   205	000071'	251740	001767'
   206	000072'	200040	001773'
   207	000073'	700600	020002		WRPI LI.CPP+1_<7-6>	;Yes, clear request.
   208	000074'	402000	001670'		SETZM PERFLG
   209	000075'	332000	001671'		SKIPE SOTFLG		;Need to check the output ring?
   210	000076'	332000	001700'		 SKIPE TTACT		;Only if not device done interrupt driven.
   211	000077'	334000	000000		  SKIPA
   212	000100'	260040	000776'		   CALL PROOR		;Yes, do so.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-4
DZKON.MAC	30-OCT-87 17:11		DSB

   213				    ;Check carrier transitions if needed.
   214	000101'	336000	001672'	PER2:	SKIPN CARFLG
   215	000102'	254000	000156'		 JRST PER3
   216	000103'	205600	777777		MOVSI P1,-DZNUM		;Dz-11 number.
   217	000104'	400740	000000		SETZ P4,		;Port number.
   218	000105'	205640	777770	PER21:	MOVSI P2,-8		;Line number on current Dz-11.
   219	000106'	200714	002124'		MOVE P3,DZBATB(P1)	;Get base address of this DZ-11.
   220	000107'	712716	000006		RDIO P3,MSROFS(P3)	;Read its modem status register.
   221	000110'	551357	000000	PER22:	HRRZI T2,(P4)		;Ignore connections involving unconfigured
   222	000111'	135300	003516'		LDB T1,LCTYP		; lines.
   223	000112'	306300	000003		CAIN T1,LT.UNU
   224	000113'	344740	000154'		 AOJA P4,PER24
   225	000114'	200457	003441'		MOVE T4,LINCHR(P4)	;Update the system's idea of the status.
   226	000115'	616715	000010*		TDNN P3,TIBTBL+8(P2)
   227	000116'	607440	010000		 TLNN T4,LCCAR
   228	000117'	254000	000140'		  JRST PER23
   229				    ;Carrier is actually off; the last time we checked it was on.
   230	000120'	135400	003515'		LDB T3,LCOS		;Get current state.
   231	000121'	306400	000006		CAIN T3,OS.HU		;Hanging up the line?
   232	000122'	254000	000130'		 JRST PER22A
   233	000123'	260040	000725'		CALL FLUBUF		;Clear buffers for this line.
   234	000124'	241340	777760		ROT T2,-8-8
   235	000125'	661340	026000		TLO T2,(<BYTE (8) 13>)	;Circuit zapper.
   236	000126'	260040	000750'		CALL DWIIR
   237	000127'	344740	000154'		 AOJA P4,PER24		;Get it next time around.
   238	000130'	201400	000000	PER22A:	MOVEI T3,OS.IDL		;Line is now idle.
   239	000131'	137400	003515'		DPB T3,LCOS
   240	000132'	200354	002124'		MOVE T2,DZBATB(P1)	;Make sure DTR is on.
   241	000133'	200415	000010*		MOVE T3,TIBTBL+8(P2)
   242	000134'	714407	000004		BSIO T3,TCROFS(T2)
   243	000135'	205440	210000		MOVSI T4,LCCAR+LCLGI
   244	000136'	412457	003441'		ANDCAM T4,LINCHR(P4)
   245	000137'	344740	000154'		AOJA P4,PER24
   246	000140'	612715	000010*	PER23:	TDNE P3,TIBTBL+8(P2)
   247	000141'	603440	010000		 TLNE T4,LCCAR
   248	000142'	344740	000154'		  AOJA P4,PER24
   249				    ;Carrier is actually on; the last time we checked it was off.
   250	000143'	661440	010000		TLO T4,LCCAR
   251	000144'	202447	003441'		MOVEM T4,LINCHR(T2)	;Save new status.
   252	000145'	200307	002152'		MOVE T1,LINOT(T2)
   253	000146'	202307	002141'		MOVEM T1,LINOP(T2)
   254	000147'	201300	000377		MOVEI T1,NOBIOB
   255	000150'	202307	002175'		MOVEM T1,LINCOU(T2)
   256	000151'	201300	000003		MOVEI T1,IS.BD		;Enter baud detect mode.
   257	000152'	137300	003514'		DPB T1,LCIS
   258	000153'	340740	000000		AOJ P4,
   259	000154'	253640	000110'	PER24:	AOBJN P2,PER22
   260	000155'	253600	000105'		AOBJN P1,PER21
   261				    ;Check silos if needed.
   262	000156'	336000	001673'	PER3:	SKIPN SILFLG
   263	000157'	254000	000164'		 JRST PER4
   264	000160'	205600	777777		MOVSI P1,-DZNUM
   265	000161'	200454	002124'	PER31:	MOVE T4,DZBATB(P1)
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-5
DZKON.MAC	30-OCT-87 17:11		DSB

   266	000162'	260040	000253'		CALL DZRI
   267	000163'	253600	000161'		AOBJN P1,PER31
   268				    ;Check to see if lines can enter deferred echo mode.
   269	000164'	336000	001674'	PER4:	SKIPN DEFLG
   270	000165'	254000	000170'		 JRST PER5
   271	000166'	205740	777767		MOVSI P4,-NDZLIN-1	;-Number of lines to check,,0
   272	000167'			PER41:	
   273	000167'	253740	000167'	PER42:	AOBJN P4,PER41
   274	000170'	402000	001671'	PER5:	SETZM SOTFLG
   275	000171'	402000	001672'		SETZM CARFLG
   276	000172'	402000	001673'		SETZM SILFLG
   277	000173'	402000	001674'		SETZM DEFLG
   278	000174'	205740	001751'		RESTAC(PER)
   279	000175'	251740	000017
   280	000176'	702600	001771'
   281	000177'	254000	000065'		JRST PERINT+1
   282
   283				;This routine runs at PI level 6 and handles DZ-11 interrupts.
   284				;1. If a line gives the ready for output interrupt, check its output
   285				;		ring.  If the ring has characters yet to be output,
   286				;		send them and dismiss the interrupt.  If not, call the
   287				;		the routine which processes the output ring.  Upon return,
   288				;		if there is output to be done to this line, start it;
   289				;		otherwise, clear the line active bit for the line.
   290				;2. If the silo full interrupt is given, empty the silo by putting characters
   291				;		into the Base-Host ring.  If the input ring fills, count
   292				;		and ignore the extra characters; later on, install code
   293				;		to put black balls in the input ring in this case;
   294
   295
   296				;Note: the code assumes that the following maps are inverses:
   297				; 1. F:Port # -> (DZ-11 base address)x(DZ-11 line number),
   298				;		 F(P) = (DZ0BAS+(P & 70)/10, P and 7)
   299				; 2. G:(DZ-11 base address)x(DZ-11 line number) -> Port #,
   300				;		 G(D,L) = (D-DZ0BAS) DIV 10 + L
   301				DEFINE LOSER(X) <	;;Silly restrictions on use of concatination operator.
   302				DZ'X'INT>
   303
   304			000000	ZZ==0
   305				REPEAT MAXDZ,<
   306				LOSER(\ZZ)::	0
   307					DMOVEM T3,DZSV+3
   308					MOVE T4,DZBATB+ZZ
   309					JSP T3,DZINT
   310				ZZ==ZZ+1
   311				>
   312	000200'	000000	000000
   313	000201'	124400	002017'
   314	000202'	200440	002124'
   315	000203'	265400	000220'
   316	000204'	000000	000000
   317	000205'	124400	002017'
   318	000206'	200440	002125'
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-6
DZKON.MAC	30-OCT-87 17:11		DSB

   319	000207'	265400	000220'
   320	000210'	000000	000000
   321	000211'	124400	002017'
   322	000212'	200440	002126'
   323	000213'	265400	000220'
   324	000214'	000000	000000
   325	000215'	124400	002017'
   326	000216'	200440	002127'
   327	000217'	265400	000220'
   328
   329	000220'	352000	001472'	DZINT:	AOSE DZLOCK		;CHECK TO SEE IF CODE REENTERS.
   330	000221'	254200	000221'		 JRST 4,.	
   331	000222'	702200	002034'		TBSAVE DZTBV		;save the current time base value
   332	000223'	275400	000004		SUBI T3,4
   333	000224'	542400	000246'		HRRM T3,ITDDI		;Instruction to dismiss the DZ-11 interrupt.
   334	000225'	124300	002015'		DMOVEM T1,DZSV+1	;Save the rest of the ACs.
   335	000226'	202040	002014'		MOVEM P,DZSV
   336	000227'	200040	002036'		MOVE P,DZPDP
   337	000230'	712311	000000		RDIO T1,CSROFS(T4)	;Read the status.
   338	000231'	261040	000006		SAVE T1
   339	000232'	261040	000011		SAVE T4
   340	000233'	602300	100000		TRNE T1,CSRTRDY		;Transmitter ready?
   341	000234'	260040	000247'		 CALL DZXI		;Yes, try to send it a character.
   342	000235'	262040	000011		REST T4
   343	000236'	262040	000006		REST T1
   344	000237'	602300	020000		TRNE T1,CSRSA		;Silo full?
   345	000240'	260040	000253'		 CALL DZRI		;Yes, empty it.
   346	000241'	200040	002014'	DZDIS:	MOVE P,DZSV
   347	000242'	120300	002015'		DMOVE T1,DZSV+1
   348	000243'	120400	002017'		DMOVE T3,DZSV+3
   349	000244'	476000	001472'		SETOM DZLOCK	
   350	000245'	702600	002034'		TBSET DZTBV		;reset the time base for charging
   351	000246'	254520	000000	ITDDI:	JEN @0
   352	000247'	135340	003522'	DZXI:	LDB T2,[100300,,T1]	;Get port requesting service.
   353	000250'	271351	017770		ADDI T2,-DZ0BAS(T4)
   354	000251'	405340	000037		ANDI T2,37
   355	000252'	254000	000321'	 	JRST OUTDON
   356	000253'	712311	000002	DZRI:	RDIO T1,RBUOFS(T4)	;Remove a word.
   357	000254'	606300	100000		TRNN T1,RBUDV		;This bit is off when the queue is empty.
   358	000255'	263040	000000		 RET
   359	000256'	602300	070000		TRNE T1,RBUOVE+RBUFE+RBUPE	;Error?
   360	000257'	350000	001701'		 AOS NEI		;Yes, count it.
   361	000260'	135340	003522'		LDB T2,[100300,,T1]	;Line.
   362	000261'	271351	017770		ADDI T2,-DZ0BAS(T4)
   00262'	405340	000037		ANDI T2,37
   364	000263'	405300	000377		ANDI T1,377
   365	000264'	260040	000505'		CALL INPDON		;Put character into input ring.
   366	000265'	263040	000000		 RET			;Out of space, quit and hope it frees up.
   367	000266'	254000	000253'		JRST DZRI
   368
   369				;This routine is initiated by the APR interrupt handler whenever
   370				; an APR interrupt occurs for input ready or output done on the CTY.
   371	000267'	336000	001675'	CONINT::SKIPN DZINF		;Are we supposed to look at this?
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-7
DZKON.MAC	30-OCT-87 17:11		DSB

   372	000270'	000000	000000		 0			;No, try next routine.
   373	000271'	702200	002077'		SAVEAC(CON)
   374	000272'	202740	002076'
   375	000273'	551740	002057'
   376	000274'	251740	002075'
   377	000275'	200040	002101'
   378	000276'	402000	001675'		SETZM DZINF		;Clear flag.
   379	000277'	700600	020002		WRPI LI.CPP+1_<7-6>	;Clear interrupt request.
   380	000300'	332300	000000*		SKIPE T1,CTYIWD		;Input done?
   381	000301'	606300	000400		 TRNN T1,CTYIVL
   382	000302'	254000	000307'		  JRST CONODP
   383	000303'	402000	000300*		SETZM CTYIWD
   384	000304'	405300	000377		ANDI T1,CTYOCH
   385	000305'	260040	000504'		CALL CTYIDN
   386	000306'	255000	000000		 JFCL
   387	000307'	205300	100000	CONODP:	MOVSI T1,LCACT		;Expecting output done interrupt?
   388	000310'	612300	003451'		TDNE T1,LINCHR+CTYLIN
   389	000311'	332300	000000*		 SKIPE T1,CTYOWD	;Output done?
   390	000312'	334000	000000		  SKIPA
   391	000313'	260040	000320'		   CALL CTYODN
   392	000314'	205740	002057'		RESTAC(CON)
   393	000315'	251740	000017
   394	000316'	702600	002077'
   395	000317'	254000	000270'		JRST CONINT+1
   396
   397	000320'	201340	000010	CTYODN:	MOVEI T2,CTYLIN
   398				;This routine is called when a line gives a transmitter ready interrupt,
   399				; or when it is desired to start output to the CTY.  Also, after ^O on
   400				; a line with output currently active, this routine resets the output state
   401				; to idle.
   402				;It gives the device another character to be output if it can, or terminates
   403				; output processing for the line.  The latter operation requires turning
   404				; off the line enable bit if this is a DZ-11.
   405	000321'	135400	003515'	OUTDON:	LDB T3,LCOS		;Get output state.
   406	000322'	254030	000323'	OUTDO0:	JRST @.+1(T3)
   407	000323'	000000	000413'		 EXP O.IDL,O.RNG,O.STR,O.FIL,O.BMOD,O.STR,O.HU,O.FOO
	000324'	000000	000344'
	000325'	000000	000374'
	000326'	000000	000334'
	000327'	000000	000440'
	000330'	000000	000374'
	000331'	000000	000413'
	000332'	000000	000333'
   408	000333'	263040	000000	O.FOO:	RET
   409	000334'	550407	003430'	O.FIL:	HRRZ T3,LINFCR(T2)
   410	000335'	361400	000341'		SOJL T3,FILDON		;J-All fill characters have been sent.
   411	000336'	542407	003430'		HRRM T3,LINFCR(T2)	;save decremented fill count
   412	000337'	201300	000377		MOVEI T1,377
   413	000340'	254000	000377'		JRST SNDBYT
   414	000341'	554407	003430'	FILDON:	HLRZ T3,LINFCR(T2)
   415	000342'	137400	003515'		DPB T3,LCOS
   416	000343'	254000	000322'		JRST OUTDO0
   417	000344'	260040	000463'	O.RNG:	CALL ORILDB		;Get a byte from the ring
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-8
DZKON.MAC	30-OCT-87 17:11		DSB

   418	000345'	254000	000415'		 JRST OUTDO1		;None left, try a higher level buffer.
   419	000346'	626300	000400		TRZN T1,400		;Is this a block output request?
   420	000347'	254000	000377'		 JRST SNDBYT		;No, send off byte.
   421	000350'	242300	000010		LSH T1,8
   422	000351'	261040	000006		PUSH P,T1
   423	000352'	260040	000463'		CALL ORILDB		;Get low order byte of count.
   424	000353'	256000	000000'		 STOPCD
   425	000354'	135400	003523'		LDB T3,[100100,,T1]	;Sign bit distinguishes between login/bio.
   426	000355'	405300	000377		ANDI T1,377
   427	000356'	436301	000000		IORM T1,(P)
   428	000357'	200310	003524'		MOVE T1,[EXP OS.LGI,OS.OP](T3)
   429	000360'	137300	003515'		DPB T1,LCOS
   430	000361'	200310	003526'		MOVE T1,[EXP 440700,001100](T3)
   431	000362'	506307	003357'		HRLM T1,LINV2(T2)
   432	000363'	262047	003306'		POP P,LINV1(T2)
   433	000364'	261040	003530'		PUSH P,[221100+T2,,LINV2]
   434				REPEAT 2,<CALL ORILDB
   435					 STOPCD
   436					IDPB T1,(P)>
   437	000365'	260040	000463'
   438	000366'	256000	000000'
   439	000367'	136301	000000
   440	000370'	260040	000463'
   441	000371'	256000	000000'
   442	000372'	136301	000000
   443	000373'	105040	777777		ADJSP P,-1
   444	000374'	375007	003306'	O.STR:	SOSGE LINV1(T2)		;Any bytes left?
   445	000375'	254000	000432'		 JRST OUTDO2		;No.
   446	000376'	134307	003357'		ILDB T1,LINV2(T2)
   447	000377'	135400	003516'	SNDBYT:	LDB T3,LCTYP
   448	000400'	260070	003531'		CALL @[EXP SNDCTY,SNDDZ,SNDFOO,SNDFOO](T3)
   449	000401'	302300	000015		CAIE T1,15		;Does the byte just output require fill chars?
   450	000402'	263040	000000		 RET			;No, all finished
   451	000403'	135300	003517'		LDB T1,LCFIL		;Yes, set fill count
   452	000404'	322300	000000*		JUMPE T1,CPOPJ
   453	000405'	135400	003515'		LDB T3,LCOS
   454	000406'	504300	000010		HRL T1,T3
   455	000407'	202307	003430'		MOVEM T1,LINFCR(T2)
   456	000410'	201300	000003		MOVEI T1,OS.FIL
   457	000411'	137300	003515'		DPB T1,LCOS
   458	000412'	263040	000000		RET
   459	000413'			O.IDL: O.HU:
   460	000413'	135400	003516'		LDB T3,LCTYP		;Here when stopping output on active line.
   461	000414'	254030	000426'		JRST @ODTBL(T3)
   462	000415'	201300	000000	OUTDO1:	MOVEI T1,OS.IDL		;Mark line as idle
   463	000416'	137300	003515'		DPB T1,LCOS
   464	000417'	261040	000007		PUSH P,T2
   465	000420'	260040	000776'		CALL PROOR		;Process some of the Host-Base ring.
   466	000421'	262040	000007		POP P,T2
   467	000422'	135400	003515'		LDB T3,LCOS		;Any output for this line?
   468	000423'	135300	003516'		LDB T1,LCTYP
   469	000424'	322426	000426'		JUMPE T3,@ODTBL(T1)	;J-No, clear line active flag.
   470	000425'	254000	000322'		JRST OUTDO0		;Yes, hop to it, Charlie.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-9
DZKON.MAC	30-OCT-87 17:11		DSB

   471	000426'	000000	000446'	ODTBL:	EXP OD.CTY,OD.DZ,OD.FOO,OD.FOO
	000427'	000000	000452'
	000430'	000000	000451'
	000431'	000000	000451'
   472	000432'	135300	003515'	OUTDO2:	LDB T1,LCOS		;Get current output state.
   473	000433'	306300	000005		CAIN T1,OS.LGI		;Outputting login greeting?
   474	000434'	254000	000344'		 JRST O.RNG		;Yes, try ring next.
   475	000435'	256000	000000'		STOPCD			;Block mode not supported yet.
   476	000436'	201300	000004		MOVEI T1,OS.BMD		;Block mode output finished, tell the host.
   477	000437'	137300	003515'		DPB T1,LCOS
   478	000440'	241340	777770	O.BMOD:	ROT T2,-8
   479	000441'	661340	112000		TLO T2,(<BYTE (8) 45>)
   480	000442'	260040	000750'		CALL DWIIR
   481	000443'	256000	000000'		 STOPCD			;Better not happen frequently.
   482	000444'	135340	003535'		LDB T2,[POINT 8,T2,15]
   483	000445'	254000	000415'		JRST OUTDO1
   484				;Here when output complete on a line.
   485	000446'	370000	001700'	OD.CTY:	SOS TTACT		;One less active line.
   486	000447'	205300	100000		MOVSI T1,LCACT
   487	000450'	412307	003441'		ANDCAM T1,LINCHR(T2)
   488	000451'	263040	000000	OD.FOO: RET
   489	000452'	370000	001700'	OD.DZ:	SOS TTACT		;One less active line.
   490	000453'	205300	100000		MOVSI T1,LCACT
   491	000454'	412307	003441'		ANDCAM T1,LINCHR(T2)	;Remember line enable not set.
   492	000455'	246340	777775		LSHC T2,-3
   493	000456'	242400	777737		LSH T3,-41
   494	000457'	200310	000000*		MOVE T1,TIBTBL(T3)
   495	000460'	200407	002124'		MOVE T3,DZBATB(T2)
   496	000461'	715310	000004		BCIO T1,TCROFS(T3)	;Clear line enable bit.
   497	000462'	263040	000000		RET
   498
   499				;Line output ring buffer routines.
   500				;Try to get a byte from the output ring.  Skip if could, with the byte in T1;
   501				; single return otherwise.
   502	000463'	200407	002152'	ORILDB:	MOVE T3,LINOT(T2)
   503	000464'	316407	002141'		CAMN T3,LINOP(T2)	;Empty ring?
   504	000465'	263040	000000		 RET
   505	000466'	134300	000010		ILDB T1,T3
   506	000467'	316407	002164'		CAMN T3,LINTOR(T2)	;Reached the top of the ring?
   507	000470'	200407	002163'		 MOVE T3,LINTOR-1(T2)	;Yes, take the next byte from its start.
   508	000471'	202407	002152'		MOVEM T3,LINOT(T2)
   509	000472'	350007	002175'		AOS LINCOU(T2)
   510	000473'	254000	000000*		JRST CPOPJ1
   511				;Deposit the 9 bit byte in T1 in the output ring.
   512	000474'	375007	002175'	ORIDPB:	SOSGE LINCOU(T2)
   513	000475'	256000	000000'		 STOPCD
   514	000476'	136307	002141'		IDPB T1,LINOP(T2)
   515	000477'	200307	002141'		MOVE T1,LINOP(T2)
   516	000500'	316307	002164'		CAMN T1,LINTOR(T2)	;Reached the top of the ring?
   517	000501'	200307	002163'		 MOVE T1,LINTOR-1(T2)	;Yes, put the next byte at its start.
   518	000502'	202307	002141'		MOVEM T1,LINOP(T2)
   519	000503'	263040	000000		RET
   520
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-10
DZKON.MAC	30-OCT-87 17:11		DSB

   521	000504'	201340	000010	CTYIDN:	MOVEI T2,CTYLIN
   522				;I-level routine to handle an input character in T1 from line in T2.
   523				;DZRI assumes T4 is preserved.  Skip if the input ring wasn't full.
   524				;Count the character as lost and single-return if it was.
   525	000505'	135400	003514'	INPDON:	LDB T3,LCIS		;Get input state
   526	000506'	254030	000507'		JRST @.+1(T3)
   527	000507'	000000	000602'		 EXP I.IDL,I.LGI,I.ESC,I.BD
	000510'	000000	000513'
	000511'	000000	000650'
	000512'	000000	000534'
   528	000513'	201406	000000	I.LGI:	MOVEI T3,(T1)
   529	000514'	405400	000177		ANDI T3,177
   530	000515'	302400	000073		CAIE T3,";"		;Echo up to delimiter.
   531	000516'	305400	000040		 CAIGE T3,40
   532	000517'	254000	000531'		  JRST ILGI1		;Delimiter: stop echoing.
   533	000520'	260040	000522'		CALL ECHO
   534	000521'	254000	000605'		JRST ID1
   535	000522'	261040	000006	ECHO:	PUSH P,T1		;Echo character.
   536	000523'	261040	000007		PUSH P,T2
   537	000524'	260040	000474'		CALL ORIDPB
   538	000525'	260040	001650'		CALL STOUT
   539	000526'	262040	000007		POP P,T2
   540	000527'	262040	000006		POP P,T1
   541	000530'	263040	000000		RET
   542	000531'	201400	000000	ILGI1:	MOVEI T3,IS.IDL		;Normal state.
   543	000532'	137400	003514'		DPB T3,LCIS
   544	000533'	254000	000605'		JRST ID1
   545	000534'	135400	003516'	I.BD:	LDB T3,LCTYP
   546				;;;	CAIE T3,LT.DZ		;Only set LPR for DZ lines.
   547	000535'	254000	000560'		 JRST BD3
   548	000536'	405300	000377		ANDI T1,377		;Get char received
   549	000537'	205400	777777		MOVSI T3,-NRCTLP	;Map to LPR setting.
   550	000540'	430310	000546'	BD1:	XOR T1,RCTLPR(T3)
   551	000541'	606300	777777		TRNN T1,-1
   552	000542'	254000	000547'		 JRST BD2		;Found it.
   553	000543'	430310	000546'		XOR T1,RCTLPR(T3)
   554	000544'	253400	000540'		AOBJN T3,BD1
   555	000545'	263040	000000		RET			;Not found, remain in BD state.
   556				;Received character to LPR setting mapping.
   557				;Rh: received character.  Lh: LPR setting.
   558	000546'	000000	000000	RCTLPR:	0
   559			000001	NRCTLPR==.-RCTLPR
   560	000547'	554310	000546'	BD2:	HLRZ T1,RCTLPR(T3)	;Set software speed.
   561	000550'	137300	003521'		DPB T1,LCSPE		;And hardware.
   562	000551'	201407	000000		MOVEI T3,(T2)
   563	000552'	405400	000007		ANDI T3,7
   564	000553'	660400	010030		TRO T3,LPRRO+3*LPRCLA
   565	000554'	306300	000002		CAIN T1,2		;110 baud?
   566	000555'	660400	000040		 TRO T3,LPRSC		;Yes, 2 stop bits.
   567	000556'	137300	003536'		DPB T1,[100400,,T3]
   568	000557'	713431	000002		WRIO T3,@LPROFS(T4)
   569				    ;Here when baud rate set.
   570	000560'	260040	001631'	BD3:	CALL TYPGRE		;Start out greeting,
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-11
DZKON.MAC	30-OCT-87 17:11		DSB

   571	000561'	200300	000007		MOVE T1,T2		;Send login message for port.
   572	000562'	205340	014000		MOVSI T2,(<BYTE (8) 6>)
   573	000563'	137300	003535'		DPB T1,[POINT 8,T2,15]	;Login on this port.
   574	000564'	260040	000750'		PUSHJ P,DWIIR
   575	000565'	256000	000000'		 STOPCD
   576	000566'	430340	003537'		XOR T2,[BYTE (8) 202,0,14,13]	;Terminal type 14.
   577	000567'	260040	000750'		PUSHJ P,DWIIR
   578	000570'	256000	000000'		 STOPCD
   579	000571'	200340	003540'		MOVE T2,[BYTE (8) 27]
   580	000572'	260040	000750'		PUSHJ P,DWIIR
   581	000573'	256000	000000'		 STOPCD
   582	000574'	200340	000006		MOVE T2,T1
   583	000575'	205300	200000		MOVSI T1,LCLGI
   584	000576'	436307	003441'		IORM T1,LINCHR(T2)
   585	000577'	201300	000001		MOVEI T1,IS.LGI		;Prepare to accept login message.
   586	000600'	137300	003514'		DPB T1,LCIS
   587	000601'	263040	000000		RET
   588	000602'	302300	000032	I.IDL:	CAIE T1,"Z"-100		;Check for escape character.
   589	000603'	306300	000232		 CAIN T1,"Z"-100+200
   590	000604'	254000	000735'		  JRST IDSE		;Yep, change state.
   591	000605'	201400	000002	ID1:	MOVEI T3,LCDE		;Deferred echoing?
   592	000606'	616407	003441'		TDNN T3,LINCHR(T2)
   593	000607'	260040	000617'		 CALL INPECH		;No, echo character if possible.
   594	000610'	241340	777760		ROT T2,-8-8		;Construct a single byte data packet.
   595	000611'	661340	402000		TLO T2,(<BYTE (8) 201>)
   596	000612'	137300	003541'		DPB T1,[POINT 8,T2,23]
   597	000613'	260040	000750'		PUSHJ P,DWIIR		;Store in Base-Host ring.
   598	000614'	354000	001702'		 AOSA NLIC		;No space left in input ring.  Count lost char.
   599	000615'	350001	000000		  AOS (P)
   600	000616'	263040	000000		RET
   601	000617'	261040	000006	INPECH:	PUSH P,T1		;Can this character be echoed by us?
   602	000620'	205400	100000		MOVSI T3,LCACT
   603	000621'	612407	003441'		TDNE T3,LINCHR(T2)
   604	000622'	254000	000636'		 JRST INPEC1		;No--line doing output.
   605	000623'	135400	003542'		LDB T3,[POINT 2,T1,30]
   606	000624'	405300	000037		ANDI T1,37
   607	000625'	200306	000000*		MOVE T1,BITTBL(T1)
   608	000626'	612310	000632'		TDNE T1,CET(T3)
   609	000627'	254000	000636'		 JRST INPEC1		;No--special character.
   610	000630'	262040	000006		POP P,T1		;Yes, echo it.
   611	000631'	254000	000522'		JRST ECHO
   612	000632'	000217	777777	CET:	<-1>+1B10+1B13	;all control characters but CR and LF.
   613	000633'	000000	000000		EXP 0,0
	000634'	000000	000000
   614	000635'	000000	000460		1B27+1B30+1B31	;right brace, tilde, rubout.
   615	000636'	261040	000007	INPEC1:	PUSH P,T2		;Can't echo, enter deferred echo mode.
   616	000637'	241340	777760		ROT T2,-8-8
   617	000640'	661340	030000		TLO T2,(<BYTE (8) 14>)
   618	000641'	260040	000750'		CALL DWIIR
   619	000642'	256000	000000'		 STOPCD
   620	000643'	262040	000007		POP P,T2
   621	000644'	262040	000006		POP P,T1
   622	000645'	201400	000002		MOVEI T3,LCDE
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-12
DZKON.MAC	30-OCT-87 17:11		DSB

   623	000646'	436407	003441'		IORM T3,LINCHR(T2)
   624	000647'	263040	000000		RET
   625
   626	000650'	405300	000177	I.ESC:	ANDI T1,177
   627	000651'	201400	000000		MOVEI T3,IS.IDL		;Reset state.
   628	000652'	137400	003514'		DPB T3,LCIS
   629	000653'	306300	000102		CAIN T1,"B"
   630	000654'	263040	000000	DZBRK:	 RET			;Traditional breakpoint location.
   631	000655'	306300	000023		CAIN T1,"S"-100
   632	000656'	254000	000676'		 JRST CTRLS
   633	000657'	306300	000021		CAIN T1,"Q"-100
   634	000660'	254000	000707'		 JRST CTRLQ
   635	000661'	306300	000117		CAIN T1,"O"
   636	000662'	254000	000723'		 JRST CTRLO
   637	000663'	306300	000110		CAIN T1,"H"
   638	000664'	254000	000740'		 JRST HNGUP		;Reset line.
   639	000665'	301300	000060		CAIL T1,"0"
   640	000666'	303300	000071		 CAILE T1,"9"
   641	000667'	254000	000673'		  JRST DZBRK1		;Treat as normal char.
   642	000670'	275300	000060		SUBI T1,"0"
   643	000671'	137300	003517'		DPB T1,LCFIL		;Set number of fill characters.
   644	000672'	263040	000000		RET
   645	000673'	260040	000605'	DZBRK1:	CALL ID1
   646	000674'	263040	000000		 RET
   647	000675'	263040	000000		RET
   648
   649	000676'	201300	000001	CTRLS:	MOVEI T1,LCOH
   650	000677'	612307	003441'		TDNE T1,LINCHR(T2)
   651	000700'	263040	000000		 RET
   652	000701'	436307	003441'		IORM T1,LINCHR(T2)
   653	000702'	241340	777760		ROT T2,-8-8
   654	000703'	661340	020000		TLO T2,(<BYTE (8) 10>)	;Backpressure on.
   655	000704'	260040	000750'		CALL DWIIR
   656	000705'	256000	000000'		 STOPCD
   657	000706'	263040	000000		RET
   658
   659	000707'	201300	000001	CTRLQ:	MOVEI T1,LCOH
   660	000710'	616307	003441'		TDNN T1,LINCHR(T2)
   661	000711'	263040	000000		 RET
   662	000712'	412307	003441'		ANDCAM T1,LINCHR(T2)
   663	000713'	241340	777760		ROT T2,-8-8
   664	000714'	661340	022000		TLO T2,(<BYTE (8) 11>)	;Backpressure off.
   665	000715'	260040	000750'		CALL DWIIR
   666	000716'	256000	000000'		 STOPCD
   667	000717'	263040	000000		RET
   668
   669	000720'	201400	000006	HANGLN:	MOVEI T3,OS.HU
   670	000721'	137400	003515'		DPB T3,LCOS
   671	000722'	254000	000727'		JRST FB1
   672	000723'	205400	400000	CTRLO:	MOVSI T3,LCDO		;^O, flush current & discard future output.
   673	000724'	432407	003441'		XORM T3,LINCHR(T2)
   674	000725'	201400	000000	FLUBUF:	MOVEI T3,OS.IDL		;If line is currently active, Xmit done
   675	000726'	137400	003515'		DPB T3,LCOS		; will reset state.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-13
DZKON.MAC	30-OCT-87 17:11		DSB

   676	000727'	200407	002152'	FB1:	MOVE T3,LINOT(T2)
   677	000730'	202407	002141'		MOVEM T3,LINOP(T2)
   678	000731'	201400	000377		MOVEI T3,NOBIOB
   679	000732'	202407	002175'		MOVEM T3,LINCOU(T2)
   680	000733'	402007	003306'		SETZM LINV1(T2)
   681	000734'	263040	000000		RET
   682	
   683	000735'	201400	000002	IDSE:	MOVEI T3,IS.ESC		;Remember we have seen the escape character.
   684	000736'	137400	003514'		DPB T3,LCIS
   685	000737'	263040	000000		RET
   686
   687	000740'	200300	000007	HNGUP:	MOVE T1,T2
   688	000741'	205340	026000		MOVSI T2,(<BYTE (8) 13>)	;Circuit zapper.
   689	000742'	137300	003535'		DPB T1,[POINT 8,T2,15]
   690	000743'	205400	200000		MOVSI T3,LCLGI
   691	000744'	612406	003441'		TDNE T3,LINCHR(T1)	;Ignore if not logged in.
   692	000745'	260040	000750'		 PUSHJ P,DWIIR
   693	000746'	263040	000000		  RET
   694	000747'	263040	000000		RET
   695
   696				;Try to deposit the word in T2 in the Base-Host ring (IRING).  Skip if there
   697				; was space and the word has been deposited; single return if not.
   698	000750'	200400	000000*	DWIIR:	MOVE T3,IRP620
   699	000751'	340400	000000		AOJ T3,
   700	000752'	405400	000000*		ANDI T3,MSKIRG
   701	000753'	316400	000000*		CAMN T3,IRPPDP		;Is there space in the input ring?
   702	000754'	263040	000000		 RET			;No, indicate so.
   703	000755'	261040	000007		SAVE T2			;T2 MUST BE RETURNED UNCHANGED
   704	000756'	261040	000010		SAVE T3			;Can't do EXCH because of race possibility.
   705				IFKMC<
   706	000757'	242340	777776		LSH	T2,-2		;SHIFT RIGHT 2
   707	000760'	550400	000007		HRRZ	T3,T2		;T3 = RIGHT HALF
   708	000761'	242400	777776		LSH	T3,-2		;SHIFT RIGHT HALF RIGHT 2 MORE BITS
   709	000762'	540340	000010		HRR	T2,T3		;T2 GETS NEW RIGHT HALF
   710				>;END IFKMC
   711	000763'	200400	000750*		MOVE T3,IRP620
   712	000764'	202350	000000*		MOVEM T2,IRING(T3)
   713	000765'	262040	000763*		REST IRP620
   714	000766'	262040	000007		REST T2			;RESTORE T2
   715	000767'	350001	000000		AOS (P)
   716	000770'	263040	000000		RET
   717
   718					;PUT ORING WORD INTO T2 IN NON-KMC FORMAT
   719	000771'	200351	000000*	LWFOR:	MOVE T2,ORING(T4)	;T2 <- NEXT WORD IN ORING
   720				IFKMC<
   721	000772'	242340	000002		LSH	T2,2		;SHIFT LEFT 2
   722	000773'	500351	000771*		HLL	T2,ORING(T4)	;LAY IN THE LEFT HALF AGAIN
   723	000774'	242340	000002		LSH	T2,2		;NOW T2 LOOKS LIKE KL's ORING WORD
   724				>;END IFKMC
   725	000775'	263040	000000		POPJ	P,
   726				;Here to process packets in the Host-Base ring (ORING).
   727	000776'	334440	000030*	PROOR:	SKIPA T4,ORP620		;Output ring pointer.
   728	000777'	405440	000000*	PROOR1:	 ANDI T4,MSKORG
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-14
DZKON.MAC	30-OCT-87 17:11		DSB

   729	001000'	316440	000026*		CAMN T4,ORPPDP		;Is the ring empty?
   730	001001'	254000	001110'		 JRST ORDONE		;Yes.
   731	001002'	135300	003543'		LDB T1,[POINT 8,ORING(T4),BYP1]	;Get type of this packet.
   732	001003'	307300	000043		CAIG T1,SZODS		;Special, data, or illegal?
   733	001004'	256006	001130'		 XCT CTOSPC(T1)		;Special.
   734	001005'	626300	000200		TRZN T1,200
   735	001006'	256000	000000'		 STOPCD			;Illegal.
   736	001007'	135340	003544'		LDB T2,[POINT 8,ORING(T4),BYP2]	;Data.
   737
   738				;Now see what line it is going to and behave accordingly:
   739				; 1. CTY: put it in the line's output ring, send backpressure if the
   740				;		ring is too full, and start output on line if possible.
   741				; 2. DZ-11: put it in the output ring, send backpressure if it's too full,
   742				;		set line enable bit for the line if it's not already set.
   743				;		I-level routines will start the output.
   744				; 3. Aux circuit: copy directly into the input ring as input data going
   745				;		into the line on the other end of this circuit.  If the
   746				;		input ring is full, quit processing the output ring; this
   747				;		effectively waits until there is enough space.
   748	001010'	135400	003516'		LDB T3,LCTYP		;Process data according to the type of line
   749	001011'	254030	001012'		JRST @.+1(T3)
   750	001012'	000000	001060'		 EXP O.CTY,O.DZ,O.AUX,O.FOO
	001013'	000000	001060'
	001014'	000000	001016'
	001015'	000000	000333'
   751
   752	001016'	135400	003520'	O.AUX:	LDB T3,LCAUX		;What's the connection?
   753	001017'	322400	001053'		JUMPE T3,SKPDPK		;None, spurious output.
   754				;Turn data packet starting at ORING(T4) into data packet for input ring
   755				; of line in T3.
   756	001020'	202300	001677'		MOVEM T1,CTOCNT
   757	001021'	201351	000773*		MOVEI T2,ORING(T4)
   758	001022'	505340	221000		HRLI T2,(<POINT 8,0,BYP2>)
   759	001023'	202340	001676'		MOVEM T2,CTOPNT
   760	001024'	340300	000000		AOJ T1,
   761	001025'	242300	777777		LSH T1,-1
   762	001026'	260040	001356'		PUSHJ P,CIRFS		;Is there space in the input ring?
   763	001027'	254000	001110'		 JRST ORDONE		;No, quit.
   764	001030'	205340	404000		MOVSI T2,(BYTE (8) 202)
   765	001031'	137400	003535'		DPB T3,[POINT 8,T2,15]
   766	001032'	375000	001677'	CFOIL:	SOSGE CTOCNT
   767	001033'	254000	001050'		 JRST CFOIL1
   768	001034'	101300	001676'		UUILDB T1,CTOPNT
   769	001035'	137300	003541'		DPB T1,[POINT 8,T2,23]
   770	001036'	375000	001677'		SOSGE CTOCNT
   771	001037'	254000	001045'		 JRST CFOIL2
   772	001040'	101300	001676'		UUILDB T1,CTOPNT
   773	001041'	137300	003545'		DPB T1,[POINT 8,T2,31]
   774	001042'	260040	000750'		PUSHJ P,DWIIR
   775	001043'	256000	000000'		 STOPCD
   776	001044'	254000	001032'		JRST CFOIL
   777
   778	001045'	641340	006000	CFOIL2:	TLC T2,(BYTE (8) 3)	;Last packet is odd.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-15
DZKON.MAC	30-OCT-87 17:11		DSB

   779	001046'	260040	000750'		PUSHJ P,DWIIR
   780	001047'	256000	000000'		 STOPCD
   781	001050'	550440	001676'	CFOIL1:	HRRZ T4,CTOPNT
   782	001051'	275440	001021*		SUBI T4,ORING
   783	001052'	344440	000777'	SKT3:	AOJA T4,PROOR1	;CONTINUE
   784
   785				;Skip over a data packet.  T4/ Packet start. T1/ Number of data bytes.
   786	001053'	275300	000002	SKPDPK:	SUBI T1,2		;The first 2 data bytes fit in the first word
   787	001054'	361300	003546'		SOJL T1,[AOJA T4,PROOR1]
   788	001055'	242300	777776		LSH T1,-2		;Number of words in packet - 2
   789	001056'	271446	000001		ADDI T4,1(T1)
   790	001057'	344440	000777'		AOJA T4,PROOR1
   791
   792				;Here to dispose of a data packet going to a real terminal.
   793				;T1/ Number of bytes in the packet.  T2/ Line number.
   794	001060'			O.DZ: O.CTY:
   795	001060'	205400	400000		MOVSI T3,LCDO
   796	001061'	612407	003441'		TDNE T3,LINCHR(T2)
   797	001062'	254000	001053'		 JRST SKPDPK		;Skip data packet.
   798	001063'	313307	002175'		CAMLE T1,LINCOU(T2)	;Room?
   799	001064'	254000	001110'		 JRST ORDONE		;No, terminate output ring processing.
   800	001065'	551406	000000		HRRZI T3,(T1)		;Number of data bytes.
   801	001066'	505440	221000		HRLI T4,(<POINT 8,0,BYP2>)
   802	001067'	271440	001051*	CDPIOR:	ADDI T4,ORING
   803	001070'	101300	000011		UUILDB T1,T4
   804	001071'	275440	001067*		SUBI T4,ORING
   805	001072'	260040	000474'		CALL ORIDPB
   806	001073'	404440	003547'		AND T4,[-1,,MSKORG]
   807	001074'	367400	001067'		SOJG T3,CDPIOR
   808	001075'	260040	001650'		CALL STOUT		;Start up line if it's not already active.
   809	001076'	344440	000777'		AOJA T4,PROOR1		;Back for more.
   810
   811				;Set the line enable bit for the DZ-11 line specified by the port number in T2.
   812				;Destroys T2, T1.
   813	001077'	553000	000007	SDLE:	HRRZS T2
   814	001100'	205300	100000		MOVSI T1,LCACT
   815	001101'	436307	003441'		IORM T1,LINCHR(T2)
   816	001102'	245300	777775		ROTC T1,-3
   817	001103'	200347	002124'		MOVE T2,DZBATB(T2)
   818	001104'	242300	777737		LSH T1,-41
   819	001105'	200306	000457*		MOVE T1,TIBTBL(T1)
   820	001106'	714307	000004		BSIO T1,TCROFS(T2)
   821	001107'	263040	000000		RET
   822
   823	001110'	202440	000776*	ORDONE:	MOVEM T4,ORP620
   824	001111'	263040	000000		RET
   825
   826				;Low level output routines. T1/ Char.  T2/ Line.  T1 27-35 must be preserved
   827				; and T2 must be wholly preserved.
   828				;Send a character to the CTY.
   829	001112'	405300	000377	SNDCTY:	ANDI T1,CTYOCH
   830	001113'	660300	000400		TRO T1,CTYOVL
   831	001114'	202300	000311*		MOVEM T1,CTYOWD
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 1-16
DZKON.MAC	30-OCT-87 17:11		DSB

   832	001115'	700200	012000*		WRAPR LP.SSF+LP.I8C+APRCHN	;Kick the 8080
   833	001116'	620300	000400		TRZ T1,CTYOVL
   834	001117'	263040	000000		RET
   835				;Send a byte to a DZ-11 line.  T1/ Byte T2/ Line number
   836	001120'	551407	760010	SNDDZ:	HRRZI T3,DZ0BAS(T2)
   837	001121'	505400	000003		HRLI T3,DZUBA
   838	001122'	620400	000007		TRZ T3,7
   839	001123'	405300	000377		ANDI T1,377
   840	001124'	713310	000006		WRIO T1,TDROFS(T3)
   841	001125'	263040	000000		RET
   842	001126'	263040	000000	SNDFOO:	RET
   843
   844	001127'	000000	000000	SAVT1:	0			;SAVE T1
   845
   846
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 2
DZKON.MAC	30-OCT-87 17:11		DSB

   847
   848				;Vector of special output packets for Host-Base protocol.
   849				;If the output ring processor encounters a packet of type N, the Nth
   850				; element of the vector is XCTed.
   851				DEFINE IGNORE(LENGTH)<
   852				IFE LENGTH-1,<AOJA T4,PROOR1>
   853				IFE LENGTH-2,<AOJA T4,[AOJA T4,PROOR1]>>
   854	001130'			CTOSPC:	;Instruction	;Packet type
   855	001130'	256000	000000'		STOPCD		;0 Undefined
   856	001131'	344440	000777'		IGNORE 1	;1 Host is open
   857	001132'	344440	000777'		IGNORE 1	;2 Host is Shut
   858	001133'	256000	000000'		STOPCD		;3 Undefined
   859	001134'	256000	000000'		STOPCD		;4     "
   860	001135'	256000	000000'		STOPCD		;5     "
   861	001136'	256000	000000'		STOPCD		;6     "
   862	001137'	256000	000000'		STOPCD		;7     "
   863	001140'	254000	001366'		JRST P.BON	;10 Backpressure On
   864	001141'	254000	001366'		JRST P.BOFF	;11 Backpressure Off
   865	001142'	254000	001455'		JRST P.CG	;12 Character Gobbler
   866	001143'	254000	001412'		JRST P.CZ	;13 Circuit Zapper
   867	001144'	256000	000000'		STOPCD		;14 Enter deferred echo mode
   868	001145'	256000	000000'		STOPCD		;15 Leave deferred echo mode
   869	001146'	344440	000777'		IGNORE 1	;16 Green Ball
   870	001147'	344440	000777'		IGNORE 1	;17 Red Ball
   871	001150'	254000	001401'		JRST P.YELL	;20 Yellow Ball
   872	001151'	254000	001366'		JRST P.ORAN	;21 Orange Ball
   873	001152'	256000	000000'		STOPCD		;22 Hang Character
   874	001153'	256000	000000'		STOPCD		;23 Enter transparency mode
   875	001154'	256000	000000'		STOPCD		;24 Leave transparency mode
   876	001155'	256000	000000'		STOPCD		;25 Undefined
   877	001156'	254000	001174'		JRST P.SR	;26 Supervisor Request
   878	001157'	256000	000000'		STOPCD		;27 Undefined
   879	001160'	254000	001211'		JRST P.SLC	;30 Supervisor login character
   880	001161'	256000	000000'		STOPCD		;31 Test pattern probe
   881	001162'	256000	000000'		STOPCD		;32 Undefined
   882	001163'	344440	003546'		IGNORE 2	;33 Host sad
   883	001164'	344440	000777'		IGNORE 1 	;34 Echo on
   884	001165'	344440	000777'		IGNORE 1	;35 Echo off
   885	001166'	344440	000777'		IGNORE 1	;36 Set terminal characteristics
   886	001167'	344440	000777'		IGNORE 1	;37 Probe terminal characteristics
   887	001170'	256000	000000'		STOPCD		;40 Undefined
   888	001171'	344440	000777'		IGNORE 1	;41 Set host number
   889	001172'	344440	000777'		IGNORE 1	;42 Supervisor clock request
   890	001173'	256000	000000'		STOPCD		;43 Undefined
   891				REPEAT 0,<;Code not yet finished.
   892					JRST P.IBMO	;44 Initiate block mode output
   893					STOPCD		;45 Block mode output complete
   894					JRST P.IBMI	;46 Initiate block mode input
   895					STOPCD		;47 Block mode input terminated--out of buffer space
   896					STOPCD		;50 Block mode input terminated--end of transmission
   897					STOPCD		;51 Block mode input terminated--timeout by base
   898					JRST P.RBIT	;52 Request block mode input termination
   899					STOPCD		;53 Block mode input terminated by host request
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 2-2
DZKON.MAC	30-OCT-87 17:11		DSB

   900					JRST P.RBOT	;54 Request block mode output termination
   901					STOPCD		;55 Block mode output terminated by host request
   902					JRST P.NBIP	;56 Negotiate for number of block I/O ports
   903				>;REPEAT 0,
   904			000043	SZODS==.-CTOSPC-1
   905
   906
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 3
DZKON.MAC	30-OCT-87 17:11		DSB

   907
   908				REPEAT 0,<
   909				;Block mode I/O
   910				P.IBMO:	LDB T2,[POINT 8,ORING(T4),BYP2]	;Destination port number
   911					LDB T3,LCTYP
   912					CAIN T3,LT.AUX
   913					 STOPCD
   914					MOVEI T1,5
   915					CAMLE T1,LINCOU(T2)
   916					 JRST ORDONE
   917				;code to put request into output ring
   918					JRST PROOR1
   919				P.RBOT:	
   920				P.NBIP:	LDB T2,[POINT 8,ORING(T4),BYP2]	;Destination port number
   921					LDB T3,LCTYP
   922					CAIE T3,LT.AUX
   923					 JRST PNBIP1
   924				;send request over aux circuit.
   925				>;REPEAT 0,
   926
   927
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 4
DZKON.MAC	30-OCT-87 17:11		DSB

   928
   929				;Simulate a supervisor to allow building of Auxiliary Circuits.
   930				;Circuits can only be built to ourselves (for obvious reasons).
   931	001174'	352000	001463'	P.SR:	AOSE SUPBF		;The Host can only have one dialogue at a time
   932	001175'	254000	001206'		 JRST SUPBSY		;Sorry, busy.
   933	001176'	200300	003550'		MOVE T1,[POINT 7,AXSTR]
   934	001177'	202300	001464'		MOVEM T1,AXSTRP
   935	001200'	201300	000014		MOVEI T1,^D12
   936	001201'	202300	001470'		MOVEM T1,AXCNT
   937	001202'	476000	001471'		SETOM AXNUM		;Remember state.
   938	001203'	260040	000771'		PUSHJ P,LWFOR		;Load Word From ORing(T4) into t2
   939	001204'	661340	002000		TLO T2,(<BYTE (8) 1>)	;Turn it into good response.
   940	001205'	254000	001407'		JRST RSPOUT
   941	001206'	260040	000771'	SUPBSY:	PUSHJ P,LWFOR		;Load Word From ORing(T4) into t2
   942	001207'	670340	003551'		TDO T2,[BYTE (8) 1,0,1]
   943	001210'	254000	001407'		JRST RSPOUT
   944
   945	001211'	135300	003552'	P.SLC:	LDB T1,[POINT 7,ORING(T4),BYP3]	;Supervisor login character.
   946	001212'	302300	000015		CAIE T1,15
   947	001213'	306300	000073		 CAIN T1,";"
   948	001214'	254000	001236'	 	  JRST P.SLC3		;End of login string
   949	001215'	331000	001471'		SKIPL AXNUM
   950	001216'	254000	001226'		 JRST P.SLC2		;Continue reading system number
   951	001217'	306300	000072		CAIN T1,":"
   952	001220'	254000	001224'		 JRST P.SLC1		;Commence reading system number
   953	001221'	371000	001470'		SOSL AXCNT		;Save as part of user name if there's room
   954	001222'	136300	001464'		 IDPB T1,AXSTRP
   955	001223'	344440	000777'		AOJA T4,PROOR1
   956
   957	001224'	402000	001471'	P.SLC1:	SETZM AXNUM
   958	001225'	344440	000777'		AOJA T4,PROOR1
   959
   960	001226'	307300	000071	P.SLC2:	CAIG T1,"9"		;Ignore non digits
   961	001227'	305300	000060		 CAIGE T1,"0"
   962	001230'	344440	000777'		  AOJA T4,PROOR1
   963	001231'	200340	001471'		MOVE T2,AXNUM
   964	001232'	221340	000012		IMULI T2,12
   965	001233'	271346	777720		ADDI T2,-"0"(T1)
   966	001234'	202340	001471'		MOVEM T2,AXNUM
   967	001235'	344440	000777'		AOJA T4,PROOR1
   968
   969	001236'	135300	003553'	P.SLC3:	LDB T1,[POINT 7,CONFIG,13]
   970	001237'	135340	003554'		LDB T2,[POINT 7,CONFIG,20]	;Find Host's system number
   971	001240'	275300	000060		SUBI T1,"0"
   972	001241'	221300	000012		IMULI T1,12
   973	001242'	271307	777720		ADDI T1,-"0"(T2)
   974	001243'	312300	001471'		CAME T1,AXNUM
   975	001244'	254000	001336'		 JRST SUPSYW		;Host can talk only to itself
   976	001245'	201300	000015		MOVEI T1,^D13
   977	001246'	274300	001470'		SUB T1,AXCNT
   978	001247'	242300	777777		LSH T1,-1
   979	001250'	271300	000005		ADDI T1,5		;Get space in input ring required
   980	001251'	260040	001356'		PUSHJ P,CIRFS		;Check size
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 4-2
DZKON.MAC	30-OCT-87 17:11		DSB

   981	001252'	254000	001110'		 JRST ORDONE		;No, say finished, will reenter.
   982	001253'	201300	000000		MOVEI T1,0
   983	001254'	136300	001464'		IDPB T1,AXSTRP
   984	001255'	260040	001345'		PUSHJ P,GETPRT		;Now get 2 ports for the circuit
   985	001256'	254000	001336'		 JRST SUPSYW		;All are busy.  Say the system is unavailable.
   986	001257'	261040	000007		PUSH P,T2
   987	001260'	260040	001354'		CALL GETPRC
   988	001261'	254000	001335'		 JRST SUPSWP
   989	001262'	550301	000000		HRRZ T1,(P)
   990	001263'	250300	000007		EXCH T1,T2
   991	001264'	137300	003520'		DPB T1,LCAUX
   992	001265'	250300	000007		EXCH T1,T2
   993	001266'	137300	003520'		DPB T1,LCAUX
   994	001267'	205400	016000		MOVSI T3,(<BYTE (8) 7>)	;Internally initiated new circuit
   995	001270'	137300	003555'		DPB T1,[POINT 8,T3,15]
   996	001271'	135340	003544'		LDB T2,[POINT 8,ORING(T4),BYP2]	;Get port of requester.
   997	001272'	137340	003556'		DPB T2,[POINT 8,T3,23]	;And put in port request.
   998	001273'	200340	000007		MOVE T2,T2
   999	001274'	260040	000750'		PUSHJ P,DWIIR
  1000	001275'	256000	000000'		 STOPCD
  1001	001276'	205340	056000		MOVSI T2,(BYTE (8) 27)	;Supervisor response.
  1002	001277'	135400	003544'		LDB T3,[POINT 8,ORING(T4),BYP2]
  1003	001300'	137400	003535'		DPB T3,[POINT 8,T2,15]
  1004	001301'	260040	000750'		PUSHJ P,DWIIR		;Say no error.
  1005	001302'	256000	000000'		 STOPCD
  1006	001303'	205340	014000		MOVSI T2,(BYTE (8) 6)	;Externally initiated new circuit.
  1007	001304'	137300	003535'		DPB T1,[POINT 8,T2,15]	;Now log in new port.
  1008	001305'	260040	000750'		PUSHJ P,DWIIR
  1009	001306'	256000	000000'		 STOPCD
  1010	001307'	205340	404000		MOVSI T2,(BYTE (8) 202)
  1011	001310'	137300	003535'		DPB T1,[POINT 8,T2,15]
  1012	001311'	260040	000750'		PUSHJ P,DWIIR
  1013	001312'	256000	000000'		 STOPCD
  1014	001313'	260040	000750'		PUSHJ P,DWIIR
  1015	001314'	256000	000000'		 STOPCD
  1016	001315'	200400	003550'		MOVE T3,[POINT 7,AXSTR]
  1017	001316'	202400	001464'		MOVEM T3,AXSTRP
  1018	001317'	134400	001464'	STRLP:	ILDB T3,AXSTRP
  1019	001320'	322400	001333'		JUMPE T3,STRLP2
  1020	001321'	137400	003541'		DPB T3,[POINT 8,T2,23]
  1021	001322'	134400	001464'		ILDB T3,AXSTRP
  1022	001323'	322400	001330'		JUMPE T3,STRLP3
  1023	001324'	137400	003545'		DPB T3,[POINT 8,T2,31]
  1024	001325'	260040	000750'		PUSHJ P,DWIIR
  1025	001326'	256000	000000'		 STOPCD
  1026	001327'	254000	001317'		JRST STRLP
  1027
  1028	001330'	641340	006000	STRLP3:	TLC T2,(BYTE (8) 3)	;Change to 1 chr.
  1029	001331'	260040	000750'		PUSHJ P,DWIIR
  1030	001332'	256000	000000'		 STOPCD
  1031	001333'	476000	001463'	STRLP2:	SETOM SUPBF
  1032	001334'	344440	000777'		AOJA T4,PROOR1
  1033
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 4-3
DZKON.MAC	30-OCT-87 17:11		DSB

  1034
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 5
DZKON.MAC	30-OCT-87 17:11		DSB

  1035
  1036	001335'	262040	000010	SUPSWP:	POP P,T3
  1037	001336'	135300	003544'	SUPSYW:	LDB T1,[POINT 8,ORING(T4),BYP2]
  1038	001337'	200340	003557'		MOVE T2,[BYTE (8) 27,0,4]
  1039	001340'	137300	003535'		DPB T1,[POINT 8,T2,15]
  1040	001341'	260040	000750'		PUSHJ P,DWIIR
  1041	001342'	254000	001110'		 JRST ORDONE
  1042	001343'	476000	001463'		SETOM SUPBF
  1043	001344'	344440	000777'		AOJA T4,PROOR1
  1044
  1045				;Return in Rh(T2) a port number eligible for use in an Auxiliary Ciruit.
  1046	001345'	200340	002140'	GETPRT:	MOVE T2,AUXCPT
  1047	001346'	135300	003516'	GETPR1:	LDB T1,LCTYP		;Is this an Aux Circuit line?
  1048	001347'	302300	000002		CAIE T1,LT.AUX
  1049	001350'	254000	001354'		 JRST GETPRC
  1050	001351'	135300	003520'		LDB T1,LCAUX		;Is it in use?
  1051	001352'	336000	000006		SKIPN T1
  1052	001353'	354001	000000		 AOSA (P)
  1053	001354'	253340	001346'	GETPRC:	  AOBJN T2,GETPR1
  1054	001355'	263040	000000		RET
  1055
  1056				;Compare number of free words in input ring with T1 and skip if greater.
  1057	001356'	200340	000753*	CIRFS:	MOVE T2,IRPPDP
  1058	001357'	274340	000765*		SUB T2,IRP620
  1059	001360'	362340	000404*		SOJE T2,CPOPJ		;J-Ring totally full
  1060	001361'	335000	000007		SKIPGE T2
  1061	001362'	271340	000001*		 ADDI T2,MSKIRG+1
  1062	001363'	311340	000006		CAML T2,T1
  1063	001364'	350001	000000		 AOS (P)
  1064	001365'	263040	000000		RET
  1065
  1066	001366'			P.BON: P.BOFF: P.ORAN:
  1067				;If this is an Aux circuit port, send the packet to the port at the
  1068				; other end.  Otherwise ignore it.
  1069	001366'	135340	003544'	SOAOR:	LDB T2,[POINT 8,ORING(T4),BYP2]	;Send over aux circuit or ignore
  1070	001367'	135400	003516'		LDB T3,LCTYP
  1071	001370'	302400	000002		CAIE T3,LT.AUX		;Ignore unless Aux circuit port.
  1072	001371'	344440	000777'		 AOJA T4,PROOR1
  1073				;Send a packet over the simulated circuit.  T2/ Line number.
  1074	001372'	135340	003520'	SOA:	LDB T2,LCAUX
  1075	001373'	322340	003546'		JUMPE T2,[AOJA T4,PROOR1]
  1076	001374'	137340	003544'		DPB T2,[POINT 8,ORING(T4),BYP2]
  1077	001375'	260040	000771'		PUSHJ P,LWFOR		;Load Word From ORing(T4) into t2
  1078	001376'	260040	000750'		PUSHJ P,DWIIR
  1079	001377'	254000	001110'		 JRST ORDONE
  1080	001400'	344440	000777'		AOJA T4,PROOR1
  1081
  1082	001401'	135340	003544'	P.YELL:	LDB T2,[POINT 8,ORING(T4),BYP2]
  1083	001402'	135400	003516'		LDB T3,LCTYP
  1084	001403'	306400	000002		CAIN T3,LT.AUX
  1085	001404'	254000	001372'		 JRST SOA
  1086	001405'	260040	000771'		PUSHJ P,LWFOR		;Load Word From ORing(T4) into t2
  1087	001406'	661340	002000		TLO T2,(<BYTE (8) 1>)	;Yellow ball reflects as an orange ball.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 5-2
DZKON.MAC	30-OCT-87 17:11		DSB

  1088	001407'	260040	000750'	RSPOUT:	PUSHJ P,DWIIR
  1089	001410'	344440	000777'		 AOJA T4,PROOR1
  1090	001411'	344440	000777'		AOJA T4,PROOR1
  1091
  1092	001412'	135340	003544'	P.CZ:	LDB T2,[POINT 8,ORING(T4),BYP2]	;Circuit zapper.
  1093	001413'	135400	003516'		LDB T3,LCTYP
  1094	001414'	302400	000002		CAIE T3,LT.AUX
  1095	001415'	254000	001430'		 JRST P.CZ1		;Not Aux port.
  1096	001416'	135300	003520'		LDB T1,LCAUX		;Send on circuit zapper if anyone's at
  1097	001417'	322300	003546'		JUMPE T1,[AOJA T4,PROOR1]	; the other end.
  1098	001420'	260040	000771'		PUSHJ P,LWFOR		;Load Word From ORing(T4) into t2
  1099	001421'	137300	003535'		DPB T1,[POINT 8,T2,15]
  1100	001422'	260040	000750'		PUSHJ P,DWIIR
  1101	001423'	254000	001110'		 JRST ORDONE
  1102	001424'	400300	000000		SETZ T1,
  1103	001425'	135340	003544'		LDB T2,[POINT 8,ORING(T4),BYP2]
  1104	001426'	137307	003520'		DPB T1,LCAUX(T2)	;No longer connected to anything.
  1105	001427'	344440	000777'		AOJA T4,PROOR1
  1106	001430'	205300	020000	P.CZ1:	MOVSI T1,LCREM
  1107	001431'	612307	003441'		TDNE T1,LINCHR(T2)	;Is this a remote line?
  1108	001432'	254000	001443'		 JRST P.CZ2		;Yes, go hang it up.
  1109	001433'	200307	002175'		MOVE T1,LINCOU(T2)	;Count of free space in output ring.
  1110	001434'	305300	000004		CAIGE T1,4
  1111	001435'	254000	001110'		 JRST ORDONE		;Not enough for message, hope it frees up.
  1112	001436'	201300	000003		MOVEI T1,IS.BD		;Enter baud detect mode.
  1113	001437'	137300	003514'		DPB T1,LCIS
  1114	001440'	205300	200000		MOVSI T1,LCLGI
  1115	001441'	412307	003441'		ANDCAM T1,LINCHR(T2)
  1116	001442'	344440	000777'		AOJA T4,PROOR1
  1117	001443'	205300	010000	P.CZ2:	MOVSI T1,LCCAR		;Do nothing if line not now connected.
  1118	001444'	616307	003441'		TDNN T1,LINCHR(T2)
  1119	001445'	344440	000777'		 AOJA T4,PROOR1
  1120	001446'	260040	000720'		CALL HANGLN
  1121	001447'	135300	003560'		LDB T1,[30300,,T2]
  1122	001450'	200306	002124'		MOVE T1,DZBATB(T1)	;DZ-11 base address.
  1123	001451'	405340	000007		ANDI T2,7
  1124	001452'	200407	000010*		MOVE T3,TIBTBL+8(T2)
  1125	001453'	715406	000004		BCIO T3,TCROFS(T1)	;Clear DTR.
  1126	001454'	344440	000777'		AOJA T4,PROOR1
  1127
  1128	001455'	135340	003544'	P.CG:	LDB T2,[POINT 8,ORING(T4),BYP2]	;Character gobbler.
  1129	001456'	135400	003516'		LDB T3,LCTYP
  1130	001457'	306400	000002		CAIN T3,LT.AUX
  1131	001460'	254000	001372'		 JRST SOA
  1132	001461'	260040	000725'		CALL FLUBUF		;Flush buffers.
  1133	001462'	344440	000777'		AOJA T4,PROOR1
  1134
  1135	001463'	000000	000000	SUPBF:	0
  1136	001464'	000000	000000	AXSTRP:	0
  1137	001465'			AXSTR:	BLOCK 3
  1138	001470'	000000	000000	AXCNT:	0
  1139	001471'	000000	000000	AXNUM:	0
  1140	001472'	000000	000000	DZLOCK:	0
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6
DZKON.MAC	30-OCT-87 17:11		DSB

  1141				;Initialization.  This code assumes the PI system is off.
  1142	001473'	336000	000000*	DZINI::	SKIPN DZDO##
  1143	001474'	263040	000000		 RET
  1144	001475'	200300	002124'		MOVE	T1,DZBATB	;Address of first DZ11
  1145	001476'	260040	000000*		PUSHJ	P,UBGOOD##	;Is it plugged in?
  1146					  JRST	[SETZM DZDO	  ;Nonexistant device
  1147	001477'	254000	003561'			 RET]
  1148	001500'	476000	001472'		SETOM DZLOCK
  1149	001501'	476000	001463'		SETOM SUPBF		;Simulated supervisor not busy.
  1150	001502'	205300	255000		MOVSI T1,(<JFCL>)
  1151	001503'	202300	000000*		MOVEM T1,KEYSET		;Turn off base communications.
  1152				;Cons interrupt handling routines onto front of interrupt chains.
  1153	001504'	200300	003563'		MOVE T1,[JRST PERINT]	;PERINT
  1154	001505'	250300	000001*		EXCH T1,CH6+1
  1155	001506'	200300	003564'		MOVE T1,[JEN @CH6];;;;;;;OVERRIDE LINK INCASE CH WAS UNUSED
  1156							  ;;;;;;;THIS CUTS OFF ANY PREVIOUS CH6 ROUTINES
  1157	001507'	202300	000065'		MOVEM T1,PERINT+1
  1158	001510'	200300	003565'		MOVE T1,[JRST CONINT]	;CONINT
  1159	001511'	250300	000001*		EXCH T1,CH6+1
  1160	001512'	202300	000270'		MOVEM T1,CONINT+1
  1161	001513'	200300	003566'		MOVE T1,[JRST DZPINT]	;DZPINT
  1162	001514'	250300	000001*		EXCH T1,CH7+1
  1163	001515'	202300	000020'		MOVEM T1,DZPINT+1
  1164				;Setup DZ-11 interrupt vector addresses in DZUBA's table.
  1165	001516'	205340	777776		MOVSI T2,-DZNUM*2
  1166	001517'	554407	002130'	DZINIA:	HLRZ T3,DZVECT(T2)
  1167	001520'	270400	000103*		ADD T3,EPT+100+DZUBA
  1168	001521'	550307	002130'		HRRZ T1,DZVECT(T2)
  1169	001522'	505300	264000		HRLI T1,(<JSR>)
  1170	001523'	202310	000000		MOVEM T1,(T3)
  1171	001524'	253340	001517'		AOBJN T2,DZINIA
  1172	001525'	200300	003512'		MOVE T1,ILCHR		;Init status of all lines.
  1173	001526'	200340	003567'		MOVE T2,[LINCHR,,LINCHR+1]
  1174	001527'	202307	777777		MOVEM T1,-1(T2)
  1175	001530'	251340	003511'		BLT T2,LINCHR+NLINES-1
  1176	001531'	200300	003513'		MOVE T1,ICCHR
  1177	001532'	202300	003451'		MOVEM T1,LINCHR+CTYLIN
  1178				;Adjust tables to reflect system DZ-11 configuration.
  1179	001533'	205300	777770		MOVSI T1,-NCDLIN	;Get number of preconfigured ports.
  1180	001534'	135340	000013'	DZINI0:	LDB T2,DCTDN		;Get port number to configure.
  1181	001535'	135400	000014'		LDB T3,DCTLN
  1182	001536'	242340	000003		LSH T2,3
  1183	001537'	660350	000000		TRO T2,(T3)
  1184	001540'	135400	000015'		LDB T3,DCTSPE		;Speed.
  1185	001541'	137400	003521'		DPB T3,LCSPE
  1186	001542'	135400	000016'		LDB T3,DCTFIL		;Fill characters to send after a CR.
  1187	001543'	137400	003517'		DPB T3,LCFIL
  1188	001544'	205400	020000		MOVSI T3,LCREM		;Remote or local.
  1189	001545'	335006	000003'		SKIPGE DCTABL(T1)
  1190	001546'	436407	003441'		 IORM T3,LINCHR(T2)
  1191	001547'	201400	000001		MOVEI T3,LT.DZ
  1192	001550'	137400	003516'		DPB T3,LCTYP
  1193	001551'	253300	001534'		AOBJN T1,DZINI0
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-2
DZKON.MAC	30-OCT-87 17:11		DSB

  1194
  1195				;Set up DZ-11 status for each DZ-11 in the system.
  1196	001552'	205340	777777		MOVSI T2,-DZNUM
  1197	001553'	200407	002124'	DZINI4:	MOVE T3,DZBATB(T2)
  1198	001554'	201300	000020		MOVEI T1,CSRCLR		;Clear the DZ-11.
  1199	001555'	714310	000000		BSIO T1,CSROFS(T3)
  1200	001556'	710310	000000		TIOE T1,CSROFS(T3)	;Wait until it's clear
  1201	001557'	254000	001556'		 JRST .-1
  1202				    ;Enable for Silo Full and transmitter ready interrupts.
  1203				    ;Enable master scan.
  1204	001560'	201300	050140		MOVEI T1,CSRMSE+CSRRIE+CSRSAE+CSRTIE
  1205	001561'	713310	000000		WRIO T1,CSROFS(T3)
  1206	001562'	253340	001553'		AOBJN T2,DZINI4
  1207
  1208				;Now set up the DZ-11 line parameter registers for DZ-11 lines,
  1209				; and send the login message to all local terminals.
  1210	001563'	205340	777767		MOVSI T2,-NDZLIN-1
  1211	001564'	135300	003516'	DZINI1:	LDB T1,LCTYP
  1212	001565'	200407	002152'		MOVE T3,LINOT(T2)	;Initially the output ring buffer is empty.
  1213	001566'	202407	002141'		MOVEM T3,LINOP(T2)
  1214	001567'	201400	000377		MOVEI T3,NOBIOB
  1215	001570'	202407	002175'		MOVEM T3,LINCOU(T2)
  1216	001571'	306300	000003		CAIN T1,LT.UNU		;Unused line?
  1217	001572'	254000	001617'		 JRST DZINI3		;Yes, nothing more to do.
  1218	001573'	302300	000001		CAIE T1,LT.DZ
  1219	001574'	254000	001615'		 JRST DZINI2		;Type greeting if CTY.
  1220				    ;Now set the line parameter register for DZ-11 lines.
  1221	001575'	550440	000007		HRRZ T4,T2
  1222	001576'	241440	777775		ROT T4,-3
  1223	001577'	200411	002124'		MOVE T3,DZBATB(T4)
  1224	001600'	242440	777737		LSH T4,-41
  1225	001601'	660440	010030		TRO T4,LPRRO+3*LPRCLA
  1226	001602'	135300	003521'		LDB T1,LCSPE		;Get desired speed.
  1227	001603'	306300	000002		CAIN T1,2		;Use 2 stop bits for 110 baud, 1 for others.
  1228	001604'	660440	000040		 TRO T4,LPRSC
  1229	001605'	137300	003570'		DPB T1,[100400,,T4]
  1230	001606'	713450	000002		WRIO T4,LPROFS(T3)
  1231				    ;Turn on DTR.  Some local terminals require it.
  1232	001607'	405440	000007		ANDI T4,7		;Get back line number.
  1233	001610'	200311	000010*		MOVE T1,TIBTBL+8(T4)
  1234	001611'	714310	000004		BSIO T1,TCROFS(T3)
  1235	001612'	205300	020000		MOVSI T1,LCREM
  1236	001613'	612307	003441'		TDNE T1,LINCHR(T2)
  1237	001614'	254000	001617'		 JRST DZINI3
  1238	001615'	201300	000003	DZINI2:	MOVEI T1,IS.BD		;Enter baud rate detect mode.
  1239	001616'	137300	003514'		DPB T1,LCIS
  1240	001617'	253340	001564'	DZINI3:	AOBJN T2,DZINI1
  1241	001620'	263040	000000		RET
  1242
  1243				;Shut down all DZ-11s.
  1244	001621'	205440	777777	DZREM::	MOVSI T4,-DZNUM
  1245	001622'	200411	002124'	DZREM1:	MOVE T3,DZBATB(T4)
  1246	001623'	201340	000020		MOVEI T2,CSRCLR		;Clear CSR
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-3
DZKON.MAC	30-OCT-87 17:11		DSB

  1247	001624'	713350	000000		WRIO T2,CSROFS(T3)
  1248	001625'	400340	000000		SETZ T2,
  1249	001626'	713350	000004		WRIO T2,TCROFS(T3)	;Clear modems
  1250	001627'	253440	001622'		AOBJN T4,DZREM1
  1251	001630'	263040	000000		RET
  1252
  1253				;Start typing login greeting.
  1254	001631'	201300	000400	TYPGRE:	MOVEI T1,400		;High, low 8 bits of count.
  1255	001632'	260040	000474'		CALL ORIDPB
  1256	001633'	550300	002122'		HRRZ T1,LIMBC
  1257	001634'	260040	000474'		CALL ORIDPB
  1258	001635'	550300	002123'		HRRZ T1,LIMBP
  1259	001636'	241300	777767		ROT T1,-9		;High, low 9 bits of address.
  1260	001637'	261040	000006		PUSH P,T1
  1261	001640'	260040	000474'		CALL ORIDPB
  1262	001641'	262040	000006		POP P,T1
  1263	001642'	241300	000011		ROT T1,9
  1264	001643'	260040	000474'		CALL ORIDPB
  1265	001644'	261040	000007		PUSH P,T2
  1266	001645'	260040	001650'		CALL STOUT		;Start message out.
  1267	001646'	262040	000007		POP P,T2
  1268	001647'	263040	000000		RET
  1269
  1270				;Start output on line in T2.  Destroys T2, T1.
  1271	001650'	553000	000007	STOUT:	HRRZS T2
  1272	001651'	135400	003515'		LDB T3,LCOS
  1273	001652'	201300	000001		MOVEI T1,OS.ORB		;Set to examine output ring.
  1274	001653'	306400	000000		CAIN T3,OS.IDL		;If it is now idle.
  1275	001654'	137300	003515'		 DPB T1,LCOS
  1276	001655'	205300	100000		MOVSI T1,LCACT		;Output already going?
  1277	001656'	612307	003441'		TDNE T1,LINCHR(T2)
  1278	001657'	263040	000000		 RET			;Y, Xmit done will continue.
  1279	001660'	436307	003441'		IORM T1,LINCHR(T2)
  1280	001661'	135300	003516'		LDB T1,LCTYP
  1281	001662'	254026	003571'		JRST @[EXP STCTY,STDZ,STFOO,STFOO](T1)
  1282	001663'	350000	001700'	STCTY:	AOS TTACT		;One more active line.
  1283	001664'	254000	000320'		JRST CTYODN		;Pretend output done.
  1284	001665'	350000	001700'	STDZ:	AOS TTACT
  1285	001666'	254000	001077'		JRST SDLE		;Set Dz-11 line enable and let I-level start.
  1286	001667'	263040	000000	STFOO:	RET
  1287
  1288	001670'	000000	000000	PERFLG:	0	;Set this flag and give Ch6 interrupt when need periodic action
  1289						;The next four flags tell PERINT what to do:
  1290	001671'	000000	000000	SOTFLG:	0	;Check the output ring.
  1291	001672'	000000	000000	CARFLG:	0	;Poll the state of the carrier bits on all dial in lines.
  1292	001673'	000000	000000	SILFLG:	0	;Empty the silos on all Dz-11s.
  1293	001674'	000000	000000	DEFLG:	0	;See if lines can enter deferred echo mode.
  1294	001675'	000000	000000	DZINF::	0	;Set DZINF and give CH6 interrupt when CTY UART ready/done.
  1295	001676'	000000	000000	CTOPNT:	0	;OUTPUT POINTER
  1296	001677'	000000	000000	CTOCNT:	0	;AND COUNT
  1297	001700'	000000	000000	TTACT:	0	;-1 if CTY or DZ11 output is in progress, 0 otherwise.
  1298	001701'	000000	000000	NEI:	0	;Number of error indications by DZ-11 on reception.
  1299	001702'	000000	000000	NLIC:	0	;Number of input characters which had to be discarded because
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-4
DZKON.MAC	30-OCT-87 17:11		DSB

  1300						; of insufficient space in the input ring.
  1301	001703'	000000	000000	TBNCC:	0	;Ticks before next check for carrier lost.
  1302	001704'	000000	000000	TBNSC:	0	;Ticks before next silo check.
  1303	001705'	000000	000000	TBNDEC:	0	;Ticks before next deferred echo check.
  1304
  1305				;Space to save all Acs and new stack.
  1306				DEFINE SAVEAREAS(NAME)<
  1307				IRP NAME,<
  1308				NAME'SV:BLOCK 20
  1309				NAME'TBV:BLOCK 2
  1310				NAME'PDP:-20,,.
  1311					BLOCK 20>>
  1312
  1313	001730'	777760	001730'	SAVEAREAS <DZP,PER,DZ,CON>
  1314	001773'	777760	001773'
  1315	002036'	777760	002036'
  1316	002101'	777760	002101'
  1317
  1318				;Login message.
  1319	002122'			LIM:
  1320	002122'	000000	000051	LIMBC:	51			;Number of bytes in the message
  1321				LIMBP:	440700,,[ASCIZ/
  1322	002123'	440700	003575'	Hi there!  Please type your user name: /]
  1323
  1324				;Base addresses of the DZ11s on the system.  The code makes a lot of
  1325				; assumptions about the strcture of the sequence.
  1326			000003	DZUBA==3
  1327			760010	DZ0BAS==760010
  1328			760020	DZ1BAS==760020
  1329			760030	DZ2BAS==760030
  1330			760040	DZ3BAS==760040
  1331	002124'	000003	760010	DZBATB:	DZUBA,,DZ0BAS
  1332	002125'	000003	760020		DZUBA,,DZ1BAS
  1333	002126'	000003	760030		DZUBA,,DZ2BAS
  1334	002127'	000003	760040		DZUBA,,DZ3BAS
  1335
  1336				;Addresses of offset of DZ-11 vectors into vector table.
  1337				;The same interrupt routine handles both silo full and
  1338				; transmitter ready interrupts.
  1339	002130'	000070	000200'	DZVECT:	70,,DZ0INT
  1340	002131'	000071	000200'		71,,DZ0INT
  1341	002132'	000072	000204'		72,,DZ1INT
  1342	002133'	000073	000204'		73,,DZ1INT
  1343	002134'	000074	000210'		74,,DZ2INT
  1344	002135'	000075	000210'		75,,DZ2INT
  1345	002136'	000076	000214'		76,,DZ3INT
  1346	002137'	000077	000214'		77,,DZ3INT
  1347
  1348				;Configuration information.
  1349			000040	NAUXCP==40			;Number of Auxiliary Circuit ports.
  1350			000011	FAUXCP==CTYLIN+1		;Port number of first Auxiliary Circuit port.
  1351			000010	NDZLIN==DZNUM*8			;Number of DZ-11 lines on the system.
  1352			000010	CTYLIN==NDZLIN			;Line number of the CTY.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-5
DZKON.MAC	30-OCT-87 17:11		DSB

  1353			000100	ORBSIZ==100			;Number of words in the output rings.
  1354			000377	NOBIOB==4*ORBSIZ-1		;Number of usable bytes per output ring.
  1355			000051	NLINES==NDZLIN+1+NAUXCP
  1356
  1357	002140'	777740	003452'	AUXCPT:	-NAUXCP,,LINCHR+FAUXCP
  1358
  1359
  1360				DEFINE LOOP(START,EXPRESSION) <
  1361				ZZ==0
  1362				REPEAT NDZLIN+1,<
  1363					<START>+<ZZ*ORBSIZ>+<EXPRESSION>
  1364				ZZ==ZZ+1
  1365				>>
  1366
  1367				;Output ring buffers, one per DZ-11 line and one for the CTY.
  1368				;Data is stored as 9 bit bytes.  If the high order bit is off, the rest of
  1369				; the byte is a character to send to the line; otherwise, this byte and
  1370				; the next 4 specify a block mode output request: bytes 1,2: byte count;
  1371				; bytes 3-5: address.
  1372	002141'	001100	002205'	LINOP:	LOOP(LINORS-1,<001100,,>)
  1373	002142'	001100	002305'
  1374	002143'	001100	002405'
  1375	002144'	001100	002505'
  1376	002145'	001100	002605'
  1377	002146'	001100	002705'
  1378	002147'	001100	003005'
  1379	002150'	001100	003105'
  1380	002151'	001100	003205'
  1381					;Output putter
  1382	002152'	001100	002205'	LINOT:	LOOP(LINORS-1,<001100,,>)
  1383	002153'	001100	002305'
  1384	002154'	001100	002405'
  1385	002155'	001100	002505'
  1386	002156'	001100	002605'
  1387	002157'	001100	002705'
  1388	002160'	001100	003005'
  1389	002161'	001100	003105'
  1390	002162'	001100	003205'
  1391					;Output taker
  1392	002163'	001100	002205'		001100,,LINORS-1
  1393	002164'	001100	002305'	LINTOR:	LOOP(LINORS-1+ORBSIZ,<001100,,>)
  1394	002165'	001100	002405'
  1395	002166'	001100	002505'
  1396	002167'	001100	002605'
  1397	002170'	001100	002705'
  1398	002171'	001100	003005'
  1399	002172'	001100	003105'
  1400	002173'	001100	003205'
  1401	002174'	001100	003305'
  1402					;Pointer to first byte above this
  1403								; buffer.  This table, indexed by line
  1404								; number - 1 also gives the start of that
  1405								; line's buffer.
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-6
DZKON.MAC	30-OCT-87 17:11		DSB

  1406	002175'			LINCOU:	REPEAT NDZLIN+1,<NOBIOB>	;Number of free bytes in the buffer
  1407	002175'	000000	000377
  1408	002176'	000000	000377
  1409	002177'	000000	000377
  1410	002200'	000000	000377
  1411	002201'	000000	000377
  1412	002202'	000000	000377
  1413	002203'	000000	000377
  1414	002204'	000000	000377
  1415	002205'	000000	000377
  1416	002206'			LINORS:	BLOCK <NDZLIN+1>*ORBSIZ	;The buffers themselves
  1417
  1418				;Variables for block mode output
  1419	003306'			LINV1:	BLOCK NLINES
  1420	003357'			LINV2:	BLOCK NLINES
  1421
  1422				;Variables used when sending fill characters.  Lh: state to revert to
  1423				; when fill character transmission finished. Rh: # of fill characters
  1424				; yet to be sent.
  1425	003430'			LINFCR:	BLOCK NDZLIN+1
  1426				;Line characteristics table and byte pointers.
  1427				;Note that all fields are orthogonal as far as storage is concerned.
  1428	003441'			LINCHR:	BLOCK NLINES
  1429					;Initial line characteristics word for all ports except the CTY.
  1430	003512'	000006	000242	ILCHR:	<BYTE (9) 0 (3) IS.IDL (3) OS.IDL (2) LT.UNU (10) 0 (4) 5>+LCDE
  1431					;Initial line characteristics for CTY.
  1432	003513'	000000	000002	ICCHR:	<BYTE (9) 0 (3) IS.IDL (3) OS.IDL (2) LT.CTY (10) 0 (4) 0>+LCDE
  1433				;Byte pointers are set up assuming the port number will be in T2.
  1434			400000	LCDO==1B<18+0>	;One bit which is set iff output to this port should be
  1435						; discarded.
  1436			200000	LCLGI==1B<18+1>	;One bit which is set iff the port has logged in, clear ow.
  1437			100000	LCACT==1B<18+2>	;(DZ,CTY) One bit which is set iff we expect a transmitter
  1438						; done interrupt for the line.  On Dz-11s, this is just
  1439						; when the line enable bit is set for the line.
  1440			020000	LCREM==1B<18+4>	;(DZ) One bit set iff this DZ-11 line is a dial-in.
  1441			010000	LCCAR==1B<18+5>	;(DZ) One bit set iff last timewet checked this DZ-11 line
  1442			000002	LCDE==1B34	;One bit set iff input echoing mode is "deferred."
  1443			000001	LCOH==1B35	;One bit set iff output is being held for this lin.
  1444						; had its carrier detect bit on.
  1445	003514'	300307	003441'	LCIS:	POINT 3,LINCHR(T2),11
  1446					;input state of line
  1447			000003		IS.BD==3	;Baud detection going on.
  1448			000002		IS.ESC==2	;Escape character (^Z) was the last character input.
  1449			000001		IS.LGI==1	;Accepting part of login string we must echo.
  1450			000000		IS.IDL==0	;Idle.
  1451	003515'	250307	003441'	LCOS:	POINT 3,LINCHR(T2),14
  1452					;output state of line
  1453			000000		OS.IDL==0	;Idle
  1454			000001		OS.ORB==1	;Outputting from the line's ring buffer.
  1455			000002		OS.OP==2	;Outputting from a block output type pointer.
  1456							;Send block mode output finished message to base
  1457							; when finished.
  1458							;Additional variables in:
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-7
DZKON.MAC	30-OCT-87 17:11		DSB

  1459							; LINV1, # bytes left; LINV2: address.
  1460			000003		OS.FIL==3	;Sending fill characters.
  1461			000004		OS.BMD==4	;Block output finished, must send message to host.
  1462			000005		OS.LGI==5	;Outputting from a block output type pointer,
  1463							; send no message to the base when finished.
  1464			000006		OS.HU==6	;DTR turned off, waiting for carrier to go off too.
  1465	003516'	230207	003441'	LCTYP:	POINT 2,LINCHR(T2),16
  1466					;pointer to line type:  0, CTY; 1, DZ-11; 2, Aux circuit; 3, Unused.
  1467					;code assumes LT.CTY < LT.DZ < LT.AUX < LT.UNU
  1468			000000		LT.CTY==0	;This is the CTY
  1469			000001		LT.DZ==1	;DZ-11 line
  1470			000002		LT.AUX==2	;Auxiliary Circuit port
  1471			000003		LT.UNU==3	;Line not connected
  1472	003517'	170407	003441'	LCFIL:	POINT 4,LINCHR(T2),20
  1473					;(-AUX) Number of fill characters to output after CR.
  1474	003520'	110607	003441'	LCAUX:	POINT 6,LINCHR(T2),26
  1475					;(AUX) Line number of line on other end of this aux circuit, if any.
  1476	003521'	050407	003441'	LCSPE:	POINT 4,LINCHR(T2),30
  1477					;(DZ) Speed of line.
  1478				;Free: 9 bits.
  1479
  1480	003522'	100300	000006		$END	(DZK)

  1481	003523'	100100	000006

  1482	003524'	000000	000005

  1483	003525'	000000	000002

  1484	003526'	000000	440700

  1485	003527'	000000	001100

  1486	003530'	221107	003357'

  1487	003531'	000000	001112'

  1488	003532'	000000	001120'

  1489	003533'	000000	001126'

  1490	003534'	000000	001126'

  1491	003535'	241000	000007

  1492	003536'	100400	000010

  1493	003537'	404000	140260

  1494	003540'	056000	000000

  1495	003541'	141000	000007

DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-8
DZKON.MAC	30-OCT-87 17:11		DSB

  1496	003542'	050200	000006

  1497	003543'	321011	001071*

  1498	003544'	221011	003543*

  1499	003545'	041000	000007

  1500	003546'	344440	000777'

  1501	003547'	777777	000777*

  1502	003550'	440700	001465'

  1503	003551'	002000	010000

  1504	003552'	100711	003544*

  1505	003553'	260700	000000*

  1506	003554'	170700	003553*

  1507	003555'	241000	000010

  1508	003556'	141000	000010

  1509	003557'	056000	040000

  1510	003560'	030300	000007

  1511	003561'	402000	001473*

  1512	003562'	263040	000000

  1513	003563'	254000	000064'

  1514	003564'	254520	000000*

  1515	003565'	254000	000267'

  1516	003566'	254000	000017'

  1517	003567'	003441'	003442'

  1518	003570'	100400	000011

  1519	003571'	000000	001663'

  1520	003572'	000000	001665'

  1521	003573'	000000	001667'

  1522	003574'	000000	001667'
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 6-9
DZKON.MAC	30-OCT-87 17:11		DSB


  1523	003575'	064251	064500

  1524	003576'	723214	571312

  1525	003577'	205004	050330

  1526	003600'	627036	362500

  1527	003601'	723636	062500

  1528	003602'	747376	571100

  1529	003603'	727474	571100

  1530	003604'	673035	562564

  1531	003605'	200000	000000

  1532						;End of DZKON  (DZKLIT: DZKEND:)
  1533
NO ERRORS DETECTED
PROGRAM BREAK IS 003607
7K CORE USED
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 7
DZKON.MAC	30-OCT-87 17:11		SYMBOL TABLE

ADJSP	105000	000000		CTYIDN		000504'		DZREM		001621'	INT	LI.CPP		020000	SPD
APRCHN		000000	EXT	CTYIVL		000400	SPD	DZREM1		001622'		LI.REQ		004000	SPD
AUXCPT		002140'		CTYIWD		000303'	EXT	DZRI		000253'		LIM		002122'	
AXCNT		001470'		CTYLIN		000010	SPD	DZSV		002014'		LIMBC		002122'	
AXNUM		001471'		CTYOCH		000377	SPD	DZTBV		002034'		LIMBP		002123'	
AXSTR		001465'		CTYODN		000320'		DZUBA		000003	SPD	LINCHR		003441'	
AXSTRP		001464'		CTYOVL		000400	SPD	DZVECT		002130'		LINCOU		002175'	
BCIO	715000	000000		CTYOWD		001114'	EXT	DZXI		000247'		LINFCR		003430'	
BD1		000540'		DCTABL		000003'		ECHO		000522'		LINOP		002141'	
BD2		000547'		DCTDN		000013'		EPT		000000	EXT	LINORS		002206'	
BD3		000560'		DCTFIL		000016'		FAUXCP		000011	SPD	LINOT		002152'	
BIT		100000	SPD	DCTLN		000014'		FB1		000727'		LINTOR		002164'	
BITTBL		000625'	EXT	DCTSPE		000015'		FILDON		000341'		LINV1		003306'	
BSIO	714000	000000		DEFLG		001674'		FLUBUF		000725'		LINV2		003357'	
BYP1		000011	SPD	DIE		000000'	EXT	GETPR1		001346'		LP.I8C		002000	SPD
BYP2		000021	SPD	DWIIR		000750'		GETPRC		001354'		LP.SSF		010000	SPD
BYP3		000033	SPD	DZ0BAS		760010	SPD	GETPRT		001345'		LPRCLA		000010	SPD
BYP4		000043	SPD	DZ0INT		000200'	INT	HANGLN		000720'		LPRCLB		000020	SPD
CALL	260040	000000		DZ1BAS		760020	SPD	HNGUP		000740'		LPRFA		000400	SPD
CARFLG		001672'		DZ1INT		000204'	INT	I.BD		000534'		LPRFB		001000	SPD
CDPIOR		001067'		DZ2BAS		760030	SPD	I.ESC		000650'		LPRFC		002000	SPD
CET		000632'		DZ2INT		000210'	INT	I.IDL		000602'		LPRFD		004000	SPD
CFOIL		001032'		DZ3BAS		760040	SPD	I.LGI		000513'		LPRLA		000001	SPD
CFOIL1		001050'		DZ3INT		000214'	INT	ICCHR		003513'		LPRLB		000002	SPD
CFOIL2		001045'		DZBATB		002124'		ID1		000605'		LPRLC		000004	SPD
CH6		003564'	EXT	DZBRK		000654'		IDSE		000735'		LPROFS		000002	SPD
CH7		000000	EXT	DZBRK1		000673'		ILCHR		003512'		LPROP		000200	SPD
CIRFS		001356'		DZDIS		000241'		ILGI1		000531'		LPRPE		000100	SPD
CONFIG		003554'	EXT	DZDO		003561'	EXT	INPDON		000505'		LPRRO		010000	SPD
CONINT		000267'	INT	DZINF		001675'	INT	INPEC1		000636'		LPRSC		000040	SPD
CONODP		000307'		DZINI		001473'	ENT	INPECH		000617'		LT.AUX		000002	SPD
CONPDP		002101'		DZINI0		001534'		IRING		000764'	EXT	LT.CTY		000000	SPD
CONSV		002057'		DZINI1		001564'		IRP620		001357'	EXT	LT.DZ		000001	SPD
CONTBV		002077'		DZINI2		001615'		IRPPDP		001356'	EXT	LT.UNU		000003	SPD
CPOPJ		001360'	EXT	DZINI3		001617'		IS.BD		000003	SPD	LWFOR		000771'	
CPOPJ1		000473'	EXT	DZINI4		001553'		IS.ESC		000002	SPD	MAXDZ		000004	SPD
CSR		000400	SPD	DZINIA		001517'		IS.IDL		000000	SPD	MSKIRG		000752'	EXT
CSRCLR		000020	SPD	DZINT		000220'		IS.LGI		000001	SPD	MSKORG		003547'	EXT
CSRMAI		000010	SPD	DZKEND		003606'	INT	ITDDI		000246'		MSROFS		000006	SPD
CSRMSE		000040	SPD	DZKLIT		003522'	INT	KEYSET		001503'	EXT	NAUXCP		000040	SPD
CSROFS		000000	SPD	DZKON		000000'	ENT	LCACT		100000	SPD	NCDLIN		000010	SPD
CSRRDO		000200	SPD	DZLOCK		001472'		LCAUX		003520'		NDZLIN		000010	SPD
CSRRIE		000100	SPD	DZNUM		000001	SPD	LCCAR		010000	SPD	NEI		001701'	
CSRSA		020000	SPD	DZPDP		002036'		LCDE		000002	SPD	NLIC		001702'	
CSRSAE		010000	SPD	DZPINT		000017'	INT	LCDO		400000	SPD	NLINES		000051	SPD
CSRTIE		040000	SPD	DZPLK2		000034'		LCFIL		003517'		NOBIOB		000377	SPD
CSRTRD		100000	SPD	DZPLK3		000042'		LCIS		003514'		NODIE		000000	EXT
CTOCNT		001677'		DZPLK4		000050'		LCLGI		200000	SPD	NRCTLP		000001	SPD
CTOPNT		001676'		DZPLK5		000050'		LCOH		000001	SPD	O.AUX		001016'	
CTOSPC		001130'		DZPLK6		000056'		LCOS		003515'		O.BMOD		000440'	
CTRLO		000723'		DZPPDP		001730'		LCREM		020000	SPD	O.CTY		001060'	
CTRLQ		000707'		DZPSV		001706'		LCSPE		003521'		O.DZ		001060'	
CTRLS		000676'		DZPTBV		001726'		LCTYP		003516'		O.FIL		000334'	
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88 PAGE 7-2
DZKON.MAC	30-OCT-87 17:11		SYMBOL TABLE

O.FOO		000333'		PER4		000164'		SZODS		000043	SPD	
O.HU		000413'		PER41		000167'		T1		000006	INT	
O.IDL		000413'		PER42		000167'		T2		000007	INT	
O.RNG		000344'		PER5		000170'		T3		000010	INT	
O.STR		000374'		PERFLG		001670'		T4		000011	INT	
OD.CTY		000446'		PERINT		000064'	INT	TBCC		000170	SPD	
OD.DZ		000452'		PERPDP		001773'		TBDEC		000264	SPD	
OD.FOO		000451'		PERSV		001751'		TBNCC		001703'		
ODTBL		000426'		PERTBV		001771'		TBNDEC		001705'		
ORBSIZ		000100	SPD	PROOR		000776'		TBNSC		001704'		
ORDONE		001110'		PROOR1		000777'		TBSC		000020	SPD	
ORIDPB		000474'		RBUDV		100000	SPD	TCROFS		000004	SPD	
ORILDB		000463'		RBUFE		020000	SPD	TDROFS		000006	SPD	
ORING		003552'	EXT	RBUOFS		000002	SPD	TIBTBL		001105'	EXT	
ORP620		001110'	EXT	RBUOVE		040000	SPD	TIOE	710000	000000		
ORPPDP		001000'	EXT	RBUPE		010000	SPD	TTACT		001700'		
OS.BMD		000004	SPD	RCTLPR		000546'		TYPGRE		001631'		
OS.FIL		000003	SPD	RDIO	712000	000000		UBGOOD		001476'	EXT	
OS.HU		000006	SPD	RDTIME	702200	000000		UUIDPB	102000	000000		
OS.IDL		000000	SPD	REST	262040	000000		UUILDB	101000	000000		
OS.LGI		000005	SPD	RET	263040	000000		WRAPR	700200	000000		
OS.OP		000002	SPD	RSPOUT		001407'		WRIO	713000	000000		
OS.ORB		000001	SPD	S$ENTR	777777	777775	SIN	WRPI	700600	000000		
OUTDO0		000322'		S$HALT	777777	777777	SIN	WRTIME	702600	000000		
OUTDO1		000415'		S$NAME		000000'	SPD	ZZ		000011	SPD	
OUTDO2		000432'		S$NONA		000000	SIN	
OUTDON		000321'		S$TEMP		000000	SPD	
P		000001	INT	S$XCT	777777	777776	SIN	
P.BOFF		001366'		SAVE	261040	000000		
P.BON		001366'		SAVT1		001127'		
P.CG		001455'		SDLE		001077'		
P.CZ		001412'		SILFLG		001673'		
P.CZ1		001430'		SKPDPK		001053'		
P.CZ2		001443'		SKT3		001052'		
P.ORAN		001366'		SNDBYT		000377'		
P.SLC		001211'		SNDCTY		001112'		
P.SLC1		001224'		SNDDZ		001120'		
P.SLC2		001226'		SNDFOO		001126'		
P.SLC3		001236'		SOA		001372'		
P.SR		001174'		SOAOR		001366'		
P.YELL		001401'		SOTFLG		001671'		
P1		000014	INT	STCTY		001663'		
P2		000015	INT	STDZ		001665'		
P3		000016	INT	STFOO		001667'		
P4		000017	INT	STOUT		001650'		
PER2		000101'		STRLP		001317'		
PER21		000105'		STRLP2		001333'		
PER22		000110'		STRLP3		001330'		
PER22A		000130'		SUPBF		001463'		
PER23		000140'		SUPBSY		001206'		
PER24		000154'		SUPSWP		001335'		
PER3		000156'		SUPSYW		001336'		

DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

APRCHN	   140%	   832
AUXCPT	  1046	  1357#
AXCNT	   936	   953	   977	  1138#
AXNUM	   937	   949	   957	   963	   966	   974	  1139#
AXSTR	   933	  1016	  1137#
AXSTRP	   934	   954	   983	  1017	  1018	  1021	  1136#
BD1	   550#	   554
BD2	   552	   560#
BD3	   547	   570#
BIT	   133#	   133	   134#	   134	   135#	   135	   136#	   137#	   138#
BITTBL	   140%	   607
BYP1	    35#	   731
BYP2	    36#	   736	   758	   801	   996	  1002	  1037	  1069	  1076	  1082	  1092	  1103	  1128
BYP3	    37#	   945
BYP4	    38#
CARFLG	   174	   214	   275	  1291#
CDPIOR	   802#	   807
CET	   608	   612#
CFOIL	   766#	   776
CFOIL1	   767	   781#
CFOIL2	   771	   778#
CH6	   142%	  1154	  1155	  1159
CH7	   142%	  1162
CIRFS	   762	   980	  1057#
CONFIG	   143%	   969	   970
CONINT	   371#	   395	  1158	  1160
CONODP	   382	   387#
CONPDP	   377	  1316#
CONSV	   374	   375	   376	   392	  1316#
CONTBV	   373	   394	  1316#
CPOPJ	   143%	   452	  1059
CPOPJ1	   143%	   510
CSR	   133#
CSRCLR	   133#	  1198	  1246
CSRMAI	   133#
CSRMSE	   133#	  1204
CSROFS	   133#	   337	  1199	  1200	  1205	  1247
CSRRDO	   133#
CSRRIE	   133#	  1204
CSRSA	   133#	   344
CSRSAE	   133#	  1204
CSRTIE	   133#	  1204
CSRTRD	   133#	   340
CTOCNT	   756	   766	   770	  1296#
CTOPNT	   759	   768	   772	   781	  1295#
CTOSPC	   733	   854#	   904
CTRLO	   636	   672#
CTRLQ	   634	   659#
CTRLS	   632	   649#
CTYIDN	   385	   521#
CTYIVL	   381
CTYIWD	   140%	   380	   383
CTYLIN	   388	   397	   521	  1177	  1350	  1352#
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

CTYOCH	   384	   829
CTYODN	   391	   397#	  1283
CTYOVL	   830	   833
CTYOWD	   140%	   389	   831
DCTABL	    82#	    90	    92	    93	    94	    95	  1189
DCTDN	    92#	  1180
DCTFIL	    95#	  1186
DCTLN	    93#	  1181
DCTSPE	    94#	  1184
DEFLG	   189	   269	   277	  1293#
DIE	    17	    17%	    18
DWIIR	   236	   480	   574	   577	   580	   597	   618	   655	   665	   692	   698#	   774	   779	   999
	  1004	  1008	  1012	  1014	  1024	  1029	  1040	  1078	  1088	  1100
DZ0BAS	   353	   362	   836	  1327#	  1331
DZ0INT	   312#	  1339	  1340
DZ1BAS	  1328#	  1332
DZ1INT	   316#	  1341	  1342
DZ2BAS	  1329#	  1333
DZ2INT	   320#	  1343	  1344
DZ3BAS	  1330#	  1334
DZ3INT	   324#	  1345	  1346
DZBATB	   219	   240	   265	   314	   318	   322	   326	   495	   817	  1122	  1144	  1197	  1223	  1245
	  1331#
DZBRK	   630#
DZBRK1	   641	   645#
DZDIS	   346#
DZDO	  1142%	  1142	  1146
DZINF	   371	   378	  1294#
DZINI	    24	  1142#
DZINI0	  1180#	  1193
DZINI1	  1211#	  1240
DZINI2	  1219	  1238#
DZINI3	  1217	  1237	  1240#
DZINI4	  1197#	  1206
DZINIA	  1166#	  1171
DZINT	   315	   319	   323	   327	   329#
DZKEND	  1532#
DZKLIT	  1480#
DZKON	    17	    18#	    21
DZLOCK	   329	   349	  1140#	  1148
DZNUM	    32#	   216	   264	  1165	  1196	  1244	  1351
DZPDP	   336	  1315#
DZPINT	   155#	   196	  1161	  1163
DZPLK2	   166	   170#
DZPLK3	   171	   176#
DZPLK4	   177	   183#
DZPLK5	   185#
DZPLK6	   186	   191#
DZPPDP	   161	  1313#
DZPSV	   158	   159	   160	   193	  1313#
DZPTBV	   157	   195	  1313#
DZREM	  1244#
DZREM1	  1245#	  1250
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

DZRI	   266	   345	   356#	   367
DZSV	   313	   317	   321	   325	   334	   335	   346	   347	   348	  1315#
DZTBV	   331	   350	  1315#
DZUBA	   837	  1167	  1326#	  1331	  1332	  1333	  1334
DZVECT	  1166	  1168	  1339#
DZXI	   341	   352#
ECHO	   533	   535#	   611
EPT	   143%	  1167
FAUXCP	  1350#	  1357
FB1	   671	   676#
FILDON	   410	   414#
FLUBUF	   233	   674#	  1132
GETPR1	  1047#	  1053
GETPRC	   987	  1049	  1053#
GETPRT	   984	  1046#
HANGLN	   669#	  1120
HNGUP	   638	   687#
I.BD	   527	   545#
I.ESC	   527	   626#
I.IDL	   527	   588#
I.LGI	   527	   528#
ICCHR	  1176	  1432#
ID1	   534	   544	   591#	   645
IDSE	   590	   683#
ILCHR	  1172	  1430#
ILGI1	   532	   542#
INPDON	   365	   525#
INPEC1	   604	   609	   615#
INPECH	   593	   601#
IRING	   141%	   712
IRP620	   141%	   698	   711	   713	  1058
IRPPDP	   142%	   701	  1057
IS.BD	   256	  1112	  1238	  1447#
IS.ESC	   683	  1448#
IS.IDL	   542	   627	  1430	  1432	  1450#
IS.LGI	   585	  1449#
ITDDI	   333	   351#
KEYSET	   142%	  1151
LCACT	   387	   486	   490	   602	   814	  1276	  1437#
LCAUX	   752	   991	   993	  1050	  1074	  1096	  1104	  1474#
LCCAR	   227	   243	   247	   250	  1117	  1441#
LCDE	   591	   622	  1430	  1432	  1442#
LCDO	   672	   795	  1434#
LCFIL	   451	   643	  1187	  1472#
LCIS	   257	   525	   543	   586	   628	   684	  1113	  1239	  1445#
LCLGI	   243	   583	   690	  1114	  1436#
LCOH	   649	   659	  1443#
LCOS	   230	   239	   405	   415	   429	   453	   457	   463	   467	   472	   477	   670	   675	  1272
	  1275	  1451#
LCREM	  1106	  1188	  1235	  1440#
LCSPE	   561	  1185	  1226	  1476#
LCTYP	   222	   447	   460	   468	   545	   748	  1047	  1070	  1083	  1093	  1129	  1192	  1211	  1280
	  1465#
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

LI.CPP	   207	   379
LI.REQ	   192
LIM	  1319#
LIMBC	  1256	  1320#
LIMBP	  1258	  1321#
LINCHR	   225	   244	   251	   388	   487	   491	   584	   592	   603	   623	   650	   652	   660	   662
	   673	   691	   796	   815	  1107	  1115	  1118	  1173	  1175	  1177	  1190	  1236	  1277	  1279
	  1357	  1428#	  1445	  1451	  1465	  1472	  1474	  1476
LINCOU	   255	   509	   512	   679	   798	  1109	  1215	  1406#
LINFCR	   409	   411	   414	   455	  1425#
LINOP	   253	   503	   514	   515	   518	   677	  1213	  1372#
LINORS	  1372	  1373	  1374	  1375	  1376	  1377	  1378	  1379	  1380	  1382	  1383	  1384	  1385	  1386
	  1387	  1388	  1389	  1390	  1392	  1393	  1394	  1395	  1396	  1397	  1398	  1399	  1400	  1401
	  1416#
LINOT	   252	   502	   508	   676	  1212	  1382#
LINTOR	   506	   507	   516	   517	  1393#
LINV1	   432	   444	   680	  1419#
LINV2	   431	   433	   446	  1420#
LISTSN	     3	     6
LP.I8C	   832
LP.SSF	   832
LPRCLA	   135#	   564	  1225
LPRCLB	   135#
LPRFA	   135#
LPRFB	   135#
LPRFC	   135#
LPRFD	   135#
LPRLA	   135#
LPRLB	   135#
LPRLC	   135#
LPROFS	   135#	   568	  1230
LPROP	   135#
LPRPE	   135#
LPRRO	   135#	   564	  1225
LPRSC	   135#	   566	  1228
LT.AUX	  1048	  1071	  1084	  1094	  1130	  1470#
LT.CTY	  1432	  1468#
LT.DZ	  1191	  1218	  1469#
LT.UNU	   223	  1216	  1430	  1471#
LWFOR	   719#	   938	   941	  1077	  1086	  1098
MAXDZ	    33#	   305
MSKIRG	   141%	   700	  1061
MSKORG	   141%	   728	   806
MSROFS	   138#	   220
NAUXCP	  1349#	  1355	  1357
NCDLIN	    90#	  1179
NDZLIN	   271	  1210	  1351#	  1352	  1355	  1372	  1382	  1393	  1406	  1416	  1425
NEI	   360	  1298#
NLIC	   598	  1299#
NLINES	  1175	  1355#	  1419	  1420	  1428
NOBIOB	   254	   678	  1214	  1354#	  1407	  1408	  1409	  1410	  1411	  1412	  1413	  1414	  1415
NODIE	    17%
NRCTLP	   549	   559#
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

O.AUX	   750	   752#
O.BMOD	   407	   478#
O.CTY	   750	   794#
O.DZ	   750	   794#
O.FIL	   407	   409#
O.FOO	   407	   408#	   750
O.HU	   407	   459#
O.IDL	   407	   459#
O.RNG	   407	   417#	   474
O.STR	   407	   444#
OD.CTY	   471	   485#
OD.DZ	   471	   489#
OD.FOO	   471	   488#
ODTBL	   461	   469	   471#
ORBSIZ	  1353#	  1354	  1372	  1373	  1374	  1375	  1376	  1377	  1378	  1379	  1380	  1382	  1383	  1384
	  1385	  1386	  1387	  1388	  1389	  1390	  1393	  1394	  1395	  1396	  1397	  1398	  1399	  1400
	  1401	  1416
ORDONE	   730	   763	   799	   823#	   981	  1041	  1079	  1101	  1111
ORIDPB	   512#	   537	   805	  1255	  1257	  1261	  1264
ORILDB	   417	   423	   437	   440	   502#
ORING	   141%	   719	   722	   731	   736	   757	   782	   802	   804	   945	   996	  1002	  1037	  1069
	  1076	  1082	  1092	  1103	  1128
ORP620	   141%	   165	   727	   823
ORPPDP	   142%	   163	   729
OS.BMD	   476	  1461#
OS.FIL	   456	  1460#
OS.HU	   231	   669	  1464#
OS.IDL	   238	   462	   674	  1274	  1430	  1432	  1453#
OS.LGI	   428	   473	  1462#
OS.OP	   428	  1455#
OS.ORB	  1273	  1454#
OUTDO0	   406#	   416	   470
OUTDO1	   418	   462#	   483
OUTDO2	   445	   472#
OUTDON	   355	   405#
P	    18	   102	   103	   104	   105	   161	   206	   335	   336	   346	   377	   422	   427	   432
	   433	   439	   442	   443	   464	   466	   535	   536	   539	   540	   574	   577	   580	   597
	   599	   601	   610	   615	   620	   621	   692	   715	   725	   762	   774	   779	   938	   941
	   980	   984	   986	   989	   999	  1004	  1008	  1012	  1014	  1024	  1029	  1036	  1040	  1052
	  1063	  1077	  1078	  1086	  1088	  1098	  1100	  1145	  1260	  1262	  1265	  1267
P.BOFF	   864	  1066#
P.BON	   863	  1066#
P.CG	   865	  1128#
P.CZ	   866	  1092#
P.CZ1	  1095	  1106#
P.CZ2	  1108	  1117#
P.ORAN	   872	  1066#
P.SLC	   879	   945#
P.SLC1	   952	   957#
P.SLC2	   950	   960#
P.SLC3	   948	   969#
P.SR	   877	   931#
P.YELL	   871	  1082#
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

P1	   216	   219	   240	   260	   264	   265	   267
P2	   218	   226	   241	   246	   259
P3	   219	   220	   226	   246
P4	   217	   221	   224	   225	   237	   244	   245	   248	   258	   271	   273
PER2	   214#
PER21	   218#	   260
PER22	   221#	   259
PER22A	   232	   238#
PER23	   228	   246#
PER24	   224	   237	   245	   248	   259#
PER3	   215	   262#
PER31	   265#	   267
PER4	   263	   269#
PER41	   272#	   273
PER42	   273#
PER5	   270	   274#
PERFLG	   168	   175	   181	   190	   191	   200	   208	  1288#
PERINT	   200#	   281	  1153	  1157
PERPDP	   206	  1314#
PERSV	   203	   204	   205	   278	  1314#
PERTBV	   202	   280	  1314#
PROOR	   212	   465	   727#
PROOR1	   728#	   783	   787	   790	   809	   856	   857	   869	   870	   882	   883	   884	   885	   886
	   888	   889	   955	   958	   962	   967	  1032	  1043	  1072	  1075	  1080	  1089	  1090	  1097
	  1105	  1116	  1119	  1126	  1133
RBUDV	   134#	   357
RBUFE	   134#	   359
RBUOFS	   134#	   356
RBUOVE	   134#	   359
RBUPE	   134#	   359
RCTLPR	   550	   553	   558#	   559	   560
RSPOUT	   940	   943	  1088#
S$ENTR	    17	    23	   424	   438	   441	   475	   481	   513	   575	   578	   581	   619	   656	   666
	   735	   775	   780	   855	   858	   859	   860	   861	   862	   867	   868	   873	   874	   875
	   876	   878	   880	   881	   887	   890	  1000	  1005	  1009	  1013	  1015	  1025	  1030
S$HALT	    17	   424	   438	   441	   475	   481	   513	   575	   578	   581	   619	   656	   666	   735
	   775	   780	   855	   858	   859	   860	   861	   862	   867	   868	   873	   874	   875	   876
	   878	   880	   881	   887	   890	  1000	  1005	  1009	  1013	  1015	  1025	  1030
S$NAME	    21#	   424	   438	   441	   475	   481	   513	   575	   578	   581	   619	   656	   666	   735
	   775	   780	   855	   858	   859	   860	   861	   862	   867	   868	   873	   874	   875	   876
	   878	   880	   881	   887	   890	  1000	  1005	  1009	  1013	  1015	  1025	  1030
S$NONA	    20	    23	   424	   438	   441	   475	   481	   513	   575	   578	   581	   619	   656	   666
	   735	   775	   780	   855	   858	   859	   860	   861	   862	   867	   868	   873	   874	   875
	   876	   878	   880	   881	   887	   890	  1000	  1005	  1009	  1013	  1015	  1025	  1030
S$TEMP	    17#	    17	   424#	   424	   438#	   438	   441#	   441	   475#	   475	   481#	   481	   513#	   513
	   575#	   575	   578#	   578	   581#	   581	   619#	   619	   656#	   656	   666#	   666	   735#	   735
	   775#	   775	   780#	   780	   855#	   855	   858#	   858	   859#	   859	   860#	   860	   861#	   861
	   862#	   862	   867#	   867	   868#	   868	   873#	   873	   874#	   874	   875#	   875	   876#	   876
	   878#	   878	   880#	   880	   881#	   881	   887#	   887	   890#	   890	  1000#	  1000	  1005#	  1005
	  1009#	  1009	  1013#	  1013	  1015#	  1015	  1025#	  1025	  1030#	  1030
S$XCT	    23	   424	   438	   441	   475	   481	   513	   575	   578	   581	   619	   656	   666	   735
	   775	   780	   855	   858	   859	   860	   861	   862	   867	   868	   873	   874	   875	   876
	   878	   880	   881	   887	   890	  1000	  1005	  1009	  1013	  1015	  1025	  1030
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

SAVT1	   844#
SDLE	   813#	  1285
SILFLG	   180	   262	   276	  1292#
SKPDPK	   753	   786#	   797
SKT3	   783#
SNDBYT	   413	   420	   447#
SNDCTY	   448	   829#
SNDDZ	   448	   836#
SNDFOO	   448	   842#
SOA	  1074#	  1085	  1131
SOAOR	  1069#
SOTFLG	   167	   209	   274	  1290#
STCTY	  1281	  1282#
STDZ	  1281	  1284#
STFOO	  1281	  1286#
STOUT	   538	   808	  1266	  1271#
STRLP	  1018#	  1026
STRLP2	  1019	  1031#
STRLP3	  1022	  1028#
SUPBF	   931	  1031	  1042	  1135#	  1149
SUPBSY	   932	   941#
SUPSWP	   988	  1036#
SUPSYW	   975	   985	  1037#
SZODS	   732	   904#
T1	    92	    93	    94	    95	   163	   165	   172	   173	   178	   179	   187	   188	   222	   223
	   252	   253	   254	   255	   256	   257	   334	   337	   338	   340	   343	   344	   347	   352
	   356	   357	   359	   361	   364	   380	   381	   384	   387	   388	   389	   412	   419	   421
	   422	   425	   426	   427	   428	   429	   430	   431	   439	   442	   446	   449	   451	   452
	   454	   455	   456	   457	   462	   463	   468	   469	   472	   473	   476	   477	   486	   487
	   490	   491	   494	   496	   505	   514	   515	   516	   517	   518	   528	   535	   540	   548
	   550	   551	   553	   560	   561	   565	   567	   571	   573	   582	   583	   584	   585	   586
	   588	   589	   596	   601	   605	   606	   607	   608	   610	   621	   626	   629	   631	   633
	   635	   637	   639	   640	   642	   643	   649	   650	   652	   659	   660	   662	   687	   689
	   691	   731	   732	   733	   734	   756	   760	   761	   768	   769	   772	   773	   786	   787
	   788	   789	   798	   800	   803	   814	   815	   816	   818	   819	   820	   829	   830	   831
	   833	   839	   840	   933	   934	   935	   936	   945	   946	   947	   951	   954	   960	   961
	   965	   969	   971	   972	   973	   974	   976	   977	   978	   979	   982	   983	   989	   990
	   991	   992	   993	   995	  1007	  1011	  1037	  1039	  1047	  1048	  1050	  1051	  1062	  1096
	  1097	  1099	  1102	  1104	  1106	  1107	  1109	  1110	  1112	  1113	  1114	  1115	  1117	  1118
	  1121	  1122	  1125	  1144	  1150	  1151	  1153	  1154	  1155	  1157	  1158	  1159	  1160	  1161
	  1162	  1163	  1168	  1169	  1170	  1172	  1174	  1176	  1177	  1179	  1189	  1193	  1198	  1199
	  1200	  1204	  1205	  1211	  1216	  1218	  1226	  1227	  1229	  1233	  1234	  1235	  1236	  1238
	  1239	  1254	  1256	  1258	  1259	  1260	  1262	  1263	  1273	  1275	  1276	  1277	  1279	  1280
	  1281
T2	   221	   234	   235	   240	   242	   251	   252	   253	   255	   352	   353	   354	   361	   362
	   363	   397	   409	   411	   414	   431	   432	   433	   444	   446	   455	   464	   466	   478
	   479	   482	   487	   491	   492	   495	   502	   503	   506	   507	   508	   509	   512	   514
	   515	   516	   517	   518	   521	   536	   539	   562	   571	   572	   573	   576	   579	   582
	   584	   592	   594	   595	   596	   603	   615	   616	   617	   620	   623	   650	   652	   653
	   654	   660	   662	   663	   664	   673	   676	   677	   679	   680	   687	   688	   689	   703
	   706	   707	   709	   712	   714	   719	   721	   722	   723	   736	   757	   758	   759	   764
	   765	   769	   773	   778	   796	   798	   813	   815	   817	   820	   836	   939	   942	   963
	   964	   965	   966	   970	   973	   986	   990	   992	   996	   997	   998	  1001	  1003	  1006
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Symbol cross reference

	  1007	  1010	  1011	  1020	  1023	  1028	  1038	  1039	  1046	  1053	  1057	  1058	  1059	  1060	  1061
	  1062	  1069	  1074	  1075	  1076	  1082	  1087	  1092	  1099	  1103	  1104	  1107	  1109	  1115
	  1118	  1121	  1123	  1124	  1128	  1165	  1166	  1168	  1171	  1173	  1174	  1175	  1180	  1182
	  1183	  1190	  1196	  1197	  1206	  1210	  1212	  1213	  1215	  1221	  1236	  1240	  1246	  1247
	  1248	  1249	  1265	  1267	  1271	  1277	  1279	  1445	  1451	  1465	  1472	  1474	  1476
T3	   230	   231	   238	   239	   241	   242	   313	   315	   317	   319	   321	   323	   325	   327
	   332	   333	   348	   405	   406	   409	   410	   411	   414	   415	   425	   428	   430	   447
	   448	   453	   454	   460	   461	   467	   469	   493	   494	   495	   496	   502	   503	   505
	   506	   507	   508	   525	   526	   528	   529	   530	   531	   542	   543	   545	   549	   550
	   553	   554	   560	   562	   563	   564	   566	   567	   568	   591	   592	   602	   603	   605
	   608	   622	   623	   627	   628	   669	   670	   672	   673	   674	   675	   676	   677	   678
	   679	   683	   684	   690	   691	   698	   699	   700	   701	   704	   707	   708	   709	   711
	   712	   748	   749	   752	   753	   765	   795	   796	   800	   807	   836	   837	   838	   840
	   994	   995	   997	  1002	  1003	  1016	  1017	  1018	  1019	  1020	  1021	  1022	  1023	  1036
	  1070	  1071	  1083	  1084	  1093	  1094	  1124	  1125	  1129	  1130	  1166	  1167	  1170	  1181
	  1183	  1184	  1185	  1186	  1187	  1188	  1190	  1191	  1192	  1197	  1199	  1200	  1205	  1212
	  1213	  1214	  1215	  1223	  1230	  1234	  1245	  1247	  1249	  1272	  1274
T4	   225	   227	   243	   244	   247	   250	   251	   265	   314	   318	   322	   326	   337	   339
	   342	   353	   356	   362	   568	   719	   722	   727	   728	   729	   731	   736	   757	   781
	   782	   783	   787	   789	   790	   801	   802	   803	   804	   806	   809	   823	   856	   857
	   869	   870	   882	   883	   884	   885	   886	   888	   889	   945	   955	   958	   962	   967
	   996	  1002	  1032	  1037	  1043	  1069	  1072	  1075	  1076	  1080	  1082	  1089	  1090	  1092
	  1097	  1103	  1105	  1116	  1119	  1126	  1128	  1133	  1221	  1222	  1223	  1224	  1225	  1228
	  1229	  1230	  1232	  1233	  1244	  1245	  1250
TBCC	    97#	   172
TBDEC	    99#	   187
TBNCC	   170	   173	  1301#
TBNDEC	   185	   188	  1303#
TBNSC	   176	   179	  1302#
TBSC	    98#	   178
TCROFS	   136#	   242	   496	   820	  1125	  1234	  1249
TDROFS	   137#	   840
TIBTBL	   140%	   226	   241	   246	   494	   819	  1124	  1233
TTACT	   164	   210	   485	   489	  1282	  1284	  1297#
TYPGRE	   570	  1254#
UBGOOD	  1145%	  1145
ZZ	   304#	   312	   314	   316	   316#	   318	   320	   320#	   322	   324	   324#	   326	   328	   328#
	  1372#	  1372	  1373	  1373#	  1374	  1374#	  1375	  1375#	  1376	  1376#	  1377	  1377#	  1378	  1378#
	  1379	  1379#	  1380	  1380#	  1381	  1381#	  1382#	  1382	  1383	  1383#	  1384	  1384#	  1385	  1385#
	  1386	  1386#	  1387	  1387#	  1388	  1388#	  1389	  1389#	  1390	  1390#	  1391	  1391#	  1393#	  1393
	  1394	  1394#	  1395	  1395#	  1396	  1396#	  1397	  1397#	  1398	  1398#	  1399	  1399#	  1400	  1400#
	  1401	  1401#	  1402	  1402#
DZKON - Simulate a Tymnet Base and Remote using DZ11s and the CTY	MACRO 12.5-46.0 14:19 13-JAN-88
DZKON.MAC	30-OCT-87 17:11		Macro/Opdef cross reference

ADJSP	   106#	   443
BCIO	   496	  1125
BSIO	   242	   820	  1199	  1234
CALL	   102#	   212	   233	   236	   266	   341	   345	   365	   385	   391	   417	   423	   437	   440
	   448	   465	   480	   533	   537	   538	   570	   593	   618	   645	   655	   665	   805	   808
	   987	  1120	  1132	  1255	  1257	  1261	  1264	  1266
DZLIN	    79#	    82	    83	    84	    85	    86	    87	    88	    89
IFKMC	    35	   705	   720
IFNKMC	    44
IGNORE	   851#	   856	   857	   869	   870	   882	   883	   884	   885	   886	   888	   889
IOREG	   124#	   133	   134	   135	   136	   137	   138
LOOP	  1360#	  1372	  1382	  1393
LOSER	   301#	   312	   316	   320	   324
PRINTF	    10#
RDIO	   220	   337	   356
RDTIME	   157	   202	   331	   373
REST	   105#	   342	   343	   713	   714
RESTAC	   117#	   193	   278	   392
RET	   103#	   358	   366	   408	   450	   458	   488	   497	   504	   519	   541	   555	   587	   600
	   624	   630	   644	   646	   647	   651	   657	   661	   667	   681	   685	   693	   694	   702
	   716	   821	   824	   834	   841	   842	  1054	  1064	  1143	  1147	  1241	  1251	  1268	  1278
	  1286
SAVE	   104#	   338	   339	   703	   704
SAVEAC	   110#	   157	   202	   373
SAVEAR	  1306#	  1313
STOPCD	    16	   424	   438	   441	   475	   481	   513	   575	   578	   581	   619	   656	   666	   735
	   775	   780	   855	   858	   859	   860	   861	   862	   867	   868	   873	   874	   875	   876
	   878	   880	   881	   887	   890	  1000	  1005	  1009	  1013	  1015	  1025	  1030
TBSAVE	   157	   202	   331	   373
TBSET	   195	   280	   350	   394
TIOE	  1200
TYPI	    42#
UUIDPB	    40#
UUILDB	    39#	   768	   772	   803
WRAPR	   832
WRIO	   568	   840	  1205	  1230	  1247	  1249
WRPI	   192	   207	   379
WRTIME	   195	   280	   350	   394
$END	  1480    I@x.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE	FRMSER - Frame-OP UUO and job assignment
     9				SUBTTL	9 MAR 79 /EVS
    10
    11					STOPCD(,ENTRY,FRMSER)^
    12					ENTRY	FRMSER		;For library searches
    13	000000'	260040	000000*	FRMSER::PUSHJ	P,DIE		;**** Default stopcode for "FRMSER" ****
    14	000001'	466255	634562		SIXBIT	/FRMSER/  	;Title of module
    15	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "FRMSER+nnn(nnnnnn)"
    16			000000'	S$NAME==FRMSER			;For STOPCDs with no arguments
    17					SALL>
    18				^
    19
    20				;          Table of Contents for FRMSER - FRMOP handler
    21				;
    22				;
    23				;			   Section			      Page
    24				;
    25				;    1. FRMOP MUUO (opcode 044)  . . . . . . . . . . . . . . .   2
    26				;    2. SETSTV - Set start vector address (CALLI -137) . . . .   4
    27				;    3. FINASS - Assign frame interrupt causes (CALLI -151)  .   5
    28				;    4. .FOREP=7 REPLICATE TO/FROM FRAME . . . . . . . . . . .   5
    29				;    5. .FOVRM=10 VREMOV FOR ANOTHER FRAME . . . . . . . . . .   5
    30				;    6. .FOVCL=11 VCLEAR FOR ANOTHER FRAME . . . . . . . . . .   5
    31				;    7. .FOCSI=44 Cause software interrupt . . . . . . . . . .   6
    32				;    8. .FOCFM=1 Create frame  . . . . . . . . . . . . . . . .   7
    33				;    9. .FORVA=2 Read a virtual address  . . . . . . . . . . .  14
    34				;   10. .FOWVA=3 Write a virtual address . . . . . . . . . . .  14
    35				;   11. .FOSAA=4 Start at absolute address . . . . . . . . . .  16
    36				;   12. .FOSVA=22 Start frame at start vector address  . . . .  17
    37				;   13. .FOJMP=0 Gate jump to other frame  . . . . . . . . . .  20
    38				;   14. .FOGIN=26 Gate jump Initialization . . . . . . . . . .  23
    39				;   15. .FOCLR=14 Clear a stopped frame  . . . . . . . . . . .  24
    40				;   16. .FOGET=32 Get new core image from SAVE file  . . . . .  25
    41				;   17. .FORUN=33 Run program in frame . . . . . . . . . . . .  25
    42				;   18. .FOSAV=34 Save frame's core image  . . . . . . . . . .  25
    43				;   19. .FOSSA=35 Sharable save frame's core image . . . . . .  25
    44				;   20. .FOHLT=5 Halt frame  . . . . . . . . . . . . . . . . .  26
    45				;   21. .FOSTP=41 Stop Frame (^C)  . . . . . . . . . . . . . .  26
    46				;   22. .FOFRC=42 Force Command for frame  . . . . . . . . . .  27
    47				;   23. .FOCON=25 Continue a frame . . . . . . . . . . . . . .  28
    48				;   24. .FOHST=23 Read Halt Status block . . . . . . . . . . .  29
    49				;   25. .FORPC=6 Read PC (if PC is in user mode) . . . . . . .  30
    50				;   26. .FOPRJ=43 Change Project Code for frame  . . . . . . .  31
    51				;   27. .FORFA=36 Read Frame Attributes  . . . . . . . . . . .  31
    52				;   28. .FOWFA=37 Write Frame Attributes . . . . . . . . . . .  31
    53				;   29. .FOXFA=40 Exchange Frame Attributes  . . . . . . . . .  31
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 1
FRMSER.MAC	 8-DEC-87 16:09		9 MAR 79 /EVS

    54				;   30. .FOCFH=12 Create handle  . . . . . . . . . . . . . . .  34
    55				;   31. .FODFH=13 Destroy handle . . . . . . . . . . . . . . .  40
    56				;   32. .FOSMF=20 Set Max Frame Rights . . . . . . . . . . . .  41
    57				;   33. .FOCHR=21 Change rights in a handle  . . . . . . . . .  42
    58				;   34. .FOVCH=27 Validate Child to Parent Handle for a chil .  44
    59				;   35. .FORSI=15 Return standard access rights info . . . . .  46
    60				;   36. .FORAR=16 Read a handle's access rights  . . . . . . .  47
    61				;   37. .FORER=17 Read handle's effective rights . . . . . . .  47
    62				;   38. .FOCAR=30 Read child's child to parent process handl .  50
    63				;   39. .FOCER=31 Read child's C2P with effective rights . . .  50
    64				;   40. COPY BITS FROM USER TO HANDLE  . . . . . . . . . . . .  52
    65				;   41. .FOGFT=24 Graft a frame  . . . . . . . . . . . . . . .  55
    66				;   42. FRAME TREE HANDLERS  . . . . . . . . . . . . . . . . .  56
    67				;   43. ROUTINES TO GET CONTEXT PAGES AND CHECK ACCESS . . . .  59
    68				;   44. FRAME DESCRIPTOR PROCESSING  . . . . . . . . . . . . .  62
    69				;   45. BIT MAP TRANSLATION ROUTINES . . . . . . . . . . . . .  70
    70				;   46. ERROR CODES  . . . . . . . . . . . . . . . . . . . . .  76
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 2
FRMSER.MAC	 8-DEC-87 16:09		FRMOP MUUO (opcode 044)

    71				SUBTTL FRMOP MUUO (opcode 044)
    72				;FRMOP MONITOR CODE. UUO CALLING FORMAT IS
    73				;
    74				;	MOVE	AC,[FUNCTION,,FRAME DESCRIPTOR]
    75				;	FRMOP	AC,<EFFECTIVE ADDRESS (CAN BE IMMEDIATE)>
    76				;	  ERROR RETURN
    77				;	SUCCESS RETURN
    78
    79				;FRMOP ERROR CODES ARE GLOBAL ACROSS ALL FUNCTIONS, AND ARE
    80				; ALSO FOUND AS SUB-ERROR CODES IN THE "OTHER FRAME" ERROR CODES
    81				; IN VIRTUAL ADDRESS SPACE MANIPULATIONS.
    82
    83				;A FRMOP FUNCTION ROUTINE WILL FIND THE FRAME DESCRIPTOR IN P4,
    84				; THE AC NUMBER IN W FOR ERROR CODE STORING, AND THE ADDRESS
    85				; IN THE RIGHT HALF OF M.
    86
    87				;SOME FRMOP FUNCTIONS ARE IMMEDIATE (USE THE EFFECTIVE ADDRESS AS THE
    88				; DATA) AND IN SOME THE EFFECTIVE ADDRESS POINTS TO AN ARGUMENT BLOCK.
    89				; THE EFFECTIVE ADDRESS IS NEVER USED AS AN ADDRESS TO STORE THE
    90				; RETURN DATA TO. RETURN DATA IS ALWAYS STORED EITHER IN THE AC
    91				; OR IN A LOCATION SPECIFIED BY THE UUO ARGUMENTS.
    92
    93
    94	000003'	256200	003637'	FRMOPD::UMOVE	T1,(W)		;GET FN,,FD
    95	000004'	550740	000006		HRRZ	P4,T1		;GET FD IN P4 FOR FD2FNO, CHEKAR ETC.
    96	000005'	557000	000006		HLRZS	T1		;JUST FN IN RH
    97	000006'	350006	000046'		AOS	CNTFRM(T1)	;Count FRMOPs by function
    98	000007'	322300	001047'		JUMPE	T1,FRMJMP	;IF ZERO, BYPASS DISPATCH FOR SPEED.
    99	000010'	301300	000050		CAIL	T1,FRMOTL*2	;IN BOUNDS?
   100	000011'	254000	000017'		JRST	FOEBFN		;BAD FUNCTION CODE
   101	000012'	241300	777777		ROT	T1,-1		;<EVEN/ODD>,,FN/2
   102	000013'	335000	000006		SKIPGE	T1		;SKIP OF EVEN, USE LH
   103	000014'	334306	000022'		SKIPA	T1,FRMOTB(T1)	;ODD, USE RH
   104	000015'	204306	000022'		MOVS	T1,FRMOTB(T1)	;EVEN, USE LH
   105	000016'	254006	000000		JRST	(T1)		;DISPATCH.
   106
   107	000017'	201300	000015	FOEBFN:	MOVEI	T1,FEBFN%	;BAD FUNCTION NUMBER
   108	000020'	256200	003640'		UMOVEM	T1,(W)		;STORE INTO AC
   109	000021'	263040	000000		POPJ	P,		;AND GIVE ERROR RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 3
FRMSER.MAC	 8-DEC-87 16:09		FRMOP MUUO (opcode 044)

   110				;DISPATCH TABLE FOR FRMOP
   111
   112				DEFINE FRMOGN<XALL
   113				X (JMP,FRMJMP)			;;(0)GATE JUMP TO FRAME (ZERO FOR FAST DISPATCH)
   114				X (CFM,FRMCRE)			;;(1) CREATE FRAME
   115				X (RVA,FRMRVA)			;;(2) READ A VIRTUAL ADDRESS
   116				X (WVA,FRMWVA)			;;(3) WRITE A VIRTUAL ADDRESS
   117				X (SAA,FRMSAA)			;;(4) START AT ABSOLUTE ADDRESS
   118				X (HLT,FRMHLT)			;;(5) HALT FRAME
   119				X (RPC,FRMRPC)			;;(6) READ PC (USER MODE PC)
   120				X (REP,FRMREP)			;;(7) REPLICATE TO/FROM FRAME
   121				X (VRM,FRMVRM)			;;(10) VREMOV FOR ANOTHER FRAME
   122				X (VCL,FRMVCL)			;;(11) VCLEAR FOR ANOTHER FRAME
   123				X (CFH,FRMCFH)			;;(12) CREATE HANDLE
   124				X (DFH,FRMDFH)			;;(13) DESTROY HANDLE
   125				X (CLR,FRMCLR)			;;(14) CLEAR A STOPPED FRAME
   126				X (RSI,FRMRSI)			;;(15) RETURN STANDARD ACCESS RIGHT INFO
   127				X (RAR,FRMRAR)			;;(16) READ A HANDLE'S ACCESS RIGHTS
   128				X (RER,FRMRER)			;;(17) READ HANDLE'S EFFECTIVE RIGHTS
   129				X (SMF,FRMSMF)			;;(20) SET MAX FRAME RIGHTS
   130				X (CHR,FRMCHR)			;;(21) CHANGE RIGHTS IN A HANDLE
   131				X (SVA,FRMSVA)			;;(22) START FRAME AT START VECTOR ADDRESS
   132				X (HST,FRMHST)			;;(23) READ HALT STATUS BLOCK FOR FRAME
   133				X (GFT,FRMGFT)			;;(24) GRAFT A FRAME
   134				X (CON,FRMCON)			;;(25) CONTINUE A FRAME
   135				X (GIN,FRMGIN)			;;(26) PREPARE FRAME TO BE GATE JUMPED INTO
   136				X (VCH,FRMVCH)			;;(27) VALIDATE CHILD TO PARENT HANDLE FOR A CHILD
   137				X (CAR,FRMCAR)			;;(30) READ CHILD'S CHILD TO PARENT PROCESS HANDLE
   138				X (CER,FRMCER)			;;(31) READ CHILD'S CHILD TO PARENT PROCESS HANDLE, GIVE EFFECT
   139				IVE RIGHTS BACK
   140				X (GET,FRMGET)			;;(32) SETUP FRAME'S CORE IMAGE FROM FILE
   141				X (RUN,FRMRUN)			;;(33) RUN PROGRAM IN FRAME
   142				X (SAV,FRMSAV)			;;(34) SAVE FRAME'S CORE IMAGE
   143				X (SSA,FRMSSA)			;;(35) SHARABLY SAVE FRAME'S CORE IMAGE
   144				X (RFA,FRMRFA)			;;(36) Read Frame Attributes
   145				X (WFA,FRMWFA)			;;(37) Write Frame Attributes
   146				X (XFA,FRMXFA)			;;(40) Exchange Frame Attributes
   147				X (STP,FRMSTP)			;;(41) Stop Frame (^C)
   148				X (FRC,FRMFRC)			;;(42) Force Command for frame
   149				X (PRJ,FRMPRJ)			;;(43) Change Project Code for frame
   150				X (CSI,FRMCSI)			;;(44) Cause software interrupt
   151				X (ENA,FRMENA)			;;(45) Enable license in frame
   152				X (DIS,FRMDIS)			;;(46) Disable license in frame
   153				SALL>;END FRMOGN MACRO DEFINITION
   154
   155				DEFINE X(A,B)<
   156				XP .FO'A,ZZ
   157				IFE <ZZ/2*2-ZZ>,<ZZ1=='B
   158						'B,,FOEBFN>
   159				IFN <ZZ/2*2-ZZ>,<RELOC .-1
   160						BYTE (18)ZZ1,'B> ;;GET AROUND BUG IN MACRO OR LOADER
   161				ZZ==ZZ+1
   162				>;END X MACRO DEFINITION
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 3-2
FRMSER.MAC	 8-DEC-87 16:09		FRMOP MUUO (opcode 044)

   163
   164			000000	ZZ==0				;COUNTER TO USE DEFINING .FO???
   165	000022'			FRMOTB:	FRMOGN   166	000022'	001047'	000017'			FRMJMP,,FOEBFN>
   167	000022'	000000	000000*			BYTE (18)ZZ1,FRMCRE> 
   168	000023'	000652'	000017'			FRMRVA,,FOEBFN>
   169	000023'	000000	000000*			BYTE (18)ZZ1,FRMWVA> 
   170	000024'	000742'	000017'			FRMSAA,,FOEBFN>
   171	000024'	000000	000000*			BYTE (18)ZZ1,FRMHLT> 
   172	000025'	001461'	000017'			FRMRPC,,FOEBFN>
   173	000025'	000000	000000*			BYTE (18)ZZ1,FRMREP> 
   174	000026'	000000*	000017'			FRMVRM,,FOEBFN>
   175	000026'	000000	000000*			BYTE (18)ZZ1,FRMVCL> 
   176	000027'	001667'	000017'			FRMCFH,,FOEBFN>
   177	000027'	000000	000000*			BYTE (18)ZZ1,FRMDFH> 
   178	000030'	001235'	000017'			FRMCLR,,FOEBFN>
   179	000030'	000000	000000*			BYTE (18)ZZ1,FRMRSI> 
   180	000031'	002326'	000017'			FRMRAR,,FOEBFN>
   181	000031'	000000	000000*			BYTE (18)ZZ1,FRMRER> 
   182	000032'	002137'	000017'			FRMSMF,,FOEBFN>
   183	000032'	000000	000000*			BYTE (18)ZZ1,FRMCHR> 
   184	000033'	000755'	000017'			FRMSVA,,FOEBFN>
   185	000033'	000000	000000*			BYTE (18)ZZ1,FRMHST> 
   186	000034'	002655'	000017'			FRMGFT,,FOEBFN>
   187	000034'	000000	000000*			BYTE (18)ZZ1,FRMCON> 
   188	000035'	001230'	000017'			FRMGIN,,FOEBFN>
   189	000035'	000000	000000*			BYTE (18)ZZ1,FRMVCH> 
   190	000036'	002500'	000017'			FRMCAR,,FOEBFN>
   191	000036'	000000	000000*			BYTE (18)ZZ1,FRMCER> 
   192	000037'	001251'	000017'			FRMGET,,FOEBFN>
   193	000037'	000000	000000*			BYTE (18)ZZ1,FRMRUN> 
   194	000040'	001254'	000017'			FRMSAV,,FOEBFN>
   195	000040'	000000	000000*			BYTE (18)ZZ1,FRMSSA> 
   196	000041'	001551'	000017'			FRMRFA,,FOEBFN>
   197	000041'	000000	000000*			BYTE (18)ZZ1,FRMWFA> 
   198	000042'	001547'	000017'			FRMXFA,,FOEBFN>
   199	000042'	000000	000000*			BYTE (18)ZZ1,FRMSTP> 
   200	000043'	001412'	000017'			FRMFRC,,FOEBFN>
   201	000043'	000000	000000*			BYTE (18)ZZ1,FRMPRJ> 
   202	000044'	000161'	000017'			FRMCSI,,FOEBFN>
   203	000044'	000000	000000*			BYTE (18)ZZ1,FRMENA> 
   204	000045'	001330'	000017'			FRMDIS,,FOEBFN>
   205			000024	FRMOTL==.-FRMOTB
   206
   207	000046'			CNTFRM:	BLOCK	FRMOTL*2	; Block for counters, one per .FO???
   208
   209
   210				SUBTTL	SETSTV - Set start vector address (CALLI -137)
   211
   212				COMMENT #
   213				CALL:
   214
   215					MOVE	AC,[COUNT,,ADDRESS]
   216					SETSTV	AC,
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 3-3
FRMSER.MAC	 8-DEC-87 16:09		SETSTV - Set start vector address (CALLI -137)

   217					  <ERROR RETURN> ;NEVER HAPPENS
   218					<SUCCESS RETURN>	;AC HAS OLD SETTING.
   219				#
   220
   221	000116'	250300	000000*	STVSET::EXCH	T1,%UPT+UPTSTV	;SET NEW ONE, GET OLD ONE
   222	000117'	256200	003640'		UMOVEM	T1,(W)		;STORE OLD ONE IN USER'S AC
   223	000120'	254000	000000*		JRST	CPOPJ1		;AND RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 4
FRMSER.MAC	 8-DEC-87 16:09		FINASS - Assign frame interrupt causes (CALLI -151)

   224				SUBTTL	FINASS - Assign frame interrupt causes (CALLI -151)
   225				COMMENT ~
   226					MOVE	ac, [ <cause>B8+<channel>B17+<FD>B35 ]
   227					FINASS	ac,
   228					  error return
   229					normal return
   230
   231				where <cause> is a cause number from the table below,
   232				<channel> is the INTADR channel number (1 to 35) to assign; 0 to deassign,
   233				and <FD> is the frame descriptor for the specified frame (for causes 0-5, the
   234				FD must be that of a child, for causes 6-13, the FD must be -1).
   235				~
   236
   237	000121'			FNTBYP::	; FINASS interrupt channel assignments.
   238	000121'	360602	000000*	JBYLCF::POINT 6,JBTPNT##(J),05	;(00) interrupt parent - Lost Child Frame
   239			000000	  .IALCF==JBYLCF-FNTBYP
   240	000122'	300602	000121*	JBYECF::POINT 6,JBTPNT##(J),11	;(01) interrupt parent - Exit in Child Frame
   241			000001	  .IAECF==JBYECF-FNTBYP
   242	000123'	220602	000122*	JBYNIC::POINT 6,JBTPNT##(J),17	;(02) interrupt parent - NTQ in Child Frame
   243			000002	  .IANIC==JBYNIC-FNTBYP
   244	000124'	140602	000123*		POINT 6,JBTPNT##(J),23	;(03) interrupt parent - unused
   245	000125'	060602	000124*		POINT 6,JBTPNT##(J),29	;(04) interrupt parent - unused
   246	000126'	000602	000125*		POINT 6,JBTPNT##(J),35	;(05) interrupt parent - unused
   247	000127'	360602	000000*	JBYSIP::POINT 6,JBTFNT##(J),05	;(06) Software Interrupt from Parent
   248			000006	  .IASIP==JBYSIP-FNTBYP
   249	000130'	300602	000127*	JBYSIC::POINT 6,JBTFNT##(J),11	;(07) Software Interrupt from Child
   250			000007	  .IASIC==JBYSIC-FNTBYP
   251	000131'	220602	000130*	JBYSIS::POINT 6,JBTFNT##(J),17	;(10) Software Interrupt from Sibling
   252			000010	  .IASIS==JBYSIS-FNTBYP
   253	000132'	140602	000131*	JBYSIA::POINT 6,JBTFNT##(J),23	;(11) Software Interrupt from Anyone
   254			000011	  .IASIA==JBYSIA-FNTBYP
   255				;*;	POINT 6,JBTFNT##(J),29	;(12) unused
   256				;*;	POINT 6,JBTFNT##(J),35	;(13) unused
   257			000012	FNTRNM==:.-FNTBYP	;Number of FINASS interrupts
   258
   259
   260	000133'	550740	000006	FINASS::HRRZ	P4,T1		;Frame descriptor
   261	000134'	135640	003641'		LDB	P2,[POINT 9,T1,17] ;Channel #
   262	000135'	303640	000043		CAILE	P2,^D35		;Legal interrupt channel number?
   263	000136'	254000	003622'		 JRST	FEWBCN		;Bad Channel Number
   264	000137'	135600	003642'		LDB	P1,[POINT 9,T1,8];Cause #
   265	000140'	303600	000012		CAILE	P1,FNTRNM	;Legal cause ?
   266	000141'	254000	003623'		 JRST	FEWBTN		;Bad Table Number
   267	000142'	474700	000000		SETO	P3,		;No access rights needed
   268	000143'	260040	003102'		PUSHJ	P,FD2FNO	;Convert FD to frame #
   269	000144'	254000	000674'		  JRST	FRVERR		;No go
   270	000145'	550314	000121'		HRRZ	T1,FNTBYP(P1)	;Get JBT table address
   271	000146'	302300	000126*		CAIE	T1,JBTPNT##	;Is it set by parent in child's JBTPNT?
   272	000147'	254000	000156'		 JRST	FINAS2		;No, must be doing to self
   273	000150'	260040	003002'		PUSHJ	P,ISCHLD	;Check if J is a child
   274	000151'	254000	003603'		  JRST	FEWNCH		;Not a child
   275	000152'	135714	000121'	FINAS1:	LDB	P3,FNTBYP(P1)	;Get old value
   276	000153'	137654	000121'		DPB	P2,FNTBYP(P1)	;Store new into JBTFNT or JBTPNT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 4-2
FRMSER.MAC	 8-DEC-87 16:09		FINASS - Assign frame interrupt causes (CALLI -151)

   277	000154'	256200	003643'	FRVOK:	UMOVEM	P3,(W)		;Return old value to user
   278	000155'	254000	000120*		JRST	CPOPJ1	
   279
   280	000156'	312100	000000*	FINAS2:	CAME	J,%UPT+UPTJOB	;Does FD reference self?
   281	000157'	254000	003600'		 JRST	FEWBDF		;No, bad frame number
   282	000160'	254000	000152'		JRST	FINAS1		;Yes, go set channel in JBTFNT
   283
   284
   285
   286
   287				SUBTTL	.FOREP=7 REPLICATE TO/FROM FRAME
   288				SUBTTL	.FOVRM=10 VREMOV FOR ANOTHER FRAME
   289				SUBTTL	.FOVCL=11 VCLEAR FOR ANOTHER FRAME
   290
   291				EXTERN	FRMREP,FRMVRM,FRMVCL	;These are in IOCSS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 5
FRMSER.MAC	 8-DEC-87 16:09		.FOCSI=44 Cause software interrupt

   292				SUBTTL	.FOCSI=44 Cause software interrupt
   293
   294				COMMENT ~
   295					MOVE	ac, [ XWD .FOCSI,Target-FD ]
   296					FRMOP	ac,
   297					  error return		; no rights or interrupt not enabled
   298					normal return		; ac = interrupt channel # enabled
   299				where the Target-FD is a frame descriptor to the target frame.
   300
   301				If we are child of FD and parent is enabled, skip return with <.IASIP,,channel>.
   302				If we are parent of FD and child is enabled, skip return with <.IASIC,,channel>.
   303				If FD is a sibling and sibling is enabled, skip return with <.IASIS,,channel>.
   304				If FD is enabled for interrupts from any, skip return with <.IASIA,,channel>.
   305				Otherwise error return with zero in AC.
   306				~
   307
   308	000161'	474700	000000	FRMCSI::SETO	P3,		;No access rights need  309	000162'	260040	003102'		PUSHJ	P,FD2FNO	;Get frame number
   310	000163'	254000	000674'		  JRST	FRVERR		;Bad frame descriptor, error code in P3
   311	000164'	260040	003002'		PUSHJ	P,ISCHLD	;Is J one of our children?
   312	000165'	334600	003644'		  SKIPA	P1,[.IASIA]	;No, could be anybody
   313	000166'	201600	000006		MOVEI	P1,.IASIP	;Yes, this is an interrupt from parent
   314	000167'	260040	003014'		PUSHJ	P,ISSIBL	;Does J belong to a sibling (including myself)?
   315	000170'	334000	000000		  SKIPA			;No
   316	000171'	201600	000010		MOVEI	P1,.IASIS	;Yes, this is an interrupt from sibling
   317	000172'	200300	000000*		MOVE	T1,%UPT+UPTJOB	;Get our frame number
   318	000173'	135300	003645'		LDB	T1,PRNTBP(T1)	;Get our parent's frame number
   319	000174'	316300	000002		CAMN	T1,J		;Interrupting our parent?
   320	000175'	201600	000007		 MOVEI	P1,.IASIC	;Yes, this is an interrupt from child
   321	000176'	135314	000121'		LDB	T1,FNTBYP(P1)	;Get the channel
   322	000177'	336000	000006		SKIPN	T1		;If this one is not enabled,
   323	000200'	135300	000132'		 LDB	T1,JBYSIA	; get the "from anybody" channel
   324	000201'	256200	003640'		UMOVEM	T1,(W)		;Tell caller (zero if not enabled)
   325	000202'	322300	000000*		JUMPE	T1,CPOPJ	;Error return if callee not enabled
   326	000203'	260040	000000*		PUSHJ	P,TAKTRP##	;Take the trap in T1 for job in J
   327	000204'	254000	000155*		JRST	CPOPJ1		;End of FRMOP function .FOCSI
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 6
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   328				SUBTTL	.FOCFM=1 Create frame
   329				COMMENT @;;SUBROUTINE FRMCRE
   330				;;PURPOSE DOES CREFRM UUO
   331				;;There are two formats for performing this call:
   332
   333					OLDWAY:	MOVSI	ac,.FOCFM
   334						FRMOP	ac,[-count,,BLOCK]
   335						  error return
   336						normal return
   337					BLOCK:	exp JBTPPN,JBTPRV,JBTAUN,JBTUNM,JBTUN1
   338
   339					NEWWAY:	MOVSI	ac,.FOCFM
   340						FRMOP	ac,BLOCK
   341						  error return
   342						normal return
   343					BLOCK:	flags,,count
   344						exp JBTPPN,JBTPRV,JBTAUN,JBTUNM,JBTUN1
   345						EXP RH<JBTLIC>		;IF FLAG 1B16 IS SET THIS CONTAINS
   346									; FRAME LIC FOR CHILD.  MAX FRAME
   347									; LIC PASSABLE IS FRAME LIC OF PARENT.
   348					;FLAGS
   349					CF.OLD== 1B0			; this word is -cnt,,adr (old way)
   350					CF.LOG== 1B17			; run LOGINN in child
   351					CF.LIC== 1B16			; pass frame license to child
   352					CF.PLI== 1B15			; LOGINN asks "please log in:" to
   353									; verify username and password
   354					CF.BAT== 1B14			; create child as batch job
   355					CF.BBJ== 1B13			; create child as background batch job
   356
   357				;;ACCUM ALL EXCEPT P
   358				;;EXIT NON-SKIP IF ERROR (SEE ERROR CODES BELOW)
   359				SKIP IF SUCCESS, FRAME DESCRIPTOR FOR NEW CHILD IN AC.
   360				;;@
   361
   362
   363				EXTERNAL AGENTV,ATBDUM,ATBMWC,ATBSTS,ATBUMC,ATPDUM,ATPMXU,CPOPJ1
   364				EXTERNAL CTXTAB,DABBIT,DECHJB,HIGHJB,JBTAUN,JBTFTR,JBTLIC,JBTPPN,JBTPRV
   365				EXTERNAL JBTUN1,JBTUNM,JBTUPM,JBYMWS,JBYUWS,JOBATB,LM3ATB,LM3HDA,LMPCUR
   366				EXTERNAL LMPMXW,MAPUPX,MBIT,NCTXPG,PBMMSK,RBREAL,UP4LDA,UPT,UPTACP,UPTEND
   367				EXTERNAL UPTJOB,UPTNTV,UPTPBM,UPTOFD,UXYUWL,UXYUWM
   368				EXTERNAL %UPT,%UPT.N,%UPX,UXYPSR,LMASRP,JOBMAX,%UPX.N
   369				EXTERNAL CLRJBT,JBTCTX,JBTSTS,LOGTAB
   370				EXTERNAL SETLMX,TTYNFR
   371				EXTERNAL SYSUID,JBTUID
   372
   373		400000	000000		CF.OLD==1B0			; this word is -cnt,,adr (old way)
   374		000001	000000		CF.LOG==1B17			; run LOGINN in child
   375		000002	000000		CF.LIC==1B16			; PASS FRAME LIC TO CHILD
   376		000004	000000		CF.PLI==1B15			; Please Log In
   377		000010	000000		CF.BAT==1B14			; create batch job
   378		000020	000000		CF.BBJ==1B13			; create background batch job
   379
   380				;1) Get arguments from user, defaulting from caller's UPT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 6-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   381				;2) Assign a new frame number (at this point, J does not equal JOB)
   382				;3) Allocate pages for the new UPT, map them thru %UPX
   383				;4) Insert initial values into the new UPT
   384				;5) Put caller's arguments into JBT tables and in the new UPT
   385
   386				;P1=flag, P2=AC, P3&P4=LMAP, U=%UPT/%UPX, W=SETLMX, J=newframe
   387
   388	000205'	200640	000012	FRMCRE::MOVE	P2,W		;User's AC number for storing FD
   389	000206'	201240	000000*		MOVEI	U,%UPT		;Read current args from caller's UPT
   390	000207'	260040	000504'		PUSHJ	P,PSHARG	;SAVE USER'S ARGS ON THE STACK AND CHECK.
   391	000210'	254000	000461'		  JRST	FCEBDA		;BaD Args (stack already cleaned up)
   392	000211'	606200	000030		TRNN	F,(CF.BAT!CF.BBJ);Want to create a (background) batch job?
   393	000212'	254000	000215'		  JRST	FRMCR0		;No
   394	000213'	607200	001000		TLNN	F,LICJAL	;Require JL license for batch job
   395	000214'	254000	000432'		  JRST	NBJFCE		;No Batch Job privileges (need to unstack)
   396	000215'	200600	000004	FRMCR0:	MOVE	P1,F		;Save value of CF.LOG (TTYNFR clobbers F)
   397	000216'	260040	000610'		PUSHJ	P,FRMASN	;ASSIGN A FRAME NUMBER
   398	000217'	254000	000430'		  JRST	FCRFCE		;Frame Capacity Exceeded (need to unstack)
   399	000220'	201300	002000		MOVEI	T1,SWPINP	;TO KEEP SWAPPER HAPPY
   400	000221'	436302	000000*		IORM	T1,JBTSTS(J)
   401	000222'	260040	000000*		PUSHJ	P,TTYNFR	;GET NEW DETACHED TTY DDB FOR FRAME
   402	000223'	254000	000450'		  JRST	FRMNCP		;Can't get it, (need to unstack)
   403								; TTYTAB(J) NOW SETUP WITH DDB.
   404
   405				;;	-- Privileges for creating batch jobs have already been checked --
   406	000224'	205300	400000		MOVSI	T1,JS.BAT	;Bit to indicate batch job
   407	000225'	602600	000030		TRNE	P1,(CF.BAT!CF.BBJ);Do we want any type batch job?
   408	000226'	436302	000000*		  IORM	T1,JBTST2##(J)	;Yes, set batch job indicator
   409	000227'	205300	001000		MOVSI	T1,JS.BBJ	;Bit to indicate background class
   410	000230'	602600	000020		TRNE	P1,(CF.BBJ)	;Do we want background batch?
   411	000231'	436302	000226*		  IORM	T1,JBTST2##(J)	;Yes, set bit for scheduler
   412
   413	000232'	606600	000005		TRNN	P1,(CF.LOG!CF.PLI);Do we want to run LOGINN?
   414	000233'	254000	000243'		  JRST	FRMCR2		;No
   415	000234'	205300	400000		MOVSI	T1,(1B0)	;Special flag to LOGINN
   416	000235'	602600	000004		TRNE	P1,(CF.PLI)	;Want to have LOGINN verify name and password?
   417	000236'	202300	000011		  MOVEM	T1,PSHARZ-<LOGTP0-CRESPC> ;Yes, set magic AUN
   418	000237'	205300	000004		MOVSI	T1,JLOG		;This is turned on now so that it
   419	000240'	436302	000221*		IORM	T1,JBTSTS(J)	; gets cleared later when complemented
   420	000241'	201300	000000*		MOVEI	T1,CMFCXN##	;Forced command index for .LOGIN
   421	000242'	260040	000000*		PUSHJ	P,COMWCM##	;Yes, force the command
   422				;;***NOTE*** COMCON will not try to process the .LOGIN as long as
   423				;;***NOTE*** SWPINP is set - gross, but...
   424
   425	000243'	403602	000000*	FRMCR2:	SETZB	P1,JBTCTX(J)	;P1 WILL CONTAIN LAST DISK ADDRESS ALLOCATED
   426	000244'	137600	000000*		DPB	P1,JBYMWS	;INIT MWS SIZE.
   427								; FOR CONTIGUITY.
   428								; CLEAR ALL FLAGS IN JBTCTX ENTRY.
   429	000245'	260040	000000*		PUSHJ	P,JOBATB	;GET DUMMY ATB ADDRESS
   430	000246'	205340	000000*		MOVSI	T2,ATPDUM	;SET DUMMY BIT FOR GETPAG
   431	000247'	436346	000000*		IORM	T2,ATBDUM(T1)
   432	000250'	205500	000000*		MOVSI	W,-NCTXPG	;WHICH ONE WE'RE WORKING ON
   433
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 6-3
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   434	000251'	201300	000000*	FRMCR4:	MOVEI	T1,MBIT		;JUST MAPPING BIT
   435	000252'	200340	000014		MOVE	T2,P1		;TO BE CONTIGUOUS
   436	000253'	260040	000245*		PUSHJ	P,JOBATB	;GET JOB'S ATB ADDRESS IN T1
   437	000254'	200400	000006		MOVE	T3,T1		;GET IT INTO T3
   438	000255'	201300	000251*		MOVEI	T1,MBIT
   439	000256'	260040	000604'		PUSHJ	P,FRMGTP	;GET A PAGE
   440	000257'	254000	000434'		  JRST	FRMNRD		;NO ROOM, GIVE BACK PAGES, FRAME SLOT AND GIVE ERROR RETURN
   441	000260'	137352	000000*		DPB	T2,CTXTAB(W)	;STORE.
   442	000261'	661340	000000*		TLO	T2,RBREAL	;FOR NEXT TIME
   443	000262'	200600	000007		MOVE	P1,T2
   444	000263'	253500	000251'		AOBJN	W,FRMCR4
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 7
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   445				;*** Start of duplicate code - This matches SWICSV in SCHED1.MAC
   446
   447				;NOW UPDATE THE DUMMY ATB COUNTS FOR THE CONTEXT PAGES ABOUT TO
   448				; BE MAPPED. NOTE THAT THE DUMMY ATB CAN STILL HAVE VALUES
   449				; IN IT FROM THE PREVIOUS OCCUPANT OF THE JOB NUMBER IF
   450				; SOME OTHER JOB HAS PRIVATE PAGES MAPPED FROM THAT
   451				; PREVIOUS OCCUPANT.
   452
   453	000264'	260040	000253*		PUSHJ	P,JOBATB	;NOW INIT THE JOB'S ATB
   454	000265'	201340	000000*		MOVEI	T2,NCTXPG	;THIS MANY SLOTS WILL BE MAX-WRITE
   455	000266'	272346	000000*		ADDM	T2,ATBMWC(T1) 	;THIS MANY MORE PAGES MAPPED WRITABLE.
   456	000267'	204346	000000*		MOVS	T2,ATBDUM&ATBUMC&ATBSTS(T1) ;GET SWAPPED COPY
   457	000270'	671340	003646'		TSO	T2,[ATPDUM,,ATPMXU] ;MAKE SURE DUMMY BIT IS ON, SET MXU
   458	000271'	271340	000265*		ADDI	T2,NCTXPG	;INCREASE ATBUMC BY NCTXPG.
   459	000272'	206346	000000*		MOVSM	T2,ATBDUM&ATBUMC&ATBSTS(T1)
   460								;SET THESE FIELDS
   461
   462	000273'	205300	200000		MOVSI	T1,CTXCEX	;SAY THEY EXIST FOR MAPUPX
   463	000274'	436302	000243*		IORM	T1,JBTCTX(J)
   464	000275'	260040	000000*		PUSHJ	P,MAPUPX
   465	000276'	256000	000000'		  STOPCD		;SHOULDN'T HAPPEN
   466	000277'	200300	003647'		MOVE	T1,[<CPRRDW>B7+<NCTXPG>B17+%UPX.N+CNVVPN]
   467	000300'	047300	777710		VPROT	T1,		;WRITE ENABLE THEM TO INIT THEM.
   468	000301'	256000	000000'		  STOPCD
   469	000302'	200300	003650'		MOVE	T1,[UPT,,%UPX]
   470	000303'	251300	000577*		BLT	T1,%UPX+UPTFSL-1	;COPY TRAP LOCS, PCS
   471				IFCPU (KL),<
   472	000304'	402000	000504*		SETZM	%UPX+UPTHEC
   473	000305'	402000	000505*		SETZM	%UPX+UPTLEC
   474	000306'	402000	000506*		SETZM	%UPX+UPTHMC
   475	000307'	402000	000507*		SETZM	%UPX+UPTLMC
   476				>;END IFCPU (KL)
   477	000310'	200300	003651'		MOVE	T1,[%UPX+UPTFSL,,%UPX+UPTFSL+1]
   478	000311'	402000	000600*		SETZM	%UPX+UPTFSL	;CLEAR OUT SOFTWRE LOCATIONS
   479	000312'	251300	000000*		BLT	T1,%UPX+UPTEND
   480	000313'	200300	000000*		MOVE	T1,PBMMSK	;SETUP PER PROCESS AREA BIT MASK
   481
   482	000314'	202300	000000*		MOVEM	T1,%UPX+UPTPBM	;USED FOR DYNAMIC ALLOC.
   483	000315'	200300	000000*		MOVE	T1,UPT+UPTACP	;GET AC STACK POINTER
   484	000316'	202300	000000*		MOVEM	T1,%UPX+UPTACP	;INIT THAT.
   485	000317'	550300	000000*		HRRZ	T1,AGENTV
   486	000320'	202300	000000*		MOVEM	T1,%UPX+UPTNTV	;FOR PAGE AGEING
   487
   488	000321'	201300	001000		MOVEI	T1,1000		;INIT UWS LIMIT AND MAX
   489	000322'	137300	000000*		DPB	T1,UXYUWM
   490	000323'	137300	000000*		DPB	T1,UXYUWL
   491	000324'	202100	000000*		MOVEM	J,%UPX+UPTJOB	;REMEMBER WHO THIS IS FOR.
   492	000325'	400300	000000		SETZ	T1,		;CLEAR UWS SIZE NOW.
   493	000326'	137300	000000*		DPB	T1,JBYUWS
   494	000327'	506302	000000*		HRLM	T1,JBTUPM(J)	;NUMBER OF EXISTENT PAGES TOO.
   495								;MWS SIZE ALREADY CLEARED IF THESE ARE NEW
   496								; (AS OPPOSED TO ERROR, THEN STILL NEED MWS SIZE TO DECREMENT S
   497				IPTOT.)
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 7-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   498
   499				; *** End of duplicate code (FRMSER uses %UPX, SCHED1 uses %UPS).
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 8
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   500				;NOW SETUP THE LMAP SLOTS FOR THE NEW FRAMES CONTEXT PAGES.
   501
   502	000330'	200500	003652'		MOVE	W,[-NCTXPG,,<%UPT.N+CNVVPN>]
   503
   504	000331'	205700	000000*	FRMCTP:	MOVSI	P3,<CPRRDW*LMPCUR>!LMPMXW ;READ WRITE, MAX WRITE
   505	000332'	135352	000000*		LDB	T2,CTXTAB-<%UPT.N+CNVVPN>(W) ;GET DP ADDRESS
   506	000333'	400740	000000		SETZ	P4,
   507	000334'	137340	000000*		DPB	T2,UP4LDA	;Set up P3,P4,W for SETLMX
   508	000335'	242340	000000*		LSH	T2,-LMASRP
   509	000336'	137340	000000*		DPB	T2,LM3HDA
   510	000337'	201302	000000*		MOVEI	T1,DABBIT(J)	;ATB POINTER
   511	000340'	137300	000000*		DPB	T1,LM3ATB	;PUT INTO THE ATB FIELD
   512	000341'	260040	000000*		PUSHJ	P,SETLMX	;STUFF THE SLOT INTO NEW FRAME'S LMAP SLOT
   513	000342'	253500	000331'		AOBJN	W,FRMCTP	;LOOP FOR ALL CONTEXT PAGES.
   514	000343'	205300	120000		MOVSI	T1,MRQ+JERR	;SET MRQ SO JOB WON'T RUN UNTIL HIS CTX PAGES ARE IN.
   515								;SET JERR SO STARTING CODE WON'T THINK
   516								; ITS IN THE MONITOR SOMEWHERE.
   517	000344'	436302	000240*		IORM	T1,JBTSTS(J)	;SET THESE BITS.
   518				;;***NOTE*** JLOG is in the opposite of the state that it wants to be in,
   519				;;***NOTE*** i.e., it wants to be turned on here unless a .LOGIN command
   520				;;***NOTE*** was forced.  Therefore it gets turned on when the command is
   521				;;***NOTE*** forced so that complementing it here always puts it in the
   522				;;***NOTE*** correct state.
   523	000345'	205300	000004		MOVSI	T1,JLOG
   524	000346'	432302	000344*		XORM	T1,JBTSTS(J)	;Sigh...
   525
   526				;Now store CREFRM arguments which are on the stack
   527
   528	000347'	402002	000000*		SETZM	JBTNM1##(J)	;Clear name associated with PPN
   529	000350'	402002	000000*		SETZM	JBTNM2##(J)
   530	000351'	201240	000000*		MOVEI	U,%UPX		;Store in new jobs UPT, not caller's UPT
   531
   532				;If batch job, license goes to JBTSLC(J) and 0 goes to JBTLIC(J)
   533				;If normal job, license goes to JBTSLC(J) and JBTLIC(J)
   534	000352'	262042	000000*		POP	P,JBTLIC(J)	;Set actual license on frame
   535	000353'	262042	000000*		POP	P,JBTSLC(J)	;Set potential license on frame
   536	000354'	201300	000010		MOVEI	T1,LOGTOP-1	;GET NUMBER OF ARGS TO POP OFF STACK
   537	000355'	262066	000000*		POP	P,@LOGTAB(T1)	;SET NEXT ARGUMENT INTO JBT TABLES.
   538	000356'	365300	000355'		SOJGE	T1,.-1
   539	000357'	260040	000000*		PUSHJ	P,CHGNAM##	;Make sure JBTNM1 and JBTNM2 match JBTPPN
   540	000360'	402002	000000*		SETZM	JBTPRG##(J)	;Core image did not come from any file yet
   541	000361'	200300	003653'		MOVE	T1,['------']
   542	000362'	202302	000000*		MOVEM	T1,JBTNAM##(J)	;Do SETNAM for SYSTAT
   543	000363'	205300	000400		MOVSI	T1,PVDINA	;Did we set the default inactivity
   544	000364'	616302	000000*		TDNN	T1,JBTPRV(J)	; timeout for the new frame?
   545	000365'	254000	000373'		 JRST	FRMCR6		;No, don't bother with this rot
   546	000366'	200340	000000*		MOVE	T2,JOB		;Get our parents number
   547	000367'	616307	000364*		TDNN	T1,JBTPRV(T2)	;Is there an inactivity timer set here?
   548	000370'	334300	000000*		 SKIPA	T1,INADEF##	;No, so use the system-wide default
   549	000371'	135300	000000*		  LDB	T1,JBYIN2##	;Yes, use my parent's timeout value
   550	000372'	137300	000000*		DPB	T1,JBYINA##	; and store it away for me.
   551	000373'	200300	003654'	FRMCR6:	MOVE	T1,[%UPT+UPTRNM##,,%UPX+UPTRNM##]
   552	000374'	251300	000000*		BLT	T1,%UPX+UPTRPN##;Copy restricted command program
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 8-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   553
   554	000375'	201300	002000		MOVEI	T1,SWPINP	;CAN TURN OFF SWPINP NOW, SWAPPER CAN HAVE IT.
   555	000376'	412302	000346*		ANDCAM	T1,JBTSTS(J)	;
   556	000377'	205300	040000		MOVSI	T1,JSTCTX	;SAVE SWAPPER SOME WORK
   557	000400'	436302	000274*		IORM	T1,JBTCTX(J)
   558	000401'	200300	000000*		MOVE	T1,%UPT+UPTJOB	;SETUP PARENT NUMBER
   559	000402'	260040	002724'		PUSHJ	P,ADCHLD	;ADD A CHILD TO THE FRAME TREE.
   560
   561				;SETUP RIGHTS OF PARENT TO SELF TO BE EVERYTHING.
   562
   563	000403'	200300	003511'		MOVE	T1,ALLMFR	;GET FAST ACCESS BITS
   564	000404'	202302	000000*		MOVEM	T1,JBTP2S(J)	;INITIALLY, PARENT HAS ALL RIGHTS
   565	000405'	202302	000000*		MOVEM	T1,JBTMFR(J)	;AND SO DOES EVERYONE ELSE
   566	000406'	200300	003655'		MOVE	T1,[ALLMFR+1,,%UPX+UPTMFR]
   567	000407'	251300	000000*		BLT	T1,%UPX+UPTMFR+.ARSIZ-1 ;COPY THE SLOW BITS
   568	000410'	200300	003656'		MOVE	T1,[ALLMFR+1,,%UPX+UPTP2S]
   569	000411'	251300	000000*		BLT	T1,%UPX+UPTP2S+.ARSIZ-1 ;ALL RIGHTS.
   570	000412'	200300	003657'		MOVE	T1,[<CPRRED>B7+<NCTXPG>B17+%UPX.N+CNVVPN]
   571	000413'	047300	777710		VPROT	T1,		;WRITE PROTECT THEM AGAIN
   572	000414'	256000	000000'		  STOPCD
   573
   574				;THE NEW FRAME'S CONTEXT PAGE LMAP SLOTS ARE UNSHARED, AND OUR %UPX
   575				; SLOTS WERE SHARED, SINCE THE M BITS WERE ON WHEN WE CALLED MAPUPX.
   576				; THE NEW FRAME'S CONTEXT PAGES WILL ALWAYS BE SHARED, AND THE
   577				; SPT USE COUNT WILL BE CORRECT BECAUSE MAPUPX USED THE NEW FRAME'S
   578				; ATB.
   579
   580				;WRITE LOGINN RECORD FOR THE NEW FRAME
   581
   582				;Before writing LOGINN record, check to see whether LOGINN
   583				; program will be run and do it for us.
   584	000415'	200302	000376*		MOVE	T1,JBTSTS(J)
   585	000416'	607300	000004		TLNN	T1,JLOG		;If JLOG is off
   586	000417'	254000	000425'		  JRST	FRMCRX		; don't write stream record, LOGINN will
   587	000420'	201300	000040		MOVEI	T1,40		;40 IS CODE FOR LOGINN RECORD
   588	000421'	260040	000000*		PUSHJ	P,WRTACR##	;WRITE IT
   589	000422'	201300	000000*		MOVEI	T1,RNQ##	;TAKE NEW FRAME OUT OF NULL QUEUE
   590	000423'	137300	000000*		DPB	T1,PJBSTS	;PUT INTO WAIT STATE FIELD
   591	000424'	260040	000000*		PUSHJ	P,REQUE##	;MAKE SCHEDULER MOVE IT INTO NEW QUEUE
   592								; (BUT MAYBE SOMEONE WILL START IT UP FIRST)
   593				;End of CREFRM uuo - return Frame Descriptor to parent
   594
   595	000425'	201302	100000	FRMCRX:	MOVEI	T1,.FDFAM+.FMCHL(J) ;GET FD FOR THE NEW CHILD
   596	000426'	256200	003660'		UMOVEM	T1,(P2)		;STORE IN AC
   597	000427'	254000	000204*		JRST	CPOPJ1		;AND GIVE SKIP RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 9
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   598				;ERROR EXITS FROM FRMCRE
   599
   600				;FRAME CAPACITY EXCEEDED
   601
   602	000430'	274040	003661'	FCRFCE:	SUB	P,[PSHARZ,,PSHARZ] ;GET ARGS OFF THE STACK
   603	000431'	254000	000460'		JRST	FCEFCE		;AND GIVE THAT ERROR CODE BACK TO USER
   604
   605				;NO PRIVS TO DO BATCH JOB
   606	000432'	274040	003661'	NBJFCE:	SUB	P,[PSHARZ,,PSHARZ] ;GET ARGS OFF THE STACK
   607	000433'	254000	000463'		JRST	FCENBJ		;AND GIVE APPROPRIATE ERROR CODE
   608
   609				;HERE IF RUN OUT OF DISK TRYING TO ALLOCATE CONTEXT PAGES FOR
   610				; THE NEW FRAME
   611
   612
   613	000434'	274040	003661'	FRMNRD:	SUB	P,[PSHARZ,,PSHARZ] ;GET ARGS OFF THE STACK
   614	000435'	571512	777777		HRREI	W,-1(W)		;GET C(W)-1 - LAST PAGE THAT WAS ALLOCATED.
   615	000436'	321500	000446'		JUMPL	W,FRMNR2	;JUMP IF COULDN'T EVEN GET FIRST ONE.
   616	000437'	135352	000260*	FRMNR1:	LDB	T2,CTXTAB(W)	;GET DISK PAGE WE ALLOCATED
   617	000440'	661340	000261*		TLO	T2,RBREAL	;MAKE IT ACCEPTABLE TO GIVPAG.
   618	000441'	260040	000000*		PUSHJ	P,FRMGVP##	;GIVE IT BACK
   619	000442'	200300	000000*		MOVE	T1,ADRNCT##	;SET TO "NO DISK PAGE" VALUE.
   620	000443'	137312	000437*		DPB	T1,CTXTAB(W)	;ZERO THE DISK ADDRESS NOW.
   621	000444'	365500	000437'		SOJGE	W,FRMNR1	;KEEP LOOPING TILL WE GIVE THEM ALL BACK
   622	000445'	260040	000000*		PUSHJ	P,RELSAT##	;GIVE LAST SAT SNATCHED BY FRMGVP BACK.
   623	000446'	260040	000457'	FRMNR2:	PUSHJ	P,FCENRD	;STORE ERROR CODE IN USER'S AC
   624	000447'	254000	000452'		JRST	FRMKJF		;AND DEALLOCATE THE FRAME SLOT
   625
   626				;HERE IF CAN'T ALLOCATE TTY DDB.
   627
   628	000450'	274040	003661'	FRMNCP:	SUB	P,[PSHARZ,,PSHARZ] ;GET ARGS OFF THE STACK
   629	000451'	260040	000462'		PUSHJ	P,FCENCP	;STORE NO COMMAND PORT ERROR INTO CALLER'S AC.
   630
   631				;HERE WITH ERROR CODE ALREADY STORED IN USER AC TO DEALLOCATE THE FRAME
   632				; SLOT.
   633
   634	000452'	200300	003662'	FRMKJF::MOVE	T1,[JNA,,SWPINP] ;TURN OFF JNA AND SWPINP
   635	000453'	412302	000415*		ANDCAM	T1,JBTSTS(J)
   636	000454'	260040	000000*		PUSHJ	P,CLRJBT	;CLEAR OUT STUFF WE SET
   637	000455'	260040	000000*		PUSHJ	P,TTYKIL##	;GET RID OF TTY DDB.
   638	000456'	324740	000000*		PJRST	DECHJB		;UPDATE HIGHJB IF NECESSARY AND GIVE USER THE ERROR RETURN.
   639
   640				;ERROR RETURNS
   641
   642	000457'			FCETAB:
   643	000457'	265300	000464'	FCENRD:	JSP	T1,FCEJSP	;(0)NO DISK ROOM
   644	000460'	265300	000464'	FCEFCE:	JSP	T1,FCEJSP	;(1)FRAME CAPACITY EXCEEDED
   645	000461'	265300	000464'	FCEBDA:	JSP	T1,FCEJSP	;(2)BAD ARG (NO LICENSE AND DOESN'T MATCH CALLERS PARAMETER)
   646	000462'	265300	000464'	FCENCP:	JSP	T1,FCEJSP	;(3)CANNOT CREATE COMMAND PORT (DDB)
   647	000463'	265300	000464'	FCENBJ:	JSP	T1,FCEJSP	;(4)NO PRIVS TO CREATE BATCH JOB
   648	000464'	275300	000460'	FCEJSP:	SUBI	T1,FCETAB+1
   649	000465'	256200	003663'		XCTTU	<HRRZM T1,(P2)>	;STORE ERROR CODE INTO USER'S AC
   650	000466'	263040	000000		POPJ	P,		;AND GIVE ERROR RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 10
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   651				;Set LDBLOG from UPTLOG if LDBLOG is zero
   652				;Called with target frame number in J, LDB address in U
   653
   654	000467'	261040	000012	LOGLDB::PUSH	P,W		;Save ACs
   655	000470'	261040	000003		PUSH	P,PG
   656	000471'	316100	000000*		CAMN	J,%UPX+UPTJOB	;Is required info already there?
   657	000472'	254000	000475'		 JRST	LOGLD1		;Yes
   658	000473'	260040	000275*		PUSHJ	P,MAPUPX##	;Map target's context pages in UPX
   659	000474'	634300	000006		  TDZA	T1,T1		;Couldn't
   660	000475'	414300	000000*	LOGLD1:	SWAPIN	T1,%UPX+UPTLOG##;Get data that CREFRM stored for us
   661	000476'	200340	003664'		MOVE	T2,[BYTE(4)0(8)0,377,377,0] ;Mask for node number
   662	000477'	616345	000000*		TDNN	T2,LDBLOG##(U)	;If not set already,
   663	000500'	202305	000477*		 MOVEM	T1,LDBLOG##(U)	; store for jobs running on PTYs
   664	000501'	262040	000003		POP	P,PG
   665	000502'	262040	000012		POP	P,W		;Restore ACs
   666	000503'	263040	000000		POPJ	P,
   667
   668				COMMENT ;@@SUBROUTINE PSHARG
   669				@@PURPOSE PUSH ARGS FOR CREFRM UUO ONTO THE STACK SO DON'T PAGE
   670				FAULT OR GET I/O ERRORS FOR THEM DURING CRITICAL CODE.
   671				@@ENTRY	J/FRAME NUMBER OF CURRENT FRAME (EXECUTER OF CREFRM UUO)
   672				@@ACCUM T1-T4,M,W,F
   673				@@EXIT ERROR RETURN IF NOT LICENSED AND NOT SETTING UP ARGS
   674					TO EXACTLY CORRESPOND TO THE CALLER'S FRAME PARAMETERS
   675				SKIP RETURN IF OK, WITH ALL 10 ARGS PUSHJED ON STACK:
   676					PPN
   677					JBTPRV WORD
   678					AUN
   679					USER NAME WORD 1
   680					USER NAME WORD 2
   681					SUPERVISOR DATA (LDBLOG/UPTLOG)
   682					PROJECT CODE WORD 1
   683					PROJECT CODE WORD 2
   684					PROJECT CODE WORD 3
   685
   686				ALL UNSPECIFIED ARGS ARE SETUP TO BE THE CALLER'S.
   687				PLUS
   688					RH<JBTLIC>
   689				IF CF.LIC IS SET.
   690				Returns with LH<F> = LICJAL bit copied from caller's JBTLIC word,
   691				 RH<F> = caller's flag bits (if new style).
   692				@@;
   693
   694	000504'	262040	000012	PSHARG:	POP	P,W		;RETURN IS IN W
   695	000505'	510202	000352*		HLLZ	F,JBTLIC(J)	;Leave F<>0 iff caller has JL license
   696	000506'	621200	776777		TLZ	F,-1-LICJAL	;AC NOT GOOD ENUF, WE'RE IGNORING QUOTAS
   697	000507'	256200	003665'		UMOVE	T2,(M)		;GET AOBJN POINTER FROM USER SPACE
   698	000510'	327340	000514'		JUMPG	T2,PSHAR0	;Jump if new-style CREFRM
   699	000511'	550540	000007		HRRZ	M,T2		;Copy addr of user's arg block
   700	000512'	574400	000007		HLRE	T3,T2		;GET -VE COUNT IN RH OF T3
   701	000513'	254000	000517'		JRST	PSHAR1
   702
   703	000514'	544200	000007	PSHAR0:	HLR	F,T2		;Copy user's flag bits
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 10-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   704	000515'	201553	000001		MOVEI	M,1(M)		;Point to first user arg
   705	000516'	211407	000000		MOVNI	T3,(T2)		;Get -count in RH of T3
   706	000517'	312400	003666'	PSHAR1:	CAME	T3,[CRESPC-LOGTP1] ;Cannot have 1 word project code
   707	000520'	316400	003667'		CAMN	T3,[CRESPC-LOGTP2] ;Cannot have 2 word project code
   708	000521'	254000	000560'		 JRST	PSHERR		;Illegal number of arguments
   709	000522'	505540	777767		HRLI	M,-LOGTOP	;GET COUNT OF SPECIFIABLE ARGS IN LH OF M
   710								;ADDRESS IS ALREADY IN RH(M)
   711	000523'	205410	777777		MOVSI	T3,-1(T3)	;MAKE ONE MORE NEGATIVE, AOBJN IS FIRST.
   712								; RH OF T3 IS FOR INDEXING LOGTAB.
   713	000524'	253400	000526'	PSHAR2:	AOBJN	T3,.+2		;IF ANY USER ARG LEFT,
   714	000525'	334330	777777*		SKIPA	T1,@LOGTAB-1(T3)	;USER DIDN'T SAY, USE HIS OWN
   715	000526'	256200	003670'		 UMOVE	T1,(M)		;THERE IS ANOTHER ONE LEFT, GET IT
   716	000527'	602200	000004		TRNE	F,(CF.PLI)	;Going to have LOGINN validate everything?
   717	000530'	254000	000537'		 JRST	PSHAR3		;Yes, ignore user's arguments
   718	000531'	312330	777777*		CAME	T1,@LOGTAB-1(T3) ;SAME AS HIS OWN?
   719	000532'	603200	001000		 TLNE	F,LICJAL	;No, has license maybe?
   720	000533'	254000	000537'		  JRST	PSHAR3		;Same arg or has license
   721				;Argument mismatch with no JL license, check special cases
   722	000534'	550340	000010		HRRZ	T2,T3		;Copy argument index (1 through 9)
   723	000535'	256007	000563'		XCT	CRESPC-1(T2)	;Perform argument-specific check
   724	000536'	254000	000560'		  JRST	PSHERR		;Wrong arg or no secondary match, no go
   725	000537'	261040	000006	PSHAR3:	PUSH	P,T1		;ARG IS OK, PUT IT ON STACK
   726	000540'	253540	000524'		AOBJN	M,PSHAR2	;AND GO FOR ANOTHER ONE
   727	000541'	557000	000010		HLRZS	T3		;ENSURE THAT M POINTS
   728	000542'	331000	000010		SKIPL	T3		; TO LOCATION AFTER
   729	000543'	275550	000001		SUBI	M,1(T3)		; LOGTAB ARG BLOCK
   730	000544'	256200	003671'		UHRRZ	T1,(M)		;GET FRAME LIC USER WANTS TO PASS
   731	000545'	544342	000505*		HLR	T2,JBTLIC(J)	;GET PARENT'S PROCESS LIC
   732	000546'	620340	002040		TRZ	T2,LICRMT!LICHR	;TURN OFF HF and HR,  AND? what about WA-RP?
   733	000547'	404300	000007		AND	T1,T2		;CLEAR LIC THAT PARENT CAN'T PASS
   734	000550'	606200	000002		TRNN	F,(CF.LIC)	;WANT TO PASS FRAME LIC?
   735	000551'	400300	000000		  SETZ	T1,		;No, so clear license
   736	000552'	261040	000006		PUSH	P,T1		;STACK IT AWAY (saved license)
   737	000553'	606200	000030		TRNN	F,(CF.BAT!CF.BBJ);Creating a batch job?
   738	000554'	606200	000002		TRNN	F,(CF.LIC)	;No, Want to pass frame license?
   739	000555'	400300	000000		  SETZ	T1,		;No, or a batch job, so clear it
   740	000556'	261040	000006		PUSH	P,T1		;STACK IT AWAY (enabled license)
   741	000557'	254012	000001		JRST	1(W)		;GIVE SKIP RETURN.
   742
   743	000560'	275400	000001	PSHERR:	SUBI	T3,1		;CONVERT TO NUMBER PUSHED
   744	000561'	507000	000010		HRLS	T3		;GET #PUSHED,,#PUSHED
   745	000562'	274040	000010		SUB	P,T3		;FIX POINTER UP
   746	000563'	254012	000000		JRST	(W)		;AND GIVE ERROR RETURN.
   747
   748				; Execute table for special-case check when caller has no
   749				; license and arguments don't match caller's job table entries.
   750	000564'	312302	000000*	CRESPC:	CAME	T1,JBTAUN(J)	;PPN (can also match AUN)
   751	000565'	260040	000575'		PUSHJ	P,PSHPRV	;JBTPRV word
   752	000566'	255000	000000	LOGTP0:	JFCL			;AUN must match if no license
   753	000567'	255000	000000		JFCL			;User name word 1 must match if no license
   754	000570'	255000	000000		JFCL			;User name word 2 must match if no license
   755	000571'	255000	000000		JFCL			;Tymnet supervisor data
   756	000572'	334000	000000	LOGTP1:	SKIPA			;Project code word 1 can be different
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 10-3
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   757	000573'	334000	000000	LOGTP2:	SKIPA			;Project code word 2 can be different
   758	000574'	334000	000000		SKIPA			;Project code word 3 can be different
   759			000011	XP LOGTOP,.-CRESPC	;LINK will complain if this value does not match UUOCON
   760			000013	PSHARZ==LOGTOP+2	;This includes the *** 2 LICENSE words ***
   761
   762	000575'	200340	000006	PSHPRV:	MOVE	T2,T1		;Copy caller's arg
   763	000576'	430342	000367*		XOR	T2,JBTPRV(J)	;T2 has bits that differ
   764	000577'	420340	000000*		ANDCM	T2,PRVMSK##	;Clear bits which may legally differ
   765	000600'	331002	000576*		SKIPL	JBTPRV(J)	;Check if LogoutOnStop *WAS* set
   766	000601'	621340	400000		 TLZ	T2,PVLOS	; if not - its legal to set it
   767	000602'	322340	000427*		JUMPE	T2,CPOPJ1	;If no illegal different bits,
   768	000603'	263040	000000		POPJ	P,		; else error
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 11
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   769				COMMENT ;@@SUBROUTINE FRMGTP
   770				@@PURPOSE GET A DISK PAGE FOR CREFRM UUO
   771				@@ENTRY SAME AS GETPAG
   772				@@ACCUM SAME AS GETPAG
   773				@@EXIT NON-SKIP IF CAN'T ALLOCATE, SKIP IF CAN, PAGE IN T2
   774				@@;
   775
   776
   777				PRINTF(<[FRMGTP Needs to use DRBSTR for free disk page for CREFRM UUO]>)
   778	000604'	201440	000000*	FRMGTP:	MOVEI	T4,SRPNDS##	;IF DSKCLN HASN'T RUN YET
   779	000605'	612440	000000*		TDNE	T4,STRDDB##+STRBTS##
   780					  JRST	[MOVE T2,ADRDUM##
   781	000606'	254000	003672'			 POPJ P,]	;JUST GIVE DUMMY DISK ADDRESS AND RETURN
   782	000607'	324740	000000*		PJRST	GETPAG##	;OTHERWISE, CALL GETPAG.
   783
   784				EXTERNAL FRMGVP			;SEE SWAMP FOR THIS ROUTINE.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 12
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   785				COMMENT ~@@SUBROUTINE FRMASN
   786				@@PURPOSE: ASSIGN A NEW FRAME NUMBER
   787				@@ENTRY: NO INPUT PARAMS
   788				@@ACCUM: T1,J
   789				@@EXIT: Non-skip if all frames in use.
   790				@@	Skip with frame number in J, job tables cleared, JBTUID setup.
   791				@@~
   792
   793	000610'	200100	003674'	FRMASN::MOVE	J,[-JOBMAX,,1]
   794	000611'	205300	240002	FRMAS1:	MOVSI	T1,JNA+CMWB+JRQ	;Assigned ! Cmd needs core ! Requeue
   795	000612'	612302	000453*		TDNE	T1,JBTSTS(J)	;Find a free frame number
   796	000613'	253100	000612'		AOBJN	J,.-1
   797	000614'	325100	000202*		JUMPGE	J,CPOPJ		;Frame capacity exceeded
   798	000615'	135300	000423*		LDB	T1,PJBSTS	;Get job wait state/queue
   799	000616'	332002	000612*		SKIPE	JBTSTS(J)	; 0 == never been used (.gt. HIGHJB)
   800	000617'	306300	000000*		CAIN	T1,NULQ##	;Is it in the NULL queue
   801	000620'	254000	000627'		 JRST	FRMAS2		;Yes, continue...
   802	000621'	350000	000000*		AOS	BADQUE##	;No, I think this is fatal but only
   803	000622'	200300	000000*		MOVE	T1,UPTIME##	; increment a flag for now!!!
   804	000623'	202300	000001*		MOVEM	T1,BADQUE+1	;Save uptime in case of crash
   805	000624'	506100	000621*		HRLM	J,BADQUE	;Save frame we tried this with
   806	000625'	253100	000611'		AOBJN	J,FRMAS1	;Try another frame...
   807	000626'	263040	000000		POPJ	P,		;Ooops!  None left - just return
   808
   809	000627'	621100	777777	FRMAS2:	TLZ	J,-1		;Clear out count for HIGHJB compare
   810	000630'	205300	040000		MOVSI	T1,JNA		;Job Number Assigned
   811	000631'	202302	000616*		MOVEM	T1,JBTSTS(J)	;Is now allocated
   812	000632'	260040	000454*		PUSHJ	P,CLRJBT	;Clear job tables
   813	000633'	402002	000146*		SETZM	JBTPNT##(J)	;Parent to child ints (not zeroed by CLRJBT)
   814	000634'	200300	000000*		MOVE	T1,DATE##	;Get current UDT date
   815	000635'	317300	000000*		CAMG	T1,SYSUID	;Make sure it's greater than last UID
   816	000636'	354300	000635*		  AOSA	T1,SYSUID	;No, Get next unique universal frame id
   817	000637'	202300	000636*		MOVEM	T1,SYSUID	;Ok, Set next unique universal frame id
   818	000640'	202302	000000*		MOVEM	T1,JBTUID(J)	;Store it for user
   819	000641'	474300	000000		SETO	T1,		;Initially allow infinite VM
   820	000642'	137300	000000*		DPB	T1,PVYCOR##	;Up to caller to adjust
   821								;***NOTE*** CREFRM UUO will over-write
   822								;***NOTE*** this field from caller's
   823								;***NOTE*** arg block - LOGIN command
   824								;***NOTE*** needs it to run LOGIN CUSP.
   825	000643'	313100	000000*		CAMLE	J,HIGHJB	;If newly-assigned frame number higher
   826	000644'	202100	000643*		MOVEM	J,HIGHJB	; than previous highest, set new highest
   827	000645'	324740	000602*		PJRST	CPOPJ1		;Give good return
   828
   829				;FRMDSN - Called from KSTOP to turn off JNA
   830				COMMENT ~@@SUBROUTINE FRMDSN
   831				@@PURPOSE: DEASSIGN A FRAME NUMBER AT KJOB TIME
   832				@@ENTRY: J HAS # OF FRAME LOGGING OUT
   833				@@ACCUM: T1,J
   834				@@EXIT: NON-SKIP ALWAYS.
   835				@@~
   836
   837	000646'	200300	000651'	FRMDSN::MOVE	T1,JSCLR	;Clear JNA and other special bits
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 12-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCFM=1 Create frame

   838	000647'	412302	000631*		ANDCAM	T1,JBTSTS##(J)
   839	000650'	263040	000000		POPJ	P,		;Note: NOPRNT & TKCHLD have already been called
   840
   841	000651'	040005	300500	JSCLR:	XWD JNA+JLOG+JACCT,JACCT2+KJP+WAKFLG+EXCFLG ; "SPECIAL" JBTSTS BITS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 13
FRMSER.MAC	 8-DEC-87 16:09		.FORVA=2 Read a virtual address

   842				SUBTTL	.FORVA=2 Read a virtual address
   843				SUBTTL	.FOWVA=3 Write a virtual address
   844
   845				COMMENT #	READ/WRITE ANOTHER FRAME'S ADDRESS SPACE
   846
   847				CALLING FORMAT:
   848
   849					MOVE	AC,[FN,,FD]	;FN = .FORVA,.FOWVA
   850					FRMOP	AC,<BLOCK>
   851					  <ERROR RETURN> 	;CODE IN AC
   852					<SUCCESS RETURN>
   853
   854				BLOCK:	<ADDRESS>
   855					<DATA>
   856
   857				IF LARGE QUANTITIES OF DATA ARE TO BE TRANSFERRED,
   858				THE PROGRAM SHOULD REPLICATE THE PAGES INTO ITS ADDRESS SPACE
   859				AND PERFORM THE TRANSFER. THESE FUNCTIONS ARE ONLY PROVIDED TO
   860				ALLOW READING AND WRITING MEMORY LOCATIONS AND ACS WITH MINIMUM
   861				SETUP TIME.
   862					#
   863
   864				EXTERNAL LMMERR,LMPNER
   865				EXTERNAL UPTUAC,%COW,%COW.N,%UPLMA
   866
   867	000652'	256200	003675'	FRMRVA::UHRRZ	U,(M)		;GET ADDRESS IN U
   868	000653'	303240	000017		CAILE	U,17		;SKIP IF REGISTERS
   869	000654'	254000	000676'		JRST	FRMRVM		;ITS TO MEMORY
   870	000655'	201700	000046		MOVEI	P3,.ARRAC	;THE CAPABILITY
   871	000656'	260040	003042'		PUSHJ	P,FDWUPX
   872	000657'	254000	000674'		  JRST	FRVERR		;SOMETHING WRONG, CODE IN P3
   873	000660'	200305	000000*		MOVE	T1,%UPX+UPTUAC(U) ;GET FRAME'S AC (IF SELF, GET OLD ACS)
   874	000661'	256200	003676'		UMOVEM	T1,1(M)		;STORE IN ARG BLOCK
   875	000662'	254000	000645*		JRST	CPOPJ1		;AND RETURN.
   876
   877	000663'	256200	003675'	FRMWVA::UHRRZ	U,(M)		;GET ADDRESS IN U
   878	000664'	303240	000017		CAILE	U,17		;SKIP IF IN REGISTERS
   879	000665'	254000	000704'		JRST	FRMWVM		;NOT, DO IT TO MEMORY
   880	000666'	201700	000047		MOVEI	P3,.ARWAC	;WRITE ACS ACCESS CODE
   881	000667'	260040	003042'		PUSHJ	P,FDWUPX
   882	000670'	254000	000674'		  JRST	FRVERR		;COMETHING WRONG, CODE IN P3
   883	000671'	256200	003677'		UMOVE	T1,1(M)		;GET DATA TO WRITE
   884	000672'	202305	000000*		MOVEM	T1,%UPX+UPTUAC(U)	;STORE INTO USER'S AC
   885	000673'	254000	000662*		JRST	CPOPJ1		;AND RETURN.
   886
   887	000674'	256200	003643'	FRVERR:	UMOVEM	P3,(W)
   888	000675'	263040	000000		POPJ	P,
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 14
FRMSER.MAC	 8-DEC-87 16:09		.FOWVA=3 Write a virtual address

   889				;HERE IF READING OR WRITING NON-REGISTER MEMORY
   890
   891	000676'	256200	003700'	FRMRVM:	XCTBU	<SETMM 1(M)>	;IN CASE ITS COW, WE'RE USING %COW.
   892	000677'	400000	000000		SETZ	S,		;INDICATE A READ
   893	000700'	260040	000706'		PUSHJ	P,FRMXVM	;DO THE WORK, GET THE DATA
   894	000701'	254000	000674'		  JRST FRVERR		;STORE ERROR CODE AND RETURN.
   895	000702'	256200	003676'		UMOVEM	T1,1(M)		;OK GIVE THE DATA TO CALLER
   896	000703'	254000	000673*		JRST	CPOPJ1		;AND RETURN.
   897
   898	000704'	256200	003677'	FRMWVM:	UMOVE	T1,1(M)		;GET DATA
   899	000705'	205000	000020		MOVSI	S,IO		;INDICATE WRITE
   900				;	PJRST	FRMXVM
   901
   902	000706'	607000	000020	FRMXVM:	TLNN	S,IO		;IF READ,
   903	000707'	334400	003701'		SKIPA	T3,[<CPRRED>B7!1B17+%COW.N+CNVVPN] ;THEN MAP IT READ ONLY
   904	000710'	200400	003702'		MOVE	T3,[<CPRRDW>B7!1B17+%COW.N+CNVVPN] ;ELSE MAP IT WRITEABLE
   905	000711'	135440	003703'		LDB	T4,[POINT 9,U,26] ;PAGE NUMBER
   906	000712'	661440	200000		TLO	T4,OTFFLG	;INDICATE THAT ITS THE "OTHER" FRAME
   907	000713'	200340	000017		MOVE	T2,P4		;GET FD IN RH OF T2
   908	000714'	505340	000007		HRLI	T2,.FOREP	;REPLICATE
   909	000715'	044340	000010		FRMOP	T2,T3		;DO THE REPLICATE
   910	000716'	254000	000736'		  JRST	FRMXVE		;ERROR.
   911	000717'	205340	000000*		MOVSI	T2,LMPNER	;IGNORE ERROR BIT
   912	000720'	436340	000000*		IORM	T2,%UPLMA+%COW.N+CNVVPN ;SET IT.
   913	000721'	405240	000777		ANDI	U,777		;LOCATION WITHING PAGE
   914	000722'	607000	000020		TLNN	S,IO		;IF READ,
   915	000723'	334305	000000*		SKIPA	T1,%COW(U)	;THEN PICK UP DATE
   916	000724'	202305	000723*		MOVEM	T1,%COW(U)	;ELSE STORE DATA.
   917								;HAD BETTER NOT FAIL - WHAT ABOUT I/O ERRORS?
   918	000725'	205400	000000*		MOVSI	T3,LMMERR	;MAKE SURE NOT ERRORS HAPPENED
   919	000726'	612400	000000*		TDNE	T3,%UPLMA+%COW.N+CNVVPN ;DID THEY?
   920	000727'	254000	000734'		JRST	FRVIOE		;YES, GIVE I/O ERROR CODE
   921	000730'	200400	003704'		MOVE	T3,[1B17+%COW.N+CNVVPN]
   922	000731'	047400	777712		VCLEAR	T3,
   923	000732'	256000	000000'		  STOPCD		;SHOULD NOT HAPPEN.
   924	000733'	254000	000703*		JRST	CPOPJ1		;DONE, SUCCESS.
   925
   926	000734'	201700	000017	FRVIOE:	MOVEI	P3,FEIOE%	;I/O ERROR
   927	000735'	254000	000674'		JRST	FRVERR		;STORE ERROR CODE AND RETURN.
   928
   929	000736'	135700	003705'	FRMXVE:	LDB	P3,[POINT 6,T2,5] ;GET SUBCODE
   930	000737'	326700	000674'		JUMPN	P3,FRVERR	;IF NON-ZERO, THAT'S THE ERROR CODE.
   931	000740'	201700	000016		MOVEI	P3,FEADB%	;OTHERWISE INDICATE REPLICATE FAILURE
   932	000741'	254000	000674'		JRST	FRVERR		;AND GO.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 15
FRMSER.MAC	 8-DEC-87 16:09		.FOSAA=4 Start at absolute address

   933				SUBTTL	.FOSAA=4 Start at absolute address
   934				COMMENT # HERE ON START FRAME AT ABSOLUTE ADDRESS FUNCTION.
   935				FRAME DESCRIPTOR IS IN P4. FORMAT OF THE UUO CALL IS
   936
   937					MOVE	AC,[FN,,FD]
   938					FRMOP	AC,ADDR
   939					  <ERROR>
   940					<SUCCESS>
   941
   942				ADDR:	STARDI,,ADDRESS.
   943
   944				IF STARDI IS SET, THE ADDRESS IS THE ACTUAL ADDRESS TO START THE FRAME
   945				AT. IF STARDI IS ZERO, THE ADDRESS IS THE ADDRESS OF THE ADDRESS IN
   946				THE TARGET FRAME WHERE THE ADDRESS IS TO BE FOUND.
   947				(STARDI IS DEFINED TO BE 1B0 IN COMCON - STARCL IS 1B1).
   948				(USEFUL FOR STARTING AT START ADDRESS IN .JBSA, .JBDDT, .JBREN, ETC.
   949				OF TARGET FRAME.
   950				#
   951
   952				EXTERNAL UPTSTS,STARTX,MONJBX,JBTLIC,JBTSLC,UPTPID,UPTSPD,UPTPC,JBTSTS
   953				EXTERNAL UPTXAC,PJBSTS,UPSPSR,UPNPSR,TIOWQ,SLPQ,STRTAD,SETRUN,STRTCL
   954				EXTERNAL STARDI,STARCL
   955
   956	000742'	256200	003706'	FRMSAA:	UMOVE	P1,(M)		;E POINTS TO STARDI,,ADDRESS.
   957	000743'	621600	000000*		TLZ	P1,STARCL	;DON'T LOOK AT INCREMENT BIT USED IN FRMSVA
   958	000744'	201640	000004		MOVEI	P2,4		;STREAM ACCOUNTING RECORD TYPE TO WRITE.
   959	000745'	201700	000001		MOVEI	P3,.ARSAA	;MUST HAVE ABILITY TO START AT ABSOLUTE ADDRESS.
   960
   961	000746'	260040	003042'		PUSHJ	P,FDWUPX	;GET CONTEXT PAGES
   962	000747'	324740	000674'		  PJRST	FRVERR		;COULD NOT, GIVE ERROR
   963	000750'	507302	000545*		HRLS	T1,JBTLIC(J)	;RESET PROCESS LICENSE TO FRAME LICENSE
   964	000751'	506302	000353*		HRLM	T1,JBTSLC(J)	;AND SAVED LICENSE TOO
   965	000752'	402000	000000*		SETZM	%UPX+UPTPID	;GET RID OF PID AND
   966	000753'	402000	000000*		SETZM	%UPX+UPTSPD	;SAVED PID.
   967	000754'	324740	001007'		PJRST	FRMSTR		;DO THE WORK.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 16
FRMSER.MAC	 8-DEC-87 16:09		.FOSVA=22 Start frame at start vector address

   968				SUBTTL	.FOSVA=22 Start frame at start vector address
   969
   970				COMMENT #
   971				CALL IS:
   972
   973					MOVE	AC,[FN,,FD]
   974					FRMOP	AC,ADDR
   975					  <ERROR>
   976					<SUCCESS>
   977				ADDR:	-VE JOB DATA AREA START VECTOR NUMBER OR
   978					  POSITIVE USER SPECIFIED START VECTOR NUMBER
   979				#
   980
   981	000755'	256200	003706'	FRMSVA:	UMOVE	P1,(M)		;GET NUMBER
   982	000756'	201700	000000		MOVEI	P3,.ARSVA	;NEED TO BE ABLE TO DO THIS MUCH
   983	000757'	260040	003042'		PUSHJ	P,FDWUPX	;LOCK UPX AND SEE IF CAN
   984	000760'	324740	000674'		  PJRST	FRVERR		;NO, CANNOT
   985	000761'	201640	000004		MOVEI	P2,4		;START RECORD TYPE
   986	000762'	325600	001000'		JUMPGE	P1,FRMSV1	;JUMP IF SPECIFYING USER ONE
   987	000763'	271600	000001		ADDI	P1,1		;TURN FROM -N TO -N+1 = -(N-1)
   988	000764'	217000	000014		MOVMS	P1		;TURN INTO N-1
   989	000765'	301600	000005		CAIL	P1,JDSVLN	;CHECK RANGE
   990	000766'	254000	003626'		 JRST	FEWBSV		;BAD START VECTOR OFFSET
   991	000767'	306600	000004		CAIN	P1,JDSVCO	;IS IT CONTINUE?
   992	000770'	254000	001437'		 JRST	FRMCO0		;YES, DO A CONTINUE.
   993	000771'	200614	000773'		MOVE	P1,JDSVTB(P1)	;GET USER LOC TO GET START ADDR FROM
   994	000772'	324740	001007'		PJRST	FRMSTR		;AND DO THE WORK.
   995
   996	000000			JDSVTB:	phase 0
   997	000773'	000000	000000*		.JBSA##			;(-1) NORMAL START ADDRESS
   998	000774'	000000*	000773*	JDSVCL:	STARCL,,.JBSA		;(-2) CCL START ADDRESS
   999	000775'	000000	000000*		.JBREN##		;(-3) REENTER ADDRESS
  1000	000776'	000000	000000*		.JBDDT##		;(-4) DDT START ADDRESS
  1001	000777'	000000	000000	JDSVCO:	0			;(-5) CONTINUE POINT.
  1002	000005			JDSVLN:				;table length
  1003	001000'				dephase
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 17
FRMSER.MAC	 8-DEC-87 16:09		.FOSVA=22 Start frame at start vector address

  1004				;HERE IF WANTS TO START IN USERS START VECTOR
  1005
  1006				EXTERNAL UPTSTV
  1007
  1008	001000'	336300	000000*	FRMSV1:	SKIPN	T1,%UPX+UPTSTV	;GET START VECTOR WORD
  1009	001001'	322300	003626'		JUMPE	T1,FEWBSV	;BAD START VECTOR OFFSET - NO START VECTOR!
  1010	001002'	554340	000006		HLRZ	T2,T1		;GET COUNT
  1011	001003'	311600	000007		CAML	P1,T2		;SKIP IF OFFSET LESS THAN MAX+1
  1012	001004'	254000	003626'		JRST	FEWBSV		;OFFSET IS NO GOOD.
  1013	001005'	271606	000000		ADDI	P1,(T1)		;OK, GET ADDRESS IN USER'S SPACE TO START THRU
  1014	001006'	621600	000000*		TLZ	P1,STARDI!STARCL!-1 ;GET RID OF POSSIBLE JUNK
  1015					PFALL	FRMSTR		;AND START THE FRAME UP THERE.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 18
FRMSER.MAC	 8-DEC-87 16:09		.FOSVA=22 Start frame at start vector address

  1016				;HERE FROM ALL START FRAME FUNCTIONS TO DO THE WORK. THE CODE
  1017				; STARTS THE SAME MONITOR JOB IN THE TARGET FRAME AS COMCON
  1018				; DOES WHEN A FRAME'S COMMAND PORT PERFORMS A START COMMAND.
  1019				; THIS MAKES IT EASIER TO SET JOBOPC, FETCH A START ADDRESS
  1020				; FROM THE TARGET FRAMES ADDRESS SPACE, ETC.
  1021
  1022	001007'	335002	000647*	FRMSTR:	SKIPGE	JBTSTS(J)	;MAKE SURE RUN BIT IS OFF
  1023	001010'	254000	003614'		JRST	FEWALR		;ALREADY RUNNING ERROR RETURN.
  1024	001011'	200300	000000*		MOVE	T1,%UPX+UPTPC	;GET OLD PC
  1025	001012'	607300	010000		TLNN	T1,PC.USR	;IN USER MODE ALREADY?
  1026	001013'	254000	001023'		JRST	FRSNUM		;NO, MAY HAVE TO SET UTRP
  1027	001014'	202600	000000*	FRSST1:	MOVEM	P1,%UPX+UPTXAC+T3 ;STARTX EXPECTS NEW PC IN T3 WHEN ITS MONJOB RUNS
  1028	001015'	200300	000000*		MOVE	T1,%UPX+UPTPC	;OLD PC
  1029	001016'	202300	000000*		MOVEM	T1,%UPX+UPTXAC+T4	;IS EXPECTED IN T4
  1030	001017'	202640	000000*		MOVEM	P2,%UPX+UPTXAC+P4	;ACCT CODE IN P4
  1031	001020'	201340	000000*		MOVEI	T2,STARTX	;END OF START CODE IN COMCON
  1032	001021'	350001	000000		AOS	(P)		;SKIP RETURN, WE SUCCEEDED.
  1033	001022'	324740	000000*		PJRST	MONJBX		;AND START MONITOR JOB FOR OTHER FRAME.
  1034
  1035				;HERE IF CANNOT START THE FRAME UP RIGHT AWAY SET A UTRP TO DO SO
  1036				; IF NOT OK TO START FROM EXEC MODE.
  1037				; PC TO START IS IN P1, STREAM RECORD TYPE TO WRITE IS IN P2.
  1038
  1039	001023'	200302	001007*	FRSNUM:	MOVE	T1,JBTSTS(J)	;GET THIS
  1040	001024'	612300	003707'		TDNE	T1,[JERR,,JDCON] ;IF THESE SET, OK TO START
  1041	001025'	254000	001014'		JRST	FRSST1		;JUST START NORMALLY
  1042	001026'	135300	000615*		LDB	T1,PJBSTS	;GET WAIT STATE
  1043	001027'	302300	000000*		CAIE	T1,TIOWQ
  1044	001030'	306300	000000*		CAIN	T1,SLPQ
  1045	001031'	254000	001014'		JRST	FRSST1		;OK TO TAKE OUT OF TI OR SL.
  1046	001032'	542600	000000*		HRRM	P1,%UPX+UPTSTS	;CAN'T START, SET ADDRESS OR ADDR OF ADDRESS
  1047	001033'	200300	000000*		MOVE	T1,%UPX+UPTSTS	;GET IT
  1048	001034'	331000	000014		SKIPL	P1		;SKIP IF ITS INDIRECT
  1049	001035'	625300	000000*		TLZA	T1,STRTAD	;ITS INDIRECT (@120, ETC)
  1050	001036'	661300	001035*		TLO	T1,STRTAD	;ITS NOT
  1051	001037'	603600	000743*		TLNE	P1,STARCL	;NEEDS CCL ADDRESS?
  1052	001040'	661300	000000*		TLO	T1,STRTCL	;YES, TELL USRXIT.
  1053	001041'	202300	000000*		MOVEM	T1,%UPX+UPTSTS	;SET IT
  1054	001042'	201300	040000		MOVEI	T1,UTRP
  1055	001043'	436302	001023*		IORM	T1,JBTSTS(J)	;SO USRXIT WILL NOTICE
  1056	001044'	137640	000000*		DPB	P2,UXYPSR	;FOR USRXIT TO WRITE STREAM
  1057	001045'	350001	000000		AOS	(P)		;GIVE GOOD RETURN
  1058	001046'	324740	000000*		PJRST	SETRUN		;AND SET RUN BIT, PUT HIM BACK INTO
  1059								; WHATEVER WAIT HE WAS IN AND START HIM
  1060								; WHEN HE COMES BACK TO USRXIT.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 19
FRMSER.MAC	 8-DEC-87 16:09		.FOJMP=0 Gate jump to other frame

  1061				SUBTTL	.FOJMP=0 Gate jump to other frame
  1062
  1063				COMMENT #
  1064				CALL:
  1065					MOVEI	AC,<CREATED FH INDEX> ;JUMP IS FUNCTION ZERO
  1066					FRMOP	AC,[PC WORD + 1B17 IF ADDRESS IS VECTOR ADDRESS]
  1067					  <ERROR RETURN>
  1068					<RETURN HERE IF FRAME JUMPED TO JUMPS BACK TO CONTINUE ADDRESS>
  1069				#
  1070
  1071			000001	XP FJ.VEC,(1B17)		;USE INDEX AND INDIRECT FIELD IN PC TO SPECIFY ABS OR VECTOR.
  1072
  1073				DEFINE BTXGEN(X)<DEFINE BTXN'X(AC,SYM)<IFLE <'SYM-'SYM/^D36*^D36-^D17>,<TLN'X 'AC,(1B<'SYM-'SYM
  1074				/^D36*^D36>)>
  1075					IFG <'SYM-'SYM/^D36*^D36-^D17>,<TRN'X 'AC,1B<'SYM-'SYM/^D36*^D36>>
  1076				>>;END BTXGEN MACRO DEFINITION
  1077				BTXGEN(E)
  1078				BTXGEN(N)
  1079
  1080				EXTERNAL TIMEF,CURUPT,EPLLEN,ABKSET,JOB,JBYQNT,STOP1,USCHED,USRXIT
  1081
  1082	001047'	256200	003706'	FRMJMP:	UMOVE	P1,(M)		;GET DESIRED PC
  1083	001050'	661600	012000		TLO	P1,PC.USR!PC.PUB	;MAKE SURE HE CAN'T START UP ANYONE IN EXEC MODE
  1084	001051'	303740	000000*		CAILE	P4,FHIMAX	;IS HANDLE INDEX VALID?
  1085	001052'	254000	003610'		JRST	FEWBDH		;NO
  1086	001053'	336757	000000*		SKIPN	P4,%UPT+UPTFHT(P4) ;GET HANDLE ADDRESS IF ANY
  1087	001054'	254000	003575'		JRST	FEWNOH		;NONE, GIVE ERROR.
  1088	001055'	550717	000000		HRRZ	P3,.FHFNO(P4)	;GET FRAME NUMBER IN RH P3
  1089	001056'	200317	000001		MOVE	T1,.FHUID(P4)	;MAKE SURE UID MATCHES
  1090	001057'	312316	000640*		CAME	T1,JBTUID(P3)	;MATCH?
  1091	001060'	254000	003576'		JRST	FEWBDI		;NO, GIVE ERROR. BAD UID.
  1092								; (FRAME COULD HAVE LOGGED OUT)
  1093	001061'	135300	003710'		LDB	T1,[HTPPTR(.FHTYP(P4))] ;GET HANDLE TYPE
  1094	001062'	200357	000003		MOVE	T2,.FHART(P4)	;GET ACCESS RIGHTS IN T2
  1095	001063'	306300	000001		CAIN	T1,.FHPRC	;IF NOT PROCESS HANDLE, DON'T CHECK PNO
  1096					JRST	[MOVE T3,.FHPNO(P4) ;PROCESS HANDLE, MUST MAKE SURE PNO MATCHES
  1097						 CAME T3,JBTPNO(P3) ;MUST MATCH OR ELSE
  1098						 JRST FEWNRT	;NO RIGHTS
  1099	001064'	254000	003711'			 JRST .+1]	;OK.
  1100	001065'	306300	000000		CAIN	T1,.FHFRM	;IF FRAME HANDLE,
  1101	001066'	404356	000405*		AND	T2,JBTMFR(P3)	;THEN AND RIGHTS WITH MFR
  1102	001067'	603600	000001		TLNE	P1,FJ.VEC	;IF VECTOR,
  1103					JRST	[BTXNN T2,.ARSVA ;CHECK FOR PROPER BIT
  1104						 JRST FEWNRT	;NO RIGHTS
  1105	001070'	254000	003715'			 JRST FRMJM0]	;OK.
  1106	001071'	607340	200000		BTXNN	T2,.ARSAA	;CHECK FOR ABSOLUTE
  1107	001072'	254000	003577'		JRST	FEWNRT		;SORRY.
  1108	001073'			FRMJM0: PFALL	FRJSTS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 20
FRMSER.MAC	 8-DEC-87 16:09		.FOJMP=0 Gate jump to other frame

  1109				;NOW CHECK TO SEE IF THE FRAME CALLER IS JUMPING TO CAN BE JUMPED
  1110				; INTO QUICKLY, OR WHETHER IT HAS TO BE DONE THE SLOW WAY.
  1111				;P1 HAS DESIRED STARTING PC, P2 HAS OLD PC (POINTS TO FRMOP+1),
  1112				; J HAS CALLER'S FRAME NUMBER, P3 HAS NEW FRAME FRAME NUMBER.
  1113
  1114	001073'	554316	001043*	FRJSTS:	HLRZ	T1,JBTSTS(P3)	;OK, CAN CALL, GET JBTSTS, EXTEND RN BIT
  1115	001074'	620300	000407		TRZ	T1,RUNMSK!JRQ	;CLEAR DON'T CARE BITS
  1116	001075'	302300	040000		CAIE	T1,RUNABLE-RUN	;IS HE RUNNABLE EXCEPT FOR RUN BIT??
  1117	001076'	254000	001174'		JRST	FRJNRN		;SEE IF MRQ IS PROBLEM.
  1118	001077'	332000	000000*		SKIPE	TIMEF		;CHECK CLOCK - MAKE SURE DON'T
  1119								; KEEP SCHEDULER FROM RUNNING BY MANY FAST GATE JUMPS.
  1120	001100'	254000	001201'		JRST	FRJSLO		;GO DO IT THE SLOW WAY, GIVE SCHEDULER A CHANCE TO RUN.
  1121	001101'	350300	000000*		AOS	T1,%UPT+UPTPDL	;GET CALLER PC, TURN IT INTO SKIP
  1122					MOVEM	T1,%UPT+UPTPC	;MAKE THIS OUR RETURN PC SO HE CAN JUMP BACK (MUST BE USER MODE
  1123	001102'	202300	000000*	)
  1124
  1125				;JSP P1,FRJCTS FROM JUMPED TO FRAME IF START VECTOR IS BAD.
  1126				; P3 CONTAINS FRAME TO JUMP TO, J CONTAINS JUMPING FRAME,
  1127				; P1 HAS PC.
  1128
  1129	001103'	550316	000327*	FRJCTS:	HRRZ	T1,JBTUPM(P3)	;GET UPT WORD
  1130
  1131				DEFINE SETMAP,<
  1132				IFCPU (KI),<
  1133					HRLM	T1,CURUPT
  1134					DATAO	PAG,CURUPT	;Combined WREBR and WRUBR
  1135				>;END IFCPU (KI)
  1136				IFNCPU (KI),<
  1137					MOVEM	T1,CURUPT	;SAVE IT
  1138					TLO	T1,(LG.LUB)	;JUST LOAD UBR
  1139					WRUBR	T1		;AND SET IT
  1140				>;END IFNCPU (KI)
  1141				>;END SETMAP MACRO DEFINITION
  1142
  1143	001104'	202300	000000*		SETMAP
  1144	001105'	661300	100000
  1145	001106'	701140	000006
  1146	001107'	200300	000000*		MOVE	T1,%UPT+UPTPC	;GET HIS PC BEFORE WE DESTROY ANYTHING.
  1147	001110'	607300	010000		TLNN	T1,PC.USR	;MAKE SURE IT WAS IN USER MODE
  1148					JRST	[HRRZ T1,JBTUPM(J) ;GET OUR OWN MAP BACK
  1149						 SETMAP
  1150						 SOS %UPT+UPTPDL ;UN-SKIP RETURN.
  1151	001111'	254000	003720'			 JRST FEWCJF]	;SAY CAN'T JUMP TO FRAME
  1152	001112'	256000	000000*		XCT	ABKSET		;WAS, SET ADDRESS BREAK SETTING
  1153	001113'	202700	000366*		MOVEM	P3,JOB		;SETUP JOB TO NEW NUMBER
  1154	001114'	205400	400000		MOVSI	T3,RUN
  1155	001115'	412402	001073*		ANDCAM	T3,JBTSTS(J)	;MAKE OLD FRAME STOP
  1156	001116'	260040	000424*		PUSHJ	P,REQUE		;HE IS NO LONGER CURRENT JOB
  1157	001117'	135340	000000*		LDB	T2,JBYQNT	;GET QUANTUM FOR OLD JOB
  1158	001120'	250100	000016		EXCH	J,P3
  1159	001121'	436402	001115*		IORM	T3,JBTSTS(J)	;SET RUN BIT FOR NEW GUY
  1160	001122'	137340	001117*		DPB	T2,JBYQNT	;SETUP NEW RUN QUANTUM
  1161	001123'	260040	001116*		PUSHJ	P,REQUE		;AND FLAG SO SCHEDULER WILL PUT HIM INTO RUN QUEUE
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 20-2
FRMSER.MAC	 8-DEC-87 16:09		.FOJMP=0 Gate jump to other frame

  1162	001124'	623600	000001		TLZE	P1,FJ.VEC	;SKIP IF ABSOLUTE, NOT VECTOR
  1163	001125'	254000	001132'		JRST	FRJVEC		;IS VECTOR, DO IT.
  1164	001126'	621600	000037		TLZ	P1,(@(17))	;CLEAR OUT BITS THAT MUST BE CLEAR
  1165	001127'	202600	000000*		MOVEM	P1,%UPT+UPTPC	;SET IT HERE
  1166	001130'	701140	003726'		USERAC	
  1167						;SWITCH TO USER ACS IF NECESSARY
  1168	001131'	254520	000000*		JEN	@%UPT+UPTPC	;AND DISMISS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 21
FRMSER.MAC	 8-DEC-87 16:09		.FOJMP=0 Gate jump to other frame

  1169	001132'	570300	000014	FRJVEC:	HRRE	T1,P1		;GET THE NUMBER
  1170	001133'	325300	001152'		JUMPGE	T1,FRJUVC	;GO IF USER VECTOR
  1171	001134'	271300	000001		ADDI	T1,1		;TURN FROM -N TO -N+1 = -(N-1)
  1172	001135'	217000	000006		MOVMS	T1		;TURN INTO N-1
  1173	001136'	306300	000004		CAIN	T1,JDSVCO	;IS IT CONTINUE?
  1174	001137'	254000	001150'		 JRST	FRJVGO		;GO SWITCH TO USERACS AND JUST DISMISS THRU UPTPC
  1175	001140'	301300	000005		CAIL	T1,JDSVLN	;MAKE SURE ITS WITHIN RANGE
  1176	001141'	254000	001165'		 JRST	FRJBSV		;BAD START VECTOR
  1177	001142'	550346	000773'		HRRZ	T2,JDSVTB(T1)	;GET USER ADDRESS CONTAINING START ADR
  1178	001143'	256200	003727'		XCTFU	<HRR P1,(T2)>	;GET THE START ADDRESS
  1179	001144'	306300	000001		CAIN	T1,JDSVCL	;CCL?
  1180	001145'	271600	000001		 ADDI	P1,1		;YES
  1181	001146'	621600	000037		TLZ	P1,(@(17))	;CLEAR OUT BAD BITS
  1182	001147'	202600	000000*		MOVEM	P1,%UPT+UPTPC	;SET IT HERE
  1183	001150'	701140	003726'	FRJVGO:	USERAC	
  1184						;SWITCH TO USER ACS IF NECESSARY
  1185	001151'	254520	000000*		JEN	@%UPT+UPTPC	;AND DISMISS
  1186
  1187	001152'	336300	000000*	FRJUVC:	SKIPN	T1,%UPT+UPTSTV	;GET START VECTOR WORD
  1188	001153'	254000	001165'		JRST	FRJBSV		;BAD START VECTOR
  1189	001154'	554340	000006		HLRZ	T2,T1		;GET COUNT
  1190	001155'	307354	000000		CAIG	T2,(P1)		;MAKE SURE SIZE IS BIGGER THAN OFFSET
  1191	001156'	254000	001165'		JRST	FRJBSV		;BAD START VECTOR
  1192	001157'	271606	000000		ADDI	P1,(T1)		;GET RH(P1) THE ADDRESS OF START ADDRESS IN USER SPACE
  1193	001160'	256200	003730'		XCTBU	<HRR P1,(P1)>	;GET THE ADDRESS FROM USER
  1194	001161'	621600	000037		TLZ	P1,(@(17))	;CLEAR OUT BAD BITS
  1195	001162'	202600	000000*		MOVEM	P1,%UPT+UPTPC	;SET IT HERE
  1196	001163'	701140	003726'		USERAC	
  1197						;SWITCH TO USER ACS IF NECESSARY
  1198	001164'	254520	000000*		JEN	@%UPT+UPTPC	;AND DISMISS
  1199
  1200				;HERE IF START VECTOR WAS BAD.
  1201				;  J HAS FRAME NUMBER OF JUMPED TO FRAME, P3 HAS OLD FRAME NUMBER.
  1202
  1203	001165'	265600	001103'	FRJBSV:	JSP	P1,FRJCTS	;CONTEXT SWITCH BACK
  1204	001166'	701140	003731'		EXECAC			;MUST SWITCH BACK TO EXEC ACS
  1205	001167'	200040	003732'		MOVE	P,[-EPLLEN+1,,%UPT+UPTPDL] ;SETUP STACK TO POINT AT RETURN PC FOR USRXIT
  1206	001170'	201300	000032		MOVEI	T1,FEBSV%	;BAD START VECTOR
  1207	001171'	256200	003640'		UMOVEM	T1,(W)		;GIVE THAT AS ERROR CODE
  1208	001172'	370001	000000		SOS	(P)		;WAS SET FOR SKIP RETURN, SET FOR NON-SKIP
  1209	001173'	254000	000000*		JRST	USRXIT		;AND GIVE HIM ERROR RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 22
FRMSER.MAC	 8-DEC-87 16:09		.FOJMP=0 Gate jump to other frame

  1210				;HERE WITH JBTSTS LH IN RH(T1) IF HE'S NOT RUNNABLE.
  1211
  1212	001174'	602300	400000	FRJNRN:	TRNE	T1,RUN		;IF HE HAS RUN BIT ON, NO DEAL
  1213	001175'	254000	003614'		JRST	FEWALR		;ALREADY RUNNING.
  1214	001176'	620300	300002		TRZ	T1,MRQ!CMWB!JRQ	;IF THESE ARE ON, WE CAN STILL START
  1215	001177'	302300	040000		CAIE	T1,RUNABLE-RUN	;RUNNABLE NOW?
  1216	001200'	254000	003631'		JRST	FEWCJF		;CANT JUMP, HAS SOME BAD BIT ON OR NON-ZERO WAIT STATE.
  1217
  1218				;HERE IF EITHER CLOCK HAS TICKED OR TARGET FRAME'S CONTEXT PAGES
  1219				; AREN'T ACTIVE. MUST DO IT BY HAND.
  1220
  1221	001201'	200100	000016	FRJSLO:	MOVE	J,P3		;GET TARGET FRAME NUMBER INTO J
  1222	001202'	201700	000000		MOVEI	P3,.ARSVA	;ASSUME START VECTOR
  1223	001203'	607600	000001		TLNN	P1,FJ.VEC	;IF NOT,
  1224	001204'	201700	000001		MOVEI	P3,.ARSAA	;THEN CHECK ABSOLUTE
  1225	001205'	256200	003733'		UMOVE	P4,(W)		;GET INDEX IN P4 AGAIN FROM USER AC
  1226	001206'	201757	300000		MOVEI	P4,.FDFRH(P4)	;TURN INTO A FRAME DESCRIPTOR.
  1227	001207'	260040	003055'		PUSHJ	P,FD2WL1	;GET HIS CONTEXT PAGES WRITE LOCKED
  1228	001210'	254000	000674'		  JRST	FRVERR		;STORE ERROR CODE.
  1229	001211'	200300	000000*		MOVE	T1,%UPX+UPTPC	;MAKE SURE HIS PC IS IN USER MODE.
  1230	001212'	607300	010000		TLNN	T1,PC.USR
  1231					JRST	[PUSHJ P,ULDUPX
  1232	001213'	254000	003734'			 JRST FEWCJF]	;GIVE BACK UPX AND GIVE PROPER ERROR.
  1233	001214'	201300	000000*		MOVEI	T1,%UPX+UPTUAC
  1234	001215'	256040	003737'		XCTFU	<BLT T1,%UPX+UPTUAC+17> ;COPY ACS TO DESTINATION
  1235	001216'	260040	000000*		PUSHJ	P,ULDUPX	;UNLOCK CONTEXT PAGES NOW
  1236	001217'	256200	003740'		UMOVE	P3,(W)		;GET INDEX IN P3 AGAIN
  1237	001220'	201716	300000		MOVEI	P3,.FDFRH(P3)	;FRAME HANDLE
  1238	001221'	505700	000004		HRLI	P3,.FOSAA	;ASSUME ABSOLUTE
  1239	001222'	607600	000001		TLNN	P1,FJ.VEC	;SKIP IF VECTOR STARTING ADDRESS
  1240					JRST	[HRLI P1,STARDI ;NOT. SAY ITS NOT INDIRECT
  1241						 HRLI P3,.FOSAA ;SAY ITS ABSOLUTE
  1242	001223'	254000	003741'			 JRST FRJSL1]	;AND DO THE FRMOP
  1243	001224'	505700	000022		HRLI	P3,.FOSVA	;DO PROPER START FUNCTION
  1244	001225'	573000	000014		HRRES	P1		;EXTEND SIGN IN CASE ARG IS NEGATIVE.
  1245	001226'	044700	000014	FRJSL1:	FRMOP	P3,P1		;START UP THE OTHER FRAME
  1246					  JRST	FRVERR		;STORE THE ERROR CODE FROM START FRMOP AS ERROR CODE FOR THIS O
  1247	001227'	254000	000674'	NE.
  1248
  1249
  1250
  1251				SUBTTL	.FOGIN=26 Gate jump Initialization
  1252
  1253				;HERE IS GATE JUMP INIT FRMOP. IT JUST STOPS THE JOB WITHOUT
  1254				; INTERRUPTING ANYONE, AND WITHOUT CHANGING THE TTY STATE, AND
  1255				; ENSURES THAT THE PC IS IN USER MODE, SO THAT THE CALLED FRAME
  1256				; CAN CALL BACK.
  1257
  1258	001230'	200100	000000*	FRMGIN:	MOVE	J,%UPT+UPTJOB	;SETUP J FOR STOP1
  1259	001231'	200040	003744'		MOVE	P,[-EPLLEN+1,,%UPT+UPTPDL] ;POINT SO THAT POPJ PUTS PC INTO UPTPC
  1260	001232'	260040	000000*		PUSHJ	P,STOP1		;STOP THIS JOB
  1261	001233'	350001	000000		AOS	(P)		;GIVE SKIP RETURN.
  1262	001234'	324740	000000*		PJRST	USCHED		;AND CALL SCHEDULER.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 23
FRMSER.MAC	 8-DEC-87 16:09		.FOCLR=14 Clear a stopped frame

  1263				SUBTTL	.FOCLR=14 Clear a stopped frame
  1264				;HERE ON ZAP FRAME
  1265
  1266	001235'	201700	000055	FRMCLR:	MOVEI	P3,.ARCLR
  1267	001236'	260040	003042'		PUSHJ	P,FDWUPX	;SEE IF CAN DO IT, RETURN WITH CTX IF SO
  1268	001237'	254000	000674'		  JRST	FRVERR		;CAN'T DO IT.
  1269	001240'	335002	001121*		SKIPGE	JBTSTS(J)	;MUST BE STOPPED
  1270	001241'	254000	003614'		  JRST	FEWALR		;IS RUNNING, SORRY.
  1271	001242'	201340	000000*		MOVEI	T2,CLRFRM##	;GLOBAL PLACE THAT ZAPS JOBS
  1272	001243'	350001	000000		AOS	(P)		;GIVE CALLER THE SKIP RETURN
  1273	001244'	324740	001022*		PJRST	MONJBX		;GO ZAP IT.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 24
FRMSER.MAC	 8-DEC-87 16:09		.FOGET=32 Get new core image from SAVE file

  1274				SUBTTL	.FOGET=32 Get new core image from SAVE file
  1275				SUBTTL	.FORUN=33 Run program in frame
  1276				SUBTTL	.FOSAV=34 Save frame's core image
  1277				SUBTTL	.FOSSA=35 Sharable save frame's core image
  1278
  1279				; Call is
  1280
  1281				;	MOVE	ac,[fn,,fd]
  1282				;	FRMOP	ac,adr
  1283				;	  error return
  1284				;	success return
  1285				;
  1286				;adr:	XWD 	start-incr,cnt	; number of arguments following
  1287				;	SIXBIT 	"dev"
  1288				;	XWD 	gan,uun
  1289				;	SIXBIT 	"name"
  1290				;	SIXBIT 	"ext"		; don't specify this!
  1291				;	XWD	ru-lic,core
  1292				;cnt==	.-adr-1
  1293
  1294				; This starts a monitor job for the target frame that actually gets
  1295				; (saves) the core image.  The license of the target frame applies
  1296				; for file access.
  1297
  1298				EXTERNAL GETFRM,RUNFRM,SAVFRM,GETFMU,RUNFMU,SAVFMU
  1299				EXTERNAL GNUARG,GNUARX,SG3
  1300				EXTERNAL HSLIC,LSLIC,NOSHR
  1301				EXTERNAL JBTNAM
  1302
  1303				;GET/RUN/SAVE table
  1304				; access-right-code,,monitor-job-address
  1305
  1306	001245'	000051	000000*	GRSTAB:	XWD .ARVAW,GETFRM	;get
  1307	001246'	000051	000000*		XWD .ARVAW,RUNFRM	;run
  1308	001247'	000050	000000*		XWD .ARVAR,SAVFRM	;save
  1309	001250'	000050	001247*		XWD .ARVAR,SAVFRM	;ssave
  1310
  1311	001251'	634600	000014	FRMGET:	TDZA	P1,P1		; P1/ 0 ;for GET
  1312	001252'	201600	000001	FRMRUN:  MOVEI	P1,1		; P1/ 1 ;for RUN
  1313	001253'	254000	001256'		JRST	FRMGRS
  1314	001254'	334600	003745'	FRMSAV:	SKIPA	P1,[2]		; P1/ 2 ;for SAVE
  1315	001255'	201600	000003	FRMSSA:	 MOVEI	P1,3		; P1/ 3 ;for SSAVE
  1316
  1317	001256'	554714	001245'	FRMGRS:	HLRZ	P3,GRSTAB(P1)	;obtain proper access right code
  1318	001257'	260040	003042'		PUSHJ	P,FDWUPX	;check rights, return with %UPX if ok
  1319	001260'	254000	000674'		 JRST	FRVERR		;can't do it.
  1320	001261'	621500	000000*		TLZ	W,NOSHR!HSLIC!LSLIC ;clear flags of unwanted type
  1321	001262'	302600	000003		CAIE	P1,3		;sharable save?
  1322	001263'	661500	000000*		 TLO	W,NOSHR		; no - flag it
  1323				;****** remove this JRST .+3 when GRS on self is working   /WRS 5-14-80
  1324	001264'	254000	001267'	GRSPAT::JRST 	.+3		;GRS code crashes, disable if for now
  1325				;****** note: patch GRSPAT to JUMP .+3 for debugging GRS on self
  1326	001265'	316100	001113*		CAMN	J,JOB		;is he talking about himself?
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 24-2
FRMSER.MAC	 8-DEC-87 16:09		.FOSSA=35 Sharable save frame's core image

  1327	001266'	254000	001303'		 JRST	GRSSLF		; yes - go GET/RUN/SAVE self
  1328	001267'	335002	001240*		SKIPGE	JBTSTS(J)	;must be stopped
  1329	001270'	254000	003614'		 JRST	FEWALR		; is running, sorry.
  1330	001271'	260040	000000*		PUSHJ	P,GNUARX	;get new user arguments into %UPX+UPTXAC
  1331	001272'	254000	003622'		 JRST	FEWBCN		; error - bad arg count
  1332	001273'	200340	000000*		MOVE	T2,%UPX+UPTXAC+P2 ;get program name
  1333	001274'	305600	000002		CAIGE	P1,2		;if GET or RUN (0 or 1),
  1334	001275'	202342	000362*		 MOVEM	T2,JBTNAM(J)	; set new name for SYSTAT
  1335	001276'	550354	001245'		HRRZ  	T2,GRSTAB(P1)	;get address of monjob to queue
  1336	001277'	402000	000000*		SETZM	%UPX+UPTPID	;clear out pids
  1337	001300'	402000	000000*		SETZM	%UPX+UPTSPD	;clear out pids
  1338	001301'	350001	000000		AOS	(P)		;give caller the skip return
  1339	001302'	324740	001244*		PJRST	MONJBX		;go zap it.
  1340
  1341	001303'	260040	001216*	GRSSLF:	PUSHJ	P,ULDUPX	;don't need %UPX for self
  1342	001304'	262040	000005		POP	P,U		;discard return address from FDWUPX
  1343	001305'	260040	000000*		PUSHJ	P,GNUARG	;get new user args on stack
  1344	001306'	254000	003622'		 JRST	FEWBCN		; error - bad arg count
  1345	001307'	260040	000000*		PUSHJ	P,SG3		;hack JOBDAT and set up XPACOM
  1346	001310'	305600	000002		CAIGE	P1,2		;if GET or RUN (0 or 1),
  1347	001311'	047000	000000		 CALLI	0		;do a reset
  1348	001312'	254034	003746'		JRST	@[EXP GETFMU,RUNFMU,SAVFMU,SAVFMU](P1)
  1349	
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 25
FRMSER.MAC	 8-DEC-87 16:09		.FOENA=45 Enable  frame license

  1350				SUBTTL	.FOENA=45 Enable  frame license
  1351				SUBTTL	.FODIS=46 Disable frame license
  1352
  1353				; Call is
  1354				;
  1355				;	MOVE	ac,[fn,,fd]
  1356				;	FRMOP	ac,adr
  1357				;	  error return
  1358				;	success return
  1359				;
  1360				;adr:	license-to-enable-or-disable
  1361				;
  1362				;  .FOENA
  1363				;	If <license> = -1, then all saved license is enabled
  1364				;	otherwise, the minimum of saved license and <license> is
  1365				;	enabled for the frame.
  1366				;
  1367				;
  1368				;  .FODIS
  1369				;	If <license> = -1, then all frame license is cleared
  1370				;	otherwise, the specified <license> is disabled for the frame.
  1371				;	If either LICWPJ or LICWFL are specified, both are disabled.
  1372				;	If either LICRPJ or LICRFL are specified, both are disabled.
  1373				;
  1374				; Note: LICRMT and LICHR are not settable on a frame, so they don't
  1375				;	really matter to this code.
  1376				;
  1377
  1378	001313'	201700	000014	FRMENA:	MOVEI	P3,.ARPLC	;Pass license - access right needed
  1379	001314'	260040	003042'		PUSHJ	P,FDRUPX	;GET UPX READ LOCKED (OR WRITE LOCKED?)
  1380	001315'	254000	000674'		  JRST	FRVERR		;Cannot
  1381	001316'	256200	003665'		UMOVE	T2,(M)		;Get license to enable
  1382	001317'	316340	003752'		CAMN	T2,[-1]		;Is it everything?
  1383					  JRST	[HRRZ  T2,JBTSLC(J)	;Yes, get saved frame license
  1384	001320'	254000	003753'			 JRST  FRMEN1]		; and enable all of it
  1385	001321'	504342	000751*		HRL	T2,JBTSLC(J)	;No, copy saved frame license
  1386	001322'	260040	000000*		PUSHJ	P,LICMSK##	;Get what is allowable
  1387	001323'	504342	000750*		HRL	T2,JBTLIC(J)	;Copy current license
  1388	001324'	260040	000000*		PUSHJ	P,MAXLIC##	;Get maximum allowable
  1389	001325'	542342	001323*	FRMEN1:	HRRM	T2,JBTLIC(J)	;Set it on specified frame
  1390	001326'	256200	003755'		UMOVEM	T2,(M)		;Store license in user ac
  1391	001327'	254000	000733*		JRST	CPOPJ1		;Return
  1392
  1393
  1394	001330'	201700	000014	FRMDIS:	MOVEI	P3,.ARPLC	;Pass license rights needed
  1395	001331'	260040	003042'		PUSHJ	P,FDRUPX	;Get UPX read lock
  1396	001332'	254000	000674'		  JRST	FRVERR		;Cannot
  1397	001333'	256200	003665'		UMOVE	T2,(M)		;Get license to disable
  1398	001334'	316340	003752'		CAMN	T2,[-1]		;Is it everything?
  1399					  JRST	[SETZ  T2,	;Clear frame license
  1400	001335'	254000	003756'			 JRST  FRMEN1]	; for the frame
  1401	001336'	504342	001325*		HRL	T2,JBTLIC(J)	;Copy current frame license
  1402	001337'	260040	001322*		PUSHJ	P,LICMSK##	;Get what is allowed
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 25-2
FRMSER.MAC	 8-DEC-87 16:09		.FODIS=46 Disable frame license

  1403	001340'	602340	000003		TRNE	T2,LICWPJ+LICWFL;Any WP-WF bits enabled
  1404	001341'	660340	000003		  TRO	T2,LICWPJ+LICWFL;Yes, set both
  1405	001342'	602340	000014		TRNE	T2,LICRPJ+LICRFL;Any RP-RF bits enabled
  1406	001343'	660340	000014		  TRO	T2,LICRPJ+LICRFL;Yes, set both
  1407	001344'	413342	001336*		ANDCAB	T2,JBTLIC(J)	;Disable (clear) license
  1408	001345'	256200	003755'		UMOVEM	T2,(M)		;Store license in user ac
  1409	001346'	254000	001327*		JRST	CPOPJ1		;Skip return
  1410
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 26
FRMSER.MAC	 8-DEC-87 16:09		.FOHLT=5 Halt frame

  1411				SUBTTL	.FOHLT=5 Halt frame
  1412				COMMENT #HERE ON STOP FRAME. FRAME DESCRIPTOR IS IN P4.
  1413				FORMAT OF CALL IS
  1414
  1415					MOVE	AC,[FN,,FD]
  1416					FRMOP	AC,
  1417					  <ERROR RETURN>
  1418					<SUCCESS RETURN>
  1419				#
  1420
  1421				EXTERNAL JBTSTS,DELAYN,PJBSTS,TRHALT
  1422
  1423	001347'	201700	000052	FRMHLT:	MOVEI	P3,.ARHLT	;MUST HAVE HALT ACCESS RIGHT
  1424	001350'	260040	003042'		PUSHJ	P,FDWUPX	;TRY TO GET
  1425	001351'	254000	000674'		  JRST	FRVERR		;PASS ERROR CODE IN P3 BACK TO USER.
  1426	001352'	331302	001267*		SKIPL	T1,JBTSTS(J)	;MAKE SURE HE'S RUNNING
  1427	001353'	254000	003615'		JRST	FEWALH		;ALREADY STOPPED.
  1428	001354'	620300	020000		TRZ	T1,JDCON	;CLEAR THIS SO ONCE A MINUTE STOPS
  1429	001355'	603300	000001		TLNE	T1,JACCT	;CAN'T STOP JACCTED FRMAE
  1430	001356'	254000	003616'		JRST	FEWCSJ		;"CANT STOP JACCT"
  1431	001357'	202302	001352*		MOVEM	T1,JBTSTS(J)	;OK TO STORE JBTSTS NOW, WE WILL STOP HIM
  1432	001360'	200300	000000*		MOVE	T1,%UPX+UPTPC	;GET PC
  1433	001361'	603300	010000		TLNE	T1,PC.USR	;IF IN USER MODE, STOP RIGHT NOW.
  1434	001362'	254000	001373'		JRST	FRMHLN		;HALT NOW.
  1435	001363'	135300	001026*		LDB	T1,PJBSTS	;NO, SEE WHAT STATE CODE IS
  1436	001364'	201340	000001		MOVEI	T2,1
  1437	001365'	242346	000000		LSH	T2,(T1)		;GET BIT FOR DELAYN
  1438	001366'	616340	000000*		TDNN	T2,DELAYN	;NEED TO STOP LATER?
  1439	001367'	254000	001373'		JRST	FRMHLN		;NO, HALT IT NOW.
  1440	001370'	205300	000400		MOVSI	T1,CNTRLC	;YES, SET CONTROL C BIT FOR USRXIT
  1441	001371'	436302	001357*		IORM	T1,JBTSTS(J)
  1442	001372'	254000	001346*		JRST	CPOPJ1		;AND GIVE GOOD RETURN.
  1443
  1444	001373'	350001	000000	FRMHLN:	AOS	(P)		;HALT IT NOW.
  1445	001374'	324740	000000*		PJRST	TRHALT		;GIVE PARENT TRAP, STOP FRAME, GIVE GOOD RETURN TO USER.
  1446
  1447
  1448				SUBTTL	.FOSTP=41 Stop Frame (^C)
  1449
  1450				;;  FRMSTP - Non-privileged version of FRMHLT.
  1451				;;  Requires .ARSTP access right only, fakes ^C.
  1452
  1453	001375'	201700	000053	FRMSTP:	MOVEI	P3,.ARSTP	;Low privilege
  1454	001376'	260040	003042'		PUSHJ	P,FDWUPX	;Lock down UPT
  1455	001377'	254000	000674'		  JRST	FRVERR
  1456	001400'	205300	000001		MOVSI	T1,JACCT	;The only exception
  1457	001401'	612302	001371*		TDNE	T1,JBTSTS(J)	;JACCT set?
  1458	001402'	254000	003616'		  JRST	FEWCSJ		;Can't Stop with JACCT set
  1459	001403'	550202	000000*		HRRZ	F,TTYTAB##(J)	;Command port TTY DDB address
  1460	001404'	550244	000000*		HRRZ	U,DDBLDB##(F)	;Line Data Block address (if any)
  1461	001405'	332000	000005		SKIPE	U		;Skip if detached
  1462	001406'	260040	000000*		PUSHJ	P,TTYHLT##	;If not, put TTY in command mode
  1463	001407'	201300	000000*		MOVEI	T1,CMFCHT##	;Forced command index for ^C
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 26-2
FRMSER.MAC	 8-DEC-87 16:09		.FOSTP=41 Stop Frame (^C)

  1464	001410'	260040	000242*		PUSHJ	P,COMWCM##	;Force command on frame
  1465	001411'	324740	001372*		PJRST	CPOPJ1##	;Give good return
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 27
FRMSER.MAC	 8-DEC-87 16:09		.FOFRC=42 Force Command for frame

  1466				SUBTTL	.FOFRC=42 Force Command for frame
  1467
  1468				;;  FRMFRC - Force a command on a frame.
  1469				;;  Argument is a SIXBIT string which must be a
  1470				;;  command from the forced command table in COMCON.
  1471				;;  The calling frame must have .ARVAW access rights to the
  1472				;;  target frame, and the target frame must be halted.
  1473
  1474	001412'	201700	000051	FRMFRC:	MOVEI	P3,.ARVAW	;Must have write access to target frame
  1475	001413'	260040	003042'		PUSHJ	P,FDWUPX	;Lock down UPT
  1476	001414'	254000	000674'		  JRST	FRVERR
  1477	001415'	335002	001401*		SKIPGE	JBTSTS(J)	;Frame halted?
  1478	001416'	254000	003614'		  JRST	FEWALR		;If not, give Already Running error
  1479	001417'	256200	003670'		UMOVE	T1,(M)		;Pick up user's argument word
  1480	001420'	135340	003760'		LDB	T2,[POINT 6,T1,5] ;Check first character
  1481	001421'	302340	000016		CAIE	T2,'.'		;These are monitor-internal only
  1482	001422'	260040	000000*		 PUSHJ	P,CMFIDX##	;Convert to forced command table index
  1483	001423'	254000	003633'		  JRST	FEWILC		;No such forced command, say Illegal
  1484	001424'	550202	001403*		HRRZ	F,TTYTAB##(J)	;Command port TTY DDB address
  1485	001425'	550244	001404*		HRRZ	U,DDBLDB##(F)	;Line Data Block address (if any)
  1486	001426'	261040	000006		PUSH	P,T1		;Save index returned by FCMIDX
  1487	001427'	332000	000005		SKIPE	U		;Skip if detached
  1488	001430'	260040	001406*		  PUSHJ	P,TTYHLT##	;If not, put TTY in command mode
  1489	001431'	262040	000006		POP	P,T1		;Restore forced command table index
  1490	001432'	260040	001410*		PUSHJ	P,COMWCM##	;Force command on frame
  1491	001433'	324740	001411*		PJRST	CPOPJ1##	;Give good return
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 28
FRMSER.MAC	 8-DEC-87 16:09		.FOCON=25 Continue a frame

  1492				SUBTTL	.FOCON=25 Continue a frame
  1493
  1494				COMMENT #CONTINUE FRAME FRMOP. ACTUALLY, CAN ALWAYS HALT FRAME, READ
  1495				PC, AND START AT PC BECAUSE READ PC FRMOP BACKS UP PC IF WAIT
  1496				STATE WAS IN TI OR SLP. IF WAIT STATE WASN'T IN TI OR SLP,
  1497				THE START CODE WILL JUST PUT THE FRAME BACK INTO THAT WAIT STATE,
  1498				EVEN IF IT WAS SJ, AND WHEN JOB COMES OUT OF THE UUO IN USRXIT,
  1499				IT WILL BE STARTED AT THE NEW PC SPECIFIED. SINCE HIBER INCREMENTS
  1500				PC BEFORE SLEEPING, THIS WILL RESULT IN SKIP RETURN.
  1501
  1502				FORMAT OF CALL IS
  1503
  1504					MOVE	AC,[.FOCON,,FD]
  1505					FRMOP	AC,
  1506					  <ERROR RETURN>
  1507					<SUCCESS RETURN>
  1508				#
  1509
  1510	001434'	201700	000000	FRMCON:	MOVEI	P3,.ARSVA	;IF CAN START AT VECTOR ADDRESS, CAN CONTINUE
  1511	001435'	260040	003042'		PUSHJ	P,FDWUPX	;LOCK CONTEXT PAGES FOR WRITING
  1512	001436'	254000	000674'		  JRST	FRVERR		;CAN'T DO IT
  1513
  1514				;HERE FROM START AT VECTOR ADDRESS FRMOP IF CONTINUE IS SPECIFIED
  1515
  1516	001437'	335302	001415*	FRMCO0:	SKIPGE	T1,JBTSTS(J)	;MAKE SURE HE'S STOPPED
  1517	001440'	254000	003614'		JRST	FEWALR		;CAN'T DO IT, HE'S ALREADY RUNNING.
  1518	001441'	603300	020000		TLNE	T1,JERR		;IF JERR SET, NOT CONTINUABLE
  1519	001442'	254000	003630'		JRST	FEWCCF		;CAN'T CONTINUE FRAME
  1520	001443'	350001	000000		AOS	(P)		;OK, GIVE CALLER THE SKIP RETURN AND
  1521	001444'	324740	001046*		PJRST	SETRUN		;MAKE HIM RUN AGAIN.
  1522
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 29
FRMSER.MAC	 8-DEC-87 16:09		.FOHST=23 Read Halt Status block

  1523				SUBTTL	.FOHST=23 Read Halt Status block
  1524
  1525				COMMENT #
  1526				CALL IS
  1527
  1528					MOVE	AC,[FN,,FD]
  1529					FRMOP	AC,ADDR
  1530					  <ERROR>
  1531					<SUCCESS>
  1532
  1533				ADDR:	COUNT			;NUMBER OF WORDS TO RETURN
  1534								;WORDS RETURNED STARTING AT ADDR+1
  1535				ADDR+1/ HALT CLASS,,HALT TYPE
  1536				ADDR+2/ HALT COUNT
  1537				ADDR+3/ PC OF HALT OR EXIT
  1538				ADDR+4/ PC OF LAST UUO
  1539				ADDR+5/ SIXBIT DEVICE NAME IF RELEVANT
  1540				ADDR+6/ 36 BIT DATA DEPENDENT ON HALT CLASS AND TYPE (E.G. LOCATION OF ILL MEM REF)
  1541				ADDR+7/ ANOTHER TYPE DEPENDENT DATA LOCATION
  1542				#
  1543
  1544				EXTERNAL UPTHST,FHSMXC
  1545
  1546	001445'	256200	003706'	FRMHST:	UMOVE	P1,(M)		;GET COUNT
  1547	001446'	322600	003622'		JUMPE	P1,FEWBCN	;ZERO NO GOOD.
  1548	001447'	303600	000000*		CAILE	P1,FHSMXC	;MUST NOT ASK FOR TOO MUCH
  1549	001450'	254000	003622'		JRST	FEWBCN		;BAD COUNT
  1550	001451'	201700	000002		MOVEI	P3,.ARRUN	;NEED TO BE ABLE TO READ FRAME STATE
  1551	001452'	260040	003042'		PUSHJ	P,FDRUPX	;GET FOR READING
  1552	001453'	254000	000674'		  JRST	FRVERR		;SORRY
  1553	001454'	205300	000000*		MOVSI	T1,%UPX+UPTHST	;GET FROM FIRST LOCATION
  1554	001455'	541313	000001		HRRI	T1,1(M)		;STORE TO ADDRESS+1
  1555	001456'	271613	000000		ADDI	P1,(M)		;GET LAST LOCATION TO XFER TO
  1556	001457'	256200	003761'		XCTTU <BLT T1,(P1)>	;TRANSFER THE DATA
  1557	001460'	254000	001433*		JRST	CPOPJ1		;AND RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 30
FRMSER.MAC	 8-DEC-87 16:09		.FORPC=6 Read PC (if PC is in user mode)

  1558				SUBTTL	.FORPC=6 Read PC (if PC is in user mode)
  1559				COMMENT # FRMOP TO READ A FRAME'S LAST USER MODE PC
  1560
  1561					MOVE	AC,[FN,,FD]
  1562					FRMOP	AC,<ADDR>
  1563					  <ERROR>
  1564					<SUCCESS>		;PC IN <ADDR>
  1565
  1566				IF NO USER MODE PC IS KNOWN FOR THE FRAME (E.G. JUST FINISHED A RUN)
  1567				THEN ZERO IS RETURNED IN <ADDR> AND THE SUCCESS RETURN IS GIVEN.
  1568				#
  1569
  1570				EXTERNAL UPTPDL
  1571
  1572	001461'	201700	000003	FRMRPC:	MOVEI	P3,.ARRDS	;HAVE TO BE ABLE TO READ FRAME STATE
  1573	001462'	260040	003042'		PUSHJ	P,FDRUPX	;GET UPX READ LOCKED (REALLY WRITE FOR NOW)
  1574	001463'	254000	000674'		  JRST	FRVERR
  1575	001464'	200300	000000*		MOVE	T1,%UPX+UPTPC	;GET PC
  1576	001465'	603300	010000		TLNE	T1,PC.USR	;IF NOT IN USER MODE,
  1577	001466'	254000	001476'		JRST	FRMRP1		;USER, OK.
  1578	001467'	200300	000000*		MOVE	T1,%UPX+UPTPDL	;THEN GET IT OFF PDL
  1579	001470'	135340	001363*		LDB	T2,PJBSTS	;GET STATE CODE
  1580	001471'	302340	001027*		CAIE	T2,TIOWQ	;IF IN TI OR
  1581	001472'	306340	001030*		CAIN	T2,SLPQ		;SLEEP OR HIBER,
  1582	001473'	541306	777777		HRRI	T1,-1(T1)	;THEN DECREMENT PC, MUST EXECUTE UUO OVER.
  1583								; ELSE START CODE WILL FINISH, AND PC SHOULD BE BELIEVED AS IS.
  1584
  1585	001474'	607300	010000		TLNN	T1,PC.USR	;DON'T GIVE AWAY ANY EXEC PCS
  1586	001475'	400300	000000		SETZ	T1,
  1587	001476'	256200	003762'	FRMRP1:	UMOVEM	T1,(M)		;STORE IN AC
  1588	001477'	254000	001460*		JRST	CPOPJ1		;AND RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 31
FRMSER.MAC	 8-DEC-87 16:09		.FOPRJ=43 Change Project Code for frame

  1589				SUBTTL	.FOPRJ=43 Change Project Code for frame
  1590
  1591				;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  1592				;;								;;
  1593				;;	FRMPRJ - Change Project Code for a frame.		;;
  1594				;;	Calling sequence:					;;
  1595				;;		MOVE	ac,[function code,,frame descriptor]	;;
  1596				;;		FRMOP	ac,addr					;;
  1597				;;		  error return	;error code in AC		;;
  1598				;;		success return					;;
  1599				;;								;;
  1600				;;	addr:			bits				;;
  1601				;;	addr+1:			chars 1-5 of project code	;;
  1602				;;	addr+2:			chars 6-10 of project code	;;
  1603				;;	addr+3:	bits 0-13	chars 11-12 of project code	;;
  1604				;;	addr+3:	bits 14-34	0				;;
  1605				;;	addr+3:	bit 35		project-code-verify bit		;;
  1606				;;								;;
  1607				;;	where <bits> =	0 to read currect project code and	;;
  1608				;;			  verify bit				;;
  1609				;;			1 to set project code but not change	;;
  1610				;;			  verify bit				;;
  1611				;;			3 to set both project code and		;;
  1612				;;			  verify bit				;;
  1613				;;								;;
  1614				;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  1615
  1616				;FUNCTION OF PJCVFY BIT: REQUIRE SETTERS OF PJC TO HAVE
  1617				;WPJ OR XC LICENSE. THE UNLICENSED USER MAY NOT SET PJC WITHOUT
  1618				;RUNNING A LICENSED PROGRAM TO DO IT. BIT GETS SET BY
  1619				;CHPJC 3,AC CALL FROM LICENSED PROGRAM AT LOGIN TIME, FOR
  1620				;USERS SUBJECT TO VERIFICATION.
  1621
  1622			000002	CHGVFY==2; IN LH AC
  1623			000001	PJCSET==1; "  "  "
  1624			000001	PJCVFY==1; IN RH UPTPJ2, IN RH BLOCK+2
  1625	001500'	256200	003670'	FRMPRJ:	UMOVE	T1,(M)		;First user arg word (control bits)
  1626	001501'	207300	000006		MOVSS	T1,T1		;Move into left half
  1627	001502'	541313	000001		HRRI	T1,1(M)		;Now in same format as CHPJC CALLI
  1628	001503'	334000	000000		SKIPA			;Skip frame descriptor set-up
  1629								;  (use caller's)
  1630				;;
  1631				;; Enter here for CHPJC UUO (CALLI -61) from UUOCON
  1632				;;
  1633				EXTERNAL UPTPJC,UPTPJ2
  1634				INTERNAL CHPJC
  1635	001504'	474740	000000	CHPJC:	SETO	P4,		;Frame descriptor for self (CALLI only)
  1636	001505'	201700	000005		MOVEI	P3,.ARRFI	;Need Read Frame Info to read project code
  1637	001506'	603300	000001		TLNE	T1,PJCSET	;SKIP IF WANTS READ ONLY
  1638	001507'	201700	000051		  MOVEI	P3,.ARVAW	;Need Write access to write project code
  1639	001510'	200600	000006		MOVE	P1,T1		;Save user's address & bits
  1640	001511'	260040	003042'		PUSHJ	P,FDWUPX	;Check access rights & lock down target UPT
  1641	001512'	254000	000674'		  JRST FRVERR
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 31-2
FRMSER.MAC	 8-DEC-87 16:09		.FOPRJ=43 Change Project Code for frame

  1642				;; ***NOTE*** Register J now has job number of target, not caller
  1643	001513'	200300	000014		MOVE	T1,P1		;Restore bits,,user's address
  1644	001514'	603300	000001		TLNE	T1,PJCSET	;Want to read only?
  1645	001515'	254000	001522'		  JRST	CHPJC2
  1646	001516'	551346	000002		HRRZI	T2,2(T1)	;T2:=LAST USER LOC=USER BLOCK LOC+2
  1647	001517'	505300	000000*		HRLI	T1,%UPX+UPTPJC
  1648	001520'	256200	003763'		XCTTU	<BLT T1,(T2)>	;MOVE 3 WORDS TO USER
  1649	001521'	254000	001477*		JRST	CPOPJ1
  1650
  1651	001522'	201340	000001	CHPJC2:	MOVEI	T2,PJCVFY
  1652	001523'	616340	000000*		TDNN	T2,%UPX+UPTPJ2	;SKIP IF LIC REQUIRED TO SET PJC
  1653	001524'	254000	001531'		  JRST	CHPJC3
  1654	001525'	200340	000000*		MOVE	T2,%UPT+UPTJOB	;Get back caller's job number
  1655	001526'	200347	001344*		MOVE	T2,JBTLIC(T2)	; to check the license word
  1656	001527'	607340	000201		TLNN	T2,LICWPJ!LICXC
  1657	001530'	254000	003601'		  JRST	FEWNLC		;Return Not-Enough-License error
  1658
  1659	001531'	120640	000000*	CHPJC3:	DMOVE	P2,%UPX+UPTPJC	;P2/P3/P4:=OLD PJC
  1660	001532'	200740	000000*		MOVE	P4,%UPX+UPTPJ2	;P4 BIT 35:=OLD PJCVFY BIT
  1661	001533'	514340	000006		HRLZ	T2,T1
  1662	001534'	541340	000000*		HRRI	T2,UPTPJC+%UPX	;T2:=USERLOC,,UPTLOC
  1663	001535'	256040	003765'		XCTFU	<BLT T2,%UPX+UPTPJ2>	;UPT:=USER BLOCK
  1664	001536'	607300	000002		TLNN	T1,CHGVFY	;IF USER ASKS, TAKE PJCVFY
  1665	001537'	137740	003766'		  DPB	P4,[POINT 1,%UPX+UPTPJ2,35]
  1666								;FROM HIS CORE,ELSE RESTORE FROM OLD PJC
  1667	001540'	256200	003767'		XCTTU	<DMOVEM P2,(T1)>;RETURN OLD PJC &
  1668	001541'	256200	003770'		XCTTU	<MOVEM P4,2(T1)>;PJCVFY STATUS
  1669				;WRITE ACT REC TYPE 7
  1670				;J has target job number
  1671	001542'	201300	000007		MOVEI	T1,7
  1672	001543'	260040	000000*		PUSHJ	P,ACTWRT##
  1673	001544'	254000	001521*		JRST	CPOPJ1		;SKIP RETURN TO USER
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 32
FRMSER.MAC	 8-DEC-87 16:09		.FORFA=36 Read Frame Attributes

  1674				SUBTTL	.FORFA=36 Read Frame Attributes
  1675				SUBTTL	.FOWFA=37 Write Frame Attributes
  1676				SUBTTL	.FOXFA=40 Exchange Frame Attributes
  1677
  1678				;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  1679				;;								;;
  1680				;;	FRMOPs to read, write or write/read (exch) frame	;;
  1681				;;	attributes.  Format of call is:				;;
  1682				;;								;;
  1683				;;		MOVE	AC,[FN,,FD]				;;
  1684				;;		FRMOP	AC,ADDR					;;
  1685				;;		  <ERROR>					;;
  1686				;;		<SUCCESS>					;;
  1687				;;								;;
  1688				;;	<ADDR>:	Attribute #,,<Argument address>			;;
  1689				;;			OR					;;
  1690				;;	<ADDR>:	     0,,<Argument block address>		;;
  1691				;;		-COUNT,,<Attribute list address>		;;
  1692				;;								;;
  1693				;;	On error return, FRMOP error is in AC right, positive	;;
  1694				;;	index into argument/attribute table is in AC left.	;;
  1695				;;								;;
  1696				;;	FRMOP function codes are:				;;
  1697				;;		36 - Read frame attribute			;;
  1698				;;		37 - Write frame attribute			;;
  1699				;;		40 - Exchange (read, then write) frame attr.	;;
  1700				;;								;;
  1701				;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  1702
  1703				;;
  1704				;; FRMRFA - Read Frame Attribute
  1705				;; FRMWFA - Write Frame Attribute
  1706				;; FRMXFA - Exchange (Write/Read) Frame Attribute
  1707				;;
  1708				;; Internal register usage:
  1709				;;	S - Flag word, LH set to all ones if context pages are locked.
  1710				;;	    RH has flag bits to indicate what actions are to be taken.
  1711				;;	J - Calling frame's frame number
  1712				;;	F - LH has absolute target frame number, RH has saved frame
  1713				;;	    descriptor.
  1714				;;	U - Address if user's argument or argument list
  1715				;;	P4 - contains frame descriptor as calling parameter
  1716				;;	P3 - access rights codes
  1717				;;	P2 - Copy of initial value of U for error calculation
  1718				;;	P1 - caller's attribute code
  1719				;;
  1720
  1721			000001		FA.RD==1
  1722			000002		FA.WR==2
  1723
  1724	001545'	201000	000002	FRMWFA:	MOVEI	S,FA.WR		;Indicate user wants to write
  1725	001546'	254000	001552'		JRST	FRMFA
  1726	001547'	201000	000003	FRMXFA:	MOVEI	S,FA.RD!FA.WR	;Indicate both read and write
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 32-2
FRMSER.MAC	 8-DEC-87 16:09		.FOXFA=40 Exchange Frame Attributes

  1727	001550'	254000	001552'		JRST	FRMFA
  1728	001551'	201000	000001	FRMRFA:	MOVEI	S,FA.RD		;Indicate user wants to read
  1729	001552'			FRMFA:
  1730	001552'	260040	003102'		PUSHJ	P,FD2FNO	;Convert frame descriptor in P4 to
  1731								; absolute frame number in J.
  1732	001553'	254000	001644'		  JRST	FRATER		;Error - code in P3
  1733	001554'	550200	000017		HRRZ	F,P4		;Get frame descriptor into RH
  1734	001555'	504200	000002		HRL	F,J		;And absolute frame number into LH
  1735	001556'	256200	003771'		UMOVE	U,(M)		;Caller's argument word
  1736	001557'	550640	000005		HRRZ	P2,U		;Copy original arg addr in case error
  1737	001560'	607240	777777		TLNN	U,-1		;Attribute in left half?
  1738	001561'	254000	001566'		 JRST	FRALST		;No, must be a list
  1739	001562'	205540	777777		MOVSI	M,-1		;Make a fake AOBJN word
  1740	001563'	554600	000005		HLRZ	P1,U		;Get attribute code
  1741	001564'	621240	777777		TLZ	U,-1		;Clear left half of argument address
  1742	001565'	254000	001574'		JRST	FRANX1		;Drop into main loop
  1743				;;
  1744				;; Here if U has first word of 2-word block (list form)
  1745				;;
  1746	001566'	256200	003772'	FRALST:	UMOVE	M,1(M)		;Get AOBJN word for attribute list
  1747	001567'	574300	000013		HLRE	T1,M		;-count
  1748	001570'	325300	001640'		JUMPGE	T1,FRABCN	;Error out if count not negative
  1749	001571'	271300	000001		ADDI	T1,MXFRAT	;Within reason ?
  1750	001572'	321300	001640'		JUMPL	T1,FRABCN	;Bad count
  1751	001573'	256200	003706'	FRANXT:	UMOVE	P1,(M)		;Get next attribute from caller's list
  1752	001574'	303600	000001	FRANX1:	CAILE	P1,MXFRAT	;Attribute legal ?
  1753	001575'	254000	001641'		 JRST	FRABTN		;No, Bad Table Number error
  1754	001576'	550100	000000*		HRRZ	J,%UPT+UPTJOB	;Set up caller's frame number
  1755								; for license checking routines
  1756	001577'	400700	000000		SETZ	P3,		;Error codes stored here
  1757	001600'	135300	001652'		LDB	T1,FARLCY	;Dispatch index to check license, etc.
  1758	001601'	602000	000002		TRNE	S,FA.WR		;Wants to write ?
  1759	001602'	135300	001653'		 LDB	T1,FAWLCY	;Get different index if so
  1760	001603'	256006	001650'		XCT	FRADSP(T1)	;Allowed to access this attribute ?
  1761	001604'	254000	001642'		 JRST	FRANLC		;No - Not Enough License error
  1762
  1763				;;
  1764				;; Here to decide about access rights and the context page lock
  1765				;; There are five cases:
  1766				;;	1. No access rights or context page lock required.
  1767				;;	2. Access rights required and the context pages have not
  1768				;;	   yet been locked.
  1769				;;	3. Access rights required, but the context pages were
  1770				;;	   already locked in a previous pass through the loop.
  1771				;;	4. No access rights required, but the requested attribute
  1772				;;	   needs the context pages locked anyway.
  1773				;;	5. Same as (4) except that context pages were previously
  1774				;;	   locked.  This is effectively the same as (1) and is
  1775				;;	   treated as such.
  1776				;;
  1777
  1778	001605'	135700	001654'		LDB	P3,FARARY	;Read access rights required
  1779	001606'	602000	000002		TRNE	S,FA.WR		;Wants to write ?
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 32-3
FRMSER.MAC	 8-DEC-87 16:09		.FOXFA=40 Exchange Frame Attributes

  1780	001607'	135700	001655'		 LDB	P3,FAWARY	;Get different index if so
  1781	001610'	302700	000777		CAIE	P3,NOAR		;No access rights required ?
  1782	001611'	254000	001617'		 JRST	FRAGAR		;Get them if needed
  1783	001612'	474700	000000		SETO	P3,		;Indicate to context-page-locking
  1784								; routine not to check access rights
  1785	001613'	335014	001656'		SKIPGE	FRATAB(P1)	;Does this attribute need lock?
  1786	001614'	325000	001624'		 JUMPGE S,FRACTX	;If so and not locked, go get it
  1787				;;
  1788				;; No access rights or context lock needed
  1789				;;  OR no access rights needed and already locked.
  1790				;;
  1791	001615'	554100	000004		HLRZ	J,F		;Get target absolute frame number
  1792	001616'	254000	001627'		JRST	FRATGO		;And get on with it
  1793				;;
  1794				;; Here if access rights required to target frame
  1795				;;
  1796	001617'	325000	001624'	FRAGAR:	JUMPGE	S,FRACTX	;Branch if context pages not locked
  1797				;;
  1798				;; Here if access rights required and context pages are already
  1799				;; locked from previous loop pass.
  1800				;;
  1801	001620'	260040	003063'		PUSHJ	P,FARCHK	;Fast Access Rights Check
  1802	001621'	254000	001644'		  JRST	FRATER		;No access rights - error out
  1803	001622'	550740	000004		HRRZ	P4,F		;Restore clobbered frame descriptor
  1804	001623'	254000	001627'		JRST	FRATGO		;Doo dah
  1805				;;
  1806				;; Here if context pages need to be locked.  P3 has access rights
  1807				;; code or -1 if none needed.
  1808				;;
  1809	001624'	260040	003042'	FRACTX:	PUSHJ	P,FDWUPX	;Lock context pages
  1810	001625'	254000	001644'		  JRST	FRATER		;Failed - error out
  1811	001626'	661000	777777		TLO	S,-1		;Indicate that context pages are locked
  1812	001627'	135314	001660'	FRATGO:	LDB	T1,FRAPTR(P1)	;Get frame attribute
  1813	001630'	256200	003773'		UMOVE	T2,(U)		;Get caller's argument
  1814	001631'	602000	000001		TRNE	S,FA.RD		;Does caller want to read it?
  1815	001632'	256200	003774'		 UMOVEM T1,(U)		;Pass it down if so
  1816	001633'	602000	000002		TRNE	S,FA.WR		;Want to write it?
  1817	001634'	137354	001660'		 DPB	T2,FRAPTR(P1)	;If so, do it
  1818	001635'	350000	000005		AOS	U		;Point to caller's next argument
  1819	001636'	253540	001573'		AOBJN	M,FRANXT	;Do next attribute, if any
  1820	001637'	254000	001544*		JRST	CPOPJ1		;Give good return
  1821
  1822				;;
  1823				;; Error exits from Read/Write Frame Attributes
  1824				;;
  1825
  1826				;; Here if attribute list is too long
  1827
  1828	001640'	334700	003775'	FRABCN:	SKIPA	P3,[FEBCN%]	;Bad Count
  1829
  1830				;; Here if attribute code is illegal
  1831
  1832	001641'	201700	000027	FRABTN:	MOVEI	P3,FEBTN%	;Call it Bad Table Number
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 32-4
FRMSER.MAC	 8-DEC-87 16:09		.FOXFA=40 Exchange Frame Attributes

  1833
  1834				;; Here if license check failed (with possible error code in P3)
  1835
  1836	001642'	326700	001644'	FRANLC:	JUMPN	P3,.+2		;Don't overwrite existing error code
  1837	001643'	201700	000005		MOVEI	P3,FENLC%	;Not Enough License
  1838
  1839				;; Here for anything else (error code in P3)
  1840
  1841	001644'	275255	000000	FRATER:	SUBI	U,(P2)		;Find index into user's arg list
  1842	001645'	504700	000005		HRL	P3,U		;Set into error code
  1843	001646'	256200	003643'		UMOVEM	P3,(W)		;Set into caller's AC
  1844	001647'	263040	000000		POPJ	P,		;And give error return
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 33
FRMSER.MAC	 8-DEC-87 16:09		.FOXFA=40 Exchange Frame Attributes

  1845				;; Table for dispatching to license/privilege-checking routines
  1846
  1847	001650'	334000	000000	FRADSP:	SKIPA			;No check required
  1848	001651'	260040	001662'		PUSHJ	P,CHKJL		;Check for JL license
  1849
  1850				;; Indices into FRADSP
  1851			000000		NOLIC==0
  1852			000001		FRATJL==1
  1853
  1854				;; Table of licenses/access rights required to read/write frame
  1855				;;  attributes - indexed by P1.
  1856
  1857			000001		GETLOK==1	;Bit 0 (must be sign) - get context page lock
  1858
  1859			000001		FARLCS==1	;Start bit for Read index to FRADSP
  1860			000003		FARLCL==^D3	;Length of Read index field
  1861			000003		FARLCR==FARLCS+FARLCL-1 ;Rightmost bit of Read index field
  1862	001652'	400314	001656'	FARLCY:	POINT	FARLCL,FRATAB(P1),FARLCR ;Byte pointer to Read index
  1863
  1864			000004		FAWLCS==FARLCR+1	;Start bit for Write index to FRADSP
  1865			000003		FAWLCL==FARLCL	;Length of Write index field
  1866			000006		FAWLCR==FAWLCS+FAWLCL-1 ;Rightmost bit of Write index field
  1867	001653'	350314	001656'	FAWLCY:	POINT	FAWLCL,FRATAB(P1),FAWLCR ;Byte pointer to Write index
  1868
  1869			000007		FARARS==FAWLCR+1	;Start bit of Read Access Rights field
  1870			000011		FARARL==^D9	;Length of Read Access Rights field
  1871			000017		FARARR==FARARS+FARARL-1 ;Rightmost bit of R.A.R. field
  1872	001654'	241114	001656'	FARARY:	POINT	FARARL,FRATAB(P1),FARARR ;Byte pointer to R.A.R. field
  1873
  1874			000020		FAWARS==FARARR+1	;Start bit of Write Access Rights field
  1875			000011		FAWARL==FARARL	;Length of Write Access Rights field
  1876			000030		FAWARR==FAWARS+FAWARL-1 ;Rightmost bit of W.A.R. field
  1877	001655'	131114	001656'	FAWARY:	POINT	FAWARL,FRATAB(P1),FAWARR ;Byte pointer to W.A.R. field
  1878
  1879			000777		NOAR==777	;Special value for no access rights
  1880							; (since 0 is defined)
  1881
  1882					DEFINE	TABENT	(LOKFLG,RDLIC,WRLIC,RDAR,WRAR) <
  1883					<LOKFLG>B0+<RDLIC>B<FARLCR>+<WRLIC>B<FAWLCR>+<RDAR>B<FARARR>+<WRAR>B<FAWARR>
  1884					> ;End TABENT macro
  1885
  1886	001656'	000000	000000	FRATAB:	0				;No zero entry (yet)
  1887	001657'	404027	774000		TABENT	GETLOK,NOLIC,FRATJL,.ARRFI,NOAR
  1888								;Needs .ARRFI to read, JL to write
  1889			000001		MXFRAT==.-FRATAB-1	;Max legal attribute code
  1890
  1891				;; Table of byte pointers to frame attributes - must be ordered
  1892				;;  same as FRATAB.
  1893
  1894	001660'	000000	000000	FRAPTR:	0			;No zero entry (yet)
  1895	001661'	004400	000000*		POINT	36,%UPX+UPTLOG##,35 ;Byte pointer to fullword field
  1896
  1897				;;
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 33-2
FRMSER.MAC	 8-DEC-87 16:09		.FOXFA=40 Exchange Frame Attributes

  1898				;; Routines for verifying license/privilege
  1899				;;
  1900
  1901				;; Routine to check for JL license - Frame number in J
  1902
  1903	001662'	205300	001000	CHKJL:	MOVSI	T1,LICJAL	;JL license?
  1904	001663'	612302	001526*		TDNE	T1,JBTLIC(J)	;Got it?
  1905	001664'	354001	000000		AOSA	(P)		;Yes, give good return
  1906	001665'	201700	000005		MOVEI	P3,FENLC%	;No, say not enough license
  1907	001666'	263040	000000		POPJ	P,
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 34
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  1908				SUBTTL	.FOCFH=12 Create handle
  1909				COMMENT #HERE ON CREATE HANDLE. FRAME DESCRIPTOR
  1910				FOR TARGET FRAME IN P4. FORMAT OF CALL IS
  1911
  1912					MOVE	AC,[FN,,FD]	;FD FOR TARGET FRAME
  1913					FRMOP	AC,<ADDR>
  1914					  <ERROR>
  1915					<SUCCESS>
  1916
  1917				<ADDR>:	BITS,,FD FOR NEW HANDLE (INDEX FIELD 77777 TO FIND FIRST FREE SLOT)
  1918					COUNT,,ADDR OF ACCESS BITS (0 FOR DEFAULT-MAX)
  1919					<N WORDS OF ACCESS BITS>
  1920
  1921					CURRENT BITS:
  1922					  15-17 - HANDLE TYPE (FRAME, PROCESS, CLUB)
  1923					OTHER BITS WILL BE USED IN THE FUTURE TO CREATE HANDLES
  1924					WHICH CANNOT BE PASSED OR COPIED.
  1925				ON SUCCESS, RH OF AC IS SET TO FD OF NEW HANDLE
  1926
  1927				RULES FOR HANDLE CONVERSION, RESULTANT RIGHTS:
  1928
  1929				SOURCE		CREATE		MAX RIGHTS SETTING
  1930				--------------------------------------------------
  1931				LIC		LIC		HANDLE
  1932						FRAME		HANDLE
  1933						PROCESS		HANDLE,PNO FROM CURRENT
  1934				FRAME		LIC		FROM PROCESS LICENSE
  1935						FRAME		HANDLE
  1936						PROCESS		HANDLE .AND. MFR, PNO FROM CURRENT
  1937				PROCESS		LIC		FROM PROCESS LICENSE
  1938						FRAME		(ILLEGAL)
  1939						PROCESS		HANDLE, PNO FROM HANDLE
  1940				ABS FRAME	LIC		FROM PROCESS LICENSE
  1941						FRAME		FROM PROCESS LICENSE
  1942						PROCESS		FROM PROCESS LICENSE,PNO FROM CURRENT
  1943
  1944				SOURCE FD OF "CHILD" IS TREATED LIKE FRAME HANDLE.
  1945				SOURCE FD OF "PARENT" IS TREATED LIKE PROCESS HANDLE.
  1946				SOURCE FD OF "SELF" IS TREATED LIKE PROCESS HANDLE.
  1947				"SELF" PROCESS HANDLE BEHAVES AS IF ALL RIGHTS BITS WERE SET.
  1948
  1949				NOTE THAT A HANDLE OTHER THAN A LICENSED ONE IS NEEDED TO
  1950				CREATE A NEW LICENSED HANDLE WITH MAX RIGHTS BASED ON PROCESS LICENSE
  1951				RATHER THAN THE LICENSE IN THE HANDLE. THIS IS TO MAKE COPYING
  1952				AND PASSING HANDLES EASIER.
  1953				#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 35
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  1954				EXTERNAL GETWDS,FHIN,FCREQ,FCWAIT,JBTABT
  1955
  1956	001667'	256200	003776'	FRMCFH:	UMOVE	P2,(M)		;GET BITS+TYPE,,FD FOR NEW HANDLE
  1957	001670'	201615	500000		MOVEI	P1,-.FDFRH(P2)	;GET INDEX IN P1 (WE HOPE)
  1958	001671'	602600	700000		TRNE	P1,700000	;IF IT WASN'T HANDLE, BOMB
  1959	001672'	254000	003617'		JRST	FEWFHE		;HANDLE EXPECTED.
  1960	001673'	474700	000000		SETO	P3,		;NO SPECIAL ACCESS NEEDED - CHECK LATER.
  1961	001674'	260040	003042'		PUSHJ	P,FDWUPX
  1962	001675'	254000	000674'		  JRST	FRVERR		;NO, ERROR CODE IS IN P3
  1963	001676'	640600	077777		TRC	P1,77777	;SEE IF WANTS NEW ONE ALLOCATED
  1964	001677'	646600	077777		TRCN	P1,77777	;SIP IF INDEX WAS NOT ALL ONES
  1965	001700'	254000	001706'		JRST	FRMCF1		;IS ALL ONES, GO CREATE ONE.
  1966	001701'	303600	001051*		CAILE	P1,FHIMAX	;HE PROVIDES THE NUMBER. MAKE SURE ITS LEGAL
  1967	001702'	254000	003610'		JRST	FEWBDH		;NOT IN RANGE, BOMB
  1968	001703'	332014	000000*		SKIPE	%UPT+UPTFHT(P1)	;LEGAL, BUT IS IT FREE?
  1969	001704'	254000	003620'		JRST	FEWFHU		;NO, HANDLE USED.
  1970	001705'	254000	001713'		JRST	FRMCF3		;ALL SET.
  1971	001706'	205600	000000*	FRMCF1:	MOVSI	P1,-FHIN	;GET AOBJN POINTER FOR SEARCH
  1972	001707'	332014	000000*	FRMCF2:	SKIPE	%UPT+UPTFHT(P1)	;UNUSED?
  1973	001710'	253600	001707'		AOBJN	P1,FRMCF2	;USED.
  1974	001711'	325600	003621'		JUMPGE	P1,FEWNFH	;NO MORE HANDLES LEFT.
  1975	001712'	553000	000014		HRRZS	P1		;GET RID OF COUNT
  1976	001713'	201340	000005	FRMCF3:	MOVEI	T2,.FHSIZ	;THIS IS HOW BIG A HANDLE IS
  1977	001714'	260040	000000*		PUSHJ	P,GETWDS	;GET A BLOCK OF FREE CORE
  1978					  JRST	[AOS FCREQ
  1979						 PUSHJ P,FCWAIT
  1980						 SOS FCREQ	;ONE LESS WAITER
  1981	001715'	254000	003777'			 JRST FRMCF3]	;AND TRY AGAIN
  1982	001716'	500100	000015		HLL	J,P2		;GET BITS+TYPE,,FRAME NUMBER IN J
  1983	001717'	200700	000006		MOVE	P3,T1		;GET ADDRESS OF BLOCK IN SAFER P3
  1984	001720'	202714	000000*		MOVEM	P3,%UPT+UPTFHT(P1) ;KEEP TRACK OF IT.
  1985					MOVEI	T1,CFHABT	;PLACE TO GIVE BACK FREE CORE IN CASE OF ILL MEM REF OR SOMETHI
  1986	001721'	201300	001743'	NG
  1987	001722'	504300	000014		HRL	T1,P1		;GET FRAME HANDLE NUMBER FOR CFHABT
  1988	001723'	200340	000000*		MOVE	T2,%UPT+UPTJOB
  1989	001724'	202307	000000*		MOVEM	T1,JBTABT(T2)	;STORE FOR CURRENTLY RUNNING FRAME.
  1990	001725'	256200	004003'		UMOVE	PG,1(M)		;GET COUNT,,USER ADDRESS
  1991								;COUNT WILL BE CHECKED BY FILLFH
  1992	001726'	260040	001751'		PUSHJ	P,FILLFH	;FILL IN ACCESS RIGHTS, UID, FRAME NUMBER
  1993	001727'	254000	001735'		  JRST	FRMCFE		;ERROR OF SOME SORT, CODE IN P3
  1994	001730'	200300	000000*		MOVE	T1,%UPT+UPTJOB
  1995	001731'	402006	001724*		SETZM	JBTABT(T1)	;NO LONGER NEED THIS.
  1996	001732'	201614	300000		MOVEI	P1,.FDFRH(P1)	;MAKE INDEX NUMBER INTO FRAME DESCRIPTOR
  1997	001733'	256200	004004'		XCTTU	<MOVEM P1,(W)>	;FILL IN RH OF AC WITH FD FOR THE NEW HANDLE.
  1998	001734'	254000	001637*		JRST	CPOPJ1		;AND GIVE SUCCESS RETURN.
  1999
  2000				;HERE IF FILLFH GAVE AN ERROR, CODE IN P3.
  2001
  2002	001735'	400340	000000	FRMCFE:	SETZ	T2,		;GET RID OF HANDLE
  2003	001736'	250354	000000*		EXCH	T2,%UPT+UPTFHT(P1)
  2004	001737'	201300	000005		MOVEI	T1,.FHSIZ	;NUMBER OF WORDS TO GIVE BACK
  2005	001740'	621340	777777		TLZ	T2,-1		;GET RID OF JUNK IN LH OF T2
  2006	001741'	260040	000000*		PUSHJ	P,GIVWDS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 35-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  2007	001742'	324740	000674'		PJRST	FRVERR		;STORE CODE IN P3 BACK AND GIVE ERROR RETURN.
  2008
  2009	001743'	557000	000006	CFHABT:	HLRZS	T1		;GET INDEX NUMBER IN T1
  2010	001744'	400340	000000		SETZ	T2,
  2011	001745'	250346	000000*		EXCH	T2,%UPT+UPTFHT(T1) ;GET ADDRESS OF HANDLE
  2012	001746'	201300	000005		MOVEI	T1,.FHSIZ	;SIZE OF IT
  2013	001747'	621340	777777		TLZ	T2,-1		;JUST ADDRESS IN T2
  2014	001750'	324740	001741*		PJRST	GIVWDS		;GIVE IT BACK.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 36
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  2015				COMMENT ;@@SUBROUTINE FILLFH
  2016				@@PURPOSE USING FRAME DESCRIPTOR IN P4, FILLS IN PROPER ACCESS RIGHTS
  2017				, FRAME NUMBER AND UNIVERSAL ID NUMBER IN A HANDLE CORE BLOCK.
  2018				@@ENTRY	P1/HANDLE INDEX NUMBER
  2019					J/ BITS+TYPE,,FRAME NUMBER OF SAID FRAME
  2020					%UPX/ CONTEXT PAGES OF SAID FRAME
  2021					P3/ HANDLE BLOCK ADDRESS
  2022					P4/ FD FOR TARGET FRAME OR PROCESS
  2023					PG/ COUNT,,USER ADDR OF USER'S ACCESS BIT SPECIFICATION
  2024				@@ACCUM T1-T4,F,M,U,P2,P4,S
  2025				@@EXIT NON-SKIP IF ERROR ENCOUNTERED, ERROR CODE IN P3
  2026					SKIP IF OK, HANDLE FILLED IN CORRECTLY.
  2027				@@;
  2028
  2029	001751'	202116	000000	FILLFH:	MOVEM	J,.FHTYP(P3)	;STORE BITS+TYPE,,FNO IN .FHTYP/.FDFNO
  2030	001752'	200302	001057*		MOVE	T1,JBTUID(J)	;GET ID NUMBER
  2031	001753'	202316	000001		MOVEM	T1,.FHUID(P3)	;SET THAT ALSO
  2032	001754'	201440	001756'		MOVEI	T4,FILLTB	;GET ADDR OF TABLE IN RH OF T4
  2033	001755'	254000	003352'		JRST	FDDSP		;AND DISPATCH.
  2034
  2035	001756'	254000	002072'	FILLTB:	JRST	FILABS		;(0)ABSOLUTE FRAME NUMBER
  2036	001757'	256000	000000'		STOPCD			;(1)FAMILY, USES WORDS BELOW
  2037	001760'	256000	000000'		STOPCD			;(2)OTHER FRAME
  2038	001761'	254000	001770'		JRST	FILFRH		;(3)HANDLE
  2039	001762'	256000	000000'		STOPCD			;(4)UNDEFINED (WAS SUPPOSED TO BE CHECKED)
  2040	001763'	256000	000000'		STOPCD			;(5)UNDEFINED
  2041	001764'	256000	000000'		STOPCD			;(6)UNDEFINED
  2042	001765'	254000	002043'		JRST	FILSLF		;(7) OWN FRAME
  2043	001766'	254000	002054'		JRST	FILCHL		;(1,0)CHILD
  2044	001767'	254000	002030'		JRST	FILPAR		;(1,1)PARENT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 37
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  2045				;HERE FOR HANDLE.
  2046
  2047				EXTERNAL TPOPJ
  2048
  2049	001770'	135400	004005'	FILFRH:	LDB	T3,[POINT 15,P4,35] ;GET INDEX OF OLD HANDLE
  2050	001771'	200410	000000*		MOVE	T3,%UPT+UPTFHT(T3)	;GET BITS IN LH T3
  2051	001772'	135300	004006'		LDB	T1,[HTPPTR(.FHTYP(T3))]	;GET SOURCE HANDLE TYPE
  2052	001773'	260040	002102'		PUSHJ	P,CHKHDL	;T1/ SOURCE HANDLE TYPE
  2053	001774'	263040	000000		  POPJ	P,		;P3 HAS ERROR CODE
  2054	001775'	302300	000002		CAIE	T1,.FHLIC	;IF SOURCE NOT LIC AND
  2055	001776'	302340	000002		CAIE	T2,.FHLIC	;DEST IS,
  2056	001777'	254000	002001'		JRST	.+2		;(EITHER SOURCE LIC OR DEST NOT LIC)
  2057	002000'	254000	002075'		JRST	FILAB0		; THEN SET ACCESS IN NEW HANDLE ACCORDING TO PROCESS LICENSE.
  2058	002001'	261040	000006		PUSH	P,T1		;REMEMBER SOURCE HANDLE TYPE ON STACK
  2059	002002'	200450	000002		MOVE	T4,.FHPNO(T3)	;ASSUME PNO COMES FROM OLD HANDLE
  2060	002003'	302300	000001		CAIE	T1,.FHPRC	;IF SOURCE IS LIC OR FRAME HANDLE,
  2061	002004'	200442	000000*		MOVE	T4,JBTPNO(J)	;GET CURRENT PNO FOR TARGET.
  2062	002005'	202456	000002		MOVEM	T4,.FHPNO(P3)	;THIS GOES IN TOO.
  2063	002006'	205750	000003		MOVSI	P4,.FHART(T3)	;ADDRESS OF FAST RIGHTS MAX
  2064	002007'	541750	000004		HRRI	P4,.FHART+1(T3)	;ADDRESS OF SLOW MAX HE CAN HAVE
  2065	002010'	260040	002574'		PUSHJ	P,SETHDL	;SET RIGHTS IN HANDLE
  2066	002011'	254000	000000*		  JRST	TPOPJ		;SOMETHING WENT WRONG.
  2067	002012'	262040	000007		POP	P,T2		;GET SOURCE HANDLE TYPE BACK INTO T2
  2068	002013'	135300	004007'		LDB	T1,[HTPPTR(.FHTYP(P3))]	;GET KIND OF HANDLE WE'RE CREATING
  2069	002014'	306340	000000		CAIN	T2,.FHFRM	;IF SOURCE HANDLE IS FRAME AND
  2070	002015'	302300	000001		CAIE	T1,.FHPRC	;TRYING TO CREATE PROCESS HANDLE
  2071	002016'	254000	001734*		JRST	CPOPJ1		;NO, IF ITS FRAME HANDLE, ALWAYS SUBJECT TO MFR
  2072								;THEN SET RIGHTS DOWN ACCORDING TO MFR.
  2073	002017'	200302	001066*	FILFH0:	MOVE	T1,JBTMFR(J)	;GET MAX FRAME RIGHTS
  2074	002020'	406316	000003		ANDM	T1,.FHART(P3)	;SET THEM DOWN
  2075	002021'	201440	000000		MOVEI	T4,.ARSIZ-1	;HIGHEST INDEX TO USE FOR UPTMFR
  2076	002022'	201416	000004		MOVEI	T3,.FHART+FARSIZ+.ARSIZ-1(P3) ;ADDRESS TO AND TO
  2077	002023'	200311	000000*	FILFH1:	MOVE	T1,%UPX+UPTMFR(T4) ;GET WORD
  2078	002024'	406310	000000		ANDM	T1,(T3)
  2079	002025'	275400	000001		SUBI	T3,1
  2080	002026'	365440	002023'		SOJGE	T4,FILFH1	;KEEP GOING.
  2081	002027'	254000	002016*		JRST	CPOPJ1
  2082
  2083				;HERE FOR PARENT
  2084
  2085	002030'	201300	000001	FILPAR:	MOVEI	T1,.FHPRC	;CHILD TO PARENT IS PROCESS HANDLE
  2086	002031'	260040	002102'		PUSHJ	P,CHKHDL	;SEE IF OK
  2087	002032'	263040	000000		  POPJ	P,		;NOT FOR SOME REASON.
  2088	002033'	306340	000002		CAIN	T2,.FHLIC	;TRYING TO CREATE LICENSED HANDLE?
  2089	002034'	254000	002075'		JRST	FILAB0		;YES, DO IT ACCORDING TO PROCESS LICENSE.
  2090	002035'	200400	000000*		MOVE	T3,%UPT+UPTJOB	;GET OUR FRAME NUMBER
  2091	002036'	200310	000000*		MOVE	T1,JBTSPN(T3)	;PROG THAT GAVE US RIGHTS
  2092	002037'	202316	000002		MOVEM	T1,.FHPNO(P3)	;SAME ONE THAT GAVE US CHILD TO PARENT RIGHTS.
  2093	002040'	205750	000000*		MOVSI	P4,JBTS2P(T3)	;ADDRESS OF MAX FAST RIGHTS
  2094	002041'	541740	000000*		HRRI	P4,%UPT+UPTS2P	;AND SLOW ONES
  2095	002042'	324740	002574'		PJRST	SETHDL		;GO SET THE RIGHTS.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 38
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  2096				;HERE FOR SELF FRAME DESCRIPTOR
  2097
  2098	002043'	201300	000001	FILSLF:	MOVEI	T1,.FHPRC	;SELF TO SELF IS PROCESS ONLY, NOT FRAME
  2099	002044'	260040	002102'		PUSHJ	P,CHKHDL	;SEE IF CAN DO IT
  2100	002045'	263040	000000		  POPJ	P,		;NO.
  2101	002046'	306340	000002		CAIN	T2,.FHLIC	;TRYING TO CREATE LIC HANDLE?
  2102	002047'	254000	002075'		JRST	FILAB0		;YES, DO IT ACCORDING TO PROCESS LICENSE.
  2103	002050'	200402	002004*		MOVE	T3,JBTPNO(J)	;NO, NEED TO FILL IN PROCESS HANDLE
  2104	002051'	202416	000002		MOVEM	T3,.FHPNO(P3)	;WITH PROCESS NUMBER OF OUR "SELF" HANDLE (CURRENT PNO)
  2105	002052'	400740	000000	FILSL0:	SETZ	P4,		;NO MAX RIGHTS CHECK NEEDED.
  2106	002053'	324740	002574'		PJRST	SETHDL		;JUST SET THE BITS FROM USER SPEC.
  2107
  2108				;HERE FOR CHILD
  2109
  2110	002054'	201300	000000	FILCHL:	MOVEI	T1,.FHFRM	;PARENT TO CHILD IS FRAME HANDLE
  2111	002055'	260040	002102'		PUSHJ	P,CHKHDL	;SEE IF CAN DO IT
  2112	002056'	263040	000000		  POPJ	P,		;NO
  2113	002057'	306340	000002		CAIN	T2,.FHLIC	;TRYING TO CREATE LIC HANDLE?
  2114	002060'	254000	002075'		JRST	FILAB0		;YES, DO IT ACCORDING TO PROCESS LICENSE.
  2115	002061'	205742	000404*		MOVSI	P4,JBTP2S(J)	;GET THE MAX RIGHTS WE CAN HAVE OER IT
  2116	002062'	541740	000000*		HRRI	P4,%UPX+UPTP2S	;ADDRESS OF SLOW RIGHTS
  2117	002063'	200442	002050*		MOVE	T4,JBTPNO(J)	;GET PNO IN CASE ITS A PROCESS HANDLE
  2118	002064'	202456	000002		MOVEM	T4,.FHPNO(P3)	;STORE IT
  2119	002065'	306340	000000		CAIN	T2,.FHFRM	;CREATING A FRAME HANDLE?
  2120	002066'	324740	002574'		PJRST	SETHDL		;YES, NO NEED TO CUT RIGHTS DOWN.
  2121	002067'	260040	002574'		PUSHJ	P,SETHDL	;COPY RIGHTS
  2122	002070'	263040	000000		  POPJ	P,		;SOME SORT OF ERROR, CODE STORED THRU (W)
  2123	002071'	324740	002017'		PJRST	FILFH0		;OK, SET THEM DOWN ACCORDING TO MFR.
  2124
  2125				;ABSOLUTE
  2126
  2127	002072'	201300	000002	FILABS:	MOVEI	T1,.FHLIC	;IF OUR LICENSE IS HIGH ENOUGH
  2128	002073'	260040	002102'		PUSHJ	P,CHKHDL	;LET HIM HAVE ANYTHING
  2129	002074'	263040	000000		  POPJ	P,		;BAD DESIRED TYPE
  2130	002075'	200402	002063*	FILAB0:	MOVE	T3,JBTPNO(J)	;IN CASE ITS PROCESS HANDLE, MAKE IT VALID
  2131	002076'	202416	000002		MOVEM	T3,.FHPNO(P3)
  2132	002077'	260040	003300'		PUSHJ	P,ABSACC	;SET P4 TO ADDR,,ADDR+1 OF ABS RIGHTS HE HAS OVER TARGET
  2133	002100'	254000	003540'		  JRST	FENLC		;CAN'T CREATE, NOT ENOUGH LICENSE.
  2134	002101'	324740	002574'		PJRST	SETHDL		;AND GO SET FROM USER'S SPEC.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 39
FRMSER.MAC	 8-DEC-87 16:09		.FOCFH=12 Create handle

  2135				COMMENT ;@@SUBROUTINE CHKHDL
  2136				@@PURPOSE SEE IF IT IS LEGAL TO GENERATE A FRAME HANDLE
  2137				@@ENTRY	J/LH CONTAINS TYPE OF HANDLE TRYING TO CREATE IN FH.TYP FIELD
  2138					T1/TYPE OF "HANDLE" TRYING TO CREATE NEW HANDLE WITH
  2139					   (PARENT TO CHILD, "FRAME HANDLE"
  2140					    CHILD TO PARENT, "PROCESS HANDLE" SUBJECT TO S2P RIGHTS)
  2141				@@ACCUM T2
  2142				@@EXIT NON-SKIP WITH ERROR CODE IN P3 IF CANNOT DO THE CREATE
  2143					SKIP IF CAN, WITH T2/HANDLE TYPE OF NEW HANDLE
  2144				@@FUNCTION FRAME OR LICENSED HANDLE CAN CREATE FRAME, LICENSED OR PROCESS HANDLE
  2145				PROCESS HANDLE CAN ONLY CREATE PROCESS OR LICENSED HANDLES.
  2146				@@;
  2147	002102'	135340	004010'	CHKHDL:	LDB	T2,[HTPPTR(J)]	;GET TYPE OF HANDLE DESIRED
  2148	002103'	303340	000002		CAILE	T2,.FHMAX	;IN RANGE?
  2149	002104'	254000	003563'		JRST	FEBHT		;NO. BAD HANDLE TYPE.
  2150	002105'	302300	000001		CAIE	T1,.FHPRC	;SOURCE IS PROCESS HANDLE?
  2151	002106'	254000	002027*		JRST	CPOPJ1		;NO, FRAME HANDLES AND LIC HANDLES CAN CREATE EVERYTHING.
  2152	002107'	306340	000000		CAIN	T2,.FHFRM	;IF PROCESS HANDLE TRIES TO CREATE FRAME HANDLE,
  2153	002110'	254000	003564'		JRST	FECCH		;GIVE ERROR RETURN
  2154					JRST	CPOPJ1		;OK, PROCESS CAN CREATE PROCESS OR LIC IF OWNING PROCESS HAS TH
  2155	002111'	254000	002106*	E LIC.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 40
FRMSER.MAC	 8-DEC-87 16:09		.FODFH=13 Destroy handle

  2156				SUBTTL	.FODFH=13 Destroy handle
  2157
  2158				COMMENT #FRMOP TO DESTROY A HANDLE. FRAME DESCRIPTOR
  2159				FOR THE HANDLE IN P4.
  2160				#
  2161
  2162				EXTERNAL GIVWDS
  2163
  2164	002112'	201757	500000	FRMDFH:	MOVEI	P4,-.FDFRH(P4) ;GET INDEX ALONE POSSIBLY
  2165	002113'	602740	700000		TRNE	P4,700000	;HE MUST HAVE SPECIFIED A HANDLE FD
  2166	002114'	254000	003617'		JRST	FEWFHE		;HANDLE EXPECTED
  2167	002115'	303740	001701*		CAILE	P4,FHIMAX	;MAKE SURE ITS IN RANGE
  2168	002116'	254000	003610'		JRST	FEWBDH		;ITS NOT, BAD HANDLE ERROR RETURN
  2169	002117'	400340	000000	FRMDFR:	SETZ	T2,		;CLEAR THE SLOT
  2170	002120'	250357	000000*		EXCH	T2,%UPT+UPTFHT(P4) ;GET THE HANDLE
  2171	002121'	322340	003575'		JUMPE	T2,FEWNOH	;THERE WAS NO HANDLE IN HANDLE SLOT
  2172	002122'	350001	000000		AOS	(P)		;OK, WE WILL SUCCEED
  2173	002123'	201300	000005		MOVEI	T1,.FHSIZ	;GIVE BACK THIS MANY
  2174	002124'	621340	777777		TLZ	T2,-1		;JUST ADDRESS IN RH.
  2175	002125'	324740	001750*		PJRST	GIVWDS		;MAKE IT DISAPPEAR.
  2176
  2177				;ROUTINE CALED BY RESET TO RELEASE ALL HANDLES
  2178				; USES T1-T4, P4.
  2179
  2180	002126'	205740	000000*	RESFRH::MOVSI	P4,-FHIN	;AOBJN POINTER
  2181	002127'	400340	000000	RESFR1:	SETZ	T2,
  2182	002130'	250357	000000*		EXCH	T2,%UPT+UPTFHT(P4) ;GET HANDLE
  2183	002131'	322340	002135'		JUMPE	T2,RESFR2	;DON'T CALL IF NONE
  2184	002132'	201300	000005		MOVEI	T1,.FHSIZ	;HOW MANY TO GIVE BACK
  2185	002133'	621340	777777		TLZ	T2,-1		;JUST ADDRESS IN RH(T2)
  2186	002134'	260040	002125*		PUSHJ	P,GIVWDS
  2187	002135'	253740	002127'	RESFR2:	AOBJN	P4,RESFR1	;AND LOOP.
  2188	002136'	263040	000000		POPJ	P,		;RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 41
FRMSER.MAC	 8-DEC-87 16:09		.FOSMF=20 Set Max Frame Rights

  2189				SUBTTL	.FOSMF=20 Set Max Frame Rights
  2190
  2191				;FRMOP TO SET MAX FRAME RIGHTS.
  2192				; AC/FN,,FD E/COUNT,,ADDR OF RIGHTS.
  2193				; IF CALLER HAS THE RIGHTS, HE CAN SET MFR TO ANY DESIRED VALUE.
  2194
  2195	002137'	256200	003776'	FRMSMF:	UMOVE	P2,(M)		;GET COUNT,,ADDR
  2196	002140'	201700	000060		MOVEI	P3,.ARSMF	;SET MFR RIGHT NEEDED
  2197	002141'	260040	003042'		PUSHJ	P,FDRUPX	;GET CONTEXT PAGES
  2198	002142'	254000	000674'		  JRST	FRVERR
  2199	002143'	200140	000015		MOVE	PG,P2		;OK GET INTO PG
  2200	002144'	400740	000000		SETZ	P4,		;NO MAXIMUM NEEDED
  2201	002145'	205702	002017*		MOVSI	P3,JBTMFR(J)	;ADDRESS OF FAST RIGHTS TO SET
  2202	002146'	541700	000000*		HRRI	P3,%UPX+UPTMFR	;ADDRESS OF SLOW RIGHTS
  2203	002147'	400740	000000		SETZ	P4,		;NO MAX TO WORRY ABOUT
  2204	002150'	260040	002604'		PUSHJ	P,SETARN	;DO IT
  2205	002151'	324740	000674'		  PJRST	FRVERR		;STORE ERROR CODE AND GIVE ERROR RETURN
  2206	002152'	324740	002111*		PJRST	CPOPJ1		;OK, RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 42
FRMSER.MAC	 8-DEC-87 16:09		.FOCHR=21 Change rights in a handle

  2207				SUBTTL	.FOCHR=21 Change rights in a handle
  2208
  2209				;FRMOP TO CHANGE RIGHTS IN A HANDLE WHICH CALLER OWNS.
  2210				; AC/FN,,FD OF HANDLE E/COUNT,,ADDR OF RIGHTS
  2211				;
  2212				;CANNOT CHANGE RIGHTS OF "SELF" HANDLE, "ABS" HANDLE.
  2213				;OTHER HANDLES CAN ONLY SET RIGHTS LOWER, EXCEPT FOR
  2214				; PROCESS HANDLES, WHICH CAN BE SET TO ANY VALUE - AND PNO
  2215				; IN THE HANDLE IS INVALIDATED.
  2216
  2217	002153'	256200	004011'	FRMCHR:	UMOVE	PG,(M)		;GET COUNT,,ADDR INTO PG
  2218	002154'	201440	002156'		MOVEI	T4,RCHTAB	;GET TABLE ADDRESS
  2219	002155'	254000	003352'		JRST	FDDSP		;DISPATCH
  2220
  2221	002156'	254000	003624'	RCHTAB:	JRST	FEWBHT		;(0) ABS FRAME, CANNOT CHANGE THIS.
  2222	002157'	256000	000000'		STOPCD			;(1) FAMILY
  2223	002160'	256000	000000'		STOPCD			;(2) OTHER FRAME, SHOULD BE CONVERTED
  2224	002161'	254000	002170'		JRST	CHRFRH		;(3) HANDLE
  2225	002162'	254000	003602'		JRST	FEWUND		;(4) UNDEFINED
  2226	002163'	254000	003602'		JRST	FEWUND		;(5) UNDEFINED
  2227	002164'	254000	003602'		JRST	FEWUND		;(6) UNDEFINED
  2228	002165'	254000	003624'		JRST	FEWBHT		;(7) OWN FRAME, CAN'T CHANGE IT
  2229	002166'	254000	002223'		JRST	CHRCHL		;(1,0) CHILD
  2230	002167'	254000	002207'		JRST	CHRPAR		;(1,1) PARENT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 43
FRMSER.MAC	 8-DEC-87 16:09		.FOCHR=21 Change rights in a handle

  2231				;HERE TO CHANGE RIGHTS IN A HANDLE
  2232
  2233	002170'	200700	000017	CHRFRH:	MOVE	P3,P4		;GET DESCRIPTOR
  2234	002171'	405700	077777		ANDI	P3,FDDMSK	;JUST INDEX
  2235	002172'	200716	000000*		MOVE	P3,%UPT+UPTFHT(P3) ;GET ADDRESS IN P3
  2236	002173'	205756	000003		MOVSI	P4,.FHART(P3)	;CANNOT SET RIGHTS HIGHER THAN CURRENT VALUES
  2237	002174'	541756	000004		HRRI	P4,.FHART+1(P3)	;P4/SLOW,,FAST MAX RIGHTS
  2238	002175'	135300	004007'		LDB	T1,[HTPPTR(.FHTYP(P3))] ;GET HANDLE TYPE
  2239	002176'	302300	000001		CAIE	T1,.FHPRC	;IF NOT PROCESS HANDLE
  2240	002177'	665500	200000		TLOA	W,LIMMAX	;DON'T SET ANY RIGHTS HIGHER THAN MAX
  2241	002200'	621500	200000		TLZ	W,LIMMAX	;ELSE PROCESS, CAN SET TO ANY VALUE.
  2242	002201'	260040	002574'		PUSHJ	P,SETHDL	;SET HANDLE RIGHTS
  2243	002202'	325500	000674'		  JUMPGE W,FRVERR	;IF COUNT ERROR, STORE CODE AND GIVE ERROR
  2244	002203'	325500	002152*		JUMPGE	W,CPOPJ1	;IF MAX NOT VIOLATED, GIVE GOOD RETURN NOW.
  2245	002204'	607500	200000		TLNN	W,LIMMAX	;SKIP IF NOT PROCESS HANDLE
  2246					JRST	[SETOM .FHPNO(P2) ;PROCESS, INVALIDATE PNO - HANDLE ADDRESS IN P2 NOW.
  2247	002205'	254000	004012'			 JRST CPOPJ1]	;AND SUCCEED.
  2248	002206'	254000	003577'		JRST	FEWNRT		;SAY RIGHTS VIOLATION AND RETURN MAX RIGHTS HE CAN HAVE.
  2249
  2250				;HERE TO SET CHILD TO PARENT PROCESS HANDLE RIGHTS
  2251
  2252	002207'	260040	003102'	CHRPAR:	PUSHJ	P,FD2FNO	;MAKE SURE THERE IS A PARENT
  2253	002210'	254000	000674'		  JRST	FRVERR		;GUESS NOT
  2254	002211'	200100	000000*		MOVE	J,%UPT+UPTJOB	;GET CALLER'S FRAME NUMBER IN J
  2255	002212'	205702	002040*		MOVSI	P3,JBTS2P(J)	;ADDRESS OF FAST RIGHTS TO CHANGE
  2256	002213'	541700	000000*		HRRI	P3,%UPT+UPTS2P	;AND SLOW ONES
  2257	002214'	200740	000016		MOVE	P4,P3		;THIS IS MAX TOO
  2258	002215'	621500	200000		TLZ	W,LIMMAX	;WHICH ARE JUST FOR SEEING WHETHER TO SMASH PNO
  2259	002216'	260040	002604'		PUSHJ	P,SETARN	;SET THE RIGHTS TO WHAT HE WANTS
  2260	002217'	325500	000674'		  JUMPGE W,FRVERR	;IF NOT MAX VIOLATION, STORE AND RETURN.
  2261	002220'	325500	002203*		JUMPGE	W,CPOPJ1	;IF NOT INCREASING, GIVE GOOD RETURN.
  2262	002221'	476002	002036*		SETOM	JBTSPN(J)	;INCREASED. SMASH SPN.
  2263	002222'	254000	002220*		JRST	CPOPJ1		;AND RETURN.
  2264
  2265				;HERE TO SET PARENT TO CHILD FRAME HANDLE RIGHTS
  2266
  2267	002223'	200640	000003	CHRCHL:	MOVE	P2,PG		;SAVE PG
  2268	002224'	474700	000000		SETO	P3,		;NO SPECIAL RIGHTS NEEDED TO LOOK
  2269	002225'	260040	003042'		PUSHJ	P,FDRUPX	;GET, OUR RIGHTS ARE IN CHILD UPT
  2270	002226'	254000	000674'		  JRST	FRVERR		;SORRY, SOMETHING IS WRONG.
  2271	002227'	200140	000015		MOVE	PG,P2		;GET ARG COUNT,,ADDR BACK IN PG
  2272	002230'	205702	002061*		MOVSI	P3,JBTP2S(J)	;PARENT'S FAST RIGHTS OVER CHILD ADDRESS
  2273	002231'	541700	000000*		HRRI	P3,%UPX+UPTP2S	;ADDRESS OF PAR'S SLOW RIGHTS OVER CHILD
  2274	002232'	200740	000016		MOVE	P4,P3		;CANNOT SET HIGHER THAN CURRENT VALUES
  2275	002233'	661500	200000		TLO	W,LIMMAX	;DO NOT UNDER ANY CIRCUMSTANCES SET RIGHTS HIGHER THAN ALLOWED
  2276	002234'	260040	002604'		PUSHJ	P,SETARN	;COPY THE RIGHTS
  2277	002235'	324740	000674'		  PJRST	FRVERR		;MAX VIOLATION OR OTHER ERROR, STORE CODE AND ERROR RETURN
  2278	002236'	254000	002222*		JRST	CPOPJ1		;ALL OK, GOOD RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 44
FRMSER.MAC	 8-DEC-87 16:09		.FOVCH=27 Validate Child to Parent Handle for a child

  2279				SUBTTL	.FOVCH=27 Validate Child to Parent Handle for a child
  2280
  2281				COMMENT #
  2282				CALL:
  2283					MOVE	AC,[.FOVCH,,FD]
  2284					FRMOP	AC,<ADDR>
  2285					  <ERROR RETURN>
  2286					<SUCCESS RETURN>
  2287
  2288
  2289				<ADDR>:	COUNT,,ADDR		;OF RIGHTS WHICH MUST MATCH IN CHILD'S PROCESS HANDLE
  2290
  2291				GIVE ERROR RETURN IF COUNT IS BAD OR IF THE ACCESS RIGHTS IN CHILD'S
  2292				HANDLE DO NOT MATCH THOSE GIVEN AT <ADDR> EXACTLY. (THIS IS SO
  2293				THAT A PARENT CAN READ IN THE RIGHTS OF ITS CHILD'S HANDLE TO
  2294				ITSELF AND THEN VALIDATE THAT HANDLE IF AND ONLY IF
  2295				THE CHILD HASN'T CHANGED THE RIGHTS SINCE THEY WERE READ.
  2296				#
  2297
  2298	002237'	256200	003776'	FRMVCH:	UMOVE	P2,(M)		;GET COUNT,,ADDR IN P2
  2299	002240'	474700	000000		SETO	P3,		;NO ACCESS RIGHT NEEDED TO VALIDATE HANDLE TO OURSELVES
  2300	002241'	260040	003042'		PUSHJ	P,FDWUPX	;GET THEM SO CAN READ ACCESS RIGHTS
  2301	002242'	254000	000674'		  JRST	FRVERR		;NO GO.
  2302	002243'	260040	003002'		PUSHJ	P,ISCHLD	;THIS HAS TO BE FOR A CHILD FRAME
  2303					  JRST	FEWNCH		;SAY NOT A CHILD (SHARED CODE WITH ONE THAT SAYS FRAME NUMBER N
  2304	002244'	254000	003603'	OT THAT OF A CHILD)
  2305	002245'	205702	002212*		MOVSI	P3,JBTS2P(J)	;GET FAST RIGHTS OF THIS CHILD OVER ITS PARENT, THE CALLER
  2306	002246'	541700	000000*		HRRI	P3,%UPX+UPTS2P
  2307	002247'	200140	000015		MOVE	PG,P2		;GET INTO PG FOR CMPARN
  2308	002250'	260040	002256'		PUSHJ	P,CMPARN	;SEE IF RIGHTS MATCH USER ARG EXACTLY.
  2309	002251'	254000	000674'		  JRST	FRVERR		;STORE ERROR CODE IN P3 THRU (W)
  2310								;AND GIVE ERROR RETURN.
  2311	002252'	200300	000000*		MOVE	T1,%UPT+UPTJOB	;GET OUR JOB NUMBER
  2312	002253'	200306	002075*		MOVE	T1,JBTPNO(T1)	;GET OUR CURRENT PNO
  2313	002254'	202302	002221*		MOVEM	T1,JBTSPN(J)	;MAKE THE CHILD TO PARENT PROCESS HANDLE VALID.
  2314	002255'	254000	002236*		JRST	CPOPJ1		;AND GIVE THE GOOD RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 45
FRMSER.MAC	 8-DEC-87 16:09		.FOVCH=27 Validate Child to Parent Handle for a child

  2315				COMMENT ;@@SUBROUTINE CMPARN
  2316				@@PURPOSE SKIP IF RIGHTS USER IS SPECIFYING ARE GREATER THAN OR EQUAL TO
  2317				THOSE IN THE MONITOR ACCESS RIGHTS TABLE
  2318				@@ENTRY PG/COUNT,,USER ADDR OF USER RIGHTS BITS
  2319					P3/FAST RIGHTS ADDRESS,,SLOW RIGHTS ADDRESS
  2320					W/ USER AC NUMBER TO STORE ERROR CODE INTO
  2321				@@ACCUM T1-T4,F,M,U,P2,S
  2322				@@EXIT NON-SKIP IF RIGHTS IN MONITOR TABLE ARE NOT GEQ THOSE
  2323				SPECIFIED IN USER TABLE
  2324					SKIP IF USER RIGHTS ARE GEQ THE MONITOR ONES
  2325				@@;
  2326
  2327			000001	XP .UAWMX,<<.UAMAX+^D35>/^D36>	;NUMBER OF WORDS IN USER'S BIT MAP
  2328
  2329	002256'	265440	000000*	CMPARN:	JSP	T4,SAVE1	;SAVE P1
  2330	002257'	554000	000003		HLRZ	S,PG		;GET USER'S COUNT
  2331					JUMPE	S,CPOPJ1	;IF ZERO COUNT, HE MEANS ALL. WHATEVER THE MONITOR RIGHTS ARE, 
  2332	002260'	322000	002255*	THEY ARE OK.
  2333	002261'	303000	000001		CAILE	S,.UAWMX	;IN RANGE?
  2334	002262'	254000	003561'		JRST	FEBCN		;NO, BAD COUNT
  2335	002263'	271003	777777		ADDI	S,-1(PG)	;GET LAST WORD TO READ FROM
  2336	002264'	201240	003525'		MOVEI	U,U2MACT	;CONVERT USER BITS TO MONITOR BITS
  2337	002265'	265200	003377'		JSP	F,ACRPTR	;START THE BYTE POINTERS COMING
  2338	002266'	254000	002260*		  JRST	CPOPJ1		;MUST HAVE BEEN OK.
  2339	002267'	271403	000000		ADDI	T3,(PG)		;RELOACTE POINTER TO USER'S BLOCK
  2340	002270'	305010	000000		CAIGE	S,(T3)		;STILL WITHIN SPECIFIED RANGE?
  2341	002271'	634300	000006		TDZA	T1,T1		;NO, ASSUME HE MEANT ZERO RIGHTS
  2342	002272'	256040	004014'		XCTFU	<LDB T1,T3>	;ELSE GET THAT COLLECTION OF BITS
  2343	002273'	606440	777777		TRNN	T4,-1		;IF ZERO INDEX,
  2344					JRST	[HLR T4,P3	;THEN SETUP FAST RIGHTS ADDRESS
  2345	002274'	254000	004015'			 JRST .+2]
  2346	002275'	271456	777777		ADDI	T4,-1(P3)	;IS SLOW ADDRESS
  2347	002276'	135340	000011		LDB	T2,T4		;GET THE BYTE
  2348					TDZ	T2,T1		;MAKE SURE NO BITS SET IN MONITOR TABLE THAT AREN'T IN USER'S S
  2349	002277'	630340	000006	PEC
  2350	002300'	322353	000000		JUMPE	T2,(M)		;IF ZERO, THEN ALL BITS WERE OK.
  2351	002301'	254000	003571'		JRST	FERNE		;RIGHTS NOT EQUAL
  2352
  2353				REPEAT 0,<;NOT NEEDED YET.
  2354				;ROUTINE TO CHECK IF P4/FAST,,SLOW RIGHTS ARE LESS THAN OR EQUAL TO
  2355				; P3/FAST,,SLOW MAXIMUM RIGHTS. NON-SKIP IF NOT LESS OR EQUAL TO.
  2356				; SMASHES T1-T4.
  2357				
  2358				MAXCMP:	HLRZ	T1,P4		;GET FAST RIGHTS ADDRESS
  2359					MOVE	T1,(T1)		;GET THE DATA
  2360					HLRZ	T2,P3		;GET FAST MAX RIGHTS ADDRESS
  2361					TDZ	T1,(T2)		;CLEAR ALLOWED BITS
  2362					JUMPN	T1,CPOPJ	;IF ANYTHING LEFT, RIGHTS NOT LESS OR EQUAL TO
  2363					MOVSI	T4,-.UAWMX	;GET AOBJN POINTER TO ALLMFR
  2364					MOVE	T3,P4		;GET SLOW ADDRESS
  2365					HRLI	T3,T4		;INDEX BY T4
  2366					MOVE	T2,P3		;GET SLOW MAX ADDRESS
  2367					HRLI	T2,T4		;INDEX THAT BY T4 ALSO.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 45-2
FRMSER.MAC	 8-DEC-87 16:09		.FOVCH=27 Validate Child to Parent Handle for a child

  2368				CMPMX1:	MOVE	T1,@T3		;GET NEXT WORD
  2369					TDZ	T1,@T2		;CLEAR THE ALLOWED BITS
  2370					JUMPN	T1,CPOPJ	;IF ANYTHING LEFT, GIVE ERROR RETURN.
  2371					AOBJN	T4,CMPMX1	;YES, CONTINUE
  2372					JRST	CPOPJ1		;ALL RIGHTS ARE THE SAME, RETURN.
  2373				>;END REPEAT 0
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 46
FRMSER.MAC	 8-DEC-87 16:09		.FORSI=15 Return standard access rights info

  2374				SUBTTL	.FORSI=15 Return standard access rights info
  2375
  2376				;FRMOP TO RETURN STANDARD ACCESS BIT INFORMATION TO USER.
  2377				; AC/FN,,<TABLE NUMBER> E/COUNT,,ADDR
  2378				; RETURNS MAXIMUM USER RIGHT NUMBER IN AC.
  2379
  2380	002302'	256200	004011'	FRMRSI:	UMOVE	PG,(M)		;GET COUNT,,ADDR
  2381	002303'	323140	002312'		JUMPLE	PG,FRMARD	;JUST RETURN SIZE OF BIT TABLE IF NEGAITVE.
  2382	002304'	553000	000017		HRRZS	P4		;JUST TABLE ADDRESS
  2383	002305'	303740	000010		CAILE	P4,RSIMAX	;IN RANGE?
  2384	002306'	254000	003623'		JRST	FEWBTN		;BAD TABLE NUMBER
  2385	002307'	200757	002315'		MOVE	P4,RSITAB(P4)	;GET PROPER ADDRESS OF FAST,,SLOW IN P4
  2386	002310'	260040	002537'		PUSHJ	P,FRMRMR	;RETURN MONITOR RIGHTS TO USER
  2387	002311'	263040	000000		  POPJ	P,		;ERROR CODE STORED.
  2388	002312'	201300	000032	FRMARD:	MOVEI	T1,.UAMAX	;RETURN THIS IN AC FOR INFO PURPOSES
  2389	002313'	256200	003640'		UMOVEM	T1,(W)		;BACK IN HIS AC
  2390	002314'	254000	002266*		JRST	CPOPJ1		;DONE.
  2391
  2392				;TABLE OF ADDRESSES OF STANDARD BIT TABLES TO RETURN.
  2393
  2394				DEFINE RSIMAC<XALL
  2395				X(EXOMFR)			;;(0)EXECUTE ONLY
  2396				X(RDXMFR)			;;(1)EXECUTE ONLY + READ FUNCTIONS, IN CASE PROCESS HAS MORE CA
  2397				PABILITY THAN FRAME
  2398				X(ALLMFR)			;;(2)ALL RIGHTS BITS CURRENTLY DEFINED
  2399				X(RCATAB)			;;(3)RIGHTS THAT RC LICENSE GIVES
  2400				X(SYSTAB)			;;(4)RIGHTS THAT SY LICENSE GIVES
  2401				X(TYPTAB)			;;(5)TYMSHARE PROPRIETARY RIGHTS
  2402				X(AUNTAB)			;;(6)RIGHTS THAT SAME AUN OR ACC SUPER GIVES
  2403				X(JALTAB)			;;(7)RIGHTS THAT JL LICENSE GIVES
  2404				X(WCATAB)			;;(10)RIGHTS THAT WC LICENSE GIVES
  2405				SALL>
  2406
  2407				DEFINE X(NAME)<'NAME,,'NAME+1>
  2408	002315'			RSITAB:	RSIMAC  2409	002315'	003505'	003506'	X(EXOMFR)^EXOMFR,,EXOMFR+1^			
  2410	002316'	003507'	003510'	X(RDXMFR)^RDXMFR,,RDXMFR+1^			
  2411	002317'	003511'	003512'	X(ALLMFR)^ALLMFR,,ALLMFR+1^			
  2412	002320'	003473'	003474'	X(RCATAB)^RCATAB,,RCATAB+1^			
  2413	002321'	003475'	003476'	X(SYSTAB)^SYSTAB,,SYSTAB+1^			
  2414	002322'	003477'	003500'	X(TYPTAB)^TYPTAB,,TYPTAB+1^			
  2415	002323'	003503'	003504'	X(AUNTAB)^AUNTAB,,AUNTAB+1^			
  2416	002324'	003501'	003502'	X(JALTAB)^JALTAB,,JALTAB+1^			
  2417	002325'	003471'	003472'	X(WCATAB)^WCATAB,,WCATAB+1^			
  2418			000010	RSIMAX==.-RSITAB-1
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 47
FRMSER.MAC	 8-DEC-87 16:09		.FORAR=16 Read a handle's access rights

  2419				SUBTTL	.FORAR=16 Read a handle's access rights
  2420				SUBTTL	.FORER=17 Read handle's effective rights
  2421
  2422				;THESE TWO FRMOPS RETURN ACCESS RIGHTS ASSOCIATED WITH
  2423				; THE GIVEN FRAME DESCRIPTOR. READING ACCESS RIGHTS
  2424				; READS THE RIGHTS THAT ARE ASSOCIATED WITH THE HANDLE
  2425				; ITSELF. READING EFFECTIVE RIGHTS RETURNS WHICH RIGHTS
  2426				; THE HANDLE IS CURRENTLY GOOD FOR, WHICH MAY OR MAY
  2427				; NOT BE THE SAME AS THE RIGHTS ASSOCIATED WITH THE HANDLE.
  2428
  2429				; CALLING FORMAT FOR BOTH FRMOPS:
  2430
  2431				;	MOVE	AC,[FUNCTION,,FRAME DESCRIPTOR]
  2432				;	FRMOP	AC,ADDR
  2433				;	  ERROR
  2434				;	SUCCESS
  2435				;ADDR:	COUNT,,ADDR OF BLOCK TO RETURN RIGHTS IN.
  2436				;FORMAT OF BLOCK:
  2437				;
  2438				;0/ BITS+TYPE,,FRAME NUMBER	;SAME AS GIVEN TO CREATE HANDLE FRMOP
  2439				;1/ 36 BIT UID
  2440				;2/ PNO (ONLY VALID IF TYPE IS PROCESS HANDLE)
  2441				;3-N/ ACCESS BITS
  2442
  2443	002326'	634600	000014	FRMRAR:	TDZA	P1,P1		;P1 IS 0 IF JUST RETURNING
  2444								; HANDLE RIGHTS
  2445	002327'	201600	000001	FRMRER:	MOVEI	P1,1		;P1 IS 1 IF RETURNING EFFECTIVE RIGHTS
  2446	002330'	256200	003776'		UMOVE	P2,(M)		;GET COUNT,,ADDRESS IN P2
  2447	002331'	554000	000015		HLRZ	S,P2		;GET COUNT IN S FOR ROUTINES
  2448	002332'	332000	000000		SKIPE	S		;ZERO IS ILLEGAL.
  2449	002333'	303000	000004		CAILE	S,.UAWMX+3	;RIGHTS TABLE SIZE + FNO,UID,PNO
  2450	002334'	254000	003622'		JRST	FEWBCN		;BAD COUNT OTHERWISE
  2451	002335'	210300	000000		MOVN	T1,S		;GET - COUNT IN T1
  2452	002336'	504640	000006		HRL	P2,T1		;PASS -COUNT,,ADDR IN P2 TO ROUTINES
  2453	002337'	474700	000000		SETO	P3,		;NO SPECIAL ACCESS REQUIREMENT
  2454	002340'	260040	003042'		PUSHJ	P,FDRUPX	;GET CONTEXT PAGES LOCKED IN
  2455	002341'	254000	000674'		  JRST	FRVERR		;ERROR CODE IN P3, GO STORE AND RETURN
  2456	002342'	200140	000015		MOVE	PG,P2		;FDRUPX SMASHED PG BEFORE, BUT NOW ITS SAFE.
  2457	002343'	201440	002345'		MOVEI	T4,RXRTAB	;DISPATCH
  2458	002344'	254000	003352'		JRST	FDDSP
  2459
  2460	002345'	254000	002465'	RXRTAB:	JRST	RXRABS		;(0) ABSOLUTE FRAME NUMBER
  2461	002346'	256000	000000'		STOPCD			;(1) FAMILY, NOT SUPPOSED TO GET HERE
  2462	002347'	256000	000000'		STOPCD			;(2) OTHER FRAME, SUPPOSED TO BE CONVERTED
  2463	002350'	254000	002357'		JRST	RXRFRH		;(3) HANDLE
  2464	002351'	254000	003602'		JRST	FEWUND		;(4) UNDEFINED
  2465	002352'	254000	003602'		JRST	FEWUND		;(5) UNDEFINED
  2466	002353'	254000	003602'		JRST	FEWUND		;(6) UNDEFINED
  2467	002354'	254000	002412'		JRST	RXRSLF		;(7) OWN FRAME
  2468	002355'	254000	002446'		JRST	RXRCHL		;(1,0) CHILD
  2469	002356'	254000	002425'		JRST	RXRPAR		;(1,1) PARENT FRAME
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 48
FRMSER.MAC	 8-DEC-87 16:09		.FORER=17 Read handle's effective rights

  2470
  2471				;HERE FOR THE VARIOUS TYPES OF FRAME DESCRIPTOR.
  2472				;PG/ -COUNT,,USER ADDR
  2473				;S/ ORIGINAL COUNT (TO RESTORE LH(PG) FROM)
  2474				;P4/ FD GIVEN IN FRMOP AC
  2475				; COUNT IS GUARANTEED TO BE NON-ZERO.
  2476
  2477				;HERE TO READ RIGHTS FOR A HANDLE
  2478
  2479	002357'	405740	077777	RXRFRH:	ANDI	P4,FDDMSK	;GET HANDLE INDEX, KNOW ITS GOOD
  2480	002360'	200657	000000*		MOVE	P2,%UPT+UPTFHT(P4) ;GET THE ADDRESS
  2481	002361'	200315	000000		MOVE	T1,.FHFNO(P2)	;GET BITS+TYPE,,FRAME NUMBER
  2482	002362'	256200	004017'		UMOVEM	T1,(PG)		;STORE
  2483	002363'	252140	002314*		AOBJP	PG,CPOPJ1	;DONE IF COUNT EXHAUSED
  2484	002364'	200315	000001		MOVE	T1,.FHUID(P2)	;GET UID
  2485	002365'	256200	004017'		UMOVEM	T1,(PG)		;STORE THAT
  2486	002366'	252140	002363*		AOBJP	PG,CPOPJ1	;DONE IF COUNT EXHAUSED
  2487	002367'	200315	000002		MOVE	T1,.FHPNO(P2)	;GET PNO (ONLY MEANING FUL FOR PROCESS HANDLES)
  2488	002370'	256200	004017'		UMOVEM	T1,(PG)
  2489	002371'	252140	002366*		AOBJP	PG,CPOPJ1	;DONE IF COUNT EXHAUSED
  2490								;IF COUNT GONE, LAST AOBJP WENT AWAY.
  2491	002372'	205755	000003		MOVSI	P4,.FHART(P2)	;FAST,,
  2492	002373'	541755	000004		HRRI	P4,.FHART+1(P2)	;SLOW
  2493	002374'	322600	002537'		JUMPE	P1,FRMRMR	;IF JUST READING HANDLE, GO NOW.
  2494	002375'	135340	004020'		LDB	T2,[HTPPTR(.FHTYP(P2))] ;GET HANDLE TYPE
  2495	002376'	306340	000002		CAIN	T2,.FHLIC	;IF LIC HANDLE,
  2496	002377'	324740	002537'		PJRST	FRMRMR		;JUST RETURN THE RIGHTS IN THE HANDLE
  2497	002400'	302340	000000		CAIE	T2,.FHFRM	;SKIP IF FRAME HANDLE
  2498	002401'	254000	002405'		JRST	RXRFR1		;NOT, MUST BE PROCESS
  2499	002402'	205702	002145*		MOVSI	P3,JBTMFR(J)	;NEED TO AND WITH MFR
  2500	002403'	541700	000000*		HRRI	P3,%UPX+UPTMFR	;P3/FAST,,SLOW RIGHTS TO AND WITH
  2501	002404'	324740	002540'		PJRST	FRMRMA		;RETURN RIGHTS AND GIVE SKIP RETURN
  2502
  2503	002405'	302340	000001	RXRFR1:	CAIE	T2,.FHPRC	;PROCESS?
  2504	002406'	254000	003624'		JRST	FEWBHT		;NO, BAD HANDLE TYPE
  2505	002407'	312302	002253*		CAME	T1,JBTPNO(J)	;PNO OF HANDLE MATCHES CURRENT PNO OF FRAME?
  2506	002410'	200740	004021'		MOVE	P4,[NULMFR,,NULMFR+1] ;NO, RETURN NULL RIGHTS
  2507	002411'	324740	002537'		PJRST	FRMRMR		;YES, RETURN ALL RIGHTS THAT APPEAR IN THE HANDLE.
  2508
  2509				;HERE FOR SELF FRAME
  2510
  2511	002412'	505100	000001	RXRSLF:	HRLI	J,.FHPRC	;MAKE IT LOOK LIKE PROCESS HANDLE
  2512	002413'	256200	004022'		UMOVEM	J,(PG)
  2513	002414'	252140	002371*		AOBJP	PG,CPOPJ1
  2514	002415'	200302	001752*		MOVE	T1,JBTUID(J)
  2515	002416'	256200	004017'		UMOVEM	T1,(PG)
  2516	002417'	252140	002414*		AOBJP	PG,CPOPJ1
  2517	002420'	200302	002407*		MOVE	T1,JBTPNO(J)
  2518	002421'	256200	004017'		UMOVEM	T1,(PG)		;PROCESS NUMBER ALWAYS VALID
  2519	002422'	252140	002417*		AOBJP	PG,CPOPJ1
  2520	002423'	200740	004023'		MOVE	P4,[ALLMFR,,ALLMFR+1]
  2521	002424'	324740	002537'		PJRST	FRMRMR		;NO RIGHTS TO AND WITH, JUST RETURN THEM AND SKIP
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 49
FRMSER.MAC	 8-DEC-87 16:09		.FORER=17 Read handle's effective rights

  2522				;HERE FOR PARENT FRAME DESCRIPTOR
  2523
  2524	002425'	505100	000001	RXRPAR:	HRLI	J,.FHPRC	;CHILD TO PARENT IS PROCESS HANDLE
  2525	002426'	256200	004022'		UMOVEM	J,(PG)
  2526	002427'	252140	002422*		AOBJP	PG,CPOPJ1
  2527	002430'	200302	002415*		MOVE	T1,JBTUID(J)	;GET UID OF PARENT
  2528	002431'	256200	004017'		UMOVEM	T1,(PG)
  2529	002432'	252140	002427*		AOBJP	PG,CPOPJ1
  2530	002433'	200100	000000*		MOVE	J,%UPT+UPTJOB	;GET OUR FRAME NUMBER
  2531	002434'	200302	002254*		MOVE	T1,JBTSPN(J)	;GET PROCESS NUMBER OF THIS HANDLE
  2532	002435'	256200	004017'		UMOVEM	T1,(PG)		;GIVE IT TO HIM
  2533	002436'	252140	002432*		AOBJP	PG,CPOPJ1	;GO IF DONE
  2534	002437'	205742	002245*		MOVSI	P4,JBTS2P(J)	;GET OUR RIGHTS OVER PARENT
  2535	002440'	541740	000000*		HRRI	P4,%UPT+UPTS2P	;FAST,,SLOW
  2536	002441'	322600	002537'		JUMPE	P1,FRMRMR	;IF JUST READING HANDLE, GO
  2537	002442'	200100	000000*		MOVE	J,%UPX+UPTJOB	;GET FRAME NUMBER OF PARENT
  2538	002443'	312302	002420*		CAME	T1,JBTPNO(J)	;SEE IF PNO OF HANDLE FROM ABOVE MATCHES
  2539	002444'	200740	004021'		MOVE	P4,[NULMFR,,NULMFR+1] ;NO RIGHTS
  2540	002445'	324740	002537'		PJRST	FRMRMR		;RETURN WHATEVER.
  2541
  2542				;HERE FOR CHILD FRAME DESCRIPTOR
  2543
  2544	002446'	505100	000000	RXRCHL:	HRLI	J,.FHFRM	;THIS IS A FRAME HANDLE
  2545	002447'	256200	004022'		UMOVEM	J,(PG)
  2546	002450'	252140	002436*		AOBJP	PG,CPOPJ1
  2547	002451'	200302	002430*		MOVE	T1,JBTUID(J)	;UID IS CURRENT ONE FOR CHILD
  2548	002452'	256200	004017'		UMOVEM	T1,(PG)
  2549	002453'	252140	002450*		AOBJP	PG,CPOPJ1	;RETURN IF DONE
  2550	002454'	200302	002443*		MOVE	T1,JBTPNO(J)	;MAY AS WELL RETURN PNO FOR CHILD
  2551	002455'	256200	004017'		UMOVEM	T1,(PG)
  2552	002456'	252140	002453*		AOBJP	PG,CPOPJ1	;RETURN IF DONE
  2553	002457'	205742	002230*		MOVSI	P4,JBTP2S(J)	;GET PARENT'S RIGHTS OVER TARGET CHILD
  2554	002460'	541740	000000*		HRRI	P4,%UPX+UPTP2S
  2555	002461'	322600	002537'		JUMPE	P1,FRMRMR	;GO IF JUST READING THE BITS
  2556	002462'	205702	002402*		MOVSI	P3,JBTMFR(J)	;WANTS EFFECTIVE RIGHTS, AND WITH MFR
  2557	002463'	541700	000000*		HRRI	P3,%UPX+UPTMFR
  2558	002464'	324740	002540'		PJRST	FRMRMA		;RETURN THEM.
  2559
  2560				;HERE FOR ABSOLUTE FRAME NUMBER
  2561
  2562	002465'	505100	000002	RXRABS:	HRLI	J,.FHLIC	;THIS LOOKS LIKE A LICENSED HANDLE
  2563	002466'	256200	004022'		UMOVEM	J,(PG)
  2564	002467'	252140	002456*		AOBJP	PG,CPOPJ1
  2565	002470'	400300	000000		SETZ	T1,		;NO UID ASSOCIATED WITH ABS HANDLES
  2566	002471'	256200	004017'		UMOVEM	T1,(PG)
  2567	002472'	252140	002467*		AOBJP	PG,CPOPJ1
  2568	002473'	256200	004017'		UMOVEM	T1,(PG)		;NO PNO EITHER
  2569	002474'	252140	002472*		AOBJP	PG,CPOPJ1
  2570	002475'	260040	003300'		PUSHJ	P,ABSACC	;SET P4 TO FAST,,SLOW
  2571	002476'	200740	004021'		  MOVE	P4,[NULMFR,,NULMFR+1] ;RETURN 0 ACCESS BITS
  2572	002477'	324740	002537'		PJRST	FRMRMR		;RETURN RIGHTS AND SKIP.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 50
FRMSER.MAC	 8-DEC-87 16:09		.FOCAR=30 Read child's child to parent process handle

  2573				SUBTTL	.FOCAR=30 Read child's child to parent process handle
  2574				SUBTTL	.FOCER=31 Read child's C2P with effective rights
  2575
  2576				COMMENT #FRMOPS TO READ A CHILDS CHILD TO PARENT HANDLE
  2577
  2578				CALL:
  2579
  2580					MOVE	AC,[.FOCAR OR .FOCER,,<FD>]
  2581					FRMOP	AC,ADDR
  2582					  <ERROR RETURN>
  2583					<SUCCESS RETURN>
  2584
  2585				ADDR:	COUNT,,ADDR OF BLOCK TO RETURN HANDLE INFO IN
  2586
  2587				FORMAT OF BLOCK:
  2588
  2589				0/ BITS+TYPE,,FRAME NUMBER
  2590				1/ 36 BIT UID
  2591				2/ PNO
  2592				3-N/ ACCESS BITS
  2593
  2594				FORMAT OF BLOCK IS COMPATIBLE WITH .FORAR AND .FORER CALLS.
  2595
  2596				#
  2597
  2598	002500'	634600	000014	FRMCAR:	TDZA	P1,P1		;FLAG TO SAY READ ACCESS/EFFECTIVE
  2599	002501'	201600	000001	FRMCER:	MOVEI	P1,1		;SAY TO DO EFFECTIVE RIGHTS
  2600	002502'	256200	003776'		UMOVE	P2,(M)		;GET COUNT,,ADDR
  2601	002503'	554000	000015		HLRZ	S,P2		;GET COUNT IN S
  2602	002504'	332000	000000		SKIPE	S
  2603	002505'	303000	000004		CAILE	S,.UAWMX+3	;RIGHTS TABLE SIZE + FNO,UID,PNO
  2604	002506'	254000	003622'		JRST	FEWBCN		;BAD COUNT
  2605	002507'	210300	000000		MOVN	T1,S		;GET -COUNT
  2606	002510'	504640	000006		HRL	P2,T1		;PASS [COUNT,,ADDR IN P2
  2607	002511'	474700	000000		SETO	P3,
  2608	002512'	260040	003042'		PUSHJ	P,FDRUPX	;GET LOCKED FOR READING
  2609	002513'	254000	000674'		  JRST	FRVERR		;NO GO
  2610	002514'	260040	003002'		PUSHJ	P,ISCHLD	;CHECK C(J) FOR CHILDNESS
  2611	002515'	254000	003603'		  JRST	FEWNCH		;NOT A CHILD
  2612	002516'	200140	000015		MOVE	PG,P2		;PUT INTO PG
  2613
  2614				;THIS CODE SIMILAR TO THAT AT RXRPAR
  2615
  2616	002517'	200440	000000*		MOVE	T4,%UPT+UPTJOB	;GET PARENT'S (SELF) JOB NUMBER
  2617	002520'	505440	000001		HRLI	T4,.FHPRC	;CHILD TO PARENT HANDLE IS PROCESS HANDLE
  2618	002521'	256200	004024'		UMOVEM	T4,(PG)		;STORE IT
  2619	002522'	252140	002474*		AOBJP	PG,CPOPJ1
  2620	002523'	200311	002451*		MOVE	T1,JBTUID(T4)	;GET PARENT'S UID
  2621	002524'	256200	004017'		UMOVEM	T1,(PG)		;STORE IT
  2622	002525'	252140	002522*		AOBJP	PG,CPOPJ1
  2623	002526'	200302	002434*		MOVE	T1,JBTSPN(J)	;GET PROCESS NUMBER
  2624	002527'	256200	004017'		UMOVEM	T1,(PG)		;STORE IT
  2625	002530'	252140	002525*		AOBJP	PG,CPOPJ1
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 50-2
FRMSER.MAC	 8-DEC-87 16:09		.FOCER=31 Read child's C2P with effective rights

  2626	002531'	205742	002437*		MOVSI	P4,JBTS2P(J)	;GET FAST RIGHTS,,
  2627	002532'	541740	000000*		HRRI	P4,%UPX+UPTS2P	;SLOW RIGHTS IN P4
  2628	002533'	322600	002537'		JUMPE	P1,FRMRMR	;IF NOT DOING EFFECTIVE, JUST GO
  2629	002534'	312311	002454*		CAME	T1,JBTPNO(T4)	;PNO IN HANDLE HAS TO BE SAME AS PARENT'S
  2630	002535'	200740	004021'		MOVE	P4,[NULMFR,,NULMFR+1] ;ELSE NO RIGHTS AT ALL
  2631	002536'	324740	002537'		PJRST	FRMRMR		;AND RETURN THE RIGHTS.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 51
FRMSER.MAC	 8-DEC-87 16:09		.FOCER=31 Read child's C2P with effective rights

  2632				COMMENT ;@@SUBROUTINE FRMRMR/FRMRMA
  2633				@@PURPOSE RETURN USER ACCESS BIT MAP FROM MONITOR ACCESS BIT MAP
  2634				@@ENTRY	PG/-COUNT(CHECKED),,USER ADDRESS
  2635					P3/ FAST,,SLOW RIGHTS TO AND WITH IF ENTER AND FRMRMA
  2636					P4/ FAST,,SLOW RIGHTS TO RETURN
  2637				@@ACCUM U,F,M,P1-P2. PRESERVES W. STORES ERROR CODE THRU W IF COUNT TOO LARGE.
  2638				@@EXIT BIT MAP STORED INTO USER SPACE IF SKIP.
  2639					NON-SKIP IF COUNT WAS BAD.
  2640				@@;
  2641
  2642	002537'	400700	000000	FRMRMR:	SETZ	P3,		;DON'T AND WITH ANYTHING IF ENTER HERE
  2643	002540'	574000	000003	FRMRMA:	HLRE	S,PG		;GET -SIZE IN S.
  2644	002541'	217000	000000		MOVMS	S		;GET +SIZE
  2645	002542'	271003	777777		ADDI	S,-1(PG)	;GET LAST WORD HE WANTS STORED.
  2646	002543'	201240	003515'		MOVEI	U,M2UACT	;CONVERTING MONITOR BIT MAP TO USER BIT MAP.
  2647	002544'	265200	003377'		JSP	F,ACRPTR	;START GETTING POINTERS
  2648	002545'	254000	002530*		  JRST	CPOPJ1		;OK RETURN.
  2649	002546'	322700	002564'		JUMPE	P3,FRMRM2	;IF NO ANDING, SKIP THIS NEXT STUFF
  2650	002547'	200340	000010		MOVE	T2,T3		;COPY SOURCE POINTER
  2651	002550'	606340	777777		TRNN	T2,-1		;IF WORD ZERO,
  2652					JRST	[HLR T2,P3	;GET FAST ANDING RIGHTS ADDRESS IN RH OF T2
  2653						 HLR T3,P4	;AND DO IT FOR MAIN SOURCE POINTER
  2654	002551'	254000	004025'			 JRST FRMRM1]
  2655	002552'	271356	777777		ADDI	T2,-1(P3)	;GET SLOW RIGHTS IN T2
  2656	002553'	271417	777777		ADDI	T3,-1(P4)	;FOR SOURCE AND AND SLOW RIGHTS
  2657	002554'	271443	000000	FRMRM1:	ADDI	T4,(PG)		;GET COUNT
  2658	002555'	305011	000000		CAIGE	S,(T4)		;MAKE SURE STILL IN RANGE
  2659	002556'	254013	000000		JRST	(M)		;NOT, GO FOR MORE DATA
  2660	002557'	135340	000007		LDB	T2,T2		;GET DATA TO AND WITH
  2661	002560'	135300	000010		LDB	T1,T3		;GET SOURCE DATA BYTE
  2662	002561'	404300	000007		AND	T1,T2		;DO THE ANDING
  2663	002562'	256040	004030'		XCTBU	<DPB T1,T4>	;AND STORE IT FOR USER
  2664	002563'	254013	000000		JRST	(M)		;GO FOR NEXT.
  2665
  2666	002564'	606400	777777	FRMRM2:	TRNN	T3,-1		;SOURCE WORD ZERO?
  2667					JRST	[HLR T3,P4	;NO, GET FAST ADDRESS IN SOURCE POINTER
  2668	002565'	254000	004031'			 JRST .+2]	;AND SKIP NEXT INSTRUCTION
  2669	002566'	271417	777777		ADDI	T3,-1(P4)	;ADD IN SLOW RIGHTS ADDRESS
  2670	002567'	271443	000000		ADDI	T4,(PG)		;TURN REL USER ADDR INTO ABS ONE.
  2671	002570'	135300	000010		LDB	T1,T3		;GET BYTE FROM TABLE
  2672	002571'	301011	000000		CAIL	S,(T4)		;STORE IF ADDRESS IN POINTER IS IN RANGE.
  2673	002572'	256040	004030'		XCTBU	<DPB T1,T4>	;PUT IN USER'S AREA
  2674	002573'	254013	000000		JRST	(M)		;GO FOR MORE. NOTE - HAVE TO
  2675								; GO TILL ACRPTR DONE, USER PTRS DO NOT NECESSARILY
  2676								; COME MONITONICALLY INCREASING.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 52
FRMSER.MAC	 8-DEC-87 16:09		COPY BITS FROM USER TO HANDLE

  2677				SUBTTL COPY BITS FROM USER TO HANDLE
  2678
  2679				COMMENT ;@@SUBROUTINE SETHDL
  2680				@@PURPOSE FILL RIGHTS OF A HANDLE ACCORDING TO USER ARG
  2681				@@ENTRY	PG/COUNT,,USER ADDR OF USER RIGHTS BITS
  2682					P3/HANDLE ADDRESS
  2683					P4/ FAST,,SLOW MAXIMUM ALLOWED RIGHTS, OR 0 IF ALL IS MAX.
  2684					W/ LIMMAX SETTING,,?
  2685				@@ACCUM T1-T4,F,M,U,P2,S,1B0 OF W
  2686				@@EXIT	NON-SKIP IF COUNT ERROR OR ATTEMPT TO SET RIGHTS HIGHER THAN MAX.
  2687					  P3/ERROR CODE
  2688					  P2/FRAME HANDLE ADDRESS
  2689					  W/RETURNED NEGATIVE IFF USER ARG EXCEEDED MAX.
  2690					  IF LIMMAX WAS 0, RIGHTS ARE USER SPECIFIED ONES.
  2691					  IF LIMMAX WAS 1, RIGHTS ARE USER .AND. MAX
  2692					SKIP IF USER ARG LESS THAN MAX AND COUNT OK, RIGHTS COPIED TO DEST.
  2693				@@;
  2694	002574'	261040	000016	SETHDL:	PUSH	P,P3		;SAVE HANDLE ADDRESS
  2695	002575'	505716	000003		HRLI	P3,.FHART(P3)	;GET FAST RIGHTS ADDRESS IN LH P3
  2696	002576'	541716	000004		HRRI	P3,.FHART+1(P3)	;SLOW RIGHTS ADDRESS IN RH(P3)
  2697	002577'	260040	002604'		PUSHJ	P,SETARN	;SET RIGHTS IN MONITOR FROM USER SPEC
  2698					  JRST	[POP P,P2	;GET FH ADDRESS IN P2 FOR THOSE WHO CARE
  2699	002600'	254000	004033'			 POPJ P,]	;AND GIVE ERROR RETURN.
  2700	002601'	350001	777777		AOS	-1(P)
  2701	002602'	262040	000016		POP	P,P3
  2702	002603'	263040	000000		POPJ	P,
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 53
FRMSER.MAC	 8-DEC-87 16:09		COPY BITS FROM USER TO HANDLE

  2703				COMMENT ;@@SUBROUTINE SETARN
  2704				@@PURPOSE SET RIGHTS IN MONITOR SOMEWHERE ACCORDING TO USER ARGUMENT
  2705				@@ENTRY	PG/COUNT,,USER ADDR OF USER RIGHTS BITS
  2706					P3/FAST RIGHTS ADDRESS,,SLOW RIGHTS ADDRESS
  2707					P4/ FAST,,SLOW MAXIMUM ALLOWED RIGHTS, OR 0 IF ALL IS MAX.
  2708					W/LIMMAX SETTING,,USER AC NUMBER TO STORE ERROR CODE INTO
  2709				@@ACCUM T1-T4,F,M,U,P2,S,1B0 OF W
  2710				@@EXIT NON-SKIP IF RIGHTS EXCEED MAX, WITH RIGHTS SET TO USER SPEC
  2711					IF LIMMAX WAS 0, TO USER SPEC .AND. MAX IF LIMMAX WAS 1,
  2712					AND W NEGATIVE IFF MAX RIGHTS WERE EXCEEDED BY USER SPEC.
  2713				       SKIP OTHERWISE WITH RIGHTS COPIED INTO DESTINATION
  2714					 WITH W NEGATIVE IFF MAX RIGHTS ARE EXCEEDED BY USER SPEC.
  2715				@@;
  2716
  2717
  2718				EXTERNAL SAVE1
  2719
  2720			200000	XP LIMMAX,(1B1)		;IF ON, LIMIT DESTINATION TO MAX RIGHTS ARG.
  2721
  2722	002604'	621500	400000	SETARN:	TLZ	W,(1B0)		;CLEAR MAX EXCEEDED RETURN ARG.
  2723	002605'	265440	002256*		JSP	T4,SAVE1	;SAVE P1 FOR CALLER.
  2724	002606'	607140	777777		TLNN	PG,-1		;IF COUNT IS ZERO,
  2725	002607'	254000	002643'		JRST	SETMAX		;THEN SET THE MAX RIGHTS HE IS ALLOWED.
  2726	002610'	554000	000003		HLRZ	S,PG		;GET USER'S COUNT
  2727	002611'	303000	000001		CAILE	S,.UAWMX	;IN RANGE?
  2728	002612'	254000	003561'		JRST	FEBCN		;NO, BAD COUNT
  2729	002613'	271003	777777		ADDI	S,-1(PG)	;GET LAST WORD WE'RE ALLOWED TO STORE INTO
  2730	002614'	201240	003525'		MOVEI	U,U2MACT	;CONVERT USER BITS TO MONITOR ONES
  2731	002615'	265200	003377'		JSP	F,ACRPTR	;GET THINGS STARTED
  2732					  JRST	[JUMPL W,FENRT	;IF MAX VIOLATION, GIVE ERROR.
  2733	002616'	254000	004035'			 JRST CPOPJ1]
  2734	002617'	271403	000000		ADDI	T3,(PG)		;GET BYTE POINTER TO USER'S ARG BLOCK
  2735	002620'	305010	000000		CAIGE	S,(T3)		;STILL WITHIN SPECIFIED SPACE?
  2736					JRST	[SETZ T1,	;NO, ASSUME RIGHTS ARE OFF
  2737	002621'	254000	004037'			 JRST SETAR1]
  2738					JUMPE	P4,[XCTFU <LDB T1,T3> ;ALL RIGHTS ALLOWED - JUST GET SOURCE BYTE
  2739	002622'	322740	004041'			   JRST SETAR1]
  2740	002623'	200340	000011		MOVE	T2,T4		;GET COPY OF DEST POINTER
  2741	002624'	606340	777777		TRNN	T2,-1		;IF ZEROTH WORD,
  2742					JRST	[HLR T2,P4	;PUT ADDRESS OF FAST RIGHTS IN RH OF POINTER
  2743	002625'	254000	004043'			 JRST .+2]
  2744	002626'	271357	777777		ADDI	T2,-1(P4)		;ELSE ADD SLOW RIGHTS ADDRESS IN
  2745	002627'	256040	004014'		XCTFU	<LDB T1,T3>	;GET A BYTE
  2746	002630'	135340	000007		LDB	T2,T2		;GET MAX BYTE
  2747	002631'	410340	000006		ANDCA	T2,T1		;T2 GETS A 1 FOR EVERY FORBIDDEN BIT
  2748								; USER IS TRYING TO SET
  2749	002632'	322340	002636'		JUMPE	T2,SETAR1	;JUMP IF MAX NOT EXCEEDED.
  2750	002633'	661500	400000		TLO	W,(1B0)		;THEY ARE, SET W TO BE NEGATIVE.
  2751	002634'	603500	200000		TLNE	W,LIMMAX	;IF LIMMAX IS ONE,
  2752	002635'	412340	000006		ANDCAM	T2,T1		;THEN TURN OFF BITS HE'S NOT ALLOWED TO HAVE.
  2753	002636'	606440	777777	SETAR1:	TRNN	T4,-1		;IF ZERO WORD,
  2754					JRST	[HLR T4,P3	;FILL IN FAST RIGHTS ADDRESS
  2755	002637'	254000	004045'			 JRST .+2]	;AND SKIP
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 53-2
FRMSER.MAC	 8-DEC-87 16:09		COPY BITS FROM USER TO HANDLE

  2756	002640'	271456	777777		ADDI	T4,-1(P3)	;FILL IN SLOW RIGHTS ADDRESS
  2757	002641'	137300	000011		DPB	T1,T4		;STORE THEM
  2758	002642'	254013	000000		JRST	(M)		;GO FOR MORE.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 54
FRMSER.MAC	 8-DEC-87 16:09		COPY BITS FROM USER TO HANDLE

  2759				;HERE IF USER SPECIFIED ZERO COUNT - GIVE HIM THE MAX RIGHTS HE
  2760				; CAN HAVE.
  2761
  2762	002643'	336300	000017	SETMAX:	SKIPN	T1,P4		;IF P4 IS ZERO,
  2763	002644'	200300	004023'		MOVE	T1,[ALLMFR,,ALLMFR+1] ;THEN SKY IS THE LIMIT
  2764	002645'	554340	000006		HLRZ	T2,T1		;GET FAST RIGHTS ADDRESS
  2765	002646'	200347	000000		MOVE	T2,(T2)		;GET FAST RIGHTS DATA
  2766	002647'	554400	000016		HLRZ	T3,P3		;GET DESTINAION ADDRESS
  2767	002650'	202350	000000		MOVEM	T2,(T3)		;STORE IT.
  2768	002651'	205346	000000		MOVSI	T2,(T1)		;GET SOURCE,,0
  2769	002652'	540340	000016		HRR	T2,P3		;GET SOURCE,,DEST
  2770	002653'	251356	000000		BLT	T2,.ARSIZ-1(P3)	;COPY REST OF BITS INTO DESTINATION
  2771	002654'	254000	002545*		JRST	CPOPJ1
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 55
FRMSER.MAC	 8-DEC-87 16:09		.FOGFT=24 Graft a frame

  2772				SUBTTL	.FOGFT=24 Graft a frame
  2773
  2774				COMMENT #FRMOP FUNCTION TO GRAFT FRAMES AROUND.
  2775
  2776				CALL:
  2777
  2778					MOVE	AC,[.FOGFT,,FD OF CHILD TO REMOVE]
  2779					FRMOP	AC,[FD OF PARENT TO ADD CHILD TO OR 0 TO MAKE CHILD AN ORPHAN]
  2780					  <ERROR RETURN>
  2781					<SKIP RETURN>
  2782
  2783				THE CHILD TO PARENT PROCESS HANDLE IS INVALIDATED BY THIS OPERATION,
  2784				IN ORDER TO ALLOW FRAMES TO LET OTHER FRAMES GRAFT CHILDREN ONTO THEM
  2785				WITHOUT RUNNING THE RISK OF THE CHILD HAVING TOO MUCH ACCESS TO ITS
  2786				NEW PARENT.
  2787				THE PARENT TO CHILD FRAME HANDLE HAS THE SAME RIGHTS SET AS THE
  2788				LAST PARENT TO CHILD HANDLE TO THAT FRAME HAD. THE CHILD'S MFR
  2789				IS ALSO UNCHANGED BY THIS OPERATION. THIS ENSURES THAT A PARENT THAT
  2790				IS GIVEN A CHILD WITH ONLY CERTAIN RIGHTS OVER IT CANNOT INCREASE THOSE
  2791				RIGHTS WITHOUT ZAPPING THE FRAME.
  2792				#
  2793
  2794	002655'	256200	003675'	FRMGFT:	UHRRZ	U,(M)		;GET DEST FD IF ANY IN U
  2795	002656'	200640	000017		MOVE	P2,P4		;SAVE, HAVE TO DO MULTIPLE CHECKS
  2796	002657'	322240	002704'		JUMPE	U,FRMGNP	;GO IF NO NEW PARENT TO CHECK FOR
  2797	002660'	200740	000005		MOVE	P4,U		;GET NEW PARENT'S FD
  2798	002661'	201700	000013		MOVEI	P3,.ARGVC	;CHECK TO SEE IF CAN GIVE A CHILD
  2799	002662'	260040	003063'		PUSHJ	P,FARCHK	;CAN HE?
  2800	002663'	254000	000674'		  JRST	FRVERR		;NO
  2801	002664'	200302	001437*		MOVE	T1,JBTSTS(J)	;MAKE SURE IT EXISTS
  2802	002665'	607300	040000		TLNN	T1,JNA		;IF NOT,
  2803	002666'	254000	003600'		 JRST	FEWBDF		;BAD FRAME NUMBER
  2804	002667'	200240	000002		MOVE	U,J		;SAVE NEW PARENT'S FRAME NUMBER IN U
  2805	002670'	200740	000015		MOVE	P4,P2		;GET FD FOR CHILD
  2806	002671'	201700	000012		MOVEI	P3,.ARGVP	;CAN WE GIVE NEW PARENT TO CHILD?
  2807	002672'	260040	003063'		PUSHJ	P,FARCHK	;IF NOT
  2808	002673'	254000	000674'		  JRST	FRVERR		;DIE.
  2809	002674'	200302	002664*		MOVE	T1,JBTSTS(J)	;GET BITS TO SEE IF IT EXISTS
  2810	002675'	607300	040000		TLNN	T1,JNA
  2811	002676'	254000	003600'		 JRST	FEWBDF		;DOES NOT.
  2812	002677'	550300	000005		HRRZ	T1,U		;SCAN SUBTREE TO MAKE SURE NOT GRAFTING ONTO
  2813								; ANYONE IN CHILD'S SUBTREE
  2814	002700'	306302	000000	FRMGF1:	CAIN	T1,(J)		;HAVE WE REACHED CHILD YET?
  2815	002701'	254000	003627'		 JRST	FEWCII		;YES, CAN'T ALLOW GRAPHS
  2816	002702'	135300	003645'		LDB	T1,PRNTBP(T1)	;GET PARENT NEXT UP
  2817	002703'	326300	002700'		JUMPN	T1,FRMGF1	;AND KEEP GOING
  2818
  2819				;HERE WITH NEW PARENT FRAME NUMBER OR 0 IN U, CHILD DESCRIPTOR IN P2
  2820
  2821	002704'	200740	000015	FRMGNP:	MOVE	P4,P2		;GET FD FOR CHILD IN P4
  2822	002705'	260040	003102'		PUSHJ	P,FD2FNO	;CONVERT TO FRAME NUMBER, IN J
  2823	002706'	254000	000674'		  JRST	FRVERR		;SOMETHING IS BAD
  2824	002707'	200302	002674*		MOVE	T1,JBTSTS(J)	;MAKE SURE IT EXISTS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 55-2
FRMSER.MAC	 8-DEC-87 16:09		.FOGFT=24 Graft a frame

  2825	002710'	607300	040000		TLNN	T1,JNA		;DOES IT?
  2826	002711'	254000	003600'		 JRST	FEWBDF		;NO, BAD FRAME NUMBER
  2827	002712'	135300	004047'		LDB	T1,PRNTBP(J)	;HAS PARENT?
  2828	002713'	322300	002720'		JUMPE	T1,FRMNPR	;NO, DON'T HAVE TO CHECK TO SEE IF CAN TAKE PARENT AWAY
  2829	002714'	201700	000011		MOVEI	P3,.ARTKP	;HAS ONE, CAN WE TAKE IT?
  2830	002715'	260040	003153'		PUSHJ	P,CHEKAR	;SEE
  2831	002716'	254000	000674'		  JRST	FRVERR		;NO, RETURN ERROR CODE
  2832	002717'	260040	002732'		PUSHJ	P,TKCHLD	;TAKE CHILD'S PARENT AWAY.
  2833	002720'	402002	002526*	FRMNPR:	SETZM	JBTSPN(J)	;INVALIDATE CHILD'S PROCESS HANDLE
  2834	002721'	332300	000005		SKIPE	T1,U		;GET NEW PARENT'S FRAME NUMBER
  2835	002722'	260040	002724'		 PUSHJ	P,ADCHLD	;ADD TO HIS TREE
  2836	002723'	254000	002654*		JRST	CPOPJ1		;AND RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 56
FRMSER.MAC	 8-DEC-87 16:09		FRAME TREE HANDLERS

  2837				SUBTTL FRAME TREE HANDLERS
  2838
  2839				COMMENT ;@@SUBROUTINE ADCHLD
  2840				@@PURPOSE ADDS A CHILD FOR A SPECIFIED PARENT FRAME
  2841				@@ENTRY	T1/PARENT FRAME NUMBER
  2842					J/NEW CHILD FRAME NUMBER
  2843				@@ACCUM T1-T4
  2844				@@EXIT J IS PRESERVED, ALWAYS NON-SKIP
  2845				@@;
  2846
  2847	002724'	402002	000633*	ADCHLD:	SETZM	JBTPNT##(J)	;Clear child to parent int channels
  2848	002725'	135340	004050'		LDB	T2,CHLDBP(T1)	;GET PARENT'S LEFTMOST CHILD IF ANY
  2849	002726'	137340	004051'		DPB	T2,NEIGBP(J)	;THIS IS OUR NEW NEIGHBOR
  2850	002727'	137100	004050'		DPB	J,CHLDBP(T1)	;WE ARE NOW LEFTMOST CHILD
  2851	002730'	137300	004047'		DPB	T1,PRNTBP(J)	;POINT US AT OUR PARENT
  2852	002731'	263040	000000		POPJ	P,		;RETURN.
  2853
  2854
  2855				COMMENT ;@@SUBROUTINE TKCHLD
  2856				@@PURPOSE REMOVES A CHILD FROM ITS PARENT
  2857				@@ENTRY	J/ CHILD NUMBER
  2858				@@ACCUM T1-T4
  2859				@@EXIT J PRESERVED, ALWAYS NON-SKIP
  2860				  CALLER RESPONSIBLE FOR ACCESS CHECKING
  2861				  AND MAKING SURE FRAME HAS A PARENT
  2862				@@;
  2863
  2864	002732'	135300	000121'	TKCHLD::LDB	T1,JBYLCF	;Does parent want to know "lost child frame"?
  2865	002733'	336000	000006		SKIPN	T1		;If channel is not set,
  2866	002734'	135300	000122'		 LDB	T1,JBYECF	; try the Exit in Child Frame channel (JBTPNT)
  2867	002735'	261040	000002		PUSH	P,J		;Save J of frame being taken
  2868	002736'	135100	004047'		LDB	J,PRNTBP(J)	;Get this guy's parent, if any
  2869	002737'	332000	000002		SKIPE	J		;Nothing do do if no parent
  2870	002740'	336000	000006		SKIPN	T1		; or if no interrupt channel assigned
  2871	002741'	334000	000000		 SKIPA
  2872	002742'	260040	000203*		  PUSHJ	P,TAKTRP##	;Tell parent she has lost her child
  2873	002743'	262040	000002		POP	P,J
  2874	002744'	402002	002724*		SETZM	JBTPNT##(J)	;Clear child to parent int channels
  2875	002745'	135300	004047'		LDB	T1,PRNTBP(J)	;GET PARENT FRAME NUMBER
  2876	002746'	322300	000614*		JUMPE	T1,CPOPJ	;IF NO PARENT, CAN'T DO IT.
  2877	002747'	135340	004050'		LDB	T2,CHLDBP(T1)	;GET FIRST CHILD
  2878	002750'	316340	000002		CAMN	T2,J		;FIRST ONE IS US?
  2879	002751'	254000	002761'		 JRST	TKCHL2		;YES, NO PREVIOUS FRAME TO UNLINK
  2880	002752'	200400	000007	TKCHL1:	MOVE	T3,T2		;REMBMER PREVIOUS FRAME
  2881	002753'	135340	004052'		LDB	T2,NEIGBP(T2)	;GET NEXT ONE
  2882	002754'	312340	000002		CAME	T2,J		;FOUND OURSELVES?
  2883					 JRST	TKCHL1		;NO, KEEP LOOKING, WE SHOULD BE THERE IF DATA BASE IS NOT SCREW
  2884	002755'	254000	002752'	ED UP
  2885
  2886				;FRAME THAT POINTS TO US IS IN T3.
  2887
  2888	002756'	135340	004052'		LDB	T2,NEIGBP(T2)	;GET OUR NEXTDOOR NEIGHBOR
  2889	002757'	137340	004053'		DPB	T2,NEIGBP(T3)	;LAST POINTS TO NEXT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 56-2
FRMSER.MAC	 8-DEC-87 16:09		FRAME TREE HANDLERS

  2890	002760'	254000	002763'		JRST	TKCHL3		;AND GO FINISH UP.
  2891
  2892				;HERE IF WE ARE FIRST CHILD FRAME OF PARENT IN C(T1).
  2893
  2894	002761'	135340	004051'	TKCHL2:	LDB	T2,NEIGBP(J)	;GET NEXT FRAME IF ANY
  2895	002762'	137340	004050'		DPB	T2,CHLDBP(T1)	;PARENT POINTS TO NEXT FRAME
  2896
  2897	002763'	400340	000000	TKCHL3:	SETZ	T2,		;NOW CLEAR OUT
  2898	002764'	137340	004051'		DPB	T2,NEIGBP(J)	;NEIGBOR FRAME NUMBER
  2899	002765'	137340	004047'		DPB	T2,PRNTBP(J)	; AND PARENT NUMBER
  2900	002766'	263040	000000		POPJ	P,		;AND RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 57
FRMSER.MAC	 8-DEC-87 16:09		FRAME TREE HANDLERS

  2901				COMMENT ;@@SUBROUTINE NOPRNT
  2902				@@PURPOSE CAUSE ALL CHILDREN OF A CERTAIN PARENT FRAME TO BECOME
  2903				ORPHANED (NO PARENTS, NO NEIGHBORS)
  2904				CALLED BY JOBKL
  2905				@@ENTRY J/PARENT FRAME NUMBER
  2906				@@ACCUM T1-T4
  2907				@@EXIT ALWAYS NON-SKIP, J PRESERVED
  2908				@@;
  2909
  2910				EXTERNAL CPOPJ
  2911
  2912	002767'	135340	004054'	NOPRNT::LDB	T2,CHLDBP(J)	;GET LEFTMOST CHILD
  2913	002770'	322340	002746*		JUMPE	T2,CPOPJ	;IF NO CHILDREN, DONE.
  2914	002771'	400400	000000		SETZ	T3,		;USE THIS REG FOR ZEROING
  2915	002772'	137400	004054'		DPB	T3,CHLDBP(J)	;NO MORE CHILDREN
  2916	002773'	137400	004055'	NOPRN1:	DPB	T3,PRNTBP(T2)	;THIS CHILD HAS NO MORE PARENT
  2917	002774'	402007	002744*		SETZM	JBTPNT##(T2)	;Clear child to parent int channels
  2918	002775'	135300	004052'		LDB	T1,NEIGBP(T2)	;GET ITS NEXT BROTHER, IF ANY.
  2919	002776'	322300	002770*		JUMPE	T1,CPOPJ	;IF NO BROTHER, DONE.
  2920	002777'	137400	004052'		DPB	T3,NEIGBP(T2)	;THIS FRAME IS NOT THAT FRAME'S BROTHER ANYMORE
  2921	003000'	200340	000006		MOVE	T2,T1		;ITS FORMER BROTHER IS NEW FRAME TO WORK ON
  2922	003001'	254000	002773'		JRST	NOPRN1		;GO ORPHAN NEXT FRAME.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 58
FRMSER.MAC	 8-DEC-87 16:09		FRAME TREE HANDLERS

  2923				COMMENT ;@@SUBROUTINE ISCHLD
  2924				@@PURPOSE USED TO CHECK IF C(J) IS A CHILD OF CURRENTLY RUNNING
  2925				FRAME.
  2926				@@ENTRY C(J)/ ALLEGED CHILD
  2927					%UPT/ CURRENT FRAME'S CONTEXT PAGES
  2928				@ACCUM PRESERVES ALL ACS
  2929				@@EXIT NON-SKIP IF C(J) FRAME IS NOT A CHILD OF CURRENT FRAME,
  2930					SKIP IF C(J) IS A CHILD.
  2931				@@;
  2932				EXTERNAL IPOPJ1,IPOPJ
  2933
  2934	003002'	261040	000002	ISCHLD:	PUSH	P,J		;SAVE WHAT WE WANT
  2935	003003'	200100	000000*		MOVE	J,%UPT+UPTJOB	;GET OUR FRAME NUMBER
  2936	003004'	135100	004054'	ISCHL0:	LDB	J,CHLDBP(J)	;GET FIRST CHILD IF ANY
  2937	003005'	322100	000000*		JUMPE	J,IPOPJ		;NO CHILDREN AT ALL GIVE ERROR.
  2938	003006'	316101	000000	ISCHL1:	CAMN	J,(P)		;WHAT WE'RE LOOKING FOR?
  2939	003007'	254000	000000*		 JRST	IPOPJ1		;YES, GIVE SUCCESS RETURN
  2940	003010'	135100	004051'		LDB	J,NEIGBP(J)	;NO, GET NEXT
  2941	003011'	326100	003006'		JUMPN	J,ISCHL1	;AND LOOP
  2942	003012'	262040	000002		POP	P,J		;NOT FOUND, GIVE ERROR RETURN
  2943	003013'	263040	000000		POPJ	P,
  2944
  2945				COMMENT ;@@SUBROUTINE ISSIBL
  2946				@@PURPOSE USED TO CHECK IF C(J) IS A SIBLING OF CURRENTLY RUNNING FRAME.
  2947				@@ENTRY C(J)/ ALLEGED SIBLING
  2948					%UPT/ CURRENT FRAME'S CONTEXT PAGES
  2949				@ACCUM PRESERVES ALL ACS
  2950				@@EXIT NON-SKIP IF C(J) FRAME IS NOT A CHILD OF CURRENT FRAME'S PARENT
  2951					SKIP IF C(J) IS A SIBLING.
  2952				@@;
  2953
  2954	003014'	261040	000002	ISSIBL:	PUSH	P,J		;Save J on stack for compare
  2955	003015'	200100	000000*		MOVE	J,%UPT+UPTJOB	;Get our frame number
  2956	003016'	135100	004047'		LDB	J,PRNTBP(J)	;Get our parent if any
  2957	003017'	322100	003005*		JUMPE	J,IPOPJ		;No parent - therefore no siblings
  2958	003020'	254000	003004'		JRST	ISCHL0		;Jump into ISCHLD loop
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 59
FRMSER.MAC	 8-DEC-87 16:09		ROUTINES TO GET CONTEXT PAGES AND CHECK ACCESS

  2959				SUBTTL ROUTINES TO GET CONTEXT PAGES AND CHECK ACCESS
  2960				COMMENT ;@@SUBROUTINE SRDUPX/SWRUPX
  2961				@@PURPOSE WRITE LOCK DESIRED CONTEXT PAGES IN %UPX AND CALL THE CALLER
  2962				SO DON'T HAVE TO WORRY ABOUT GIVING THE LOCK BACK ON ERRORS AND THINGS
  2963				@@ENTRY T1 CONTAINS VUUO POINTER - PAGE IN RH(T1) AND OTFFLG IN LH(T1)
  2964					P3 CONTAINS ACCESS RIGHTS CODE FOR INTENDED OPERATIONI OR -1 FOR NO CHECK
  2965					%UPT+UPTOFD CONTAINS FRAME DESCRIPTOR TO USE IF OTHER FRAME ENABLED.
  2966				@@ACCUM T3-T4,P3,P4,PG,J (CALLS WLKUPX)
  2967				  (SAVES T1 AND T2 BECAUSE UUO ARGS ARE IN THEM.)
  2968				@@EXIT NON-SKIP WITH ERROR CODE IN P3 IF CAN'T GET CONTEXT PAGES
  2969					LOCKED OR GET FRAME DESCRIPTOR FAILURE.
  2970				SKIP IF CAN WITH J/FRAME NUMBER P4/FD %UPX/ C(J)'S CONTEXT PAGES
  2971				@@;
  2972
  2973			200000	XP OTFFLG,(1B1)
  2974
  2975	003021'			SRDUPX::
  2976	003021'	603300	200000	SWRUPX::TLNE	T1,OTFFLG
  2977	003022'	336740	000000*		SKIPN	P4,%UPT+UPTOFD	;WANTS OTHER - GET IT IF NON-ZERO
  2978	003023'	201740	700000		 MOVEI	P4,.FDSLF	;NONE SET, USE SELF.
  2979	003024'	261040	000006		PUSH	P,T1		;SVE T1 AND T2
  2980	003025'	261040	000007		PUSH	P,T2
  2981	003026'	260040	003053'		PUSHJ	P,FD2WLK	;SETUP J, CHECK RIGHTS, GET %UPX LOCKED.
  2982					  JRST	[POP P,T2	;SUB ERROR CODE IS IN P3.
  2983						 POP P,T1	;RESTORE AND RETURN.
  2984	003027'	254000	004056'			 POPJ P,]
  2985	003030'	262040	000007		POP	P,T2
  2986	003031'	262040	000006		POP	P,T1
  2987	003032'	262040	000011		POP	P,T4		;GET CALLER'S PC
  2988	003033'	260051	000001		PUSHJ	P,1(T4)		;CALL AT ADDR+2 (SKIP OVER ERROR RETURN)
  2989	003034'	334000	000000		  SKIPA
  2990	003035'	350001	000000		AOS	(P)		;GIVE CALLER'S CALLER SKIP RETURN
  2991	003036'	261040	000006		PUSH	P,T1		;SAVE ERROR CODE
  2992	003037'	260040	001303*		PUSHJ	P,ULDUPX	;RELEASE LOCKDOWN
  2993	003040'	262040	000006		POP	P,T1
  2994	003041'	263040	000000		POPJ	P,
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 60
FRMSER.MAC	 8-DEC-87 16:09		ROUTINES TO GET CONTEXT PAGES AND CHECK ACCESS

  2995				COMMENT ;@@SUBROUTINE FDWUPX/FDRUPX
  2996				@@PURPOSE SAME AS SWRUPX, SRDUPX EXCEPT TAKES FRAME DESCRIPTOR IN P4.
  2997				@@ENTRY P4 CONTAINS FRAME DESCRIPTOR
  2998					P3 CONTAINS REQUIRED ACCESS RIGHT CODE OR -1 FOR NO CHECK
  2999				@@ACCUM T1-T4, P3, PG, J (CALLS WLKUPX)
  3000				@@EXIT NON-SKIP IF CAN'T GET CONTEXT PAGES LOCKED, J DESTROYED,
  3001					ERROR CODE IN P3.
  3002					SKIP IF OK, J HAS APPROPRIATE FRAME NUMBER, %UPX
  3003					HAS THAT FRAME'S CONTEXT PAGES LOCKED.
  3004				@@;
  3005
  3006	003042'			FDWUPX::
  3007	003042'	261040	000017	FDRUPX::PUSH	P,P4		;SAVE AS A COURTESY TO CALLER
  3008	003043'	260040	003053'		PUSHJ	P,FD2WLK
  3009					  JRST	[POP P,P4	;GET P4 BACK
  3010	003044'	254000	004061'			 POPJ P,]
  3011	003045'	262040	000017		POP	P,P4		;RESTORE
  3012	003046'	262040	000011		POP	P,T4
  3013	003047'	260051	000001		PUSHJ	P,1(T4)		;CALL THE CALLER, SKIP OVER ERROR RETURN.
  3014	003050'	254000	003037*		  JRST	ULDUPX		;GIVE ERROR RETURN, UNLOCK UPX.
  3015	003051'	350001	000000		AOS	(P)		;CALLER GIVING HIS CALLER SKIP RETURN.
  3016	003052'	254000	003050*		JRST	ULDUPX		;UNLOCK UPX AND RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 61
FRMSER.MAC	 8-DEC-87 16:09		ROUTINES TO GET CONTEXT PAGES AND CHECK ACCESS

  3017				COMMENT ;@@SUBROUTINE FD2WLK
  3018				@@PURPOSE TAKE A FRAME DESCRIPTOR AND GET THE ABSOLUTE
  3019				FRAME NUMBER IN J, WRITE LOCK C(J)'S CONTEXT PAGES IN %UPX.
  3020				@@ENTRY	ENTER AT FD2WL1 IF FD2FNO ALREADY CALLED.
  3021					P3/ACCESS RIGHTS CODE FOR ATTEMPTED FUNCTION OR -1 FOR NO RIGHTS CHECK
  3022					P4/FRAME DESCRIPTOR
  3023				@@ACCUM T1-T4, P3,P4, PG
  3024				@@EXIT	NON-SKIP, P3 HAS ERROR CODE
  3025					UPX NOT LOCKED.
  3026					SKIP, J HAS FRAME NUMBER, %UPX HAS CONTEXT PAGES WRITE LOCKED.
  3027					ORIGINAL CONTENTS OF P3 AND P4 ARE LOST.
  3028				@@;
  3029
  3030				EXTERNAL WLKUPX,ULDUPX
  3031
  3032	003053'	260040	003102'	FD2WLK::PUSHJ	P,FD2FNO	;GET FRAME NUMBER TO LOCK
  3033	003054'	263040	000000		  POPJ	P,		;P3 HAS ERROR CODE.
  3034	003055'	260040	000000*	FD2WL1::PUSHJ	P,WLKUPX	;TRY TO GET THE CONTEXT PAGES IN
  3035	003056'	254000	003543'		  JRST	FECLP		;CAN'T GET THEM IN.
  3036	003057'	321700	002723*		JUMPL	P3,CPOPJ1	;IF NO RIGHTS CHECK, RETURN NOW.
  3037	003060'	260040	003153'		PUSHJ	P,CHEKAR	;SEE IF HE HAS RIGHTS
  3038	003061'	324740	003052*		  PJRST ULDUPX		;GIVE BACK %UPX AND ERROR CODE IS IN P3.
  3039	003062'	254000	003057*		JRST	CPOPJ1		;OK, RETURN.
  3040
  3041
  3042				COMMENT  ;@@SUBROUTINE FARCHK
  3043				@@PURPOSE CHECK A FAST ACCESS RIGHT TO SEE IF CALLER HAS ACCESS
  3044				@@ENTRY	P3/ACCESS RIGHTS CODE FOR INTENDED FUNCTION
  3045					P4/FRAME DESCRIPTOR
  3046				@@ACCUM T1-T4, P3, P4
  3047				@@EXIT	NON-SKIP, P3 HAS ERROR CODE FOR ERROR
  3048					SKIP IF OK, FRAME NUMBER IN J.
  3049				@@;
  3050
  3051	003063'	260040	003102'	FARCHK::PUSHJ	P,FD2FNO	;GET FRAME NUMBER.
  3052	003064'	263040	000000		  POPJ	P,
  3053	003065'	260040	003153'		PUSHJ	P,CHEKAR	;SEE IF CAN DO IT
  3054	003066'	263040	000000		  POPJ	P,		;NO, RETURN ERROR IN P3
  3055	003067'	254000	003062*		JRST	CPOPJ1		;OK.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 62
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3056				SUBTTL FRAME DESCRIPTOR PROCESSING
  3057				COMMENT ;@@SUBROUTINE FD2FNO
  3058				@@PURPOSE CONVERT FRAME DESCRIPTOR TO ABSOLUTE FRAME NUMBER
  3059				@@ENTRY	RH(P4)/FRAME DESCRIPTOR
  3060				@@ACCUM T3,T4
  3061				@@EXIT	SKIP RETURN WITH C(J) FRAME NUMBER IF SUCCESSFUL
  3062					NON-SKIP IF ERROR, CODE IN P3 IF NOT SUCCESSFUL.
  3063					CONTENTS OF ARG C(P4) ARE PRESERVED.
  3064				@@;
  3065
  3066	003070'	261040	000016	FD2J::	PUSH	P,P3		;Convert FD in J to frame number in J
  3067	003071'	261040	000017		PUSH	P,P4		;Preserves all other ACs
  3068	003072'	550740	000002		HRRZ	P4,J		;Get FD
  3069	003073'	474700	000000		SETO	P3,		;No access rights
  3070	003074'	260040	003102'		PUSHJ	P,FD2FNO	;Convert to frame number in J
  3071					  JRST	[MOVE	J,P3	  ;Return error code in J
  3072	003075'	254000	004063'			 JRST	FD2J1]
  3073	003076'	350001	000000		AOS	(P)		;Skip return
  3074	003077'	262040	000017	FD2J1:	POP	P,P4
  3075	003100'	262040	000016		POP	P,P3
  3076	003101'	263040	000000		POPJ	P,
  3077
  3078
  3079	003102'	201440	003104'	FD2FNO::MOVEI	T4,FD2TAB	;ADDRESS OF INSTRUCTION TABLE
  3080	003103'	254000	003352'		JRST	FDDSP		;DISPATCH.
  3081
  3082	003104'	254000	003133'	FD2TAB:	JRST	FD2ABS		;(0) ABS FRAME NUMBER
  3083	003105'	256000	000000'		STOPCD			;(1) FAMILY
  3084	003106'	256000	000000'		STOPCD			;(2) OTHER FRAME
  3085	003107'	254000	003140'		JRST	FD2FRH		;(3) HANDLE
  3086	003110'	254000	003541'		JRST	FEUND		;(4) UNDEFINED
  3087	003111'	254000	003541'		JRST	FEUND		;(5) UNDEFINED
  3088	003112'	254000	003541'		JRST	FEUND		;(6) UNDEFINED
  3089	003113'	254000	003131'		JRST	FD2SLF		;(7) OWN FRAME
  3090	003114'	254000	003122'		JRST	FD2CHL		;(1,0) CHILD
  3091	003115'	254000	003116'		JRST	FD2PAR		;(1,1) PARENT FRAME
  3092
  3093	003116'	200100	000000*	FD2PAR:	MOVE	J,%UPT+UPTJOB	;GET OUR OWN FRAME NUMBER
  3094	003117'	135100	004047'		LDB	J,PRNTBP(J)	;GET OUR PARENT IF ANY
  3095	003120'	322100	003545'		JUMPE	J,FENPR		;NO PARENT, GIVE ERROR
  3096	003121'	254000	003067*		JRST	CPOPJ1		;OK, RETURN WITH PARENT'S FRAME NUMBER
  3097
  3098	003122'	200100	000017	FD2CHL:	MOVE	J,P4		;GET FD IN J
  3099	003123'	405100	077777		ANDI	J,FDDMSK	;JUST FRAME NUMBER
  3100	003124'	303100	000000*		CAILE	J,JOBMAX	;FRAME NUMBER IN RANGE?
  3101	003125'	254000	003537'		 JRST	FEBDF		;NO, GIVE ERROR
  3102	003126'	260040	003002'		PUSHJ	P,ISCHLD	;MAKE SURE ITS ONE OF OUR CHILDREN
  3103	003127'	254000	003542'		  JRST	FENCH		;NOT A CHILD.
  3104	003130'	254000	003121*		JRST	CPOPJ1		;OK, RETURN WITH CHILD NUMBER IN J
  3105
  3106	003131'	200100	000000*	FD2SLF:	MOVE	J,%UPT+UPTJOB	;GET OWN FRAME NUMBER
  3107	003132'	254000	003130*		JRST	CPOPJ1		;AND RETURN WITH IT.
  3108
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 62-2
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3109	003133'	200100	000017	FD2ABS:	MOVE	J,P4		;GET THE DESCRIPTOR
  3110	003134'	405100	077777		ANDI	J,FDDMSK	;JUST THE FRAME NUMBER
  3111	003135'	303100	003124*		CAILE	J,JOBMAX	;OK AS LONG AS ITS INSIDE LEGAL RANGE.
  3112	003136'	254000	003537'		 JRST	FEBDF		;NO, GIVE ERROR.
  3113	003137'	254000	003132*		JRST	CPOPJ1		;GIVE SUCCESS. CHEKAR WILL CHECK LICENSE.
  3114
  3115				;HERE FOR HANDLE
  3116
  3117	003140'	200100	000017	FD2FRH:	MOVE	J,P4		;GET DESCRIPTOR
  3118	003141'	405100	077777		ANDI	J,FDDMSK	;JUST THE HANDLE INDEX NUMBER
  3119	003142'	303100	002115*		CAILE	J,FHIMAX	;LEGAL HANDLE INDEX NUMBER?
  3120	003143'	254000	003547'		 JRST	FEBDH		;NO, ERROR
  3121	003144'	336102	000000*		SKIPN	J,%UPT+UPTFHT(J) ;GET HANDLE ADDRESS
  3122	003145'	254000	003534'		 JRST	FENOH		;NO HANDLE
  3123	003146'	200402	000001		MOVE	T3,.FHUID(J)	;GET UNIVERSAL ID NUMBER
  3124	003147'	200102	000000		MOVE	J,.FHFNO(J)	;GET FRAME NUMBER INTO J
  3125	003150'	312402	002523*		CAME	T3,JBTUID(J)	;MAKE SURE UID'S MATCH
  3126	003151'	254000	003535'		 JRST	FEBDI		;THEY DO NOT, GIVE ERROR.
  3127	003152'	254000	003137*		JRST	CPOPJ1		;AND GIVE GOOD RETURN
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 63
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3128				COMMENT ;@@SUBROUTINE CHEKAR
  3129				@@PURPOSE SEE IF THE CALLER HAS THE RIGHT TO PERFORM A GIVEN
  3130				FUNCTION THROUGH A GIVEN FRAME DESCRIPTOR
  3131				@@ENTRY	P3/ACCESS RIGHT FUNCTION CODE
  3132					RH(P4)/FRAME DESCRIPTOR
  3133					%UPX - HAS CONTEXT PAGES OF C(J) FRAME
  3134				IT IS ASSUMED THAT FD2FNO WAS CALLED, WHICH CHECKS THE VALIDITY
  3135				OF THE FRAME DESCRIPTOR.
  3136				@@ACCUM T1-T4, P3, P4
  3137				@@EXIT NON-SKIP IF CALLER CANNOT PERFORM FUNCTION
  3138					ERROR CODE IN P3 (SEE FEERS ROUTINE)
  3139					SKIP IF CALLER CAN PERFORM FUNCTION
  3140					ORIGINAL CONTENTS OF P3 AND P4 ARE LOST.
  3141				@@;
  3142
  3143				EXTERNAL %UPT,%UPX,UPTS2P,UPTP2S,UPTFHT,UPTJOB
  3144				EXTERNAL BITTBL
  3145				EXTERNAL JBTLIC
  3146				EXTERNAL JOBMAX,FHIMAX,CPOPJ1
  3147				EXTERNAL JBTP2S,JBTS2P,JBTSPN,JBTPNO
  3148
  3149	003153'	303700	000061	CHEKAR::CAILE	P3,.ARMAX	;IS IT IN RANGE?
  3150	003154'	254000	003544'		 JRST	FEBAR		;NO, BAD ACCESS RIGHTS CODE.
  3151	003155'	200300	000016		MOVE	T1,P3		;GET ACCESS RIGHT CODE INTO T1 FOR IDIVI
  3152	003156'	231300	000044		IDIVI	T1,^D36		;T1 GETS INDEX INTO WHATEVER BIT TABLE,
  3153	003157'	200347	000000*		MOVE	T2,BITTBL(T2)	; T2 HAD BIT NUMBER, GETS THE BIT.
  3154	003160'	201440	003162'		MOVEI	T4,CHEKTB	;ADDRESS OF DISPATCH TABLE FOR FDDSP
  3155	003161'	254000	003352'		JRST	FDDSP		;AND DISPATCH.
  3156
  3157				;FRAME DESCRIPTOR ROUTINES ARE GIVEN INDEX FOR ACCESS RIGHT
  3158				; BIT TABLE IN T1, BIT IN T2, FRAME DESCRIPTOR IN P4.
  3159
  3160	003162'	254000	003241'	CHEKTB:	JRST	CHEABS		;(0) ABS FRAME NUMBER
  3161	003163'	256000	000000'		STOPCD			;(1) FAMILY
  3162	003164'	256000	000000'		STOPCD			;(2) OTHER FRAME
  3163	003165'	254000	003174'		JRST	CHEFRH		;(3) HANDLE
  3164	003166'	254000	003541'		JRST	FEUND		;(4) UNDEFINED
  3165	003167'	254000	003541'		JRST	FEUND		;(5) UNDEFINED
  3166	003170'	254000	003541'		JRST	FEUND		;(6) UNDEFINED
  3167	003171'	254000	003152*		JRST	CPOPJ1		;(7) OWN FRAME
  3168	003172'	254000	003235'		JRST	CHECHL		;(1,0) CHILD FRAME
  3169	003173'	254000	003224'		JRST	CHEPAR		;(1,1) PARENT FRAME
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 64
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3170				;HERE FOR HANDLE, HANDLE INDEX IN P4, T1 AND T2 INDEX AND BIT
  3171				; INTO ACCESS BIT TABLE
  3172
  3173	003174'	405740	077777	CHEFRH:	ANDI	P4,FDDMSK	;JUST DATA.
  3174	003175'	303740	003142*		CAILE	P4,FHIMAX	;WITHIN THE RANGE OF A HANDLE INDEX?
  3175	003176'	254000	003547'		JRST	FEBDH		;NO, BAD HANDLE.
  3176	003177'	336757	000000*		SKIPN	P4,%UPT+UPTFHT(P4)	;GET HANDLE ADDRESS IN P4
  3177	003200'	254000	003534'		JRST	FENOH		;ZERO MEANS THERE ISN'T ANY HANDLE.
  3178	003201'	200400	000006		MOVE	T3,T1		;GET RELATIVE WORD IN T3
  3179	003202'	271417	000003		ADDI	T3,.FHART(P4)	;GET ADDRESS OF THE BIT TO CHECK
  3180	003203'	616350	000000		TDNN	T2,(T3)		;OK IF THE BIT IS ON
  3181	003204'	254000	003536'		JRST	FENRT		;NO RIGHT TO DO THIS OPERATION
  3182	003205'	135400	003710'		LDB	T3,[HTPPTR(.FHTYP(P4))] ;GET HANDLE TYPE
  3183	003206'	306400	000002		CAIN	T3,.FHLIC	;IF LICENSED, OK.
  3184	003207'	254000	003171*		JRST	CPOPJ1
  3185	003210'	200702	003150*		MOVE	P3,JBTUID(J)	;GET UNIVERSAL ID NUMBER
  3186	003211'	312717	000001		CAME	P3,.FHUID(P4)	;MUST MATCH
  3187	003212'	254000	003535'		JRST	FEBDI		;IDS DO NOT MATCH
  3188	003213'	302400	000001		CAIE	T3,.FHPRC	;PROCESS HANDLE?
  3189	003214'	254000	003221'		JRST	CHEFR1		;NO, SEE IF ITS ANOTHER TYPE.
  3190	003215'	200402	002534*		MOVE	T3,JBTPNO(J)	;YES, CAN ACCESS IF PNO MATCHES
  3191	003216'	312417	000002		CAME	T3,.FHPNO(P4)	;THE ONE IN THE HANDLE
  3192	003217'	254000	003536'		JRST	FENRT		;LOSES, SOME OTHER PROGRAM GRANTED THE PROCESS RIGHTS.
  3193	003220'	254000	003207*		JRST	CPOPJ1		;OK, WINS.
  3194
  3195	003221'	306400	000000	CHEFR1:	CAIN	T3,.FHFRM	;FRAME HANDLE?
  3196	003222'	254000	003252'		JRST	MFRCHK		;YES, CAN HAVE RIGHTS SUBJECT TO MAX FRAME RIGHTS.
  3197	003223'	254000	003563'		JRST	FEBHT		;BAD HANDLE TYPE.
  3198
  3199				;HERE TRYING TO ACCESS PARENT. CHILD OVER PARENT RELATIONSHIP
  3200				; IS STRICLY A PROCESS RELATIONSHIP FOR THE MOMENT - LATER,
  3201				; WE MUST ADD A BIT WHICH ALLOWS IT TO BE A FRAME RELATIONSHIP
  3202				; WHEN WE ADD THE "SELF RIGHT" FOR A FRAME TO CREATE FRAME
  3203				; HANDLES TO ITSELF, RATHER THAN JUST PROCESS HANDLES.
  3204				; ELSE, FRAME COULD GET A FRAME HANDLE TO ITSELF BY CREATING
  3205				; A CHILD WHICH PASSED THE FRAME HANDLE TO PARENT.
  3206
  3207	003224'	200400	004065'	CHEPAR:	MOVE	T3,[%UPT+UPTS2P,,JBTS2P]
  3208	003225'	200100	000000*		MOVE	J,%UPT+UPTJOB	;GET OUR FRAME NUMBER
  3209	003226'	260040	003256'		PUSHJ	P,ARCHEK	;CHECK RIGHT
  3210	003227'	254000	003536'		  JRST	FENRT		;SORRY.
  3211	003230'	200402	002720*		MOVE	T3,JBTSPN(J)	;GET PROCESS NUMBER THAT GRANTED THE RIGHTS
  3212	003231'	135100	004047'		LDB	J,PRNTBP(J)	;GET PARENT FRAME NUMBER
  3213	003232'	316402	003215*		CAMN	T3,JBTPNO(J)	;SAME PROCESS AS RUNNING NOW?
  3214	003233'	350001	000000		AOS	(P)		;YES, WIN.
  3215	003234'	263040	000000		POPJ	P,		;NO, NO RIGHTS AT ALL.
  3216
  3217				;HERE TRYING TO ACCESS CHILD. FD2FNO ALREADY CALLED, SO NO NEED TO CHECK.
  3218				; PARENT TO CHILD RELATIONSHIP ACTS LIKE A FRAME HANDLE - IT
  3219				; CANOT BE VALIDATED BY THE CHILD LIKE A PROCESS RELATIONSHIP,
  3220				; AND IT CAN ALWAYS HAVE UP TO CURRENT MAX FRAME RIGHTS OF CHILD FRAME.
  3221
  3222	003235'	200400	004066'	CHECHL:	MOVE	T3,[%UPX+UPTP2S,,JBTP2S] ;FOR RIGHTS CHECKING
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 64-2
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3223	003236'	260040	003256'		PUSHJ	P,ARCHEK	;INHERENT RIGHTS ALLOW IT?
  3224	003237'	254000	003536'		  JRST	FENRT		;NO.
  3225	003240'	324740	003252'		PJRST	MFRCHK		;NO, RIGHTS SUBJECT TO MAX FRAME RIGHTS.
  3226
  3227	003241'	405740	077777	CHEABS:	ANDI	P4,FDDMSK	;JUST DATA, NO TYPE.
  3228	003242'	303740	003135*		CAILE	P4,JOBMAX	;LEGAL
  3229	003243'	254000	003537'		JRST	FEBDF
  3230	003244'	260040	003300'		PUSHJ	P,ABSACC	;GET P4 FAST,,SLOW = TABLE,,TABLE+1
  3231	003245'	254000	003540'		  JRST	FENLC		;HAS NO LICENSE
  3232	003246'	271317	777777		ADDI	T1,-1(P4)	;GET ADDRESS TO CHECK
  3233	003247'	616346	000000		TDNN	T2,(T1)		;HAS THE BIT SET?
  3234	003250'	254000	003536'		JRST	FENRT		;NO
  3235	003251'	254000	003220*		JRST	CPOPJ1		;YES.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 65
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3236				COMMENT ;@@SUBROUTINE MFRCHK
  3237				@@PURPOSE CHECK MAX FRAME RIGHTS FOR FRAME
  3238				@@ENTRY	T1/INDEX
  3239					T2/BIT
  3240					J/FRAME NUMBER
  3241					%UPX/CTX PAGES FOR C(J) IF SLOW ACCESS RIGHTS
  3242				@@ACCUM T3
  3243				@@EXIT	NONSKIP AND ERROR CODE FOR ACCESS RIGHTS FAIL IN P3 IF ERROR.
  3244					SKIP IF OK.
  3245				@@;
  3246
  3247				EXTERNAL UPTMFR,JBTMFR
  3248
  3249	003252'	200400	004067'	MFRCHK:	MOVE	T3,[%UPX+UPTMFR,,JBTMFR]
  3250	003253'	260040	003256'		PUSHJ	P,ARCHEK
  3251	003254'	254000	003536'		  JRST	FENRT
  3252	003255'	254000	003251*		JRST	CPOPJ1
  3253
  3254
  3255				COMMENT ;@@SUBROUTINE ARCHEK
  3256				@@PURPOSE CHECK BITS EITHER IN JBT TABLE OR UPT, DEPENDING ON
  3257				WHETHER INDEX AC T1 IS 0 OR NON-ZERO.
  3258				@@ENTRY	T1/INDEX (0 FOR JBT TABLE, 1-INF FOR UPT)
  3259					T2/THE BIT WITHIN THE WORD
  3260					T3/%UPT+UPT???,,JBT???
  3261					J/FRAME NUMBER
  3262					%UPX/SETUP IF NECESSARY FOR A SLOW ACCESS RIGHT
  3263				@@ACCUM T3
  3264				@@EXIT NON-SKIP IF ACCESS FAILURE
  3265					SKIP IF ACCESS OK.
  3266				@@;
  3267
  3268	003256'	326300	003263'	ARCHEK:	JUMPN	T1,ARCHE1	;GO IF SLOW ACCESS RIGHT.
  3269	003257'	505400	000002		HRLI	T3,J		;MAKE T3/JBT???(J)
  3270	003260'	612360	000010		TDNE	T2,@T3
  3271	003261'	350001	000000		AOS	(P)
  3272	003262'	263040	000000		POPJ	P,
  3273	003263'	557000	000010	ARCHE1:	HLRZS	T3		;GET %UPT+UPT??? IN RH OF T3
  3274	003264'	271406	777777		ADDI	T3,-1(T1)	;GET INDEX TO CHECK.
  3275	003265'	612360	000010		TDNE	T2,@T3
  3276	003266'	350001	000000		AOS	(P)
  3277	003267'	263040	000000		POPJ	P,
  3278
  3279				;ROUTINE FOR COMCON TO INIT RIGHTS FOR CURRENT JOB TO VIRGIN. SMASHES T1 ONLY.
  3280				; EXPECTS CTX PAGES FOR CURRENT JOB IN %UPT.
  3281
  3282	003270'	200300	003511'	INIARB::MOVE	T1,ALLMFR	;GET FAST BITS
  3283	003271'	202302	002457*		MOVEM	T1,JBTP2S(J)	;INITIALLY, PARENT HAS ALL RIGHTS
  3284	003272'	202302	002462*		MOVEM	T1,JBTMFR(J)	;AND SO DOES EVERYONE ELSE
  3285	003273'	200300	004070'		MOVE	T1,[ALLMFR+1,,%UPT+UPTMFR]
  3286	003274'	251300	000000*		BLT	T1,%UPT+UPTMFR+.ARSIZ-1 ;COPY THE SLOW BITS
  3287	003275'	200300	004071'		MOVE	T1,[ALLMFR+1,,%UPT+UPTP2S]
  3288	003276'	251300	000000*		BLT	T1,%UPT+UPTP2S+.ARSIZ-1 ;ALL RIGHTS.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 65-2
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3289	003277'	263040	000000		POPJ	P,		;RETURN.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 66
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3290				COMMENT ;@@SUBROUTINE ABSACC
  3291				@@PURPOSE RETURN ACCESS RIGHTS THAT CURRENTLY RUNNING FRAME HAS OVER
  3292				ANOTHER FRAME
  3293				@@ENTRY %UPT/ CONTEXT PAGES FOR CURRENT FRAME
  3294					RH(J)/ FRAME NUMBER OF TARGET
  3295				@@ACCUM T3,T4
  3296				@@EXIT	NON-SKIP IF NO ABSOLUTE ACCESS OVER TARGET FRAME
  3297					SKIP IF HAVE SOME LEVEL OF ACCESS WITH
  3298					P4/FAST RIGHTS ADDRESS,SLOW RIGHTS ADDRESS
  3299					RIGHTS ARE STORED ON THE STACK. POPJ OR CPOPJ1 WILL
  3300					RETURN AND TAKE STUFF BACK OFF STACK.
  3301				@@;
  3302			400000	ABSAUN==1B18			;SIGN BIT IS SAME AUN
  3303			200000	ABSGAN==1B19			;SAME GAN
  3304			100000	ABSNZA==1B20			;SET IF ANY BITS ARE SEEN AT ALL.
  3305
  3306				IFN <<ABSAUN!ABSGAN!ABSNZA>&<PVACTS!PVTYMP>>,<PRINTX ABSACC FLAGS MUST BE DIFFERENT THAN PVACTS
  3307				 AND PVTYMP
  3308				QQQQQQ>
  3309
  3310	003300'	261040	000006	ABSACC:	PUSH	P,T1		;CALLER CANNOT HAVE THEM ON STACK SO
  3311	003301'	261040	000007		PUSH	P,T2		;WE HAVE TO SAVE THEM
  3312	003302'	205741	000001		MOVSI	P4,1(P)		;THIS IS WHERE RIGHTS WILL BE RETURNED
  3313	003303'	541741	000002		HRRI	P4,2(P)		; IN FAST,,SLOW FORMAT
  3314
  3315	003304'	200440	000000*		MOVE	T4,%UPT+UPTJOB	;GET CALLER'S FRAME NUMBER
  3316	003305'	550411	000600*		HRRZ	T3,JBTPRV(T4)	;GET JBTPRV FOR CALLER
  3317	003306'	405400	060000		ANDI	T3,PVACTS!PVTYMP ;JUST ACT SUPER AND TYMSHARE PROPRIETARY
  3318	003307'	200351	000564*		MOVE	T2,JBTAUN(T4)	;GET CALLERS AUN
  3319	003310'	430342	003307*		XOR	T2,JBTAUN(J)	;XOR WITH TARGET FRAME'S AUN
  3320					JUMPE	T2,[TRO T3,ABSAUN ;SAME AUN, MARK THE FLAG IN T3
  3321	003311'	322340	004072'			    JRST ABSAC0]  ;AND GO
  3322	003312'	603340	777777		TLNE	T2,-1		;SAME GAN?
  3323					JRST	[TRZ T3,PVACTS	;NOT ACCT SUPER FOR THIS TARGET
  3324	003313'	254000	004074'			 JRST ABSAC0]
  3325	003314'	660400	200000		TRO	T3,ABSGAN	;FLAG THAT ITS SAME GAN, MAY HAVE ACCESS
  3326								;AND LEAVE PVACTS ON IN RH(T3).
  3327	003315'	205300	777776	ABSAC0:	MOVSI	T1,-<.ARSIZ+FARSIZ> ;AOBJN POINTER
  3328	003316'	500411	001663*		HLL	T3,JBTLIC(T4)	;GET LICENSE BITS
  3329	003317'	400340	000000		SETZ	T2,		;CLEAR OUT T2 FOR FIRST TIME
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 67
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3330				;NOW CHECK THE LICENSES AND OR THE ACCESS RIGHTS INTO T2
  3331				; FOR EACH MONITOR ACCESS RIGHTS WORD.
  3332
  3333	003320'	603400	400000	ABSAC1:	TLNE	T3,LICWCR	;WRITE CORE
  3334	003321'	434346	003471'		IOR	T2,WCATAB(T1)	;YES, GET THOSE BITS
  3335	003322'	603400	200000		TLNE	T3,LICSPY	;READ CORE?
  3336	003323'	434346	003473'		IOR	T2,RCATAB(T1)	;YES
  3337	003324'	603400	001000		TLNE	T3,LICJAL	;JACCT-LOGINN LICENSE?
  3338	003325'	434346	003501'		IOR	T2,JALTAB(T1)	;YES.
  3339	003326'	603400	040000		TLNE	T3,LICSYS	;SYSTAT?
  3340	003327'	434346	003475'		IOR	T2,SYSTAB(T1)	;YES
  3341	003330'	602400	420000		TRNE	T3,ABSAUN!PVACTS ;ACCT SUPERVISOR OR SAME AUN?
  3342	003331'	434346	003503'		IOR	T2,AUNTAB(T1)	;YES.
  3343	003332'	602400	040000		TRNE	T3,PVTYMP	;TMSHARE PROPRIETARY?
  3344	003333'	434346	003477'		IOR	T2,TYPTAB(T1)	;YES
  3345
  3346	003334'	261040	000007		PUSH	P,T2		;END OF CHECKS, PUSH RESULTANT WORD
  3347	003335'	632340	000007		TDZE	T2,T2		;CLEAR T2 AND SKIP IF NO BITS WERE TURNED ON
  3348	003336'	660400	100000		TRO	T3,ABSNZA	;REMEMBER THAT CALLER HAS SOME ACCESS.
  3349	003337'	253300	003320'		AOBJN	T1,ABSAC1	;AND GO FOR NEXT WORD.
  3350	003340'	200341	777776		MOVE	T2,-<.ARSIZ+FARSIZ>(P) ;GET T2 AND T1 BACK FOR
  3351	003341'	200301	777775		MOVE	T1,-<.ARSIZ+FARSIZ>-1(P) ;CALLER
  3352	003342'	606400	100000		TRNN	T3,ABSNZA	;SKIP IF WE SAW SOME RIGHTS
  3353					JRST	[SUB P,[.ARSIZ+FARSIZ+2,,.ARSIZ+FARSIZ+2]
  3354	003343'	254000	004077'			 POPJ P,]	;NO, GET STUFF OFF STACK AND GIVE ERROR RETURN.
  3355	003344'	350001	777774		AOS	-<.ARSIZ+FARSIZ>-2(P)	;SKIP RETURN TO CALLER
  3356	003345'	260061	777774		PUSHJ	P,@-<.ARSIZ+FARSIZ>-2(P) ;CALL THE CALLER
  3357	003346'	334000	000000		  SKIPA			;NON-SKIP TO CALLER'S CALLER
  3358	003347'	350001	777773		AOS	-<.ARSIZ+FARSIZ>-2-1(P) ;SKIP TO CALLER'S CALLER
  3359	003350'	274040	004101'		SUB	P,[.ARSIZ+FARSIZ+3,,.ARSIZ+FARSIZ+3] ;GET STUFF OFF STACK
  3360	003351'	263040	000000		POPJ	P,		;AND RETURN TO CALLER'S CALLER.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 68
FRMSER.MAC	 8-DEC-87 16:09		FRAME DESCRIPTOR PROCESSING

  3361				;ROUTINE TO DISPATCH ACCORDING TO FD TYPE.
  3362				; TAKES FD IN P4, TABLE ADDRESS IN T4. SMASHES T3 AND T4.
  3363				; CALLED EITHER WITH PJRST OR PUSHJ. IF BAD FRAME DESCRIPTOR,
  3364				; RETURNS WITH P3 = ERROR CODE.
  3365				; TABLE FORMAT IS EIGHT WORDS, ONE FOR EACH FD TYPE, FOLLOWED
  3366				; BY 3 WORDS, ONE FOR EACH FAMILY TYPE.
  3367				; CHANGES P4 IF TYPE IS "OTHER FRAME" TO THE ACTUAL DESCRIPTOR.
  3368
  3369
  3370	003352'	135400	004102'	FDDSP:	LDB	T3,[POINT 3,P4,20] ;GET TYPE FROM FD
  3371	003353'	306400	000002		CAIN	T3,.FDOTF_-^D15	;IS IT OTHER FRAME?
  3372					JRST	[MOVE P4,%UPT+UPTOFD ;SETUP P4 TO "OTHER FRAME"
  3373	003354'	254000	004103'			 JRST FDDSP]	;AND DO DISPATCH AGAIN.
  3374	003355'	306400	000001		CAIN	T3,.FDFAM_-^D15	;FAMILY TYPE?
  3375					JRST	[LDB T3,[POINT 3,P4,23] ;GET FAMILY TYPE
  3376						 CAILE T3,.FMMAX_-^D12
  3377						 PJRST FEBFD
  3378						 ADDI T3,10(T4) ;GET ADDRESS OF INSTRUCTION
  3379	003356'	254000	004106'			 JRST .+2]	;AND REJOIN
  3380	003357'	271411	000000		ADDI	T3,(T4)		;NOT FAMILY TYPE, GET ADDRESS OF INSTRUCTION
  3381	003360'	256010	000000		XCT	(T3)		;DO THE INSTRUCTION
  3382	003361'	254000	003255*		JRST	CPOPJ1		;IN CASE CALLER CALLED WITH PUSHJ
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 69
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3383				SUBTTL BIT MAP TRANSLATION ROUTINES
  3384				COMMENT ;@@SUBROUTINE FNDOFS
  3385				@@PURPOSE FIND TABLE ENTRY COVERING NUMBER IN T1.
  3386				@@ENTRY	T1/NUMBER
  3387					T2/END ADDRESS OF TABLE,,START OF TABLE
  3388				SEE COMMENT AT U2MACT AND M2UACT DEFINITIONS FOR FORMAT OF TABLE.
  3389				@@ACCUM T1-T4
  3390				@@RESTRICTIONS CALLER MUST NOT CALL WITH NUMBER IN T1 LESS THAN
  3391				LH OF FIRST TABLE ENTRY.
  3392				@@EXIT ALWAYS NON-SKIP, RH OF T2 CONTAINS ADDRESS OF TABLE ENTRY.
  3393				@@;
  3394
  3395				EXTERNAL CPOPJ
  3396
  3397	003362'	554400	000007	FNDOFS:	HLRZ	T3,T2		;GET END ADDRESS
  3398	003363'	275407	000000		SUBI	T3,(T2)		;GET LENGTH-1
  3399	003364'	323400	002776*		JUMPLE	T3,CPOPJ	;IF START=END, FOUND IT.
  3400								;IF -VE, NO ENTRY IN TABLE FOR IT.
  3401	003365'	271400	000002		ADDI	T3,1+1		;GET LENGTH, CAUSE LSH TO ROUND UP.
  3402	003366'	242400	777777		LSH	T3,-1		;(LENGTH)/2
  3403	003367'	271407	000000		ADDI	T3,(T2)		;GET ADDRESS OF WORD TO CHECK
  3404	003370'	554450	000000		HLRZ	T4,(T3)		;GET STARTING NUMBER
  3405	003371'	315300	000011		CAMGE	T1,T4		;SKIP IF IN 2ND HALF OF TABLE
  3406	003372'	254000	003375'		JRST	FNDOF1		;NO, MUST BE IN FIRST PART
  3407	003373'	541350	000000		HRRI	T2,(T3)		;USE THIS WORD AS NEW START
  3408	003374'	254000	003362'		JRST	FNDOFS
  3409	003375'	505350	777777	FNDOF1:	HRLI	T2,-1(T3)	;THIS WORD IS PAST, NEW END IS THIS -1.
  3410	003376'	254000	003362'		JRST	FNDOFS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 70
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3411				COMMENT #@@SUBROUTINE ACRPTR
  3412				@@PURPOSE HELP CONVERT BETWEEN USER AND MONITOR ACCESS RIGHT BIT
  3413				MAPS BY PROVIDING BYTE POINTERS
  3414				@@ENTRY U/ AOBJN POINTER TO TRANSLATION TABLE
  3415					JSP F,ACRPTR	;FIRST TIME.
  3416					JRST	(M)	;FOR NEXT POINTER.
  3417				CALLER MUST PRESERVE CONTENTS OF P1,P2,U,M UNTIL FINISHED.
  3418				@@ACCUM T1-T4,P1-P2
  3419				@@EXIT RETURNS TO JSP + 2 WITH NEXT FROM BYTE PTR IN T3, TO POINTER IN T4.
  3420					RETURNS TO JSP + 1 WHEN NO MORE POINTERS.
  3421				@@#
  3422
  3423	003377'	204605	000000	ACRPTR:	MOVS	P1,(U)		;P1 HAS DEST START,,SOURCE START
  3424	003400'	321604	000000		JUMPL	P1,(F)		;IF NO MORE, RETURN.
  3425	003401'	603600	200000		TLNE	P1,200000	;UNASSIGNED RANGE?
  3426	003402'	344240	003377'		AOJA	U,ACRPTR	;YES, IGNORE THAT POINTER.
  3427	003403'	554645	000001		HLRZ	P2,1(U)		;P2 GETS END SOURCE BIT-1.
  3428	003404'	201540	003470'	ACRPT0:	MOVEI	M,ACRNXW	;ASSUME WILL NOT SPLIT ACROSS WORDS.
  3429	003405'	550300	000014		HRRZ	T1,P1		;GET START BIT NUMBER
  3430	003406'	201415	777777		MOVEI	T3,-1(P2)	;GET END BIT IN T3
  3431	003407'	231300	000044		IDIVI	T1,^D36		;GET WORD NUMBER
  3432	003410'	231400	000044		IDIVI	T3,^D36		;T3/WORD T4/BIT IN WORD
  3433	003411'	316300	000010		CAMN	T1,T3		;IN SAME WORD?
  3434	003412'	254000	003415'		JRST	ACRPT2		;YES, GO SEE DISPOSITION OF DESTINATION BYTE
  3435	003413'	201540	003404'		MOVEI	M,ACRPT0	;CONTINUE WITH CURRENT ENTRY NEXT TIME.
  3436	003414'	201440	000043		MOVEI	T4,^D35		;AND LAST BIT WITHIN THAT WORD.
  3437	003415'	275447	777777	ACRPT2:	SUBI	T4,-1(T2)	;GET JUNK,,SOURCE BYTE SIZE IN T4.
  3438	003416'	271611	000000		ADDI	P1,(T4)		;P1 GETS NEXT BIT NUMBER TO DO, IF ANY.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 71
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3439				;HERE WITH T1 WORD NUMBER FOR SOURCE BYTE, T4 SOURCE BYTE SIZE.
  3440				; AND T2 SOURCE START BIT.
  3441
  3442	003417'	504300	000011	ACRDST:	HRL	T1,T4		;GET IN LH OF T1 FOR COMPRESSION
  3443	003420'	261040	000006		PUSH	P,T1		;SAVE SOURCE: SIZE,,WORD NUMBER
  3444	003421'	261040	000007		PUSH	P,T2		;SAVE SOURCE: START BIT
  3445	003422'	201411	777777		MOVEI	T3,-1(T4)	;GET SOURCE BYTE SIZE-1 IN T3
  3446	003423'	554300	000014		HLRZ	T1,P1		;GET START DEST BIT NUMBER IN TABLE
  3447	003424'	270400	000006		ADD	T3,T1		;GET END DEST BIT NUMBER IN TABLE IN T3
  3448	003425'	231300	000044		IDIVI	T1,^D36		;GET WORD IN T1, BIT POSITION IN T2 FOR START BIT
  3449	003426'	231400	000044		IDIVI	T3,^D36		;SAME FOR T3, T4 FOR END BIT
  3450	003427'	316300	000010		CAMN	T1,T3		;START AND END IN SAME WORD?
  3451	003430'	254000	003443'		JRST	ACRDS1		;YES
  3452								;C(T3) MUST BE C(T1)+1 BECAUSE BYTE
  3453								; SIZE IS GUARANTEED TO BE LESS THAN 36.
  3454	003431'	201540	003404'		MOVEI	M,ACRPT0	;CONTINUE WITH NEXT PART OF ENTRY NEXT TIME.
  3455	003432'	201440	000044		MOVEI	T4,^D36		;GET READY TO COMPUTE
  3456	003433'	274440	000007		SUB	T4,T2		;DEST SIZE IN T4
  3457	003434'	554401	777777		HLRZ	T3,-1(P)	;GET OLD SOURCE BYTE SIZE
  3458	003435'	506441	777777		HRLM	T4,-1(P)	;STORE NEW SOURCE AND DEST BYTE SIZE..
  3459	003436'	274400	000011		SUB	T3,T4		;GET HOW MANY BITS WE COULDN'T DO
  3460	003437'	275610	000000		SUBI	P1,(T3)		;UPDATE SOURCE BIT NUMBER
  3461	003440'	205411	000000		MOVSI	T3,(T4)		;GET SIZE,,0
  3462	003441'	270600	000010		ADD	P1,T3		;UPDATE DEST BIT NUMBER IN LH P1
  3463	003442'	254000	003446'		JRST	ACRDSS		;AND GO MAKE BYTE POINTERS.
  3464
  3465	003443'	275447	777777	ACRDS1:	SUBI	T4,-1(T2)	;GET JUNK,,DEST SIZE
  3466	003444'	514400	000011		HRLZ	T3,T4		;GET SIZE,,0
  3467	003445'	270600	000010		ADD	P1,T3		;UPDATE DEST BIT NUMBER IN CASE SOURCE BYTE IS SPLIT
  3468								; AND FALL INTO ACRDSS.
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 72
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3469				; SIZE,,SOURCE WORD AT -1(P), START SOURCE BIT AT (P)
  3470				; T1/ DEST WORD NUMBER T2/START DEST BIT.
  3471				; T4/JUNK,,SIZE.
  3472				; WORD AND START BIT FOR DESTINATION.
  3473				; BYTE SIZE HERE MUST BE SAME FOR SOURCE AND DESTINATION.
  3474
  3475	003446'	514400	000011	ACRDSS:	HRLZ	T3,T4		;GET SIZE IN LH FOR BYTE POINTER
  3476	003447'	250400	000011		EXCH	T3,T4		;GET JJJJSS,,0 IN T4, 0,,SS IN T3
  3477	003450'	242440	000006		LSH	T4,6		;GET JJSS00,,0 IN T4
  3478	003451'	540440	000006		HRR	T4,T1		;GET WORD NUMBER IN RH (T4) - THIS WILL BE DEST POINTER
  3479								; (JJSS00,,WWWWWW)
  3480	003452'	201300	000044		MOVEI	T1,^D36		;COMPUTE P FOR DEST BYTE POINTER
  3481	003453'	274300	000007		SUB	T1,T2		;36-START
  3482	003454'	274300	000010		SUB	T1,T3		;36-START-SIZE = 35-<START+SIZE-1> = P
  3483	003455'	137300	004113'		DPB	T1,[POINT 6,T4,5] ;PUT IN BYTE POINTER FOR DES.
  3484								;(PPSS00,,WWWWWW)
  3485	003456'	262040	000007		POP	P,T2		;GET SOURCE START BIT
  3486	003457'	262040	000006		POP	P,T1		;GET SIZE,,WORD
  3487	003460'	504400	000006		HRL	T3,T1		;SAVE WORD NUMBER IN LH OF T3 - SIZE STILL IN LH OF T3.
  3488	003461'	201300	000044		MOVEI	T1,^D36
  3489	003462'	274300	000007		SUB	T1,T2		;GET 36-START
  3490	003463'	275310	000000		SUBI	T1,(T3)		;GET 36-START-SIZE = 35-<START+SIZE-1> = P
  3491	003464'	557000	000010		HLRZS	T3		;GET WORD NUMBER IN RH
  3492	003465'	500400	000011		HLL	T3,T4		;GET LH OF POINTER (S FIELD) FROM DEST.
  3493	003466'	137300	004114'		DPB	T1,[POINT 6,T3,5] ;PUT "P" FIELD FOR SOURCE BYTE IN ON TOP OF ONE FOR DES.
  3494	003467'	254004	000001		JRST	1(F)		;RETURN WITH BYTE POINTERS.
  3495	003470'	344240	003377'	ACRNXW:	AOJA	U,ACRPTR	;HERE THRU (M) WHEN POSSIBLY MODIFIED
  3496								; TABLE ENTRIES IN P1 AND P2 DESCRIBE
  3497								; SOURCE AND DEST BYTES THAT AREN'T SPLIT ACROSS WORDS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 73
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3498				;DEFINE ACCESS BITS USED FOR CHECKING WHEN A JOB HAS RC BUT NOT WC
  3499				; LICENSE.
  3500
  3501
  3502				;MACRO TO GENERATE BIT TABLES FOR ARMAC FIELDS
  3503
  3504
  3505				DEFINE BITGEN(F,V)<IRP V,<IRP F,<IFIDN <'F> <'V> <ZZ==ZZ!<1>B<ZZ1>>>>
  3506				ZZ1==ZZ1+1
  3507				IFE ZZ1-^D36,<ZZ
  3508				ZZ==0
  3509				ZZ1==0>>;END BITGEN MACRO DEFINITION
  3510
  3511				DEFINE ARDO<ZZ==0
  3512				ZZ1==0
  3513				ARMAC
  3514				IFN <ZZ1-^D36>,<ZZ>	;;PLACE FINAL WORD IN TABLE
  3515				>;END ARDO MACRO DEFINITION
  3516
  3517				DEFINE ARBITS(ARG)<ARCALL(<BITGEN('ARG)>,ARDO)>
  3518
  3519
  3520				;GENERATE BIT TABLES FOR VARIOUS LICENSES
  3521
  3522	003471'	601540	000000	WCATAB:	ARBITS(<<LIC>,WC>)
  3523	003472'	257760	000000
  3524
  3525	003473'	000000	000000	RCATAB:	ARBITS(<<LIC>,RC>)
  3526	003474'	520000	000000
  3527
  3528	003475'	174000	000000	SYSTAB:	ARBITS(<<LIC>,SY>)
  3529	003476'	000000	000000
  3530
  3531	003477'	100000	000000	TYPTAB:	ARBITS(<<LIC>,TP>)
  3532	003500'	000000	000000
  3533
  3534	003501'	002200	000000	JALTAB:	ARBITS(<<LIC>,JL>)
  3535	003502'	000000	000000
  3536
  3537	003503'	176000	000000	AUNTAB:	ARBITS(<<LIC>,AUN>)
  3538	003504'	000000	000000
  3539
  3540				;GENERATE BIT TABLE FOR EXECUTE ONLY MAX FRAME RIGTS
  3541
  3542	003505'	501000	000000	EXOMFR::ARBITS(<RWX,X>)
  3543	003506'	002400	000000
  3544
  3545				;GENERATE BIT TABLE FOR SWR FILES WITHOUT WRITE ACCESS
  3546
  3547	003507'	575000	000000	RDXMFR::ARBITS(<RWX,<X,R>>)
  3548	003510'	522400	000000
  3549
  3550				;GENERATE BIT TABLE FOR NON-LICENSED NON-SWR FILES, SWR FILES WITH WRITE ACCESS
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 73-2
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3551
  3552	003511'	777740	000000	ALLMFR::ARBITS(<RWX,<X,R,W>>)
  3553	003512'	777760	000000
  3554
  3555	003513'			NULMFR::REPEAT .ARSIZ+FARSIZ,<Z>
  3556	003513'	000000	000000
  3557	003514'	000000	000000
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 74
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3558				COMMENT \
  3559				GENERATE TABLES TO TRANSLATE BETWEEN USER ACCESS RIGHTS CODES
  3560				 AND MONITOR ACCESS RIGHTS CODES. TABLES ARE ALSO USED TO
  3561				 TRANSLATE BETWEEN USER ACCESS RIGHTS BIT MAPS AND THE MONITOR
  3562				 ACCESS RIGHTS BIT MAPS.
  3563
  3564				FORMAT OF TABLE IS:
  3565
  3566					XWD	<FROM CODE>,,<TO CODE>
  3567					XWD	<FROM CODE>,,<TO CODE>
  3568						.
  3569						.
  3570					XWD	<FROM CODE>,,200000	;SAYS UNASSIGNED BIT RANGE
  3571						.
  3572						.
  3573					XWD	<FROM CODE>,,-1 ;LAST ENTRY.
  3574				WHERE <FROM CODE> IS MONOTONICALLY INCREASING AS THE TABLE ADDRESSES
  3575				INCREASE (SOAS TO BE ABLE TO DO A BINARY SEARCH ON THE TABLE).
  3576				THE ROUTINE FNDOFS TAKES THE START AND END ADDRESSES
  3577				OF THESE TABLES AS AN ARGUMENT, AND WILL FIND THE ENTRY
  3578				THAT COVERS A GIVEN <FROM CODE> ARGUMENT.
  3579				\
  3580
  3581
  3582				DEFINE Y(NUM)<
  3583				IFN LOFS-<NUM-ZZ>,<;;NEW OFFSET
  3584					IFDEF LASZZ,<LASZZ,,LASZZ+LOFS>
  3585					LOFS==NUM-ZZ
  3586					LASZZ==ZZ>;END IFN LOFS-<ZZ-NUM>
  3587				GENUAR(\'NUM)
  3588				ZZ==ZZ+1
  3589				>;END Y MACRO DEFINITION
  3590
  3591				DEFINE GENUAR(NUM)<.UA'NUM==ZZ
  3592				IFNDEF .UAMAX,<.UAMAX==NUM>
  3593				IFL .UAMAX-NUM,<.UAMAX==NUM>>
  3594
  3595				DEFINE ARDO<
  3596				IFNDEF LASZZ,<LOFS==777777	;FORCE MATCH FIRST TIME
  3597				ZZ==0
  3598				>;END IFNDEF
  3599				IFDEF LASZZ,<PURGE LASZZ
  3600				LOFS==777777	;FORCE MATCH FIRST TIME
  3601				ZZ==^D36>;END IFDEF
  3602				ARMAC
  3603				IFDEF LASZZ,<LASZZ,,LASZZ+LOFS>
  3604				IFL ZZ-^D36,<;IF FAST RIGHTS AND UNASSIGNED BITS (LESS THAN ALL 36)
  3605					ZZ,,200000	;GENERATE UNASSIGNED TABLE ENTRY FOR REST OF THE BITS.
  3606							;(ZZ HAS BEEN INCREMENTED PAST LAST BIT ALREADY)
  3607				>;END IFL ZZ-^D35
  3608				>;END ARDO MACRO DEFINITION
  3609				IFDEF LASZZ,<PURGE LASZZ>
  3610
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 74-2
FRMSER.MAC	 8-DEC-87 16:09		BIT MAP TRANSLATION ROUTINES

  3611	003515'	000000	000012	M2UACT:ARCALL(<Y('NUM)>,ARDO)
  3612	003516'	000002	000016
  3613	003517'	000007	000025
  3614	003520'	000015	200000
  3615	003521'	000044	000000
  3616	003522'	000056	000014
  3617	003523'	000060	000023
  3618			003523'		M2UACE=.-1		;LAST ADDRESS IN TABLE
  3619	003524'	000062	777777		ZZ,,-1
  3620
  3621				IFDEF LASZZ,<PURGE LASZZ>
  3622
  3623				DEFINE CALUAR(NUM)<Y(.UA'NUM)
  3624				PURGE .UA'NUM>
  3625				DEFINE GENUAR(NUM)<>
  3626
  3627	003525'			U2MACT::
  3628			000000	ZZ==0
  3629			777777	LOFS==777777	;FORCE MATCH FIRST TIME
  3630				REPEAT .UAMAX+1,<
  3631				CALUAR(\ZZ)
  3632				>;END REPEAT .UAMAX+1
  3633	003525'	000000	000044
  3634	003526'	000012	000000
  3635	003527'	000014	000056
  3636	003530'	000016	000002
  3637	003531'	000023	000060
  3638	003532'	000025	000007	IFDEF LASZZ,<LASZZ,,LASZZ+LOFS>			;GET THE LAST WORD.
  3639			003532'	U2MACE=.-1			;LAST ADDRESS IN TABLE
  3640	003533'	000033	777777		ZZ,,-1
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

  3641				SUBTTL ERROR CODES
  3642				;ERROR CODE GENERATOR. ALL ROUTINES THAT DEAL WITH FRAMES
  3643				; USE THE ERROR CODES DEFINED HERE.
  3644				; THE VUUOS THAT NEED TO RETURN THESE CODES RETURN THEM
  3645				; IN 0-5, WITH "HANDLE ERROR" CODE FOR THAT PARTICULAR
  3646				; UUO IN 18-35.
  3647				; SUB ERROR CODES ARE GUARANTEED TO BE NON-ZERO FOR EASY EXISTENCE
  3648				; CHECKING.
  3649
  3650				;SEE S.MAC FOR FDEERP MACRO TO GENERATE BYTE POINTER TO PUT
  3651				; SUB ERROR CODE IN VUUO ERROR RETURN AC.
  3652
  3653
  3654				DEFINE FRMERS<XALL
  3655				X (NOH)		;;(1) NO HANDLE IN SLOT
  3656				X (BDI)		;;(2) UNMATCHING UNIVERSAL ID NUMBER
  3657				X (NRT)		;;(3) NO RIGHTS TO DO OPERATION
  3658				X (BDF)		;;(4) BAD FRAME NUMBER
  3659				X (NLC)		;;(5) NOT ENOUGH LICENSE
  3660				X (UND)		;;(6) UNDEFINED FRAME DESCRIPTOR TYPE
  3661				X (NCH)		;;(7) FD SAID CHILD BUT GAVE NON-CHILD FRAME NUMBER.
  3662				X (CLP)		;;(10) CAN'T LOCK CONTEXT PAGES (FD2UPX)
  3663				X (BAR)		;;(11) BAD ACCESS RIGHTS CODE
  3664				X (NPR)		;;(12) ORPHAN ASKED FOR ITS PARENT
  3665				X (BFD)		;;(13) BAD FAMILY DISPATCH TYPE
  3666				X (BDH)		;;(14) BAD HANDLE INDEX NUMBER IN FD
  3667				X (BFN)		;;(15) BAD FUNCTION CODE TO FRMOP
  3668				X (ADB)		;;(16) ADDRESS FOUND BAD (REPLICATE FAILED) IN .FO?VA
  3669				X (IOE)		;;(17) PAGE I/O ERROR IN FRMRVM/FRMWVM
  3670				X (ALR)		;;(20) ATTEMPT TO START A RUNNING FRAME
  3671				X (ALH)		;;(21) ATTEMPT TO HALT NON-RUNNING FRAME
  3672				X (CSJ)		;;(22) ATTEMPT TO HALT FRAME WITH JACCT ON
  3673				X (FHE)		;;(23) HANDLE DESCRIPTOR EXPECTED, NOT GIVEN
  3674				X (FHU)		;;(24) HANDLE (INDEX ALREADY) USED
  3675				X (NFH)		;;(25) NO HANDLE INDICES LEFT.
  3676				X (BCN)		;;(26) BAD COUNT
  3677				X (BTN)		;;(27) BAD TABLE NUMBER
  3678				X (BHT)		;;(30) BAD HANDLE TYPE
  3679				X (CCH)		;;(31) CAN'T CREATE HANDLE (ACCESS FAILURE)
  3680				X (BSV)		;;(32) BAD START VECTOR OFFSET
  3681				X (CII)		;;(33) ATTEMPT TO MAKE CHILD ITS OWN INFERIOR IN TREE
  3682				X (CCF)		;;(34) CAN'T CONTINUE FRAME
  3683				X (CJF)		;;(35) CAN'T JUMP TO FRAME (PC IS NOT USER MODE)
  3684				X (RNE)		;;(36) RIGHTS NOT EQUAL
  3685				X (ILC)		;;(37) Illegal Command
  3686				SALL>;END FRMERS MACRO DEFINITIONS
  3687
  3688				DEFINE X(ERR)<
  3689				XP <FE'ERR'%>,ZZ
  3690				FE'ERR'::JSP	P3,FEERR
  3691				ZZ==ZZ+1
  3692				>
  3693			000001	ZZ==1
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-2
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

  3694	003534'			FEERS:
  3695				FRMERS  3696	003534'	265700	003573'	FENOH::JSP	P3,FEERR
  3697	003535'	265700	003573'	FEBDI::JSP	P3,FEERR
  3698	003536'	265700	003573'	FENRT::JSP	P3,FEERR
  3699	003537'	265700	003573'	FEBDF::JSP	P3,FEERR
  3700	003540'	265700	003573'	FENLC::JSP	P3,FEERR
  3701	003541'	265700	003573'	FEUND::JSP	P3,FEERR
  3702	003542'	265700	003573'	FENCH::JSP	P3,FEERR
  3703	003543'	265700	003573'	FECLP::JSP	P3,FEERR
  3704	003544'	265700	003573'	FEBAR::JSP	P3,FEERR
  3705	003545'	265700	003573'	FENPR::JSP	P3,FEERR
  3706	003546'	265700	003573'	FEBFD::JSP	P3,FEERR
  3707	003547'	265700	003573'	FEBDH::JSP	P3,FEERR
  3708	003550'	265700	003573'	FEBFN::JSP	P3,FEERR
  3709	003551'	265700	003573'	FEADB::JSP	P3,FEERR
  3710	003552'	265700	003573'	FEIOE::JSP	P3,FEERR
  3711	003553'	265700	003573'	FEALR::JSP	P3,FEERR
  3712	003554'	265700	003573'	FEALH::JSP	P3,FEERR
  3713	003555'	265700	003573'	FECSJ::JSP	P3,FEERR
  3714	003556'	265700	003573'	FEFHE::JSP	P3,FEERR
  3715	003557'	265700	003573'	FEFHU::JSP	P3,FEERR
  3716	003560'	265700	003573'	FENFH::JSP	P3,FEERR
  3717	003561'	265700	003573'	FEBCN::JSP	P3,FEERR
  3718	003562'	265700	003573'	FEBTN::JSP	P3,FEERR
  3719	003563'	265700	003573'	FEBHT::JSP	P3,FEERR
  3720	003564'	265700	003573'	FECCH::JSP	P3,FEERR
  3721	003565'	265700	003573'	FEBSV::JSP	P3,FEERR
  3722	003566'	265700	003573'	FECII::JSP	P3,FEERR
  3723	003567'	265700	003573'	FECCF::JSP	P3,FEERR
  3724	003570'	265700	003573'	FECJF::JSP	P3,FEERR
  3725	003571'	265700	003573'	FERNE::JSP	P3,FEERR
  3726	003572'	265700	003573'	FEILC::JSP	P3,FEERR
  3727	003573'	201716	000000*	FEERR:	MOVEI	P3,-FEERS(P3)
  3728	003574'	263040	000000		POPJ	P,
  3729
  3730				DEFINE X(ERR)<
  3731				FEW'ERR'::JSP P3,FEWERR
  3732				>
  3733	003575'			FEWERS:	FRMERS  3734	003575'	265700	003634'	FEWNOH::JSP P3,FEWERR
  3735	003576'	265700	003634'	FEWBDI::JSP P3,FEWERR
  3736	003577'	265700	003634'	FEWNRT::JSP P3,FEWERR
  3737	003600'	265700	003634'	FEWBDF::JSP P3,FEWERR
  3738	003601'	265700	003634'	FEWNLC::JSP P3,FEWERR
  3739	003602'	265700	003634'	FEWUND::JSP P3,FEWERR
  3740	003603'	265700	003634'	FEWNCH::JSP P3,FEWERR
  3741	003604'	265700	003634'	FEWCLP::JSP P3,FEWERR
  3742	003605'	265700	003634'	FEWBAR::JSP P3,FEWERR
  3743	003606'	265700	003634'	FEWNPR::JSP P3,FEWERR
  3744	003607'	265700	003634'	FEWBFD::JSP P3,FEWERR
  3745	003610'	265700	003634'	FEWBDH::JSP P3,FEWERR
  3746	003611'	265700	003634'	FEWBFN::JSP P3,FEWERR
  3747	003612'	265700	003634'	FEWADB::JSP P3,FEWERR
  3748	003613'	265700	003634'	FEWIOE::JSP P3,FEWERR
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-3
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

  3749	003614'	265700	003634'	FEWALR::JSP P3,FEWERR
  3750	003615'	265700	003634'	FEWALH::JSP P3,FEWERR
  3751	003616'	265700	003634'	FEWCSJ::JSP P3,FEWERR
  3752	003617'	265700	003634'	FEWFHE::JSP P3,FEWERR
  3753	003620'	265700	003634'	FEWFHU::JSP P3,FEWERR
  3754	003621'	265700	003634'	FEWNFH::JSP P3,FEWERR
  3755	003622'	265700	003634'	FEWBCN::JSP P3,FEWERR
  3756	003623'	265700	003634'	FEWBTN::JSP P3,FEWERR
  3757	003624'	265700	003634'	FEWBHT::JSP P3,FEWERR
  3758	003625'	265700	003634'	FEWCCH::JSP P3,FEWERR
  3759	003626'	265700	003634'	FEWBSV::JSP P3,FEWERR
  3760	003627'	265700	003634'	FEWCII::JSP P3,FEWERR
  3761	003630'	265700	003634'	FEWCCF::JSP P3,FEWERR
  3762	003631'	265700	003634'	FEWCJF::JSP P3,FEWERR
  3763	003632'	265700	003634'	FEWRNE::JSP P3,FEWERR
  3764	003633'	265700	003634'	FEWILC::JSP P3,FEWERR
  3765	003634'	201716	000000*	FEWERR:	MOVEI	P3,-FEWERS(P3)
  3766	003635'	256200	003643'		UMOVEM	P3,(W)
  3767	003636'	263040	000000		POPJ	P,		;STORE IN USER AC AND RETURN.
  3768
  3769	003637'	200312	000000		$END	(FRM)

  3770	003640'	202312	000000

  3771	003641'	221100	000006

  3772	003642'	331100	000006

  3773	003643'	202712	000000

  3774	003644'	000000	000011

  3775	003645'	301406	000000*

  3776	003646'	000000*	000000*

  3777	003647'	000000	000000*

  3778	003650'	000000*	000351*

  3779	003651'	000600*	000601*

  3780	003652'	000000*	000440*

  3781	003653'	151515	151515

  3782	003654'	000000*	000000*

  3783	003655'	003512'	000000*

  3784	003656'	003512'	000000*

  3785	003657'	000000	000000*
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-4
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES


  3786	003660'	202315	000000

  3787	003661'	000013	000013

  3788	003662'	040000	002000

  3789	003663'	552315	000000

  3790	003664'	000077	777400

  3791	003665'	200353	000000

  3792	003666'	777777	777772

  3793	003667'	777777	777771

  3794	003670'	200313	000000

  3795	003671'	550313	000000

  3796	003672'	200340	000000*

  3797	003673'	263040	000000

  3798	003674'	000000*	000001

  3799	003675'	550253	000000

  3800	003676'	202313	000001

  3801	003677'	200313	000001

  3802	003700'	416013	000001

  3803	003701'	002001	000440*

  3804	003702'	006001	000440*

  3805	003703'	111100	000005

  3806	003704'	000001	000440*

  3807	003705'	360600	000007

  3808	003706'	200613	000000

  3809	003707'	020000	020000

  3810	003710'	220317	000000

  3811	003711'	200417	000002

FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-5
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

  3812	003712'	312416	003232*

  3813	003713'	254000	003577'

  3814	003714'	254000	001065'

  3815	003715'	607340	400000

  3816	003716'	254000	003577'

  3817	003717'	254000	001073'

  3818	003720'	550302	001103*

  3819	003721'	202300	001104*

  3820	003722'	661300	100000

  3821	003723'	701140	000006

  3822	003724'	370000	000000*

  3823	003725'	254000	003631'

  3824	003726'	400000	000000

  3825	003727'	540607	000000

  3826	003730'	540614	000000

  3827	003731'	401000	000000

  3828	003732'	000000*	000000*

  3829	003733'	200752	000000

  3830	003734'	260040	003061*

  3831	003735'	254000	003631'

  3832	003736'	251300	000000*

  3833	003737'	251300	000000*

  3834	003740'	200712	000000

  3835	003741'	505600	000000*

  3836	003742'	505700	000004

  3837	003743'	254000	001226'

  3838	003744'	000000*	000000*
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-6
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES


  3839	003745'	000000	000002

  3840	003746'	000000	000000*

  3841	003747'	000000	000000*

  3842	003750'	000000	000000*

  3843	003751'	000000	003750*

  3844	003752'	777777	777777

  3845	003753'	550342	001321*

  3846	003754'	254000	001325'

  3847	003755'	202353	000000

  3848	003756'	400340	000000

  3849	003757'	254000	001325'

  3850	003760'	360600	000006

  3851	003761'	251314	000000

  3852	003762'	202313	000000

  3853	003763'	251307	000000

  3854	003764'	251340	000000*

  3855	003765'	251340	000000*

  3856	003766'	000100	000000*

  3857	003767'	124646	000000

  3858	003770'	202746	000002

  3859	003771'	200253	000000

  3860	003772'	200553	000001

  3861	003773'	200345	000000

  3862	003774'	202305	000000

  3863	003775'	000000	000026

  3864	003776'	200653	000000

FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-7
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

  3865	003777'	350000	000000*

  3866	004000'	260040	000000*

  3867	004001'	370000	003777*

  3868	004002'	254000	001713'

  3869	004003'	200153	000001

  3870	004004'	202612	000000

  3871	004005'	001700	000017

  3872	004006'	220310	000000

  3873	004007'	220316	000000

  3874	004010'	220300	000002

  3875	004011'	200153	000000

  3876	004012'	476015	000002

  3877	004013'	254000	003361*

  3878	004014'	135300	000010

  3879	004015'	544440	000016

  3880	004016'	254000	002276'

  3881	004017'	202303	000000

  3882	004020'	220315	000000

  3883	004021'	003513'	003514'

  3884	004022'	202103	000000

  3885	004023'	003511'	003512'

  3886	004024'	202443	000000

  3887	004025'	544340	000016

  3888	004026'	544400	000017

  3889	004027'	254000	002554'

  3890	004030'	137300	000011

  3891	004031'	544400	000017
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-8
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES


  3892	004032'	254000	002567'

  3893	004033'	262040	000015

  3894	004034'	263040	000000

  3895	004035'	321500	003536'

  3896	004036'	254000	004013*

  3897	004037'	400300	000000

  3898	004040'	254000	002636'

  3899	004041'	256040	004014'

  3900	004042'	254000	002636'

  3901	004043'	544340	000017

  3902	004044'	254000	002627'

  3903	004045'	544440	000016

  3904	004046'	254000	002641'

  3905	004047'	301402	003645*

  3906	004050'	001406	004047*

  3907	004051'	141402	004050*

  3908	004052'	141407	004051*

  3909	004053'	141410	004052*

  3910	004054'	001402	004053*

  3911	004055'	301407	004054*

  3912	004056'	262040	000007

  3913	004057'	262040	000006

  3914	004060'	263040	000000

  3915	004061'	262040	000017

  3916	004062'	263040	000000

  3917	004063'	200100	000016

FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-9
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

  3918	004064'	254000	003077'

  3919	004065'	000000*	002531*

  3920	004066'	000000*	003271*

  3921	004067'	000000*	003272*

  3922	004070'	003512'	000000*

  3923	004071'	003512'	000000*

  3924	004072'	660400	400000

  3925	004073'	254000	003315'

  3926	004074'	620400	020000

  3927	004075'	254000	003315'

  3928	004076'	000004	000004

  3929	004077'	274040	004076'

  3930	004100'	263040	000000

  3931	004101'	000005	000005

  3932	004102'	170300	000017

  3933	004103'	200740	000000*

  3934	004104'	254000	003352'

  3935	004105'	140300	000017

  3936	004106'	135400	004105'

  3937	004107'	303400	000001

  3938	004110'	324740	003546'

  3939	004111'	271411	000010

  3940	004112'	254000	003360'

  3941	004113'	360600	000011

  3942	004114'	360600	000010

  3943						;End of FRMSER (FRMLIT: FRMEND:)
  3944
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 75-10
FRMSER.MAC	 8-DEC-87 16:09		ERROR CODES

NO ERRORS DETECTED
PROGRAM BREAK IS 004125
11K CORE USED
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 76
FRMSER.MAC	 8-DEC-87 16:09		SYMBOL TABLE

ABKSET		001112'	EXT	CHRFRH		002170'		FAWLCR		000006	SPD	FEBTN%		000027	SIN
ABSAC0		003315'		CHRPAR		002207'		FAWLCS		000004	SPD	FECCF		003567'	INT
ABSAC1		003320'		CLRFRM		001242'	EXT	FAWLCY		001653'		FECCF%		000034	SIN
ABSACC		003300'		CLRJBT		000632'	EXT	FCEBDA		000461'		FECCH		003564'	INT
ABSAUN		400000	SPD	CMFCHT		001407'	EXT	FCEFCE		000460'		FECCH%		000031	SIN
ABSGAN		200000	SPD	CMFCXN		000241'	EXT	FCEJSP		000464'		FECII		003566'	INT
ABSNZA		100000	SPD	CMFIDX		001422'	EXT	FCENBJ		000463'		FECII%		000033	SIN
ACRDS1		003443'		CMPARN		002256'		FCENCP		000462'		FECJF		003570'	INT
ACRDSS		003446'		CMWB		200000	SIN	FCENRD		000457'		FECJF%		000035	SIN
ACRDST		003417'		CNTFRM		000046'		FCETAB		000457'		FECLP		003543'	INT
ACRNXW		003470'		CNTRLC		000400	SIN	FCREQ		004001'	EXT	FECLP%		000010	SIN
ACRPT0		003404'		CNVVPN		000440	SIN	FCRFCE		000430'		FECSJ		003555'	INT
ACRPT2		003415'		COMWCM		001432'	EXT	FCWAIT		004000'	EXT	FECSJ%		000022	SIN
ACRPTR		003377'		CPOPJ		003364'	EXT	FD2ABS		003133'		FEERR		003573'	
ACTWRT		001543'	EXT	CPOPJ1		004036'	EXT	FD2CHL		003122'		FEERS		003534'	
ADCHLD		002724'		CPRRDW		000003	SIN	FD2FNO		003102'	INT	FEFHE		003556'	INT
ADRDUM		003672'	EXT	CPRRED		000001	SIN	FD2FRH		003140'		FEFHE%		000023	SIN
ADRNCT		000442'	EXT	CPUKI		000001	SPD	FD2J		003070'	INT	FEFHU		003557'	INT
AGENTV		000317'	EXT	CPUKL		000002	SPD	FD2J1		003077'		FEFHU%		000024	SIN
ALLMFR		003511'	INT	CPUTYP		000002	SPD	FD2PAR		003116'		FEILC		003572'	INT
ARCHE1		003263'		CPZZ		000001	SPD	FD2SLF		003131'		FEILC%		000037	SIN
ARCHEK		003256'		CRESPC		000564'		FD2TAB		003104'		FEIOE		003552'	INT
ATBDUM		000247'	EXT	CTXCEX		200000	SIN	FD2WL1		003055'	INT	FEIOE%		000017	SIN
ATBMWC		000266'	EXT	CTXTAB		000443'	EXT	FD2WLK		003053'	INT	FENCH		003542'	INT
ATBSTS		000000	EXT	CURUPT		003721'	EXT	FDDMSK		077777	SIN	FENCH%		000007	SIN
ATBUMC		000000	EXT	DABBIT		000337'	EXT	FDDSP		003352'		FENFH		003560'	INT
ATPDUM		000246'	EXT	DATE		000634'	EXT	FDRUPX		003042'	INT	FENFH%		000025	SIN
ATPMXU		003646'	EXT	DDBLDB		001425'	EXT	FDWUPX		003042'	INT	FENLC		003540'	INT
AUNTAB		003503'		DECHJB		000456'	EXT	FEADB		003551'	INT	FENLC%		000005	SIN
BADQUE		000624'	EXT	DELAYN		001366'	EXT	FEADB%		000016	SIN	FENOH		003534'	INT
BITTBL		003157'	EXT	DIE		000000'	EXT	FEALH		003554'	INT	FENOH%		000001	SIN
CF.BAT	000010	000000	SPD	EPLLEN		000000	EXT	FEALH%		000021	SIN	FENPR		003545'	INT
CF.BBJ	000020	000000	SPD	EX0ACB		000001	SIN	FEALR		003553'	INT	FENPR%		000012	SIN
CF.LIC	000002	000000	SPD	EXCFLG		000400	SIN	FEALR%		000020	SIN	FENRT		003536'	INT
CF.LOG	000001	000000	SPD	EXOMFR		003505'	INT	FEBAR		003544'	INT	FENRT%		000003	SIN
CF.OLD	400000	000000	SPD	F		000004	INT	FEBAR%		000011	SIN	FERNE		003571'	INT
CF.PLI	000004	000000	SPD	FA.RD		000001	SPD	FEBCN		003561'	INT	FERNE%		000036	SIN
CFHABT		001743'		FA.WR		000002	SPD	FEBCN%		000026	SIN	FEUND		003541'	INT
CHEABS		003241'		FARARL		000011	SPD	FEBDF		003537'	INT	FEUND%		000006	SIN
CHECHL		003235'		FARARR		000017	SPD	FEBDF%		000004	SIN	FEWADB		003612'	INT
CHEFR1		003221'		FARARS		000007	SPD	FEBDH		003547'	INT	FEWALH		003615'	INT
CHEFRH		003174'		FARARY		001654'		FEBDH%		000014	SIN	FEWALR		003614'	INT
CHEKAR		003153'	INT	FARCHK		003063'	INT	FEBDI		003535'	INT	FEWBAR		003605'	INT
CHEKTB		003162'		FARLCL		000003	SPD	FEBDI%		000002	SIN	FEWBCN		003622'	INT
CHEPAR		003224'		FARLCR		000003	SPD	FEBFD		003546'	INT	FEWBDF		003600'	INT
CHGNAM		000357'	EXT	FARLCS		000001	SPD	FEBFD%		000013	SIN	FEWBDH		003610'	INT
CHGVFY		000002	SPD	FARLCY		001652'		FEBFN		003550'	INT	FEWBDI		003576'	INT
CHKHDL		002102'		FARSIZ		000001	SIN	FEBFN%		000015	SIN	FEWBFD		003607'	INT
CHKJL		001662'		FAWARL		000011	SPD	FEBHT		003563'	INT	FEWBFN		003611'	INT
CHPJC		001504'	INT	FAWARR		000030	SPD	FEBHT%		000030	SIN	FEWBHT		003624'	INT
CHPJC2		001522'		FAWARS		000020	SPD	FEBSV		003565'	INT	FEWBSV		003626'	INT
CHPJC3		001531'		FAWARY		001655'		FEBSV%		000032	SIN	FEWBTN		003623'	INT
CHRCHL		002223'		FAWLCL		000003	SPD	FEBTN		003562'	INT	FEWCCF		003630'	INT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 76-2
FRMSER.MAC	 8-DEC-87 16:09		SYMBOL TABLE

FEWCCH		003625'	INT	FRATER		001644'		FRMHLT		001347'		GETFMU		003746'	EXT
FEWCII		003627'	INT	FRATGO		001627'		FRMHST		001445'		GETFRM		001245'	EXT
FEWCJF		003631'	INT	FRATJL		000001	SPD	FRMJM0		001073'		GETLOK		000001	SPD
FEWCLP		003604'	INT	FRJBSV		001165'		FRMJMP		001047'		GETPAG		000607'	EXT
FEWCSJ		003616'	INT	FRJCTS		001103'		FRMKJF		000452'	INT	GETWDS		001714'	EXT
FEWERR		003634'		FRJNRN		001174'		FRMLIT		003637'	INT	GIVWDS		002134'	EXT
FEWERS		003575'		FRJSL1		001226'		FRMNCP		000450'		GNUARG		001305'	EXT
FEWFHE		003617'	INT	FRJSLO		001201'		FRMNPR		002720'		GNUARX		001271'	EXT
FEWFHU		003620'	INT	FRJSTS		001073'		FRMNR1		000437'		GRSPAT		001264'	INT
FEWILC		003633'	INT	FRJUVC		001152'		FRMNR2		000446'		GRSSLF		001303'	
FEWIOE		003613'	INT	FRJVEC		001132'		FRMNRD		000434'		GRSTAB		001245'	
FEWNCH		003603'	INT	FRJVGO		001150'		FRMOP	044000	000000		HIGHJB		000644'	EXT
FEWNFH		003621'	INT	FRMARD		002312'		FRMOPD		000003'	INT	HSLIC		000000	EXT
FEWNLC		003601'	INT	FRMAS1		000611'		FRMOTB		000022'		INADEF		000370'	EXT
FEWNOH		003575'	INT	FRMAS2		000627'		FRMOTL		000024	SPD	INIARB		003270'	INT
FEWNPR		003606'	INT	FRMASN		000610'	INT	FRMPRJ		001500'		IO		000020	SIN
FEWNRT		003577'	INT	FRMCAR		002500'		FRMRAR		002326'		IPOPJ		003017'	EXT
FEWRNE		003632'	INT	FRMCER		002501'		FRMREP		000000	EXT	IPOPJ1		003007'	EXT
FEWUND		003602'	INT	FRMCF1		001706'		FRMRER		002327'		ISCHL0		003004'	
FHIMAX		003175'	EXT	FRMCF2		001707'		FRMRFA		001551'		ISCHL1		003006'	
FHIN		000000	EXT	FRMCF3		001713'		FRMRM1		002554'		ISCHLD		003002'	
FHSMXC		001447'	EXT	FRMCFE		001735'		FRMRM2		002564'		ISSIBL		003014'	
FILAB0		002075'		FRMCFH		001667'		FRMRMA		002540'		J		000002	INT
FILABS		002072'		FRMCHR		002153'		FRMRMR		002537'		JACCT		000001	SIN
FILCHL		002054'		FRMCLR		001235'		FRMRP1		001476'		JACCT2		100000	SIN
FILFH0		002017'		FRMCO0		001437'		FRMRPC		001461'		JALTAB		003501'	
FILFH1		002023'		FRMCON		001434'		FRMRSI		002302'		JBTABT		001731'	EXT
FILFRH		001770'		FRMCR0		000215'		FRMRUN		001252'		JBTAUN		003310'	EXT
FILLFH		001751'		FRMCR2		000243'		FRMRVA		000652'	INT	JBTCTX		000400'	EXT
FILLTB		001756'		FRMCR4		000251'		FRMRVM		000676'		JBTFNT		000132'	EXT
FILPAR		002030'		FRMCR6		000373'		FRMSAA		000742'		JBTFTR		004055'	EXT
FILSL0		002052'		FRMCRE		000205'	INT	FRMSAV		001254'		JBTLIC		003316'	EXT
FILSLF		002043'		FRMCRX		000425'		FRMSER		000000'	ENT	JBTMFR		004067'	EXT
FINAS1		000152'		FRMCSI		000161'	INT	FRMSMF		002137'		JBTNAM		001275'	EXT
FINAS2		000156'		FRMCTP		000331'		FRMSSA		001255'		JBTNM1		000347'	EXT
FINASS		000133'	INT	FRMDFH		002112'		FRMSTP		001375'		JBTNM2		000350'	EXT
FJ.VEC		000001	SIN	FRMDFR		002117'		FRMSTR		001007'		JBTP2S		004066'	EXT
FNDOF1		003375'		FRMDIS		001330'		FRMSV1		001000'		JBTPNO		003712'	EXT
FNDOFS		003362'		FRMDSN		000646'	INT	FRMSVA		000755'		JBTPNT		002774'	EXT
FNTBYP		000121'	INT	FRMEN1		001325'		FRMVCH		002237'		JBTPPN		000000	EXT
FNTRNM		000012	SIN	FRMENA		001313'		FRMVCL		000000	EXT	JBTPRG		000360'	EXT
FOEBFN		000017'		FRMEND		004124'	INT	FRMVRM		000000	EXT	JBTPRV		003305'	EXT
FRABCN		001640'		FRMFA		001552'		FRMWFA		001545'		JBTS2P		004065'	EXT
FRABTN		001641'		FRMFRC		001412'		FRMWVA		000663'	INT	JBTSLC		003753'	EXT
FRACTX		001624'		FRMGET		001251'		FRMWVM		000704'		JBTSPN		003230'	EXT
FRADSP		001650'		FRMGF1		002700'		FRMXFA		001547'		JBTST2		000231'	EXT
FRAGAR		001617'		FRMGFT		002655'		FRMXVE		000736'		JBTSTS		002707'	EXT
FRALST		001566'		FRMGIN		001230'		FRMXVM		000706'		JBTUID		003210'	EXT
FRANLC		001642'		FRMGNP		002704'		FRSNUM		001023'		JBTUN1		000000	EXT
FRANX1		001574'		FRMGRS		001256'		FRSST1		001014'		JBTUNM		000000	EXT
FRANXT		001573'		FRMGTP		000604'		FRVERR		000674'		JBTUPM		003720'	EXT
FRAPTR		001660'		FRMGVP		000441'	EXT	FRVIOE		000734'		JBYECF		000122'	INT
FRATAB		001656'		FRMHLN		001373'		FRVOK		000154'		JBYIN2		000371'	EXT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 76-3
FRMSER.MAC	 8-DEC-87 16:09		SYMBOL TABLE

JBYINA		000372'	EXT	LOGLDB		000467'	INT	PVDINA		000400	SIN	STOP1		001232'	EXT
JBYLCF		000121'	INT	LOGTAB		000355'	EXT	PVLOS		400000	SIN	STRBTS		000000	EXT
JBYMWS		000244'	EXT	LOGTOP		000011	SIN	PVTYMP		040000	SIN	STRDDB		000000	EXT
JBYNIC		000123'	INT	LOGTP0		000566'		PVYCOR		000642'	EXT	STRTAD		001036'	EXT
JBYQNT		001122'	EXT	LOGTP1		000572'		PX.MEM		000004	SPD	STRTCL		001040'	EXT
JBYSIA		000132'	INT	LOGTP2		000573'		PX.SRC		000001	SPD	STVSET		000116'	INT
JBYSIC		000130'	INT	LSLIC		000000	EXT	PXCT	256000	000000		SWAPIN	414000	000000	
JBYSIP		000127'	INT	M		000013	INT	RBREAL		000440'	EXT	SWPINP		002000	SIN
JBYSIS		000131'	INT	M2UACE		003523'		RCATAB		003473'		SWRUPX		003021'	INT
JBYUWS		000326'	EXT	M2UACT		003515'		RCHTAB		002156'		SYSTAB		003475'	
JDCON		020000	SIN	MAPUPX		000473'	EXT	RDXMFR		003507'	INT	SYSUID		000637'	EXT
JDSVCL		000001		MAXLIC		001324'	EXT	RELSAT		000445'	EXT	T1		000006	INT
JDSVCO		000004		MBIT		000255'	EXT	REQUE		001123'	EXT	T2		000007	INT
JDSVLN		000005		MFRCHK		003252'		RESFR1		002127'		T3		000010	INT
JDSVTB		000773'		MONJBX		001302'	EXT	RESFR2		002135'		T4		000011	INT
JERR		020000	SIN	MRQ		100000	SIN	RESFRH		002126'	INT	TAKTRP		002742'	EXT
JLOG		000004	SIN	MXFRAT		000001	SPD	RNQ		000422'	EXT	TIMEF		001077'	EXT
JNA		040000	SIN	NBJFCE		000432'		RSIMAX		000010	SPD	TIOWQ		001471'	EXT
JOB		001265'	EXT	NCTXPG		000271'	EXT	RSITAB		002315'		TKCHL1		002752'	
JOBATB		000264'	EXT	NOAR		000777	SPD	RUN		400000	SIN	TKCHL2		002761'	
JOBMAX		003242'	EXT	NODIE		000000	EXT	RUNABL		440000	SIN	TKCHL3		002763'	
JRQ		000002	SIN	NOLIC		000000	SPD	RUNFMU		003747'	EXT	TKCHLD		002732'	INT
JS.BAT		400000	SIN	NOPRN1		002773'		RUNFRM		001246'	EXT	TPOPJ		002011'	EXT
JS.BBJ		001000	SIN	NOPRNT		002767'	INT	RUNMSK		000405	SIN	TRHALT		001374'	EXT
JSCLR		000651'		NOSHR		001263'	EXT	RXRABS		002465'		TTYHLT		001430'	EXT
JSTCTX		040000	SIN	NULMFR		003513'	INT	RXRCHL		002446'		TTYKIL		000455'	EXT
KJP		000100	SIN	NULQ		000617'	EXT	RXRFR1		002405'		TTYNFR		000222'	EXT
LASZZ		000025	SPD	OTFFLG		200000	SIN	RXRFRH		002357'		TTYTAB		001424'	EXT
LDBLOG		000500'	EXT	P		000001	INT	RXRPAR		002425'		TYPTAB		003477'	
LG.LAB	400000	000000	SPD	P1		000014	INT	RXRSLF		002412'		U		000005	INT
LG.LUB	100000	000000	SPD	P2		000015	INT	RXRTAB		002345'		U2MACE		003532'	
LICHR		000040	SIN	P3		000016	INT	S		000000	INT	U2MACT		003525'	INT
LICJAL		001000	SIN	P4		000017	INT	S$ENTR	777777	777775	SIN	ULDUPX		003734'	EXT
LICMSK		001337'	EXT	PAG		000010	SPD	S$HALT	777777	777777	SIN	UP4LDA		000334'	EXT
LICRFL		000010	SIN	PBMMSK		000313'	EXT	S$NAME		000000'	SPD	UPNPSR		000000	EXT
LICRMT		002000	SIN	PC.PUB		002000	SIN	S$NONA		000000	SIN	UPSPSR		000000	EXT
LICRPJ		000004	SIN	PC.USR		010000	SIN	S$TEMP		000000	SPD	UPT		000000	EXT
LICSPY		200000	SIN	PG		000003	INT	S$XCT	777777	777776	SIN	UPTACP		000000	EXT
LICSYS		040000	SIN	PJBSTS		001470'	EXT	SAVE1		002605'	EXT	UPTEND		000000	EXT
LICWCR		400000	SIN	PJCSET		000001	SPD	SAVFMU		003751'	EXT	UPTFHT		000000	EXT
LICWFL		000002	SIN	PJCVFY		000001	SPD	SAVFRM		001250'	EXT	UPTFSL		000600	SIN
LICWPJ		000001	SIN	PJRST	324740	000000		SETAR1		002636'		UPTHEC		000504	SIN
LICXC		000200	SIN	PRVMSK		000577'	EXT	SETARN		002604'		UPTHMC		000506	SIN
LIMMAX		200000	SIN	PSHAR0		000514'		SETHDL		002574'		UPTHST		000000	EXT
LM3ATB		000340'	EXT	PSHAR1		000517'		SETLMX		000341'	EXT	UPTIME		000622'	EXT
LM3HDA		000336'	EXT	PSHAR2		000524'		SETMAX		002643'		UPTJOB		000000	EXT
LMASRP		000000	EXT	PSHAR3		000537'		SETRUN		001444'	EXT	UPTLEC		000505	SIN
LMMERR		000725'	EXT	PSHARG		000504'		SG3		001307'	EXT	UPTLMC		000507	SIN
LMPCUR		000000	EXT	PSHARZ		000013	SPD	SLPQ		001472'	EXT	UPTLOG		000000	EXT
LMPMXW		000000	EXT	PSHERR		000560'		SRDUPX		003021'	INT	UPTMFR		000000	EXT
LMPNER		000717'	EXT	PSHPRV		000575'		SRPNDS		000604'	EXT	UPTNTV		000000	EXT
LOFS	777777	777762	SPD	PVACTS		020000	SIN	STARCL		001037'	EXT	UPTOFD		000000	EXT
LOGLD1		000475'		PVDINA		000400	SIN	STARDI		003741'	EXT	UPTP2S		000000	EXT
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88 PAGE 76-4
FRMSER.MAC	 8-DEC-87 16:09		SYMBOL TABLE

UPTPBM		000000	EXT	.ARVAR		000050	SIN	.FOVCL		000011	SIN	
UPTPC		000000	EXT	.ARVAW		000051	SIN	.FOVRM		000010	SIN	
UPTPDL		000000	EXT	.ARWAC		000047	SIN	.FOWFA		000037	SIN	
UPTPID		000000	EXT	.FDFAM		100000	SIN	.FOWVA		000003	SIN	
UPTPJ2		000000	EXT	.FDFRH		300000	SIN	.FOXFA		000040	SIN	
UPTPJC		000000	EXT	.FDOTF		200000	SIN	.IAECF		000001	SPD	
UPTRNM		000000	EXT	.FDSLF		700000	SIN	.IALCF		000000	SPD	
UPTRPN		000000	EXT	.FHART		000003	SIN	.IANIC		000002	SPD	
UPTS2P		000000	EXT	.FHFNO		000000	SIN	.IASIA		000011	SPD	
UPTSPD		000000	EXT	.FHFRM		000000	SIN	.IASIC		000007	SPD	
UPTSTS		000000	EXT	.FHLIC		000002	SIN	.IASIP		000006	SPD	
UPTSTV		000000	EXT	.FHMAX		000002	SIN	.IASIS		000010	SPD	
UPTUAC		000000	EXT	.FHPNO		000002	SIN	.JBDDT		000776'	EXT	
UPTXAC		000000	EXT	.FHPRC		000001	SIN	.JBREN		000775'	EXT	
USCHED		001234'	EXT	.FHSIZ		000005	SIN	.JBSA		000774'	EXT	
USRACB		000000	SIN	.FHTYP		000000	SIN	.UAMAX		000032	SPD	
USRXIT		001173'	EXT	.FHUID		000001	SIN	.UAWMX		000001	SIN	
UTRP		040000	SIN	.FMCHL		000000	SIN	
UXYPSR		001044'	EXT	.FMMAX		010000	SIN	
UXYUWL		000323'	EXT	.FOCAR		000030	SIN	
UXYUWM		000322'	EXT	.FOCER		000031	SIN	
VCLEAR	047000	777712		.FOCFH		000012	SIN	
VPROT	047000	777710		.FOCFM		000001	SIN	
W		000012	INT	.FOCHR		000021	SIN	
WAKFLG		200000	SIN	.FOCLR		000014	SIN	
WCATAB		003471'		.FOCON		000025	SIN	
WLKUPX		003055'	EXT	.FOCSI		000044	SIN	
WRTACR		000421'	EXT	.FODFH		000013	SIN	
WRUBR	701140	000000		.FODIS		000046	SIN	
ZZ	005557	664555	SPD	.FOENA		000045	SIN	
%COW		000724'	EXT	.FOFRC		000042	SIN	
%COW.N		000000	EXT	.FOGET		000032	SIN	
%UPLMA		000000	EXT	.FOGFT		000024	SIN	
%UPT		000206'	EXT	.FOGIN		000026	SIN	
%UPT.N		000000	EXT	.FOHLT		000005	SIN	
%UPX		003650'	EXT	.FOHST		000023	SIN	
%UPX.N		000000	EXT	.FOJMP		000000	SIN	
.ARCLR		000055	SIN	.FOPRJ		000043	SIN	
.ARGVC		000013	SIN	.FORAR		000016	SIN	
.ARGVP		000012	SIN	.FOREP		000007	SIN	
.ARHLT		000052	SIN	.FORER		000017	SIN	
.ARMAX		000061	SIN	.FORFA		000036	SIN	
.ARPLC		000014	SIN	.FORPC		000006	SIN	
.ARRAC		000046	SIN	.FORSI		000015	SIN	
.ARRDS		000003	SIN	.FORUN		000033	SIN	
.ARRFI		000005	SIN	.FORVA		000002	SIN	
.ARRUN		000002	SIN	.FOSAA		000004	SIN	
.ARSAA		000001	SIN	.FOSAV		000034	SIN	
.ARSIZ		000001	SIN	.FOSMF		000020	SIN	
.ARSMF		000060	SIN	.FOSSA		000035	SIN	
.ARSTP		000053	SIN	.FOSTP		000041	SIN	

FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

ABKSET	  1080%	  1152
ABSAC0	  3321	  3324	  3327#
ABSAC1	  3333#	  3349
ABSACC	  2132	  2570	  3230	  3310#
ABSAUN	  3302#	  3306	  3320	  3341
ABSGAN	  3303#	  3306	  3325
ABSNZA	  3304#	  3306	  3348	  3352
ACRDS1	  3451	  3465#
ACRDSS	  3463	  3475#
ACRDST	  3442#
ACRNXW	  3428	  3495#
ACRPT0	  3428#	  3435	  3454
ACRPT2	  3434	  3437#
ACRPTR	  2337	  2647	  2731	  3423#	  3426	  3495
ACTWRT	  1672%	  1672
ADCHLD	   559	  2835	  2847#
ADRDUM	   780%	   780
ADRNCT	   619%	   619
AGENTV	   363%	   485
ALLMFR	   563	   566	   568	  2411	  2520	  2763	  3282	  3285	  3287	  3552#
ARCHE1	  3268	  3273#
ARCHEK	  3209	  3223	  3250	  3268#
ATBDUM	   363%	   431	   456	   459
ATBMWC	   363%	   455
ATBSTS	   363%	   456	   459
ATBUMC	   363%	   456	   459
ATPDUM	   363%	   430	   457
ATPMXU	   363%	   457
AUNTAB	  2415	  3342	  3537#
BADQUE	   802%	   802	   804	   805
BITTBL	  3144%	  3153
CF.BAT	   377#	   392	   407	   737
CF.BBJ	   378#	   392	   407	   410	   737
CF.LIC	   375#	   734	   738
CF.LOG	   374#	   413
CF.OLD	   373#
CF.PLI	   376#	   413	   416	   716
CFHABT	  1985	  2009#
CHEABS	  3160	  3227#
CHECHL	  3168	  3222#
CHEFR1	  3189	  3195#
CHEFRH	  3163	  3173#
CHEKAR	  2830	  3037	  3053	  3149#
CHEKTB	  3154	  3160#
CHEPAR	  3169	  3207#
CHGNAM	   539%	   539
CHGVFY	  1622#	  1664
CHKHDL	  2052	  2086	  2099	  2111	  2128	  2147#
CHKJL	  1848	  1903#
CHPJC	  1634	  1635#
CHPJC2	  1645	  1651#
CHPJC3	  1653	  1659#
CHRCHL	  2229	  2267#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

CHRFRH	  2224	  2233#
CHRPAR	  2230	  2252#
CLRFRM	  1271%	  1271
CLRJBT	   369%	   636	   812
CMFCHT	  1463%	  1463
CMFCXN	   420%	   420
CMFIDX	  1482%	  1482
CMPARN	  2308	  2329#
CMWB	   794	  1214
CNTFRM	    97	   207#
CNTRLC	  1440
CNVVPN	   466	   502	   505	   570	   903	   904	   912	   919	   921
COMWCM	   421%	   421	  1464%	  1464	  1490%	  1490
CPOPJ	   325	   797	  2876	  2910%	  2913	  2919	  3395%	  3399
CPOPJ1	   223	   278	   327	   363%	   597	   767	   827	   875	   885	   896	   924	  1391	  1409	  1442
	  1465%	  1465	  1491%	  1491	  1557	  1588	  1649	  1673	  1820	  1998	  2071	  2081	  2151	  2154
	  2206	  2244	  2247	  2261	  2263	  2278	  2314	  2331	  2338	  2390	  2483	  2486	  2489	  2513
	  2516	  2519	  2526	  2529	  2533	  2546	  2549	  2552	  2564	  2567	  2569	  2619	  2622	  2625
	  2648	  2733	  2771	  2836	  3036	  3039	  3055	  3096	  3104	  3107	  3113	  3127	  3146%	  3167
	  3184	  3193	  3235	  3252	  3382
CPRRDW	   466	   504	   904
CPRRED	   570	   903
CPUKI	  1143	  1149
CPUKL	   471
CPUTYP	   471	  1143	  1149
CPZZ	   471#	   471	  1143#	  1143	  1149#	  1149
CRESPC	   417	   706	   707	   723	   750#	   759
CTXCEX	   462
CTXTAB	   364%	   441	   505	   616	   620
CURUPT	  1080%	  1143	  1149
DABBIT	   364%	   510
DATE	   814%	   814
DDBLDB	  1460%	  1460	  1485%	  1485
DECHJB	   364%	   638
DELAYN	  1421%	  1438
DIE	    12	    12%	    13
EPLLEN	  1080%	  1205	  1259
EX0ACB	  1204
EXCFLG	   841
EXOMFR	  2409	  3542#
F	   392	   394	   396	   695	   696	   703	   716	   719	   734	   737	   738	  1459	  1460	  1484
	  1485	  1733	  1734	  1791	  1803	  2337	  2647	  2731	  3424	  3494
FA.RD	  1721#	  1726	  1728	  1814
FA.WR	  1722#	  1724	  1726	  1758	  1779	  1816
FARARL	  1870#	  1871	  1872	  1875
FARARR	  1871#	  1872	  1874	  1887
FARARS	  1869#	  1871
FARARY	  1778	  1872#
FARCHK	  1801	  2799	  2807	  3051#
FARLCL	  1860#	  1861	  1862	  1865
FARLCR	  1861#	  1862	  1864	  1887
FARLCS	  1859#	  1861
FARLCY	  1757	  1862#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

FARSIZ	  2076	  3327	  3350	  3351	  3353	  3355	  3356	  3358	  3359	  3555
FAWARL	  1875#	  1876	  1877
FAWARR	  1876#	  1877	  1887
FAWARS	  1874#	  1876
FAWARY	  1780	  1877#
FAWLCL	  1865#	  1866	  1867
FAWLCR	  1866#	  1867	  1869	  1887
FAWLCS	  1864#	  1866
FAWLCY	  1759	  1867#
FCEBDA	   391	   645#
FCEFCE	   603	   644#
FCEJSP	   643	   644	   645	   646	   647	   648#
FCENBJ	   607	   647#
FCENCP	   629	   646#
FCENRD	   623	   643#
FCETAB	   642#	   648
FCREQ	  1954%	  1978	  1980
FCRFCE	   398	   602#
FCWAIT	  1954%	  1979
FD2ABS	  3082	  3109#
FD2CHL	  3090	  3098#
FD2FNO	   268	   309	  1730	  2252	  2822	  3032	  3051	  3070	  3079#
FD2FRH	  3085	  3117#
FD2J	  3066#
FD2J1	  3072	  3074#
FD2PAR	  3091	  3093#
FD2SLF	  3089	  3106#
FD2TAB	  3079	  3082#
FD2WL1	  1227	  3034#
FD2WLK	  2981	  3008	  3032#
FDDMSK	  2234	  2479	  3099	  3110	  3118	  3173	  3227
FDDSP	  2033	  2219	  2458	  3080	  3155	  3370#	  3373
FDRUPX	  1379	  1395	  1551	  1573	  2197	  2269	  2454	  2608	  3007#
FDWUPX	   871	   881	   961	   983	  1267	  1318	  1424	  1454	  1475	  1511	  1640	  1809	  1961	  2300
	  3006#
FEADB	  3709#
FEADB%	   931	  3709#
FEALH	  3712#
FEALH%	  3712#
FEALR	  3711#
FEALR%	  3711#
FEBAR	  3150	  3704#
FEBAR%	  3704#
FEBCN	  2334	  2728	  3717#
FEBCN%	  1828	  3717#
FEBDF	  3101	  3112	  3229	  3699#
FEBDF%	  3699#
FEBDH	  3120	  3175	  3707#
FEBDH%	  3707#
FEBDI	  3126	  3187	  3697#
FEBDI%	  3697#
FEBFD	  3377	  3706#
FEBFD%	  3706#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

FEBFN	  3708#
FEBFN%	   107	  3708#
FEBHT	  2149	  3197	  3719#
FEBHT%	  3719#
FEBSV	  3721#
FEBSV%	  1206	  3721#
FEBTN	  3718#
FEBTN%	  1832	  3718#
FECCF	  3723#
FECCF%	  3723#
FECCH	  2153	  3720#
FECCH%	  3720#
FECII	  3722#
FECII%	  3722#
FECJF	  3724#
FECJF%	  3724#
FECLP	  3035	  3703#
FECLP%	  3703#
FECSJ	  3713#
FECSJ%	  3713#
FEERR	  3696	  3697	  3698	  3699	  3700	  3701	  3702	  3703	  3704	  3705	  3706	  3707	  3708	  3709
	  3710	  3711	  3712	  3713	  3714	  3715	  3716	  3717	  3718	  3719	  3720	  3721	  3722	  3723
	  3724	  3725	  3726	  3727#
FEERS	  3694#	  3727
FEFHE	  3714#
FEFHE%	  3714#
FEFHU	  3715#
FEFHU%	  3715#
FEILC	  3726#
FEILC%	  3726#
FEIOE	  3710#
FEIOE%	   926	  3710#
FENCH	  3103	  3702#
FENCH%	  3702#
FENFH	  3716#
FENFH%	  3716#
FENLC	  2133	  3231	  3700#
FENLC%	  1837	  1906	  3700#
FENOH	  3122	  3177	  3696#
FENOH%	  3696#
FENPR	  3095	  3705#
FENPR%	  3705#
FENRT	  2732	  3181	  3192	  3210	  3224	  3234	  3251	  3698#
FENRT%	  3698#
FERNE	  2351	  3725#
FERNE%	  3725#
FEUND	  3086	  3087	  3088	  3164	  3165	  3166	  3701#
FEUND%	  3701#
FEWADB	  3747#
FEWALH	  1427	  3750#
FEWALR	  1023	  1213	  1270	  1329	  1478	  1517	  3749#
FEWBAR	  3742#
FEWBCN	   263	  1331	  1344	  1547	  1549	  2450	  2604	  3755#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

FEWBDF	   281	  2803	  2811	  2826	  3737#
FEWBDH	  1085	  1967	  2168	  3745#
FEWBDI	  1091	  3735#
FEWBFD	  3744#
FEWBFN	  3746#
FEWBHT	  2221	  2228	  2504	  3757#
FEWBSV	   990	  1009	  1012	  3759#
FEWBTN	   266	  2384	  3756#
FEWCCF	  1519	  3761#
FEWCCH	  3758#
FEWCII	  2815	  3760#
FEWCJF	  1151	  1216	  1232	  3762#
FEWCLP	  3741#
FEWCSJ	  1430	  1458	  3751#
FEWERR	  3734	  3735	  3736	  3737	  3738	  3739	  3740	  3741	  3742	  3743	  3744	  3745	  3746	  3747
	  3748	  3749	  3750	  3751	  3752	  3753	  3754	  3755	  3756	  3757	  3758	  3759	  3760	  3761
	  3762	  3763	  3764	  3765#
FEWERS	  3733#	  3765
FEWFHE	  1959	  2166	  3752#
FEWFHU	  1969	  3753#
FEWILC	  1483	  3764#
FEWIOE	  3748#
FEWNCH	   274	  2303	  2611	  3740#
FEWNFH	  1974	  3754#
FEWNLC	  1657	  3738#
FEWNOH	  1087	  2171	  3734#
FEWNPR	  3743#
FEWNRT	  1098	  1104	  1107	  2248	  3736#
FEWRNE	  3763#
FEWUND	  2225	  2226	  2227	  2464	  2465	  2466	  3739#
FHIMAX	  1084	  1966	  2167	  3119	  3146%	  3174
FHIN	  1954%	  1971	  2180
FHSMXC	  1544%	  1548
FILAB0	  2057	  2089	  2102	  2114	  2130#
FILABS	  2035	  2127#
FILCHL	  2043	  2110#
FILFH0	  2073#	  2123
FILFH1	  2077#	  2080
FILFRH	  2038	  2049#
FILLFH	  1992	  2029#
FILLTB	  2032	  2035#
FILPAR	  2044	  2085#
FILSL0	  2105#
FILSLF	  2042	  2098#
FINAS1	   275#	   282
FINAS2	   272	   280#
FINASS	   260#
FJ.VEC	  1071#	  1102	  1162	  1223	  1239
FNDOF1	  3406	  3409#
FNDOFS	  3397#	  3408	  3410
FNTBYP	   237#	   239	   241	   243	   248	   250	   252	   254	   257	   270	   275	   276	   321
FNTRNM	   257#	   265
FOEBFN	   100	   107#	   166	   168	   170	   172	   174	   176	   178	   180	   182	   184	   186	   188
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

	   190	   192	   194	   196	   198	   200	   202	   204
FRABCN	  1748	  1750	  1828#
FRABTN	  1753	  1832#
FRACTX	  1786	  1796	  1809#
FRADSP	  1760	  1847#
FRAGAR	  1782	  1796#
FRALST	  1738	  1746#
FRANLC	  1761	  1836#
FRANX1	  1742	  1752#
FRANXT	  1751#	  1819
FRAPTR	  1812	  1817	  1894#
FRATAB	  1785	  1862	  1867	  1872	  1877	  1886#	  1889
FRATER	  1732	  1802	  1810	  1841#
FRATGO	  1792	  1804	  1812#
FRATJL	  1852#	  1887
FRJBSV	  1176	  1188	  1191	  1203#
FRJCTS	  1129#	  1203
FRJNRN	  1117	  1212#
FRJSL1	  1242	  1245#
FRJSLO	  1120	  1221#
FRJSTS	  1108	  1114#
FRJUVC	  1170	  1187#
FRJVEC	  1163	  1169#
FRJVGO	  1174	  1183#
FRMARD	  2381	  2388#
FRMAS1	   794#	   806
FRMAS2	   801	   809#
FRMASN	   397	   793#
FRMCAR	   190	  2598#
FRMCER	   191	  2599#
FRMCF1	  1965	  1971#
FRMCF2	  1972#	  1973
FRMCF3	  1970	  1976#	  1981
FRMCFE	  1993	  2002#
FRMCFH	   176	  1956#
FRMCHR	   183	  2217#
FRMCLR	   178	  1266#
FRMCO0	   992	  1516#
FRMCON	   187	  1510#
FRMCR0	   393	   396#
FRMCR2	   414	   425#
FRMCR4	   434#	   444
FRMCR6	   545	   551#
FRMCRE	   167	   388#
FRMCRX	   586	   595#
FRMCSI	   202	   308#
FRMCTP	   504#	   513
FRMDFH	   177	  2164#
FRMDFR	  2169#
FRMDIS	   204	  1394#
FRMDSN	   837#
FRMEN1	  1384	  1389#	  1400
FRMENA	   203	  1378#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

FRMEND	  3943#
FRMFA	  1725	  1727	  1729#
FRMFRC	   200	  1474#
FRMGET	   192	  1311#
FRMGF1	  2814#	  2817
FRMGFT	   186	  2794#
FRMGIN	   188	  1258#
FRMGNP	  2796	  2821#
FRMGRS	  1313	  1317#
FRMGTP	   439	   778#
FRMGVP	   618%	   618	   784%
FRMHLN	  1434	  1439	  1444#
FRMHLT	   171	  1423#
FRMHST	   185	  1546#
FRMJM0	  1105	  1108#
FRMJMP	    98	   166	  1082#
FRMKJF	   624	   634#
FRMLIT	  3769#
FRMNCP	   402	   628#
FRMNPR	  2828	  2833#
FRMNR1	   616#	   621
FRMNR2	   615	   623#
FRMNRD	   440	   613#
FRMOPD	    94#
FRMOTB	   103	   104	   165#	   205
FRMOTL	    99	   205#	   207
FRMPRJ	   201	  1625#
FRMRAR	   180	  2443#
FRMREP	   173	   291%
FRMRER	   181	  2445#
FRMRFA	   196	  1728#
FRMRM1	  2654	  2657#
FRMRM2	  2649	  2666#
FRMRMA	  2501	  2558	  2643#
FRMRMR	  2386	  2493	  2496	  2507	  2521	  2536	  2540	  2555	  2572	  2628	  2631	  2642#
FRMRP1	  1577	  1587#
FRMRPC	   172	  1572#
FRMRSI	   179	  2380#
FRMRUN	   193	  1312#
FRMRVA	   168	   867#
FRMRVM	   869	   891#
FRMSAA	   170	   956#
FRMSAV	   194	  1314#
FRMSER	    12	    13#	    16
FRMSMF	   182	  2195#
FRMSSA	   195	  1315#
FRMSTP	   199	  1453#
FRMSTR	   967	   994	  1015	  1022#
FRMSV1	   986	  1008#
FRMSVA	   184	   981#
FRMVCH	   189	  2298#
FRMVCL	   175	   291%
FRMVRM	   174	   291%
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

FRMWFA	   197	  1724#
FRMWVA	   169	   877#
FRMWVM	   879	   898#
FRMXFA	   198	  1726#
FRMXVE	   910	   929#
FRMXVM	   893	   902#
FRSNUM	  1026	  1039#
FRSST1	  1027#	  1041	  1045
FRVERR	   269	   310	   872	   882	   887#	   894	   927	   930	   932	   962	   984	  1228	  1246	  1268
	  1319	  1380	  1396	  1425	  1455	  1476	  1512	  1552	  1574	  1641	  1962	  2007	  2198	  2205
	  2243	  2253	  2260	  2270	  2277	  2301	  2309	  2455	  2609	  2800	  2808	  2823	  2831
FRVIOE	   920	   926#
FRVOK	   277#
GETFMU	  1298%	  1348
GETFRM	  1298%	  1306
GETLOK	  1857#	  1887
GETPAG	   782%	   782
GETWDS	  1954%	  1977
GINST	    94#	    94	    95	   108#	   108	   109	   222#	   222	   223	   277#	   277	   278	   324#	   324
	   325	   596#	   596	   597	   649#	   649	   650	   697#	   697	   698	   715#	   715	   716	   730#
	   730	   731	   867#	   867	   868	   874#	   874	   875	   877#	   877	   878	   883#	   883	   884
	   887#	   887	   888	   891#	   891	   892	   895#	   895	   896	   898#	   898	   899	   956#	   956
	   957	   981#	   981	   982	  1082#	  1082	  1083	  1178#	  1178	  1179	  1193#	  1193	  1194	  1207#
	  1207	  1208	  1225#	  1225	  1226	  1234#	  1234	  1235	  1236#	  1236	  1237	  1381#	  1381	  1382
	  1390#	  1390	  1391	  1397#	  1397	  1398	  1408#	  1408	  1409	  1479#	  1479	  1480	  1546#	  1546
	  1547	  1556#	  1556	  1557	  1587#	  1587	  1588	  1625#	  1625	  1626	  1648#	  1648	  1649	  1663#
	  1663	  1664	  1667#	  1667	  1668	  1668#	  1669	  1735#	  1735	  1736	  1746#	  1746	  1747	  1751#
	  1751	  1752	  1813#	  1813	  1814	  1815#	  1815	  1816	  1843#	  1843	  1844	  1956#	  1956	  1957
	  1990#	  1990	  1991	  1997#	  1997	  1998	  2195#	  2195	  2196	  2217#	  2217	  2218	  2298#	  2298
	  2299	  2342#	  2342	  2343	  2380#	  2380	  2381	  2389#	  2389	  2390	  2446#	  2446	  2447	  2482#
	  2482	  2483	  2485#	  2485	  2486	  2488#	  2488	  2489	  2512#	  2512	  2513	  2515#	  2515	  2516
	  2518#	  2518	  2519	  2525#	  2525	  2526	  2528#	  2528	  2529	  2532#	  2532	  2533	  2545#	  2545
	  2546	  2548#	  2548	  2549	  2551#	  2551	  2552	  2563#	  2563	  2564	  2566#	  2566	  2567	  2568#
	  2568	  2569	  2600#	  2600	  2601	  2618#	  2618	  2619	  2621#	  2621	  2622	  2624#	  2624	  2625
	  2663#	  2663	  2664	  2673#	  2673	  2674	  2738#	  2738	  2745#	  2745	  2746	  2794#	  2794	  2795
	  3766#	  3766	  3767
GIVWDS	  2006	  2014	  2162%	  2175	  2186
GNUARG	  1299%	  1343
GNUARX	  1299%	  1330
GRSPAT	  1324#
GRSSLF	  1327	  1341#
GRSTAB	  1306#	  1317	  1335
HIGHJB	   364%	   825	   826
HSLIC	  1300%	  1320
INADEF	   548%	   548
INIARB	  3282#
IO	   899	   902	   914
IPOPJ	  2932%	  2937	  2957
IPOPJ1	  2932%	  2939
ISCHL0	  2936#	  2958
ISCHL1	  2938#	  2941
ISCHLD	   273	   311	  2302	  2610	  2934#	  3102
ISSIBL	   314	  2954#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

J	   238	   240	   242	   244	   245	   246	   247	   249	   251	   253	   280	   319	   400	   408
	   411	   419	   425	   463	   491	   494	   510	   517	   524	   528	   529	   534	   535	   540
	   542	   544	   555	   557	   564	   565	   584	   595	   635	   656	   695	   731	   750	   763
	   765	   793	   795	   796	   797	   799	   805	   806	   809	   811	   813	   818	   825	   826
	   838	   963	   964	  1022	  1039	  1055	  1148	  1155	  1158	  1159	  1221	  1258	  1269	  1326
	  1328	  1334	  1383	  1385	  1387	  1389	  1401	  1407	  1426	  1431	  1441	  1457	  1459	  1477
	  1484	  1516	  1734	  1754	  1791	  1904	  1982	  2029	  2030	  2061	  2073	  2103	  2115	  2117
	  2130	  2147	  2201	  2254	  2255	  2262	  2272	  2305	  2313	  2499	  2505	  2511	  2512	  2514
	  2517	  2524	  2525	  2527	  2530	  2531	  2534	  2537	  2538	  2544	  2545	  2547	  2550	  2553
	  2556	  2562	  2563	  2623	  2626	  2801	  2804	  2809	  2814	  2824	  2827	  2833	  2847	  2849
	  2850	  2851	  2867	  2868	  2869	  2873	  2874	  2875	  2878	  2882	  2894	  2898	  2899	  2912
	  2915	  2934	  2935	  2936	  2937	  2938	  2940	  2941	  2942	  2954	  2955	  2956	  2957	  3068
	  3071	  3093	  3094	  3095	  3098	  3099	  3100	  3106	  3109	  3110	  3111	  3117	  3118	  3119
	  3121	  3123	  3124	  3125	  3185	  3190	  3208	  3211	  3212	  3213	  3269	  3283	  3284	  3319
JACCT	   841	  1429	  1456
JACCT2	   841
JALTAB	  2416	  3338	  3534#
JBTABT	  1954%	  1989	  1995
JBTAUN	   364%	   750	  3318	  3319
JBTCTX	   369%	   425	   463	   557
JBTFNT	   247%	   247	   249%	   249	   251%	   251	   253%	   253
JBTFTR	   318	   364%	  2816	  2827	  2848	  2849	  2850	  2851	  2868	  2875	  2877	  2881	  2888	  2889
	  2894	  2895	  2898	  2899	  2912	  2915	  2916	  2918	  2920	  2936	  2940	  2956	  3094	  3212
JBTLIC	   364%	   534	   695	   731	   952%	   963	  1387	  1389	  1401	  1407	  1655	  1904	  3145%	  3328
JBTMFR	   565	  1101	  2073	  2201	  2499	  2556	  3247%	  3249	  3284
JBTNAM	   542%	   542	  1301%	  1334
JBTNM1	   528%	   528
JBTNM2	   529%	   529
JBTP2S	   564	  2115	  2272	  2553	  3147%	  3222	  3283
JBTPNO	  1097	  2061	  2103	  2117	  2130	  2312	  2505	  2517	  2538	  2550	  2629	  3147%	  3190	  3213
JBTPNT	   238%	   238	   240%	   240	   242%	   242	   244%	   244	   245%	   245	   246%	   246	   271%	   271
	   813%	   813	  2847%	  2847	  2874%	  2874	  2917%	  2917
JBTPPN	   364%
JBTPRG	   540%	   540
JBTPRV	   364%	   544	   547	   763	   765	  3316
JBTS2P	  2093	  2255	  2305	  2534	  2626	  3147%	  3207
JBTSLC	   535	   952%	   964	  1383	  1385
JBTSPN	  2091	  2262	  2313	  2531	  2623	  2833	  3147%	  3211
JBTST2	   408%	   408	   411%	   411
JBTSTS	   369%	   400	   419	   517	   524	   555	   584	   635	   795	   799	   811	   838%	   838	   952%
	  1022	  1039	  1055	  1114	  1155	  1159	  1269	  1328	  1421%	  1426	  1431	  1441	  1457	  1477
	  1516	  2801	  2809	  2824
JBTUID	   371%	   818	  1090	  2030	  2514	  2527	  2547	  2620	  3125	  3185
JBTUN1	   365%
JBTUNM	   365%
JBTUPM	   365%	   494	  1129	  1148
JBYECF	   240#	   241	  2866
JBYIN2	   549%	   549
JBYINA	   550%	   550
JBYLCF	   238#	   239	  2864
JBYMWS	   365%	   426
JBYNIC	   242#	   243
JBYQNT	  1080%	  1157	  1160
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

JBYSIA	   253#	   254	   323
JBYSIC	   249#	   250
JBYSIP	   247#	   248
JBYSIS	   251#	   252
JBYUWS	   365%	   493
JDCON	  1040	  1428
JDSVCL	   998#	  1179
JDSVCO	   991	  1001#	  1173
JDSVLN	   989	  1002#	  1175
JDSVTB	   993	   996#	  1177
JERR	   514	  1040	  1518
JLOG	   418	   523	   585	   841
JNA	   634	   794	   810	   841	  2802	  2810	  2825
JOB	   546	  1080%	  1153	  1326
JOBATB	   365%	   429	   436	   453
JOBMAX	   368%	   793	  3100	  3111	  3146%	  3228
JRQ	   794	  1115	  1214
JS.BAT	   406
JS.BBJ	   409
JSCLR	   837	   841#
JSTCTX	   556
KJP	   841
LASZZ	  3609	  3611	  3611#	  3612#	  3612	  3613#	  3613	  3615	  3615#	  3616#	  3616	  3617#	  3617	  3621
	  3633	  3633#	  3634#	  3634	  3635#	  3635	  3636#	  3636	  3637#	  3637	  3638#	  3638
LDBLOG	   662%	   662	   663%	   663
LG.LAB	  1166	  1183	  1196	  1204
LG.LUB	  1144	  1149
LICHR	   732
LICJAL	   394	   696	   719	  1903	  3337
LICMSK	  1386%	  1386	  1402%	  1402
LICRFL	  1405	  1406
LICRMT	   732
LICRPJ	  1405	  1406
LICSPY	  3335
LICSYS	  3339
LICWCR	  3333
LICWFL	  1403	  1404
LICWPJ	  1403	  1404	  1656
LICXC	  1656
LIMMAX	  2240	  2241	  2245	  2258	  2275	  2720#	  2751
LISTSN	     3	     6
LM3ATB	   365%	   511
LM3HDA	   365%	   509
LMASRP	   368%	   508
LMMERR	   864%	   918
LMPCUR	   365%	   504
LMPMXW	   366%	   504
LMPNER	   864%	   911
LOFS	  3611#	  3611	  3612#	  3612	  3613#	  3613	  3615#	  3615	  3616#	  3616	  3617#	  3617	  3629#	  3633
	  3633#	  3634#	  3634	  3635#	  3635	  3636#	  3636	  3637#	  3637	  3638#	  3638
LOGLD1	   657	   660#
LOGLDB	   654#
LOGTAB	   369%	   537	   714	   718
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

LOGTOP	   536	   709	   759#	   760
LOGTP0	   417	   752#
LOGTP1	   706	   756#
LOGTP2	   707	   757#
LSLIC	  1300%	  1320
M	   697	   699	   704	   709	   715	   726	   729	   730	   867	   874	   877	   883	   891	   895
	   898	   956	   981	  1082	  1381	  1390	  1397	  1408	  1479	  1546	  1554	  1555	  1587	  1625
	  1627	  1735	  1739	  1746	  1747	  1751	  1819	  1956	  1990	  2195	  2217	  2298	  2350	  2380
	  2446	  2600	  2659	  2664	  2674	  2758	  2794	  3428	  3435	  3454
M2UACE	  3618#
M2UACT	  2646	  3611#
MAPUPX	   366%	   464	   658%	   658
MAXLIC	  1388%	  1388
MBIT	   366%	   434	   438
MFRCHK	  3196	  3225	  3249#
MONJBX	   952%	  1033	  1273	  1339
MRQ	   514	  1214
MXFRAT	  1749	  1752	  1889#
NBJFCE	   395	   606#
NCTXPG	   366%	   432	   454	   458	   466	   502	   570
NOAR	  1781	  1879#	  1887
NODIE	    12%
NOLIC	  1851#	  1887
NOPRN1	  2916#	  2922
NOPRNT	  2912#
NOSHR	  1300%	  1320	  1322
NULMFR	  2506	  2539	  2571	  2630	  3555#
NULQ	   800%	   800
OTFFLG	   906	  2973#	  2976
P	    13	   109	   268	   273	   309	   311	   314	   326	   390	   397	   401	   421	   429	   436
	   439	   453	   464	   512	   534	   535	   537	   539	   559	   588	   591	   602	   606	   613
	   618	   622	   623	   628	   629	   636	   637	   650	   654	   655	   658	   664	   665	   666
	   694	   725	   736	   740	   745	   751	   768	   781	   807	   812	   839	   871	   881	   888
	   893	   961	   983	  1032	  1057	  1156	  1161	  1205	  1208	  1227	  1231	  1235	  1259	  1260
	  1261	  1267	  1272	  1318	  1330	  1338	  1341	  1342	  1343	  1345	  1379	  1386	  1388	  1395
	  1402	  1424	  1444	  1454	  1462	  1464	  1475	  1482	  1486	  1488	  1489	  1490	  1511	  1520
	  1551	  1573	  1640	  1672	  1730	  1801	  1809	  1844	  1848	  1905	  1907	  1961	  1977	  1979
	  1992	  2006	  2052	  2053	  2058	  2065	  2067	  2086	  2087	  2099	  2100	  2111	  2112	  2121
	  2122	  2128	  2129	  2132	  2172	  2186	  2188	  2197	  2204	  2242	  2252	  2259	  2269	  2276
	  2300	  2302	  2308	  2386	  2387	  2454	  2570	  2608	  2610	  2694	  2697	  2698	  2699	  2700
	  2701	  2702	  2799	  2807	  2822	  2830	  2832	  2835	  2852	  2867	  2872	  2873	  2900	  2934
	  2938	  2942	  2943	  2954	  2979	  2980	  2981	  2982	  2983	  2984	  2985	  2986	  2987	  2988
	  2990	  2991	  2992	  2993	  2994	  3007	  3008	  3009	  3010	  3011	  3012	  3013	  3015	  3032
	  3033	  3034	  3037	  3051	  3052	  3053	  3054	  3066	  3067	  3070	  3073	  3074	  3075	  3076
	  3102	  3209	  3214	  3215	  3223	  3230	  3250	  3271	  3272	  3276	  3277	  3289	  3310	  3311
	  3312	  3313	  3346	  3350	  3351	  3353	  3354	  3355	  3356	  3358	  3359	  3360	  3443	  3444
	  3457	  3458	  3485	  3486	  3728	  3767
P1	   264	   265	   270	   275	   276	   312	   313	   316	   320	   321	   396	   407	   410	   413
	   416	   425	   426	   435	   443	   956	   957	   981	   986	   987	   988	   989	   991	   993
	  1011	  1013	  1014	  1027	  1046	  1048	  1051	  1082	  1083	  1102	  1162	  1164	  1165	  1169
	  1178	  1180	  1181	  1182	  1190	  1192	  1193	  1194	  1195	  1203	  1223	  1239	  1240	  1244
	  1245	  1311	  1312	  1314	  1315	  1317	  1321	  1333	  1335	  1346	  1348	  1546	  1547	  1548
	  1555	  1556	  1639	  1643	  1740	  1751	  1752	  1785	  1812	  1817	  1862	  1867	  1872	  1877
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

	  1957	  1958	  1963	  1964	  1966	  1968	  1971	  1972	  1973	  1974	  1975	  1984	  1987	  1996	  1997
	  2003	  2443	  2445	  2493	  2536	  2555	  2598	  2599	  2628	  3423	  3424	  3425	  3429	  3438
	  3446	  3460	  3462	  3467
P2	   261	   262	   276	   388	   596	   649	   958	   985	  1030	  1056	  1332	  1659	  1667	  1736
	  1841	  1956	  1957	  1982	  2195	  2199	  2246	  2267	  2271	  2298	  2307	  2446	  2447	  2452
	  2456	  2480	  2481	  2484	  2487	  2491	  2492	  2494	  2600	  2601	  2606	  2612	  2698	  2795
	  2805	  2821	  3427	  3430
P3	   267	   275	   277	   308	   504	   870	   880	   887	   926	   929	   930	   931	   959	   982
	  1088	  1090	  1097	  1101	  1114	  1129	  1153	  1158	  1221	  1222	  1224	  1236	  1237	  1238
	  1241	  1243	  1245	  1266	  1317	  1378	  1394	  1423	  1453	  1474	  1510	  1550	  1572	  1636
	  1638	  1756	  1778	  1780	  1781	  1783	  1828	  1832	  1836	  1837	  1842	  1843	  1906	  1960
	  1983	  1984	  2029	  2031	  2062	  2068	  2074	  2076	  2092	  2104	  2118	  2131	  2196	  2201
	  2202	  2233	  2234	  2235	  2236	  2237	  2238	  2255	  2256	  2257	  2268	  2272	  2273	  2274
	  2299	  2305	  2306	  2344	  2346	  2453	  2499	  2500	  2556	  2557	  2607	  2642	  2649	  2652
	  2655	  2694	  2695	  2696	  2701	  2754	  2756	  2766	  2769	  2770	  2798	  2806	  2829	  3036
	  3066	  3069	  3071	  3075	  3149	  3151	  3185	  3186	  3696	  3697	  3698	  3699	  3700	  3701
	  3702	  3703	  3704	  3705	  3706	  3707	  3708	  3709	  3710	  3711	  3712	  3713	  3714	  3715
	  3716	  3717	  3718	  3719	  3720	  3721	  3722	  3723	  3724	  3725	  3726	  3727	  3734	  3735
	  3736	  3737	  3738	  3739	  3740	  3741	  3742	  3743	  3744	  3745	  3746	  3747	  3748	  3749
	  3750	  3751	  3752	  3753	  3754	  3755	  3756	  3757	  3758	  3759	  3760	  3761	  3762	  3763
	  3764	  3765	  3766
P4	    95	   260	   506	   907	  1030	  1084	  1086	  1088	  1089	  1093	  1094	  1096	  1225	  1226
	  1635	  1660	  1665	  1668	  1733	  1803	  2049	  2063	  2064	  2093	  2094	  2105	  2115	  2116
	  2164	  2165	  2167	  2170	  2180	  2182	  2187	  2200	  2203	  2233	  2236	  2237	  2257	  2274
	  2382	  2383	  2385	  2479	  2480	  2491	  2492	  2506	  2520	  2534	  2535	  2539	  2553	  2554
	  2571	  2626	  2627	  2630	  2653	  2656	  2667	  2669	  2738	  2742	  2744	  2762	  2795	  2797
	  2805	  2821	  2977	  2978	  3007	  3009	  3011	  3067	  3068	  3074	  3098	  3109	  3117	  3173
	  3174	  3176	  3179	  3182	  3186	  3191	  3227	  3228	  3232	  3312	  3313	  3370	  3372	  3375
PAG	  1166	  1183	  1196	  1204
PBMMSK	   366%	   480
PC.PUB	  1083
PC.USR	  1025	  1083	  1147	  1230	  1433	  1576	  1585
PG	   655	   664	  1990	  2199	  2217	  2267	  2271	  2307	  2330	  2335	  2339	  2380	  2381	  2456
	  2482	  2483	  2485	  2486	  2488	  2489	  2512	  2513	  2515	  2516	  2518	  2519	  2525	  2526
	  2528	  2529	  2532	  2533	  2545	  2546	  2548	  2549	  2551	  2552	  2563	  2564	  2566	  2567
	  2568	  2569	  2612	  2618	  2619	  2621	  2622	  2624	  2625	  2643	  2645	  2657	  2670	  2724
	  2726	  2729	  2734
PJBSTS	   590	   798	   953%	  1042	  1421%	  1435	  1579
PJCSET	  1623#	  1637	  1644
PJCVFY	  1624#	  1651
PRVMSK	   764%	   764
PSHAR0	   698	   703#
PSHAR1	   701	   706#
PSHAR2	   713#	   726
PSHAR3	   717	   720	   725#
PSHARG	   390	   694#
PSHARZ	   417	   602	   606	   613	   628	   760#
PSHERR	   708	   724	   743#
PSHPRV	   751	   762#
PVACTS	  3306	  3317	  3323	  3341
PVDINA	   543
PVLOS	   766
PVTYMP	  3306	  3317	  3343
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

PVYCOR	   820%	   820
PX.MEM	    94	   108	   222	   277	   324	   596	   649	   697	   715	   730	   867	   874	   877	   883
	   887	   891	   895	   898	   956	   981	  1082	  1178	  1193	  1207	  1225	  1234	  1236	  1381
	  1390	  1397	  1408	  1479	  1546	  1556	  1587	  1625	  1648	  1663	  1667	  1668	  1735	  1746
	  1751	  1813	  1815	  1843	  1956	  1990	  1997	  2195	  2217	  2298	  2342	  2380	  2389	  2446
	  2482	  2485	  2488	  2512	  2515	  2518	  2525	  2528	  2532	  2545	  2548	  2551	  2563	  2566
	  2568	  2600	  2618	  2621	  2624	  2663	  2673	  2738	  2745	  2794	  3766
PX.SRC	  1234	  1663	  2342	  2663	  2673	  2738	  2745
RBREAL	   366%	   442	   617
RCATAB	  2412	  3336	  3525#
RCHTAB	  2218	  2221#
RDXMFR	  2410	  3547#
RELSAT	   622%	   622
REQUE	   591%	   591	  1156	  1161
RESFR1	  2181#	  2187
RESFR2	  2183	  2187#
RESFRH	  2180#
RNQ	   589%	   589
RSIMAX	  2383	  2418#
RSITAB	  2385	  2408#	  2418
RUN	  1116	  1154	  1212	  1215
RUNABL	  1116	  1215
RUNFMU	  1298%	  1348
RUNFRM	  1298%	  1307
RUNMSK	  1115
RXRABS	  2460	  2562#
RXRCHL	  2468	  2544#
RXRFR1	  2498	  2503#
RXRFRH	  2463	  2479#
RXRPAR	  2469	  2524#
RXRSLF	  2467	  2511#
RXRTAB	  2457	  2460#
S	   892	   899	   902	   914	  1724	  1726	  1728	  1758	  1779	  1786	  1796	  1811	  1814	  1816
	  2330	  2331	  2333	  2335	  2340	  2447	  2448	  2449	  2451	  2601	  2602	  2603	  2605	  2643
	  2644	  2645	  2658	  2672	  2726	  2727	  2729	  2735
S$ENTR	    12	    18	   465	   468	   572	   923	  2036	  2037	  2039	  2040	  2041	  2222	  2223	  2461
	  2462	  3083	  3084	  3161	  3162
S$HALT	    12	   465	   468	   572	   923	  2036	  2037	  2039	  2040	  2041	  2222	  2223	  2461	  2462
	  3083	  3084	  3161	  3162
S$NAME	    16#	   465	   468	   572	   923	  2036	  2037	  2039	  2040	  2041	  2222	  2223	  2461	  2462
	  3083	  3084	  3161	  3162
S$NONA	    15	    18	   465	   468	   572	   923	  2036	  2037	  2039	  2040	  2041	  2222	  2223	  2461
	  2462	  3083	  3084	  3161	  3162
S$TEMP	    12#	    12	   465#	   465	   468#	   468	   572#	   572	   923#	   923	  2036#	  2036	  2037#	  2037
	  2039#	  2039	  2040#	  2040	  2041#	  2041	  2222#	  2222	  2223#	  2223	  2461#	  2461	  2462#	  2462
	  3083#	  3083	  3084#	  3084	  3161#	  3161	  3162#	  3162
S$XCT	    18	   465	   468	   572	   923	  2036	  2037	  2039	  2040	  2041	  2222	  2223	  2461	  2462
	  3083	  3084	  3161	  3162
SAVE1	  2329	  2718%	  2723
SAVFMU	  1298%	  1348
SAVFRM	  1298%	  1308	  1309
SETAR1	  2737	  2739	  2749	  2753#
SETARN	  2204	  2259	  2276	  2697	  2722#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

SETHDL	  2065	  2095	  2106	  2120	  2121	  2134	  2242	  2694#
SETLMX	   370%	   512
SETMAX	  2725	  2762#
SETRUN	   953%	  1058	  1521
SG3	  1299%	  1345
SLPQ	   953%	  1044	  1581
SRDUPX	  2975#
SRPNDS	   778%	   778
STARCL	   954%	   957	   998	  1014	  1051
STARDI	   954%	  1014	  1240
STARTX	   952%	  1031
STOP1	  1080%	  1260
STRBTS	   779%	   779
STRDDB	   779%	   779
STRTAD	   953%	  1049	  1050
STRTCL	   953%	  1052
STVSET	   221#
SWPINP	   399	   554	   634
SWRUPX	  2976#
SYSTAB	  2413	  3340	  3528#
SYSUID	   371%	   815	   816	   817
T1	    94	    95	    96	    97	    98	    99	   101	   102	   103	   104	   105	   107	   108	   221
	   222	   260	   261	   264	   270	   271	   317	   318	   319	   321	   322	   323	   324	   325
	   399	   400	   406	   408	   409	   411	   415	   417	   418	   419	   420	   431	   434	   437
	   438	   455	   456	   459	   462	   463	   466	   467	   469	   470	   477	   479	   480	   482
	   483	   484	   485	   486	   488	   489	   490	   492	   493	   494	   510	   511	   514	   517
	   523	   524	   536	   537	   538	   541	   542	   543	   544	   547	   548	   549	   550	   551
	   552	   554	   555	   556	   557	   558	   563	   564	   565	   566	   567	   568	   569	   570
	   571	   584	   585	   587	   589	   590	   595	   596	   619	   620	   634	   635	   643	   644
	   645	   646	   647	   648	   649	   659	   660	   663	   714	   715	   718	   725	   730	   733
	   735	   736	   739	   740	   750	   762	   794	   795	   798	   800	   803	   804	   810	   811
	   814	   815	   816	   817	   818	   819	   820	   837	   838	   873	   874	   883	   884	   895
	   898	   915	   916	   963	   964	  1008	  1009	  1010	  1013	  1024	  1025	  1028	  1029	  1039
	  1040	  1042	  1043	  1044	  1047	  1049	  1050	  1052	  1053	  1054	  1055	  1089	  1090	  1093
	  1095	  1100	  1114	  1115	  1116	  1121	  1122	  1129	  1143	  1144	  1145	  1146	  1147	  1148
	  1149	  1169	  1170	  1171	  1172	  1173	  1175	  1177	  1179	  1187	  1189	  1192	  1206	  1207
	  1212	  1214	  1215	  1229	  1230	  1233	  1234	  1426	  1428	  1429	  1431	  1432	  1433	  1435
	  1437	  1440	  1441	  1456	  1457	  1463	  1479	  1480	  1486	  1489	  1516	  1518	  1553	  1554
	  1556	  1575	  1576	  1578	  1582	  1585	  1586	  1587	  1625	  1626	  1627	  1637	  1639	  1643
	  1644	  1646	  1647	  1648	  1661	  1664	  1667	  1668	  1671	  1747	  1748	  1749	  1750	  1757
	  1759	  1760	  1812	  1815	  1903	  1904	  1983	  1985	  1987	  1989	  1994	  1995	  2004	  2009
	  2011	  2012	  2030	  2031	  2051	  2054	  2058	  2060	  2068	  2070	  2073	  2074	  2077	  2078
	  2085	  2091	  2092	  2098	  2110	  2127	  2150	  2173	  2184	  2238	  2239	  2311	  2312	  2313
	  2341	  2342	  2348	  2388	  2389	  2451	  2452	  2481	  2482	  2484	  2485	  2487	  2488	  2505
	  2514	  2515	  2517	  2518	  2527	  2528	  2531	  2532	  2538	  2547	  2548	  2550	  2551	  2565
	  2566	  2568	  2605	  2606	  2620	  2621	  2623	  2624	  2629	  2661	  2662	  2663	  2671	  2673
	  2736	  2738	  2745	  2747	  2752	  2757	  2762	  2763	  2764	  2768	  2801	  2802	  2809	  2810
	  2812	  2814	  2816	  2817	  2824	  2825	  2827	  2828	  2834	  2848	  2850	  2851	  2864	  2865
	  2866	  2870	  2875	  2876	  2877	  2895	  2918	  2919	  2921	  2976	  2979	  2983	  2986	  2991
	  2993	  3151	  3152	  3178	  3232	  3233	  3268	  3274	  3282	  3283	  3284	  3285	  3286	  3287
	  3288	  3310	  3327	  3334	  3336	  3338	  3340	  3342	  3344	  3349	  3351	  3405	  3429	  3431
	  3433	  3442	  3443	  3446	  3447	  3448	  3450	  3478	  3480	  3481	  3482	  3483	  3486	  3487
	  3488	  3489	  3490	  3493
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

T2	   430	   431	   435	   441	   442	   443	   454	   455	   456	   457	   458	   459	   505	   507
	   508	   509	   546	   547	   616	   617	   661	   662	   697	   698	   699	   700	   703	   705
	   722	   723	   731	   732	   733	   762	   763	   764	   766	   767	   780	   907	   908	   909
	   911	   912	   929	  1010	  1011	  1031	  1094	  1101	  1103	  1106	  1157	  1160	  1177	  1178
	  1189	  1190	  1271	  1332	  1334	  1335	  1381	  1382	  1383	  1385	  1387	  1389	  1390	  1397
	  1398	  1399	  1401	  1403	  1404	  1405	  1406	  1407	  1408	  1436	  1437	  1438	  1480	  1481
	  1579	  1580	  1581	  1646	  1648	  1651	  1652	  1654	  1655	  1656	  1661	  1662	  1663	  1813
	  1817	  1976	  1988	  1989	  2002	  2003	  2005	  2010	  2011	  2013	  2055	  2067	  2069	  2088
	  2101	  2113	  2119	  2147	  2148	  2152	  2169	  2170	  2171	  2174	  2181	  2182	  2183	  2185
	  2347	  2348	  2350	  2494	  2495	  2497	  2503	  2650	  2651	  2652	  2655	  2660	  2662	  2740
	  2741	  2742	  2744	  2746	  2747	  2749	  2752	  2764	  2765	  2767	  2768	  2769	  2770	  2848
	  2849	  2877	  2878	  2880	  2881	  2882	  2888	  2889	  2894	  2895	  2897	  2898	  2899	  2912
	  2913	  2916	  2917	  2918	  2920	  2921	  2980	  2982	  2985	  3153	  3180	  3233	  3270	  3275
	  3311	  3318	  3319	  3320	  3322	  3329	  3334	  3336	  3338	  3340	  3342	  3344	  3346	  3347
	  3350	  3397	  3398	  3403	  3407	  3409	  3437	  3444	  3456	  3465	  3481	  3485	  3489
T3	   437	   700	   705	   706	   707	   711	   713	   714	   718	   722	   727	   728	   729	   743
	   744	   745	   903	   904	   909	   918	   919	   921	   922	  1027	  1096	  1097	  1154	  1155
	  1159	  2049	  2050	  2051	  2059	  2063	  2064	  2076	  2078	  2079	  2090	  2091	  2093	  2103
	  2104	  2130	  2131	  2339	  2340	  2342	  2650	  2653	  2656	  2661	  2666	  2667	  2669	  2671
	  2734	  2735	  2738	  2745	  2766	  2767	  2880	  2889	  2914	  2915	  2916	  2920	  3123	  3125
	  3178	  3179	  3180	  3182	  3183	  3188	  3190	  3191	  3195	  3207	  3211	  3213	  3222	  3249
	  3269	  3270	  3273	  3274	  3275	  3316	  3317	  3320	  3323	  3325	  3328	  3333	  3335	  3337
	  3339	  3341	  3343	  3348	  3352	  3370	  3371	  3374	  3375	  3376	  3378	  3380	  3381	  3397
	  3398	  3399	  3401	  3402	  3403	  3404	  3407	  3409	  3430	  3432	  3433	  3445	  3447	  3449
	  3450	  3457	  3459	  3460	  3461	  3462	  3466	  3467	  3475	  3476	  3482	  3487	  3490	  3491
	  3492	  3493
T4	   778	   779	   905	   906	  1029	  2032	  2059	  2061	  2062	  2075	  2077	  2080	  2117	  2118
	  2218	  2329	  2343	  2344	  2346	  2347	  2457	  2616	  2617	  2618	  2620	  2629	  2657	  2658
	  2663	  2670	  2672	  2673	  2723	  2740	  2753	  2754	  2756	  2757	  2987	  2988	  3012	  3013
	  3079	  3154	  3315	  3316	  3318	  3328	  3378	  3380	  3404	  3405	  3436	  3437	  3438	  3442
	  3445	  3455	  3456	  3458	  3459	  3461	  3465	  3466	  3475	  3476	  3477	  3478	  3483	  3492
TAKTRP	   326%	   326	  2872%	  2872
TIMEF	  1080%	  1118
TIOWQ	   953%	  1043	  1580
TKCHL1	  2880#	  2883
TKCHL2	  2879	  2894#
TKCHL3	  2890	  2897#
TKCHLD	  2832	  2864#
TPOPJ	  2047%	  2066
TRHALT	  1421%	  1445
TTYHLT	  1462%	  1462	  1488%	  1488
TTYKIL	   637%	   637
TTYNFR	   370%	   401
TTYTAB	  1459%	  1459	  1484%	  1484
TYPTAB	  2414	  3344	  3531#
U	   389	   530	   662	   663	   867	   868	   873	   877	   878	   884	   905	   913	   915	   916
	  1342	  1460	  1461	  1485	  1487	  1735	  1736	  1737	  1740	  1741	  1813	  1815	  1818	  1841
	  1842	  2336	  2646	  2730	  2794	  2796	  2797	  2804	  2812	  2834	  3423	  3426	  3427	  3495
U2MACE	  3639#
U2MACT	  2336	  2730	  3627#
ULDUPX	  1231	  1235	  1341	  2992	  3014	  3016	  3030%	  3038
UP4LDA	   366%	   507
UPNPSR	   953%
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

UPSPSR	   953%
UPT	   366%	   469	   483
UPTACP	   366%	   483	   484
UPTEND	   366%	   479
UPTFHT	  1086	  1968	  1972	  1984	  2003	  2011	  2050	  2170	  2182	  2235	  2480	  3121	  3143%	  3176
UPTFSL	   470	   477	   478
UPTHEC	   472
UPTHMC	   474
UPTHST	  1544%	  1553
UPTIME	   803%	   803
UPTJOB	   280	   317	   367%	   491	   558	   656	  1258	  1654	  1754	  1988	  1994	  2090	  2254	  2311
	  2530	  2537	  2616	  2935	  2955	  3093	  3106	  3143%	  3208	  3315
UPTLEC	   473
UPTLMC	   475
UPTLOG	   660%	   660	  1895%	  1895
UPTMFR	   566	   567	  2077	  2202	  2500	  2557	  3247%	  3249	  3285	  3286
UPTNTV	   367%	   486
UPTOFD	   367%	  2977	  3372
UPTP2S	   568	   569	  2116	  2273	  2554	  3143%	  3222	  3287	  3288
UPTPBM	   367%	   482
UPTPC	   952%	  1024	  1028	  1122	  1146	  1165	  1168	  1182	  1185	  1195	  1198	  1229	  1432	  1575
UPTPDL	  1121	  1150	  1205	  1259	  1570%	  1578
UPTPID	   952%	   965	  1336
UPTPJ2	  1633%	  1652	  1660	  1663	  1665
UPTPJC	  1633%	  1647	  1659	  1662
UPTRNM	   551%	   551
UPTRPN	   552%	   552
UPTS2P	  2094	  2256	  2306	  2535	  2627	  3143%	  3207
UPTSPD	   952%	   966	  1337
UPTSTS	   952%	  1046	  1047	  1053
UPTSTV	   221	  1006%	  1008	  1187
UPTUAC	   865%	   873	   884	  1233	  1234
UPTXAC	   953%	  1027	  1029	  1030	  1332
USCHED	  1080%	  1262
USRACB	  1166	  1183	  1196	  1204
USRXIT	  1080%	  1209
UTRP	  1054
UXYPSR	   368%	  1056
UXYUWL	   367%	   490
UXYUWM	   367%	   489
W	    94	   108	   222	   277	   324	   388	   432	   441	   444	   502	   505	   513	   614	   615
	   616	   620	   621	   654	   665	   694	   741	   746	   887	  1207	  1225	  1236	  1320	  1322
	  1843	  1997	  2240	  2241	  2243	  2244	  2245	  2258	  2260	  2261	  2275	  2389	  2722	  2732
	  2750	  2751	  3766
WAKFLG	   841
WCATAB	  2417	  3334	  3522#
WLKUPX	  3030%	  3034
WRTACR	   588%	   588
ZZ	    94#	    94	   108#	   108	   164#	   166	   167	   167#	   168	   168#	   169	   169#	   170	   170#
	   171	   171#	   172	   172#	   173	   173#	   174	   174#	   175	   175#	   176	   176#	   177	   177#
	   178	   178#	   179	   179#	   180	   180#	   181	   181#	   182	   182#	   183	   183#	   184	   184#
	   185	   185#	   186	   186#	   187	   187#	   188	   188#	   189	   189#	   190	   190#	   191	   191#
	   192	   192#	   193	   193#	   194	   194#	   195	   195#	   196	   196#	   197	   197#	   198	   198#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

	   199	   199#	   200	   200#	   201	   201#	   202	   202#	   203	   203#	   204	   204#	   205	   205#	   222#
	   222	   277#	   277	   324#	   324	   596#	   596	   649#	   649	   697#	   697	   715#	   715	   730#
	   730	   867#	   867	   874#	   874	   877#	   877	   883#	   883	   887#	   887	   891#	   891	   895#
	   895	   898#	   898	   956#	   956	   981#	   981	  1082#	  1082	  1178#	  1178	  1193#	  1193	  1207#
	  1207	  1225#	  1225	  1234#	  1234	  1236#	  1236	  1381#	  1381	  1390#	  1390	  1397#	  1397	  1408#
	  1408	  1479#	  1479	  1546#	  1546	  1556#	  1556	  1587#	  1587	  1625#	  1625	  1648#	  1648	  1663#
	  1663	  1667#	  1667	  1668#	  1668	  1735#	  1735	  1746#	  1746	  1751#	  1751	  1813#	  1813	  1815#
	  1815	  1843#	  1843	  1956#	  1956	  1990#	  1990	  1997#	  1997	  2195#	  2195	  2217#	  2217	  2298#
	  2298	  2342#	  2342	  2380#	  2380	  2389#	  2389	  2446#	  2446	  2482#	  2482	  2485#	  2485	  2488#
	  2488	  2512#	  2512	  2515#	  2515	  2518#	  2518	  2525#	  2525	  2528#	  2528	  2532#	  2532	  2545#
	  2545	  2548#	  2548	  2551#	  2551	  2563#	  2563	  2566#	  2566	  2568#	  2568	  2600#	  2600	  2618#
	  2618	  2621#	  2621	  2624#	  2624	  2663#	  2663	  2673#	  2673	  2738#	  2738	  2745#	  2745	  2794#
	  2794	  3522#	  3522	  3523#	  3523	  3525#	  3525	  3526#	  3526	  3528#	  3528	  3529#	  3529	  3531#
	  3531	  3532#	  3532	  3534#	  3534	  3535#	  3535	  3537#	  3537	  3538#	  3538	  3542#	  3542	  3543#
	  3543	  3547#	  3547	  3548#	  3548	  3552#	  3552	  3553#	  3553	  3611#	  3611	  3612	  3612#	  3613
	  3613#	  3614	  3615#	  3615	  3616	  3616#	  3617	  3617#	  3618	  3619	  3628#	  3633	  3633#	  3634
	  3634#	  3635	  3635#	  3636	  3636#	  3637	  3637#	  3638	  3638#	  3640	  3693#	  3696	  3697	  3697#
	  3698	  3698#	  3699	  3699#	  3700	  3700#	  3701	  3701#	  3702	  3702#	  3703	  3703#	  3704	  3704#
	  3705	  3705#	  3706	  3706#	  3707	  3707#	  3708	  3708#	  3709	  3709#	  3710	  3710#	  3711	  3711#
	  3712	  3712#	  3713	  3713#	  3714	  3714#	  3715	  3715#	  3716	  3716#	  3717	  3717#	  3718	  3718#
	  3719	  3719#	  3720	  3720#	  3721	  3721#	  3722	  3722#	  3723	  3723#	  3724	  3724#	  3725	  3725#
	  3726	  3726#	  3727	  3727#	  3766#	  3766
ZZ1	    94#	    94	   108#	   108	   166#	   167	   168#	   169	   170#	   171	   172#	   173	   174#	   175
	   176#	   177	   178#	   179	   180#	   181	   182#	   183	   184#	   185	   186#	   187	   188#	   189
	   190#	   191	   192#	   193	   194#	   195	   196#	   197	   198#	   199	   200#	   201	   202#	   203
	   204#	   222#	   222	   277#	   277	   324#	   324	   596#	   596	   649#	   649	   697#	   697	   715#
	   715	   730#	   730	   867#	   867	   874#	   874	   877#	   877	   883#	   883	   887#	   887	   891#
	   891	   895#	   895	   898#	   898	   956#	   956	   981#	   981	  1082#	  1082	  1178#	  1178	  1193#
	  1193	  1207#	  1207	  1225#	  1225	  1234#	  1234	  1236#	  1236	  1381#	  1381	  1390#	  1390	  1397#
	  1397	  1408#	  1408	  1479#	  1479	  1546#	  1546	  1556#	  1556	  1587#	  1587	  1625#	  1625	  1648#
	  1648	  1663#	  1663	  1667#	  1667	  1668#	  1668	  1735#	  1735	  1746#	  1746	  1751#	  1751	  1813#
	  1813	  1815#	  1815	  1843#	  1843	  1956#	  1956	  1990#	  1990	  1997#	  1997	  2195#	  2195	  2217#
	  2217	  2298#	  2298	  2342#	  2342	  2380#	  2380	  2389#	  2389	  2446#	  2446	  2482#	  2482	  2485#
	  2485	  2488#	  2488	  2512#	  2512	  2515#	  2515	  2518#	  2518	  2525#	  2525	  2528#	  2528	  2532#
	  2532	  2545#	  2545	  2548#	  2548	  2551#	  2551	  2563#	  2563	  2566#	  2566	  2568#	  2568	  2600#
	  2600	  2618#	  2618	  2621#	  2621	  2624#	  2624	  2663#	  2663	  2673#	  2673	  2738#	  2738	  2745#
	  2745	  2794#	  2794	  3522#	  3522	  3523#	  3523	  3525#	  3525	  3526#	  3526	  3528#	  3528	  3529#
	  3529	  3531#	  3531	  3532#	  3532	  3534#	  3534	  3535#	  3535	  3537#	  3537	  3538#	  3538	  3542#
	  3542	  3543#	  3543	  3547#	  3547	  3548#	  3548	  3552#	  3552	  3553#	  3553	  3766#	  3766
%COW	   865%	   915	   916
%COW.N	   865%	   903	   904	   912	   919	   921
%UPLMA	   865%	   912	   919
%UPT	   221	   280	   317	   368%	   389	   551	   558	  1086	  1121	  1122	  1146	  1150	  1165	  1168
	  1182	  1185	  1187	  1195	  1198	  1205	  1258	  1259	  1654	  1754	  1968	  1972	  1984	  1988
	  1994	  2003	  2011	  2050	  2090	  2094	  2170	  2182	  2235	  2254	  2256	  2311	  2480	  2530
	  2535	  2616	  2935	  2955	  2977	  3093	  3106	  3121	  3143%	  3176	  3207	  3208	  3285	  3286
	  3287	  3288	  3315	  3372
%UPT.N	   368%	   502	   505
%UPX	   368%	   469	   470	   472	   473	   474	   475	   477	   478	   479	   482	   484	   486	   491
	   530	   551	   552	   566	   567	   568	   569	   656	   660	   873	   884	   965	   966	  1008
	  1024	  1027	  1028	  1029	  1030	  1046	  1047	  1053	  1229	  1233	  1234	  1332	  1336	  1337
	  1432	  1553	  1575	  1578	  1647	  1652	  1659	  1660	  1662	  1663	  1665	  1895	  2077	  2116
	  2202	  2273	  2306	  2500	  2537	  2554	  2557	  2627	  3143%	  3222	  3249
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

%UPX.N	   368%	   466	   570
.ARCLR	  1266
.ARGVC	  2798
.ARGVP	  2806
.ARHLT	  1423
.ARMAX	  3149
.ARPLC	  1378	  1394
.ARRAC	   870
.ARRDS	  1572
.ARRFI	  1636	  1887
.ARRUN	  1550
.ARSAA	   959	  1106	  1107	  1224
.ARSIZ	   567	   569	  2075	  2076	  2770	  3286	  3288	  3327	  3350	  3351	  3353	  3355	  3356	  3358
	  3359	  3555
.ARSMF	  2196
.ARSTP	  1453
.ARSVA	   982	  1103	  1222	  1510
.ARTKP	  2829
.ARVAR	  1308	  1309
.ARVAW	  1306	  1307	  1474	  1638
.ARWAC	   880
.FDFAM	   595	  3374
.FDFRH	  1226	  1237	  1957	  1996	  2164
.FDOTF	  3371
.FDSLF	  2978
.FHART	  1094	  2063	  2064	  2074	  2076	  2236	  2237	  2491	  2492	  2695	  2696	  3179
.FHFNO	  1088	  2481	  3124
.FHFRM	  1100	  2069	  2110	  2119	  2152	  2497	  2544	  3195
.FHLIC	  2054	  2055	  2088	  2101	  2113	  2127	  2495	  2562	  3183
.FHMAX	  2148
.FHPNO	  1096	  2059	  2062	  2092	  2104	  2118	  2131	  2246	  2487	  3191
.FHPRC	  1095	  2060	  2070	  2085	  2098	  2150	  2239	  2503	  2511	  2524	  2617	  3188
.FHSIZ	  1976	  2004	  2012	  2173	  2184
.FHTYP	  1093	  2029	  2051	  2068	  2238	  2494	  3182
.FHUID	  1089	  2031	  2484	  3123	  3186
.FMCHL	   595
.FMMAX	  3376
.FOCAR	   190#
.FOCER	   191#
.FOCFH	   176#
.FOCFM	   167#
.FOCHR	   183#
.FOCLR	   178#
.FOCON	   187#
.FOCSI	   202#
.FODFH	   177#
.FODIS	   204#
.FOENA	   203#
.FOFRC	   200#
.FOGET	   192#
.FOGFT	   186#
.FOGIN	   188#
.FOHLT	   171#
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

.FOHST	   185#
.FOJMP	   166#
.FOPRJ	   201#
.FORAR	   180#
.FOREP	   173#	   908
.FORER	   181#
.FORFA	   196#
.FORPC	   172#
.FORSI	   179#
.FORUN	   193#
.FORVA	   168#
.FOSAA	   170#	  1238	  1241
.FOSAV	   194#
.FOSMF	   182#
.FOSSA	   195#
.FOSTP	   199#
.FOSVA	   184#	  1243
.FOVCH	   189#
.FOVCL	   175#
.FOVRM	   174#
.FOWFA	   197#
.FOWVA	   169#
.FOXFA	   198#
.IAECF	   241#
.IALCF	   239#
.IANIC	   243#
.IASIA	   254#	   312
.IASIC	   250#	   320
.IASIP	   248#	   313
.IASIS	   252#	   316
.JBDDT	  1000%	  1000
.JBREN	   999%	   999
.JBSA	   997%	   997	   998
.UA0	  3615#	  3633
.UA1	  3615#	  3633
.UA10	  3615#	  3633
.UA11	  3615#	  3633
.UA12	  3611#	  3633	  3634
.UA13	  3611#	  3634
.UA14	  3616#	  3634	  3635
.UA15	  3616#	  3635
.UA16	  3612#	  3635	  3636
.UA17	  3612#	  3636
.UA2	  3615#	  3633
.UA20	  3612#	  3636
.UA21	  3612#	  3636
.UA22	  3612#	  3636
.UA23	  3617#	  3636	  3637
.UA24	  3617#	  3637
.UA25	  3613#	  3637	  3638
.UA26	  3613#	  3638
.UA27	  3613#	  3638
.UA3	  3615#	  3633
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Symbol cross reference

.UA30	  3613#	  3638
.UA31	  3613#	  3638
.UA32	  3613#	  3638
.UA4	  3615#	  3633
.UA5	  3615#	  3633
.UA6	  3615#	  3633
.UA7	  3615#	  3633
.UAMAX	  2327	  2388	  3611	  3612	  3613	  3615	  3616	  3617	  3630
.UAWMX	  2327#	  2333	  2449	  2603	  2727
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Macro/Opdef cross reference

ARBITS	  3517#	  3522	  3525	  3528	  3531	  3534	  3537	  3542	  3547	  3552
ARCALL	  3522	  3525	  3528	  3531	  3534	  3537	  3542	  3547	  3552	  3611
ARDO	  3511#	  3522	  3523	  3525	  3526	  3528	  3529	  3531	  3532	  3534	  3535	  3537	  3538	  3542
	  3543	  3547	  3548	  3552	  3553	  3595#	  3611	  3615
ARMAC	  3522	  3523	  3525	  3526	  3528	  3529	  3531	  3532	  3534	  3535	  3537	  3538	  3542	  3543
	  3547	  3548	  3552	  3553	  3611	  3615
BITGEN	  3505#	  3522	  3523	  3525	  3526	  3528	  3529	  3531	  3532	  3534	  3535	  3537	  3538	  3542
	  3543	  3547	  3548	  3552	  3553
BTXGEN	  1073#	  1077	  1078
BTXNE	  1077#
BTXNN	  1078#	  1103	  1106
CALUAR	  3623#	  3633	  3634	  3635	  3636	  3637	  3638
CHLDBP	  2848	  2850	  2877	  2895	  2912	  2915	  2936
EXECAC	  1204
FRMERS	  3654#	  3695	  3733
FRMOGN	   112#	   165
FRMOP	   909	  1245
GENUAR	  3591#	  3611	  3612	  3613	  3615	  3616	  3617	  3625#	  3633	  3634	  3635	  3636	  3637	  3638
HTPPTR	  1093	  2051	  2068	  2147	  2238	  2494	  3182
IFCPU	   471	  1143	  1149
IFNCPU	  1143	  1149
NEIGBP	  2849	  2881	  2888	  2889	  2894	  2898	  2918	  2920	  2940
PFALL	  1015	  1108
PJRST	   638	   782	   827	   962	   967	   984	   994	  1033	  1058	  1262	  1273	  1339	  1445	  1465
	  1491	  1521	  2007	  2014	  2095	  2106	  2120	  2123	  2134	  2175	  2205	  2206	  2277	  2496
	  2501	  2507	  2521	  2540	  2558	  2572	  2631	  3038	  3225	  3377
PRINTF	   777
PRNTBP	   318	  2816	  2827	  2851	  2868	  2875	  2899	  2916	  2956	  3094	  3212
PXCT	    94	   108	   222	   277	   324	   596	   649	   697	   715	   730	   867	   874	   877	   883
	   887	   891	   895	   898	   956	   981	  1082	  1178	  1193	  1207	  1225	  1234	  1236	  1381
	  1390	  1397	  1408	  1479	  1546	  1556	  1587	  1625	  1648	  1663	  1667	  1668	  1735	  1746
	  1751	  1813	  1815	  1843	  1956	  1990	  1997	  2195	  2217	  2298	  2342	  2380	  2389	  2446
	  2482	  2485	  2488	  2512	  2515	  2518	  2525	  2528	  2532	  2545	  2548	  2551	  2563	  2566
	  2568	  2600	  2618	  2621	  2624	  2663	  2673	  2738	  2745	  2794	  3766
PXGEN	    94	   108	   222	   277	   324	   596	   649	   697	   715	   730	   867	   874	   877	   883
	   887	   891	   895	   898	   956	   981	  1082	  1178	  1193	  1207	  1225	  1234	  1236	  1381
	  1390	  1397	  1408	  1479	  1546	  1556	  1587	  1625	  1648	  1663	  1667	  1668	  1735	  1746
	  1751	  1813	  1815	  1843	  1956	  1990	  1997	  2195	  2217	  2298	  2342	  2380	  2389	  2446
	  2482	  2485	  2488	  2512	  2515	  2518	  2525	  2528	  2532	  2545	  2548	  2551	  2563	  2566
	  2568	  2600	  2618	  2621	  2624	  2663	  2673	  2738	  2745	  2794	  3766
RSIMAC	  2394#	  2408
SETMAP	  1131#	  1143	  1149
STOPCD	    11	   465	   468	   572	   923	  2036	  2037	  2039	  2040	  2041	  2222	  2223	  2461	  2462
	  3083	  3084	  3161	  3162
SWAPIN	   660
TABENT	  1882#	  1887
UHRRZ	   730	   867	   877	  2794
UMOVE	    94	   697	   715	   883	   898	   956	   981	  1082	  1225	  1236	  1381	  1397	  1479	  1546
	  1625	  1735	  1746	  1751	  1813	  1956	  1990	  2195	  2217	  2298	  2380	  2446	  2600
UMOVEM	   108	   222	   277	   324	   596	   874	   887	   895	  1207	  1390	  1408	  1587	  1815	  1843
	  2389	  2482	  2485	  2488	  2512	  2515	  2518	  2525	  2528	  2532	  2545	  2548	  2551	  2563
	  2566	  2568	  2618	  2621	  2624	  3766
USERAC	  1166	  1183	  1196
FRMSER - Frame-OP UUO and job assignment	MACRO 12.5-46.0 14:27 13-JAN-88
FRMSER.MAC	 8-DEC-87 16:09		Macro/Opdef cross reference

VCLEAR	   922
VPROT	   467	   571
WRUBR	  1145	  1149
X	   155#	   166	   167	   168	   169	   170	   171	   172	   173	   174	   175	   176	   177	   178
	   179	   180	   181	   182	   183	   184	   185	   186	   187	   188	   189	   190	   191	   192
	   193	   194	   195	   196	   197	   198	   199	   200	   201	   202	   203	   204	  2407#	  2409
	  2410	  2411	  2412	  2413	  2414	  2415	  2416	  2417	  3522#	  3522	  3523#	  3523	  3525#	  3525
	  3526#	  3526	  3528#	  3528	  3529#	  3529	  3531#	  3531	  3532#	  3532	  3534#	  3534	  3535#	  3535
	  3537#	  3537	  3538#	  3538	  3542#	  3542	  3543#	  3543	  3547#	  3547	  3548#	  3548	  3552#	  3552
	  3553#	  3553	  3611#	  3611	  3612	  3613	  3615#	  3615	  3616	  3617	  3688#	  3696	  3697	  3698
	  3699	  3700	  3701	  3702	  3703	  3704	  3705	  3706	  3707	  3708	  3709	  3710	  3711	  3712
	  3713	  3714	  3715	  3716	  3717	  3718	  3719	  3720	  3721	  3722	  3723	  3724	  3725	  3726
	  3730#	  3734	  3735	  3736	  3737	  3738	  3739	  3740	  3741	  3742	  3743	  3744	  3745	  3746
	  3747	  3748	  3749	  3750	  3751	  3752	  3753	  3754	  3755	  3756	  3757	  3758	  3759	  3760
	  3761	  3762	  3763	  3764
XCTBU	   730	   867	   877	   891	  1193	  2663	  2673	  2794
XCTFU	    94	   697	   715	   883	   898	   956	   981	  1082	  1178	  1225	  1234	  1236	  1381	  1397
	  1479	  1546	  1625	  1663	  1735	  1746	  1751	  1813	  1956	  1990	  2195	  2217	  2298	  2342
	  2380	  2446	  2600	  2738	  2745
XCTTU	   108	   222	   277	   324	   596	   649	   874	   887	   895	  1207	  1390	  1408	  1556	  1587
	  1648	  1667	  1668	  1815	  1843	  1997	  2389	  2482	  2485	  2488	  2512	  2515	  2518	  2525
	  2528	  2532	  2545	  2548	  2551	  2563	  2566	  2568	  2618	  2621	  2624	  3766
XP	   166	   167	   168	   169	   170	   171	   172	   173	   174	   175	   176	   177	   178	   179
	   180	   181	   182	   183	   184	   185	   186	   187	   188	   189	   190	   191	   192	   193
	   194	   195	   196	   197	   198	   199	   200	   201	   202	   203	   204	   759	  1071	  2327
	  2720	  2973	  3696	  3697	  3698	  3699	  3700	  3701	  3702	  3703	  3704	  3705	  3706	  3707
	  3708	  3709	  3710	  3711	  3712	  3713	  3714	  3715	  3716	  3717	  3718	  3719	  3720	  3721
	  3722	  3723	  3724	  3725	  3726
Y	  3582#	  3611	  3612	  3613	  3615	  3616	  3617	  3633	  3634	  3635	  3636	  3637	  3638
$END	  3769/@N
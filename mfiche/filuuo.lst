FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE	FILUUO	DISK SERVICE ROUTINE
     9
    10					STOPCD(,ENTRY,FILUUO)^
    11					ENTRY	FILUUO		;For library searches
    12	000000'	260040	000000*	FILUUO::PUSHJ	P,DIE		;**** Default stopcode for "FILUUO" ****
    13	000001'	465154	656557		SIXBIT	/FILUUO/  	;Title of module
    14	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "FILUUO+nnn(nnnnnn)"
    15			000000'	S$NAME==FILUUO			;For STOPCDs with no arguments
    16					SALL>
    17				^
    18
    19				;DEFINITIONS IN M
    20
    21			400000	UUOLUK==400000	;UUO IS A LOOKUP
    22			200000	EXTUUO==200000	;EXTENDED UUO
    23			100000	UUOMLK==100000	;MULTIPLE EXTENSION LOOKUP
    24			040000	UUOENT==040000	;UUO IS AN ENTER
    25			020000	UUOUFD==020000	;FILE UUO DEALS WITH IS A UFD
    26			010000	UUOREN==010000	;UUO IS A RENAME
    27			004000	UUOSIM==004000	;SET IN UPDATE IF ITS SIMULTANEOUS STYLE
    28			002000	UUOIRE==002000	;SET SO THAT FILFND STILL LEAVES ATB COUNT UP IF RIB ERROR,
    29						; WITH INFO FROM UFD IN THE ATB.
    30			777777	UUOMSK==777777	;CLEAR ALL BITS INCLUDING INDEX AND INDIR
    31
    32				;BITS IN UUXNUM.
    33			200000	UUPWDS==200000	;ENTER/RENAME--ALLOCATION WORD IS IN UNITS
    34						;OF WORDS, NOT BLOCKS.
    35			100000	UUPPID==100000	;LOOKUP/ENTER/RENAME - PID ACCESS BIT
    36
    37				INTERNAL UUOLUK,EXTUUO,UUOMLK,UUOENT,UUOUFD,UUOREN,UUOIRE
    38				INTERNAL DSKRES,DSKKJB,JOBSTR,DSKDSP
    39				INTERNAL PRTWDW,PRTWDR
    40				INTERNAL UUPPID
    41
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 2
FILUUO.MAC	 8-DEC-87 11:25		S.MAC - with system parameter file for P035/D, January 1988

    42				;EXTERNALS FROM OTHER PARTS OF THE MONITOR
    43
    44				EXTERNAL GETWDS,GIVWDS,TPOPJ,CPOPJ,CPOPJ1,TPOPJ1,PJOBN,WATPCB
    45				EXTERNAL KMAPP,KFDEL,KFCRE,KFEXC,IOSERR,IOSRBE,IOSRIB,IOSUPR,KSMAPP
    46				EXTERN KVLRIB,KFFIFP,KFTRN,KMOVPG
    47				EXTERNAL JBTPRV,JBTPPN,JBTUNM,JBTUN1,JBTAUN,JBTSER
    48				EXTERN NORED,NOWRT,PIDACC
    49				EXTERNAL JBTDLK,JBTSLK,JBTERN,JBTLIC,JBYWPT,UPTPJC	;-
    50				EXTERNAL UPTPID,UPTSPD
    51				EXTERNAL TIME,JFYSEC,THSDAT,WAIT1,HIGHJB,JOB,UPTJDA,CLOSE1
    52				EXTERNAL UPTRIB,UPTRB2,UPTSAT,QUEPCB,JBTABT,JBTSTS,CPOPJ2
    53				EXTERNAL SYDNM4,STOIOS,SAVE4,GET4WD,GIV4WD,PWAIT1,CURUPT,EPT,ONCTIM
    54				EXTERNAL UPTPDL,DATCOM,%UPT
    55				EXTERNAL PDNMUP
    56
    57				;EXTERNAL IN OTHER PARTS OF FILSER
    58
    59				EXTERNAL SRCFIL,CHKPRV,FREATB,GETCBR,INVDDB,RIBRDL,RIBWTL,ZERDDB
    60				EXTERNAL RELLOK,SRCNAM,DLTTRC,FNDDRB,GIVCBR
    61				EXTERN GIVCB1,%RIB.C,MAPWLN,DLTNAM,USETI0,USETO0,DLTALL,%CTUPT
    62				EXTERNAL DIRSRC,TSTWRT,LKDATB,ULKDBL,TSTWRS
    63				EXTERNAL LOKPPB,NLKPPB,DEVLG,GUFBT,GIVCB1,RMVATB
    64				EXTERNAL MAPWTL,%RB2.C,MAPRLS,MAPXCH,GETER1,RIBDIR,MAPRDU
    65				EXTERNAL DIRBLK,PTROUT,CRBRWL,INSNAM,RRSETB,FPCSET
    66				EXTERNAL PCBCLR,PTROU2,GIVPAG,UUOSEK
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 3
FILUUO.MAC	 8-DEC-87 11:25		S.MAC - with system parameter file for P035/D, January 1988

    67				;EXTERNAL IN COMMOD
    68
    69				EXTERNAL MFDPPN,SYSPPN,SYSDRB,UFDPRT,STNPRT,DSKDDB
    70				EXTERNAL CBUSER,INDPPN,SYSCOR,SYSUNI,ETSUNI,METSLN,ETSTAB
    71				EXTERNAL STRDDB,STRNAM,STRTAL,STROVR,STRNXT,STRUNI,STRSID,STRLEN
    72
    73				EXTERNAL UNILOG,UNINAM,UNISYS,UNIKON,UNIDES,UNITAL,UNICHR
    74				EXTERNAL UNIFEP,UNIPPU,UNIHID,UNISTR
    75				EXTERNAL UNYSIZ,UNYSPU,UNYWPS
    76
    77				EXTERNAL DEVATB,DEVDRB,DEVDBL,DEVELB,DEYTCT,DEYSTC
    78				EXTERNAL DEVRB1,DDBCOR,DDBLEN,DEVRIB,DEVRET,DEVFLO,DEVPOS
    79				EXTERNAL PTRCHG
    80
    81				EXTERNAL ATBFNB,ATBCNT,ATBSIZ,ATBPVW,ATBMSC,ATBLIC,ATBALP,ATBSTS
    82				EXTERNAL ATBRIB,ATBPRV,ATBLCW,ATBDOR,ATBLNK,ATBMWC,ATBUMC
    83				EXTERNAL ATBPID
    84				EXTERNAL ATPMXU,ATPDIR,ATPCRE,ATPNDL,ATPDEL,ATPUPD,ATPDMP,ATMCNT,ATPCNT
    85				EXTERNAL ATPSUP,ATPREN,ATPUFE,ATPPID,ATPALC,ATMCSC,ATMUFP,ATMUFU,ATMMWC,ATMUMC
    86				EXTERNAL ATYBSZ,ATYBLK,ATYXCD,ATYCTM,ATYCSC,ATYCTD,ATYCDT
    87				EXTERNAL ATYCNT,ATYPRV,ATYADT,ATYUF1,ATYUF2
    88
    89				EXTERNAL FNBEXT,FNBAPD,FNBNX,FNBRIB,FNBNAM,FNBDRB,FNBLNK,FNBUPD,FNBALT
    90				EXTERNAL FNPNX,FNBATB,FNBDBL,FNYUFP
    91
    92				EXTERNAL FNCLOK,FNCRED,FNCEXC,FNCCRE,FNCSUP,FNCAPP
    93				EXTERNAL FNCUPD,FNCTRN,FNCCAT,FNCDEL,FNCCNM,FNCCPR
    94
    95				EXTERNAL DRBCNT,DRBRIB,DRBALC,DRBMXA,DRBLNK,DRBUNM,DRBUN1,DRBNAM
    96				EXTERNAL DRBNX,DRBFNB,DRYPRV,DRYCNT
    97				EXTERNAL DRPMXC,DRPNX,DRMCNT,DRPLOG,DRBLOG
    98
    99				EXTERNAL RIBVER,RIBFUT,RIBPPN,RIBEST,RIBEXT,RIBPVW,RIBNAM,RIBPOS
   100				EXTERNAL RIBFT1,RIBLCW,RIBMTA,RIBDEV,RIBSTS,RIBELB,RIBXT1,RIBQTF
   101				EXTERNAL RIBQTO,RIBAUT,RIBUNM,RIBUN1,RIBTRU,RIBXT2,RIBSNM,RIBALC
   102				EXTERNAL RIBUSD,RIBMXA,RIBPID,RIBCOD,CODRIB,RIBSLF,RIBSZS,RBMASK
   103				EXTERNAL RIBALT
   104				EXTERNAL RIPDIR,RIPHRE,RIPHWE,RIPLOG,RIBPFS,RIPNFS,RIPUFE,RIPPID
   105				EXTERNAL RBYPN1,PTSPNO,PTNPNO,RBYUN1,RIBRIB,RIBSIZ,RIBALP,RIPBDR
   106				EXTERNAL RIBPJC,RIBPJ1,RIBPJ2	;-
   107				EXTERNAL RIPBDA,RIPBFS,RIBLST,RBDLTA,RBINDX,RIPSPP,RIPBDR
   108
   109				EXTERNAL STRHSH
   110
   111				EXTERNAL STRBTS,SRPNDS
   112
   113				EXTERNAL CMBLNK
   114
   115				EXTERNAL KONLTM
   116
   117				EXTERNAL UFPERR,UFDERR,UFDALP,UFDCDT,UFDEXT,UFDLIC,UFDNAM,UFDRIB
   118				EXTERNAL UFYCTM,UFYPRV,UFYUF1,UFYUF2,UFYXCD,RBREAL,UFDSIZ
   119				EXTERNAL UFYCDT,UFDLNK
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 3-2
FILUUO.MAC	 8-DEC-87 11:25		S.MAC - with system parameter file for P035/D, January 1988

   120
   121				;EXTERNS FROM SIMIO MODULE
   122				EXTERN USETI0,USETO0,INBLT,OUTBLT,SIMRLS
   123				EXTERN UPTPOS
   124				EXTERN PCDTIM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 4
FILUUO.MAC	 8-DEC-87 11:25		S.MAC - with system parameter file for P035/D, January 1988

   125				COMMENT ! **************************************************
   126
   127						DISK  DISPATCH  TABLE   DSKDSP
   128
   129						( DEVSER(F) POINTS HERE )
   130				***********************************************************!
   131
   132	777776				PHASE -2
   133	000003'	254000	000000*	DDO:	JRST	OUTBLT		;DUMP OUTPUT
   134	000004'	254000	000000*	DDI:	JRST	INBLT		;DMP INPUT.  SEE SIMIO
   135	000005'				DEPHASE
   136	000005'			DSKDSP:
   137	000000				PHASE 0
   138	000005'	000000	000037	DDXZ:	DSPSIZ
   139	000006'	263040	000000	DDINT:	POPJ	P,
   140	000007'	004400	004400	DBYT:	4400,,4400
   141	000010'	201300	000000*	DVSIZ:	MOVEI	T1,DDBLEN
   142	000011'	263040	000000	DINI:	POPJ	P,
   143	000012'	254000	000000*	DHNG:	JRST	CPOPJ1
   144	000013'	254000	001773'	DRL:	JRST	DSKREL		;CALLS CLOS IN/OUT WHICH CALL SIMRLS
   145	000014'	254000	001216'	DCL:	JRST	CLOSOU
   146	000015'	256000	000000'	DOU:	STOPCD			;BUFF OUTPUT. SIMBOU USES DDO EXCLUSIVELY
   147	000016'	256000	000000'	DIN:	STOPCD			;BUFF INPUT, SIMBIN USES DDI EXCLUSIVELY
   148	000017'	263040	000000	DZAP:	POPJ	P,		;FORGET ZAP
   149	000020'	263040	000000	DGTRD:	POPJ	P,		;FORGET GET READY
   150	000021'	263040	000000	DMT:	POPJ	P,
   151	000022'	254000	000155'	DGF:	JRST	DSKUGF
   152	000023'	254000	002271'	DEN:	JRST	UENTR
   153	000024'	254000	002026'	DLK:	JRST	ULOOK
   154	000025'	254000	003523'	DRN:	JRST	RENAM
   155	000026'	254000	000000*	DSI:	JRST	USETI0
   156	000027'	254000	000000*	DSO:	JRST	USETO0
   157	000030'	254000	001007'	DCLI:	JRST	CLOSIN
   158	000031'	254000	000271'	DUFD:	JRST	UFDUUO
   159	000032'	254000	000000*	DSEK:	JRST	UUOSEK
   160	000033'	254000	000000*	DVMAP:	JRST	KMAPP
   161	000034'	254000	000000*	DFDEL:	JRST	KFDEL
   162	000035'	254000	000000*	DFCRE:	JRST	KFCRE
   163	000036'	254000	000000*	DFEXC:	JRST	KFEXC
   164	000037'	254000	002553'	DSIM:	JRST	USIMUP		;SIMULTANEOUS UPDATE CHANIO
   165	000040'	254000	000000*	DFVLR:	JRST	KVLRIB
   166	000041'	254000	000000*	DVSMAP:	JRST	KSMAPP
   167	000042'	254000	000000*	DFFIF:	JRST	KFFIFP
   168	000043'	254000	000000*	DFTRN:	JRST	KFTRN
   169	000044'	254000	000000*	DMOVPG:	JRST	KMOVPG		;MAKE VP MAPPABLE FROM FILE
   170			000037		DSPSIZ==.-1
   171	000045'				DEPHASE
   172
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 5
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   173				SUBTTL	INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR
   174
   175				INTERN	TSTDSK,SETDDB,CLRDDB
   176
   177				;SUBROUTINE TO SAVE AND RESTORE TEMP ACS
   178				;CALLED BY PUSHJ P,SAVT   RETURN EITHER CPOPJ OR CPOPJ1 WHEN THROUGH
   179				INTERN SAVT
   180	000045'	250441	000000	SAVT:	EXCH	T4,(P)		;SAVE T4, GET RETURN ADR.
   181	000046'	261040	000010		PUSH	P,T3		;SAVE T3
   182	000047'	261040	000007		PUSH	P,T2		;AND T2
   183	000050'	260051	000000		PUSHJ	P,(T4)		;RETURN TO CALLER
   184	000051'	334000	000000		  SKIPA			;POPJ RETURN
   185	000052'	350001	777775		AOS	-3(P)		;CPOPJ1 - SET SKIP RETURN
   186	000053'	262040	000007		POP	P,T2		;RESTORE T3 ACS
   187	000054'	262040	000010		POP	P,T3
   188	000055'	262040	000011		POP	P,T4
   189	000056'	263040	000000		POPJ	P,		;AND RETURN
   190
   191				;SUBROUTINE TO TEST IF THE DEVICE WHOSE NAME IS IN T1 IS A DISK
   192				;ENTER WITH J (=J)= JOB NUMBER
   193				;EXIT CPOPJ IF A DISK, WITH F=PROTOTYPE DDB
   194				;EXIT CPOPJ1 IF NOT A DISK, OR A SINGLE-ACCESS DISK NOT FOR THIS JOB
   195				;CALLED BY DEVPHY
   196	000057'	322300	000012*	TSTDSK:	JUMPE	T1,CPOPJ1	;"0" IS NOT A DISK
   197	000060'	260040	000045'		PUSHJ	P,SAVT		;SAVE T2-T4
   198	000061'	201200	000000*		MOVEI	F,DSKDDB	;SET F FOR PROTOTYPE DDB
   199	000062'	260040	005671'		PUSHJ	P,ALIASD	;IS NAME AN ALIAS FOR "DSK"?
   200	000063'	263040	000000		  POPJ	P,		;YES. NON-SKIP RETURN
   201	000064'	316300	006024'		CAMN T1,[SIXBIT /DSKB/]	;CHECK FOR STR NAME
   202	000065'	263040	000000		  POPJ	P,
   203	000066'	260040	005757'		PUSHJ	P,SRUNI		;IS USER SUPPLYING A UNIT NAME?
   204	000067'	254000	000057*		  JRST	CPOPJ1		;NOT A DISK - SKIP RETURN
   205	000070'	255000	000000		  JFCL			;PHYSICAL DSK NAME (Logical unit return)
   206	000071'	550405	000000*		HRRZ	T3,UNISTR(U)	;YES, SET T3 TO STR DB LOC
   207	000072'	326400	000000*		JUMPN	T3,CPOPJ	;JOB MUST BE PRIVILEGED IF UNIT NOT IN AN STR
   208	000073'	205400	004000		MOVSI	T3,LICSTR
   209	000074'	616402	000000*		TDNN	T3,JBTLIC(J)	;SPECIAL FOR LICENSED JOB
   210	000075'	350001	000000		  AOS	(P)		;NO, ERROR RETURN
   211	000076'	263040	000000		POPJ	P,		;YES, OK RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 6
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   212				;SUBROUTINE TO CLEAN UP THE ACCESS TABLES FOR A JOB AFTER A SWAP-READ ERROR
   213				;SCANS THE DDB'S, WHEN IT FINDS ONE FOR THE JOB IT FIXES IT-
   214				; DECREMENTS THE READ-COUNT IF READING, CLEARS THE STATUS BYTE IF WRITING
   215				; AND INCREMENTS THE QUOTA IF CREATE OR SUPERSEDE
   216				;IT EXITS BY RETURNING ANY SYSTEM RESOURCES THE JOB MIGHT HAVE
   217	000077'	201200	000061*	SWPCLN:	MOVEI	F,DSKDDB	;START AT PROTOTYPE DDB
   218	000100'	265440	000000*		JSP T4,SAVE4	;SAVE SOME TEP ACS TO WORK IN (FOR CALLS)
   219	000101'	554204	000003	SWPCL1:	HLRZ	F,DEVSER(F)	;LINK TO NEXT DDB
   220	000102'	322200	000072*		JUMPE	F,CPOPJ		;DONE IF 0
   221	000103'	200304	000004		MOVE	T1,DEVMOD(F)
   222	000104'	607300	200000		TLNN	T1,DVDSK	;IS THIS DDB A DISK?
   223	000105'	263040	000000		POPJ P,			;NO, THROUGH
   224	000106'	135300	000000*		LDB	T1,PJOBN	;YES, SAME JOB?
   225	000107'	312300	000002		CAME	T1,J
   226	000110'	254000	000101'		JRST	SWPCL1		;NO, TRY NEXT DDB
   227	000111'	336644	000000*		SKIPN P2,DEVATB(F)
   228	000112'	254000	000101'		JRST SWPCL1
   229	000113'	554740	000015		HLRZ P4,P2	;DRB POINTER
   230	000114'	550715	000000*		HRRZ P3,ATBFNB(P2)
   231	000115'	553000	000015		HRRZS P2
   232	000116'	135300	000000*		LDB T1,DEYSTC	;WHAT WERE WE DOING
   233	000117'	201340	000000		MOVEI T2,0
   234	000120'	137340	000116*		DPB T2,DEYSTC
   235	000121'	256006	000122'		XCT .+1(T1)
   236	000000				PHASE 0
   237	000122'	254000	000101'		JRST SWPCL1
   238	000123'	254000	000141'	DECLUK:!JRST SWPLUK
   239	000124'	254000	000134'	DECUPD:!JRST SWPUPD
   240	000125'	254000	000152'	DECUP2:!JRST SWPUP2	;WAS UPDATING BUT INPUT CLOSED
   241	000126'	254000	000130'	DECENT:!JRST SWPENT	;FOR SUPERCEDE OR RENAME
   242	000127'	256000	000000'	DECSTP:! STOPCD (SLO)
   243					;IN THE MIDDLE OF A UUO
   244	000130'				DEPHASE
   245
   246	000130'	200315	000000*	SWPENT:	MOVE T1,ATBALP(P2)	;NUMBER OF PAGES ALLOCATED
   247	000131'	272317	000000*		ADDM T1,DRBALC(P4)	;RETURN TO HIS QUOTA
   248	000132'	260040	000000*		PUSHJ P,FREATB	;RETURN ATB TO FREE STORAGE
   249	000133'	254000	000144'		JRST SWPLK1	;AND RESET A FEW THINGS
   250
   251	000134'	201300	000000*	SWPUPD:	MOVEI T1,ATPUPD
   252	000135'	412315	000000*		ANDCAM T1,ATBSTS(P2)
   253	000136'	370317	000000*		SOS T1,DRBCNT(P4)
   254	000137'	602300	000000*		TRNE T1,DRPMXC
   255	000140'	256000	000000'		 STOPCD (SLO)
   256				           ;;SWPUPD+4
   257	000141'	370315	000000*	SWPLUK:	SOS T1,ATBCNT(P2)
   258	000142'	606300	000000*	SWPLK2:	TRNN T1,ATMCNT!ATPUPD!ATPREN
   259	000143'	260040	000000*		PUSHJ P,LKDATB	;MAKE DORMANT IF NOT IN USE
   260	000144'	370317	000136*	SWPLK1:	SOS T1,DRBCNT(P4)
   261	000145'	602300	000137*		TRNE T1,DRPMXC
   262	000146'	256000	000000'		 STOPCD (SLO)
   263				           ;;SWPLK1+2
   264	000147'	402004	000111*		SETZM DEVATB(F)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 6-2
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   265	000150'	260040	000000*		PUSHJ P,ULKDBL
   266	000151'	254000	000101'		JRST SWPCL1
   267
   268	000152'	205300	000134*	SWPUP2:	MOVSI T1,ATPUPD
   269	000153'	413315	000135*		ANDCAB T1,ATBSTS(P2)
   270	000154'	254000	000142'		JRST SWPLK2
   271
   272				INTERNAL SWPCLN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 7
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   273				;UGETF
   274
   275				COMMENT ! ROUTINE DSKUGF -- UGETF FOR DSK FILE.
   276				FUNCTION: RETURN TO USER LOC/ CURRENT POSITION,,FILE SIZE UNLESS
   277					EITHER VALUE EXCEEDS 18 BITS OR NO LOOKUP/ENTER DONE
   278					(IN WHICH CASES -1).
   279				EXPECTS: M/ USER DATA LOCN ADDR
   280					F/ DDB
   281					W/ CHANNEL
   282				!
   283	000155'	260040	000000*	DSKUGF:	PUSHJ P,WAIT1
   284	000156'	211300	000001		MOVNI T1,1		;READY FOR ERROR RETURN
   285	000157'	550344	000147*		HRRZ T2,DEVATB(F)
   286	000160'	322340	000170'		JUMPE T2,DSKUG1	;NO LOOKUP/ENTER, ERROR
   287	000161'	135300	000000*		LDB	T1,ATYBSZ
   288	000162'	603300	777777		TLNE	T1,-1
   289	000163'	254000	000172'		JRST	DSKUG2
   290	000164'	200344	000000*		MOVE	T2,DEVPOS(F)
   291	000165'	603340	377777		TLNE	T2,377777	;DONT TEST USETI/O FLAG 1B0
   292	000166'	254000	000172'		JRST	DSKUG2
   293	000167'	505307	000000		HRLI	T1,(T2)
   294	000170'	256200	006025'	DSKUG1:	UMOVEM T1,(M)		;RETURN TO USER
   295	000171'	263040	000000		POPJ P,
   296	000172'	211300	000001	DSKUG2:	MOVNI	T1,1
   297	000173'	254000	000170'		JRST	DSKUG1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 8
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   298				; CALLED FROM COMMON IN CRASH CODE.
   299				;*;FILSTP::POPJ	P,	;DSKSTP:;GOOD PLACE TO WRITE SATS OUT
   300
   301				;HERE ON A LOGOUT, WHEN THERE ARE NO OTHER JOBS LOGGED IN UNDER THIS PPB
   302				;CALLED BY LOGOUT , WITH AC=PPN  (DSKLGO M)
   303	000174'	312300	000000*	DSKLGO:	CAME	T1,SYSPPN	;YES. IS JBTPPN FOR SYS?
   304	000175'	316300	000000*		CAMN	T1,MFDPPN	; OR AN MFD?
   305	000176'	263040	000000		  POPJ	P,		;YES, DONT DELETE  CORE BLOCKS
   306	000177'	260040	000000*		PUSHJ	P,GETCBR
   307	000200'	554340	000000*		HLRZ	T2,SYSDRB	;% NO. SET TO SEARCH DRB'S
   308	000201'	211400	000001		MOVNI	T3,1		;% DO NOT CREATE A NEW ONE
   309	000202'	260040	000000*		PUSHJ	P,SRCNAM	;% FIND PPB FOR THIS JOB
   310	000203'	322340	000000*		  JUMPE	T2,GIVCBR
   311	000204'	201300	000000*		MOVEI	T1,DRPLOG	;% FOUND - SET NLG
   312	000205'	412307	000000*		ANDCAM	T1,DRBLOG(T2)	;%  IN PPB BLOCK
   313	000206'	324740	000203*		PJRST	GIVCBR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 9
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   314				INTERNAL DSKCLR
   315				EXTERNAL ADJMWS
   316
   317				;CODE TO CLEAR CORE INFO (CALLED BY DSKFIXER)
   318
   319	000207'	254000	000235'	DSKCTB:	JRST	DSKCL2			;0  CLEAR IN-CORE DISK INFO
   320	000210'	254000	000226'		JRST	DSKCL3			;1  SET STTFPC FOR ALL SATS
   321	000211'	254000	000222'		JRST	DSKCL4			;2  CLEAR SRPNDS ONLY
   322			000003	DCTBSZ==.-DSKCTB
   323
   324				PRINTF(<[DSKCLR This entire UUO needs work, maybe a STRUUO function]>)
   325	000212'	200302	000074*	DSKCLR:	MOVE	T1,JBTLIC(J)
   326	000213'	641300	000003		TLC	T1,LICWFL+LICWPJ
   327	000214'	643300	000003		TLCE	T1,LICWFL+LICWPJ	;DOES HE HAVE WRITE ABSOLUTE??
   328	000215'	254000	000067*		  JRST	CPOPJ1
   329	000216'	135300	006026'		LDB	T1,[POINT 4,M,^D12]	;GET AC FIELD.
   330	000217'	301300	000003		CAIL	T1,DCTBSZ		;IS VALUE TOO LARGE?
   331	000220'	254000	000215*		  JRST	CPOPJ1			;YES
   332	000221'	256006	000207'		XCT	DSKCTB(T1)		;DISPATCH
   333
   334	000222'	201300	000000*	DSKCL4:	MOVEI	T1,SRPNDS		;CLEAR THE NEED DSKCLN FLAG
   30223'	412300	000000*		ANDCAM	T1,STRDDB+STRBTS	; FOR THIS STRUCTURE
   336	000224'	476000	000000*		SETOM	ADJMWS			;TURN MWS ADJUST
   337	000225'	263040	000000		POPJ	P,
   338	000226'	200301	000000*	DSKCL3:	MOVE	T1,PDNMUP(P)		;GET RETURN ADDR
   339	000227'	350001	000226*		AOS	PDNMUP(P)		;INC PAST ARG
   340	000230'	256200	006027'		UMOVE	T1,(T1)			;GET AOBJN WORD ADDR
   341	000231'	260040	000000*		PUSHJ	P, FPCSET		;SET FREE PGS
   342	000232'	370001	000000		SOS	0(P)
   343	000233'	476000	000224*		SETOM	ADJMWS			;TURN ON MWS ADJUST
   344	000234'	254000	000220*		JRST	CPOPJ1
   345	000235'	260040	000000*	DSKCL2:	PUSHJ	P,PCBCLR		;ZAP ALL SAT AND RIB PCBS.
   346	000236'	263040	000000		  POPJ	P,			;PCB I/O IN PROGRESS
   347	000237'	254000	000234*		  JRST	CPOPJ1			;CAN NOT CLEAR PCBS
   348	000240'	350000	000000*		AOS	%UPT+UPTPDL		;FOR MULTIPLE SKIP RETURN TO USER
   349	000241'	260040	000177*		PUSHJ	P,GETCBR
   350	000242'	554740	000200*		HLRZ	P4,SYSDRB		;% ALL DRB BLOCKS
   351	000243'	322740	000000*		JUMPE	P4,GIVCB1		;% SKIP RETURN, ALL DONE
   352	000244'	135300	000000*	DSKCL1:	LDB	T1,DRYCNT		;% GET COUNT
   353	000245'	326300	000206*		JUMPN	T1,GIVCBR		;% DRB IN USE, ERROR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 10
FILUUO.MAC	 8-DEC-87 11:25		INTERFACE SUBROUTINES WITH THE REST OF THE MONITOR

   354	000246'	554717	000000*		HLRZ	P3,DRBFNB(P4)		;% NOW THE NAME BLOCK
   355	000247'	322700	000262'		JUMPE	P3,DSKCL7		;% ALL DONE, GIVE BACK DRB
   356	000250'	554656	000000*	DSKCL6:	HLRZ	P2,FNBATB(P3)		;% FOR FOR THE ACCESS TABLE
   357	000251'	322640	000254'		JUMPE	P2,DSKCL5		;% NONE THERE, GIVE BACK FNB
   358	000252'	260040	000000*		PUSHJ	P,RMVATB		;% GET RID OF ATB (DRBCNT=0 SO OK)
   359	000253'	254000	000250'		JRST	DSKCL6			;%
   360
   361	000254'	200300	000000*	DSKCL5:	MOVE	T1,SYSCOR
   362	000255'	250316	000000*		EXCH	T1,CMBLNK(P3)		;% THIS POINTS TO NEXT FNB (MAYBE)
   363	000256'	516700	000254*		HRLZM	P3,SYSCOR		;% NOW FNB RETURNED
   364	000257'	502317	000246*		HLLM	T1,DRBFNB(P4)		;% SO LINK FROM DRB OK
   365	000260'	554700	000006		HLRZ	P3,T1			;% NEXT LINK
   366	000261'	326700	000250'		JUMPN	P3,DSKCL6		;%
   367
   368	000262'	200300	000256*	DSKCL7:	MOVE	T1,SYSCOR		;% NOW GIVE BACK DRB
   369	000263'	250317	000255*		EXCH	T1,CMBLNK(P4)
   370	000264'	516740	000262*		HRLZM	P4,SYSCOR
   371	000265'	512300	000242*		HLLZM	T1,SYSDRB		;% RELINK START
   372	000266'	554740	000006		HLRZ	P4,T1			;%
   373	000267'	326740	000244'		JUMPN	P4,DSKCL1		;%
   374	000270'	254000	000243*		JRST	GIVCB1			;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 11
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   375				SUBTTL	.CHUFD - Read UFD uuo
   376				EXTERN USETST,UNLFIL,LOKUNM,RELRIB,IOBDRB
   377
   378	000271'	607200	040000	UFDUUO:	TLNN	F,LOOKB
   379	000272'	263040	000000		 POPJ	P,
   380	000273'	550644	000157*		HRRZ	P2,DEVATB(F)		;MUST HAVE A UFD LOOKED UP
   381	000274'	201300	000000*		MOVEI	T1,ATPDIR
   382	000275'	616315	000153*		TDNN	T1,ATBSTS(P2)
   383	000276'	263040	000000		 POPJ	P,
   384	000277'	702600	400000*		NOCHARGE
   385	000300'	256200	006030'		UMOVE	P4,1(M)			;NAME
   386	000301'	256200	006031'		XCTBU	<HLLZ P2,2(M)>		;EXTENSION
   387	000302'	256200	006032'		XCTBU	<SETZM 7(M)>		;ZERO COUNT
   388	000303'	403700	000014		SETZB	P3,P1			;NO MASK YET
   389	000304'	256200	006033'		XCTBU	<SKIPGE 3(M)>		;CHECK TO SEE IF WANT * AND #
   390	000305'	254000	000313'		 JRST	UFDNMK			;NO
   391	000306'	250640	000017		EXCH	P2,P4
   392	000307'	260040	000565'		PUSHJ	P,UFDMSK		;CONVERT * AND # IN P2 TO MASK IN P1
   393	000310'	250640	000017		EXCH	P2,P4			;PUT NAME BACK IN P4
   394	000311'	200700	000014		MOVE	P3,P1			;GET MASK
   395	000312'	260040	000565'		PUSHJ	P,UFDMSK		;NOW DO EXTENSION, EXT MASK IN P1
   396	000313'	557000	000015	UFDNMK:	HLRZS	P2			;EXTENSION IN RH
   397	000314'	557000	000014		HLRZS	P1			;EXTENSION MASK IN RH
   398	000315'	504600	000013		HRL	P1,M			;P1/USER ADDR,,MASK
   399	000316'	256200	006034'		XCTBU	<SKIPN T1,4(M)>		;MONITOR WORD IS ZERO?
   400					 JRST	[			;SET UP INITIAL HASH LINK
   401						JUMPN P3,UFDNXM		;NOT ONE SPECIFIC NAME
   402						MOVE  T1,P4
   403						TLZ   T1,(1B0)
   404						HRRZ  T2,STRDDB+STRHSH
   405						IDIV  T1,T2
   406						MOVE  T1,T2
   407	000317'	254000	006035'			JRST  UFDNXM]
   408
   409				;; P4/NAME  P3/NMASK  P2/0,,EXT  P1/USERADDR,,MASK  T1/HASH LINK
   410	000320'	504640	000006	UFDNXM:	HRL	P2,T1			;P2/HASH LINK,,FILE EXT
   411	000321'	620300	400000		TRZ	T1,400000
   412	000322'	357540	000006		AOSG	M,T1			;M/PAGE IN UFD
   413	000323'	263040	000000		 POPJ	P,			;PG 0 OR <0 BAD OR END
   414	000324'	260040	000000*		PUSHJ	P,LOKUNM		;LOCK(UNMODIFIABLE) F/UFD DDB
   415									;DESTROY NO ACS
   416	000325'	550344	000273*		HRRZ	T2,DEVATB(F)
   417	000326'	135300	000161*		LDB	T1,ATYBSZ		;SIZE OF UFD, IN BLOCKS
   418	000327'	271300	000003		ADDI	T1,3	
   419	000330'	242300	777776		LSH	T1,-2			;T1/SIZE UFD, IN PAGES
   420	000331'	315300	000013		CAMGE	T1,M			;SKIP IF PAGE IN M AT OR BEFORE EOF
   421					 JRST	[PUSHJ P,UNLFIL		;PAST EOF,UNLOCK
   422						 TDO   S,[IOEND,,IODEND]
   423	000332'	254000	006045'			 PJRST STOIOS]		;SET IN DEVIOS & NOSKIP RTN
   424	000333'	260040	000000*		PUSHJ	P,USETST		;GET @DEVRET(F) SETUP FOR
   425									;M/PAGE. CLOB T1-T4,U,PG. SKIP SUCCESS
   426					 JRST	[TRO   S,IODTER
   427	000334'	254000	006050'			 PJRST STOIOS]		;NOSKIP RTN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 11-2
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   428	000335'	260040	000000*		PUSHJ	P,UNLFIL		;UNLOCK,DESTROY NO ACS
   429	000336'	260040	000000*		PUSHJ	P,RELRIB		;RELEASE RIB IN %RIB, CLOB T1-T4,PG
   430	000337'	602000	760000		TRNE	S,760000		;ANY ERRORS?
   431	000340'	263040	000000		 POPJ	P,			;
   432	000341'	554540	000014		HLRZ	M,P1			;M/USER CONTROL BLOCK ADDR AGAIN
   433	000342'	200324	000000*		MOVE	T1,@DEVRET(F)
   434	000343'	607300	000000*		TLNN	T1,RBREAL
   435	000344'	254000	000524'		 JRST	UFDSPR			;HOLE.
   436	000345'	201140	000000*		MOVEI	PG,%RIB.C
   437	000346'	260040	000000*		PUSHJ	P,MAPRDU		;READ IT
   438	000347'	135100	000106*		LDB	J,PJOBN
   439	000350'	201340	000551'		MOVEI	T2,UFDRLK
   440	000351'	202342	000000*		MOVEM	T2,JBTABT(J)
   441	000352'	260040	000000*		PUSHJ	P,GTCGSZ		;GET T1/ CHARGING SIZE.
   442	000353'	272300	000000*		ADDM	T1,JBTSIN
   443	000354'	272302	000353*		ADDM	T1,JBTSIN(J)
   444	000355'	350000	000000*		AOS	JBTRCT
   445	000356'	350002	000355*		AOS	JBTRCT(J)
   446	000357'	205340	000000*		MOVSI	T2,-<1000/UFDSIZ>	;NUMBER OF ENTRIES TO SEARCH
   447	000360'	325640	000375'		JUMPGE	P2,UFDSFD		;DO NOT SEARCH FOR NAME, NEW BLK
   448	000361'	256200	006052'		UMOVE	T3,5(M)			;NAME TO SEARCH FOR
   449	000362'	256200	006053'		XCTBU	<HLRZ T4,6(M)>
   450	000363'	312407	376000*	UFDSLP:	CAME	T3,%RIB+UFDNAM(T2)
   451	000364'	254000	000370'		 JRST	UFDNSL			;NOT THIS ONE, CONTINUE
   452	000365'	554307	376000*		HLRZ	T1,%RIB+UFDEXT(T2)
   453	000366'	316300	000011		CAMN	T1,T4
   454	000367'	254000	000373'		 JRST	UFDSF0			;FOUND IT
   455	000370'	271340	777777*	UFDNSL:	ADDI	T2,UFDSIZ-1
   456	000371'	253340	000363'		AOBJN	T2,UFDSLP
   457	000372'	254000	000551'		JRST	UFDRLK			;GIVE UP AND ERROR RETURN IF NOT FOUND
   458
   459	000373'	271340	777777*	UFDSF0:	ADDI	T2,UFDSIZ-1		;FOUND THE STARTING NAME
   460	000374'	252340	000554'		AOBJP	T2,FINUS0		;FINISHED
   461	000375'	261040	000017	UFDSFD:	PUSH	P,P4
   462	000376'	261040	000016		PUSH	P,P3
   463	000377'	256200	006054'		UMOVE	T4,(M)			;GET AOBJN POINTER FOR RETURNING DATA
   464					JUMPGE	T4,[POP  P,P3		;ERROR IF NONE TO RETURN
   465						    POP  P,P4
   466	000400'	325440	006055'			    JRST UFDRLK]
   467
   468	000401'	336307	376000*	UFDLLP:	SKIPN	T1,%RIB+UFDNAM(T2)	;SEARCH FOR NAMES THAT MATCH MASK
   469	000402'	254000	000507'		 JRST	UFDLCN
   470	000403'	420301	000000		ANDCM	T1,(P)
   471	000404'	312301	777777		CAME	T1,-1(P)
   472	000405'	254000	000507'		 JRST	UFDLCN			;NAME DOES NOT MATCH
   473	000406'	554307	376000*		HLRZ	T1,%RIB+UFDEXT(T2)
   474	000407'	420300	000014		ANDCM	T1,P1
   475	000410'	302315	000000		CAIE	T1,(P2)
   476	000411'	254000	000507'		 JRST	UFDLCN			;EXT DOES NOT MATCH
   477	000412'	120707	376000*		DMOVE	P3,%RIB+UFDNAM(T2)
   478	000413'	252440	000530'		AOBJP	T4,FINSUP
   479	000414'	513000	000017		HLLZS	P4
   480	000415'	256200	006060'		XCTBU	<DMOVEM P3,-1(T4)>	;RETURN NAME AND EXT TO USER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 11-3
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   481	000416'	256200	006061'		UMOVE	T3,3(M)
   482	000417'	607400	200000		TLNN	T3,(1B1)
   483	000420'	254000	000427'		 JRST	UFNBLK			;NO BLOCKS
   484	000421'	252440	000530'		AOBJP	T4,FINSUP
   485	000422'	554307	376000*		HLRZ	T1,%RIB+UFDALP(T2)
   486	000423'	602300	400000		TRNE	T1,400000
   487	000424'	665300	777777		TLOA	T1,-1
   488	000425'	242300	000002		 LSH	T1,2			;CONVERT TO BLOCKS, NEG IF UNKNOWN
   489	000426'	256200	006062'		UMOVEM	T1,(T4)
   490	000427'	607400	100000	UFNBLK:	TLNN	T3,(1B2)
   491	000430'	254000	000434'		 JRST	UFNLIC			;NO LICENSE
   492	000431'	252440	000530'		AOBJP	T4,FINSUP
   493	000432'	550307	376000*		HRRZ	T1,%RIB+UFDLIC(T2)
   494	000433'	256200	006062'		UMOVEM	T1,(T4)
   495	000434'	607400	040000	UFNLIC:	TLNN	T3,(1B3)
   496	000435'	254000	000473'		 JRST	UFNDAT			;NO DATE
   497	000436'	252440	000530'		AOBJP	T4,FINSUP
   498	000437'	135740	000000*		LDB	P4,UFYCDT
   499	000440'	135700	000000*		LDB	P3,UFYXCD
   500	000441'	137700	006063'		DPB	P3,[POINT 2,P4,23]
   501	000442'	135700	000000*		LDB	P3,UFYCTM
   502	000443'	607400	000200		TLNN	T3,200			;DOES HE WANT TIME AND DATE CONVERSION
   503	000444'	254000	000471'		 JRST	UFNNCV			;NO, HE WANTS TYMSHARE FORMAT
   504	000445'	220700	000000*		IMUL	P3,JFYSEC
   505	000446'	261040	000007		PUSH	P,T2
   506	000447'	120300	000016		DMOVE	T1,P3
   507	000450'	204740	000010		MOVS	P4,T3
   508	000451'	405740	000177		ANDI	P4,177
   509	000452'	622740	000100		TRZE	P4,100			;WANT IT IN DEC FORMAT?
   510	000453'	660740	400000		 TRO	P4,400000		;NO, TYMSHARE BUT DIFFERENT TIME ZONE
   511	000454'	505740	400020		HRLI	P4,400020		;FROM GMT
   512	000455'	261040	000010		PUSH	P,T3
   513	000456'	261040	000011		PUSH	P,T4
   514	000457'	260040	000000*		PUSHJ	P,DATCOM
   515	000460'	255000	000000		  JFCL
   516	000461'	250300	000007		EXCH	T1,T2
   517	000462'	230340	000445*		IDIV	T2,JFYSEC		;RECONVERT
   518	000463'	506340	000006		HRLM	T2,T1
   519	000464'	262040	000011		POP	P,T4
   520	000465'	262040	000010		POP	P,T3
   521	000466'	262040	000007		POP	P,T2
   522	000467'	256200	006064'		XCTBU	<MOVSM T1,(T4)>		;STORE CONVERTED
   523	000470'	254000	000473'		JRST	UFNDAT
   524
   525	000471'	506740	000016	UFNNCV:	HRLM	P4,P3
   526	000472'	256200	006065'		UMOVEM	P3,(T4)			;STORE NONCONVERTED DATE
   527	000473'	607400	020000	UFNDAT:	TLNN	T3,(1B4)
   528	000474'	254000	000504'		 JRST	UFNSTS			;NO STATUS
   529	000475'	252440	000530'		AOBJP	T4,FINSUP
   530	000476'	135740	000000*		LDB	P4,UFYPRV
   531	000477'	135300	000000*		LDB	T1,UFYUF2
   532	000500'	137300	006066'		DPB	T1,[POINT 8,P4,26]
   533	000501'	135300	000000*		LDB	T1,UFYUF1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 11-4
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   534	000502'	137300	006067'		DPB	T1,[POINT 4,P4,18]
   535	000503'	256200	006070'		UMOVEM	P4,(T4)
   536	000504'	504600	000007	UFNSTS:	HRL	P1,T2			;SAVE LOCATION
   537	000505'	256200	006071'		XCTBU	<AOS 7(M)>		;COUNT NUMBER OF FILES RETURNED
   538	000506'	252440	000530'		AOBJP	T4,FINSUP
   539	000507'	271340	777777*	UFDLCN:	ADDI	T2,UFDSIZ-1
   540	000510'	253340	000401'		AOBJN	T2,UFDLLP
   541	000511'	262040	000016		POP	P,P3
   542	000512'	262040	000017		POP	P,P4
   543	000513'	256200	006072'		XCTBU	<SKIPN 7(M)>		;ANY MATCHES AT ALL?
   544	000514'	254000	000554'		 JRST	FINUS0
   545					JUMPN	P3,[HLRZ T1,P2
   546	000515'	326700	006073'			    AOJA T1,FINNXB]
   547	000516'	336300	376000*		SKIPN	T1,%RIB+UFDLNK
   548	000517'	201300	377777		 MOVEI	T1,377777
   549	000520'	254000	000542'		JRST	FINNXB
   550
   551
   552	000521'	260040	000000*	UFDSP1:	PUSHJ	P,RELLOK
   553	000522'	135300	000347*		LDB	T1,PJOBN
   554	000523'	402006	000351*		SETZM	JBTABT(T1)
   555	000524'	322700	000546'	UFDSPR:	JUMPE	P3,UFDEOF		;SPECIFIC NAME, ONLY ONE HASH CODE
   556	000525'	554300	000015		HLRZ	T1,P2
   557	000526'	620300	400000		TRZ	T1,400000
   558	000527'	344300	000320'		AOJA	T1,UFDNXM
   559
   560	000530'	262040	000016	FINSUP:	POP	P,P3
   561	000531'	262040	000017		POP	P,P4
   562	000532'	256200	006072'		XCTBU	<SKIPN 7(M)>		;COUNT OF MATCHES
   563	000533'	254000	000551'		 JRST	UFDRLK			;ERROR IF NONE FOUND
   564	000534'	554440	000014		HLRZ	T4,P1
   565	000535'	120311	376000*		DMOVE	T1,%RIB+UFDNAM(T4)	;GET LAST NAME STORED
   566	000536'	513000	000007		HLLZS	T2
   567	000537'	256200	006075'		XCTBU	<DMOVEM T1,5(M)>	;STARTING NAME AND EXT FOR NEXT TIME
   568	000540'	554300	000015		HLRZ	T1,P2
   569	000541'	664300	400000		TROA	T1,400000		;SEARCH THIS AGAIN
   570	000542'	620300	400000	FINNXB:	 TRZ	T1,400000
   571	000543'	256200	006076'		UMOVEM	T1,4(M)
   572	000544'	350001	000000		AOS	(P)			;SKIP RETURN
   573	000545'	254000	000551'		JRST	UFDRLK			;DONE
   574
   575	000546'	670000	006077'	UFDEOF:	TDO	S,[IOEND,IODEND]
   576	000547'	202004	000002		MOVEM	S,DEVIOS(F)
   577	000550'	263040	000000		POPJ	P,
   578
   579	000551'	135300	000522*	UFDRLK:	LDB	T1,PJOBN
   580	000552'	402006	000523*		SETZM	JBTABT(T1)
   581	000553'	324740	000521*		PJRST	RELLOK
   582
   583	000554'	336300	376000*	FINUS0:	SKIPN	T1,%RIB+UFDLNK
   584	000555'	254000	000521'		 JRST	UFDSP1			;NO LINK, EOF IF SPECIAL NAME, ELSE NEXT
   585	000556'	326700	000521'		JUMPN	P3,UFDSP1		;LINK AND NOT SPECIAL
   586	000557'	261040	000006		PUSH	P,T1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 11-5
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   587	000560'	260040	000553*		PUSHJ	P,RELLOK
   588	000561'	135300	000551*		LDB	T1,PJOBN
   589	000562'	402006	000552*		SETZM	JBTABT(T1)
   590	000563'	262040	000006		POP	P,T1
   591	000564'	254000	000320'		JRST	UFDNXM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 12
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   592				;CHECK P2 FOR * AND #, RETURN MASK IN P1
   593	000565'	316640	006100'	UFDMSK:	CAMN	P2,[SIXBIT /*/]
   594					 JRST	[MOVNI P1,1
   595						 MOVEI P2,0
   596	000566'	254000	006101'			 POPJ  P,]
   597	000567'	200340	000015		MOVE	T2,P2
   598	000570'	430340	006104'		XOR	T2,[SIXBIT /######/]
   599	000571'	201600	000000		MOVEI	P1,0
   600	000572'	205300	770000		MOVSI	T1,770000
   601	000573'	616340	000006	UFDMS0:	TDNN	T2,T1
   602	000574'	670600	000006		 TDO	P1,T1
   603	000575'	242300	777772		LSH	T1,-6
   604	000576'	326300	000573'		JUMPN	T1,UFDMS0
   605	000577'	420640	000014		ANDCM	P2,P1			;GET RID OF #'S
   606	000600'	263040	000000		POPJ	P,
   607
   608
   609				;UUO TO SET PID TO NEW VALUE
   610				; CALL:
   611				;	MOVE	AC,[PID]
   612				;	PIDSET	AC,
   613				;	  <ERROR RETURN>		;NOT AUTHORIZED TO SET PID
   614				;	<SUCCESS RETURN>
   615	000601'	322300	000620'	SETPID::JUMPE	T1,SETPIO		;ZERO ALWAYS OK
   616	000602'	135340	000000*		LDB	T2,JBYWPT		;IF WF, CAN SET PID TO ANYTHING.
   617	000603'	303340	000001		CAILE	T2,1			;SKIP IF WP OR LESS
   618	000604'	254000	000620'		  JRST	SETPIO			;OK TO SET ANY PID IF WF OR WA.
   619	000605'	204342	000000*		MOVS	T2,JBTAUN(J)		;GET UUN IN LH
   620	000606'	430340	000006		XOR	T2,T1			;LH = 0 IF ALL BITS MATCH
   621	000607'	607340	777777		TLNN	T2,-1			;SKIP IF MATCH ON AUN
   622	000610'	254000	000620'		  JRST	SETPIO			;OK, SAVE OLD PID AND SET NEW ONE
   623	000611'	316300	000000*		CAMN	T1,%UPT+UPTSPD		;SETTING BACK TO LAST VALUE?
   624	000612'	254000	000620'		  JRST	SETPIO			;YES, THAT'S OK
   625	000613'	316300	000000*		CAMN	T1,%UPT+UPTPID		;NOT CHANGING?
   626	000614'	350001	000000		  AOS	(P)			;NOT CHANGING, DON'T BOTHER WITH UPTSPD
   627	000615'	200300	000000*		MOVE	T1,%UPT+UPTPID		;GET CURRENT PID
   628	000616'	256200	006025'		UMOVEM	T1,(M)			;RETURN "OLD" PID (SAME AS NEW)
   629	000617'	263040	000000		POPJ	P,			;NOT AUTHORIZED TO SET THIS PID
   630
   631	000620'	250300	000000*	SETPIO:	EXCH	T1,%UPT+UPTPID		;SET NEW PID, GET OLD ONE
   632	000621'	332000	000006		SKIPE	T1			;DON'T SET SAVED PID TO ZERO, SO IF
   633									; JOB HAS PID, SETS IT TO ZERO, SETS IT
   634									; TO ANOTHER PID, DOESN'T LOSE ABILITY
   635									; TO RESET TO ORIGINAL PID.
   636	000622'	202300	000000*		  MOVEM	T1,%UPT+UPTSPD		;REMEMBER WHAT LAST ONE WAS SO CAN RESTORE IT.
   637	000623'	256200	006025'		UMOVEM	T1,(M)			;RETURN OLD PID VALUE
   638	000624'	254000	000237*		JRST	CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 13
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   639				;SUBROUTINE TO BUILD A DISK DEVICE DATA BLOCK
   640				;ENTER WITH T1=DEVICE NAME, F=LOC OF DDB (OR PROTOTYPE DDB)
   641				;CALLED BY ASSPRG
   642				;HERE FROM ONCE-ONLY CODE
   643				INTERN SETDDO
   644	000625'	261040	000077*	SETDDO:	PUSH	P,DSKDDB	;SAVE NAME
   645	000626'	254000	000644'		JRST	SETDD3		;GO CREATE THE DDB
   646
   647				;THIS IS THE NORMAL ENTRY POINT
   648	000627'	260040	000045'	SETDDB:	PUSHJ	P,SAVT		;SAVE T2-T4
   649	000630'	550400	000004		HRRZ	T3,F		;ADDR. OF THE DDB
   650	000631'	302400	000625*		CAIE	T3,DSKDDB	;IS IT THE PROTOTYPE?
   651	000632'	200304	000000		  MOVE	T1,DEVNAM(F)	;NO. GET THE PHYSICAL DEVICE NAME
   652	000633'	261040	000006		PUSH	P,T1		;SAVE NAME
   653	000634'	200304	000004		MOVE	T1,DEVMOD(F)
   654	000635'	602300	200000		TRNE	T1,ASSPRG	;DDB BEEN INITED?
   655	000636'	254000	000641'		  JRST	SETDD1		;YES. HAVE TO COPY PROTOTYPE
   656	000637'	302400	000631*		CAIE	T3,DSKDDB	;IS IT PROTOTYPE?
   657	000640'	254000	000654'		  JRST	SETDD2		;NO. USE IT
   658
   659				;HERE WHEN WE MUST MAKE A COPY OF THE PROTOTYPE DDB
   660	000641'	201340	000000*	SETDD1:	MOVEI	T2,DDBCOR	;NO OF 4-WORD BLOCKS NEEDED
   661	000642'	260040	000000*		PUSHJ	P,GET4WD	;GET THE CORE
   662	000643'	254000	000000*		  JRST	TPOPJ		;CANT GET IT - RETURN
   663	000644'	540200	000006	SETDD3:	HRR	F,T1		;LOC OF THE CORE
   664	000645'	505300	000637*		HRLI	T1,DSKDDB	;FROM THE PROTOTYPE
   665	000646'	251304	777777*		BLT	T1,DDBLEN-1(F)	;BLT THE NEEDED INFORMATION
   666	000647'	506200	000003*		HRLM	F,DSKDDB+DEVSER	;LINK PROTOTYPE TO THEIS DDB
   667								;(COPY ALREADY CONTAINS LINK TO NEXT)
   668	000650'	201300	600000		MOVEI	T1,ASSCON+ASSPRG	;MAKE SURE ASSIGN BITS ARE OFF
   669	000651'	412304	000004		ANDCAM	T1,DEVMOD(F)	;(1 WILL BE TURNED ON BY ASSPRG)
   670
   671	000652'	262044	000000	SETDD4:	POP	P,DEVNAM(F)	;SET NAME INTO DDB
   672	000653'	254000	000624*		JRST	CPOPJ1		;SUCCESS RETURN
   673
   674	000654'	201304	000006	SETDD2:	MOVEI	T1,DEVLOG+1(F)	;MAKE SURE DDB PROPERLY INITED
   675	000655'	505300	000006*		HRLI	T1,DSKDDB+DEVLOG+1 ;BUT SKIP STUFF BEFORE THIS
   676	000656'	251304	777777*		BLT	T1,DEVRB1-1(F)
   677	000657'	402004	000002		SETZM	DEVIOS(F)	;EXCEPT FOR DEVIOS
   678	000660'	254000	000652'		JRST	SETDD4
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 14
FILUUO.MAC	 8-DEC-87 11:25		.CHUFD - Read UFD uuo

   679				;SUBROUTINE TO CLEAR A DISK DEVICE DATA BLOCK
   680				;ENTER WITH F=LOC OF DDB
   681				;CALLED BY RELEASE CODE AND ONCDSK AT ONCE TIME
   682
   683	000661'			CLRDDB:
   684					;PUSHJ P,IOLDEL		;NO IOLIST TO DELETE IN VM SYSTEM
   685
   686	000661'	201300	000645*		MOVEI	T1,DSKDDB	;START AT PROTOTYPE
   687	000662'	200340	000006	CLRDD1:	MOVE	T2,T1
   688	000663'	554307	000003		HLRZ	T1,DEVSER(T2)	;GET SUCCESSOR TO THIS DDB
   689	000664'	336000	000006		SKIPN	T1		;END?
   690	000665'	256000	000000'		 STOPCD (SLO)
   691						;;CLRDD1+3
   692	000666'	302304	000000		CAIE	T1,(F)		;NO. IS LINK THE ONE WE WANT?
   693	000667'	254000	000662'		JRST	CLRDD1		;NO. TRY NEXT
   694
   695				;HERE WITH T2=LOC OF DDB WHOSE LINK IS THE ONE WE WANT
   696	000670'	200404	000003		MOVE	T3,DEVSER(F)	;LINK OF DDB WE ARE REMOVING
   697	000671'	502407	000003		HLLM	T3,DEVSER(T2)	;SAVE IN LINK OF PREDECESSOR
   698	000672'	201300	000641*		MOVEI	T1,DDBCOR	;NO OF 4-WORD BLOCKS TO RETURN
   699	000673'	550340	000004		HRRZ	T2,F		;LOC OF DDB TO CLEAR
   700	000674'	332000	000000*		SKIPE	ONCTIM		;SKIP IF AT ONCE TIME
   701	000675'	324740	000000*		PJRST	GIV4WD		;RETURN THE CORE AND RETURN TO CALLER
   702	000676'	263040	000000		POPJ 	P,
   703
   704					INTERN	NAMSTR
   705				;SUBROUTINE TO RETURN THE ACTUAL STR NAME FOR A DDB
   706				;ENTER WITH F=LOC OF DDB
   707				;EXIT CPOPJ IF NOT A DISK OR NO UNIT ASSOCIATED WITH DDB (LOOKUP NOT DONE)
   708				;EXIT CPOPJ1 IF A DISK, WITH T1=NAME OF STR
   709
   710				PRINTF(<[NAMSTR Ought to return STRNAM( DRBSTR( DEVDRB(F) ) ) as name]>)
   711	000677'	200304	000004	NAMSTR:	MOVE	T1,DEVMOD(F)	;IS DEVICE A DISK?
   712	000700'	607300	200000		TLNN	T1,DVDSK
   713	000701'	263040	000000		  POPJ	P,
   714
   715				;;*;;	Might need CB resource for this -- consider this!
   716				;;*;;	HLRZ	T1,DEVDRB(F)		; Get directory block
   717				;;*;;	HRRZ	T1,DRBSTR(T1)		; and structure block
   718				;;*;;	MOVE	T1,STRNAM(T1)		; Name of structure
   719
   720	000702'	200300	006024'		MOVE	T1,[SIXBIT /DSKB/]	; Think DSKB for now
   721	000703'	324740	000653*		PJRST	CPOPJ1			;SKIP-RETURN
   722
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 15
FILUUO.MAC	 8-DEC-87 11:25		COMCON - COMMAND DECODER INTERFACE ROUTINES

   723				SUBTTL	COMCON - COMMAND DECODER INTERFACE ROUTINES
   724
   725				;SUBROUTINE TO PERFORM "DISK" COMMAND - PRINT DISK ACCESSES
   726				;CALL:	MOVE	J,JOB NO.
   727				;	PUSHJ	P,DSKCOM	;CALLED FROM COMCON - COMMAND DECODER
   728				;	ALWAYS RETURN
   729				;PRINTS INCREMENTAL READS AND WRITES, TOTAL READS AND WRITES
   730				;TOTAL BLOCKS ALLOCATED, AND KILO-DISK-MIN FOR ALL STRS COMBINED
   731
   732					INTERN	DSKCOM
   733				EXTERN	DECIN,COMERA,ATT1,CRLF,JBTRCT,JBTWCT,JBYRCT,RADX10,JBTSIN
   734					EXTERN	JBYWCT,INLMES,JOBN,CHKSGJ
   735
   736	000704'	260040	000000*	DSKCOM:	PUSHJ	P,DECIN		;GET DECIMAL JOB NO. ARG IF ANY
   737	000705'	254000	000720'		  JRST	DSKCM1		;NO ARG, ASSUME USER'S OWN JOB(AC [=J)
   738	000706'	254000	000000*		  JRST	COMERA		;BAD CHARACTER, PRINT ERROR
   739	000707'	301340	000000*		CAIL	T2,JOBN		;JOB NUMBER TO LARGE?
   740	000710'	254000	000000*		JRST	ATT1		;YES, PRINT NOT A JOB NO.
   741	000711'	250100	000007		EXCH	J,T2		;NO, SETUP JOB NUMBER
   742	000712'	260040	000000*		PUSHJ P,CHKSGJ		;SEE IF HE CAN HAVE THAT INFO
   743					  JRST	[MOVE J,T2	;No - restore caller's frame number
   744	000713'	254000	006105'			 JRST COMERA]	;And take common command error exit.
   745	000714'	261040	000007		PUSH P,T2		;SAVE JOB NUM (IN CASE DSK 0)
   746	000715'	260040	000730'		PUSHJ P,DSKCM2
   747	000716'	262040	000002		POP P,J
   748	000717'	263040	000000		POPJ P,
   749
   750				;HERE WHEN USER DID NOT SPECIFY A JOB NUMBER - SO DO HIS WITH INCREMENTAL
   751	000720'	260040	000000*	DSKCM1:	PUSHJ	P,INLMES	;NO, PRINT MESSAGE
   752	000721'	512105	453650		ASCIZ	/RD,WT=/
	000722'	364000	000000
   753	000723'	260040	000750'		PUSHJ	P,DSKINC	;PRINT INCREMENTAL DISK READS
   754	000724'	260040	000720*		PUSHJ	P,INLMES	;COMMA
   755	000725'	260000	000000		ASCIZ	/,/
   756	000726'	260040	000744'		PUSHJ	P,PRTWDW	;PRINT NO OF INCREMENTAL DISK WRITES
   757	000727'	260040	000000*		PUSHJ	P,CRLF		;PRINT CRLF
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 16
FILUUO.MAC	 8-DEC-87 11:25		COMCON - COMMAND DECODER INTERFACE ROUTINES

   758				;HERE TO PRINT DATA FOR ANOTHER JOB(IE DO NOT PRINT INCREMENTAL)
   759	000730'	260040	000724*	DSKCM2:	PUSHJ	P,INLMES	;PRINT HEADING
   760	000731'	512105	453650		ASCIZ	/RD,WT=/
	000732'	364000	000000
   761	000733'	135300	000000*		LDB	T1,JBYRCT	;TOTAL NO. OF READS FOR JOB SINCE LOG-IN
   762	000734'	260040	000000*		PUSHJ	P,RADX10	;PRINT DECIMAL
   763	000735'	260040	000730*		PUSHJ	P,INLMES	;PRINT COMMA
   764	000736'	260000	000000		ASCIZ	/,/
   765	000737'	271100	000000*		ADDI	J,JBTWCT-JBTRCT	;INCREASE JOB NO. BY DIFF. IN TABLE ORIGINS
   766	000740'	135300	000000*		LDB	T1,JBYWCT	;TOTAL NO. OF WRITES FOR JOB SINCE LOGIN
   767	000741'	260040	000734*		PUSHJ	P,RADX10	;PRINT DECIMAL
   768	000742'	201102	000000*		MOVEI	J,JBTRCT-JBTWCT(J)	;RESTORE J TO ORIGINAL JOB NO. (ELSE COMCON CONFUSED)
   769	000743'	324740	000727*		PJRST	CRLF		;PRINT CRLF AND RETURN
   770
   771				;SUBROUTINE TO PRINT NO OF DISK WRITES (RESULT OF WATCH COMMAND)
   772				;CALL:	MOVE J,JOB NO [J=J]
   773				;	PUSHJ P,PRTWDW
   774	000744'	271100	000000*	PRTWDW:	ADDI	J,JBTWCT-JBTRCT	;INCREASE JOB NO BY DIFF IN READ/WRITE TABLE ORIGINS
   775	000745'	260040	000750'		PUSHJ	P,DSKINC	;PRINT INCREMENTAL DISK WRITES
   776	000746'	201102	000000*		MOVEI	J,JBTRCT-JBTWCT(J)	;@ECREASE JOB NO BY DIFF IN TABLE ORIGINS
   777	000747'	263040	000000		POPJ	P,
   778
   779				;SUBROUTINE TO PRINT INCREMENTAL NO. OF BLOCKS READ OR WRITTEN
   780				;CALL:	MOVE	J,JOB NO.(J=J)
   781				;	PUSHJ	P,DSKINC
   782				;	ALWAYS RETURN
   783
   784					EXTERN	JBYIRD,JBRIRD
   785
   786	000750'			PRTWDR:				;PRINT INCREMENTAL NO OF BLOCKS READ
   787	000750'	135300	000733*	DSKINC:	LDB	T1,JBYRCT	;TOTAL NO OF READS(OR WRITES) FOR JOB
   788	000751'	135340	000000*		LDB	T2,JBYIRD	;INCREMENTAL SETTING(LOW ORDER N BITS
   789								; OR TOTAL NO.)
   790	000752'	137300	000751*		DPB	T1,JBYIRD	;UPDATE INCREMENTAL SETTING WITH CURRENT TOTAL
   791	000753'	274300	000007		SUB	T1,T2		;DIFFERENCE CUR TOTAL-LAST TOTAL
   792	000754'	405300	000000*		ANDI	T1,JBRIRD	;MASK OUT ALL BITS OUTSIDE INCREMENTAL FIELD
   793	000755'	324740	000741*		PJRST	RADX10		;PRINT DECIMAL AND RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 17
FILUUO.MAC	 8-DEC-87 11:25		COMCON - COMMAND DECODER INTERFACE ROUTINES

   794				;COMMAND TO PRINT FILE STRUCTURES IN SYSTEM, AND UNITS NOT IN STRUCTURES
   795				; (RESOURCES COMMAND)
   796			000000	DSKRES==CPOPJ		;FOR NOW
   797
   798				;SUBROUTINE TO CLEAN UP CORE ON A KJOB COMMAND
   799				;CALLED AT CLOCK LEVEL IF NO CORE, M LEVEL IF CORE WHEN JOB IS KILLED
   800				;CALL	MOVE J,JOB NUMBER
   801				;	PUSHJ P,DSKKJB
   802	000756'	200302	000000*	DSKKJB:	MOVE	T1,JBTPPN(J)	;PPN OF JOB
   803	000757'	200340	000000*		MOVE	T2,HIGHJB	;CHECK FOR OTHER JOBS WITH SAME PPN
   804	000760'	306342	000000	DSKKLP:	CAIN	T2,(J)		;IS NEXT JOB=CURRENT JOB?
   805	000761'	363340	000174'		SOJLE	T2,DSKLGO	;YES, DONT TEST PPN'S
   806	000762'	316307	000756*		CAMN	T1,JBTPPN(T2)	;NO. IS ANOTHER JOB LOGGED IN UNDER SAME NUMBER?
   807	000763'	263040	000000		POPJ P,
   808	000764'	367340	000760'		SOJG	T2,DSKKLP	;NO, KEEP LOOKING
   809	000765'	324740	000174'		PJRST DSKLGO
   810
   811				;CHGPPN - Change PPN, used by the GFD program, called from CALLI 74 uuo
   812
   813	000766'	205340	001000	CHGPPN::MOVSI	T2,LICJAL	;Must have JL license
   814	000767'	312300	000175*		CAME	T1,MFDPPN	;Cannot GFD to (UFD)[1,1]
   815	000770'	616342	000212*		TDNN	T2,JBTLIC(J)
   816	000771'	263040	000000		 POPJ	P,
   817	000772'	261040	000006		PUSH	P,T1
   818	000773'	260040	000756'		PUSHJ	P,DSKKJB	;GET RID OF OLD PPN
   819	000774'	402002	000000*		SETZM	JBTNM1(J)	;Clear out the username associated with GFD'd
   820	000775'	402002	000000*		SETZM	JBTNM2(J)	; PPN so CHGNAM will work
   821	000776'	262042	000762*		POP	P,JBTPPN(J)
   822	000777'	260040	001001'		PUSHJ	P,CHGNAM	;Make sure GETTAB tables 31 and 32 match
   823	001000'	254000	000703*		JRST	CPOPJ1		;End of CHGPPN uuo
   824
   825				;CHGNAM - Change name, called from CHGPPN, LOGIN, and CREFRM uuos
   826
   827	001001'	200302	000776*	CHGNAM::MOVE	T1,JBTPPN##(J)	;Get current PPN (as set by GFD)
   828	001002'	260040	003127'		PUSHJ	P,PPNUSR	;Get username in T2 and T3
   829	001003'	403340	000010		  SETZB	T2,T3		;Not found
   830	001004'	202342	000774*		MOVEM	T2,JBTNM1##(J)	;Store first half
   831	001005'	202402	000775*		MOVEM	T3,JBTNM2##(J)	;2nd half
   832	001006'	263040	000000		POPJ	P,		;End of CHGNAM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 18
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

   833				SUBTTL	CLOSE
   834				;WHEN RENAME CALLS CLOSE, IT MAY ALREADY HAVE THE MONITOR BUFFER, AND THE RIB
   835				;MAY BE IN IT. IF SO, DEPRIB IS ON IN S
   836
   837				;INPUT CLOSE
   838	001007'	627200	040000	CLOSIN:	TLZN	F,LOOKB		;LOOKUP IN FORCE?
   839	001010'	324740	000000*		  PJRST	STOIOS		;NO. RETURN
   840	001011'	702600	400000*		NOCHARGE
   841	001012'	607200	020000		TLNN	F,ENTRB		;IF OUTPUT STILL OPEN, DON'T WIPE OUT UPTPOS.
   842	001013'	260040	000000*		  PUSHJ	P,SIMRLS	;CLEAN UP SIMIO DATA BASE
   843	001014'	201300	000005		MOVEI	T1,DECSTP
   844	001015'	137300	000120*		DPB	T1,DEYSTC	;IN CASE OF ERROR HERE
   845	001016'	260040	000241*		PUSHJ	P,GETCBR
   846	001017'	550644	000325*		HRRZ	P2,DEVATB(F)	;% CHECK ON STATUS OF FILE
   847	001020'	554744	000000*		HLRZ	P4,DEVDRB(F)
   848	001021'	332000	000015		SKIPE	P2
   849	001022'	336000	000017		  SKIPN	P4
   850	001023'	256000	000000'		 STOPCD (SLO)
   851				           ;;CLOSIN+14
   852	001024'	200315	000275*		MOVE	T1,ATBSTS(P2)
   853	001025'	602300	000000*		TRNE	T1,ATPREN	;% IF RENAME ON, THE ONE WHO TURNS
   854	001026'	254000	001200'		  JRST	CLSXT1		;% IT OFF WILL WORRY ABOUT READ COUNT=0
   855	001027'	260040	002007'		PUSHJ	P,TSTRES	;% MAKE SURE WE GIVE UP RESOURCES(UNLESS RENAME)
   856	001030'	606300	777777*	CLOSRN:	TRNN	T1,ATMCNT-1	;% IS HE THE LAST READER?
   857	001031'	606300	000000*		TRNN	T1,ATPDEL	;% FILE MARKED FOR DELETION?
   858	001032'	254000	001062'		  JRST	CLSIN2		;% NO
   859	001033'	260040	000245*	CLIDEL:	PUSHJ	P,GIVCBR
   860	001034'	260040	000000*		PUSHJ	P,RIBWTL	;GET RIB WRITE LOCKED
   861	001035'	254000	001053'		  JRST	CLIBDR		;BAD RIB, FIX QUOTAS AND GO TO FREACC.
   862	001036'	260040	000000*		PUSHJ	P,DLTALL	;I CAN'T BELIEVE I ATE THE WHOLE THING.
   863	001037'	255000	000000		  JFCL			;IGNORE ERROR RETURN
   864								;DON'T TRY TO ADJUST QUOTAS, GIVPAG SUBTRACTS AS IT GOES ALONG.
   865
   866	001040'	402015	000000*		SETZM	ATBRIB(P2)	;IN CASE THE FILE IS STILL MAPPED,
   867								; TELLS REMOVE THAT RIB WENT AWAY.
   868	001041'	260040	001527'		PUSHJ	P,LOGTST	;RECOMPUTE RIBUSD IF PPN NOT LOGGED IN
   869
   870				;HERE WHEN THE FILE NAME WAS NOT FOUND IN THE UFD.
   871				; ALSO COME HERE FROM DELETE CODE WHEN RIB ERROR OCCURS, ATBRIB CAN BE ZERO!
   872	001042'	621200	020040	FREACC:	TLZ	F,RENMB!ENTRB		;TURN OFF RENMB SO CLOSE OUTPUT WONT DO ANYTHING
   873	001043'	260040	001016*		PUSHJ P,GETCBR
   874	001044'	550715	000114*		HRRZ P3,ATBFNB(P2)	;% FOR DELETING FNB
   875	001045'	260040	000150*		PUSHJ P,ULKDBL		;% AND REMOVE DDB
   876	001046'	211300	000000*		MOVNI	T1,ATPCNT	;% ONE LESS READER OF FILE
   877	001047'	273315	001024*		ADDB	T1,ATBSTS(P2)	;% AND GET ATBSTS IN T1
   878	001050'	607300	000000*		TLNN	T1,ATMUMC	;% ANYONE STILL HAVE A PAGE MAPPED?
   879	001051'	324740	001153'		PJRST CLSN3A		;% NO, DELETE PPB ETC. IF NECESSARY
   880	001052'	324740	001176'		PJRST CLSIN5		;% YES, JUST ZERO DEVATB AND LEAVE AT ALONE
   881
   882				;HERE IF BAD RIB TRYING TO DELETE ATPDEL FILE OR BAD RIB IN DELETE
   883				; CODE
   884
   885	001053'	200315	000130*	CLIBDR:	MOVE	T1,ATBALP(P2) ;TRY TO ADJUST QUOTAS PROPERLY
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 18-2
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

   886	001054'	270317	000131*		ADD	T1,DRBALC(P4)  ;GET PROPER VALUE - AS IF WE DELETED THE PAGES
   887	001055'	331017	001054*		SKIPL	DRBALC(P4)	;IF NEGATIVE, REPLACE ANYWAY
   888	001056'	331000	000006		SKIPL	T1		;DON'T DECREASE
   889	001057'	202317	001055*		MOVEM	T1,DRBALC(P4)	;STORE NEW DRBALC
   890	001060'	260040	001527'		PUSHJ	P,LOGTST	;IF DIRECTORY NOT CONNECTED TO, RECOMPUTE RIBUSD AND RIBMXA
   891	001061'	254000	001042'		JRST	FREACC		;AND GO GET RID OF ATB IF WE CAN.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 19
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

   892				;HERE WHEN FILE IS NOT MARKED FOR DELETION
   893	001062'	606540	000001	CLSIN2:	TRNN	M,CLSOUT	;% SUPPRESSING OUTPUT CLOSE?
   894	001063'	607200	020040		TLNN	F,ENTRB+RENMB	;% NO, ENTER OR RENAME DONE?(IF SO, CLSOUT WILL BE CALLED)
   895	001064'	334000	000000		SKIPA
   896	001065'	254000	001204'		JRST CLSXIT		;% YES. RETURN
   897	001066'	200302	000770*		MOVE	T1,JBTLIC(J)	;% GET PROCESS LIC
   898	001067'	602540	100000		TRNE	M,CLSDMP	;% SET DUMPED BIT?
   899	001070'	607300	001002		TLNN	T1,LICJAL+LICWFL	;% APPROPRIATE LIC?
   900	001071'	254000	001077'		JRST	CLSIN7		;% NO
   901	001072'	205300	000000*		MOVSI	T1,ATPDMP
   902	001073'	436315	000000*		IORM	T1,ATBLCW(P2)	;% SET DUMPED BIT
   903	001074'	260040	001726'		PUSHJ	P,UPDUF0	;% UPDATE THE UFD
   904	001075'	260040	001043*		PUSHJ	P,GETCBR	;GET CB BACK
   905	001076'	254000	001101'		JRST	CLSIN8		;UPDATE RIB
   906	001077'	602540	000010	CLSIN7:	TRNE	M,CLSACC	;% SUPPRESS UPDATING ACCESS DATE?
   907	001100'	254000	001141'		JRST	CLSIN3		;% YES, DONT WRITE RIB
   908
   909				;NOW CLEAR ATPALC IF ITS OK TO. IF CLSACC ON, TRY TO GUARANTEE
   910				; THAT WE DON'T WRITE ANY DISK ON INPUT CLOSE - THUS THIS CALL
   911				; IS AFTER CHECK ON CLSACC.
   912
   913	001101'	200315	001073*	CLSIN8:	MOVE	T1,ATBLCW(P2)	;% GET LIC WORD
   914	001102'	603300	000000*		TLNE	T1,ATPALC	;% IF THIS BIT IS SET,
   915	001103'	260040	001706'		 PUSHJ	P,CLRACH	;% TRY TO CLEAR IT.
   916	001104'	135440	000000*		LDB	T4,ATYADT	;% GET CURRENT ACCESS DATE FOR BELOW
   917	001105'	200315	001101*		MOVE	T1,ATBLCW(P2)	;% GET NEW LIC WORD
   918	001106'	603300	001102*		TLNE	T1,ATPALC	;% IF ATPALC HAS CHANGED (WENT OFF)
   919	001107'	603300	001072*		TLNE	T1,ATPDMP	;%  OR ATPDMP IS SET
   920	001110'	254000	001114'		 JRST	CLSN2B		;%  THEN ALWAYS UPDATE RIB
   921	001111'	312440	000000*		CAME	T4,THSDAT	;% IS ACCESS DATE=TODAY?
   922	001112'	607200	010004		 TLNN	F,INPB!MAPB	;% DATE NEQ TODAY, ANY INPUTS DONE?
   923	001113'	254000	001141'		  JRST	CLSIN3		;% NO NEED TO UPDATE ACCESS DATE, JUST SET A.T. DORMANT
   924	001114'	603200	010004	CLSN2B: TLNE	F,INPB!MAPB	;% IN CASE FORCING RIB OUT DUE TO ATPALC
   925	001115'	200440	001111*		 MOVE	T4,THSDAT	;% SET ACCESS DATE=TODAY IF INPUT DONE
   926	001116'	606540	000010		TRNN 	M,CLSACC	;% DO NOT RESET ACCESS IF HERE ON ERR
   927	001117'	137440	001104*		 DPB	T4,ATYADT	;% IN AKB
   928	001120'	260040	001033*		PUSHJ 	P,GIVCBR
   929	001121'	260040	001034*		PUSHJ 	P,RIBWTL	;GET RIB WRITE LOCKED
   930	001122'	254000	001131'		 JRST 	CLSN2A		;ERROR
   931	001123'	554355	000000*		HLRZ T2,ATBMSC(P2)	;RESET ACCESS DATE
   932	001124'	542340	376000*		HRRM T2,%RIB+RIBEXT
   933	001125'	200355	001105*		MOVE T2,ATBLCW(P2)	;GET LIC WORD
   934	001126'	312340	376000*		CAME T2,%RIB+RIBLCW	;IF ITS CHANGING
   935	001127'	202340	376000*		MOVEM T2,%RIB+RIBLCW	;THEN CHANGE IT.
   936	001130'	260040	000560*		PUSHJ P,RELLOK		;FINISHED WITH RIB
   937	001131'	260040	001075*	CLSN2A:	PUSHJ P,GETCBR
   938	001132'	200355	001047*		MOVE T2,ATBSTS(P2)
   939	001133'	602340	001025*		TRNE T2,ATPREN
   940	001134'	254000	001200'		JRST CLSXT1		;% RENAME ON WHILE RIB FIDDLE, EXIT
   941	001135'	602340	777777*		TRNE T2,ATMCNT-1		;% COUNT NOW 1?
   942	001136'	254000	001141'		JRST CLSIN3		;% NO
   943	001137'	602340	001031*		TRNE T2,ATPDEL		;% YES, HAS DELETE GONE ON?
   944	001140'	254000	001033'		JRST CLIDEL		;%YES, GO DELETE FILE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 19-2
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

   945
   946				;DELETE EXPECTS TO JUMP INTO THIS POINT ON RIB ERROR, WITH ATBRIB POSSIBLY 0.
   947
   948	001141'	603200	020040	CLSIN3:	TLNE	F,ENTRB+RENMB	;% ENTER OR RENAME DONE?
   949	001142'	254000	001204'		JRST CLSXIT		;% YES, EXIT (UPDATE SUPPRESSING OUTPUT CLOSE)
   950	001143'	550715	001044*		HRRZ P3,ATBFNB(P2)
   951	001144'	260040	001045*		PUSHJ P,ULKDBL	;REMOVE DDB FROM LINKED LIST
   952	001145'	211300	001046*		MOVNI T1,ATPCNT
   953	001146'	273315	001132*		ADDB T1,ATBSTS(P2)	;DECREMENT COUNT
   954	001147'	612300	006107'		TDNE T1,[ATMUMC,,ATMCNT!ATPUPD!ATPMXU]
   955	001150'	254000	001176'		JRST CLSIN5		;STILL IN USE
   956	001151'	603200	010004		TLNE	F,INPB!MAPB		;% NO. ANY INPUTS BEEN DONE?
   957	001152'	254000	001175'		JRST	CLSIN6		;% YES, JUST MAKE A.T. DORMANT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 20
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

   958				;HERE TO SEE IF NMB NOW HAS NO A.T.S IN ITS RING
   959	001153'	260040	000132*	CLSN3A:	PUSHJ P,FREATB		;% RETURN AT TO FREE STORAGE
   960	001154'	554316	000250*		HLRZ T1,FNBATB(P3)	;% ANY ATBS LEFT?
   961	001155'	326300	001176'		JUMPN T1,CLSIN5		;% YES, DO NOT DELETE FNB
   962	001156'	550356	000000*		HRRZ T2,FNBDRB(P3)	;% GET SET TO REMOVE FNB
   963	001157'	201407	000000*		MOVEI T3,DRBFNB-FNBLNK(T2)	;% FAKE A PRED.
   964	001160'	554347	000257*		HLRZ T2,DRBFNB(T2)	;% FIRST FNB
   965	001161'	306356	000000	CLSN3B:	CAIN T2,(P3)
   966	001162'	254000	001167'		JRST CLSIN4
   967	001163'	200400	000007		MOVE T3,T2		;% RESET PRED
   968	001164'	554347	000000*		HLRZ T2,FNBLNK(T2)	;% NEXT
   969	001165'	326340	001161'		JUMPN T2,CLSN3B
   970	001166'	256000	000000'		 STOPCD (SLO)
   971						;;CLSN3B+5
   972
   973	001167'	200316	001164*	CLSIN4:	MOVE T1,FNBLNK(P3)	;% NOW LINK AROUND FNB
   974	001170'	502310	001167*		HLLM T1,FNBLNK(T3)
   975	001171'	200340	000264*		MOVE T2,SYSCOR
   976	001172'	506700	001171*		HRLM P3,SYSCOR
   977	001173'	502356	000263*		HLLM T2,CMBLNK(P3)	;% AND PUT FNB ON FREE LIST
   978	001174'	254000	001176'		JRST CLSIN5
   979
   980	001175'	260040	000143*	CLSIN6:	PUSHJ P,LKDATB		;%JUST PUT THE ATB ON DORMANT LIST
   981	001176'	402004	001017*	CLSIN5:	SETZM DEVATB(F)
   982	001177'	254000	001210'		JRST CLSXT2
   983
   984	001200'	550715	001143*	CLSXT1:	HRRZ P3,ATBFNB(P2)
   985	001201'	260040	001144*		PUSHJ P,ULKDBL
   986	001202'	402004	001176*		SETZM DEVATB(F)
   987	001203'	634300	000006		TDZA T1,T1	;FOR DEB IN DAYSTS
   988	001204'	201300	000003	CLSXIT:	MOVEI T1,DECUP2	;HERE ON UPDATE CLOSE IN (SET DEYSTC
   989	001205'	137300	001015*		DPB T1,DEYSTC
   990	001206'	211300	001145*		MOVNI T1,ATPCNT
   991	001207'	272315	001146*		ADDM T1,ATBSTS(P2)	;% DEC COUNT
   992	001210'	370317	000144*	CLSXT2:	SOS T1,DRBCNT(P4)
   993	001211'	602300	000145*		TRNE T1,DRPMXC
   994	001212'	256000	000000'		 STOPCD (SLO)
   995				           ;;CLSXT2+2
   996	001213'	202004	000002	STOCBR:	MOVEM S,DEVIOS(F)
   997	001214'	502212	000000*		HLLM F,%UPT+UPTJDA(W)
   998	001215'	324740	001120*		PJRST GIVCBR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 21
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

   999				;CLOSE OUTPUT
  1000
  1001
  1002	001216'	607200	020000	CLOSOU:	TLNN	F,ENTRB	;ENTER OR RENAME DONE?
  1003	001217'	263040	000000		POPJ	P,		;NO. RETURN
  1004	001220'	260040	002007'		PUSHJ P,TSTRES
  1005	001221'	702600	400000*		NOCHARGE	;TURN OFF CHARGING
  1006	001222'	260040	001013*		PUSHJ P,SIMRLS		;CLEAN UP SIMIO DATA BASE
  1007	001223'	201300	000005		MOVEI T1,DECSTP
  1008	001224'	137300	001205*		DPB T1,DEYSTC
  1009	001225'	550644	001202*		HRRZ P2,DEVATB(F)
  1010	001226'	554744	001020*		HLRZ P4,DEVDRB(F)
  1011	001227'	332000	000015		SKIPE P2
  1012	001230'	336000	000017		SKIPN P4
  1013	001231'	256000	000000'		 STOPCD (SLO)
  1014				           ;;CLOSOU+11
  1015	001232'	550715	001200*		HRRZ P3,ATBFNB(P2)	;JUST TO MAKE SURE ITS LOADED
  1016	001233'	260040	000000*		PUSHJ P,PTROUT	;DUMP CHANGED POINTERS
  1017	001234'	254000	001300'		 JRST NOOUT2	;RIB ERROR
  1018	001235'	254000	001241'		 JRST CLSOU1	;NONE (RIB NOT GOTTEN)
  1019	001236'	336000	376000*		SKIPN %RIB+RIBRIB	;IS IT THE PRIME RIB IN CORE
  1020	001237'	254000	001243'		JRST CLSOU0	;YES, GO
  1021	001240'	260040	001130*		PUSHJ P,RELLOK	;GET RID OF IT
  1022	001241'	260040	001121*	CLSOU1:	PUSHJ P,RIBWTL	;GET RIB WRITE LOCKED
  1023	001242'	254000	001300'		 JRST NOOUT2	;CAN NOT, RIB ERROR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 22
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1024				;HERE WHEN THE FILE IS COMPLETELY WRITTEN
  1025	001243'	602540	000040	CLSOU0:	TRNE	M,CLSRST	;SHOULD THIS CLOSE ACT LIKE A RESET?
  1026	001244'	661200	000020		TLO	F,RESETB	;YES. TURN ON RESETB
  1027	001245'	550644	001225*		HRRZ	P2,DEVATB(F)	;NO. JUST GET LOC OF A.T.
  1028	001246'	200355	001207*		MOVE	T2,ATBSTS(P2)	;STATUS OF FILE
  1029	001247'	606340	000000*		TRNN	T2,ATPCRE!ATPSUP ;SKIP IF NOT UPDATING
  1030	001250'	621200	000020		TLZ	F,RESETB	;UPDATING, MAKE SURE FILE ISNT DELETED
  1031	001251'	627200	000020		TLZN F,RESETB	;IS THIS A RESET?
  1032	001252'	254000	001315'		JRST CLSOU2	;NO, GO
  1033	001253'	260040	001036*		PUSHJ	P,DLTALL	;I CAN'T BELIEVE I ATE THE WHOLE THING.
  1034	001254'	255000	000000		 JFCL
  1035	001255'	402015	001040*		SETZM	ATBRIB(P2) ;TELL REMOVE RIB IS GONE. NO ONE ELSE
  1036							; CAN USE THIS ATB YET IS ASSUMPTION.
  1037	001256'	260040	001527'		PUSHJ P,LOGTST	;AND UFD QUOTAS
  1038	001257'	260040	001131*	CLORS1:	PUSHJ P,GETCBR
  1039	001260'	550715	001232*		HRRZ P3,ATBFNB(P2)
  1040	001261'	260040	001201*		PUSHJ P,ULKDBL	;UNLINK DDB FROM FNB
  1041	001262'	201300	000000*		MOVEI T1,ATPCRE!ATPSUP	;TURN THESE OFF IN CASE THIS STAYS AROUND
  1042	001263'	410315	001246*		ANDCA T1,ATBSTS(P2)	;GET STATUS WITHOUT BITS
  1043	001264'	607300	001050*		TLNN T1,ATMUMC		;ANYTHING STILL MAPPED?
  1044								; (MUST BE THIS JOB)
  1045	001265'	254000	001271'		JRST CLORS2		;NO, DELETE THE ATB
  1046	001266'	660300	001137*		TRO T1,ATPDEL		;YES, SET ATPDEL SO DECUMC WILL DELETE THE ATB
  1047								;WHEN LAST PAGE IS UNMAPPED
  1048	001267'	202315	001263*		MOVEM T1,ATBSTS(P2)	;STORE
  1049	001270'	254000	001272'		JRST CLORS3
  1050	001271'	260040	001153*	CLORS2:	PUSHJ P,FREATB	;RETURN ATB TO FREE CORE
  1051	001272'	370357	001210*	CLORS3:	SOS T2,DRBCNT(P4)	;DECREMENT COUNT
  1052	001273'	602340	001211*		TRNE T2,DRPMXC
  1053	001274'	256000	000000'		 STOPCD (SLO)
  1054						;;CLORS3+2
  1055	001275'	402004	001245*		SETZM DEVATB(F)
  1056	001276'	621200	060040		TLZ F,ENTRB!RENMB!LOOKB
  1057	001277'	324740	001213'		PJRST STOCBR	;DONE
  1058
  1059	001300'	623200	000020	NOOUT2:	TLZE F,RESETB	;RIB ERROR, RESET?
  1060	001301'	254000	001307'		JRST CLORST	;YES, GO DUMP IT
  1061	001302'	200315	001267*		MOVE T1,ATBSTS(P2)
  1062	001303'	606300	000000*		TRNN	T1,ATPCRE!ATPSUP	;SKIP IF NOT UPDATE
  1063	001304'	254000	001465'		JRST	CLOUPD	;THIS IS UPDATE, MUST WATCH OUT FOR OTHER USERS OF FILE ETC.
  1064	001305'	602300	000000*		TRNE T1,ATPCRE	;IS THIS CREATE?
  1065	001306'	254000	001444'		JRST CLOSCR	;GO DO IT ANYWAY
  1066
  1067	001307'	200315	001053*	CLORST:	MOVE T1,ATBALP(P2)	;TRY TO ADJUST QUOTAS
  1068	001310'	270317	001057*		ADD T1,DRBALC(P4)
  1069	001311'	331017	001310*		SKIPL DRBALC(P4)
  1070	001312'	331000	000006		SKIPL T1
  1071	001313'	202317	001311*		MOVEM T1,DRBALC(P4)
  1072	001314'	254000	001257'		JRST CLORS1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 23
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1073	001315'	200315	000000*	CLSOU2:	MOVE	T1,ATBSIZ(P2)	;RESET SOME THING IN RIB
  1074	001316'	602300	000177		TRNE	T1,177
  1075	001317'	275300	000200		SUBI	T1,200
  1076	001320'	312300	376000*		CAME	T1,%RIB+RIBSIZ	;CHANGE ONLY IF CHANGING
  1077	001321'	202300	376000*		MOVEM	T1,%RIB+RIBSIZ
  1078	001322'	200300	001115*		MOVE	T1,THSDAT
  1079	001323'	200415	001302*		MOVE	T3,ATBSTS(P2)
  1080	001324'	606400	000000*		TRNN	T3,ATPCRE!ATPSUP
  1081	001325'	603200	014004		TLNE	F,INPB!OUTPB!MAPB	;IF UPDATE, RESET ONLY IF I/O
  1082	001326'	137300	001117*		DPB	T1,ATYADT		;SET ACCESS DATE
  1083	001327'	554315	001123*		HLRZ	T1,ATBMSC(P2)
  1084	001330'	550340	376000*		HRRZ	T2,%RIB+RIBEXT	;SEE IF CHANGING
  1085	001331'	312300	000007		CAME	T1,T2
  1086	001332'	542300	376000*		HRRM	T1,%RIB+RIBEXT
  1087	001333'	200315	001125*		MOVE	T1,ATBLCW(P2)
  1088	001334'	200340	376000*		MOVE	T2,%RIB+RIBSTS
  1089	001335'	606340	000000*		TRNN	T2,RIPHWE!RIPHRE!RIPBDA!RIPBFS!RIPBDR
  1090	001336'	625300	000000*		TLZA	T1,ATPUFE
  1091	001337'	661300	001336*		TLO	T1,ATPUFE
  1092	001340'	602400	000000*		TRNE	T3,ATPSUP!ATPCRE	;IF NOT UPDATE,
  1093	001341'	661300	001106*		TLO	T1,ATPALC	;THEN HAVE TO SET THIS BECAUSE PRIME RIB GOT ALLOCATED
  1094								;IF NOTHING ELSE.
  1095	001342'	202315	001333*		MOVEM	T1,ATBLCW(P2)	;GET SET FROM ERROR BITS
  1096	001343'	312300	376000*		CAME	T1,%RIB+RIBLCW 	;ONLY WRITE IF ITS CHANGING
  1097	001344'	202300	376000*		MOVEM	T1,%RIB+RIBLCW
  1098	001345'	200315	001307*		MOVE	T1,ATBALP(P2)
  1099	001346'	312300	376000*		CAME	T1,%RIB+RIBALP
  1100	001347'	202300	376000*		MOVEM	T1,%RIB+RIBALP
  1101	001350'	200315	000000*		MOVE	T1,ATBPVW(P2)
  1102	001351'	312300	376000*		CAME	T1,%RIB+RIBPVW
  1103	001352'	202300	376000*		MOVEM	T1,%RIB+RIBPVW
  1104	001353'	550415	001260*		HRRZ	T3,ATBFNB(P2)	;GET FNB
  1105	001354'	200315	001342*		MOVE	T1,ATBLCW(P2)	;GET ATPALC BIT
  1106	001355'	607300	001341*		TLNN	T1,ATPALC	;IF ATPALC IS SET, THEN NEED TO STORE RIBALT AND FNBALT
  1107	001356'	254000	001363'		JRST	CLSOU3
  1108	001357'	200340	000000*		MOVE	T2,PCDTIM	;OK, SET FNBALT AND RIBALT FOR ANY ALLOCATION
  1109								; THAT MIGHT HAVE HAPPENED
  1110	001360'	312340	376000*		CAME	T2,%RIB+RIBALT  	;ONLY CHANGE IF ITS CHANGING
  1111	001361'	202340	376000*		MOVEM	T2,%RIB+RIBALT	;SET CORRECT VALUE.
  1112	001362'	202350	000000*		MOVEM	T2,FNBALT(T3)	;WE MAY BE INCREASING THE FNBALT FOR
  1113								; THE OLD FILE, BUT DOESN'T MATTER SINCE
  1114								; NORMALLY OLD FILE GOES AWAY UNLESS
  1115								; CAN'T UPDATE UFD OR SOMETHING, IN WHICH
  1116								; CASE NO HARM MAKING THIS BIGGER.
  1117								; (IN THAT CASE, RIBALT WILL DIFFER FROM FNBALT)
  1118	001363'	260040	001240*	CLSOU3:	PUSHJ	P,RELLOK	;ASSUME THIS WON'T RESCHEDULE.
  1119								; (OR ELSE PCDTIM WILL BE WRONG FOR THE RIB.)
  1120	001364'	200355	001323*		MOVE	T2,ATBSTS(P2)
  1121	001365'	602340	001305*		TRNE	T2,ATPCRE
  1122	001366'	254000	001444'		JRST	CLOSCR		;CLOSE FOR CREATE
  1123	001367'	260040	001727'		PUSHJ	P,UPDUFD	;UPDATE THE UFD.
  1124	001370'	200315	001364*		MOVE	T1,ATBSTS(P2)
  1125	001371'	606300	000000*		TRNN	T1,ATPSUP 	;IF SUPERCEDE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 23-2
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1126	001372'	254000	001465'		JRST	CLOUPD		;NOT, MUST BE UPDATE
  1127	001373'	205340	001355*		MOVSI	T2,ATPALC	;AND IF ALC IS ON,
  1128	001374'	612355	001354*		TDNE	T2,ATBLCW(P2)	;THEN
  1129	001375'	260040	000000*		PUSHJ	P,WATPCB	;MUST WAIT FOR UFPALC TO GO OUT.
  1130								; OR ELSE MIGHT GET OLD UFD POINTER WITH NO
  1131								; BIT ON POINTING TO FREE PAGE.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 24
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1132				;SUPERCEDE MUST LOOK AT OTHER A.T.'S
  1133
  1134	001376'	260040	001257*		PUSHJ P,GETCBR
  1135	001377'	201340	000000*		MOVEI T2,ATPUPD!ATPSUP!ATPMXU
  1136								;TURN SUP INTO UPD
  1137								; SO THAT ANYONE WHO LOOKS UP THIS
  1138								; FILE WHILE WE'RE STILL CLOSING WILL
  1139								; GET THIS COPY.
  1140	001400'	432355	001370*		XORM T2,ATBSTS(P2)
  1141	001401'	350355	000000*		AOS T2,ATBMWC(P2)	;INCREMENT MAX WRITE COUNT
  1142	001402'	606340	000000*		TRNN T2,ATMMWC		;CHECK FOR OVERFLOW
  1143	001403'	256000	000000'		 STOPCD (SLO)
  1144						;;CLOSU3+20
  1145	001404'	350016	000000*		AOS FNBUPD(P3)		;BUMP COUNT OF UPDATERS
  1146	001405'	554356	001154*		HLRZ T2,FNBATB(P3)	;GET SET TO SEARCH
  1147	001406'	200307	001400*	CLOSU1:	MOVE T1,ATBSTS(T2)	;IF THERE IS ONE SUP ATB, SHOULDN'T BE
  1148	001407'	602300	000000*		TRNE T1,ATPCRE!ATPSUP!ATPREN ; ANY OTHER WRITERS
  1149	001410'	256000	000000'		 STOPCD (SLO)
  1150						;;CLOSU1+2
  1151	001411'	602300	000000*		TRNE T1,ATPUPD!ATPDEL ;IGNORE OUR OWN AND DELETED ONES
  1152	001412'	254000	001421'		JRST CLOSU2	;IGNORE THESE
  1153	001413'	332007	000000*		SKIPE ATBDOR(T2)	;NOT DORMANT MUST BE READERS
  1154	001414'	254000	001437'		JRST CLOSU3
  1155	001415'	201300	001266*		MOVEI T1,ATPDEL
  1156	001416'	436307	001406*		IORM T1,ATBSTS(T2)	;MARK TO DELETE IT
  1157	001417'	260040	001215*		PUSHJ P,GIVCBR
  1158	001420'	254000	001471'		JRST CLOCOM	;AND GO
  1159
  1160	001421'	554347	000000*	CLOSU2:	HLRZ T2,ATBLNK(T2)	;NEXT ATB
  1161	001422'	326340	001406'		JUMPN T2,CLOSU1
  1162	001423'	200315	001255*	CLOSU4:	MOVE T1,ATBRIB(P2)
  1163	001424'	250316	000000*		EXCH T1,FNBRIB(P3)
  1164	001425'	260040	001417*		PUSHJ P,GIVCBR
  1165	001426'	202304	000000*		MOVEM T1,DEVRIB(F)	;NOW MUST DELETE OLD
  1166	001427'	661000	000020		TLO S,IO
  1167	001430'	260040	000000*		PUSHJ P,CRBRWL
  1168					 JRST	[PUSHJ P,RELLOK
  1169	001431'	254000	006110'			JRST CLOCOM]	;RIB ERROR, GIVE UP
  1170	001432'	513004	001275*		HLLZS DEVATB(F)	;DO NOT WANT ATBALP ADJUSTED
  1171	001433'	260040	001253*		PUSHJ	P,DLTALL	;I CAN'T BELIEVE I ATE THE WHOLE THING.
  1172	001434'	255000	000000		 JFCL
  1173	001435'	542644	001432*		HRRM P2,DEVATB(F)	;RESTORE
  1174	001436'	254000	001471'		JRST CLOCOM	;NOW FOR COMMON CODE
  1175
  1176	001437'	261040	000015	CLOSU3:	PUSH P,P2
  1177	001440'	200640	000007		MOVE P2,T2	;MUST REMOVE ATB
  1178	001441'	260040	000252*		PUSHJ P,RMVATB
  1179	001442'	262040	000015		POP P,P2
  1180	001443'	254000	001423'		JRST CLOSU4	;AND FINISH UP
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 25
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1181	001444'	400340	000000	CLOSCR:	SETZ	T2,		;NO RET PNTR SUPPLIED TO INSNAM.
  1182	001445'	260040	000000*		PUSHJ P,INSNAM	;CREATE, INSERT NAME IN UFD
  1183	001446'	254000	001471'		 JRST CLOCOM	;COULDN'T(ALLOC FAIL, RIB ERR, DIR FULL).
  1184	001447'	260040	001545'		PUSHJ P,CREUFD	;PUT STUFF INTO THE DIRECTORY
  1185	001450'	260040	001363*		PUSHJ P,RELLOK
  1186	001451'	201300	000274*		MOVEI T1,ATPDIR
  1187	001452'	616315	001416*		TDNN T1,ATBSTS(P2)
  1188	001453'	254000	001471'		JRST CLOCOM
  1189	001454'	260040	001376*		PUSHJ P,GETCBR	;ITS A UFD. MUST WORRY IF DRB
  1190	001455'	200304	000015		MOVE T1,DEVFIL(F)
  1191	001456'	260040	000000*		PUSHJ P,FNDDRB
  1192	001457'	254000	001463'		 JRST CLOUF1	;NONE THERE
  1193	001460'	402007	000000*		SETZM DRBRIB(T2)
  1194	001461'	201300	000000*		MOVEI T1,DRPNX
  1195	001462'	412307	000000*		ANDCAM T1,DRBNX(T2)
  1196	001463'	260040	001425*	CLOUF1:	PUSHJ P,GIVCBR
  1197	001464'	254000	001471'		JRST CLOCOM
  1198
  1199	001465'	607200	040000	CLOUPD:	TLNN F,LOOKB	;IF CLOSING OUTPUT ONLY
  1200	001466'	254000	001471'		JRST CLOCOM
  1201	001467'	260040	000000*		PUSHJ	P,INVDDB	;INVALIDATE THE DDB, SET FILE LOC TO START.
  1202						;FALL INTO COMMON CODE
  1203	001470'	334300	006112'		SKIPA T1,[DECLUK]	;SET TO LOOKUP IF ONLY OUT CLSD
  1204	001471'	201300	000000	CLOCOM:	MOVEI T1,0	;DONE WITH STATUS
  1205	001472'	137300	001224*		DPB T1,DEYSTC
  1206	001473'	260040	001527'		PUSHJ P,LOGTST	;RESET UFD USD INFO IF NEEDED
  1207	001474'	200315	001423*		MOVE T1,ATBRIB(P2)
  1208	001475'	621200	020040		TLZ F,ENTRB!RENMB
  1209	001476'	202316	001424*		MOVEM T1,FNBRIB(P3)
  1210	001477'	205300	000000*		MOVSI T1,FNPNX
  1211	001500'	412316	000000*		ANDCAM T1,FNBNX(P3)	;MAKE SURE FNB MARKED AS THERE
  1212	001501'	260040	001454*		PUSHJ P,GETCBR
  1213	001502'	200315	001452*		MOVE T1,ATBSTS(P2)	;PICKUP ATBSTS
  1214	001503'	622300	000000*		TRZE T1,ATPSUP!ATPCRE	;CLEAR THESE, SKIP IF UPDATING
  1215	001504'	254000	001513'		JRST CLOCM1		;CREATE (SUPERCEDE TURNED INTO UPDATE)
  1216	001505'	375016	001404*		SOSGE FNBUPD(P3)	;DECREMENT UPDATE COUNT
  1217	001506'	256000	000000'		 STOPCD (SLO)
  1218						;;CLOCOM+15
  1219	001507'	370355	001401*		SOS T2,ATBMWC(P2)	;DECREMENT MWC FOR UPDATER
  1220	001510'	606340	001402*		TRNN T2,ATMMWC		;COUNT GO TO ZERO?
  1221	001511'	620300	000000*		TRZ T1,ATPMXU		;YES, CLEAR MAX WRITE BIT
  1222	001512'	620300	000152*		TRZ T1,ATPUPD		;CLEAR IN CASE IT WAS SINGLE UPDATER
  1223	001513'	202315	001502*	CLOCM1:	MOVEM T1,ATBSTS(P2)	;STORE NEW ATBSTS.
  1224	001514'	616300	006113'		TDNN T1,[ATMUMC,,ATPMXU!ATMCNT] ;SKIP IF ANY USERS STILL
  1225	001515'	260040	001175*		PUSHJ P,LKDATB	;MAKE ATB DORMANT IF NO MORE USERS
  1226	001516'	370317	001272*		SOS T1,DRBCNT(P4)
  1227	001517'	602300	001273*		TRNE T1,DRPMXC
  1228	001520'	256000	000000'		 STOPCD (SLO)
  1229				           ;;CLOCM1+5
  1230	001521'	603200	040000		TLNE	F,LOOKB
  1231	001522'	254000	001525'		JRST	CLOCM2		;ALMOST DONE.
  1232	001523'	260040	001261*		PUSHJ	P,ULKDBL	;REMOVE FROM DDB LIST
  1233	001524'	402004	001435*		SETZM	DEVATB(F)	;NO MORE AT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 25-2
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1234	001525'	260040	001213'	CLOCM2:	PUSHJ	P,STOCBR	;
  1235	001526'	324740	001375*		PJRST	WATPCB		;
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 26
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1236				;TEST TO SEE IF THE USER IS LOGGED IN AND RESET UFD USD IF NOT
  1237
  1238	001527'	201340	000204*	LOGTST:	MOVEI T2,DRPLOG
  1239	001530'	612357	000205*		TDNE T2,DRBLOG(P4)
  1240	001531'	263040	000000		POPJ P,		;NOT LOGGED IN
  1241	001532'	661000	000020		TLO S,IO
  1242	001533'	260040	000000*		PUSHJ P,RIBDIR
  1243	001534'	324740	001450*		 PJRST RELLOK	;CAN NOT GET IT
  1244	001535'	554304	001226*		HLRZ T1,DEVDRB(F)
  1245	001536'	200340	376000*		MOVE T2,%RIB+RIBQTF
  1246	001537'	274346	001313*		SUB T2,DRBALC(T1)
  1247	001540'	202340	376000*		MOVEM T2,%RIB+RIBUSD
  1248	001541'	200340	376000*		MOVE T2,%RIB+RIBQTF
  1249	001542'	274346	000000*		SUB T2,DRBMXA(T1)
  1250	001543'	202340	376000*		MOVEM T2,%RIB+RIBMXA
  1251	001544'	324740	001534*		PJRST RELLOK	;ALL DONE
  1252
  1253				;FILL IN THE UFD FROM THE IN CORE TABLES
  1254				; USES T1-T3. EXPECT P2/ATB ADDRESS.
  1255
  1256	001545'	261040	000016	CREUFD:	PUSH	P,P3		;SAVE P3 AND SETUP TO BE FNB ADDRESS
  1257	001546'	550715	001353*		HRRZ	P3,ATBFNB(P2)	;GET FNB ADDR IN P3
  1258	001547'	261040	000011		PUSH	P,T4		;SVE T4 FOR COMPARES BELOW
  1259	001550'	200304	000015		MOVE T1,DEVFIL(F)
  1260	001551'	312307	376000*		CAME	T1,%RIB+UFDNAM(T2) ;DON'T WRITE IF ITS THE SAME
  1261	001552'	202307	376000*		MOVEM T1,%RIB+UFDNAM(T2)	;T2 POINTS TO THE UFD SLOT
  1262	001553'	510304	000016		HLLZ T1,DEVEXT(F)
  1263	001554'	510447	376000*		HLLZ	T4,%RIB+UFDEXT(T2)	;SEE IF ITS SAME
  1264	001555'	312300	000011		CAME	T1,T4
  1265	001556'	202307	376000*		MOVEM	T1,%RIB+UFDEXT(T2)	;NOT, UPDATE.
  1266	001557'	135400	000000*		LDB T3,ATYPRV
  1267	001560'	135440	000476*		LDB	T4,UFYPRV		;SEE IF SAME
  1268	001561'	312400	000011		CAME	T3,T4		;SKIP IF NO NEED TO WRITE
  1269	001562'	137400	001560*		DPB T3,UFYPRV
  1270	001563'	135400	000000*		LDB T3,ATYUF2
  1271	001564'	135440	000477*		LDB	T4,UFYUF2	;SEE IF ANY NEED TO WRITE
  1272	001565'	312400	000011		CAME	T3,T4		;?
  1273	001566'	137400	001564*		DPB T3,UFYUF2
  1274	001567'	135300	000000*		LDB T1,ATYCDT
  1275	001570'	312307	376000*		CAME	T1,%RIB+UFDCDT(T2)	;ANY NEED TO WRITE?
  1276	001571'	202307	376000*		MOVEM T1,%RIB+UFDCDT(T2)	;CREATION DATE
  1277	001572'	135300	000000*		LDB T1,ATYXCD
  1278	001573'	135440	000440*		LDB	T4,UFYXCD	;SEE IF SAME
  1279	001574'	312300	000011		CAME	T1,T4
  1280	001575'	137300	001573*		DPB T1,UFYXCD	;AND THE EXTENDED PART
  1281	001576'	135300	000000*		LDB T1,ATYCTM
  1282	001577'	221300	000074		IMULI T1,^D60
  1283	001600'	135400	000000*		LDB T3,ATYCSC	;SECONDS
  1284	001601'	270300	000010		ADD T1,T3
  1285	001602'	135440	000442*		LDB	T4,UFYCTM	;SEE IF SAME
  1286	001603'	312300	000011		CAME	T1,T4
  1287	001604'	137300	001602*		DPB T1,UFYCTM	;AND STORE IN UFD
  1288	001605'	135300	000000*		LDB T1,ATYUF1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 26-2
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1289	001606'	135440	000501*		LDB	T4,UFYUF1
  1290	001607'	312300	000011		CAME	T1,T4
  1291	001610'	137300	001606*		DPB T1,UFYUF1	;MORE BITS
  1292	001611'	200315	000000*		MOVE T1,ATBLIC(P2)
  1293	001612'	550447	376000*		HRRZ	T4,%RIB+UFDLIC(T2)
  1294	001613'	312300	000011		CAME	T1,T4
  1295	001614'	552307	376000*		HRRZM T1,%RIB+UFDLIC(T2)
  1296	001615'	200315	001345*		MOVE T1,ATBALP(P2)	;NUMBER OF ALLOCATED PAGES
  1297	001616'	301300	400000		CAIL T1,400000
  1298	001617'	201300	400000		MOVEI T1,400000	;SET FLAGIF VERY BIG. NEEDS LOOKUP
  1299	001620'	554447	376000*		HLRZ	T4,%RIB+UFDALP(T2)
  1300	001621'	312300	000011		CAME	T1,T4
  1301	001622'	506307	376000*		HRLM T1,%RIB+UFDALP(T2)
  1302	001623'	200315	001474*		MOVE T1,ATBRIB(P2)
  1303	001624'	312307	376000*		CAME	T1,%RIB+UFDRIB(T2)
  1304	001625'	202307	376000*		MOVEM T1,%RIB+UFDRIB(T2)
  1305	001626'	262040	000011		POP	P,T4		;RESTORE T4 AND
  1306	001627'	262040	000016		POP	P,P3		;P3
  1307	001630'	263040	000000		POPJ P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 27
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1308				;ROUTINE TO FILL IN ATB WITH PRELIMINARY INFORMATION FROM UFD
  1309				; ENTRY IN CASE WE GET A RIB ERROR TRYING TO READ RIB.
  1310				; CALLED FROM SRCFIL WITH CB, DRBCNT UP, RIB LOCKED STILL.
  1311				; DOES NOT FILL IN ATBRIB, SINCE INFO IS REALLY NOT VALID - IS
  1312				; OVERWRITTEN WITH THE REAL DATA FROM THE RIB NORMALLY.
  1313				; IF GET A RIB ERROR, PROTECTION AND PID ARE SETUP SO THAT
  1314				; USER CAN DELETE IT IF IT REALLY WAS HIS FILE AND IT WAS
  1315				; PROTECTED SO HE COULD DELETE IT.
  1316				; P2 HAS ATB ADDRESS, T2 HAS POINER TO UFD ENTRY (%RIB+UFD???(T2))
  1317
  1318	001631'	332015	001623*	UFDATB::SKIPE	ATBRIB(P2)	;MAKE SURE NOTHING IN THERE ALREADY
  1319	001632'	256000	000000'		 STOPCD (SLO)
  1320						;;UFDATB+1
  1321	001633'	135300	001562*		LDB	T1,UFYPRV	;GET PROTECTION CODE
  1322	001634'	137300	001557*		DPB	T1,ATYPRV	;STORE IT THERE.
  1323	001635'	135300	001566*		LDB	T1,UFYUF2	;GET DUMPED, ERROR, PID BITS ETC
  1324	001636'	137300	001563*		DPB	T1,ATYUF2
  1325	001637'	200307	376000*		MOVE	T1,%RIB+UFDCDT(T2) ;GET CREATION DATE
  1326	001640'	137300	001567*		DPB	T1,ATYCDT
  1327	001641'	135300	001575*		LDB	T1,UFYXCD	;GET REST OF BITS (EXTENDED)
  1328	001642'	137300	001572*		DPB	T1,ATYXCD
  1329	001643'	135300	001604*		LDB	T1,UFYCTM
  1330	001644'	231300	000074		IDIVI	T1,^D60		;GET SECONDS IN T2, TIME IN T1
  1331	001645'	137300	001576*		DPB	T1,ATYCTM	;IN MINUTES
  1332	001646'	137340	001600*		DPB	T2,ATYCSC	;IN SECONDS
  1333	001647'	135300	001610*		LDB	T1,UFYUF1	;GET FIRST 4 BITS
  1334	001650'	137300	001605*		DPB	T1,ATYUF1	;AND STORE THEM
  1335	001651'	550307	376000*		HRRZ	T1,%RIB+UFDLIC(T2)
  1336	001652'	542315	001611*		HRRM	T1,ATBLIC(P2)	;STORE INTO RH OF ATBLIC.
  1337								;(FOR INFO - CAN'T RUN ANYTHING ANYWAY)
  1338	001653'	200307	376000*		MOVE	T1,%RIB+UFDALP(T2) ;GET SIZE
  1339	001654'	202315	001615*		MOVEM	T1,ATBALP(P2)	;STORE. INCLUDES 400000,,0 IF DON'T KNOW HOW BIG.
  1340	001655'	205300	000000*		MOVSI	T1,ATPPID	;DOES THIS FILE HAVE A PID?
  1341	001656'	616315	001374*		TDNN	T1,ATBLCW(P2)	;IF NOT, JUST RETURN.
  1342	001657'	263040	000000		POPJ	P,		;AND RETURN.
  1343	001660'	201300	777777		MOVEI	T1,777777	;USE LAST SYSTEM PID
  1344					MOVEM	T1,ATBPID(P2)	;SO THAT ITS PROTECTED AGAINST THE OWNER UNLESS HE HAS LICENSE.
  1345	001661'	202315	000000*
  1346	001662'	263040	000000		POPJ	P,		;RETURN NOW.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 28
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1347				;ROUTINE CALLED BY ROUTINES THAT ALLOCATE BEFORE THEY ALLOCATE
  1348				; TO SET UFDALC AND ATBALC. GETS CB RESOURCE, NEEDS %RIB TO
  1349				; PUT UFD INTO.
  1350				; EXPECTS F/DDB ADDRESS
  1351				; USES T1-T3
  1352				; IF CALER DOESN'T WANT ANYTHING TO HAPPEN UNLESS ATPALC IS CLEAR,
  1353				; HE MUST CHECK HIMSELF. OTHERWISE ALL CHANGED UFD VALUES WILL GET
  1354				; UPDATED.
  1355
  1356	001663'	260040	001501*	SETACH::PUSHJ	P,GETCBR	;GET CB RESOURCE
  1357	001664'	550344	001524*		HRRZ	T2,DEVATB(F)	;GET ATB ADDRESS IN T2 FOR FILSER ROUTINES
  1358	001665'	550407	001546*		HRRZ	T3,ATBFNB(T2)	;GET FNB ADDRESS IN T3
  1359	001666'	200307	001631*		MOVE	T1,ATBRIB(T2)	;MAKE SURE THIS FILE-ATB IS THE ONE WITH UFD ENTRY
  1360	001667'	312310	001476*		CAME	T1,FNBRIB(T3)
  1361	001670'	324740	001463*		PJRST	GIVCBR		;ITS NOT, DON'T HAVE TO SET THE BIT
  1362	001671'	476010	001362*		SETOM	FNBALT(T3)	;SO THAT NO ONE WILL CLEAR IT - ACTUALLY JUST DEBUGGING CHECK
  1363	001672'	205300	001373*		MOVSI	T1,ATPALC	;GET THE BIT
  1364	001673'	612307	001656*		TDNE	T1,ATBLCW(T2)	;IS IS SET ALREADY?
  1365	001674'	324740	001670*		PJRST	GIVCBR		;YES, THEN NO NEED TO WRITE OUT UFD AGAIN
  1366	001675'	436307	001673*		IORM	T1,ATBLCW(T2)	;NO, SO SET IT. NO ONE WILL CLEAR THIS
  1367								; AFTER RELEASE OF CB, SINCE WE HAVE WRITE
  1368								; BITS ON IN THIS ATB.
  1369	001676'	261040	000015		PUSH	P,P2		;SAVE P2, NEED IT FOR ATB ADDRESS FOR UPDUF0
  1370	001677'	200640	000007		MOVE	P2,T2		;GET ATB ADDRESS IN P2
  1371	001700'	260040	001726'		PUSHJ	P,UPDUF0	;DO THE COMMON WORK
  1372	001701'	262040	000015		POP	P,P2		;RESTORE P2
  1373	001702'	261040	000011		PUSH	P,T4		;BOY OH BOY, WATPCB CLOBBERS T4 AND WE CAN'T
  1374	001703'	260040	001526*		PUSHJ	P,WATPCB
  1375	001704'	262040	000011		POP	P,T4
  1376	001705'	263040	000000		POPJ	P,		;RETURN.
  1377
  1378				;HERE IF ATPALC WAS ON TO CLEAR IT
  1379				; WITH CB RESOURCE.
  1380				;EXPECTS ATB ADDRESS IN P2
  1381				;SMASHES T1-T3
  1382
  1383	001706'	260040	000000*	CLRACH:	PUSHJ	P,TSTWRT	;DON'T MUCK WITH IT IF FILE IS OPEN FOR ANY SORT OF WRITE
  1384	001707'	263040	000000		  POPJ	P,		;GO AWAY, STILL HAVE CB
  1385	001710'	550415	001665*		HRRZ	T3,ATBFNB(P2)	;GET FNB ADDR IN T3
  1386	001711'	200315	001666*		MOVE	T1,ATBRIB(P2)	;GET RIB POINTER
  1387	001712'	312310	001667*		CAME	T1,FNBRIB(T3)	;MAKE SURE THIS FILE IS STILL IN UFD
  1388	001713'	263040	000000		POPJ	P,		;JUST RETURN WITH CB STILL
  1389	001714'	200310	001671*		MOVE	T1,FNBALT(T3)	;GET WHAT PCB DIRTY MONITOR CLOCK WAS AFTER ALLOCATION
  1390	001715'	313300	001357*		CAMLE	T1,PCDTIM	;IF ALT IS GREATER THAN CURRENT PCDTIM,
  1391	001716'	254000	001722'		JRST	CLRAC0		; THEN RIBALT MUST HAVE BEEN FROM PREVIOUS MONITOR.
  1392								; SO CLEAR ATPALC.
  1393	001717'	271300	000002		ADDI	T1,2		;ONE COUNT FOR THE PCBS THAT WERE ON THEIR
  1394								; WAY OUT, ONE FOR THE ONES THAT WERE DIRTY
  1395	001720'	313300	001715*		CAMLE	T1,PCDTIM	;IF IT HAS INCREMENTED 2 TIMES, WE WIN
  1396	001721'	263040	000000		POPJ	P,		;SORRY, EVERTHING HASN'T GONE OUT YET.
  1397
  1398				;NOW WE NOW THERE ARE NO MORE WRITERS OF FILE, THE ATB STILL
  1399				; REPRESENTS THE FILE WHICH HAS A UFD ENTRY, AND ALL THE PCBS THAT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 28-2
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1400				; WERE DIRTY AT THE LAST ALLOCATION CHANGE HAVE BEEN WRITTEN OUT
  1401				; AT LEAST ONCE, AND ALL THE PCBS WHICH HAD IO IN PROGRESS HAVE
  1402				; BEEN WRITTEN OUT ONCE AFTER THAT IO STOPPED. WE CAN NOW SAFELY
  1403				; SAY THAT ALL INFORMATION (RIBS, SATS, UFD ENTRIES) FOR THE FILE
  1404				; ARE ON THE DISK.
  1405	001722'	205300	001672*	CLRAC0:	MOVSI	T1,ATPALC
  1406	001723'	412315	001675*		ANDCAM	T1,ATBLCW(P2)	;CLEAR IT AND
  1407	001724'	260040	001726'		PUSHJ	P,UPDUF0	;UPDATE THE UFD
  1408	001725'	324740	001663*		PJRST	GETCBR		;GET CB BACK FOR CALLER AND RETURN.
  1409								;(NO NEED TO WAIT FOR CLEARED BIT TO MAKE IT BACK TO DISK.)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 29
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1410				;ROUTINE TO UPDATE A UFD ENTRY FROM ATB INFORMATION
  1411				; CAL WITH CB AT UPDUF0 OR WITHOUT AT UPDUFD
  1412				; USES T1-T3, %RIB.
  1413				; EXPECTS ATB ADDRESS IN P2, DDB ADDRESS IN F.
  1414
  1415	001726'	260040	001674*	UPDUF0:	PUSHJ	P,GIVCBR	;GIVE BACK CB CALLER SHOULD HAVE HAD.
  1416	001727'	261040	000017	UPDUFD:	PUSH	P,P4		;SVE THIS
  1417	001730'	261040	000011		PUSH	P,T4		;MUST SAVE THIS TOO.
  1418	001731'	554744	001664*		HLRZ	P4,DEVATB(F)	;GET DRB ADDRESS
  1419	001732'	260040	001533*		PUSHJ	P,RIBDIR	;GET UFD RIB IN %RIB
  1420	001733'	254000	001754'		  JRST	UPDNUR		;NO UFD RIB, MUST CALL RELLOK
  1421	001734'	261040	000016		PUSH	P,P3		;SAVE P3
  1422	001735'	550715	001710*		HRRZ	P3,ATBFNB(P2)	;GET FNB ADDRESS
  1423	001736'	135300	000000*		LDB	T1,FNYUFP	;GET POINTER TO THE UFD ENTRY
  1424	001737'	661000	000020		TLO	S,IO		;NEED TO WRITE INTO IT
  1425	001740'	621000	000000*		TLZ	S,IOSRIB	;NOTHING IN %RIB, SO USE IT, NOT %RB2
  1426	001741'	260040	000000*		PUSHJ	P,DIRBLK	;GET PAGE OF THE UFD THAT ENTRY IS IN
  1427					  PJSP	T1,[POP P,P3	;RESTORE P3
  1428	001742'	265300	006114'			    JRST UPDNU1] ;AND GO SAY MUST DO SLOW DSKCLN.
  1429	001743'	260040	000000*		PUSHJ	P,DIRSRC	;OK, GET ENTRY ADDRESS IN T2
  1430	001744'	334000	000000		 SKIPA			;HAVE IT
  1431	001745'	256000	006116'		 STOPCD (.,DISK,UFDER1,,<UFD error return from DIRSRC>)
  1432				 ;;UPDUFD+16
  1433	001746'	260040	001545'		PUSHJ	P,CREUFD	;OK, UPDATE UFD IF NECESSARY
  1434	001747'	260040	001544*		PUSHJ	P,RELLOK	;GET RID OF IT NOW
  1435	001750'	262040	000016		POP	P,P3		;RESTORE P3 AND
  1436	001751'	262040	000011		POP	P,T4		; T4
  1437	001752'	262040	000017		POP	P,P4
  1438	001753'	263040	000000		POPJ	P,		;AND RETURN. (DON'T PJRST, RELLOK SMASHES T4.)
  1439
  1440	001754'	260040	001747*	UPDNUR:	PUSHJ	P,RELLOK
  1441	001755'	262040	000011	UPDNU1:	POP	P,T4
  1442	001756'	262040	000017		POP	P,P4		;RESTORE THIS.
  1443					 STOPCD (.+1,INFO,BADUFD,DSKCLN##,<Inconsistent UFD - FULL DSKCLN requested>);;UPDNU1+3
  1444	001757'	256000	006121'
  1445	001760'	263040	000000		POPJ	P,
  1446
  1447				;ROUTINE TO SET FNBALT. EXPECTS LIVE DDB IN F (RH(DEVATB) SETUP)
  1448				; PRESERVES T1, USES T2 AND T3.
  1449				; DON'T NEED CB, SINCE FILE SHOULD HAVE ATPMXU ON, PREVENTING
  1450				; SOMEONE ELSE FROM DELETING IT OUT FROM UNDER US (EITHER ITS
  1451				; ALREADY DELETED (TRUNCATING RENAME) OR IT IS STILL IN UFD.
  1452
  1453	001761'	261040	000006	SETALT::PUSH	P,T1		;PRESERVE T1
  1454	001762'	261040	000015		PUSH	P,P2		;SAVE P2 ALSO
  1455	001763'	550644	001731*		HRRZ	P2,DEVATB(F)	;GET ATB IN P2
  1456	001764'	550315	001735*		HRRZ	T1,ATBFNB(P2)	;GET FNB
  1457	001765'	200406	001712*		MOVE	T3,FNBRIB(T1)	;GET POINTER
  1458	001766'	200340	001720*		MOVE	T2,PCDTIM	;GET READY IN CASE THIS IS FILE IN UFD
  1459	001767'	316415	001711*		CAMN	T3,ATBRIB(P2)	;IS THIS THE FILE IN THE UFD?
  1460	001770'	202346	001714*		MOVEM	T2,FNBALT(T1)	;YES, MAKE COUNT >= TO WHAT IT WAS
  1461	001771'	262040	000015		POP	P,P2		;RESTORE
  1462	001772'	254000	000643*		JRST	TPOPJ		;AND RETURN.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 30
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1463				;RELEASE UUO
  1464	001773'	260040	000155*	DSKREL:	PUSHJ	P,WAIT1		;WAIT FOR I/O TO STOP
  1465	001774'	200100	000000*		MOVE 	J,JOB
  1466	001775'	260040	001222*		PUSHJ	P,SIMRLS	;FIX SIMIO DATA BASE (DO THIS
  1467								;HERE FOR SUPERIO)
  1468	001776'	661200	000020		TLO	F,RESETB	;INDICATE RESET IN PROGRESS
  1469	001777'	260040	001007'		PUSHJ	P,CLOSIN	;CLOSE INPUT (IF NOT ALREADY DONE)
  1470	002000'	260040	001216'		PUSHJ	P,CLOSOU	;CLOSE OUTPUT (DITTO)
  1471	002001'	621200	000020		TLZ	F,RESETB	;RESET BIT
  1472	002002'	402004	000015		SETZM	DEVFIL(F)	;INDICATE FILE RELEASED
  1473	002003'	402004	000164*		SETZM 	DEVPOS(F)	;FOR GOOD MEASURE, MARK BAD POSITION
  1474	002004'	402004	000017		SETZM DEVPPN(F)
  1475	002005'	621000	000000*		TLZ S,IOSUPR
  1476	002006'	324740	001010*		PJRST STOIOS
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 31
FILUUO.MAC	 8-DEC-87 11:25		CLOSE

  1477				;THIS ROUTINE IS AN ERROR CHECKING ROUTINE CALLED AT THE START
  1478				;OF VARIOUS UUO'S. IT INSERTS A NEW RETURN ON THE PUSH-DOWN
  1479				;LIST WHICH WILL CHECK TO SEE THAT RESOURCES HAVE BEEN RELEASED.
  1480
  1481	002007'	262041	000000	TSTRES:	POP P,(P)	;CALLED WITH PUSHJ GET STACK DECED
  1482	002010'	260061	000001		PUSHJ P,@1(P)	;NOW CALL USING OLD RETURN ADDRESS
  1483	002011'	334000	000000		 SKIPA
  1484	002012'	350001	000000		AOS (P)		;SKIP RETURN
  1485	002013'	261040	000006		PUSH P,T1
  1486	002014'	200300	001774*		MOVE T1,JOB
  1487	002015'	312300	000000*		CAME T1,CBUSER	;SEE IF JOB HAS CB
  1488	002016'	332006	000000*		SKIPE QUEPCB(T1)	;OR A DIRECTORY
  1489	002017'	256000	006125'	UUOXWR:: STOPCD (.,DISK,UUOXWR,,<UUO eXit with Resources still owned>);;TSTRES+10
  1490	002020'	336000	000000*		SKIPN %UPT+UPTRIB	;NO BLOCKS LOCKED
  1491	002021'	332000	000000*		SKIPE %UPT+UPTRB2
  1492	002022'	256000	002017'		 STOPCD (,XCT,UUOXWR)
  1493					;;TSTRES+13
  1494	002023'	332000	000000*		SKIPE %UPT+UPTSAT
  1495	002024'	256000	002017'		 STOPCD (,XCT,UUOXWR)
  1496					;;TSTRES+15
  1497	002025'	254000	001772*		JRST TPOPJ
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 32
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1498				SUBTTL	LOOKUP
  1499
  1500				;LOOKUP
  1501	002026'	260040	002007'	ULOOK:	PUSHJ P,TSTRES	;MAKE SURE WE EVENTUALLY GIVE ALL BACK
  1502	002027'	607000	002005*		TLNN	S,IOSUPR
  1503	002030'	603200	020000		TLNE F,ENTRB
  1504	002031'	254000	005107'		JRST LUKER1	;CAN NOT DO LOOKUP AFTER ENTER
  1505	002032'	702600	400000*		NOCHARGE
  1506	002033'	260040	003505'		PUSHJ P,LKSET	;CHARGE 1 LOOKUP
  1507	002034'	260040	003035'		PUSHJ P,CHKARG	;CHECK ARGUMENT LIST
  1508	002035'	254000	005105'		 JRST ILNMER	;BAD NAME (ACTUALLY EXTENDED WITH SMALL COUNT)
  1509	002036'	661540	400000		TLO M,UUOLUK	;SET FOR LOOKUP
  1510	002037'	260040	003117'		PUSHJ P,SETFIL	;GET FILE NAME STORED
  1511	002040'	254000	005105'		 JRST ILNMER	;BAD NAME
  1512	002041'	201300	000005		MOVEI T1,DECSTP
  1513	002042'	137300	001472*		DPB T1,DEYSTC
  1514	002043'	554304	000016		HLRZ T1,DEVEXT(F)	;SEE IF UFD
  1515	002044'	603540	200000		TLNE M,EXTUUO		;ONLY ON EXTENDED UUO
  1516	002045'	302300	654644		CAIE T1,'UFD'
  1517	002046'	254000	002060'		JRST ULOOK2		;NOT EXTENDED OR NOT UFD
  1518	002047'	200304	000017		MOVE T1,DEVPPN(F)
  1519	002050'	312300	000767*		CAME T1,MFDPPN
  1520	002051'	254000	002060'		JRST ULOOK2
  1521	002052'	200304	000015		MOVE T1,DEVFIL(F)
  1522	002053'	603300	777777		TLNE T1,-1		;IS L.H. 0
  1523	002054'	254000	002060'		JRST ULOOK2		;NO
  1524	002055'	260040	003237'		PUSHJ P,LOKLUD		;GET USER NAME TO PPN
  1525	002056'	202304	000015		MOVEM T1,DEVFIL(F)
  1526	002057'	256200	006130'		UMOVEM T1,UUXNAM(M)
  1527	002060'	607540	200000	ULOOK2:	TLNN M,EXTUUO	;CHECK FOR MULTIPLE EXTENSION LOOKUP
  1528	002061'	254000	002066'		JRST ULOOK3	;CAN NOT BE
  1529	002062'	256200	006131'		UMOVE T1,(M)
  1530	002063'	606300	400000		TRNN T1,400000
  1531	002064'	254000	002066'		JRST ULOOK3	;THAT WAS THE FLAG
  1532
  1533				COMMENT ! DISABLE FANCY LOOKUP FEATURE 16 NOV 77 AAA.
  1534					(GIVE ERROR 0 IF FANCY LOOKUP SPECIFIED) !
  1535	002065'	254000	005105'		JRST ILNMER
  1536				COMMENT !
  1537				;PROCESS FANCY (MULTIPLE EXTENSION) LOOKUP. READ USER ARGUMENT
  1538				;POINTED AT BY USER'S EXTENSION WORD, NOW IN DEVEXT(F).
  1539				;DEVEXT(F)/     USER BLOCK,,0		USER BLOCK/  N
  1540				;					          / EXT 1
  1541				;						  / EXT 2
  1542				;						...ETC...
  1543				;						  / EXT N
  1544
  1545					HLRZ P2,DEVEXT(F)	;THIS IS THE CORE TABLE OF EXTENSIONS
  1546					UMOVE T2,(P2)
  1547					CAIGE T2,1000
  1548					CAIG T2,0	;DON'T ALLOW TOO MANY
  1549					JRST ERRLKM
  1550					MOVE T1,P2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 32-2
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1551					ADD T1,T2
  1552					UMOVE T1,(T1)	;TRY TO READ IT SO WE FAULT NOW
  1553FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 33
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1554				;PROCESS FANCY LOOKUP
  1555					HRL P2,T2	;P2/ USER COUNT,,USER ADDR
  1556					ADDI T2,1	;NEED <USER COUNT>EXTENSION WDS+1 COUNT WD
  1557					HRLZ P3,T2	;P3/WDS BEING ALLOCATED,,0
  1558					PUSHJ P,GETWDS	;TAKE T2/WDS NEEDED. RETURN T1/LOC FREECORE
  1559					 JRST ERRNET	;NOT AVAILABLE
  1560					HRR P3,T1	;P3/SIZE EXTBLOCK,,ADDR EXTBLOCK
  1561					SETZM (T1)	;EXTBLOCK[0]_COUNT OF DISTINCT EXT'S SEEN
  1562					HLRZ T2,P2	;T2/USER COUNT
  1563					MOVNS T2	;T2/-USER COUNT
  1564					HRLM T1,DEVEXT(F)	;DEVEXT(F)/EXTBLOCK ADDR,,0
  1565					HRLM T2,P2	;P2/-USER COUNT,,USER ADDR SEE ULK2A
  1566					UMOVE T2,1(P2)
  1567					AOJA T1,ULK2D	;GO STORE IN MONITOR CORE
  1568				;ULK2C - ULK2A:  PICK UP EXTENSIONS FROM USER BLOCK
  1569				;AND CHECK TO SEE THAT THEY'RE NOT ALREADY IN MONITOR EXTBLOCK
  1570				;(DON'T REPEAT IF USER REPEATS AN EXT). INCREMENT EXTBLOCK
  1571				;CONTROL COUNT FOR EACH DISTINCT EXT SEEN.
  1572				;T1/EXTBLOCK ADDR	T2/GET USER EXT		T3/TEST EXTBLOCK EXT
  1573				;P2/USER AOBJN		P3/SIZE,,ADDR OF EXTBLOCK[0] CONTROL WORD
  1574
  1575				ULK2C:	 XCTBU <HLLZ T2,1(P2)>	;NORMAL LOOP. NEXT EXT
  1576					MOVEI T3,1(P3)	;POINT TO MONITOR CORE
  1577				ULK2B:	CAMN T2,(T3)	;HAVE WE SEEN THIS EXT BEFORE?
  1578					JRST ULK2A	;YES, SKIP IT
  1579					CAIE T3,(T1)	;HAVE WE LOOKED AT ALL OF THEM?
  1580					AOJA T3,ULK2B	;NO, CONTINUE
  1581					ADDI T1,1	;THIS ONE IS NEW, STORE IT
  1582				ULK2D:	AOS (P3)	;COUNT ONE MORE
  1583					HLLZM T2,(T1)	;AND STORE EXTENSION
  1584				ULK2A:	AOBJN P2,ULK2C	;ANY MORE FROM USER?
  1585
  1586
  1587							;FINISHED ALL USER BLOCK.
  1588					MOVN T2,(P3)	;T2/-COUNT DISTINCT EXTENSIONS
  1589					HRLM T2,(P3)	;EXTBLOCK[0]_-COUNT,,COUNT FOR SRCFIL
  1590					TLO M,UUOMLK	;SET FLAG
  1591				;******************************************************
  1592					PUSHJ P,SRCFIL	;GO FIND FILE. P1-P4 PRESERVED
  1593					 SKIPA		;NO FILE
  1594					JRST FOUND0
  1595				;PASS SRCFIL THE FOLLOWING ARGUMENT:
  1596				;DEVEXT(F)/ FREECORE EXTBLOCK,,0
  1597				;FREECORE EXTBLOCK/ -COUNT,,COUNT
  1598				;		  / EXTENSION,,0
  1599				;		  / EXTENSION,,0
  1600				; ETC.
  1601				;( COUNT IS THE NUMBER OF UNIQUE EXTENSIONS PRESENT, NOT THE
  1602				;  SIZE OF THE FREECORE AREA ALLOCATED. THAT IS IN P3, FOR
  1603				;  CLNML.  COUNT MAY BE ALTERED BY SRCFIL AS IT FINDS NX FILES,
  1604				;  ETC.)
  1605				;********************************************************
  1606					PUSHJ P,CLNML	;RETURN FREE CORE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 33-2
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1607					JRST STRERZ	;AND GIVE ERROR
  1608
  1609				CLNML:	;RETURN EXTBLOCK FREECORE. EXPECTS
  1610					;P3/SIZE OF EXTBLOCK,,ADDR EXTBLOCK
  1611					;DESTROYS T2
  1612					PUSH P,T1
  1613					HRRZ T2,P3	;T2/ADDR FREECORE
  1614					HLRZ T1,P3	;T1/SIZE
  1615					PUSHJ P,GIVWDS	;EXPECTS T1,T2
  1616					JRST TPOPJ
  1617
  1618				FOUND0:	PUSHJ P,CLNML
  1619					HLL T1,DEVEXT(F)
  1620					XCTBU <HLLM T1,UUXEXT(M)>	;RETURN TO USER
  1621					JRST FOUND
  1622
  1623				END FANCY LOOKUP !
  1624
  1625				;PROCESS ORDINARY SINGLE-EXTENSION LOOKUP. M/ UUOMLK IS OFF
  1626				; AND DEVEXT(F)/EXTENSION,,0
  1627
  1628	002066'	260040	000000*	ULOOK3:	PUSHJ P,SRCFIL
  1629	002067'	254000	005160'		 JRST STRERZ
  1630	002070'	621000	001740*		TLZ	S,IOSRIB	;CLEAR DUMB FLAG.
  1631							;FALL INTO FOUND
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 34
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1632				;HERE WHEN FILE NAME IS FOUND ON LOOKUP
  1633	002071'	550644	001763*	FOUND:	HRRZ P2,DEVATB(F)	;GET ATB LOCATION
  1634	002072'	554744	001535*		HLRZ P4,DEVDRB(F)	;AND DRB
  1635	002073'	201300	000000*		MOVEI T1,FNCLOK
  1636	002074'	260040	000000*		PUSHJ P,CHKPRV
  1637	002075'	254000	005140'		 JRST LKER1		;CAN NOT REALLY DO THE LOOKUP
  1638	002076'	201300	000000*		MOVEI T1,FNCRED		;CAN LOOKUP, NOW CHECK READ
  1639	002077'	603200	000010		TLNE F,GETB		;IF FROM GET OR RUN
  1640	002100'	201300	000000*		MOVEI T1,FNCEXC		;THEN EXECUTE IS ENOUGH
  1641	002101'	260040	002074*		PUSHJ P,CHKPRV
  1642	002102'	334000	000000		SKIPA
  1643	002103'	254000	002106'		JRST FNDROK		;OK TO READ
  1644	002104'	205300	000000*		MOVSI T1,NORED
  1645	002105'	436304	000007		IORM T1,DEVIAD(F)
  1646	002106'	607200	000010	FNDROK:	TLNN F,GETB		;IS IT A GET OR RUN??
  1647	002107'	254000	002117'		JRST FNDNGT		;NO
  1648	002110'	201300	002076*		MOVEI T1,FNCRED	;SEE IF HE CAN READ
  1649	002111'	260040	002101*		PUSHJ P,CHKPRV
  1650	002112'	334000	000000		SKIPA			;NO, EXECUTE ONLY
  1651	002113'	254000	002117'		JRST FNDNGT
  1652	002114'	201300	004000		MOVEI T1,PVEXOG
  1653	002115'	135340	000561*		LDB T2,PJOBN
  1654	002116'	436307	000000*		IORM T1,JBTPRV(T2)	;SET GOT EX ONLY R BIT
  1655	002117'	603540	200000	FNDNGT:	TLNE	M,EXTUUO	;EXTENDED M?
  1656	002120'	254000	002135'		JRST FOUND2	;YES
  1657	002121'	200315	001315*		MOVE T1,ATBSIZ(P2)
  1658	002122'	303300	400000		CAILE T1,400000	;TOO BIG TO REPORT WORDS?
  1659					JRST	[LSH T1,W2BLSH	;YES, JUST REPORT BLOCKS
  1660	002123'	254000	006132'			JRST FOUND1]
  1661	002124'	602300	000177		TRNE T1,177	;CORRECT FOR ADJUST MENT TO BLOCK FIELD
  1662	002125'	275300	000200		SUBI T1,200
  1663	002126'	213000	000006		MOVNS T1
  1664	002127'	256200	006134'	FOUND1:	 XCTTU <HRLZM T1,UUNPPN(M)>	;GIVE USER SIZE
  1665	002130'	200315	001350*		MOVE T1,ATBPVW(P2)	;GET PRIVS, ETC
  1666	002131'	256200	006130'		UMOVEM T1,UUNATT(M)	;AND GIVE TO USER
  1667	002132'	554315	001327*		HLRZ T1,ATBMSC(P2)	;ACCESS DATE
  1668	002133'	256200	006135'		XCTBU <HRRM T1,UUNEXT(M)>
  1669	002134'	254000	002153'		JRST FOUND3	;FINISH UP
  1670
  1671				;HERE WHEN FILE IS FOUND FOR AN EXTENDED LOOKUP
  1672	002135'	554315	002132*	FOUND2:	HLRZ	T1,ATBMSC(P2)	;ACCESS DATE
  1673	002136'	256200	006136'		XCTBU <HRRM T1,UUXEXT(M)>	;AND ACCESS DATE
  1674	002137'	305600	000004		CAIGE	P1,UUXPRV		;STORE VALUES?
  1675	002140'	254000	002153'		JRST	FOUND3		;NO. FINISH UP
  1676	002141'	200315	002130*		MOVE	T1,ATBPVW(P2)	;PRIVILEGES WORD
  1677	002142'	256200	006076'		UMOVEM T1,UUXPRV(M)	;GIVE PRIVS TO USER
  1678	002143'	305600	000005		CAIGE P1,UUXSIZ
  1679	002144'	254000	002153'		JRST FOUND3
  1680	002145'	200315	002121*		MOVE T1,ATBSIZ(P2)
  1681	002146'	602300	000177		TRNE T1,177
  1682	002147'	275300	000200		SUBI T1,200	;CORRECT FOR BLOCK ADJUSTMENT
  1683	002150'	256200	006137'		UMOVEM	T1,UUXSIZ(M)		;YES. SAVE IT
  1684	002151'	303600	000005		CAILE	P1,UUXSIZ	;NEED MORE VALUES?
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 34-2
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1685	002152'	254000	002155'		JRST FOUND4	;YES. GO READ RIB
  1686
  1687				;HERE TO FINISH UP A LOOKUP IF THE RIB DOESN'T HAVE TO BE READ
  1688	002153'	621000	000020	FOUND3:	TLZ S,IO
  1689	002154'	254000	002172'		JRST FOUND8
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 35
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1690				;HERE WHEN USER WANTS MORE VALUES THAN ARE STORED IN ACCESS TABLE
  1691				;READ RIB (IF IT ISN'T ALREADY IN CORE)
  1692	002155'	621000	000020	FOUND4:	TLZ	S,IO		;NO MORE NEED TO WRITE IN RIB.
  1693	002156'	332020	000000*		SKIPE	@%RIB.C+%CTUPT	;DO WE HAVE THE RIB?
  1694	002157'	254000	002162'		JRST	FOUND5		;YES.
  1695	002160'	260040	000000*		PUSHJ	P,RIBRDL	;NO.
  1696	002161'	254000	002172'		JRST	FOUND8		;SOMETHING WRONG WITH RIB
  1697
  1698				;HERE WITH FILE RIB IN CORE
  1699	002162'	275600	000005	FOUND5:	SUBI P1,UUXVER-1	;NUMBER MORE TO TRANSFER
  1700	002163'	213000	000014		MOVNS P1
  1701	002164'	507000	000014		HRLS P1
  1702	002165'	541600	000006		HRRI P1,UUXVER
  1703	002166'	661540	000014		TLO M,P1		;FORCE INDEXING FOR M.
  1704	002167'	256014	002174'		XCT TUTAB-UUXVER(P1)	;XCT FOR SPECIAL ARGS
  1705	002170'	256200	006140'		UMOVEM T1,@M
  1706	002171'	253600	002167'		AOBJN P1,.-2
  1707				    ;HERE WHEN VALUES SET UP, OR NO NEED TO DO SO,  OR COULDN'T
  1708				    ;GET GOOD RIB TO DO SO.
  1709	002172'	260040	001467*	FOUND8:	PUSHJ P,INVDDB	;INVALIDATE DDB AREA, SET FILE LOC TO START.
  1710	002173'	261040	000003		PUSH	P,PG		;SAVE PG.
  1711	002174'	260040	000336*		PUSHJ	P,RELRIB	;GET RID OF RIB IF WE HAVE IT.
  1712	002175'	262040	000003		POP	P,PG		;
  1713	002176'	201300	000001		MOVEI T1,DECLUK
  1714	002177'	137300	002042*		DPB T1,DEYSTC
  1715	002200'	202004	000002		MOVEM S,DEVIOS(F)
  1716	002201'	324740	001000*		PJRST CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 36
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1717				;TABLE FOR LOADING ARGUMENTS TO RETURN TO USER
  1718
  1719				;To User from RIB (LOOKUP), FUTAB is From User (ENTER)
  1720	002202'	200300	376000*	TUTAB:	MOVE T1,%RIB+RIBVER	;RIBVER
  1721	002203'	200300	376000*		MOVE T1,%RIB+RIBFUT
  1722	002204'	200300	376000*		MOVE T1,%RIB+RIBEST
  1723	002205'	260040	002235'		PUSHJ P,CLCALC		;SPECIAL FOR ALLOCATED
  1724	002206'	200300	376000*		MOVE T1,%RIB+RIBPOS
  1725	002207'	200300	376000*		MOVE T1,%RIB+RIBFT1
  1726	002210'	200300	376000*		MOVE T1,%RIB+RIBLCW
  1727	002211'	200300	376000*		MOVE T1,%RIB+RIBMTA
  1728	002212'	200300	376000*		MOVE T1,%RIB+RIBDEV
  1729	002213'	200300	376000*		MOVE T1,%RIB+RIBSTS
  1730	002214'	200300	376000*		MOVE T1,%RIB+RIBELB
  1731	002215'	200300	376000*		MOVE T1,%RIB+RIBXT1
  1732	002216'	200300	376000*		MOVE T1,%RIB+RIBQTF
  1733	002217'	200300	376000*		MOVE T1,%RIB+RIBQTO
  1734	002220'	260040	002241'		PUSHJ P,CLCMXA		;IF DIRECTORY, SPECIAL
  1735	002221'	260040	002264'		PUSHJ P,CLCUSD		;ALSO
  1736	002222'	200300	376000*		MOVE T1,%RIB+RIBAUT
  1737	002223'	200300	376000*		MOVE T1,%RIB+RIBUNM
  1738	002224'	200300	376000*		MOVE T1,%RIB+RIBUN1
  1739	002225'	200300	376000*		MOVE T1,%RIB+RIBTRU
  1740	002226'	200300	376000*		MOVE T1,%RIB+RIBXT2
  1741	002227'	200315	001654*		MOVE T1,ATBALP(P2)
  1742	002230'	200300	376000*		MOVE T1,%RIB+RIBSNM
  1743	002231'	200300	376000*		MOVE T1,%RIB+RIBPJC	;PROJECT CODE
  1744	002232'	200300	376000*		MOVE T1,%RIB+RIBPJ1	;-
  1745	002233'	200300	376000*		MOVE T1,%RIB+RIBPJ2	;-
  1746	002234'	200300	376000*		MOVE T1,%RIB+RIBPID	;PROCESSOR ID
  1747
  1748	002235'	135300	000000*	CLCALC:	LDB T1,ATYBLK	;GET NUMBER OF BLOCKS IN FILE (TO EOF)
  1749	002236'	315300	376000*		CAMGE T1,%RIB+RIBALC
  1750	002237'	200300	376000*		MOVE T1,%RIB+RIBALC	;GET LARGEST REQUEST
  1751	002240'	263040	000000		POPJ P,
  1752
  1753	002241'	201300	001451*	CLCMXA:	MOVEI T1,ATPDIR
  1754	002242'	616315	001513*		TDNN T1,ATBSTS(P2)
  1755	002243'	254000	002261'		JRST MXACL1
  1756	002244'	260040	001725*		PUSHJ P,GETCBR
  1757	002245'	200304	000015		MOVE T1,DEVFIL(F)
  1758	002246'	554340	000265*		HLRZ T2,SYSDRB	;WHERE TO START AND NO CREATE
  1759	002247'	211400	000001		MOVNI T3,1	;SET T3 NEG SO NO NEW BLOCK
  1760	002250'	260040	000202*		PUSHJ P,SRCNAM
  1761	002251'	254000	002260'		 JRST MXACL2	;JUST USE IT FROM RIB
  1762	002252'	336007	001460*		SKIPN DRBRIB(T2)
  1763	002253'	254000	002260'		JRST MXACL2	;ALSO IF RIB NOT READ YET
  1764	002254'	200700	000007		MOVE P3,T2	;FOR RIBUSD
  1765	002255'	210316	001542*		MOVN T1,DRBMXA(P3)
  1766	002256'	270300	376000*		ADD T1,%RIB+RIBQTF
  1767	002257'	324740	001726*		PJRST GIVCBR
  1768
  1769	002260'	260040	002257*	MXACL2:	PUSHJ P,GIVCBR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 36-2
FILUUO.MAC	 8-DEC-87 11:25		LOOKUP

  1770	002261'	201700	000000	MXACL1:	MOVEI P3,0	;FOR RIBUSD IF WANTED
  1771	002262'	200300	376000*		MOVE T1,%RIB+RIBMXA
  1772	002263'	263040	000000		POPJ P,
  1773
  1774	002264'	332000	000016	CLCUSD:	SKIPE P3
  1775	002265'	334300	376000*		SKIPA T1,%RIB+RIBQTF
  1776	002266'	334300	376000*		SKIPA T1,%RIB+RIBUSD	;JUST GET ARG FROM RIB
  1777	002267'	274316	001537*		SUB T1,DRBALC(P3)
  1778	002270'	263040	000000		POPJ P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 37
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1779				SUBTTL	ENTER
  1780
  1781
  1782				COMMENT ! ROUTINE UENTR - DISPATCH HERE FROM DSKDSP
  1783				CALL:	HRRZ AC,DEVSER(F)
  1784					PUSHJ P,DEN(AC)
  1785					RETURN HERE FAILURE
  1786					SUCCESS
  1787				!
  1788	002271'	702600	400000*	UENTR:	NOCHARGE
  1789	002272'	260040	002007'		PUSHJ	P,TSTRES
  1790	002273'	603000	002027*		TLNE	S,IOSUPR		;Check if supersede
  1791	002274'	254000	005107'		 JRST	LUKER1
  1792	002275'	260040	003514'		PUSHJ	P,ERNSET		;CHARGE 1 ENTER
  1793	002276'	260040	000000*		PUSHJ	P,SIMENT##		;DEAL WITH SIMIO DATA BASE
  1794	002277'	603200	040000		TLNE	F,LOOKB			;LOOKUP IN FORCE?
  1795	002300'	254000	002564'		 JRST	UPDATE			;YES. UPDATE
  1796	002301'	260040	003035'		PUSHJ	P,CHKARG		;NO. SET M FOR ENTER
  1797	002302'	254000	005105'		  JRST	ILNMER			;BAD NAME - ERROR
  1798	002303'	661540	040000		TLO	M,UUOENT		;INDICATE ENTER
  1799	002304'	260040	003117'		PUSHJ	P,SETFIL		;SET UP FILE NAME
  1800	002305'	254000	005105'		  JRST	ILNMER
  1801	002306'	201300	000005		MOVEI	T1,DECSTP
  1802	002307'	137300	002177*		DPB	T1,DEYSTC
  1803	002310'	260040	002066*		PUSHJ	P,SRCFIL		;SEARCH FOR MATCH, SET A.T.
  1804	002311'	254000	005160'		  JRST	STRERZ			;ERROR
  1805	002312'	550644	002071*		HRRZ	P2,DEVATB(F)		;LOC OF A.T.
  1806	002313'	554744	002072*		HLRZ	P4,DEVDRB(F)
  1807	002314'	200355	002242*		MOVE	T2,ATBSTS(P2)
  1808	002315'	201300	000000*		MOVEI	T1,FNCCRE
  1809	002316'	606340	001365*		TRNN	T2,ATPCRE
  1810	002317'	201300	000000*		 MOVEI	T1,FNCSUP		;CHECK SUP OR CRE
  1811	002320'	606340	000000*		TRNN	T2,ATPNDL		;IF NO DELETE SET, FORGET IT
  1812	002321'	260040	002111*		 PUSHJ	P,CHKPRV
  1813	002322'	254000	005147'		  JRST	ENTER1			;CAN NOT DO IT
  1814	002323'	331017	002267*		SKIPL	DRBALC(P4)		;See if room in this UFD
  1815				PRINTF(<[UENTR++ ROOM ON DSK?  DRBALC(P4) + SKIPG STRTAL(DRBSTR(P4))]>)
  1816	002324'	337000	000000*		SKIPG	STRDDB+STRTAL		;AND IF ROOM ON DISK
  1817	002325'	254000	005152'		 JRST	ENTER2			;NO ROOM
  1818	002326'	336304	000000*		SKIPN	T1,DEV1UN(F)		;SPECIAL UNIT STUFF?
  1819	002327'	254000	002332'		 JRST	.+3			;NO.
  1820	002330'	337006	000000*		SKIPG	UNITAL(T1)		;YES, ROOM ON SPECIAL UNIT?
  1821	002331'	254000	005152'		 JRST	ENTER2			;NO.
  1822	002332'	402015	002145*		SETZM	ATBSIZ(P2)
  1823	002333'	402015	002227*		SETZM	ATBALP(P2)		;FORCE TO ZERO
  1824	002334'	550404	002312*		HRRZ	T3,DEVATB(F)		;T3/ ATB ADDR OR 0 IF NO ATB.
  1825	002335'	201300	000000*		MOVEI	T1,FBIT##		;(Used to call GETAPG before P035/B02)
  1826	002336'	260040	000000*		PUSHJ	P,GETUPG##		;Get a page from unit with most space
  1827	002337'	254000	005152'		  JRST	ENTER2			;Couldn't get page to build the RIB
  1828	002340'	202355	001767*		MOVEM	T2,ATBRIB(P2)
  1829	002341'	200300	000007		MOVE	T1,T2
  1830	002342'	201140	000345*		MOVEI	PG,%RIB.C
  1831	002343'	260040	000000*		PUSHJ	P,MAPWLN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 37-2
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1832	002344'	402000	376000		SETZM	%RIB
  1833	002345'	200300	006141'		MOVE	T1,[%RIB,,%RIB+1]
  1834	002346'	251300	376777		BLT	T1,%RIB+777		;ZERO ENTIRE RIB
  1835	002347'	201300	000000*		MOVEI	T1,RIPSPP
  1836	002350'	135340	002115*		LDB	T2,PJOBN
  1837	002351'	200347	001001*		MOVE	T2,JBTPPN(T2)
  1838	002352'	316344	000017		CAMN	T2,DEVPPN(F)		;IS IT THE SAME PPN AS CREATOR
  1839	002353'	436300	376000*		 IORM	T1,%RIB+RIBSTS		;YES, SET BIT
  1840	002354'	553015	002135*		HRRZS	ATBMSC(P2)
  1841	002355'	201300	002241*		MOVEI	T1,ATPDIR
  1842	002356'	603540	020000		TLNE	M,UUOUFD
  1843	002357'	436315	002314*		 IORM	T1,ATBSTS(P2)
  1844	002360'	260040	002545'		PUSHJ	P,SAVLIC
  1845	002361'	552315	001652*		HRRZM	T1,ATBLIC(P2)		;PRESERVE WHAT WE CAN
  1846				;-MOVE PJC IN UPT TO RIB EXCEPT ON UFD'S
  1847	002362'	200300	006142'		MOVE	T1,[%UPT+UPTPJC,,%RIB+RIBPJC]	;-
  1848	002363'	607540	020000		TLNN	M,UUOUFD			;-
  1849	002364'	251300	376000*		 BLT	T1,%RIB+RIBPJ2			;-
  1850	002365'	402015	001661*		SETZM	ATBPID(P2)		;CLEAR PID NOW, GETS SETUP AGAIN AT
  1851									; SETVAL IF USER IS ALLOWED
  1852	002366'	402000	376000*		SETZM	%RIB+RIBPID		;ATPPID CLEARED ABOVE, STORED INTO RIBLCW AT SETEN5.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 38
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1853	002367'	260040	003107'		PUSHJ	P,GETEXT
  1854	002370'	242300	777762		LSH	T1,-^D14
  1855	002371'	137300	001642*		DPB	T1,ATYXCD		;SET EXTENDED DATE FIELD
  1856	002372'	201713	000002		MOVEI	P3,UUNATT(M)		;SET P2 TO POINT TO PRV WORD
  1857	002373'	603540	200000		TLNE	M,EXTUUO
  1858	002374'	201713	000004		 MOVEI	P3,UUXPRV(M)
  1859	002375'	603540	200000		TLNE	M,EXTUUO		;IS IT EXTENDED UUO
  1860	002376'	301600	000004		CAIL	P1,UUXPRV		;AND SPECIFIED
  1861	002377'	256200	006143'		 XCTFU	<SKIPA T2,(P3)>		;NOT EXTENDED OR SPECIFIED
  1862	002400'	201340	000000		MOVEI	T2,0			;NOT SPECIFIED, USE 0
  1863	002401'	612340	006144'		TDNE	T2,[37,,-1]		;TIME, DATE GIVEN?
  1864	002402'	254000	002421'		 JRST	SETEN1			;YES
  1865	002403'	135300	002371*		LDB	T1,ATYXCD		;GET EXTENDED DATE
  1866	002404'	326300	002421'		JUMPN	T1,SETEN1		;SINCE IT ALSO COUNTS
  1867	002405'	500700	000007		HLL	P3,T2			;SAVE LEFT HALF OF T2
  1868	002406'	260040	000000*		PUSHJ	P,GETGMT##		;GET T1/TIME T2/DATE
  1869	002407'	200400	000007		MOVE	T3,T2
  1870	002410'	230300	000462*		IDIV	T1,JFYSEC
  1871	002411'	231300	000074		IDIVI 	T1,^D60			;GET SECONDS PART TOO
  1872	002412'	137340	001646*		DPB 	T2,ATYCSC		;SAVE SECONDS PART
  1873	002413'	550340	000010		HRRZ	T2,T3
  1874	002414'	241340	777764		ROT 	T2,-^D12
  1875	002415'	137340	002403*		DPB 	T2,ATYXCD		;SAVE HIGH PART OF DATE
  1876	002416'	241340	000014		ROT 	T2,^D12			;AND GET DATE BACK
  1877	002417'	500340	000016		HLL 	T2,P3			;GET LEFT HALF BACK
  1878	002420'	137300	006145'		DPB	T1,[POINT 11,T2,23]	;STORE TIME IN T2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 39
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1879
  1880	002421'	201400	001371*	SETEN1:	MOVEI	T3,ATPSUP
  1881	002422'	616415	002357*		TDNN	T3,ATBSTS(P2)		;IS IT SUPERSEDE
  1882	002423'	254000	002427'		 JRST	SETEN2			;NO, USE STANDARD IF NO PROT GIVEN
  1883	002424'	205400	777000		MOVSI	T3,777000		;YES, USE OLD IF NO PROT GIVEN
  1884	002425'	404415	000000*		AND	T3,ATBPRV(P2)
  1885	002426'	254000	002432'		JRST	SETEN3
  1886	002427'	603540	020000	SETEN2:	TLNE	M,UUOUFD		;CREATE, SET UP DEFAULT PROT. DIRECTORY FILE?
  1887	002430'	334400	000000*		 SKIPA	T3,UFDPRT		;YES. USE UFD STANDARD PROTECTION
  1888	002431'	200400	000000*		MOVE	T3,STNPRT		;NO. USE REGULAR STANDARD PROTECTION
  1889	002432'	607340	777740	SETEN3:	TLNN	T2,777740		;PROTECTION  ALREADY GIVEN? (OR MODE IF 000 DESIRED)
  1890	002433'	434340	000010		 OR	T2,T3			;NO, SET STANDARD PROTECTION
  1891	002434'	137000	006146'		DPB	S,[POINT 4,T2,12]	;MODE
  1892	002435'	135300	006147'		LDB	T1,[POINT 12,T2,35]	;GET DATE
  1893	002436'	135400	002415*		LDB	T3,ATYXCD
  1894	002437'	137400	006150'		DPB	T3,[POINT 2,T1,23]	;GET ALL OF DATE
  1895	002440'	317300	001322*		CAMG	T1,THSDAT		;IN THE FUTURE?
  1896	002441'	254000	002446'		 JRST	SETN3A			;NO
  1897	002442'	200300	002440*		MOVE	T1,THSDAT
  1898	002443'	137300	006147'		DPB	T1,[POINT 12,T2,35]
  1899	002444'	242300	777764		LSH	T1,-^D12
  1900	002445'	137300	002436*		DPB	T1,ATYXCD		;IN FUTURE, SET TODAY
  1901	002446'	603540	200000	SETN3A:	TLNE	M,EXTUUO		;IF NOT EXTENDED
  1902	002447'	301600	000004		 CAIL	P1,UUXPRV		;SAVE IN USERS AREA
  1903	002450'	256200	006151'		  UMOVEM T2,(P3)			; IF HE ASKED FOR IT
  1904	002451'	202355	002141*		MOVEM	T2,ATBPVW(P2)		;SAVE IN AKB
  1905	002452'	607540	200000		TLNN	M,EXTUUO		;EXTENDED M?
  1906	002453'	254000	002460'		 JRST	SETEN4
  1907	002454'	256200	006152'		XCTBU	<HRRZ T4,UUXEXT(M)>
  1908	002455'	405440	037777		ANDI	T4,37777		;GET ONLY ACCESS DATE
  1909	002456'	332000	000011		SKIPE	T4			;IF NONE GIVEN
  1910	002457'	313440	002442*		CAMLE	T4,THSDAT		;OR IF GREATER THAN TODAY
  1911	002460'	200440	002457*	SETEN4:	 MOVE	T4,THSDAT		;USE TODAY'S DATE
  1912	002461'	137440	001326*		DPB	T4,ATYADT		;STORE THE ACCESS DATE
  1913	002462'	200355	002422*		MOVE	T2,ATBSTS(P2)
  1914	002463'	606340	002316*		TRNN	T2,ATPCRE		;IS THIS A CREATE??
  1915	002464'	660440	400000		 TRO	T4,400000		;NO, SET OLD FILE FLAG
  1916	002465'	135340	002445*		LDB	T2,ATYXCD
  1917	002466'	137340	006153'		DPB	T2,[POINT 2,T4,21]	;SAVE EXTENDED DATE INFO
  1918	002467'	607540	200000		TLNN	M,EXTUUO
  1919	002470'	254000	002474'		 JRST	SETN5A			;NOT EXTENDED
  1920	002471'	256200	006154'		XCTBU	<HRRM T4,UUXEXT(M)>	;GIVE ARG TO USER
  1921	002472'	260040	004424'		PUSHJ	P,SETVAL
  1922	002473'	334000	000000		  SKIPA
  1923	002474'	256200	006155'	SETN5A:	 XCTBU	<HRRM T4,UUNEXT(M)>
  1924
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 40
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1925				;HERE WHEN THE RIB BLOCK IS SET UP. INSERT CONSTANT VALUES, WRITE IT
  1926	002475'	200355	002340*	SETEN5:	MOVE	T2,ATBRIB(P2)		;GET RIB POINTER
  1927	002476'	202340	376000*		MOVEM	T2,%RIB+RIBSLF		;SAVE ADR AS LAST WORD OF RIB
  1928	002477'	135400	002350*		LDB	T3,PJOBN		;JOB NUMBER
  1929	002500'	200410	000605*		MOVE	T3,JBTAUN(T3)		;AUTHORS PRJ,PRG NUMBER
  1930	002501'	336000	376000*		SKIPN	%RIB+RIBAUT		;IF NO PRJ,PRG GIVEN
  1931	002502'	202400	376000*		 MOVEM	T3,%RIB+RIBAUT		;STORE USERS PRJ,PRG
  1932	002503'	201400	000000*		MOVEI	T3,CODRIB		;CODE WORD SHOWING THIS BLOCK IS A RIB
  1933	002504'	202400	376000*		MOVEM	T3,%RIB+RIBCOD		;SAVE IN RIB BLOCK
  1934	002505'	201300	000001		MOVEI	T1,1
  1935	002506'	202300	376000*		MOVEM	T1,%RIB+RIBSZS		;SET SPARE RIB SIZE
  1936	002507'	200455	002451*		MOVE	T4,ATBPVW(P2)		;PRIVS, DATE
  1937	002510'	202440	376000*		MOVEM	T4,%RIB+RIBPVW		;SAVE IN RIB
  1938	002511'	200455	001723*		MOVE	T4,ATBLCW(P2)
  1939	002512'	202440	376000*		MOVEM	T4,%RIB+RIBLCW
  1940	002513'	200440	376000*		MOVE	T4,%RIB+RIBSTS
  1941	002514'	661440	000000*		TLO	T4,RIPLOG
  1942	002515'	603540	020000		TLNE	M,UUOUFD		;DIRECTORY FILE?
  1943	002516'	664440	000000*		 TROA	T4,RIPDIR		;YES. SET A BIT IN RIBSTS
  1944	002517'	620440	002516*		 TRZ	T4,RIPDIR		;  ELSE CLEAR IT
  1945	002520'	202440	376000*		MOVEM	T4,%RIB+RIBSTS	
  1946	002521'	120304	000015		DMOVE	T1,DEVFIL(F)		;GET NAME AND EXTENSION
  1947	002522'	544355	002354*		HLR	T2,ATBMSC(P2)		;ACCESS DATE AND EXTENDED DATE
  1948	002523'	124300	376000*		DMOVEM	T1,%RIB+RIBNAM		;TO RIB
  1949	002524'	200304	000017		MOVE	T1,DEVPPN(F)
  1950	002525'	202300	376000*		MOVEM	T1,%RIB+RIBPPN
  1951	002526'	607540	020000		TLNN	M,UUOUFD		;IS THIS A DIRECTORY
  1952	002527'	254000	002537'		 JRST	SETENA			;NO
  1953	002530'	550300	000000*		HRRZ	T1,STRDDB+STRHSH	;MUST PUT A FEW NX PTRS THERE
  1954	002531'	201340	000001		MOVEI	T2,1			;THIS WILL DO
  1955	002532'	202346	375777*		MOVEM	T2,%RIB+RIBPFS-1(T1)
  1956	002533'	367300	002532'		SOJG	T1,.-1
  1957	002534'	550300	000000*		HRRZ	T1,STRDDB+STRHSH
  1958	002535'	221300	001000		IMULI	T1,1000
  1959	002536'	202315	002332*		MOVEM	T1,ATBSIZ(P2)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 41
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1960	002537'	260040	000000*	SETENA:	PUSHJ	P,ZERDDB		;ALL 0 BUT NOT READ RIB BEFORE CREATE PNTRS
  1961	002540'	350001	000000		  AOS	(P)
  1962	002541'	201300	000004		MOVEI	T1,DECENT
  1963	002542'	137300	002307*		DPB	T1,DEYSTC
  1964	002543'	202004	000002		MOVEM	S,DEVIOS(F)
  1965	002544'	254000	001754*		JRST	RELLOK			;NO RELEASE RIB
  1966
  1967				;GET PART OF OLD LICENSE THAT CAN STILL BEE SET ON FILE
  1968
  1969	002545'	135440	002477*	SAVLIC:	LDB	T4,PJOBN		;GET SET TO PRESERVE LICENSE ON SUP
  1970	002546'	510351	001066*		HLLZ	T2,JBTLIC(T4)
  1971	002547'	200411	002351*		MOVE	T3,JBTPPN(T4)
  1972	002550'	430404	000017		XOR	T3,DEVPPN(F)
  1973	002551'	550315	002361*		HRRZ	T1,ATBLIC(P2) 		;WILL BE 0 FOR CRE, OLD FOR SUP OR UPD
  1974	002552'	324740	004754'		PJRST	FILLIC
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 42
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  1975				;SIMULTANEOUS UPDATE CHANIO COMES HERE.
  1976
  1977	002553'	702600	400000*	USIMUP:	NOCHARGE			;DON'T CHARGE MICROCYCLES
  1978	002554'	260040	002007'		PUSHJ	P,TSTRES		;SETUP STACK FOR RETURN CHECK
  1979	002555'	607200	040000		TLNN	F,LOOKB			;GUY HAD TO DO LOOKUP
  1980	002556'	254000	005107'		  JRST	LUKER1			;HE DIDN'T, ILLEGAL SEQUENCE OF UUOS
  1981	002557'	260040	003514'		PUSHJ	P,ERNSET		;CHARGE ONE ENTER
  1982	002560'	260040	003040'		PUSHJ	P,CHKAG1		;CHECK ARGS, SETUP M
  1983	002561'	254000	005105'		  JRST	ILNMER			;ILLEGAL NAME ERROR
  1984	002562'	661540	004000		TLO	M,UUOSIM		;SET THE FLAG FOR UPDATE
  1985	002563'	254000	002566'		JRST	UPDAT1			;AND JOIN COMMON CODE.
  1986
  1987				;HERE WHEN THE ENTER IS AN UPDATE (LOOKUP ALREADY DONE)
  1988				; OR FROM THE SIMULTANEOUS UPDATE CHANIO, ABOVE, WITH UUOSIM SET.
  1989
  1990	002564'	260040	003040'	UPDATE:	PUSHJ	P,CHKAG1		;CHECK ARGUMENTS NOW
  1991	002565'	254000	005105'		  JRST	ILNMER			;SAY ILLEGAL NAME
  1992	002566'	260040	001773*	UPDAT1:	PUSHJ	P,WAIT1			;WAIT FOR I/O TO STOP
  1993	002567'	260040	002244*		PUSHJ	P,GETCBR
  1994	002570'	260040	003103'		PUSHJ	P,GETNAM
  1995	002571'	312304	000015		CAME	T1,DEVFIL(F)
  1996	002572'	254000	005116'		  JRST	UILNMD			;%  NAME DOES NOT MATCH
  1997	002573'	260040	003107'		PUSHJ	P,GETEXT
  1998	002574'	513000	000006		HLLZS	T1			;% ONLY WANT LEFT HALF
  1999	002575'	510344	000016		HLLZ	T2,DEVEXT(F)
  2000	002576'	312300	000007		CAME	T1,T2
  2001	002577'	254000	005116'		  JRST	UILNMD
  2002	002600'	260040	003113'		PUSHJ	P,GETPPN
  2003	002601'	312304	000017		CAME	T1,DEVPPN(F)
  2004	002602'	254000	005116'		  JRST	UILNMD
  2005	002603'	550644	002334*		HRRZ	P2,DEVATB(F)
  2006	002604'	554744	002313*		HLRZ	P4,DEVDRB(F)		;% LOAD POINTERS FOR PROTECTION CHECK ETC
  2007	002605'	200315	002475*		MOVE	T1,ATBRIB(P2)		;SET UP
  2008	002606'	202304	001426*		MOVEM	T1,DEVRIB(F)		;FOR
  2009	002607'	476004	000000*		SETOM	DEVFLO(F)		;TRUNCATION.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 43
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2010				;% HERE WHEN THE NAME, EXTENSION AND PRJ,PRG AGREE WITH THE LOOKED-UP FILE
  2011	002610'	205300	000000*		MOVSI	T1,NOWRT
  2012	002611'	412304	000007		ANDCAM	T1,DEVIAD(F)		;% TURN OFF IN CASE ON FROM BEFORE
  2013	002612'	201340	002320*		MOVEI	T2,ATPNDL		;% DO NOT ALLOW IF UNDELETABLE
  2014	002613'	201300	000000*		MOVEI	T1,FNCAPP		;% CHECK TO SEE IF APPEND IS LEGAL
  2015	002614'	616355	002462*		TDNN	T2,ATBSTS(P2)
  2016	002615'	260040	002321*		 PUSHJ	P,CHKPRV		;% OK?
  2017	002616'	254000	005121'		  JRST	UPDER2			;% NO. ERROR
  2018	002617'	201300	000000*		MOVEI	T1,FNCUPD		;% NOW CHECK IF APPEND OR UPDATE
  2019	002620'	260040	002615*		PUSHJ	P,CHKPRV
  2020	002621'	334000	000000		  SKIPA
  2021	002622'	254000	002625'		 JRST	WRTOK
  2022	002623'	205300	002610*		MOVSI	T1,NOWRT
  2023	002624'	436304	000007		IORM	T1,DEVIAD(F)		;% SET NO WRITE BIT
  2024	002625'	201300	000005	WRTOK:	MOVEI	T1,DECSTP
  2025	002626'	137300	002542*		DPB	T1,DEYSTC
  2026	002627'	200415	002614*		MOVE	T3,ATBSTS(P2)		;% FILE STATUS
  2027	002630'	602400	001415*		TRNE	T3,ATPDEL		;% IF FILE IS GOING TO GO AWAY
  2028	002631'	254000	005123'		  JRST	UPDER3			;% GIVE BEING MODIFIED ERROR
  2029	002632'	607540	004000		TLNN	M,UUOSIM		;% THIS SIMULTANEOUS UPDATE?
  2030	002633'	254000	002640'		  JRST	WRTOK1			;% NO, MAKE SURE NO OTHER WRITERS.
  2031	002634'	260040	000000*		PUSHJ	P,TSTWRS		;% BOMB IF SINGLE UPDATER OR SUPERCEDE
  2032	002635'	254000	005123'		  JRST	UPDER3			;% BEING MODIFIED SOMEHOW.
  2033	002636'	201340	001511*		MOVEI	T2,ATPMXU		;% DON'T SET ATPUPD
  2034	002637'	254000	002643'		JRST	WRTOK2			;% GO SET MXU
  2035	002640'	260040	001706*	WRTOK1:	PUSHJ	P,TSTWRT		;% SINGLE UPDATE, IF OTHER WRITERS,
  2036	002641'	254000	005123'		  JRST	UPDER3			;% GIVE FILE BEING MODIFIED.
  2037	002642'	201340	000000*		MOVEI	T2,ATPUPD!ATPMXU	;% MAX WRITE COUNT IS ABOUT TO BE INCED
  2038	002643'	436355	002627*	WRTOK2:	IORM	T2,ATBSTS(P2)
  2039	002644'	550415	001764*		HRRZ	T3,ATBFNB(P2)
  2040	002645'	350010	001505*		AOS	FNBUPD(T3)
  2041	002646'	350415	001507*		AOS	T3,ATBMWC(P2)		;% INCREMENT COUNT WHICH INCLUDES UPDATERS
  2042	002647'	606400	001510*		TRNN	T3,ATMMWC		;% MAKE SURE IT DIDN'T TO TO ZERO (OVERFLOW)
  2043	002650'	256000	000000'		 STOPCD (SLO)
  2044				           	;;WRTOK2+5
  2045	002651'	350357	001516*		AOS	T2,DRBCNT(P4)		;% COUNT ONE MORE IN UFB IN CASE CLOSE IN
  2046	002652'	602340	001517*		TRNE	T2,DRPMXC		;% OVERFLOW?
  2047	002653'	256000	000000'		 STOPCD (SLO)
  2048					        	;;WRTOK2+10
  2049	002654'	260040	002260*		PUSHJ	P,GIVCBR		;% NOW ALL FINISHED WITH CB
  2050	002655'	205300	000000*		MOVSI	T1,ATMUFP-ATPALC-ATPPID	;ZERO PRIV UFD BITS
  2051	002656'	412315	002511*		ANDCAM	T1,ATBLCW(P2)
  2052	002657'	260040	002545'		PUSHJ	P,SAVLIC		;GET LIC HE CAN STILL HAVE
  2053	002660'	542315	002551*		HRRM	T1,ATBLIC(P2)		;AND SAVE IT
  2054	002661'	200300	002460*		MOVE	T1,THSDAT
  2055	002662'	137300	002461*		DPB	T1,ATYADT		;UPDATE ACCESS DATE
  2056	002663'	607540	200000		TLNN	M,EXTUUO		;NO. EXTENDED ENTER?
  2057	002664'	254000	002724'		  JRST	UPDEN3			;NO
  2058	002665'	305600	000004		CAIGE	P1,UUXPRV
  2059	002666'	254000	002733'		  JRST	UPNSDT			;NOT SETTING DATE
  2060	002667'	256200	006156'		UMOVE	T1,UUXPRV(M)
  2061	002670'	256200	006157'		UMOVE	T2,UUXEXT(M)		;GET EXTENSION WORD
  2062	002671'	606340	140000		TRNN	T2,140000		;TO SEE IF EXTENDED DATE INFO
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 43-2
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2063	002672'	612300	006144'		  TDNE	T1,[37,,-1]		;SEE IF DATE, TIME GIVEN
  2064	002673'	334000	000000		 SKIPA	
  2065	002674'	254000	002733'		  JRST	UPNSDT
  2066	002675'	137300	001640*		DPB	T1,ATYCDT
  2067	002676'	242300	777764		LSH	T1,-^D12
  2068	002677'	137300	001645*		DPB	T1,ATYCTM
  2069	002700'	201300	000000		MOVEI	T1,0
  2070	002701'	137300	002412*		DPB	T1,ATYCSC		;IF HE SETS IT LATTER OK
  2071	002702'	242340	777762		LSH	T2,-^D14
  2072	002703'	137340	002465*		DPB	T2,ATYXCD		;SAVE EXTENDED DATE INFO
  2073	002704'	200315	002507*	UPDTDN:	MOVE	T1,ATBPVW(P2)
  2074	002705'	301600	000004		CAIL	P1,UUXPRV
  2075	002706'	256200	006076'		 UMOVEM	T1,UUXPRV(M)		;TELL THE USER
  2076	002707'	554315	002522*		HLRZ	T1,ATBMSC(P2)
  2077	002710'	256200	006136'		XCTBU	<HRRM T1,UUXEXT(M)>
  2078	002711'	305600	000005		CAIGE	P1,UUXSIZ
  2079	002712'	254000	002717'		  JRST	UPDTD2			;CAN NOT POSSIBLE WANT SIZE BACK
  2080	002713'	200315	002536*		MOVE	T1,ATBSIZ(P2)
  2081	002714'	602300	000177		TRNE	T1,177
  2082	002715'	275300	000200		  SUBI	T1,200			;ADJUST TO WORDS
  2083	002716'	256200	006137'		UMOVEM	T1,UUXSIZ(M)		;AND GIVE IT TO USER
  2084
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 44
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2085	002717'	305600	000011	UPDTD2:	CAIGE	P1,UUXALC		;SPECIFYING ALLOCATION?
  2086	002720'	254000	003003'		  JRST	UPDEND			;NO. TAKE GOOD RETURN.
  2087	002721'	260040	002752'		PUSHJ	P,ALCCHK		;MAYBE.
  2088	002722'	254000	003003'		  JRST	UPDEND			;NO.
  2089	002723'	254000	002770'		JRST	DELGRP			;YES.
  2090
  2091				;HERE ON 4-WORD UPDATE   SET UP SIZE IN E+3
  2092	002724'	200315	002713*	UPDEN3:	MOVE	T1,ATBSIZ(P2)		;GET NUMBER OF WORDS IN FILE
  2093	002725'	602300	000177		TRNE	T1,177
  2094	002726'	275300	000200		  SUBI	T1,200
  2095	002727'	307300	400000		CAIG	T1,400000
  2096					  JRST	[MOVNS T1
  2097	002730'	254000	006160'			 JRST  UPDEN4]
  2098	002731'	242300	777771		LSH	T1,W2BLSH
  2099	002732'	256200	006134'	UPDEN4: XCTBU <HRLZM T1,UUNPPN(M)>	;IN LH (E+3)
  2100	002733'	260040	002406*	UPNSDT:	PUSHJ	P,GETGMT		;GET T1/TIME T2/DATE
  2101	002734'	137340	002675*		DPB 	T2,ATYCDT		;UPDATE 'CREATION' TIME
  2102	002735'	242340	777764		LSH 	T2,-^D12
  2103	002736'	137340	002703*		DPB 	T2,ATYXCD
  2104	002737'	230300	002410*		IDIV 	T1,JFYSEC
  2105	002740'	231300	000074		IDIVI 	T1,^D60
  2106	002741'	137300	002677*		DPB 	T1,ATYCTM
  2107	002742'	137340	002701*		DPB 	T2,ATYCSC
  2108	002743'	603540	200000		TLNE	M,EXTUUO
  2109	002744'	254000	002704'		  JRST	UPDTDN
  2110	002745'	200315	002704*		MOVE	T1,ATBPVW(P2)
  2111	002746'	256200	006130'		UMOVEM	T1,UUNATT(M)
  2112	002747'	554315	002707*		HLRZ	T1,ATBMSC(P2)
  2113	002750'	256200	006135'		XCTBU	<HRRM T1,UUNEXT(M)>
  2114	002751'	254000	003003'		JRST	UPDEND			;MUST GO CLEAR LICENSE.
  2115
  2116				;SMALL SUBR TO SEE IF A FILE SHOULD BE TRUNCATED.
  2117				;EXPECTS P2/ ATB ADDRESS.
  2118				;DESTROYS T2 AND T3.
  2119				;NON-SKIP RETURNS IF CHANGE OF ALLOCATION IS NOT REQUESTED OR
  2120				;IF REQUEST IS >= ACTUAL SIZE.  ELSE SKIP RETURNS WITH
  2121				;T2/ UUXALC IN UNITS OF WORDS.
  2122
  2123	002752'	256200	006162'	ALCCHK:	UMOVE	T3,UUXNUM(M)		;IS TRUNCATION
  2124	002753'	256200	006163'		XCTFU	<SKIPN T2,UUXALC(M)>	;BEING
  2125	002754'	602400	200000		TRNE	T3,UUPWDS		;REQUESTED?
  2126	002755'	254000	002757'		  JRST	.+2			;YES.
  2127	002756'	263040	000000		 POPJ	P,			;NO.
  2128	002757'	321340	000102*		JUMPL	T2,CPOPJ		;
  2129	002760'	606400	200000		TRNN	T3,UUPWDS		;IS UUXALC IN WORDS?
  2130					  JRST	[CAMLE T2,[XWD 1777,-1] ;NO, SO WE MUST
  2131						  POPJ P,		;CONVERT IT FROM BLOCKS.
  2132						 LSH   T2,B2WLSH	;(WON'T OVERFLOW, SINCE WE
  2133	002761'	254000	006165'			 JRST  .+1]		;JUST CHECKED FOR THAT.).
  2134	002762'	200415	002724*		MOVE	T3,ATBSIZ(P2)		;GET THE ACTUAL FILE
  2135	002763'	602400	000177		TRNE	T3,177			;SIZE IN
  2136	002764'	275400	000200		  SUBI	T3,200			;WORDS.
  2137	002765'	315340	000010		CAMGE	T2,T3			;ACTUALLY WANT TO TRUNCATE?
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 44-2
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2138	002766'	350001	000000		  AOS	(P)			;YES.
  2139	002767'	263040	000000		POPJ	P,			;NO.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 45
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2140	002770'	201300	000000*	DELGRP:	MOVEI	T1,FNCTRN		;CAN WE TRUNCATE?
  2141	002771'	260040	002620*		PUSHJ	P,CHKPRV
  2142	002772'	254000	003003'		  JRST	UPDEND			;NO
  2143	002773'	256200	006171'		UMOVE	T2,UUXALC(M)		;GET
  2144	002774'	256200	006131'		UMOVE	T1,UUXNUM(M)		;T2
  2145	002775'	606300	200000		TRNN	T1,UUPWDS		;IN
  2146	002776'	242340	000007		  LSH	T2,B2WLSH		;WORDS.
  2147	002777'	661540	040000		TLO	M,UUOENT		;DELETE THINGS FROM RIB.
  2148	003000'	260040	000000*		PUSHJ	P,DLTTRC		;FLAG SO WE NEED RB2DDB NEEDED.
  2149	003001'	254000	003032'		  JRST	UPDND3			;ERROR ON TRUNCATION, BAD FILE NOW.
  2150	003002'	254000	003010'		JRST	UPDEN2			;NOW HAVE PRIME RIB IN CORE, FINISH UP
  2151
  2152	003003'	260040	001241*	UPDEND:	PUSHJ	P,RIBWTL
  2153	003004'	254000	003032'		  JRST	UPDND3
  2154	003005'	201300	000000*		MOVEI	T1,FNCCAT		;CAN HE CHANGE ATTRIBUTES?
  2155	003006'	260040	002771*		PUSHJ	P,CHKPRV
  2156	003007'	400600	000000		  SETZ	P1,			;CAN'T TOUCH ATTRIBUTES, MAKE SETVAL DO NOTHING.
  2157	003010'	402015	002365*	UPDEN2:	SETZM	ATBPID(P2)		;CLEAR PID AND BIT THAT SAYS THERE IS ONE
  2158	003011'	402000	376000*		SETZM	%RIB+RIBPID		;IN CASE NO VALID PID SPECIFIED.
  2159	003012'	205300	001655*		MOVSI	T1,ATPPID		;CLEAR BIT THAT SAYS THERE'S A PID
  2160	003013'	413315	002656*		ANDCAB	T1,ATBLCW(P2)		;STORE LICENSE NOW SO THAT SOMEONE DOESN'T
  2161									; CHANGE CONTENTS OF LICENSED FILE WHILE
  2162									; ITS BEING UPDATED AND STILL HAVE LICENSE
  2163									; UNTIL CLOSE. (ALSO STORE ATPPID=RIPPID)
  2164	003014'	202300	376000*		MOVEM	T1,%RIB+RIBLCW
  2165					TLNE	M,EXTUUO		;IF EXTENDED UUO, CALL SETVAL. (ELSE ALL DONE SETTING T
  2166	003015'	603540	200000	HINGS.)
  2167	003016'	260040	004424'		  PUSHJ	P,SETVAL
  2168	003017'	603540	040000		TLNE	M,UUOENT
  2169	003020'	260040	002172*		  PUSHJ	P,INVDDB		;NEEDED IF PAGES DELETED
  2170	003021'	260040	002544*	UPDEN5:	PUSHJ	P,RELLOK		;NOW RELEASE RIB
  2171	003022'	350001	000000	UPDND4:	AOS	(P)			;AND FALL INTO SETAPN
  2172	003023'	201300	000002		MOVEI	T1,DECUPD
  2173	003024'	137300	002626*		DPB	T1,DEYSTC
  2174	003025'	202004	000002		MOVEM	S,DEVIOS(F)
  2175
  2176	003026'	135300	002235*	SETAPN:	LDB	T1,ATYBLK		;GET BLOCKS CURRENTLY IN FILE
  2177	003027'	550355	002644*		HRRZ	T2,ATBFNB(P2)
  2178	003030'	202307	000000*		MOVEM	T1,FNBAPD(T2)		;AND STORE IN CASE APPEND ONLY
  2179	003031'	263040	000000		POPJ	P,
  2180
  2181	003032'	603540	040000	UPDND3:	TLNE	M,UUOENT
  2182	003033'	260040	003020*		  PUSHJ	P,INVDDB		;INVALIDATE THE DDB, SET FILE LOC TO START.
  2183	003034'	254000	003022'		 JRST	UPDND4			;COULD NOT GET RIB TO UPDATE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 46
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2184				;CHECK ARGUMENT LIST AND TAKE CARE OF USER NAME INSTEAD OF PPN
  2185
  2186	003035'	205000	000000*	CHKARG:	MOVSI	S,IOSERR		;RESET SOME EXTRA BITS
  2187	003036'	413004	000002		ANDCAB	S,DEVIOS(F)
  2188	003037'	334340	006172'		SKIPA	T2,[<NORED!NOWRT!PIDACC>,,0] ;BITS TO CLEAR IN DEVIAD
  2189	003040'	205340	000000*	CHKAG1:	MOVSI	T2,PIDACC
  2190	003041'	412344	000007		ANDCAM	T2,DEVIAD(F)
  2191	003042'	621540	777777		TLZ	M,UUOMSK
  2192	003043'	256200	006173'		UMOVE	P1,(M)			;GET COUNT OR NAME
  2193	003044'	607600	777777		TLNN	P1,-1			;SEE IF EXTENDED
  2194	003045'	254000	003062'		  JRST	CHKAGX			;YES
  2195	003046'	261040	000013		PUSH	P,M			;SAVE ARG POINTER (IN CASE EXTENDED)
  2196	003047'	256200	006174'	CHKPPN:	XCTBU	<MOVES T1,UUNPPN(M)>	;MAKE SURE CAN WRITE IN THIS
  2197					JUMPLE	T1,[LDB  T3,PJOBN
  2198						    MOVE T1,JBTPPN(T3)	;USE JOBS IF 0 OR NEG
  2199	003050'	323300	006175'			    JRST CHKPP1]
  2200	003051'	607300	777777		TLNN	T1,-1			;IS IT USER NAME?
  2201	003052'	260040	003237'		  PUSHJ	P,LOKLUD
  2202	003053'	607200	000100	CHKPP1:	TLNN	F,SYSDEV		;SYS?
  2203	003054'	254000	003057'		  JRST	CHKPP2			;NO
  2204				PRINTF(<[Including HACK at CHKPP1 that makes SYS:[1,1] work for accounting]>)
  2205	003055'	312300	002050*		CAME	T1,MFDPPN		;*HACK* for dumb accounting programs (no source!)
  2206	003056'	200300	000174*		MOVE	T1,SYSPPN		;USE SYS PPN UNLESS MFD PPN
  2207	003057'	256200	006200'	CHKPP2:	UMOVEM	T1,UUNPPN(M)		;SAVE FOR USER
  2208	003060'	262040	000013		POP	P,M
  2209	003061'	254000	002201*		JRST	CPOPJ1
  2210
  2211	003062'	205300	003040*	CHKAGX:	MOVSI	T1,PIDACC		;GET READY TO SET
  2212	003063'	602600	100000		TRNE	P1,UUPPID		;CALLER ASKING FOR PID ACCESS?
  2213	003064'	436304	000007		  IORM	T1,DEVIAD(F)		;YES, SET BIT FOR CHKPRV
  2214	003065'	405600	000777		ANDI	P1,777			;MASK TO COUNT FIELD
  2215	003066'	303600	000040		CAILE	P1,UUXENT
  2216	003067'	201600	000040		  MOVEI	P1,UUXENT		;MUST NOT BE TOO BIG
  2217	003070'	322600	003061*		JUMPE	P1,CPOPJ1		;NOT REALLY EXTENDED, JUST 0 NAME
  2218	003071'	661540	200000		TLO	M,EXTUUO		;MARK EXTENDED UNLESS 0 NAME
  2219	003072'	305600	000003		CAIGE	P1,3			;BUT MUST BE AT LEAST 3
  2220	003073'	263040	000000		  POPJ	P,			;OR ERROR
  2221	003074'	550300	000013		HRRZ	T1,M
  2222	003075'	270300	000014		ADD	T1,P1
  2223	003076'	256200	006201'		XCTBU	<MOVES (M)>		;MAKE SURE CAN WRITE IN FIRST AND LAST
  2224	003077'	256200	006202'		XCTFU	<MOVES (T1)>		;WORDS (ASSUMES LOOKUP BLOCK LESS THAN 1 PAGE LONG)
  2225	003100'	261040	000013		PUSH	P,M			;SAVE ARG
  2226	003101'	275540	000002		SUBI	M,UUNPPN-UUXPPN		;CORRECT M FOR EXTENDED PPN
  2227	003102'	254000	003047'		JRST	CHKPPN			;AND GO TAKE CARE OF IT
  2228
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 47
FILUUO.MAC	 8-DEC-87 11:25		ENTER

  2229				;ROUTINES TO GET THE VARIOUS ARGS
  2230
  2231	003103'	607540	200000	GETNAM:	TLNN	M,EXTUUO
  2232	003104'	256200	006203'		  XCTFU	<SKIPA T1,UUNNAM(M)>
  2233	003105'	256200	006204'		UMOVE	T1,UUXNAM(M)
  2234	003106'	263040	000000		POPJ	P,			;NAME
  2235
  2236	003107'	607540	200000	GETEXT:	TLNN	M,EXTUUO
  2237	003110'	256200	006205'		  XCTFU	<SKIPA T1,UUNEXT(M)>
  2238	003111'	256200	006206'		UMOVE	T1,UUXEXT(M)
  2239	003112'	263040	000000		POPJ	P,
  2240
  2241	003113'	607540	200000	GETPPN:	TLNN	M,EXTUUO
  2242	003114'	256200	006207'		  XCTFU	<SKIPA T1,UUNPPN(M)>
  2243	003115'	256200	006210'		UMOVE	T1,UUXPPN(M)
  2244	003116'	263040	000000		POPJ	P,
  2245
  2246				;SET UF DEVFIL, DEVEXT, DEVPPN, LEAVE PPN IN T1
  2247
  2248	003117'	260040	003103'	SETFIL:	PUSHJ	P,GETNAM
  2249	003120'	322300	002757*		JUMPE	T1,CPOPJ		;GERROR IF NAME 0
  2250	003121'	202304	000015		MOVEM	T1,DEVFIL(F)
  2251	003122'	260040	003107'		PUSHJ	P,GETEXT
  2252	003123'	502304	000016		HLLM	T1,DEVEXT(F)
  2253	003124'	260040	003113'		PUSHJ	P,GETPPN
  2254	003125'	202304	000017		MOVEM	T1,DEVPPN(F)
  2255	003126'	254000	003070*		JRST	CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 48
FILUUO.MAC	 8-DEC-87 11:25		PPNUSR - Translate PPN to USERNAME using only in-core tables

  2256				SUBTTL	PPNUSR - Translate PPN to USERNAME using only in-core tables
  2257				;Call:	MOVE	T1,[PPN]
  2258				;	PUSHJ	P,PPNUSR
  2259				;	  error return	;Need to read DUL.SYS
  2260				;	success return	;USERNAME in T2 and T3
  2261
  2262	003127'	316300	003056*	PPNUSR::CAMN	T1,SYSPPN##	;Is it [1,4]
  2263					 JRST	[MOVSI T2,'SYS'	;Yes
  2264						 SETZ  T3,
  2265	003130'	254000	006211'			 JRST  CPOPJ1]	;[1,4]=(SYS)
  2266	003131'	200400	000757*		MOVE	T3,HIGHJB	;Search the JBT tables
  2267	003132'	312310	002500*	PPNUS1:	CAME	T1,JBTAUN(T3)	;Check if Accounting User Number matches
  2268	003133'	254000	003140'		 JRST	PPNUS2
  2269	003134'	200350	000000*		MOVE	T2,JBTUNM(T3)	;Get USERNAME for this AUN
  2270	003135'	322340	003140'		JUMPE	T2,PPNUS2
  2271	003136'	200410	000000*		MOVE	T3,JBTUN1(T3)
  2272	003137'	254000	003126*		JRST	CPOPJ1		;Success
  2273	003140'	367400	003132'	PPNUS2:	SOJG	T3,PPNUS1
  2274
  2275				;No one logged in by that PPN, check if anyone is GFD'd to that directory
  2276
  2277	003141'	200400	003131*		MOVE	T3,HIGHJB	;Search the JBT tables
  2278	003142'	312310	002547*	PPNUS3:	CAME	T1,JBTPPN(T3)	;Check if PPN matches
  2279	003143'	254000	003150'		 JRST	PPNUS4
  2280	003144'	200350	001004*		MOVE	T2,JBTNM1(T3)	;Get USERNAME for this PPN
  2281	003145'	322340	003150'		JUMPE	T2,PPNUS4
  2282	003146'	200410	001005*		MOVE	T3,JBTNM2(T3)
  2283	003147'	254000	003137*		JRST	CPOPJ1		;Success
  2284	003150'	367400	003142'	PPNUS4:	SOJG	T3,PPNUS3
  2285
  2286	003151'	331000	000000*		SKIPL	.CPDWD##	;Processing a stopcode?
  2287	003152'	263040	000000		 POPJ	P,		;Yes, can't trust DRB's, give error return
  2288	003153'	261040	002014*		PUSH	P,JOB
  2289	003154'	202100	003153*		MOVEM	J,JOB
  2290	003155'	260040	002567*		PUSHJ	P,GETCBR	;Not found, need to search core blocks
  2291	003156'	201400	000000*		MOVEI	T3,SYSDRB-DRBLNK;Pointer to first place
  2292	003157'	254000	003167'		JRST	PPNUS6		;Jump into loop
  2293
  2294				;Check for USERNAME/PPN correlation in the PPBs
  2295
  2296	003160'	312310	000000*	PPNUS5:	CAME	T1,DRBNAM(T3)	;Check if PPN matches
  2297	003161'	254000	003167'		 JRST	PPNUS6
  2298	003162'	200350	000000*		MOVE	T2,DRBUNM(T3)	;Get USERNAME
  2299	003163'	200410	000000*		MOVE	T3,DRBUN1(T3)
  2300	003164'	260040	002654*		PUSHJ	P,GIVCBR
  2301	003165'	262040	003154*		POP	P,JOB
  2302	003166'	254000	003147*		JRST	CPOPJ1		;Success
  2303	003167'	554410	000000*	PPNUS6:	HLRZ	T3,DRBLNK(T3)
  2304	003170'	326400	003160'		JUMPN	T3,PPNUS5	;Follow pointer to next one
  2305	003171'	260040	003164*		PUSHJ	P,GIVCBR	;No more pointers, error return
  2306	003172'	262040	003165*		POP	P,JOB
  2307	003173'	263040	000000		POPJ	P,		;Give error return
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 49
FILUUO.MAC	 8-DEC-87 11:25		USRPPN - Translate USERNAME to PPN using only in-core tables

  2308				SUBTTL	USRPPN - Translate USERNAME to PPN using only in-core tables
  2309				;Call:	DMOVE	T2,[SIXBIT/USERNAME/]
  2310				;	PUSHJ	P,USRPPN
  2311				;	  error return	;Need to read LUD.SYS
  2312				;	success return	;PPN in T1
  2313
  2314	003174'	316340	006214'	USRPPN::CAMN	T2,[SIXBIT/SYS/];Is it (SYS)
  2315					 JUMPE	T3,[MOVE T1,SYSPPN##
  2316	003175'	322400	006215'			    JRST CPOPJ1];(SYS)=[1,4]
  2317	003176'	200300	003141*		MOVE	T1,HIGHJB	;Search the JBT tables
  2318	003177'	316346	003134*	USRPP1:	CAMN	T2,JBTUNM(T1)	;Check if username matches
  2319	003200'	312406	003136*		CAME	T3,JBTUN1(T1)	; (in the AUN tables)
  2320	003201'	254000	003204'		 JRST	USRPP2
  2321	003202'	200306	003132*		MOVE	T1,JBTAUN(T1)	;Get Accounting User Number for this name
  2322	003203'	254000	003166*		JRST	CPOPJ1		;Success
  2323	003204'	367300	003177'	USRPP2:	SOJG	T1,USRPP1
  2324
  2325				;No one logged in by that name, check if anyone is GFD'd to that directory
  2326
  2327	003205'	200300	003176*		MOVE	T1,HIGHJB	;Search the JBT tables
  2328	003206'	316346	003144*	USRPP3:	CAMN	T2,JBTNM1(T1)	;Check if username matches
  2329	003207'	312406	003146*		CAME	T3,JBTNM2(T1)
  2330	003210'	254000	003213'		 JRST	USRPP4
  2331	003211'	200306	003142*		MOVE	T1,JBTPPN(T1)	;Get PPN for this username
  2332	003212'	254000	003203*		JRST	CPOPJ1		;Success
  2333	003213'	367300	003206'	USRPP4:	SOJG	T1,USRPP3
  2334
  2335	003214'	331000	003151*		SKIPL	.CPDWD##	;Processing a stopcode?
  2336	003215'	263040	000000		 POPJ	P,		;Yes, can't trust DRB's, give error return
  2337	003216'	261040	003172*		PUSH	P,JOB
  2338	003217'	202100	003216*		MOVEM	J,JOB
  2339	003220'	260040	003155*		PUSHJ	P,GETCBR	;Not found, need to search core blocks
  2340	003221'	201300	000000*		MOVEI	T1,SYSDRB-DRBLNK;Pointer to first place
  2341	003222'	254000	003232'		JRST	USRPP6		;Jump into loop
  2342
  2343				;Check for USERNAME/PPN correlation in the PPBs
  2344
  2345	003223'	316346	003162*	USRPP5:	CAMN	T2,DRBUNM(T1)	;Check if username matches
  2346	003224'	312406	003163*		CAME	T3,DRBUN1(T1)
  2347	003225'	254000	003232'		 JRST	USRPP6
  2348	003226'	200306	003160*		MOVE	T1,DRBNAM(T1)	;Get PPN
  2349	003227'	260040	003171*		PUSHJ	P,GIVCBR
  2350	003230'	262040	003217*		POP	P,JOB
  2351	003231'	254000	003212*		JRST	CPOPJ1		;Success
  2352	003232'	554306	003167*	USRPP6:	HLRZ	T1,DRBLNK(T1)
  2353	003233'	326300	003223'		JUMPN	T1,USRPP5	;Follow pointer to next one
  2354	003234'	260040	003227*		PUSHJ	P,GIVCBR	;No more pointers
  2355	003235'	262040	003230*		POP	P,JOB
  2356	003236'	263040	000000		POPJ	P,		;Give error return
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 50
FILUUO.MAC	 8-DEC-87 11:25		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2357				SUBTTL	LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN
  2358
  2359	003237'	261040	000006	LOKLUD:	PUSH	P,T1		;Save pointer (return it in T2)
  2360	003240'	261040	000013		PUSH	P,M
  2361	003241'	256200	006217'		XCTBU	<DMOVE T2,(T1)>	;GET USER NAME
  2362	003242'	260040	003174'		PUSHJ	P,USRPPN	;See if USERNAME and PPN is in memory
  2363	003243'	254000	003247'		  JRST	LOKLL5		;Its not, have to read LUD.SYS
  2364	003244'	262040	000013		POP	P,M
  2365	003245'	262040	000007		POP	P,T2
  2366	003246'	263040	000000		POPJ	P,
  2367
  2368				;LOKLUD continued - Go read SYS:LUD.SYS
  2369	003247'	261040	000004	LOKLL5:	PUSH P,F
  2370	003250'	202004	000002		MOVEM S,DEVIOS(F)	;MAKE SURE THIS STAYS AROUND
  2371	003251'	201200	000661*		MOVEI F,DSKDDB	;GET A DDB
  2372	003252'	205300	446353		MOVSI T1,'DSK'
  2373	003253'	260040	000627'		PUSHJ P,SETDDB
  2374	003254'	254000	003475'		 JRST LUDER2		;CAN NOT GET DDB
  2375	003255'	200300	003235*		MOVE T1,JOB
  2376	003256'	137300	002545*		DPB T1,PJOBN
  2377	003257'	201300	200000		MOVEI T1,ASSPRG
  2378	003260'	436304	000004		IORM T1,DEVMOD(F)
  2379	003261'	261052	000000*		PUSH P,%UPT+UPTJDA(W)	;REPLACE HIS POINTER
  2380	003262'	202212	000000*		MOVEM F,%UPT+UPTJDA(W)
  2381	003263'	205340	546544		MOVSI T2,'LUD'
  2382	003264'	202344	000015		MOVEM T2,DEVFIL(F)
  2383	003265'	201340	637163		MOVEI T2,'SYS'
  2384	003266'	506344	000016		HRLM T2,DEVEXT(F)
  2385	003267'	205540	400000		MOVSI M,UUOLUK
  2386	003270'	200300	003127*		MOVE T1,SYSPPN		;Read from SYS:(SYS)[1,4]
  2387	003271'	202304	000017		MOVEM T1,DEVPPN(F)
  2388	003272'	476004	002607*		SETOM	DEVFLO(F)
  2389	003273'	260040	002310*		PUSHJ	P,SRCFIL	;DO A LOOKUP ON LUD.SYS
  2390	003274'	254000	003464'		  JRST	LUDER0
  2391	003275'	623000	002070*		TLZE S,IOSRIB
  2392	003276'	260040	003021*		PUSHJ P,RELLOK	;MAKE SURE WE DON'T HAVE RIB
  2393	003277'	200300	006220'		MOVE T1,[555555555555]
  2394	003300'	202300	003500'		MOVEM T1,X
  2395	003301'	200300	006221'		MOVE T1,[361275431652]
  2396	003302'	202300	003501'		MOVEM T1,X+1
  2397	003303'	200300	006222'		MOVE T1,[612754316523]
  2398	003304'	202300	003502'		MOVEM T1,X+2
  2399	003305'	200401	777775		MOVE T3,-3(P)	;Get pointer to name block
  2400	003306'	256200	006223'		UMOVE T1,(T3)
  2401	003307'	202300	003503'		MOVEM T1,N
  2402	003310'	256200	006224'		UMOVE T1,1(T3)
  2403	003311'	202300	003504'		MOVEM T1,N+1	;GET USER NAME
  2404	003312'	201400	000000		MOVEI T3,0
  2405					REPEAT 4,<PUSHJ P,RND>
  2406	003313'	260040	003332'
  2407	003314'	260040	003332'
  2408	003315'	260040	003332'
  2409	003316'	260040	003332'
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 50-2
FILUUO.MAC	 8-DEC-87 11:25		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2410	003317'	200300	003502'		MOVE T1,X+2
  2411	003320'	430300	003501'		XOR T1,X+1
  2412	003321'	200340	003500'		MOVE T2,X
  2413	003322'	430340	000006		XOR T2,T1
  2414	003323'	261040	000014		PUSH P,P1
  2415	003324'	261040	000007		PUSH P,T2	;THE HASHED USER NAME
  2416	003325'	621300	400000		TLZ T1,400000
  2417	003326'	231300	001567		IDIVI T1,LUDHSH
  2418	003327'	621000	000000*		TLZ S,IOSRIB!IOSRBE!IO
  2419	003330'	201600	000100		MOVEI P1,100	;DO NOT LINK FOREVER
  2420	003331'	254000	003357'		JRST USRUSI	;GO GET THAT BLOCK
  2421
  2422	003332'	200300	003503'	RND:	MOVE T1,N
  2423	003333'	200340	003504'		MOVE T2,N+1
  2424	003334'	272300	003501'		ADDM T1,X+1
  2425	003335'	245300	777756		ROTC T1,-22
  2426	003336'	202300	003503'		MOVEM T1,N
  2427	003337'	202340	003504'		MOVEM T2,N+1
  2428	003340'	201440	000005		MOVEI T4,5
  2429	003341'	200310	003501'	RND1:	MOVE T1,X+1(T3)
  2430	003342'	224300	006225'		MUL T1,[5*5*5*5*5*5*5*5*5*5*5*5*5*5*5]
  2431	003343'	272350	003502'		ADDM T2,X+2(T3)
  2432	003344'	342400	003355'		AOJE T3,RND2
  2433	003345'	211400	000001		MOVNI T3,1
  2434	003346'	200300	003501'		MOVE T1,X+1
  2435	003347'	602300	000001		TRNE T1,1
  2436	003350'	331000	003502'		SKIPL X+2
  2437	003351'	201400	000000		MOVEI T3,0
  2438	003352'	200300	003500'		MOVE T1,X
  2439	003353'	250300	003502'		EXCH T1,X+2
  2440	003354'	202300	003500'		MOVEM T1,X
  2441	003355'	367440	003341'	RND2:	SOJG T4,RND1
  2442	003356'	263040	000000		POPJ P,
  2443
  2444			001567	LUDHSH==^D887
  2445			000004	LHUN==4		;RELATIVE LOC OF HASHED USER NAME
  2446			000000	LPPN==0		;PPN
  2447			000002	LLINK==2	;SIZE OF ENTRY
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 51
FILUUO.MAC	 8-DEC-87 11:25		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2448				EXTERN PE.NER
  2449
  2450			000035	MAPID==35	;CHANIO VMAP FUNCTION NO.
  2451				EXTERN FALHOL,FALPHP,%COW,%COW.N,PE.NER
  2452
  2453	003357'	661200	040000	USRUSI:	TLO	F,LOOKB		;FOOL MAP.
  2454	003360'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W)
  2455	003361'	261040	000007		PUSH	P,T2		;SAVE DESIRED BLOCK NUMBER.
  2456	003362'	200300	006226'		MOVE	T1,[<CPRRED>B7+1B17+%COW.N+<CNVVPN>]
  2457	003363'	242340	777776		LSH	T2,B2PLSH	;MAP IN THAT
  2458	003364'	271340	000001		ADDI	T2,1		;COMES AS 0,1,2,3.
  2459	003365'	551412	000000		HRRZI	T3,(W)		;PAGE OF
  2460	003366'	505400	000035		HRLI	T3,MAPID	;THE
  2461	003367'	043400	000006		CHANIO	T3,T1		;FILE.
  2462	003370'	254000	003372'		  JRST	.+2		;LOST.
  2463	003371'	254000	003402'		JRST	USRUS2		;WON.
  2464	003372'	621200	040000		TLZ	F,LOOKB		;
  2465	003373'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W)
  2466	003374'	262040	000006		POP	P,T1		;CLEAR PD A LITTLE.
  2467	003375'	551410	000000		HRRZI	T3,(T3)		;GET T3/ ERROR CODE.
  2468	003376'	302400	000000*		CAIE	T3,FALHOL	;
  2469	003377'	306400	000000*		CAIN	T3,FALPHP	;
  2470	003400'	254000	003471'		JRST	LUDER1		;
  2471	003401'	256000	006227'		 STOPCD (LUDER1,DEBUG,USRUS1,PRTT3##,<Unexpected CHANIO error in USETI>);;USRUSI+22
  2472	003402'	200300	006233'	USRUS2:	MOVE	T1,[PE.NER+1,,%COW.N+CNVVPN] ;SET IGNORE ERROR BIT
  2473	003403'	047300	777706		PERSET	T1,		; (OLD PCB CODE IGNORED ERRORS TOO)
  2474	003404'	256000	000000'		 STOPCD (SLO)
  2475						;;USRUS2+2
  2476	003405'	621200	040000		TLZ	F,LOOKB		;
  2477	003406'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W)
  2478	003407'	262040	000006		POP	P,T1		;
  2479	003410'	405300	000003		ANDI	T1,3		;
  2480	003411'	242300	000007		LSH	T1,B2WLSH
  2481	003412'	505300	777600		HRLI	T1,-200
  2482	003413'	200346	000004*	SRUSR:	MOVE	T2,%COW+LHUN(T1) ;GET THE HASHED USER NAME.
  2483	003414'	316341	000000		CAMN	T2,(P)
  2484	003415'	254000	003437'		JRST	FUNM		;FOUND IT.
  2485	003416'	337346	000000*		SKIPG	T2,%COW+LPPN(T1)
  2486	003417'	254000	003431'		JRST	BLKLNK		;END OR A LINK.
  2487	003420'	200346	000002*		MOVE	T2,%COW+LLINK(T1)
  2488	003421'	405340	000177		ANDI	T2,177
  2489	003422'	507000	000007		HRLS	T2
  2490	003423'	270300	000007		ADD	T1,T2
  2491	003424'	321300	003413'		JUMPL	T1,SRUSR
  2492	003425'	200300	006234'		MOVE	T1,[XWD 1,%COW.N+CNVVPN] ;
  2493	003426'	047300	777713		VREMOV	T1,
  2494	003427'	256000	000000'		 STOPCD (SLO)
  2495				           ;;SRUSR+14
  2496	003430'	254000	003471'		JRST	LUDER1		;RAN OUT OF BUFFER.
  2497
  2498	003431'	200300	006234'	BLKLNK:	MOVE	T1,[XWD 1,%COW.N+CNVVPN] ;
  2499	003432'	047300	777713		VREMOV	T1,
  2500	003433'	256000	000000'		 STOPCD (SLO)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 51-2
FILUUO.MAC	 8-DEC-87 11:25		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2501				           ;;BLKLNK+2
  2502	003434'	322340	003471'		JUMPE	T2,LUDER1	;
  2503	003435'	365600	003357'		SOJGE	P1,USRUSI	;MAKE SURE WE ARE NOT LOOPING.
  2504	003436'	254000	003471'		JRST	LUDER1
  2505
  2506	003437'	262040	000007	FUNM:	POP	P,T2
  2507	003440'	262040	000014		POP	P,P1
  2508	003441'	200546	003416*		MOVE	M,%COW+LPPN(T1)
  2509	003442'	260040	000335*		PUSHJ	P,UNLFIL	;
  2510	003443'	200300	006234'		MOVE	T1,[XWD 1,%COW.N+CNVVPN] ;
  2511	003444'	047300	777713		VREMOV	T1,
  2512	003445'	256000	000000'		 STOPCD (SLO)
  2513				           ;;FUNM+6
  2514	003446'	260040	003220*		PUSHJ	P,GETCBR		;% NOW NEED TO ADD TO LIST
  2515	003447'	554340	002246*		HLRZ	T2,SYSDRB		;%
  2516	003450'	201400	000000*		MOVEI	T3,SYSDRB-DRBLNK 	;% SET TO SEARCH DRB
  2517	003451'	200300	000013		MOVE	T1,M			;% GET PPN
  2518	003452'	260040	002250*		PUSHJ	P,SRCNAM		;%
  2519					JUMPLE	T2,[MOVEM M,-3(P)	;% NO CORE
  2520	003453'	323340	006235'			JRST FUNM1]
  2521	003454'	250541	777775		EXCH	M,-3(P)			;% ADDRESS OF USER NAME
  2522	003455'	256200	006237'		XCTBU	<DMOVE T3,(M)>		;%
  2523	003456'	124407	003223*		DMOVEM	T3,DRBUNM(T2)		;%
  2524	003457'	260040	003234*	FUNM1:	PUSHJ	P,GIVCBR		;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 52
FILUUO.MAC	 8-DEC-87 11:25		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2525	003460'	201540	000000	LUDERR:	MOVEI	M,0
  2526	003461'	661200	050000		TLO	F,INPB!LOOKB		;FLAG SO A.T. NOT DELETED
  2527	003462'	260040	001007'		PUSHJ	P,CLOSIN
  2528	003463'	260040	000661'		PUSHJ	P,CLRDDB
  2529	003464'	262052	000000*	LUDER0:	POP	P,%UPT+UPTJDA(W)	;THE PUSHED UPTJDA WORD
  2530	003465'	262040	000004		POP	P,F
  2531	003466'	200004	000002		MOVE	S,DEVIOS(F)		;RESTORE IOS
  2532	003467'	262040	000013		POP	P,M
  2533	003470'	324740	002025*		PJRST	TPOPJ
  2534
  2535	003471'	260040	003442*	LUDER1:	PUSHJ	P,UNLFIL	;
  2536	003472'	262040	000006		POP	P,T1
  2537	003473'	262040	000014		POP	P,P1
  2538	003474'	254000	003460'		JRST	LUDERR
  2539
  2540	003475'	262040	000004	LUDER2:	POP	P,F
  2541	003476'	262040	000013		POP	P,M
  2542	003477'	324740	003470*		PJRST	TPOPJ
  2543
  2544	003500'			X:	BLOCK	3
  2545	003503'			N:	BLOCK	2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 53
FILUUO.MAC	 8-DEC-87 11:25		LOKLUD - LOOKUP USER NAME IN LUD.SYS TO TRANSLATE USERNAME TO PPN

  2546				;ROUTINE TO CHARGE FOR 1 LOOKUP-ENTER
  2547
  2548				EXTERN GTCGSZ
  2549	003505'	135100	003256*	LKSET:	LDB	J,PJOBN
  2550	003506'	260040	000352*		PUSHJ	P,GTCGSZ	;GET CHARGING SIZE OF JOB.
  2551	003507'	350002	000000*		AOS	JBTDLK(J)
  2552	003510'	350000	003507*		AOS	JBTDLK		;ACCUMULATE TOTAL IN JOB 0
  2553	003511'	272302	000000*		ADDM	T1,JBTSLK(J)
  2554	003512'	272300	003511*		ADDM	T1,JBTSLK
  2555	003513'	263040	000000		POPJ	P,
  2556
  2557				;SIMILAR ROUTINE TO CHARGE FOR USETI'S, AND USETO'S
  2558
  2559	003514'	135100	003505*	ERNSET:	LDB	J,PJOBN
  2560	003515'	260040	003506*		PUSHJ	P,GTCGSZ
  2561	003516'	350002	000000*		AOS	JBTERN(J)
  2562	003517'	350000	003516*		AOS	JBTERN
  2563	003520'	272302	000000*		ADDM	T1,JBTSER(J)
  2564	003521'	272300	003520*		ADDM	T1,JBTSER
  2565	003522'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 54
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2566				SUBTTL	RENAME
  2567
  2568	003523'	702600	400000*	RENAM:	NOCHARGE
  2569	003524'	260040	002566*		PUSHJ	P,WAIT1	;WAIT FOR I/O TO STOP
  2570	003525'	260040	002007'		PUSHJ	P,TSTRES
  2571	003526'	603000	002273*		TLNE	S,IOSUPR
  2572	003527'	254000	005107'		  JRST	LUKER1
  2573	003530'	260040	003514'		PUSHJ	P,ERNSET		;CHARGE 1 RENAME
  2574	003531'	621000	003275*		TLZ	S,IOSRIB
  2575	003532'	260040	003040'		PUSHJ	P,CHKAG1		;CHECK ARGUMENTS
  2576	003533'	254000	005105'		  JRST	ILNMER			;BAD COUNT FOR EXTENDED
  2577	003534'	336004	000015		SKIPN	DEVFIL(F)		;IS THERE AN OPEN FILE?
  2578	003535'	254000	005114'		  JRST	RENER0			;NO. ERROR RETURN
  2579	003536'	603200	020000		TLNE	F,ENTRB			;IS IT OPEN FOR OUTPUT
  2580	003537'	603200	001000		  TLNE	F,OCLOSB
  2581	003540'	254000	003545'		 JRST	RECLSD			;NO
  2582	003541'	261040	000013		PUSH	P,M
  2583	003542'	541540	000002		HRRI	M,CLSIN			;CLOSE ONLY OUTPUT
  2584	003543'	260040	000000*		PUSHJ	P,CLOSE1		;YES, CLOSE IT
  2585	003544'	262040	000013		POP	P,M
  2586	003545'	621000	003531*	RECLSD:	TLZ	S,IOSRIB		;JUST TO MAKE SURE
  2587	003546'	550644	002603*		HRRZ	P2,DEVATB(F)		;LOC OF ACCES BLOCK
  2588	003547'	326640	003571'		JUMPN	P2,RENAM1		;DONT HAVE TO LOOKUP IF THERE
  2589	003550'	661540	400000		TLO	M,UUOLUK		;INDICATE LOOKUP FOR FNDFIL
  2590	003551'	260040	003103'		PUSHJ	P,GETNAM		;GET FILE NAME RENAMING TO
  2591	003552'	336000	000006		SKIPN	T1			;IF TRYING TO DELETE,
  2592					  TLO	M,UUOIRE		;THEN IGNORE RIB ERROR, USE INFO FROM UFD FOR ACCESS CH
  2593	003553'	661540	002000	ECKING.
  2594									; (SRCFIL WILL GIVE SKIP RETURN FOR RIB ERRORS TOO WHEN
  2595				 THIS IS ON.)
  2596	003554'	201300	000005		MOVEI	T1,DECSTP
  2597	003555'	137300	003024*		DPB	T1,DEYSTC
  2598	003556'	260040	003273*		PUSHJ	P,SRCFIL		;SET UP AN ACCESS BLOCK FOR IT
  2599	003557'	254000	005162'		  JRST	STRERR			;ERROR - RETURN
  2600	003560'	623000	003545*		TLZE	S,IOSRIB		;GIVE IT BACK IN CASE RETURNED WITH IT
  2601	003561'	260040	003276*		PUSHJ	P,RELLOK
  2602	003562'	621540	577777		TLZ	M,UUOMSK-EXTUUO		;RESET ALL BITS BUT EXTENDED UUO
  2603	003563'	260040	003566'		PUSHJ	P,RENAM0		;GO DO REST OF RENAME
  2604	003564'	324740	001007'		  PJRST	CLOSIN			;ERROR - FIX UP ACCESS TABLE
  2605									;(UUOCON WONT DO A CLOSE SINCE THE RENAME FAILED)
  2606	003565'	324740	003231*		PJRST	CPOPJ1			;GOOD RETURN
  2607	003566'	661200	040000	RENAM0:	TLO	F,LOOKB			;SET SO CLOSE INPUT WILL HAPPEN
  2608	003567'	621200	003000		TLZ	F,OCLOSB+ICLOSB
  2609	003570'	550644	003546*		HRRZ	P2,DEVATB(F)		;LOC OF A.T. INTO P2
  2610
  2611	003571'	260040	003446*	RENAM1:	PUSHJ	P,GETCBR		;%
  2612	003572'	200315	002605*		MOVE	T1,ATBRIB(P2)		;%
  2613	003573'	202304	002606*		MOVEM	T1,DEVRIB(F)		;%
  2614	003574'	200315	002643*		MOVE	T1,ATBSTS(P2)
  2615	003575'	602300	002612*		TRNE	T1,ATPNDL
  2616	003576'	254000	005121'		  JRST	UPDER2			;% CAN NOT BE DELETED
  2617	003577'	661540	010000		TLO	M,UUOREN	 	;% LIGHT UUOREN
  2618	003600'	260040	003103'		PUSHJ	P,GETNAM		;% GET FILE NAME
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 54-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2619	003601'	326300	003664'		JUMPN	T1,RENAM3		;% NON-ZERO, DO NOT DELETE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 55
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2620				;HERE WHEN RENAMING A FILE TO 0 (DELETING)
  2621	003602'	554744	002604*	RENAM2:	HLRZ	P4,DEVDRB(F)
  2622	003603'	201300	000000*		MOVEI	T1,FNCDEL
  2623	003604'	260040	003006*		PUSHJ	P,CHKPRV
  2624	003605'	254000	005121'		   JRST UPDER2			;% NO. ERROR RETURN
  2625	003606'	260040	002640*		PUSHJ	P,TSTWRT		;DO NOT ALLOW IF SOMEONE WRITING
  2626	003607'	254000	005123'		  JRST UPDER3			;% BEING UPDATED, ERROR
  2627	003610'	201300	000005		MOVEI	T1,DECSTP
  2628	003611'	137300	003555*		DPB	T1,DEYSTC
  2629	003612'	200315	003574*		MOVE	T1,ATBSTS(P2)
  2630	003613'	606300	002355*		TRNN	T1,ATPDIR		;% DIRECTORY IS SPECIAL
  2631	003614'	254000	003627'		  JRST	RENM2A
  2632	003615'	200304	000015		MOVE	T1,DEVFIL(F)
  2633	003616'	260040	001456*		PUSHJ	P,FNDDRB		;% FIND THIS DIRECTORY BLOCK
  2634	003617'	254000	003626'		  JRST RENM2B			;% NOT THERE
  2635	003620'	200307	002651*		MOVE	T1,DRBCNT(T2)
  2636	003621'	602300	000000*		TRNE	T1,DRMCNT		;% IS COUNT UP?
  2637	003622'	254000	005123'		  JRST	UPDER3			;% YES, CAN NOT DELETE
  2638	003623'	402007	002252*		SETZM	DRBRIB(T2)
  2639	003624'	201300	001461*		MOVEI	T1,DRPNX
  2640	003625'	436307	001462*		IORM	T1,DRBNX(T2)		;% AND FLAG NOT THERE
  2641	003626'	200315	003612*	RENM2B:	MOVE	T1,ATBSTS(P2)
  2642	003627'	621200	040000	RENM2A:	TLZ	F,LOOKB			;% ZERO LOOKB SO A FOLLOWING ENTER WILL SUCCEED
  2643	003630'	502212	000000*		HLLM	F,%UPT+UPTJDA(W)	;% UUOCON WONT SAVE LH(F)
  2644	003631'	602300	002630*		TRNE	T1,ATPDEL		;% IF ALREADY MARKED FOR DELETE,
  2645	003632'	254000	003652'		  JRST	RENM2C			;% GO DO INPUT CLOSE, ETC.
  2646	003633'	660300	001512*		TRO	T1,ATPUPD		;%SET UPD SO NO ONE ELSE CAN MODIFY, JUST READ
  2647	003634'	202315	003626*		MOVEM	T1,ATBSTS(P2)
  2648	003635'	550715	003027*		HRRZ	P3,ATBFNB(P2)		;% GET FNB ADDRESS FOR DLTNAM
  2649	003636'	260040	003457*		PUSHJ	P,GIVCBR
  2650					PUSHJ	P,SETACH		;SET CHANGED BIT IN CASE UFD PAGE DOESN'T MAKE IT OUT B
  2651	003637'	260040	001663'	EFORE SYSTEM CRASH
  2652	003640'	260040	000000*		PUSHJ	P,DLTNAM		;REMOVE NAME FROM UFD
  2653	003641'	513000	000013		HLLZS	M			;NO ONE ELSE CAN MAKE NEW UFD ENTRY SINCE ATPUPD IS ON
  2654	003642'	260040	001775*		PUSHJ	P,SIMRLS		;EXPECTS F,S,W; CLEAN UP SIMIO DATABASE
  2655									;MAY SET IODTER IF VREMOV FAILURE,OUTPUT
  2656	003643'	260040	003571*		PUSHJ	P,GETCBR		;%
  2657	003644'	205300	001477*		MOVSI	T1,FNPNX		;%
  2658	003645'	436316	001500*		IORM	T1,FNBNX(P3)		;% TELL WORLD IT DOESN'T EXIST NOW.
  2659	003646'	402016	001765*		SETZM	FNBRIB(P3)		;% CLEAR SO HAS TO SCAN UFD AGAIN.
  2660	003647'	201300	000000*		MOVEI	T1,ATPDEL!ATPUPD
  2661									;% (DEL CAN'T GO ON SINCE UPD IS ON.)
  2662	003650'	433315	003634*		XORB	T1,ATBSTS(P2)		;% TURN ON DEL, TURN OFF UPD
  2663	003651'	254000	003655'		JRST	RENM2D
  2664	003652'	260040	003636*	RENM2C:	PUSHJ	P,GIVCBR
  2665	003653'	260040	003642*		PUSHJ	P,SIMRLS		;CLEAN UP SIMIO DATABASE
  2666	003654'	260040	003643*		PUSHJ	P,GETCBR
  2667	003655'	350001	000000	RENM2D:	AOS	(P)			;% GIVE SKIP RETURN TO THE RENAME UUO
  2668	003656'	607000	000000*		TLNN	S,IOSRBE		;% IF RIB ERROR, BETTER CHECK FOR OTHER USER
  2669	003657'	324740	001030'		  PJRST	CLOSRN			;% JUMP INTO THE CLOSE CODE TO FINISH UP
  2670									;% ASSUME IF THERE IS A RIB ERROR THAT CLOSE WILL IGNOR
  2671				E IT - WHICH RESULTS IN LOST PAGES.
  2672	003660'	602300	777777*		TRNE	T1,ATMCNT-1		;% IF LAST READER, NO NEW ONES CAN COME,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 55-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2673	003661'	254000	001141'		  JRST	CLSIN3			;% WE KNOW ATPDEL SET AND OTHER USERS, SO
  2674									;% GO DO NORMAL CLOSE, LAST USER WILL DELETE THE FILE I
  2675				N INPUT CLOSE
  2676									;% (ATBRIB HAS TO BE NON-ZERO IF OTHER USER?
  2677	003662'	260040	003652*		PUSHJ	P,GIVCBR 		;% SO GIVE BACK CB AND
  2678	003663'	254000	001053'		JRST	CLIBDR			;GET RID OF ATB IF NO MAPPERS.
  2679									; NOTE THAT WE SKIP AROUND TRYING TO GET RIB IN CLOSE.
  2680									; NOTE THAT ATBRIB CAN BE ZERO IN RIB ERROR CASE!
  2681									; CODE THAT WE CALL HERE IN CLOSE HAD BETTER
  2682									; NOT CALL ANYTHING THAT NEEDS ATBRIB.
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 56
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2683				;HERE TO RENAME A FILE TO SOMETHING (NOT DELETE)
  2684	003664'	200415	003650*	RENAM3:	MOVE	T3,ATBSTS(P2)
  2685	003665'	606400	003631*		TRNN	T3,ATPDEL		;% MUST NOT BE MARKED FOR DEL
  2686	003666'	260040	003606*		PUSHJ	P,TSTWRT
  2687	003667'	254000	005123'		  JRST	UPDER3			;% BEING WRITTEN
  2688	003670'	201300	000005		MOVEI	T1,DECSTP
  2689	003671'	137300	003611*		DPB	T1,DEYSTC
  2690	003672'	201300	001133*		MOVEI	T1,ATPREN
  2691	003673'	436315	003664*		IORM	T1,ATBSTS(P2)		;% SET RENAME
  2692	003674'	554744	003602*		HLRZ	P4,DEVDRB(F)
  2693	003675'	350357	003620*		AOS	T2,DRBCNT(P4)		;% ONE EXTR COUNT
  2694	003676'	602340	002652*		TRNE	T2,DRPMXC
  2695	003677'	256000	000000'		 STOPCD (SLO)
  2696							;;RENAM3+13
  2697	003700'	260040	003113'		PUSHJ	P,GETPPN
  2698	003701'	312304	000017		CAME	T1,DEVPPN(F)		;% YES. CHANGING PPN?
  2699	003702'	254000	003714'		  JRST	RENM4B			;% YES.
  2700	003703'	260040	003103'		PUSHJ	P,GETNAM
  2701	003704'	312304	000015		CAME	T1,DEVFIL(F)		;% RENAMING TO SAME NAME?
  2702	003705'	254000	003713'		  JRST	RENAM4			;% NO
  2703	003706'	260040	003107'		PUSHJ	P,GETEXT
  2704	003707'	513000	000006		HLLZS	T1
  2705	003710'	510344	000016		HLLZ	T2,DEVEXT(F)		;% OLD EXTENSION
  2706	003711'	316300	000007		CAMN	T1,T2			;% SAME?
  2707	003712'	254000	004141'		  JRST	RENAM6			;% YES
  2708
  2709	003713'	334300	006240'	RENAM4:	SKIPA	T1,[FNCCNM]
  2710	003714'	201300	003603*	RENM4B:	MOVEI	T1,FNCDEL		;% CHANGING DIRECTORIES
  2711	003715'	260040	003604*		PUSHJ	P,CHKPRV		;%
  2712	003716'	254000	005175'		  JRST	RENER7			;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 57
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2713				;% HERE WHEN RENAME HAS BEEN CHECKED (IF CHANGING DIRECTORIES)
  2714	003717'	260040	003117'	RENM4A:	PUSHJ	P,SETFIL		;% SET NAME INTO DEVFIL ETC
  2715	003720'	256000	000000'		 STOPCD (SLO)
  2716							;;RENM4A+1  ;% ALREADY KNOW NAME NON-ZERO
  2717	003721'	260040	003662*		PUSHJ	P,GIVCBR		;%
  2718	003722'	260040	003556*		PUSHJ	P,SRCFIL		;CHECK THAT NEW FILE NAME DOESN'T EXIST
  2719	003723'	254000	005167'		  JRST	RENER9			;NEW FILE NAME ALREADY EXISTS
  2720	003724'	661540	040000		TLO	M,UUOENT		;FLAG THIS SO WE KNOW NAME CHANGE
  2721	003725'	554304	003674*		HLRZ	T1,DEVDRB(F)
  2722	003726'	312300	000017		CAME	T1,P4
  2723	003727'	621540	010000		  TLZ	M,UUOREN		;REN ON IF NO DIR CHANGE
  2724	003730'	260040	004131'		PUSHJ	P,RENNMR
  2725	003731'	550304	003570*		HRRZ	T1,DEVATB(F)		;NEW ATB
  2726	003732'	542644	003731*		HRRM	P2,DEVATB(F)		;PUT BACK OLD
  2727	003733'	500304	003725*		HLL	T1,DEVDRB(F)
  2728	003734'	506744	003733*		HRLM	P4,DEVDRB(F)
  2729	003735'	202315	001413*		MOVEM	T1,ATBDOR(P2)		;CROSS LINK THROUGH ATBDOR
  2730	003736'	542646	003735*		HRRM	P2,ATBDOR(T1)
  2731	003737'	506746	003736*		HRLM	P4,ATBDOR(T1)
  2732	003740'	260040	003003*		PUSHJ	P,RIBWTL
  2733	003741'	254000	005211'		 JRST	RENRR2			;ERROR READING RIB
  2734	003742'	603540	010000		TLNE	M,UUOREN
  2735	003743'	254000	003776'		  JRST	RENAM7			;NOT CHANGING DIRECTORY
  2736	003744'	554755	003737*		HLRZ	P4,ATBDOR(P2)
  2737	003745'	550655	003744*		HRRZ	P2,ATBDOR(P2)
  2738	003746'	260040	004131'		PUSHJ	P,RENNMR
  2739	003747'	201300	002315*		MOVEI	T1,FNCCRE
  2740	003750'	260040	003715*		PUSHJ	P,CHKPRV		;CAN WE CREATE IN NEW DIRECTORY?
  2741	003751'	254000	005231'		  JRST	RENRR1			;NO
  2742	003752'	550644	003732*		HRRZ	P2,DEVATB(F)
  2743	003753'	554744	003734*		HLRZ	P4,DEVDRB(F)
  2744	003754'	260040	004131'		PUSHJ	P,RENNMR
  2745	003755'	554315	003745*		HLRZ	T1,ATBDOR(P2)
  2746	003756'	210355	002333*		MOVN	T2,ATBALP(P2)		;FILE SIZE
  2747	003757'	270346	002323*		ADD	T2,DRBALC(T1)
  2748				PRINTF(<[RENM4A++ STROVR check for room in dir, must check file STR+STROVR]>)
  2749	003760'	315340	000000*		CAMGE	T2,STRDDB+STROVR
  2750	003761'	254000	005235'		  JRST	RENRR0			;NO ROOM IN NEW DIRECTORY
  2751	003762'	202346	003757*		MOVEM	T2,DRBALC(T1)
  2752	003763'	315346	002255*		CAMGE	T2,DRBMXA(T1)
  2753	003764'	202346	003763*		  MOVEM	T2,DRBMXA(T1)
  2754	003765'	200315	003756*		MOVE	T1,ATBALP(P2)
  2755	003766'	270317	003762*		ADD	T1,DRBALC(P4)
  2756	003767'	331017	003766*		SKIPL	DRBALC(P4)		;DO NOT LET IT OVERFLOW
  2757	003770'	331000	000006		  SKIPL	T1
  2758	003771'	202317	003767*		 MOVEM	T1,DRBALC(P4)
  2759	003772'	260040	002545'		PUSHJ	P,SAVLIC
  2760	003773'	542315	002660*		HRRM	T1,ATBLIC(P2)
  2761	003774'	525300	000000*		HRLOI	T1,ATMUFP!ATMCSC	;SAVE UNPROTECTED PART OF UFD BITS
  2762	003775'	406315	003013*		ANDM	T1,ATBLCW(P2)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 58
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2763				;NOW INTERCHANGE THE ATB ETC
  2764	003776'	260040	003654*	RENAM7:	PUSHJ	P,GETCBR		;%
  2765	003777'	135300	000000*		LDB	T1,ATYCNT		;% GET COUNT IN OLD ATB
  2766	004000'	205340	001264*		MOVSI	T2,ATMUMC		;% IF UMC IS NON-ZERO, THEN DRBCNT
  2767	004001'	612355	000000*		TDNE	T2,ATBUMC(P2)		;% WAS INCREMENTED ONCE FOR IT
  2768					  ADDI	T1,1			;% SO CAUSE DRBCNT TO GET INCREMENTED AND DECREMENTED C
  2769	004002'	271300	000001	ORRECTLY
  2770	004003'	554355	003755*		HLRZ	T2,ATBDOR(P2)		;% NEW DRB
  2771	004004'	200400	000006		MOVE	T3,T1
  2772	004005'	273407	003675*		ADDB	T3,DRBCNT(T2)
  2773	004006'	602400	003676*		TRNE	T3,DRPMXC
  2774	004007'	256000	000000'		 STOPCD (SLO)
  2775							;;RENAM7+11
  2776	004010'	213000	000006		MOVNS	T1
  2777	004011'	273317	004005*		ADDB	T1,DRBCNT(P4)		;% DECREMENT OLDCOUNT
  2778	004012'	602300	004006*		TRNE	T1,DRPMXC
  2779	004013'	256000	000000'		 STOPCD (SLO)
  2780							;;RENAM7+15
  2781	004014'	550455	004003*		HRRZ	T4,ATBDOR(P2)
  2782	004015'	500315	001421*		HLL	T1,ATBLNK(P2)		;% OLD LINK
  2783	004016'	500351	004015*		HLL	T2,ATBLNK(T4)		;% NEW LINK
  2784	004017'	502311	004016*		HLLM	T1,ATBLNK(T4)
  2785	004020'	502355	004017*		HLLM	T2,ATBLNK(P2)		;% INTERCHANGE
  2786	004021'	550311	003635*		HRRZ	T1,ATBFNB(T4)		;% GET OLD FNB ADDRESS
  2787	004022'	200306	001770*		MOVE	T1,FNBALT(T1)		;% GET OLD ALT
  2788	004023'	202316	004022*		MOVEM	T1,FNBALT(P3)		;% AND PUT IT INTO NEW FNB
  2789	004024'	120315	002762*		DMOVE	T1,ATBSIZ(P2)
  2790	004025'	124311	004024*		DMOVEM	T1,ATBSIZ(T4)		;% MOVE SOME INFORMATION
  2791	004026'	200315	003765*		MOVE	T1,ATBALP(P2)
  2792	004027'	202311	004026*		MOVEM	T1,ATBALP(T4)
  2793	004030'	200315	003775*		MOVE	T1,ATBLCW(P2)
  2794	004031'	202311	004030*		MOVEM	T1,ATBLCW(T4)
  2795	004032'	500315	002747*		HLL	T1,ATBMSC(P2)
  2796	004033'	502311	004032*		HLLM	T1,ATBMSC(T4)
  2797	004034'	201316	000000*		MOVEI	T1,FNBATB-ATBLNK(P3)
  2798	004035'	554346	004020*	RNM7A:	HLRZ	T2,ATBLNK(T1)
  2799	004036'	336000	000007		SKIPN	T2
  2800	004037'	256000	000000'		 STOPCD (SLO)
  2801							;;RNM7A+2
  2802	004040'	302355	000000		CAIE	T2,(P2)			;% FOUND POINTER TO CURRENT?
  2803	004041'	254000	004035'		  JRST	RNM7A
  2804	004042'	506446	004035*		HRLM	T4,ATBLNK(T1)		;% POINT TO NEW
  2805	004043'	550311	004021*		HRRZ	T1,ATBFNB(T4)
  2806	004044'	542315	004043*		HRRM	T1,ATBFNB(P2)		;% REPLACE BACK POINTER WHILE WE HAVE IT
  2807	004045'	201306	000000*		MOVEI	T1,FNBATB-ATBLNK(T1)
  2808	004046'	554346	004042*	RNM7B:	HLRZ	T2,ATBLNK(T1)
  2809	004047'	336000	000007		SKIPN	T2
  2810	004050'	256000	000000'		 STOPCD (SLO)
  2811							;;RNM7B+2
  2812	004051'	302351	000000		CAIE	T2,(T4)
  2813	004052'	254000	004046'		  JRST	RNM7B
  2814	004053'	506646	004046*		HRLM	P2,ATBLNK(T1)
  2815	004054'	542711	004044*		HRRM	P3,ATBFNB(T4)		;% AND OTHER BACK POINTER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 58-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2816	004055'	504440	000017		HRL	T4,P4
  2817	004056'	554755	004014*		HLRZ	P4,ATBDOR(P2)
  2818	004057'	502455	004056*		HLLM	T4,ATBDOR(P2)		;% NOW NEED TO RESET ATBDOR LINKS
  2819	004060'	506751	004057*		HRLM	P4,ATBDOR(T4)		;% ALSO
  2820	004061'	542644	003752*		HRRM	P2,DEVATB(F)
  2821	004062'	506744	004061*		HRLM	P4,DEVATB(F)		;% NOW HAVE THE NEW ONE
  2822	004063'	550715	004054*		HRRZ	P3,ATBFNB(P2)
  2823	004064'	200316	000000*		MOVE	T1,FNBNAM(P3)
  2824	004065'	202304	000015		MOVEM	T1,DEVFIL(F)
  2825	004066'	202300	376000*		MOVEM	T1,%RIB+RIBNAM
  2826	004067'	200316	000000*		MOVE	T1,FNBEXT(P3)
  2827	004070'	506304	000016		HRLM	T1,DEVEXT(F)
  2828	004071'	506300	376000*		HRLM	T1,%RIB+RIBEXT
  2829	004072'	200317	003226*		MOVE	T1,DRBNAM(P4)		;% RESET ALL NAMES
  2830	004073'	202304	000017		MOVEM	T1,DEVPPN(F)
  2831	004074'	202300	376000*		MOVEM	T1,%RIB+RIBPPN
  2832	004075'	550415	004060*		HRRZ	T3,ATBDOR(P2)		;% GET OLD FNB
  2833	004076'	550410	004063*		HRRZ	T3,ATBFNB(T3)
  2834	004077'	201310	000000*		MOVEI	T1,FNBDBL-DEVDBL(T3)	;% GET SET TO RELINK DDBS
  2835	004100'	550410	000000*		HRRZ	T3,FNBDBL(T3)
  2836	004101'	550350	004062*	DBRLP:	HRRZ	T2,DEVATB(T3)
  2837	004102'	302355	000000		CAIE	T2,(P2)			;% IF IT POINTS TO THIS ACCESS TABLE
  2838	004103'	254000	004121'		  JRST	DBRNXT			;% (IF NOT IGNORE IT)
  2839	004104'	550350	000000*		HRRZ	T2,DEVDBL(T3)		;% THEN LINK AROUND
  2840	004105'	542346	004104*		HRRM	T2,DEVDBL(T1)
  2841	004106'	550356	004100*		HRRZ	T2,FNBDBL(P3)
  2842	004107'	542350	004105*		HRRM	T2,DEVDBL(T3)		;% AND LINKK INTO NEW
  2843	004110'	542416	004106*		HRRM	T3,FNBDBL(P3)
  2844	004111'	261040	000006		PUSH	P,T1			;% SAVE BACK POINTER
  2845	004112'	120304	000015		DMOVE	T1,DEVFIL(F)
  2846	004113'	202310	000015		MOVEM	T1,DEVFIL(T3)
  2847	004114'	502350	000016		HLLM	T2,DEVEXT(T3)
  2848	004115'	200304	000017		MOVE	T1,DEVPPN(F)
  2849	004116'	202310	000017		MOVEM	T1,DEVPPN(T3)		;% RESET NAME
  2850	004117'	506750	003753*		HRLM	P4,DEVDRB(T3)
  2851	004120'	262040	000010		POP	P,T3			;% USE OLD BACK POINTER TO COUNTINUE
  2852	004121'	200300	000010	DBRNXT:	MOVE	T1,T3			;% REMEMBER BACK POINTER
  2853	004122'	550410	004107*		HRRZ	T3,DEVDBL(T3)
  2854	004123'	326400	004101'		JUMPN	T3,DBRLP
  2855	004124'	260040	003721*		PUSHJ	P,GIVCBR		;% FINISHED RESETTING
  2856	004125'	254000	004147'		JRST	RENAM8
  2857
  2858	004126'	200655	004075*	RENNXR:	MOVE	P2,ATBDOR(P2)
  2859	004127'	202644	004101*		MOVEM	P2,DEVATB(F)
  2860	004130'	554740	000015		HLRZ	P4,P2			;% RESET ATB, DRB POINTERS ALSO
  2861
  2862	004131'	550715	004076*	RENNMR:	HRRZ	P3,ATBFNB(P2)
  2863	004132'	200316	004064*		MOVE	T1,FNBNAM(P3)
  2864	004133'	202304	000015		MOVEM	T1,DEVFIL(F)		;% PUT BACK OLD NAME BEFORE READING RIB
  2865	004134'	550316	004067*		HRRZ	T1,FNBEXT(P3)
  2866	004135'	506304	000016		HRLM	T1,DEVEXT(F)
  2867	004136'	200317	004072*		MOVE	T1,DRBNAM(P4)
  2868	004137'	202304	000017		MOVEM	T1,DEVPPN(F)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 58-3
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2869	004140'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 59
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2870
  2871	004141'	260040	004124*	RENAM6:	PUSHJ	P,GIVCBR		;%
  2872	004142'	201300	000000*		MOVEI	T1,FNCCPR		;CAN HE MODIFY FILE
  2873	004143'	260040	003750*		PUSHJ	P,CHKPRV
  2874	004144'	254000	005176'		  JRST	RENRR3
  2875	004145'	260040	003740*		PUSHJ	P,RIBWTL
  2876	004146'	254000	005207'		  JRST	RENRR4
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 60
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2877				;HERE WITH THE RIB IN THE MON BUF, M POINTING TO PPN WORD
  2878	004147'			RENAM8:	;;TLZ S,IOSRIB		;MAKE SURE WE DON'T CONFUCE DIR ROUTINES
  2879					;;This was moved to RENSTS+1 so DLTTRC can't botch it up/WRS
  2880	004147'	205300	000000*		MOVSI	T1,ATPPID!ATPDMP	;CLEAR BIT THAT SAYS THERE
  2881									; IS A PID AND FILE DUMPED BIT
  2882	004150'	412315	004031*		ANDCAM	T1,ATBLCW(P2)		;GETS STORED INTO RIB AT RENDEA
  2883	004151'	402015	003010*		SETZM	ATBPID(P2)		;ZERO PID IN ATB AND
  2884	004152'	402000	376000*		SETZM	%RIB+RIBPID		; RIB.
  2885	004153'	607540	200000		TLNN	M,EXTUUO		;EXTENDED M?
  2886	004154'	254000	004160'		  JRST	RENM8A			;NO. POINT TO ATT WORD
  2887	004155'	305600	000004		CAIGE	P1,UUXPRV		;SPECIFYING ATTRIBUTES?
  2888	004156'	254000	004252'		  JRST	RENDEA			;NO
  2889	004157'	256200	006241'		XCTFU	<SKIPA P3,UUXPRV(M)>
  2890	004160'	256200	006242'	RENM8A:	  UMOVE	P3,UUNATT(M)		;GET ATTRIBUTES WORD
  2891	004161'	322700	004232'		JUMPE	P3,RENAM9		;NO CHANGE
  2892	004162'	200340	000016		MOVE	T2,P3
  2893	004163'	430355	002745*		XOR	T2,ATBPVW(P2)		;COMPARE WITH RIB ATTR. WORD
  2894	004164'	260040	003107'		PUSHJ	P,GETEXT		;GET EXTENSION WORD
  2895	004165'	554415	004033*		HLRZ	T3,ATBMSC(P2)
  2896	004166'	430300	000010		XOR	T1,T3
  2897	004167'	606300	140000		TRNN	T1,140000		;SEE IF EXTENDED DATE CHANGING
  2898	004170'	322340	004232'		  JUMPE	T2,RENAM9		;SAME IF 0
  2899	004171'	525400	000037		HRLOI	T3,37			;SET UP MASK FOR PRIVS, MODE
  2900	004172'	406415	004163*		ANDM	T3,ATBPVW(P2)		;TAKE PRIVS, MODE OUT OF RIB
  2901	004173'	410400	000016		ANDCA	T3,P3			;GET PRIVS FROM USER
  2902	004174'	436415	004172*		IORM	T3,ATBPVW(P2)		;AND SET THEM IN RIB WORD
  2903	004175'	201300	003613*		MOVEI	T1,ATPDIR
  2904	004176'	612315	003673*		TDNE	T1,ATBSTS(P2)
  2905	004177'	607340	777000		  TLNN	T2,777000
  2906	004200'	254000	004212'		 JRST	RENM9B			;ARE WE CHANGING PROT OF A UFD?
  2907	004201'	260040	003776*		PUSHJ	P,GETCBR		;% YES!
  2908	004202'	200304	000015		MOVE	T1,DEVFIL(F)		;%
  2909	004203'	260040	003616*		PUSHJ	P,FNDDRB		;% SEE IF A DRB BLOCK FOR IT
  2910	004204'	254000	004211'		  JRST	RENM9A			;%
  2911	004205'	135300	001634*		LDB	T1,ATYPRV		;%
  2912	004206'	250740	000007		EXCH	P4,T2			;%
  2913	004207'	137300	000000*		DPB	T1,DRYPRV		;%
  2914	004210'	200740	000007		MOVE	P4,T2			;%
  2915	004211'	260040	004141*	RENM9A:	PUSHJ	P,GIVCBR		;% AND RETURN CB RESOURCE
  2916	004212'	260040	003107'	RENM9B:	PUSHJ	P,GETEXT
  2917	004213'	606300	140000		TRNN	T1,140000		;IS ANYTHING BUT PROTECTION
  2918	004214'	612700	006144'		  TDNE	P3,[37,,-1]		;NON-ZERO
  2919	004215'	334000	000000		 SKIPA				;YES
  2920	004216'	254000	004224'		  JRST	RENM9C			;NO, DO NOT CHANGE IT
  2921	004217'	242300	777762		LSH	T1,-^D14
  2922	004220'	137300	002736*		DPB	T1,ATYXCD
  2923	004221'	137700	000000*		DPB	P3,ATYCTD
  2924	004222'	200315	004165*		MOVE	T1,ATBMSC(P2)
  2925	004223'	546300	376000*		HLRM	T1,%RIB+RIBEXT		;NOW UPDATE RIB
  2926	004224'	200315	004174*	RENM9C:	MOVE	T1,ATBPVW(P2)
  2927	004225'	202300	376000*		MOVEM	T1,%RIB+RIBPVW
  2928	004226'	607540	200000		TLNN	M,EXTUUO
  2929					  JRST	[UMOVEM T1,UUNATT(M)	;GIVE IT TO USER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 60-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2930	004227'	254000	006243'			 JRST   RENDEA]
  2931	004230'	301600	000004		CAIL	P1,UUXPRV
  2932	004231'	256200	006076'		 UMOVEM	T1,UUXPRV(M)	;USER WANTS IT
  2933	004232'	607540	200000	RENAM9:	TLNN	M,EXTUUO	;
  2934	004233'	254000	004252'		  JRST	RENDEA		;
  2935	004234'	305600	000011		CAIGE	P1,UUXALC	;
  2936	004235'	254000	004251'		  JRST	RENRIB		;NOT CHANGING ALLOC.
  2937	004236'	260040	002752'		PUSHJ	P,ALCCHK	;CHANGING ALLOCATION?
  2938	004237'	254000	004251'		  JRST	RENRIB		;NO.
  2939	004240'	260040	003000*		PUSHJ	P,DLTTRC	;AND REMOVE PAGES
  2940	004241'	254000	004243'		  JRST	.+2		;ERR ON TRUNC, BAD FILE NOW.
  2941	004242'	254000	004245'		 JRST	RENM9D		;SUCCESS.
  2942	004243'	260040	004145*		PUSHJ	P,RIBWTL	;MOST UNGRACEFUL ERROR HANDLING.
  2943	004244'	256000	000000'		 STOPCD (SLO)
  2944				           ;;RENAM9+12
  2945	004245'	550315	004131*	RENM9D:	HRRZ	T1,ATBFNB(P2)	;GET FNB ADDRESS
  2946	004246'	200340	001766*		MOVE	T2,PCDTIM	;GET CURRENT PCB TIMER
  2947	004247'	202346	004023*		MOVEM	T2,FNBALT(T1)	;SET IN FNB AND
  2948	004250'	202340	376000*		MOVEM	T2,%RIB+RIBALT	;RIB.
  2949
  2950				;FALL INTO RENRIB
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 61
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  2951	004251'	260040	004424'	RENRIB:	PUSHJ	P,SETVAL		;STORE ARGUMENTS FROM USER IN RIB
  2952
  2953	004252'	200315	004150*	RENDEA:	MOVE	T1,ATBLCW(P2)
  2954	004253'	200340	376000*		MOVE	T2,%RIB+RIBSTS
  2955	004254'	606340	000000*		TRNN	T2,RIPHWE!RIPHRE!RIPBDA!RIPBFS!RIPBDR
  2956	004255'	625300	001337*		  TLZA	T1,ATPUFE
  2957	004256'	661300	004255*		 TLO	T1,ATPUFE		;KEEP ERROR BIT CORRECT
  2958	004257'	202315	004252*		MOVEM	T1,ATBLCW(P2)
  2959	004260'	202300	376000*		MOVEM	T1,%RIB+RIBLCW
  2960	004261'	135300	003514*		LDB	T1,PJOBN
  2961	004262'	500306	002546*		HLL	T1,JBTLIC(T1)		; KEEP JOB# IN RH FOR LATER
  2962	004263'	603300	000002		TLNE	T1,LICWFL		; LET USER SET RIPSPP IF HAS WF
  2963	004264'	254000	004271'		 JRST	RENSTS
  2964	004265'	200306	003211*		MOVE	T1,JBTPPN(T1)
  2965	004266'	312304	000017		CAME	T1,DEVPPN(F)		;IS IT THE SAME
  2966	004267'	624340	002347*		  TRZA	T2,RIPSPP		;NO RESET
  2967	004270'	660340	004267*		 TRO	T2,RIPSPP		;OR SET
  2968	004271'	202340	376000*	RENSTS:	MOVEM	T2,%RIB+RIBSTS
  2969	004272'	260040	003561*		PUSHJ	P,RELLOK		;ALL DONE
  2970	004273'	621000	003560*		TLZ	S,IOSRIB		;DIR### routines die if they think its there
  2971	004274'	603540	040000		TLNE	M,UUOENT		;IS THERE A NAME CHANGE?
  2972	004275'	254000	004323'		  JRST	RENNMC			;YES, DO IT
  2973	004276'	260040	001732*		PUSHJ	P,RIBDIR
  2974	004277'	254000	004311'		  JRST	RENR7A			;CAN NOT GET IT
  2975	004300'	550715	004245*		HRRZ	P3,ATBFNB(P2)
  2976	004301'	135300	001736*		LDB	T1,FNYUFP
  2977	004302'	661000	000020		TLO	S,IO			;WANT UFD PAGE WRITEABLE.
  2978	004303'	260040	001741*		PUSHJ	P,DIRBLK
  2979	004304'	254000	004312'		  JRST	RENRR7			;CAN NOT GET IT
  2980	004305'	260040	001743*		PUSHJ	P,DIRSRC
  2981	004306'	334000	000000		  SKIPA				;FOUND IT
  2982	004307'	256000	001745'		 STOPCD (,XCT,UFDER1)
  2983						;UFD error return from DIRSRC ;;RENSTS+16
  2984	004310'	260040	001545'		PUSHJ	P,CREUFD		;UPDATE UFD WITH NEW VALUES
  2985	004311'	260040	004272*	RENR7A:	PUSHJ	P,RELLOK		;DONE WITH UFD BLOCK
  2986	004312'	201300	003672*	RENRR7:	MOVEI	T1,ATPREN
  2987	004313'	412315	004176*		ANDCAM	T1,ATBSTS(P2)		;RESET FLAG
  2988	004314'	370317	004011*	RENECM:	SOS	T1,DRBCNT(P4)
  2989	004315'	602300	004012*		TRNE	T1,DRPMXC
  2990	004316'	256000	000000'		 STOPCD (SLO)
  2991							;;RENECM+2
  2992	004317'	350001	000000		AOS	(P)
  2993	004320'	260040	001703*		PUSHJ	P,WATPCB		;WAIT FOR THE RIB PCBS TO BE VAIDATED.
  2994	004321'	201540	000010		MOVEI	M,CLSACC		;NO ACCESS DATE UPDATE ON FORCED CLOSE
  2995	004322'	324740	003543*		PJRST	CLOSE1			;FINISH UP
  2996
  2997	004323'	607540	010000	RENNMC:	TLNN	M,UUOREN		;NAME CHANGE, DIRECTORY ALSO?
  2998	004324'	254000	004361'		  JRST	RENDCR			;YES, MUST DELETE OLD AND CREATE NEW
  2999	004325'	550315	004126*		HRRZ	T1,ATBDOR(P2)
  3000	004326'	550306	004300*		HRRZ	T1,ATBFNB(T1)
  3001	004327'	200306	004132*		MOVE	T1,FNBNAM(T1)		;GET OLD NAME
  3002	004330'	621300	400000		TLZ	T1,(1B0)
  3003	004331'	200344	000015		MOVE	T2,DEVFIL(F)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 61-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3004	004332'	621340	400000		TLZ	T2,(1B0)
  3005	004333'	274300	000007		SUB	T1,T2
  3006	004334'	550340	000000*		HRRZ	T2,STRDDB+STRHSH
  3007	004335'	231307	000000		IDIVI	T1,(T2)
  3008	004336'	326340	004361'		JUMPN	T2,RENDCR		;DIFFERENT NAME FORCES DELETE AND CREATE
  3009	004337'	260040	004126'		PUSHJ	P,RENNXR		;GET READY TO FIND OLD NAME
  3010	004340'	550715	004326*		HRRZ	P3,ATBFNB(P2)
  3011	004341'	260040	004276*		PUSHJ	P,RIBDIR
  3012					 JRST	[PUSHJ	P,RELLOK
  3013	004342'	254000	006245'			 JRST	RENZAP]		;CAN NOT READ UFD
  3014	004343'	135300	004301*		LDB	T1,FNYUFP
  3015	004344'	260040	004303*		PUSHJ	P,DIRBLK
  3016	004345'	254000	004365'		  JRST	RENZAP
  3017	004346'	260040	004305*		PUSHJ	P,DIRSRC		;SEARCH THIS PAGE.
  3018	004347'	334000	000000		  SKIPA	
  3019	004350'	256000	001745'		 STOPCD (,XCT,UFDER1)
  3020						;UFD error return from DIRSRC ;;RENNMC+24
  3021	004351'	261040	000007		PUSH	P,T2			;SAVE LOCATION
  3022	004352'	135300	004343*		LDB	T1,FNYUFP		;SAVE THIS
  3023	004353'	261040	000006		PUSH	P,T1			;FOR OTHER ENTRY.
  3024	004354'	260040	004126'		PUSHJ	P,RENNXR		;GET NEW NAME BACK
  3025	004355'	262040	000007		POP	P,T2			;GET OLD FNYUFP BACK.
  3026	004356'	137340	004352*		DPB	T2,FNYUFP
  3027	004357'	262040	000007		POP	P,T2
  3028	004360'	254000	004373'		JRST	RENFL1			;AND DO IT LIKE CREATE
  3029
  3030	004361'	260040	004126'	RENDCR:	PUSHJ	P,RENNXR		;GET SET TO DELETE OLD NAME
  3031	004362'	260040	003640*		PUSHJ	P,DLTNAM
  3032	004363'	607540	010000		TLNN	M,UUOREN		;CHANGE OF DIR OR JUST NAME
  3033	004364'	260040	001527'		  PUSHJ	P,LOGTST		;DIR, REWRITE IF NEEDED
  3034	004365'	260040	004126'	RENZAP:	PUSHJ	P,RENNXR		;NOW TRY TO CREATE NEW
  3035	004366'	607540	010000		TLNN	M,UUOREN
  3036	004367'	260040	001527'		  PUSHJ	P,LOGTST
  3037	004370'	400340	000000		SETZ	T2,			;FLAG NO RET PNTR FOR INSNAM.
  3038	004371'	260040	001445*		PUSHJ	P,INSNAM
  3039	004372'	254000	004375'		  JRST	RENFL2			;COULD NOT(ALLOC FAIL/RIB ERR/DIR FULL).
  3040	004373'	260040	001545'	RENFL1:	PUSHJ	P,CREUFD		;STORE INFORMATION
  3041	004374'	260040	004311*		PUSHJ	P,RELLOK
  3042	004375'	550715	004340*	RENFL2:	HRRZ	P3,ATBFNB(P2)
  3043	004376'	260040	004201*		PUSHJ	P,GETCBR		;%
  3044	004377'	205300	003644*		MOVSI	T1,FNPNX		;%
  3045	004400'	412316	003645*		ANDCAM	T1,FNBNX(P3)		;% RESET FOR NEW NAME
  3046	004401'	200315	003572*		MOVE	T1,ATBRIB(P2)		;%
  3047	004402'	202316	003646*		MOVEM	T1,FNBRIB(P3)		;%
  3048	004403'	201340	004312*		MOVEI	T2,ATPREN		;%
  3049	004404'	412355	004313*		ANDCAM	T2,ATBSTS(P2)		;%
  3050	004405'	370317	004314*		SOS	T1,DRBCNT(P4)		;%
  3051	004406'	602300	004315*		TRNE	T1,DRPMXC		;%
  3052	004407'	256000	000000'		 STOPCD (SLO)
  3053							;;RENFL2+12
  3054	004410'	201300	000000		MOVEI	T1,0			;%
  3055	004411'	250315	004325*		EXCH	T1,ATBDOR(P2)		;%
  3056	004412'	402006	004411*		SETZM	ATBDOR(T1)		;%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 61-3
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3057	004413'	550640	000006		HRRZ	P2,T1			;%
  3058	004414'	554740	000006		HLRZ	P4,T1			;%
  3059	004415'	550715	004375*		HRRZ	P3,ATBFNB(P2)		;%
  3060	004416'	260040	001271*		PUSHJ	P,FREATB		;% GET RID OF ATB NOW ATTACHED TO OLD FNB
  3061	004417'	205300	004377*		MOVSI	T1,FNPNX		;%
  3062	004420'	436316	004400*		IORM	T1,FNBNX(P3)		;%
  3063	004421'	402016	004402*		SETZM	FNBRIB(P3)		;%
  3064	004422'	260040	004211*		PUSHJ	P,GIVCBR		;%
  3065	004423'	254000	004314'		JRST	RENECM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 62
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3066				;SUBROUTINE TO STORE USER-SUPPLIED ARGUMENTS IN THE RIB BLOCK
  3067				;CALLED BY ENTER AND RENAME
  3068				;ENTER WITH P1=NUMBER OF ARGS
  3069
  3070				;-SEP 76 AAA. ADDITIONS FOR PROJ CODES. WF USER CAN SET PJC AT WILL.
  3071				;-	WPJ USER CAN SET PJC ON RENAME OR UPDATE
  3072	004424'	305600	000006	SETVAL:	CAIGE	P1,UUXVER	;Check for extended ENTER block past .RBSIZ
  3073	004425'	263040	000000		 POPJ	P,		;NOT ENOUGH TO WORRY ABOUT
  3074	004426'	200440	004714'		MOVE	T4,UNPARG	;CAN ALWAYS SET UN-PRIV'D ARGS
  3075	004427'	261040	000002		PUSH	P,J
  3076	004430'	135100	004261*		LDB	J,PJOBN
  3077	004431'	135340	000602*		LDB	T2,JBYWPT	;GET LICENSE
  3078	004432'	303340	000001		CAILE	T2,1		;CHECK FOR WRITE-FILES OR WRITE-ABSOLUTE
  3079	004433'	434440	004715'		 IOR	T4,WRTARG	;CAN SET THESE IF WRITE FILES
  3080	004434'	205340	001000		MOVSI	T2,LICJAL
  3081	004435'	612342	004262*		TDNE	T2,JBTLIC(J)
  3082	004436'	434440	004716'		 IOR	T4,JALARG	;CAN SET THESE IF JACCT-LOGIN
  3083	004437'	205340	000001		MOVSI	T2,LICWPJ	;CHECK WRITE PROJECT
  3084	004440'	616342	004435*		TDNN	T2,JBTLIC(J)	;-
  3085	004441'	254000	004445'		 JRST	SETVL0		;-
  3086	004442'	201340	000000*		MOVEI	T2,ATPCRE!ATPSUP;-FOR RENAME OR UPDATE,
  3087	004443'	616355	004404*		TDNN	T2,ATBSTS(P2)	;-(SKIP IF NEITHER)
  3088	004444'	434440	004720'		 IOR	T4,WPJARG	;-LICWPJ USER CAN SET THESE
  3089	004445'	262040	000002	SETVL0:	POP	P,J
  3090	004446'	201340	004175*		MOVEI	T2,ATPDIR
  3091	004447'	616355	004443*		TDNN	T2,ATBSTS(P2)
  3092	004450'	434440	004717'		 IOR	T4,NONUA	;AND CAN SET THESE IF NOT A UFD
  3093	004451'	275600	000005		SUBI	P1,UUXVER-1	;NUMBER WE WANT TO SET
  3094	004452'	213000	000014		MOVNS	P1
  3095	004453'	507000	000014		HRLS	P1		;Make AOBJN pointer
  3096	004454'	541600	000006		HRRI	P1,UUXVER	;Start from .RBVER
  3097	004455'	665540	000014		TLOA	M,P1		;So "@M" uses P1 for indexing
  3098	004456'	242440	000001	SETVL1:	LSH	T4,1		;Get next bit to set
  3099	004457'	325440	004464'		JUMPGE	T4,SETVTU	;Zero bit means user cannot set this word
  3100	004460'	256200	006247'		UMOVE	T1,@M		;Get arg from user
  3101	004461'	256014	004462'		XCT FUTAB-UUXVER(P1)	;Store in %RIB or else PUSHJ to routine
  3102	004462'	253600	004456'		AOBJN	P1,SETVL1
  3103	004463'	263040	000000		POPJ	P,		;DONE
  3104
  3105	004464'	256014	002174'	SETVTU:	XCT TUTAB-UUXVER(P1)	;For those args user cannot set,
  3106	004465'	256200	006140'		UMOVEM	T1,@M		; return current value to him
  3107	004466'	253600	004456'		AOBJN	P1,SETVL1
  3108	004467'	263040	000000		POPJ	P,
  3109
  3110				;From User to RIB (ENTER), TUTAB is To User (LOOKUP)
  3111	004470'	202300	376000*	FUTAB:	MOVEM T1,%RIB+RIBVER	;06.RBVER Version number
  3112	004471'	202300	376000*		MOVEM T1,%RIB+RIBFUT	;07.RBFUT (.RBSPL Spooling name on ENTER)
  3113	004472'	202300	376000*		MOVEM T1,%RIB+RIBEST	;10.RBEST Estimated size
  3114	004473'	260040	004524'		PUSHJ P,CLFALC		;11.RBALC Allocated size
  3115	004474'	202300	376000*		MOVEM T1,%RIB+RIBPOS	;12.RBPOS Absolute disk position
  3116	004475'	202300	376000*		MOVEM T1,%RIB+RIBFT1	;13.RBFT1 unused (DEC .RBUFW)
  3117	004476'	260040	004721'		PUSHJ P,CLFLIC		;14.RBLIC Check on license he can set
  3118	004477'	202300	376000*		MOVEM T1,%RIB+RIBMTA	;15.RBMTA Tape ID used in last all-files BACKUP
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 62-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3119	004500'	202300	376000*		MOVEM T1,%RIB+RIBDEV	;16.RBDEV Device name
  3120	004501'	260040	004544'		PUSHJ P,CLFSTS		;17.RBSTS File/UFD status bits
  3121	004502'	255000	000000		JFCL			;20.RBELB Disk address of bad page
  3122	004503'	255000	000000		JFCL			;21.RBXT1 unused (DEC .RBEUN)
  3123	004504'	260040	004557'		PUSHJ P,CLFQTF		;22.RBQTF Quota in (check with DRBMXA+DRBALC)
  3124	004505'	202300	376000*		MOVEM T1,%RIB+RIBQTO	;23.RBQTO Quota out (UFDs only)
  3125	004506'	260040	004644'		PUSHJ P,CLFMXA		;24.RBQTR Quota reserved (max used last time)
  3126	004507'	260040	004621'		PUSHJ P,CLFUSD		;25.RBUSD Pages used
  3127	004510'	202300	376000*		MOVEM T1,%RIB+RIBAUT	;26.RBAUT Author
  3128	004511'	260040	004607'		PUSHJ P,CLFUNM		;27.RBUNM Username 1st half
  3129	004512'	260040	004615'		PUSHJ P,CLFUN1		;30.RBUN1 Username 2nd half
  3130	004513'	202300	376000*		MOVEM T1,%RIB+RIBTRU	;31.RBTRU UFD TRU limit
  3131	004514'	202300	376000*		MOVEM T1,%RIB+RIBXT2	;32.RBXT2 ???
  3132	004515'	255000	000000		JFCL			;33.RBALP Allocated pages
  3133	004516'	255000	000000		JFCL			;34.RBSNM Number spare RIBs
  3134	004517'	202300	376000*		MOVEM T1,%RIB+RIBPJC	;35.RBPJC Project code 1-5
  3135	004520'	202300	376000*		MOVEM T1,%RIB+RIBPJ1	;36.RBPJ1 Project code 6-10
  3136	004521'	202300	376000*		MOVEM T1,%RIB+RIBPJ2	;37.RBPJ2 Project code 11-12
  3137	004522'	260040	004671'		PUSHJ P,CLFPID		;40.RBPID Set or clear PID
  3138	004523'	255000	000000		JFCL			;41.RBACT Can never set ACCT from ENTER
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 63
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3139
  3140	004524'	256200	006250'	CLFALC:	UMOVE	T2,UUXNUM(M)	;ARG IN UNITS OF
  3141	004525'	602340	200000		TRNE	T2,UUPWDS	;WORDS?
  3142	004526'	254000	004537'		  JRST	CLFAL2		;YES.
  3143	004527'	315300	376000*	CLFAL1:	CAMGE	T1,%RIB+RIBEST	;NO. SO WE CAN SIMULATE EST SIZE
  3144	004530'	200300	376000*		  MOVE	T1,%RIB+RIBEST
  3145	004531'	202300	376000*		MOVEM	T1,%RIB+RIBALC
  3146	004532'	135340	003026*		LDB	T2,ATYBLK
  3147	004533'	313340	000006		CAMLE	T2,T1
  3148	004534'	200300	000007		  MOVE	T1,T2
  3149	004535'	256200	006251'		UMOVEM	T1,UUXALC(M)	;GIVE USER A FAKE NUMBER
  3150	004536'	263040	000000		POPJ	P,		;SO LOOKS LIKE ALLOC SUCCEDED
  3151	004537'	200340	000006	CLFAL2:	MOVE	T2,T1		;CONVERT THE ARG
  3152	004540'	242300	777771		LSH	T1,W2BLSH	;TO
  3153	004541'	602340	000177		TRNE	T2,177		;BLOCKS, WATCHING OUT FOR
  3154	004542'	344300	004527'		  AOJA	T1,CLFAL1	;OVERFLOW.
  3155	004543'	254000	004527'		JRST	CLFAL1		;
  3156
  3157					DEFINE TXXGEN (AC,NUM,TYP)
  3158				<IFE NUM&777777,<TL'TYP AC,(NUM)>
  3159				 IFN NUM&777777,<
  3160					IFE NUM&777777000000,<TR'TYP AC,NUM>
  3161					IFN NUM&777777000000,<TD'TYP AC,[NUM]>>>
  3162
  3163	004544'	606440	200000	CLFSTS:	TXXGEN (T4,<1B0_<^L<ARGSTS>-^L<ARGPVS>>>,NN)
  3164	004545'	254000	004553'		  JRST	CLFNPS		;NO.
  3165	004546'	201340	002517*		MOVEI	T2,RIPDIR	;DO NOT LET DIR GET SET
  3166	004547'	406340	376000*		ANDM	T2,%RIB+RIBSTS	;JUST THAT BIT
  3167	004550'	620300	004546*		TRZ	T1,RIPDIR
  3168	004551'	436300	376000*		IORM	T1,%RIB+RIBSTS	;PRIV CALL, SET STATUS
  3169	004552'	263040	000000		POPJ	P,
  3170
  3171	004553'	465300	000000*	CLFNPS:	ORCMI	T1,RIPBDA!RIPBFS!RIPHWE!RIPHRE ;SET TO 1
  3172								;ALL BITS BUT ONES WANTED CLEARED.
  3173	004554'	407300	376000*		ANDB	T1,%RIB+RIBSTS	;(DON'T LET CLR RIPBDR.).
  3174	004555'	256200	006252'		UMOVEM	T1,UUXSTS(M)	;TELL USER
  3175	004556'	263040	000000		POPJ	P,
  3176
  3177	004557'	201340	004446*	CLFQTF:	MOVEI	T2,ATPDIR
  3178	004560'	616355	004447*		TDNN	T2,ATBSTS(P2)
  3179	004561'	254000	004604'		  JRST	CLFQT1		;NOT A DIRECTORY
  3180	004562'	260040	004376*		PUSHJ	P,GETCBR	;% TRY TO FIND DRB
  3181	004563'	261040	000006		PUSH	P,T1		;%
  3182	004564'	200304	000015		MOVE	T1,DEVFIL(F)	;%
  3183	004565'	260040	004203*		PUSHJ	P,FNDDRB	;%
  3184	004566'	254000	004601'		  JRST	CLFQT2		;% NOT THERE
  3185	004567'	336007	003623*		SKIPN	DRBRIB(T2)	;%
  3186	004570'	254000	004601'		  JRST	CLFQT2		;% NOT REALLY READ YET
  3187	004571'	200700	000007		MOVE	P3,T2		;% SAVE FOR LATER ARGUMENTS
  3188	004572'	262040	000006		POP	P,T1		;%
  3189	004573'	260040	004422*		PUSHJ	P,GIVCBR	;%
  3190	004574'	200340	000006		MOVE	T2,T1
  3191	004575'	274340	376000*		SUB	T2,%RIB+RIBQTF
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 63-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3192	004576'	272356	003764*		ADDM	T2,DRBMXA(P3)
  3193	004577'	272356	003771*		ADDM	T2,DRBALC(P3)
  3194	004600'	254000	004605'		JRST	CLFQT3		;AND GO
  3195
  3196	004601'	260040	004573*	CLFQT2:	PUSHJ	P,GIVCBR	;%
  3197	004602'	262040	000006		POP	P,T1
  3198	004603'	634700	000016		TDZA	P3,P3		;SET 0 AS FLAG FOR LATER ARGS
  3199	004604'	211700	000001	CLFQT1:	  MOVNI	P3,1		;NEGATIVE AS FLAG THAT NOT DIR
  3200	004605'	202300	376000*	CLFQT3:	MOVEM	T1,%RIB+RIBQTF
  3201	004606'	263040	000000		POPJ	P,
  3202
  3203	004607'	323700	004613'	CLFUNM:	JUMPLE	P3,CLFUM1
  3204	004610'	202316	003456*		MOVEM	T1,DRBUNM(P3)	;STORE IT IN DRB IF CHANGING
  3205	004611'	402016	003224*		SETZM	DRBUN1(P3)	;JUST IN CASE
  3206	004612'	402000	376000*		SETZM	%RIB+RIBUN1
  3207	004613'	202300	376000*	CLFUM1:	MOVEM	T1,%RIB+RIBUNM
  3208	004614'	263040	000000		POPJ	P,
  3209
  3210	004615'	333000	000016	CLFUN1:	SKIPLE	P3
  3211	004616'	202316	004611*		  MOVEM	T1,DRBUN1(P3)
  3212	004617'	202300	376000*		MOVEM	T1,%RIB+RIBUN1
  3213	004620'	263040	000000		POPJ	P,
  3214
  3215				EXTERNAL JBTNAM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 64
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3216
  3217	004621'	321700	004631'	CLFUSD:	JUMPL	P3,CLFUS1	;NOT A UFD
  3218	004622'	321300	004636'		JUMPL	T1,CLFUS2	;DOES NOT WANT CHANGED
  3219	004623'	322700	004633'		JUMPE	P3,CLFUS3	;NO DRB, JUST CHANGE RIB
  3220	004624'	200340	376000*		MOVE	T2,%RIB+RIBQTF
  3221	004625'	274340	000006		SUB	T2,T1		;HAVE A DRB, CHANGE FOR NEW USD
  3222	004626'	202356	004577*		MOVEM	T2,DRBALC(P3)
  3223	004627'	315356	004576*		CAMGE	T2,DRBMXA(P3)
  3224	004630'	202356	004627*		  MOVEM	T2,DRBMXA(P3)	;AND THIS IF CHANGED
  3225	004631'	202300	376000*	CLFUS1:	MOVEM	T1,%RIB+RIBUSD
  3226	004632'	263040	000000		POPJ	P,
  3227
  3228	004633'	313300	376000*	CLFUS3:	CAMLE	T1,%RIB+RIBMXA	;MAY HAVE TO CHANGE THIS TOO
  3229	004634'	202300	376000*		  MOVEM	T1,%RIB+RIBMXA
  3230	004635'	254000	004631'		JRST	CLFUS1
  3231
  3232	004636'	332000	000016	CLFUS2:	SKIPE	P3
  3233	004637'	334300	376000*		  SKIPA	T1,%RIB+RIBQTF	;IF WE HAVE DRB, RETURN QTF-ALC
  3234	004640'	334300	376000*		 SKIPA	T1,%RIB+RIBUSD	;ELSE USD FROM RIB
  3235	004641'	274316	004626*		SUB	T1,DRBALC(P3)
  3236	004642'	256200	006253'		UMOVEM	T1,UUXUSD(M)
  3237	004643'	263040	000000		POPJ	P,
  3238
  3239	004644'	321700	004661'	CLFMXA:	JUMPL	P3,CLFMX1	;NOT A UFD, JUST ANOTHER ARG
  3240	004645'	321300	004663'		JUMPL	T1,CLFMX2	;DO NOT WANT IT CHANGED
  3241	004646'	322700	004654'		JUMPE	P3,CLFMX3	;CHANGE TO CURRENT USD AND REPORT OLD
  3242	004647'	200356	004641*		MOVE	T2,DRBALC(P3)	;IF HAVE DRB, GET CURRENT
  3243	004650'	250356	004630*		EXCH	T2,DRBMXA(P3)	;AND STORE FOR MAX. GET OLD
  3244	004651'	274340	376000*		SUB	T2,%RIB+RIBQTF	;NOW OLD MAX-QUOTA
  3245	004652'	212340	376000*		MOVNM	T2,%RIB+RIBMXA	;TEMP STORE OLD MAX
  3246	004653'	334300	376000*		SKIPA	T1,%RIB+RIBQTF	;GET QUOTA
  3247	004654'	334300	376000*	CLFMX3:	  SKIPA	T1,%RIB+RIBUSD	;IF NO DRB, GET CURRENT USED
  3248	004655'	274316	004647*		SUB	T1,DRBALC(P3)	;IF DRB QUOTA-CURRENT QUOTA LEFT
  3249	004656'	250300	376000*		EXCH	T1,%RIB+RIBMXA	;SET RIBMXA TO CURRENT USED, GET OLD
  3250	004657'	256200	006254'		UMOVEM	T1,UUXMXA(M)
  3251	004660'	263040	000000		POPJ	P,
  3252
  3253	004661'	202300	376000*	CLFMX1:	MOVEM	T1,%RIB+RIBMXA
  3254	004662'	263040	000000		POPJ	P,
  3255
  3256	004663'	332000	000016	CLFMX2:	SKIPE	P3		;IS THERE A DRB
  3257	004664'	334300	376000*		  SKIPA	T1,%RIB+RIBQTF	;YES
  3258	004665'	334300	376000*		 SKIPA	T1,%RIB+RIBMXA	;NO
  3259	004666'	274316	004650*		SUB	T1,DRBMXA(P3)	;NOW HAVE CURRENT MAX
  3260	004667'	256200	006254'		UMOVEM	T1,UUXMXA(M)
  3261	004670'	263040	000000		POPJ	P,
  3262
  3263	004671'	325700	003120*	CLFPID:	JUMPGE	P3,CPOPJ	;FORGET IT FOR UFDS
  3264	004672'	322300	004711'		JUMPE	T1,CLFPIZ	;ZEROING PID IS ALWAYS OK
  3265					MOVS	T2,T1		;GET SWAPPED COPY OF NEW PID IN T2 (UUN IN RH INSTEAD OF LEFT H
  3266	004673'	204340	000006	ALF)
  3267	004674'	430342	003202*		XOR	T2,JBTAUN(J)	;SEE IF PID UUN MATCHES JOB'S AUN UUN
  3268	004675'	606340	777777		TRNN	T2,-1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 64-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3269	004676'	254000	004704'		  JRST	CLFPIO		;OK TO GIVE OUT THIS PID
  3270	004677'	135340	004431*		LDB	T2,JBYWPT
  3271	004700'	303340	000001		CAILE	T2,1		;IF HAS WF OR WA,
  3272	004701'	254000	004704'		  JRST	CLFPIO		;OK TO GIVE PID OUT
  3273	004702'	312300	000000*		CAME	T1,%UPT+UPTPID	;PROGRAM TRYING TO GIVE OUT ITS OWN PID?
  3274	004703'	263040	000000		  POPJ	P,		;NO, WAS HIS LAST CHANCE, NO PID.
  3275	004704'	205340	003012*	CLFPIO:	MOVSI	T2,ATPPID
  3276	004705'	436355	004257*		IORM	T2,ATBLCW(P2)	;SET TO GOES INTO UFD ENTRY AND RIBLCW
  3277	004706'	202300	376000*	CLFPIS:	MOVEM	T1,%RIB+RIBPID	;OK, STORE IN RIB AND IN
  3278	004707'	202315	004151*		MOVEM	T1,ATBPID(P2)	;ATB
  3279	004710'	263040	000000		POPJ	P,
  3280	004711'	205340	004704*	CLFPIZ:	MOVSI	T2,ATPPID
  3281	004712'	412355	004705*		ANDCAM	T2,ATBLCW(P2)
  3282	004713'	254000	004706'		JRST	CLFPIS
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 65
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3283					DEFINE XA (A)
  3284				<	A==%%Z
  3285					%%Z==%%Z_-1>
  3286		400000	000000		%%Z==400000,,0
  3287
  3288				;DEFINE 'ALLOWED TO CHANGE' BIT NAMES
  3289
  3290		200000	000000	XA ARGVER
  3291		100000	000000	XA ARGFUT
  3292		040000	000000	XA ARGEST
  3293		020000	000000	XA ARGALC
  3294		010000	000000	XA ARGPOS
  3295		004000	000000	XA ARGFT1
  3296		002000	000000	XA ARGLIC
  3297		001000	000000	XA ARGMTA
  3298		000400	000000	XA ARGDEV
  3299		000200	000000	XA ARGSTS
  3300		000100	000000	XA ARGELB
  3301		000040	000000	XA ARGEUN
  3302		000020	000000	XA ARGQTF
  3303		000010	000000	XA ARGQTO
  3304		000004	000000	XA ARGMXA
  3305		000002	000000	XA ARGUSD
  3306		000001	000000	XA ARGAUT
  3307			400000	XA ARGUNM
  3308			200000	XA ARGUN1
  3309			100000	XA ARGTRU
  3310			040000	XA ARGUFD
  3311			020000	XA ARGALP
  3312			010000	XA ARGSNM
  3313			004000	XA (ARGPJ0)	;-
  3314			002000	XA (ARGPJ1)	;-
  3315			001000	XA (ARGPJ2)	;-
  3316			000400	XA ARGPID
  3317			000200	XA ARGALT
  3318			000100	XA (ARGPVS)	;FAKE TO REMEMBER STATUS PRIV
  3319
  3320				;NOW THE WORDS DEFINING BITS ALLOWED TO CHANGE
  3321
  3322	004714'	774400	101000	UNPARG:	ARGVER+ARGFUT+ARGEST+ARGALC+ARGPOS+ARGFT1+ARGLIC+ARGUFD+ARGSTS+ARGPID
  3323	004715'	002002	016200	WRTARG:	ARGMTA+ARGAUT+ARGPVS+ARGPJ0+ARGPJ1+ARGPJ2	;-
  3324	004716'	000075	600200	JALARG:	ARGQTF+ARGQTO+ARGMXA+ARGUSD+ARGUNM+ARGUN1+ARGTRU+ARGPVS
  3325	004717'	000075	600000	NONUA:	ARGUNM+ARGUN1+ARGTRU+ARGQTF+ARGQTO+ARGMXA+ARGUSD
  3326	004720'	000000	016000	WPJARG:	ARGPJ0+ARGPJ1+ARGPJ2	;-NEW FOR PJC
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 66
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3327
  3328	004721'	200355	004712*	CLFLIC:	MOVE	T2,ATBLCW(P2)		;GET CURRENT VALUE
  3329	004722'	261040	000011		PUSH	P,T4
  3330	004723'	603300	000077		TLNE	T1,77			;SPECIFYING SECONDS?
  3331	004724'	665340	000077		  TLOA	T2,77			;YES, VOID OLD FOR MERGE
  3332	004725'	661300	000077		 TLO	T1,77			;NO, VOID NEW FOR MERGE
  3333	004726'	135440	004430*		LDB	T4,PJOBN
  3334	004727'	205400	001002		MOVSI	T3,LICJAL+LICWFL
  3335	004730'	612411	004440*		TDNE	T3,JBTLIC(T4)
  3336	004731'	665340	000000*		  TLOA	T2,ATMUFP!ATMUFU	;LET HIM SET SPECIAL BITS
  3337	004732'	661340	000000*		 TLO	T2,ATMUFU		;JUST THE USUAL ONES
  3338	004733'	520400	000007		HLLO	T3,T2
  3339	004734'	404300	000010		AND	T1,T3			;ADJUST LEFT HALF
  3340	004735'	500351	004730*		HLL	T2,JBTLIC(T4)
  3341	004736'	603340	000002		TLNE	T2,LICWFL		;FIND OUT IF HE HAS WA
  3342	004737'	607340	000001		TLNN	T2,LICWPJ		;
  3343	004740'	625300	000000*		  TLZA	T1,ATPPID!ATPALC	;NO. IGNORE HIS ATPPID AND ATPALC ARGS.
  3344	004741'	254000	004745'		 JRST	CLFLC1			;YES.
  3345	004742'	200415	004721*		MOVE	T3,ATBLCW(P2)		;DOESN'T HAVE WA. DON'T LET HIM CLEAR
  3346	004743'	621400	000000*		TLZ	T3,-<ATPPID!ATPALC>-1	;ATPPID OR ALC
  3347	004744'	434300	000010		IOR	T1,T3
  3348	004745'	200411	004265*	CLFLC1:	MOVE	T3,JBTPPN(T4)
  3349	004746'	430404	000017		XOR	T3,DEVPPN(F)
  3350	004747'	260040	004754'		PUSHJ	P,FILLIC
  3351	004750'	256200	006255'		UMOVEM	T1,UUXLCW(M)
  3352	004751'	202315	004742*		MOVEM	T1,ATBLCW(P2)
  3353	004752'	262040	000011		POP	P,T4
  3354	004753'	263040	000000		POPJ	P,
  3355
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 67
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3356
  3357	004754'	621340	002040	FILLIC::TLZ	T2,LICRMT!LICHR		;DON'T LOOK AT THESE (HF + HR)
  3358	004755'	261040	000010		PUSH	P,T3
  3359	004756'	260040	005012'		PUSHJ	P,MAXLIC
  3360	004757'	262040	000010		POP	P,T3
  3361	004760'	607400	777777		TLNN	T3,-1			;SAME PROJ??
  3362	004761'	254000	004777'		  JRST	LICSPJ			;YES
  3363	004762'	606300	000002		TRNN	T1,LICWFL		;CAN NOT SET WRIT PROJ UNLESS
  3364	004763'	602340	000002		TRNE	T2,LICWFL		;SOMEONE HAS WRITE FILE
  3365	004764'	334000	000000		  SKIPA	
  3366	004765'	620300	000001		TRZ	T1,LICWPJ
  3367	004766'	606300	000010		TRNN	T1,LICRFL
  3368	004767'	602340	000010		TRNE	T2,LICRFL
  3369	004770'	334000	000000		  SKIPA	
  3370	004771'	620300	000004		TRZ	T1,LICRPJ
  3371	004772'	606340	002002		TRNN	T2,LICRMT!LICWFL	;SOME ONE MUST HAVE WF OR HF
  3372	004773'	620300	002000		  TRZ	T1,LICRMT		; TO SET HF ON A FILE
  3373	004774'	606340	002052		TRNN	T2,LICRMT!LICHR!LICWFL!LICRFL	;NEED WF,RF OR HF,HR
  3374	004775'	620300	000040		  TRZ	T1,LICHR		; TO SET HR ON A FILE
  3375	004776'	254000	005005'		JRST	LICSPG
  3376
  3377	004777'	616400	006256'	LICSPJ:	TDNN	T3,[XWD INDPPN,-1]
  3378	005000'	254000	005005'		  JRST	LICSPG
  3379	005001'	606340	002003		TRNN	T2,LICRMT!LICWFL!LICWPJ	;NEED HF,WF OR WP
  3380	005002'	620300	002000		  TRZ	T1,LICRMT		; TO SET HF ON A FILE
  3381	005003'	606340	002057		TRNN	T2,LICRMT!LICHR!LICWFL!LICRFL!LICWPJ!LICRPJ
  3382	005004'	620300	000040		  TRZ	T1,LICHR		;NEED ABOVE OR HR,RF OR RP TO SET HR
  3383
  3384	005005'	660340	002040	LICSPG:	TRO	T2,LICRMT!LICHR		;OK TO SET HF OR HR
  3385	005006'	504340	000006		HRL	T2,T1			;  NOT OK TO ASK IF UNABLE TO SET
  3386	005007'	260040	005031'		PUSHJ	P,LICMSK
  3387	005010'	542340	000006		HRRM	T2,T1
  3388	005011'	263040	000000		POPJ	P,
  3389
  3390
  3391				;SET MAX LICENSE OF LEFT HALF OF T2 AND RIGHT HALF OF T2
  3392	005012'	135400	006257'	MAXLIC::LDB	T3,[POINT 2,T2,LICWPS]	;MAX OF WRITE PRVS
  3393	005013'	135440	006260'		LDB	T4,[POINT 2,T2,LICWPS+^D18]
  3394	005014'	315440	000010		CAMGE	T4,T3
  3395	005015'	200440	000010		  MOVE	T4,T3
  3396	005016'	137440	006260'		DPB	T4,[POINT 2,T2,LICWPS+^D18]
  3397	005017'	135400	006261'		LDB	T3,[POINT 2,T2,LICRPS]	;READ IS MAX OF READ
  3398	005020'	315400	000011		CAMGE	T3,T4			;WRITE PRV. IMPLIES READ SO INCLUDE
  3399	005021'	200400	000011		  MOVE	T3,T4
  3400	005022'	135440	006262'		LDB	T4,[POINT 2,T2,LICRPS+^D18]
  3401	005023'	315440	000010		CAMGE	T4,T3
  3402	005024'	137400	006262'		  DPB	T3,[POINT 2,T2,LICRPS+^D18]
  3403	005025'	554400	000007		HLRZ	T3,T2
  3404	005026'	620400	000017		TRZ	T3,LICFMK		;TURN OFF ALL READ AND WRITE DSK BITS
  3405	005027'	434340	000010		IOR	T2,T3
  3406	005030'	263040	000000		POPJ	P,
  3407
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 68
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3408
  3409				;SETS LICENSE BY MASKING. LEFT HALF OF T2 IS THE REQUESTED
  3410				;LICENSE. RIGHT HALF IS WHAT HE CAN HAVE
  3411
  3412	005031'	135400	006257'	LICMSK::LDB	T3,[POINT 2,T2,LICWPS]
  3413	005032'	135440	006260'		LDB	T4,[POINT 2,T2,LICWPS+^D18]
  3414	005033'	315440	000010		CAMGE	T4,T3
  3415	005034'	137440	006257'		  DPB	T4,[POINT 2,T2,LICWPS]
  3416	005035'	135400	006261'		LDB	T3,[POINT 2,T2,LICRPS]
  3417	005036'	135440	006262'		LDB	T4,[POINT 2,T2,LICRPS+^D18]
  3418	005037'	315440	000010		CAMGE	T4,T3
  3419	005040'	137440	006261'		  DPB	T4,[POINT 2,T2,LICRPS]
  3420	005041'	554400	000007		HLRZ	T3,T2
  3421	005042'	602340	002000		TRNE	T2,LICRMT		;IF HF OK BUT HR UNSPECIFIED
  3422	005043'	660340	000040		  TRO	T2,LICHR		; THEN MAKE HR OK ALSO
  3423	005044'	660340	000017		TRO	T2,LICFMK
  3424	005045'	404340	000010		AND	T2,T3
  3425	005046'	620340	000020		TRZ	T2,LICUNU		;TURN OFF UNUSED BITS JUST IN CASE
  3426	005047'	263040	000000		POPJ	P,
  3427
  3428				COMMENT ! LICSAM
  3429				EXPECTS: T2/ LICENSE (FROM HIGH FILE),,LICENSE(FROM LOW FILE)
  3430				FUNCTION: RETURN T2/ 0,,LICENSES COMMON TO BOTH HALVES
  3431				DESTROY: T3,T4
  3432				NOTE: VIRTUALLY IDENTICAL TO LICMSK. USED BY SEGCON
  3433				!
  3434	005050'	135400	006257'	LICSAM::LDB	T3,[POINT 2,T2,LICWPS]
  3435	005051'	135440	006260'		LDB	T4,[POINT 2,T2,LICWPS+^D18]
  3436	005052'	312440	000010		CAME	T4,T3
  3437	005053'	621340	000003		  TLZ	T2,3B<LICWPS+^D18>	;DIFFERENT. ZAP WRITE PRIVS
  3438	005054'	135400	006261'		LDB	T3,[POINT 2,T2,LICRPS]
  3439	005055'	135440	006262'		LDB	T4,[POINT 2,T2,LICRPS+^D18]
  3440	005056'	312440	000010		CAME	T4,T3
  3441	005057'	621340	000014		  TLZ	T2,3B<LICRPS+^D18>	;DIFFERENT. ZAP READ PRIVS
  3442	005060'	554400	000007		HLRZ	T3,T2			;T3/0,,LICS (READ,WRITE PRIVS FIXED)
  3443	005061'	660340	000017		TRO	T2,LICFMK		;R/W PRIV MASK
  3444	005062'	404340	000010		AND	T2,T3			;T2/0,,LICS(ANDED)+R/W PRIVS, FIXED
  3445	005063'	620340	000020		TRZ	T2,LICUNU
  3446	005064'	263040	000000		POPJ	P,
  3447
  3448				;GET LICENSE FROM CORE TABLES. F IS SET UP. RETURN IN T1
  3449				;NON-SKIP RETURN IF NOT DISK. USED BY SEGCON
  3450
  3451	005065'	200304	000004	GETLIC::MOVE	T1,DEVMOD(F)
  3452	005066'	603200	000010		TLNE	F,GETB			;IF OFF A GETSEG, NO LICENSE
  3453	005067'	607300	200000		TLNN	T1,DVDSK
  3454	005070'	254000	003565*		  JRST	CPOPJ1
  3455	005071'	550304	004127*	GETLI1::HRRZ	T1,DEVATB(F)		;ENTERED HERE FROM SEGCON
  3456	005072'	550306	003773*		HRRZ	T1,ATBLIC(T1)
  3457	005073'	200340	003255*		MOVE	T2,JOB
  3458	005074'	200347	004745*		MOVE	T2,JBTPPN(T2)
  3459	005075'	430344	000017		XOR	T2,DEVPPN(F)		;SEE IF IN SAME PROJECT
  3460	005076'	607340	777777		TLNN	T2,-1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 68-2
FILUUO.MAC	 8-DEC-87 11:25		RENAME

  3461	005077'	263040	000000		  POPJ	P,			;YES
  3462	005100'	606300	000002		TRNN	T1,LICWFL
  3463	005101'	620300	000001		  TRZ	T1,LICWPJ		;RESET PROJECT READ AND WRITES
  3464	005102'	606300	000010		TRNN	T1,LICRFL		;FROM OTHER PROJECTS
  3465	005103'	620300	000004		  TRZ	T1,LICRPJ
  3466	005104'	263040	000000		POPJ	P,
  3467
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 69
FILUUO.MAC	 8-DEC-87 11:25		ERROR RETURNS

  3468					SUBTTL ERROR RETURNS
  3469
  3470	005105'	201300	000000	ILNMER:	MOVEI	T1,FNFERR
  3471	005106'	254000	005162'		JRST	STRERR
  3472
  3473	005107'	621540	200000	LUKER1:	TLZ	M,EXTUUO
  3474	005110'	256200	006263'		XCTFU	<SKIPN T2,(M)>		;DO NOT KNOW YET IF EXTENDED
  3475	005111'	254000	005114'		  JRST	RENER0
  3476	005112'	607340	777777		TLNN	T2,-1
  3477	005113'	661540	200000		  TLO	M,EXTUUO		;IT IS EXTENDED
  3478	005114'	201300	000005	RENER0:	MOVEI	T1,ISUERR
  3479	005115'	254000	005162'		JRST	STRERR
  3480	005116'	201300	000004	UILNMD:	MOVEI	T1,AEFERR		;%
  3481	005117'	260040	004601*	UPDERC:	PUSHJ	P,GIVCBR
  3482	005120'	254000	005162'		JRST	STRERR
  3483
  3484	005121'	201300	000002	UPDER2:	MOVEI	T1,PRTERR		;%
  3485	005122'	254000	005117'		JRST	UPDERC
  3486
  3487	005123'	201300	000003	UPDER3:	MOVEI	T1,FBMERR		;%
  3488	005124'	254000	005117'		JRST	UPDERC
  3489
  3490	005125'	260040	004562*	CLRENT:	PUSHJ	P,GETCBR		;% GET RESOURCE
  3491	005126'	201300	000000*		MOVEI	T1,ATPCRE!ATPSUP	;%
  3492	005127'	413315	004560*	CLRNT1:	ANDCAB	T1,ATBSTS(P2)		;%
  3493	005130'	550715	004415*	CLRCOM:	HRRZ	P3,ATBFNB(P2)		;% IN CASE WE NEED IT (FNB)
  3494	005131'	616300	006264'		TDNN	T1,[ATMUMC,,ATMCNT!ATPREN!ATPUPD!ATPSUP!ATPCRE!ATPMXU]
  3495					  JRST	[PUSHJ  P,FREATB	;%
  3496						 HLLZS  DEVATB(F)	;%
  3497	005132'	254000	006265'			 JRST   .+1]		;%
  3498	005133'	370317	004405*		SOS	T1,DRBCNT(P4)		;%
  3499	005134'	602300	004406*		TRNE	T1,DRPMXC		;%
  3500	005135'	256000	006270'		 STOPCD (.,DISK,CLRCM1,,<CLRCOM decremented DRBCNT too far>);;CLRCOM+5
  3501	005136'	260040	001523*		PUSHJ	P,ULKDBL		;%
  3502	005137'	324740	005117*		PJRST	GIVCBR			; Free CB resource
  3503
  3504	005140'	260040	002174*	LKER1:	PUSHJ	P,RELRIB		;GET RID OF RIB IF WE HAVE IT.
  3505	005141'	201300	000002		MOVEI	T1,PRTERR
  3506	005142'	260040	005162'		PUSHJ	P,STRERR		;SET FLAG
  3507	005143'	260040	005125*		PUSHJ	P,GETCBR		;%
  3508	005144'	200315	000141*		MOVE	T1,ATBCNT(P2)		;% SET ARGUMENT
  3509	005145'	201540	000011		MOVEI	M,CLSACC!CLSOUT		;% MAKE LOOK LIKE A CLOSE
  3510	005146'	324740	001030'		PJRST	CLOSRN			;% IN CASE ATPDEL IS SET (SUPERCEDE)
  3511
  3512	005147'	260040	005125'	ENTER1:	PUSHJ	P,CLRENT
  3513	005150'	201300	000002		MOVEI	T1,PRTERR
  3514	005151'	254000	005160'		JRST	STRERZ
  3515
  3516	005152'	260040	005125'	ENTER2:	PUSHJ	P,CLRENT		;Here when RIB page cannot be allocated
  3517	005153'	201300	000014		MOVEI	T1,NRMERR		;"No room"
  3518	005154'	254000	005160'		JRST	STRERZ
  3519
  3520	005155'	201300	000022	ERRLKM:	MOVEI	T1,LKMERR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 69-2
FILUUO.MAC	 8-DEC-87 11:25		ERROR RETURNS

  3521	005156'	254000	005162'		JRST	STRERR
  3522
  3523	005157'	201300	000016	ERRNET:	MOVEI	T1,NETERR
  3524	005160'	201340	000000	STRERZ:	MOVEI	T2,0
  3525	005161'	137340	003671*		DPB	T2,DEYSTC
  3526	005162'	607540	200000	STRERR:	TLNN	M,EXTUUO
  3527	005163'	256200	006135'		  XCTBU	<HRRM T1,UUNEXT(M)>
  3528	005164'	603540	200000		TLNE	M,EXTUUO
  3529	005165'	256200	006136'		  XCTBU	<HRRM T1,UUXEXT(M)>
  3530	005166'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 70
FILUUO.MAC	 8-DEC-87 11:25		ERROR RETURNS

  3531	005167'	542644	005071*	RENER9:	HRRM	P2,DEVATB(F)		;PUT THINGS BACK
  3532	005170'	506744	004117*		HRLM	P4,DEVDRB(F)
  3533	005171'	261040	000006		PUSH	P,T1			;SAVE ERROR CODE
  3534	005172'	260040	004131'		PUSHJ	P,RENNMR		;RESTORE OLD NAME
  3535	005173'	262040	000006		POP	P,T1
  3536	005174'	254000	005177'		JRST	RENRCM			;AND GIVE ERROR
  3537
  3538	005175'	260040	005137*	RENER7:	PUSHJ	P,GIVCBR		;%
  3539	005176'	201300	000002	RENRR3:	MOVEI	T1,PRTERR
  3540	005177'	201340	004403*	RENRCM:	MOVEI	T2,ATPREN
  3541	005200'	412355	005127*		ANDCAM	T2,ATBSTS(P2)
  3542	005201'	370357	005133*		SOS	T2,DRBCNT(P4)
  3543	005202'	602340	005134*		TRNE	T2,DRPMXC
  3544	005203'	256000	000000'		 STOPCD (SLO)
  3545							;;RENRCM+4
  3546	005204'	201340	000001		MOVEI	T2,DECLUK
  3547	005205'	137340	005161*		DPB	T2,DEYSTC		;RESET, LOOKUP WAS IN FORCE AND IS AGAIN
  3548	005206'	254000	005162'		JRST	STRERR
  3549
  3550	005207'	201300	000006	RENRR4:	MOVEI	T1,TRNERR
  3551	005210'	254000	005177'		JRST	RENRCM
  3552
  3553	005211'	201300	000006	RENRR2:	MOVEI	T1,TRNERR
  3554	005212'	261040	000006	RENCLR:	PUSH	P,T1			;SAVE IT
  3555	005213'	554755	004412*		HLRZ	P4,ATBDOR(P2)		;OLD DRB
  3556	005214'	550655	005213*		HRRZ	P2,ATBDOR(P2)
  3557	005215'	260040	005143*		PUSHJ	P,GETCBR
  3558	005216'	550715	005130*		HRRZ	P3,ATBFNB(P2)		;%
  3559	005217'	260040	004416*		PUSHJ	P,FREATB		;% GIVE BACK ATB (NEW)
  3560	005220'	370317	005201*		SOS	T1,DRBCNT(P4)		;%
  3561	005221'	602300	005202*		TRNE	T1,DRPMXC		;%
  3562	005222'	256000	000000'		 STOPCD (SLO)
  3563							;;RENCLR+8
  3564	005223'	260040	005175*		PUSHJ	P,GIVCBR		;%
  3565	005224'	550644	005167*		HRRZ	P2,DEVATB(F)
  3566	005225'	554744	005170*		HLRZ	P4,DEVDRB(F)
  3567	005226'	402015	005214*		SETZM	ATBDOR(P2)		;REMOVE LINK
  3568	005227'	262040	000006		POP	P,T1
  3569	005230'	254000	005177'		JRST	RENRCM			;AND GO
  3570
  3571	005231'	260040	004374*	RENRR1:	PUSHJ	P,RELLOK
  3572	005232'	260040	004126'		PUSHJ	P,RENNXR
  3573	005233'	201300	000002		MOVEI	T1,PRTERR
  3574	005234'	254000	005212'		JRST	RENCLR
  3575
  3576	005235'	260040	005231*	RENRR0:	PUSHJ	P,RELLOK
  3577	005236'	201300	000014		MOVEI	T1,NRMERR
  3578	005237'	254000	005212'		JRST	RENCLR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 71
FILUUO.MAC	 8-DEC-87 11:25		ERROR RETURNS

  3579				;THIS IS PART OF THE SYSDEV UUO
  3580
  3581	005240'	541553	000001	SYDUNI::HRRI	M,1(M)			;GET THE UNIT NAME SPECIFIED BY USER
  3582	005241'	256200	006131'		UMOVE	T1,(M)
  3583	005242'	554240	000000*		HLRZ	U,SYSUNI		;START OF UNIT CHAIN
  3584	005243'	322300	005253'		JUMPE	T1,SYDUN1		;USER SPECIFIED 0, FIRST UNIT
  3585	005244'	316305	000000*	SYDUN3:	CAMN	T1,UNINAM(U)
  3586	005245'	254000	005251'		  JRST	SYDUN2			;FOUND UNIT SPECIFIED
  3587	005246'	554245	000000*		HLRZ	U,UNISYS(U)		;NEXT UNIT
  3588	005247'	326240	005244'		JUMPN	U,SYDUN3		;MORE LEFT?
  3589	005250'	263040	000000		POPJ	P,			;NO, NAME SPECIFIED NOT UNIT, ERROR RET
  3590
  3591	005251'	554245	005246*	SYDUN2:	HLRZ	U,UNISYS(U)		;GET NEXT UNIT
  3592	005252'	322240	000000*		JUMPE	U,SYDNM4		;RETURN A 0 FOR END OF LIST
  3593	005253'	135300	000000*	SYDUN1:	LDB	T1,UNYSIZ		;GET THE SIZE WE CAN GIVE HIM
  3594	005254'	200345	005244*		MOVE	T2,UNINAM(U)
  3595	005255'	256200	006273'	SYDUN4:	UMOVEM	T2,(M)			;GIVE HIM THE NAME OF THIS ONE
  3596	005256'	205340	240000		MOVSI	T2,LICSYS!LICSPY	;SEE IF HE CAN HAVE MORE
  3597	005257'	616342	004735*		TDNN	T2,JBTLIC(J)
  3598	005260'	254000	005070*		  JRST	CPOPJ1			;NO
  3599	005261'	363600	005260*		SOJLE	P1,CPOPJ1		;OR MAYBE DOES NOT WANT MORE
  3600	005262'	541553	000001		HRRI	M,1(M)
  3601	005263'	254000	000000*		JRST	SYDCOM
  3602
  3603
  3604	005264'	541553	000001	SYDSTR::HRRI	M,1(M)			;Addr of user block + 1
  3605	005265'	256200	006131'		UMOVE	T1,(M)
  3606	005266'	322300	005300'		JUMPE	T1,SYDST3		;FIRST STRUCTURE REQUESTED
  3607	005267'	201240	000000*		MOVEI	U,STRDDB		;NO, CHECK LIST FOR POSITION
  3608	005270'	312305	000000*	SYDST1:	CAME	T1,STRNAM(U)		;IS THIS THE CURRENT ONE?
  3609	005271'	254000	005275'		  JRST	SYDST2			;NO, TRY NEXT ONE
  3610	005272'	554245	000000*		HLRZ	U,STRNXT(U)		;YES, GET NEXT
  3611	005273'	326240	005301'		JUMPN	U,SYDST4		;ANOTHER STR, GIVE IT TO HIM
  3612	005274'	254000	005252*		JRST	SYDNM4			;SAY NOTHING MORE
  3613
  3614	005275'	554245	005272*	SYDST2:	HLRZ	U,STRNXT(U)		;TRY FOR ANOTHER ONE
  3615	005276'	326240	005270'		JUMPN	U,SYDST1		;YES, KEEP LOOKING FOR A MATCH
  3616	005277'	263040	000000		  POPJ	P,			;NO MATCH, BAD ARGUMENT
  3617
  3618	005300'	201240	005267*	SYDST3:	MOVEI	U,STRDDB		;STR DATA FROM COMMOD
  3619	005301'	201300	000000*	SYDST4:	MOVEI	T1,STRLEN
  3620	005302'	200345	005270*		MOVE	T2,STRNAM(U)		;NAME FROM STR BLOCK
  3621	005303'	254000	005255'		JRST	SYDUN4
  3622
  3623				EXTERNAL SYDCOM
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 72
FILUUO.MAC	 8-DEC-87 11:25		F.S. UUO FUNCTION AND ERROR RETURN CODES

  3624				SUBTTL  F.S. UUO FUNCTION AND ERROR RETURN CODES
  3625
  3626				;STRUUO FUNCTION CODES
  3627
  3628			000000	XP .FSSRC,0	;DEFINE NEW SEARCH LIST (UNPRIVILEGED)
  3629			000001	XP .FSDSL,1	;DEFINE NEW SEARCH LIST (PRIVILEGED)
  3630			000002	XP .FSDEF,2	;DEFINE NEW FILE STRUCTURE
  3631			000003	XP .FSRDF,3	;REDEFINE FILE STRUCTURE STATUS
  3632			000004	XP .FSLOK,4	;LOCK OUT NEW INITS,ENTERS,LOOKUPS
  3633			000005	XP .FSREM,5	;REMOVE FILE STRUCTURE FROM SYSTEM
  3634
  3635				;STRUUO & GOBSTR ERROR CODES
  3636
  3637			000000	XP .ERILF,0	;ILLEGAL FUNCTION CODE
  3638			000001	XP .ERSNF,1	;1 OR MORE FILE STRUCTURES NOT FOUND
  3639			000002	XP .ERSSA,2	;1 OR MORE FILE STRUCTURES SINGLE ACCESS ONLY
  3640			000003	XP .ERILE,3	;1 OR MORE ILLEGAL ENTRIES IN ARG. LIST
  3641			000004	XP .ERTME,4	;TOO MANY ENTRIES IN SEARCH LIST
  3642			000005	XP .ERUNA,5	;1 OR MORE UNITS NOT AVAILABLE
  3643			000006	XP .ERPPN,6	;JOB # , PP # DO NOT MATCH
  3644			000007	XP .ERMCN,7	;MOUNT COUNT NOT 0
  3645			000010	XP .ERNPV,10	;NOT PRIVILEGED USER
  3646			000011	XP .ERFSA,11	;F.S. ALREADY EXISTS
  3647			000012	XP .ERILL,12	;ILLEGAL ARG. LIST LENGTH (LH UUO AC)
  3648			000013	XP .ERUNC,13	;UNABLE TO COMPLETE THE FUNCTION
  3649			000014	XP .ERNFS,14	;SYSTEM FULL OF FILE STRUCTURES
  3650			000015	XP .ERNCS,15	;NOT ENOUGH FREE CORE FOR DATA BLOCK
  3651			000016	XP .ERUNF,16	;ILLEGAL UNIT
  3652			000017	XP .ERRSL,17	;FILE STRUCTURE REPEATED IN SEARCH LIST DEFINITION
  3653
  3654				;MACRO TO ASSOCIATE SYMBOLIC ADDRESS AND ERROR CODE
  3655
  3656					DEFINE	ERCODE	(NAME,CODE)<
  3657				IFG <CODE-MXECOD>,<MXECOD==CODE>
  3658					NAME==ECOD'CODE>
  3659
  3660			000000	MXECOD==0	;NUMBER OF ERROR CODES TO GENERATE
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 73
FILUUO.MAC	 8-DEC-87 11:25		SYSSTR UUO

  3661				SUBTTL	SYSSTR UUO
  3662				;UUO TO RETURN NAME OF NEXT FILE STRUCTURE IN SYSTEM
  3663				;NOTE THAT ACCUMULATOR J IS J AND CONTAINS THE JOB NUMBER OF THE JOB
  3664				; EXECUTING THE UUO
  3665
  3666
  3667	005304'	322300	005310'	SYSTUU::JUMPE	T1,SYSTU1		;% JUMP IF 1ST STR DESIRED
  3668	005305'	312300	006024'		CAME	T1,[SIXBIT /DSKB/]	;ONLY LEGAL STR NAME
  3669	005306'	263040	000000		  POPJ	P,			;% NO, ERROR RETURN
  3670	005307'	634300	000006		TDZA	T1,T1			;AFTER DSKB IS END
  3671	005310'	200300	006024'	SYSTU1:	MOVE	T1,[SIXBIT /DSKB/]
  3672	005311'	254000	005467'		JRST	RETARG
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 74
FILUUO.MAC	 8-DEC-87 11:25		SYSPHY UUO

  3673				SUBTTL	SYSPHY UUO
  3674				;CALLI AC,51
  3675				;UUO TO RETURN NAME OF NEXT PHYS.DEV. NAME IN SYSTEM
  3676				; CALLING SEQUENCE IS SIMILAR TO SYSSTR UUO
  3677
  3678
  3679	005312'	554240	005242*	SYSPHY::HLRZ	U,SYSUNI	;U=ADDRESS 1ST UNIT D.B.
  3680	005313'	322300	005324'		JUMPE	T1,SYSPH4	;IF USER AC=0: RETURN 1ST UNIT
  3681
  3682	005314'	316305	005254*	SYSPH2:	CAMN	T1,UNINAM(U)	;THIS UNIT PHYS.NAME = ARGUMENT?
  3683	005315'	254000	005321'		JRST	SYSPH3		;YES-GO RETURN NEXT PHYS.NAME
  3684	005316'	554245	005251*		HLRZ	U,UNISYS(U)	;NO--GET NEXT UNIT
  3685	005317'	326240	005314'		JUMPN	U,SYSPH2	;IF THIS IS LAST UNIT:
  3686	005320'	263040	000000		POPJ	P,		;   GIVE ERROR RETURN
  3687
  3688	005321'	400300	000000	SYSPH3:	SETZ	T1,		;RETURN 0 IN CASE IT WAS LAST UNIT
  3689	005322'	554245	005316*		HLRZ	U,UNISYS(U)	;GET NEXT UNIT D.B.
  3690	005323'	322240	005467'		JUMPE	U,RETARG	;IF THAT WAS LAST UNIT: RETURN 0
  3691	005324'	200305	005314*	SYSPH4:	MOVE	T1,UNINAM(U)	;OTHERWISE RETURN PHYS.NAME
  3692	005325'	254000	005467'		JRST	RETARG
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 75
FILUUO.MAC	 8-DEC-87 11:25		GOBSTR M

  3693				SUBTTL GOBSTR M
  3694				; GENERALIZED JOBSTR M  -  CALLI AC,66
  3695
  3696
  3697				;ERROR RETURN CODES:
  3698
  3699			005474'	ERCODE GERIFS,\.ERILE	;1ST ARG. NOT VALID (-1 OR F.S. NAME IN JOBS SRCH LIST)
  3700			005477'	ERCODE GERPPN,\.ERPPN	;JOB# (1ST ARG) NO GOOD OR DOESNT MATCH PPN (2ND ARG)
  3701			005503'	ERCODE GERILL,\.ERILL	;ILLEGAL ARG.LIST LENGTH (LH OF M AC)
  3702				; ALSO .ERNPV		;(SUBROUT PRIVJ) NOT PRIVILEGED JOB
  3703
  3704				INTERN GOBSTR
  3705	005326'	265440	005572'	GOBSTR:	JSP	T4,PRIVJ		;PRIVILEGED JOB?
  3706	005327'	542300	000013		HRRM	T1,M		;RH M=ADDR. USERS ARG. LIST
  3707	005330'	554600	000006		HLRZ	P1,T1		;P1=LENGTH OF ARG. LIST
  3708	005331'	336000	000014		SKIPN	P1		;CONVERT 0 TO 3
  3709	005332'	201600	000003		MOVEI	P1,3
  3710	005333'	305600	000003		CAIGE	P1,3		;LENGTH 3 OR GREATER?
  3711	005334'	254000	005503'		JRST	GERILL		;NO--ERROR RETURN
  3712
  3713	005335'	260040	005544'		PUSHJ	P,CKJPPN	; JOB # MATCH PPN?
  3714	005336'	254000	005477'		  JRST	GERPPN		; NO--ERROR RETURN
  3715	005337'	271540	000002		ADDI M,2		; POSITION FOR THE JOBSTR ARG
  3716	005340'	260040	005347'		PUSHJ	P,JOBST0	; PUSHJ TO JOBSTR CODE SO I
  3717	005341'	254000	005474'		  JRST	GERIFS		;   CAN HANDLE MY OWN ERROR RETURN
  3718	005342'	254000	005261*		JRST	CPOPJ1		; GOOD RETURN--PASS IT ON
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 76
FILUUO.MAC	 8-DEC-87 11:25		GOBSTR M

  3719				;UUO TO RETURN NEXT STR IN JOB'S OWN SEARCH LIST
  3720
  3721
  3722				;SO GOBSTR CAN USE THIS SAME CODE:
  3723				;   J HOLDS # OF JOB WHOSE SEARCH LIST IS TO BE SEARCHED (0 IS SYS SEARCH LIST)
  3724				;   P1=# OF ARGUMENTS
  3725
  3726	005343'	542300	000013	JOBSTR:	HRRM	T1,M		;ADDR OF USER'S ARGUMENT LIST
  3727	005344'	554600	000006		HLRZ	P1,T1		;P1=NUMBER OF ARGS DESIRED
  3728	005345'	336000	000014		SKIPN	P1
  3729	005346'	201600	000001		  MOVEI	P1,1		;CONVERT 0 TO 1
  3730
  3731	005347'			JOBST0:				; HERE FROM GOBSTR
  3732	005347'	256200	006131'		UMOVE	T1,(M)		; GET 1ST ARG=STR NAME
  3733	005350'	342300	005357'		AOJE	T1,JOBST2	; JUMP IF BEGINNING DESIRED (-1)
  3734	005351'	366300	005354'		SOJN	T1,JOBST1	; JUMP IF NOT FENCE (0)
  3735	005352'	211640	000001		MOVNI	P2,1		; FENCE, NEXT IS END
  3736	005353'	254000	005360'		JRST	JOBST8
  3737
  3738	005354'	312300	006024'	JOBST1:	CAME	T1,[SIXBIT /DSKB/]
  3739	005355'	263040	000000		  POPJ	P,		; DSKB IS ONLY ALLOWED STR
  3740	005356'	634640	000015		TDZA	P2,P2		; FOLLOWED BY FENCE
  3741	005357'	200640	006024'	JOBST2:	MOVE P2,[SIXBIT /DSKB/]	; FIRST STR IS DSKB
  3742	005360'	256200	006274'	JOBST8:	UMOVEM	P2,(M)		; STORE STR NAME
  3743	005361'	362600	005342*		SOJE	P1,CPOPJ1	; SKIP RETURN IF NO MORE ARGS DESIRED
  3744	005362'	256200	006275'		XCTBU	<SETZM 1(M)>	; ZERO FOR PPN WORD FOR NOW ***
  3745	005363'	362600	005361*		SOJE	P1,CPOPJ1	; SKIP RETURN IF NO MORE ARGS DESIRED
  3746	005364'	256200	006276'		XCTBU	<SETZM 2(M)>	; STORE 0 FOR STATUS BITS
  3747	005365'	254000	005363*		JRST	CPOPJ1		; SKIP RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 77
FILUUO.MAC	 8-DEC-87 11:25		STRUUO M

  3748				SUBTTL	STRUUO M
  3749				;M TO PERFORM VARIOUS FUNCTIONS FOR FILE STRUCTURES
  3750				;NOTE THAT ACCUMULATOR J IS J AND CONTAINS THE JOB NUMBER OF THE JOB
  3751				; EXECUTING THE M
  3752
  3753				;ERROR CODES
  3754
  3755			005503'	ERCODE ILLERR,\.ERILL	;ILLEGAL ARG.LIST LENGTH (LH M AC)
  3756			005501'	ERCODE NPVERR,\.ERNPV	;NOT PRIVILEGED PROGRAM
  3757			005477'	ERCODE PPNERR,\.ERPPN	;JOB #--PPN MISMATCH
  3758			005472'	ERCODE SNFERR,\.ERSNF	;F.S. NOT FOUND (NONEXISTANT)
  3759				INTERNAL SNFERR
  3760			005471'	ERCODE ILFERR,\.ERILF	;ILLEGAL FUNCTION
  3761			005507'	ERCODE UNFERR,\.ERUNF	;NO SUCH UNIT
  3762			005506'	ERCODE NCSERR,\.ERNCS	;NOT ENOUGH FREE CORE
  3763				INTERNAL NCSERR
  3764			005504'	ERCODE UNCERR,\.ERUNC	;UNABLE TO COMPLETE THE FUNCTION
  3765
  3766
  3767				INTERN STRUUO
  3768	005366'	265440	000100*	STRUUO:	JSP	T4,SAVE4	;SAVE ALL 4 GLOBAL ACCUMULATORS
  3769	005367'	200740	000006		MOVE	P4,T1		;SAVE T1 IN P4
  3770	005370'	542300	000013		HRRM	T1,M		;ADDRESS OF ARGUMENT LIST
  3771	005371'	256200	006131'		UMOVE	T1,(M)		;GET FIRST ARGUMENT = FUNCTION
  3772	005372'	321300	005471'		JUMPL	T1,ILFERR	;ILLEGAL IF NEGATIVE
  3773	005373'	301300	000012		CAIL	T1,STRFNN	;SEE IF LEGAL FUNCTION
  3774	005374'	254000	005471'		JRST	ILFERR		;WELL, NO
  3775	005375'	344566	005376'		AOJA	M,@STRFNC(T1)
  3776	005376'	000000	005410'	STRFNC:	XWD	ZERO5,SRCSTR	;(0) DEFINE NEW SEARCH LIST (UNPRIVILEGED)
  3777	005377'	000000	005412'		XWD	ZERO5,DSLSTR	;(1) DEFINE NEW SEARCH LIST (PRIVILEGED)
  3778	005400'	000000	005471'		XWD	ZERO5,ILFERR	;(2) DEFINE NEW FILE STRUCTURE
  3779	005401'	000000	005471'		XWD	ZERO5,ILFERR	;(3) REDEFINE FILE STRUCTURE (CHANGE BITS)
  3780	005402'	000000	005471'		XWD	ZERO5,ILFERR	;(4) LOCK OUT NEW INIT'S, ENTER'S ,ETC.
  3781	005403'	000000	005471'		XWD	ZERO5,ILFERR	;(5) REMOVE FILE STRUCTURE FROM SYSTEM
  3782	005404'	000000	005435'		XWD	ZERO5,ULKSTR	;(6) TEST/SET UFD INTERLOCK FOR LOGIN, LOGOUT, ETC
  3783	005405'	000000	005436'		XWD	ZERO5,UCLSTR	;(7) CLEAR UFD INTERLOCK
  3784	005406'	000000	005450'		XWD ZERO5,ETSSTR	;(10 ERROR TEST M (SIMULATE ERRORS) .FSETS
  3785	005407'	000000	005530'		RRSET			;(11) READ AND RESET BUFFERED LOG FOR 3330'S
  3786			000012	STRFNN==.-STRFNC
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 78
FILUUO.MAC	 8-DEC-87 11:25		STRUUO M - DEFINE NEW SEARCH LIST

  3787				SUBTTL STRUUO M - DEFINE NEW SEARCH LIST
  3788				;FUNCTIONS TO DECLARE NEW SEARCH LISTS
  3789
  3790				;FOR THIS JOB (UNPRIVILEGED)
  3791
  3792	005410'	554700	000017	SRCSTR:	HLRZ	P3,P4		; P3=ARG.LIST LENGTH - 1
  3793	005411'	364700	005420'		SOJA	P3,SLSTRR
  3794
  3795				;FOR ANY JOB (PRIVILEGED)
  3796
  3797	005412'	265440	005572'	DSLSTR:	JSP	T4,PRIVJ		;PRIVILEGED JOB?
  3798	005413'	260040	005544'		PUSHJ	P,CKJPPN	; JOB # MATCH PPN?
  3799	005414'	254000	005477'		  JRST	PPNERR		; NO--ERROR RETURN
  3800	005415'	554700	000017		HLRZ	P3,P4		; P3=ARG.LIST LENGTH - 4
  3801	005416'	275700	000004		SUBI	P3,4
  3802	005417'	271540	000003		ADDI M,3		; FOR CKJPPN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 79
FILUUO.MAC	 8-DEC-87 11:25		STRUUO M - DEFINE NEW SEARCH LIST

  3803				; RH(J)=# OF JOB WHOSE SEARCH LIST IS TO BE DEFINED
  3804				; P3=ARG.LIST LENGTH (EXCLUDING INITIAL STUFF LIKE FUNCTION NO.)
  3805
  3806				; FALL OR SKIP INTO HERE FROM DSLSTR CODE
  3807
  3808	005420'	323700	005365*	SLSTRR:	JUMPLE	P3,CPOPJ1	; IF NO F.S. GIVEN, TREAT AS ERROR
  3809	005421'	256200	006131'	SLSTR0:	UMOVE	T1,(M)		; GET NEXT F.S. NAME
  3810	005422'	322300	005501'		JUMPE	T1,NPVERR	; NOT ALLOWED TO HAVE EMPTY LIST
  3811	005423'	316300	006024'		CAMN T1,[SIXBIT /DSKB/]	;NOT ALLOWED ANY BUT DSKB
  3812	005424'	256200	006277'		  XCTBU	<SKIPE 2(M)>	;NO SPECIAL STATUS ALLOWED
  3813	005425'	254000	005472'		 JRST	SNFERR
  3814	005426'	271540	000003		ADDI	M,3
  3815	005427'	275700	000003		SUBI	P3,3
  3816	005430'	323700	005420*		JUMPLE	P3,CPOPJ1	;FINISHED (ASSUME FENCE)
  3817	005431'	256200	006300'		XCTBU	<SKIPN 2(M)>	;ALLOW A FENCE
  3818	005432'	303700	000003		CAILE	P3,3		;BUT THAT MUST BE END OF LIST
  3819	005433'	254000	005472'		  JRST	SNFERR
  3820	005434'	254000	005430*		JRST CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 80
FILUUO.MAC	 8-DEC-87 11:25		STRUUO - UFD INTERLOCK

  3821				SUBTTL	STRUUO - UFD INTERLOCK
  3822			000003	LKCLNA==3			;MUST HAVE 3 ARGS INCLUDING FUNCTION CODE
  3823	005435'	634700	000016	ULKSTR:	TDZA	P3,P3		;CLEAR P3 AND SKIP
  3824	005436'	474700	000000	UCLSTR:	SETO	P3,		;SET P3 NON-0
  3825	005437'	265440	005572'		JSP	T4,PRIVJ	;ONLY RETURN IF PRIVILEGED JOB
  3826	005440'	554300	000017		HLRZ	T1,P4		;T1=NUMBER OF ARGS
  3827	005441'	305300	000003		CAIGE	T1,LKCLNA	;MUST HAVE ENOUGH ARGS
  3828	005442'	324740	005503'		PJRST	ILLERR		;NOT ENOUGH ARGUMENTS
  3829	005443'	256200	006173'		UMOVE P1,(M)		;GET STR NAME IN P1 FOR LOKPPB
  3830	005444'	256200	006301'		UMOVE P2,1(M)		;AND PPN IN P2
  3831	005445'	322700	000000*		PJUMPE	P3,LOKPPB	;IF ILK, CALL LOKPPB TO TEST/SET
  3832	005446'	260040	000000*		PUSHJ	P,NLKPPB	;ELSE CALL NLKPPB TO CLEAR
  3833	005447'	324740	005434*		PJRST	CPOPJ1		;AND RETURN OK
  3834
  3835				SUBTTL STRUUO - .FSETS ERROR TESTING
  3836
  3837				;.FSET-ERROR TESTING-FUNCTION TO FORCE CONI AND DATAI ERRORS ON A UNIT
  3838				;PART OF STRUUO.
  3839				;ARGS ARE FUNCTION, UNIT NAME, ETC. SEE COMMOD FOR
  3840				;TABLE OF ARGS-ETSTAB.
  3841				;USER MUST BE PRIVILEGED
  3842				; ERROR RETURN IF SOME UNIT IS ALREADY BEING ERROR TESTED (.ERUNC)
  3843				; UNIT NOT FOUND (.ERFUNF)
  3844
  3845	005450'	265440	005572'	ETSSTR:	JSP	T4,PRIVJ	;CHECK FOR PRIVILEGED JOB
  3846	005451'	256200	006131'		UMOVE T1,(M)		;GET UNIT NAME
  3847	005452'	332000	000000*		SKIPE	ETSUNI		;ALREADY TESTING ERRORS ON SOME UNIT?
  3848	005453'	254000	005504'		JRST	UNCERR		;YES, GIVE ERROR RETURN SO TWO
  3849								; USER'S DO NOT CONFUSE EACH OTHER
  3850	005454'	476000	000007		SETOM	T2		;SET UNIT NAME MASK TO -1
  3851	005455'	260040	005757'		PUSHJ	P,SRUNI		;SEARCH FOR UNIT NAME
  3852	005456'	254000	005507'		  JRST	UNFERR		;UNIT NOT FOUND
  3853	005457'	255000	000000		  JFCL			;LOGICAL UNIT NAME
  3854	005460'	205600	000000*		MOVSI	P1,METSLN	;-LENGTH OF ARG PICKUP
  3855	005461'	271540	000001	ETSLUP:	ADDI M,1		;GET NEXT USER ARG
  3856	005462'	256200	006131'		UMOVE T1,(M)
  3857	005463'	202314	000000*		MOVEM	T1,ETSTAB(P1)	;STORE
  3858	005464'	253600	005461'		AOBJN	P1,ETSLUP	;MORE?
  3859	005465'	202240	005452*		MOVEM	U,ETSUNI	;NOW SET UNIT ADDRESS WHICH
  3860								;ENABLES FAKE ERROR TESTING
  3861	005466'	254000	005447*		JRST	CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 81
FILUUO.MAC	 8-DEC-87 11:25		M RETURNS AND ERROR CODES

  3862				SUBTTL M RETURNS AND ERROR CODES
  3863
  3864				;HERE TO PUT T1 IN USERS M AC AND SKIP RETURN
  3865
  3866	005467'	256200	006302'	RETARG:	UMOVEM T1,(W)
  3867	005470'	254000	005466*		JRST	CPOPJ1
  3868
  3869				;THESE RETURNS TO PUT ERROR CODE IN USERS M AC AND NO-SKIP RETURN
  3870
  3871					DEFINE XCOD(A)
  3872				<ECOD'A:	JSP T1,ECOD>
  3873
  3874			000000	%%XCOD==0
  3875					REPEAT MXECOD+1,<XCOD (\%%XCOD)
  3876				%%XCOD==%%XCOD+1>
  3877	005471'	265300	005510'
  3878	005472'	265300	005510'
  3879	005473'	265300	005510'
  3880	005474'	265300	005510'
  3881	005475'	265300	005510'
  3882	005476'	265300	005510'
  3883	005477'	265300	005510'
  3884	005500'	265300	005510'
  3885	005501'	265300	005510'
  3886	005502'	265300	005510'
  3887	005503'	265300	005510'
  3888	005504'	265300	005510'
  3889	005505'	265300	005510'
  3890	005506'	265300	005510'
  3891	005507'	265300	005510'
  3892	005510'	275300	005472'	ECOD:	SUBI	T1,ECOD0+1
  3893
  3894	005511'	256200	006302'		UMOVEM T1,(W)
  3895	005512'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 82
FILUUO.MAC	 8-DEC-87 11:25		M RETURNS AND ERROR CODES

  3896				;CODE FOR INTERLOCK
  3897
  3898				;	JSP	T4,LOCK
  3899				;	--WILL BE UNLOCKED BY MATCHING POPJ (OR CPOPJ1)--
  3900
  3901	005513'	260040	005215*	LOCK:	PUSHJ P,GETCBR
  3902	005514'	201200	005223*		MOVEI F,GIVCBR
  3903	005515'	261040	000002		PUSH P,J
  3904	005516'	200100	005073*		MOVE J,JOB
  3905	005517'	202202	000562*		MOVEM F,JBTABT(J)	;SET IN CASE OF ADDRESS ERROR
  3906	005520'	262040	000002		POP P,J
  3907	005521'	201200	000000		MOVEI F,0		;JUST IN CASE
  3908	005522'	260051	000000		PUSHJ P,(T4)
  3909	005523'	334000	000000		 SKIPA
  3910	005524'	350001	000000		AOS (P)
  3911	005525'	200100	005516*		MOVE J,JOB
  3912	005526'	402002	005517*		SETZM JBTABT(J)
  3913	005527'	324740	005514*		PJRST GIVCBR
  3914
  3915	005530'	205300	005000	RRSET:	MOVSI T1,LICSTR!LICJAL
  3916	005531'	616302	005257*		TDNN T1,JBTLIC(J)		;MUST HAVE ENOUGH LICENSE
  3917	005532'	254000	005501'		JRST NPVERR
  3918	005533'	256200	006131'		UMOVE T1,(M)	;THIS IS THE UNIT NAME
  3919	005534'	211340	000001		MOVNI T2,1
  3920	005535'	260040	005757'		PUSHJ P,SRUNI
  3921	005536'	254000	005507'		 JRST UNFERR
  3922	005537'	254000	005507'		 JRST UNFERR	;DO NOT ACCEPT LOGICAL NAMES
  3923	005540'	550105	000000*		HRRZ J,UNIKON(U)
  3924	005541'	331002	000000*		SKIPL KONLTM(J)
  3925	005542'	254000	005504'		 JRST UNCERR	;ONLY FOR NON-CHANNEL DEVICES
  3926	005543'	254000	000000*		JRST RRSETB	;GO TO THE CODE IN FILIO
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 83
FILUUO.MAC	 8-DEC-87 11:25		M RETURNS AND ERROR CODES

  3927				;% SUBROUTINE TO GET JOB # & PPN FROM ARG. LIST AND CK FOR A MATCH
  3928				;% CALL:		M=ADDRESS-1 OF JOB # ARG.
  3929				;% 		    PPN ARG. FOLLOWS
  3930				;% RETURN+0	IF RIDICULOUS JOB # OR DOESNT MATCH PPN
  3931				;% 		M & J ARE CHANGED
  3932				;% RETURN+1	IF JOB # ARG. MATCHES PPN ARG.: J=JOB # ARG.
  3933				;% 		IF JOB # ARG.=PPN ARG.=-1: J=J (CURRENT JOB #)
  3934
  3935	005544'	256200	006131'	CKJPPN:	UMOVE T1,(M)		;% T1=JOB # (1ST ARG.)
  3936	005545'	326300	005553'		JUMPN T1,CKJPP2		;% NOT SYS
  3937	005546'	256200	006210'		UMOVE T1,1(M)
  3938	005547'	312300	003270*		CAME T1,SYSPPN
  3939	005550'	263040	000000		POPJ P,			;% NO MATCH
  3940	005551'	201100	000000		MOVEI J,0		;% JOB=0 FOR SYS SEARCH LIST
  3941	005552'	254000	005470*		JRST CPOPJ1
  3942	005553'	337000	000006	CKJPP2:	SKIPG	T1		;% IF -1: USE CURRENT JOB #
  3943	005554'	200300	000002		MOVE	T1,J
  3944	005555'	333000	000006		SKIPLE	T1		;% IS IT GOOD JOB #?
  3945	005556'	313300	003205*		CAMLE	T1,HIGHJB
  3946	005557'	263040	000000		POPJ	P,		;% NO
  3947	005560'	200106	000000*		MOVE	J,JBTSTS(T1)	;% MAYBE  (CK JNA BIT)
  3948	005561'	607100	040000		TLNN	J,JNA
  3949	005562'	263040	000000		POPJ	P,		;% NO
  3950	005563'	200100	000006		MOVE	J,T1		;% YES--MAKE J=JOB #
  3951	005564'	256200	006210'		UMOVE T1,1(M)		;% T1=PPN
  3952	005565'	337000	000006		SKIPG	T1		;% IF -1: USE CURRENT PPN
  3953	005566'	200302	005074*		MOVE	T1,JBTPPN(J)
  3954	005567'	312302	005566*		CAME	T1,JBTPPN(J)	;% IS PPN FOR THIS JOB #?
  3955	005570'	263040	000000		POPJ	P,		;% NO
  3956	005571'	254000	005552*		JRST	CPOPJ1		;% YES--GOOD MATCH
  3957
  3958
  3959				;SUBROUTINE TO CK FOR PRIVILEGED JOB (FAILSAFE PPN OR JACCT LIT)
  3960				;CALL:	JSP	T4,PRIVJ
  3961				;		J=JOB #
  3962				;		PRESERVES T1
  3963				;RETURNS IF PRIVILEGED OTHERWISE GOES TO NPVERR
  3964
  3965	005572'	205400	004000	PRIVJ:	MOVSI T3,LICSTR
  3966	005573'	612402	005531*		TDNE T3,JBTLIC(J)
  3967	005574'	254011	000000		JRST (T4)		;HE CAN DO IT
  3968	005575'	254000	005501'		JRST NPVERR	;NO- GIVE ERROR RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 84
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  3969				SUBTTL DSKCHR MUUO
  3970
  3971			000000	CODDSK==0		; generic DSK
  3972			000001	CODSFS==1		; file structure
  3973			000002	CODSTR==2		; structure name
  3974			000003	CODLUF==3		; logical unit in file structure
  3975			000004	CODKNC==4		; controller class
  3976			000005	CODKON==5		; controller name
  3977			000006	CODPUN==6		; logical unit of a controller
  3978
  3979	005576'	554400	000006	DSKCHR::HLRZ	T3,T1		;COMPUTE LAST ADDRESS OF TABLE
  3980	005577'	210100	000010		MOVN	J,T3
  3981	005600'	517000	000002		HRLZS	J
  3982	005601'	265440	005513'		JSP	T4,LOCK		;LOCK DATA SO IT CAN BE BELIEVED
  3983
  3984	005602'	540100	000006		HRR	J,T1		;% REMEMBER START OF ARG LIST
  3985	005603'	256200	006027'		UMOVE	T1,(T1)		;% GET DISK NAME
  3986	005604'	322300	004671*		JUMPE	T1,CPOPJ	;% ERROR IF ARG. ZERO
  3987	005605'	205000	000000		MOVSI	S,CODDSK	;% PRESUME ARG. TO BE "DSK". SET CODE ACCORDINGLY
  3988	005606'	261040	000002		PUSH	P,J		;% SAVE J
  3989	005607'	200100	005525*		MOVE	J,JOB		;% SET J TO CURRENT JOB
  3990	005610'	260040	000000*		PUSHJ	P,DEVLG		;% SEARCH ALL LOGICAL NAMES IN SYSTEM FOR A MATCH
  3991	005611'	254000	005617'		  JRST	DSKCHK		;% NO MATCH - CHECK FOR "DSK"
  3992	005612'	205340	200000		MOVSI	T2,DVDSK
  3993	005613'	616344	000004		TDNN	T2,DEVMOD(F)	;% IS IT A DISK?
  3994	005614'	254000	003477*		  JRST	TPOPJ		;% NO - EXIT
  3995	005615'	200304	000000		MOVE	T1,DEVNAM(F)	;% PICK UP
  3996	005616'	201200	000000		MOVEI	F,0		;% JUST TO MAKE SURE 0 IN CASE ERROR
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 85
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  3997				;% HERE TO SEE WHETHER C(T1) IS "DSK","DS" OR "D"
  3998
  3999	005617'	260040	005671'	DSKCHK:	PUSHJ	P,ALIASD	;% IS NAME AN ALIAS FOR "DSK"?
  4000	005620'	254000	005642'		  JRST	DSKFND		;% YES - FIND FIRST UNIT OF 1ST. STR FOR THIS JOB
  4001	005621'	205000	000002		MOVSI	S,CODSTR	;% PRESUME ARG. TO BE STR NAME
  4002	005622'	316300	006024'		CAMN T1,[SIXBIT /DSKB/]	;% ONLY STR ALLOWED
  4003	005623'	254000	005642'		  JRST	DSKFND		;% YES, USE FIRST UNIT
  4004	005624'	205000	000003		MOVSI	S,CODLUF	;%ASSUME LOG. UNIT IN STR
  4005	005625'	260040	005757'		PUSHJ	P,SRUNI		;% SCAN ALL PHYSICAL AND LOGICAL UNIT NAMES
  4006	005626'	254000	005614*		  JRST	TPOPJ		;% NO MATCH - EXIT
  4007	005627'	254000	005677'		  JRST	LOGCHK		;% MATCH ON LOGICAL NAME
  4008	005630'	450340	000000		SETCA	T2,0		;% MATCH ON PHYSICAL NAME
  4009	005631'	243340	005633'		JFFO	T2,.+2		;% DETERMINE # CHARS. IN ARG. FROM MASK
  4010					 STOPCD			;% ERROR - 6 CH. ARG. CAN'T MATCH WITH REMAINING NAME ;;DSKCHK+
  4011	005632'	256000	000000'	13
  4012	005633'	205000	000004		MOVSI	S,CODKNC	;% PRESUME KONTROLLER NAME
  4013	005634'	307400	000014		CAIG	T3,^D12		;% 1 OR 2 CHARS.?
  4014	005635'	254000	005701'		  JRST	FNDSTR		;% YES. SETUP USER AC
  4015	005636'	205000	000006		MOVSI	S,CODPUN	;% PRESUME PHYS. UNIT NAME
  4016	005637'	306400	000022		CAIN	T3,^D18		;% 3 CHARS.?
  4017	005640'	205000	000005		  MOVSI	S,CODKON	;% YES KONTROLLER NAME
  4018	005641'	254000	005701'		JRST	FNDSTR		;% DEPOSIT VALUE IN TABLE AND SETUP USER AC.
  4019
  4020				;HERE WHEN ARG. WAS OR IMPLIED "DSK" TO FIND FIRST UNIT OF JOB'S FIRST FILE STRUCTURE
  4021				PRINTF(<[DSKCHR @DSKFND setup P2 with default DSK structure, for this job.]>)
  4022	005642'	201640	005300*	DSKFND:	MOVEI	P2,STRDDB	;% DEFAULT (Only) STRUCTURE is DSKB
  4023	005643'	554255	000000*		HLRZ	U,STRUNI(P2)	;% USE FIRST UNIT IN STR FOR DSK OR DSKB
  4024	005644'	254000	005701'		JRST	FNDSTR		;% STR? found
  4025
  4026
  4027				;SUBR TO SEE IF SPECIAL UNIT IN STR IS DESIRED (CALLED BY INIT/OPEN).
  4028
  4029	005645'	200304	000004	TST1UN::MOVE	T1,DEVMOD(F)	;IS THIS A
  4030	005646'	607300	200000		TLNN	T1,DVDSK	;DISK?
  4031	005647'	263040	000000		  POPJ	P,		;NO.
  4032	005650'	200304	000000		MOVE	T1,DEVNAM(F)	;YES. IS IT DSK OR
  4033	005651'	260040	005671'		PUSHJ	P,ALIASD	;DS OR D?
  4034	005652'	263040	000000		  POPJ	P,		;YES.
  4035	005653'	316300	006024'		CAMN	T1,[SIXBIT/DSKB/] ;NO, DSKB?
  4036	005654'	263040	000000		  POPJ	P,		;YES.
  4037	005655'	201640	005642*		MOVEI	P2,STRDDB	;No, Check each unit on each STR
  4038	005656'	554255	005643*	TST1U0:	HLRZ	U,STRUNI(P2)	;NO, MAYBE A SPECIAL
  4039	005657'	312305	005324*	TST1U2:	CAME	T1,UNINAM(U)	;UNIT?
  4040	005660'	316305	000000*		CAMN	T1,UNILOG(U)	;
  4041	005661'	254000	005667'		  JRST	TST1U5		;YES.
  4042	005662'	554245	000071*		HLRZ	U,UNISTR(U)	;TRY AGAIN.
  4043	005663'	326240	005657'		JUMPN	U,TST1U2	;
  4044	005664'	554655	005275*		HLRZ	P2,STRNXT(P2)	; Go through all STRs (only 1) ***
  4045	005665'	326640	005656'		JUMPN	P2,TST1U0	; Next STR?
  4046	005666'	263040	000000		POPJ	P,		; No.
  4047				EXTERN DEV1UN
  4048	005667'	202244	002326*	TST1U5:	MOVEM	U,DEV1UN(F)	;SPECIAL UNIT.
  4049	005670'	263040	000000		POPJ	P,
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 85-2
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4050
  4051
  4052				;SUBROUTINE TO TEST IF A NAME IS AN ALIAS FOR "DSK"
  4053				;ENTER WITH NAME IN T1
  4054				;EXIT NAME IN T1, MASK IN T2
  4055				;RETURN CPOPJ IF NAME IS AN ALIAS FOR "DSK", CPOPJ1 OTHERWISE
  4056
  4057	005671'	260040	005746'	ALIASD::PUSHJ	P,MSKUNI	;GENERATE MASK IN T2 FROM # OF CHARS. IN T1
  4058	005672'	205400	446353		MOVSI	T3,(SIXBIT .DSK.)
  4059	005673'	404400	000007		AND	T3,T2		;MASK OUT SUPERFLUOUS CHARS
  4060	005674'	312300	000010		CAME	T1,T3		;MATCH ON "D", "DS" OR "DSK"?
  4061	005675'	350001	000000		  AOS	(P)		;NO. SET FOR SKIP RETURN
  4062	005676'	263040	000000		POPJ	P,		;RETURN CPOPJ OR CPOPJ1
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 86
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4063				;% HERE WHEN A MATCH IS FOUND BETWEEN LOGICAL NAME(UNILOG) & C(T1)
  4064
  4065	005677'	312305	005660*	LOGCHK:	CAME	T1,UNILOG(U)	;% EXACT MATCH WITH LOGICAL UNIT NAME?
  4066	005700'	201000	000001		  MOVEI	S,CODSFS	;% NO - MUST BE SUBSET OF STRS
  4067	005701'	200305	000000*	FNDSTR:	MOVE	T1,UNIDES(U)	;% LOAD UP BITS FOR USER AC.
  4068	005702'	621300	000377		TLZ	T1,377		;% GET RID OF UNIT BLOCK SIZE
  4069	005703'	434300	000000		IOR	T1,S		;% "OR" IN ARG. TYPE CODE.
  4070	005704'	262040	000002	FNDST1:	POP	P,J		;% RESTORE USER ARG
  4071	005705'	256200	006302'		UMOVEM	T1,(W)		;% STORE BITS IN USER AC.
  4072	005706'	252100	005571*		AOBJP	J,CPOPJ1	;% IS LENGTH >1?
  4073	005707'	205300	777756		MOVSI	T1,MATLEN	;% SETUP LENGTH & INDEX INTO ARGTAB
  4074	005710'	550645	005662*		HRRZ	P2,UNISTR(U)	;% UP PTR TO STR DATA BLOCK =0 IF NOT IN STR
  4075	005711'	200600	006303'		MOVE	P1,[647210,,0]	;% BITS=1 FOR ARGS TO IGNORE IF NO FS
  4076	005712'	603600	400000	ARGLUP:	TLNE	P1,400000	;% HIGH ORDER BIT A 1, THEN CHECK STR
  4077	005713'	332000	000015		  SKIPE	P2		;% IGNORE IF NO FS
  4078	005714'	334000	000000		 SKIPA			;% ALWAYS RETURN OR IN FS
  4079	005715'	634340	000007		TDZA	T2,T2		;% IGNORE, RETURN 0
  4080	005716'	256006	005724'		  XCT	ARGTAB(T1)
  4081	005717'	242600	000001		LSH	P1,1		;% AND SHIFT FOR NEXT TEST
  4082	005720'	256200	006304'		UMOVEM	T2,(J)		;% DEPOSIT IN TABLE
  4083	005721'	252100	005706*		AOBJP	J,CPOPJ1	;% FINISHED?
  4084	005722'	253300	005712'		AOBJN	T1,ARGLUP	;% NO INCREMENT INDEX
  4085	005723'	254000	005721*		JRST	CPOPJ1		;% RETURN
  4086
  4087	005724'	260040	000000*	ARGTAB:	PUSHJ	P,GUFBT			;LOC+1(.UFTAL)	UFD  QUOTA LEFT
  4088	005725'	200355	000000*		MOVE	T2,STRTAL(P2)		;LOC+2(.STTAL)	STR  SPACE LEFT
  4089	005726'	200345	002330*		MOVE	T2,UNITAL(U)		;LOC+3(.UNTAL)	UNIT SPACE LEFT
  4090	005727'	200355	005302*		MOVE	T2,STRNAM(P2)		;LOC+4(.STNAM)	STR  NAME
  4091	005730'	200345	000000*		MOVE	T2,UNICHR(U)		;LOC+5(.UNCHR)	UNIT CHARs
  4092	005731'	200345	000000*		MOVE	T2,UNIPPU(U)		;LOC+6(.UNPPU)	# PAGES on UNIT
  4093	005732'	201340	000000		MOVEI	T2,0			;LOC+7(.STMNT)	MOUNT COUNT
  4094	005733'	135340	000000*		LDB	T2,UNYWPS		;LOC+10(.UNWPS)	WORDS PER SAT
  4095	005734'	135340	000000*		LDB	T2,UNYSPU		;LOC+11(.UNSPU)	SATS PER UNIT
  4096	005735'	200345	000000*		MOVE	T2,UNIFEP(U)		;LOC+12(.UNFEP) FE FILE PAGES
  4097	005736'	201340	000000		MOVEI	T2,0			;LOC+13(.STJOB)	SINGLE ACCESS JOB
  4098	005737'	200345	005677*		MOVE	T2,UNILOG(U)		;LOC+14(.UNLOG)	STR LOGICAL UNIT
  4099	005740'	200345	005657*		MOVE	T2,UNINAM(U)		;LOC+15(.UNNAM) KON UNIT NAME
  4100	005741'	200345	000000*		MOVE	T2,UNIHID(U)		;LOC+16(.UNHID)	UNIT ID
  4101	005742'	201355	000000*		MOVEI	T2,STRSID(P2)		;LOC+17(.STSID) STR SET ID
  4102	005743'	200340	006305'		MOVE T2,[LPNHOM##,,LP2HOM##]	;LOC+20(.UNHA)	HOME ADDRESS
  4103	005744'	200340	006306'		MOVE T2,[LPNBAT##,,LP2BAT##]	;LOC+21(.UNBA)	BAT ADDRESS
  4104				IFCPU (KS),<PUSHJ P,GETBSA>		; LOC+22(.UNBSA) BOOTS ADDRESS
  4105	005745'	200340	006307'	IFNCPU(KS),<MOVE T2,[NBOOTP##,,FBOOTB##]>;LOC+22(.UNBSA) BOOTS ADDRESS
  4106		777777	777756	MATLEN==ARGTAB-.		;ADD NEW ENTRIES TO TABLE HERE
  4107
  4108				IFCPU (KS),<
  4109				GETBSA:	SKIPN	UNIFEP##(U)		;Has the 8080 area been moved?
  4110					 SKIPA	T2,[100,,10]		;No, give expected value to DSKCLN
  4111					MOVE	T2,[NBOOTP##,,FBOOTB##]	;Yes, KS-BOOTS is now 3 starting at 3
  4112					POPJ	P,
  4113				>  ;End IFCPU(KS)
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 87
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4114				;SUBROUTINE TO SET UP A SEARCH-MASK FOR A NAME
  4115				;ENTER WITH T1 =NAME
  4116				;EXIT WITH T1=NAME, T2=MASK
  4117
  4118	005746'	336340	000006	MSKUNI:	SKIPN	T2,T1		;GET NAME
  4119	005747'	263040	000000		  POPJ	P,		;NOT A NAME - RETURN MASK =0
  4120	005750'	205400	770000		MOVSI	T3,770000	;SET  UP MASK
  4121	005751'	676340	000010	UNIMS1:	TDON	T2,T3		;THIS CHARACTER 0?
  4122	005752'	254000	005755'		  JRST	UNIMS2		;YES. HAVE MASK
  4123	005753'	242400	777772		LSH	T3,-6		;NO, SHIFT AND TRY NEXT CHAR
  4124	005754'	326400	005751'		JUMPN	T3,UNIMS1
  4125	005755'	630340	000010	UNIMS2:	TDZ	T2,T3		;0 THE LAST BYTE
  4126	005756'	263040	000000		POPJ	P,		;AND RETURN WITH MASK IN T2
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 88
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4127				;SUBROUTINE TO SEARCH UNIT DATA BLOCKS FOR A MATCH BETWEEN C(T1)
  4128				;AND AN EQUIVALENT NUMBER OF CHARACTERS OF UNILOG AND UNINAM
  4129				;CALL	MOVE	T2,MASK
  4130				;	MOVE	T1,SIXBIT NAME OF FILE STRUCTURE,UNIT,KONTROLLER, ETC.
  4131				;	PUSHJ	P,SRUNI
  4132				;	  NON MATCH RETURN	T1 & T2 ARE RESPECTED. U IS 0
  4133				;	  LOGICAL NAME MATCH	T1 & T2 ARE RESPECTED. U IS THE ADR. OF UNIT DATA BLOCK.
  4134				;	PHYSICAL NAME MATCH
  4135
  4136	005757'	554240	005312*	SRUNI::	HLRZ	U,SYSUNI	;GET ADR. OF FIRST UNIT IN SYSTEM
  4137	005760'	200405	005737*	LUPUNI:	MOVE	T3,UNILOG(U)	;GET LOGICAL UNIT NAME WITHIN STR
  4138	005761'	606340	007700		TRNN	T2,007700	;Don't stop at DSKB10 when looking for DSKB1
  4139	005762'	404400	000007		 AND	T3,T2		;MASK OUT UNWANTED CHARS.
  4140	005763'	316300	000010		CAMN	T1,T3		;MATCH?
  4141	005764'	254000	005723*		 JRST	CPOPJ1		;YES - FOUND A LOGICAL UNIT MATCH RETURN
  4142	005765'	200405	005740*		MOVE	T3,UNINAM(U)	;GET PHYSICAL UNIT NAME
  4143	005766'	606340	770000		TRNN	T2,770000	;Don's stop at BPA10 when looking for BPA1
  4144	005767'	404400	000007		 AND	T3,T2		;MASK
  4145	005770'	316300	000010		CAMN	T1,T3		;MATCH?
  4146	005771'	254000	000000*		 JRST	CPOPJ2		;YES - FOUND A PHYSICAL UNIT MATCH RETURN
  4147	005772'	554245	005322*		HLRZ	U,UNISYS(U)	;GET ADR. OF NEXT UNIT IN SYSTEM
  4148	005773'	326240	005760'		JUMPN	U,LUPUNI	;LAST ONE?
  4149	005774'	263040	000000		POPJ	P,		;YES - RETURN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4150				;SUBROUTINE TO COMPUTE SIXBIT LOGICAL UNIT NUMBER WITHIN STR
  4151				; T1 HAS NUMBER WITHIN STR IN RH, LH GARBAGE.
  4152
  4153				INTERN CMPLOG
  4154	005775'	261040	000016	CMPLOG:	PUSH	P,P3
  4155	005776'	550700	000006		HRRZ	P3,T1
  4156	005777'	242700	777775		LSH	P3,-^D3
  4157	006000'	271700	000020		ADDI	P3,20
  4158	006001'	242700	000006		LSH	P3,^D6
  4159	006002'	405300	000007		ANDI	T1,7
  4160	006003'	271706	000020		ADDI	P3,20(T1)
  4161	006004'	200300	006024'		MOVE	T1,[SIXBIT /DSKB/]	; Needs thought, STR setup somewhere?
  4162	006005'	260040	005746'		PUSHJ	P,MSKUNI
  4163	006006'	450340	000000		SETCA	T2,0
  4164	006007'	243340	006011'		JFFO	T2,.+2
  4165	006010'	256000	000000'		 STOPCD (SLO)
  4166				           ;;CMPLOG+13
  4167	006011'	201340	000030		MOVEI	T2,^D24
  4168	006012'	602700	000700		TRNE	P3,700
  4169	006013'	254000	006016'		  JRST	INSUN2
  4170	006014'	620700	007700		TRZ	P3,7700
  4171	006015'	201340	000036		MOVEI	T2,^D30
  4172	006016'	274340	000010	INSUN2:	SUB	T2,T3
  4173	006017'	242707	000000		LSH	P3,(T2)
  4174	006020'	270300	000016		ADD	T1,P3
  4175	006021'	202305	005760*		MOVEM	T1,UNILOG(U)
  4176	006022'	262040	000016		POP	P,P3
  4177	006023'	263040	000000		POPJ	P,
  4178
  4179	006024'	446353	420000		$END	(FUU)

  4180	006025'	202313	000000

  4181	006026'	270400	000013

  4182	006027'	200306	000000

  4183	006030'	200753	000001

  4184	006031'	510653	000002

  4185	006032'	402013	000007

  4186	006033'	335013	000003

  4187	006034'	336313	000004

  4188	006035'	326700	000320'

  4189	006036'	200300	000017

  4190	006037'	621300	400000

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-2
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4191	006040'	550340	000000*

  4192	006041'	230300	000007

  4193	006042'	200300	000007

  4194	006043'	254000	000320'

  4195	006044'	000040	020000

  4196	006045'	260040	003471*

  4197	006046'	670000	006044'

  4198	006047'	324740	002006*

  4199	006050'	660000	100000

  4200	006051'	324740	006047*

  4201	006052'	200413	000005

  4202	006053'	554453	000006

  4203	006054'	200453	000000

  4204	006055'	262040	000016

  4205	006056'	262040	000017

  4206	006057'	254000	000551'

  4207	006060'	124711	777777

  4208	006061'	200413	000003

  4209	006062'	202311	000000

  4210	006063'	140200	000017

  4211	006064'	206311	000000

  4212	006065'	202711	000000

  4213	006066'	111000	000017

  4214	006067'	210400	000017

  4215	006070'	202751	000000

  4216	006071'	350013	000007

  4217	006072'	336013	000007
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-3
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO


  4218	006073'	554300	000015

  4219	006074'	344300	000542'

  4220	006075'	124313	000005

  4221	006076'	202313	000004

  4222	006077'	000000	020000

  4223	006100'	120000	000000

  4224	006101'	211600	000001

  4225	006102'	201640	000000

  4226	006103'	263040	000000

  4227	006104'	030303	030303

  4228	006105'	200100	000007

  4229	006106'	254000	000706*

  4230	006107'	000000*	000000*

  4231	006110'	260040	005235*

  4232	006111'	254000	001471'

  4233	006112'	000000	000001

  4234	006113'	000000*	000000*

  4235	006114'	262040	000016

  4236	006115'	254000	001755'

  4237	006116'	260040	000000*

  4238	006117'	654644	456221

  4239	006120'	000010	000000

  4240	006121'	260040	000000*

  4241	006122'	424144	654644

  4242	006123'	400005	000000

  4243	006124'	000000	000000*

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-4
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4244	006125'	260040	006116*

  4245	006126'	656557	706762

  4246	006127'	000010	000000

  4247	006130'	202313	000002

  4248	006131'	200313	000000

  4249	006132'	242300	777771

  4250	006133'	254000	002127'

  4251	006134'	516313	000003

  4252	006135'	542313	000001

  4253	006136'	542313	000003

  4254	006137'	202313	000005

  4255	006140'	202320	000013

  4256	006141'	376000	376001

  4257	006142'	000000*	376000*

  4258	006143'	334356	000000

  4259	006144'	000037	777777

  4260	006145'	141300	000007

  4261	006146'	270400	000007

  4262	006147'	001400	000007

  4263	006150'	140200	000006

  4264	006151'	202356	000000

  4265	006152'	550453	000003

  4266	006153'	160200	000011

  4267	006154'	542453	000003

  4268	006155'	542453	000001

  4269	006156'	200313	000004

  4270	006157'	200353	000003
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-5
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO


  4271	006160'	213000	000006

  4272	006161'	254000	002732'

  4273	006162'	200413	000000

  4274	006163'	336353	000011

  4275	006164'	001777	777777

  4276	006165'	313340	006164'

  4277	006166'	263040	000000

  4278	006167'	242340	000007

  4279	006170'	254000	002762'

  4280	006171'	200353	000011

  4281	006172'	000000*	000000

  4282	006173'	200613	000000

  4283	006174'	203313	000003

  4284	006175'	135400	004726*

  4285	006176'	200310	005567*

  4286	006177'	254000	003053'

  4287	006200'	202313	000003

  4288	006201'	203013	000000

  4289	006202'	203006	000000

  4290	006203'	334313	000000

  4291	006204'	200313	000002

  4292	006205'	334313	000001

  4293	006206'	200313	000003

  4294	006207'	334313	000003

  4295	006210'	200313	000001

  4296	006211'	205340	637163

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-6
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4297	006212'	400400	000000

  4298	006213'	254000	005764*

  4299	006214'	637163	000000

  4300	006215'	200300	005547*

  4301	006216'	254000	006213*

  4302	006217'	120346	000000

  4303	006220'	555555	555555

  4304	006221'	361275	431652

  4305	006222'	612754	316523

  4306	006223'	200310	000000

  4307	006224'	200310	000001

  4308	006225'	343277	244615

  4309	006226'	002001	000440*

  4310	006227'	260040	006125*

  4311	006230'	656362	656321

  4312	006231'	400003	003471'

  4313	006232'	000000	000000*

  4314	006233'	000001*	000440*

  4315	006234'	000001	000440*

  4316	006235'	202541	777775

  4317	006236'	254000	003457'

  4318	006237'	120413	000000

  4319	006240'	000000	000000*

  4320	006241'	334713	000004

  4321	006242'	200713	000002

  4322	006243'	256200	006130'

  4323	006244'	254000	004252'
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-7
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO


  4324	006245'	260040	006110*

  4325	006246'	254000	004365'

  4326	006247'	200320	000013

  4327	006250'	200353	000000

  4328	006251'	202313	000011

  4329	006252'	202313	000017

  4330	006253'	202313	000025

  4331	006254'	202313	000024

  4332	006255'	202313	000014

  4333	006256'	000000*	777777

  4334	006257'	220200	000007

  4335	006260'	000200	000007

  4336	006261'	240200	000007

  4337	006262'	020200	000007

  4338	006263'	336353	000000

  4339	006264'	000000*	000000*

  4340	006265'	260040	005217*

  4341	006266'	513004	005224*

  4342	006267'	254000	005133'

  4343	006270'	260040	006227*

  4344	006271'	435462	435521

  4345	006272'	000010	000000

  4346	006273'	202353	000000

  4347	006274'	202653	000000

  4348	006275'	402013	000001

  4349	006276'	402013	000002

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 89-8
FILUUO.MAC	 8-DEC-87 11:25		DSKCHR MUUO

  4350	006277'	332013	000002

  4351	006300'	336013	000002

  4352	006301'	200653	000001

  4353	006302'	202312	000000

  4354	006303'	647210	000000

  4355	006304'	202342	000000

  4356	006305'	000000*	000000*

  4357	006306'	000000*	000000*

  4358	006307'	000000*	000000*

  4359						;End of FILUUO (FUULIT: FUUEND:)
  4360
NO ERRORS DETECTED
PROGRAM BREAK IS 006310
10K CORE USED
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 90
FILUUO.MAC	 8-DEC-87 11:25		SYMBOL TABLE

ADJMWS		000233'	EXT	ATMCNT		000000	EXT	CLFAL1		004527'		CLRNT1		005127'	
AEFERR		000004	SIN	ATMCSC		000000	EXT	CLFAL2		004537'		CLSACC		000010	SIN
ALCCHK		002752'		ATMMWC		002647'	EXT	CLFALC		004524'		CLSDMP		100000	SIN
ALIASD		005671'	INT	ATMUFP		000000	EXT	CLFLC1		004745'		CLSIN		000002	SIN
ARGALC	040000	000000	SPD	ATMUFU		004732'	EXT	CLFLIC		004721'		CLSIN2		001062'	
ARGALP		040000	SPD	ATMUMC		004000'	EXT	CLFMX1		004661'		CLSIN3		001141'	
ARGALT		000400	SPD	ATPALC		001722'	EXT	CLFMX2		004663'		CLSIN4		001167'	
ARGAUT	000002	000000	SPD	ATPCNT		001206'	EXT	CLFMX3		004654'		CLSIN5		001176'	
ARGDEV	001000	000000	SPD	ATPCRE		002463'	EXT	CLFMXA		004644'		CLSIN6		001175'	
ARGELB	000200	000000	SPD	ATPDEL		003665'	EXT	CLFNPS		004553'		CLSIN7		001077'	
ARGEST	100000	000000	SPD	ATPDIR		004557'	EXT	CLFPID		004671'		CLSIN8		001101'	
ARGEUN	000100	000000	SPD	ATPDMP		001107'	EXT	CLFPIO		004704'		CLSN2A		001131'	
ARGFT1	010000	000000	SPD	ATPMXU		002636'	EXT	CLFPIS		004706'		CLSN2B		001114'	
ARGFUT	200000	000000	SPD	ATPNDL		003575'	EXT	CLFPIZ		004711'		CLSN3A		001153'	
ARGLIC	004000	000000	SPD	ATPPID		004711'	EXT	CLFQT1		004604'		CLSN3B		001161'	
ARGLUP		005712'		ATPREN		005177'	EXT	CLFQT2		004601'		CLSOU0		001243'	
ARGMTA	002000	000000	SPD	ATPSUP		002421'	EXT	CLFQT3		004605'		CLSOU1		001241'	
ARGMXA	000010	000000	SPD	ATPUFE		004256'	EXT	CLFQTF		004557'		CLSOU2		001315'	
ARGPID		001000	SPD	ATPUPD		003633'	EXT	CLFSTS		004544'		CLSOU3		001363'	
ARGPJ0		010000	SPD	ATT1		000710'	EXT	CLFUM1		004613'		CLSOUT		000001	SIN
ARGPJ1		004000	SPD	ATYADT		002662'	EXT	CLFUN1		004615'		CLSRST		000040	SIN
ARGPJ2		002000	SPD	ATYBLK		004532'	EXT	CLFUNM		004607'		CLSXIT		001204'	
ARGPOS	020000	000000	SPD	ATYBSZ		000326'	EXT	CLFUS1		004631'		CLSXT1		001200'	
ARGPVS		000200	SPD	ATYCDT		002734'	EXT	CLFUS2		004636'		CLSXT2		001210'	
ARGQTF	000040	000000	SPD	ATYCNT		003777'	EXT	CLFUS3		004633'		CMBLNK		001173'	EXT
ARGQTO	000020	000000	SPD	ATYCSC		002742'	EXT	CLFUSD		004621'		CMPLOG		005775'	INT
ARGSNM		020000	SPD	ATYCTD		004221'	EXT	CLIBDR		001053'		CNVVPN		000440	SIN
ARGSTS	000400	000000	SPD	ATYCTM		002741'	EXT	CLIDEL		001033'		CODDSK		000000	SPD
ARGTAB		005724'		ATYPRV		004205'	EXT	CLOCM1		001513'		CODKNC		000004	SPD
ARGTRU		200000	SPD	ATYUF1		001650'	EXT	CLOCM2		001525'		CODKON		000005	SPD
ARGUFD		100000	SPD	ATYUF2		001636'	EXT	CLOCOM		001471'		CODLUF		000003	SPD
ARGUN1		400000	SPD	ATYXCD		004220'	EXT	CLORS1		001257'		CODPUN		000006	SPD
ARGUNM	000001	000000	SPD	B2PLSH	777777	777776	SPD	CLORS2		001271'		CODRIB		002503'	EXT
ARGUSD	000004	000000	SPD	B2WLSH		000007	SPD	CLORS3		001272'		CODSFS		000001	SPD
ARGVER	400000	000000	SPD	BADUFD		001757'	INT	CLORST		001307'		CODSTR		000002	SPD
ASSCON		400000	SIN	BLKLNK		003431'		CLOSCR		001444'		COMERA		006106'	EXT
ASSPRG		200000	SIN	CBUSER		002015'	EXT	CLOSE1		004322'	EXT	CPOPJ		005604'	EXT
ATBALP		004027'	EXT	CHANIO	043000	000000		CLOSIN		001007'		CPOPJ1		006216'	EXT
ATBCNT		005144'	EXT	CHGNAM		001001'	INT	CLOSOU		001216'		CPOPJ2		005771'	EXT
ATBDOR		005226'	EXT	CHGPPN		000766'	INT	CLOSRN		001030'		CPRRED		000001	SIN
ATBFNB		005216'	EXT	CHKAG1		003040'		CLOSU1		001406'		CPUKS		000003	SPD
ATBLCW		004751'	EXT	CHKAGX		003062'		CLOSU2		001421'		CPUTYP		000002	SPD
ATBLIC		005072'	EXT	CHKARG		003035'		CLOSU3		001437'		CPZZ		000000	SPD
ATBLNK		004053'	EXT	CHKPP1		003053'		CLOSU4		001423'		CRBRWL		001430'	EXT
ATBMSC		004222'	EXT	CHKPP2		003057'		CLOUF1		001463'		CREUFD		001545'	
ATBMWC		002646'	EXT	CHKPPN		003047'		CLOUPD		001465'		CRLF		000743'	EXT
ATBPID		004707'	EXT	CHKPRV		004143'	EXT	CLRAC0		001722'		CURUPT		000000	EXT
ATBPRV		002425'	EXT	CHKSGJ		000712'	EXT	CLRACH		001706'		DATCOM		000457'	EXT
ATBPVW		004224'	EXT	CKJPP2		005553'		CLRCM1		005135'	INT	DBRLP		004101'	
ATBRIB		004401'	EXT	CKJPPN		005544'		CLRCOM		005130'		DBRNXT		004121'	
ATBSIZ		004025'	EXT	CLCALC		002235'		CLRDD1		000662'		DBYT		000002	SIN
ATBSTS		005200'	EXT	CLCMXA		002241'		CLRDDB		000661'	INT	DCL		000007	SIN
ATBUMC		004001'	EXT	CLCUSD		002264'		CLRENT		005125'		DCLI		000023	SIN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 90-2
FILUUO.MAC	 8-DEC-87 11:25		SYMBOL TABLE

DCTBSZ		000003	SPD	DLTNAM		004362'	EXT	DSKUGF		000155'		FNBDRB		001156'	EXT
DDBCOR		000672'	EXT	DLTTRC		004240'	EXT	DSLSTR		005412'		FNBEXT		004134'	EXT
DDBLEN		000010'	EXT	DMOVPG		000037	SIN	DSO		000022	SIN	FNBLNK		001170'	EXT
DDI	777777	777777	SIN	DMT		000014	SIN	DSPSIZ		000037	SPD	FNBNAM		004327'	EXT
DDINT		000001	SIN	DOU		000010	SIN	DUFD		000024	SIN	FNBNX		004420'	EXT
DDO	777777	777776	SIN	DRBALC		004655'	EXT	DVDSK		200000	SIN	FNBRIB		004421'	EXT
DDXZ		000000	SIN	DRBCNT		005220'	EXT	DVMAP		000026	SIN	FNBUPD		002645'	EXT
DECENT		000004	SPD	DRBFNB		001160'	EXT	DVSIZ		000003	SIN	FNCAPP		002613'	EXT
DECIN		000704'	EXT	DRBLNK		003232'	EXT	DVSMAP		000034	SIN	FNCCAT		003005'	EXT
DECLUK		000001	SPD	DRBLOG		001530'	EXT	DZAP		000012	SIN	FNCCNM		006240'	EXT
DECSTP		000005	SPD	DRBMXA		004666'	EXT	ECOD		005510'		FNCCPR		004142'	EXT
DECUP2		000003	SPD	DRBNAM		004136'	EXT	ECOD0		005471'		FNCCRE		003747'	EXT
DECUPD		000002	SPD	DRBNX		003625'	EXT	ECOD1		005472'		FNCDEL		003714'	EXT
DELGRP		002770'		DRBRIB		004567'	EXT	ECOD10		005501'		FNCEXC		002100'	EXT
DEN		000016	SIN	DRBUN1		004616'	EXT	ECOD11		005502'		FNCLOK		002073'	EXT
DEV1UN		005667'	EXT	DRBUNM		004610'	EXT	ECOD12		005503'		FNCRED		002110'	EXT
DEVATB		006266'	EXT	DRL		000006	SIN	ECOD13		005504'		FNCSUP		002317'	EXT
DEVDBL		004122'	EXT	DRMCNT		003621'	EXT	ECOD14		005505'		FNCTRN		002770'	EXT
DEVDRB		005225'	EXT	DRN		000020	SIN	ECOD15		005506'		FNCUPD		002617'	EXT
DEVELB		000000	EXT	DRPLOG		001527'	EXT	ECOD16		005507'		FNDDRB		004565'	EXT
DEVEXT		000016	SIN	DRPMXC		005221'	EXT	ECOD2		005473'		FNDNGT		002117'	
DEVFIL		000015	SIN	DRPNX		003624'	EXT	ECOD3		005474'		FNDROK		002106'	
DEVFLO		003272'	EXT	DRYCNT		000244'	EXT	ECOD4		005475'		FNDST1		005704'	
DEVIAD		000007	SIN	DRYPRV		004207'	EXT	ECOD5		005476'		FNDSTR		005701'	
DEVIOS		000002	SIN	DSEK		000025	SIN	ECOD6		005477'		FNFERR		000000	SIN
DEVLG		005610'	EXT	DSI		000021	SIN	ECOD7		005500'		FNPNX		004417'	EXT
DEVLOG		000005	SIN	DSIM		000032	SIN	ENTER1		005147'		FNYUFP		004356'	EXT
DEVMOD		000004	SIN	DSKCHK		005617'		ENTER2		005152'		FOUND		002071'	
DEVNAM		000000	SIN	DSKCHR		005576'	INT	ENTRB		020000	SIN	FOUND1		002127'	
DEVPOS		002003'	EXT	DSKCL1		000244'		EPT		000000	EXT	FOUND2		002135'	
DEVPPN		000017	SIN	DSKCL2		000235'		ERNSET		003514'		FOUND3		002153'	
DEVRB1		000000	EXT	DSKCL3		000226'		ERRLKM		005155'		FOUND4		002155'	
DEVRET		000342'	EXT	DSKCL4		000222'		ERRNET		005157'		FOUND5		002162'	
DEVRIB		003573'	EXT	DSKCL5		000254'		ETSLUP		005461'		FOUND8		002172'	
DEVSER		000003	SIN	DSKCL6		000250'		ETSSTR		005450'		FPCSET		000231'	EXT
DEYSTC		005205'	EXT	DSKCL7		000262'		ETSTAB		005463'	EXT	FREACC		001042'	
DEYTCT		000000	EXT	DSKCLN		006124'	EXT	ETSUNI		005465'	EXT	FREATB		006265'	EXT
DFCRE		000030	SIN	DSKCLR		000212'	INT	EXTUUO		200000	SIN	FUNM		003437'	
DFDEL		000027	SIN	DSKCM1		000720'		F		000004	INT	FUNM1		003457'	
DFEXC		000031	SIN	DSKCM2		000730'		FALHOL		003376'	EXT	FUTAB		004470'	
DFFIF		000035	SIN	DSKCOM		000704'	INT	FALPHP		003377'	EXT	FUUEND		006307'	INT
DFTRN		000036	SIN	DSKCTB		000207'		FBIT		002335'	EXT	FUULIT		006024'	INT
DFVLR		000033	SIN	DSKDDB		003251'	EXT	FBMERR		000003	SIN	GERIFS		005474'	SPD
DGF		000015	SIN	DSKDSP		000005'	INT	FBOOTB		006307'	EXT	GERILL		005503'	SPD
DGTRD		000013	SIN	DSKFND		005642'		FILLIC		004754'	INT	GERPPN		005477'	SPD
DHNG		000005	SIN	DSKINC		000750'		FILUUO		000000'	ENT	GET4WD		000642'	EXT
DIE		006270'	EXT	DSKKJB		000756'	INT	FINNXB		000542'		GETB		000010	SIN
DIN		000011	SIN	DSKKLP		000760'		FINSUP		000530'		GETCBR		005513'	EXT
DINI		000004	SIN	DSKLGO		000174'		FINUS0		000554'		GETER1		000000	EXT
DIRBLK		004344'	EXT	DSKREL		001773'		FNBALT		004247'	EXT	GETEXT		003107'	
DIRSRC		004346'	EXT	DSKRES		000000	SIN	FNBAPD		003030'	EXT	GETGMT		002733'	EXT
DLK		000017	SIN	DSKUG1		000170'		FNBATB		001405'	EXT	GETLI1		005071'	INT
DLTALL		001433'	EXT	DSKUG2		000172'		FNBDBL		004110'	EXT	GETLIC		005065'	INT
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 90-3
FILUUO.MAC	 8-DEC-87 11:25		SYMBOL TABLE

GETNAM		003103'		JBTUN1		003200'	EXT	LOGTST		001527'		P		000001	INT
GETPPN		003113'		JBTUNM		003177'	EXT	LOKLL5		003247'		P1		000014	INT
GETUPG		002336'	EXT	JBTWCT		000000	EXT	LOKLUD		003237'		P2		000015	INT
GETWDS		000000	EXT	JBYIRD		000752'	EXT	LOKPPB		005445'	EXT	P3		000016	INT
GIV4WD		000675'	EXT	JBYRCT		000750'	EXT	LOKUNM		000324'	EXT	P4		000017	INT
GIVCB1		000270'	EXT	JBYWCT		000740'	EXT	LOOKB		040000	SIN	PCBCLR		000235'	EXT
GIVCBR		005527'	EXT	JBYWPT		004677'	EXT	LP2BAT		006306'	EXT	PCDTIM		004246'	EXT
GIVPAG		000000	EXT	JFYSEC		002737'	EXT	LP2HOM		006305'	EXT	PDNMUP		000227'	EXT
GIVWDS		000000	EXT	JNA		040000	SIN	LPNBAT		000000	EXT	PE.NER		000000	EXT
GOBSTR		005326'	INT	JOB		005607'	EXT	LPNHOM		000000	EXT	PERSET	047000	777706	
GTCGSZ		003515'	EXT	JOBN		000707'	EXT	LPPN		000000	SPD	PG		000003	INT
GUFBT		005724'	EXT	JOBST0		005347'		LUDER0		003464'		PIDACC		003062'	EXT
HIGHJB		005556'	EXT	JOBST1		005354'		LUDER1		003471'		PJOBN		006175'	EXT
ICLOSB		002000	SIN	JOBST2		005357'		LUDER2		003475'		PJRST	324740	000000	
ILFERR		005471'	SPD	JOBST8		005360'		LUDERR		003460'		PJSP	265000	000000	
ILLERR		005503'	SPD	JOBSTR		005343'	INT	LUDHSH		001567	SPD	PJUMPE	322000	000000	
ILNMER		005105'		KFCRE		000035'	EXT	LUKER1		005107'		PPNERR		005477'	SPD
INBLT		000004'	EXT	KFDEL		000034'	EXT	LUPUNI		005760'		PPNUS1		003132'	
INDPPN		000000	EXT	KFEXC		000036'	EXT	M		000013	INT	PPNUS2		003140'	
INLMES		000735'	EXT	KFFIFP		000042'	EXT	MAPB		000004	SIN	PPNUS3		003142'	
INPB		010000	SIN	KFTRN		000043'	EXT	MAPID		000035	SPD	PPNUS4		003150'	
INSNAM		004371'	EXT	KMAPP		000033'	EXT	MAPRDU		000346'	EXT	PPNUS5		003160'	
INSUN2		006016'		KMOVPG		000044'	EXT	MAPRLS		000000	EXT	PPNUS6		003167'	
INVDDB		003033'	EXT	KONLTM		005541'	EXT	MAPWLN		002343'	EXT	PPNUSR		003127'	INT
IO		000020	SIN	KSMAPP		000041'	EXT	MAPWTL		000000	EXT	PRIVJ		005572'	
IOBDRB		000000	EXT	KVLRIB		000040'	EXT	MAPXCH		000000	EXT	PRTERR		000002	SIN
IODEND		020000	SIN	LHUN		000004	SPD	MATLEN	777777	777756	SPD	PRTT3		006232'	EXT
IODTER		100000	SIN	LICFMK		000017	SIN	MAXLIC		005012'	INT	PRTWDR		000750'	INT
IOEND		000040	SIN	LICHR		000040	SIN	METSLN		005460'	EXT	PRTWDW		000744'	INT
IOSERR		003035'	EXT	LICJAL		001000	SIN	MFDPPN		003055'	EXT	PTNPNO		000000	EXT
IOSRBE		003656'	EXT	LICMSK		005031'	INT	MO.LAC		400000	SPD	PTRCHG		000000	EXT
IOSRIB		004273'	EXT	LICRFL		000010	SIN	MSKUNI		005746'		PTROU2		000000	EXT
IOSUPR		003526'	EXT	LICRMT		002000	SIN	MTR		000024	SPD	PTROUT		001233'	EXT
ISUERR		000005	SIN	LICRPJ		000004	SIN	MXACL1		002261'		PTSPNO		000000	EXT
ITMCHN		000000	EXT	LICRPS		000017	SIN	MXACL2		002260'		PVEXOG		004000	SIN
J		000002	INT	LICSAM		005050'	INT	MXECOD		000016	SPD	PWAIT1		000000	EXT
JALARG		004716'		LICSPG		005005'		N		003503'		PX.MEM		000004	SPD
JBRIRD		000754'	EXT	LICSPJ		004777'		NAMSTR		000677'	INT	PXCT	256000	000000	
JBTABT		005526'	EXT	LICSPY		200000	SIN	NBOOTP		000000	EXT	QUEPCB		002016'	EXT
JBTAUN		004674'	EXT	LICSTR		004000	SIN	NCSERR		005506'	SIN	RADX10		000755'	EXT
JBTDLK		003510'	EXT	LICSYS		040000	SIN	NETERR		000016	SIN	RBDLTA		000000	EXT
JBTERN		003517'	EXT	LICUNU		000020	SIN	NLKPPB		005446'	EXT	RBINDX		000000	EXT
JBTLIC		005573'	EXT	LICWFL		000002	SIN	NODIE		006121'	EXT	RBMASK		000000	EXT
JBTNAM		000000	EXT	LICWPJ		000001	SIN	NONUA		004717'		RBREAL		000343'	EXT
JBTNM1		003206'	EXT	LICWPS		000021	SIN	NOOUT2		001300'		RBYPN1		000000	EXT
JBTNM2		003207'	EXT	LKCLNA		000003	SPD	NORED		002104'	EXT	RBYUN1		000000	EXT
JBTPPN		006176'	EXT	LKDATB		001515'	EXT	NOWRT		002623'	EXT	RECLSD		003545'	
JBTPRV		002116'	EXT	LKER1		005140'		NPVERR		005501'	SPD	RELLOK		006245'	EXT
JBTRCT		000356'	EXT	LKMERR		000022	SIN	NRMERR		000014	SIN	RELRIB		005140'	EXT
JBTSER		003521'	EXT	LKSET		003505'		OCLOSB		001000	SIN	RENAM		003523'	
JBTSIN		000354'	EXT	LLINK		000002	SPD	ONCTIM		000674'	EXT	RENAM0		003566'	
JBTSLK		003512'	EXT	LOCK		005513'		OUTBLT		000003'	EXT	RENAM1		003571'	
JBTSTS		005560'	EXT	LOGCHK		005677'		OUTPB		004000	SIN	RENAM2		003602'	
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 90-4
FILUUO.MAC	 8-DEC-87 11:25		SYMBOL TABLE

RENAM3		003664'		RIBFT1		000000	EXT	S$DEBU		000003	SIN	STRERR		005162'	
RENAM4		003713'		RIBFUT		000000	EXT	S$DISK		000010	SIN	STRERZ		005160'	
RENAM6		004141'		RIBLCW		000000	EXT	S$ENTR	777777	777775	SIN	STRFNC		005376'	
RENAM7		003776'		RIBLST		000000	EXT	S$EVEN		000006	SIN	STRFNN		000012	SPD
RENAM8		004147'		RIBMTA		000000	EXT	S$HALT	777777	777777	SIN	STRHSH		000000	EXT
RENAM9		004232'		RIBMXA		000000	EXT	S$INFO		000005	SIN	STRLEN		005301'	EXT
RENCLR		005212'		RIBNAM		000000	EXT	S$NAME		000000'	SPD	STRNAM		005727'	EXT
RENDCR		004361'		RIBPFS		000000	EXT	S$NONA		000000	SIN	STRNXT		005664'	EXT
RENDEA		004252'		RIBPID		000000	EXT	S$PATC		000007	SIN	STROVR		000000	EXT
RENECM		004314'		RIBPJ1		000000	EXT	S$TEMP	000010	000000	SPD	STRSID		005742'	EXT
RENER0		005114'		RIBPJ2		000000	EXT	S$XCT	777777	777776	SIN	STRTAL		005725'	EXT
RENER7		005175'		RIBPJC		000000	EXT	SAVE4		005366'	EXT	STRUNI		005656'	EXT
RENER9		005167'		RIBPOS		000000	EXT	SAVLIC		002545'		STRUUO		005366'	INT
RENFL1		004373'		RIBPPN		000000	EXT	SAVT		000045'	INT	SWPCL1		000101'	
RENFL2		004375'		RIBPVW		000000	EXT	SETACH		001663'	INT	SWPCLN		000077'	INT
RENM2A		003627'		RIBQTF		000000	EXT	SETALT		001761'	INT	SWPENT		000130'	
RENM2B		003626'		RIBQTO		000000	EXT	SETAPN		003026'		SWPLK1		000144'	
RENM2C		003652'		RIBRDL		002160'	EXT	SETDD1		000641'		SWPLK2		000142'	
RENM2D		003655'		RIBRIB		000000	EXT	SETDD2		000654'		SWPLUK		000141'	
RENM4A		003717'		RIBSIZ		000000	EXT	SETDD3		000644'		SWPUP2		000152'	
RENM4B		003714'		RIBSLF		000000	EXT	SETDD4		000652'		SWPUPD		000134'	
RENM8A		004160'		RIBSNM		000000	EXT	SETDDB		000627'	INT	SYDCOM		005263'	EXT
RENM9A		004211'		RIBSTS		000000	EXT	SETDDO		000625'	INT	SYDNM4		005274'	EXT
RENM9B		004212'		RIBSZS		000000	EXT	SETEN1		002421'		SYDST1		005270'	
RENM9C		004224'		RIBTRU		000000	EXT	SETEN2		002427'		SYDST2		005275'	
RENM9D		004245'		RIBUN1		000000	EXT	SETEN3		002432'		SYDST3		005300'	
RENMB		000040	SIN	RIBUNM		000000	EXT	SETEN4		002460'		SYDST4		005301'	
RENNMC		004323'		RIBUSD		000000	EXT	SETEN5		002475'		SYDSTR		005264'	INT
RENNMR		004131'		RIBVER		000000	EXT	SETENA		002537'		SYDUN1		005253'	
RENNXR		004126'		RIBWTL		004243'	EXT	SETFIL		003117'		SYDUN2		005251'	
RENR7A		004311'		RIBXT1		000000	EXT	SETN3A		002446'		SYDUN3		005244'	
RENRCM		005177'		RIBXT2		000000	EXT	SETN5A		002474'		SYDUN4		005255'	
RENRIB		004251'		RIPBDA		000000	EXT	SETPID		000601'	INT	SYDUNI		005240'	INT
RENRR0		005235'		RIPBDR		000000	EXT	SETPIO		000620'		SYSCOR		001172'	EXT
RENRR1		005231'		RIPBFS		000000	EXT	SETVAL		004424'		SYSDEV		000100	SIN
RENRR2		005211'		RIPDIR		004550'	EXT	SETVL0		004445'		SYSDRB		003447'	EXT
RENRR3		005176'		RIPHRE		000000	EXT	SETVL1		004456'		SYSPH2		005314'	
RENRR4		005207'		RIPHWE		000000	EXT	SETVTU		004464'		SYSPH3		005321'	
RENRR7		004312'		RIPLOG		002514'	EXT	SIMENT		002276'	EXT	SYSPH4		005324'	
RENSTS		004271'		RIPNFS		000000	EXT	SIMRLS		003653'	EXT	SYSPHY		005312'	INT
RENZAP		004365'		RIPPID		000000	EXT	SLSTR0		005421'		SYSPPN		006215'	EXT
RESETB		000020	SIN	RIPSPP		004270'	EXT	SLSTRR		005420'		SYSTU1		005310'	
RETARG		005467'		RIPUFE		000000	EXT	SNFERR		005472'	SIN	SYSTUU		005304'	INT
RIBALC		000000	EXT	RMVATB		001441'	EXT	SRCFIL		003722'	EXT	SYSUNI		005757'	EXT
RIBALP		000000	EXT	RND		003332'		SRCNAM		003452'	EXT	T1		000006	INT
RIBALT		000000	EXT	RND1		003341'		SRCSTR		005410'		T2		000007	INT
RIBAUT		000000	EXT	RND2		003355'		SRPNDS		000222'	EXT	T3		000010	INT
RIBCOD		000000	EXT	RNM7A		004035'		SRUNI		005757'	INT	T4		000011	INT
RIBDEV		000000	EXT	RNM7B		004046'		SRUSR		003413'		THSDAT		002661'	EXT
RIBDIR		004341'	EXT	RRSET		005530'		STNPRT		002431'	EXT	TIME		000000	EXT
RIBELB		000000	EXT	RRSETB		005543'	EXT	STOCBR		001213'		TPOPJ		005626'	EXT
RIBEST		000000	EXT	S		000000	INT	STOIOS		006051'	EXT	TPOPJ1		000000	EXT
RIBEXT		000000	EXT	S$DEBU		000003	SIN	STRBTS		000000	EXT	TRNERR		000006	SIN
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88 PAGE 90-5
FILUUO.MAC	 8-DEC-87 11:25		SYMBOL TABLE

TST1U0		005656'		ULKSTR		005435'		USETI0		000026'	EXT	X		003500'	
TST1U2		005657'		ULOOK		002026'		USETO0		000027'	EXT	XA		000002	SIN
TST1U5		005667'		ULOOK2		002060'		USETST		000333'	EXT	ZERDDB		002537'	EXT
TST1UN		005645'	INT	ULOOK3		002066'		USIMUP		002553'		ZERO5		000000	SIN
TSTDSK		000057'	INT	UNCERR		005504'	SPD	USRPP1		003177'		ZZ	005557	664555	SPD
TSTRES		002007'		UNFERR		005507'	SPD	USRPP2		003204'		%%XCOD		000017	SPD
TSTWRS		002634'	EXT	UNICHR		005730'	EXT	USRPP3		003206'		%%Z		000100	SPD
TSTWRT		003666'	EXT	UNIDES		005701'	EXT	USRPP4		003213'		%COW		003441'	EXT
TUTAB		002202'		UNIFEP		005735'	EXT	USRPP5		003223'		%COW.N		000000	EXT
U		000005	INT	UNIHID		005741'	EXT	USRPP6		003232'		%CTUPT		000000	EXT
UCLSTR		005436'		UNIKON		005540'	EXT	USRPPN		003174'	INT	%RB2.C		000000	EXT
UENTR		002271'		UNILOG		006021'	EXT	USRUS1		003401'	INT	%RIB		376000	SIN
UFDALP		000000	EXT	UNIMS1		005751'		USRUS2		003402'		%RIB.C		002342'	EXT
UFDATB		001631'	INT	UNIMS2		005755'		USRUSI		003357'		%UPT		000000	EXT
UFDCDT		000000	EXT	UNINAM		005765'	EXT	UUNATT		000002	SIN	.CPDWD		003214'	EXT
UFDEOF		000546'		UNIPPU		005731'	EXT	UUNEXT		000001	SIN	.ERFSA		000011	SIN
UFDER1		001745'	INT	UNISTR		005710'	EXT	UUNNAM		000000	SIN	.ERILE		000003	SIN
UFDERR		000000	EXT	UNISYS		005772'	EXT	UUNPPN		000003	SIN	.ERILF		000000	SIN
UFDEXT		000000	EXT	UNITAL		005726'	EXT	UUOENT		040000	SIN	.ERILL		000012	SIN
UFDLCN		000507'		UNLFIL		006045'	EXT	UUOIRE		002000	SIN	.ERMCN		000007	SIN
UFDLIC		000000	EXT	UNPARG		004714'		UUOLUK		400000	SIN	.ERNCS		000015	SIN
UFDLLP		000401'		UNYSIZ		005253'	EXT	UUOMLK		100000	SIN	.ERNFS		000014	SIN
UFDLNK		000000	EXT	UNYSPU		005734'	EXT	UUOMSK		777777	SPD	.ERNPV		000010	SIN
UFDMS0		000573'		UNYWPS		005733'	EXT	UUOREN		010000	SIN	.ERPPN		000006	SIN
UFDMSK		000565'		UPDAT1		002566'		UUOSEK		000032'	EXT	.ERRSL		000017	SIN
UFDNAM		000000	EXT	UPDATE		002564'		UUOSIM		004000	SPD	.ERSNF		000001	SIN
UFDNMK		000313'		UPDEN2		003010'		UUOUFD		020000	SIN	.ERSSA		000002	SIN
UFDNSL		000370'		UPDEN3		002724'		UUOXWR		002017'	INT	.ERTME		000004	SIN
UFDNXM		000320'		UPDEN4		002732'		UUPPID		100000	SIN	.ERUNA		000005	SIN
UFDPRT		002430'	EXT	UPDEN5		003021'		UUPWDS		200000	SPD	.ERUNC		000013	SIN
UFDRIB		000000	EXT	UPDEND		003003'		UUXALC		000011	SIN	.ERUNF		000016	SIN
UFDRLK		000551'		UPDER2		005121'		UUXENT		000040	SIN	.FSDEF		000002	SIN
UFDSF0		000373'		UPDER3		005123'		UUXEXT		000003	SIN	.FSDSL		000001	SIN
UFDSFD		000375'		UPDERC		005117'		UUXLCW		000014	SIN	.FSLOK		000004	SIN
UFDSIZ		000000	EXT	UPDND3		003032'		UUXMXA		000024	SIN	.FSRDF		000003	SIN
UFDSLP		000363'		UPDND4		003022'		UUXNAM		000002	SIN	.FSREM		000005	SIN
UFDSP1		000521'		UPDNU1		001755'		UUXNUM		000000	SIN	.FSSRC		000000	SIN
UFDSPR		000524'		UPDNUR		001754'		UUXPPN		000001	SIN	
UFDUUO		000271'		UPDTD2		002717'		UUXPRV		000004	SIN	
UFNBLK		000427'		UPDTDN		002704'		UUXSIZ		000005	SIN	
UFNDAT		000473'		UPDUF0		001726'		UUXSTS		000017	SIN	
UFNLIC		000434'		UPDUFD		001727'		UUXUSD		000025	SIN	
UFNNCV		000471'		UPNSDT		002733'		UUXVER		000006	SIN	
UFNSTS		000504'		UPTJDA		000000	EXT	VREMOV	047000	777713		
UFPERR		000000	EXT	UPTPDL		000000	EXT	W		000012	INT	
UFYCDT		000437'	EXT	UPTPID		000000	EXT	W2BLSH	777777	777771	SPD	
UFYCTM		001643'	EXT	UPTPJC		000000	EXT	WAIT1		003524'	EXT	
UFYPRV		001633'	EXT	UPTPOS		000000	EXT	WATPCB		004320'	EXT	
UFYUF1		001647'	EXT	UPTRB2		000000	EXT	WPJARG		004720'		
UFYUF2		001635'	EXT	UPTRIB		000000	EXT	WRTARG		004715'		
UFYXCD		001641'	EXT	UPTSAT		000000	EXT	WRTOK		002625'		
UILNMD		005116'		UPTSPD		000000	EXT	WRTOK1		002640'		

FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

ADJMWS	   315%	   336	   343
AEFERR	  3480
ALCCHK	  2087	  2123#	  2937
ALIASD	   199	  3999	  4033	  4057#
ARGALC	  3293#	  3322
ARGALP	  3311#
ARGALT	  3317#
ARGAUT	  3306#	  3323
ARGDEV	  3298#
ARGELB	  3300#
ARGEST	  3292#	  3322
ARGEUN	  3301#
ARGFT1	  3295#	  3322
ARGFUT	  3291#	  3322
ARGLIC	  3296#	  3322
ARGLUP	  4076#	  4084
ARGMTA	  3297#	  3323
ARGMXA	  3304#	  3324	  3325
ARGPID	  3316#	  3322
ARGPJ0	  3313#	  3323	  3326
ARGPJ1	  3314#	  3323	  3326
ARGPJ2	  3315#	  3323	  3326
ARGPOS	  3294#	  3322
ARGPVS	  3163	  3164	  3318#	  3323	  3324
ARGQTF	  3302#	  3324	  3325
ARGQTO	  3303#	  3324	  3325
ARGSNM	  3312#
ARGSTS	  3163	  3164	  3299#	  3322
ARGTAB	  4080	  4087#	  4106
ARGTRU	  3309#	  3324	  3325
ARGUFD	  3310#	  3322
ARGUN1	  3308#	  3324	  3325
ARGUNM	  3307#	  3324	  3325
ARGUSD	  3305#	  3324	  3325
ARGVER	  3290#	  3322
ASSCON	   668
ASSPRG	   654	   668	  2377
ATBALP	    81%	   246	   885	  1067	  1098	  1296	  1339	  1741	  1823	  2746	  2754	  2791	  2792
ATBCNT	    81%	   257	  3508
ATBDOR	    82%	  1153	  2729	  2730	  2731	  2736	  2737	  2745	  2770	  2781	  2817	  2818	  2819	  2832
	  2858	  2999	  3055	  3056	  3555	  3556	  3567
ATBFNB	    81%	   230	   874	   950	   984	  1015	  1039	  1104	  1257	  1358	  1385	  1422	  1456	  2039
	  2177	  2648	  2786	  2805	  2806	  2815	  2822	  2833	  2862	  2945	  2975	  3000	  3010	  3042
	  3059	  3493	  3558
ATBLCW	    82%	   902	   913	   917	   933	  1087	  1095	  1105	  1128	  1341	  1364	  1366	  1406	  1938
	  2051	  2160	  2762	  2793	  2794	  2882	  2953	  2958	  3276	  3281	  3328	  3345	  3352
ATBLIC	    81%	  1292	  1336	  1845	  1973	  2053	  2760	  3456
ATBLNK	    82%	  1160	  2782	  2783	  2784	  2785	  2797	  2798	  2804	  2807	  2808	  2814
ATBMSC	    81%	   931	  1083	  1667	  1672	  1840	  1947	  2076	  2112	  2795	  2796	  2895	  2924
ATBMWC	    82%	  1141	  1219	  2041
ATBPID	    83%	  1344	  1850	  2157	  2883	  3278
ATBPRV	    82%	  1884
ATBPVW	    81%	  1101	  1665	  1676	  1904	  1936	  2073	  2110	  2893	  2900	  2902	  2926
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

ATBRIB	    82%	   866	  1035	  1162	  1207	  1302	  1318	  1359	  1386	  1459	  1828	  1926	  2007	  2612
	  3046
ATBSIZ	    81%	  1073	  1657	  1680	  1822	  1959	  2080	  2092	  2134	  2789	  2790
ATBSTS	    81%	   252	   269	   382	   852	   877	   938	   953	   991	  1028	  1042	  1048	  1061	  1079
	  1120	  1124	  1140	  1147	  1156	  1187	  1213	  1223	  1754	  1807	  1843	  1881	  1913	  2015
	  2026	  2038	  2614	  2629	  2641	  2647	  2662	  2684	  2691	  2904	  2987	  3049	  3087	  3091
	  3178	  3492	  3541
ATBUMC	    82%	  2767
ATMCNT	    84%	   258	   856	   941	   954	  1224	  2672	  3494
ATMCSC	    85%	  2761
ATMMWC	    85%	  1142	  1220	  2042
ATMUFP	    85%	  2050	  2761	  3336
ATMUFU	    85%	  3336	  3337
ATMUMC	    85%	   878	   954	  1043	  1224	  2766	  3494
ATPALC	    85%	   914	   918	  1093	  1106	  1127	  1363	  1405	  2050	  3343	  3346
ATPCNT	    84%	   876	   952	   990
ATPCRE	    84%	  1029	  1041	  1062	  1064	  1080	  1092	  1121	  1148	  1214	  1809	  1914	  3086	  3491
	  3494
ATPDEL	    84%	   857	   943	  1046	  1151	  1155	  2027	  2644	  2660	  2685
ATPDIR	    84%	   381	  1186	  1753	  1841	  2630	  2903	  3090	  3177
ATPDMP	    84%	   901	   919	  2880
ATPMXU	    84%	   954	  1135	  1221	  1224	  2033	  2037	  3494
ATPNDL	    84%	  1811	  2013	  2615
ATPPID	    85%	  1340	  2050	  2159	  2880	  3275	  3280	  3343	  3346
ATPREN	    85%	   258	   853	   939	  1148	  2690	  2986	  3048	  3494	  3540
ATPSUP	    85%	  1029	  1041	  1062	  1080	  1092	  1125	  1135	  1148	  1214	  1880	  3086	  3491	  3494
ATPUFE	    85%	  1090	  1091	  2956	  2957
ATPUPD	    84%	   251	   258	   268	   954	  1135	  1151	  1222	  2037	  2646	  2660	  3494
ATT1	   733%	   740
ATYADT	    87%	   916	   927	  1082	  1912	  2055
ATYBLK	    86%	  1748	  2176	  3146
ATYBSZ	    86%	   287	   417
ATYCDT	    86%	  1274	  1326	  2066	  2101
ATYCNT	    87%	  2765
ATYCSC	    86%	  1283	  1332	  1872	  2070	  2107
ATYCTD	    86%	  2923
ATYCTM	    86%	  1281	  1331	  2068	  2106
ATYPRV	    87%	  1266	  1322	  2911
ATYUF1	    87%	  1288	  1334
ATYUF2	    87%	  1270	  1324
ATYXCD	    86%	  1277	  1328	  1855	  1865	  1875	  1893	  1900	  1916	  2072	  2103	  2922
B2PLSH	  2457
B2WLSH	  2132	  2146	  2480
BADUFD	  1444#
BLKLNK	  2486	  2498#
CBUSER	    70%	  1487
CHGNAM	   822	   827#
CHGPPN	   813#
CHKAG1	  1982	  1990	  2189#	  2575
CHKAGX	  2194	  2211#
CHKARG	  1507	  1796	  2186#
CHKPP1	  2199	  2202#
CHKPP2	  2203	  2207#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

CHKPPN	  2196#	  2227
CHKPRV	    59%	  1636	  1641	  1649	  1812	  2016	  2019	  2141	  2155	  2623	  2711	  2740	  2873
CHKSGJ	   734%	   742
CKJPP2	  3936	  3942#
CKJPPN	  3713	  3798	  3935#
CLCALC	  1723	  1748#
CLCMXA	  1734	  1753#
CLCUSD	  1735	  1774#
CLFAL1	  3143#	  3154	  3155
CLFAL2	  3142	  3151#
CLFALC	  3114	  3140#
CLFLC1	  3344	  3348#
CLFLIC	  3117	  3328#
CLFMX1	  3239	  3253#
CLFMX2	  3240	  3256#
CLFMX3	  3241	  3247#
CLFMXA	  3125	  3239#
CLFNPS	  3164	  3171#
CLFPID	  3137	  3263#
CLFPIO	  3269	  3272	  3275#
CLFPIS	  3277#	  3282
CLFPIZ	  3264	  3280#
CLFQT1	  3179	  3199#
CLFQT2	  3184	  3186	  3196#
CLFQT3	  3194	  3200#
CLFQTF	  3123	  3177#
CLFSTS	  3120	  3163#
CLFUM1	  3203	  3207#
CLFUN1	  3129	  3210#
CLFUNM	  3128	  3203#
CLFUS1	  3217	  3225#	  3230
CLFUS2	  3218	  3232#
CLFUS3	  3219	  3228#
CLFUSD	  3126	  3217#
CLIBDR	   861	   885#	  2678
CLIDEL	   859#	   944
CLOCM1	  1215	  1223#
CLOCM2	  1231	  1234#
CLOCOM	  1158	  1169	  1174	  1183	  1188	  1197	  1200	  1204#
CLORS1	  1038#	  1072
CLORS2	  1045	  1050#
CLORS3	  1049	  1051#
CLORST	  1060	  1067#
CLOSCR	  1065	  1122	  1181#
CLOSE1	    51%	  2584	  2995
CLOSIN	   157	   838#	  1469	  2527	  2604
CLOSOU	   145	  1002#	  1470
CLOSRN	   856#	  2669	  3510
CLOSU1	  1147#	  1161
CLOSU2	  1152	  1160#
CLOSU3	  1154	  1176#
CLOSU4	  1162#	  1180
CLOUF1	  1192	  1196#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

CLOUPD	  1063	  1126	  1199#
CLRAC0	  1391	  1405#
CLRACH	   915	  1383#
CLRCM1	  3500#
CLRCOM	  3493#
CLRDD1	   687#	   693
CLRDDB	   175	   683#	  2528
CLRENT	  3490#	  3512	  3516
CLRNT1	  3492#
CLSACC	   906	   926	  2994	  3509
CLSDMP	   898
CLSIN	  2583
CLSIN2	   858	   893#
CLSIN3	   907	   923	   942	   948#	  2673
CLSIN4	   966	   973#
CLSIN5	   880	   955	   961	   978	   981#
CLSIN6	   957	   980#
CLSIN7	   900	   906#
CLSIN8	   905	   913#
CLSN2A	   930	   937#
CLSN2B	   920	   924#
CLSN3A	   879	   959#
CLSN3B	   965#	   969
CLSOU0	  1020	  1025#
CLSOU1	  1018	  1022#
CLSOU2	  1032	  1073#
CLSOU3	  1107	  1118#
CLSOUT	   893	  3509
CLSRST	  1025
CLSXIT	   896	   949	   988#
CLSXT1	   854	   940	   984#
CLSXT2	   982	   992#
CMBLNK	   113%	   362	   369	   977
CMPLOG	  4153	  4154#
CNVVPN	  2456	  2472	  2492	  2498	  2510
CODDSK	  3971#	  3987
CODKNC	  3975#	  4012
CODKON	  3976#	  4017
CODLUF	  3974#	  4004
CODPUN	  3977#	  4015
CODRIB	   102%	  1932
CODSFS	  3972#	  4066
CODSTR	  3973#	  4001
COMERA	   733%	   738	   744
CPOPJ	    44%	   207	   220	   796	  2128	  2249	  3263	  3986
CPOPJ1	    44%	   143	   196	   204	   328	   331	   344	   347	   638	   672	   721	   823	  1716	  2209
	  2217	  2255	  2265	  2272	  2283	  2302	  2316	  2322	  2332	  2351	  2606	  3454	  3598	  3599
	  3718	  3743	  3745	  3747	  3808	  3816	  3820	  3833	  3861	  3867	  3941	  3956	  4072	  4083
	  4085	  4141
CPOPJ2	    52%	  4146
CPRRED	  2456
CPUKS	  4104	  4105	  4108
CPUTYP	  4104	  4105	  4108
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

CPZZ	  4104#	  4104	  4105#	  4105	  4108#	  4108
CRBRWL	    65%	  1167
CREUFD	  1184	  1256#	  1433	  2984	  3040
CRLF	   733%	   757	   769
CURUPT	    53%
DATCOM	    54%	   514
DBRLP	  2836#	  2854
DBRNXT	  2838	  2852#
DBYT	   140#
DCL	   145#
DCLI	   157#
DCTBSZ	   322#	   330
DDBCOR	    78%	   660	   698
DDBLEN	    78%	   141	   665
DDI	   134#
DDINT	   139#
DDO	   133#
DDXZ	   138#
DECENT	   241#	  1962
DECIN	   733%	   736
DECLUK	   238#	  1203	  1713	  3546
DECSTP	   242#	   843	  1007	  1512	  1801	  2024	  2596	  2627	  2688
DECUP2	   240#	   988
DECUPD	   239#	  2172
DELGRP	  2089	  2140#
DEN	   152#
DEV1UN	  1818	  4047%	  4048
DEVATB	    77%	   227	   264	   285	   380	   416	   846	   981	   986	  1009	  1027	  1055	  1170	  1173
	  1233	  1357	  1418	  1455	  1633	  1805	  1824	  2005	  2587	  2609	  2725	  2726	  2742	  2820
	  2821	  2836	  2859	  3455	  3496	  3531	  3565
DEVDBL	    77%	  2834	  2839	  2840	  2842	  2853
DEVDRB	    77%	   847	  1010	  1244	  1634	  1806	  2006	  2621	  2692	  2721	  2727	  2728	  2743	  2850
	  3532	  3566
DEVELB	    77%
DEVEXT	  1262	  1514	  1999	  2252	  2384	  2705	  2827	  2847	  2866
DEVFIL	  1190	  1259	  1472	  1521	  1525	  1757	  1946	  1995	  2250	  2382	  2577	  2632	  2701	  2824
	  2845	  2846	  2864	  2908	  3003	  3182
DEVFLO	    78%	  2009	  2388
DEVIAD	  1645	  2012	  2023	  2190	  2213
DEVIOS	   576	   677	   996	  1715	  1964	  2174	  2187	  2370	  2531
DEVLG	    63%	  3990
DEVLOG	   674	   675
DEVMOD	   221	   653	   669	   711	  2378	  3451	  3993	  4029
DEVNAM	   651	   671	  3995	  4032
DEVPOS	    78%	   290	  1473
DEVPPN	  1474	  1518	  1838	  1949	  1972	  2003	  2254	  2387	  2698	  2830	  2848	  2849	  2868	  2965
	  3349	  3459
DEVRB1	    78%	   676
DEVRET	    78%	   433
DEVRIB	    78%	  1165	  2008	  2613
DEVSER	   219	   666	   688	   696	   697
DEYSTC	    77%	   232	   234	   844	   989	  1008	  1205	  1513	  1714	  1802	  1963	  2025	  2173	  2597
	  2628	  2689	  3525	  3547
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

DEYTCT	    77%
DFCRE	   162#
DFDEL	   161#
DFEXC	   163#
DFFIF	   167#
DFTRN	   168#
DFVLR	   165#
DGF	   151#
DGTRD	   149#
DHNG	   143#
DIE	    11	    11%	    12	  1431	  1444	  1489	  2471	  3500
DIN	   147#
DINI	   142#
DIRBLK	    65%	  1426	  2978	  3015
DIRSRC	    62%	  1429	  2980	  3017
DLK	   153#
DLTALL	    61%	   862	  1033	  1171
DLTNAM	    61%	  2652	  3031
DLTTRC	    60%	  2148	  2939
DMOVPG	   169#
DMT	   150#
DOU	   146#
DRBALC	    95%	   247	   886	   887	   889	  1068	  1069	  1071	  1246	  1777	  1814	  2747	  2751	  2755
	  2756	  2758	  3193	  3222	  3235	  3242	  3248
DRBCNT	    95%	   253	   260	   992	  1051	  1226	  2045	  2635	  2693	  2772	  2777	  2988	  3050	  3498
	  3542	  3560
DRBFNB	    96%	   354	   364	   963	   964
DRBLNK	    95%	  2291	  2303	  2340	  2352	  2516
DRBLOG	    97%	   312	  1239
DRBMXA	    95%	  1249	  1765	  2752	  2753	  3192	  3223	  3224	  3243	  3259
DRBNAM	    95%	  2296	  2348	  2829	  2867
DRBNX	    96%	  1195	  2640
DRBRIB	    95%	  1193	  1762	  2638	  3185
DRBUN1	    95%	  2299	  2346	  3205	  3211
DRBUNM	    95%	  2298	  2345	  2523	  3204
DRL	   144#
DRMCNT	    97%	  2636
DRN	   154#
DRPLOG	    97%	   311	  1238
DRPMXC	    97%	   254	   261	   993	  1052	  1227	  2046	  2694	  2773	  2778	  2989	  3051	  3499	  3543
	  3561
DRPNX	    97%	  1194	  2639
DRYCNT	    96%	   352
DRYPRV	    96%	  2913
DSEK	   159#
DSI	   155#
DSIM	   164#
DSKCHK	  3991	  3999#
DSKCHR	  3979#
DSKCL1	   352#	   373
DSKCL2	   319	   345#
DSKCL3	   320	   338#
DSKCL4	   321	   334#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

DSKCL5	   357	   361#
DSKCL6	   356#	   359	   366
DSKCL7	   355	   368#
DSKCLN	  1444%	  1444
DSKCLR	   314	   325#
DSKCM1	   737	   751#
DSKCM2	   746	   759#
DSKCOM	   732	   736#
DSKCTB	   319#	   322	   332
DSKDDB	    69%	   198	   217	   644	   650	   656	   664	   666	   675	   686	  2371
DSKDSP	    38	   136#
DSKFND	  4000	  4003	  4022#
DSKINC	   753	   775	   787#
DSKKJB	    38	   802#	   818
DSKKLP	   804#	   808
DSKLGO	   303#	   805	   809
DSKREL	   144	  1464#
DSKRES	    38	   796#
DSKUG1	   286	   294#	   297
DSKUG2	   289	   292	   296#
DSKUGF	   151	   283#
DSLSTR	  3777	  3797#
DSO	   156#
DSPSIZ	   138	   170#
DUFD	   158#
DVDSK	   222	   712	  3453	  3992	  4030
DVMAP	   160#
DVSIZ	   141#
DVSMAP	   166#
DZAP	   148#
ECOD	  3877	  3878	  3879	  3880	  3881	  3882	  3883	  3884	  3885	  3886	  3887	  3888	  3889	  3890
	  3891	  3892#
ECOD0	  3760	  3877#	  3892
ECOD1	  3758	  3878#
ECOD10	  3756	  3885#
ECOD11	  3886#
ECOD12	  3701	  3755	  3887#
ECOD13	  3764	  3888#
ECOD14	  3889#
ECOD15	  3762	  3890#
ECOD16	  3761	  3891#
ECOD2	  3879#
ECOD3	  3699	  3880#
ECOD4	  3881#
ECOD5	  3882#
ECOD6	  3700	  3757	  3883#
ECOD7	  3884#
ENTER1	  1813	  3512#
ENTER2	  1817	  1821	  1827	  3516#
ENTRB	   841	   872	   894	   948	  1002	  1056	  1208	  1503	  2579
EPT	    53%
ERNSET	  1792	  1981	  2559#	  2573
ERRLKM	  3520#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

ERRNET	  3523#
ETSLUP	  3855#	  3858
ETSSTR	  3784	  3845#
ETSTAB	    70%	  3857
ETSUNI	    70%	  3847	  3859
EXTUUO	    22#	    37	  1515	  1527	  1655	  1857	  1859	  1901	  1905	  1918	  2056	  2108	  2165	  2218
	  2231	  2236	  2241	  2602	  2885	  2928	  2933	  3473	  3477	  3526	  3528
F	   198	   217	   219	   220	   221	   227	   264	   285	   290	   378	   380	   416	   433	   576
	   649	   651	   653	   663	   665	   666	   669	   671	   674	   676	   677	   692	   696	   699
	   711	   838	   841	   846	   847	   872	   894	   922	   924	   948	   956	   981	   986	   996
	   997	  1002	  1009	  1010	  1026	  1027	  1030	  1031	  1055	  1056	  1059	  1081	  1165	  1170
	  1173	  1190	  1199	  1208	  1230	  1233	  1244	  1259	  1262	  1357	  1418	  1455	  1468	  1471
	  1472	  1473	  1474	  1503	  1514	  1518	  1521	  1525	  1633	  1634	  1639	  1645	  1646	  1715
	  1757	  1794	  1805	  1806	  1818	  1824	  1838	  1946	  1949	  1964	  1972	  1979	  1995	  1999
	  2003	  2005	  2006	  2008	  2009	  2012	  2023	  2174	  2187	  2190	  2202	  2213	  2250	  2252
	  2254	  2369	  2370	  2371	  2378	  2380	  2382	  2384	  2387	  2388	  2453	  2454	  2464	  2465
	  2476	  2477	  2526	  2530	  2531	  2540	  2577	  2579	  2580	  2587	  2607	  2608	  2609	  2613
	  2621	  2632	  2642	  2643	  2692	  2698	  2701	  2705	  2721	  2725	  2726	  2727	  2728	  2742
	  2743	  2820	  2821	  2824	  2827	  2830	  2845	  2848	  2859	  2864	  2866	  2868	  2908	  2965
	  3003	  3182	  3349	  3451	  3452	  3455	  3459	  3496	  3531	  3532	  3565	  3566	  3902	  3905
	  3907	  3993	  3995	  3996	  4029	  4032	  4048
FALHOL	  2451%	  2468
FALPHP	  2451%	  2469
FBIT	  1825%	  1825
FBMERR	  3487
FBOOTB	  4105%	  4105
FILLIC	  1974	  3350	  3357#
FILUUO	    11	    12#	    15
FINNXB	   546	   549	   570#
FINSUP	   478	   484	   492	   497	   529	   538	   560#
FINUS0	   460	   544	   583#
FNBALT	    89%	  1112	  1362	  1389	  1460	  2787	  2788	  2947
FNBAPD	    89%	  2178
FNBATB	    90%	   356	   960	  1146	  2797	  2807
FNBDBL	    90%	  2834	  2835	  2841	  2843
FNBDRB	    89%	   962
FNBEXT	    89%	  2826	  2865
FNBLNK	    89%	   963	   968	   973	   974
FNBNAM	    89%	  2823	  2863	  3001
FNBNX	    89%	  1211	  2658	  3045	  3062
FNBRIB	    89%	  1163	  1209	  1360	  1387	  1457	  2659	  3047	  3063
FNBUPD	    89%	  1145	  1216	  2040
FNCAPP	    92%	  2014
FNCCAT	    93%	  2154
FNCCNM	    93%	  2709
FNCCPR	    93%	  2872
FNCCRE	    92%	  1808	  2739
FNCDEL	    93%	  2622	  2710
FNCEXC	    92%	  1640
FNCLOK	    92%	  1635
FNCRED	    92%	  1638	  1648
FNCSUP	    92%	  1810
FNCTRN	    93%	  2140
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

FNCUPD	    93%	  2018
FNDDRB	    60%	  1191	  2633	  2909	  3183
FNDNGT	  1647	  1651	  1655#
FNDROK	  1643	  1646#
FNDST1	  4070#
FNDSTR	  4014	  4018	  4024	  4067#
FNFERR	  3470
FNPNX	    90%	  1210	  2657	  3044	  3061
FNYUFP	    90%	  1423	  2976	  3014	  3022	  3026
FOUND	  1633#
FOUND1	  1660	  1664#
FOUND2	  1656	  1672#
FOUND3	  1669	  1675	  1679	  1688#
FOUND4	  1685	  1692#
FOUND5	  1694	  1699#
FOUND8	  1689	  1696	  1709#
FPCSET	    65%	   341
FREACC	   872#	   891
FREATB	    59%	   248	   959	  1050	  3060	  3495	  3559
FUNM	  2484	  2506#
FUNM1	  2520	  2524#
FUTAB	  3101	  3111#
FUUEND	  4359#
FUULIT	  4179#
GERIFS	  3699#	  3717
GERILL	  3701#	  3711
GERPPN	  3700#	  3714
GET4WD	    53%	   661
GETB	  1639	  1646	  3452
GETCBR	    59%	   306	   349	   845	   873	   904	   937	  1038	  1134	  1189	  1212	  1356	  1408	  1756
	  1993	  2290	  2339	  2514	  2611	  2656	  2666	  2764	  2907	  3043	  3180	  3490	  3507	  3557
	  3901
GETER1	    64%
GETEXT	  1853	  1997	  2236#	  2251	  2703	  2894	  2916
GETGMT	  1868%	  1868	  2100
GETLI1	  3455#
GETLIC	  3451#
GETNAM	  1994	  2231#	  2248	  2590	  2618	  2700
GETPPN	  2002	  2241#	  2253	  2697
GETUPG	  1826%	  1826
GETWDS	    44%
GINST	   294#	   294	   295	   340#	   340	   341	   385#	   385	   386	   386#	   387	   387#	   388	   389#
	   389	   390	   399#	   399	   400	   448#	   448	   449	   449#	   450	   463#	   463	   464	   480#
	   480	   481	   481#	   482	   489#	   489	   490	   494#	   494	   495	   522#	   522	   523	   526#
	   526	   527	   535#	   535	   536	   537#	   537	   538	   543#	   543	   544	   562#	   562	   563
	   567#	   567	   568	   571#	   571	   572	   628#	   628	   629	   637#	   637	   638	  1526#	  1526
	  1527	  1529#	  1529	  1530	  1664#	  1664	  1665	  1666#	  1666	  1667	  1668#	  1668	  1669	  1673#
	  1673	  1674	  1677#	  1677	  1678	  1683#	  1683	  1684	  1705#	  1705	  1706	  1861#	  1861	  1862
	  1903#	  1903	  1904	  1907#	  1907	  1908	  1920#	  1920	  1921	  1923#	  1923	  1924	  2060#	  2060
	  2061	  2061#	  2062	  2075#	  2075	  2076	  2077#	  2077	  2078	  2083#	  2083	  2084	  2099#	  2099
	  2100	  2111#	  2111	  2112	  2113#	  2113	  2114	  2123#	  2123	  2124	  2124#	  2125	  2143#	  2143
	  2144	  2144#	  2145	  2192#	  2192	  2193	  2196#	  2196	  2197	  2207#	  2207	  2208	  2223#	  2223
	  2224	  2224#	  2225	  2232#	  2232	  2233	  2233#	  2234	  2237#	  2237	  2238	  2238#	  2239	  2242#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

	  2242	  2243	  2243#	  2244	  2361#	  2361	  2362	  2400#	  2400	  2401	  2402#	  2402	  2403	  2522#	  2522
	  2523	  2889#	  2889	  2890	  2890#	  2891	  2929#	  2929	  2932#	  2932	  2933	  3100#	  3100	  3101
	  3106#	  3106	  3107	  3140#	  3140	  3141	  3149#	  3149	  3150	  3174#	  3174	  3175	  3236#	  3236
	  3237	  3250#	  3250	  3251	  3260#	  3260	  3261	  3351#	  3351	  3352	  3474#	  3474	  3475	  3527#
	  3527	  3528	  3529#	  3529	  3530	  3582#	  3582	  3583	  3595#	  3595	  3596	  3605#	  3605	  3606
	  3732#	  3732	  3733	  3742#	  3742	  3743	  3744#	  3744	  3745	  3746#	  3746	  3747	  3771#	  3771
	  3772	  3809#	  3809	  3810	  3812#	  3812	  3813	  3817#	  3817	  3818	  3829#	  3829	  3830	  3830#
	  3831	  3846#	  3846	  3847	  3856#	  3856	  3857	  3866#	  3866	  3867	  3894#	  3894	  3895	  3918#
	  3918	  3919	  3935#	  3935	  3936	  3937#	  3937	  3938	  3951#	  3951	  3952	  3985#	  3985	  3986
	  4071#	  4071	  4072	  4082#	  4082	  4083
GIV4WD	    53%	   701
GIVCB1	    61%	    63%	   351	   374
GIVCBR	    60%	   310	   313	   353	   859	   928	   998	  1157	  1164	  1196	  1361	  1365	  1415	  1767
	  1769	  2049	  2300	  2305	  2349	  2354	  2524	  2649	  2664	  2677	  2717	  2855	  2871	  2915
	  3064	  3189	  3196	  3481	  3502	  3538	  3564	  3902	  3913
GIVPAG	    66%
GIVWDS	    44%
GOBSTR	  3704	  3705#
GTCGSZ	   441	  2548%	  2550	  2560
GUFBT	    63%	  4087
HIGHJB	    51%	   803	  2266	  2277	  2317	  2327	  3945
ICLOSB	  2608
ILFERR	  3760#	  3772	  3774	  3778	  3779	  3780	  3781
ILLERR	  3755#	  3828
ILNMER	  1508	  1511	  1535	  1797	  1800	  1983	  1991	  2576	  3470#
INBLT	   122%	   134
INDPPN	    70%	  3377
INLMES	   734%	   751	   754	   759	   763
INPB	   922	   924	   956	  1081	  2526
INSNAM	    65%	  1182	  3038
INSUN2	  4169	  4172#
INVDDB	    59%	  1201	  1709	  2169	  2182
IO	  1166	  1241	  1424	  1688	  1692	  2418	  2977
IOBDRB	   376%
IODEND	   422	   575
IODTER	   426
IOEND	   422	   575
IOSERR	    45%	  2186
IOSRBE	    45%	  2418	  2668
IOSRIB	    45%	  1425	  1630	  2391	  2418	  2574	  2586	  2600	  2970
IOSUPR	    45%	  1475	  1502	  1790	  2571
ISUERR	  3478
ITMCHN	   384	   384%	   840	  1005	  1505	  1788	  1977	  2568
J	   209	   225	   325	   438	   440	   443	   445	   619	   741	   743	   747	   765	   768	   774
	   776	   802	   804	   815	   819	   820	   821	   827	   830	   831	   897	  1465	  2289	  2338
	  2549	  2551	  2553	  2559	  2561	  2563	  3075	  3076	  3081	  3084	  3089	  3267	  3597	  3903
	  3904	  3905	  3906	  3911	  3912	  3916	  3923	  3924	  3940	  3943	  3947	  3948	  3950	  3953
	  3954	  3966	  3980	  3981	  3984	  3988	  3989	  4070	  4072	  4082	  4083
JALARG	  3082	  3324#
JBRIRD	   784%	   792
JBTABT	    52%	   440	   554	   580	   589	  3905	  3912
JBTAUN	    47%	   619	  1929	  2267	  2321	  3267
JBTDLK	    49%	  2551	  2552
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

JBTERN	    49%	  2561	  2562
JBTLIC	    49%	   209	   325	   815	   897	  1970	  2961	  3081	  3084	  3335	  3340	  3597	  3916	  3966
JBTNAM	  3215%
JBTNM1	   819	   830%	   830	  2280	  2328
JBTNM2	   820	   831%	   831	  2282	  2329
JBTPPN	    47%	   802	   806	   821	   827%	   827	  1837	  1971	  2198	  2278	  2331	  2964	  3348	  3458
	  3953	  3954
JBTPRV	    47%	  1654
JBTRCT	   444	   445	   733%	   765	   768	   774	   776
JBTSER	    47%	  2563	  2564
JBTSIN	   442	   443	   733%
JBTSLK	    49%	  2553	  2554
JBTSTS	    52%	  3947
JBTUN1	    47%	  2271	  2319
JBTUNM	    47%	  2269	  2318
JBTWCT	   733%	   765	   768	   774	   776
JBYIRD	   784%	   788	   790
JBYRCT	   733%	   761	   787
JBYWCT	   734%	   766
JBYWPT	    49%	   616	  3077	  3270
JFYSEC	    51%	   504	   517	  1870	  2104
JNA	  3948
JOB	    51%	  1465	  1486	  2288	  2289	  2301	  2306	  2337	  2338	  2350	  2355	  2375	  3457	  3904
	  3911	  3989
JOBN	   734%	   739
JOBST0	  3716	  3731#
JOBST1	  3734	  3738#
JOBST2	  3733	  3741#
JOBST8	  3736	  3742#
JOBSTR	    38	  3726#
KFCRE	    45%	   162
KFDEL	    45%	   161
KFEXC	    45%	   163
KFFIFP	    46%	   167
KFTRN	    46%	   168
KMAPP	    45%	   160
KMOVPG	    46%	   169
KONLTM	   115%	  3924
KSMAPP	    45%	   166
KVLRIB	    46%	   165
LHUN	  2445#	  2482
LICFMK	  3404	  3423	  3443
LICHR	  3357	  3373	  3374	  3381	  3382	  3384	  3422
LICJAL	   813	   899	  3080	  3334	  3915
LICMSK	  3386	  3412#
LICRFL	  3367	  3368	  3373	  3381	  3464
LICRMT	  3357	  3371	  3372	  3373	  3379	  3380	  3381	  3384	  3421
LICRPJ	  3370	  3381	  3465
LICRPS	  3397	  3400	  3402	  3416	  3417	  3419	  3438	  3439	  3441
LICSAM	  3434#
LICSPG	  3375	  3378	  3384#
LICSPJ	  3362	  3377#
LICSPY	  3596
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

LICSTR	   208	  3915	  3965
LICSYS	  3596
LICUNU	  3425	  3445
LICWFL	   326	   327	   899	  2962	  3334	  3341	  3363	  3364	  3371	  3373	  3379	  3381	  3462
LICWPJ	   326	   327	  3083	  3342	  3366	  3379	  3381	  3463
LICWPS	  3392	  3393	  3396	  3412	  3413	  3415	  3434	  3435	  3437
LISTSN	     3	     6
LKCLNA	  3822#	  3827
LKDATB	    62%	   259	   980	  1225
LKER1	  1637	  3504#
LKMERR	  3520
LKSET	  1506	  2549#
LLINK	  2447#	  2487
LOCK	  3901#	  3982
LOGCHK	  4007	  4065#
LOGTST	   868	   890	  1037	  1206	  1238#	  3033	  3036
LOKLL5	  2363	  2369#
LOKLUD	  1524	  2201	  2359#
LOKPPB	    63%	  3831
LOKUNM	   376%	   414
LOOKB	   378	   838	  1056	  1199	  1230	  1794	  1979	  2453	  2464	  2476	  2526	  2607	  2642
LP2BAT	  4103%	  4103
LP2HOM	  4102%	  4102
LPNBAT	  4103%	  4103
LPNHOM	  4102%	  4102
LPPN	  2446#	  2485	  2508
LUDER0	  2390	  2529#
LUDER1	  2470	  2471	  2496	  2502	  2504	  2535#
LUDER2	  2374	  2540#
LUDERR	  2525#	  2538
LUDHSH	  2417	  2444#
LUKER1	  1504	  1791	  1980	  2572	  3473#
LUPUNI	  4137#	  4148
M	   294	   329	   385	   386	   387	   389	   398	   399	   412	   420	   432	   448	   449	   463
	   481	   537	   543	   562	   567	   571	   628	   637	   893	   898	   906	   926	  1025	  1509
	  1515	  1526	  1527	  1529	  1655	  1664	  1666	  1668	  1673	  1677	  1683	  1703	  1705	  1798
	  1842	  1848	  1856	  1857	  1858	  1859	  1886	  1901	  1905	  1907	  1918	  1920	  1923	  1942
	  1951	  1984	  2029	  2056	  2060	  2061	  2075	  2077	  2083	  2099	  2108	  2111	  2113	  2123
	  2124	  2143	  2144	  2147	  2165	  2168	  2181	  2191	  2192	  2195	  2196	  2207	  2208	  2218
	  2221	  2223	  2225	  2226	  2231	  2232	  2233	  2236	  2237	  2238	  2241	  2242	  2243	  2360
	  2364	  2385	  2508	  2517	  2519	  2521	  2522	  2525	  2532	  2541	  2582	  2583	  2585	  2589
	  2592	  2602	  2617	  2653	  2720	  2723	  2734	  2885	  2889	  2890	  2928	  2929	  2932	  2933
	  2971	  2994	  2997	  3032	  3035	  3097	  3100	  3106	  3140	  3149	  3174	  3236	  3250	  3260
	  3351	  3473	  3474	  3477	  3509	  3526	  3527	  3528	  3529	  3581	  3582	  3595	  3600	  3604
	  3605	  3706	  3715	  3726	  3732	  3742	  3744	  3746	  3770	  3771	  3775	  3802	  3809	  3812
	  3814	  3817	  3829	  3830	  3846	  3855	  3856	  3918	  3935	  3937	  3951
MAPB	   922	   924	   956	  1081
MAPID	  2450#	  2460
MAPRDU	    64%	   437
MAPRLS	    64%
MAPWLN	    61%	  1831
MAPWTL	    64%
MAPXCH	    64%
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

MATLEN	  4073	  4106#
MAXLIC	  3359	  3392#
METSLN	    70%	  3854
MFDPPN	    69%	   304	   814	  1519	  2205
MO.LAC	   384	   840	  1005	  1505	  1788	  1977	  2568
MSKUNI	  4057	  4118#	  4162
MTR	   384	   840	  1005	  1505	  1788	  1977	  2568
MXACL1	  1755	  1770#
MXACL2	  1761	  1763	  1769#
MXECOD	  3660#	  3699	  3699#	  3700	  3700#	  3701	  3701#	  3755	  3756	  3757	  3758	  3760	  3761	  3761#
	  3762	  3764	  3875
N	  2401	  2403	  2422	  2423	  2426	  2427	  2545#
NAMSTR	   704	   711#
NBOOTP	  4105%	  4105
NCSERR	  3762#	  3763
NETERR	  3523
NLKPPB	    63%	  3832
NODIE	    11%	  1444
NONUA	  3092	  3325#
NOOUT2	  1017	  1023	  1059#
NORED	    48%	  1644	  2188
NOWRT	    48%	  2011	  2022	  2188
NPVERR	  3756#	  3810	  3917	  3968
NRMERR	  3517	  3577
OCLOSB	  2580	  2608
ONCTIM	    53%	   700
OUTBLT	   122%	   133
OUTPB	  1081
P	    12	   139	   142	   148	   149	   150	   180	   181	   182	   183	   185	   186	   187	   188
	   189	   197	   199	   200	   202	   203	   210	   211	   223	   248	   259	   265	   283	   295
	   305	   306	   309	   337	   338	   339	   341	   342	   345	   346	   349	   358	   379	   383
	   392	   395	   413	   414	   421	   424	   428	   429	   431	   437	   441	   461	   462	   464
	   465	   470	   471	   505	   512	   513	   514	   519	   520	   521	   541	   542	   552	   560
	   561	   572	   577	   586	   587	   590	   596	   606	   626	   629	   644	   648	   652	   661
	   671	   702	   713	   736	   742	   745	   746	   747	   748	   751	   753	   754	   756	   757
	   759	   762	   763	   767	   775	   777	   807	   816	   817	   818	   821	   822	   828	   832
	   842	   845	   855	   859	   860	   862	   868	   873	   875	   890	   903	   904	   915	   928
	   929	   936	   937	   951	   959	   980	   985	  1003	  1004	  1006	  1016	  1021	  1022	  1033
	  1037	  1038	  1040	  1050	  1118	  1123	  1129	  1134	  1157	  1164	  1167	  1168	  1171	  1176
	  1178	  1179	  1182	  1184	  1185	  1189	  1191	  1196	  1201	  1206	  1212	  1225	  1232	  1234
	  1240	  1242	  1256	  1258	  1305	  1306	  1307	  1342	  1346	  1356	  1369	  1371	  1372	  1373
	  1374	  1375	  1376	  1383	  1384	  1388	  1396	  1407	  1415	  1416	  1417	  1419	  1421	  1426
	  1427	  1429	  1431	  1433	  1434	  1435	  1436	  1437	  1438	  1440	  1441	  1442	  1444	  1445
	  1453	  1454	  1461	  1464	  1466	  1469	  1470	  1481	  1482	  1484	  1485	  1489	  1501	  1506
	  1507	  1510	  1524	  1628	  1636	  1641	  1649	  1695	  1709	  1710	  1711	  1712	  1723	  1734
	  1735	  1751	  1756	  1760	  1769	  1772	  1778	  1789	  1792	  1793	  1796	  1799	  1803	  1812
	  1826	  1831	  1844	  1853	  1868	  1921	  1960	  1961	  1978	  1981	  1982	  1990	  1992	  1993
	  1994	  1997	  2002	  2016	  2019	  2031	  2035	  2049	  2052	  2087	  2100	  2127	  2131	  2138
	  2139	  2141	  2148	  2152	  2155	  2167	  2169	  2170	  2171	  2179	  2182	  2195	  2201	  2208
	  2220	  2225	  2234	  2239	  2244	  2248	  2251	  2253	  2287	  2288	  2290	  2300	  2301	  2305
	  2306	  2307	  2336	  2337	  2339	  2349	  2350	  2354	  2355	  2356	  2359	  2360	  2362	  2364
	  2365	  2366	  2369	  2373	  2379	  2389	  2392	  2399	  2406	  2407	  2408	  2409	  2414	  2415
	  2442	  2455	  2466	  2471	  2478	  2483	  2506	  2507	  2509	  2514	  2518	  2519	  2521	  2524
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

	  2527	  2528	  2529	  2530	  2532	  2535	  2536	  2537	  2540	  2541	  2550	  2555	  2560	  2565	  2569
	  2570	  2573	  2575	  2582	  2584	  2585	  2590	  2598	  2601	  2603	  2611	  2618	  2623	  2625
	  2633	  2649	  2650	  2652	  2654	  2656	  2664	  2665	  2666	  2667	  2677	  2686	  2697	  2700
	  2703	  2711	  2714	  2717	  2718	  2724	  2732	  2738	  2740	  2744	  2759	  2764	  2844	  2851
	  2855	  2869	  2871	  2873	  2875	  2894	  2907	  2909	  2915	  2916	  2937	  2939	  2942	  2951
	  2969	  2973	  2978	  2980	  2984	  2985	  2992	  2993	  3009	  3011	  3012	  3015	  3017	  3021
	  3023	  3024	  3025	  3027	  3030	  3031	  3033	  3034	  3036	  3038	  3040	  3041	  3043	  3060
	  3064	  3073	  3075	  3089	  3103	  3108	  3114	  3117	  3120	  3123	  3125	  3126	  3128	  3129
	  3137	  3150	  3169	  3175	  3180	  3181	  3183	  3188	  3189	  3196	  3197	  3201	  3208	  3213
	  3226	  3237	  3251	  3254	  3261	  3274	  3279	  3329	  3350	  3353	  3354	  3358	  3359	  3360
	  3386	  3388	  3406	  3426	  3446	  3461	  3466	  3481	  3490	  3495	  3500	  3501	  3504	  3506
	  3507	  3512	  3516	  3530	  3533	  3534	  3535	  3538	  3554	  3557	  3559	  3564	  3568	  3571
	  3572	  3576	  3589	  3616	  3669	  3686	  3713	  3716	  3739	  3798	  3832	  3851	  3895	  3901
	  3903	  3906	  3908	  3910	  3920	  3939	  3946	  3949	  3955	  3988	  3990	  3999	  4005	  4031
	  4033	  4034	  4036	  4046	  4049	  4057	  4061	  4062	  4070	  4087	  4119	  4126	  4149	  4154
	  4162	  4176	  4177
P1	   388	   394	   397	   398	   432	   474	   536	   564	   594	   599	   602	   605	  1674	  1678
	  1684	  1699	  1700	  1701	  1702	  1703	  1704	  1706	  1860	  1902	  2058	  2074	  2078	  2085
	  2156	  2192	  2193	  2212	  2214	  2215	  2216	  2217	  2219	  2222	  2414	  2419	  2503	  2507
	  2537	  2887	  2931	  2935	  3072	  3093	  3094	  3095	  3096	  3097	  3101	  3102	  3105	  3107
	  3599	  3707	  3708	  3709	  3710	  3727	  3728	  3729	  3743	  3745	  3829	  3854	  3857	  3858
	  4075	  4076	  4081
P2	   227	   229	   230	   231	   246	   252	   257	   269	   356	   357	   380	   382	   386	   391
	   393	   396	   410	   447	   475	   545	   556	   568	   593	   595	   597	   605	   846	   848
	   852	   866	   874	   877	   885	   902	   913	   917	   931	   933	   938	   950	   953	   984
	   991	  1009	  1011	  1015	  1027	  1028	  1035	  1039	  1042	  1048	  1061	  1067	  1073	  1079
	  1083	  1087	  1095	  1098	  1101	  1104	  1105	  1120	  1124	  1128	  1140	  1141	  1162	  1173
	  1176	  1177	  1179	  1187	  1207	  1213	  1219	  1223	  1257	  1292	  1296	  1302	  1318	  1336
	  1339	  1341	  1344	  1369	  1370	  1372	  1385	  1386	  1406	  1422	  1454	  1455	  1456	  1459
	  1461	  1633	  1657	  1665	  1667	  1672	  1676	  1680	  1741	  1754	  1805	  1807	  1822	  1823
	  1828	  1840	  1843	  1845	  1850	  1881	  1884	  1904	  1913	  1926	  1936	  1938	  1947	  1959
	  1973	  2005	  2007	  2015	  2026	  2038	  2039	  2041	  2051	  2053	  2073	  2076	  2080	  2092
	  2110	  2112	  2134	  2157	  2160	  2177	  2587	  2588	  2609	  2612	  2614	  2629	  2641	  2647
	  2648	  2662	  2684	  2691	  2726	  2729	  2730	  2736	  2737	  2742	  2745	  2746	  2754	  2760
	  2762	  2767	  2770	  2781	  2782	  2785	  2789	  2791	  2793	  2795	  2802	  2806	  2814	  2817
	  2818	  2820	  2822	  2832	  2837	  2858	  2859	  2860	  2862	  2882	  2883	  2893	  2895	  2900
	  2902	  2904	  2924	  2926	  2945	  2953	  2958	  2975	  2987	  2999	  3010	  3042	  3046	  3049
	  3055	  3057	  3059	  3087	  3091	  3178	  3276	  3278	  3281	  3328	  3345	  3352	  3492	  3493
	  3508	  3531	  3541	  3555	  3556	  3558	  3565	  3567	  3735	  3740	  3741	  3742	  3830	  4022
	  4023	  4037	  4038	  4044	  4045	  4074	  4077	  4088	  4090	  4101
P3	   230	   354	   355	   356	   362	   363	   365	   366	   388	   394	   401	   462	   464	   477
	   480	   499	   500	   501	   504	   506	   525	   526	   541	   545	   555	   560	   585	   874
	   950	   960	   962	   965	   973	   976	   977	   984	  1015	  1039	  1145	  1146	  1163	  1209
	  1211	  1216	  1256	  1257	  1306	  1421	  1422	  1427	  1435	  1764	  1765	  1770	  1774	  1777
	  1856	  1858	  1861	  1867	  1877	  1903	  2648	  2658	  2659	  2788	  2797	  2815	  2822	  2823
	  2826	  2841	  2843	  2862	  2863	  2865	  2889	  2890	  2891	  2892	  2901	  2918	  2923	  2975
	  3010	  3042	  3045	  3047	  3059	  3062	  3063	  3187	  3192	  3193	  3198	  3199	  3203	  3204
	  3205	  3210	  3211	  3217	  3219	  3222	  3223	  3224	  3232	  3235	  3239	  3241	  3242	  3243
	  3248	  3256	  3259	  3263	  3493	  3558	  3792	  3793	  3800	  3801	  3808	  3815	  3816	  3818
	  3823	  3824	  3831	  4154	  4155	  4156	  4157	  4158	  4160	  4168	  4170	  4173	  4174	  4176
P4	   229	   247	   253	   260	   350	   351	   354	   364	   369	   370	   372	   373	   385	   391
	   393	   402	   461	   465	   479	   498	   500	   507	   508	   509	   510	   511	   525	   530
	   532	   534	   535	   542	   561	   847	   849	   886	   887	   889	   992	  1010	  1012	  1051
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

	  1068	  1069	  1071	  1226	  1239	  1416	  1418	  1437	  1442	  1634	  1806	  1814	  2006	  2045	  2621
	  2692	  2693	  2722	  2728	  2731	  2736	  2743	  2755	  2756	  2758	  2777	  2816	  2817	  2819
	  2821	  2829	  2850	  2860	  2867	  2912	  2914	  2988	  3050	  3058	  3498	  3532	  3542	  3555
	  3560	  3566	  3769	  3792	  3800	  3826
PCBCLR	    66%	   345
PCDTIM	   124%	  1108	  1390	  1395	  1458	  2946
PDNMUP	    55%	   338	   339
PE.NER	  2448%	  2451%	  2472
PG	   436	  1710	  1712	  1830
PIDACC	    48%	  2188	  2189	  2211
PJOBN	    44%	   224	   438	   553	   579	   588	  1653	  1836	  1928	  1969	  2197	  2376	  2549	  2559
	  2960	  3076	  3333
PPNERR	  3757#	  3799
PPNUS1	  2267#	  2273
PPNUS2	  2268	  2270	  2273#
PPNUS3	  2278#	  2284
PPNUS4	  2279	  2281	  2284#
PPNUS5	  2296#	  2304
PPNUS6	  2292	  2297	  2303#
PPNUSR	   828	  2262#
PRIVJ	  3705	  3797	  3825	  3845	  3965#
PRTERR	  3484	  3505	  3513	  3539	  3573
PRTT3	  2471%	  2471
PRTWDR	    39	   786#
PRTWDW	    39	   756	   774#
PTNPNO	   105%
PTRCHG	    79%
PTROU2	    66%
PTROUT	    65%	  1016
PTSPNO	   105%
PVEXOG	  1652
PWAIT1	    53%
PX.MEM	   294	   340	   385	   386	   387	   389	   399	   448	   449	   463	   480	   481	   489	   494
	   522	   526	   535	   537	   543	   562	   567	   571	   628	   637	  1526	  1529	  1664	  1666
	  1668	  1673	  1677	  1683	  1705	  1861	  1903	  1907	  1920	  1923	  2060	  2061	  2075	  2077
	  2083	  2099	  2111	  2113	  2123	  2124	  2143	  2144	  2192	  2196	  2207	  2223	  2224	  2232
	  2233	  2237	  2238	  2242	  2243	  2361	  2400	  2402	  2522	  2889	  2890	  2929	  2932	  3100
	  3106	  3140	  3149	  3174	  3236	  3250	  3260	  3351	  3474	  3527	  3529	  3582	  3595	  3605
	  3732	  3742	  3744	  3746	  3771	  3809	  3812	  3817	  3829	  3830	  3846	  3856	  3866	  3894
	  3918	  3935	  3937	  3951	  3985	  4071	  4082
QUEPCB	    52%	  1488
RADX10	   733%	   762	   767	   793
RBDLTA	   107%
RBINDX	   107%
RBMASK	   102%
RBREAL	   118%	   434
RBYPN1	   105%
RBYUN1	   105%
RECLSD	  2581	  2586#
RELLOK	    60%	   552	   581	   587	   936	  1021	  1118	  1168	  1185	  1243	  1251	  1434	  1440	  1965
	  2170	  2392	  2601	  2969	  2985	  3012	  3041	  3571	  3576
RELRIB	   376%	   429	  1711	  3504
RENAM	   154	  2568#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

RENAM0	  2603	  2607#
RENAM1	  2588	  2611#
RENAM2	  2621#
RENAM3	  2619	  2684#
RENAM4	  2702	  2709#
RENAM6	  2707	  2871#
RENAM7	  2735	  2764#
RENAM8	  2856	  2878#
RENAM9	  2891	  2898	  2933#
RENCLR	  3554#	  3574	  3578
RENDCR	  2998	  3008	  3030#
RENDEA	  2888	  2930	  2934	  2953#
RENECM	  2988#	  3065
RENER0	  2578	  3475	  3478#
RENER7	  2712	  3538#
RENER9	  2719	  3531#
RENFL1	  3028	  3040#
RENFL2	  3039	  3042#
RENM2A	  2631	  2642#
RENM2B	  2634	  2641#
RENM2C	  2645	  2664#
RENM2D	  2663	  2667#
RENM4A	  2714#
RENM4B	  2699	  2710#
RENM8A	  2886	  2890#
RENM9A	  2910	  2915#
RENM9B	  2906	  2916#
RENM9C	  2920	  2926#
RENM9D	  2941	  2945#
RENMB	   872	   894	   948	  1056	  1208
RENNMC	  2972	  2997#
RENNMR	  2724	  2738	  2744	  2862#	  3534
RENNXR	  2858#	  3009	  3024	  3030	  3034	  3572
RENR7A	  2974	  2985#
RENRCM	  3536	  3540#	  3551	  3569
RENRIB	  2936	  2938	  2951#
RENRR0	  2750	  3576#
RENRR1	  2741	  3571#
RENRR2	  2733	  3553#
RENRR3	  2874	  3539#
RENRR4	  2876	  3550#
RENRR7	  2979	  2986#
RENSTS	  2963	  2968#
RENZAP	  3013	  3016	  3034#
RESETB	  1026	  1030	  1031	  1059	  1468	  1471
RETARG	  3672	  3690	  3692	  3866#
RIBALC	   101%	  1749	  1750	  3145
RIBALP	   105%	  1099	  1100
RIBALT	   103%	  1110	  1111	  2948
RIBAUT	   101%	  1736	  1930	  1931	  3127
RIBCOD	   102%	  1933
RIBDEV	   100%	  1728	  3119
RIBDIR	    64%	  1242	  1419	  2973	  3011
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

RIBELB	   100%	  1730
RIBEST	    99%	  1722	  3113	  3143	  3144
RIBEXT	    99%	   932	  1084	  1086	  2828	  2925
RIBFT1	   100%	  1725	  3116
RIBFUT	    99%	  1721	  3112
RIBLCW	   100%	   934	   935	  1096	  1097	  1726	  1939	  2164	  2959
RIBLST	   107%
RIBMTA	   100%	  1727	  3118
RIBMXA	   102%	  1250	  1771	  3228	  3229	  3245	  3249	  3253	  3258
RIBNAM	    99%	  1948	  2825
RIBPFS	   104%	  1955
RIBPID	   102%	  1746	  1852	  2158	  2884	  3277
RIBPJ1	   106%	  1744	  3135
RIBPJ2	   106%	  1745	  1849	  3136
RIBPJC	   106%	  1743	  1847	  3134
RIBPOS	    99%	  1724	  3115
RIBPPN	    99%	  1950	  2831
RIBPVW	    99%	  1102	  1103	  1937	  2927
RIBQTF	   100%	  1245	  1248	  1732	  1766	  1775	  3191	  3200	  3220	  3233	  3244	  3246	  3257
RIBQTO	   101%	  1733	  3124
RIBRDL	    59%	  1695
RIBRIB	   105%	  1019
RIBSIZ	   105%	  1076	  1077
RIBSLF	   102%	  1927
RIBSNM	   101%	  1742
RIBSTS	   100%	  1088	  1729	  1839	  1940	  1945	  2954	  2968	  3166	  3168	  3173
RIBSZS	   102%	  1935
RIBTRU	   101%	  1739	  3130
RIBUN1	   101%	  1738	  3206	  3212
RIBUNM	   101%	  1737	  3207
RIBUSD	   102%	  1247	  1776	  3225	  3234	  3247
RIBVER	    99%	  1720	  3111
RIBWTL	    59%	   860	   929	  1022	  2152	  2732	  2875	  2942
RIBXT1	   100%	  1731
RIBXT2	   101%	  1740	  3131
RIPBDA	   107%	  1089	  2955	  3171
RIPBDR	   105%	   107%	  1089	  2955
RIPBFS	   107%	  1089	  2955	  3171
RIPDIR	   104%	  1943	  1944	  3165	  3167
RIPHRE	   104%	  1089	  2955	  3171
RIPHWE	   104%	  1089	  2955	  3171
RIPLOG	   104%	  1941
RIPNFS	   104%
RIPPID	   104%
RIPSPP	   107%	  1835	  2966	  2967
RIPUFE	   104%
RMVATB	    63%	   358	  1178
RND	  2406	  2407	  2408	  2409	  2422#
RND1	  2429#	  2441
RND2	  2432	  2441#
RNM7A	  2798#	  2803
RNM7B	  2808#	  2813
RRSET	  3785	  3915#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

RRSETB	    65%	  3926
S	   422	   426	   430	   575	   576	   996	  1166	  1241	  1424	  1425	  1475	  1502	  1630	  1688
	  1692	  1715	  1790	  1891	  1964	  2174	  2186	  2187	  2370	  2391	  2418	  2531	  2571	  2574
	  2586	  2600	  2668	  2970	  2977	  3987	  4001	  4004	  4012	  4015	  4017	  4066	  4069
S$DEBU	  2471	  2472
S$DISK	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143	  1149	  1217	  1228	  1319
	  1431	  1432	  1489	  1490	  2043	  2047	  2474	  2494	  2500	  2512	  2695	  2715	  2774	  2779
	  2800	  2810	  2943	  2990	  3052	  3500	  3501	  3544	  3562	  4165
S$ENTR	    11	    17	   146	   147	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143
	  1149	  1217	  1228	  1319	  1432	  1445	  1490	  1492	  1495	  2043	  2047	  2472	  2474	  2494
	  2500	  2512	  2695	  2715	  2774	  2779	  2800	  2810	  2943	  2982	  2990	  3019	  3052	  3501
	  3544	  3562	  4011	  4165
S$EVEN	  1431	  1444	  1489	  2471	  3500
S$HALT	    11	   146	   147	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143	  1149
	  1217	  1228	  1319	  1431	  1444	  1489	  1492	  1495	  2043	  2047	  2471	  2474	  2494	  2500
	  2512	  2695	  2715	  2774	  2779	  2800	  2810	  2943	  2982	  2990	  3019	  3052	  3500	  3544
	  3562	  4011	  4165
S$INFO	  1431	  1444	  1445	  1489	  2471	  3500
S$NAME	    15#	   146	   147	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143	  1149
	  1217	  1228	  1319	  2043	  2047	  2474	  2494	  2500	  2512	  2695	  2715	  2774	  2779	  2800
	  2810	  2943	  2990	  3052	  3544	  3562	  4011	  4165
S$NONA	    14	    17	   146	   147	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143
	  1149	  1217	  1228	  1319	  1432	  1445	  1490	  1493	  1496	  2043	  2047	  2472	  2474	  2494
	  2500	  2512	  2695	  2715	  2774	  2779	  2800	  2810	  2943	  2983	  2990	  3020	  3052	  3501
	  3544	  3562	  4011	  4165
S$PATC	  1431	  1444	  1489	  2471	  3500
S$TEMP	    11#	    11	   146#	   146	   147#	   147	   242#	   242	   255#	   255	   262#	   262	   690#	   690
	   850#	   850	   970#	   970	   994#	   994	  1013#	  1013	  1053#	  1053	  1143#	  1143	  1149#	  1149
	  1217#	  1217	  1228#	  1228	  1319#	  1319	  1431#	  1431	  1444#	  1444	  1489#	  1489	  1492#	  1492
	  1495#	  1495	  2043#	  2043	  2047#	  2047	  2471#	  2471	  2474#	  2474	  2494#	  2494	  2500#	  2500
	  2512#	  2512	  2695#	  2695	  2715#	  2715	  2774#	  2774	  2779#	  2779	  2800#	  2800	  2810#	  2810
	  2943#	  2943	  2982#	  2982	  2990#	  2990	  3019#	  3019	  3052#	  3052	  3500#	  3500	  3544#	  3544
	  3562#	  3562	  4011#	  4011	  4165#	  4165
S$XCT	    17	   146	   147	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143	  1149
	  1217	  1228	  1319	  1432	  1445	  1490	  1492	  1493	  1495	  1496	  2043	  2047	  2472	  2474
	  2494	  2500	  2512	  2695	  2715	  2774	  2779	  2800	  2810	  2943	  2982	  2983	  2990	  3019
	  3020	  3052	  3501	  3544	  3562	  4011	  4165
SAVE4	    53%	   218	  3768
SAVLIC	  1844	  1969#	  2052	  2759
SAVT	   179	   180#	   197	   648
SETACH	  1356#	  2650
SETALT	  1453#
SETAPN	  2176#
SETDD1	   655	   660#
SETDD2	   657	   674#
SETDD3	   645	   663#
SETDD4	   671#	   678
SETDDB	   175	   648#	  2373
SETDDO	   643	   644#
SETEN1	  1864	  1866	  1880#
SETEN2	  1882	  1886#
SETEN3	  1885	  1889#
SETEN4	  1906	  1911#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

SETEN5	  1926#
SETENA	  1952	  1960#
SETFIL	  1510	  1799	  2248#	  2714
SETN3A	  1896	  1901#
SETN5A	  1919	  1923#
SETPID	   615#
SETPIO	   615	   618	   622	   624	   631#
SETVAL	  1921	  2167	  2951	  3072#
SETVL0	  3085	  3089#
SETVL1	  3098#	  3102	  3107
SETVTU	  3099	  3105#
SIMENT	  1793%	  1793
SIMRLS	   122%	   842	  1006	  1466	  2654	  2665
SLSTR0	  3809#
SLSTRR	  3793	  3808#
SNFERR	  3758#	  3759	  3813	  3819
SRCFIL	    59%	  1628	  1803	  2389	  2598	  2718
SRCNAM	    60%	   309	  1760	  2518
SRCSTR	  3776	  3792#
SRPNDS	   111%	   334
SRUNI	   203	  3851	  3920	  4005	  4136#
SRUSR	  2482#	  2491
STNPRT	    69%	  1888
STOCBR	   996#	  1057	  1234
STOIOS	    53%	   423	   427	   839	  1476
STRBTS	   111%	   335
STRDDB	    71%	   335	   404	  1816	  1953	  1957	  2749	  3006	  3607	  3618	  4022	  4037
STRERR	  2599	  3471	  3479	  3482	  3506	  3521	  3526#	  3548
STRERZ	  1629	  1804	  3514	  3518	  3524#
STRFNC	  3775	  3776#	  3786
STRFNN	  3773	  3786#
STRHSH	   109%	   404	  1953	  1957	  3006
STRLEN	    71%	  3619
STRNAM	    71%	  3608	  3620	  4090
STRNXT	    71%	  3610	  3614	  4044
STROVR	    71%	  2749
STRSID	    71%	  4101
STRTAL	    71%	  1816	  4088
STRUNI	    71%	  4023	  4038
STRUUO	  3767	  3768#
SWPCL1	   219#	   226	   228	   237	   266
SWPCLN	   217#	   272
SWPENT	   241	   246#
SWPLK1	   249	   260#
SWPLK2	   258#	   270
SWPLUK	   238	   257#
SWPUP2	   240	   268#
SWPUPD	   239	   251#
SYDCOM	  3601	  3623%
SYDNM4	    53%	  3592	  3612
SYDST1	  3608#	  3615
SYDST2	  3609	  3614#
SYDST3	  3606	  3618#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

SYDST4	  3611	  3619#
SYDSTR	  3604#
SYDUN1	  3584	  3593#
SYDUN2	  3586	  3591#
SYDUN3	  3585#	  3588
SYDUN4	  3595#	  3621
SYDUNI	  3581#
SYSCOR	    70%	   361	   363	   368	   370	   975	   976
SYSDEV	  2202
SYSDRB	    69%	   307	   350	   371	  1758	  2291	  2340	  2515	  2516
SYSPH2	  3682#	  3685
SYSPH3	  3683	  3688#
SYSPH4	  3680	  3691#
SYSPHY	  3679#
SYSPPN	    69%	   303	  2206	  2262%	  2262	  2315%	  2315	  2386	  3938
SYSTU1	  3667	  3671#
SYSTUU	  3667#
SYSUNI	    70%	  3583	  3679	  4136
T1	   141	   196	   201	   221	   222	   224	   225	   232	   235	   246	   247	   251	   252	   253
	   254	   257	   258	   260	   261	   268	   269	   284	   287	   288	   293	   294	   296	   303
	   304	   311	   312	   325	   326	   327	   329	   330	   332	   334	   335	   338	   340	   352
	   353	   361	   362	   364	   365	   368	   369	   371	   372	   381	   382	   399	   402	   403
	   405	   406	   410	   411	   412	   417	   418	   419	   420	   433	   434	   442	   443	   452
	   453	   468	   470	   471	   473	   474	   475	   485	   486	   487	   488	   489	   493	   494
	   506	   516	   518	   522	   531	   532	   533	   534	   545	   546	   547	   548	   553	   554
	   556	   557	   558	   565	   567	   568	   569	   570	   571	   579	   580	   583	   586	   588
	   589	   590	   600	   601	   602	   603	   604	   615	   620	   623	   625	   627	   628	   631
	   632	   636	   637	   651	   652	   653	   654	   663	   664	   665	   668	   669	   674	   675
	   676	   686	   687	   688	   689	   692	   698	   711	   712	   720	   761	   766	   787	   790
	   791	   792	   802	   806	   814	   817	   827	   843	   844	   852	   853	   856	   857	   876
	   877	   878	   885	   886	   888	   889	   897	   899	   901	   902	   913	   914	   917	   918
	   919	   952	   953	   954	   960	   961	   973	   974	   987	   988	   989	   990	   991	   992
	   993	  1007	  1008	  1041	  1042	  1043	  1046	  1048	  1061	  1062	  1064	  1067	  1068	  1070
	  1071	  1073	  1074	  1075	  1076	  1077	  1078	  1082	  1083	  1085	  1086	  1087	  1090	  1091
	  1093	  1095	  1096	  1097	  1098	  1099	  1100	  1101	  1102	  1103	  1105	  1106	  1124	  1125
	  1147	  1148	  1151	  1155	  1156	  1162	  1163	  1165	  1186	  1187	  1190	  1194	  1195	  1203
	  1204	  1205	  1207	  1209	  1210	  1211	  1213	  1214	  1221	  1222	  1223	  1224	  1226	  1227
	  1244	  1246	  1249	  1259	  1260	  1261	  1262	  1264	  1265	  1274	  1275	  1276	  1277	  1279
	  1280	  1281	  1282	  1284	  1286	  1287	  1288	  1290	  1291	  1292	  1294	  1295	  1296	  1297
	  1298	  1300	  1301	  1302	  1303	  1304	  1321	  1322	  1323	  1324	  1325	  1326	  1327	  1328
	  1329	  1330	  1331	  1333	  1334	  1335	  1336	  1338	  1339	  1340	  1341	  1343	  1344	  1359
	  1360	  1363	  1364	  1366	  1386	  1387	  1389	  1390	  1393	  1395	  1405	  1406	  1423	  1427
	  1453	  1456	  1457	  1460	  1485	  1486	  1487	  1488	  1512	  1513	  1514	  1516	  1518	  1519
	  1521	  1522	  1525	  1526	  1529	  1530	  1635	  1638	  1640	  1644	  1645	  1648	  1652	  1654
	  1657	  1658	  1659	  1661	  1662	  1663	  1664	  1665	  1666	  1667	  1668	  1672	  1673	  1676
	  1677	  1680	  1681	  1682	  1683	  1705	  1713	  1714	  1720	  1721	  1722	  1724	  1725	  1726
	  1727	  1728	  1729	  1730	  1731	  1732	  1733	  1736	  1737	  1738	  1739	  1740	  1741	  1742
	  1743	  1744	  1745	  1746	  1748	  1749	  1750	  1753	  1754	  1757	  1765	  1766	  1771	  1775
	  1776	  1777	  1801	  1802	  1808	  1810	  1818	  1820	  1825	  1829	  1833	  1834	  1835	  1839
	  1841	  1843	  1845	  1847	  1849	  1854	  1855	  1865	  1866	  1870	  1871	  1878	  1892	  1894
	  1895	  1897	  1898	  1899	  1900	  1934	  1935	  1946	  1948	  1949	  1950	  1953	  1955	  1956
	  1957	  1958	  1959	  1962	  1963	  1973	  1995	  1998	  2000	  2003	  2007	  2008	  2011	  2012
	  2014	  2018	  2022	  2023	  2024	  2025	  2050	  2051	  2053	  2054	  2055	  2060	  2063	  2066
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

	  2067	  2068	  2069	  2070	  2073	  2075	  2076	  2077	  2080	  2081	  2082	  2083	  2092	  2093	  2094
	  2095	  2096	  2098	  2099	  2104	  2105	  2106	  2110	  2111	  2112	  2113	  2140	  2144	  2145
	  2154	  2159	  2160	  2164	  2172	  2173	  2176	  2178	  2196	  2197	  2198	  2200	  2205	  2206
	  2207	  2211	  2213	  2221	  2222	  2224	  2232	  2233	  2237	  2238	  2242	  2243	  2249	  2250
	  2252	  2254	  2262	  2267	  2278	  2296	  2315	  2317	  2318	  2319	  2321	  2323	  2327	  2328
	  2329	  2331	  2333	  2340	  2345	  2346	  2348	  2352	  2353	  2359	  2361	  2372	  2375	  2376
	  2377	  2378	  2386	  2387	  2393	  2394	  2395	  2396	  2397	  2398	  2400	  2401	  2402	  2403
	  2410	  2411	  2413	  2416	  2417	  2422	  2424	  2425	  2426	  2429	  2430	  2434	  2435	  2438
	  2439	  2440	  2456	  2461	  2466	  2472	  2473	  2478	  2479	  2480	  2481	  2482	  2485	  2487
	  2490	  2491	  2492	  2493	  2498	  2499	  2508	  2510	  2511	  2517	  2536	  2553	  2554	  2563
	  2564	  2591	  2596	  2597	  2612	  2613	  2614	  2615	  2619	  2622	  2627	  2628	  2629	  2630
	  2632	  2635	  2636	  2639	  2640	  2641	  2644	  2646	  2647	  2657	  2658	  2660	  2662	  2672
	  2688	  2689	  2690	  2691	  2698	  2701	  2704	  2706	  2709	  2710	  2721	  2722	  2725	  2727
	  2729	  2730	  2731	  2739	  2745	  2747	  2751	  2752	  2753	  2754	  2755	  2757	  2758	  2760
	  2761	  2762	  2765	  2768	  2771	  2776	  2777	  2778	  2782	  2784	  2786	  2787	  2788	  2789
	  2790	  2791	  2792	  2793	  2794	  2795	  2796	  2797	  2798	  2804	  2805	  2806	  2807	  2808
	  2814	  2823	  2824	  2825	  2826	  2827	  2828	  2829	  2830	  2831	  2834	  2840	  2844	  2845
	  2846	  2848	  2849	  2852	  2863	  2864	  2865	  2866	  2867	  2868	  2872	  2880	  2882	  2896
	  2897	  2903	  2904	  2908	  2911	  2913	  2917	  2921	  2922	  2924	  2925	  2926	  2927	  2929
	  2932	  2945	  2947	  2953	  2956	  2957	  2958	  2959	  2960	  2961	  2962	  2964	  2965	  2976
	  2986	  2987	  2988	  2989	  2999	  3000	  3001	  3002	  3005	  3007	  3014	  3022	  3023	  3044
	  3045	  3046	  3047	  3050	  3051	  3054	  3055	  3056	  3057	  3058	  3061	  3062	  3100	  3106
	  3111	  3112	  3113	  3115	  3116	  3118	  3119	  3124	  3127	  3130	  3131	  3134	  3135	  3136
	  3143	  3144	  3145	  3147	  3148	  3149	  3151	  3152	  3154	  3167	  3168	  3171	  3173	  3174
	  3181	  3182	  3188	  3190	  3197	  3200	  3204	  3207	  3211	  3212	  3218	  3221	  3225	  3228
	  3229	  3233	  3234	  3235	  3236	  3240	  3246	  3247	  3248	  3249	  3250	  3253	  3257	  3258
	  3259	  3260	  3264	  3265	  3273	  3277	  3278	  3330	  3332	  3339	  3343	  3347	  3351	  3352
	  3363	  3366	  3367	  3370	  3372	  3374	  3380	  3382	  3385	  3387	  3451	  3453	  3455	  3456
	  3462	  3463	  3464	  3465	  3470	  3478	  3480	  3484	  3487	  3491	  3492	  3494	  3498	  3499
	  3505	  3508	  3513	  3517	  3520	  3523	  3527	  3529	  3533	  3535	  3539	  3550	  3553	  3554
	  3560	  3561	  3568	  3573	  3577	  3582	  3584	  3585	  3593	  3605	  3606	  3608	  3619	  3667
	  3668	  3670	  3671	  3680	  3682	  3688	  3691	  3706	  3707	  3726	  3727	  3732	  3733	  3734
	  3738	  3769	  3770	  3771	  3772	  3773	  3775	  3809	  3810	  3811	  3826	  3827	  3846	  3856
	  3857	  3866	  3877	  3878	  3879	  3880	  3881	  3882	  3883	  3884	  3885	  3886	  3887	  3888
	  3889	  3890	  3891	  3892	  3894	  3915	  3916	  3918	  3935	  3936	  3937	  3938	  3942	  3943
	  3944	  3945	  3947	  3950	  3951	  3952	  3953	  3954	  3979	  3984	  3985	  3986	  3995	  4002
	  4029	  4030	  4032	  4035	  4039	  4040	  4060	  4065	  4067	  4068	  4069	  4071	  4073	  4080
	  4084	  4118	  4140	  4145	  4155	  4159	  4160	  4161	  4174	  4175
T2	   182	   186	   233	   234	   285	   286	   290	   291	   293	   307	   310	   312	   404	   405
	   406	   416	   439	   440	   446	   450	   452	   455	   456	   459	   460	   468	   473	   477
	   485	   493	   505	   516	   517	   518	   521	   536	   539	   540	   566	   597	   598	   601
	   616	   617	   619	   620	   621	   660	   687	   688	   697	   699	   739	   741	   743	   745
	   788	   791	   803	   804	   805	   806	   808	   813	   815	   829	   830	   931	   932	   933
	   934	   935	   938	   939	   941	   943	   962	   963	   964	   965	   967	   968	   969	   975
	   977	  1028	  1029	  1051	  1052	  1084	  1085	  1088	  1089	  1108	  1110	  1111	  1112	  1120
	  1121	  1127	  1128	  1135	  1140	  1141	  1142	  1146	  1147	  1153	  1156	  1160	  1161	  1177
	  1181	  1193	  1195	  1219	  1220	  1238	  1239	  1245	  1246	  1247	  1248	  1249	  1250	  1260
	  1261	  1263	  1265	  1275	  1276	  1293	  1295	  1299	  1301	  1303	  1304	  1325	  1332	  1335
	  1338	  1357	  1358	  1359	  1364	  1366	  1370	  1458	  1460	  1653	  1654	  1758	  1762	  1764
	  1807	  1809	  1811	  1828	  1829	  1836	  1837	  1838	  1861	  1862	  1863	  1867	  1869	  1872
	  1873	  1874	  1875	  1876	  1877	  1878	  1889	  1890	  1891	  1892	  1898	  1903	  1904	  1913
	  1914	  1916	  1917	  1926	  1927	  1947	  1954	  1955	  1970	  1999	  2000	  2013	  2015	  2033
	  2037	  2038	  2045	  2046	  2061	  2062	  2071	  2072	  2101	  2102	  2103	  2107	  2124	  2128
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

	  2130	  2132	  2137	  2143	  2146	  2177	  2178	  2188	  2189	  2190	  2263	  2269	  2270	  2280	  2281
	  2298	  2314	  2318	  2328	  2345	  2361	  2365	  2381	  2382	  2383	  2384	  2412	  2413	  2415
	  2423	  2427	  2431	  2455	  2457	  2458	  2482	  2483	  2485	  2487	  2488	  2489	  2490	  2502
	  2506	  2515	  2519	  2523	  2635	  2638	  2640	  2693	  2694	  2705	  2706	  2746	  2747	  2749
	  2751	  2752	  2753	  2766	  2767	  2770	  2772	  2783	  2785	  2798	  2799	  2802	  2808	  2809
	  2812	  2836	  2837	  2839	  2840	  2841	  2842	  2847	  2892	  2893	  2898	  2905	  2912	  2914
	  2946	  2947	  2948	  2954	  2955	  2966	  2967	  2968	  3003	  3004	  3005	  3006	  3007	  3008
	  3021	  3025	  3026	  3027	  3037	  3048	  3049	  3077	  3078	  3080	  3081	  3083	  3084	  3086
	  3087	  3090	  3091	  3140	  3141	  3146	  3147	  3148	  3151	  3153	  3165	  3166	  3177	  3178
	  3185	  3187	  3190	  3191	  3192	  3193	  3220	  3221	  3222	  3223	  3224	  3242	  3243	  3244
	  3245	  3265	  3267	  3268	  3270	  3271	  3275	  3276	  3280	  3281	  3328	  3331	  3336	  3337
	  3338	  3340	  3341	  3342	  3357	  3364	  3368	  3371	  3373	  3379	  3381	  3384	  3385	  3387
	  3392	  3393	  3396	  3397	  3400	  3402	  3403	  3405	  3412	  3413	  3415	  3416	  3417	  3419
	  3420	  3421	  3422	  3423	  3424	  3425	  3434	  3435	  3437	  3438	  3439	  3441	  3442	  3443
	  3444	  3445	  3457	  3458	  3459	  3460	  3474	  3476	  3524	  3525	  3540	  3541	  3542	  3543
	  3546	  3547	  3594	  3595	  3596	  3597	  3620	  3850	  3919	  3992	  3993	  4008	  4009	  4059
	  4079	  4082	  4088	  4089	  4090	  4091	  4092	  4093	  4094	  4095	  4096	  4097	  4098	  4099
	  4100	  4101	  4102	  4103	  4105	  4118	  4121	  4125	  4138	  4139	  4143	  4144	  4163	  4164
	  4167	  4171	  4172	  4173
T3	   181	   187	   206	   207	   208	   209	   308	   448	   450	   481	   482	   490	   495	   502
	   507	   512	   520	   527	   649	   650	   656	   696	   697	   829	   831	   963	   967	   974
	  1079	  1080	  1092	  1104	  1112	  1266	  1268	  1269	  1270	  1272	  1273	  1283	  1284	  1358
	  1360	  1362	  1385	  1387	  1389	  1457	  1459	  1759	  1824	  1869	  1873	  1880	  1881	  1883
	  1884	  1887	  1888	  1890	  1893	  1894	  1928	  1929	  1931	  1932	  1933	  1971	  1972	  2026
	  2027	  2039	  2040	  2041	  2042	  2123	  2125	  2129	  2134	  2135	  2136	  2137	  2197	  2198
	  2264	  2266	  2267	  2269	  2271	  2273	  2277	  2278	  2280	  2282	  2284	  2291	  2296	  2298
	  2299	  2303	  2304	  2315	  2319	  2329	  2346	  2399	  2400	  2402	  2404	  2429	  2431	  2432
	  2433	  2437	  2459	  2460	  2461	  2467	  2468	  2469	  2516	  2522	  2523	  2684	  2685	  2771
	  2772	  2773	  2832	  2833	  2834	  2835	  2836	  2839	  2842	  2843	  2846	  2847	  2849	  2850
	  2851	  2852	  2853	  2854	  2895	  2896	  2899	  2900	  2901	  2902	  3334	  3335	  3338	  3339
	  3345	  3346	  3347	  3348	  3349	  3358	  3360	  3361	  3377	  3392	  3394	  3395	  3397	  3398
	  3399	  3401	  3402	  3403	  3404	  3405	  3412	  3414	  3416	  3418	  3420	  3424	  3434	  3436
	  3438	  3440	  3442	  3444	  3965	  3966	  3979	  3980	  4013	  4016	  4058	  4059	  4060	  4120
	  4121	  4123	  4124	  4125	  4137	  4139	  4140	  4142	  4144	  4145	  4172
T4	   180	   183	   188	   218	   449	   453	   463	   464	   478	   480	   484	   489	   492	   494
	   497	   513	   519	   522	   526	   529	   535	   538	   564	   565	   916	   921	   925	   927
	  1258	  1263	  1264	  1267	  1268	  1271	  1272	  1278	  1279	  1285	  1286	  1289	  1290	  1293
	  1294	  1299	  1300	  1305	  1373	  1375	  1417	  1436	  1441	  1907	  1908	  1909	  1910	  1911
	  1912	  1915	  1917	  1920	  1923	  1936	  1937	  1938	  1939	  1940	  1941	  1943	  1944	  1945
	  1969	  1970	  1971	  2428	  2441	  2781	  2783	  2784	  2786	  2790	  2792	  2794	  2796	  2804
	  2805	  2812	  2815	  2816	  2818	  2819	  3074	  3079	  3082	  3088	  3092	  3098	  3099	  3163
	  3329	  3333	  3335	  3340	  3348	  3353	  3393	  3394	  3395	  3396	  3398	  3399	  3400	  3401
	  3413	  3414	  3415	  3417	  3418	  3419	  3435	  3436	  3439	  3440	  3705	  3768	  3797	  3825
	  3845	  3908	  3967	  3982
THSDAT	    51%	   921	   925	  1078	  1895	  1897	  1910	  1911	  2054
TIME	    51%
TPOPJ	    44%	   662	  1462	  1497	  2533	  2542	  3994	  4006
TPOPJ1	    44%
TRNERR	  3550	  3553
TST1U0	  4038#	  4045
TST1U2	  4039#	  4043
TST1U5	  4041	  4048#
TST1UN	  4029#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

TSTDSK	   175	   196#
TSTRES	   855	  1004	  1481#	  1501	  1789	  1978	  2570
TSTWRS	    62%	  2031
TSTWRT	    62%	  1383	  2035	  2625	  2686
TUTAB	  1704	  1720#	  3105
U	   206	  3583	  3585	  3587	  3588	  3591	  3592	  3594	  3607	  3608	  3610	  3611	  3614	  3615
	  3618	  3620	  3679	  3682	  3684	  3685	  3689	  3690	  3691	  3859	  3923	  4023	  4038	  4039
	  4040	  4042	  4043	  4048	  4065	  4067	  4074	  4089	  4091	  4092	  4096	  4098	  4099	  4100
	  4136	  4137	  4142	  4147	  4148	  4175
UCLSTR	  3783	  3824#
UENTR	   152	  1788#
UFDALP	   117%	   485	  1299	  1301	  1338
UFDATB	  1318#
UFDCDT	   117%	  1275	  1276	  1325
UFDEOF	   555	   575#
UFDER1	  1431#	  2982	  3019
UFDERR	   117%
UFDEXT	   117%	   452	   473	  1263	  1265
UFDLCN	   469	   472	   476	   539#
UFDLIC	   117%	   493	  1293	  1295	  1335
UFDLLP	   468#	   540
UFDLNK	   119%	   547	   583
UFDMS0	   601#	   604
UFDMSK	   392	   395	   593#
UFDNAM	   117%	   450	   468	   477	   565	  1260	  1261
UFDNMK	   390	   396#
UFDNSL	   451	   455#
UFDNXM	   401	   407	   410#	   558	   591
UFDPRT	    69%	  1887
UFDRIB	   117%	  1303	  1304
UFDRLK	   439	   457	   466	   563	   573	   579#
UFDSF0	   454	   459#
UFDSFD	   447	   461#
UFDSIZ	   118%	   446	   455	   459	   539
UFDSLP	   450#	   456
UFDSP1	   552#	   584	   585
UFDSPR	   435	   555#
UFDUUO	   158	   378#
UFNBLK	   483	   490#
UFNDAT	   496	   523	   527#
UFNLIC	   491	   495#
UFNNCV	   503	   525#
UFNSTS	   528	   536#
UFPERR	   117%
UFYCDT	   119%	   498
UFYCTM	   118%	   501	  1285	  1287	  1329
UFYPRV	   118%	   530	  1267	  1269	  1321
UFYUF1	   118%	   533	  1289	  1291	  1333
UFYUF2	   118%	   531	  1271	  1273	  1323
UFYXCD	   118%	   499	  1278	  1280	  1327
UILNMD	  1996	  2001	  2004	  3480#
ULKDBL	    62%	   265	   875	   951	   985	  1040	  1232	  3501
ULKSTR	  3782	  3823#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

ULOOK	   153	  1501#
ULOOK2	  1517	  1520	  1523	  1527#
ULOOK3	  1528	  1531	  1628#
UNCERR	  3764#	  3848	  3925
UNFERR	  3761#	  3852	  3921	  3922
UNICHR	    73%	  4091
UNIDES	    73%	  4067
UNIFEP	    74%	  4096
UNIHID	    74%	  4100
UNIKON	    73%	  3923
UNILOG	    73%	  4040	  4065	  4098	  4137	  4175
UNIMS1	  4121#	  4124
UNIMS2	  4122	  4125#
UNINAM	    73%	  3585	  3594	  3682	  3691	  4039	  4099	  4142
UNIPPU	    74%	  4092
UNISTR	    74%	   206	  4042	  4074
UNISYS	    73%	  3587	  3591	  3684	  3689	  4147
UNITAL	    73%	  1820	  4089
UNLFIL	   376%	   421	   428	  2509	  2535
UNPARG	  3074	  3322#
UNYSIZ	    75%	  3593
UNYSPU	    75%	  4095
UNYWPS	    75%	  4094
UPDAT1	  1985	  1992#
UPDATE	  1795	  1990#
UPDEN2	  2150	  2157#
UPDEN3	  2057	  2092#
UPDEN4	  2097	  2099#
UPDEN5	  2170#
UPDEND	  2086	  2088	  2114	  2142	  2152#
UPDER2	  2017	  2616	  2624	  3484#
UPDER3	  2028	  2032	  2036	  2626	  2637	  2687	  3487#
UPDERC	  3481#	  3485	  3488
UPDND3	  2149	  2153	  2181#
UPDND4	  2171#	  2183
UPDNU1	  1428	  1441#
UPDNUR	  1420	  1440#
UPDTD2	  2079	  2085#
UPDTDN	  2073#	  2109
UPDUF0	   903	  1371	  1407	  1415#
UPDUFD	  1123	  1416#
UPNSDT	  2059	  2065	  2100#
UPTJDA	    51%	   997	  2379	  2380	  2454	  2465	  2477	  2529	  2643
UPTPDL	    54%	   348
UPTPID	    50%	   625	   627	   631	  3273
UPTPJC	    49%	  1847
UPTPOS	   123%
UPTRB2	    52%	  1491
UPTRIB	    52%	  1490
UPTSAT	    52%	  1494
UPTSPD	    50%	   623	   636
USETI0	    61%	   122%	   155
USETO0	    61%	   122%	   156
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

USETST	   376%	   424
USIMUP	   164	  1977#
USRPP1	  2318#	  2323
USRPP2	  2320	  2323#
USRPP3	  2328#	  2333
USRPP4	  2330	  2333#
USRPP5	  2345#	  2353
USRPP6	  2341	  2347	  2352#
USRPPN	  2314#	  2362
USRUS1	  2471#
USRUS2	  2463	  2472#
USRUSI	  2420	  2453#	  2503
UUNATT	  1666	  1856	  2111	  2890	  2929
UUNEXT	  1668	  1923	  2113	  2237	  3527
UUNNAM	  2232
UUNPPN	  1664	  2099	  2196	  2207	  2226	  2242
UUOENT	    24#	    37	  1798	  2147	  2168	  2181	  2720	  2971
UUOIRE	    28#	    37	  2592
UUOLUK	    21#	    37	  1509	  2385	  2589
UUOMLK	    23#	    37
UUOMSK	    30#	  2191	  2602
UUOREN	    26#	    37	  2617	  2723	  2734	  2997	  3032	  3035
UUOSEK	    66%	   159
UUOSIM	    27#	  1984	  2029
UUOUFD	    25#	    37	  1842	  1848	  1886	  1942	  1951
UUOXWR	  1489#	  1492	  1495
UUPPID	    35#	    40	  2212
UUPWDS	    33#	  2125	  2129	  2145	  3141
UUXALC	  2085	  2124	  2143	  2935	  3149
UUXENT	  2215	  2216
UUXEXT	  1673	  1907	  1920	  2061	  2077	  2238	  3529
UUXLCW	  3351
UUXMXA	  3250	  3260
UUXNAM	  1526	  2233
UUXNUM	  2123	  2144	  3140
UUXPPN	  2226	  2243
UUXPRV	  1674	  1677	  1858	  1860	  1902	  2058	  2060	  2074	  2075	  2887	  2889	  2931	  2932
UUXSIZ	  1678	  1683	  1684	  2078	  2083
UUXSTS	  3174
UUXUSD	  3236
UUXVER	  1699	  1702	  1704	  3072	  3093	  3096	  3101	  3105
W	   997	  2379	  2380	  2454	  2459	  2465	  2477	  2529	  2643	  3866	  3894	  4071
W2BLSH	  1659	  2098	  3152
WAIT1	    51%	   283	  1464	  1992	  2569
WATPCB	    44%	  1129	  1235	  1374	  2993
WPJARG	  3088	  3326#
WRTARG	  3079	  3323#
WRTOK	  2021	  2024#
WRTOK1	  2030	  2035#
WRTOK2	  2034	  2038#
X	  2394	  2396	  2398	  2410	  2411	  2412	  2424	  2429	  2431	  2434	  2436	  2438	  2439	  2440
	  2544#
ZERDDB	    59%	  1960
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

ZERO5	  3776	  3777	  3778	  3779	  3780	  3781	  3782	  3783	  3784
ZZ	   294#	   294	   340#	   340	   385#	   385	   386#	   386	   387#	   387	   389#	   389	   399#	   399
	   448#	   448	   449#	   449	   463#	   463	   480#	   480	   481#	   481	   489#	   489	   494#	   494
	   522#	   522	   526#	   526	   535#	   535	   537#	   537	   543#	   543	   562#	   562	   567#	   567
	   571#	   571	   628#	   628	   637#	   637	  1526#	  1526	  1529#	  1529	  1664#	  1664	  1666#	  1666
	  1668#	  1668	  1673#	  1673	  1677#	  1677	  1683#	  1683	  1705#	  1705	  1861#	  1861	  1903#	  1903
	  1907#	  1907	  1920#	  1920	  1923#	  1923	  2060#	  2060	  2061#	  2061	  2075#	  2075	  2077#	  2077
	  2083#	  2083	  2099#	  2099	  2111#	  2111	  2113#	  2113	  2123#	  2123	  2124#	  2124	  2143#	  2143
	  2144#	  2144	  2192#	  2192	  2196#	  2196	  2207#	  2207	  2223#	  2223	  2224#	  2224	  2232#	  2232
	  2233#	  2233	  2237#	  2237	  2238#	  2238	  2242#	  2242	  2243#	  2243	  2361#	  2361	  2400#	  2400
	  2402#	  2402	  2522#	  2522	  2889#	  2889	  2890#	  2890	  2929#	  2929	  2932#	  2932	  3100#	  3100
	  3106#	  3106	  3140#	  3140	  3149#	  3149	  3174#	  3174	  3236#	  3236	  3250#	  3250	  3260#	  3260
	  3351#	  3351	  3474#	  3474	  3527#	  3527	  3529#	  3529	  3582#	  3582	  3595#	  3595	  3605#	  3605
	  3732#	  3732	  3742#	  3742	  3744#	  3744	  3746#	  3746	  3771#	  3771	  3809#	  3809	  3812#	  3812
	  3817#	  3817	  3829#	  3829	  3830#	  3830	  3846#	  3846	  3856#	  3856	  3866#	  3866	  3894#	  3894
	  3918#	  3918	  3935#	  3935	  3937#	  3937	  3951#	  3951	  3985#	  3985	  4071#	  4071	  4082#	  4082
ZZ1	   294#	   294	   340#	   340	   385#	   385	   386#	   386	   387#	   387	   389#	   389	   399#	   399
	   448#	   448	   449#	   449	   463#	   463	   480#	   480	   481#	   481	   489#	   489	   494#	   494
	   522#	   522	   526#	   526	   535#	   535	   537#	   537	   543#	   543	   562#	   562	   567#	   567
	   571#	   571	   628#	   628	   637#	   637	  1526#	  1526	  1529#	  1529	  1664#	  1664	  1666#	  1666
	  1668#	  1668	  1673#	  1673	  1677#	  1677	  1683#	  1683	  1705#	  1705	  1861#	  1861	  1903#	  1903
	  1907#	  1907	  1920#	  1920	  1923#	  1923	  2060#	  2060	  2061#	  2061	  2075#	  2075	  2077#	  2077
	  2083#	  2083	  2099#	  2099	  2111#	  2111	  2113#	  2113	  2123#	  2123	  2124#	  2124	  2143#	  2143
	  2144#	  2144	  2192#	  2192	  2196#	  2196	  2207#	  2207	  2223#	  2223	  2224#	  2224	  2232#	  2232
	  2233#	  2233	  2237#	  2237	  2238#	  2238	  2242#	  2242	  2243#	  2243	  2361#	  2361	  2400#	  2400
	  2402#	  2402	  2522#	  2522	  2889#	  2889	  2890#	  2890	  2929#	  2929	  2932#	  2932	  3100#	  3100
	  3106#	  3106	  3140#	  3140	  3149#	  3149	  3174#	  3174	  3236#	  3236	  3250#	  3250	  3260#	  3260
	  3351#	  3351	  3474#	  3474	  3527#	  3527	  3529#	  3529	  3582#	  3582	  3595#	  3595	  3605#	  3605
	  3732#	  3732	  3742#	  3742	  3744#	  3744	  3746#	  3746	  3771#	  3771	  3809#	  3809	  3812#	  3812
	  3817#	  3817	  3829#	  3829	  3830#	  3830	  3846#	  3846	  3856#	  3856	  3866#	  3866	  3894#	  3894
	  3918#	  3918	  3935#	  3935	  3937#	  3937	  3951#	  3951	  3985#	  3985	  4071#	  4071	  4082#	  4082
%%XCOD	  3874#	  3877	  3878	  3878#	  3879	  3879#	  3880	  3880#	  3881	  3881#	  3882	  3882#	  3883	  3883#
	  3884	  3884#	  3885	  3885#	  3886	  3886#	  3887	  3887#	  3888	  3888#	  3889	  3889#	  3890	  3890#
	  3891	  3891#	  3892	  3892#
%%Z	  3286#	  3290	  3290#	  3291	  3291#	  3292	  3292#	  3293	  3293#	  3294	  3294#	  3295	  3295#	  3296
	  3296#	  3297	  3297#	  3298	  3298#	  3299	  3299#	  3300	  3300#	  3301	  3301#	  3302	  3302#	  3303
	  3303#	  3304	  3304#	  3305	  3305#	  3306	  3306#	  3307	  3307#	  3308	  3308#	  3309	  3309#	  3310
	  3310#	  3311	  3311#	  3312	  3312#	  3313	  3313#	  3314	  3314#	  3315	  3315#	  3316	  3316#	  3317
	  3317#	  3318	  3318#
%COW	  2451%	  2482	  2485	  2487	  2508
%COW.N	  2451%	  2456	  2472	  2492	  2498	  2510
%CTUPT	    61%	  1693
%RB2.C	    64%
%RIB	   450	   452	   468	   473	   477	   485	   493	   547	   565	   583	   932	   934	   935	  1019
	  1076	  1077	  1084	  1086	  1088	  1096	  1097	  1099	  1100	  1102	  1103	  1110	  1111	  1245
	  1247	  1248	  1250	  1260	  1261	  1263	  1265	  1275	  1276	  1293	  1295	  1299	  1301	  1303
	  1304	  1325	  1335	  1338	  1720	  1721	  1722	  1724	  1725	  1726	  1727	  1728	  1729	  1730
	  1731	  1732	  1733	  1736	  1737	  1738	  1739	  1740	  1742	  1743	  1744	  1745	  1746	  1749
	  1750	  1766	  1771	  1775	  1776	  1832	  1833	  1834	  1839	  1847	  1849	  1852	  1927	  1930
	  1931	  1933	  1935	  1937	  1939	  1940	  1945	  1948	  1950	  1955	  2158	  2164	  2825	  2828
	  2831	  2884	  2925	  2927	  2948	  2954	  2959	  2968	  3111	  3112	  3113	  3115	  3116	  3118
	  3119	  3124	  3127	  3130	  3131	  3134	  3135	  3136	  3143	  3144	  3145	  3166	  3168	  3173
	  3191	  3200	  3206	  3207	  3212	  3220	  3225	  3228	  3229	  3233	  3234	  3244	  3245	  3246
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Symbol cross reference

	  3247	  3249	  3253	  3257	  3258	  3277
%RIB.C	    61%	   436	  1693	  1830
%UPT	    54%	   348	   623	   625	   627	   631	   636	   997	  1490	  1491	  1494	  1847	  2379	  2380
	  2454	  2465	  2477	  2529	  2643	  3273
.CPDWD	  2286%	  2286	  2335%	  2335
.ERFSA	  3646#
.ERILE	  3640#	  3699
.ERILF	  3637#	  3760
.ERILL	  3647#	  3701	  3755
.ERMCN	  3644#
.ERNCS	  3650#	  3762
.ERNFS	  3649#
.ERNPV	  3645#	  3756
.ERPPN	  3643#	  3700	  3757
.ERRSL	  3652#
.ERSNF	  3638#	  3758
.ERSSA	  3639#
.ERTME	  3641#
.ERUNA	  3642#
.ERUNC	  3648#	  3764
.ERUNF	  3651#	  3761
.FSDEF	  3630#
.FSDSL	  3629#
.FSLOK	  3632#
.FSRDF	  3631#
.FSREM	  3633#
.FSSRC	  3628#
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Macro/Opdef cross reference

CHANIO	  2461
ERCODE	  3656#	  3699	  3700	  3701	  3755	  3756	  3757	  3758	  3760	  3761	  3762	  3764
IFCPU	  4104	  4108
IFNCPU	  4105
NOCHAR	   384	   840	  1005	  1505	  1788	  1977	  2568
PERSET	  2473
PJRST	   313	   423	   427	   581	   701	   721	   769	   793	   809	   839	   879	   880	   998	  1057
	  1235	  1243	  1251	  1361	  1365	  1408	  1476	  1716	  1767	  1974	  2533	  2542	  2604	  2606
	  2669	  2995	  3502	  3510	  3828	  3833	  3913
PJSP	  1427
PJUMPE	  3831
PRINTF	   324	   710	  1815	  2204	  2748	  4021
PXCT	   294	   340	   385	   386	   387	   389	   399	   448	   449	   463	   480	   481	   489	   494
	   522	   526	   535	   537	   543	   562	   567	   571	   628	   637	  1526	  1529	  1664	  1666
	  1668	  1673	  1677	  1683	  1705	  1861	  1903	  1907	  1920	  1923	  2060	  2061	  2075	  2077
	  2083	  2099	  2111	  2113	  2123	  2124	  2143	  2144	  2192	  2196	  2207	  2223	  2224	  2232
	  2233	  2237	  2238	  2242	  2243	  2361	  2400	  2402	  2522	  2889	  2890	  2929	  2932	  3100
	  3106	  3140	  3149	  3174	  3236	  3250	  3260	  3351	  3474	  3527	  3529	  3582	  3595	  3605
	  3732	  3742	  3744	  3746	  3771	  3809	  3812	  3817	  3829	  3830	  3846	  3856	  3866	  3894
	  3918	  3935	  3937	  3951	  3985	  4071	  4082
PXGEN	   294	   340	   385	   386	   387	   389	   399	   448	   449	   463	   480	   481	   489	   494
	   522	   526	   535	   537	   543	   562	   567	   571	   628	   637	  1526	  1529	  1664	  1666
	  1668	  1673	  1677	  1683	  1705	  1861	  1903	  1907	  1920	  1923	  2060	  2061	  2075	  2077
	  2083	  2099	  2111	  2113	  2123	  2124	  2143	  2144	  2192	  2196	  2207	  2223	  2224	  2232
	  2233	  2237	  2238	  2242	  2243	  2361	  2400	  2402	  2522	  2889	  2890	  2929	  2932	  3100
	  3106	  3140	  3149	  3174	  3236	  3250	  3260	  3351	  3474	  3527	  3529	  3582	  3595	  3605
	  3732	  3742	  3744	  3746	  3771	  3809	  3812	  3817	  3829	  3830	  3846	  3856	  3866	  3894
	  3918	  3935	  3937	  3951	  3985	  4071	  4082
STOPCD	    10	   146	   147	   242	   255	   262	   690	   850	   970	   994	  1013	  1053	  1143	  1149
	  1217	  1228	  1319	  1431	  1443	  1489	  1492	  1495	  2043	  2047	  2471	  2474	  2494	  2500
	  2512	  2695	  2715	  2774	  2779	  2800	  2810	  2943	  2982	  2990	  3019	  3052	  3500	  3544
	  3562	  4010	  4165
TXXGEN	  3158#	  3163
UMOVE	   340	   385	   448	   463	   481	  1529	  2060	  2061	  2123	  2143	  2144	  2192	  2233	  2238
	  2243	  2400	  2402	  2890	  3100	  3140	  3582	  3605	  3732	  3771	  3809	  3829	  3830	  3846
	  3856	  3918	  3935	  3937	  3951	  3985
UMOVEM	   294	   489	   494	   526	   535	   571	   628	   637	  1526	  1666	  1677	  1683	  1705	  1903
	  2075	  2083	  2111	  2207	  2929	  2932	  3106	  3149	  3174	  3236	  3250	  3260	  3351	  3595
	  3742	  3866	  3894	  4071	  4082
VREMOV	  2493	  2499	  2511
XA	  3284#	  3290	  3291	  3292	  3293	  3294	  3295	  3296	  3297	  3298	  3299	  3300	  3301	  3302
	  3303	  3304	  3305	  3306	  3307	  3308	  3309	  3310	  3311	  3312	  3313	  3314	  3315	  3316
	  3317	  3318
XCOD	  3872#	  3877	  3878	  3879	  3880	  3881	  3882	  3883	  3884	  3885	  3886	  3887	  3888	  3889
	  3890	  3891
XCTBU	   386	   387	   389	   399	   449	   480	   522	   537	   543	   562	   567	  1668	  1673	  1907
	  1920	  1923	  2077	  2099	  2113	  2196	  2223	  2361	  2522	  3527	  3529	  3744	  3746	  3812
	  3817
XCTFU	   340	   385	   448	   463	   481	  1529	  1861	  2060	  2061	  2123	  2124	  2143	  2144	  2192
	  2224	  2232	  2233	  2237	  2238	  2242	  2243	  2400	  2402	  2889	  2890	  3100	  3140	  3474
	  3582	  3605	  3732	  3771	  3809	  3829	  3830	  3846	  3856	  3918	  3935	  3937	  3951	  3985
XCTTU	   294	   489	   494	   526	   535	   571	   628	   637	  1526	  1664	  1666	  1677	  1683	  1705
	  1903	  2075	  2083	  2111	  2207	  2929	  2932	  3106	  3149	  3174	  3236	  3250	  3260	  3351
FILUUO	DISK SERVICE ROUTINE	MACRO 12.5-46.0 14:25 13-JAN-88
FILUUO.MAC	 8-DEC-87 11:25		Macro/Opdef cross reference

	  3595	  3742	  3866	  3894	  4071	  4082
XP	  3628	  3629	  3630	  3631	  3632	  3633	  3637	  3638	  3639	  3640	  3641	  3642	  3643	  3644
	  3645	  3646	  3647	  3648	  3649	  3650	  3651	  3652
$END	  4179 9@<6
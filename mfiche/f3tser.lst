F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH FOONLY PARAMETER FILE - F3SYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST F3SYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS
     9				SUBTTL	This hack written by Daniel S. Blom
    10				;P035/A09 11-Jan-87 modified by Joe Smith to use %MTA instead of %ONC
    11
    12					STOPCD(,ENTRY,F3TSER)^
    13					ENTRY	F3TSER		;For library searches
    14	000000'	260040	000000*	F3TSER::PUSHJ	P,DIE		;**** Default stopcode for "F3TSER" ****
    15	000001'	462364	634562		SIXBIT	/F3TSER/  	;Title of module
    16	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "F3TSER+nnn(nnnnnn)"
    17			000000'	S$NAME==F3TSER			;For STOPCDs with no arguments
    18					SALL>
    19				^
    20
    21				;EXTERNALS:
    22
    23				EXTERN TMX0CB,MAGDDS,TU0CB,MTUDBL,TIBTBL,BITTBL
    24				EXTERN MTREQ,MTAVAL,MTWAIT,JBTABT,MAGSAV
    25				EXTERN TKBIUN,TKBCUN
    26				EXTERN DEVUDB,DEVCNT,DEVFNJ,DEVDWC
    27				EXTERN DEVER1,DEVDIO,DEVMD1
    28				EXTERN TUBDDB,UNITYP,TUBHC,TUBKDB,TUYTMN,TUYTUN,TUBIWC,TUBS
    29				EXTERN TUBEC,TUBSB
    30				EXTERN TUBICW,TUBCOM
    31
    32				EXTERN SETHNG,PIOMOD,CPOPJ,CPOPJ1,WAIT1,SETIOD
    33				EXTERN HNGSTP,JBTIOA,PJOBN,SYDNM4,SYDCOM,JBTLIC
    34				EXTERN DSKPIF,DSKPIN,PAGWAK,PGYDIO
    35				EXTERN TUBIFC,TUBCNT,TUBCLS,TUBER1,TUBER2
    36				EXTERN MAGCHN
    37
    38				;Unit characteristics.  Those marked with '*' are also stored in
    39				; Lh(UNITYP) in the UDB of a unit.  The others are only returned
    40				; by the UGETF uuo.
    41			400000	WRPROT==400000	;Write protected (DSWRL on)
    42			040000	LOADPT==40000	;Tape at load point
    43			020000	TAPEIN==20000	;Tape at EOT.
    44			000100	TRK9==100	;* 9 track tape
    45			000010	DS1600==10	;* 1600cpi
    46			000004	DS800==4	;* 800cpi
    47				;Bits in DEVIOS (which is frequently cached in S):
    48			010000	SFDONE==10000	;SF/BSF finished.
    49			020000	HASCTL==20000	;Job using this channel has controller locked.
    50			040000	HNGTAP==40000
    51			001000	IOLEND==1000
    52
    53				;These are the only entry points:
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 1
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

    54				    INTERN MAGINT,MAGDSP,MAGINI,SYDTMX
    55
    56	000003'	777777	740000	    MSKCTD: XWD 777777,740000	;MASK TO CHANGE THE COUNT BYTE
    57								;FROM THE DDB INTO A NUMBER.
    58	000004'	777777	774000	    MSKCTU: XWD 777777,774000	;MASK TO CHANGE THE COUNT BYTE
    59								;FROM UNIT CMD WORD INTO A NUMBER.
    60			777760	    MSKMMD==777760		;MASKS OUT ALL BUT MEM ADDR
    61								;FROM DDB WORDS.
    62			777700	    MSKMMU==777700		;MASKS OUT ALL BUT MEM ADDR
    63								;FROM UNIT CMD WORDS.
    64	000005'	777777	774000	    DATASZ: XWD 777777,774000	;-(2**11).
    65
    66			000001	OLDCTL==1
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

    67				;DEFINITIONS FOR F3 TAPE CONTROL
    68
    69				OPDEF MTRS [726000,,0]		;TAPE READ STATUS
    70					;AC/COUNT FROM LAST IOWD IN 1-15, ABSOLUTE MA
    71					; OF LAST WORD TRANSFERRED IN LAST DATA TRANSFER IN 16-35
    72
    73					;E/STATUS BITS AS FOLLOWS:
    74
    75		400000	000000		ANYERR==1B0		;SET IF ANY ERROR OR EOF WAS SEEN
    76		200000	000000		  EOF==1B1		;END OF FILE PASSED OVER ON READ.
    77								;PHYSICAL EOT SEEN ON WRITE.
    78		100000	000000		  PARERR==1B2		;PARITY ERROR
    79		040000	000000		  LENERR==1B3		;LENGTH ERROR
    80		020000	000000		  TIMOUT==1B4		;MICROCODE TIMED OUT TRANSFER.
    81		010000	000000		  OVRRUN==1B5		;OVERRUN
    82		170000	000000		    ERRMSK==PARERR!LENERR!TIMOUT!OVRRUN
    83
    84		000040	000000		ONLINE==1B12		;SELECTED UNIT IS ONLINE
    85		000020	000000		RIP==1B13		;REWIND IN PROGRESS
    86		000010	000000		WP==1B14		;WRITE PROTECTED
    87		000004	000000		LODPNT==1B15		;LOAD POINT
    88		000002	000000		READY==1B16		;UNIT IS READY
    89		000001	000000		EOT==1B17		;PHYSICAL END OF TAPE ENCOUNTERED
    90								;ONLY ON IF RIGHT AT EOT. DOESNT
    91								;STAY ON FOR READ WHEN EOT PASSES BY. DON'T
    92								; CHECK FOR WRITE, CHECK EOF INSTEAD.
    93			400000		INTREQ==1B18		;INERRUPT REQUEST
    94			200000		CTLAVL==1B19		;CONTROL FREE
    95
    96				;BITS 20-32 REFLECT LAST MTOP DONE.
    97
    98			000007		PIA==7B35		;AS USUAL, PI ASSIGNMENT
    99
   100				OPDEF MTOP [727000,,0]		;PERFORM TAPE OPERATION
   101						;AC/FIRST CHANNEL COMMAND WORD IF DATA XFER OPERATION.
   102						;FORMAT OF COMMAND WORDS:
   103		400000	000000		CCWJMP==1B0		;IF SET, ADDRESS IS JUMP ADDRESS
   104		377760	000000		CCWCNT==377760,,0	;MASK FOR COUNT (WORD OR BYTE)
   105		000017	777777		CCWADR==17,,777777	;MASK FOR ADDRESS (SHOULD BE 22 BITS, ONLY 20 HERE)
   106
   107						;E - IMMEDIATE VALUE USED TO DO COMMAND, BITS AS FOLLOWS:
   108
   109			100000		EVNPAR==1B20		;EVEN PARITY
   110			030000		XFRMOD==3B23		;TRANSFER MODE
   111			000000		  XFRCDM==0B23		;WORD CORE DUMP MODE
   112			010000		  XFRBYT=1B23		;IBM 4 8 BIT BYTE MODE
   113			006000		UNIT==3B25		;UNIT
   114			001700		CMD==17B29		;COMMAND FIELD
   115			000000		  F.REWI==0
   116			000001		  F.RO==1		;REWIND AND PUT OFF LINE (UNLOAD)
   117			000002		  F.WTM==2		;WRITE TAPE MARK
   118			000003		  F.EG==3		;ERASE GAP
   119			000004		  F.SKR==4		;SKIP ONE REC FORWARD
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 2-2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   120			000005		  F.BSR==5		;BACKSPACE OVER LAST RECORD
   121				;	  F.SFR==6		;SKIP FORWARD TO TAPE MARK (NOT USED SO DOESN'T TIE UP CONTROL)
   122
   123				;	  F.SBR==7		;SKIP BACKWARD TO LAST TAPE MARK (ALSO NOT USED)
   124			000010		  F.RF==10		;READ A RECORD
   125			000011		  F.WF==11		;WRITE A RECORD.
   126			000070		DENS==7B32		;DENSITY TO USE
   127			000000		  DN200==0
   128			000001		  DN556==1
   129			000002		  DN800==2
   130			000003		  DN1600==3
   131			000004		  DN6250==4
   132
   133			000007		PIA==7B35		;PI ASSIGNMENT
   134
   135				OPDEF MTSZ [730000,,0]		;CONSZ FOR TAPE STATUS
   136
   137				OPDEF MTSO [731000,,0]		;CONSO FOR TAPE STATUS
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 3
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   138				;Dispatch table used by device independent routines.
   139
   140	777776			 	PHASE -2
   141	000006'	254000	000512'	DDO:	JRST TMXWRT
   142	000007'	254000	000511'	DDI:	JRST TMXRED
   143	000010'				DEPHASE
   144	000000			MAGDSP:	PHASE 0
   145	000010'	000000	000015	DDXZ:	DSPSIZ
   146	000011'	263040	000000	DDINT:	POPJ	P,
   147	000012'	004400	004400	DBYT:	4400,,4400
   148	000013'	201300	000000*	DVSIZ:	MOVEI T1,MAGDDS
   149	000014'	254000	000026'	DINI:	JRST MAGINI
   150	000015'	254000	000105'	DHNG:	JRST TMXHNG
   151	000016'	254000	000045'	DRL:	JRST TMXREL
   152	000017'	254000	000053'	DCL:	JRST TMXCLS
   153	000020'	254000	000512'	DOU:	JRST TMXWRT
   154	000021'	254000	000511'	DIN:	JRST TMXRED
   155	000022'	263040	000000	DZAP:	POPJ	P,
   156	000023'	254000	000627'	DGTRD:	JRST TMXGRD
   157	000024'	254000	000352'	DMT:	JRST FTAPE
   158	000025'	254000	000275'	DGF:	JRST TMXUGF
   159			000015		DSPSIZ==.-1
   160	000026'				DEPHASE
   161
   162
   163
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 4
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   164				COMMENT ;@@SUBROUTNE MAGINI
   165				INITIALIZE F3 TAPE CONTROL AND DRIVES. SETS LH(UNITYP) TO 0 IF
   166				DRIVE IS OFF LINE, OR TO DS800+DS1600 IF IT IS ONLINE.
   167
   168				@@DESTROYS T1,T2,T2.
   169				@@CALLED BY SYSINI WITH THE PI SYSTEM OFF.
   170				@@;
   171
   172	000026'	261040	000005	MAGINI:	PUSH	P,U
   173	000027'	550244	000000*		HRRZ	U,DEVUDB(F)
   174	000030'	550405	000000*		HRRZ	T3,TUBKDB(U)	;GET KDB ADDR IN T3
   175	000031'	200350	000000*		MOVE	T2,TKBIUN(T3)		;GET AOBJN POINTER TO UDBS
   176
   177	000032'	200247	000000	MAGIN1:	MOVE	U,(T2)
   178	000033'	261040	000007		PUSH	P,T2		;SAVE T2, GETST RETURNS STATUS IN IT
   179	000034'	260040	001331'		PUSHJ	P,GETST		;GET TAPE STATUS WORD IN T1
   180	000035'	607300	000040		TLNN	T1,(ONLINE)	;ONLINE?
   181	000036'	634300	000006		 TDZA	T1,T1		;NO
   182	000037'	201300	000014		MOVEI	T1,DS1600+DS800
   183	000040'	516305	000000*		HRLZM	T1,UNITYP(U)	;EITHER 0 IF OFFLINE OR DENSITIES
   184	000041'	262040	000007		POP	P,T2		;RESTORE AOBJN POINTER
   185	000042'	253340	000032'		AOBJN	T2,MAGIN1
   186	000043'	262040	000005		POP	P,U		;RSTORE U
   187	000044'	263040	000000		POPJ	P,		;AND RETURN.
   188
   189
   190
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 5
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   191				COMMENT %@@SUBROUTINE TMXREL
   192				RELEAS uuo.
   193				Waits for I/O to complete for the unit and then clears function in progress
   194				(the halves of devfnj), and devsts.
   195				@@ENTRY Expects F=DDB.
   196				@@ACCUM SETS S TO DEVIOS.
   197				@@CALLS WAIT1.
   198				@@CALLED UUO. @@%
   199
   200	000045'	260040	000000*	TMXREL:	PUSHJ	P,WAIT1		;Wait until device stops
   201	000046'	402004	000000*		SETZM	DEVFNJ(F)	;No byte adjustment
   202	000047'	402004	000000*		SETZM	DEVMD1(F)	;Turn off IBM compatability
   203	000050'	202004	000002		MOVEM	S,DEVIOS(F)	;Save S.
   204	000051'	402004	000012		SETZM	DEVSTS(F)
   205	000052'	263040	000000		POPJ	P,
   206
   207
   208
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 6
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   209				COMMENT %@@SUBROUTINE TMXCLS
   210				Process CLOSE uuo.
   211				If output has been done, an attempt is made to
   212				write two tape marks (logical eot) on the tape and then to
   213				backspace over one of them.  This routine does nothing if
   214				output hasn't been done.
   215				@@EXPECTS F=DDB.
   216				@@DESTROYS all but U, F.
   217				@@CALLS WAIT1, FT1CM2 (PART OF THE TMXPE ROUTINE), SAVAIL,
   218				FHGSTP, AND ITS OWN INTERNAL ROUTINE TMXCL6.
   219				@@ERRORS If the tape is write locked, just exit (ioimpm has
   220				been set at interrupt level.).
   221				@@CALLED UUO. @@%
   222
   223	000053'	607200	004000	TMXCLS:	TLNN F,OUTPB		;Were we doing output?
   224	000054'	263040	000000		 POPJ	P,			;No, nothing to do.
   225	000055'	260040	000045*		PUSHJ	P,WAIT1		;Yes, wait for device to stop.
   226	000056'	201540	000002		MOVEI M,I.WTM		;Write tape mark.
   227	000057'	550244	000027*		HRRZ U,DEVUDB(F)
   228	000060'	260040	000072'		PUSHJ	P,TMXCL6
   229	000061'	602000	400000		TRNE S,IOIMPM		;Write locked?
   230	000062'	263040	000000		 POPJ	P,			;Yes, just return.
   231	000063'	201540	000002		MOVEI M,I.WTM		;No, write second mark
   232	000064'	260040	000072'		PUSHJ	P,TMXCL6
   233	000065'	201540	000004		MOVEI M,I.BSR		;Backup one record.
   234	000066'	260040	000072'		PUSHJ	P,TMXCL6
   235	000067'	620000	020000		TRZ S,IODEND		;Clear EOF.
   236	000070'	202004	000002		MOVEM S,DEVIOS(F)
   237	000071'	263040	000000		POPJ	P,
   238
   239	000072'	260040	000612'	TMXCL6:	PUSHJ	P,SAVAIL		;See if it's online
   240	000073'	260040	000552'	TMXCL7:	PUSHJ	P,GETCTL		;Grab controller.
   241	000074'	260040	000426'		PUSHJ	P,FT1CM2		;Start function
   242	000075'	260040	000055*		PUSHJ	P,WAIT1		;Wait for operation to complete.
   243	000076'	616000	001502'		TDNN S,[HNGTAP,,IODERR+IODTER]	;Trouble?
   244	000077'	263040	000000		 POPJ	P,			;N, return.
   245	000100'	260040	001334'	TMXCL8:	PUSHJ	P,FHGSTP		;Yes, tell the user.
   246	000101'	200004	000002		MOVE S,DEVIOS(F)
   247	000102'	603000	040000		TLNE S,HNGTAP		;Still hung?
   248	000103'	254000	000100'		 JRST TMXCL8		;Yes, try again.
   249	000104'	254000	000073'		JRST TMXCL7		;No, try operation again.
   250
   251
   252
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 7
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   253				COMMENT %@@SUBROUTINE TMXHNG
   254				Call here from once a second code in UUOCON after PDVCNT
   255				field counts to zero.  Current implementation gives
   256				127. seconds between calls here.
   257				If IOACT has been on through 2 calls, we say the
   258				device is hung.
   259				@@EXPECTS F=DDB.
   260				@@DESTROYS T1, T2.
   261				@@EXIT Skip returns unless it thinks the device is hung, in
   262				which case it cleans up some locations and then non-skip
   263				returns.
   264				@@CALLS SETHNG, SDCIOA, AND CPOPJ.
   265				@@%
   266
   267				DEFINE DSKOFF <WRPI DSKPIF>
   268				DEFINE DSKON <WRPI DSKPIN>
   269
   270
   271	000105'			TMXHNG:
   272	000105'	700600	000000*		DSKOFF
   273	000106'	200004	000002		MOVE S,DEVIOS(F)
   274	000107'	606000	010000		TRNN S,IOACT		;Did an interrupt sneak in?
   275	000110'	254000	000122'		 JRST TMXHC2		;Yes, say not hung
   276	000111'	261040	000005		PUSH P,U
   277	000112'	550244	000057*		HRRZ U,DEVUDB(F)	;U=UDB
   278	000113'	550345	000030*		HRRZ T2,TUBKDB(U)	;T2=KDB
   279	000114'	550305	000040*		HRRZ T1,UNITYP(U)	;Is this the second time here?
   280	000115'	326300	000125'		JUMPN T1,TMXHN8		;J-Yes, in which case we say it's hung.
   281	000116'	340300	000000		AOJ T1,			;Count times through here.
   282	000117'	542305	000114*		HRRM T1,UNITYP(U)
   283	000120'	260040	000000*	TMXHCT:	PUSHJ	P,SETHNG		;Reset hung count
   284	000121'	262040	000005	TMXHC3:	POP P,U
   285	000122'	700600	000000*	TMXHC2:	DSKON
   286	000123'	202004	000002		MOVEM	S,DEVIOS(F)	;MAKE SURE ANY CHANGED BITS ARE STORED INTO DDB
   287								;(IOACT, HASCTL)
   288	000124'	254000	000000*		JRST CPOPJ1
   289
   290	000125'	350005	000000*	TMXHN8:	AOS TUBHC(U)		;Say it's hung
   291	000126'	623000	020000		TLZE S,HASCTL
   292	000127'	260040	000563'		 PUSHJ	P,RELCTL
   293	000130'	553004	000000*		HRRZS DEVER1(F)		;Turn off error processing
   294	000131'	402005	000000*		SETZM TUBER1(U)		;Clear error rec. state.
   295	000132'	550105	000113*		HRRZ	J,TUBKDB(U)	;GET KONTROLLER DATA BLOCK
   296	000133'	316242	000000*		CAMN	U,TKBCUN(J)	;IS THIS CURRENT UNIT?
   297	000134'	402002	000133*		SETZM	TKBCUN(J)	;YES, NOT ANY LONGER.
   298	000135'	261040	000010		PUSH	P,T3
   299	000136'	260040	001331'		PUSHJ	P,GETST
   300	000137'	202305	000000*		MOVEM	T1,TUBSB(U)	;PUT INTO UDB.
   301	000140'	262040	000010		POP	P,T3
   302				IFN OLDCTL,<
   303	000141'	734000	000100*		TPCONO	100+MAGCHN	;STOP THE TAPE.
   304				>
   305				IFE OLDCTL,<PRINTX [TMXHN8: DON'T KNOW HOW TO CLEAR DRIVE IN NEW CTL]>
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 7-2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   306	000142'	260040	000145'		PUSHJ	P,SDCIOA		;Unlock pages if I/O, and clear fcn
   307	000143'	370001	777777		SOS -1(P)		;Setup for single return
   308	000144'	254000	000121'		JRST TMXHC3
   309
   310				COMMENT %@@SUBROUTINE SDCIOA/SDCIO2
   311				Decrement the "don't swap while
   312				ioact" count (JBTIOA) AND say no function is in progress.
   313				1. Clear the function code in the Lh(DEVFNJ).
   314				2. For read and write functions, decrease JBTIOA for the job.
   315				@@ENTRY F=DDB, T1=function in progress.
   316				@@DESTROYS T1, T2.
   317				@@CALLED UUO, I-level. @@%
   318
   319	000145'	554304	000046*	SDCIOA:	HLRZ T1,DEVFNJ(F)	;Get function which the device just finished.
   320	000146'	305300	000011		CAIGE T1,FTC		;Data transfer command?
   321	000147'	254000	000153'		 JRST SDCIO4		;No, just say no current operation.
   322	000150'	135300	000000*	SDCIO2:	LDB T1,PJOBN		;Yes, one less reason why he's locked in core
   323	000151'	370006	000000*		SOS JBTIOA(T1)
   324	000152'	260040	000166'	SDCIO3:	PUSHJ	P,DDIO		;Mark I/O done on all pages.
   325	000153'	553004	000145*	SDCIO4:	HRRZS DEVFNJ(F)		;Remember function finished.
   326	000154'	263040	000000		POPJ	P,
   327
   328				;HERE FROM ONCE A SECOND CODE FOR EACH TAPE WITH IOACT ON.
   329				; CHECK TO SEE IF TAPE IS REWINDING, IF SO FAKE AN INTERRUPT
   330				; IN CASE IT IS FINISHED. THIS IS A TEMPORARY HACK!!!!!!
   331
   332				IF2,<PRINTX [F3TRWC+0: Check for drive dropping off line during rewind check]>
   333
   334	000155'	554304	000153*	F3TRWC::HLRZ	T1,DEVFNJ(F)	;GET FUNCTION
   335	000156'	302300	000001		CAIE	T1,I.REWI
   336	000157'	306300	000005		CAIN	T1,I.RO		;IF REWIND OR REWIND OFF LINE
   337	000160'	254000	000162'		JRST	.+2		;IS
   338	000161'	263040	000000		POPJ	P,		;NOT
   339	000162'	476000	000165'		SETOM	REWFLG		;THEN FAKE AN INTERRUPT. MAY OR MAY NOT BE DONE.
   340	000163'	700600	000000*		WRPI	LI.REQ+1_<7-MAGCHN>
   341	000164'	263040	000000		POPJ	P,
   342
   343	000165'	000000	000000	REWFLG:	0
   344
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 8
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   345				COMMENT #
   346				@@SUBROUTINE DDIO
   347				Decrement PGYDIO for pages from DEVDIO to the end of the list.
   348				Calls PAGWAK to wake waiters for the page if PGYDIO goes to zero.
   349				@@DESTROYS T1, T2.
   350				@@ #
   351
   352	000166'	261040	000011	DDIO:	PUSH P,T4
   353	000167'	550444	000000*		HRRZ T4,DEVDIO(F)	;T4/ Address of list.
   354	000170'	336311	000000	N T1,(T4)		;Anything there?
   355	000171'	254000	000204'		 JRST POPT4J		;No.
   356	000172'	261040	000003		PUSH P,PG
   357	000173'	261040	000002		PUSH P,J
   358	000174'	260040	000227'	DECDI2:	PUSHJ	P,BUFKRN		;Free pages specified by IOWDs up to next 0.
   359	000175'	135340	000000*		LDB T2,PIOMOD		;Done if D or DR.
   360	000176'	301340	000016		CAIL T2,DR
   361	000177'	254000	000202'		 JRST .+3
   362	000200'	332311	000001		SKIPE T1,1(T4)		;B - need 2 consequative 0s to finish.
   363	000201'	344440	000174'		 AOJA T4,DECDI2
   364	000202'	262040	000002		POP P,J
   365	000203'	262040	000003		POP P,PG
   366	000204'	262040	000011	POPT4J:	POP P,T4
   367	000205'	263040	000000		POPJ	P,
   368
   369				COMMENT #
   370				@@SUBROUTINE BDIO
   371				Decrease the I/O use count on all pages specified by the list of IOWDs
   372				pointed at by DEVDIO.  Wakes jobs waiting for pages which
   373				are no longer unavailable by virtue of being used in tape I/O.
   374				@@ #
   375
   376	000206'	261040	000006	BDIO:	PUSH P,T1
   377	000207'	261040	000007		PUSH P,T2
   378	000210'	261040	000011		PUSH P,T4
   379	000211'	261040	000003		PUSH P,PG
   380	000212'	261040	000002		PUSH P,J
   381	000213'	550444	000167*		HRRZ T4,DEVDIO(F)	;T4:=Address of list of IOWDs comprising xfr
   382	000214'	336311	000000		SKIPN T1,(T4)
   383	000215'	256000	001503'		 STOPCD (.,JOB,MTANIB,,<No IOWDS in BDIO>)
   384	000216'	260040	000227'		PUSHJ	P,BUFKRN		;Process until next 0 word
   385	000217'	201451	000001		MOVEI T4,1(T4)		;Skip over 0
   386	000220'	542444	000213*		HRRM T4,DEVDIO(F)
   387	000221'	262040	000002		POP P,J
   388	000222'	262040	000003		POP P,PG
   389	000223'	262040	000011		POP P,T4
   390	000224'	262040	000007		POP P,T2
   391	000225'	262040	000006		POP P,T1
   392	000226'	263040	000000		POPJ	P,
   393
   394
   395				;Routine used by BDIO AND DDIO.
   396				;Enter with T1 the contents of the IOWD pointed at by T4.
   397				;Go through the vector of IOWDs, starting with the one at c(T4) and
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 8-2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   398				; decrease the I/O active count for each page, waking up jobs waiting
   399				; for the pages if it goes to 0.
   400				;Leaves T4 pointing to the next 0 word in the vector.
   401				;Destroys T1, T2, T4, PG, J.
   402	000227'	260040	000234'	BUFKRN:	PUSHJ	P,DPL		;Decrement lock count for this page.
   403	000230'	201451	000001		MOVEI T4,1(T4)
   404	000231'	332311	000000		SKIPE T1,(T4)
   405	000232'	254000	000227'		 JRST BUFKRN
   406	000233'	263040	000000		POPJ	P,
   407
   408				;Decrement lock count for page pointed to by IOWD in T1.
   409	000234'	340300	000000	DPL:	AOJ T1,			;-COUNT AND ADDRESS-1+1.
   410	000235'	135140	001506'		LDB PG,[POINT 13,T1,26] ;GET PHYSICAL PAGE NUMBER.
   411	000236'	135300	000000*		LDB T1,PGYDIO		;GET DIRECT I/O COUNT.
   412	000237'	375000	000006		SOSGE T1		;SHOULD BE NON-ZERO.
   413	000240'	256000	001507'		 STOPCD (.,JOB,MTAICZ,,<I/O count zero>)
   414	000241'	137300	000236*		DPB T1,PGYDIO
   415	000242'	336000	000006		SKIPN T1		;Still doing I/O on this page?
   416	000243'	324740	000000*		 PJRST PAGWAK		;No, wake up waiters, if any.
   417	000244'	263040	000000		POPJ	P,
   418
   419
   420
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 9
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   421				COMMENT %@@SUBROUTINE SYDTMX
   422				SYSDVF UUO.
   423				@@%
   424
   425	000245'	340540	000000	SYDTMX:	AOJ	M,		;POINT M TO THE UNIT NAME.
   426	000246'	256200	001512'		UMOVE	T1,(M)		;T1/ UNIT NAME.
   427	000247'	200340	000000*		MOVE	T2,TMX0CB+TKBIUN;Pointer to vector of UDB addresses
   428	000250'	326300	000253'		JUMPN	T1,FTDVF2	;J-Don't want the first unit
   429	000251'	201240	000000*		MOVEI	U,TU0CB		;First UDB.
   430	000252'	254000	000264'		JRST	FTDVF7
   431
   432	000253'	336247	000000	FTDVF2:	SKIPN	U,(T2)
   433	000254'	254000	000000*		 JRST	SYDNM4
   434	000255'	550245	000000*		HRRZ	U,TUBDDB(U)
   435	000256'	316305	000000		CAMN	T1,DEVNAM(U)	;Is this the name we're looking for?
   436	000257'	254000	000262'		 JRST	FTDVF5		;J-Yes.
   437	000260'	253340	000253'		AOBJN	T2,FTDVF2	;No, try another unit
   438	000261'	254000	000254*		JRST	SYDNM4		;None left.
   439	000262'	336247	000001	FTDVF5:	SKIPN	U,1(T2)		;We're supposed to get the first after that
   440	000263'	254000	000261*		 JRST	SYDNM4		;There isn't one.
   441	000264'	550305	000255*	FTDVF7:	HRRZ	T1,TUBDDB(U)	;Get the name of the unit
   442	000265'	200306	000000		MOVE	T1,DEVNAM(T1)
   443	000266'	256200	001513'		UMOVEM	T1,(M)		;Save its name.
   444	000267'	201300	000000*		MOVEI	T1,MTUDBL	;T1:=Length of UDB
   445	000270'	205340	240000		MOVSI	T2,LICSYS!LICSPY
   446	000271'	616342	000000*		TDNN	T2,JBTLIC(J)
   447	000272'	254000	000124*		 JRST	CPOPJ1
   448	000273'	363600	000272*		SOJLE	P1,CPOPJ1
   449	000274'	344540	000000*		AOJA	M,SYDCOM
   450
   451
   452
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 10
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   453				COMMENT %@@SUBROUTINE TMXUGF
   454				UGETF UUO.
   455
   456				If Rh(E)=0,	Return the byte count of the last user record filled to
   457						E+1.
   458					 1,	Return Min(6,Lh(E)) words of 0 starting at E.
   459					 2,	Return the following into E+1:
   460							Bit 0: Hardware write locked
   461							Bits 1&2: always 0
   462							Bit 3: Copy of DS.BOT
   463							Bit 4: Copy of DS.EOT
   464							Bit 5: Always 0 (IBM compatible)
   465							Bit 12: Always 0 (7 track)
   466							Bits 13-17: 14 (1600/800 cpi)
   467
   468				@@ENTRY M=E, F=DDB.
   469				@@ACCUM SAVES F AND M.  OTHER ACS MAY BE DESTROYED.
   470				@@CALLS WAIT1, SGTDEV, FHGSTP.
   471				@@ERRORS Any of the following cause E+1 to be set to -1:
   472				1. E does not have one of the forms described under purpose.
   473				2. Rh(E)=0 and the mode is neitherl D nor DR.
   474				3. Rh(E)=1 and LH(E)<1.
   475				@@CALLED UUO. @@%
   476
   477	000275'	256200	001514'	TMXUGF:	UHRRZ T3,(M)		;Function type
   478	000276'	307400	000002		CAIG T3,2		;Legal?
   479	000277'	254000	000302'		 JRST FFUGF2		;Yes.
   480	000300'	256200	001515'	FFUERR:	XCTTU <SETOM 1(M)>	;Flag error by setting E+1:=-1;
   481	000301'	263040	000000		POPJ	P,
   482
   483	000302'	260040	000075*	FFUGF2:	PUSHJ	P,WAIT1		;Wait for device to stop
   484	000303'	550244	000112*	FFUGF3:	HRRZ U,DEVUDB(F)	;UDB
   485	000304'	554305	000117*		HLRZ T1,UNITYP(U)	;Set unit characteristics
   486	000305'	254030	001516'		JRST @[EXP UGET0,UGET1,UGET2](T3)	;Process function
   487
   488				    ;Function 0.
   489	000306'	135300	000175*	UGET0:	LDB T1,PIOMOD		;Mode D or DR?
   490	000307'	305300	000016		CAIGE T1,DR
   491	000310'	254000	000300'		 JRST FFUERR		;No.
   492	000311'	200304	000000*		MOVE T1,DEVDWC(F)	;Yes, give user the byte count
   493	000312'	256200	001521'	FFUSTO:	UMOVEM T1,1(M)
   494	000313'	263040	000000		POPJ	P,
   495
   496				    ;Function 1.
   497	000314'	403300	000007	UGET1:	SETZB T1,T2		;Since this function makes no sense, return 0.
   498	000315'	256200	001522'		XCTTU <DMOVEM T1,1(M)>
   499	000316'	256200	001522'		XCTTU <DMOVEM T1,1(M)>
   500	000317'	256200	001522'		XCTTU <DMOVEM T1,1(M)>
   501	000320'	263040	000000		POPJ	P,
   502
   503				    ;Function 2
   504	000321'	326300	000327'	UGET2:	JUMPN T1,FFUS2		;Is the unit available?
   505	000322'	260040	000572'	FFUS1:	PUSHJ	P,SGTDEV		;No, try to get it.
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 10-2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   506	000323'	254000	000327'		 JRST FFUS2		;Got it.
   507	000324'	260040	001334'		PUSHJ	P,FHGSTP		;Tell the user it's hung.
   508	000325'	200004	000002		MOVE S,DEVIOS(F)
   509	000326'	254000	000322'		JRST FFUS1		;Loop until the problem has been fixed.
   510
   511	000327'	260040	000552'	FFUS2:	PUSHJ	P,GETCTL		;Get back controller.
   512	000330'	260040	001331'		PUSHJ	P,GETST		;GET STATUS OF UNIT WHOSE UDB IS IN U
   513	000331'	515340	000014		HRLZI	T2,14		;1600/800 cpi density
   514	000332'	603300	000010		TLNE	T1,(WP)		;WRITE PROTECTED?
   515	000333'	661340	400000		 TLO	T2,WRPROT	;YES
   516	000334'	603300	000004		TLNE	T1,(LODPNT)	;AT LOAD POINT?
   517	000335'	661340	040000		 TLO	T2,LOADPT
   518	000336'	603300	000001		TLNE	T1,(EOT)	;AT END OF TAPE?
   519	000337'	661340	020000		 TLO	T2,TAPEIN	;(MUST BE EXACTLY THERE FOR THIS BIT TO BE ON)
   520	000340'	256200	001523'		UMOVEM	T2,1(M)		;Give the status to the user
   521	000341'	324740	000563'		PJRST	RELCTL		;Give up controller
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 11
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   522				COMMENT %@@SUBROUTINE FTAPE
   523				MTAPE uuo.
   524
   525				0 Wait	10 Go to LEOT  100 Core dump mode
   526				1 REW	11 REW/UNL     101 4 8-bit bytes per word mode
   527				3 WTM	13 ERG
   528				6 SKR	16 SKF
   529				7 BSR	17 BSF
   530				@@ENTRY M=E, F=DDB, S=DEVIOS.
   531				An additional entry point is FT1CM2.
   532				@@ACCUM Saves F. Others may be destroyed. Sets U=UDB and S=DEVIOS.
   533				@@CALLS WAIT1, CPOPJ, SAVAIL, UNISE0, SUBRGO, AND ITS INTERNAL
   534				ROUTINE FT1CM2.
   535				@@CALLED UUO. @@%
   536
   537				    ;Dispatch table for functions. Odd in Lh.
   538	000342'	000413'	000370'	FTPTBL:	FT1CMD,,MTPERR
   539	000343'	000413'	000370'		FT1CMD,,MTPERR
   540	000344'	000370'	000370'		MTPERR,,MTPERR
   541	000345'	000413'	000413'		FT1CMD,,FT1CMD
   542	000346'	000413'	000464'		FT1CMD,,FTLEOT
   543	000347'	000413'	000370'		FT1CMD,,MTPERR
   544	000350'	000370'	000370'		MTPERR,,MTPERR
   545	000351'	000413'	000413'		FT1CMD,,FT1CMD
   546
   547	000352'	260040	000302*	FTAPE:	PUSHJ	P,WAIT1		;Wait until device finished.
   548	000353'	551553	000000		HRRZI M,(M)		;Nothing to do if funtion 0.
   549	000354'	322540	000000*		JUMPE M,CPOPJ
   550
   551	000355'	260040	000612'	FTP2:	PUSHJ	P,SAVAIL		;Make sure unit is available
   552	000356'	554305	000304*		HLRZ T1,UNITYP(U)	;Unit characteristics
   553	000357'	301540	000100		CAIL M,100		;9 track function ?
   554	000360'	254000	000372'		 JRST FT9TRK		; yes
   555	000361'	602540	777760		TRNE M,777760		;<100, so must be in [0,17]
   556	000362'	254000	000370'		 JRST MTPERR		;No.
   557	000363'	241540	777777	FTP6:	ROT M,-1		;Go to function dependent code.
   558	000364'	331000	000013		SKIPL M
   559	000365'	334313	000342'		 SKIPA T1,FTPTBL(M)
   560	000366'	554313	000342'		  HLRZ T1,FTPTBL(M)
   561	000367'	254006	000000		JRST (T1)
   562
   563				    ;Here if the function is illegal.
   564	000370'	660000	400000	MTPERR:	TRO S,IOIMPM		;Mark illegal.
   565	000371'	254000	000377'		JRST FTOUT		;Store S in DEVIOS and return
   566
   567				    ;Set status flags for 9 track operation. (F=76,77,100).
   568	000372'	303540	000101	FT9TRK:	CAILE M,101		;Legal function
   569	000373'	254000	000370'		JRST MTPERR		;no
   570	000374'	135300	001524'		LDB T1,[POINT 2,M,35]	;Yes.  Set up mode information.
   571	000375'	542304	000047*		HRRM T1,DEVMD1(F)
   572	000376'	513004	000155*		HLLZS DEVFNJ(F)		;No byte adjustment.
   573	000377'	202004	000002	FTOUT:	MOVEM S,DEVIOS(F)	;Save S.
   574	000400'	263040	000000		POPJ	P,
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 11-2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   575
   576	000001			FT1TBL:	PHASE 1
   577	000401'	000000	000354*	I.REWI:!F.REWI,,CPOPJ		;1
   578	000402'	000002	000401*	I.WTM:!	F.WTM,,CPOPJ		;2
   579	000403'	000004	000402*	I.SKR:!	F.SKR,,CPOPJ		;3 Need to set up FC for these two.
   580	000404'	000005	000403*	I.BSR:!	F.BSR,,CPOPJ		;4
   581	000405'	000001	000404*	I.RO:!	F.RO,,CPOPJ		;5
   582	000406'	000003	000405*	I.EG:!	F.EG,,CPOPJ		;6
   583	000407'	000004	000435'	I.SF:!	F.SKR,,FTSKB2		;7 These two implemented as SKR/BSR
   584	000410'	000005	000435'	I.BF:!	F.BSR,,FTSKB2		;10 until error (tape mark hit).
   585	000011			FTC:!
   586	000411'	000010	000000	I.RF:!	F.RF,,			;11
   587	000412'	000011	000000	I.WF:!	F.WF,,			;12
   588	000413'				DEPHASE
   589
   590				    ;Simple functions: REW,WTM,SKR,BSR,REW&UNL,ERG,SKF,BSF ->
   591				    ;(1,3,6,7,11,13,16,17)
   592	000413'	337000	000013	FT1CMD:	SKIPG M
   593	000414'	340540	000000		 AOJ M,			;(S+0,S+1,3,S+3,S+4,S+5,7,S+7) ->
   594								; (1,2,3,4,5,6,7,10)
   595	000415'	260040	000552'		PUSHJ	P,GETCTL		;Grab the controller
   596	000416'	261040	000013		PUSH P,M		;In case completes before return
   597	000417'	260040	000426'		PUSHJ	P,FT1CM2		;Issue drive command.
   598	000420'	262040	000013		POP P,M
   599	000421'	553000	000013		HRRZS M
   600	000422'	302540	000001		CAIE M,I.REWI		;Rewind or rewind offline.
   601	000423'	306540	000005		 CAIN M,I.RO
   602	000424'	260040	000563'		  PUSHJ	P,RELCTL		;Y.  Don't need controller anymore.
   603	000425'	263040	000000		POPJ	P,
   604	000426'	402004	000000*	FT1CM2:	SETZM	DEVCNT(F)	;Interrupt level repeat count gets cleared.
   605
   606				;ENTER HERE IF DEVCNT IS SETUP FOR ITERATIONS
   607
   608	000427'	506544	000376*	FT1CM3:	HRLM M,DEVFNJ(F)	;Remember what this unit's doing.
   609	000430'	550244	000303*		HRRZ	U,DEVUDB(F)
   610	000431'	550105	000132*		HRRZ	J,TUBKDB(U)	;SETUP U AND J
   611	000432'	200313	000400'		MOVE T1,FT1TBL-1(M)
   612	000433'	260046	000000		PUSHJ	P,(T1)		;Perform any special setup needed for this fcn
   613	000434'	324740	001273'		PJRST SUBRGO		;Start device.
   614				;Here to skip over a file forwards or backwards.  This is
   615				; implemented as a number of skip record operations.
   616				; Rescheduling is allowed so that a job skipping a single
   617				; large file can't tie up the tape controller indefinately.
   618	000435'	274040	001525'	FTSKB2:	SUB P,[1,,1]		;flush return to FT1CM2.
   619	000436'	201340	000012	FTSKBL:	MOVEI	T2,^D10		;SKIP 10 RECORDS AT A TIME
   620	000437'	202344	000426*		MOVEM	T2,DEVCNT(F)	;IRP LEVEL DECREMENTS THIS.
   621	000440'	550244	000430*		HRRZ U,DEVUDB(F)
   622	000441'	202004	000002		MOVEM S,DEVIOS(F)
   623	000442'	260040	001273'		PUSHJ	P,SUBRGO		;Start device.
   624	000443'	260040	000352*		PUSHJ	P,WAIT1		;Wait until finished
   625	000444'	200004	000002		MOVE S,DEVIOS(F)
   626	000445'	603000	010000		TLNE S,SFDONE		;I level say tape mark or eot?
   627	000446'	263040	000000		 POPJ	P,			;Yes, so finished.
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 11-3
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   628	000447'	260040	000612'	FTSKB4:	PUSHJ	P,SAVAIL	;MAKE SURE ITS STILL ONLINE
   629	000450'	135300	000150*		LDB	T1,PJOBN	;SEE IF HES TRYING TO STOP IT
   630	000451'	200306	000000*		MOVE	T1,JBTSTS##(T1)
   631	000452'	607300	000400		TLNN	T1,CNTRLC
   632	000453'	254000	000461'		JRST	FTSKB3
   633	000454'	200100	000000*		MOVE	J,JOB##	;SETUP J FOR STOP1
   634	000455'	260040	000000*		PUSHJ	P,STOP1##
   635	000456'	260040	000000*		PUSHJ	P,WSCHED##
   636	000457'	550105	000431*		HRRZ	J,TUBKDB(U)	;GET J BACK TO KON DATA BLOCK
   637	000460'	254000	000447'		JRST	FTSKB4		;GO CHECK AGAIN
   638	000461'	260040	000552'	FTSKB3:	PUSHJ	P,GETCTL		;No, get controller.
   639	000462'	506544	000427*		HRLM M,DEVFNJ(F)
   640	000463'	254000	000436'		JRST FTSKBL		; ... and try another bunch of skrs.
   641				;LEOT (10).
   642				;
   643				;    1. BSR over possible tape mark.
   644				;    2. SKF.  If it's EOT, we're done.  Otherwise, we've seen 1 tape mark.
   645				;    3. SKR.  If it's EOT, we're done.  If it's an EOF, we're done also and
   646				;	have seen 2 tape marks in a row.  Otherwise, go to 2.
   647				;    4. BSR over the last of the two consequative tape marks we saw.
   648
   649	000464'	260040	000552'	FTLEOT:	PUSHJ	P,GETCTL		;Grab controller.
   650	000465'	201540	000004		MOVEI M,I.BSR		;1. BSR
   651	000466'	260040	000426'		PUSHJ	P,FT1CM2
   652	000467'	260040	000443*		PUSHJ	P,WAIT1
   653	000470'	260040	000552'	FTLEO1:	PUSHJ	P,GETCTL		;Get controller.
   654	000471'	201540	000007		MOVEI M,I.SF		;2. SKF	
   655	000472'	260040	000426'		PUSHJ	P,FT1CM2
   656	000473'	260040	000467*		PUSHJ	P,WAIT1
   657	000474'	603000	001000		TLNE S,IOLEND		;EOT?
   658	000475'	263040	000000		 POPJ	P,			;Yes
   659	000476'	260040	000552'		PUSHJ	P,GETCTL		;get controller
   660	000477'	201540	000003		MOVEI M,I.SKR		;3. SKR
   661	000500'	260040	000426'		PUSHJ	P,FT1CM2
   662	000501'	260040	000473*		PUSHJ	P,WAIT1
   663	000502'	616000	001526'		TDNN S,[XWD IOLEND,IODEND]	;EOT/EOF?
   664	000503'	254000	000470'		 JRST FTLEO1		;No,loop.
   665	000504'	606000	020000		TRNN S,IODEND		;EOF?
   666	000505'	263040	000000		 POPJ	P,			;No, so it's EOT.
   667	000506'	260040	000552'		PUSHJ	P,GETCTL		;Get controller.
   668	000507'	201540	000004		MOVEI M,I.BSR		;4. BSR to leave tape after 1st of 2 tape marks
   669	000510'	254000	000426'		JRST FT1CM2		; at its end.
   670
   671
   672
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 12
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   673				COMMENT %@@SUBROUTINE TMXRED/WRT
   674				Read and write the tape.
   675				In buffered mode if a transfer of 0 words is specified, the routine returns.
   676				Otherwise it starts the device and returns.
   677				@@ENTRY S=DEVIOS, F=DDB.
   678				@@ACCUM SAVES F AND M.  OTHERS MAY BE DESTROYED.  Sets U=UDB, S=DEVIOS.
   679				@@CALLS SAVAIL, WAIT1, SRFX, AND SDCIO2.
   680				@@ERRORS CERTAIN BAD DDB LISTS (SEE SRFX.).
   681				@@CALLED UUO. @@%
   682
   683	000511'	625000	000020	TMXRED:	TLZA S,IO		;Remember if read or write.
   684	000512'	661000	000020	TMXWRT:	 TLO S,IO
   685	000513'	260040	000612'		PUSHJ	P,SAVAIL	;Check the unit is available.
   686	000514'	550304	000011		HRRZ	T1,DEVCLS(F)	;Start from the beginning of the list
   687	000515'	542304	000220*		HRRM	T1,DEVDIO(F)	; for busy page calculations.
   688	000516'	554305	000356*		HLRZ	T1,UNITYP(U)	;Unit characteristics.
   689	000517'	260040	000501*		PUSHJ	P,WAIT1		;Wait until device stops.
   690	000520'	260040	000552'		PUSHJ	P,GETCTL	;Get controller.
   691	000521'	135300	000306*		LDB	T1,PIOMOD	;Mode.
   692	000522'	301300	000016		CAIL	T1,DR		;D or DR?
   693	000523'	627000	000002		 TLZN	S,IOBEG		;Y; new IOWD?
   694	000524'	334000	000000		  SKIPA			;NvN
   695	000525'	402004	000311*		SETZM	DEVDWC(F)	;Y&Y; remember nothing transferred yet.
   696	000526'	402004	000437*		SETZM	DEVCNT(F)	;Not continuing IOWD processing.
   697	000527'	550244	000440*		HRRZ	U,DEVUDB(F)
   698	000530'	402005	000131*		SETZM	TUBER1(U)	;Not yet in error recovery.
   699				;The 2020 gets "problem on device" if you attempt to output to a tape
   700				;that is missing the write ring.  The F3 used to ignore the error.
   701	000531'	201300	000011		MOVEI	T1,I.RF		;Remember what we're doing.
   702	000532'	603000	000020		TLNE	S,IO
   703					 JRST	[PUSHJ	P,GETST	  ;Get status
   704						 TLNE	T1,(WP)	  ;Write protected?
   705						  JRST	WPERR	  ;Yes, abort UUO
   706						 MOVEI	T1,I.WF	  ;Write function
   707	000533'	254000	001527'			 JRST	.+1]
   708	000534'	506304	000462*		HRLM	T1,DEVFNJ(F)
   709	000535'	135340	000450*		LDB	T2,PJOBN	;Prevent user from being swapped.
   710	000536'	350007	000151*		AOS	JBTIOA(T2)
   711	000537'	260040	001357'		PUSHJ	P,SRFX		;Set up registers for transfer.
   712	000540'	254000	000545'		  JRST	TMXRW1		;Start operation.
   713	000541'	350004	000013		AOS	DEVABC(F)	;B mode, empty buffer.
   714	000542'	260040	001102'		PUSHJ	P,FREBUF
   715	000543'	260040	000563'		PUSHJ	P,RELCTL	;Release MT lock
   716	000544'	324740	000150'		PJRST	SDCIO2
   717	000545'	260040	001274'	TMXRW1:	PUSHJ	P,SUBRG1	;Start operation.
   718	000546'	263040	000000		POPJ	P,
   719
   720	000547'	661000	400000	WPERR:	TLO	S,IOIMPM	;Improper mode - tape is write protected
   721	000550'	202004	000002		MOVEM	S,DEVIOS(F)
   722	000551'	324740	000563'		PJRST	RELCTL
   723
   724				;GETCTL, RELCTL.  Handle interlocking for tape controller.
   725				;Enter with DDB adr in F.  Leave GETCTL with controller
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 12-2
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   726				; locked, HASCTL set, JBTABT set to RELCTL.
   727				; Leave RELCTL with controller unlocked.  Usually called
   728				; at interrupt level after completion of the operation.
   729	000552'	352000	000000*	GETCTL:	AOSE MTREQ
   730	000553'	260040	000000*		 PUSHJ	P,MTWAIT
   731	000554'	261040	000002		PUSH P,J
   732	000555'	135100	000535*		LDB J,PJOBN		;Get user's job #
   733	000556'	201300	000563'		MOVEI T1,RELCTL
   734	000557'	552302	000000*		HRRZM T1,JBTABT(J)	;Set abort location.
   735	000560'	262040	000002		POP P,J
   736	000561'	661000	020000		TLO S,HASCTL	;Remember we have conroller.
   737	000562'	263040	000000		POPJ	P,
   738
   739	000563'	371000	000552*	RELCTL:	SOSL MTREQ
   740	000564'	476000	000000*		 SETOM MTAVAL
   741	000565'	261040	000002		PUSH P,J
   742	000566'	135100	000555*		LDB J,PJOBN		;Get user's job #
   743	000567'	402002	000557*		SETZM JBTABT(J)		;Clear abort location.
   744	000570'	262040	000002		POP P,J
   745	000571'	263040	000000		POPJ	P,
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 13
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   746				COMMENT %@@SUBROUTINE SGTDEV
   747				See if a tape is now available although it wasn't when the system
   748				came up.  Sets Lh(UNITYP) as appropriate if the device is
   749				available.  Skips if the unit remains unavailable.
   750				@@ENTRY U=UDB, F=DDB.
   751				@@CALLS SUBRSN, SUBRG2, WAIT1, SFISKN, AND SFISUN.
   752				@@CALLED UUO. @@%
   753
   754	000572'	261040	000010	SGTDEV: PUSH P,T3
   755	000573'	261040	000015		PUSH P,P2
   756	000574'	261040	000007		PUSH	P,T2		;GETST SMASHES T2
   757	000575'	260040	000552'		PUSHJ	P,GETCTL		;Get controller.
   758	000576'	260040	001331'		PUSHJ	P,GETST		;GET TAPE STATUS IN T1
   759	000577'	607300	000040		TLNN	T1,(ONLINE)
   760	000600'	254000	000610'		 JRST SGTDE1		;J-No
   761	000601'	201400	000014		MOVEI T3,DS800+DS1600	;Yes, set up unit information
   762	000602'	516405	000516*		HRLZM T3,UNITYP(U)	;Clear hung counter.
   763	000603'	260040	000563'	SGTDE0:	PUSHJ	P,RELCTL		;Release controller.
   764	000604'	262040	000007		POP	P,T2
   765	000605'	262040	000015		POP P,P2
   766	000606'	262040	000010		POP P,T3
   767	000607'	263040	000000		POPJ	P,
   768	000610'	350001	777775	SGTDE1:	AOS -3(P)		;Skip return-unit still unavailable
   769	000611'	254000	000603'		JRST SGTDE0
   770
   771
   772
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 14
F3TSER.MAC	25-NOV-87 15:34		This hack written by Daniel S. Blom

   773				COMMENT %@@SUBROUTINE SAVAIL
   774				Unit now online?
   775					No: Tell user via FHGSTP, loop until it is.
   776					Yes: Check HNGTAP in DEVIOS.
   777						Not set: Return.
   778						Set: Check status to see if intervention still
   779						   required.  If so, tell the user via HNGSTP,
   780						   and continue checking HNGTAP.  If not, return.
   781				@@ENTRY F=DDB.
   782				@@DESTROYS S, T4. (U is set to UDB and S to DEVIOS).
   783				@@CALLS SGTDEV, FHGSTP, SUBRSN, AND WAIT1.
   784				@@CALLED UUO.@@%
   785
   786	000612'	261040	000006	SAVAIL:	PUSH P,T1
   787	000613'	550244	000527*		HRRZ U,DEVUDB(F)	;U=UDB
   788
   789				    ;Check that the unit is online.
   790	000614'	260040	000572'	SAVAL2:	PUSHJ	P,SGTDEV		;See if it is there now.
   791	000615'	254000	000620'		 JRST SAVAL4
   792	000616'	260040	001334'		PUSHJ	P,FHGSTP		;Nope.  Tell the user and try again.
   793	000617'	254000	000614'		JRST SAVAL2
   794
   795				    ;Here when the unit is online.
   796	000620'	200004	000002	SAVAL4:	MOVE S,DEVIOS(F)	;Is HNGTAP set?
   797	000621'	607000	040000		TLNN S,HNGTAP
   798	000622'	254000	000625'		 JRST SAVAL8		;No.
   799	000623'	260040	001334'		PUSHJ	P,FHGSTP		;Yes, tell user.
   800	000624'	254000	000620'		JRST SAVAL4
   801	000625'	262040	000006	SAVAL8:	POP P,T1
   802	000626'	263040	000000		POPJ	P,
   803
   804	000627'	261040	000010	TMXGRD: PUSH P,T3
   805	000630'	261040	000011		PUSH P,T4
   806	000631'	260040	000612'		PUSHJ	P,SAVAIL
   807	000632'	262040	000011		POP P,T4
   808	000633'	262040	000010		POP P,T3
   809	000634'	263040	000000		POPJ	P,
   810
   811
   812
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

   813				SUBTTL INTERRUPT PROCESSING
   814
   815				;U=UDB, F=DDB, J=KDB, S=DEVIOS.
   816
   817				;The code assumes that tape operations may not be overlapped.  All
   818				; routines which perform tape operations must wait until the previous
   819				; one, if any, has finished; one way to do this is to call WAIT1.
   820
   821	000635'			MAGINT:
   822	000635'	334000	000000	IFN OLDCTL,<SKIPA>
   823				IFE OLDCTL,<	MTSO	INTREQ>		;ANY INTERRUPT FOR TAPE?
   824	000636'	254000	000636'		JRST	.
   825				IFN OLDCTL,<
   826	000637'	735000	000010		TPCNSO	10
   827	000640'	332000	000165'		SKIPE	REWFLG
   828	000641'	254000	000643'		JRST	.+2
   829	000642'	254000	000636'		JRST	MAGINT+1	;NOT FOR US
   830	000643'	402000	000165'		SETZM	REWFLG		;IN CASE IT WAS SET
   831	000644'	735000	000010		TPCNSO	10		;SEE IF INTERRUPT FLAG IS SET
   832	000645'	254000	000647'		JRST	.+2		;NO, JUST REWIND FLAG.
   833	000646'	734000	000020*		TPCONO 20+MAGCHN>	;CLEAR THE INTERRUPT FLAG.
   834
   835	000647'	264000	000000*		JSR	MAGSAV		;SAVE ACS
   836	000650'	201100	000000*		MOVEI J,TMX0CB		;KDB.  Here we set up the record pointers.
   837	000651'	260040	000654'		PUSHJ	P,CHKCUN		;Check current unit.
   838	000652'	260040	000672'		PUSHJ	P,CHKSSC		;Check for rewind complete.
   839	000653'	263040	000000		POPJ	P,		;RETURN FROM INTERRUPT
   840
   841				;Interrupt by unit controller is currently talking to.
   842				; WHEN DEBUGGING MULTI DRIVES WATCH OUT FOR INTERPLAY BETWEEN REWINDS AND XFERS.
   843				; TRIED TO FIX THIS BY CHECKING READY, BUT MAY NEED MORE CHECKING.
   844	000654'	336242	000134*	CHKCUN:	SKIPN U,TKBCUN(J)	;Waiting for this unit?
   845	000655'	263040	000000		 POPJ	P,
   846	000656'	200205	000264*		MOVE F,TUBDDB(U)	;Get DDB associated with this unit.
   847	000657'	200004	000002		MOVE S,DEVIOS(F)	;Get device status.
   848	000660'	260040	001331'		PUSHJ	P,GETST		;GET STATUS OF THIS UNIT IN T1
   849	000661'	200400	000006		MOVE	T3,T1		;GET STATUS INTO T3 FOR ROUTINES BELOW
   850	000662'	607400	000002		TLNN	T3,(READY)	;IS UNIT READY?
   851	000663'	263040	000000		 POPJ	P,		;NO, HASN'T INTERRUPTED YET.
   852	000664'	402002	000654*		SETZM	TKBCUN(J)	;YES, NO LONGER WAITING FOR THIS UNIT.
   853	000665'	554544	000534*		HLRZ M,DEVFNJ(F)	;Most recent function issued.
   854	000666'	332305	000530*		SKIPE T1,TUBER1(U)	;Doing error recovery?
   855	000667'	254006	000000		 JRST (T1)		;Co-routine call.
   856	000670'	326573	000751'		JUMPN M,@ODD-1(M)	;Function done interrupt service.
   857	000671'	263040	000000		POPJ	P,
   858
   859				;Check for rewind start/finish or drives offline.
   860	000672'	200302	000031*	CHKSSC:	MOVE T1,TKBIUN(J)	;Pointer to vector of UDB adrs.
   861	000673'	261040	000006	CHKRW4:	PUSH P,T1
   862	000674'	550246	000000		HRRZ U,(T1)		;U:=UDB
   863	000675'	316242	000664*		CAMN U,TKBCUN(J)	;Handled specially.
   864	000676'	254000	000722'		 JRST CHKRW3
   865	000677'	550205	000656*		HRRZ F,TUBDDB(U)	;F:=DDB
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15-2
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

   866	000700'	200004	000002		MOVE S,DEVIOS(F)	;S:=DDB.DEVIOS
   867	000701'	260040	001331'		PUSHJ	P,GETST		;READ STATUS OF THIS UNIT
   868	000702'	200400	000006		MOVE	T3,T1		;T1 IS USED LATER
   869	000703'	260040	000725'		PUSHJ	P,CHKOFL		;Process MOL state changes.
   870	000704'	550345	000000*		HRRZ T2,TUBS(U)		;Expecting rewind done int?
   871	000705'	322340	000722'		JUMPE T2,CHKRW3
   872	000706'	554445	000704*		HLRZ T4,TUBS(U)
   873	000707'	607400	000002		TLNN	T3,(READY)	;UNIT CAN'T BE DONE IF READY NOT SET
   874	000710'	326440	000722'		 JUMPN T4,CHKRW3
   875	000711'	513005	000706*		HLLZS TUBS(U)
   876	000712'	607400	000004		TLNN	T3,(LODPNT)	;IF NOT AT LOAD POINT, SOMETHING WENT WRONG.
   877	000713'	254000	000721'		  JRST CHKRW1		;WAKE USER.
   878	000714'	660000	004000		TRO S,IOBOT
   879	000715'	630000	001534'		TDZ S,[XWD IOLEND,IOTEND]	;Update our idea of the status.
   880	000716'	554544	000665*		HLRZ M,DEVFNJ(F)	;Load function identifier
   881	000717'	260040	000735'		PUSHJ	P,MTDONE	;OK, WAKE UP USER AND RELEASE CONTROL
   882	000720'	254000	000722'		JRST CHKRW3
   883	000721'	260040	001012'	CHKRW1:	PUSHJ	P,INTERR
   884	000722'	262040	000006	CHKRW3:	POP P,T1
   885	000723'	253300	000673'		AOBJN T1,CHKRW4
   886	000724'	263040	000000		POPJ	P,
   887				;Here to check for unit changing MOL state.
   888	000725'	554345	000711*	CHKOFL:	HLRZ T2,TUBS(U)
   889	000726'	322340	000732'		JUMPE T2,CHKOF1		;JUMP IF THOUGHT IT WAS OFFLINE
   890	000727'	607400	000040		TLNN	T3,(ONLINE)	;SKIP IF UNIT NOT ON LINE
   891	000730'	553005	000725*		HRRZS TUBS(U)
   892	000731'	263040	000000		POPJ	P,
   893	000732'	603400	000040	CHKOF1:	TLNE	T3,(ONLINE)	;SKIP IF UNIT IS ONLINE
   894	000733'	563005	000730*		HRROS TUBS(U)
   895	000734'	263040	000000		POPJ	P,
   896	
   897
   898				    ;Here when an operation is complete.
   899	000735'	603000	000001	MTDONE:	TLNE S,IOW
   900	000736'	260040	000000*		 PUSHJ	P,SETIOD		;Wake up waiter since device has finished.
   901	000737'	554544	000716*		HLRZ M,DEVFNJ(F)
   902	000740'	302540	000001		CAIE M,I.REWI
   903	000741'	306540	000005		 CAIN M,I.RO
   904	000742'	254000	000745'		  JRST MTDON1
   905	000743'	623000	020000		TLZE S,HASCTL		;Have controller?
   906	000744'	260040	000563'		 PUSHJ	P,RELCTL		;Y, no longer need it.
   907	000745'	620000	010000	MTDON1:	TRZ S,IOACT
   908	000746'	202004	000002		MOVEM S,DEVIOS(F)
   909	000747'	324740	000145'		PJRST	SDCIOA		;Unlock pages if xfr, say no current operation.
   910
   911	000750'	260040	001332'	FXDSM1:	PUSHJ	P,FSTHNG		;Reset hung timeout vars & mark unit as idle.
   912	000751'	263040	000000		POPJ	P,
   913
   914				;This table maps between the operation code stored in Lh(DEVFNJ) and the
   915				; I-level routine to be called when an interrupt is received after the
   916				; operation has been initiated.
   917	000001			ODD:	PHASE 1
   918	000752'	000000	001652'	I.REWI:!MTAIFC			;1 Rewind (handled specially)
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15-3
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

   919	000753'	000000	001001'	I.WTM:!	OD.WTM			;2 Write Tape Mark
   920	000754'	000000	000775'	I.SKR:!	OD.SKR			;3 Skip Record
   921	000755'	000000	000775'	I.BSR:!	OD.BSR			;4 Backspace Record
   922	000756'	000000	000764'	I.RO:!	OD.RO			;5 Rewind Offline
   923	000757'	000000	001001'	I.EG:!	OD.EG			;6 Erase gap
   924	000760'	000000	000770'	I.SF:!	OD.SF			;7 Skip file
   925	000761'	000000	000767'	I.BF:!	OD.BF			;10 Backspace file
   926	000762'	000000	001015'	I.RF:!	OD.RF			;11 Read forward
   927	000763'	000000	001030'	I.WF:!	OD.WF			;12 Write forward
   928	000764'				DEPHASE
   929
   930	000764'	603400	140000	OD.RO:	TLNE	T3,(PARERR!LENERR) ;ANY ERRORS?
   931	000765'	254000	001012'		JRST	INTERR		;YES, LET USER KNOW SOMETHING WENT WRONG
   932	000766'	254000	000735'		JRST	MTDONE		;NO, WAKE USER AND RETURN.
   933	000767'	607400	000004	OD.BF:	TLNN	T3,(LODPNT)	;FINISHED IF GET TO LOAD POINT
   934	000770'	603400	140000	OD.SF:	TLNE	T3,(PARERR!LENERR) ;ERRORS?
   935	000771'	665000	010000		  TLOA S,SFDONE		;Yes, flag finished.
   936	000772'	621000	010000		   TLZ S,SFDONE		;No, flag need to do some more.
   937	000773'	603400	200001		TLNE	T3,(EOT!EOF)	;PHYSICAL OR LOGICAL END OF TAPE ENCOUNTERED?
   938	000774'	661000	010000		 TLO S,SFDONE
   939	000775'			OD.SKR: OD.BSR:
   940	000775'	630000	001534'		TDZ	S,[IOLEND,,IOTEND]	;ALWAYS CLEAR EOT ON THESE READ TYPE OPS
   941
   942	000776'	603400	200000		TLNE	T3,(EOF)	;ON READ FUNCTIONS, THIS MEANS EOF.
   943	000777'	670000	001535'		 TDO S,[IOEND,,IODEND]
   944	001000'	254000	001004'		JRST	MTICE0
   945	001001'			OD.EG:OD.WTM:
   946	001001'	603400	200000		TLNE	T3,(EOF)	;ON WRITE FUNCTIONS, EOF MEANS REACHED EOT.
   947	001002'	674000	001534'		 TDOA S,[IOLEND,,IOTEND]
   948	001003'	630000	001534'		  TDZ S,[IOLEND,,IOTEND]
   949	001004'	603400	000004	MTICE0:	TLNE	T3,(LODPNT)
   950	001005'	660000	004000		 TRO S,IOBOT
   951	001006'	607000	011000		TLNN	S,IOLEND!SFDONE	;DON'T DO ANY MORE IF ERRORS.
   952	001007'	377004	000526*		SOSG	DEVCNT(F)	;GO TO MTDONE IF NO MORE OF THESE TO DO.
   953	001010'	254000	000735'		JRST	MTDONE
   954	001011'	254000	001274'		JRST	SUBRG1		;GO START UP SAME OPERATION AGAIN.
   955
   956	001012'	660000	200000	INTERR:	TRO S,IODERR		;Yes, flag error for higher level routines.
   957	001013'	260040	001236'		PUSHJ	P,RECDER		;Record device error for CHKPNT.
   958	001014'	254000	000735'		JRST MTDONE
   959
   960				IFL <%MTE-%MTA>-^D33*1000,<%MTA=%MTE-^D33*1000	;32+1 (plus 1 because user's
   961							   %MTA.N=%MTA_W2PLSH	; buffer is not on page boundry)
   962					PRINTX %MTA moved down to make room for 32 page buffer>
   963
   964	001015'	603400	200000	OD.RF:	TLNE	T3,(EOF)	;EOF THIS TIME?
   965	001016'	254000	001030'		JRST	RWDON3		;YES, DON'T MESS UP USER'S BUFFER.
   966	001017'	261040	000007		PUSH	P,T2
   967	001020'	200365	000000*		MOVE	T2,@TUBICW(U)	;GET FIRST COMMAND
   968	001021'	405340	000777		ANDI	T2,777		;GET ADDRESS WITHIN PAGE
   969	001022'	660340	732000		TRO	T2,%MTA		;GET ADDRESS TO BLT TO
   970	001023'	505340	001701'		HRLI	T2,MAGBUF	;WHERE TO BLT FROM
   971	001024'	200305	000000*		MOVE	T1,TUBIWC(U)	;GET COUNT
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15-4
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

   972	001025'	271307	777777		ADDI	T1,-1(T2)	;LAST ADDRESS TO BLT TO IN T1
   973	001026'	251346	000000		BLT	T2,(T1)		;TRANSFER DATA TO USER SPACE.
   974	001027'	262040	000007		POP	P,T2		;RESTORE T2.
   975
   976	001030'			OD.WF:
   977	001030'	607400	170000	RWDON3:	TLNN	T3,(ERRMSK)	;ERRORS?
   978	001031'	254000	001041'		JRST RWDON1		;NO
   979				    ;Here when reading/writing complete, device errors.
   980				    ;IOBKTL should be set if the user request is less than the record size.
   981
   982	001032'	607400	040000		TLNN	T3,(LENERR)	;IS LENGTH ERROR ON?
   983	001033'	254000	001127'		JRST	RWERR		;NO, SOME OTHER ERROR, ALL OTHERS ARE REAL
   984	001034'	603400	120000		TLNE	T3,(ERRMSK-LENERR-OVRRUN)
   985	001035'	254000	001127'		JRST	RWERR		;IF LENGTH ERROR ON, SO IS OVERRUN. ANYTHING
   986								; ELSE IS A REAL ERROR.
   987	001036'	135300	001536'		LDB	T1,[POINT 14,T2,13]	;GET COUNT FROM STATUS
   988	001037'	315305	001024*		CAMGE	T1,TUBIWC(U)	;(DON'T THINK IT CAN BE GREATER)
   989								;IF LENGTH ERROR AND WE READ AS MUCH AS REQUESTED,
   990	001040'	660000	040000		TRO	S,IOBKTL	;THEN WE LOST DATA FROM THE RECORD - SET IOBKTL.
   991
   992	001041'			RWDON2:
   993	001041'	302540	000011	RWDON1:	CAIE	M,I.RF		;READ?
   994	001042'	254000	001050'		JRST	RWDON4		;NO,WRITE
   995	001043'	607400	200000		TLNN	T3,(EOF)	;READ. EOF SEEN?
   996	001044'	254000	001070'		JRST	RD		;NO, JUST NORMAL STUFF.
   997	001045'	670000	001535'		TDO	S,[IOEND,,IODEND] ;YES, TELL USER
   998	001046'	402004	001007*		SETZM	DEVCNT(F)	;DON'T TRY TO READ ANYTHING ELSE.
   999	001047'	254000	001070'		JRST	RD		;AND GO FINISH.
  1000
  1001	001050'	603400	200000	RWDON4:	TLNE	T3,(EOF)	;WRITE. EOF BIT MEANS SAW EOT WHILE WRITING.
  1002	001051'	670000	001534'		TDO	S,[IOLEND,,IOTEND]
  1003	
  1004				    ;Writing complete.
  1005	001052'	135340	000521*		LDB T2,PIOMOD
  1006	001053'	305340	000016		CAIGE T2,DR		;Buffered mode?
  1007	001054'	260040	001102'		 PUSHJ	P,FREBUF		;Yes, free buffer.
  1008	001055'	336004	001046*	IOC:	SKIPN DEVCNT(F)		;More to do?
  1009	001056'	254000	000735'		 JRST MTDONE		;No, operation complete.
  1010	001057'	260040	001357'	IOC0:	PUSHJ	P,SRFX		;Yes, set up to do it.
  1011					 JRST [ PUSHJ	P,SUBRG1
  1012	001060'	254000	001537'			JRST IOC1]
  1013	001061'	254000	000735'		  JRST MTDONE		;Here if buffered mode and nothing to do.
  1014	001062'	607000	000001	IOC1:	TLNN S,IOW		;Is the user waiting for I/O to complete?
  1015	001063'	263040	000000		 POPJ	P,			;No, dismiss.
  1016	001064'	135340	001052*		LDB T2,PIOMOD		;Yes, wake him up if it's buffered mode.
  1017	001065'	305340	000016		CAIGE T2,DR
  1018	001066'	260040	000736*		 PUSHJ	P,SETIOD
  1019	001067'	263040	000000		POPJ	P,			;Dismiss.
  1020				    ;Reading complete.
  1021	001070'	135340	001064*	RD:	LDB T2,PIOMOD		;Get software mode.
  1022	001071'	305340	000016		CAIGE T2,DR		;Buffered?
  1023	001072'	254000	001075'		 JRST RDB		;Yes.
  1024	001073'	260040	001104'		PUSHJ	P,SDMPCT		;Set DEVDWC.
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15-5
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

  1025	001074'	254000	001055'		JRST IOC		;See if there's more to do.
  1026	001075'	260040	001102'	RDB:	PUSHJ	P,FREBUF		;Free buffer.
  1027	001076'	260040	001107'		PUSHJ	P,SBUFCT		;Set DEVBWC.
  1028	001077'	332004	001055*		SKIPE DEVCNT(F)		;More to do?
  1029	001100'	254000	001057'		 JRST IOC0		;Yes, start work on the next buffer.
  1030	001101'	254000	000735'		JRST MTDONE		;No.
  1031
  1032
  1033				;Here to free pages involved in a buffered mode I/O operation.
  1034	001102'	350004	000013	FREBUF:	AOS DEVABC(F)
  1035	001103'	254000	000206'		JRST BDIO
  1036
  1037				;Here to increment DEVDWC by the number of words transferred because of
  1038				; the last D or DR mode operation.
  1039	001104'	260040	001115'	SDMPCT:	PUSHJ	P,CNTWDS
  1040	001105'	272304	000525*		ADDM T1,DEVDWC(F)
  1041	001106'	263040	000000		POPJ	P,
  1042
  1043				;After a B mode transfer, compute how many words were actually transferred.
  1044	001107'	260040	001115'	SBUFCT:	PUSHJ	P,CNTWDS
  1045	001110'	550344	000014		HRRZ T2,DEVBWC(F)
  1046	001111'	202307	000000		MOVEM	T1,(T2)
  1047	001112'	340340	000000		AOJ T2,
  1048	001113'	542344	000014		HRRM T2,DEVBWC(F)
  1049	001114'	263040	000000		POPJ	P,
  1050
  1051				;Return in T1 the words transferred by the last transfer.
  1052	001115'			CNTWDS:	
  1053	001115'	260040	001331'		PUSHJ	P,GETST		;TERMINATION WORD IN T2
  1054	001116'	603300	200000		TLNE	T1,(EOF)	;IF EOF SEEN,
  1055	001117'	634300	000006		 TDZA	T1,T1		;THEN NO DATA WAS XFERRED.
  1056	001120'	135300	001541'		LDB	T1,[POINT 13,T2,13] ;GET TOTAL COUNT
  1057	001121'	263040	000000		POPJ	P,		;AND RETURN.
  1058
  1059				;Here to start or continue error recovery procedure after transfer
  1060				; done interrupt.
  1061	001122'	202305	000666*	ERGO:	MOVEM T1,TUBER1(U)
  1062	001123'	260040	001274'		PUSHJ	P,SUBRG1
  1063	001124'	263040	000000		POPJ	P,
  1064	001125'	202305	001122*	ERGO1:	MOVEM T1,TUBER1(U)
  1065	001126'	263040	000000		POPJ	P,
  1066
  1067	001127'			RWERR:
  1068	001127'	302540	000011		CAIE M,I.RF
  1069	001130'	254000	001156'		 JRST WRERR
  1070
  1071				;GO TO RDLOSE HERE ON FATAL ERRORS (MEMORY PARITY, ETC)
  1072	001131'	201300	000024		MOVEI T1,24		;20. retries.
  1073	001132'	202305	000000*		MOVEM T1,TUBER2(U)
  1074	001133'	201540	000004	RDERR:	MOVEI M,I.BSR		;Backup one record.
  1075	001134'	260040	000426'		PUSHJ	P,FT1CM2
  1076	001135'	265300	001125'		JSP T1,ERGO1
  1077	001136'	603400	170000		TLNE	T3,(ERRMSK)
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15-6
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

  1078	001137'	254000	001224'		  JRST RDLOSE
  1079	001140'	200305	000000*		MOVE T1,TUBCNT(U)	;Retry read operation.
  1080	001141'	202304	001077*		MOVEM T1,DEVCNT(F)
  1081	001142'	200305	000000*		MOVE T1,TUBCLS(U)
  1082	001143'	202304	000011		MOVEM T1,DEVCLS(F)
  1083	001144'	260040	001357'		PUSHJ	P,SRFX
  1084	001145'	255000	000000		 JFCL
  1085	001146'	201300	000011		MOVEI T1,I.RF
  1086	001147'	516304	000737*		HRLZM T1,DEVFNJ(F)
  1087	001150'	265300	001122'		JSP T1,ERGO
  1088	001151'	607400	130000		TLNN	T3,(ERRMSK-LENERR)
  1089	001152'	254000	001242'		JRST	RDWON		;LENGTH ERROR OK HERE.
  1090	001153'	377005	001132*	RDERR2:	SOSG TUBER2(U)		;Out of retries?
  1091	001154'	254000	001224'		 JRST RDLOSE
  1092	001155'	254000	001133'		JRST RDERR
  1093
  1094				IF2,<PRINTX [WRERR: What happens on memory parity?]>
  1095	001156'	201300	000024	WRERR:	MOVEI T1,24		;Number of retries.
  1096	001157'	202305	001153*		MOVEM T1,TUBER2(U)
  1097
  1098				;CODE TO NOT WRITE GAP OVER NOISE RECORDS USED TO BE HERE, NOISE RECORDS
  1099				; NOT IGNORED BY FOONLY HARDWARE.
  1100
  1101	001160'	135400	001542'	WRERR1:	LDB	T3,[POINT 2,S,^D28] ;GET DENSITY
  1102	001161'	302400	000001		CAIE	T3,1
  1103	001162'	306400	000002		CAIN	T3,2
  1104	001163'	634400	000010		TDZA	T3,T3		;800 BPI, T3/0
  1105	001164'	201400	000001		MOVEI	T3,1		;0 OR 3, 1600BPI, T3/1
  1106	001165'	200345	001037*		MOVE	T2,TUBIWC(U)	;GET NUMBER OF WORDS WE TRIED TO WRITE
  1107	001166'	270350	001543'		ADD	T2,[EXP <^D800*6>/^D50,<^D1600*6>/^D50](T3) ;ALLOW FOR .6 INCH GAP
  1108	001167'	230350	001545'		IDIV	T2,[EXP ^D800/<5*3>,^D1600/<5*3>](T3) ;GET NUMBER OF GAPS TO WRITE
  1109	001170'	340340	000000		AOJ T2,			;ROUND UP TO BE SAFE.
  1110	001171'	202345	000000*		MOVEM	T2,TUBIFC(U)	;SAVE COUNT OF ERASE GAPS IN TUBIFC
  1111	001172'	201540	000004		MOVEI M,I.BSR		;Back over record just written.
  1112	001173'	260040	000426'		PUSHJ	P,FT1CM2
  1113	001174'	265300	001125'		JSP T1,ERGO1
  1114	001175'	603400	170000		TLNE	T3,(ERRMSK)
  1115	001176'	254000	001225'		  JRST WRLOSE
  1116	001177'	201540	000006	WRERR2: MOVEI M,I.EG		;Erase tape.
  1117	001200'	260040	000426'		PUSHJ	P,FT1CM2	;DEVCNT SETUP SO CALL FT1CM2
  1118	001201'	265300	001125'		JSP T1,ERGO1
  1119	001202'	603400	170000		TLNE	T3,(ERRMSK)
  1120	001203'	254000	001225'		  JRST WRLOSE
  1121	001204'	373005	001171*		SOSLE	TUBIFC(U)
  1122	001205'	254000	001177'		  JRST	WRERR2		;NOT ENOUGH YET.
  1123
  1124	001206'	200305	001140*	WRERR3: MOVE T1,TUBCNT(U)
  1125	001207'	202304	001141*		MOVEM T1,DEVCNT(F)
  1126	001210'	200305	001142*		MOVE T1,TUBCLS(U)
  1127	001211'	202304	000011		MOVEM T1,DEVCLS(F)
  1128	001212'	260040	001357'		PUSHJ	P,SRFX
  1129	001213'	255000	000000		 JFCL
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 15-7
F3TSER.MAC	25-NOV-87 15:34		INTERRUPT PROCESSING

  1130	001214'	515540	000012		HRLZI M,I.WF
  1131	001215'	202544	001147*		MOVEM M,DEVFNJ(F)
  1132	001216'	265300	001122'		JSP T1,ERGO
  1133	001217'	607400	130000		TLNN	T3,(ERRMSK-LENERR)
  1134	001220'	254000	001246'		 JRST WRWON
  1135	001221'	377005	001157*		SOSG TUBER2(U)
  1136	001222'	254000	001225'		 JRST WRLOSE
  1137	001223'	254000	001160'		JRST WRERR1
  1138
  1139				;HERE WHEN ERROR RECOVERY DIDN'T WORK.
  1140	001224'	334540	001547'	RDLOSE:	SKIPA M,[I.RF]
  1141	001225'	201540	000012	WRLOSE:	 MOVEI M,I.WF
  1142	001226'	506544	001215*		HRLM M,DEVFNJ(F)
  1143				IF2,<PRINTX [WRLOSE+2: Are there any detectable device errors?]>
  1144				;WHAT ABOUT "READY", NEED TO CHECK THAT?
  1145	001227'	607400	120000		TLNN	T3,(PARERR!TIMOUT)
  1146	001230'	664000	200000		 TROA S,IODERR		;Say device in error
  1147	001231'	660000	100000		  TRO S,IODTER		;Say medium fouled up.
  1148	001232'	602000	200000		TRNE S,IODERR		;Device error?
  1149	001233'	260040	001236'		 PUSHJ	P,RECDER		;Y, log it for CHKPNT.
  1150	001234'	402005	001125*		SETZM TUBER1(U)
  1151	001235'	254000	001041'		JRST RWDON2
  1152				;Here to record a device error for CHKPNT to look at.
  1153	001236'	550244	000613*	RECDER:	HRRZ U,DEVUDB(F)
  1154	001237'	350005	000000*		AOS TUBEC(U)		;One more device error.
  1155	001240'	202405	000137*		MOVEM	T3,TUBSB(U)
  1156	001241'	263040	000000		POPJ	P,
  1157				;HERE WHEN ERROR RECOVERY SUCCEEDED IN COMPLETING OPERATION.
  1158	001242'	201540	000011	RDWON:	MOVEI	M,I.RF
  1159	001243'	506544	001226*		HRLM	M,DEVFNJ(F)
  1160	001244'	402005	001234*		SETZM	TUBER1(U)
  1161	001245'	254000	001015'		JRST	OD.RF
  1162
  1163	001246'	201540	000012	WRWON:	 MOVEI M,I.WF
  1164	001247'	506544	001243*		HRLM M,DEVFNJ(F)
  1165	001250'	402005	001244*		SETZM TUBER1(U)
  1166	001251'	254000	001030'		JRST	OD.WF
  1167
  1168
  1169
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 16
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1170				SUBTTL UTILITY SUBROUTINES.
  1171
  1172				COMMENT %@@SUBROUTINE RSBO
  1173				Reset status in S and UDB before operation is initiated.
  1174				@@EXPECTS U=UDB, F=DDB.
  1175				@@CALLS FSTHNG.
  1176				@@%
  1177
  1178	001252'	620000	004000	RSBO:	TRZ S,IOBOT
  1179	001253'	620000	764000		TRZ S,IOIMPM!IODERR!IODTER!IOBKTL!IODEND!IOBOT
  1180	001254'	261040	000006		PUSH P,T1
  1181	001255'	261040	000007		PUSH P,T2
  1182	001256'	261040	000016		PUSH P,P3
  1183	001257'	550105	000457*		HRRZ J,TUBKDB(U)	;KDB.
  1184	001260'	660000	010000		TRO S,IOACT		;Set S to reflect the start of I/O.
  1185	001261'	607000	001000		TLNN S,IOLEND
  1186	001262'	624000	002000		 TRZA S,IOTEND
  1187	001263'	660000	002000		  TRO S,IOTEND
  1188	001264'	202004	000002		MOVEM S,DEVIOS(F)	;Save S.
  1189	001265'	260040	001332'		PUSHJ	P,FSTHNG		;Reset hung device vars & clear previous fcn.
  1190	001266'	402004	000130*		SETZM DEVER1(F)		;No error status.
  1191	001267'	262040	000016		POP P,P3
  1192	001270'	262040	000007		POP P,T2
  1193	001271'	262040	000006		POP P,T1
  1194	001272'	263040	000000		POPJ	P,
  1195
  1196				COMMENT %@@SUBROUTINE SUBRGO
  1197				Start device performing opertion specififed by Lh(DEVFNJ).
  1198				@@DESTROYS T2.
  1199				@@ENTRY U=UDB, F=DDB.
  1200				@@CALLS SUBRS0, RSBO.
  1201				@@%
  1202
  1203	001273'	260040	001252'	SUBRGO: PUSHJ	P,RSBO
  1204	001274'	554304	001247*	SUBRG1:	HLRZ T1,DEVFNJ(F)	;Function code.
  1205	001275'	554306	000400'		HLRZ T1,FT1TBL-1(T1)	;Device command for this code.
  1206	001276'	302300	000001		CAIE T1,F.RO
  1207	001277'	306300	000000		 CAIN T1,F.REWI
  1208	001300'	254000	001326'		  JRST SUBRG2
  1209	001301'	700600	000105*		DSKOFF
  1210	001302'	550345	001257*		HRRZ	T2,TUBKDB(U)	;GET KDB ADDRESS
  1211	001303'	552247	000675*		HRRZM U,TKBCUN(T2)	;REMEMBER CURRENT UNIT XFERRING
  1212	001304'	201640	000000*	SUBRG3:	MOVEI	P2,MAGCHN	;GET READY TO CONSTRUCT COMMAND
  1213	001305'	137300	001550'		DPB	T1,[POINT 4,P2,29] ;SET FUNCTION FIELD
  1214	001306'	135340	000000*		LDB	T2,TUYTUN
  1215	001307'	137340	001551'		DPB	T2,[POINT 2,P2,25] ;UNIT NUMBER
  1216	001310'	135340	001552'		LDB	T2,[POINT 2,DEVMD1(F),35] ;GET MODE
  1217	001311'	306340	000001		CAIN	T2,1		;IF IBM MODE,
  1218	001312'	660640	010000		TRO	P2,XFRBYT	;DO IT IN BYTE MODE
  1219	001313'	602000	001000		TRNE	S,IOPAR		;EVEN PARITY?
  1220	001314'	660640	100000		TRO	P2,EVNPAR	;YES, SET IT
  1221	001315'	135340	001542'		LDB	T2,[POINT 2,S,28] ;GET DENSITY
  1222	001316'	336000	000007		SKIPN	T2		;IF ZERO,
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 16-2
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1223	001317'	201340	000003		MOVEI	T2,3		;USE HIGHEST
  1224	001320'	200347	001353'		MOVE	T2,DENTBL-1(T2) ;GET DENSITY SETTING
  1225	001321'	137340	001553'		DPB	T2,[POINT 3,P2,32] ;PUT IT IN COMMAND
  1226	001322'	200345	001020*		MOVE	T2,TUBICW(U)	;GET INITIAL CONTROL WORD
  1227				IFE OLDCTL,<
  1228					MTOP	T2,(P2)		;START THE THING GOING
  1229				>;END IFE OLDCTL
  1230	001323'	260040	001566'	IFN OLDCTL,<PUSHJ P,OLDMOP>
  1231	001324'	700600	000122*		DSKON
  1232	001325'	263040	000000		POPJ	P,
  1233	001326'	700600	001301*	SUBRG2:	DSKOFF			;Here on rewind.
  1234	001327'	523005	000733*		HLLOS TUBS(U)
  1235	001330'	254000	001304'		JRST	SUBRG3
  1236
  1237				IFE OLDCTL,<
  1238				GETST:	LDB	T1,TUYTUN	;GET TAPE UNIT NUMBER
  1239					LSH	T1,^D35-^D25	;PUT IT INTO BIT 24 AND 25
  1240					MTRS	T2,T1		;GET STATUS INTO T1, TERMINATION STATUS IN T2
  1241					POPJ	P,		;AND RETURN.
  1242				>;END IFE OLDCTL
  1243				IFN OLDCTL,<
  1244	001331'	254000	001665'	GETST:	JRST	OLDSTS>
  1245
  1246
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 17
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1247				COMMENT %@@SUBROUTINE FSTHNG
  1248				Reset the hung timeout variables for the device
  1249				@@ENTRY U=UDB, F=DDB.
  1250				@@CALLS SETHNG.
  1251				@@CALLED UUO, I-level. @@%
  1252
  1253	001332'	513005	000602*	FSTHNG:	HLLZS UNITYP(U)		;CLEAR THE PREV WAS WAIT FLAG.
  1254	001333'	324740	000120*		PJRST SETHNG		;RESET THE HUNG TIME.
  1255
  1256				COMMENT %@@SUBROUTINE FHGSTP
  1257				Save some ACs and call HNGSTP, which tells the user that the device
  1258				he wants to use isn't ready.
  1259				@@ENTRY F=DDB.
  1260				@@DESTROYS T4.
  1261				@@CALLED UUO. @@%
  1262
  1263	001334'	261040	000005	FHGSTP:	PUSH P,U
  1264	001335'	261040	000003		PUSH P,PG
  1265	001336'	261040	000012		PUSH P,W
  1266	001337'	261040	000013		PUSH P,M
  1267	001340'	261040	000006		PUSH P,T1
  1268	001341'	261040	000007		PUSH P,T2
  1269	001342'	261040	000010		PUSH P,T3
  1270	001343'	260040	000000*		PUSHJ	P,HNGSTP
  1271	001344'	262040	000010		POP P,T3
  1272	001345'	262040	000007		POP P,T2
  1273	001346'	262040	000006		POP P,T1
  1274	001347'	262040	000013		POP P,M
  1275	001350'	262040	000012		POP P,W
  1276	001351'	262040	000003		POP P,PG
  1277	001352'	262040	000005		POP P,U
  1278	001353'	263040	000000		POPJ	P,
  1279
  1280
  1281
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 18
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1282				COMMENT %@@SUBROUTINE UNISE0
  1283				Set up TC register before a transfer.
  1284				@@ENTRY S=DEVIOS, U=UDB, F=DDB.
  1285				@@DESTROYS T1.
  1286				@@CALLED UUO. @@%
  1287
  1288				;Density, index by software density minus 1.
  1289	001354'	000000	000002	DENTBL:	EXP	DN800		;1 - 800BPI
  1290	001355'	000000	000002		EXP	DN800		;2 - 800BPI
  1291	001356'	000000	000003		EXP	DN1600		;3 - 1600BPI
  1292
  1293
  1294
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 19
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1295				COMMENT %@@SUBROUTINE SRFX
  1296				In DEVCLS(F) is a pointer to a vector of "IOWDS" each of which is in the
  1297				format: bits 0-13: ones complement word count which specifies at
  1298				most one page; bits 14-35: one less than the first core address to be
  1299				used for this transfer.  The vector is terminated by a 0 word in D and DR
  1300				modes; in B mode, after each buffer is a 0 word and a second 0 word appears
  1301				after the last buffer.  Note that in B and D modes, the virtual core addresses
  1302				to be used in a single transfer must be contiguous.
  1303				In D mode, the entire list is done in one transfer.
  1304				In DR mode, the list is stepped through
  1305				and 200 word records are read or written; successive transfers are
  1306				initiated at I-level (using DEVCNT as the state variable).  In B mode,
  1307				records are the same size as the buffers.
  1308				At I-level, the job is awakened after each buffer is trasferrd in B mode;
  1309				it is left in IOW until the entire transfer is finished in D or DR mode.
  1310				@@ENTRY F=DDB.
  1311				@@DESTROYS T1, T2, U.
  1312				@@CALLS STODTS, SDTCAL, AND RSBO.
  1313				@@ERRORS CERTAIN ILLEGAL DDB LISTS (TOO LARGE A BUFFER, A
  1314				ZERO DATA COUNT FOR D OR DR MODES) CAUSE A STOPCODE.
  1315				@@CALLED UUO, I-level. @@%
  1316
  1317				;IF COUNT DIFFERENT FROM XFER REQUEST IN B MODE, WORD COUNT NOT STORED INTO BUFFER.
  1318				IF2,<PRINTX [SRFX: Word count not stored in buffer]>
  1319
  1320	001357'	261040	000015	SRFX:	PUSH P,P2
  1321	001360'	261040	000011		PUSH P,T4
  1322	001361'	261040	000013		PUSH P,M
  1323	001362'	261040	000003		PUSH P,PG
  1324	001363'	550244	001236*		HRRZ	U,DEVUDB(F)
  1325	001364'	200304	001207*		MOVE T1,DEVCNT(F)	;Save for error recovery.
  1326	001365'	202305	001206*		MOVEM T1,TUBCNT(U)
  1327	001366'	200304	000011		MOVE T1,DEVCLS(F)
  1328	001367'	202305	001210*		MOVEM T1,TUBCLS(U)
  1329	001370'	336304	001364*		SKIPN T1,DEVCNT(F)	;Continuing?
  1330	001371'	200304	000011		 MOVE T1,DEVCLS(F)	;No.
  1331	001372'	336446	000000		SKIPN T4,(T1)		;Get the IOWD.
  1332	001373'	256000	001554'		 STOPCD (.,JOB,MTANIS,,<No IOWD in SRFX>)
  1333	001374'	135540	001557'		LDB M,[POINT 14,T4,13]	;Number of words to do on this page.
  1334	001375'	332004	001370*		SKIPE DEVCNT(F)
  1335	001376'	554544	001375*		 HLRZ M,DEVCNT(F)
  1336	001377'	670540	000003'		TDO	M,MSKCTD	;TURN INTO REAL -VE NUMBER
  1337	001400'	135140	001070*		LDB PG,PIOMOD		;Get mode.
  1338	001401'	306140	000016		CAIN PG,DR		;Different code for different modes
  1339	001402'	254000	001420'		 JRST SRFDR
  1340	001403'	302140	000017		CAIE PG,D
  1341	001404'	254000	001407'		 JRST SRFB
  1342
  1343				    ;D mode.  One transfer uses the whole space specified by the vector.
  1344	001405'	260040	001436'		PUSHJ	P,SETADR
  1345	001406'	254000	001430'		JRST SRTDON
  1346
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 19-2
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1347				    ;B mode.  One record is transferred per buffer.
  1348	001407'	606540	037777	SRFB:	TRNN	M,37777		;IF NO WORDS TO XFER
  1349	001410'	254000	001413'		JRST	SRFB1		;JUMP.
  1350	001411'	260040	001436'		PUSHJ	P,SETADR
  1351	001412'	254000	001422'		JRST SRFDR0
  1352	
  1353	001413'	332006	000001	SRFB1:	SKIPE 1(T1)		;Only legal if this is last word in the list
  1354	001414'	256000	001560'		 STOPCD (.,JOB,MTALNZ,,<Last word Not Zero>)
  1355	001415'	402004	001376*		SETZM DEVCNT(F)		;Not continuing
  1356	001416'	350001	777774		AOS	-4(P)		;GIVE SKIP RETURN TO HIGHER ROUTINE TO SAY NO DATA
  1357	001417'	254000	001431'		JRST	SRTDN1		;AND POP STUFF OFF STACK.
  1358
  1359				    ;DR mode.  Record size is at most 200 words.
  1360	001420'	260040	001436'	SRFDR:	PUSHJ	P,SETADR
  1361	001421'	326540	001426'		JUMPN M,SRFDR1		;Any more left on this IOWD?
  1362	001422'	340300	000000	SRFDR0:	AOJ T1,			;No, move on to the next.
  1363	001423'	336006	000000		SKIPN (T1)		;Have we reached the end of the vector?
  1364	001424'	634300	000006		 TDZA T1,T1		;No, zero continuation word.  I-level will
  1365								; wake up the job.
  1366	001425'	135540	001563'		  LDB M,[POINT 14,(T1),13]	;Yes, this many words to transfer.
  1367	001426'	552304	001415*	SRFDR1:	HRRZM T1,DEVCNT(F)	;Set up for I-level continuation.
  1368	001427'	506544	001426*		HRLM M,DEVCNT(F)
  1369				;	JRST SRTDON
  1370
  1371	001430'	260040	001252'	SRTDON:	PUSHJ	P,RSBO		;Set flags in S, clear DDB error variables.
  1372	001431'	262040	000003	SRTDN1:	POP P,PG
  1373	001432'	262040	000013		POP P,M
  1374	001433'	262040	000011		POP P,T4
  1375	001434'	262040	000015		POP P,P2
  1376	001435'	263040	000000		POPJ	P,
  1377
  1378				;ROUTINE SETADR
  1379				; BUILDS TAPE CHANNEL COMMAND LIST
  1380				;
  1381				;ENTER WITH T1/ADDR (IN DDB) OF IOWD TO START WITH
  1382				;	M/ NEGATIVE COUNT OF NUMBER OF WORDS TO DO ON FIRST IOWD
  1383				;FOR DR MODE, RETURNS WITH
  1384				;	T1/ADDR IN DDB OF NEXT IOWD TO DO
  1385				;	M/ NEGATIVE COUNT OF NUMBER OF WORDS TO DO ON THIS IOWD
  1386				;
  1387				;FOR D AND B MODES, ALL DDB IOWDS ARE PROCESSED UP TO THE FIRST
  1388				; ZERO AND M IS RETURNED 0.
  1389				;TUBIWC IS SET TO THE TOTAL NUMBER OF WORDS ATTEMPTING TO TRANSFER
  1390				;
  1391				;USES T1-T4, PG, P2
  1392
  1393
  1394	001436'	553000	000006	SETADR:	HRRZS	T1		;CLEAR OUT LH
  1395	001437'	402005	001165*		SETZM	TUBIWC(U)	;GET READY TO ADD IN COUNTS
  1396	001440'	201645	000000*		MOVEI	P2,TUBCOM(U)	;ADDRESS OF WHERE TO BUILD COMMAND LIST
  1397	001441'	661640	400000		TLO	P2,(CCWJMP)
  1398	001442'	202645	001322*		MOVEM	P2,TUBICW(U)	;REMEMBER WHERE COMAND LIST IS
  1399	001443'	135340	001563'	SETAD1:	LDB	T2,[POINT 14,(T1),13] ;GET COUNT OF THIS IOWD
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 19-3
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1400	001444'	670340	000003'		TDO	T2,MSKCTD	;TURN INTO A REAL -VE COUNT
  1401	001445'	135440	001564'		LDB	T4,[POINT 22,(T1),35] ;GET ADDRESS-1
  1402	001446'	217000	000007		MOVMS	T2		;GET +COUNT OF TOTAL WORDS IN THIS IOWD
  1403	001447'	271447	000001		ADDI	T4,1(T2)	;GET LAST WORD TO XFER TO + 1
  1404	001450'	270440	000013		ADD	T4,M		;GET FIRST ADDRESS TO XFER TO
  1405	001451'	135400	001400*		LDB	T3,PIOMOD
  1406	001452'	302400	000016		CAIE	T3,DR		;IF DR MODE
  1407	001453'	254000	001470'		JRST	SETAD2		;NOT
  1408	001454'	214400	000013		MOVM	T3,M		;GET NUMBER OF WORDS MORE THIS WILL BE
  1409	001455'	270405	001437*		ADD	T3,TUBIWC(U)	;GET TOTAL WORD COUNT THIS XFER WILL BE
  1410	001456'	307400	000200		CAIG	T3,200		;MORE THAN 200 WORDS?
  1411	001457'	254000	001470'		JRST	SETAD2		;NO, JUST ADD ANOTHER CHANNEL COMMAND LIST
  1412	001460'	201400	000200		MOVEI	T3,200		;GET HOW MANY TO DO IN THIS IOWD
  1413	001461'	274405	001455*		SUB	T3,TUBIWC(U)
  1414	001462'	137400	001565'		DPB	T3,[POINT 13,T4,13] ;PUT COUNT WHICH WILL BRING US TO 200 IN
  1415	001463'	272405	001461*		ADDM	T3,TUBIWC(U)	;TUBIWC WILL GET SET TO 200.
  1416	001464'	270540	000010		ADD	M,T3		;M IS NEW NEG NUMBER OF WORDS LEFT TO DO.
  1417	001465'	202455	000000		MOVEM	T4,(P2)		;STORE ANOTHER IOWD
  1418	001466'	402015	000001	SETADO:	SETZM	1(P2)		;MAKE LAST CHANNEL COMMAND WORD A HALT
  1419	001467'	263040	000000		POPJ	P,		;AND RETURN.
  1420
  1421				;HERE IF B OR D MODES, OR IF DR AND TOTAL COUNT WILL NOT EXCEED 200 YET.
  1422
  1423	001470'	214400	000013	SETAD2:	MOVM	T3,M		;GET NUMBER OF WORDS LEFT TO DO
  1424	001471'	137400	001565'		DPB	T3,[POINT 13,T4,13] ;SET
  1425	001472'	202455	000000		MOVEM	T4,(P2)		;STORE ANOTHER IOWD
  1426	001473'	272405	001463*		ADDM	T3,TUBIWC(U)	;THIS MANY MORE TO EXPECT TO HAVE XFERRED
  1427	001474'	336546	000001		SKIPN	M,1(T1)		;ANY MORE IOWDS TO DO?
  1428					AOJA	T1,SETADO	;NO, RETURN WITH M ZEROED AND T1 POINTING TO IOWD 1 PAST LAST O
  1429	001475'	344300	001466'	NE WE DID.
  1430	001476'	350000	000006		AOS	T1		;YES, POINT OT IT
  1431	001477'	135540	001563'		LDB	M,[POINT 14,(T1),13] ;SETUP M FOR NEW NUMBER OF WORDS TO DO
  1432	001500'	670540	000003'		TDO	M,MSKCTD	;TURN INTO REAL NUMBER
  1433	001501'	344640	001443'		AOJA	P2,SETAD1	;POINT TO PLACE TO STORE NEXT IOWD AND CONTINUE.
  1434	001502'				LIT
  1435	001502'	040000	300000
  1436	001503'	260040	000000*
  1437	001504'	556441	565142
  1438	001505'	000002	000000
  1439	001506'	111500	000006
  1440	001507'	260040	001503*
  1441	001510'	556441	514372
  1442	001511'	000002	000000
  1443	001512'	200313	000000
  1444	001513'	202313	000000
  1445	001514'	550413	000000
  1446	001515'	476013	000001
  1447	001516'	000000	000306'
  1448	001517'	000000	000314'
  1449	001520'	000000	000321'
  1450	001521'	202313	000001
  1451	001522'	124313	000001
  1452	001523'	202353	000001
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 19-4
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1453	001524'	000200	000013
  1454	001525'	000001	000001
  1455	001526'	001000	020000
  1456	001527'	260040	001331'
  1457	001530'	603300	000010
  1458	001531'	254000	000547'
  1459	001532'	201300	000012
  1460	001533'	254000	000534'
  1461	001534'	001000	002000
  1462	001535'	000040	020000
  1463	001536'	261600	000007
  1464	001537'	260040	001274'
  1465	001540'	254000	001062'
  1466	001541'	261500	000007
  1467	001542'	070200	000000
  1468	001543'	000000	000140
  1469	001544'	000000	000300
  1470	001545'	000000	000065
  1471	001546'	000000	000152
  1472	001547'	000000	000011
  1473	001550'	060400	000015
  1474	001551'	120200	000015
  1475	001552'	000204	000375*
  1476	001553'	030300	000015
  1477	001554'	260040	001507*
  1478	001555'	556441	565163
  1479	001556'	000002	000000
  1480	001557'	261600	000011
  1481	001560'	260040	001554*
  1482	001561'	556441	545672
  1483	001562'	000002	000000
  1484	001563'	261606	000000
  1485	001564'	002606	000000
  1486	001565'	261500	000011
  1487
  1488
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 20
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1489				IFN OLDCTL,<
  1490				;TEMP ROUTINE TO DRIVE OLD F3 TAPE CONTROL.
  1491				; CONVERTS A COMMAND WORD FOR NEW CONTROL TO OLD CONTROL,
  1492				; SETS UP SOME EXEC VIRTUAL LOCATIONS SO CAN DO THE TRANSFER.
  1493
  1494				EXTERNAL EPT,EPTEBR
  1495
  1496				OPDEF OMTOP  [726000,,0]	;OLD TAPE OPERATION
  1497				OPDEF OMTWR  [731000,,0]	;OLD TAPE WRITE
  1498				OPDEF OMTRD  [732000,,0]	;OLD TAPE READ
  1499				OPDEF OMTRS  [727000,,0]	;OLD TAPE STATUS
  1500				OPDEF TPCONI [733000,,0]	;OLD TAPE CONI
  1501				OPDEF TPCONO [734000,,0]	;OLD TAPE CONO
  1502				OPDEF TPCNSO [735000,,0]	;OLD TAPE CONSO
  1503				OPDEF TPDATI [736000,,0]	;OLD TAPE DATAI
  1504
  1505	001566'	261040	000006	OLDMOP:	PUSH	P,T1
  1506	001567'	261040	000007		PUSH	P,T2
  1507	001570'	261040	000010		PUSH	P,T3
  1508	001571'	261040	000011		PUSH	P,T4
  1509	001572'	735000	100000		TPCNSO	100000		;1B18 = OVERRUN, 1B19 = CONTROL BUSY,
  1510								;1B20=FORMATTER BUSY
  1511	001573'	254000	001575'		JRST	.+2		;OK.
  1512	001574'	256000	041701'		 STOPCD (.,JOB,MTAXIP,,<Xfer already In Progress>)
  1513
  1514	001575'	734000	000120*		TPCONO	120+MAGCHN	;CLEAR FORMATTER, INTERRUPT FLAG, SET PI ASSIGNMENT
  1515
  1516	001576'	135300	041704'		LDB	T1,[POINT 4,P2,29]	;GET COMMAND CODE
  1517	001577'	256006	001653'		XCT	XTAB(T1)	;SETUP T1 WITH PROPER CONTROL FUNCTION
  1518								;OR CRASH IF UNIMPLEMENTED
  1519	001600'	726346	000000		OMTOP	T2,(T1)		;DO THE FUNCTION.
  1520	001601'	254000	001644'		JRST	OLDOUT		;BYE.
  1521
  1522	001602'	200445	001442*	OLDRW:	MOVE	T4,TUBICW(U)	;GET ADDRESS OF COMMAND LIST
  1523	001603'	505440	777737		HRLI	T4,%MTA.N-%MTE.N;-Number of pages reserved for F3TSER
  1524	001604'	200400	041705'		MOVE	T3,[POINT 18,EPT+<%MTA.N/2>,-1+^D18*<%MTA.N&1>]
  1525								;PLACE TO SETUP STUFF in EPT
  1526	001605'	336311	000000	OLDRW1:	SKIPN	T1,(T4)		;GET NEXT COMMAND WORD
  1527	001606'	254000	001616'		 JRST	OLDCDN		;COMMANDS DONE.
  1528	001607'	135340	041706'		LDB	T2,[POINT 13,T1,26] ;GET PAGE NUMBER
  1529	001610'	660340	500000		TRO	T2,PGE.A!PGE.W	;MAKE WRITEABLE AND ACCESSIBLE
  1530	001611'	136340	000010		IDPB	T2,T3		;PUT INTO THE MAP
  1531	001612'	253440	001605'		AOBJN	T4,OLDRW1
  1532	001613'	661000	400000		TLO	S,IOIMPM	;Transfer too big, set IOIMPM
  1533	001614'	202004	000002		MOVEM	S,DEVIOS(F)
  1534	001615'	254000	001644'		JRST	OLDOUT
  1535
  1536	001616'	701220	000000*	OLDCDN:	CLRPTA			;CLEAR PAGE TABLE
  1537	001617'	200325	001602*		MOVE	T1,@TUBICW(U)	;GET FIRST COMMAND AGAIN
  1538	001620'	405300	000777		ANDI	T1,777		;GET PLACE TO START WITHIN FIRST PAGE
  1539	001621'	271300	732000		ADDI	T1,%MTA		;VIRTUAL ADDRESS TO START
  1540	001622'	200340	000006		MOVE	T2,T1		;Get exec virtual address
  1541	001623'	200405	001473*		MOVE	T3,TUBIWC(U)	;GET WORD COUNT
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 20-2
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1542	001624'	602640	030000		TRNE	P2,XFRMOD	;0 MEANS NORMAL
  1543					 JRST	[OMTOP 50	;SET IBM BYTE MODE
  1544	001625'	254000	041707'			 JRST .+2]
  1545	001626'	726000	000051		OMTOP	51		;SET TO REGULAR PDP10 WORD MODE
  1546	001627'	700600	000400		WRPI	LI.PIF
  1547	001630'	135440	041704'		LDB	T4,[POINT 4,P2,29] ;GET COMMAND AGAIN
  1548	001631'	302440	000010		CAIE	T4,F.RF
  1549	001632'	254000	001636'		 JRST	OLDWRT
  1550	001633'	201300	001701'		MOVEI	T1,MAGBUF	;GET BUFFER ADDRESS
  1551	001634'	732325	001623*		OMTRD	T1,@TUBIWC(U)	;START THE READ
  1552	001635'	254000	001644'		JRST	OLDOUT		;AND RETURN.
  1553
  1554	001636'	507000	000007	OLDWRT:	HRLS	T2		;GET USER BUFFER,,0
  1555	001637'	541340	001701'		HRRI	T2,MAGBUF	;WRITE TO BLT USR BUFFER TO
  1556	001640'	271407	777777		ADDI	T3,-1(T2)	;LAST ADDR IN MAGBUF TO BLT TO
  1557	001641'	251350	000000		BLT	T2,(T3)		;Copy data into continguous core
  1558	001642'	201300	001701'		MOVEI	T1,MAGBUF	;GET BUFFER ADDRESS
  1559	001643'	731325	001634*		OMTWR	T1,@TUBIWC(U)	;START THE WRITE (T1=addr, E=count)
  1560	001644'	700600	000200	OLDOUT:	WRPI	LI.PIN		;TURN PI BACK ON
  1561	001645'	262040	000011		POP	P,T4
  1562	001646'	262040	000010		POP	P,T3
  1563	001647'	262040	000007		POP	P,T2
  1564	001650'	262040	000006		POP	P,T1
  1565	001651'	263040	000000		POPJ	P,
  1566
  1567	001652'	256000	041711'	MTAIFC:: STOPCD (.,JOB,MTAIFC,,<Illegal Function Code>)
  1568
  1569	001653'	201300	000000	XTAB:	MOVEI	T1,0		;REWIND IS SAME
  1570	001654'	201300	000000		MOVEI	T1,0		;REWIND AND UNLOAD BECOMES REWIND
  1571	001655'	201300	000001		MOVEI	T1,1		;WRITE EOF
  1572	001656'	201300	000013		MOVEI	T1,13		;ERASE GAP
  1573	001657'	201300	000005		MOVEI	T1,5		;FORWARD SPACE
  1574	001660'	201300	000006		MOVEI	T1,6		;BACKWARD SPACE
  1575	001661'	256000	001652'		 STOPCD (,XCT,MTAIFC)
  1576					;CAN'T DO SPACE FILE
  1577	001662'	256000	001652'		 STOPCD (,XCT,MTAIFC)
  1578					;OR BACK SPACE FILE
  1579	001663'	254000	001602'		JRST	OLDRW		;READ
  1580	001664'	254000	001602'		JRST	OLDRW		;WRITE
  1581
  1582	001665'	736000	000006	OLDSTS:	TPDATI	T1		;GET TRANSFER STATUS BITS
  1583	001666'	200340	000006		MOVE	T2,T1		;COPY SO GET JUST ADDR
  1584	001667'	621340	777760		TLZ	T2,777760	;GET 22 BIT ADDRESS
  1585	001670'	275340	001701'		SUBI	T2,MAGBUF	;GET COUNT OF WORDS XFERRED
  1586	001671'	242340	000026		LSH	T2,^D35-^D13	;PUT INTO BIT 13.
  1587	001672'	727000	000010		OMTRS	T3		;GET STATUS OF TAPE DRIVE
  1588	001673'	517000	000010		HRLZS	T3		;PUT BITS INTO LH
  1589	001674'	434300	000010		IOR	T1,T3		;GET 0-13 STATUS BITS.
  1590	001675'	735000	400000		TPCNSO	400000		;SKIP IF OVERRUN IS ON
  1591	001676'	263040	000000		 POPJ	P,		;AND RETURN.
  1592	001677'	661300	410000		TLO	T1,(ANYERR!OVRRUN)
  1593	001700'	263040	000000		POPJ	P,		;RETURN.
  1594
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 20-3
F3TSER.MAC	25-NOV-87 15:34		UTILITY SUBROUTINES.

  1595				;REPLACE GETST ROUTINE WITH OLDSTS
  1596				;REPLACE MTSO WITH SKIPN MAGFLG
  1597				;REPLACE MTOP WITH PUSHJ TO OLDMOP
  1598
  1599	001701'			MAGBUF:	BLOCK	^D32*1000	;BUFFER FOR OLD CTL (14 bits count, 22 addr)
  1600				>;END IFN OLDCTL
  1601
  1602	041701'	260040	001560*		$END	(F3T)

  1603	041702'	556441	705160

  1604	041703'	000002	000000

  1605	041704'	060400	000015

  1606	041705'	442200	000355*

  1607	041706'	111500	000006

  1608	041707'	726000	000050

  1609	041710'	254000	001627'

  1610	041711'	260040	041701*

  1611	041712'	556441	514643

  1612	041713'	000002	000000

  1613						;End of F3TSER (F3TLIT: F3TEND:)
  1614
NO ERRORS DETECTED
PROGRAM BREAK IS 041714
7K CORE USED
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 21
F3TSER.MAC	25-NOV-87 15:34		SYMBOL TABLE

ANYERR	400000	000000	SPD	DN1600		000003	SPD	FTDVF5		000262'		JOB		000454'	EXT
BDIO		000206'		DN200		000000	SPD	FTDVF7		000264'		LENERR	040000	000000	SPD
BITTBL		000000	EXT	DN556		000001	SPD	FTLEO1		000470'		LI.PIF		000400	SPD
BUFKRN		000227'		DN6250		000004	SPD	FTLEOT		000464'		LI.PIN		000200	SPD
CCWADR	000017	777777	SPD	DN800		000002	SPD	FTOUT		000377'		LI.REQ		004000	SPD
CCWCNT	377760	000000	SPD	DOU		000010	SIN	FTP2		000355'		LICSPY		200000	SIN
CCWJMP	400000	000000	SPD	DPL		000234'		FTP6		000363'		LICSYS		040000	SIN
CHKCUN		000654'		DR		000016	SIN	FTPTBL		000342'		LOADPT		040000	SPD
CHKOF1		000732'		DRL		000006	SIN	FTSKB2		000435'		LODPNT	000004	000000	SPD
CHKOFL		000725'		DS1600		000010	SPD	FTSKB3		000461'		M		000013	INT
CHKRW1		000721'		DS800		000004	SPD	FTSKB4		000447'		MAGBUF		001701'	
CHKRW3		000722'		DSKPIF		001326'	EXT	FTSKBL		000436'		MAGCHN		001304'	EXT
CHKRW4		000673'		DSKPIN		001324'	EXT	FXDSM1		000750'		MAGDDS		000013'	EXT
CHKSSC		000672'		DSPSIZ		000015	SPD	GETCTL		000552'		MAGDSP		000010'	INT
CMD		001700	SPD	DVSIZ		000003	SIN	GETST		001331'		MAGIN1		000032'	
CNTRLC		000400	SIN	DZAP		000012	SIN	HASCTL		020000	SPD	MAGINI		000026'	INT
CNTWDS		001115'		EOF	200000	000000	SPD	HNGSTP		001343'	EXT	MAGINT		000635'	INT
CPOPJ		000406'	EXT	EOT	000001	000000	SPD	HNGTAP		040000	SPD	MAGSAV		000647'	EXT
CPOPJ1		000273'	EXT	EPT		000000	EXT	I.BF		000010	SPD	MSKCTD		000003'	
CTLAVL		200000	SPD	EPTEBR		000000	EXT	I.BSR		000004	SPD	MSKCTU		000004'	
D		000017	SIN	ERGO		001122'		I.EG		000006	SPD	MSKMMD		777760	SPD
DATASZ		000005'		ERGO1		001125'		I.REWI		000001	SPD	MSKMMU		777700	SPD
DBYT		000002	SIN	ERRMSK	170000	000000	SPD	I.RF		000011	SPD	MTAICZ		000240'	INT
DCL		000007	SIN	EVNPAR		100000	SPD	I.RO		000005	SPD	MTAIFC		001652'	INT
DDI	777777	777777	SIN	F		000004	INT	I.SF		000007	SPD	MTALNZ		001414'	INT
DDINT		000001	SIN	F.BSR		000005	SPD	I.SKR		000003	SPD	MTANIB		000215'	INT
DDIO		000166'		F.EG		000003	SPD	I.WF		000012	SPD	MTANIS		001373'	INT
DDO	777777	777776	SIN	F.REWI		000000	SPD	I.WTM		000002	SPD	MTAVAL		000564'	EXT
DDXZ		000000	SIN	F.RF		000010	SPD	INTERR		001012'		MTAXIP		001574'	INT
DECDI2		000174'		F.RO		000001	SPD	INTREQ		400000	SPD	MTDON1		000745'	
DENS		000070	SPD	F.SKR		000004	SPD	IO		000020	SIN	MTDONE		000735'	
DENTBL		001354'		F.WF		000011	SPD	IOACT		010000	SIN	MTICE0		001004'	
DEVABC		000013	SIN	F.WTM		000002	SPD	IOBEG		000002	SIN	MTOP	727000	000000	
DEVBWC		000014	SIN	F3TEND		041713'	INT	IOBKTL		040000	SIN	MTPERR		000370'	
DEVCLS		000011	SIN	F3TLIT		041701'	INT	IOBOT		004000	SIN	MTREQ		000563'	EXT
DEVCNT		001427'	EXT	F3TRWC		000155'	INT	IOC		001055'		MTRS	726000	000000	
DEVDIO		000515'	EXT	F3TSER		000000'	ENT	IOC0		001057'		MTSO	731000	000000	
DEVDWC		001105'	EXT	FFUERR		000300'		IOC1		001062'		MTSZ	730000	000000	
DEVER1		001266'	EXT	FFUGF2		000302'		IODEND		020000	SIN	MTUDBL		000267'	EXT
DEVFNJ		001274'	EXT	FFUGF3		000303'		IODERR		200000	SIN	MTWAIT		000553'	EXT
DEVIOS		000002	SIN	FFUS1		000322'		IODTER		100000	SIN	NODIE		000000	EXT
DEVMD1		001552'	EXT	FFUS2		000327'		IOEND		000040	SIN	OD.BF		000767'	
DEVNAM		000000	SIN	FFUSTO		000312'		IOIMPM		400000	SIN	OD.BSR		000775'	
DEVSTS		000012	SIN	FHGSTP		001334'		IOLEND		001000	SPD	OD.EG		001001'	
DEVUDB		001363'	EXT	FREBUF		001102'		IOPAR		001000	SIN	OD.RF		001015'	
DGF		000015	SIN	FSTHNG		001332'		IOTEND		002000	SIN	OD.RO		000764'	
DGTRD		000013	SIN	FT1CM2		000426'		IOW		000001	SIN	OD.SF		000770'	
DHNG		000005	SIN	FT1CM3		000427'		J		000002	INT	OD.SKR		000775'	
DIE		041711'	EXT	FT1CMD		000413'		JBTABT		000567'	EXT	OD.WF		001030'	
DIN		000011	SIN	FT1TBL		000401'		JBTIOA		000536'	EXT	OD.WTM		001001'	
DINI		000004	SIN	FT9TRK		000372'		JBTLIC		000271'	EXT	ODD		000752'	
DMT		000014	SIN	FTAPE		000352'		JBTSTS		000451'	EXT	OLDCDN		001616'	
DN1600		000003	SPD	FTC		000011	SPD	JOB		000454'	EXT	OLDCTL		000001	SPD
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88 PAGE 21-2
F3TSER.MAC	25-NOV-87 15:34		SYMBOL TABLE

OLDMOP		001566'		S$JOB		000002	SIN	TMXCL7		000073'		WRWON		001246'	
OLDOUT		001644'		S$NAME		000000'	SPD	TMXCL8		000100'		WSCHED		000456'	EXT
OLDRW		001602'		S$NONA		000000	SIN	TMXCLS		000053'		XFRBYT		010000	
OLDRW1		001605'		S$PATC		000007	SIN	TMXGRD		000627'		XFRCDM		000000	SPD
OLDSTS		001665'		S$TEMP	777776	000000	SPD	TMXHC2		000122'		XFRMOD		030000	SPD
OLDWRT		001636'		S$XCT	777777	777776	SIN	TMXHC3		000121'		XTAB		001653'	
OMTOP	726000	000000		SAVAIL		000612'		TMXHCT		000120'		ZZ	005557	664555	SPD
OMTRD	732000	000000		SAVAL2		000614'		TMXHN8		000125'		%MTA		732000	SIN
OMTRS	727000	000000		SAVAL4		000620'		TMXHNG		000105'		%MTA.N		000732	SIN
OMTWR	731000	000000		SAVAL8		000625'		TMXRED		000511'		%MTE		773000	SIN
ONLINE	000040	000000	SPD	SBUFCT		001107'		TMXREL		000045'		%MTE.N		000773	SIN
OUTPB		004000	SIN	SDCIO2		000150'		TMXRW1		000545'		
OVRRUN	010000	000000	SPD	SDCIO3		000152'		TMXUGF		000275'		
P		000001	INT	SDCIO4		000153'		TMXWRT		000512'		
P1		000014	INT	SDCIOA		000145'		TPCNSO	735000	000000		
P2		000015	INT	SDMPCT		001104'		TPCONI	733000	000000		
P3		000016	INT	SETAD1		001443'		TPCONO	734000	000000		
PAG		000010	SPD	SETAD2		001470'		TPDATI	736000	000000		
PAGWAK		000243'	EXT	SETADO		001466'		TRK9		000100	SPD	
PARERR	100000	000000	SPD	SETADR		001436'		TU0CB		000251'	EXT	
PG		000003	INT	SETHNG		001333'	EXT	TUBCLS		001367'	EXT	
PGE.A		400000	SIN	SETIOD		001066'	EXT	TUBCNT		001365'	EXT	
PGE.W		100000	SIN	SFDONE		010000	SPD	TUBCOM		001440'	EXT	
PGYDIO		000241'	EXT	SGTDE0		000603'		TUBDDB		000677'	EXT	
PIA		000007	SPD	SGTDE1		000610'		TUBEC		001237'	EXT	
PIOMOD		001451'	EXT	SGTDEV		000572'		TUBER1		001250'	EXT	
PJOBN		000566'	EXT	SRFB		001407'		TUBER2		001221'	EXT	
PJRST	324740	000000		SRFB1		001413'		TUBHC		000125'	EXT	
POPT4J		000204'		SRFDR		001420'		TUBICW		001617'	EXT	
PX.MEM		000004	SPD	SRFDR0		001422'		TUBIFC		001204'	EXT	
PXCT	256000	000000		SRFDR1		001426'		TUBIWC		001643'	EXT	
RD		001070'		SRFX		001357'		TUBKDB		001302'	EXT	
RDB		001075'		SRTDN1		001431'		TUBS		001327'	EXT	
RDERR		001133'		SRTDON		001430'		TUBSB		001240'	EXT	
RDERR2		001153'		STOP1		000455'	EXT	TUYTMN		000000	EXT	
RDLOSE		001224'		SUBRG1		001274'		TUYTUN		001306'	EXT	
RDWON		001242'		SUBRG2		001326'		U		000005	INT	
READY	000002	000000	SPD	SUBRG3		001304'		UGET0		000306'		
RECDER		001236'		SUBRGO		001273'		UGET1		000314'		
RELCTL		000563'		SYDCOM		000274'	EXT	UGET2		000321'		
REWFLG		000165'		SYDNM4		000263'	EXT	UNIT		006000	SPD	
RIP	000020	000000	SPD	SYDTMX		000245'	INT	UNITYP		001332'	EXT	
RSBO		001252'		T1		000006	INT	W		000012	INT	
RWDON1		001041'		T2		000007	INT	WAIT1		000517'	EXT	
RWDON2		001041'		T3		000010	INT	WP	000010	000000	SPD	
RWDON3		001030'		T4		000011	INT	WPERR		000547'		
RWDON4		001050'		TAPEIN		020000	SPD	WRERR		001156'		
RWERR		001127'		TIBTBL		000000	EXT	WRERR1		001160'		
S		000000	INT	TIMOUT	020000	000000	SPD	WRERR2		001177'		
S$ENTR	777777	777775	SIN	TKBCUN		001303'	EXT	WRERR3		001206'		
S$EVEN		000006	SIN	TKBIUN		000672'	EXT	WRLOSE		001225'		
S$HALT	777777	777777	SIN	TMX0CB		000650'	EXT	

F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

ANYERR	    75#	  1592
BDIO	   376#	  1035
BITTBL	    23%
BUFKRN	   358	   384	   402#	   405
CCWADR	   105#
CCWCNT	   104#
CCWJMP	   103#	  1397
CHKCUN	   837	   844#
CHKOF1	   889	   893#
CHKOFL	   869	   888#
CHKRW1	   877	   883#
CHKRW3	   864	   871	   874	   882	   884#
CHKRW4	   861#	   885
CHKSSC	   838	   860#
CMD	   114#
CNTRLC	   631
CNTWDS	  1039	  1044	  1052#
CPOPJ	    32%	   549	   577	   578	   579	   580	   581	   582
CPOPJ1	    32%	   288	   447	   448
CTLAVL	    94#
D	  1340
DATASZ	    64#
DBYT	   147#
DCL	   152#
DDI	   142#
DDINT	   146#
DDIO	   324	   352#
DDO	   141#
DDXZ	   145#
DECDI2	   358#	   363
DENS	   126#
DENTBL	  1224	  1289#
DEVABC	   713	  1034
DEVBWC	  1045	  1048
DEVCLS	   686	  1082	  1127	  1327	  1330
DEVCNT	    26%	   604	   620	   696	   952	   998	  1008	  1028	  1080	  1125	  1325	  1329	  1334	  1335
	  1355	  1367	  1368
DEVDIO	    27%	   353	   381	   386	   687
DEVDWC	    26%	   492	   695	  1040
DEVER1	    27%	   293	  1190
DEVFNJ	    26%	   201	   319	   325	   334	   572	   608	   639	   708	   853	   880	   901	  1086	  1131
	  1142	  1159	  1164	  1204
DEVIOS	   203	   236	   246	   273	   286	   508	   573	   622	   625	   721	   796	   847	   866	   908
	  1188	  1533
DEVMD1	    27%	   202	   571	  1216
DEVNAM	   435	   442
DEVSTS	   204
DEVUDB	    26%	   173	   227	   277	   484	   609	   621	   697	   787	  1153	  1324
DGF	   158#
DGTRD	   156#
DHNG	   150#
DIE	    13	    13%	    14	   383	   413	  1332	  1354	  1512	  1567
DIN	   154#
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

DINI	   149#
DMT	   157#
DN1600	   130#	  1291
DN200	   127#
DN556	   128#
DN6250	   131#
DN800	   129#	  1289	  1290
DOU	   153#
DPL	   402	   409#
DR	   360	   490	   692	  1006	  1017	  1022	  1338	  1406
DRL	   151#
DS1600	    45#	   182	   761
DS800	    46#	   182	   761
DSKPIF	    34%	   272	  1209	  1233
DSKPIN	    34%	   285	  1231
DSPSIZ	   145	   159#
DVSIZ	   148#
DZAP	   155#
EOF	    76#	   937	   942	   946	   964	   995	  1001	  1054
EOT	    89#	   518	   937
EPT	  1494%	  1524	  1536
EPTEBR	  1494%	  1536
ERGO	  1061#	  1087	  1132
ERGO1	  1064#	  1076	  1113	  1118
ERRMSK	    82#	   977	   984	  1077	  1088	  1114	  1119	  1133
EVNPAR	   109#	  1220
F	   173	   201	   202	   203	   204	   223	   227	   236	   246	   273	   277	   286	   293	   319
	   325	   334	   353	   381	   386	   484	   492	   508	   571	   572	   573	   604	   608	   609
	   620	   621	   622	   625	   639	   686	   687	   695	   696	   697	   708	   713	   721	   787
	   796	   846	   847	   853	   865	   866	   880	   901	   908	   952	   998	  1008	  1028	  1034
	  1040	  1045	  1048	  1080	  1082	  1086	  1125	  1127	  1131	  1142	  1153	  1159	  1164	  1188
	  1190	  1204	  1216	  1324	  1325	  1327	  1329	  1330	  1334	  1335	  1355	  1367	  1368	  1533
F.BSR	   120#	   580	   584
F.EG	   118#	   582
F.REWI	   115#	   577	  1207
F.RF	   124#	   586	  1548
F.RO	   116#	   581	  1206
F.SKR	   119#	   579	   583
F.WF	   125#	   587
F.WTM	   117#	   578
F3TEND	  1613#
F3TLIT	  1602#
F3TRWC	   334#
F3TSER	    13	    14#	    17
FFUERR	   480#	   491
FFUGF2	   479	   483#
FFUGF3	   484#
FFUS1	   505#	   509
FFUS2	   504	   506	   511#
FFUSTO	   493#
FHGSTP	   245	   507	   792	   799	  1263#
FREBUF	   714	  1007	  1026	  1034#
FSTHNG	   911	  1189	  1253#
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

FT1CM2	   241	   597	   604#	   651	   655	   661	   669	  1075	  1112	  1117
FT1CM3	   608#
FT1CMD	   538	   539	   541	   542	   543	   545	   592#
FT1TBL	   576#	   611	  1205
FT9TRK	   554	   568#
FTAPE	   157	   547#
FTC	   320	   585#
FTDVF2	   428	   432#	   437
FTDVF5	   436	   439#
FTDVF7	   430	   441#
FTLEO1	   653#	   664
FTLEOT	   542	   649#
FTOUT	   565	   573#
FTP2	   551#
FTP6	   557#
FTPTBL	   538#	   559	   560
FTSKB2	   583	   584	   618#
FTSKB3	   632	   638#
FTSKB4	   628#	   637
FTSKBL	   619#	   640
FXDSM1	   911#
GETCTL	   240	   511	   595	   638	   649	   653	   659	   667	   690	   729#	   757
GETST	   179	   299	   512	   703	   758	   848	   867	  1053	  1244#
GINST	   426#	   426	   427	   443#	   443	   444	   477#	   477	   478	   480#	   480	   481	   493#	   493
	   494	   498#	   498	   499	   499#	   500	   500#	   501	   520#	   520	   521
HASCTL	    49#	   291	   736	   905
HNGSTP	    33%	  1270
HNGTAP	    50#	   243	   247	   797
I.BF	   584#	   925#
I.BSR	   233	   580#	   650	   668	   921#	  1074	  1111
I.EG	   582#	   923#	  1116
I.REWI	   335	   577#	   600	   902	   918#
I.RF	   586#	   701	   926#	   993	  1068	  1085	  1140	  1158
I.RO	   336	   581#	   601	   903	   922#
I.SF	   583#	   654	   924#
I.SKR	   579#	   660	   920#
I.WF	   587#	   706	   927#	  1130	  1141	  1163
I.WTM	   226	   231	   578#	   919#
INTERR	   883	   931	   956#
INTREQ	    93#
IO	   683	   684	   702
IOACT	   274	   907	  1184
IOBEG	   693
IOBKTL	   990	  1179
IOBOT	   878	   950	  1178	  1179
IOC	  1008#	  1025
IOC0	  1010#	  1029
IOC1	  1012	  1014#
IODEND	   235	   663	   665	   943	   997	  1179
IODERR	   243	   956	  1146	  1148	  1179
IODTER	   243	  1147	  1179
IOEND	   943	   997
IOIMPM	   229	   564	   720	  1179	  1532
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

IOLEND	    51#	   657	   663	   879	   940	   947	   948	   951	  1002	  1185
IOPAR	  1219
IOTEND	   879	   940	   947	   948	  1002	  1186	  1187
IOW	   899	  1014
J	   295	   296	   297	   357	   364	   380	   387	   446	   610	   633	   636	   731	   732	   734
	   735	   741	   742	   743	   744	   836	   844	   852	   860	   863	  1183
JBTABT	    24%	   734	   743
JBTIOA	    33%	   323	   710
JBTLIC	    33%	   446
JBTSTS	   630%	   630
JOB	   633%	   633
LENERR	    79#	    82	   930	   934	   982	   984	  1088	  1133
LI.PIF	  1546
LI.PIN	  1560
LI.REQ	   340
LICSPY	   445
LICSYS	   445
LISTSN	     3	     6
LOADPT	    42#	   517
LODPNT	    87#	   516	   876	   933	   949
M	   226	   231	   233	   425	   426	   443	   449	   477	   480	   493	   498	   499	   500	   520
	   548	   549	   553	   555	   557	   558	   559	   560	   568	   570	   592	   593	   596	   598
	   599	   600	   601	   608	   611	   639	   650	   654	   660	   668	   853	   856	   880	   901
	   902	   903	   993	  1068	  1074	  1111	  1116	  1130	  1131	  1140	  1141	  1142	  1158	  1159
	  1163	  1164	  1266	  1274	  1322	  1333	  1335	  1336	  1348	  1361	  1366	  1368	  1373	  1404
	  1408	  1416	  1423	  1427	  1431	  1432
MAGBUF	   970	  1550	  1555	  1558	  1585	  1599#
MAGCHN	    36%	   303	   340	   833	  1212	  1514
MAGDDS	    23%	   148
MAGDSP	    54	   144#
MAGIN1	   177#	   185
MAGINI	    54	   149	   172#
MAGINT	    54	   821#	   829
MAGSAV	    24%	   835
MSKCTD	    56#	  1336	  1400	  1432
MSKCTU	    58#
MSKMMD	    60#
MSKMMU	    62#
MTAICZ	   413#
MTAIFC	   918	  1567#	  1575	  1577
MTALNZ	  1354#
MTANIB	   383#
MTANIS	  1332#
MTAVAL	    24%	   740
MTAXIP	  1512#
MTDON1	   904	   907#
MTDONE	   881	   899#	   932	   953	   958	  1009	  1013	  1030
MTICE0	   944	   949#
MTPERR	   538	   539	   540	   543	   544	   556	   564#	   569
MTREQ	    24%	   729	   739
MTUDBL	    23%	   444
MTWAIT	    24%	   730
NODIE	    13%
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

OD.BF	   925	   933#
OD.BSR	   921	   939#
OD.EG	   923	   945#
OD.RF	   926	   964#	  1161
OD.RO	   922	   930#
OD.SF	   924	   934#
OD.SKR	   920	   939#
OD.WF	   927	   976#	  1166
OD.WTM	   919	   945#
ODD	   856	   917#
OLDCDN	  1527	  1536#
OLDCTL	    66#	   302	   305	   822	   823	   825	  1227	  1230	  1237	  1243	  1489
OLDMOP	  1230	  1505#
OLDOUT	  1520	  1534	  1552	  1560#
OLDRW	  1522#	  1579	  1580
OLDRW1	  1526#	  1531
OLDSTS	  1244	  1582#
OLDWRT	  1549	  1554#
ONLINE	    84#	   180	   759	   890	   893
OUTPB	   223
OVRRUN	    81#	    82	   984	  1592
P	    14	   146	   155	   172	   178	   179	   184	   186	   187	   200	   205	   224	   225	   228
	   230	   232	   234	   237	   239	   240	   241	   242	   244	   245	   276	   283	   284	   292
	   298	   299	   301	   306	   307	   324	   326	   338	   341	   352	   356	   357	   358	   364
	   365	   366	   367	   376	   377	   378	   379	   380	   383	   384	   387	   388	   389	   390
	   391	   392	   402	   406	   413	   417	   481	   483	   494	   501	   505	   507	   511	   512
	   547	   551	   574	   595	   596	   597	   598	   602	   603	   612	   618	   623	   624	   627
	   628	   634	   635	   638	   649	   651	   652	   653	   655	   656	   658	   659	   661	   662
	   666	   667	   685	   689	   690	   703	   711	   714	   715	   717	   718	   730	   731	   735
	   737	   741	   744	   745	   754	   755	   756	   757	   758	   763	   764	   765	   766	   767
	   768	   786	   790	   792	   799	   801	   802	   804	   805	   806	   807	   808	   809	   837
	   838	   839	   845	   848	   851	   857	   861	   867	   869	   881	   883	   884	   886	   892
	   895	   900	   906	   911	   912	   957	   966	   974	  1007	  1010	  1011	  1015	  1018	  1019
	  1024	  1026	  1027	  1039	  1041	  1044	  1049	  1053	  1057	  1062	  1063	  1065	  1075	  1083
	  1112	  1117	  1128	  1149	  1156	  1180	  1181	  1182	  1189	  1191	  1192	  1193	  1194	  1203
	  1230	  1232	  1263	  1264	  1265	  1266	  1267	  1268	  1269	  1270	  1271	  1272	  1273	  1274
	  1275	  1276	  1277	  1278	  1320	  1321	  1322	  1323	  1332	  1344	  1350	  1354	  1356	  1360
	  1371	  1372	  1373	  1374	  1375	  1376	  1419	  1505	  1506	  1507	  1508	  1512	  1561	  1562
	  1563	  1564	  1565	  1567	  1591	  1593
P1	   448
P2	   755	   765	  1212	  1213	  1215	  1218	  1220	  1225	  1320	  1375	  1396	  1397	  1398	  1417
	  1418	  1425	  1433	  1516	  1542	  1547
P3	  1182	  1191
PAG	  1536
PAGWAK	    34%	   416
PARERR	    78#	    82	   930	   934	  1145
PG	   356	   365	   379	   388	   410	  1264	  1276	  1323	  1337	  1338	  1340	  1372
PGE.A	  1529
PGE.W	  1529
PGYDIO	    34%	   411	   414
PIA	    98#	   133#
PIOMOD	    32%	   359	   489	   691	  1005	  1016	  1021	  1337	  1405
PJOBN	    33%	   322	   629	   709	   732	   742
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

POPT4J	   355	   366#
PX.MEM	   426	   443	   477	   480	   493	   498	   499	   500	   520
RD	   996	   999	  1021#
RDB	  1023	  1026#
RDERR	  1074#	  1092
RDERR2	  1090#
RDLOSE	  1078	  1091	  1140#
RDWON	  1089	  1158#
READY	    88#	   850	   873
RECDER	   957	  1149	  1153#
RELCTL	   292	   521	   602	   715	   722	   733	   739#	   763	   906
REWFLG	   339	   343#	   827	   830
RIP	    85#
RSBO	  1178#	  1203	  1371
RWDON1	   978	   993#
RWDON2	   992#	  1151
RWDON3	   965	   977#
RWDON4	   994	  1001#
RWERR	   983	   985	  1067#
S	   203	   229	   235	   236	   243	   246	   247	   273	   274	   286	   291	   508	   564	   573
	   622	   625	   626	   657	   663	   665	   683	   684	   693	   702	   720	   721	   736	   796
	   797	   847	   866	   878	   879	   899	   905	   907	   908	   935	   936	   938	   940	   943
	   947	   948	   950	   951	   956	   990	   997	  1002	  1014	  1101	  1146	  1147	  1148	  1178
	  1179	  1184	  1185	  1186	  1187	  1188	  1219	  1221	  1532	  1533
S$ENTR	    13	    19	   384	   414	  1333	  1355	  1513	  1568	  1575	  1577
S$EVEN	   383	   413	  1332	  1354	  1512	  1567
S$HALT	    13	   383	   413	  1332	  1354	  1512	  1567	  1575	  1577
S$INFO	   383	   413	  1332	  1354	  1512	  1567
S$JOB	   383	   384	   413	   414	  1332	  1333	  1354	  1355	  1512	  1513	  1567	  1568
S$NAME	    17#
S$NONA	    16	    19	   384	   414	  1333	  1355	  1513	  1568	  1576	  1578
S$PATC	   383	   413	  1332	  1354	  1512	  1567
S$TEMP	    13#	    13	   383#	   383	   413#	   413	  1332#	  1332	  1354#	  1354	  1512#	  1512	  1567#	  1567
	  1575#	  1575	  1577#	  1577
S$XCT	    19	   384	   414	  1333	  1355	  1513	  1568	  1575	  1576	  1577	  1578
SAVAIL	   239	   551	   628	   685	   786#	   806
SAVAL2	   790#	   793
SAVAL4	   791	   796#	   800
SAVAL8	   798	   801#
SBUFCT	  1027	  1044#
SDCIO2	   322#	   716
SDCIO3	   324#
SDCIO4	   321	   325#
SDCIOA	   306	   319#	   909
SDMPCT	  1024	  1039#
SETAD1	  1399#	  1433
SETAD2	  1407	  1411	  1423#
SETADO	  1418#	  1428
SETADR	  1344	  1350	  1360	  1394#
SETHNG	    32%	   283	  1254
SETIOD	    32%	   900	  1018
SFDONE	    48#	   626	   935	   936	   938	   951
SGTDE0	   763#	   769
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

SGTDE1	   760	   768#
SGTDEV	   505	   754#	   790
SRFB	  1341	  1348#
SRFB1	  1349	  1353#
SRFDR	  1339	  1360#
SRFDR0	  1351	  1362#
SRFDR1	  1361	  1367#
SRFX	   711	  1010	  1083	  1128	  1320#
SRTDN1	  1357	  1372#
SRTDON	  1345	  1371#
STOP1	   634%	   634
SUBRG1	   717	   954	  1011	  1062	  1204#
SUBRG2	  1208	  1233#
SUBRG3	  1212#	  1235
SUBRGO	   613	   623	  1203#
SYDCOM	    33%	   449
SYDNM4	    33%	   433	   438	   440
SYDTMX	    54	   425#
T1	   148	   180	   181	   182	   183	   279	   280	   281	   282	   300	   319	   320	   322	   323
	   334	   335	   336	   354	   362	   376	   382	   391	   404	   409	   410	   411	   412	   414
	   415	   426	   428	   435	   441	   442	   443	   444	   485	   489	   490	   492	   493	   497
	   498	   499	   500	   504	   514	   516	   518	   552	   559	   560	   561	   570	   571	   611
	   612	   629	   630	   631	   686	   687	   688	   691	   692	   701	   704	   706	   708	   733
	   734	   759	   786	   801	   849	   854	   855	   860	   861	   862	   868	   884	   885	   971
	   972	   973	   987	   988	  1040	  1046	  1054	  1055	  1056	  1061	  1064	  1072	  1073	  1076
	  1079	  1080	  1081	  1082	  1085	  1086	  1087	  1095	  1096	  1113	  1118	  1124	  1125	  1126
	  1127	  1132	  1180	  1193	  1204	  1205	  1206	  1207	  1213	  1267	  1273	  1325	  1326	  1327
	  1328	  1329	  1330	  1331	  1353	  1362	  1363	  1364	  1366	  1367	  1394	  1399	  1401	  1427
	  1428	  1430	  1431	  1505	  1516	  1517	  1519	  1526	  1528	  1537	  1538	  1539	  1540	  1550
	  1551	  1558	  1559	  1564	  1569	  1570	  1571	  1572	  1573	  1574	  1582	  1583	  1589	  1592
T2	   175	   177	   178	   184	   185	   278	   359	   360	   377	   390	   427	   432	   437	   439
	   445	   446	   497	   513	   515	   517	   519	   520	   619	   620	   709	   710	   756	   764
	   870	   871	   888	   889	   966	   967	   968	   969	   970	   972	   973	   974	   987	  1005
	  1006	  1016	  1017	  1021	  1022	  1045	  1046	  1047	  1048	  1056	  1106	  1107	  1108	  1109
	  1110	  1181	  1192	  1210	  1211	  1214	  1215	  1216	  1217	  1221	  1222	  1223	  1224	  1225
	  1226	  1268	  1272	  1399	  1400	  1402	  1403	  1506	  1519	  1528	  1529	  1530	  1540	  1554
	  1555	  1556	  1557	  1563	  1583	  1584	  1585	  1586
T3	   174	   175	   298	   301	   477	   478	   486	   754	   761	   762	   766	   804	   808	   849
	   850	   868	   873	   876	   890	   893	   930	   933	   934	   937	   942	   946	   949	   964
	   977	   982	   984	   995	  1001	  1077	  1088	  1101	  1102	  1103	  1104	  1105	  1107	  1108
	  1114	  1119	  1133	  1145	  1155	  1269	  1271	  1405	  1406	  1408	  1409	  1410	  1412	  1413
	  1414	  1415	  1416	  1423	  1424	  1426	  1507	  1524	  1530	  1541	  1556	  1557	  1562	  1587
	  1588	  1589
T4	   352	   353	   354	   362	   363	   366	   378	   381	   382	   385	   386	   389	   403	   404
	   805	   807	   872	   874	  1321	  1331	  1333	  1374	  1401	  1403	  1404	  1414	  1417	  1424
	  1425	  1508	  1522	  1523	  1526	  1531	  1547	  1548	  1561
TAPEIN	    43#	   519
TIBTBL	    23%
TIMOUT	    80#	    82	  1145
TKBCUN	    25%	   296	   297	   844	   852	   863	  1211
TKBIUN	    25%	   175	   427	   860
TMX0CB	    23%	   427	   836
TMXCL6	   228	   232	   234	   239#
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

TMXCL7	   240#	   249
TMXCL8	   245#	   248
TMXCLS	   152	   223#
TMXGRD	   156	   804#
TMXHC2	   275	   285#
TMXHC3	   284#	   308
TMXHCT	   283#
TMXHN8	   280	   290#
TMXHNG	   150	   271#
TMXRED	   142	   154	   683#
TMXREL	   151	   200#
TMXRW1	   712	   717#
TMXUGF	   158	   477#
TMXWRT	   141	   153	   684#
TRK9	    44#
TU0CB	    23%	   429
TUBCLS	    35%	  1081	  1126	  1328
TUBCNT	    35%	  1079	  1124	  1326
TUBCOM	    30%	  1396
TUBDDB	    28%	   434	   441	   846	   865
TUBEC	    29%	  1154
TUBER1	    35%	   294	   698	   854	  1061	  1064	  1150	  1160	  1165
TUBER2	    35%	  1073	  1090	  1096	  1135
TUBHC	    28%	   290
TUBICW	    30%	   967	  1226	  1398	  1522	  1537
TUBIFC	    35%	  1110	  1121
TUBIWC	    28%	   971	   988	  1106	  1395	  1409	  1413	  1415	  1426	  1541	  1551	  1559
TUBKDB	    28%	   174	   278	   295	   610	   636	  1183	  1210
TUBS	    28%	   870	   872	   875	   888	   891	   894	  1234
TUBSB	    29%	   300	  1155
TUYTMN	    28%
TUYTUN	    28%	  1214
U	   172	   173	   174	   177	   183	   186	   227	   276	   277	   278	   279	   282	   284	   290
	   294	   295	   296	   300	   429	   432	   434	   435	   439	   441	   484	   485	   552	   609
	   610	   621	   636	   688	   697	   698	   762	   787	   844	   846	   854	   862	   863	   865
	   870	   872	   875	   888	   891	   894	   967	   971	   988	  1061	  1064	  1073	  1079	  1081
	  1090	  1096	  1106	  1110	  1121	  1124	  1126	  1135	  1150	  1153	  1154	  1155	  1160	  1165
	  1183	  1210	  1211	  1226	  1234	  1253	  1263	  1277	  1324	  1326	  1328	  1395	  1396	  1398
	  1409	  1413	  1415	  1426	  1522	  1537	  1541	  1551	  1559
UGET0	   486	   489#
UGET1	   486	   497#
UGET2	   486	   504#
UNIT	   113#
UNITYP	    28%	   183	   279	   282	   485	   552	   688	   762	  1253
W	  1265	  1275
WAIT1	    32%	   200	   225	   242	   483	   547	   624	   652	   656	   662	   689
WP	    86#	   514	   704
WPERR	   705	   720#
WRERR	  1069	  1095#
WRERR1	  1101#	  1137
WRERR2	  1116#	  1122
WRERR3	  1124#
WRLOSE	  1115	  1120	  1136	  1141#
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Symbol cross reference

WRPROT	    41#	   515
WRWON	  1134	  1163#
WSCHED	   635%	   635
XFRBYT	   112#	  1218
XFRCDM	   111#
XFRMOD	   110#	  1542
XTAB	  1517	  1569#
ZZ	   426#	   426	   443#	   443	   477#	   477	   480#	   480	   493#	   493	   498#	   498	   499#	   499
	   500#	   500	   520#	   520
ZZ1	   426#	   426	   443#	   443	   477#	   477	   480#	   480	   493#	   493	   498#	   498	   499#	   499
	   500#	   500	   520#	   520
%MTA	   960	   969	  1539
%MTA.N	  1523	  1524
%MTE	   960
%MTE.N	  1523
F3TSER TAPE SERVICE FOR TAPES FOUND ON F3 PROCESSORS	MACRO 12.5-46.0 15:02 13-JAN-88
F3TSER.MAC	25-NOV-87 15:34		Macro/Opdef cross reference

CLRPTA	  1536
DSKOFF	   267#	   272	  1209	  1233
DSKON	   268#	   285	  1231
MTOP	   100#
MTRS	    69#
MTSO	   137#
MTSZ	   135#
OMTOP	  1496#	  1519	  1543	  1545
OMTRD	  1498#	  1551
OMTRS	  1499#	  1587
OMTWR	  1497#	  1559
PJRST	   416	   521	   613	   716	   722	   909	  1254
PXCT	   426	   443	   477	   480	   493	   498	   499	   500	   520
PXGEN	   426	   443	   477	   480	   493	   498	   499	   500	   520
STOPCD	    12	   383	   413	  1332	  1354	  1512	  1567	  1575	  1577
TPCNSO	   826	   831	  1502#	  1509	  1590
TPCONI	  1500#
TPCONO	   303	   833	  1501#	  1514
TPDATI	  1503#	  1582
UHRRZ	   477
UMOVE	   426
UMOVEM	   443	   493	   520
WRPI	   272	   285	   340	  1209	  1231	  1233	  1546	  1560
XCTBU	   477
XCTFU	   426
XCTTU	   443	   480	   493	   498	   499	   500	   520
$END	  1602ER,T
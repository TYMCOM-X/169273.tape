IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE IOCSS - IO COMMON SUBROUTINES
     9
    10					STOPCD(,ENTRY,IOCSS)^
    11					ENTRY	IOCSS		;For library searches
    12	000000'	260040	000000*	IOCSS::PUSHJ	P,DIE		;**** Default stopcode for "IOCSS" ****
    13	000001'	515743	636300		SIXBIT	/IOCSS/  	;Title of module
    14	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "IOCSS+nnn(nnnnnn)"
    15			000000'	S$NAME==IOCSS			;For STOPCDs with no arguments
    16					SALL>
    17				^
    18
    19				;THIS MODULE CONTAINS MOST OF THE CODE FOR THE STANDARD SYSTEM I/O UUOS.
    20
    21				;GENERAL EXTERNALS
    22
    23				EXTERNAL UPTACP,UPTHCU,UPTJDA,%UPT
    24				EXTERNAL ABTUUO,ADRERR,ERRIDM,ERRIUC
    25				EXTERNAL PGYDIO,PGPDIO
    26				EXTERNAL PUUOAC,WAIT1,WSYNC
    27				EXTERNAL PJOBN,NWATRP,PDNMUP
    28				EXTERNAL JOBFF,JOBSA,JBTABT,JBTLIC,JOB,JOBREL
    29				EXTERNAL DEVFLO,DEVHNG,DEVPOS,DIOMAX
    30				EXTERNAL CPOPJ,TSTKTJ
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 2
IOCSS.MAC	 9-OCT-87 18:01		S.MAC - with system parameter file for P035/D, January 1988

    31				;TABLE OF MUUO DISPATCH ADDRESSES
    32				;IN FORMAT:
    33				;	XWD 40,41
    34				;	XWD 42,43
    35				;	.
    36				;	XWD 76,77
    37				EXTERN TTYUUO,AUXTUU,FRMOPD,UUOMNR,UCALL,UCALLI
    38
    39				;5 UUOS FOR EACH INSTALLATION TO DEFINE
    40				;OPCODES 42-46
    41
    42	000003'	000000*	000407'	UUOTAB::XWD UCALL,UINIT		;(40,41)CALL,INIT
    43	000004'	000000*	000023'		XWD AUXTUU,CHANIO	;(42,43)FIVE UUOS FOR EACH INSTALLATION
    44	000005'	000000*	000000*		XWD FRMOPD,UUOMNR	;(44,45)FRMOP,RESERVED FOR TYMSHARE
    45	000006'	000000*	000000*		XWD UUOMNR,UCALLI	;(46,47),CALLI
    46	000007'	000405'	000000*		XWD UOPEN,TTYUUO	;(50,51)OPEN, TTCALL
    47	000010'	000000*	000005*		XWD UUOMNR,UUOMNR	;(52,53)
    48	000011'	000000*	001201'		XWD UUOMNR,URENAM	;(54,55),RENAME
    49			000055	XP IOUUO,55			;LOWEST IO M(RENAME)
    50	000012'	003445'	003456'		XWD TIN,TOUT		;(56,57)IN,OUT
    51	000013'	004137'	003410'		XWD SETIOS,USTATO	;(60,61)SETSTS,STATO
    52	000014'	003414'	003417'		XWD USTATS,USTATZ	;(62,63)GETSTS,STATZ
    53	000015'	000350'	000333'		XWD UINBF,UOUTBF	;(64,65)INBUF,OUTBUF
    54	000016'	001520'	002256'		XWD IN,UOUT		;(66,67)INPUT,OUTPUT
    55	000017'	000127'	003334'		XWD CLOSE0,RELEAS	;(70,71)CLOSE,RELEASE
    56			000072	XP LNGUUO,72			;LOWEST LONG DISPATCH TABLE MUUO
    57	000020'	001213'	001206'		XWD UMTAPE,UDGF		;(72,73)MTAPE,GETF
    58	000021'	001345'	001417'		XWD UDSI,UDSO		;(74,75)SETI,SETO
    59	000022'	000557'	000534'		XWD UDLK,UDEN		;(76,77)LOOKUP,ENTER
    60
    61				;UUOS 42, 43, 44, 45, AND 46 ARE FOR CUSTOMERS TO DEFINE AS THEY PLEASE
    62				;UUOS 40, 41 AND 47 THROUGH 77 ARE DEFINED BY DIGITAL
    63				;UUOS 51,52,53 AND 54 ARE RESERVED FOR EXPANSION BY DIGITAL
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 3
IOCSS.MAC	 9-OCT-87 18:01		S.MAC - with system parameter file for P035/D, January 1988

    64				;CHANIO CODE. AC HAS FUNCTION,,CHANNEL NUMBER
    65				;ADDRESS IS NORMAL UUO ADDRESS
    66
    67	000023'	256200	004205'	CHANIO:	UMOVE T1,(W)	;GET FUNCTION AND CHANNEL
    68	000024'	550500	000006		HRRZ W,T1
    69	000025'	306500	777777		CAIN	W,-1	;
    70	000026'	254000	000031'		JRST	.+3
    71	000027'	303500	000000*		CAILE W,MAXCHN
    72	000030'	254000	000000*		JRST ERRIUC
    73	000031'	557000	000006		HLRZS T1
    74	000032'	301300	000050		CAIL T1,CHOTBL*2
    75	000033'	254000	000050'		JRST	CHNIER
    76	000034'	241300	777777		ROT T1,-1
    77	000035'	603300	400000		TLNE T1,(1B0)
    78	000036'	334306	000053'		SKIPA T1,CHNOTB(T1)
    79	000037'	204306	000053'		MOVS T1,CHNOTB(T1)	;HERE IS THE DISPATCH
    80	000040'	551306	000000		HRRZI	T1,(T1)		;
    81	000041'	322300	000050'		JUMPE	T1,CHNIER
    82	000042'	302300	000400'		CAIE	T1,COPEN
    83	000043'	306300	000362'		CAIN	T1,NXTCHN
    84	000044'	334000	000000		SKIPA
    85	000045'	302500	777777		CAIE	W,-1
    86	000046'	254006	000000		JRST (T1)	;AND GO
    87	000047'	254000	000030*		JRST	ERRIUC
    88
    89	000050'	306500	777777	CHNIER:	CAIN W,-1
    90	000051'	254000	000047*		JRST ERRIUC
    91	000052'	263040	000000		POPJ P,		;JUST IGNORE EXTRA FUNCTIONS
    92
    93
    94	000053'	003334'	000127'	CHNOTB:	XWD RELEAS,CLOSE0	;0 RELEASE 1 CLOSE
    95	000054'	002256'	001520'		UOUT,,IN	;2 OUTPUT 3 INPUT
    96	000055'	000557'	000534'		UDLK,,UDEN	;4 LOOKUP 5 ENTER
    97	000056'	001345'	001417'		UDSI,,UDSO	;6 USETI 7 USETO
    98	000057'	001206'	001201'		UDGF,,URENAM	;10 UGETF 11 RENAME
    99	000060'	001213'	000400'		UMTAPE,,COPEN	;12 MTAPE 13 OPEN
   100	000061'	003445'	003456'		TIN,,TOUT	;14 IN 15 OUT
   101	000062'	004137'	003414'		SETIOS,,USTATS	;16 SETSTS 17 GETSTS
   102	000063'	003417'	003410'		USTATZ,,USTATO	;20 STATS 21 STATO
   103	000064'	000350'	000333'		UINBF,,UOUTBF	;22 INBUF 23 OUTBUF
   104	000065'	000115'	000122'		UUOSK1,,WAIT	;24 SEEK 25 WAIT
   105	000066'	000661'	001344'		MOVBF2,,FWUSI	;26 MOVBUF 27 FULL WORD USETI
   106	000067'	001416'	001366'		FWUSO,,PGUSI	;30 FULL WORD USETO 31 PAGE USETI
   107	000070'	001402'	000110'		PGUSO,,UFDRD	;32 PAGE USETO 33 READ UFD
   108	000071'	001221'	000666'		MGNBIT,,VMAPUU	;34 MAGNUM BIT 35 VMAP
   109	000072'	000674'	000702'		FDELUU,,FEXCHU	;36 FDEL 37 FEXCHANGE
   110	000073'	000676'	000533'		FCREAU,,USDEN	;40 FCREATE 41 SIMULTANEOUS UPDATE
   111	000074'	000706'	000670'		FVLRBU,,VSMAPU	;42 VALIDATE FILE'S RIBS 43 SUPER MAP
   112	000075'	000704'	000700'		FFIFPU,,FTRNCU	;44 FFIFP AND FRIENDS 45 FILE TRUNC
   113	000076'	000362'	000672'		NXTCHN,,VMOVPG	;46 Find next free channel 47 Move VP to file
   114
   115			000024	CHOTBL==.-CHNOTB	;LENGTH
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 4
IOCSS.MAC	 9-OCT-87 18:01		S.MAC - with system parameter file for P035/D, January 1988

   116	000077'			CHNCHK::
   117	000077'	317500	000000*	CHNCK1::CAMG W,%UPT+UPTHCU	;IS THIS CHANNEL GREATER THE
   118								; HIGHEST ASSIGNED?
   119	000100'	336212	000000*		SKIPN F,%UPT+UPTJDA(W)	;NO.  SEE IF REALLY ASSIGNED.
   120	000101'	263040	000000		POPJ P,			;NO CHANNEL ASSIGNED.
   121	000102'	200004	000002		MOVE S,DEVIOS(F)	;GET DATA BLOCK STATUS WORD.
   122	000103'	350001	000000		AOS (P)
   123	000104'	550444	000003	CHNCK2:	HRRZ T4,DEVSER(F)	;SETUP TO SERVICE DISPATCH.
   124	000105'	317311	000000		CAMG T1,DDXZ(T4)	;SEE IF IN DISPATCH TABLE
   125	000106'	350001	000000		AOS (P)			;YES.  DOUBLE SKIP RETURN.
   126	000107'	263040	000000		POPJ P,			;SINGLE OR DOUBLE SKIP RETURN
   127
   128
   129				;ENTER HERE FOR READ UFD CHANIO
   130
   131	000110'	201300	000024	UFDRD:	MOVEI T1,DUFD
   132	000111'	260040	000077'		PUSHJ P,CHNCHK
   133	000112'	254000	000051*		 JRST ERRIUC
   134	000113'	263040	000000		 POPJ P,
   135	000114'	254011	000024		JRST DUFD(T4)
   136
   137				;SEEK UUO ENTER HERE
   138
   139	000115'	201300	000025	UUOSK1::MOVEI T1,DSEK		;SEEK NUMBER
   140	000116'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   141	000117'	254000	000112*		 JRST ERRIUC		;ERROR, NO CHANNEL.
   142	000120'	263040	000000		POPJ P,			;NOT THERE, GOOD RETURN
   143	000121'	254011	000025		JRST DSEK(T4)		;T4 SET BY CHNCHK, GO UUO
   144
   145
   146				;WAIT FOR IO TO BECOME INACTIVE ON CHANNEL AC
   147
   148	000122'	201300	000000	WAIT::	MOVEI T1,0
   149	000123'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   150	000124'	263040	000000		 POPJ P,		;RETURN IF NO CHANNEL.
   151	000125'	255000	000000		JFCL			;NO-OP IF SHORT DISPATCH TABLE.
   152	000126'	254000	000000*		JRST WAIT1		;WAIT TILL INACTIVE BEFORE
   153								; RETURNING TO USER.
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 5
IOCSS.MAC	 9-OCT-87 18:01		CLOSE UUO

   154				SUBTTL CLOSE UUO
   155				;FOR PURPOSES OF COMMENTING THIS SUBROUTINE THE
   156				;TERM 'BUFFER HEADER' SHALL REFER TO THE 3 WORD HEADER
   157				;WHICH IS USED BY THE USER PROGRAM AND THIS EXEC FOR
   158				;REFERING TO THE RING BUFFERS.
   159
   160				;THE CONTENTS OF THE 3 WORD HEADER (AS SET BY THE MONITOR
   161				;		ON EACH INPUT AND OUTPUT M).
   162				;		BIT 18-35=ADDRESS OF SECOND WORD OF THE
   163				;		CURRENT BUFFER IN RING WHICH USER IS REFERENCING
   164				;	WORD 2:	BYTE POINTER TO CURRENT ITEM.
   165				;	WORD 3:	POSITIVE J COUNT (NO. OF ITEMS LEFT ON
   166				;		INPUT, NO. OF FREE ITEMS TO GO ON OUTPUT).
   167
   168				;EACH BUFFER IN THE RING HAS FOLLOWING FORMAT (AS THE USER SEES IT)
   169
   170				;	WORD 1:	RESERVED FOR BLOCK NUMBER FOR FIXED ADDRESS DEVICES
   171				;	WORD 2:	BIT 0=USE BIT FOR THIS BUFFER
   172				;		BIT 1-17=NO. OF WORDS WHICH FOLLOW (LENGTH OF BUFFER)/
   173				;		BIT 18-35=ADDRESS OF SECOND WORD OF NEXT BUFFER IN RING
   174				;	WORD 3:	LH=LINK TO NEXT BLOCK (SET BY MONITOR FOR DECTAPE)
   175				;		RH=NO. OF WORDS OF DATA WHICH FOLLOW (USUALLY
   176				;		SET BY EXEC EXCEPT IF THE USER HAS SPECIFIED
   177				;		THAT HE WANTS TO COMPUTE WORD COUNT
   178				;		HIMSELF INSTEAD OF HAVING THE MONITOR DO IT
   179				;		USING THE BYTE POINTER IN THE 3 WORD HEADER).
   180
   181				;CALLING SEQUENCE
   182				;	CLOSE D,
   183				;	EXIT		ALWAYS RETURNS HERE
   184				; THIS ROUTINES PROCESSES THE CLOSE MUUO AND DETERMINES WHETHER THE
   185				;OUTPUT ROUTINE SHOULD BE CALLED IF OUTPUT WERE ACTIVE, CLEARS
   186				;THE INPUT BUFFER AREA IF INPUT WERE ACTIVE, AND CLEARS THE
   187				;J COUNTS OF BOTH INPUT AND OUTPUT HEADERS SERVING TO BOTH
   188				;TERMINATE THE USE OF THE DEVICE AND SET THE I/O ROUTINES TO
   189				;ACCEPT ANOTHER INPUT OR OUTPUT COMMAND IN A CLEAR STATE.
   190				;IN THE CASE OF OUTPUT DEVICES, THE CLOSE ROUTINE OF THE DEVICE HANDL-
   191				;ING ROUTINE IS CALLED IN CASE ANY SPECIAL HANDLING IS REQUIRED.
   192
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 6
IOCSS.MAC	 9-OCT-87 18:01		CLOSE UUO

   193				EXTERNAL PIOMOD,DEVECK
   194
   195	000127'	201300	000007	CLOSE0::MOVEI T1,DCL
   196	000130'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   197	000131'	263040	000000		POPJ P,			;NO OPERATION IF NO CHANNEL.
   198	000132'	263040	000000		POPJ P,			;NOT IN DISPATCH TABLE?
   199
   200				;***** NOTE *****  This code plays with the "previous context user"
   201				;***** NOTE *****  bit in the PC.  In order for this bit to be properly
   202				;***** NOTE *****  restored to it's original state, the 2-instruction
   203				;***** NOTE *****  pseudo-POPJ MUST be used to exit, since normal POPJ
   204				;***** NOTE *****  does not restore this flag from the PC on the stack.
   205				;***** NOTE *****  Buffered IO cannot be done from the monitor because
   206				;***** NOTE *****  previous context is set to user.
   207				;
   208				;***** NOTE *****  See also UXCTBU macro in S and DOXCT in CORE1
   209
   210	000133'	260040	000134'	CLOSE1::PUSHJ	P,.+1		;SAVE STATE OF "PREVIOUS CONTEXT USER"
   211	000134'	603200	014600		TLNE	F,INBFB+INPB+OUTBFB+OUTPB	;DOING BUFFERED IO?
   212	000135'	254120	004206'		 JRSTF	@[PC.UIO,,.+1]	;YES, SET PREVIOUS CONTEXT TO USER
   213	000136'	260040	001672'		PUSHJ P,WAITIO		;WAIT UNTIL DEVICE IS INACTIVE
   214	000137'	606540	000002		TRNN M,CLSIN		;SUPPRESS INPUT CLOSE?
   215	000140'	663200	002000		TLOE F,ICLOSB	;NO. INPUT ALREADY BEEN CLOSED?
   216	000141'	254000	000166'		 JRST UCLS2		;YES
   217	000142'	135300	000000*		LDB T1,PIOMOD		;NO
   218	000143'	305300	000015		CAIGE T1,SD		;DUMP MODE?
   219	000144'	254000	000152'		JRST UCLSBI		;NO. CLOSE BUFFERED INPUT.
   220	000145'	201300	000023	UCLS5:	MOVEI T1,DCLI
   221	000146'	260040	000104'		PUSHJ P,CHNCK2
   222	000147'	334000	000000		 SKIPA		;NOT IN DISPATCH TABLE
   223	000150'	260051	000023		PUSHJ P,DCLI(T4)	;YES. DISPATCH TO DEVICE DEP. ROUTINE
   224	000151'	254000	000166'		JRST UCLS2		;MUST NOT DESTROY M,F,W
   225	000152'	200304	000004	UCLSBI:	MOVE	T1,DEVMOD(F)
   226	000153'	550444	000003		HRRZ T4,DEVSER(F)	;RESTORE T4 AFTER DCLI
   227	000154'	603200	010400		TLNE F,INBFB+INPB	;WAS AN INPUT BUFFER SETUP?
   228	000155'	254000	000161'		JRST UCLS4		;YES
   229	000156'	603300	200000		TLNE	T1,DVDSK	;CLOSING A DISK FILE ?
   230	000157'	254000	000145'		JRST	UCLS5		;YES, DO DEVICE DEPENDENT CLOSE ANYWAY.
   231	000160'	254000	000166'		JRST	UCLS2		;NO, CLOSE NOT NECESSARY.
   232	000161'	201300	000023	UCLS4:	MOVEI T1,DCLI
   233	000162'	260040	000104'		PUSHJ P,CHNCK2
   234	000163'	334000	000000		 SKIPA
   235	000164'	260051	000023		PUSHJ P,DCLI(T4)	;YES, CLOSE INPUT
   236	000165'	260040	000302'		PUSHJ P,BFICLN
   237	000166'	200000	004207'	UCLS2:	MOVE S,[XWD IOEND,IODEND]
   238	000167'	413004	000002		ANDCAB S,DEVIOS(F)
   239	000170'	606540	000001		TRNN M,CLSOUT		;SUPPRESS OUTPUT CLOSE?
   240	000171'	663200	001000		TLOE F,OCLOSB	;NO. OUTPUT ALREADY CLOSED?
   241	000172'	254000	000261'		JRST UCLS3		;YES
   242	000173'	135300	000142*		LDB T1,PIOMOD		;NO.
   243	000174'	305300	000015		CAIGE T1,SD		;DUMP MODE?
   244	000175'	254000	000201'		JRST UCLSBO		;NO. CLOSE BUFFERED OUTPUT
   245	000176'	550444	000003	UCLS7:	HRRZ T4,DEVSER(F) ;RESTORE T4
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 6-2
IOCSS.MAC	 9-OCT-87 18:01		CLOSE UUO

   246	000177'	260051	000007		PUSHJ P,DCL(T4)	;YES. DISPATCH TO DEVICE DEP. ROUTINE
   247	000200'	254000	000261'		JRST UCLS3
   248	000201'	607200	004200	UCLSBO:	TLNN F,OUTBFB+OUTPB	;WAS AN OUTPUT BUFFER SET UP?
   249	000202'	254000	000276'		JRST UCLS6		;NO
   250	000203'	554244	000006		HLRZ U, DEVBUF(F)	;VIRGIN OUBPUT BUFFER?
   251	000204'	256200	004210'	 XCTBU <SKIPG	(U)>
   252	000205'	254000	000276'		JRST UCLS6		;YES, DO NOT CLOSE UNLESS IT IS A DISK FILE
   253	000206'			UCLS2A:
   254	000206'	550304	000010		HRRZ T1,DEVOAD(F)
   255	000207'	256200	004211'	 XCTBU <SKIPL	(T1)>		;HAS SERVICE ROUTINE WRITTEN ITS NEXT BUFFER?
   256	000210'	254000	000227'		 JRST UCLS2B		;YES
   257	000211'	135300	000000*		LDB T1,DEYCLS	
   258	000212'	256006	001732'		XCT CLA(T1)		;CALL CLASS DEPENDENT ROUTINE TO DUMP BUFFER TO MONITOR BUFFER
   259	000213'	255000	000000		JFCL
   260	000214'	620000	760000		TRZ	S,760000	;NO,CLEAR ERROR BITS AND START OUTPUT DEVICE
   261	000215'	261040	000013		PUSH P,M
   262	000216'	135340	000211*		LDB	T2,DEYCLS	;GET CLASS
   263	000217'	256007	001736'		XCT	CLOBUF(T2)		;CALL CLASS DEPENDENT ROUTINE
   264	000220'	254000	000223'		JRST	UCLS2C		;ROUTINE DID IT ALL, FINISH UP
   265	000221'	550444	000003		HRRZ T4,DEVSER(F) ;RESTORE T4
   266	000222'	260051	000010		PUSHJ	P,DOU(T4)	;CALL SERVICE ROUTINE TO DO OUTPUT
   267	000223'	262040	000013	UCLS2C:	POP P,M
   268	000224'	260040	000126*		PUSHJ	P,WAIT1	;WAIT TILL MOST BUFFERS FILLED
   269	000225'	606000	760000		TRNN	S,760000	;ERROR?
   270	000226'	254000	000206'		JRST UCLS2A		;NO,RETURN WHEN ALL EMPTIED
   271								; OR SHUFFLING REQUIRED STOPS DEVICE
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 7
IOCSS.MAC	 9-OCT-87 18:01		CLOSE UUO

   272				;
   273	000227'	554344	000006	UCLS2B:	HLRZ	T2,DEVBUF(F)	 ;OUTPUT LAST BUFFER LOC OF HEADER
   274	000230'	256200	004212'	 XCTFU <SKIPG	T3,(T2)>		;VIRGIN RING?
   275	000231'	254000	000244'		 JRST	UCLS2D		;YES. NOTHING TO OUTPUT
   276	000232'	603400	200000		TLNE T3,IOADVB		;IS BUFFER IN ADVANCED STATE
   277	000233'	254000	000242'		 JRST UCLS3C	;OF ROT
   278	000234'	256200	004213'	 XCTFU <HRRZ	T4,1(T2)>		;LAST WORD FILLED
   279	000235'	332000	000011		SKIPE	T4		;IGNORE IT IF 0
   280	000236'	275450	000001		SUBI	T4,1(T3)		;-1ST WORD=LENGTH OF LAST BUFFER
   281	000237'	602000	000020		TRNE	S,IOWC		;USER COMPUTING OWN WORD COUNT?
   282	000240'	256200	004214'	 XCTFU <HRRZ	T4,1(T3)>		;YES. GET IT
   283	000241'	322440	000244'		JUMPE	T4,UCLS2D	;DONT OUTPUT IF LENGTH=0
   284	000242'	260040	002266'	UCLS3C:	PUSHJ	P,OUT		;WRITE THE LAST BUFFER
   285	000243'	260040	000224*		PUSHJ	P,WAIT1	;WAIT FOR IT
   286	000244'	550444	000003	UCLS2D:	HRRZ	T4,DEVSER(F)
   287	000245'	260051	000007		PUSHJ	P,DCL(T4)	;CLOSE OUTPUT BUFFER
   288	000246'	135440	000216*		LDB	T4,DEYCLS
   289	000247'	256011	001732'		XCT	CLA(T4)	;CALL CDR TO ADVANCE LAST BUFFER
   290	000250'	255000	000000		JFCL
   291	000251'	554244	000006		HLRZ U,DEVBUF(F)
   292	000252'	515300	400000		HRLZI T1,IOUSE
   293	000253'	256200	004215'	 XCTBU <IORM T1,(U)>
   294	000254'	205300	200000		MOVSI T1,IOADVB
   295	000255'	256200	004216'	 XCTBU <ANDCAM T1,(U)>	;MAKE SURE ITS OFF
   296	000256'	256200	004217'	 XCTBU <SETZM 2(U)>		;JBFCTR:=0
   297	000257'	260040	000243*		PUSHJ P,WAIT1
   298	000260'	661200	001000		TLO F,OCLOSB	;SET OCLOSB AFTER OUTPUT IS COMPLETE
   299				;
   300				; !!!!! NO TOUCH NEXT THREE INSTRUCTIONS !!!!!
   301				;
   302	000261'	262040	000006	UCLS3:	POP	P,T1		;Get back saved PC from PUSHJ at CLOSE1
   303	000262'	541300	000264'		HRRI	T1,.+2		;SET TO RET TO INST AFTER JRSTF
   304	000263'	254120	000006		JRSTF	@T1		;RESTORE OLD "PREVIOUS CONTEXT USER"
   305				;
   306				; O.K., all kosher now.
   307				;
   308	000264'	502212	000000*		HLLM F,%UPT+UPTJDA(W)
   309	000265'	200304	000004		MOVE	T1,DEVMOD(F)	;IS THIS A
   310	000266'	607300	200000		TLNN	T1,DVDSK	;DISK FILE?
   311	000267'	254000	000000*		JRST	DEVECK		;NO.
   312	000270'	603200	002000		TLNE	F,ICLOSB	;YES,  IF BOTH INPUT AND
   313	000271'	607200	001000		TLNN	F,OCLOSB	;OUTPUT HAVE BEEN CLOSED,
   314	000272'	254000	000267*		JRST	DEVECK		;THEN
   315	000273'	402004	000000*		SETZM	DEVPOS(F)	;CLEAR SOME
   316	000274'	476004	000000*		SETOM	D(F)	;STUFF BEFORE
   317	000275'	254000	000272*		JRST	DEVECK		;EXITING WITH ERROR CHECK.
   318
   319	000276'	205300	200000	UCLS6:	MOVSI	T1,DVDSK
   320	000277'	612304	000004		TDNE	T1,DEVMOD(F)	;CLOSING A DISK FILE ?
   321	000300'	254000	000176'		JRST	UCLS7		;YES, DO DISK CLOSE ROUTINE IN ANY EVENT
   322	000301'	254000	000261'		JRST	UCLS3
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 8
IOCSS.MAC	 9-OCT-87 18:01		CLOSE UUO

   323
   324	000302'	135340	000246*	BFICLN:	LDB T2,DEYCLS	;GET TYPE
   325	000303'	256007	000327'		XCT BFICLS(T2)	;ZERO DEVABC FOR DIRECT IO DEVICES
   326	000304'	550344	000006		HRRZ T2,DEVBUF(F)
   327	000305'	256200	004220'	 XCTBU <HRRZ U,(T2)>		;FIRST WORD OF 3 WORD BUFFER HEADER
   328	000306'	200340	000005		MOVE T2,U		;REMEMBER CURRENT BUFFER IN T2
   329	000307'	515300	400000		HRLZI T1,IOUSE		;USED BOTH FOR HEADER AND EACH BUFFER
   330	000310'	322240	000321'		JUMPE U,UCLS1		;HAS A RING BEEN SETUP?(NO IF 0)
   331	000311'	201640	010000		MOVEI P2,10000		;ONLY ALLOW 10000 BUFFERS IN A RING
   332								; SETUP COUNT IN CASE USER HAS MESSED
   333								; BUFFER RING INTO A FIGURE SIX
   334	000312'	402000	000014		SETZM P1
   335	000313'			UCLS0:
   336	000313'	256200	004221'	 XCTBU <HRR U,(U)>		;ADVANCE CURRENT INPUT BUFFER ADDRESS
   337	000314'	306605	000000		CAIN P1,(U)		;IS THIS THE SAME BUFFER AS LAST ONE?
   338	000315'	254000	000321'		JRST UCLS1		;YES. BAD RING. LOOPING ON ITSELF.
   339	000316'	256200	004216'	 XCTBU <ANDCAM T1,(U)>		;YES, CLEAR USE BIT.
   340	000317'	312340	000005		CAME T2,U		;DONE?
   341	000320'	367640	000313'		SOJG P2,UCLS0		;NO, HAVE WE SCANNED 1000 BUFFERS?
   342								; (WHICH MAY BE THE SAME)
   343								; YES
   344	000321'	540244	000006	UCLS1:	HRR U,DEVBUF(F)
   345	000322'	256200	004215'	 XCTBU <IORM T1,(U)>		;FLAG AS VIRGIN BUFFER IN 3 WORD HEADER
   346	000323'	205300	200000		MOVSI T1,IOADVB
   347	000324'	256200	004216'	 XCTBU <ANDCAM T1,(U)>	;MAKE SURE ITS OFF
   348	000325'	256200	004217'	 XCTBU <SETZM 2(U)>		;CLEAR INPUT J COUNT.
   349	000326'	263040	000000		POPJ	P,
   350
   351	000327'	255000	000000	BFICLS:	JFCL	;TTY
   352	000330'	255000	000000		JFCL	;I/O BUS DEVICE
   353	000331'	255000	000000		JFCL	;DSK. SIMIO TAKES CARE OF PAGE RELEASE
   354	000332'	402004	000013		SETZM DEVABC(F)	;TAPE
   355
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 9
IOCSS.MAC	 9-OCT-87 18:01		INBUF,OUTBUF UUOS

   356				SUBTTL INBUF,OUTBUF UUOS
   357				;CALLING SEQUENCE
   358				;	INBUF D,N
   359				;	EXIT		RETURNS HERE IF MEMORY NOT EXCEEDED
   360				;CALLING SEQUENCE
   361				;	OUTBUF D,N
   362				;	EXIT		RETURNS HERE IF MEMORY NOT EXCEEDED
   363				; SETS UP AN N BUFFER RING FOLLOWING THE USER'S PROGRAM FOR DEVICE
   364				; D AND INITIALIZES THE JOB BUFFER AREA HEADER:
   365				;	JBFADR0:=1,	JBFADR 1-17:=0
   366				;	JBFADR 18-35:=ADDRESS OF FIRST BUFFER IN RING
   367				;INPUT SETS DEVIAD:=ADDRESS OF FIRST BUFFER IN RING
   368				;OUTPUT SET DEVOAD:=ADDRESS OF FIRST BUFFER IN RING
   369				;W IS RESTORED.
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 10
IOCSS.MAC	 9-OCT-87 18:01		INBUF,OUTBUF UUOS

   370
   371	000333'	201300	000000	UOUTBF:	MOVEI T1,0
   372	000334'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   373	000335'	254000	000117*		 JRST ERRIUC		;ERROR, NO CHANNEL.
   374	000336'	254000	000335*		 JRST ERRIUC		;NOT IN DISPATCH TABLE
   375	000337'	661200	000200		TLO F,OUTBFB	;FLAG OUTBUF MUUO DONE
   376	000340'	261040	000012		PUSH P,W		;SAVE W ON STACK
   377	000341'	260040	003646'		PUSHJ P,BUFCLC	;SET UP BUFFER RING
   378	000342'	544304	000006		HLR T1,DEVBUF(F)	;T1:=OUTPUT BUFFER AREA HEADER ADDRESS
   379	000343'	542504	000010		HRRM W,DEVOAD(F)	;DEVOAD:=ADDRESS OF FIRST BUFFER
   380								; IN RING
   381	000344'	256200	004222'	UOBF1:	UMOVEM W,(T1)	;JBFADR:=IOUSE,ADDRESS OF FIRST BUFFER
   382								; IN RING
   383	000345'	262040	000012		POP P,W		;RESTORE W FROM STACK
   384	000346'	202212	000000*		MOVEM F,%UPT+UPTJDA(W)
   385	000347'	263040	000000		POPJ P,		;EXIT THIS MUUO
   386
   387	000350'	201300	000000	UINBF:	MOVEI T1,0
   388	000351'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   389	000352'	254000	000336*		 JRST ERRIUC		;ERROR, NO CHANNEL.
   390	000353'	254000	000352*		 JRST ERRIUC		;NOT IN DISPATCH TABLE
   391	000354'	661200	000400		TLO F,INBFB	;FLAG INBUF MUUO DONE
   392	000355'	261040	000012		PUSH P,W		;SAVE W ON STACK
   393	000356'	260040	003646'		PUSHJ P,BUFCLC	;SET UP BUFFER RING
   394	000357'	542504	000007		HRRM W,DEVIAD(F)	;DEVIAD:=ADDRESS OF FIRST BUFFER
   395								; IN RING
   396	000360'	540304	000006		HRR T1,DEVBUF(F)	;T1:=INPUT BUFFER AREA HEADER ADDRESS
   397	000361'	254000	000344'		JRST UOBF1
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 11
IOCSS.MAC	 9-OCT-87 18:01		NXTCHN, CHNNXT

   398				SUBTTL NXTCHN, CHNNXT
   399
   400				;CHANIO TO RETURN THE NUMBER OF THE NEXT AVAIL CHANNEL
   401	000362'	260040	000365'	NXTCHN:	PUSHJ	P,CHNNXT	;FIND NEXT CHAN AND TELL USER
   402					 JRST	[SKIPE	%UPT+UPTJDA(W)	;IS USER SPECIFIED CHAN IN USE?
   403						 POPJ	P,		;YES
   404	000363'	254000	004223'			 JRST	CPOPJ1]		;NO
   405	000364'	254000	000000*		JRST	CPOPJ1		;FOUND A CHAN AND TOLD USER WHAT IT IS
   406
   407				;ROUTINE TO FIND NEXT FREE CHAN
   408	000365'	302500	777777	CHNNXT:	CAIE	W,-1		;USER ASKS US TO FIND A CHANNEL?
   409	000366'	263040	000000		POPJ	P,		;NO.
   410	000367'	201500	000001		MOVEI	W,1		;YES, START LOOKING AT 1.
   411	000370'	336012	000000*	CHNNX0:	SKIPN	%UPT+UPTJDA(W)	;CHANNEL IN USE ALREADY?
   412	000371'	254000	000375'		 JRST	CHNNX1		;NO.
   413	000372'	305500	000027*		CAIGE	W,MAXCHN	;YES, ALL IN USE?
   414	000373'	344500	000370'		 AOJA	W,CHNNX0	;NO, TRY NEXT.
   415	000374'	254000	000000*		JRST	TPOPJ		;YES, REPORT NO CHANNEL.
   416	000375'	135340	000000*	CHNNX1:	LDB	T2,PUUOAC	;HERE ON FOUND W/ CHANNEL.
   417	000376'	256200	004226'	 XCTBU <HRRM	W,(T2)> 	;REPORT IT TO USER.
   418	000377'	254000	000364*		JRST	CPOPJ1		;SKIP RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 12
IOCSS.MAC	 9-OCT-87 18:01		OPEN,CHANIO OPEN, INIT UUOS

   419				SUBTTL OPEN,CHANIO OPEN, INIT UUOS
   420				;HERE FOR CHANIO OPEN, POSSIBLY WITH CHANNEL = -1.
   421	000400'	260040	000365'	COPEN:	PUSHJ	P,CHNNXT	;GET NUMBER OF NEXT AVAIL CHAN
   422	000401'	254000	000405'		 JRST	UOPEN		;USER SUPPLIED THE CHAN NUMBER
   423	000402'	313500	000000*		CAMLE	W,%UPT+UPTHCU	;NEED TO UPDATE UPTHCU?
   424	000403'	202500	000000*		 MOVEM	W,%UPT+UPTHCU	;YES, DO SO.
   425	000404'	254000	000405'		JRST	UOPEN		;
   426				;OPEN MUUO - PERFORMS SAME OPERATION AS INIT
   427				;MAY BE USED EASILY BY REENTRANT PROGRAMS
   428				;CALLING SEQUENCE FROM USER AREA
   429				;	OPEN D,ADR
   430				;	  ERROR RETURN
   431				;	DEVICE INITED
   432
   433				;LH(ADR)=0,RH(ADR)=DATA MODE THIS INIT
   434				;C(ADR+1) = SIXBIT /NAME/
   435				;LH(ADR+2)=OUTPUT BUFFER HEADER ADDRESS
   436				;RH(ADR+2)=INPUT BUFFER HEADER ADDRESS
   437
   438
   439	000405'	256200	004227'	UOPEN:	UMOVE	T1,(M)		;SET T1 TO CONTENTS OF FIRST ARG(IO STATUS BITS)
   440	000406'	344540	000413'		AOJA	M,UINIT0	;MAKE M POINT TO ARG+1
   441
   442				;CALLING SEQUENCE
   443				;	INIT D,MODUS	D=JOB DEVICE CHANNEL
   444				;			MODUS=IORDEL,IOCON,IOWC,MODE.
   445				;	SIXBIT/NAME/	DEVICE NAME
   446				;	XWD OBUF,IBUF	BUFFER AREA HEADER ADDRESSES
   447				;	  EXIT1		DEVICE NOT AVAILABLE
   448				;	EXIT2		DEVICE PROPERLY ASSIGNED
   449				;THE LEFT HALF OF NAME CONTAINS THE THREE LETTER DEVICE MNEMONIC,
   450				;   THE RIGHT HALF IS EITHER ZERO (SYSTEM WILL ASSIGN AN ARBITRARY
   451				;   UNIT) OR NON-ZERO TO REQUEST A SPECIFIC UNIT (LEFT JUSTIFIED).
   452				;IF THE SELECTED DEVICE IS NOT AVAILABLE, CONTROL RETURNS TO EXIT1.
   453				;OTHERWISE, THE DEVICE IS ASSIGNED TO THE USER AND ATTACHED TO HIS
   454				;CHANNEL D.  THE DEVICE IS INITIALIZED IN THE FOLLOWING MANNER AFTER
   455				;IOACT IS ZERO:
   456				;	IOBEG:=1
   457				;	DATA MODE:=BITS 32-35 OF AC M
   458				;	IOCON:=BIT 31 OF AC M
   459				;	IOWC:=BIT 30 OF AC M
   460				;	IORDEL:=BIT 29 OF AC M
   461				;	IOACT:=IODEND:=IOBKTL:=IODTER:=IODERR:=IOIMPM:=0
   462				;	JBFADR:=JBFCTR:=0 FOR THE SPECIFIED BUFFERS.
   463				;	DEVBUF:=OBUF,IBUF
   464				EXTERNAL TPOPJ,TPOPJ1,DOXCT
   465
   466	000407'	550300	000013	UINIT:	HRRZ	T1,M		;SAVE FIRST ARG(IO STATUS BITS) IN T1
   467	000410'	540541	000000*		HRR	M,PDNMUP(P)	;SET M TO ADR+1 OF USER ARGS
   468	000411'	350001	000410*		AOS	PDNMUP(P)	;SET RETURN SKIP THE 2 ARGUMENTS
   469	000412'	350001	000411*		AOS	PDNMUP(P)
   470	000413'	261040	000013	UINIT0:	PUSH	P,M		;HERE ON OPEN M, SAVE ADR+1 OF USER ARGS
   471	000414'	261040	000006		PUSH	P,T1		;SAVE IO STATUS BITS(FIRST ARG)
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 12-2
IOCSS.MAC	 9-OCT-87 18:01		OPEN,CHANIO OPEN, INIT UUOS

   472	000415'	332212	000000*		SKIPE	F,%UPT+UPTJDA(W);IS A DEVICE ALREADY ASSIGNED TO THIS CHAN?
   473	000416'	313500	000000*		CAMLE	W,%UPT+UPTHCU	;YES, IS THIS CHAN. LESS OR EQUAL TO HIGHEST
   474								; CHAN. FOR THIS USER?
   475	000417'	254000	000421'		 JRST	UINITA		;NO, NO PREVIOUS DEVICE TO RELEASE
   476	000420'	260040	003334'		PUSHJ	P,RELEAS	;RELEASE PREVIOUS DEVICE ON THIS CHAN.
   477	000421'	200541	777777	UINITA:	MOVE	M,-1(P)		;RESTORE M (ADR+1 OF 3 ARGS)
   478	000422'	256200	004227'		UMOVE	T1,(M)		;C(T1)=DEVICE NAME IF IN BOUNDS.
   479								; DO NOT RETURN IF OUT OF BOUNDS(PRINT ERR AND STOP)
   480	000423'	200100	000000*		MOVE	J,JOB		;GET THE CURRENT JOB NO.
   481	000424'	335001	000000		SKIPGE	(P)		;SEE IF WANTS PHYSICAL ONLY
   482	000425'	505500	400000		 HRLI	W,PHONLY	;YES
   483	000426'	260040	003553'		PUSHJ	P,DEVSRC	;SEARCH FOR DEVICE NAME
   484								; (SET SYSDEV BIT IN LH OF
   485								; F IF THIS IS SYSTEM TAPE)
   486	000427'	254000	000515'		  JRST	UINITE		;NO SUCH DEVICE
   487	000430'	550541	000000		HRRZ	M,(P)		;RESTORE USER'S MODE SETTING
   488	000431'	261040	000006		PUSH	P,T1		;SAVE NAME USER SUPPLIED
   489	000432'	260040	004150'		PUSHJ	P,CHKMOD	;CHECK FOR LEGAL MODE, IF NOT RIGHT DONT RETURN
   490	000433'	262040	000006	UINIT1:	POP	P,T1		;RESTORE NAME
   491	000434'	201340	200000		MOVEI	T2,ASSPRG	;TRY TO ASSIGN IT BY PROGRAM
   492	000435'	260040	003517'		PUSHJ	P,ASSASG
   493	000436'	254000	000515'		  JRST	UINITE		;NOT AVAILABLE, GIVE ERROR RETURN(POP T1)
   494	000437'	262040	000013		POP	P,M		;RESTORE USER'S MODE SETTING
   495	000440'	260040	004143'		PUSHJ	P,SETIO2	;SET DDB S STATUS WORD FROM RT. HALF OF AC M
   496								; WAIT FOR DEVICES TO BECOME INACTIVE IN CASE IT IS
   497								; INITED ON A DIFFERENT CHANNEL(OR MONITOR COMMAND
   498								; RESPONSE ON TTY)
   499	000441'	550300	000004		HRRZ	T1,F
   500	000442'	306300	000000*		CAIN	T1,ACTDDB##
   501					 JRST	[MOVSI	T1,ACTDED##	;ACT DEVICE REQUIRES THIS RESET
   502						ANDCAM	T1,DEVSTS(F)	; ON INIT
   503						MOVSI	S,0		;DO NOT SET IOBEG FOR ACT DEVICE
   504	000443'	254000	004230'			JRST .+2]
   505	000444'	205000	000002		MOVSI	S,IOBEG		;IOBEG CAUSES MONITOR BUFFER TO BE CLEARED
   506	000445'	437004	000002		IORB	S,DEVIOS(F)
   507	000446'	553000	000012		HRRZS	W		;CLEAR FOR UNITL LOOP
   508	000447'	317500	000000*	UINITL:	CAMG	W,%UPT+UPTHCU	;IS THIS CHAN. .GT. HIGHEST CHAN. IN USE?
   509	000450'	254000	000460'		 JRST	UINITC		;NO
   510	000451'	350300	000000*		AOS	T1,%UPT+UPTHCU	;YES, BUMP HIGHEST SO FAR BY ONE
   511	000452'	402006	000000*		SETZM	%UPT+UPTJDA(T1)	;AND CLEAR IT OUT
   512	000453'	303300	000017		CAILE	T1,17
   513	000454'	254000	000447'		 JRST	UINITL		;PAST END OF USER JOBJDA ARRAY
   514	000455'	260040	000000*		UXCTBU <SETZM JOBJDA(T1)>
   515	000456'	256200	004234'
   516	000457'	254000	000447'		JRST	UINITL		;KEEP LOOKING
   517
   518	000460'	202212	000000*	UINITC:	MOVEM	F,%UPT+UPTJDA(W);STORE FOR MONITOR
   519	000461'	332012	000000*		SKIPE	%UPT+UPTSIM(W)	;DEBUG AAA. RELEASE SHOULD
   520	000462'	256000	000000'		 STOPCD			;HAVE CLEARED THIS IF THIS WAS DSK BEFORE
   521	000463'	303500	000017		CAILE	W,17
   522	000464'	254000	000467'		 JRST	UINIC1	;PAST END USER JOBJDA ARRAY
   523							;KEEP USER UPTODATE WITH THIS MOVEM:
   524	000465'	260040	000455*		UXCTBU <MOVEM F,JOBJDA(W)>
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 12-3
IOCSS.MAC	 9-OCT-87 18:01		OPEN,CHANIO OPEN, INIT UUOS

   525	000466'	256200	004235'
   526	000467'	200300	000000*	UINIC1:	MOVE	T1,%UPT+UPTHCU	;HIGHEST CHAN IN USE
   527	000470'	260040	000465*		UXCTBU <MOVEM T1,JOBHCU>
   528	000471'	256200	004236'
   529	000472'	661200	403000		TLO	F,INITB+ICLOSB+OCLOSB;SET INIT MUUO BIT
   530								;PREVENT SUPERFLUOUS CALLS TO CLOSE (SEE LOOKUP,ENTER)
   531	000473'	350541	000000		AOS	M,(P)		;ADVANCE TO 3RD ARG(BUFFER HEADER)
   532	000474'	256200	004227'		UMOVE	T1,(M)		;C(T1)=BUFFER HEADER ARG
   533	000475'	554340	000006		HLRZ	T2,T1		;OUTPUT BUFFER HEADER FROM USER
   534	000476'	322340	000502'		JUMPE	T2,UINIT4	;WAS ONE SPECIFIED?
   535	000477'	506344	000006		HRLM	T2,DEVBUF(F)	;YES, SET DEVICE DATA BLOCK
   536	000500'	661200	100000		TLO	F,OBUFB		;SET OUTPUT BUFFER SPECIFIED BIT
   537	000501'	260040	000517'		PUSHJ	P,UINITZ	;INITIALIZE OUTPUT BUFFER HEADER
   538	000502'	256200	004227'	UINIT4:	UMOVE	T1,(M)		;C(T1)=BUFFER HEADER ARG FROM USER
   539	000503'	550340	000006		HRRZ	T2,T1		;INPUT BUFFER HEADER
   540	000504'	322340	000512'		JUMPE	T2,UINIT5	;WAS ONE SPECIFIED?
   541	000505'	542344	000006		HRRM	T2,DEVBUF(F)	;YES, SET DEVICE DATA BLOCK
   542	000506'	661200	200000		TLO	F,IBUFB		;SET INPUT BUFFER SPECIFIED BIT
   543	000507'	205000	000040		MOVSI	S,IOEND		;CLEAR END OF FILE FLAG
   544	000510'	413004	000002		ANDCAB	S,DEVIOS(F)	;AND RETAIN S
   545	000511'	260040	000517'		PUSHJ	P,UINITZ	;INITIALIZE INPUT BUFFER HEADER
   546	000512'	202212	000000*	UINIT5:	MOVEM	F,%UPT+UPTJDA(W);STORE MUUO BITS AND DEVICE
   547								; DATA BLOCK ADDRESS
   548				EXTERNAL JOBHCU,JOBJDA
   549	000513'	260040	000000*		PUSHJ	P,TST1UN##	;SEE IF SPECIAL DSK UNIT.
   550	000514'	254000	000000*		JRST	TPOPJ1		;SUCCESSFUL RETURN(POP T1)
   551
   552	000515'	262040	000006	UINITE:	POP	P,T1		;REMOVE IO STATUS ARG
   553	000516'	254000	000374*		JRST	TPOPJ		;AND GIVE ERROR RETURN AND POP T1
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 13
IOCSS.MAC	 9-OCT-87 18:01		OPEN,CHANIO OPEN, INIT UUOS

   554				;CALLING SEQUENCE
   555				;	PUSHJ P,UINITZ
   556				;	EXIT		RETURNS HERE IF MEMORY NOT EXCEEDED.
   557				;SETS JBFADR:=JBFCTR:=0 FOR THE BUFFER AREA HEADER WHOSE ADDRESS
   558				;IS IN AC TAC1.  ALSO,JBFPTR 0-5:=JBFPTR 12-17:=0,JBFPTR 6-11:=BYTE SIZE
   559
   560	000517'	305340	000000*	UINITZ:	CAIGE	T2,JOBDA##	;Is the address in the ACs or in JOBDAT?
   561	000520'	254000	000000*		 JRST	ADRERR		;Yes, "?Address check for device ..."
   562	000521'	256200	004237'	 XCTBU <SETZM	(T2)>		;CLEAR FIRST WORD (CURRENT BUFFER) OF 3 WORD HEADER
   563	000522'	350000	000007		AOS	T2		;POINT TO SECOND WORD (BYTE POINTER)
   564	000523'	261040	000007		PUSH	P,T2
   565	000524'	350000	000007		AOS	T2		;POINT TO THIRD WORD (J COUNT)
   566	000525'	256200	004237'	 XCTBU <SETZM	(T2)>	;SET J COUNT TO ZERO
   567	000526'	260040	004171'		PUSHJ	P,SETBYT	;SET BYTE SIZE ACCORDING TO MODE AS SET IN AC S
   568	000527'	621300	770077		TLZ	T1,770077
   569	000530'	262040	000007		POP	P,T2
   570	000531'	256200	004240'	 XCTBU <HLLM	T1,(T2)>	;AND STORE IN SECOND WORD
   571	000532'	263040	000000		POPJ	P,		;RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 14
IOCSS.MAC	 9-OCT-87 18:01		ENTER,SIMULATNEOUS ENTER, LOOKUP

   572				SUBTTL ENTER,SIMULATNEOUS ENTER, LOOKUP
   573
   574				;LONG DISPATCH TABLE UUOS - GET HERE ONLY IF DEVICE HAS LONG
   575				;DISPACTH TABLE
   576				;DISPACTH TO DEVICE DEPENDENT SERVICE ROUTINE
   577				;ENTER MUUO - ENTER FILE NAME IN DIRECTORY
   578
   579	000533'	334300	004241'	USDEN:	SKIPA	T1,[DSIM]	;HERE FOR SIMULTANEOUS UPDATING ENTER
   580	000534'	201300	000016	UDEN:	MOVEI T1,DEN
   581	000535'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   582	000536'	254000	000353*		 JRST ERRIUC		;ERROR, NO CHANNEL.
   583	000537'	254000	000377*		JRST CPOPJ1		;SHORT DISPATCH TABLE OKAY.
   584	000540'	270440	000006		ADD	T4,T1		;GET PROPER DISPATCH ADDRESS.
   585	000541'	261040	000012		PUSH P,W
   586	000542'	201300	000002		MOVEI T1,CLSIN
   587	000543'	607200	001000		TLNN F,OCLOSB	;FILE OPEN?
   588	000544'	260040	000601'		PUSHJ P,UDLKC		;YES. CLOSE IT[OCLOSB_1]
   589	000545'	200304	000004		MOVE T1,DEVMOD(F)
   590	000546'	607300	200000		TLNN T1,DVDSK		;EXCEPT FOR DSK,
   591	000547'	661000	000002		TLO S,IOBEG		;SET IOBEG EVEN ON UPDATING ENTER
   592	000550'	620000	766000		TRZ S,IOIMPM!IODERR!IODTER!IOBKTL!IODEND!IOBOT!IOTEND
   593	000551'	260040	000610'		PUSHJ P,ARGCHK	;ADDRESS CHECK ARG.
   594	000552'	260051	000000		PUSHJ P,(T4)	;ATTEMPT AN ENTER
   595	000553'	254000	000613'		 JRST WPOPJ	;FAILURE
   596	000554'	621200	005000		TLZ F,OCLOSB!OUTPB
   597	000555'	661200	020000		TLO F,ENTRB	;NOTE SUCCESSFUL ENTER
   598	000556'	254000	000576'		JRST DLKDEN		;STORE THE PROGRESS BITS
   599
   600				;LOOKUP MUUO - LOOKUP FILE NAME IN DIRECTORY
   601
   602	000557'	201300	000017	UDLK:	MOVEI T1,DLK
   603	000560'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   604	000561'	254000	000536*		 JRST ERRIUC		;ERROR, NO CHANNEL.
   605	000562'	254000	000537*		JRST CPOPJ1		;SHORT DISPATCH TABLE OKAY.
   606	000563'	261040	000012		PUSH P,W
   607	000564'	201300	000001		MOVEI T1,CLSOUT		;INHIBIT OUTPUT CLOSE BIT
   608	000565'	607200	002000		TLNN F,ICLOSB	;FILE OPEN?
   609	000566'	260040	000601'		PUSHJ P,UDLKC		;YES. CLOSE IT[ICLOSB_1]
   610	000567'	630000	004242'		TDZ S,[XWD IOEND,IOIMPM!IODERR!IODTER!IOBKTL!IODEND!IOBOT!IOTEND]
   611	000570'	260040	000610'		PUSHJ P,ARGCHK	;ADDRESS CHECK ARG.
   612	000571'	550444	000003		HRRZ T4,DEVSER(F)
   613	000572'	260051	000017		PUSHJ P,DLK(T4)	;ATTEMPT A LOOKUP
   614	000573'	254000	000613'		 JRST WPOPJ	;FAILURE
   615	000574'	621200	012004		TLZ F,ICLOSB!INPB!MAPB
   616	000575'	661200	040000		TLO F,LOOKB	;NOTE SUCCESSFUL LOOKUP
   617	000576'	262040	000012	DLKDEN:	POP P,W
   618	000577'	502212	000000*		HLLM F,%UPT+UPTJDA(W) ;STORE MUUO PROGRESS BITS
   619	000600'	254000	000562*		JRST CPOPJ1		;SUCCESS RETURN TO USER (CALL+2)
   620
   621
   622	000601'	261040	000013	UDLKC:	PUSH P,M
   623	000602'	261040	000011		PUSH P,T4
   624	000603'	541546	000000		HRRI M,(T1)
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 14-2
IOCSS.MAC	 9-OCT-87 18:01		ENTER,SIMULATNEOUS ENTER, LOOKUP

   625	000604'	260040	000133'		PUSHJ P,CLOSE1
   626	000605'	262040	000011		POP P,T4
   627	000606'	262040	000013		POP P,M
   628	000607'	254000	000257*		JRST	WAIT1
   629
   630	000610'	202004	000002	ARGCHK:	MOVEM S,DEVIOS(F);STORE S & MUUO BITS
   631	000611'	502212	000000*		HLLM F,%UPT+UPTJDA(W)
   632	000612'	263040	000000		POPJ P,
   633
   634	000613'	262040	000012	WPOPJ:	POP P,W
   635	000614'	263040	000000		POPJ P,
   636
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 15
IOCSS.MAC	 9-OCT-87 18:01		ENTER,SIMULATNEOUS ENTER, LOOKUP

   637	000615'	260040	000000*	SETMOD::PUSHJ P,TTYFND
   638	000616'	540540	000006		HRR M,T1
   639	000617'	254000	004143'		JRST SETIO2		;JUST DO A SETSTS
   640
   641	000620'	135500	004243'	MOVBUF::LDB W,[POINT 4,T1,17]	;GET CHANNEL
   642	000621'	261040	000006	MOVBF3:	PUSH P,T1	;SAVE T1 FROM CHNCHK
   643	000622'	201300	000000		MOVEI T1,0	;ALWAYS OK
   644	000623'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
   645	000624'	254000	000561*		 JRST ERRIUC		;ERROR, NO CHANNEL.
   646	000625'	255000	000000		JFCL			;NO-OP ON SHORT DISPATCH TABLE.
   647	000626'	262040	000006		POP P,T1
   648	000627'	260040	000607*		PUSHJ P,WAIT1
   649	000630'	607300	000020		TLNN T1,20
   650	000631'	254000	000636'		JRST MOVOBF		;NOT INPUT RING
   651	000632'	550344	000007		HRRZ T2,DEVIAD(F)
   652	000633'	322340	000636'		JUMPE T2,MOVOBF		;NOT REALLY AN INPUT RING
   653	000634'	270340	000006		ADD T2,T1
   654	000635'	542344	000007		HRRM T2,DEVIAD(F)
   655	000636'	607300	000040	MOVOBF:	TLNN T1,40
   656	000637'	254000	000644'		JRST MOVIHD
   657	000640'	550344	000010		HRRZ T2,DEVOAD(F)
   658	000641'	322340	000644'		JUMPE T2,MOVIHD
   659	000642'	270340	000006		ADD T2,T1
   660	000643'	542344	000010		HRRM T2,DEVOAD(F)
   661	000644'	607300	000100	MOVIHD:	TLNN T1,100
   662	000645'	254000	000652'		JRST MOVOHD
   663	000646'	550344	000006		HRRZ T2,DEVBUF(F)
   664	000647'	322340	000652'		JUMPE  T2,MOVOHD
   665	000650'	270340	000006		ADD T2,T1
   666	000651'	542344	000006		HRRM T2,DEVBUF(F)
   667	000652'	607300	000200	MOVOHD:	TLNN T1,200
   668	000653'	263040	000000		POPJ P,
   669	000654'	554344	000006		HLRZ T2,DEVBUF(F)
   670	000655'	322340	000000*		JUMPE T2,CPOPJ
   671	000656'	270340	000006		ADD T2,T1
   672	000657'	506344	000006		HRLM T2,DEVBUF(F)
   673	000660'	263040	000000		POPJ P,
   674
   675	000661'	256200	004227'	MOVBF2:	UMOVE T1,(M)
   676	000662'	254000	000621'		JRST MOVBF3
   677
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   678				SUBTTL CHANIO DISPATCH VARIOUS FUNCTIONS
   679				;CHANIO VMAP FUNCTION.
   680				;
   681				;CALL HAS THE FORM:
   682				;
   683				;    MOVE AC,[XWD 35,CHANNEL NO.]
   684				;    CHANIO AC,LOC
   685				;    ERROR RETURN
   686				;    SUCCESS RETURN
   687				;
   688				;WHERE LOC HAS THE FORM:
   689				;    BYTE (1)0(4)0(3)PROTECT(^D10)CONTIG PGS(8)0(10)START VM PAGE #
   690				;
   691				;AND LOC+1 HAS THE FORM:
   692				;    START FILE PAGE #
   693
   694
   695	000663'	221200	000006	UUYCTG::POINT ^D10,T1,17
   696	000664'	340300	000006	UUYCPR::POINT ^D3,T1,7
   697	000665'	001200	000006	UUYSVM::POINT ^D10,T1,^D35
   698
   699
   700	000666'	201300	000026	VMAPUU::MOVEI	T1,DVMAP	;
   701	000667'	254000	000710'		JRST	KERCHN		;
   702
   703
   704
   705
   706
   707
   708				;CHANIO VSMAP FUNCTION.
   709				;
   710				;CALL HAS THE FORM:
   711				;
   712				;    MOVE AC,[XWD 43,CHANNEL NO.]
   713				;    CHANIO AC,LOC
   714				;    ERROR RETURN
   715				;    SUCCESS RETURN
   716				;
   717				;WHERE LOC HAS THE FORM:
   718				;    BYTE (1)0(4)0(3)PROTECT(^D10)CONTIG PGS(8)0(10)START VM PAGE #
   719				;
   720				;AND LOC+1 HAS THE FORM:
   721				;    START UNIT/STR PAGE #
   722
   723
   724	000670'	201300	000034	VSMAPU::MOVEI	T1,DVSMAP	;
   725	000671'	254000	000710'		JRST	KERCHN		;
   726
   727				;CHANIO MOVE VP TO FILE FUNCTION.
   728				;
   729				;CALL:
   730				;
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16-2
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   731				;	MOVE	AC,[XWD 47,CHANNEL NO.]
   732				;	CHANIO	AC,LOC
   733				;	  <ERROR RETURN>
   734				;	<SUCCESS RETURN>
   735				;
   736				;LOC:	VP NUMBER
   737				;LOC+1:	FP NUMBER OR -1 FOR FIRST PAGE PAST END OF FILE.
   738
   739	000672'	201300	000037	VMOVPG:	MOVEI	T1,DMOVPG	;DDB DISPATCH NUMBER
   740	000673'	254000	000710'		JRST	KERCHN		;DISPATCH TO THE CALL.
   741
   742
   743
   744
   745				;CHANIO DELETE FILE PAGE FUNCTION.
   746				;
   747				;CALL HAS THE FORM:
   748				;
   749				;    MOVE AC,[XWD 36,CHANNEL NO.]
   750				;    CHANIO AC,LOC
   751				;    ERROR RETURN
   752				;    SUCCESS RETURN
   753				;
   754				;WHERE LOC HAS THE FORM:
   755				;	FILE PAGE NUMBER.
   756
   757
   758	000674'	201300	000027	FDELUU:	MOVEI	T1,DFDEL	;
   759	000675'	254000	000710'		JRST	KERCHN		;
   760
   761
   762
   763				;CHANIO CREATE FILE PAGE FUNCTION.
   764				;
   765				;CALL HAS THE FORM:
   766				;
   767				;    MOVE AC,[XWD 40,CHANNEL NO.]
   768				;    CHANIO AC,LOC
   769				;    ERROR RETURN
   770				;    SUCCESS RETURN
   771				;
   772				;WHERE LOC HAS THE FORM:
   773				;	FILE PAGE NUMBER.
   774
   775
   776	000676'	201300	000030	FCREAU:	MOVEI	T1,DFCRE	;
   777	000677'	254000	000710'		JRST	KERCHN		;
   778
   779
   780
   781
   782				;CHANIO TRUNCATE FILE WITHIN LAST PAGE FUNCTION.
   783				;
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16-3
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   784				;CALL HAS THE FORM:
   785				;
   786				;    MOVE AC,[XWD 45,CHANNEL NO.]
   787				;    CHANIO AC,LOC
   788				;    ERROR RETURN
   789				;    SUCCESS RETURN
   790				;
   791				;WHERE LOC HAS THE FORM:
   792				;	NEW FILE SIZE IN WORDS.
   793
   794
   795	000700'	201300	000036	FTRNCU:	MOVEI	T1,DFTRN	;
   796	000701'	254000	000710'		JRST	KERCHN		;
   797
   798
   799
   800
   801				;CHANIO EXCHANGE FILE PAGES FUNCTION.
   802				;
   803				;CALL HAS THE FORM:
   804				;
   805				;    MOVE AC,[XWD 37,CHANNEL NO.]
   806				;    CHANIO AC,LOC
   807				;    ERROR RETURN
   808				;    SUCCESS RETURN
   809				;
   810				;WHERE LOC AND LOC+1 CONTAIN THE NUMBERS OF THE FILE PAGES TO
   811				;BE EXCHANGED.
   812
   813	000702'	201300	000031	FEXCHU:	MOVEI	T1,DFEXC	;
   814	000703'	254000	000710'		JRST	KERCHN		;
   815
   816
   817
   818
   819				;CHANIO FIND INTERESTING RET PNTR FUNCTION (FFIFP AND FRIENDS.).
   820				;
   821				;CALL HAS THE FORM:
   822				;
   823				;    MOVE AC,[XWD 44,CHANNEL NO.]
   824				;    CHANIO AC,
   825				;    ERROR RETURN
   826				;    SUCCESS RETURN
   827				;
   828				;WHERE LOC CONTAINS THE FILE PAGE NUMBER TO START SEARCHING
   829				;AT (INCLUSIVE), AND LOC+1 CONTAINS THE CONDITION OF INTEREST,
   830				;AS:
   831				;	0	FIND FIRST HOLE.
   832				;	1	FIND FIRST REAL PAGE.
   833
   834	000704'	201300	000035	FFIFPU:	MOVEI	T1,DFFIF	;
   835	000705'	254000	000710'		JRST	KERCHN
   836
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16-4
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   837
   838
   839
   840				;CHANIO VALIDATE RIBS FUNCTION.
   841				;
   842				;CALL HAS THE FORM:
   843				;
   844				;    MOVE AC,[XWD 42,CHANNEL NO.]
   845				;    CHANIO AC,LOC
   846				;    ERROR RETURN
   847				;    SUCCESS RETURN
   848
   849	000706'	201300	000033	FVLRBU:	MOVEI	T1,DFVLR	;
   850	000707'	254000	000710'		JRST	KERCHN
   851
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   852				COMMENT #
   853				@@SUBROUTINE KERCHN
   854				@@PURPOSE
   855				PLACE TO DISPATCH FROM SOME CHANIOS TO THE KERNEL ROUTINES
   856				IN MAPIOX.
   857				SETS UP T1 AS 1ST USER AC AND POSSIBLY T2 AS SECOND USER AC.
   858				SETS USER-EXEC FLAG IN BIT 0 OF T1 FOR MAP, BIT 0 OF T3 FOR
   859				EXCH/DEL/CRE/FFFF (TO AVOID CONFLICTS WITH -1, ETC.).
   860				NOTE THAT THE FCREATE AND FFIFP KERNELS EXPECT M TO BE SET UP,
   861				SO THAT THEY CAN STORE THRU IT.
   862				SETS J/ JOB NUMBER.
   863				@@ENTRY
   864				EXPECTS T1/ DVMAP, DVSMAP, DFDEL, DFCRE, DFVRL, DFFIF, DFEXC,
   865				OR DFTRN.
   866				@@ACCUM
   867				DESTROYS ALL BUT M.
   868				@@EXIT
   869				@@ #
   870
   871	000710'	260040	000077'	KERCHN:	PUSHJ	P,CHNCHK	;CHK CHAN AND SET F, S, AND T4.
   872	000711'	254000	000624*		JRST	ERRIUC		;NO CHANNEL ASSIGNED.
   873	000712'	263040	000000		POPJ	P,		;SHORT DISPATCH TABLE.
   874	000713'	200100	000423*		MOVE	J,JOB		;IN CASE ITS NOT MAP
   875	000714'	200600	000011		MOVE	P1,T4		;GET KERNEL ROUTINE ADDRESS IN P1
   876	000715'	270600	000006		ADD	P1,T1
   877	000716'	306300	000033		CAIN	T1,DFVLR	;SKIP LOTS OF STUFF IF
   878	000717'	254000	000747'		JRST	KERCH4		;VAL RIBS.
   879	000720'	510401	000412*		HLLZ	T3,PDNMUP(P)	;GET UUO CALLER'S PC OFF STACK
   880								; (NOT FROM UPTMUP, MAY BE MONITOR DOING UUO)
   881	000721'	607400	010000		TLNN	T3,PC.USR	;FIND OUT IF THIS IS USER OR
   882	000722'	634400	000010		TDZA	T3,T3		;EXEC
   883	000723'	515400	400000		HRLZI	T3,400000	;MODE.
   884	000724'	200340	000006		MOVE	T2,T1		;SAVE ROUTINE FLAG IN T2.
   885	000725'	256200	004227'		UMOVE	T1,(M)		;T1/ 1ST ARG.
   886	000726'	302340	000026		CAIE	T2,DVMAP	;BIT TO GO TO T1?
   887	000727'	306340	000034		CAIN	T2,DVSMAP	;
   888	000730'	254000	000732'		JRST	.+2		;
   889	000731'	254000	000741'		JRST	KERCH2		;NO, IT STAYS IN T3.
   890	000732'	621300	400000		TLZ	T1,400000	;T1 TO USER/EXEC
   891	000733'	436400	000006		IORM	T3,T1		;
   892	000734'	661200	000004		TLO	F,MAPB		;KEEP ATB AROUND
   893	000735'	202212	000000*		MOVEM	F,%UPT+UPTJDA(W) ;AFTER CLOSE.
   894	000736'	201700	000045		MOVEI	P3,.ARCHM	;MAPPING IS CERTAINLY CHANGING THE MAP
   895	000737'	260040	000000*		PUSHJ	P,SWRUPX	;WRITE LOCK %UPX AND SETUP J
   896					  JRST	[MOVSS T1	;GET VP # IN LH
   897						 HRRI T1,FALOFF
   898						 DPB P3,FDEERP<T1> ;PUT SUB ERROR CODE IN
   899						 LDB M,PUUOAC	;GET USER'S AC NUMBER
   900						 UMOVEM T1,(M)
   901	000740'	254000	004246'			 POPJ P,]	;GIVE ERROR RETURN.
   902	000741'	306340	000036	KERCH2:	CAIN	T2,DFTRN	;FTRUNC,
   903	000742'	254000	000747'		JRST	KERCH4		;
   904	000743'	302340	000030		CAIE	T2,DFCRE	;FCREATE AND
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17-2
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   905	000744'	306340	000027		CAIN	T2,DFDEL	;FDELETE ONLY NEED 1 ARG.
   906	000745'	254000	000747'		JRST	.+2		;
   907	000746'	256200	004254'		UMOVE	T2,1(M)		;VMAP, VSMAP, FFIFP, AND FEXCH TAKE TWO.
   908	000747'	261040	000013	KERCH4:	PUSH	P,M		;SAVE M.
   909	000750'	260054	000000		PUSHJ	P,(P1)		;DISPATCH TO KERNEL.
   910	000751'	254000	000754'		JRST	KERERR		;ERROR RETURN.
   911	000752'	262040	000013		POP	P,M		;RESTORE M.
   912	000753'	254000	000600*		JRST	CPOPJ1		;SUCCESS RETURN.
   913
   914
   915				    ;HERE ON ERROR.
   916	000754'	262040	000013	KERERR:	POP	P,M		;RESTORE M.
   917	000755'	135340	000375*		LDB	T2,PUUOAC	;GET T2/ USER'S AC ADDRESS.
   918	000756'	256200	004255'		UMOVEM	T1,(T2)		;RETURN ERROR INFO TO USER.
   919	000757'	263040	000000		POPJ	P,
   920
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 18
IOCSS.MAC	 9-OCT-87 18:01		CHANIO DISPATCH VARIOUS FUNCTIONS

   921				COMMENT #
   922				HERE FOR .FOREP, FRAME REPLICATE PAGE.
   923				 GIVES SAME ERROR CODES AS VREPLC.
   924				 CALL IS
   925
   926					MOVE	AC,[FN,,FD]
   927					FRMOP	AC,[<DESTINATION DESCRIPTOR>
   928						    <SOURCE DESCRIPTOR>]
   929					  <ERROR RETURN>	;ERRO CODE SAME AS REPLICATE
   930					<SUCCESS RETURN>
   931				#
   932
   933
   934	000760'	550300	000013	FRMREP::HRRZ	T1,M		;GET THIS INTO T1 FOR XREPLU
   935	000761'	254000	001004'		JRST	XREPLU		;FD IS IN P4 ALREADY.
   936
   937				;HERE FOR .FOVCL AND .FOVRM FRMOP FUNCTIONS - DO VCLEAR AND VREMOV
   938				; FOR SPECIFIED FRAME. CALL IS
   939				COMMENT #
   940					MOVE	AC,[FN,,FD]
   941					FRMOP	AC,[PAGE DESCRIPTOR]
   942					  <ERROR>		;RETURNS SAME FUNCTION CODES AS VREMOV OR VCLEAR
   943					<SUCCESS>
   944				#
   945
   946				EXTERNAL FDWUPX
   947
   948	000762'	334600	004256'	FRMVCL::SKIPA	P1,[KCLEAR]	;SET UP FOR CLEAR
   949	000763'	201600	004257'	FRMVRM::MOVEI	P1,[KREMOV]	;REMOV
   950	000764'	201700	000045		MOVEI	P3,.ARCHM	;NEED CHANGE MAP ACCESS FOR THIS
   951	000765'	260040	000000*		PUSHJ	P,FDWUPX	;LOCK PAGES, CHECK RIGHTS
   952	000766'	254000	000773'		  JRST	FRMNVC		;CAN'T DO IT, RETURN ERROR
   953	000767'	256200	004227'		UMOVE	T1,(M)		;GET THE ARG TO REMOVE
   954	000770'	661300	400000		TLO	T1,(1B0)	;ALWAYS LOOK LIKE USER - DON'T ALLOW
   955								; MONITOR TO REMOVE ANOTHER FRAME'S PER PROCESS PAGES
   956	000771'	200540	000012		MOVE	M,W		;SET M TO ADDRESS FOR ERROR CODE
   957	000772'	324740	001133'		PJRST	KERUUO		;ALL SET, GO DO IT.
   958
   959	000773'			FRMNVC:
   960	000773'	256200	004260'	 XCTFU <HRLZS T1,(M)>	;GET VP NUMBER IN LH
   961	000774'	541300	000000*		HRRI	T1,FALOFF	;"OTHER FRAME FAILURE"
   962	000775'	137700	004244'		DPB	P3,FDEERP<T1>	;PUT SUB ERROR CODE IN
   963	000776'	256200	004261'		UMOVEM	T1,(W)		;PUT IN AC
   964	000777'	263040	000000		POPJ	P,		;AND GIVE NON-SKIP ERROR RETURN.
   965
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 19
IOCSS.MAC	 9-OCT-87 18:01		REPLICATE,REMOVE,CLEAR,VFSTAT---VM PAGE UUO DISPATCHES

   966				SUBTTL REPLICATE,REMOVE,CLEAR,VFSTAT---VM PAGE UUO DISPATCHES
   967				;UUO VREPLICATE VM PAGE FUNCTION.
   968				;
   969				;CALL HAS THE FORM:
   970				;
   971				;    MOVEI	AC,ADDR
   972				;    VREPLC	AC,
   973				;    ERROR RETURN
   974				;    SUCCESS RETURN
   975				;
   976				;WHERE ADDR CONTAINS:
   977				;    BYTE (1)0(4)0(3)PROTECT(^D10)CONTIG PGS(8)0(10)1ST DEST VP
   978				;
   979				;AND ADDR+1 CONTAINS:
   980				;    1ST SOURCE VP.
   981
   982				EXTERNAL UPTJOB,OTFFLG,WLKUPT,ULDUPX,UNWUPT,UNIUPT,FALOFF
   983				EXTERNAL FD2FNO,UPTOFD,WLKUPX,CHEKAR,FECLP%
   984
   985
   986				EXTERN KREPLC,KREMOV,KCLEAR,KFILCK,SWRUPX,SRDUPX
   987
   988	001000'			VREPLU::
   989	001000'	256200	004262'		UMOVE	T2,(T1)		;USER ARG:  DOES IT HAVE
   990	001001'	603340	000000*		TLNE	T2,OTFFLG	;"OTHER FRAME" FLAG?
   991	001002'	334740	000000*		SKIPA	P4,%UPT+UPTOFD	;YES,PICK UP THE FD
   992	001003'	201740	700000		MOVEI	P4,.FDSLF	;NO,DOING REPLICATE TO SELF
   993
   994				;HERE FROM FRMOP REPLICATE FUNCTION WITH FD IN P4, ADDRESS IN T1
   995
   996	001004'	261040	000012	XREPLU:	PUSH	P,W		;SAVE M FOR ERROR CODE STORE.
   997	001005'	256200	004263'		UMOVE	M,1(T1)		;GET USER'S ARGS IN M AND W FOR NOW
   998	001006'	256200	004264'		UMOVE	W,(T1)
   999	001007'	510401	777777*		HLLZ	T3,PDNMUP-1(P)	;GET T3/ EXEC VS. USER FLAG.
  1000	001010'	607400	010000		TLNN	T3,PC.USR	;SET USER-
  1001	001011'	625500	400000		TLZA	W,400000	;EXEC
  1002	001012'	661500	400000		TLO	W,400000	;FLAG.
  1003	001013'	260040	000000*		PUSHJ	P,FD2FNO	;GET FRAME NUMBER IN J FOR SELF CHECK
  1004	001014'	254000	001114'		  JRST	REPRL0		;OTHER FRAME DESCRIPTOR IS BAD.
  1005	001015'	312100	000000*		CAME	J,%UPT+UPTJOB	;SAME AS CALLER?
  1006	001016'	254000	001022'		JRST	VREPL1		;NO, DON'T WORRY.
  1007	001017'	621500	001001*		TLZ	W,OTFFLG	;YES, DON'T TRY TO LOCK SAME CTX PAGES IN 2 PLACES
  1008	001020'	621540	001017*		TLZ	M,OTFFLG	;MAKE BELIEVE CALLER SAID BOTH FROM HIS SPACE
  1009	001021'	254000	001026'		JRST	VREPL2		;GO DIRECTLY TO LOCK UPT.
  1010	001022'	603500	001020*	VREPL1:	TLNE	W,OTFFLG	;IF EITHER SOURCE OR DEST IS SELF,
  1011	001023'	607540	001022*		TLNN	M,OTFFLG	;
  1012	001024'	254000	001026'		JRST	VREPL2		;NEED TO LOCK UPT
  1013	001025'	254000	001041'		JRST	VREPL5		;BOTH "OTHER", MUST LOCK UPX.
  1014	001026'	607500	001023*	VREPL2:	TLNN	W,OTFFLG	;IF EITHER SOURCE OR DEST IS OTHER
  1015	001027'	603540	001026*		TLNE	M,OTFFLG	; NEED UPX
  1016	001030'	254000	001032'		JRST	VREPL6		;NEEDED
  1017	001031'	254000	001036'		JRST	VREPL7		;NOT NEEEDED
  1018	001032'	200300	000000*	VREPL6:	MOVE	T1,%UPT+UPTJOB	;GET JOB NUMBER OF RUNNING JOB
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 19-2
IOCSS.MAC	 9-OCT-87 18:01		REPLICATE,REMOVE,CLEAR,VFSTAT---VM PAGE UUO DISPATCHES

  1019	001033'	311100	000006		CAML	J,T1		;GET LOCKS IN CANNONICAL ORDER
  1020								; TO AVOID DEADLOCK
  1021					JRST	[PUSHJ	P,WLKUPT	;GET WRITE LOCK FOR OWN
  1022									; CONTEXT PAGES.
  1023						   STOPCD		;CAN'T LOCK CONTEXT PAGES
  1024									; (SHOULD NEVER HAPPEN).
  1025	001034'	254000	004265'			 JRST	VREPL5]		;NOW GET UPX LOCK
  1026	001035'	260040	001063'		PUSHJ	P,VREPLX	;GET UPX LOCK
  1027	001036'	260040	000000*	VREPL7:	PUSHJ	P,WLKUPT	;GET OWN CTX PGS WRITE LOCK
  1028	001037'	256000	000000'		  STOPCD		;CAN'T, SHOULD NEVER HAPPEN
  1029	001040'	254000	001042'		JRST	VREPL4		;NOW HAVE REQUIRED LOCKS
  1030	001041'	260040	001063'	VREPL5:	PUSHJ	P,VREPLX	;GET UPX LOCK
  1031
  1032	001042'	200300	000012	VREPL4:	MOVE	T1,W		;GET ARGS BACK IN T1 AND T2
  1033	001043'	200340	000013		MOVE	T2,M
  1034	001044'	261040	000006		PUSH	P,T1		;SAVE ARGS SO KNOW WHAT TO GIVE BACK
  1035	001045'	261040	000007		PUSH	P,T2
  1036	001046'	260040	000000*		PUSHJ	P,KREPLC	;CALL KERNEL ROUTINE, ALWAYS
  1037	001047'	254000	001105'		  JRST	REPLER
  1038	001050'	262040	000013		POP	P,M
  1039	001051'	262040	000012		POP	P,W		;GET ARGS BACK
  1040	001052'	262040	000005		POP	P,U		;GET USER'S AC NUMBER
  1041	001053'	350001	000000		AOS	(P)		;GIVE SKIP RETURN.
  1042
  1043	001054'	607500	001027*	REPRLS:	TLNN	W,OTFFLG
  1044	001055'	603540	001054*		TLNE	M,OTFFLG	;IF EITHER WAS A REAL OTHER FRAME,
  1045	001056'	260040	000000*		PUSHJ	P,ULDUPX	;RELEASE WRITE LOCK AND LOCKDOWN OF %UPX.
  1046	001057'	603500	001055*	REPRS1:	TLNE	W,OTFFLG	;IF EITHER WAS SELF,
  1047	001060'	607540	001057*		TLNN	M,OTFFLG
  1048	001061'	324740	000000*		PJRST	UNWUPT		;GIVE BACK WRITE LOCK OF UPT AND RETURN.
  1049	001062'	263040	000000		POPJ	P,		;DIDN'T HAVE UPT LOCK SO JUST RETURN.
  1050
  1051				;GET UPX LOCK
  1052	001063'	260040	000000*	VREPLX:	PUSHJ	P,WLKUPX	;TRY TO GET CONTEXT PAGES IN
  1053					  JRST	[MOVEI P3,FECLP% ;CAN'T LOCK CONTEXT PAGE ERROR IN P3
  1054						 POP	P,T1	;FLUSH RETURN ADDR
  1055	001064'	254000	004270'			 JRST REPRLU]	;AND GIVE ERROR
  1056	001065'	201700	000045		MOVEI	P3,.ARCHM	;GET READY
  1057	001066'	607500	001060*		TLNN	W,OTFFLG	;REPLICATING TO OTHER FRAME?
  1058	001067'	254000	001074'		JRST	VREP3A		;NO, DON'T NEED CHANGE MAP STATUS
  1059	001070'	261040	000017		PUSH	P,P4		;SAVE OFD IN CASE ITS FRMOP CALL
  1060	001071'	260040	000000*		PUSHJ	P,CHEKAR	;YES, CAN HE CHANGE THE MAP FOR C(P4)?
  1061					  JRST	[POP P,P4
  1062						 POP	P,T1	;FLUSH RETURN ADDR
  1063	001072'	254000	004273'			 JRST REPRLX]	;NO
  1064	001073'	262040	000017		POP	P,P4		;RESTORE
  1065	001074'	607540	001066*	VREP3A:	TLNN	M,OTFFLG	;IS HE REPLICATING FROM OTHER FRAME?
  1066	001075'	263040	000000		POPJ	P,		;NO, DONE CHECKING.
  1067	001076'	201700	000051		MOVEI	P3,.ARVAW	;ASSUME HE'S TRYING MAX WRITE
  1068	001077'	135440	004276'		LDB	T4,[POINT 2,W,7] ;GET PROTECTION
  1069	001100'	307440	000001		CAIG	T4,CPRRED	;SKIP IF WRITING.
  1070	001101'	201700	000050		 MOVEI	P3,.ARVAR	;NO, JUST READING
  1071	001102'	260040	001071*		PUSHJ	P,CHEKAR	;CHECK ACCESS, SET UP J AND %UPX WRITE LOCKED
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 19-3
IOCSS.MAC	 9-OCT-87 18:01		REPLICATE,REMOVE,CLEAR,VFSTAT---VM PAGE UUO DISPATCHES

  1072					  JRST	[POP	P,T1	;FLUSH RETURN ADDR
  1073	001103'	254000	004274'			 JRST	REPRLX]	;SOMETHING WENT WRONG.
  1074	001104'	263040	000000		POPJ	P,
  1075
  1076	001105'	262040	000013	REPLER:	POP	P,M
  1077	001106'	262040	000012		POP	P,W
  1078	001107'	262040	000005		POP	P,U
  1079	001110'	256200	004277'		UMOVEM	T1,(U)		;STORE ERROR CODE (ITS AC, SO BETTER NOT FAULT)
  1080	001111'	254000	001054'		JRST	REPRLS		;AND GO RELEASE ANY LOCK WE HAVE
  1081
  1082				;HERE FOR ERRORS WHILE SETTING UP LOCKS.
  1083
  1084				;HERE IF POSSIBLY GOT UPT LOCK BUT CAN'T GET UPX LOCK.
  1085
  1086	001112'	260040	001056*	REPRLX:	PUSHJ	P,ULDUPX	;WE KNOW WE HAVE THIS IF WE COME HERE.
  1087	001113'	260040	000000*	REPRLU:	PUSHJ	P,UNIUPT	;GET RID OF UPT IF HAVE IT.
  1088	001114'	262040	000005	REPRL0:	POP	P,U		;GET AC NUMBER OFF STACK
  1089	001115'	201300	000774*		MOVEI	T1,FALOFF	;CAN'T LOCK CONTEXT PAGES
  1090	001116'	504300	000012		HRL	T1,W		;GET W IN LH
  1091	001117'	137700	004244'		DPB	P3,FDEERP<T1> ;PUT SUB ERROR CODE IN.
  1092	001120'	256200	004277'		UMOVEM	T1,(U)		;STORE IN USER'S AC
  1093	001121'	263040	000000		POPJ	P,		;RETURN.
  1094
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 20
IOCSS.MAC	 9-OCT-87 18:01		REPLICATE,REMOVE,CLEAR,VFSTAT---VM PAGE UUO DISPATCHES

  1095				;REMOVE A PAGE AND CLEAR PAGE FUNCTIONS.
  1096				;
  1097				;CALL HAS THE FORM:
  1098				;
  1099				;    MOVE AC,[BYTE (1)0(6)0(1)CLR REF(10)CONTIG PGS(8)0(10)START PAGE]
  1100				;    VREMOV	AC, OR VCLEAR AC,
  1101				;    ERROR RETURN
  1102				;    SUCCESS RETURN
  1103				;
  1104
  1105				EXTERNAL SWRUPX,FALOFF
  1106
  1107
  1108	001122'	334600	004256'	VCLEAU::SKIPA	P1,[KCLEAR]	;ENTRY FOR VCLEAR
  1109	001123'	201600	000000*	VREMOU::MOVEI	P1,KREMOV	;
  1110	001124'	200341	000720*	VREMV2:	MOVE	T2,PDNMUP(P)	;GET CALLER'S PC
  1111	001125'	607340	010000		TLNN	T2,PC.USR	;IF EXEC,
  1112	001126'	625300	400000		TLZA	T1,(1B0)	;TURN OFF USER FLAG TO KERNEL ROUTINE
  1113	001127'	661300	400000		TLO	T1,(1B0)	;IS USER.
  1114	001130'	201700	000045		MOVEI	P3,.ARCHM	;MUST BE ABLE TO CHANGE MAP TO DO THIS.
  1115	001131'	260040	000737*		PUSHJ	P,SWRUPX	;CALL CO-ROUTINE TO WRITE LOCK UPX
  1116					  JRST	[MOVSS T1	;PAGE #,,
  1117						 HRRI T1,FALOFF ;CAN'T LOCK CONTEXT PAGES IN RH
  1118						 DPB P3,FDEERP<T1>
  1119						 UMOVEM T1,(M)  ;STORE ERROR CODE
  1120	001132'	254000	004300'			 POPJ P,]	;AND RETURN WITH ERROR.
  1121	001133'	261040	000013	KERUUO:	PUSH	P,M		;SAVE M.
  1122	001134'	260054	000000		PUSHJ	P,(P1)		;
  1123	001135'	254000	001140'		JRST	KERUER		;ERROR RETURN.
  1124	001136'	262040	000013		POP	P,M		;RESTORE M.
  1125	001137'	254000	000753*		JRST	CPOPJ1		;
  1126
  1127	001140'	262040	000013	KERUER:	POP	P,M		;RESTORE M.
  1128	001141'	256200	004245'		UMOVEM	T1,(M)		;STORE ERROR FLAGS.
  1129	001142'	263040	000000		POPJ	P,		;FAIL RETURN.
  1130
  1131				;UUO SEE IF THE F BIT IS ON FOR THIS PAGE.
  1132				;
  1133				;CALL HAS THE FORM:
  1134				;
  1135				;    MOVEI AC, VP NUMBER
  1136				;    VFSTAT	AC,
  1137				;    ERROR RETURN
  1138				;    SUCCESS RETURN
  1139				;
  1140
  1141
  1142	001143'	201600	000000*	VFLCKU::MOVEI	P1,KFILCK	;
  1143	001144'	661300	400000		TLO	T1,(1B0)	;ALWAYS LOOKS LIKE USER CALLED
  1144	001145'	254000	001133'		JRST	KERUUO		;AND DISPATCH.
  1145
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 21
IOCSS.MAC	 9-OCT-87 18:01		CLUB UUOS

  1146				SUBTTL CLUB UUOS
  1147				;UUO ADD A JOB TO A CLUB.
  1148				;
  1149				;CALL HAS THE FORM:
  1150				;
  1151				;	MOVEI	AC,VP NUMBER
  1152				;	CLBADD	AC,
  1153				;	ERROR RETURN
  1154				;	SUCCESS RETURN
  1155
  1156
  1157				EXTERN KCBADD,KCBKER
  1158
  1159	001146'	201600	000000*	UCBADD::MOVEI	P1,KCBADD
  1160	001147'	254000	000000*		JRST	KCBKER
  1161
  1162
  1163
  1164				;UUO REMOVE MY JOB FROM THE CLUB.
  1165				;
  1166				;CALL HAS THE FORM:
  1167				;
  1168				;	MOVEI	AC,VP NUMBER
  1169				;	CLBLEV	AC,
  1170				;	ERROR RETURN
  1171				;	SUCCESS RETURN
  1172
  1173
  1174				EXTERN KCBLEV
  1175
  1176	001150'	201600	000000*	UCBLEV::MOVEI	P1,KCBLEV
  1177	001151'	254000	001147*		JRST	KCBKER
  1178
  1179
  1180
  1181				;UUO GET CLUB INTERLOCK (WAIT IF NECESSARY.).
  1182				;
  1183				;CALL HAS THE FORM:
  1184				;
  1185				;	MOVEI	AC,VP NUMBER
  1186				;	CLBINW	AC,
  1187				;	ERROR RETURN
  1188				;	SUCCESS RETURN
  1189
  1190
  1191				EXTERN KCBINW
  1192
  1193	001152'	201600	000000*	UCBINW::MOVEI	P1,KCBINW
  1194	001153'	254000	001151*		JRST	KCBKER
  1195
  1196
  1197
  1198				;UUO GET CLUB INTERLOCK (IMMED.).
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 21-2
IOCSS.MAC	 9-OCT-87 18:01		CLUB UUOS

  1199				;
  1200				;CALL HAS THE FORM:
  1201				;
  1202				;	MOVE	AC,ADDR
  1203				;	CLBINI	AC,
  1204				;	ERROR RETURN
  1205				;	SUCCESS RETURN
  1206				;
  1207				;WHERE ADDR CONTAINS THE VP NUMBER.
  1208
  1209
  1210				EXTERN KCBINI
  1211
  1212	001154'	256200	004305'	UCBINI::UMOVE	T1,(T1)		;GET T1/ USER'S ARG.
  1213	001155'	201600	000000*		MOVEI	P1,KCBINI
  1214	001156'	254000	001153*		JRST	KCBKER
  1215
  1216
  1217
  1218				;UUO RELEASE CLUB INTERLOCK.
  1219				;
  1220				;CALL HAS THE FORM:
  1221				;
  1222				;	MOVEI	AC,VP NUMBER
  1223				;	CLBRLI	AC,
  1224				;	ERROR RETURN
  1225				;	SUCCESS RETURN
  1226
  1227
  1228				EXTERN KCBRLI
  1229
  1230	001157'	201600	000000*	UCBRLI::MOVEI	P1,KCBRLI
  1231	001160'	254000	001156*		JRST	KCBKER
  1232
  1233
  1234
  1235				;UUO GET COUNT OF AND ID NUMBERS OF THE MEMBERS OF THE CLUB.
  1236				;
  1237				;CALL HAS THE FORM:
  1238				;
  1239				;	MOVE	AC,ADDR
  1240				;	CLBMEM	AC,
  1241				;	ERROR RETURN
  1242				;	SUCCESS RETURN
  1243				;
  1244				;WHERE ADDR CONTAINS THE VP NUMBER, AND ADDR+1 CONTAINS THE
  1245				;NUMBER OF ID NUMBERS OF MEMBERS OF THE CLUB THAT ARE TO BE
  1246				;RETURNED (STARTING AT ADDR+1.).
  1247
  1248
  1249				EXTERN KCBMEM
  1250
  1251	001161'	256200	004306'	UCBMEM::UMOVE	T2,1(T1)	;GET T1/ 1ST ARG AND
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 21-3
IOCSS.MAC	 9-OCT-87 18:01		CLUB UUOS

  1252	001162'	256200	004305'		UMOVE	T1,(T1)		;T2/ 2ND ARG FROM USER.
  1253	001163'	201600	000000*		MOVEI	P1,KCBMEM
  1254	001164'	254000	001160*		JRST	KCBKER
  1255
  1256
  1257
  1258				;UUO GET STATUS INFO ABOUT A MEMBER OF THE CLUB.
  1259				;
  1260				;CALL HAS THE FORM:
  1261				;
  1262				;	MOVE	AC,ADDR
  1263				;	CLBSTS	AC,
  1264				;	ERROR RETURN
  1265				;	SUCCESS RETURN
  1266				;
  1267				;WHERE ADDR CONTAINS THE VP NUMBER, AND ADDR+1 CONTAINS THE
  1268				;"ID NUMBER" OF THE OTHER JOB.
  1269
  1270
  1271				EXTERN KCBSTS
  1272
  1273	001165'	256200	004306'	UCBSTS::UMOVE	T2,1(T1)	;GET T1/ 1ST ARG AND
  1274	001166'	256200	004305'		UMOVE	T1,(T1)		;T2/ 2ND ARG FROM USER.
  1275	001167'	201600	000000*		MOVEI	P1,KCBSTS
  1276	001170'	254000	001164*		JRST	KCBKER
  1277
  1278
  1279
  1280				;UUO WAKE JOB IN SAME CLUB.
  1281				;
  1282				;CALL HAS THE FORM:
  1283				;
  1284				;	MOVE	AC,ADDR
  1285				;	CLBWAK	AC,
  1286				;	ERROR RETURN
  1287				;	SUCCESS RETURN
  1288				;
  1289				;WHERE ADDR CONTAINS THE VP NUMBER AND ADDR+1 CONTAINS THE
  1290				;ID NUMBER OF THE JOB TO WAKE UP.
  1291
  1292
  1293				EXTERN KCBWAK
  1294
  1295	001171'	256200	004306'	UCBWAK::UMOVE	T2,1(T1)	;GET T1/ 1ST ARG AND
  1296	001172'	256200	004305'		UMOVE	T1,(T1)		;T2/ 2ND ARG FROM USER.
  1297	001173'	201600	000000*		MOVEI	P1,KCBWAK
  1298	001174'	254000	001170*		JRST	KCBKER
  1299
  1300
  1301
  1302				;UUO HANG JOB IN SAME CLUB.
  1303				;
  1304				;CALL HAS THE FORM:
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 21-4
IOCSS.MAC	 9-OCT-87 18:01		CLUB UUOS

  1305				;
  1306				;	MOVE	AC,ADDR
  1307				;	CLBHNG	AC,
  1308				;	ERROR RETURN
  1309				;	SUCCESS RETURN
  1310				;
  1311				;WHERE ADDR CONTAINS THE VP NUMBER AND ADDR+1 CONTAINS THE
  1312				;ID NUMBER OF THE JOB TO HANG.
  1313
  1314
  1315				EXTERN KCBHNG
  1316
  1317	001175'	256200	004306'	UCBHNG::UMOVE	T2,1(T1)	;GET T1/ 1ST ARG AND
  1318	001176'	256200	004305'		UMOVE	T1,(T1)		;T2/ 2ND ARG FROM USER.
  1319	001177'	201600	000000*		MOVEI	P1,KCBHNG
  1320	001200'	254000	001174*		JRST	KCBKER
  1321
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 22
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1322				SUBTTL VARIOUS UUOS
  1323				;RENAME MUUO - HERE ON SHORT DISPATCH TABLE DEVICES TOO
  1324
  1325				EXTERNAL CPOPJ1
  1326
  1327	001201'	201300	000020	URENAM:	MOVEI T1,DRN
  1328	001202'	260040	000077'		PUSHJ P,CHNCHK		;2-SKIP IF LONG DISPATCH. T4/DEVSER(F)
  1329	001203'	254000	000711*		 JRST ERRIUC		;NO CHANNEL.
  1330	001204'	254000	001137*		JRST CPOPJ1		;SHORT DISPATCH TABLE. SKIP RETURN.
  1331	001205'	324751	000020		PJRST DRN(T4)	;ATTEMPT A RENAME. SKIP RTN TO USER IF
  1332							;SUCCESS
  1333
  1334				;GETF MUUO - GET NEXT FREE BLOCK
  1335
  1336	001206'	201300	000015	UDGF:	MOVEI T1,DGF
  1337	001207'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  1338	001210'	254000	001203*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  1339	001211'	263040	000000		POPJ P,			;NO-OP ON SHORT DISPATCH TABLE.
  1340	001212'	254011	000015		JRST DGF(T4)
  1341
  1342				;MTAPE MUUO - MAGTAPE OPERATIONS
  1343
  1344	001213'	201300	000014	UMTAPE:	MOVEI T1,DMT
  1345	001214'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  1346	001215'	254000	001210*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  1347	001216'	263040	000000		POPJ P,			;SHORT DISPATCH TABLE.  NO OPERATION.
  1348	001217'	260051	000014		PUSHJ P,DMT(T4)
  1349	001220'	254000	000275*		JRST DEVECK	;AND CHECK ERROR WHEN FINISHED
  1350
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 23
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1351				;MAGNUM BIT CHANIO
  1352				;
  1353				;ARGUMENT 34
  1354				;
  1355				;CHANIO AC,LOC
  1356				;ERROR RETURN
  1357				;SUCCESS RETURN
  1358
  1359				;LOC: RH IS FUNCTION
  1360				;	1 UPDATER WANTS TO SET/CLEAR FLAG IN ALL DDBS ON THIS
  1361				;	  ATB.
  1362				;	2 READ AND CLEAR BIT IN OWN DDB.
  1363				;	3 IS THIS FILE BEING UPDATED?
  1364				;	4 I HAVE THIS FILE OPEN FOR UPDATE; IS THERE ALSO
  1365				;	  A READER OF IT?
  1366				;
  1367				;	LH HAS MEANING ONLY FOR FUNCTION 1, IN WHICH CASE IT
  1368				;	MEANS 0(1) CLEAR(SET).
  1369
  1370				;ON SUCCESS RETURN FOR FN 2, LOC+1 IS 0(1) IF BIT
  1371				;WAS OFF(ON).
  1372				;ON SUCCESS RETURN FOR FN 3, LOC+1 IS 0(1) IF THE FILE
  1373				;IS NOT OPEN (OPEN) FOR SINGLE UPDATE.
  1374				;ON SUCCESS RETURN FOR FN 4, LOC+1 IS 0(1) IF THE FILE
  1375				;IS NOT BEING (BEING) ALSO READ.
  1376				;ON SUCCESS RETURN FOR FN 5, LOC+1 IS # UPDATE CHANNELS IN LH,
  1377				;# VPS MAPPED FROM FILE FOR ALL USERS OF FILE WITH
  1378				;MAX WRITE ON IN RH.
  1379				;
  1380				;THIS CHANIO IS A NO-OP FOR NON-DISK DEVICES AND ALWAYS TAKES
  1381				;THE 1-SKIP RETURN FOR THEM.
  1382
  1383				EXTERN ATBFNB,ATBSTS,ATPUPD,DEPMGN,DEVBTS,DEVATB,DEVDBL,FNBDBL
  1384				EXTERN ATYCNT,ATBMWC,FNBUPD
  1385
  1386	001221'	400300	000000	MGNBIT:	SETZ	T1,		;SET UP F AND
  1387	001222'	260040	000077'		PUSHJ	P,CHNCHK	;FRIENDS.
  1388	001223'	254000	001215*		JRST	ERRIUC		;NO CHANNEL ASSIGNED.
  1389	001224'	254000	001225'		JRST	.+1		;NO WAY TO GET HERE.
  1390	001225'	200304	000004		MOVE	T1,DEVMOD(F)	;IS THIS A
  1391	001226'	607300	200000		TLNN	T1,DVDSK	;DISK?
  1392	001227'	254000	001204*		JRST	CPOPJ1		;NO.
  1393	001230'	256200	004307'		UMOVE	T3,(M)		;GET T1/ POSSIBLE ARG
  1394	001231'	554300	000010		HLRZ	T1,T3		;FOR FN 1, AND
  1395	001232'	551410	000000		HRRZI	T3,(T3)		;T3/ FUNCTION NUMBER.
  1396	001233'	303400	000005		CAILE	T3,MGNTLN	;FUNCTION DEFINED?
  1397	001234'	263040	000000		POPJ	P,		;NO.
  1398	001235'	322400	000655*		JUMPE	T3,CPOPJ	;MAYBE STILL NO.
  1399	001236'	200410	001237'		MOVE	T3,MGNTBL-1(T3)	;GET DISPATCH ADDRESS AND
  1400	001237'	254010	000000		JRST	(T3)		;GO.
  1401
  1402	001240'	000000	001245'	MGNTBL:	MGNUPD
  1403	001241'	000000	001266'		MGNRAC
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 23-2
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1404	001242'	000000	001276'		MGNCKU
  1405	001243'	000000	001306'		MGNCKR
  1406	001244'	000000	001320'		MGNSUD		;SIMULTANEOUS UPDATE INFO
  1407
  1408			000005	MGNTLN==.-MGNTBL
  1409
  1410
  1411				;FUNCTION ONE.
  1412				;SET OR CLEAR FLAGS IN ALL DDBS ON THIS ATB.
  1413	001245'	303300	000001	MGNUPD:	CAILE	T1,1		;FLAG MUST SAY
  1414	001246'	263040	000000		POPJ	P,		;CLEAR OR SET.
  1415	001247'	260040	001331'		PUSHJ	P,MEUPDR	;AM I THE UPDATER OF THIS FILE?
  1416	001250'	263040	000000		POPJ	P,		;NO.
  1417	001251'	550450	000000*		HRRZ	T4,ATBFNB(T3)	;YES.  GET FNB TO
  1418	001252'	550211	000000*		HRRZ	F,FNBDBL(T4)	;GET FIRST DDB ADDRESS.
  1419	001253'	515440	000000*		HRLZI	T4,DEPMGN	;T4 HOLDS FLAG BIT.
  1420	001254'	550344	000000*	MGNBT4:	HRRZ	T2,DEVATB(F)	;DOES THIS DDB POINT TO
  1421	001255'	312340	000010		CAME	T2,T3		;OUR ATB?
  1422	001256'	254000	001263'		JRST	MGNTB6		;NO, SKIP IT.
  1423	001257'	322300	001262'		JUMPE	T1,.+3		;YES. DO WE WANT TO CLEAR THE FLAG?
  1424	001260'	436444	000000*		IORM	T4,DEVBTS(F)	;NO, SET THE FLAG.
  1425	001261'	254000	001263'		JRST	MGNTB6		;
  1426	001262'	412444	001260*		ANDCAM	T4,DEVBTS(F)	;YES, CLEAR THE FLAG.
  1427	001263'	550204	000000*	MGNTB6:	HRRZ	F,DEVDBL(F)	;GET NEXT DDB.
  1428	001264'	326200	001254'		JUMPN	F,MGNBT4	;JUMP IF ANOTHER.
  1429	001265'	254000	001227*		JRST	CPOPJ1		;ALL DONE.
  1430
  1431				;FUNCTION TWO.
  1432				;READ AND THEN CLEAR THE BIT IN OUR DDB.
  1433	001266'	200304	001262*	MGNRAC:	MOVE	T1,DEVBTS(F)	;GET THE BIT.
  1434	001267'	400340	000000		SETZ	T2,		;SET LOC+1 TO
  1435	001270'	603300	001253*		TLNE	T1,DEPMGN	;ZERO UNLESS THE
  1436	001271'	201340	000001		MOVEI	T2,1		;BIT IS
  1437	001272'	256200	004310'		UMOVEM	T2,1(M)		;SET.
  1438	001273'	515340	001270*		HRLZI	T2,DEPMGN	;TURN OFF
  1439	001274'	412344	001266*		ANDCAM	T2,DEVBTS(F)	;THE BIT.
  1440	001275'	254000	001265*		JRST	CPOPJ1		;RETURN.
  1441
  1442				;FUNCTION THREE.
  1443				;IS THIS FILE BEING UPDATED?
  1444	001276'	550344	001254*	MGNCKU:	HRRZ	T2,DEVATB(F)	;BETTER BE A
  1445	001277'	322340	001235*		JUMPE	T2,CPOPJ	;FILE OPEN FOR US.
  1446	001300'	400440	000000		SETZ	T4,		;
  1447	001301'	200307	000000*		MOVE	T1,ATBSTS(T2)	;IS THE FILE BEING
  1448	001302'	602300	000000*		TRNE	T1,ATPUPD	;UPDATED IN SINGLE MODE?
  1449	001303'	201440	000001		MOVEI	T4,1		;YES.
  1450	001304'	256200	004311'		UMOVEM	T4,1(M)
  1451	001305'	254000	001275*		JRST	CPOPJ1
  1452
  1453				;FUNCTION FOUR.
  1454				;I AM UPDATING THIS FILE; DOES IT ALSO HAVE A READER?
  1455	001306'	260040	001331'	MGNCKR:	PUSHJ	P,MEUPDR	;AM I UPDATING THIS FILE?
  1456	001307'	263040	000000		POPJ	P,		;NO.
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 23-3
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1457	001310'	250640	000010		EXCH	P2,T3		;SAVE P2 AND SET IT UP FOR
  1458	001311'	135440	000000*		LDB	T4,ATYCNT	;ATYCNT.
  1459	001312'	200640	000010		MOVE	P2,T3		;RESTORE P2.
  1460	001313'	305440	000002		CAIGE	T4,2		;A READER?
  1461	001314'	634400	000010		TDZA	T3,T3		;NO.
  1462	001315'	201400	000001		MOVEI	T3,1		;YES.
  1463	001316'	256200	004312'		UMOVEM	T3,1(M)
  1464	001317'	254000	001305*		JRST	CPOPJ1
  1465
  1466				;FUNCTION FIVE.
  1467				;RETURN # UPDATING CHANNELS,,# VPS FOR ALL FILE USERS MAPPED WRITABLE FROM THIS FILE.
  1468
  1469	001320'	550344	001276*	MGNSUD:	HRRZ	T2,DEVATB(F)	;GET ATB
  1470	001321'	322340	001277*		JUMPE	T2,CPOPJ	;MUST HAVE A FILE OPEN ON THIS CHAN
  1471	001322'	550307	000000*		HRRZ	T1,ATBMWC(T2)	;CHANNELS PLUS PAGES
  1472	001323'	550347	001251*		HRRZ	T2,ATBFNB(T2)	;GET FNB ADDRESS
  1473	001324'	550347	000000*		HRRZ	T2,FNBUPD(T2)	;GET UPDATING CHANNEL COUNT
  1474	001325'	274300	000007		SUB	T1,T2		;T1 = 0,,PAGES
  1475	001326'	504300	000007		HRL	T1,T2		;T1 = CHANNELS,,PAGES
  1476	001327'	256200	004313'		UMOVEM	T1,1(M)		;RETURN ARG TO USER
  1477	001330'	254000	001317*		JRST	CPOPJ1		;GOOD RETURN.
  1478
  1479
  1480
  1481
  1482	001331'	603200	020000	MEUPDR:	TLNE	F,ENTRB		;IF WE ARE THE UPDATER,
  1483	001332'	607200	040000		TLNN	F,LOOKB		;THEN BOTH ENTRB AND LOOKB
  1484	001333'	263040	000000		POPJ	P,		;MUST BE SET, AND NEITHER OF
  1485	001334'	607200	002000		TLNN	F,ICLOSB	;THEM CAN HAVE BEEN
  1486	001335'	603200	001000		TLNE	F,OCLOSB	;CLOSED.
  1487	001336'	263040	000000		POPJ	P,		;
  1488	001337'	550404	001320*		HRRZ	T3,DEVATB(F)	;SAVE OUR ATB FOR COMPARE.
  1489	001340'	200450	001301*		MOVE	T4,ATBSTS(T3)	;MAKE SURE OF
  1490	001341'	602440	001302*		TRNE	T4,ATPUPD	;UPDATE MODE.
  1491	001342'	350001	000000		AOS	(P)		;YES.
  1492	001343'	263040	000000		POPJ	P,
  1493
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 24
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1494				;USETI UUO - SET NEXT INPUT BLOCK NUMBER
  1495
  1496	001344'			FWUSI:
  1497	001344'	256200	004314'	 XCTBU <SKIPA	M,(M)>		;GET FULL WORD ARGUMENT
  1498	001345'	553000	000013	UDSI:	 HRRZS M		;CLEAR (FOR 2 KINDS OF USETI)
  1499	001346'	201300	000000	UDSIP:	MOVEI T1,0
  1500	001347'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  1501	001350'	254000	001223*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  1502	001351'	263040	000000		POPJ P,			;NO-OP ON SHORT DISPATCH TABLE.
  1503	001352'	260040	001672'	UDSIP0:	PUSHJ P,WAITIO
  1504	001353'	135300	000173*		LDB T1,PIOMOD
  1505	001354'	305300	000015		CAIGE T1,SD
  1506	001355'	603200	002000		TLNE F,ICLOSB
  1507	001356'	254000	001361'		JRST UDSI1		;NO BUFFERS TO CLEAN UP
  1508	001357'	603200	010400		TLNE F,INBFB+INPB	;AND BUFFERS?
  1509	001360'	260040	000302'		PUSHJ P,BFICLN		;CLEAR THEM
  1510	001361'	201300	000021	UDSI1:	MOVEI T1,DSI
  1511	001362'	260040	000104'		PUSHJ P,CHNCK2
  1512	001363'	263040	000000		 POPJ P,		;NOT IN TABLE (ALWAYS CLEAR BUFFERS)
  1513	001364'	260051	000021		PUSHJ P,DSI(T4)
  1514	001365'	254000	001220*		JRST DEVECK		;EXIT WITH ERROR CHECK
  1515
  1516	001366'	256200	004315'	PGUSI:	UMOVE M,(M)
  1517	001367'	323540	001346'		JUMPLE	M,UDSIP
  1518	001370'	400300	000000		SETZ	T1,
  1519	001371'	260040	000077'		PUSHJ	P,CHNCHK	;SET UP ACS.
  1520	001372'	254000	001350*		JRST	ERRIUC
  1521	001373'	263040	000000		POPJ	P,
  1522	001374'	242540	000002		LSH	M,2
  1523			100000	IOSUPR=100000
  1524	001375'	607000	100000		TLNN	S,IOSUPR
  1525	001376'	607200	060000		TLNN	F,LOOKB!ENTRB
  1526	001377'	254000	001352'		JRST	UDSIP0
  1527	001400'	275540	000003		SUBI	M,3
  1528	001401'	254000	001352'		JRST UDSIP0
  1529
  1530	001402'	256200	004315'	PGUSO:	UMOVE M,(M)
  1531	001403'	323540	001420'		JUMPLE	M,UDSOP
  1532	001404'	400300	000000		SETZ	T1,
  1533	001405'	260040	000077'		PUSHJ	P,CHNCHK
  1534	001406'	254000	001372*		JRST	ERRIUC
  1535	001407'	263040	000000		POPJ	P,
  1536	001410'	242540	000002		LSH	M,2
  1537	001411'	607000	100000		TLNN	S,IOSUPR
  1538	001412'	607200	020000		TLNN	F,ENTRB
  1539	001413'	254000	001424'		JRST	UDSOP0
  1540	001414'	275540	000003		SUBI	M,3
  1541	001415'	254000	001424'		JRST UDSOP0	;AND FOR USETO
  1542
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 25
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1543				;USETO UUO - SET NEXT OUTPUT BLOCK NUMBER
  1544
  1545	001416'			FWUSO:
  1546	001416'	256200	004314'	 XCTBU <SKIPA	M,(M)>		;FULL WORD ARGUMENT
  1547	001417'	553000	000013	UDSO:	 HRRZS M
  1548	001420'	201300	000000	UDSOP:	MOVEI T1,0
  1549	001421'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  1550	001422'	254000	001406*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  1551	001423'	263040	000000		POPJ P,			;NO-OP ON SHORT DISPATCH TABLE.
  1552	001424'	260040	001672'	UDSOP0:	PUSHJ P,WAITIO	;WAIT FOR DEVICE TO STOP
  1553	001425'	135300	001353*		LDB T1,PIOMOD		;MUST CLEAN UP BUFFERS
  1554	001426'	305300	000015		CAIGE T1,SD
  1555	001427'	603200	001000		TLNE F,OCLOSB		;IF DUMP OR CLOSED
  1556	001430'	254000	001475'		JRST UDSO4		;NO BUFFERS TO CLEAN
  1557	001431'	607200	004200		TLNN F,OUTBFB+OUTPB	;AND BUFFERS?
  1558	001432'	254000	001475'		JRST UDSO4		;NO
  1559	001433'	554244	000006		HLRZ U,DEVBUF(F)
  1560	001434'	256200	004210'	 XCTBU <SKIPG (U)>	;VIRGIN RING?
  1561	001435'	254000	001475'		 JRST UDSO4		;YES
  1562	001436'	550304	000010	UDSO2:	HRRZ T1,DEVOAD(F)
  1563	001437'	256200	004211'	 XCTBU <SKIPL (T1)>	;IS THIS BUFFER TO BE DUMPED?
  1564	001440'	254000	001455'		 JRST UDSO3		;NO PROCEED
  1565	001441'	620000	760000		TRZ S,760000		;CLEAR ERROR BITS
  1566	001442'	661000	000020		TLO S,IO		;MUST BE ON FOR DSK,OUTPUT
  1567	001443'	261040	000013		PUSH P,M
  1568	001444'	135340	000302*		LDB T2,DEYCLS
  1569	001445'	256007	001736'		XCT CLOBUF(T2)	;WORRY ABOUT SETTIN UP A COMMAND LIST
  1570	001446'	254000	001452'		JRST UDSO2C	;CLASS DEPENDENT CODE DID IT ALL
  1571	001447'	550444	000003		HRRZ T4,DEVSER(F)	;MAKE SURE STILL AROUND
  1572	001450'	260051	000010		PUSHJ P,DOU(T4)		;START DEVICE
  1573	001451'	260040	000627*		PUSHJ P,WAIT1
  1574	001452'	262040	000013	UDSO2C:	POP P,M
  1575	001453'	606000	760000		TRNN S,760000		;CHECK FOR ERRORS
  1576	001454'	254000	001436'		JRST UDSO2		;NONE- SEE IF MORE TO BE DUMPED
  1577	001455'	554344	000006	UDSO3:	HLRZ T2,DEVBUF(F)
  1578	001456'	256200	004316'		UMOVE T3,(T2)		;NOW SEE IF LAST BUFFER TO BE WRITTEN
  1579	001457'	603400	200000		TLNE T3,IOADVB
  1580	001460'	254000	001467'		JRST UDSO3A		;ADVANCED, JUST CALL OUT
  1581	001461'	256200	004317'	 XCTBU <HRRZ U,1(T2)>		;GET BYTE POINTER
  1582	001462'	332000	000005		SKIPE U			;IGNORE IF NONE
  1583	001463'	275250	000001		SUBI U,1(T3)		;COMPUTE WORD COUNT
  1584	001464'	602000	000020		TRNE S,IOWC		;COMPUTING OWN WORD COUNT?
  1585	001465'	256200	004320'	 XCTBU <HRRZ U,1(T3)>		;YES, GET IT
  1586	001466'	322240	001474'		JUMPE U,UDSO1		;NOTHING TO DUMP
  1587	001467'	261040	000013	UDSO3A:	PUSH P,M
  1588	001470'	513000	000013		HLLZS M			;MAKE SURE OF 0 SO DON'T THINK A BUFFER CHANGE
  1589	001471'	260040	002266'		PUSHJ P,OUT		;DUMP LAST BUFFER
  1590	001472'	260040	001451*		PUSHJ P,WAIT1
  1591	001473'	262040	000013		POP P,M
  1592	001474'	550444	000003	UDSO1:	HRRZ T4,DEVSER(F)
  1593	001475'	201300	000022	UDSO4:	MOVEI T1,DSO
  1594	001476'	260040	000104'		PUSHJ P,CHNCK2
  1595	001477'	263040	000000		 POPJ P,		;DONE
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 25-2
IOCSS.MAC	 9-OCT-87 18:01		VARIOUS UUOS

  1596
  1597	001500'	260051	000022		PUSHJ P,DSO(T4)
  1598	001501'	254000	001365*		JRST DEVECK	;AND AN ERROR CHECK
  1599
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 26
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1600				SUBTTL IN,INPUT		OUTPUT,OUT
  1601
  1602			000004	XP STDRNG,4	;NUMBER OF BUFFERS IN STANDARD RING
  1603
  1604				;INPUT UUO
  1605
  1606
  1607				;1)  IF OUTPUT ACTIVE ON THIS CHANNEL, WAIT FOR IT TO COMPLETE.
  1608				;2)  IF DUMP MODE, WAIT FOR DEVICE INACTIVE, CALL SERVICE
  1609				;	ROUTINE TO START INPUT, WAIT TILL COMPLETE, THEN RETURN TO USER.
  1610				;3)  IF NO BUFFER RING SETUP, SET UP 2 RING BUFFER.
  1611				;4)  IF FIRST REFERENCE, START SERVICE ROUTINE, GO TO
  1612				;5)  FLAG CURRENT BUFFER AS FREE TO RECEIVE MORE INPUT
  1613				;	(USE BIT SET TO 0).
  1614				;	START SERVICE ROUTINE FILLING FIRST BUFFER WITH USE BIT 0
  1615				;	(NEXT BUFFER OR ONE AHEAD OF IT)
  1616				;	(SERVICE ROUTINE WILL SET USE BIT WHEN IT FINISHES FILLING
  1617				;	BUFFER).
  1618				;7)  IF NEXT INPUT BUFFER IS FULL OF DATA, GO TO 10).
  1619				;8)  PUT JOB IN IO WAIT TILL NEXT BUFFER FILLED.
  1620				;9)  IF NEXT INPUT BUFFER STILL NOT FILLED, CHECK FOR END
  1621				;	OF FILE OR ERROR BITS SET BY SERVICE ROUTINE.
  1622				;10) CONVERT WORD COUNT AS STORED BY SERVICE ROUTINE IN THIRD
  1623				;	WORD OF BUFFER TO J COUNT AND STORE IN THIRD WORD
  1624				;	OF HEADER (J COUNT) ALSO SET BYTE POINTER (SECOND
  1625				;	WORD OF HEADER) AND RETURN TO USER.
  1626
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 27
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1627	001502'	606540	777777	CNGIN:	TRNN M,-1	;IS USER CHANGING RINGS
  1628	001503'	263040	000000		POPJ P,		;NO - RETURN IMMEDIATELY
  1629	001504'	260040	001472*		PUSHJ  P,WAIT1	;WAIT FOR I/O TO COMPLETE
  1630	001505'	606340	777777		TRNN T2,-1		;DID HE HAVE A PREVIOUS BUFFER?
  1631	001506'	254000	001512'		JRST SETNEW		;NO - SKIP NEXT
  1632	001507'	661300	200000		TLO T1,IOADVB	;THIS ONE OFF TOO
  1633	001510'	256200	004321'	 XCTBU <ANDCAM T1,(T2)>	;AND THEN MAKE IT AVAILABLE
  1634	001511'	621300	200000		TLZ T1,IOADVB	;AND CLEAR IT AGAIN
  1635	001512'			SETNEW:
  1636	001512'	256200	004322'	 XCTBU <HRRM M,(U)>		;POINT HEADER TO NEW RING
  1637	001513'	505340	400000		HRLI T2,IOUSE		;GET SET TO SET BIT
  1638	001514'	540340	000013		HRR T2,M		;AND LOAD NEW POINTER
  1639	001515'	256200	004215'	 XCTBU <IORM T1,(U)>		;VIRGIN BIT FOR NEW RING
  1640	001516'	200004	000002		MOVE S,DEVIOS(F)	;LOAD S JUST IN CASE
  1641	001517'	263040	000000		POPJ P,0		;RETURN WITH TRANSPARENT CHANGES
  1642				EXTERNAL DEYCLS,DEYMCT,DEYTCT,GET4WD,FCWAIT,FCREQ
  1643				EXTERNAL GIV4WD,DEVEC1
  1644
  1645	001520'	201300	000011	IN:	MOVEI T1,DIN
  1646	001521'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  1647	001522'	254000	001422*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  1648	001523'	255000	000000		JFCL			;SHORT DISPATCH TABLE OK.
  1649	001524'	260040	001530'		PUSHJ P,INCOM
  1650	001525'	260040	003423'		PUSHJ	P,GETSTS	;GET STATUS
  1651	001526'	540000	000006		HRR	S,T1
  1652	001527'	254000	000000*		JRST 	DEVEC1
  1653
  1654	001530'	603000	000020	INCOM:	TLNE S,IO		;IS THIS DEVICE ALREADY DOING OUTPUT?
  1655	001531'	260040	001701'		PUSHJ P,WAITO		;YES, WAIT TILL IT IS FINISHED.
  1656	001532'	661200	010000		TLO F,INPB		;FOR THIS DEVICE.
  1657	001533'	621200	002000		TLZ F,ICLOSB
  1658	001534'	502212	000000*		HLLM F,%UPT+UPTJDA(W)	;IN LH OF CURRENT JOB DEVICE CHANNEL
  1659	001535'	135300	001425*		LDB T1,PIOMOD		;IO MODE
  1660	001536'	301300	000015		CAIL T1,SD		;IT THE IO MODE DUMP(SD,D,DR)?
  1661	001537'	254000	001661'		JRST INDMP		;YES
  1662	001540'	540244	000006	IN1:	HRR U,DEVBUF(F)	;NO, GET ADDRESS OF BUFFER HEADER
  1663	001541'	515300	400000		HRLZI T1,IOUSE		;BUFFER INUSE BIT
  1664	001542'	200004	000002		MOVE S,DEVIOS(F)	;SETUP IO STATUS AGAIN FORM FROM MEMORY
  1665								; AC S IS CLOBBERED BY AUTOMATIC CORE EXPANSION
  1666								; ON AN IMPLICIT INBUF ON FIRST INPUT
  1667	001543'	256200	004323'		UMOVE T2,(U)		;GET WORD 1 OF 3 WORD BUFFER HEADER.
  1668	001544'	260040	001502'		PUSHJ P,CNGIN		;GO SEE IF USER CHANGING RINGS
  1669	001545'	323340	001642'		JUMPLE T2,INPUTF		;THIS IS STILL HERE
  1670	001546'	200004	000002		MOVE	S,DEVIOS(F)
  1671	001547'	603340	200000		TLNE T2,IOADVB		;IS BUFFER ALREADY ADVANCED?
  1672	001550'	254000	001555'		 JRST INPUT4	;YES
  1673	001551'	256200	004324'	 XCTBU <ANDCAB T1,(T2)>		;FLAG CURRENT BUFFER AS FREE TO
  1674								; RECEIVE MORE INPUT, CLEAR USE BIT
  1675								; AND GET POINTER TO NEXT BUFFER
  1676	001552'	256200	004325'	 XCTBU <HRRM T1,(U)>		;SET WORD 1 IN 3 WORD HEADER TO NEXT BUFFER
  1677	001553'	205600	200000		MOVSI P1,IOADVB
  1678	001554'	256200	004326'	 XCTBU <IORM P1,(U)>		;NOW WE HAVE IT SET IN CASE INTERUPT
  1679	001555'	135600	001444*	INPUT4:	LDB	P1,DEYCLS	;GET CLASS INDEX
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 27-2
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1680	001556'	256014	001716'		XCT	CLAI(P1)	;CALL CLASS DEP. CODE
  1681	001557'	254000	001606'		JRST	INPUT2
  1682	001560'	602000	010000		TRNE S,IOACT		;IS THE DEVICE ALREADY ACTIVE
  1683	001561'	254000	001600'		JRST INPT0C		;YES
  1684	001562'	256200	004327'	 XCTBU <HRRZ T1,(U)>	;MAKE SURE THIS POINTS TO CURRENT
  1685	001563'	200604	000004		MOVE P1,DEVMOD(F)	;GET DEVICE CHARACTERISTIC WORD
  1686	001564'	607600	004010		TLNN P1,DVTTY!DVRMT		;IS IT A TTY?
  1687	001565'	602000	000040		TRNE S,IOCON		;DO NOT LOOK AHEAD IF SYNC MODE
  1688	001566'	334000	000000		 SKIPA
  1689	001567'	256200	004330'	 XCTBU <HRR T1,(T1)>		;GET POINTER 1 BUFFER AHEAD OF NEXT BUFFER
  1690								; IF NOT TTY.
  1691	001570'	256200	004331'	 XCTBU <SKIPGE (T1)>		;IS THE USE BIT SET?
  1692	001571'	254000	001600'		 JRST	INPT0C		;BUFFER IIS FULL
  1693	001572'	606000	760000		TRNN	S,760000	;ANY ERRORS?
  1694	001573'	254000	001577'		 JRST	INPT0B		;NO. HANDLE NORMALLY
  1695	001574'	256200	004327'	 XCTBU <HRRZ T1,(U)>		;ADDRESS OF NEXT BUFFER
  1696	001575'	256200	004331'	 XCTBU <SKIPGE (T1)>		;CURRENT BUFFER FULL?
  1697	001576'	254000	001600'		 JRST	INPT0C		;YES
  1698	001577'	260040	001746'	INPT0B:	PUSHJ P,CALIN		;NO, START SERVICE ROUTINE FILLING EMPTY BUFFER
  1699	001600'			INPT0C:
  1700	001600'	256200	004332'	 XCTBU <HRR T2,(U)>		;GET USE BIT FOR NEXT BUFFER
  1701	001601'			INPT0A:
  1702	001601'	256200	004333'	 XCTBU <SKIPGE (T2)>		;IS USE BIT SET YET?(BUFFER FILLED YET?)
  1703	001602'	254000	001606'		 JRST INPUT2		;YES, RETURN IMMEDIATELY TO USER
  1704	001603'	260040	000000*	INPT2:	PUSHJ P,WSYNC		;NO, PUT JOB IN IO WAIT TILL BUFFER FILLED.
  1705	001604'	256200	004334'	 XCTBU <SKIPL (T2)>		;RETURN WHEN BUFFER FILLED. CHECK TO MAKE SURE.
  1706	001605'	254000	001612'		 JRST INEOF1		;NO, MUST BE EOF OR ERROR
  1707	001606'	256200	004335'	INPUT2:	UMOVE J,1(T2)		;RH OF 3RD WORD(FIRST SO-CALLED DATA WORD)
  1708	001607'	205300	200000		MOVSI T1,IOADVB
  1709	001610'	256200	004216'	 XCTBU <ANDCAM T1,(U)>	;CLEAR THE BIT SO ADVANCE NEXT TIME
  1710	001611'	254000	004071'		JRST IOSETC	;SET J COUNT AND BYTE POINTER
  1711								; IN 3 WORD HEADER AND RETURN TO USER
  1712
  1713	001612'	135300	001555*	INEOF1:	LDB 	T1,DEYCLS
  1714	001613'	256006	001716'		XCT	CLAI(T1)	;NEED TO ADV SINCE CALIN STARTED DEVICE
  1715	001614'	254000	001606'		 JRST	INPUT2
  1716	001615'	256200	004333'	 XCTBU <SKIPGE (T2)>
  1717	001616'	254000	001606'		 JRST	INPUT2
  1718	001617'	616000	004336'		TDNN S,[XWD IOEND,IODERR+IOBKTL+IODTER+IOIMPM]
  1719								; EOF OR ERROR BIT SET BY SERVICE ROUTINE
  1720	001620'	254000	001627'		 JRST INEOF2	;POSSIBLY FT DOING SKIP
  1721	001621'	205300	200000		MOVSI T1,IOADVB
  1722	001622'	256200	004216'	 XCTBU <ANDCAM T1,(U)>
  1723	001623'	603000	000040		TLNE S,IOEND		;IS THIS EOF?
  1724	001624'	660000	020000		TRO S,IODEND		;YES, SET USER EOF BIT.
  1725	001625'	436004	000002		IORM S,DEVIOS(F)
  1726	001626'	263040	000000		POPJ P,		;RETURN TO USER'S PROGRAM
  1727
  1728
  1729	001627'	550244	000006	INEOF2:	HRRZ U,DEVBUF(F)
  1730	001630'	256200	004332'	 XCTBU <HRR T2,(U)>	;GET REGISTERS RESET
  1731	001631'	602000	010000		TRNE S,IOACT	;IS DEVICE ACTIVE?
  1732	001632'	254000	001601'		 JRST INPT0A	;YES, WAIT FOR IT TO STOP IF BUFFER NOT FULL
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 27-3
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1733	001633'	135300	001612*		LDB T1,DEYCLS
  1734	001634'	256006	001716'		XCT CLAI(T1)	;DEVICE STOPPED, MAY NEED TO FINISH ADVBFF
  1735	001635'	254000	001606'		 JRST INPUT2	;DEVICE ROUTINE DID IT, RETURN
  1736	001636'	256200	004333'	 XCTBU <SKIPGE (T2)>	;IS BUFFER FULL NOW?
  1737	001637'	254000	001606'		 JRST INPUT2	;YES, RETURN TO USER
  1738	001640'	542344	000007		HRRM T2,DEVIAD(F)	;MAKE SURE USER POINTS TO THIS RING
  1739	001641'	254000	001577'		JRST INPT0B	;AND CONTINUE
  1740
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 28
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1741				;HERE ON FIRST INPUT AFTER INIT, INIT & LOOKUP, OR INIT & LOOKUP & INPUT
  1742	001642'	661300	200000	INPUTF:	TLO T1,IOADVB	;MAKE SURE THIS IS CLEARED TOO
  1743	001643'	256200	004337'	 XCTBU <ANDCAB T1,(U)>	;MARK THAT BUFFERS HAVE BEEN REFER
  1744								; BY CLEARING SIGN BIT OF 1ST WORD IN 3 WORD
  1745								; IN 3 WORD BUFFER HEADER
  1746	001644'	322300	001655'		JUMPE T1,INPUT3	;HAS A RING BEEN SET UP YET?
  1747	001645'	260040	001504*		PUSHJ P,WAIT1		;WAIT FOR I/O TO STOP
  1748	001646'	542304	000007		HRRM T1,DEVIAD(F)	;YES, STORE ADR. OF 2ND WORD OF
  1749								; A BUFFER FOR SERVICE ROUTINE
  1750	001647'	205300	200000		MOVSI T1,IOADVB		;IN CASE CLAI(T1) TRAPS & WE
  1751	001650'	256200	004215'	 XCTBU <IORM T1,(U)>	;RE-EXECUTE THE INPUT. AAA DEC 76
  1752	001651'	135300	001633*		LDB	T1,DEYCLS	; CLASS INDEX
  1753	001652'	256006	001716'		XCT	CLAI(T1)	;CALL CLASS DEPENDENT ROUTINE
  1754	001653'	254000	001606'		JRST	INPUT2
  1755	001654'	254000	001577'		JRST INPT0B
  1756	001655'	541540	000004	INPUT3:	HRRI M,STDRNG	;RING NOT SETUP YET,SETUP STD SIZE RING
  1757	001656'	260040	000350'		PUSHJ P, UINBF
  1758	001657'	513000	000013		HLLZS M		;CLEAR RIGHT HALF
  1759	001660'	254000	001540'		JRST IN1
  1760
  1761	001661'	260040	001603*	INDMP:	PUSHJ P,WSYNC		;INPUT DUMP
  1762	001662'	205000	000020		MOVSI S,IO
  1763	001663'	413004	000002		ANDCAB S,DEVIOS(F)	;FORCE TO INPUT STATE
  1764	001664'	135300	001651*		LDB	T1,DEYCLS	;CLASS INDEX
  1765	001665'	256006	001726'		XCT	CLIDMP(T1)	;CALL DUMP CLASS ROUTINE
  1766	001666'	263040	000000		POPJ P,		;DUMP MODE IS FINISHED
  1767	001667'	550444	000003		HRRZ	T4,DEVSER(F)
  1768	001670'	260051	777777		PUSHJ P,DDI(T4)	;CALL SERVICE ROUTINE
  1769	001671'	254000	001645*		JRST WAIT1		;THEN WAIT TILL IO  FINISHED BEFORE
  1770								; RETURNING TO USER.
  1771
  1772				; WAIT FOR I/O TO COMPLETE AND MAKE SURE BUFFERS HAVE BEEN ADVANCED
  1773
  1774	001672'	603000	000020	WAITIO::TLNE S,IO	;OUTPUT?
  1775	001673'	254000	001701'		JRST WAITO	;NO. INPUT- SO WAIT FOR OUTPUT TO FINISH
  1776	001674'	260040	001671*	WAITI:	PUSHJ P,WAIT1
  1777	001675'	135300	001664*		LDB T1,DEYCLS
  1778	001676'	256006	001706'		XCT WCLAI(T1)	;CALL CLASS DEPENDENT ROUTINE TO ADVANCE BUFFERS
  1779	001677'	255000	000000		JFCL
  1780	001700'	263040	000000		POPJ P,
  1781	001701'	260040	001674*	WAITO:	PUSHJ P,WAIT1
  1782	001702'	135300	001675*		LDB T1,DEYCLS
  1783	001703'	256006	001712'		XCT WCLA(T1)
  1784	001704'	255000	000000		JFCL
  1785	001705'	263040	000000		POPJ P,
  1786
  1787	001706'	334000	000000	WCLAI:	SKIPA		;NO NEED TOCALL CLASS ROUTINE
  1788	001707'	334000	000000		SKIPA
  1789	001710'	256006	001716'		XCT CLAI(T1)	;CALL CLASS ROUTINE FOR DSK
  1790	001711'	256006	001716'		XCT CLAI(T1)	;AND MT
  1791
  1792	001712'	334000	000000	WCLA:	SKIPA
  1793	001713'	334000	000000		SKIPA
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 28-2
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1794	001714'	256006	001732'		XCT CLA(T1)
  1795	001715'	256006	001732'		XCT CLA(T1)
  1796
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 29
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1797				;
  1798				;  CLASS DEPENDENT CALL TABLE - INPUT
  1799				;
  1800				CLAI:	PUSHJ P,[PUSHJ P,MBICDR
  1801						SKIPA
  1802						AOS (P)
  1803						XCTBU <HRRZ T2,(U)>
  1804	001716'	260040	004341'			POPJ P,]
  1805	001717'	334000	000000		SKIPA
  1806	001720'	334000	000000		SKIPA		;DSK. SIMIO PKG DOES ALL BUFF ADV
  1807	001721'	260040	002513'		PUSHJ	P,DTIDR1
  1808	001722'	334000	000000	CLIBUF:	SKIPA
  1809	001723'	334000	000000		SKIPA
  1810	001724'	260040	000000*		PUSHJ P,SIMBIN	;SIMULATED BUFFERED INPUT
  1811	001725'	260040	002563'		PUSHJ	P,DTIDR2
  1812	001726'	256000	000000'	CLIDMP:	 STOPCD
  1813	001727'	256000	000000'		 STOPCD
  1814	001730'	260040	000000*		PUSHJ P,SIMDMP
  1815	001731'	260040	003015'		PUSHJ	P,DTIDR3
  1816
  1817
  1818				;EXTERNS FROM SIMIO MODULE
  1819				EXTERN SIMBIN,SIMBOU,SIMDMP
  1820				EXTERN UPTSIM ;FOR DEBUG. LIVES IN COMMON & UPT. DELETE EVENTUALLY
  1821				;OUTPUT
  1822				;	DISPATCH TABLE FOR CLASS DEPENDENT ROUTINES- SKIPA'S
  1823				;	TO BE REPLACED BY PUSHJ'S FOR DEVICES THAT NEED IT
  1824				;
  1825	001732'	260040	002430'	CLA:	PUSHJ	P,MBCDR
  1826	001733'	334000	000000		SKIPA
  1827	001734'	334000	000000		SKIPA		;DSK. SIMIO PKG DOES ALL BUFF ADVANCE
  1828	001735'	260040	003000'		PUSHJ	P,DTODR1
  1829	001736'	334000	000000	CLOBUF:	SKIPA
  1830	001737'	334000	000000		SKIPA
  1831	001740'	260040	000000*		PUSHJ P,SIMBOU
  1832	001741'	260040	002730'		PUSHJ	P,DTODR2
  1833	001742'	256000	000000'	CLODMP:	 STOPCD
  1834	001743'	256000	000000'		 STOPCD
  1835	001744'	260040	001730*		PUSHJ P,SIMDMP
  1836	001745'	260040	003015'		PUSHJ	P,DTIDR3
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 30
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1837
  1838	001746'	603000	000040	CALIN:	TLNE S,IOEND
  1839	001747'	263040	000000		POPJ P,
  1840	001750'	261040	000005		PUSH P,U
  1841	001751'	205000	000030		MOVSI S,IOSTBL!IO		;RESET ERROR FLAG
  1842	001752'	413004	000002		ANDCAB S,DEVIOS(F)
  1843	001753'	135300	001702*		LDB	T1,DEYCLS	;CLASS INDEX
  1844	001754'	256006	001722'		XCT	CLIBUF(T1)	;CALL BUFFER INPUT CLASS ROUTINE
  1845	001755'	254000	001760'		JRST	CALIN1
  1846	001756'	550444	000003		HRRZ	T4,DEVSER(F)
  1847	001757'	260051	000011		PUSHJ P,DIN(T4)	;DISPATCH TO IO SERVICE ROUTINE
  1848	001760'	262040	000005	CALIN1:	POP P,U
  1849	001761'	263040	000000		POPJ P,
  1850
  1851
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 31
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1852				;
  1853				;	MONITOR BUFFER CLASS DEPENDENT INPUT ROUTINE
  1854				;
  1855	001762'	607000	000002	MBICDR:	TLNN	S,IOBEG		;VIRGIN DEVICE?
  1856	001763'	254000	001775'		 JRST	MBICD1		;NO
  1857	001764'	550304	000011		HRRZ	T1,DEVCLS(F)	;BUFFER POINTER
  1858	001765'	506306	777776		HRLM	T1,-2(T1)	;SET IN=FIRST
  1859	001766'	542306	777776		HRRM	T1,-2(T1)	; AND OUT=FIRST
  1860	001767'	513004	000013		HLLZS	DEVPWC(F)	;CLEAR PARTIAL WORD COUNT
  1861	001770'	200346	777777		MOVE	T2,-1(T1)	;END OF BUFFER +1
  1862	001771'	402006	000000		SETZM	(T1)		;CLEAR FIRST WORD OF BUFFER
  1863	001772'	507000	000006		HRLS	T1		;START ADDRESS TO CLEAR
  1864	001773'	271300	000001		ADDI	T1,1
  1865	001774'	251307	777777		BLT 	T1,-1(T2)	;CLEAR ALL OF MONITOR BUFFER
  1866	001775'	260040	002134'	MBICD1:	PUSHJ	P,CBLEMB	;GET LENGGTH AND ADDR OF NEXT BLOCK IN MB
  1867	001776'	322300	002051'		JUMPE	T1,MBICD2	;IF MB IS EMPTY
  1868	001777'	260040	002143'	MBICD9:	PUSHJ	P,CBLEUB	;GET LENGTH AND ADR OF NEXT BLOCK IN UB
  1869	002000'	322440	002032'		JUMPE	T4,MBICD3	;IF UB IS FULL
  1870	002001'	504700	000007		HRL	P3,T2		;SET UP FOR XFER - FROM
  1871	002002'	540700	000010		HRR	P3,T3		; - TO
  1872	002003'	200600	000006		MOVE	P1,T1		;LENGTH OF MB DATA
  1873	002004'	313600	000011		CAMLE	P1,T4		;COMPARE TO SPACE IN UB
  1874	002005'	200600	000011		 MOVE	P1,T4		;USE MINIMUM
  1875	002006'	270600	000010		ADD	P1,T3		;ENDING ADDRESS+1
  1876	002007'	540644	000003		HRR	P2,DEVSER(F)	;TRANSFER ROUTINE
  1877	002010'	621640	200000		TLZ	P2,200000	;CLEAR DONE WITH BUFFER FLAG
  1878	002011'	260055	000012		PUSHJ	P,DXFR(P2)	;CALL XFER ROUTINE
  1879	002012'	254000	002032'		JRST	MBICD3		;END OF BLOCK- DON'T PUT MORE IN THIS BUFFER
  1880	002013'	274600	000010		SUB	P1,T3		;RECOVER LENGTH OF XFER
  1881	002014'	540644	000011		HRR	P2,DEVCLS(F)	;GET MB ADDRESS
  1882	002015'	550315	777776		HRRZ	T1,-2(P2)	;GET OUT POINTER
  1883	002016'	270300	000014		ADD	T1,P1		;ADD WORD COUNT TRANSFERRED
  1884	002017'	316315	777777		CAMN	T1,-1(P2)	;END OF BUFFER?
  1885	002020'	200300	000015		 MOVE	T1,P2		;YES, LOOP AROUND
  1886	002021'	542315	777776		HRRM	T1,-2(P2)	;UPDATE OUT
  1887	002022'	550304	000007		HRRZ	T1,DEVIAD(F)	;BUFFER ADDRESS
  1888	002023'	273604	000013		ADDB	P1,DEVPWC(F)	;ADVANCE PARTIAL WORD COUNT
  1889	002024'	256200	004346'	 XCTBU <HRRZM P1,1(T1)>	;STORE BUFFER WORD COUNT
  1890	002025'	256200	004347'	 XCTBU <HLRZ T2,(T1)>	;GET BUFFER SIZE
  1891	002026'	553000	000014		HRRZS	P1		;EXTRACT WORD COUNT
  1892	002027'	620340	400000		TRZ	T2,400000	;EXTRACT BUFFER SIZE
  1893	002030'	305607	777777		CAIGE	P1,-1(T2)	;BUFFER FULL?
  1894	002031'	254000	002110'		 JRST	MBICD6		;NO.
  1895	002032'	550304	000007	MBICD3:	HRRZ	T1,DEVIAD(F)	;GET BUFFER ADDRESS
  1896	002033'	513004	000013		HLLZS	DEVPWC(F)	;CLEAR PARTIAL WORD COUNT
  1897	002034'	515340	400000		HRLZI	T2,IOUSE	;GET USE BIT
  1898	002035'	256200	004350'	 XCTBU <ORM T2,(T1)>	;SET IT IN USER BUFFER HEADER
  1899	002036'	256200	004330'	 XCTBU <HRR T1,(T1)>	;ADVANCE TO NEXT BUFFER IN RING
  1900	002037'	542304	000007		HRRM	T1,DEVIAD(F)	;SET NEW BUFFER ADDRESS
  1901	002040'	256200	004331'	 XCTBU <SKIPGE (T1)>	;IS THIS BUFFER FULL?
  1902	002041'	263040	000000		 POPJ	P,		;YES. RETURN
  1903	002042'	260040	003710'		PUSHJ	P,BUFCLR	;CLEAR NEXT BUFFER
  1904	002043'	255000	000000		  JFCL			;IGNORE ADDRESS ERRORS
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 31-2
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1905	002044'	260040	002115'		PUSHJ	P,CTMBS		;COMPUTE SPACE IN BUFFER
  1906	002045'	554344	000013		HLRZ	T2,DEVPWC(F)	;WAKE UP COUNT
  1907	002046'	317300	000007		CAMG	T1,T2		;TIME TO RETURN TO USER?
  1908	002047'	263040	000000		 POPJ	P,		;YES.
  1909	002050'	254000	001775'		JRST	MBICD1		;AND GO FILL IT
  1910	002051'	603000	000040	MBICD2:	TLNE	S,IOEND		;EOF?
  1911	002052'	254000	002071'		 JRST	MBICD4		;YES.
  1912	002053'	602000	010000	MBICD8:	TRNE	S,IOACT		;NO. I/O ACTIVE?
  1913	002054'	254000	002060'		 JRST	MBICD5		;YES
  1914	002055'	550444	000003		HRRZ	T4,DEVSER(F)	;GET DEVICE DEPENDENT ROUTINE
  1915	002056'	260051	000011		PUSHJ	P,DIN(T4)	;AND CALL IT
  1916	002057'	540244	000006		HRR	U,DEVBUF(F)	;HNGSTP MAY HAVE CLOBBERED U
  1917	002060'	200304	000006	MBICD5:	MOVE T1,DEVBUF(F)
  1918	002061'	256200	004305'		UMOVE T1,(T1)		;GET BUFFER HEADER WORD
  1919	002062'	256200	004331'	 XCTBU <SKIPGE(T1)>		;CURRENT BUFFER FULL?
  1920	002063'	263040	000000		 POPJ P,		;YES. LET HIM HAVE IT
  1921	002064'	135300	000000*		LDB T1,NWATRP		;IO WAIT TRAP CHANNEL
  1922	002065'	260040	000000*		PUSHJ P,TSTKTJ		;TEST AND TAKE?
  1923	002066'	254000	000000*		  JRST ABTUUO		;TRAP TAKEN- ABORT INPUT
  1924	002067'	260040	001661*		PUSHJ	P,WSYNC		;NO. WAIT FOR MORE I/O
  1925	002070'	254000	001775'		 JRST	MBICD1		;AND XFER SOME MORE
  1926	002071'	550344	000013	MBICD4:	HRRZ	T2,DEVPWC(F)	
  1927	002072'	326340	002101'		JUMPN	T2,MBICD7	;IF THERE IS A PARTIAL BUFFER AND EOF
  1928	002073'	256200	004340'	 XCTBU <HRRZ T2,(U)>		;GET USERS CURRENT BUFFER ADDRESS
  1929	002074'	256200	004333'	 XCTBU <SKIPGE (T2)>	;CURRENT BUFFER EMPTY?
  1930	002075'	263040	000000		 POPJ	P,		;NO. LET HIM EMPTY IT
  1931	002076'	660000	020000		TRO	S,IODEND	;YES. SET USER EOF BIT
  1932	002077'	436004	000002		IORM 	S,DEVIOS(F)	;IN DDB
  1933	002100'	263040	000000		POPJ	P,
  1934	002101'	515340	400000	MBICD7:	HRLZI	T2,IOUSE	;SET USE BIT IN BUFFER
  1935	002102'	550304	000007		HRRZ	T1,DEVIAD(F)
  1936	002103'	256200	004350'	 XCTBU <ORM T2,(T1)>
  1937	002104'	550344	000013		HRRZ	T2,DEVPWC(F)	;SET FINAL WORD COUNT
  1938	002105'	256200	004351'		UMOVEM T2,1(T1)
  1939	002106'	513004	000013		HLLZS	DEVPWC(F)	;CLEAR PARTIAL WORD COUNT
  1940	002107'	263040	000000		POPJ	P,
  1941	002110'	260040	002134'	MBICD6:	PUSHJ	P,CBLEMB
  1942	002111'	326300	001777'		JUMPN	T1,MBICD9	;JUMP IF MB IS NOT EMPTY
  1943	002112'	603000	000040		TLNE	S,IOEND		;EOF?
  1944	002113'	254000	002101'		 JRST	MBICD7		;YES
  1945	002114'	254000	002053'		JRST	MBICD8		;NO
  1946
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 32
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1947				;	COMPUTE TOTAL SPACE LEFT IN MONITOR BUFFER
  1948				;
  1949	002115'	550304	000011	CTMBS::	HRRZ	T1,DEVCLS(F)	;POINTER TO BUFFER
  1950	002116'	550406	777776		HRRZ	T3,-2(T1)	;GET OUT
  1951	002117'	554346	777776		HLRZ	T2,-2(T1)	;GET IN
  1952	002120'	315340	000010		CAMGE	T2,T3		;SKIP IF IN .GE. OUT
  1953	002121'	254000	002130'		JRST	CTMBS1
  1954	002122'	274346	777777		SUB	T2,-1(T1)	;SP=LAST-IN+OUT-FIRST-1
  1955	002123'	213000	000007		MOVNS	T2
  1956	002124'	270340	000010		ADD	T2,T3
  1957	002125'	274340	000006		SUB	T2,T1
  1958	002126'	200300	000007		MOVE	T1,T2		
  1959	002127'	254000	002132'		JRST	CTMBS2
  1960	002130'	274400	000007	CTMBS1:	SUB	T3,T2		;SP = OUT-IN-1
  1961	002131'	200300	000010		MOVE	T1,T3		;OUT-IN
  1962	002132'	275300	000001	CTMBS2:	SUBI	T1,1	
  1963	002133'	263040	000000		POPJ	P,
  1964
  1965				;
  1966				;	COMPUTE ADDRESS AND LENGTH OF NEXT BLOCK OF DATA IN MB
  1967				;	RETURNS ADDRESS IN T2 AND LENGTH IN T1
  1968				;
  1969	002134'	550404	000011	CBLEMB::HRRZ	T3,DEVCLS(F)	;ADDR OF BUFFER
  1970	002135'	550350	777776		HRRZ	T2,-2(T3)	;OUT=ADDRESS
  1971	002136'	554310	777776		HLRZ	T1,-2(T3)	;GET IN
  1972	002137'	315300	000007		CAMGE	T1,T2		;IN .GE. OUT?
  1973	002140'	550310	777777		HRRZ	T1,-1(T3)	;NO.
  1974	002141'	274300	000007		SUB	T1,T2		;LEN = IN-OUT
  1975	002142'	263040	000000		POPJ	P,
  1976				;
  1977				;	COMPUTE LENGTH AND ADDRESS OF REMAINING SPACE IN
  1978				;	CURRENT USER BUFFER
  1979				;	T3 RETURNS ADDRESS AND T4 RETURNS LENGTH
  1980				;
  1981	002143'	550404	000007	CBLEUB:	HRRZ	T3,DEVIAD(F)	;ADDRESS OF BUFFER
  1982	002144'	201440	000000		MOVEI	T4,0
  1983	002145'	256200	004352'	 XCTBU <SKIPGE (T3)>	;SKIP IF USE BIT IS CLEAR
  1984	002146'	263040	000000		POPJ	P,		;RETURN WITH 0 SPACE REMAINING
  1985	002147'	256200	004353'	 XCTBU <HLRZ T4,(T3)>	;GET BUFFER SIZE
  1986	002150'	261040	000014		PUSH	P,P1		;SAVE REGISTER
  1987	002151'	550604	000013		HRRZ	P1,DEVPWC(F)	;GET PARTIAL COUNT
  1988	002152'	275454	000001		SUBI	T4,1(P1)		;COMPUTE SPACE REMAINING
  1989	002153'	271414	000002		ADDI	T3,2(P1)		;COMPUTE ADDRESS
  1990	002154'	262040	000014		POP	P,P1		;RESTORE P1
  1991	002155'	263040	000000		POPJ	P,		;AND RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 33
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  1992				;	DEVICE DEPENDENT ROUTINE TO XFER DATA FROM
  1993				;	THE MONITOR TO THE USER BUFFER.
  1994				;	ON NETRY LH(P3)=START OF BLOCK IN MB
  1995				;		 RH(P3)=START OF BLOCK IN UB
  1996				;		   (P1)=ENDING ADDRESS IN UB OF SUGGESTED XFER
  1997				;	ON EXIT    (P1)=ACTUAL ENDING ADDRESS OF XFER
  1998				;
  1999	002156'	261040	000015	MBBXFR::PUSH	P,P2		;SAVE REGISTER
  2000	002157'	135640	001535*		LDB	P2,PIOMOD	;GET MODE
  2001	002160'	306640	000014		CAIN	P2,B		;BINARY?
  2002	002161'	254000	002166'		 JRST	PTRXF1		;YES. REQUIRES SPECIAL HANDLING
  2003	002162'	256200	004354'	 XCTTU <BLT P3,-1(P1)>		;  CAN XFER DIRECTLY
  2004	002163'	262040	000015		POP	P,P2		;RESTORE REGISTER
  2005	002164'	350001	000000		AOS	(P)		;SKIP RETURN FOR BUFFER THAT CAN BE FILLED
  2006	002165'	263040	000000		POPJ	P,		;AND RETURN
  2007
  2008	002166'	554300	000016	PTRXF1:	HLRZ	T1,P3		;GET ADDR IN MB
  2009	002167'	553000	000016		HRRZS	P3		;GET ADDR  IN UB
  2010	002170'	200346	000000		MOVE	T2,(T1)		;GET WORD  COUNT OF BLOCK
  2011	002171'	256200	004355'	 XCTBU <MOVEM T2,-1(P3)>	; STORE CKSUM AND COUNT
  2012	002172'	256200	004356'	 XCTBU <HLRZ T3,-2(P3)>		;GET BUFFER SIZE
  2013	002173'	621400	400000		TLZ	T3,400000	;CLEAR  USE  BIT IFSET
  2014	002174'	553000	000007		HRRZS	T2		;EXTRACT BLOCKWORD  COUNT
  2015	002175'	307350	777777		CAIG	T2,-1(T3)	;WILL BLOCK FIT?
  2016	002176'	254000	002201'		 JRST	PTRXF2		;YES.
  2017	002177'	660000	040000		TRO	S,IOBKTL	;NO. SET BLOCKINCOMPLETE  FLAG
  2018	002200'	551350	777777		HRRZI	T2,-1(T3)	;WORD COUNT  TO BE XFERRED
  2019	002201'	550404	000011	PTRXF2:	HRRZ	T3,DEVCLS(F)	;BUFFER POINTER
  2020	002202'	271300	000001	PTRXF4:	ADDI	T1,1		;ADVANCE OUT POINTER
  2021	002203'	316310	777777		CAMN	T1,-1(T3)	;ENDOF BUFFER?
  2022	002204'	550300	000010		 HRRZ	T1,T3		;YES.  LOOPAROUND
  2023	002205'	554450	777776	PTRXF7:	HLRZ	T4,-2(T3)	;GET IN POINTER
  2024	002206'	316440	000006		CAMN	T4,T1		;BUFFER EMPTY?
  2025	002207'	254000	002230'		 JRST	PTRXF3		;YES
  2026	002210'	200446	000000		MOVE 	T4,(T1)	;NO. GET DATA
  2027	002211'	256200	004357'		UMOVEM	T4,(P3)		;STORE  IN  UB
  2028	002212'	271700	000001		ADDI	P3,1		;ADVANCE UB POINTER
  2029	002213'	367340	002202'		SOJG	T2,PTRXF4	;LOOP TOEND  OF WORD COUNT
  2030	002214'	550344	000007		HRRZ	T2,DEVIAD(F)	;ADDR OF UB
  2031	002215'	271300	000001		ADDI	T1,1		;ADVANCE OUT POINTER
  2032	002216'	542310	777776		HRRM	T1,-2(T3)	;STORE IT
  2033	002217'	602000	040000		TRNE	S,IOBKTL	;LENGTH ERROR ON BLOCK?
  2034	002220'	254000	002226'		 JRST	PTRXF9		;YES. DO NOT CHECKSUM.
  2035	002221'	260040	003724'		PUSHJ	P,CKS12		;COMPUTE CHECKSUM
  2036	002222'	550344	000007		HRRZ	T2,DEVIAD(F)	;POINTER TO CKSUM UN UB
  2037	002223'	256200	004360'	 XCTBU <HLLZ	T2,1(T2)>	;GET IT
  2038	002224'	312300	000007		CAME	T1,T2		;COMPARE  IT
  2039	002225'	660000	100000		 TRO 	S,IODTER	;SET ERROR FLAG
  2040	002226'	437004	000002	PTRXF9:	IORB	S,DEVIOS(F)	;ALSO IN DDB
  2041	002227'	254000	002250'		JRST	PTRXF8		;RETURN
  2042
  2043	002230'	603000	000040	PTRXF3:	TLNE	S,IOEND		;EOF??
  2044	002231'	254000	002247'		 JRST	PTRXF5		;YES
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 33-2
IOCSS.MAC	 9-OCT-87 18:01		IN,INPUT		OUTPUT,OUT

  2045	002232'	606000	010000		TRNN	S,IOACT		;NO.  I/O ACTIVE?
  2046	002233'	254000	002236'		 JRST	PTRXF6		;NO
  2047	002234'	260040	002252'		PUSHJ	P,PTRWT		;YES. WAITFOR MORE DATA
  2048	002235'	254000	002205'		JRST	PTRXF7		;AND GOXFER IT
  2049
  2050	002236'	550444	000003	PTRXF6:	HRRZ	T4,DEVSER(F)	;START DEVICE
  2051	002237'	261040	000006		PUSH	P,T1
  2052	002240'	261040	000007		PUSH	P,T2		;SAVE REGISTERS
  2053	002241'	261040	000010		PUSH	P,T3
  2054	002242'	260051	000011		PUSHJ	P,DIN(T4)	;START THE DEVICE
  2055	002243'	262040	000010		POP	P,T3		;RESTORE REGISTERS
  2056	002244'	262040	000007		POP	P,T2	
  2057	002245'	262040	000006		POP	P,T1
  2058	002246'	254000	002205'		JRST	PTRXF7
  2059	002247'	660000	040000	PTRXF5:	TRO	S,IOBKTL	;SET ERROR FLAG
  2060	002250'			PTRXF8:
  2061	002250'	262040	000015		POP	P,P2		;RESTORE P2
  2062	002251'	263040	000000		POPJ	P,
  2063
  2064	002252'	261040	000016	PTRWT:	PUSH	P,P3		;SAVE P3 AND CALL WSYNC
  2065	002253'	260040	002067*		PUSHJ	P,WSYNC	
  2066	002254'	262040	000016		POP	P,P3
  2067	002255'	263040	000000		POPJ	P,
  2068
  2069
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 34
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2070				SUBTTL OUT,OUTPUT
  2071				;CALLING SEQUENCE
  2072				;     OUTPUT D,
  2073				;     EXIT
  2074				;OR
  2075				;     OUTPUT D, ADR
  2076				;     EXIT
  2077
  2078				;IF INPUT IS ACTIVE, WAIT FOR IT TO COMPLETE.
  2079				;IF DUMP MODE WAS SELECTED BY THE LAST INIT MUUO OR SETSTS MUUO
  2080				;   THE PROGRAM WAITS UNTIL THE DEVICE IN INACTIVE AND THEN
  2081				;   WRITES THE DUMPFILE AND RETURNS CONTROL TO THE USER'S PROGRAM
  2082				;   WHEN IO HAS COMPLETED.
  2083				;IF THE MODE IS NOT DUMP, THEN
  2084				;1) IF ADR IS NOT ZERO, WAIT FOR DEVICE TO BECOME INACTIVE THEN SET THE
  2085				;   CURRENT BUFFER ADDRESS EQUAL TO ADR AND AN INDICATOR (JBFADR0)
  2086				;   SPECIFYING THAT THIS BUFFER RING HAS NEVER BEEN REFERENCED FROM THE
  2087				;   USER'S PROGRAM BY AN INPUT OR AN OUTPUT UUO.  OTHERWISE, GO TO
  2088				;   2) DIRECTLY.
  2089
  2090				;2) IF THE BUFFER RING HAS NEVER BEEN REFERENCED (JBFADR0=1), THE
  2091				;   BUFFER IS CLEARED, IOUSE SET TO ZERO AND
  2092				;      IF THE CURRENT BUFFER ADDRESS IS ZERO, A TWO BUFFER RING IS SET UP.
  2093				;      THEN GO TO 8
  2094				;
  2095				;3) IF THE BUFFER RING HAS BEEN REFERENCED (JBFADR0=0	,THEN A CHECK IS
  2096				;   MADE TO DETERMINE IF THE WORD COUNT IS TO BE COMPUTED.
  2097				;      IF THE WORD COUNT IS TO BE COMPUTED (IOWC=0), IT IS SET EQUAL
  2098				;      TO THE ADDRESS FOR THE LAST DATA WORD MINUS THE ADDRESS OF THE
  2099				;      BUFFER MINUS ONE.
  2100
  2101				;4) IOUSE IS SET TO ONE, INDICATING THAT THE BUFFER IS FULL OR BEING
  2102				;   EMPTIED, AND THE CURRENT BUFFER ADDRESS IS ADVANCED.
  2103
  2104				;5) IF THE DEVICE IS NOT ACTIVE (IOACT=0), OUTPUT IS STARTED.
  2105				;6) IF THE CURRENT BUFFER IS FULL OR BEING EMPTIED (IOUSE=1),
  2106				;   THE PROGRAM WAITS UNTIL THE DEVICE FINISHES THE BUFFER
  2107				;   (THE OUTPUT SERVICE ROUTINE CLEARS THE USE BIT WHEN
  2108				;   IT FINISHES OUTPUTTING A BUFFER).
  2109				;7) THE CURRENT BUFFER IS CLEARED.
  2110				;8) THE J POINTER IS INITIATED TO THE CURRENT BUFFER ADDRESS+1
  2111				;   AND THE J COUNT IS SET TO THE PRODUCT OF THE BUFFER SIZE
  2112				;   MINUS ONE AND THE INTEGER PART OF 36/BYTE SIZE.
  2113				;9) RETURN TO THE USER'S PROGRAM
  2114
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 35
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2115				;HERE ON OUTPUT MUUO
  2116
  2117	002256'	201300	000010	UOUT:	MOVEI T1,DOU
  2118	002257'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  2119	002260'	254000	001522*		 JRST ERRIUC		;ERROR. NO CHANNEL.
  2120	002261'	255000	000000		JFCL			;SHORT DISPATCH TABLE OK.
  2121	002262'	260040	002264'		PUSHJ P,UOUT1
  2122	002263'	254000	001501*		JRST DEVECK
  2123
  2124	002264'	661200	004000	UOUT1:	TLO F,OUTPB	;SET OUTPUT MUUO BIT
  2125	002265'	621200	001000		TLZ F,OCLOSB	;CLEAR CLOSE OUTPUT BIT
  2126
  2127				;HERE FROM DEVICE SERVICE ROUTINES ON CLOSE MUUO
  2128
  2129	002266'	550444	000003	OUT::	HRRZ T4,DEVSER(F) ;RESTORE T4
  2130	002267'	607000	000020		TLNN S,IO		;IS THIS DEVICE ALREADY DOING INPUT?
  2131	002270'	260040	001674'		PUSHJ P,WAITI		;YES, WAIT TILL IT BECOMES INACTIVE
  2132	002271'	502212	000000*		HLLM F,%UPT+UPTJDA(W);SAVE NEW BIT SETTINGS.
  2133	002272'	135300	002157*		LDB T1,PIOMOD		;GET DATA MODE SET BY INIT OR SETSTS.
  2134	002273'	301300	000015		CAIL T1,SD		;IS IT DUMP MODE(SD,DR,D)?
  2135	002274'	254000	002405'		JRST OUTDMP		;YES.
  2136	002275'	205000	000020		MOVSI S,IO
  2137	002276'	437004	000002		IORB S,DEVIOS(F)	;SET IO IN S,MEMORY
  2138	002277'	260040	002416'		PUSHJ P,OUTA		; CHECK FOR NON-ZERO ADDRESS(USER
  2139								; CHANGING RING)
  2140	002300'	554244	000006		HLRZ U,DEVBUF(F)	;REL. ADDR. OF OUTPUT BUFFER HEADER
  2141	002301'	256200	004361'	 XCTBU <SKIPG T2,(U)>	; CHECK FIRST WORD OF BUFFER HEADER
  2142	002302'	254000	002367'		 JRST OUTF		;RING NOT SET UP OR FIRST REFERENCE TO RING
  2143	002303'	607340	200000		TLNN T2,IOADVB	;SEE IF OK TO ADVANCE
  2144	002304'	256200	004333'	 XCTBU <SKIPGE (T2)>		;AND IS USE BIT ON
  2145	002305'	254000	002323'		 JRST OUT3		;DO NOT ADVANCE, START DEVICE
  2146	002306'	256200	004362'	 XCTBU <HRRZ T1,1(U)>		;GET RH OF BYTE POINTER.
  2147	002307'	602000	000020		TRNE S,IOWC		;USER COMPUTING OWN WC?
  2148	002310'	201300	000000		 MOVEI T1,0		;YES, SET POINTER TO 0
  2149	002311'	332000	000006		SKIPE	T1
  2150	002312'	275307	000001		 SUBI T1,1(T2)		;NOW HAVE SIZE
  2151	002313'	321300	000520*		JUMPL T1,ADRERR		;TRYING TO PUT ONE OVER ON US
  2152	002314'	606000	000020		TRNN S,IOWC		;DO NOT STORE IF OWN WC.
  2153	002315'	256200	004363'	 XCTBU < HRRM T1,1(T2)>		;YES, STORE WORD COUNT IN 3RD WORD OF BUFFER.
  2154	002316'	515300	400000		HRLZI T1,IOUSE		;FLAG CURRENT BUFFER CONTAINS ACTIVE DATA.
  2155	002317'	256200	004364'	 XCTBU <IORB T1,(T2)>
  2156	002320'	256200	004325'	 XCTBU <HRRM T1,(U)>		;ADVANCE CURRENT BUFFER ADDRESS
  2157	002321'	205300	200000		MOVSI T1,IOADVB
  2158	002322'	256200	004215'	 XCTBU <IORM T1,(U)>	;HAVE ALREADY ADVANCED IT
  2159	002323'	205000	000010	OUT3:	MOVSI S,IOSTBL
  2160	002324'	413004	000002		ANDCAB S,DEVIOS(F)
  2161	002325'	135340	001753*		LDB T2,DEYCLS	;CLASS DEPENDENT ROUTINE INDEX
  2162	002326'	256007	001732'		XCT CLA(T2)		;CALL CLASS DEPENDENT ROUTINE
  2163	002327'	254000	002362'		JRST OUTS1			;NO SKIP MEANS CDR DID IT ALL
  2164	002330'	606000	740000		TRNN S,IODTER!IODERR!IOBKTL!IOIMPM	;DO NOT START IF ERR
  2165	002331'	602000	010000	OUT3A:	TRNE S,IOACT
  2166	002332'	254000	002347'		JRST	OUT5
  2167	002333'	135300	002325*		LDB T1,DEYCLS
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 35-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2168	002334'	256006	001732'		XCT CLA(T1)	;MAKE SURE BUFFERS ALL ADVANCED
  2169	002335'	255000	000000		JFCL
  2170	002336'	554244	000006		HLRZ U,DEVBUF(F)
  2171	002337'	256200	004323'		UMOVE T2,(U)
  2172	002340'	256200	004333'	 XCTBU <SKIPGE (T2)>		;NEXT BUFFER EMPTY?
  2173	002341'	542344	000010		 HRRM T2,DEVOAD(F)	;NO, MAKE SURE OUTPUT POINTS HERE BEFORE CONTINUING
  2174	002342'	135300	002333*		LDB	T1,DEYCLS	;CLASS INDEX
  2175	002343'	256006	001736'		XCT	CLOBUF(T1)	;CALL OUTPUT BUFFER CLASS ROUTINE
  2176	002344'	254000	002347'		JRST	OUT5		;UNABLE TO BUILD LIST
  2177	002345'	550444	000003	OUT4:	HRRZ	T4,DEVSER(F)
  2178	002346'	260051	000010		PUSHJ P,DOU(T4)	;NO,START OUTPUT.
  2179	002347'	554244	000006	OUT5:	HLRZ U,DEVBUF(F)	;U TO REL. ADDR. OF BUFFER HEADER
  2180	002350'	256200	004323'		UMOVE T2,(U)		;T2 TO REL. ADDR. OF 2ND WORD OF BUFFER.
  2181	002351'	256200	004365'	 XCTBU <HLLZS 1(U)>
  2182	002352'	256200	004334'	 XCTBU <SKIPL (T2)>		;HAS SERVICE ROUTINE EMPTIED NEXT BUFFER
  2183	002353'	254000	002376'		 JRST OUTS		;YES, RETURN TO USER
  2184	002354'	260040	002253*		PUSHJ P,WSYNC		;NO, WAIT
  2185	002355'	623000	000010		TLZE S,IOSTBL		;RECOVERABLE ERROR?
  2186	002356'	254000	002323'		 JRST OUT3		;YES
  2187	002357'	135300	002342*		LDB	T1,DEYCLS
  2188	002360'	256006	001732'		XCT	CLA(T1)		;CALL CLASS ROUTINE TO ADVANCE BUFFERS IF NEEDED
  2189	002361'	255000	000000		JFCL
  2190	002362'	554244	000006	OUTS1:	HLRZ	U,DEVBUF(F)	;RELOAD U INCASE CAME FROM CLA
  2191	002363'	256200	004323'		UMOVE T2,(U)
  2192	002364'	256200	004333'	 XCTBU <SKIPGE (T2)>	;SEE IF BUFFER FULL
  2193	002365'	254000	002331'		 JRST OUT3A	;YES, TRY AGAIN
  2194	002366'	254000	002376'		JRST OUTS		;RETURN TO USER.
  2195
  2196	002367'			OUTF:	;HERE T2/USERS HEADER WORD 0 (PTR TO NEXT BUFFER)
  2197					;EITHER NO RING YET OR FIRST REFERENCE TO RING
  2198	002367'	326340	002373'		JUMPN T2,OUTF1	;JUMP IF ALREADY SET UP RING
  2199	002370'	541540	000004		HRRI M,STDRNG	;SETUP BUFFER RING USING STANDARD
  2200	002371'	260040	000333'		PUSHJ P,UOUTBF
  2201	002372'	554244	000006		HLRZ U,DEVBUF(F)
  2202	002373'	515300	600000	OUTF1:	HRLZI T1, IOUSE!IOADVB
  2203	002374'	256200	004337'	 XCTBU <ANDCAB T1, (U)>	;IOUSE:=0
  2204	002375'	542304	000010		HRRM T1,DEVOAD(F)
  2205	002376'			OUTS:
  2206	002376'	256200	004327'	 XCTBU <HRRZ T1,(U)>		;CLEAR NEXT OUTPUT BUFFER.
  2207	002377'	260040	003710'		PUSHJ P,BUFCLR	;BEING CLEARED.
  2208	002400'	254000	002313*		JRST ADRERR		;ADDRESS CHECK
  2209	002401'	205340	200000		MOVSI T2,IOADVB
  2210	002402'	256200	004366'	 XCTBU <ANDCAB T2,(U)>
  2211	002403'	256040	004370'	 XCTBU <LDB J,[POINT 17,(T2),17]>
  2212	002404'	364100	004071'		SOJA J,IOSETC
  2213								; ADDRESS+1
  2214								; JBFCTR:=(BUFFER SIZE-1)*[36/BYTE
  2215								; SIZE]
  2216								; RETURN TO USER'S PROGRAM
  2217
  2218
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 36
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2219	002405'	260040	002354*	OUTDMP:	PUSHJ P,WSYNC
  2220	002406'	205000	000020		MOVSI S,IO
  2221	002407'	437004	000002		IORB S,DEVIOS(F)	;MAKE SURE FLAG IS SET
  2222	002410'	135300	002357*		LDB	T1,DEYCLS	;CLASS INDEX
  2223	002411'	256006	001742'		XCT	CLODMP(T1)	;CALL CLASS DUMP OUTPUT ROUTINE
  2224	002412'	263040	000000		POPJ P,
  2225	002413'	550444	000003		HRRZ	T4,DEVSER(F)
  2226	002414'	260051	777776		PUSHJ P,DDO(T4)
  2227	002415'	254000	001701*		JRST WAIT1		;WAIT BEFORE RETURNING TO USER
  2228
  2229				;CALLING SEQUENCE:
  2230				;	PUSHJ P,OUTA
  2231				;	EXIT		ALWAYS RETURNS HERE
  2232				;IF THE ADDRESS FIELD OF AC M IS ZERO,EXIT. OTHERWISE,CHECK IOACT.
  2233				;IF IOACT=1, WAIT FOR IOACT=0.
  2234				;SET JBFADR18-35:=ADDRESS FIELD OF AC UUO. JBFADR0:=1 AND EXIT.
  2235
  2236	002416'	602540	777777	OUTA:	TRNE M,-1		;IS BUFFER ADDRESS SPECIFIED?
  2237	002417'	603200	001000		TLNE F,OCLOSB		;DOES NOT APPLY DURING CLOSE
  2238	002420'	263040	000000		POPJ P,		;NO
  2239	002421'	260040	002415*		PUSHJ P,WAIT1
  2240	002422'	554244	000006		HLRZ U,DEVBUF(F)
  2241	002423'	256200	004322'	 XCTBU <HRRM M,(U)>
  2242	002424'	542544	000010		HRRM M,DEVOAD(F)
  2243	002425'	515300	400000		HRLZI T1,IOUSE
  2244	002426'	256200	004216'	 XCTBU <ANDCAM T1,(U)>
  2245	002427'	263040	000000		POPJ P,		;RETURN
  2246
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 37
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2247				;	MOINTOR BUFFER CLASS DEPENDENT ROUTINE - OUTPUT
  2248				;
  2249	002430'	607000	000002	MBCDR:	TLNN	S,IOBEG		;FIRST OUTPUT?
  2250	002431'	254000	002437'		JRST	MBCDR5		;NO.
  2251	002432'	540304	000011		HRR	T1,DEVCLS(F)	;YES. GET ADDRESS OF MON. BUFFER
  2252	002433'	507000	000006		HRLS	T1		;SET IN=OUT=FIRST
  2253	002434'	202306	777776		MOVEM	T1,-2(T1)	;STORE IN POINTER WORD
  2254	002435'	555300	000000		HLRZI	T1,		;CLEAR PARTIAL WORD COUNT
  2255	002436'	542304	000013		HRRM	T1,DEVPWC(F)	;STORE IT
  2256	002437'	260040	003323'	MBCDR5:	PUSHJ	P,CBLAUB		;GET LENGTH OF USER DATA
  2257	002440'	322440	002463'		JUMPE	T4,MBCDR3		;JUMP IF UB IS EMPTY
  2258	002441'	260040	003307'	MBCDR4:	PUSHJ	P,CBLAMB		;GET SPACE LEN. OF MB
  2259	002442'	322300	002477'		JUMPE	T1,MBCDR2		;JUMP IF FULL
  2260	002443'	313300	000011		CAMLE	T1,T4		;COMPUTE MIN(UB,MB)
  2261	002444'	200300	000011		MOVE	T1,T4		;PUT MIN IN T1
  2262	002445'	504340	000010		HRL	T2,T3		;SET UP FOR BLT-START
  2263	002446'	550400	000007		HRRZ	T3,T2		;SET UP FROM
  2264	002447'	270400	000006		ADD	T3,T1		; AND END+1
  2265	002450'	550604	000003		HRRZ	P1,DEVSER(F)		;SET TO CALL XFER ROUTINE
  2266	002451'	260054	000012		PUSHJ	P,DXFR(P1)		;CALL IT
  2267	002452'	254000	002463'		JRST	MBCDR3		;XFER ROUTINE HAS DONE IT ALL
  2268	002453'	550604	000011		HRRZ	P1,DEVCLS(F)		;MON. BUFFER POINTER
  2269	002454'	554654	777776		HLRZ	P2,-2(P1)		;GET IN POINTER
  2270	002455'	270640	000006		ADD	P2,T1		; ADD AMOUNT ADDED TO BUFFER
  2271	002456'	316654	777777		CAMN	P2,-1(P1)	; IN = LAST ?
  2272	002457'	200640	000014		MOVE	P2,P1		; P2:=FIRST
  2273	002460'	506654	777776		HRLM	P2,-2(P1)	;YES, IN := FIRST
  2274	002461'	272304	000013		ADDM	T1,DEVPWC(F)	;COMPUTE TOTAL XFRD SO FAR
  2275	002462'	254000	002437'		JRST	MBCDR5		;XFER SOME MORE IF NEEDED
  2276	002463'			MBCDR3:
  2277	002463'	513344	000013		HLLZS	T2,DEVPWC(F)	;RESET PARTIAL WORD COUNT
  2278	002464'	260040	003471'		PUSHJ	P,ADVBFE	;ADVANCE TO NEXT USER BUFFER
  2279	002465'	254000	002467'		JRST	MBCDR1		;BUFFER IS EMPTY
  2280	002466'	254000	002437'		JRST	MBCDR5		;BUFFER IS FULL
  2281	002467'	602000	010000	MBCDR1:	TRNE	S,IOACT	;DEVICE ACTIVE?
  2282	002470'	263040	000000		POPJ	P,		;YES
  2283	002471'	550304	000011		HRRZ	T1,DEVCLS(F)		;NO CHECK MON. BUFFER
  2284	002472'	204346	777776		MOVS	T2,-2(T1)	; COMPARE IN TO OUT AND OUT TO IN
  2285	002473'	316346	777776		CAMN	T2,-2(T1)	; IN = OUT?
  2286	002474'	263040	000000		 POPJ	P,		;YES. BUFFER EMPTY
  2287	002475'	550444	000003		HRRZ	T4,DEVSER(F)	;NO. SET TO CALL DEVICE DEPENDENT CODE
  2288	002476'	324751	000010		PJRST	DOU(T4)		;CALL IT AND RETURN
  2289
  2290	002477'	554304	000013	MBCDR2:	HLRZ	T1,DEVPWC(F)	;GET WAKE UP COUNT
  2291	002500'	212304	000014		MOVNM	T1,DEVWUC(F)	;SET IT
  2292	002501'	260040	002405*		PUSHJ	P,WSYNC		;WAIT FOR ROOM IN MON. BUFFER
  2293	002502'	602000	010000		TRNE	S,IOACT		;CHECK IF WE GOT HERE WITH FULL
  2294	002503'	254000	002441'		JRST	MBCDR4		;  BUFFER BUT DEV. STOPPED
  2295	002504'	550304	000011		HRRZ	T1,DEVCLS(F)	;IF SO WE MUST START DEVICE
  2296	002505'	204346	777776		MOVS	T2,-2(T1)	;BUFFER FULL CHECK
  2297	002506'	316346	777776		CAMN	T2,-2(T1)	;BUFFER EMPTY?
  2298	002507'	254000	002441'		JRST	MBCDR4		; YES. CAN'T START DEVICE
  2299	002510'	550444	000003		HRRZ	T4,DEVSER(F)	;NO. SO START DEVICE
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 37-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2300	002511'	260051	000010		PUSHJ	P,DOU(T4)	; BY CALLING DEV. DEPENDENT ROUTINE
  2301	002512'	254000	002437'		JRST	MBCDR5		;XFER MORE IF POSSIBLE
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 38
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2302				; TAPE CLASS DEPENDENT INPUT ROUTINE #1
  2303				;  CALLED TO CLEANUP AND ADVANCE BUFFERS
  2304				;
  2305				;(THIS WAS DSK/TAPE COMMON CODE AT ONE TIME)
  2306	002513'	261040	000006	DTIDR1:	PUSH	P,T1
  2307	002514'	261040	000007		PUSH	P,T2		;SAVE REGISTERS
  2308	002515'	627000	000002		TLZN	S,IOBEG		;FIRST TIME?
  2309	002516'	254000	002522'		JRST	DTID11		;NO.
  2310	002517'	205000	000002		MOVSI	S,IOBEG		
  2311	002520'	413004	000002		ANDCAB	S,DEVIOS(F)	;CLEAR BEGIN BIT IN MEMORY TOO
  2312	002521'	254000	002557'		JRST DTID12	;RESET COUNT AND RETURN
  2313	002522'	375404	000013	DTID11:	SOSGE	T3,DEVABC(F)	;ADVANCE BUFFER COUNTER
  2314	002523'	254000	002556'		JRST	DTID14		;ALL DONE. COUNT WAS 0
  2315	002524'	554304	000014		HLRZ	T1,DEVBWC(F)	;CURRENT COUNT ADDRESS
  2316					JUMPE T1,[SKIPN DEVABC(F)	;FOR DISK, ANYTHING LAST BUFFER?
  2317						SKIPN T1,DEVBWC(F)	;ANYTHING
  2318						MOVEI T1,200	;ON DISK ALL ARE 200 EXCEPT LAST
  2319	002525'	322300	004371'			JRST DTID15]
  2320	002526'	271300	000001		ADDI	T1,1
  2321	002527'	506304	000014		HRLM	T1,DEVBWC(F)	;ADVANCE ADDRESS
  2322	002530'	200306	777777		MOVE T1,-1(T1)	;WORD COUNT FOR RECORD
  2323	002531'	550344	000007	DTID15:	HRRZ	T2,DEVIAD(F)	;BUFFER ADDRESS
  2324	002532'	256200	004375'		UMOVEM T1,1(T2)	;INSTALL WORD COUNT IN BUFFER HEADER
  2325				IFCPU (KL),<;IF KL10, HAVE TO MAKE SURE EDGES OF BUFFER WEREN'T DRAGGED
  2326				; INTO THE CACHE WHILE I/O WAS IN PROGRESS BY REFERENCE TO ADJACENT
  2327				; WORD. IF USER REFS BUFFER ITSELF, TOUGH ON HIM.
  2328
  2329	002533'	201307	000002		MOVEI	T1,2(T2)	;FIRST DATA WORD IN BUFFER
  2330	002534'	405300	000777		CSHREF	
  2331	002535'	330020	000000*
  2332	002536'	330020	000001*
  2333	002537'	330020	000002*
  2334	002540'	330020	000003*
  2335						;MAKE SURE ITS NOT IN THE CACHE
  2336	002541'	256200	004376'	 XCTFU <HLRZ	T1,(T2)>	;GET BUFFER SIZE IN T1
  2337	002542'	620300	400000		TRZ	T1,400000	;GET RID OF USE BIT
  2338	002543'	271307	000000		ADDI	T1,(T2)		;GET ADDRESS OF LAST DATA WORD IN BUFFER
  2339	002544'	405300	000777		CSHREF	
  2340	002545'	330020	002535*
  2341	002546'	330020	000001*
  2342	002547'	330020	000002*
  2343	002550'	330020	000003*
  2344						;MAKE SURE ITS NOT IN CACHE
  2345				>;END IFCPU (KL)
  2346				IFCPU (KS),<CSHIVL>		;INVALIDATE THE CACHE (ITS WRITE THRU)
  2347	002551'	260040	003502'		PUSHJ	P,ADVBFF	;ADVANCE BUFFER THAT DEV IS DONE WITH
  2348	002552'	255000	000000		  JFCL			;IGNORE END OF RING
  2349	002553'	602000	760000		TRNE	S,760000	;ERRORS?
  2350	002554'	254000	002560'		 JRST	DTID13		;YES. ADVANCE ONLY 1 BUFFER
  2351	002555'	254000	002522'		JRST	DTID11
  2352
  2353	002556'	354004	000013	DTID14:	AOSA	DEVABC(F)
  2354	002557'	402004	000013	DTID12:	 SETZM	DEVABC(F)
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 38-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2355	002560'	262040	000007	DTID13:	POP	P,T2
  2356	002561'	262040	000006		POP	P,T1
  2357	002562'	254000	001330*		JRST CPOPJ1
  2358
  2359
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 39
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2360				; TAPE INPUT CLASS DEPENDENT ROUTINE #2
  2361				;  CALLED TO BUILD COMMAND LIST FOR DEVICE.
  2362				; (THIS ROUTINE USED TO BE COMMON TO DISK & TAPE DEFORE
  2363				;  VM SYSTEM. ENTRY WAS DTIDR2: TDZA P4,P4 ; FOR TAPE
  2364				;   DTIDK2: MOVEI P4,200  ;FOR DSK.
  2365
  2366				;
  2367
  2368
  2369	002563'			DTIDR2:
  2370	002563'	260040	000000*	IFCPU (KL),<CSHUNL			;DO SWEEP, RETURNS OLD NUMBER IN T1.
  2371	002564'	316300	000000*		CAMN T1,CSUCNT		;WAIT TILL ITS DONE
  2372	002565'	254000	002564'		JRST	.-1>
  2373	002566'	201740	000000		MOVEI P4,0		;MAG TAPE CANNOT SPLIT RECORDS
  2374	002567'	260040	002513'		PUSHJ	P,DTIDR1	;MAKE SURE ALL ADVANCED
  2375	002570'	255000	000000		JFCL
  2376	002571'	550404	000007		HRRZ	T3,DEVIAD(F)	;NEXT BUFFER
  2377	002572'	256200	004377'	 XCTBU <SKIPGE T1,(T3)>	;BUFFER FULL?
  2378	002573'	263040	000000		 POPJ	P,		;YES. NO LIST TO SET UP
  2379	002574'	260040	003225'		PUSHJ	P,GELSTA	;GET LIST SPACE IF NEEDED
  2380	002575'	506344	000014		HRLM	T2,DEVBWC(F)	;SET UP WORD COUNT POINTER
  2381	002576'	542344	000014		HRRM	T2,DEVBWC(F)
  2382	002577'	550444	000003		HRRZ T4,DEVSER(F)
  2383	002600'	260051	000013		PUSHJ P,DGTRD(T4)	;MAKE SURE DEVICE READY FOR I/O
  2384	002601'	261040	000006	DTID2:	PUSH P,T1		;SAVE ADDRESS OF NEXT BUFFER
  2385	002602'	256200	004400'	 XCTBU <HLRZ T1,(T3)>	;GET USER BUFFER SIZE
  2386	002603'	332000	000017		SKIPE P4	;CAN WE SPLIT RECORDS?
  2387	002604'	334300	000017		SKIPA T1,P4	;YES, ENFOCE BUFFER SIZE (ONLY DISK FOR NOW)
  2388	002605'	363300	002626'		SOJLE T1,DTID1	;DIE OF 0 OR NEG (T2 IS NEG)
  2389	002606'	303300	037777		CAILE T1,37777
  2390	002607'	254000	002626'		JRST DTID1	;TOO BIG A TRANSFER, BOMB OUT
  2391	002610'	213000	000006		MOVNS T1
  2392	002611'	507000	000006		HRLS T1
  2393	002612'	541310	000001		HRRI T1,1(T3)	;NOW SET USER ADDRESS
  2394	002613'	260040	003123'		PUSHJ	P,BLDLST	;BUILD LIST IN LIST AREA
  2395	002614'	254000	002626'		JRST	DTID1		;NOT ENOUGH ROOM OR ERROR
  2396	002615'	262040	000010		POP P,T3	;RESTORE BUFFER ADDRESS
  2397	002616'	602000	000040		TRNE	S,IOCON		;DISCONTINUOUS MODE?
  2398	002617'	254000	002631'		JRST	CLNLS1		;YES. QUIT AFTER FIRST BUFFER
  2399	002620'	256200	004377'	 XCTBU <SKIPGE T1,(T3)>	;FULL?
  2400	002621'	254000	002631'		 JRST	CLNLS1		;YES. DONE.
  2401	002622'	500404	000007		HLL	T3,DEVIAD(F)
  2402	002623'	316404	000007		CAMN	T3,DEVIAD(F)	;LOOPED AROUND?
  2403	002624'	254000	002631'		 JRST	CLNLS1		;YES. DONE WITH RING
  2404	002625'	254000	002601'		JRST	DTID2		;NO. SET UP LIST FOR IT IF POSSIBLE
  2405	002626'	262040	000010	DTID1:	POP P,T3	;RESTORE BUFFER ADDRESS
  2406	002627'	323340	003301'		JUMPLE	T2,ADRCLS	;JUMP IF BAD PAGE REFERNCE
  2407	002630'	254000	002632'		JRST MAPLS1	;JUST RAN OUT OF LIST, GO MAP IT
  2408
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 40
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2409	002631'	260040	003262'	CLNLS1:	PUSHJ P,CLNLST	;GET RID OF EXTRA LIST
  2410	002632'	350001	000000	MAPLS1:	AOS (P)		;SKIP RETURN
  2411	002633'	135100	000000*	MAPLST:	LDB	J,PJOBN		;GET JOB NUMBER IN J
  2412	002634'	201340	002710'		MOVEI	T2,MAPLUZ	;SET UP JBTABT
  2413	002635'	202342	000000*		MOVEM	T2,JBTABT(J)
  2414	002636'	254120	004401'		JRSTF @[PC.UIO,,.+1]	;MAKE SURE IN USER I/O MODE
  2415	002637'	550344	000011		HRRZ T2,DEVCLS(F)	;START LOOKING AT LIST
  2416	002640'	336407	000000	MAPLSR:	SKIPN T3,(T2)		;T3/ ADDR-1
  2417					JRST	[SKIPE 1(T2)	;IS THIS END OF WHOLE LIST?
  2418						AOJA T2,MAPLSR	;NO, LOOK AT NEXT TRANS
  2419						SETZM	JBTABT(J) ;WE ARE NOT OUR BROTHER'S KEEPERS
  2420						POP	P,T2	;GET RETURN ADDRESS
  2421					IFNCPU (KI),<WRUBR %UPT+UPTACP> ;RESTORE PROPER AC BLOCKS,
  2422								;THE PAGEFAULT AT SKIPA(T3) OR
  2423								;MOVES(T3) BELOW SETS USRACB BACK
  2424								;TO PREVIOUS. /AA
  2425	002641'	254000	004402'			JRSTF	@T2]	;DONE, RETURN
  2426	002642'	271400	000001		ADDI	T3, 1		;T3/ ADDR
  2427	002643'	603000	000020		TLNE S,IO		;DO PROPER INSTRUCTION
  2428	002644'	256200	004410'	 XCTBU < SKIPA (T3)>		;MAKE SURE CAN READ FOR OUTPUT
  2429	002645'	256200	004411'	 XCTBU <MOVES (T3)>		;MAKE SURE CAN WRITE THERE FOR INPUT.
  2430				IFCPU (KL),<
  2431	002646'	200300	000010		MOVE T1,T3		;FORCE THIS BACK OUT OF CACHE
  2432	002647'	405300	000777		CSHREF
  2433	002650'	330020	002545*
  2434	002651'	330020	000001*
  2435	002652'	330020	000002*
  2436	002653'	330020	000003*
  2437				>;END IFCPU (KL)
  2438	002654'	606400	777760		TRNN	T3,-17-1	;REF TO ACS?(KL MAP DOESN'T CHECK THIS)
  2439	002655'	254000	002672'		JRST MAPLSE		;YES -- BOMB
  2440	002656'	256200	004412'	 XCTBU <MAP PG,(T3)>
  2441	002657'	242140	777767	IFNCPU (KI),<LSH PG,-^D9>		;IF KL, MAP GIVES ADDRESS, NOT PAGE NUMBER.
  2442	002660'	137140	004413'		DPB PG,[POINT 13,T3,26]	;CONVERT TO PHYSICAL ADDRESS
  2443	002661'	405140	017777		ANDI	PG,17777	;GET PAGE NUMBER ONLY
  2444	002662'	135300	000000*		LDB	T1,PGYDIO	;GET CURRENT DIO COUNT
  2445	002663'	301300	000000*		CAIL	T1,DIOMAX	;HAS TO BE LESS THAN MAX
  2446	002664'	254000	002672'		JRST	MAPLSE		;CAN'T DO THIS I/O, GIVE ADDRESS ERROR
  2447								; (POOR USER WON'T KNOW WHATS GOING ON)
  2448	002665'	205300	000000*		MOVSI	T1,PGPDIO	;INCREMENT DIRECT I/O COUNT,
  2449	002666'	272320	002662*		ADDM	T1,@PGYDIO	;BEING CAREFUL OF INTRPTS.
  2450	002667'	275400	000001		SUBI T3,1
  2451	002670'	202407	000000		MOVEM T3,(T2)
  2452	002671'	344340	002640'		AOJA T2,MAPLSR	;CONTINUE
  2453
  2454	002672'	550304	000011	MAPLSE:	HRRZ T1,DEVCLS(F)	;ERROR, MUST DECREMENT EVERYTHING
  2455	002673'	306307	000000	MAPLE1:	CAIN T1,(T2)		;GET TO FAILING LOC YET?
  2456	002674'	254000	003301'		JRST ADRCLS		;YES, GO DO ADDRESS CHECK THING
  2457	002675'	336406	000000		SKIPN T3,(T1)		;GET DATA
  2458	002676'	344300	002673'		AOJA T1,MAPLE1		;CAN'T BE END OF LIST, OR WE WOULDN'T BE HERE.
  2459	002677'	271400	000001		ADDI T3,1		;IT IS ONE TOO SMALL.
  2460	002700'	135140	004413'		LDB PG,[POINT 13,T3,26] ;GET PAGE NUMBER
  2461	002701'	700600	000400		WRPI	LI.PIF
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 40-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2462	002702'	135440	002666*		LDB T4,PGYDIO
  2463	002703'	375000	000011		SOSGE T4
  2464	002704'	256000	000000'		 STOPCD
  2465	002705'	137440	002702*		DPB T4,PGYDIO
  2466	002706'	700600	000200		WRPI	LI.PIN		;WATCH OUT FOR INTERRUPT LEVEL
  2467	002707'	344300	002673'		AOJA T1,MAPLE1		;KEEP GOING TILL HIT THE BAD ONE.
  2468
  2469				;HERE IF MAPLST BLOWS UP (PAGE FAULT AND NO ROOM FOR NEW PAGE)
  2470				;CAN'T USE MAPLSE BECAUSE CONTEXT MAYBE CHANGED OUT FROM UNDER US
  2471
  2472	002710'	256200	004414'	MAPLUZ:	UMOVE	F,F		;GET DDB ADDR
  2473	002711'	256200	004415'		UMOVE	T2,T2		;AND WHERE WE WERE IN THE LIST
  2474	002712'	550304	000011		HRRZ	T1,DEVCLS(F)	;GET START OF LIST
  2475	002713'	306307	000000	MAPLZ1:	CAIN	T1,(T2)		;UNDONE ALL OF THE DAMAGE?
  2476	002714'	263040	000000		POPJ	P,		;YES, RETURN
  2477	002715'	336406	000000		SKIPN	T3,(T1)		;GET ADDRESS
  2478	002716'	344300	002713'		AOJA	T1,MAPLZ1	;THIS INSTRUCTION UNLIKELY TO HAPPEN
  2479	002717'	271400	000001		ADDI	T3,1		;ACTUALLY, IT WAS ADDR-1
  2480	002720'	135140	004413'		LDB	PG,[POINT 13,T3,26] ;GET PAGE NUMBER
  2481	002721'	700600	000400		WRPI	LI.PIF		;NO PIES HERE
  2482	002722'	135440	002705*		LDB	T4,PGYDIO	;GET DIO COUNT (SCREWED UP)
  2483	002723'	375000	000011		SOSGE	T4		;NOW IT'S ALL BETTER, WE HOPE
  2484	002724'	256000	000000'		 STOPCD			;OOPS
  2485	002725'	137440	002722*		DPB	T4,PGYDIO	;NOW ALL WONDERFUL
  2486	002726'	700600	000200		WRPI	LI.PIN		;NO MUONS HERE
  2487	002727'	344300	002713'		AOJA	T1,MAPLZ1	;CONTINUE
  2488
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 41
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2489				; TAPE BUFFERED OUTPUT CLASS DEP ROUTINE #2. USED TO BE
  2490				; COMMON DSK/TAPE ROUTINE WITH ENTRY
  2491				;DTODR2: TDZA P4,P4 ;TAPE. DO NOT SPLIT RECORDS
  2492				;DTODK2: MOVEI P4,200 ;DSK CAN SPLIT RECORDS
  2493
  2494				;  CALLED TO BUILD COMMAND LIST IN LIST AREA.
  2495
  2496				IFCPU (KL),<EXTERNAL CSVCNT,CSUCNT,CSHSAV>
  2497
  2498				;
  2499	002730'			DTODR2:
  2500	002730'	260040	000000*	IFCPU (KL),<CSHVAL		;START A VALIDATE
  2501	002731'	316300	000000*		CAMN T1,CSVCNT
  2502	002732'	254000	002731'		JRST	.-1>
  2503	002733'	201740	000000		MOVEI P4,0	;TAPE CANT SPLIT RECORDS
  2504	002734'	260040	003000'		PUSHJ	P,DTODR1	;MAKE SURE BUFFERS HAVE BEEN ADVANCED
  2505	002735'	255000	000000		JFCL
  2506	002736'	550404	000010		HRRZ	T3,DEVOAD(F)	;NEXT BUFFER
  2507	002737'	256200	004416'	 XCTBU <SKIPL T1,(T3)>	;BUFFER FULL?
  2508	002740'	263040	000000		 POPJ	P,		;NO. NO LIST TO SET UP
  2509	002741'	205000	000020		MOVSI S,IO
  2510	002742'	437004	000002		IORB S,DEVIOS(F)	;MAKE SURE I/O FLAG IS SET
  2511	002743'	260040	003225'		PUSHJ	P,GELSTA
  2512	002744'	550444	000003		HRRZ T4,DEVSER(F)
  2513	002745'	260051	000013		PUSHJ P,DGTRD(T4)	;MAKE SURE DEVICE READY FOR I/O
  2514	002746'	261040	000006	DTOD2:	PUSH P,T1	;SAVE NEXT BUFFER ADDRESS
  2515	002747'	256200	004417'	 XCTBU <HRRZ T1,1(T3)>	;GET WORD  COUNT
  2516	002750'	322740	002755'		JUMPE P4,DTOD5	;NOT SPLITABLE (FORCED)
  2517	002751'	313300	000017		CAMLE T1,P4	;IS THIS AN ACCEPTABLE SIZE?
  2518	002752'	256200	004420'	 XCTBU < HRRM P4,1(T3)>	;NO RESET IT IN USER AREA
  2519	002753'	202304	000014		MOVEM T1,DEVBWC(F)	;STORE REQUESTED USER COUNT
  2520	002754'	200300	000017		MOVE T1,P4	;AND SET NORMAL SIZE (DEVBWC IS COUNT OF LAST BUFFER)
  2521	002755'	303300	037777	DTOD5:	CAILE T1,37777
  2522	002756'	254000	002775'		 JRST DTOD1	;DIE IF TRANSFER TOO BIG
  2523	002757'	213000	000006		MOVNS T1
  2524	002760'	507000	000006		HRLS T1
  2525	002761'	541310	000001		HRRI T1,1(T3)	;SET ADDRESS
  2526	002762'	260040	003123'	DTOD4:	PUSHJ	P,BLDLST	;BUILD LIST IN LIST AREA
  2527	002763'	254000	002775'		  JRST	DTOD1		;BUILD FAILED
  2528	002764'	262040	000010		POP P,T3	;RESTORE BUFFER ADDRESS
  2529	002765'	602000	000040		TRNE	S,IOCON		;DIS CONTINUOUS MODE?
  2530	002766'	254000	002631'		 JRST	CLNLS1		;YES. QUIT AFTER 1 BUFFER
  2531	002767'	256200	004416'	 XCTBU <SKIPL T1,(T3)>	;FULL?
  2532	002770'	254000	002631'		 JRST	CLNLS1		;YES.
  2533	002771'	500404	000010		HLL	T3,DEVOAD(F)
  2534	002772'	316404	000010		CAMN	T3,DEVOAD(F)	;LOOPED AROUND?
  2535	002773'	254000	002631'		 JRST	CLNLS1		;YES. DONE WITH RING
  2536	002774'	254000	002746'		JRST DTOD2
  2537	002775'	262040	000010	DTOD1:	POP P,T3	;RESTORE BUFFER ADDRESS
  2538	002776'	323340	003301'		JUMPLE	T2,ADRCLS	;JUMP IF BAD PAGE REFERNECE
  2539	002777'	254000	002632'		JRST	MAPLS1
  2540
  2541				COMMENT ; TAPE BUFFERED OUTPUT CLASS DEP ROUTINE #1 - DTODR1
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 41-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2542				  (WAS COMMON TO DSK/TAPE BEFORE VM SYSTEM)  ;
  2543				;  CALLED TO ADVANCE BUFFERS
  2544				;
  2545	003000'	627000	000002	DTODR1:	TLZN	S,IOBEG		;FIRST TIME?
  2546	003001'	254000	003005'		JRST	DTOD11		;NO..
  2547	003002'	402004	000013		SETZM	DEVABC(F)	;YES. CLEAR COUNTER
  2548	003003'	205000	000002		MOVSI	S,IOBEG
  2549	003004'	413004	000002		ANDCAB	S,DEVIOS(F)		;CLEAR STATUS IN CORE
  2550	003005'	375404	000013	DTOD11:	SOSGE	T3,DEVABC(F)	;DECREMENT BUFFER COUNT
  2551	003006'	254000	003012'		JRST	DTOD14		;NO MORE BUFFERS
  2552	003007'	260040	003471'		PUSHJ	P,ADVBFE	;ADVANCE TO NEXT BUFFER
  2553	003010'	255000	000000		JFCL		;IGNORE END OF RING
  2554	003011'	254000	003005'		JRST	DTOD11		;DO NEXT BUFFER
  2555	003012'	354004	000013	DTOD14:	AOSA	DEVABC(F)
  2556	003013'	402004	000013	DTOD12:	SETZM	DEVABC(F)
  2557	003014'	254000	002562*		JRST	CPOPJ1
  2558
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 42
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2559				COMMENT ! TAPE DUMP IO CLASS DEP ROUTINE DTIDR3
  2560				FUNCTION: FOR EACH USER IOWD, BUILD COMMAND LIST IN SPACE
  2561				 RETURNED BY GELSTA, MAP ALL THE ADDRESSES TO MAKE SURE,
  2562				 GET THE DEVICE GOING,WAIT. QUIT ON END OF USER LIST OR ERROR
  2563				NOTE: THIS WAS ONCE COMMON DSK/TAPE CODE BEFORE VM SYSTEM
  2564				EXPECTS: M/ USER ADDR OF IOWDS
  2565					F/ DDB		S/DEVIOS
  2566				!
  2567
  2568	003015'			DTIDR3:
  2569				IFCPU (KL),<
  2570	003015'	260040	002563*		CSHUNL		;START AN UNLOAD
  2571	003016'	316300	002564*		CAMN	T1,CSUCNT
  2572	003017'	254000	003016'		JRST	.-1>		;WAIT TILL ITS DONE.
  2573	003020'	135740	004421'		LDB P4,[POINT 4,DEVIOS(F),35]	;GET MODE (FOR TAPE)
  2574	003021'	302740	000016		CAIE P4,DR
  2575	003022'	634740	000017		TDZA P4,P4	;IF NOT DUMP RECORD, CAN NOT SPLIT
  2576	003023'	201740	000200		MOVEI P4,200	;MTA DUMP RECORD CAN SPLIT
  2577	003024'	205000	000002	DTID36:	MOVSI S,IOBEG
  2578	003025'	437004	000002		IORB S,DEVIOS(F)	;SET IOBEG IN CASE DUMP RECORDS
  2579							;INDICATES FIRST PART OF IOWD
  2580	003026'	211700	000003		MOVNI P3,3	;THIS IS A COUNTER FOR GO/TO WORDS
  2581	003027'	256200	004307'	DTID33:	UMOVE T3,(M)	;GET A WORD FROM COMMAND LIST
  2582				IFCPU (KL),<
  2583	003030'	201313	000000		MOVEI T1,(M)	;ADDRESS FOR CACHE-REF
  2584	003031'	405300	000777		CSHREF
  2585	003032'	330020	002650*
  2586	003033'	330020	000001*
  2587	003034'	330020	000002*
  2588	003035'	330020	000003*
  2589				>;END IFCPU (KL)
  2590	003036'	200300	000010		MOVE T1,T3	;REALLY WANT COMMAND WORD HERE
  2591	003037'	322300	001321*		JUMPE T1,CPOPJ	;TERMINATE
  2592	003040'	603300	777777		TLNE T1,-1
  2593	003041'	254000	003045'		JRST DTID32	;NOT A GO TO, PROCESS
  2594	003042'	345700	002400*		AOJGE P3,ADRERR	;TO MAANY GO TO WORDS, DO NOT LOOP
  2595	003043'	540540	000006		HRR M,T1	;PICK UP ADDRESS OF NEXT WORD
  2596	003044'	254000	003027'		JRST DTID33	;AND CONTINUE
  2597
  2598	003045'	260040	003225'	DTID32:	PUSHJ P,GELSTA		;COMMAND, NEED TO GET LIST SPACE
  2599	003046'	550444	000003		HRRZ T4,DEVSER(F)
  2600	003047'	260051	000013		PUSHJ P,DGTRD(T4)	;MAKE SURE DEVICE READY FOR I/O
  2601	003050'	260040	003123'		PUSHJ P,BLDLST	;BUILD A COMMAND LIST
  2602	003051'	334000	000000		 SKIPA		;IT WOULD NOT ALL FIT
  2603	003052'	634300	000006		  TDZA T1,T1	;IT ALL FIT, 0 T1 FOR END OF COMMAND
  2604	003053'	321340	003301'		JUMPL T2,ADRCLS	;IF NOT ALL FIT AND T2 NEG, ADRESS CHECK
  2605	003054'	256200	004422'	 XCTBU <HLLZ T3,(M)>	;GET UUO COUNT
  2606	003055'	274300	000010		SUB T1,T3		;DETERMINE AMOUNT TRNAFERED
  2607	003056'	556304	000014		HLRZM T1,DEVBWC(F)	;AND SAVE IT
  2608	003057'	260040	002633'		PUSHJ P,MAPLST		;NOW MAP THE I/O LIST
  2609	003060'	260040	003112'		PUSHJ P,GODEV	;GET THE DEVICE TO GO, WAIT FOR FINISH
  2610	003061'	602000	360000		TRNE S,IODTER!IODERR!IOBKTL!IODEND
  2611	003062'	263040	000000		POPJ P,		;ERROR RETURN, ABORT
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 42-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2612	003063'	514304	000014		HRLZ T1,DEVBWC(F)	;COUNT ACTUALLY DONE
  2613	003064'	256200	004423'	 XCTBU <ADD T1,(M)>
  2614	003065'	607300	777777		TLNN T1,-1		;IS THERE ANY COUNT LEFT?
  2615	003066'	344540	003071'		 AOJA M,DTID31	;NO, CONTINUE
  2616	003067'	270304	000014		ADD T1,DEVBWC(F)	;ADJUST ADDRESS
  2617	003070'	254000	003045'		JRST DTID32	;AND CONTINUE
  2618
  2619				IFCPU (<KI,F3>),<DTID31==DTID36>
  2620				IFCPU (KL),<
  2621				;NOTE - SINCE USER CANNOT REFER TO ADJACENT WORDS TO DUMP MODE
  2622				; BUFFER (DUMP ALWAYS GOES INTO IO WAIT) THIS CODE SEEMS UNNECESSARY -
  2623				; HOWEVER, ANOTHER JOB MAY HAVE THE BUFFER PAGE MAPPED IN AND
  2624				; MAY REFERENCE ADJACENT WORDS, SO WE NEED TO DO THIS.
  2625
  2626	003071'	603000	000020	DTID31:	TLNE	S,IO		;IF THIS IS OUTPUT,
  2627	003072'	254000	003024'		JRST	DTID36		;NO NEED TO DUMP CACHE AFTER IO
  2628	003073'	256200	004424'		UMOVE	T2,-1(M)	;GET LAST IOWD
  2629	003074'	201307	000001		MOVEI	T1,1(T2)	;GET 1ST XFER ADDRESS
  2630	003075'	405300	000777		CSHREF	
  2631	003076'	330020	003032*
  2632	003077'	330020	000001*
  2633	003100'	330020	000002*
  2634	003101'	330020	000003*
  2635						;MAKE SURE THAT ADDRESS IS OUT OF CACHE NOW.
  2636	003102'	574300	000007		HLRE	T1,T2		;GET COUNT IN T1
  2637	003103'	276340	000006		SUBM	T2,T1		;GET LAST XFER ADDRESS
  2638	003104'	405300	000777		CSHREF	
  2639	003105'	330020	003076*
  2640	003106'	330020	000001*
  2641	003107'	330020	000002*
  2642	003110'	330020	000003*
  2643						;MAKE SURE ITS OUT OF THE CACHE
  2644	003111'	254000	003024'		JRST	DTID36		;GO FOR NEXT IOWD IF ANY.
  2645				>;END IFCPU (KL)
  2646
  2647				IFCPU (KS),<
  2648				DTID31:	TLNE	S,IO		;TEST IF OUTPUT
  2649					JRST	DTID36		;JUMP IF OUTPUT NO NEED TO INVALIDATE THE CACHE
  2650					CSHIVL			;INVALIDATE THE CACHE
  2651					JRST	DTID36
  2652				>;END IFCPU (KS)
  2653
  2654
  2655	003112'	260040	003262'	GODEV:	PUSHJ P,CLNLST	;REMOVE EXTRA LIST SPACE
  2656	003113'	550444	000003		HRRZ T4,DEVSER(F)
  2657	003114'	201411	777777		MOVEI T3,DDI(T4)
  2658	003115'	603000	000020		TLNE S,IO
  2659	003116'	201411	777776		MOVEI T3,DDO(T4)
  2660	003117'	260050	000000		PUSHJ P,(T3)
  2661	003120'	260040	002421*		PUSHJ P,WAIT1	;START DEVICE AND WAIT FOR END
  2662	003121'	402004	000013		SETZM DEVABC(F)	;MAKE SURE ADVANCE COUNT 0 FOR GETSTS
  2663	003122'	263040	000000		POPJ P,
  2664
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 43
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2665				; BUILD COMMAND LIST FOR BUFFER
  2666				;  ON ENTRY (T1)= -BUFSIZE AND BUF ADDRESS-1
  2667				;           (T2)= -LEN OF LIST BUF AND ADDR OF LIST BUF
  2668				;		(P4)= 0 IF CAN NOT BREAK REQ, SIZE OF BREAK OTHERWISE
  2669				;
  2670				;ON EXIT
  2671				;	SKIP RETURN, COMMAND FIT AND MORE CAN GO IN
  2672				;	NON-SKIP RETURN
  2673				;		T2<0 ERROR DISCOVERED WITH MAP
  2674				;		T2>=0
  2675				;		 T1=0 ALL OF COMMAND ENTERED BUT NO MORE LIST SPACE
  2676				;		 T1<>0 NOT ALL OF COMMAND IN LIST, T1 IS REMAINDER
  2677
  2678	003123'	261040	000007	BLDLST:	PUSH P,T2	;SAVE ORIGINAL POINTER IN CASE OF ABORT
  2679	003124'	252340	003212'		AOBJP T2,BLDLE0	;NOT ENOUGHG ROOM, ABORT
  2680	003125'	326740	003132'		JUMPN P4,BLDLS1	;IF WE CAN SPLIT, DO NOT WORRY ABOUT SIZE
  2681	003126'	554400	000006		HLRZ T3,T1	;GET SIZE
  2682	003127'	322400	003132'		JUMPE T3,BLDLS1	;0 IS ALWAYS OK (OUTPUT)
  2683	003130'	307400	740000		CAIG T3,740000
  2684	003131'	254000	003212'		JRST BLDLE0	;THIS IS TOO BIG A TRANSFER
  2685	003132'	201600	000000	BLDLS1:	MOVEI P1,0	;AMOUNT TRANSFERED SO FAR THIS LIST
  2686	003133'	564700	000006	BLDLS2:	HLRO P3,T1
  2687	003134'	213000	000016		MOVNS P3
  2688	003135'	553000	000016		HRRZS P3
  2689	003136'	303700	037777		CAILE P3,37777	;MAX IS AMOUNT IN 14 BIT COUNT FIELD
  2690	003137'	201700	037777		MOVEI P3,37777	;P3 HAS TRANSFER TO TRY THIS TIME
  2691	003140'	542307	777777		HRRM T1,-1(T2)	;STORE IN LIST
  2692	003141'	201646	000001		MOVEI P2,1(T1)
  2693	003142'	435640	000777		IORI P2,777
  2694	003143'	274640	000006		SUB P2,T1
  2695	003144'	553000	000015		HRRZS P2	;P2 NOW HAS COUNT TO END OF PAGE
  2696	003145'	311640	000016	BLDLM1:	CAML P2,P3	;IS SPACE TO END OF PAGE MORE THAN WANTED
  2697	003146'	200640	000016		MOVE P2,P3	;YES, SET COUNT FOR THIS COMMAND TO DESIRED
  2698
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 44
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2699	003147'	210700	000015	BLDLM3:	MOVN P3,P2	;SET TO STORE COUNT
  2700	003150'	137700	004425'		DPB P3,[POINT 14,-1(T2),13]
  2701	003151'	270600	000015		ADD P1,P2	;UNDATE COUNT THIS TRANSFER
  2702	003152'	204700	000015		MOVS P3,P2	;GET COUNT IN LEFT HALF
  2703	003153'	272700	000006		ADDM P3,T1	;THIS UPDATES COUNT OF REQUEST
  2704	003154'	270640	000006		ADD P2,T1	;THIS UPDATES ADDRESS (IN CASE OF CARRY)
  2705	003155'	542640	000006		HRRM P2,T1	;RESTORE IN REQUEST
  2706	003156'	325300	003217'		JUMPGE T1,BLDLND	;END NO MORE REQUESTED
  2707	003157'	253340	003133'		AOBJN T2,BLDLS2	;IS THERE ROOM FOR MORE?
  2708
  2709				;HERE WHEN THE TRANSFER IS NOT COMPLETED AND THERE IS NO
  2710				;MORE LIST ROOM. WE MUST SHORTEN THE TRANSFER TO A MULTIPLE OF
  2711				;THE BREAK COUNT. IF THE BREAK COUNT IS 0, REMOVE THE WHOLE TRANSFER
  2712
  2713	003160'	322740	003162'		JUMPE P4,BLDLB1	;BACKUP BY ENTIRE TRANSFER
  2714	003161'	317600	000017		CAMG P1,P4	;HAVE WE TRANSFERED AT LEAS 1 RECORD
  2715	003162'	334640	000014	BLDLB1:	SKIPA P2,P1	;NO, USE WHAT WE HAVE
  2716	003163'	230600	000017		IDIV P1,P4	;REMAINDER (IN P2) IS AMOUT TO BACKUP
  2717	003164'	210600	000015		MOVN P1,P2
  2718	003165'	517000	000014		HRLZS P1
  2719	003166'	272600	000006		ADDM P1,T1
  2720	003167'	207000	000014		MOVSS P1
  2721	003170'	270600	000006		ADD P1,T1	;READJUST TRANSFER
  2722	003171'	542600	000006		HRRM P1,T1
  2723	003172'	275340	000001	BLDLB4:	SUBI T2,1	;NO BACK UP COMMAND LIST
  2724	003173'	135400	004425'		LDB T3,[POINT 14,-1(T2),13]	;EXTRA AOBJN TO FIND OUT OF ROMM
  2725	003174'	670400	004426'		TDO T3,[-1,,740000]
  2726	003175'	213000	000010		MOVNS T3	;COUNT IN THAT WORD
  2727	003176'	313400	000015		CAMLE T3,P2	;ENOUGH?
  2728	003177'	254000	003204'		JRST BLDLB2	;YES, JUST FINISH UP
  2729	003200'	274640	000010		SUB P2,T3	;FIND OUT HOW MUCH MORE TO GO
  2730	003201'	402007	777777		SETZM -1(T2)	;REMOVE ENTIRE COMMAND WORD
  2731	003202'	322640	003207'		JUMPE P2,BLDLB3	;FINISHED IF NOW 0
  2732	003203'	254000	003172'		JRST BLDLB4	;OTHERWISE DO ANOTHER
  2733
  2734	003204'	241640	777762	BLDLB2:	ROT P2,-^D14	;GET AMOUNT TO SUTRACT TO COUNT FIELD
  2735	003205'	272647	777777		ADDM P2,-1(T2)	;ADJUST COMMAND
  2736	003206'	402007	000001		SETZM 1(T2)	;MAKE SURE 2 ZEROS AT END
  2737	003207'	402007	000000	BLDLB3:	SETZM (T2)	;MAKE SUURE OF A 0 (ACTUALLY 2'ND ZERO)
  2738	003210'	262040	000011		POP P,T4	;CLEAR SAVED POINTER FROM STACK
  2739	003211'	263040	000000		POPJ P,
  2740
  2741	003212'	250341	000000	BLDLE0:	EXCH T2,(P)	;NORMAL EXIT. LEAVE WIITH SAME CONDITION OF T2. GET OLD
  2742	003213'	402007	000000		SETZM (T2)
  2743	003214'	402007	000001		SETZM 1(T2)	;MAKE SURE 2 ZEROS
  2744	003215'	262040	000007		POP P,T2	;AND GET BACK ENDING POINTER (NEG FOR ADRS CHECK
  2745	003216'	263040	000000		POPJ P,		;ALL FINISHED
  2746
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 45
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2747	003217'	402007	000000	BLDLND:	SETZM (T2)	;THIS IS IT, ALL REQUEST IS IN
  2748	003220'	402007	000001		SETZM 1(T2)	;MAKE SURE DOUBLE 0 AT END
  2749	003221'	262040	000006		POP P,T1	;CLEAR SAVED POINTER OFF STACK
  2750	003222'	201300	000000		MOVEI T1,0	;MAKE T1 ALL ZERO TO SAY DONE (IN CASE
  2751							 ;OF A 0 COUNT REQUEST AND NO ROOM)
  2752	003223'	252340	003037*		AOBJP T2,CPOPJ	;IF WE ARE OUT OF ROOM, JUST EXIT
  2753	003224'	254000	003014*		JRST CPOPJ1
  2754
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 46
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2755				;  GET LIST AREA IF NEEDED. ENTRY GELSTA.
  2756				;  ON ENTRY (T2)=ADDRESS OF EXISTING LIST OR 0 IF NONE
  2757				;  ON EXIT  RH(T2)=ADDRESS OF LIST AREA
  2758				;            LH(T2)=-LENGTH OF LIST AREA-1
  2759				;  T2 RETURNS  0 IF MAX LIST IS ALREADY IN USE
  2760				;
  2761	003225'	550344	000011	GELSTA:	HRRZ T2,DEVCLS(F)	;PICK UP CURRENT
  2762	003226'	326340	003260'		JUMPN	T2,GELST1	;JUMP IF HAVE FIXED LIST
  2763	003227'	335000	000000*		SKIPGE	FCREQ		;ANYBODY ELSE WAITING FOR A LIST?
  2764	003230'	254000	003234'		JRST	GELST2		;NO.
  2765	003231'	350000	003227*	GELST5:	AOS	FCREQ		;YES. WE WAIT TOO
  2766	003232'	260040	000000*		PUSHJ	P,FCWAIT
  2767	003233'	370000	003231*		SOS FCREQ		;NOW ONE LESS WAITER
  2768	003234'	135340	000000*	GELST2:	LDB	T2,DEYMCT	;TRY FOR MAX ALLOWED
  2769	003235'	200600	000007	GELST6:	MOVE 	P1,T2		;SAVE SIZE OF REQUEST
  2770	003236'	261040	000006		PUSH P,T1		;SAVE T1 (CALLERS NEED IT)
  2771	003237'	261040	000010		PUSH P,T3	;SAVE T3 (AN ADDRESS)
  2772	003240'	260040	000000*		PUSHJ	P,GET4WD	;GET 4 WORD BLOCKS
  2773	003241'	254000	003254'		JRST	GELST3		;NOT ENOUGH AVAILABLE
  2774	003242'	137600	000000*		DPB	P1,DEYTCT	;STORE COUNT WE HAVE
  2775	003243'	210340	000014		MOVN	T2,P1		;NEGATE COUNT
  2776	003244'	240340	000002		ASH	T2,2		;CONVERT TO WORDS
  2777	003245'	271340	000001		ADDI	T2,1		;-1
  2778	003246'	504340	000006		HRL	T2,T1
  2779	003247'	207000	000007		MOVSS	T2		;FORM POINTER
  2780	003250'	262040	000010		POP P,T3
  2781	003251'	262040	000006		POP P,T1
  2782	003252'	542344	000011		HRRM T2,DEVCLS(F)	;SET LIST POINTER
  2783	003253'	263040	000000		POPJ	P,
  2784	003254'	262040	000010	GELST3:	POP P,T3	;RESTORE THE ADDRESS
  2785	003255'	262040	000006		POP P,T1
  2786	003256'	326340	003235'		JUMPN	T2,GELST6	;IS SOME FREE CORE LEFT?
  2787	003257'	254000	003231'		JRST	GELST5		;NO. WAIT FOR IT
  2788	003260'	505340	777736	GELST1:	HRLI	T2,-LENFXL+1	;LENGTH OF FIXED LIST
  2789	003261'	263040	000000		POPJ	P,
  2790
  2791				;THE FOLLOWING ROUTINE GIVES BACK UNUSED LIST SPACE
  2792
  2793	003262'	135400	003242*	CLNLST:	LDB T3,DEYTCT	;AMOUNT WE HAVE
  2794	003263'	322400	003223*		JUMPE T3,CPOPJ	;MUST BE FIXED LIST DEVICE (MTA)
  2795	003264'	201447	000005		MOVEI T4,2+3(T2)	;2(T2) IS END +3 FOR ROUND UP
  2796	003265'	274444	000011		SUB T4,DEVCLS(F)
  2797	003266'	553000	000011		HRRZS T4
  2798	003267'	242440	777776		LSH T4,-2	;NUMBER OF 4 WORD BLOCKS USED
  2799	003270'	317400	000011		CAMG T3,T4	;DO WE HAVE MORE THAN USED?
  2800	003271'	263040	000000		POPJ P,		;NO
  2801	003272'	137440	003262*		DPB T4,DEYTCT	;YES, SAVE NEW NUMBER USED
  2802	003273'	200300	000010		MOVE T1,T3
  2803	003274'	274300	000011		SUB T1,T4	;NUMBER TO GIVE BACK
  2804	003275'	550344	000011		HRRZ T2,DEVCLS(F)
  2805	003276'	242440	000002		LSH T4,2
  2806	003277'	270340	000011		ADD T2,T4	;THIS IS THE FIRST WORD TO GIVE BACK
  2807	003300'	324740	000000*		PJRST GIV4WD
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 46-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2808
  2809	003301'	550344	000011	ADRCLS:	HRRZ T2,DEVCLS(F)	;CLEAR ENTIRE LIST
  2810	003302'	275340	000002		SUBI T2,2	;FAKE IT FOR THE +2 IN CLNLST
  2811	003303'	260040	003262'		PUSHJ P,CLNLST
  2812	003304'	200100	000713*		MOVE	J,JOB	;SETUP J
  2813					SETZM	JBTABT(J)	;AND MAKE SURE JBTABT NOT CALLED NOW, CALLER HAS FIXED THINGS U
  2814	003305'	402002	002635*	P.
  2815	003306'	254000	003042*		JRST ADRERR	;AND THEN OFF TO ADDRESS ERROR
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 47
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2816				;  COMPUTE CURRENT ADDRESS AND LENGTH OF NEXT
  2817				;  CONTIGUOUS BLOCK OF EMPTY SPACE IN THE MONITOR
  2818				;  BUFFER ASSOCIATED WITH THE CURRENT DDB.
  2819				;   ON EXIT (T1)=LENGTH
  2820				;           (T2)=ADDRESS
  2821				;
  2822	003307'	261040	000014	CBLAMB::PUSH	P,P1		;WILL NEED A REGISTER
  2823	003310'	550604	000011		HRRZ	P1,DEVCLS(F)	; FOR BUFFER POINTER
  2824	003311'	550314	777776		HRRZ	T1,-2(P1)	;GET THE OUT POINTER
  2825	003312'	316300	000014		CAMN	T1,P1		;HAS OUT WRAPPED AROUND?
  2826	003313'	550314	777777		HRRZ	T1,-1(P1)	;YES, PRETEND IS HAS NOT
  2827	003314'	554354	777776		HLRZ	T2,-2(P1)	; AND THE IN POINTER=ADDRESS OF BLOCK
  2828	003315'	274300	000007		SUB	T1,T2		;COMPUTE LENGTH
  2829	003316'	365300	003321'		SOJGE	T1,CBLAM1	;IF IN .GT. OUT
  2830	003317'	550314	777777		HRRZ	T1,-1(P1)	; BLOCK GOES TO EOB
  2831	003320'	274300	000007		SUB	T1,T2		;COMPUTE BLOCK LENGTH
  2832	003321'	262040	000014	CBLAM1:	POP	P,P1		;RESTORE REGISTER
  2833	003322'	263040	000000		POPJ	P,		; AND RETURN
  2834				;
  2835				;  COMPUTE ADDRESS AND LENGTH OF NEXT FULL BLOCK IN
  2836				;  USER BUFFER.
  2837				;   ON EXIT (T3)=ADDRESS (IN USER SPACE)
  2838				;           (T4)=LENGTH
  2839				;
  2840	003323'	555440	000000	CBLAUB::HLRZI	T4,		;CLEAR LENGTH
  2841	003324'	550404	000010		HRRZ	T3,DEVOAD(F)	;CURRENT BUFFER ADDRESS
  2842	003325'	256200	004427'	 XCTBU <SKIPL (T3)>	;GET USE BIT
  2843	003326'	254000	003333'		 JRST	CBLAU1	;IF BUFFER IS EMPTY
  2844	003327'	256200	004214'	 XCTBU <HRRZ T4,1(T3)>	;GET BUFFER WORD COUNT
  2845	003330'	550344	000013		HRRZ	T2,DEVPWC(F)	
  2846	003331'	274440	000007		SUB	T4,T2		;COMPUTE REMAINING COUNT
  2847	003332'	271407	000002		ADDI	T3,2(T2)		;START OF DATA AREA
  2848	003333'	263040	000000	CBLAU1:	POPJ	P,		;AND RETURN
  2849
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 48
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2850	003334'			RELEAX::	;RELEASE A DEVICE
  2851	003334'	201300	000000	RELEAS:	MOVEI	T1,0
  2852	003335'	260040	000077'		PUSHJ	P,CHNCHK	;CHECK FOR CHANNEL ASSIGNED.
  2853	003336'	263040	000000		  POPJ	P,		;NO OPERATION IF NO CHANNEL ASSIGNED.
  2854	003337'	255000	000000		  JFCL			;SHORT DISPATCH TABLE OKAY.
  2855	003340'	620540	777777		TRZ	M,-1		;CLOSE BOTH INPUT AND OUTPUT
  2856	003341'	260040	000133'		PUSHJ	P,CLOSE1
  2857	003342'	260040	003120*		PUSHJ	P,WAIT1		;WAIT FOR DEVICE TO BECOME INACTIVE
  2858	003343'	550444	000003		HRRZ	T4,DEVSER(F)	;RESTORE T4
  2859	003344'	260051	000006	RELEA5::PUSHJ	P,DRL(T4)	;DISPATCH TO DEVICE SERVICE ROUTINE
  2860	003345'	201000	010000		MOVEI	S,IOACT		;CLEAR IO ACTIVE BIT
  2861	003346'	413004	000002		ANDCAB	S,DEVIOS(F)	;AND RETURN WITH S SET
  2862	003347'	403252	000000*		SETZB	U,%UPT+UPTJDA(W);CLEAR DEVICE ASSIGNMENT
  2863	003350'	303500	000017		CAILE	W,17
  2864	003351'	254000	003354'		 JRST	RELE5A		;PAST END USER JOBJDA
  2865	003352'	260040	000470*		UXCTBU <SETZM JOBJDA(W)>
  2866	003353'	256200	004430'
  2867				;This next loop is to check if single DECtape open on two channels at once
  2868	003354'	200300	000000*	RELE5A:	MOVE	T1,%UPT+UPTHCU	;HIGHEST IO CHANNEL IN USE
  2869	003355'	550346	000000*	RELEA4:	HRRZ	T2,%UPT+UPTJDA(T1)
  2870	003356'	326240	003363'		JUMPN	U,RELE4A	;NON-ZERO CHAN. ALREADY?
  2871	003357'	200240	000007		MOVE	U,T2		;NO, SET U WHEN FIRST(HIGHEST) FOUND
  2872	003360'	202300	000000*		MOVEM	T1,%UPT+UPTHCU	;STORE HIGHEST IN USE CHANNEL
  2873	003361'	260040	003352*		UXCTBU <MOVEM T1,JOBHCU>
  2874	003362'	256200	004236'
  2875	003363'	302344	000000	RELE4A:	CAIE	T2,(F)		;IS THIS DEVICE SAME AS ONE BEING RELEASED?
  2876	003364'	365300	003355'		 SOJGE	T1,RELEA4
  2877	003365'	325300	003263*		JUMPGE	T1,CPOPJ	;EXIT IF ON ANOTHER CHANNEL
  2878	003366'	513004	000007		HLLZS	DEVIAD(F)	;CLEAR INPUT BUFFER ADDRESS
  2879	003367'	513004	000010		HLLZS	DEVOAD(F)	;AND OUTPUT BUFFER ADDRESS.
  2880					PFALL	RELEA9
  2881
  2882				;CALLED FROM ERROR STOP ROUTINE(ESTOP)
  2883	003370'	200304	000000	RELEA9::MOVE	T1,DEVNAM(F)	;IS THIS SYSTEM TAPE?
  2884	003371'	201340	200000	RELEA7:	MOVEI	T2,ASSPRG	;CLEAR ASSIGNED BY PROGRAM BIT
  2885	003372'	413344	000004	RELEA6::ANDCAB	T2,DEVMOD(F)	;CALLED FROM DEASSIGN
  2886	003373'	620340	000777		TRZ	T2,777		;CLEAR JOB NO. FIELD
  2887	003374'	612340	004431'		TDNE	T2,[XWD TTYATC,ASSCON+ASSPRG]
  2888	003375'	263040	000000		 POPJ	P,		;DEVICE ASSIGNED BY OTHER MEANS TOO
  2889	003376'	603340	004010		TLNE	T2,DVTTY!DVRMT
  2890					 JRST	[HRRZ T4,DEVSER(F)
  2891	003377'	254000	004432'			 JRST DZAP(T4)]	;GO ZAP AUX CIR OR RMT
  2892	003400'	137340	002633*		DPB	T2,PJOBN	;CLEAR JOB NUMBER
  2893	003401'	261040	000002		PUSH	P,J		;SAVE JOB NO.
  2894	003402'	201100	400000		MOVEI	J,ASSCON
  2895	003403'	607340	200010		TLNN	T2,DVDSK!DVTTY	;DO NOT ASSIGN TO JOB 0
  2896	003404'	436104	000004		 IORM	J,DEVMOD(F)	;OTHERWISE DO
  2897	003405'	603340	200000		TLNE	T2,DVDSK	;IS DEVICE A DSK
  2898	003406'	260040	000000*		 PUSHJ	P,CLRDDB##	;YES-RETURN DDB TO STORAGE
  2899	003407'	254000	000000*		JRST	IPOPJ##		;RESTORE JOB NO. & RETURN.
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 49
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2900				;CALLING SEQUENCE
  2901				;	STATO D,MASK
  2902				;	EXIT1		ALL SELECTED BITS ARE 0
  2903				;	EXIT2		SOME SELECTED BITS ARE 1
  2904				;TESTS BITS OF I/O STATUS WORD OF DEVICE ON USER'S CHANNEL D WHICH
  2905				;ARE SELECTED BY MASK.
  2906
  2907	003410'	260040	003423'	USTATO:	PUSHJ	P,GETSTS	;GET STATUS
  2908	003411'	602313	000000		TRNE T1,(M)		;SKIP IF ANY INDICATED BITS ARE ONE
  2909	003412'	350001	000000		AOS (P)
  2910	003413'	263040	000000		POPJ P,		;RETURN TO USER
  2911
  2912				;CALLING SEQUENCE
  2913				;	STATUS D,ADR
  2914				;	EXIT		ALWAYS RETURNS HERE
  2915				;STORES I/O STATUS WORD OF DEVICE ON CHANNEL D IN LOCATION ADR.
  2916
  2917
  2918	003414'	260040	003423'	USTATS:	PUSHJ	P,GETSTS
  2919	003415'	256200	004245'		UMOVEM T1,(M)		;MOVE STATUS TO USER AREA.
  2920	003416'	263040	000000		POPJ P,			;AND RETURN.
  2921
  2922				;CALLING SEQUENCE
  2923				;	STATZ D,MASK
  2924				;	EXIT1		SOME SELECTED BITS ARE 1
  2925				;	EXIT2		ALL SELECTED BITS ARE 0
  2926
  2927				;TESTS BITS OF I/O STATUS WORD OF DEVICE ON USER'S
  2928				;CHANNEL D WHICH ARE SELECTED BY MASK.
  2929
  2930
  2931	003417'	260040	003423'	USTATZ:	PUSHJ	P,GETSTS
  2932	003420'	606313	000000		TRNN	T1,(M)
  2933	003421'	350001	000000		AOS (P)
  2934	003422'	263040	000000		POPJ P,		;RETURN TO USER
  2935
  2936	003423'	201300	000000	GETSTS:	MOVEI T1,0
  2937	003424'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  2938	003425'	254000	002260*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  2939	003426'	255000	000000		JFCL			;SHORT DISPATCH TABLE OK.
  2940	003427'	135300	002410*		LDB	T1,DEYCLS	;GET CLASS CODE
  2941	003430'	256006	003441'		XCT	STCLTB(T1)	;GET CORRECT STATUS
  2942	003431'	263040	000000		POPJ	P,		;RETURN HERE IF STATUS SHOULD BE RETURNED AS IS
  2943	003432'	603000	000020		TLNE S,IO
  2944	003433'	254000	003437'		JRST GETST2		;ALWAYS RETURN ALL BITS FOR OUTPUT
  2945	003434'	606000	010000		TRNN	S,IOACT
  2946	003435'	332004	000013		SKIPE	DEVABC(F)	;ALL BUFFERS ADVANCED?
  2947	003436'	620300	760000		TRZ	T1,760000	;NO. DO NOT RETURN ERROR BITS
  2948	003437'	553000	000006	GETST2:	HRRZS	T1
  2949	003440'	263040	000000		POPJ	P,
  2950
  2951	003441'	550300	000000	STCLTB:	HRRZ	T1,S
  2952	003442'	550300	000000		HRRZ	T1,S
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 49-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2953	003443'	550300	000000		HRRZ 	T1,S	;DSK NOW USES SIMIO. RETURN DEVIOS AS IS
  2954	003444'	334300	000000		SKIPA	T1,S
  2955
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 50
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  2956				;IN MUUO - LIKE INPUT	SKIPS IF  EOF OR ERRORS
  2957
  2958
  2959	003445'	201300	000011	TIN:	MOVEI T1,DIN
  2960	003446'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  2961	003447'	254000	003425*		 JRST ERRIUC		;ERROR -- NO CHANNEL.
  2962	003450'	255000	000000		JFCL			;SHORT DISPATCH TABLE OK.
  2963	003451'	260040	001530'		PUSHJ P,INCOM		;DO INPUT UUO
  2964	003452'	260040	003423'		PUSHJ	P,GETSTS
  2965	003453'	602300	760000		TRNE T1,IOBKTL+IODTER+IODERR+IOIMPM+IODEND
  2966	003454'	350001	000000		AOS (P)
  2967	003455'	263040	000000		POPJ P,
  2968
  2969				;OUT MUUO - LIKE OUTPUT  -  SKIPS IF ERRORS
  2970
  2971
  2972	003456'	201300	000010	TOUT:	MOVEI T1,DOU
  2973	003457'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  2974	003460'	254000	003447*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  2975	003461'	255000	000000		JFCL			;SHORT DISPATCH TABLE OK.
  2976	003462'	260040	002264'		PUSHJ P,UOUT1		;DO OUTPUT UUO
  2977	003463'	200304	000004		MOVE T1,DEVMOD(F)	;GET CHRS.
  2978	003464'	603300	000020		TLNE T1,DVMTA		;IS IT A MAG TAPE?
  2979	003465'	606000	002000		TRNN S,IOTEND		;YES, ALSO CHECK FOR END OF TAPE
  2980	003466'	602000	740000		TRNE S,IOBKTL+IODTER+IODERR+IOIMPM
  2981	003467'	350001	000000		AOS (P)
  2982	003470'	263040	000000		POPJ P,
  2983
  2984
  2985				;ROUTINE TO ADVANCE OUTPUT BUFFER AT INTERRUPT LEVEL
  2986
  2987				;CALL:	PUSHJ P,ADVBFE
  2988				;	EXIT1		RETURN IF NEXT BUFFER IS EMPTY
  2989				;	EXIT2		RETURN IF NEXT BUFFER IS FULL
  2990				;CLEARS THE USE BIT (IOUSE:=0) OF THE BUFFER POINTED TO BY THE
  2991				;OUTPUT BUFFER ADDRESS (DEVOAD) OF THE CURRENT DEVICE DATA BLOCK
  2992				;AND ADVANCES THE BUFFER ADDRESS TO THE NEXT BUFFER IN THE RING.
  2993				;UPON RETURN, SKIPS IF THE NEXT BUFFER IS FULL.
  2994				;SECOND WORD OF NEXT BUFFER IS ADDRESS CHECKED TO
  2995				;MAKE SURE IT IS NOT IN JOB DATA AREA OR ABOVE USER AREA
  2996				;THE SECOND WORD OF CURRENT BUFFER WAS CHECKED AT MUUO LEVEL
  2997				;OR PREVIOUS CALL TO ADVBFE
  2998
  2999	003471'	550344	000010	ADVBFE::HRRZ T2,DEVOAD(F)	;ABS. ADR. OF 2ND WORD OF LAST BUF.
  3000	003472'	322340	003365*		JUMPE T2,CPOPJ	;HAS DEVOAD BEEN CLEARED BY RELEASE?
  3001	003473'	256200	004434'		UMOVEM S,-1(T2)	;NO. STORE IO STATUS WORD(ERROR BITS)
  3002								; IN FIRST WORD OF BUFFER
  3003	003474'	205300	400000		MOVSI T1,IOUSE		;IOUSE:=0
  3004	003475'	256200	004324'	 XCTBU <ANDCAB T1,(T2)>		;  CLEAR USE BIT IN 2ND WORD
  3005								; ADDRESS CHECKED WHEN STORED IN DEVOAD
  3006								; DEVICE ACTIVE SINCE THEN
  3007	003476'	542304	000010		HRRM T1,DEVOAD(F)	;NOW STORE NEXT BUFFER ADDRESS
  3008	003477'	256200	004211'	 XCTBU <SKIPL (T1)>		;IS IOUSE=0?
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 50-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3009	003500'	263040	000000		 POPJ P,		;EXIT1. BUFFER IS EMPTY
  3010	003501'	254000	003514'		JRST ADVBF1		;GO SEE IF USER TYPED CONTROL C
  3011								; OR EXEC IS WAITING TO SHUFFLE JOB
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 51
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3012				;ROUTINE TO ADVANCE INPUT BUFFER AT INTERRUPT LEVEL
  3013
  3014				;CALL:	PUSHJ P,DEVBFF
  3015				;	  EXIT1		RETURN IF NEXT BUFFER IS FULL
  3016				;	EXIT2		RETURN IF NEXT BUFFER IS EMPTY
  3017				;SETS THE USE BIT (IOUSE:=1) OF THE BUFFER POINTED TO BY THE
  3018				;INPUT BUFFER ADDRESS (DEVIAD) OF THE CURRENT DEVICE DATA BLOCK
  3019				;AND ADVANCES THE BUFFER ADDRESS TO THE NEXT BUFFER IN THE RING.
  3020				;UPON RETURN, SKIPS IF THE NEXT BUFFER IS EMPTY.
  3021				;SECOND WORD OF NEXT BUFFER IS ADDRESS CHECKED TO MAKE SURE
  3022				;IT IS NOT IN IO PROTECTED PART OF JOB DATA AREA OR ABOVE
  3023				;USER AREA
  3024				;ALSO END OF BUFFER IS CHECKED TO MAKE SURE NOT ABOVE JOB AREA
  3025
  3026	003502'	550344	000007	ADVBFF::HRRZ T2,DEVIAD(F)	; ABS. ADR. OF LAST INPUT BUFFER
  3027	003503'	322340	003472*		JUMPE T2,CPOPJ	;HAS DEVIAD BEEN CLEARED BY RELEASE?
  3028	003504'	256200	004434'		UMOVEM S,-1(T2)	;NO. STORE S WORD IN FIRST WORD OF BUF.
  3029	003505'	205300	400000		MOVSI T1,IOUSE		;IOUSE:=1
  3030	003506'	256200	004364'	 XCTBU <IORB T1,(T2)>	;FLAG THAT DATA HAS BEEN INPUT
  3031	003507'	542304	000007		HRRM T1,DEVIAD(F)	;YES, SAFELY STORE ADDRESS OF NEXT BUFFER
  3032	003510'	256200	004435'	 XCTBU <SKIPGE T2,(T1)> ;IS NEXT INPUT BUFFER STILL FULL?
  3033	003511'	263040	000000		 POPJ P,		;YES, GIVE STOP RETURN
  3034	003512'	620340	777777		TRZ T2,-1		;XWD LENGTH OF BUFFER,0
  3035	003513'	270300	000007		ADD T1,T2		;ADD LENGTH TO REL. ADR. OF SECOND WORD
  3036								; LENGTH=NO. WORDS WHICH FOLLOW SECOND
  3037	003514'	606000	000040	ADVBF1:	TRNN S,IOCON		;NEXT BUFFER AVAILABLE. DISCONTINUOUS MODE?
  3038	003515'	350001	000000		AOS (P)		;NO
  3039	003516'	263040	000000		POPJ P,		;YES
  3040
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 52
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3041				;ASSIGN DEVICE IF UNASSIGNED
  3042				;CALL:	MOVE J, JOB NUMBER
  3043				;	MOVE F, ADDR. OF DDB
  3044				;	MOVEI T2, EITHER ASSPRG OR ASSCON
  3045				;	PUSHJ P, ASSASG
  3046				;	CAN'T ASSIGN RETURN
  3047				;	ASSIGNED RETURN
  3048
  3049	003517'	500344	000004	ASSASG::HLL T2,DEVMOD(F)	;IS IT A DISK?
  3050	003520'	607340	200000		TLNN T2,DVDSK
  3051	003521'	254000	003524'		JRST ASSAS0
  3052	003522'	260040	000000*		PUSHJ P,SETDDB##;YES, BUILD DEVICE DATA BLOCK
  3053	003523'	254000	003552'		 JRST ASSAS2	;NO SPACE FOR DDB
  3054	003524'	621340	777777	ASSAS0:	TLZ T2,-1		;HAVE A DDB -ZERO LH(T2)
  3055					NOSCHEDULE		;DISABLE SCHEDULING
  3056	003525'	135300	003400*		LDB T1,PJOBN		;GET JOB NUMBER IN DEV DATA BLOCK
  3057	003526'	316300	000002		CAMN T1,J		;IS IT ALREADY ASSIGNED TO THIS JOB
  3058	003527'	254000	003550'		JRST ASSAS1		;YES
  3059	003530'	201300	600000		MOVEI T1, ASSPRG+ASSCON	;NO, IS IT ASSIGNED TO ANOTHER JOB?
  3060	003531'	616304	000004		TDNN T1, DEVMOD(F)	;ARE EITHER ASSIGNED BITS SET?
  3061	003532'	254000	003547'		JRST ASSAS3		;NO
  3062	003533'	135300	003525*		LDB T1,PJOBN
  3063	003534'	326300	003552'		JUMPN T1,ASSAS2		;NOT JOB 0, CAN NOT GET IT
  3064	003535'	201300	200000		MOVEI T1,ASSPRG		;IS IT ASSIGNED BY PROGRAM
  3065	003536'	612304	000004		TDNE T1,DEVMOD(F)
  3066	003537'	254000	003552'		JRST ASSAS2		;YES, CAN NOT GET IT
  3067	003540'	205300	020000		MOVSI T1,LICGDV
  3068	003541'	602340	400000		TRNE T2,ASSCON		;IS HE TRING TO ASSIGN BY CONSOLE
  3069	003542'	201300	020000		MOVEI T1,LICGDV		;YES, USE JOB FIELD, ELSE PROCESS FIELD
  3070	003543'	616302	000000*		TDNN T1,JBTLIC(J)
  3071	003544'	254000	003552'		JRST ASSAS2		;DOES NOT HAVE LICENSE
  3072	003545'	201300	400000		MOVEI T1,ASSCON		;MUST CLEAR ASS BY CONSOLE BIT
  3073	003546'	412304	000004		ANDCAM T1,DEVMOD(F)
  3074	003547'	137100	003533*	ASSAS3:	DPB J,PJOBN		;STORE JOB NUMBER
  3075	003550'	436344	000004	ASSAS1:	IORM T2,DEVMOD(F)	;SET ONE OF ASSIGN BITS
  3076	003551'	350001	000000		AOS (P)
  3077	003552'			ASSAS2:	SCHEDULE		;SCHEDULING
  3078	003552'	263040	000000		POPJ P,
  3079
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 53
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3080				;ROUTINE TO SEARCH FOR A DEVICE
  3081				;CALL:	HRR J,JOB NUMBER
  3082				;	MOVE T1,[SIXBIT .DEVICE NAME.]
  3083				;	PUSHJ P, DEVSRC
  3084				;	  NOT FOUND
  3085				;	FOUND
  3086
  3087	003553'	260040	003556'	DEVSRC::PUSHJ	P,DEVLG		;SEARCH LOGICAL NAMES FIRST
  3088	003554'	254000	003611'		  JRST	DEVPHY		;NOT FOUND, SEARCH PHYSICAL NAMES
  3089	003555'	254000	003224*		JRST	CPOPJ1		;FOUND
  3090
  3091				;SEARCH LOGICAL NAMES
  3092
  3093	003556'	554340	000012	DEVLG::	HLRZ	T2,W
  3094	003557'	306340	400000		CAIN	T2,PHONLY
  3095	003560'	263040	000000		 POPJ	P,		;DO NOT SEARCH LOGICAL NAMES
  3096	003561'	554200	000000*		HLRZ	F,DEVLST##	;BEGINNING OF DDB CHAIN
  3097	003562'	261040	000010		PUSH	P,T3		;In case anyone wants this preserved
  3098	003563'	201400	023420		MOVEI	T3,^D10000	;Paranoid loop counter
  3099	003564'	312304	000005	DEVLP0:	CAME	T1,DEVLOG(F)	;COMPARE WITH LOGICAL NAME
  3100	003565'	254000	003571'		 JRST	DEV0		;NO MATCH
  3101	003566'	135340	003547*		LDB	T2,PJOBN	;DOES THE LOGICAL NAME BELONG TO THIS JOB?
  3102	003567'	316340	000002		CAMN	T2,J
  3103	003570'	326300	003643'		 JUMPN	T1,DEVLP3	;YES, GIVE SUCCESSFUL RET. IF NAME NOT 0
  3104	003571'	377000	000010	DEV0:	SOSG	T3		;Count number of time thru here
  3105	003572'	256000	000000*		 STOPCD	(,XCT,DDBCNE)
  3106					;DDB chain has no end ;;DEVLG+12
  3107	003573'	554204	000003		HLRZ	F,DEVSER(F)	;NO, KEEP LOOKING
  3108	003574'	326200	003564'		JUMPN	F,DEVLP0
  3109	003575'	262040	000010		POP	P,T3		;Restore T3
  3110	003576'	263040	000000		POPJ	P,		;FINISHED AND NOT FOUND
  3111
  3112				;DVCNSG -- ROUTINE TO FIND DDB FOR THOSE UUOS
  3113				;		WHICH HAVE DUAL STYLE ARGUMENT:
  3114				;		(1) 0-17 = CHANNEL NUMBER (INITED)
  3115				;		(2) ELSE = SIXBIT DEVICE NAME (GENERIC,...)
  3116				;CALL:	MOVE T1,ARGUMENT
  3117				;	PUSHJ P,DVCNSG
  3118				;RETURN CPOPJ IF NO SUCH DEVICE
  3119				;SKIP RETURN WITH F = DDB ADDRESS IF FOUND
  3120
  3121	003577'	331000	000006	DVCNSG::SKIPL	T1		;IF NEGATIVE
  3122	003600'	303300	000372*		CAILE	T1,MAXCHN##	;  OR .GT. 57,
  3123	003601'	324740	003553'		 PJRST	DEVSRC		;  MUST BE SIXBIT
  3124	003602'	250500	000006		EXCH	W,T1		;MOVE CHANNEL NO. INTO W
  3125	003603'	260040	000077'		PUSHJ	P,CHNCK1	;CHECK FOR CHANNEL ASSIGNED.
  3126	003604'	254000	003607'		  JRST	.+3		;ERROR, NO CHANNEL.
  3127	003605'	255000	000000		  JFCL			;NO-OP ON SHORT DISPATCH TABLE.
  3128	003606'	350001	000000		 AOS	(P)		;PREPARE FOR SKIP RETURN.
  3129	003607'	250500	000006		EXCH	W,T1		;RESTORE ACCUMULATORS.
  3130	003610'	263040	000000		POPJ	P,		;AND RETURN.
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 54
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3131				;SEARCH PHYSICAL NAMES
  3132
  3133				PRINTF(<[Need to add ersatz devices at DEVPHY]>)
  3134	003611'	260040	000000*	DEVPHY::PUSHJ	P,TSTDSK##	;IS DEVICE A DISK?
  3135	003612'	254000	003555*		 JRST	CPOPJ1		;YES. RETURN WITH RH(F)=PROTOTYPE DISK DDB
  3136	003613'	316300	004436'		CAMN	T1,[SIXBIT /OPR/];IS IT "OPR"?
  3137	003614'	200300	000000*		 MOVE	T1,DEVOPR##	;YES, CHANGE TO OPERATOR'S TTY
  3138	003615'	261040	000010		PUSH	P,T3		;SAVE T3
  3139	003616'	400400	000000		SETZ	T3,		;IF T3=-1 USER IS ASKING FOR SYS
  3140	003617'	316300	004437'		CAMN	T1,[SIXBIT /SYS/];IS IT "SYS"?
  3141					 JRST	[SETO	T3,	;USER IS ASKING
  3142						 SKIP T1,[SIXBIT /DSK/]	;CHANGE TO SYSTEM TAPE DEVICE NAME
  3143	003620'	254000	004441'			 JRST .+2]	;SKIP NEXT IN-LINE INSTRUCTION
  3144	003621'	634340	000007		TDZA	T2,T2		;NO, CLEAR SYSTEM TAPE FLAG
  3145	003622'	201340	000100		MOVEI	T2,SYSDEV	;YES, SET SYSTEM TAPE FLAG
  3146	003623'	554200	003561*		HLRZ	F,DEVLST##	;SEARCH DEVICE DATA BLOCKS
  3147	003624'	661207	000000	DEVLP1:	TLO	F,(T2)		;SET SYSTEM TAPE BIT IF SEARCHING FOR SYS
  3148	003625'	316304	000000		CAMN	T1,DEVNAM(F)	;MATCH OF PHYSICAL NAME?
  3149	003626'	326300	003642'		 JUMPN	T1,DEVLP2	;YES, GIVE OK RET. IF NAME IS NOT 0, AND NOT A DISK
  3150	003627'	554204	000003		HLRZ	F,DEVSER(F)
  3151	003630'	326200	003624'		JUMPN	F,DEVLP1
  3152	003631'	332000	000010		SKIPE	T3		;USER REQUESTED SYS?
  3153	003632'	256000	000000'		 STOPCD			;YES. AND IT DOES NOT EXIST!!!
  3154	003633'	262040	000010		POP	P,T3		;RESTORE ORIGINAL T3
  3155	003634'	312300	004444'		CAME	T1,[SIXBIT /TTY/];IS THIS PUBLIC LOGICAL NAME TTY?
  3156	003635'	254000	000000*		 JRST	GETDDB##	;SEE IF IT'S A PARTICULAR TTY
  3157	003636'	261040	000005		PUSH	P,U		;SAVE OUTPUT BYTE POINTER(TTY) OR INIT. ARG. ADR.
  3158	003637'	260040	000615*		PUSHJ	P,TTYFND##      ;YES, FIND TTY JOB IS ATTACHED TO
  3159	003640'	262040	000005		POP	P,U	        ;RESTORE
  3160	003641'	254000	003612*		JRST	CPOPJ1		;AND GIVE SUCCESSFUL RETURN
  3161	003642'	200344	000004	DEVLP2:	MOVE	T2,DEVMOD(F)	;DEVICE CHAR.
  3162	003643'	262040	000010	DEVLP3:	POP	P,T3		;RESTORE ORIGINAL T3
  3163	003644'	350001	000000		AOS	(P)		;OK
  3164	003645'	263040	000000		POPJ	P,		;RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 55
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3165				;ROUTINE TO SETUP N-RING IO BUFFER IN USER AREA
  3166
  3167				;EXPECTS: M/ COUNT OF BUFFERS DESIRED = N. (IF 0, USE STDRNG)
  3168				;FUNCTION: SET UP AN N-BUFFER RING AT JOBFF IN USER SPACE,
  3169				;AND ADVANCE JOBFF. DO CORUUO'S IF NEEDED. IF NO CORE
  3170				;AVAILABLE, THIS ROUTINE WILL GENERATE "UUO SPECIFIES
  3171				;ILLEGAL ADDRESS" CONDITION.
  3172				; THE BUFFER RING FORMAT IS AS FOLLOWS:
  3173				;	LOCATION		LH   CONTENTS   RH
  3174				; C(JOBFF) + 1              BUFFER         C(JOBFF) +1
  3175				;    + 0(BUFFER SIZE+2)      SIZE               + 1(BUFFER SIZE+2)
  3176				; C(JOBFF) +1               BUFFER         C(JOBFF) +1
  3177				;     +1(BUFFER SIZE+2)      SIZE                + 2(BUFFER SIZE+2)
  3178				;         .		.		     .
  3179				;	.		.		     .
  3180				;	.		.		     .
  3181				; C(JOBFF) + 1	        BUFFER	   C(JOBFF) + 1
  3182				;    + (N-2)(BUFFER SIZE+2)  SIZE               +(N-1)(BUFFER SIZE+2)
  3183				; C(JOBFF) + 1	        BUFFER	   C(JOBFF) + 1
  3184				;    + (N-1)(BUFFER SIZE+2)  SIZE		
  3185				;THEN SET 	W:=IOUSE,C(JOBFF) + 1
  3186				; AND		JOBFF:=C(JOBFF) + N(BUFFER SIZE + 2)
  3187				; P4 IS RESTORED.
  3188
  3189	003646'	261040	000017	BUFCLC:	PUSH P,P4		;SAVE P4 ON STACK
  3190	003647'	135300	004445'		LDB T1,[POINT 12,DEVCHR(F),35];T1:=BUFFER SIZE
  3191	003650'	256200	004446'	 XCTBU <HRRZ W,JOBFF>	;W:=FIRST FREE LOCATION + 1
  3192	003651'	271500	000001		ADDI W,1
  3193	003652'	550740	000012		HRRZ P4,W
  3194	003653'	504740	000006		HRL P4,T1		;P4:=BUFFER SIZE,FIRST FREE LOC + 1
  3195	003654'	271300	000002		ADDI T1,2		;T1:=BUFFER SIZE + 2
  3196	003655'	550340	000013		HRRZ T2,M		;T2:=N=ADDRESS FIELD OF AC M
  3197	003656'	336000	000007		SKIPN T2		;MAKE A DEFAULT CASE
  3198	003657'	201340	000004		 MOVEI T2,STDRNG	;NONE,N:=SYSTEM STD RING
  3199	003660'	550600	000006		HRRZ P1,T1		;BUFFER SIZE+2
  3200	003661'	220600	000007		IMUL P1,T2		;TIME NO. OF BUFFERS
  3201	003662'	270600	000017		ADD P1,P4		;LOC. OF FIRST BUFFER
  3202	003663'	550600	000014		HRRZ P1,P1		;MAKE SURE POSITIVE
  3203	003664'	275600	000002		SUBI P1,2		;READJUST FOR UPTREL COMPARISON
  3204	003665'	260040	003361*		UXCTBU <CAMG P1,JOBREL>	;WILL THIS SPACE FIT IN USER CORE?
  3205	003666'	256200	004447'
  3206	003667'	254000	003672'		 JRST BUFC1		;YES, FO DO INBUF CODE
  3207								; NO, AUTOMATICALLY EXPAND SIZE OF USER CORE
  3208	003670'	047600	000011		CORE P1,		;TRY TO ASSIGN CORE
  3209	003671'	255000	000000		  JFCL			;ERROR RETURN-LET ADR CHECK HAPPEN AND STOP JOB
  3210	003672'	270740	000006	BUFC1:	ADD P4,T1		;P4:=C(P4) + C(T1)
  3211	003673'	256200	004450'		UMOVEM P4,(W)	;BUFFER HEADER+1:=C(P4)
  3212	003674'	540500	000017		HRR W,P4	;W 18-35:=C(P4 18-35)
  3213	003675'	367340	003672'		SOJG T2,BUFC1		;N:=N-1.  IS N GR 0?
  3214	003676'	256200	004451'	 XCTBU <HRR P4,JOBFF>
  3215	003677'	271740	000001		ADDI P4,1
  3216	003700'	274500	000006		SUB W,T1
  3217	003701'	256200	004450'		UMOVEM P4,(W)	;LINK LAST BUFFER TO FIRST BUFFER
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 55-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3218	003702'	271506	777777		ADDI W,-1(T1)
  3219	003703'	256200	004452'	 XCTBU <HRRM W,JOBFF>	;JOBFF:=C(JOBFF)+1+N(BUFFER SIZE+2)
  3220	003704'	540500	000017		HRR W,P4	;W:=IOUSE,ADDRESS OF FIRST BUFFER
  3221								; IN RING.
  3222	003705'	505500	400000		HRLI W,IOUSE
  3223	003706'	262040	000017		POP P,P4		;RESTORE P4 FROM STACK.
  3224	003707'	263040	000000		POPJ P,		;RETURN
  3225
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 56
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3226				;ROUTINE TO CLEAR IO BUFFER IN USER AREA
  3227				;CALLED AT INTERRUPT AND MUUO LEVEL
  3228
  3229				;CALL:	HRRZ T1,REL. ADR. OF 2ND WORD OF USER BUFFER
  3230				;	PUSHJ P,BUFCLR
  3231				;	ERROR RETURN MEMORY EXCEEDED
  3232				;	EXIT		RETURNS HERE IF MEMORY NOT EXCEEDED
  3233				; CLEARS THE WORD COUNT AND DATA AREA OF THE BUFFER WHOSE ADDRESS
  3234				; IS IN T1 18-35.
  3235
  3236	003710'	261040	000006	BUFCLR::PUSH P,T1		;SAVE FIRST BUFFER ADR.
  3237	003711'	256200	004347'	 XCTBU <HLRZ T2,(T1)>		;T2 18-35=SIZE
  3238	003712'	620340	400000		TRZ T2,400000
  3239	003713'	270300	000007		ADD T1,T2		;LAST ADR=2ND ADR+SIZE
  3240	003714'	621300	777777		TLZ T1,-1		;CLEAR LEFT HALF
  3241	003715'	262040	000007		POP P,T2		;RESTORE FIRST ADR.
  3242	003716'	504340	000007		HRL T2,T2
  3243	003717'	253340	003720'		AOBJN T2,.+1		;THIRD WORD IN BUFFER
  3244	003720'	256200	004237'	 XCTBU <SETZM (T2)>		;CLEAR THIRD WORD
  3245	003721'	350000	000007		AOS T2		;SET DEST. ADR. TO 4TH WORD
  3246	003722'	256240	004453'	 XCTBU <BLT T2,(T1)>		;CLEAR BUFFER
  3247	003723'	254000	003641*		JRST CPOPJ1		;SUCESSFUL RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 57
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3248				;ROUTINE TO COMPUTE 12 BIT FOLDED CHECKSUM
  3249
  3250				;CALL:	PUSHJ P,CKS12
  3251				;	EXIT		ALWAYS RETURNS HERE
  3252				;CALCULATES FOLDED 12 BIT CHECKSUMS OF THE DATA WORDS IN THE
  3253				;BUFFER WHOSE ADDRESS IS IN AC T2.
  3254				;ON RETURN, THE LEFT HALF OF AC T1 CONTAINS A CHECKSUM OBTAINED
  3255				;BY ACCUMULATING, IN TWO'S COMPLEMENT, THE DATA WORDS AND FOLDING IT.
  3256				;AC T2 CONTAINS A 1.
  3257
  3258	003724'	350000	000007	CKS12::	AOS T2		;T2:=-WORD COUNT,ADDRESS OF FIRST DATA WORD
  3259	003725'	256200	004454'	 XCTBU <HRRZ T1,0(T2)>
  3260	003726'	213000	000006		MOVNS T1
  3261	003727'	350000	000007		AOS T2
  3262	003730'	504340	000006		HRL T2,T1
  3263	003731'	402000	000006		SETZM T1		;INITIALIZE TWO'S COMPLEMENT SUM
  3264	003732'			CKS12A:
  3265	003732'	256200	004455'	 XCTBU <ADD T1,0(T2)>		;TWO'S COMPLEMENT ADD
  3266	003733'	253340	003732'		AOBJN T2,CKS12A		;DONE?
  3267	003734'	246300	777750		LSHC T1,-30
  3268	003735'	242340	777764		LSH T2,-14
  3269	003736'	270300	000007		ADD T1,T2
  3270	003737'	246300	777764		LSHC T1,-14
  3271	003740'	242340	777750		LSH T2,-30
  3272	003741'	270300	000007		ADD T1,T2
  3273	003742'	622300	770000		TRZE T1,770000
  3274	003743'	350000	000006		 AOS T1
  3275	003744'	517000	000006		HRLZS T1
  3276	003745'	201340	000001		MOVEI T2,1		;T2:=1
  3277	003746'	263040	000000		POPJ P,			;End of CKS12
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 58
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3278				;ROUTINE TO CLEAR RESIDUE OF WORD POINTED TO BY A BYTE POINTER
  3279
  3280				;CALL:	PUSHJ P,CLRBYT
  3281				;	EXIT		ALWAYS RETURNS HERE
  3282				;CALLED WITH A BYTE POINTER IN AC T1, IT CLEARS THE REST OF THE
  3283				;WORD POINTED TO BY THE BYTE POINTER.
  3284
  3285
  3286	003747'	135340	004244'	CLRBYT:	LDB T2,[POINT 6,T1,5]	;T2:=P
  3287	003750'	137340	004456'		DPB T2,[POINT 12,T1,11]	;T1 0-5:=0,T1 6-12:=P
  3288	003751'	402000	000007		SETZM T2
  3289	003752'	137340	000006		DPB T2,T1		;CLEAR BITS 36-P THROUGH 35
  3290	003753'	263040	000000		POPJ P,		;RETURN
  3291
  3292				;ROUTINE TO PUT EVEN PARITY IN ( OR TAKE IT OUT OF ) BIT 28 OF
  3293				;AC TEM. ASSUMING CHARACTER IS IN BITS 28-35 OF T3, REST CLEAR.
  3294				;T1 IS DESTROYED. CALLED FROM PTP AND TTY SERVICE ROUTINES
  3295
  3296				;CALL:	PUSHJ	P,PEVEN8
  3297				;	EXIT HERE WITH T3 SET TO EVEN PARITY
  3298
  3299	003754'	261040	000007	PEVEN8::PUSH	P,T1+1			;SAVE AC FOR DIVIDE
  3300	003755'	135300	004457'		LDB	T1,[POINT 7,T3,35]	;GET ARGUMENT TO T1
  3301	003756'	220300	004460'		IMUL	T1,[2010040201]		;COMPUTE PARITY
  3302	003757'	404300	004461'		AND	T1,[21042104377]	; ..
  3303	003760'	231300	003600		IDIVI	T1,3600			;ANSWER IN T1+1 LOW 8 BITS
  3304	003761'	135400	004462'		LDB	T3,[POINT 8,T1+1,35]	;BACK INTO T3
  3305	003762'	262040	000007		POP	P,T1+1			;RESTORE AC
  3306	003763'	263040	000000		POPJ	P,			;RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 59
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3307				;ROUTINE TO RELEASE ALL DEVICES ASSIGNED TO JOB
  3308
  3309	003764'	201300	003334'	IORELS::MOVEI	T1,RELEAS	;RELEASE ALL IO DEVICES(DON'T CLOSE)
  3310					PFALL	IOALL
  3311
  3312				;ROUTINE TO DO IO FOR ALL DEVICES ASSIGNED TO JOB
  3313				;CALL	MOVEI T1,ADR. OF IO SUB.
  3314				;	PUSHJ P,IOALL
  3315				;	RETURNS WITH J=CURRENT JOB # ,M PRESERVED
  3316
  3317	003765'	261040	000006	IOALL:	PUSH	P,T1		;SAVE ADR. OF SUB.
  3318	003766'	261040	000012		PUSH	P,W
  3319	003767'	261040	000013		PUSH	P,M		;SAVE M
  3320				;*;	HRRZ	W,%UPT+UPTHCU
  3321				;*;	CAILE	W,MAXCHN
  3322				;*;	 STOPCD			;JOB DATA AREA BAD
  3323	003770'	201500	003600*		MOVEI	W,MAXCHN	;Don't trust UPTHCU (SIMUUF&KILUP2 stopcodes)
  3324	003771'	201540	000000		MOVEI	M,0
  3325	003772'	336212	000000*	IOALL0:	SKIPN	F,%UPT+UPTJDA(W);GET NEXT DDB ADR., IS IT IN USE?
  3326	003773'	254000	004004'		 JRST	IOALL1		;NO, KEEP GOING
  3327	003774'	200004	000002		MOVE	S,DEVIOS(F)
  3328	003775'	137500	000755*		DPB	W,PUUOAC
  3329	003776'	200444	000003		MOVE	T4,DEVSER(F)	;SETUP ADR. OF DEV. DISP. TABLE
  3330	003777'	261040	000012		PUSH	P,W
  3331	004000'	135300	003566*		LDB	T1,PJOBN	;GET JOB NUMBER WHICH JOB IS ASSIGNED TO
  3332	004001'	316300	003304*		CAMN	T1,JOB		;IS IT SAME AS CURRENT JOB(SHOULD BE EXCEPT FOR 140
  3333								; RESTART WHILE THIS JOB WAS SWAPPED OUT)
  3334								; DEVICE DATA BLOCKS JOB NUMBERS ARE SET TO 0 ON
  3335								; 140 RESTART,BUT THE JOB DATA AREA DEVICE ASSIGNMENTS
  3336								; FOR SWAPPED OUT JOBS HAVE NOT
  3337	004002'	260061	777775		 PUSHJ	P,@-3(P)	;YES,CALL THE SUB.
  3338	004003'	262040	000012		POP	P,W
  3339	004004'	365500	003772'	IOALL1:	SOJGE	W,IOALL0	;INCREMENT USER CHAN. NO.
  3340	004005'	262040	000013		POP	P,M		;RESTORE M & RETURN RESTORING T1 TOO
  3341	004006'	262040	000012		POP	P,W
  3342	004007'	200100	004001*		MOVE	J,JOB		;GET JOB NO.
  3343	004010'	254000	000516*		JRST	TPOPJ
  3344
  3345				;WAIT TILL ALL DEVICES ARE INACTIVE
  3346
  3347	004011'	201300	003342*	IOWAIT::MOVEI	T1,WAIT1
  3348	004012'	254000	003765'		JRST	IOALL
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 60
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3349				;KILL ALL DEVICES(RELEASE WITHOUT WAITING FOR DEVICE INACTIVE)
  3350
  3351
  3352	004013'	201300	003344'	IOKILL::MOVEI	T1,RELEA5
  3353	004014'	260040	003765'		PUSHJ	P,IOALL		;RELEASE ALL DEVICES WITHOUT WAITING
  3354					PFALL	SETUSR
  3355
  3356				COMMENT ! ROUTINE SETUSR -- TO RECLAIM BUFFER AREA ABOVE USER
  3357					PROG BY RESETTING  JOBFF TO LH(JOBSA), WHERE IT BEGAN.
  3358					CLEAR JDA ARRAY IN UPT..NO CHANNELS IN USE
  3359				!
  3360
  3361
  3362	004015'	260040	003665*	SETUSR:	UXCTBU <HLRZ T1,JOBSA>	;WE'RE GOING TO RESET JOBFF W/THIS
  3363	004016'	256200	004463'
  3364								;NOW WRITE ON USER'S JOBFF:
  3365	004017'	260040	004015*		UXCTBU <MOVEM T1,JOBFF>
  3366	004020'	256200	004464'
  3367	004021'	402000	000000*		SETZM %UPT+UPTENB##	;INITIALIZE APR TRAPPING (I.E., NONE)
  3368	004022'	201300	000000*		MOVEI T1,%UPT+UPTJDA+1	;FIRST LOC+1 TO CLEAR
  3369	004023'	505300	000000*		HRLI T1,%UPT+UPTJDA	;FIRST LOC.
  3370	004024'	402000	000000*		SETZM %UPT+UPTJDA
  3371	004025'	251300	000000*		BLT T1,%UPT+UPTJDA+MAXCHN
  3372	004026'	402000	000000*		SETZM %UPT+UPTHCU	;CLEAR HIGHEST USER IO CHAN. IN USE
  3373	004027'	263040	000000		POPJ P,
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 61
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3374				;ROUTINE TO FLAG DEVICE ACTIVE
  3375				;CALL	MOVE S,IO STATUS BITS
  3376				;	MOVE F,ADDRESS OF DEVICE DATA BLOCK
  3377				;	PUSHJ P,SETACT
  3378				;CALLED BY ALL IO SERVICE ROUTINES AT MUUO AND INTERRUPT LEVELS
  3379
  3380				EXTERNAL PDVTIM,PDVCNT
  3381
  3382	004030'	660000	010000	ORACT:	TRO	S,IOACT
  3383	004031'	437004	000002		IORB	S,DEVIOS(F)
  3384	004032'	254000	004037'		JRST	SETHNG
  3385
  3386	004033'	660000	010000	SETACT::TRO	S,IOACT
  3387	004034'	625000	000001		TLZA	S,IOW
  3388	004035'	620000	010000	CLRACT:: TRZ	S,IOACT
  3389	004036'	202004	000002	STOIOS::MOVEM	S,DEVIOS(F)
  3390	004037'	135300	000000*	SETHNG::LDB	T1,PDVTIM	;GET CODE FOR NO. OF SECONDS
  3391	004040'	261040	000006		PUSH	P,T1		;STACK THE CODE
  3392	004041'	201300	000001		MOVEI	T1,1		;COMPUTE 2**N-1
  3393	004042'	242321	000000		LSH	T1,@0(P)	; ..
  3394	004043'	275300	000001		SUBI	T1,1
  3395	004044'	137300	000000*		DPB	T1,PDVCNT	;PUT TIME INTO THE COUNTER
  3396	004045'	254000	004010*		JRST	TPOPJ		;RESTORE T1 AND RETURN
  3397
  3398	004046'	554200	003623*	DEVCHK::HLRZ	F,DEVLST
  3399	004047'	200004	000002	DEVCK0:	MOVE	S,DEVIOS(F)	;IS DEVICE ACTIVE?
  3400	004050'	606000	010000		TRNN	S,IOACT
  3401	004051'	254000	004063'		 JRST	DEVCK1		;NO
  3402				IFCPU (F3),<;HACK FOR F3 TAPES UNTIL CONTROL IS FIXED
  3403					MOVE	T1,DEVMOD(F)	;SEE IF ITS A TAPE ON F3
  3404					TLNE	T1,DVMTA	;IS IT?
  3405					 PUSHJ	P,F3TRWC##	;CHECK FOR REWINDING TAPE.
  3406				>;END IFCPU (F3)
  3407	004052'	135300	004044*		LDB	T1,PDVCNT	;YES,DECREMENT
  3408	004053'	361300	004063'		SOJL	T1,DEVCK1	;0 MEANS IGNORE DEVICE
  3409	004054'	137300	004052*		DPB	T1,PDVCNT
  3410	004055'	326300	004063'		JUMPN	T1,DEVCK1	;HAS COUNT GONE TO 0?
  3411	004056'	550444	000003		HRRZ	T4,DEVSER(F)	;YES, GET DISPATCH TABLE ENTRY
  3412	004057'	261040	000004		PUSH	P,F
  3413	004060'	260051	000005		PUSHJ	P,DHNG(T4)	;DISPATCH TO SERVICE ROUTINES TO
  3414								; UNHANG DEVICE
  3415	004061'	260040	000000*		PUSHJ	P,DEVHNG	;PRINT ERROR MESSAGE AND STOP JOB
  3416	004062'	262040	000004		POP	P,F		;DO NOT PRINT MESS. AND STOP JOB RETURN
  3417	004063'	554204	000003	DEVCK1:	HLRZ	F,DEVSER(F)
  3418	004064'	326200	004047'		JUMPN	F,DEVCK0
  3419	004065'	263040	000000		POPJ	P,
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 62
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3420				;ROUTINE TO SETUP S AND J FOR INTERRUPT SERVICE ROUTINE
  3421
  3422				;CALL	PUSHJ P,IOSET
  3423				;	EXIT	ALWAYS RETURNS HERE
  3424				;THIS PROGRAM IS CALLED FROM AN INTERRUPT SERVICE ROUTINE.
  3425				;IT PUTS THE J POINTER (C(DEVCTR)) OF THE DEVICE SPECIFIED
  3426				;BY AC F INTO AC ITEM.
  3427
  3428	004066'	200104	000015	IOSET::	MOVE	J,DEVCTR(F)	;J:=J POINTER=C(DEVCTR)
  3429	004067'	200004	000002		MOVE	S,DEVIOS(F)	;GET IO STATUS FROM THE DDB
  3430	004070'	263040	000000		POPJ	P,		;RETURN
  3431
  3432				;CALLING SEQUENCE
  3433				;	PUSHJ P,IOSETC
  3434				;	EXIT		ALWAYS RETURNS HERE
  3435
  3436				;SETS JBFPTR18-35:=C(T2 18-35)
  3437				;	JBFCTR:=C(J)*[WORD LENGTH/BYTE SIZE]
  3438				;WHERE	WORD LENGTH:=36 DECIMAL
  3439				;	BYTE SIZE:=C(JBFPTR6-11)
  3440				;	[X]:= INTEGER PART OF X
  3441
  3442
  3443	004071'	271240	000001	IOSETC:	ADDI	U,1		;JBFPTR12-18:=0
  3444	004072'	515300	007777		HRLZI	T1,7777		;JBFPTR18-35:=C(T2 18-35)+1
  3445	004073'	256200	004465'	 XCTBU <ANDM	T1,(U)>
  3446	004074'	256200	004466'	 XCTBU <HRRM	T2,(U)>
  3447	004075'	256200	004467'	 XCTBU <AOS	(U)>
  3448	004076'	256040	004471'	 XCTBU <LDB	T2,[POINT 6,(U),11]>	;T2:=BYTE SIZE
  3449	004077'	260040	004106'		PUSHJ	P,ITMCT1	;JBFCTR:=C(J)*[36/BYTE SIZE]
  3450	004100'	271240	000001		ADDI	U,1
  3451	004101'	256200	004472'	 XCTBU <MOVEM	J,(U)>
  3452	004102'	263040	000000		POPJ	P,		;EXIT
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 63
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3453				;ROUTINE TO RETURN NO. OF ITEMS IN BUFFER
  3454
  3455				;CALL:	PUSHJ P,ITMSET
  3456				;	EXIT		ALWAYS RETURNS HERE
  3457				;SETS AC J:=(BUFFER SIZE-1)*[WORD LENGTH/BYTE SIZE]
  3458				;WHERE BUFFER SIZE:=BITS 1-17 OF THE BUFFER HEADER WORD POINTED TO
  3459				;		BY C(DEVADR)
  3460				;	WORD LENGTH:=36 DECIMAL
  3461				;	BYTE SIZE:=INTEGER PART OF X.
  3462
  3463				;CALLING SEQUENCE
  3464				;	PUSHJ P,ITMCNT
  3465				;	EXIT		ALWAYS RETURNS HERE
  3466				;SETS AC J:=C(J)*[WORD LENGHT/BYTE SIZE]
  3467
  3468				;CALLING SEQUENCE
  3469				;	PUSHJ P,ITMCT1
  3470				;	EXIT		ALWAYS RETURNS HERE
  3471				;SETS AC J:=C(J)*[WORD LENGHT/C(T2)]
  3472
  3473	004103'			ITMSET:
  3474	004103'	256040	004474'	 XCTBU <LDB J,[POINT 17,@DEVADR(F),17]>;J:=BUFFER SIZE-1
  3475	004104'	275100	000001		SUBI J,1
  3476	004105'	135340	004475'	ITMCNT:	LDB T2,[POINT 6,DEVPTR(F),11];T2:=BYTE SIZE
  3477	004106'	321100	004113'	ITMCT1::JUMPL J,ITMCT2	;BIT COUNT
  3478	004107'	201300	000044		MOVEI T1,44		;J:=C(J)*[WORD LENGTH/C(T2)]
  3479	004110'	230300	000007		IDIV T1,T2
  3480	004111'	220100	000006		IMUL J,T1
  3481	004112'	263040	000000		POPJ P,
  3482
  3483	004113'	621100	400000	ITMCT2:	TLZ J,(1B0)
  3484	004114'	261040	000003		PUSH P,J+1
  3485	004115'	231100	000044		IDIVI J,^D36	;GET WHOLE WORDS
  3486	004116'	200300	000003		MOVE T1,J+1	;NUMBER OF EXTRA BITS
  3487	004117'	262040	000003		POP P,J+1
  3488	004120'	271307	777777		ADDI T1,-1(T2)	;ROUND
  3489	004121'	261040	000007		PUSH P,T2
  3490	004122'	230300	000007		IDIV T1,T2
  3491	004123'	262040	000007		POP P,T2
  3492	004124'	261040	000006		PUSH P,T1
  3493	004125'	201300	000044		MOVEI T1,^D36
  3494	004126'	230300	000007		IDIV T1,T2	;NUMBER OF BYTES/WORD
  3495	004127'	220100	000006		IMUL J,T1
  3496	004130'	272101	000000		ADDM J,(P)
  3497	004131'	262040	000002		POP P,J
  3498	004132'	263040	000000		POPJ P,		;DONE
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 64
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3499				;ROUTINE TO SET UP CONDITIONS FOR RETURN FROM INTERRUPT LEVEL ON
  3500				;DEVICE ERROR (UNIT RECORD)
  3501				;SERVICE ROUTINES USING THIS FACILITY MUST FOLLOW THE FOLLOWING PROTOCOL
  3502
  3503				;A.  AT INTERRUPT LEVEL,
  3504				;       IF NO ERROR AT END OF DATA: CLEAR IOSTBL IN LH(S)
  3505				;       IF ERROR:
  3506				;	1. STOP DEVICE
  3507				;	2. PUSHJ P,DEVERR
  3508				;	3. SET INTERNAL FLAGS TO REMEMBER ERROR CONDITION TO EFFECT
  3509				;	   RESTART AT A LATER TIME
  3510				;	4. DISMISS INTERRUPT
  3511
  3512				;B. AT UUO LEVEL ENTRANCES THE FOLLOWING MUST BE DONE
  3513
  3514				;	1. INIT/RELEASE - RESET INTERNAL ERROR FLAGS
  3515				;	2. INPUT/OUTPUT - IF ERROR FLAGS (INTERNAL) SET:
  3516				;	   A. CALL HNGSTP
  3517				;	   B. SEE IF DEVICE OK NOW (CALL HNGSTP AGAIN IF NOT)
  3518				;	   C. SET DEVICE FOR RESTART FROM INFO SAVED IN INTERNAL FLAGS
  3519				;	      AND RESET FLAGS
  3520				;	   NOTE: IOSTBL WILL ALWAYS BE CLEARED AT UUO ENTRANCE TO SERVICE ROUTINE
  3521
  3522				;	   IF NO ERROR FLAGS SET, NORMAL EXECUTION
  3523
  3524	004133'	661000	000010	DEVERR::TLO	S,IOSTBL	;SET ERROR FLAG
  3525	004134'	623000	000001		TLZE	S,IOW		;IN I/O WAIT?
  3526	004135'	260040	000000*		 PUSHJ	P,SETIOD##	;YES - WAKE UP
  3527	004136'	324740	004035'		PJRST	CLRACT		;CLEAR I/O ACTIVE AND RETURN
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 65
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3528				;ROUTINE TO SET DEVICE STATUS WORD FROM M AND SETUP S
  3529
  3530	004137'	201300	000000	SETIOS:	MOVEI T1,0
  3531	004140'	260040	000077'		PUSHJ P,CHNCHK		;CHECK FOR CHANNEL ASSIGNED.
  3532	004141'	254000	003460*		 JRST ERRIUC		;ERROR, NO CHANNEL.
  3533	004142'	255000	000000		JFCL			;SHORT DISPATCH TABLE OK.
  3534	004143'	260040	004011*	SETIO2::PUSHJ	P,WAIT1	;WAIT FOR DEVICE (INCLUDING TTY MONITOR COMMAND
  3535								; RESPONSE WHEN USER INITS TTY)
  3536
  3537	004144'	260040	004150'		PUSHJ	P,CHKMOD	;CHECK FOR LEGAL MODE, IF NOT RIGHT DONT RETURN
  3538	004145'	620540	010000		TRZ M,IOACT		;LET USER SET ALL BITS EXCEPT IOACT
  3539	004146'	542544	000002		HRRM M,DEVIOS(F)
  3540	004147'	263040	000000		POPJ P,
  3541
  3542				;CHECK FOR A LEGAL MODE FOR DEVICE
  3543
  3544
  3545	004150'	135340	004476'	CHKMOD:	LDB T2,[POINT 4,M,35]	;GET DEVICE DATA MODE
  3546	004151'	201300	000001		MOVEI T1,1		;AND CHECK FOR LEGALITY
  3547	004152'	242307	000000		LSH T1,(T2)
  3548	004153'	612304	000004		TDNE T1,DEVMOD(F)
  3549	004154'	263040	000000		 POPJ	P,		;OK
  3550	004155'	254000	000000*		JRST ERRIDM		;AND GIVE ILLEGAL MODE ERROR
  3551
  3552				;SETUP BYTE POINTER AND J COUNT
  3553				;CALL	PUSHJ P,NEWBUF
  3554				;	ADDRESS CHECK WHEN SETTING UP BUFFER
  3555				;	OK RETURN
  3556
  3557	004156'			NEWBF1::
  3558	004156'	550304	000007	NEWBUF:	HRRZ T1,DEVADR(F)	;T1:=INPUT BUFFER HEADER ADDRESS
  3559	004157'	260040	003710'		PUSHJ P,BUFCLR	;CLEAR INPUT BUFFER.
  3560	004160'	263040	000000		POPJ P,		;ADDRESS CHECK
  3561	004161'	515300	007737		HRLZI T1,7737
  3562	004162'	404304	000010		AND T1,DEVPTR(F)	;DEVPTR 0-5:=0, DEVPTR 12:=0
  3563	004163'	540304	000007		HRR T1,DEVADR(F)	;DEVPTR 18-35:=C(DEVADR 18-35) + 1
  3564	004164'	350000	000006		AOS T1
  3565	004165'	202304	000010		MOVEM T1,DEVPTR(F)
  3566	004166'	260040	004103'		PUSHJ P,ITMSET	;J:=(BUFFER SIZE-1)*[36/BYTE SIZE]
  3567	004167'	202104	000015		MOVEM J,DEVCTR(F)	;DEVCTR:=J COUNT
  3568	004170'	254000	003723*		JRST CPOPJ1		;RETURN
  3569
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3570				;ROUTINE TO SETUP BYTE POINTER ACCORDING TO DATA MODE
  3571
  3572				;CALL:	PUSHJ P,SETBYT
  3573				;	EXIT		ALWAYS RETURNS HERE
  3574				;SETS	T1 0-5:=0
  3575				;	T1 6-11:=S
  3576				;	T1 12-13:=0
  3577				;WHERE S=36 IF DATA MODE (S 32-25) IS BINARY (B)
  3578				;	OR DUMP (SD,D,DR)
  3579				;S SET FROM DISPATCH TABLE IF IMAGE (I) OR IMAGE BINARY (IB)
  3580				;      S=7  IF DATA MODE IS 	ASCII PACKED (A)
  3581				;			ASCII U (AL)
  3582				;	S=9 IF DATA MODE IS EXTENDED ASCII (XA)
  3583
  3584	004171'	606000	000010	SETBYT::TRNN	S,10		;CHECK FOR A OR AL
  3585					 JRST	[HRLI T1,700	;YES, BYTE SIZE 7
  3586						 TRNE S,2
  3587						  HRLI T1,1100
  3588	004172'	254000	004477'			 POPJ P,]
  3589	004173'	602000	000004		TRNE	S,4	;NO GET B, SD, D, DR
  3590					 JRST	[HRLI T1,4400	;BYTE SIZE 36
  3591	004174'	254000	004503'			 POPJ P,]
  3592	004175'	261040	000006		PUSH	P,T1
  3593	004176'	550304	000003		HRRZ	T1,DEVSER(F)
  3594	004177'	200306	000002		MOVE	T1,DBYT(T1)	;GET BYTE SIZES
  3595	004200'	602000	000003		TRNE	S,3		;CHECK FOR IB
  3596	004201'	207000	000006		 MOVSS	T1		;IT IS, USE RIGHT HALF
  3597	004202'	621300	000037		TLZ	T1,37		;CLEAR INDEX FIELD OF POINTER
  3598	004203'	502301	000000		HLLM	T1,(P)
  3599	004204'	254000	004045*		JRST	TPOPJ		;AND RETURN THE INFORMATION
  3600
  3601	004205'	200312	000000		$END	(IOC)

  3602	004206'	004000	000136'

  3603	004207'	000040	020000

  3604	004210'	337005	000000

  3605	004211'	331006	000000

  3606	004212'	337407	000000

  3607	004213'	550447	000001

  3608	004214'	550450	000001

  3609	004215'	436305	000000

  3610	004216'	412305	000000

  3611	004217'	402005	000002

IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-2
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3612	004220'	550247	000000

  3613	004221'	540245	000000

  3614	004222'	202506	000000

  3615	004223'	332012	000000*

  3616	004224'	263040	000000

  3617	004225'	254000	004170*

  3618	004226'	542507	000000

  3619	004227'	200313	000000

  3620	004230'	205300	000000*

  3621	004231'	412304	000012

  3622	004232'	205000	000000

  3623	004233'	254000	000445'

  3624	004234'	402006	000000*

  3625	004235'	202212	004234*

  3626	004236'	202300	000000*

  3627	004237'	402007	000000

  3628	004240'	502307	000000

  3629	004241'	000000	000032

  3630	004242'	000040	766000

  3631	004243'	220400	000006

  3632	004244'	360600	000006

  3633	004245'	202313	000000

  3634	004246'	207000	000006

  3635	004247'	541300	001115*

  3636	004250'	137700	004244'

  3637	004251'	135540	003775*

  3638	004252'	256200	004245'
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-3
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT


  3639	004253'	263040	000000

  3640	004254'	200353	000001

  3641	004255'	202307	000000

  3642	004256'	000000	000000*

  3643	004257'	000000	001123*

  3644	004260'	517313	000000

  3645	004261'	202312	000000

  3646	004262'	200346	000000

  3647	004263'	200546	000001

  3648	004264'	200506	000000

  3649	004265'	260040	001036*

  3650	004266'	256000	000000'

  3651	004267'	254000	001041'

  3652	004270'	201700	000000*

  3653	004271'	262040	000006

  3654	004272'	254000	001113'

  3655	004273'	262040	000017

  3656	004274'	262040	000006

  3657	004275'	254000	001112'

  3658	004276'	340200	000012

  3659	004277'	202305	000000

  3660	004300'	207000	000006

  3661	004301'	541300	004247*

  3662	004302'	137700	004244'

  3663	004303'	256200	004245'

  3664	004304'	263040	000000

IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-4
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3665	004305'	200306	000000

  3666	004306'	200346	000001

  3667	004307'	200413	000000

  3668	004310'	202353	000001

  3669	004311'	202453	000001

  3670	004312'	202413	000001

  3671	004313'	202313	000001

  3672	004314'	334553	000000

  3673	004315'	200553	000000

  3674	004316'	200407	000000

  3675	004317'	550247	000001

  3676	004320'	550250	000001

  3677	004321'	412307	000000

  3678	004322'	542545	000000

  3679	004323'	200345	000000

  3680	004324'	413307	000000

  3681	004325'	542305	000000

  3682	004326'	436605	000000

  3683	004327'	550305	000000

  3684	004330'	540306	000000

  3685	004331'	335006	000000

  3686	004332'	540345	000000

  3687	004333'	335007	000000

  3688	004334'	331007	000000

  3689	004335'	200107	000001

  3690	004336'	000040	740000

  3691	004337'	413305	000000
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-5
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT


  3692	004340'	550345	000000

  3693	004341'	260040	001762'

  3694	004342'	334000	000000

  3695	004343'	350001	000000

  3696	004344'	256200	004340'

  3697	004345'	263040	000000

  3698	004346'	552606	000001

  3699	004347'	554346	000000

  3700	004350'	436346	000000

  3701	004351'	202346	000001

  3702	004352'	335010	000000

  3703	004353'	554450	000000

  3704	004354'	251714	777777

  3705	004355'	202356	777777

  3706	004356'	554416	777776

  3707	004357'	202456	000000

  3708	004360'	510347	000001

  3709	004361'	337345	000000

  3710	004362'	550305	000001

  3711	004363'	542307	000001

  3712	004364'	437307	000000

  3713	004365'	513005	000001

  3714	004366'	413345	000000

  3715	004367'	222107	000000

  3716	004370'	135100	004367'

  3717	004371'	336004	000013

IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-6
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3718	004372'	336304	000014

  3719	004373'	201300	000200

  3720	004374'	254000	002531'

  3721	004375'	202307	000001

  3722	004376'	554307	000000

  3723	004377'	335310	000000

  3724	004400'	554310	000000

  3725	004401'	004000	002637'

  3726	004402'	332007	000001

  3727	004403'	344340	002640'

  3728	004404'	402002	003305*

  3729	004405'	262040	000007

  3730	004406'	701140	000000*

  3731	004407'	254120	000007

  3732	004410'	334010	000000

  3733	004411'	203010	000000

  3734	004412'	257150	000000

  3735	004413'	111500	000010

  3736	004414'	200200	000004

  3737	004415'	200340	000007

  3738	004416'	331310	000000

  3739	004417'	550310	000001

  3740	004420'	542750	000001

  3741	004421'	000404	000002

  3742	004422'	510413	000000

  3743	004423'	270313	000000

  3744	004424'	200353	777777
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-7
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT


  3745	004425'	261607	777777

  3746	004426'	777777	740000

  3747	004427'	331010	000000

  3748	004430'	402012	004235*

  3749	004431'	020000	600000

  3750	004432'	550444	000003

  3751	004433'	254011	000012

  3752	004434'	202007	777777

  3753	004435'	335346	000000

  3754	004436'	576062	000000

  3755	004437'	637163	000000

  3756	004440'	446353	000000

  3757	004441'	474400	000000

  3758	004442'	330300	004440'

  3759	004443'	254000	003622'

  3760	004444'	646471	000000

  3761	004445'	001404	000001

  3762	004446'	550500	000000*

  3763	004447'	317600	000000*

  3764	004450'	202752	000000

  3765	004451'	540740	004446*

  3766	004452'	542500	004451*

  3767	004453'	251346	000000

  3768	004454'	550307	000000

  3769	004455'	270307	000000

  3770	004456'	301400	000006

IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 66-8
IOCSS.MAC	 9-OCT-87 18:01		OUT,OUTPUT

  3771	004457'	000700	000010

  3772	004460'	002010	040201

  3773	004461'	021042	104377

  3774	004462'	001000	000007

  3775	004463'	554300	000000*

  3776	004464'	202300	004452*

  3777	004465'	406305	000000

  3778	004466'	542345	000000

  3779	004467'	350005	000000

  3780	004470'	300605	000000

  3781	004471'	135340	004470'

  3782	004472'	202105	000000

  3783	004473'	222124	000007

  3784	004474'	135100	004473'

  3785	004475'	300604	000010

  3786	004476'	000400	000013

  3787	004477'	505300	000700

  3788	004500'	602000	000002

  3789	004501'	505300	001100

  3790	004502'	263040	000000

  3791	004503'	505300	004400

  3792	004504'	263040	000000

  3793						;End of IOCSER (IOCLIT: IOCEND:)
  3794
NO ERRORS DETECTED
PROGRAM BREAK IS 004520
9K CORE USED
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 67
IOCSS.MAC	 9-OCT-87 18:01		SYMBOL TABLE

ABTUUO		002066'	EXT	CHNCK2		000104'		DEN		000016	SIN	DIE		000000'	EXT
ACTDDB		000442'	EXT	CHNIER		000050'		DEPMGN		001273'	EXT	DIN		000011	SIN
ACTDED		004230'	EXT	CHNNX0		000370'		DEV0		003571'		DIOMAX		002663'	EXT
ADRCLS		003301'		CHNNX1		000375'		DEVABC		000013	SIN	DLK		000017	SIN
ADRERR		003306'	EXT	CHNNXT		000365'		DEVADR		000007	SIN	DLKDEN		000576'	
ADVBF1		003514'		CHNOTB		000053'		DEVATB		001337'	EXT	DMOVPG		000037	SIN
ADVBFE		003471'	INT	CHOTBL		000024	SPD	DEVBTS		001274'	EXT	DMT		000014	SIN
ADVBFF		003502'	INT	CKS12		003724'	INT	DEVBUF		000006	SIN	DOU		000010	SIN
ARGCHK		000610'		CKS12A		003732'		DEVBWC		000014	SIN	DOXCT		004017'	EXT
ASSAS0		003524'		CLA		001732'		DEVCHK		004046'	INT	DR		000016	SIN
ASSAS1		003550'		CLAI		001716'		DEVCHR		000001	SIN	DRL		000006	SIN
ASSAS2		003552'		CLIBUF		001722'		DEVCK0		004047'		DRN		000020	SIN
ASSAS3		003547'		CLIDMP		001726'		DEVCK1		004063'		DSEK		000025	SIN
ASSASG		003517'	INT	CLNLS1		002631'		DEVCLS		000011	SIN	DSI		000021	SIN
ASSCON		400000	SIN	CLNLST		003262'		DEVCTR		000015	SIN	DSIM		000032	SIN
ASSPRG		200000	SIN	CLOBUF		001736'		DEVDBL		001263'	EXT	DSO		000022	SIN
ATBFNB		001323'	EXT	CLODMP		001742'		DEVEC1		001527'	EXT	DTID1		002626'	
ATBMWC		001322'	EXT	CLOSE0		000127'	INT	DEVECK		002263'	EXT	DTID11		002522'	
ATBSTS		001340'	EXT	CLOSE1		000133'	INT	DEVERR		004133'	INT	DTID12		002557'	
ATPUPD		001341'	EXT	CLRACT		004035'	INT	DEVFLO		000274'	EXT	DTID13		002560'	
ATYCNT		001311'	EXT	CLRBYT		003747'		DEVHNG		004061'	EXT	DTID14		002556'	
AUXTUU		000000	EXT	CLRDDB		003406'	EXT	DEVIAD		000007	SIN	DTID15		002531'	
B		000014	SIN	CLSIN		000002	SIN	DEVIOS		000002	SIN	DTID2		002601'	
BFICLN		000302'		CLSOUT		000001	SIN	DEVLG		003556'	INT	DTID31		003071'	
BFICLS		000327'		CNGIN		001502'		DEVLOG		000005	SIN	DTID32		003045'	
BLDLB1		003162'		COPEN		000400'		DEVLP0		003564'		DTID33		003027'	
BLDLB2		003204'		CORE	047000	000011		DEVLP1		003624'		DTID36		003024'	
BLDLB3		003207'		CPOPJ		003503'	EXT	DEVLP2		003642'		DTIDR1		002513'	
BLDLB4		003172'		CPOPJ1		004225'	EXT	DEVLP3		003643'		DTIDR2		002563'	
BLDLE0		003212'		CPRRED		000001	SIN	DEVLST		004046'	EXT	DTIDR3		003015'	
BLDLM1		003145'		CPUF3		000004	SPD	DEVMOD		000004	SIN	DTOD1		002775'	
BLDLM3		003147'		CPUKI		000001	SPD	DEVNAM		000000	SIN	DTOD11		003005'	
BLDLND		003217'		CPUKL		000002	SPD	DEVOAD		000010	SIN	DTOD12		003013'	
BLDLS1		003132'		CPUKS		000003	SPD	DEVOPR		003614'	EXT	DTOD14		003012'	
BLDLS2		003133'		CPUTYP		000002	SPD	DEVPHY		003611'	INT	DTOD2		002746'	
BLDLST		003123'		CPZZ		000000	SPD	DEVPOS		000273'	EXT	DTOD4		002762'	
BUFC1		003672'		CSHSAV		000000	EXT	DEVPTR		000010	SIN	DTOD5		002755'	
BUFCLC		003646'		CSRTAB		003105'	EXT	DEVPWC		000013	SIN	DTODR1		003000'	
BUFCLR		003710'	INT	CSUCNT		003016'	EXT	DEVSER		000003	SIN	DTODR2		002730'	
CALIN		001746'		CSUNL		003015'	EXT	DEVSRC		003553'	INT	DUFD		000024	SIN
CALIN1		001760'		CSVAL		002730'	EXT	DEVSTS		000012	SIN	DVCNSG		003577'	INT
CBLAM1		003321'		CSVCNT		002731'	EXT	DEVWUC		000014	SIN	DVDSK		200000	SIN
CBLAMB		003307'	INT	CTMBS		002115'	INT	DEYCLS		003427'	EXT	DVMAP		000026	SIN
CBLAU1		003333'		CTMBS1		002130'		DEYMCT		003234'	EXT	DVMTA		000020	SIN
CBLAUB		003323'	INT	CTMBS2		002132'		DEYTCT		003272'	EXT	DVRMT		004000	SIN
CBLEMB		002134'	INT	DBYT		000002	SIN	DFCRE		000030	SIN	DVSMAP		000034	SIN
CBLEUB		002143'		DCL		000007	SIN	DFDEL		000027	SIN	DVTTY		000010	SIN
CHANIO		000023'		DCLI		000023	SIN	DFEXC		000031	SIN	DXFR		000012	SIN
CHANIO	043000	000000		DDBCNE		003572'	EXT	DFFIF		000035	SIN	DZAP		000012	SIN
CHEKAR		001102'	EXT	DDI	777777	777777	SIN	DFTRN		000036	SIN	ENTRB		020000	SIN
CHKMOD		004150'		DDO	777777	777776	SIN	DFVLR		000033	SIN	ERRIDM		004155'	EXT
CHNCHK		000077'	INT	DDXZ		000000	SIN	DGF		000015	SIN	ERRIUC		004141'	EXT
CHNCK1		000077'	INT	DEN		000016	SIN	DGTRD		000013	SIN	F		000004	INT
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 67-2
IOCSS.MAC	 9-OCT-87 18:01		SYMBOL TABLE

FALOFF		004301'	EXT	IOACT		010000	SIN	KCBWAK		001173'	EXT	MGNTLN		000005	SPD
FCREAU		000676'		IOADVB		200000	SIN	KCLEAR		004256'	EXT	MGNUPD		001245'	
FCREQ		003233'	EXT	IOALL		003765'		KERCH2		000741'		MOVBF2		000661'	
FCWAIT		003232'	EXT	IOALL0		003772'		KERCH4		000747'		MOVBF3		000621'	
FD2FNO		001013'	EXT	IOALL1		004004'		KERCHN		000710'		MOVBUF		000620'	INT
FDELUU		000674'		IOBEG		000002	SIN	KERERR		000754'		MOVIHD		000644'	
FDWUPX		000765'	EXT	IOBKTL		040000	SIN	KERUER		001140'		MOVOBF		000636'	
FECLP%		004270'	EXT	IOBOT		004000	SIN	KERUUO		001133'		MOVOHD		000652'	
FEXCHU		000702'		IOCEND		004517'	INT	KFILCK		001143'	EXT	NEWBF1		004156'	INT
FFIFPU		000704'		IOCLIT		004205'	INT	KREMOV		004257'	EXT	NEWBUF		004156'	
FNBDBL		001252'	EXT	IOCON		000040	SIN	KREPLC		001046'	EXT	NODIE		000000	EXT
FNBUPD		001324'	EXT	IOCSS		000000'	ENT	LENFXL		000043		NWATRP		002064'	EXT
FRMNVC		000773'		IODEND		020000	SIN	LI.PIF		000400	SPD	NXTCHN		000362'	
FRMOPD		000000	EXT	IODERR		200000	SIN	LI.PIN		000200	SPD	OBUFB		100000	SIN
FRMREP		000760'	INT	IODTER		100000	SIN	LICGDV		020000	SIN	OCLOSB		001000	SIN
FRMVCL		000762'	INT	IOEND		000040	SIN	LNGUUO		000072	SIN	ORACT		004030'	
FRMVRM		000763'	INT	IOIMPM		400000	SIN	LOOKB		040000	SIN	OTFFLG		001074'	EXT
FTRNCU		000700'		IOKILL		004013'	INT	M		000013	INT	OUT		002266'	INT
FVLRBU		000706'		IORELS		003764'	INT	MAPB		000004	SIN	OUT3		002323'	
FWUSI		001344'		IOSET		004066'	INT	MAPLE1		002673'		OUT3A		002331'	
FWUSO		001416'		IOSETC		004071'		MAPLS1		002632'		OUT4		002345'	
GELST1		003260'		IOSTBL		000010	SIN	MAPLSE		002672'		OUT5		002347'	
GELST2		003234'		IOSUPR		100000		MAPLSR		002640'		OUTA		002416'	
GELST3		003254'		IOTEND		002000	SIN	MAPLST		002633'		OUTBFB		000200	SIN
GELST5		003231'		IOUSE		400000	SIN	MAPLUZ		002710'		OUTDMP		002405'	
GELST6		003235'		IOUUO		000055	SIN	MAPLZ1		002713'		OUTF		002367'	
GELSTA		003225'		IOW		000001	SIN	MAXCHN		003770'	EXT	OUTF1		002373'	
GET4WD		003240'	EXT	IOWAIT		004011'	INT	MBBXFR		002156'	INT	OUTPB		004000	SIN
GETDDB		003635'	EXT	IOWC		000020	SIN	MBCDR		002430'		OUTS		002376'	
GETST2		003437'		IPOPJ		003407'	EXT	MBCDR1		002467'		OUTS1		002362'	
GETSTS		003423'		ITMCNT		004105'		MBCDR2		002477'		P		000001	INT
GIV4WD		003300'	EXT	ITMCT1		004106'	INT	MBCDR3		002463'		P1		000014	INT
GODEV		003112'		ITMCT2		004113'		MBCDR4		002441'		P2		000015	INT
IBUFB		200000	SIN	ITMSET		004103'		MBCDR5		002437'		P3		000016	INT
ICLOSB		002000	SIN	J		000002	INT	MBICD1		001775'		P4		000017	INT
IN		001520'		JBTABT		004404'	EXT	MBICD2		002051'		PC.UIO		004000	SIN
IN1		001540'		JBTLIC		003543'	EXT	MBICD3		002032'		PC.USR		010000	SIN
INBFB		000400	SIN	JOB		004007'	EXT	MBICD4		002071'		PDNMUP		001124'	EXT
INCOM		001530'		JOBDA		000517'	EXT	MBICD5		002060'		PDVCNT		004054'	EXT
INDMP		001661'		JOBFF		004464'	EXT	MBICD6		002110'		PDVTIM		004037'	EXT
INEOF1		001612'		JOBHCU		004236'	EXT	MBICD7		002101'		PEVEN8		003754'	INT
INEOF2		001627'		JOBJDA		004430'	EXT	MBICD8		002053'		PG		000003	INT
INITB		400000	SIN	JOBREL		004447'	EXT	MBICD9		001777'		PGPDIO		002665'	EXT
INPB		010000	SIN	JOBSA		004463'	EXT	MBICDR		001762'		PGUSI		001366'	
INPT0A		001601'		KCBADD		001146'	EXT	MEUPDR		001331'		PGUSO		001402'	
INPT0B		001577'		KCBHNG		001177'	EXT	MGNBIT		001221'		PGYDIO		002725'	EXT
INPT0C		001600'		KCBINI		001155'	EXT	MGNBT4		001254'		PHONLY		400000	SIN
INPT2		001603'		KCBINW		001152'	EXT	MGNCKR		001306'		PIOMOD		002272'	EXT
INPUT2		001606'		KCBKER		001200'	EXT	MGNCKU		001276'		PJOBN		004000'	EXT
INPUT3		001655'		KCBLEV		001150'	EXT	MGNRAC		001266'		PJRST	324740	000000	
INPUT4		001555'		KCBMEM		001163'	EXT	MGNSUD		001320'		PTRWT		002252'	
INPUTF		001642'		KCBRLI		001157'	EXT	MGNTB6		001263'		PTRXF1		002166'	
IO		000020	SIN	KCBSTS		001167'	EXT	MGNTBL		001240'		PTRXF2		002201'	
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 67-3
IOCSS.MAC	 9-OCT-87 18:01		SYMBOL TABLE

PTRXF3		002230'		SYSDEV		000100	SIN	UDSO3		001455'		VREPL1		001022'	
PTRXF4		002202'		T1		000006	INT	UDSO3A		001467'		VREPL2		001026'	
PTRXF5		002247'		T2		000007	INT	UDSO4		001475'		VREPL4		001042'	
PTRXF6		002236'		T3		000010	INT	UDSOP		001420'		VREPL5		001041'	
PTRXF7		002205'		T4		000011	INT	UDSOP0		001424'		VREPL6		001032'	
PTRXF8		002250'		TIN		003445'		UFDRD		000110'		VREPL7		001036'	
PTRXF9		002226'		TOUT		003456'		UINBF		000350'		VREPLU		001000'	INT
PUUOAC		004251'	EXT	TPOPJ		004204'	EXT	UINIC1		000467'		VREPLX		001063'	
PX.MEM		000004	SPD	TPOPJ1		000514'	EXT	UINIT		000407'		VSMAPU		000670'	INT
PX.SRC		000001	SPD	TST1UN		000513'	EXT	UINIT0		000413'		W		000012	INT
PXCT	256000	000000		TSTDSK		003611'	EXT	UINIT1		000433'		WAIT		000122'	INT
RELE4A		003363'		TSTKTJ		002065'	EXT	UINIT4		000502'		WAIT1		004143'	EXT
RELE5A		003354'		TTYATC		020000	SIN	UINIT5		000512'		WAITI		001674'	
RELEA4		003355'		TTYFND		003637'	EXT	UINITA		000421'		WAITIO		001672'	INT
RELEA5		003344'	INT	TTYUUO		000007'	EXT	UINITC		000460'		WAITO		001701'	
RELEA6		003372'	INT	U		000005	INT	UINITE		000515'		WCLA		001712'	
RELEA7		003371'		UCALL		000000	EXT	UINITL		000447'		WCLAI		001706'	
RELEA9		003370'	INT	UCALLI		000006'	EXT	UINITZ		000517'		WLKUPT		004265'	EXT
RELEAS		003334'		UCBADD		001146'	INT	ULDUPX		001112'	EXT	WLKUPX		001063'	EXT
RELEAX		003334'	INT	UCBHNG		001175'	INT	UMTAPE		001213'		WPOPJ		000613'	
REPLER		001105'		UCBINI		001154'	INT	UNIUPT		001113'	EXT	WRPI	700600	000000	
REPRL0		001114'		UCBINW		001152'	INT	UNWUPT		001061'	EXT	WRUBR	701140	000000	
REPRLS		001054'		UCBLEV		001150'	INT	UOBF1		000344'		WSYNC		002501'	EXT
REPRLU		001113'		UCBMEM		001161'	INT	UOPEN		000405'		XREPLU		001004'	
REPRLX		001112'		UCBRLI		001157'	INT	UOUT		002256'		ZZ		544442	SPD
REPRS1		001057'		UCBSTS		001165'	INT	UOUT1		002264'		%UPT		000000	EXT
S		000000	INT	UCBWAK		001171'	INT	UOUTBF		000333'		.ARCHM		000045	SIN
S$ENTR	777777	777775	SIN	UCLS0		000313'		UPTACP		000000	EXT	.ARVAR		000050	SIN
S$HALT	777777	777777	SIN	UCLS1		000321'		UPTENB		000000	EXT	.ARVAW		000051	SIN
S$NAME		000000'	SPD	UCLS2		000166'		UPTHCU		000000	EXT	.FDSLF		700000	SIN
S$NONA		000000	SIN	UCLS2A		000206'		UPTJDA		000000	EXT	
S$TEMP		000000	SPD	UCLS2B		000227'		UPTJOB		000000	EXT	
S$XCT	777777	777776	SIN	UCLS2C		000223'		UPTOFD		000000	EXT	
SD		000015	SIN	UCLS2D		000244'		UPTSIM		000000	EXT	
SETACT		004033'	INT	UCLS3		000261'		URENAM		001201'		
SETBYT		004171'	INT	UCLS3C		000242'		USDEN		000533'		
SETDDB		003522'	EXT	UCLS4		000161'		USTATO		003410'		
SETHNG		004037'	INT	UCLS5		000145'		USTATS		003414'		
SETIO2		004143'	INT	UCLS6		000276'		USTATZ		003417'		
SETIOD		004135'	EXT	UCLS7		000176'		UUOMNR		000010'	EXT	
SETIOS		004137'		UCLSBI		000152'		UUOSK1		000115'	INT	
SETMOD		000615'	INT	UCLSBO		000201'		UUOTAB		000003'	INT	
SETNEW		001512'		UDEN		000534'		UUYCPR		000664'	INT	
SETUSR		004015'		UDGF		001206'		UUYCTG		000663'	INT	
SIMBIN		001724'	EXT	UDLK		000557'		UUYSVM		000665'	INT	
SIMBOU		001740'	EXT	UDLKC		000601'		VCLEAU		001122'	INT	
SIMDMP		001744'	EXT	UDSI		001345'		VFLCKU		001143'	INT	
SRDUPX		000000	EXT	UDSI1		001361'		VMAPUU		000666'	INT	
STCLTB		003441'		UDSIP		001346'		VMOVPG		000672'		
STDRNG		000004	SIN	UDSIP0		001352'		VREMOU		001123'	INT	
STOIOS		004036'	INT	UDSO		001417'		VREMV2		001124'		
SWRUPX		001131'	EXT	UDSO1		001474'		VREP3A		001074'		
SYSDEV		000100	SIN	

IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

ABTUUO	    24%	  1923
ACTDDB	   500%	   500
ACTDED	   501%	   501
ADRCLS	  2406	  2456	  2538	  2604	  2809#
ADRERR	    24%	   561	  2151	  2208	  2594	  2815
ADVBF1	  3010	  3037#
ADVBFE	  2278	  2552	  2999#
ADVBFF	  2347	  3026#
ARGCHK	   593	   611	   630#
ASSAS0	  3051	  3054#
ASSAS1	  3058	  3075#
ASSAS2	  3053	  3063	  3066	  3071	  3077#
ASSAS3	  3061	  3074#
ASSASG	   492	  3049#
ASSCON	  2887	  2894	  3059	  3068	  3072
ASSPRG	   491	  2884	  2887	  3059	  3064
ATBFNB	  1383%	  1417	  1472
ATBMWC	  1384%	  1471
ATBSTS	  1383%	  1447	  1489
ATPUPD	  1383%	  1448	  1490
ATYCNT	  1384%	  1458
AUXTUU	    37%	    43
B	  2001
BFICLN	   236	   324#	  1509
BFICLS	   325	   351#
BLDLB1	  2713	  2715#
BLDLB2	  2728	  2734#
BLDLB3	  2731	  2737#
BLDLB4	  2723#	  2732
BLDLE0	  2679	  2684	  2741#
BLDLM1	  2696#
BLDLM3	  2699#
BLDLND	  2706	  2747#
BLDLS1	  2680	  2682	  2685#
BLDLS2	  2686#	  2707
BLDLST	  2394	  2526	  2601	  2678#
BUFC1	  3206	  3210#	  3213
BUFCLC	   377	   393	  3189#
BUFCLR	  1903	  2207	  3236#	  3559
CALIN	  1698	  1838#
CALIN1	  1845	  1848#
CBLAM1	  2829	  2832#
CBLAMB	  2258	  2822#
CBLAU1	  2843	  2848#
CBLAUB	  2256	  2840#
CBLEMB	  1866	  1941	  1969#
CBLEUB	  1868	  1981#
CHANIO	    43	    67#
CHEKAR	   983%	  1060	  1071
CHKMOD	   489	  3537	  3545#
CHNCHK	   116#	   132	   140	   149	   196	   372	   388	   581	   603	   644	   871	  1328	  1337	  1345
	  1387	  1500	  1519	  1533	  1549	  1646	  2118	  2852	  2937	  2960	  2973	  3531
CHNCK1	   117#	  3125
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

CHNCK2	   123#	   221	   233	  1511	  1594
CHNIER	    75	    81	    89#
CHNNX0	   411#	   414
CHNNX1	   412	   416#
CHNNXT	   401	   408#	   421
CHNOTB	    78	    79	    94#	   115
CHOTBL	    74	   115#
CKS12	  2035	  3258#
CKS12A	  3264#	  3266
CLA	   258	   289	  1794	  1795	  1825#	  2162	  2168	  2188
CLAI	  1680	  1714	  1734	  1753	  1789	  1790	  1800#
CLIBUF	  1808#	  1844
CLIDMP	  1765	  1812#
CLNLS1	  2398	  2400	  2403	  2409#	  2530	  2532	  2535
CLNLST	  2409	  2655	  2793#	  2811
CLOBUF	   263	  1569	  1829#	  2175
CLODMP	  1833#	  2223
CLOSE0	    55	    94	   195#
CLOSE1	   210#	   625	  2856
CLRACT	  3388#	  3527
CLRBYT	  3286#
CLRDDB	  2898%	  2898
CLSIN	   214	   586
CLSOUT	   239	   607
CNGIN	  1627#	  1668
COPEN	    82	    99	   421#
CPOPJ	    30%	   670	  1398	  1445	  1470	  2591	  2752	  2794	  2877	  3000	  3027
CPOPJ1	   404	   405	   418	   583	   605	   619	   912	  1125	  1325%	  1330	  1392	  1429	  1440	  1451
	  1464	  1477	  2357	  2557	  2753	  3089	  3135	  3160	  3247	  3568
CPRRED	  1069
CPUF3	  2619	  3402
CPUKI	  2421	  2441	  2619
CPUKL	  2325	  2370	  2430	  2496	  2500	  2569	  2582	  2620
CPUKS	  2346	  2647
CPUTYP	  2325	  2346	  2370	  2421	  2430	  2441	  2496	  2500	  2569	  2582	  2619	  2620	  2647	  3402
CPZZ	  2325#	  2325	  2346#	  2346	  2370#	  2370	  2421#	  2421	  2430#	  2430	  2441#	  2441	  2496#	  2496
	  2500#	  2500	  2569#	  2569	  2582#	  2582	  2619#	  2619	  2620#	  2620	  2647#	  2647	  3402#	  3402
CSHSAV	  2496%
CSRTAB	  2330	  2330%	  2331	  2332	  2333	  2334	  2339	  2340	  2341	  2342	  2343	  2432	  2433	  2434
	  2435	  2436	  2584	  2585	  2586	  2587	  2588	  2630	  2631	  2632	  2633	  2634	  2638	  2639
	  2640	  2641	  2642
CSUCNT	  2371	  2496%	  2571
CSUNL	  2370%	  2370	  2570%	  2570
CSVAL	  2500%	  2500
CSVCNT	  2496%	  2501
CTMBS	  1905	  1949#
CTMBS1	  1953	  1960#
CTMBS2	  1959	  1962#
DBYT	  3594
DCL	   195	   246	   287
DCLI	   220	   223	   232	   235
DDBCNE	  3105	  3105%
DDI	  1768	  2657
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

DDO	  2226	  2659
DDXZ	   124
DEN	   580
DEPMGN	  1383%	  1419	  1435	  1438
DEV0	  3100	  3104#
DEVABC	   354	  2313	  2316	  2353	  2354	  2547	  2550	  2555	  2556	  2662	  2946
DEVADR	  3474	  3558	  3563
DEVATB	  1383%	  1420	  1444	  1469	  1488
DEVBTS	  1383%	  1424	  1426	  1433	  1439
DEVBUF	   250	   273	   291	   326	   344	   378	   396	   535	   541	   663	   666	   669	   672	  1559
	  1577	  1662	  1729	  1916	  1917	  2140	  2170	  2179	  2190	  2201	  2240
DEVBWC	  2315	  2317	  2321	  2380	  2381	  2519	  2607	  2612	  2616
DEVCHK	  3398#
DEVCHR	  3190
DEVCK0	  3399#	  3418
DEVCK1	  3401	  3408	  3410	  3417#
DEVCLS	  1857	  1881	  1949	  1969	  2019	  2251	  2268	  2283	  2295	  2415	  2454	  2474	  2761	  2782
	  2796	  2804	  2809	  2823
DEVCTR	  3428	  3567
DEVDBL	  1383%	  1427
DEVEC1	  1643%	  1652
DEVECK	   193%	   311	   314	   317	  1349	  1514	  1598	  2122
DEVERR	  3524#
DEVFLO	    29%	   316
DEVHNG	    29%	  3415
DEVIAD	   394	   651	   654	  1738	  1748	  1887	  1895	  1900	  1935	  1981	  2030	  2036	  2323	  2376
	  2401	  2402	  2878	  3026	  3031
DEVIOS	   121	   238	   506	   544	   630	  1640	  1664	  1670	  1725	  1763	  1842	  1932	  2040	  2137
	  2160	  2221	  2311	  2510	  2549	  2573	  2578	  2861	  3327	  3383	  3389	  3399	  3429	  3539
DEVLG	  3087	  3093#
DEVLOG	  3099
DEVLP0	  3099#	  3108
DEVLP1	  3147#	  3151
DEVLP2	  3149	  3161#
DEVLP3	  3103	  3162#
DEVLST	  3096%	  3096	  3146%	  3146	  3398
DEVMOD	   225	   309	   320	   589	  1390	  1685	  2885	  2896	  2977	  3049	  3060	  3065	  3073	  3075
	  3161	  3548
DEVNAM	  2883	  3148
DEVOAD	   254	   379	   657	   660	  1562	  2173	  2204	  2242	  2506	  2533	  2534	  2841	  2879	  2999
	  3007
DEVOPR	  3137%	  3137
DEVPHY	  3088	  3134#
DEVPOS	    29%	   315
DEVPTR	  3476	  3562	  3565
DEVPWC	  1860	  1888	  1896	  1906	  1926	  1937	  1939	  1987	  2255	  2274	  2277	  2290	  2845
DEVSER	   123	   226	   245	   265	   286	   612	  1571	  1592	  1767	  1846	  1876	  1914	  2050	  2129
	  2177	  2225	  2265	  2287	  2299	  2382	  2512	  2599	  2656	  2858	  2890	  3107	  3150	  3329
	  3411	  3417	  3593
DEVSRC	   483	  3087#	  3123
DEVSTS	   502
DEVWUC	  2291
DEYCLS	   257	   262	   288	   324	  1568	  1642%	  1679	  1713	  1733	  1752	  1764	  1777	  1782	  1843
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

	  2161	  2167	  2174	  2187	  2222	  2940
DEYMCT	  1642%	  2768
DEYTCT	  1642%	  2774	  2793	  2801
DFCRE	   776	   904
DFDEL	   758	   905
DFEXC	   813
DFFIF	   834
DFTRN	   795	   902
DFVLR	   849	   877
DGF	  1336	  1340
DGTRD	  2383	  2513	  2600
DHNG	  3413
DIE	    11	    11%	    12
DIN	  1645	  1847	  1915	  2054	  2959
DIOMAX	    29%	  2445
DLK	   602	   613
DLKDEN	   598	   617#
DMOVPG	   739
DMT	  1344	  1348
DOU	   266	  1572	  2117	  2178	  2288	  2300	  2972
DOXCT	   464%	   514	   524	   527	  2865	  2873	  3204	  3362	  3365
DR	  2574
DRL	  2859
DRN	  1327	  1331
DSEK	   139	   143
DSI	  1510	  1513
DSIM	   579
DSO	  1593	  1597
DTID1	  2388	  2390	  2395	  2405#
DTID11	  2309	  2313#	  2351
DTID12	  2312	  2354#
DTID13	  2350	  2355#
DTID14	  2314	  2353#
DTID15	  2319	  2323#
DTID2	  2384#	  2404
DTID31	  2615	  2626#
DTID32	  2593	  2598#	  2617
DTID33	  2581#	  2596
DTID36	  2577#	  2627	  2644
DTIDR1	  1807	  2306#	  2374
DTIDR2	  1811	  2369#
DTIDR3	  1815	  1836	  2568#
DTOD1	  2522	  2527	  2537#
DTOD11	  2546	  2550#	  2554
DTOD12	  2556#
DTOD14	  2551	  2555#
DTOD2	  2514#	  2536
DTOD4	  2526#
DTOD5	  2516	  2521#
DTODR1	  1828	  2504	  2545#
DTODR2	  1832	  2499#
DUFD	   131	   135
DVCNSG	  3121#
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

DVDSK	   229	   310	   319	   590	  1391	  2895	  2897	  3050
DVMAP	   700	   886
DVMTA	  2978
DVRMT	  1686	  2889
DVSMAP	   724	   887
DVTTY	  1686	  2889	  2895
DXFR	  1878	  2266
DZAP	  2891
ENTRB	   597	  1482	  1525	  1538
ERRIDM	    24%	  3550
ERRIUC	    24%	    72	    87	    90	   133	   141	   373	   374	   389	   390	   582	   604	   645	   872
	  1329	  1338	  1346	  1388	  1501	  1520	  1534	  1550	  1647	  2119	  2938	  2961	  2974	  3532
F	   119	   121	   123	   211	   215	   225	   226	   227	   238	   240	   245	   248	   250	   254
	   265	   273	   286	   291	   298	   308	   309	   312	   313	   315	   316	   320	   326	   344
	   354	   375	   378	   379	   384	   391	   394	   396	   472	   499	   502	   506	   518	   525
	   529	   535	   536	   541	   542	   544	   546	   587	   589	   596	   597	   608	   612	   615
	   616	   618	   630	   631	   651	   654	   657	   660	   663	   666	   669	   672	   892	   893
	  1390	  1418	  1420	  1424	  1426	  1427	  1428	  1433	  1439	  1444	  1469	  1482	  1483	  1485
	  1486	  1488	  1506	  1508	  1525	  1538	  1555	  1557	  1559	  1562	  1571	  1577	  1592	  1640
	  1656	  1657	  1658	  1662	  1664	  1670	  1685	  1725	  1729	  1738	  1748	  1763	  1767	  1842
	  1846	  1857	  1860	  1876	  1881	  1887	  1888	  1895	  1896	  1900	  1906	  1914	  1916	  1917
	  1926	  1932	  1935	  1937	  1939	  1949	  1969	  1981	  1987	  2019	  2030	  2036	  2040	  2050
	  2124	  2125	  2129	  2132	  2137	  2140	  2160	  2170	  2173	  2177	  2179	  2190	  2201	  2204
	  2221	  2225	  2237	  2240	  2242	  2251	  2255	  2265	  2268	  2274	  2277	  2283	  2287	  2290
	  2291	  2295	  2299	  2311	  2313	  2315	  2316	  2317	  2321	  2323	  2353	  2354	  2376	  2380
	  2381	  2382	  2401	  2402	  2415	  2454	  2472	  2474	  2506	  2510	  2512	  2519	  2533	  2534
	  2547	  2549	  2550	  2555	  2556	  2573	  2578	  2599	  2607	  2612	  2616	  2656	  2662	  2761
	  2782	  2796	  2804	  2809	  2823	  2841	  2845	  2858	  2861	  2875	  2878	  2879	  2883	  2885
	  2890	  2896	  2946	  2977	  2999	  3007	  3026	  3031	  3049	  3060	  3065	  3073	  3075	  3096
	  3099	  3107	  3108	  3146	  3147	  3148	  3150	  3151	  3161	  3190	  3325	  3327	  3329	  3383
	  3389	  3398	  3399	  3411	  3412	  3416	  3417	  3418	  3428	  3429	  3474	  3476	  3539	  3548
	  3558	  3562	  3563	  3565	  3567	  3593
FALOFF	   897	   961	   982%	  1089	  1105%	  1117
FCREAU	   110	   776#
FCREQ	  1642%	  2763	  2765	  2767
FCWAIT	  1642%	  2766
FD2FNO	   983%	  1003
FDELUU	   109	   758#
FDWUPX	   946%	   951
FECLP%	   983%	  1053
FEXCHU	   109	   813#
FFIFPU	   112	   834#
FNBDBL	  1383%	  1418
FNBUPD	  1384%	  1473
FRMNVC	   952	   959#
FRMOPD	    37%	    44
FRMREP	   934#
FRMVCL	   948#
FRMVRM	   949#
FTRNCU	   112	   795#
FVLRBU	   111	   849#
FWUSI	   105	  1496#
FWUSO	   106	  1545#
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

GELST1	  2762	  2788#
GELST2	  2764	  2768#
GELST3	  2773	  2784#
GELST5	  2765#	  2787
GELST6	  2769#	  2786
GELSTA	  2379	  2511	  2598	  2761#
GET4WD	  1642%	  2772
GETDDB	  3156%	  3156
GETST2	  2944	  2948#
GETSTS	  1650	  2907	  2918	  2931	  2936#	  2964
GINST	    67#	    67	    68	   251#	   251	   252	   255#	   255	   256	   274#	   274	   275	   278#	   278
	   279	   282#	   282	   283	   293#	   293	   294	   295#	   295	   296	   296#	   297	   327#	   327
	   328	   336#	   336	   337	   339#	   339	   340	   345#	   345	   346	   347#	   347	   348	   348#
	   349	   381#	   381	   382	   417#	   417	   418	   439#	   439	   440	   478#	   478	   479	   515#
	   515	   516	   525#	   525	   526	   528#	   528	   529	   532#	   532	   533	   538#	   538	   539
	   562#	   562	   563	   566#	   566	   567	   570#	   570	   571	   675#	   675	   676	   885#	   885
	   886	   900#	   900	   907#	   907	   908	   918#	   918	   919	   953#	   953	   954	   960#	   960
	   961	   963#	   963	   964	   989#	   989	   990	   997#	   997	   998	   998#	   999	  1079#	  1079
	  1080	  1092#	  1092	  1093	  1119#	  1119	  1128#	  1128	  1129	  1212#	  1212	  1213	  1251#	  1251
	  1252	  1252#	  1253	  1273#	  1273	  1274	  1274#	  1275	  1295#	  1295	  1296	  1296#	  1297	  1317#
	  1317	  1318	  1318#	  1319	  1393#	  1393	  1394	  1437#	  1437	  1438	  1450#	  1450	  1451	  1463#
	  1463	  1464	  1476#	  1476	  1477	  1497#	  1497	  1498	  1516#	  1516	  1517	  1530#	  1530	  1531
	  1546#	  1546	  1547	  1560#	  1560	  1561	  1563#	  1563	  1564	  1578#	  1578	  1579	  1581#	  1581
	  1582	  1585#	  1585	  1586	  1633#	  1633	  1634	  1636#	  1636	  1637	  1639#	  1639	  1640	  1667#
	  1667	  1668	  1673#	  1673	  1674	  1676#	  1676	  1677	  1678#	  1678	  1679	  1684#	  1684	  1685
	  1689#	  1689	  1690	  1691#	  1691	  1692	  1695#	  1695	  1696	  1696#	  1697	  1700#	  1700	  1701
	  1702#	  1702	  1703	  1705#	  1705	  1706	  1707#	  1707	  1708	  1709#	  1709	  1710	  1716#	  1716
	  1717	  1722#	  1722	  1723	  1730#	  1730	  1731	  1736#	  1736	  1737	  1743#	  1743	  1744	  1751#
	  1751	  1752	  1803#	  1803	  1889#	  1889	  1890	  1890#	  1891	  1898#	  1898	  1899	  1899#	  1900
	  1901#	  1901	  1902	  1918#	  1918	  1919	  1919#	  1920	  1928#	  1928	  1929	  1929#	  1930	  1936#
	  1936	  1937	  1938#	  1938	  1939	  1983#	  1983	  1984	  1985#	  1985	  1986	  2003#	  2003	  2004
	  2011#	  2011	  2012	  2012#	  2013	  2027#	  2027	  2028	  2037#	  2037	  2038	  2141#	  2141	  2142
	  2144#	  2144	  2145	  2146#	  2146	  2147	  2153#	  2153	  2154	  2155#	  2155	  2156	  2156#	  2157
	  2158#	  2158	  2159	  2171#	  2171	  2172	  2172#	  2173	  2180#	  2180	  2181	  2181#	  2182	  2182#
	  2183	  2191#	  2191	  2192	  2192#	  2193	  2203#	  2203	  2204	  2206#	  2206	  2207	  2210#	  2210
	  2211	  2211#	  2212	  2241#	  2241	  2242	  2244#	  2244	  2245	  2324#	  2324	  2325	  2336#	  2336
	  2337	  2377#	  2377	  2378	  2385#	  2385	  2386	  2399#	  2399	  2400	  2428#	  2428	  2429	  2429#
	  2430	  2440#	  2440	  2441	  2472#	  2472	  2473	  2473#	  2474	  2507#	  2507	  2508	  2515#	  2515
	  2516	  2518#	  2518	  2519	  2531#	  2531	  2532	  2581#	  2581	  2582	  2605#	  2605	  2606	  2613#
	  2613	  2614	  2628#	  2628	  2629	  2842#	  2842	  2843	  2844#	  2844	  2845	  2866#	  2866	  2867
	  2874#	  2874	  2875	  2919#	  2919	  2920	  3001#	  3001	  3002	  3004#	  3004	  3005	  3008#	  3008
	  3009	  3028#	  3028	  3029	  3030#	  3030	  3031	  3032#	  3032	  3033	  3191#	  3191	  3192	  3205#
	  3205	  3206	  3211#	  3211	  3212	  3214#	  3214	  3215	  3217#	  3217	  3218	  3219#	  3219	  3220
	  3237#	  3237	  3238	  3244#	  3244	  3245	  3246#	  3246	  3247	  3259#	  3259	  3260	  3265#	  3265
	  3266	  3363#	  3363	  3364	  3366#	  3366	  3367	  3445#	  3445	  3446	  3446#	  3447	  3447#	  3448
	  3448#	  3449	  3451#	  3451	  3452	  3474#	  3474	  3475
GIV4WD	  1643%	  2807
GODEV	  2609	  2655#
IBUFB	   542
ICLOSB	   215	   312	   529	   608	   615	  1485	  1506	  1657
IN	    54	    95	  1645#
IN1	  1662#	  1759
INBFB	   211	   227	   391	  1508
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

INCOM	  1649	  1654#	  2963
INDMP	  1661	  1761#
INEOF1	  1706	  1713#
INEOF2	  1720	  1729#
INITB	   529
INPB	   211	   227	   615	  1508	  1656
INPT0A	  1701#	  1732
INPT0B	  1694	  1698#	  1739	  1755
INPT0C	  1683	  1692	  1697	  1699#
INPT2	  1704#
INPUT2	  1681	  1703	  1707#	  1715	  1717	  1735	  1737	  1754
INPUT3	  1746	  1756#
INPUT4	  1672	  1679#
INPUTF	  1669	  1742#
IO	  1566	  1654	  1762	  1774	  1841	  2130	  2136	  2220	  2427	  2509	  2626	  2658	  2943
IOACT	  1682	  1731	  1912	  2045	  2165	  2281	  2293	  2860	  2945	  3382	  3386	  3388	  3400	  3538
IOADVB	   276	   294	   346	  1579	  1632	  1634	  1671	  1677	  1708	  1721	  1742	  1750	  2143	  2157
	  2202	  2209
IOALL	  3310	  3317#	  3348	  3353
IOALL0	  3325#	  3339
IOALL1	  3326	  3339#
IOBEG	   505	   591	  1855	  2249	  2308	  2310	  2545	  2548	  2577
IOBKTL	   592	   610	  1718	  2017	  2033	  2059	  2164	  2610	  2965	  2980
IOBOT	   592	   610
IOCEND	  3793#
IOCLIT	  3601#
IOCON	  1687	  2397	  2529	  3037
IOCSS	    11	    12#	    15
IODEND	   237	   592	   610	  1724	  1931	  2610	  2965
IODERR	   592	   610	  1718	  2164	  2610	  2965	  2980
IODTER	   592	   610	  1718	  2039	  2164	  2610	  2965	  2980
IOEND	   237	   543	   610	  1718	  1723	  1838	  1910	  1943	  2043
IOIMPM	   592	   610	  1718	  2164	  2965	  2980
IOKILL	  3352#
IORELS	  3309#
IOSET	  3428#
IOSETC	  1710	  2212	  3443#
IOSTBL	  1841	  2159	  2185	  3524
IOSUPR	  1523#	  1524	  1537
IOTEND	   592	   610	  2979
IOUSE	   292	   329	  1637	  1663	  1897	  1934	  2154	  2202	  2243	  3003	  3029	  3222
IOUUO	    49#
IOW	  3387	  3525
IOWAIT	  3347#
IOWC	   281	  1584	  2147	  2152
IPOPJ	  2899%	  2899
ITMCNT	  3476#
ITMCT1	  3449	  3477#
ITMCT2	  3477	  3483#
ITMSET	  3473#	  3566
J	   480	   874	  1005	  1019	  1707	  2211	  2212	  2411	  2413	  2419	  2812	  2813	  2893	  2894
	  2896	  3057	  3070	  3074	  3102	  3342	  3428	  3451	  3474	  3475	  3477	  3480	  3483	  3484
	  3485	  3486	  3487	  3495	  3496	  3497	  3567
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

JBTABT	    28%	  2413	  2419	  2813
JBTLIC	    28%	  3070
JOB	    28%	   480	   874	  2812	  3332	  3342
JOBDA	   560%	   560
JOBFF	    28%	  3191	  3214	  3219	  3366
JOBHCU	   528	   548%	  2874
JOBJDA	   515	   525	   548%	  2866
JOBREL	    28%	  3205
JOBSA	    28%	  3363
KCBADD	  1157%	  1159
KCBHNG	  1315%	  1319
KCBINI	  1210%	  1213
KCBINW	  1191%	  1193
KCBKER	  1157%	  1160	  1177	  1194	  1214	  1231	  1254	  1276	  1298	  1320
KCBLEV	  1174%	  1176
KCBMEM	  1249%	  1253
KCBRLI	  1228%	  1230
KCBSTS	  1271%	  1275
KCBWAK	  1293%	  1297
KCLEAR	   948	   986%	  1108
KERCH2	   889	   902#
KERCH4	   878	   903	   908#
KERCHN	   701	   725	   740	   759	   777	   796	   814	   835	   850	   871#
KERERR	   910	   916#
KERUER	  1123	  1127#
KERUUO	   957	  1121#	  1144
KFILCK	   986%	  1142
KREMOV	   949	   986%	  1109
KREPLC	   986%	  1036
LENFXL	  2788
LI.PIF	  2461	  2481
LI.PIN	  2466	  2486
LICGDV	  3067	  3069
LISTSN	     3	     6
LNGUUO	    56#
LOOKB	   616	  1483	  1525
M	   214	   239	   261	   267	   439	   440	   466	   467	   470	   477	   478	   487	   494	   531
	   532	   538	   622	   624	   627	   638	   675	   885	   899	   900	   907	   908	   911	   916
	   934	   953	   956	   960	   997	  1008	  1011	  1015	  1033	  1038	  1044	  1047	  1065	  1076
	  1119	  1121	  1124	  1127	  1128	  1393	  1437	  1450	  1463	  1476	  1497	  1498	  1516	  1517
	  1522	  1527	  1530	  1531	  1536	  1540	  1546	  1547	  1567	  1574	  1587	  1588	  1591	  1627
	  1636	  1638	  1756	  1758	  2199	  2236	  2241	  2242	  2581	  2583	  2595	  2605	  2613	  2615
	  2628	  2855	  2908	  2919	  2932	  3196	  3319	  3324	  3340	  3538	  3539	  3545
MAPB	   615	   892
MAPLE1	  2455#	  2458	  2467
MAPLS1	  2407	  2410#	  2539
MAPLSE	  2439	  2446	  2454#
MAPLSR	  2416#	  2418	  2452
MAPLST	  2411#	  2608
MAPLUZ	  2412	  2472#
MAPLZ1	  2475#	  2478	  2487
MAXCHN	    71	   413	  3122%	  3122	  3323	  3371
MBBXFR	  1999#
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

MBCDR	  1825	  2249#
MBCDR1	  2279	  2281#
MBCDR2	  2259	  2290#
MBCDR3	  2257	  2267	  2276#
MBCDR4	  2258#	  2294	  2298
MBCDR5	  2250	  2256#	  2275	  2280	  2301
MBICD1	  1856	  1866#	  1909	  1925
MBICD2	  1867	  1910#
MBICD3	  1869	  1879	  1895#
MBICD4	  1911	  1926#
MBICD5	  1913	  1917#
MBICD6	  1894	  1941#
MBICD7	  1927	  1934#	  1944
MBICD8	  1912#	  1945
MBICD9	  1868#	  1942
MBICDR	  1800	  1855#
MEUPDR	  1415	  1455	  1482#
MGNBIT	   108	  1386#
MGNBT4	  1420#	  1428
MGNCKR	  1405	  1455#
MGNCKU	  1404	  1444#
MGNRAC	  1403	  1433#
MGNSUD	  1406	  1469#
MGNTB6	  1422	  1425	  1427#
MGNTBL	  1399	  1402#	  1408
MGNTLN	  1396	  1408#
MGNUPD	  1402	  1413#
MOVBF2	   105	   675#
MOVBF3	   642#	   676
MOVBUF	   641#
MOVIHD	   656	   658	   661#
MOVOBF	   650	   652	   655#
MOVOHD	   662	   664	   667#
NEWBF1	  3557#
NEWBUF	  3558#
NODIE	    11%
NWATRP	    27%	  1921
NXTCHN	    83	   113	   401#
OBUFB	   536
OCLOSB	   240	   298	   313	   529	   587	   596	  1486	  1555	  2125	  2237
ORACT	  3382#
OTFFLG	   982%	   990	  1007	  1008	  1010	  1011	  1014	  1015	  1043	  1044	  1046	  1047	  1057	  1065
OUT	   284	  1589	  2129#
OUT3	  2145	  2159#	  2186
OUT3A	  2165#	  2193
OUT4	  2177#
OUT5	  2166	  2176	  2179#
OUTA	  2138	  2236#
OUTBFB	   211	   248	   375	  1557
OUTDMP	  2135	  2219#
OUTF	  2142	  2196#
OUTF1	  2198	  2202#
OUTPB	   211	   248	   596	  1557	  2124
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

OUTS	  2183	  2194	  2205#
OUTS1	  2163	  2190#
P	    12	    91	   120	   122	   125	   126	   132	   134	   140	   142	   149	   150	   196	   197
	   198	   210	   213	   221	   223	   233	   235	   236	   246	   261	   266	   267	   268	   284
	   285	   287	   297	   302	   349	   372	   376	   377	   383	   385	   388	   392	   393	   401
	   403	   409	   421	   467	   468	   469	   470	   471	   476	   477	   481	   483	   487	   488
	   489	   490	   492	   494	   495	   514	   524	   527	   531	   537	   545	   549	   552	   564
	   567	   569	   571	   581	   585	   588	   593	   594	   603	   606	   609	   611	   613	   617
	   622	   623	   625	   626	   627	   632	   634	   635	   637	   642	   644	   647	   648	   668
	   673	   871	   873	   879	   895	   901	   908	   909	   911	   916	   919	   951	   964	   996
	   999	  1003	  1021	  1026	  1027	  1030	  1034	  1035	  1036	  1038	  1039	  1040	  1041	  1045
	  1049	  1052	  1054	  1059	  1060	  1061	  1062	  1064	  1066	  1071	  1072	  1074	  1076	  1077
	  1078	  1086	  1087	  1088	  1093	  1110	  1115	  1120	  1121	  1122	  1124	  1127	  1129	  1328
	  1337	  1339	  1345	  1347	  1348	  1387	  1397	  1414	  1415	  1416	  1455	  1456	  1484	  1487
	  1491	  1492	  1500	  1502	  1503	  1509	  1511	  1512	  1513	  1519	  1521	  1533	  1535	  1549
	  1551	  1552	  1567	  1572	  1573	  1574	  1587	  1589	  1590	  1591	  1594	  1595	  1597	  1628
	  1629	  1641	  1646	  1649	  1650	  1655	  1668	  1698	  1704	  1726	  1747	  1757	  1761	  1766
	  1768	  1776	  1780	  1781	  1785	  1800	  1802	  1804	  1807	  1810	  1811	  1814	  1815	  1825
	  1828	  1831	  1832	  1835	  1836	  1839	  1840	  1847	  1848	  1849	  1866	  1868	  1878	  1902
	  1903	  1905	  1908	  1915	  1920	  1922	  1924	  1930	  1933	  1940	  1941	  1963	  1975	  1984
	  1986	  1990	  1991	  1999	  2004	  2005	  2006	  2035	  2047	  2051	  2052	  2053	  2054	  2055
	  2056	  2057	  2061	  2062	  2064	  2065	  2066	  2067	  2118	  2121	  2131	  2138	  2178	  2184
	  2200	  2207	  2219	  2224	  2226	  2238	  2239	  2245	  2256	  2258	  2266	  2278	  2282	  2286
	  2292	  2300	  2306	  2307	  2347	  2355	  2356	  2370	  2374	  2378	  2379	  2383	  2384	  2394
	  2396	  2405	  2409	  2410	  2420	  2476	  2500	  2504	  2508	  2511	  2513	  2514	  2526	  2528
	  2537	  2552	  2570	  2598	  2600	  2601	  2608	  2609	  2611	  2655	  2660	  2661	  2663	  2678
	  2738	  2739	  2741	  2744	  2745	  2749	  2766	  2770	  2771	  2772	  2780	  2781	  2783	  2784
	  2785	  2789	  2800	  2811	  2822	  2832	  2833	  2848	  2852	  2853	  2856	  2857	  2859	  2865
	  2873	  2888	  2893	  2898	  2907	  2909	  2910	  2918	  2920	  2931	  2933	  2934	  2937	  2942
	  2949	  2960	  2963	  2964	  2966	  2967	  2973	  2976	  2981	  2982	  3009	  3033	  3038	  3039
	  3052	  3076	  3078	  3087	  3095	  3097	  3109	  3110	  3125	  3128	  3130	  3134	  3138	  3154
	  3157	  3158	  3159	  3162	  3163	  3164	  3189	  3204	  3223	  3224	  3236	  3241	  3277	  3290
	  3299	  3305	  3306	  3317	  3318	  3319	  3330	  3337	  3338	  3340	  3341	  3353	  3362	  3365
	  3373	  3391	  3393	  3412	  3413	  3415	  3416	  3419	  3430	  3449	  3452	  3481	  3484	  3487
	  3489	  3491	  3492	  3496	  3497	  3498	  3526	  3531	  3534	  3537	  3540	  3549	  3559	  3560
	  3566	  3588	  3591	  3592	  3598
P1	   334	   337	   875	   876	   909	   948	   949	  1108	  1109	  1122	  1142	  1159	  1176	  1193
	  1213	  1230	  1253	  1275	  1297	  1319	  1677	  1678	  1679	  1680	  1685	  1686	  1872	  1873
	  1874	  1875	  1880	  1883	  1888	  1889	  1891	  1893	  1986	  1987	  1988	  1989	  1990	  2003
	  2265	  2266	  2268	  2269	  2271	  2272	  2273	  2685	  2701	  2714	  2715	  2716	  2717	  2718
	  2719	  2720	  2721	  2722	  2769	  2774	  2775	  2822	  2823	  2824	  2825	  2826	  2827	  2830
	  2832	  3199	  3200	  3201	  3202	  3203	  3205	  3208
P2	   331	   341	  1457	  1459	  1876	  1877	  1878	  1881	  1882	  1884	  1885	  1886	  1999	  2000
	  2001	  2004	  2061	  2269	  2270	  2271	  2272	  2273	  2692	  2693	  2694	  2695	  2696	  2697
	  2699	  2701	  2702	  2704	  2705	  2715	  2717	  2727	  2729	  2731	  2734	  2735
P3	   894	   898	   950	   962	  1053	  1056	  1067	  1070	  1091	  1114	  1118	  1870	  1871	  2003
	  2008	  2009	  2011	  2012	  2027	  2028	  2064	  2066	  2580	  2594	  2686	  2687	  2688	  2689
	  2690	  2696	  2697	  2699	  2700	  2702	  2703
P4	   991	   992	  1059	  1061	  1064	  2373	  2386	  2387	  2503	  2516	  2517	  2518	  2520	  2573
	  2574	  2575	  2576	  2680	  2713	  2714	  2716	  3189	  3193	  3194	  3201	  3210	  3211	  3212
	  3214	  3215	  3217	  3220	  3223
PC.UIO	   212	  2414
PC.USR	   881	  1000	  1111
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

PDNMUP	    27%	   467	   468	   469	   879	   999	  1110
PDVCNT	  3380%	  3395	  3407	  3409
PDVTIM	  3380%	  3390
PEVEN8	  3299#
PG	  2440	  2441	  2442	  2443	  2460	  2480
PGPDIO	    25%	  2448
PGUSI	   106	  1516#
PGUSO	   107	  1530#
PGYDIO	    25%	  2444	  2449	  2462	  2465	  2482	  2485
PHONLY	   482	  3094
PIOMOD	   193%	   217	   242	  1504	  1553	  1659	  2000	  2133
PJOBN	    27%	  2411	  2892	  3056	  3062	  3074	  3101	  3331
PTRWT	  2047	  2064#
PTRXF1	  2002	  2008#
PTRXF2	  2016	  2019#
PTRXF3	  2025	  2043#
PTRXF4	  2020#	  2029
PTRXF5	  2044	  2059#
PTRXF6	  2046	  2050#
PTRXF7	  2023#	  2048	  2058
PTRXF8	  2041	  2060#
PTRXF9	  2034	  2040#
PUUOAC	    26%	   416	   899	   917	  3328
PX.MEM	    67	   251	   255	   274	   278	   282	   293	   295	   296	   327	   336	   339	   345	   347
	   348	   381	   417	   439	   478	   515	   525	   528	   532	   538	   562	   566	   570	   675
	   885	   900	   907	   918	   953	   960	   963	   989	   997	   998	  1079	  1092	  1119	  1128
	  1212	  1251	  1252	  1273	  1274	  1295	  1296	  1317	  1318	  1393	  1437	  1450	  1463	  1476
	  1497	  1516	  1530	  1546	  1560	  1563	  1578	  1581	  1585	  1633	  1636	  1639	  1667	  1673
	  1676	  1678	  1684	  1689	  1691	  1695	  1696	  1700	  1702	  1705	  1707	  1709	  1716	  1722
	  1730	  1736	  1743	  1751	  1803	  1889	  1890	  1898	  1899	  1901	  1918	  1919	  1928	  1929
	  1936	  1938	  1983	  1985	  2003	  2011	  2012	  2027	  2037	  2141	  2144	  2146	  2153	  2155
	  2156	  2158	  2171	  2172	  2180	  2181	  2182	  2191	  2192	  2203	  2206	  2210	  2211	  2241
	  2244	  2324	  2336	  2377	  2385	  2399	  2428	  2429	  2440	  2472	  2473	  2507	  2515	  2518
	  2531	  2581	  2605	  2613	  2628	  2842	  2844	  2866	  2874	  2919	  3001	  3004	  3008	  3028
	  3030	  3032	  3191	  3205	  3211	  3214	  3217	  3219	  3237	  3244	  3246	  3259	  3265	  3363
	  3366	  3445	  3446	  3447	  3448	  3451	  3474
PX.SRC	  2211	  3246	  3448	  3474
RELE4A	  2870	  2875#
RELE5A	  2864	  2868#
RELEA4	  2869#	  2876
RELEA5	  2859#	  3352
RELEA6	  2885#
RELEA7	  2884#
RELEA9	  2880	  2883#
RELEAS	    55	    94	   476	  2851#	  3309
RELEAX	  2850#
REPLER	  1037	  1076#
REPRL0	  1004	  1088#
REPRLS	  1043#	  1080
REPRLU	  1055	  1087#
REPRLX	  1063	  1073	  1086#
REPRS1	  1046#
S	   121	   237	   238	   260	   269	   281	   503	   505	   506	   543	   544	   591	   592	   610
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

	   630	  1524	  1537	  1565	  1566	  1575	  1584	  1640	  1651	  1654	  1664	  1670	  1682	  1687	  1693
	  1718	  1723	  1724	  1725	  1731	  1762	  1763	  1774	  1838	  1841	  1842	  1855	  1910	  1912
	  1931	  1932	  1943	  2017	  2033	  2039	  2040	  2043	  2045	  2059	  2130	  2136	  2137	  2147
	  2152	  2159	  2160	  2164	  2165	  2185	  2220	  2221	  2249	  2281	  2293	  2308	  2310	  2311
	  2349	  2397	  2427	  2509	  2510	  2529	  2545	  2548	  2549	  2577	  2578	  2610	  2626	  2658
	  2860	  2861	  2943	  2945	  2951	  2952	  2953	  2954	  2979	  2980	  3001	  3028	  3037	  3327
	  3382	  3383	  3386	  3387	  3388	  3389	  3399	  3400	  3429	  3524	  3525	  3584	  3586	  3589
	  3595
S$ENTR	    11	    17	   520	  1023	  1028	  1812	  1813	  1833	  1834	  2464	  2484	  3105	  3153
S$HALT	    11	   520	  1023	  1028	  1812	  1813	  1833	  1834	  2464	  2484	  3105	  3153
S$NAME	    15#	   520	  1023	  1028	  1812	  1813	  1833	  1834	  2464	  2484	  3153
S$NONA	    14	    17	   520	  1023	  1028	  1812	  1813	  1833	  1834	  2464	  2484	  3106	  3153
S$TEMP	    11#	    11	   520#	   520	  1023#	  1023	  1028#	  1028	  1812#	  1812	  1813#	  1813	  1833#	  1833
	  1834#	  1834	  2464#	  2464	  2484#	  2484	  3105#	  3105	  3153#	  3153
S$XCT	    17	   520	  1023	  1028	  1812	  1813	  1833	  1834	  2464	  2484	  3105	  3106	  3153
SD	   218	   243	  1505	  1554	  1660	  2134
SETACT	  3386#
SETBYT	   567	  3584#
SETDDB	  3052%	  3052
SETHNG	  3384	  3390#
SETIO2	   495	   639	  3534#
SETIOD	  3526%	  3526
SETIOS	    51	   101	  3530#
SETMOD	   637#
SETNEW	  1631	  1635#
SETUSR	  3354	  3362#
SIMBIN	  1810	  1819%
SIMBOU	  1819%	  1831
SIMDMP	  1814	  1819%	  1835
SRDUPX	   986%
STCLTB	  2941	  2951#
STDRNG	  1602#	  1756	  2199	  3198
STOIOS	  3389#
SWRUPX	   895	   986%	  1105%	  1115
SYSDEV	  3145
T1	    67	    68	    73	    74	    76	    77	    78	    79	    80	    81	    82	    83	    86	   124
	   131	   139	   148	   195	   217	   218	   220	   225	   229	   232	   242	   243	   254	   255
	   257	   258	   292	   293	   294	   295	   302	   303	   304	   309	   310	   319	   320	   329
	   339	   345	   346	   347	   371	   378	   381	   387	   396	   439	   466	   471	   478	   488
	   490	   499	   500	   501	   502	   510	   511	   512	   515	   526	   528	   532	   533	   538
	   539	   552	   568	   570	   579	   580	   584	   586	   589	   590	   602	   607	   624	   638
	   641	   642	   643	   647	   649	   653	   655	   659	   661	   665	   667	   671	   675	   695
	   696	   697	   700	   724	   739	   758	   776	   795	   813	   834	   849	   876	   877	   884
	   885	   890	   891	   896	   897	   898	   900	   918	   934	   953	   954	   960	   961	   962
	   963	   989	   997	   998	  1018	  1019	  1032	  1034	  1054	  1062	  1072	  1079	  1089	  1090
	  1091	  1092	  1112	  1113	  1116	  1117	  1118	  1119	  1128	  1143	  1212	  1251	  1252	  1273
	  1274	  1295	  1296	  1317	  1318	  1327	  1336	  1344	  1386	  1390	  1391	  1394	  1413	  1423
	  1433	  1435	  1447	  1448	  1471	  1474	  1475	  1476	  1499	  1504	  1505	  1510	  1518	  1532
	  1548	  1553	  1554	  1562	  1563	  1593	  1632	  1633	  1634	  1639	  1645	  1651	  1659	  1660
	  1663	  1673	  1676	  1684	  1689	  1691	  1695	  1696	  1708	  1709	  1713	  1714	  1721	  1722
	  1733	  1734	  1742	  1743	  1746	  1748	  1750	  1751	  1752	  1753	  1764	  1765	  1777	  1778
	  1782	  1783	  1789	  1790	  1794	  1795	  1843	  1844	  1857	  1858	  1859	  1861	  1862	  1863
	  1864	  1865	  1867	  1872	  1882	  1883	  1884	  1885	  1886	  1887	  1889	  1890	  1895	  1898
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

	  1899	  1900	  1901	  1907	  1917	  1918	  1919	  1921	  1935	  1936	  1938	  1942	  1949	  1950	  1951
	  1954	  1957	  1958	  1961	  1962	  1971	  1972	  1973	  1974	  2008	  2010	  2020	  2021	  2022
	  2024	  2026	  2031	  2032	  2038	  2051	  2057	  2117	  2133	  2134	  2146	  2148	  2149	  2150
	  2151	  2153	  2154	  2155	  2156	  2157	  2158	  2167	  2168	  2174	  2175	  2187	  2188	  2202
	  2203	  2204	  2206	  2222	  2223	  2243	  2244	  2251	  2252	  2253	  2254	  2255	  2259	  2260
	  2261	  2264	  2270	  2274	  2283	  2284	  2285	  2290	  2291	  2295	  2296	  2297	  2306	  2315
	  2316	  2317	  2318	  2320	  2321	  2322	  2324	  2329	  2330	  2336	  2337	  2338	  2339	  2356
	  2371	  2377	  2384	  2385	  2387	  2388	  2389	  2391	  2392	  2393	  2399	  2431	  2432	  2444
	  2445	  2448	  2449	  2454	  2455	  2457	  2458	  2467	  2474	  2475	  2477	  2478	  2487	  2501
	  2507	  2514	  2515	  2517	  2519	  2520	  2521	  2523	  2524	  2525	  2531	  2571	  2583	  2584
	  2590	  2591	  2592	  2595	  2603	  2606	  2607	  2612	  2613	  2614	  2616	  2629	  2630	  2636
	  2637	  2638	  2681	  2686	  2691	  2692	  2694	  2703	  2704	  2705	  2706	  2719	  2721	  2722
	  2749	  2750	  2770	  2778	  2781	  2785	  2802	  2803	  2824	  2825	  2826	  2828	  2829	  2830
	  2831	  2851	  2868	  2869	  2872	  2874	  2876	  2877	  2883	  2908	  2919	  2932	  2936	  2940
	  2941	  2947	  2948	  2951	  2952	  2953	  2954	  2959	  2965	  2972	  2977	  2978	  3003	  3004
	  3007	  3008	  3029	  3030	  3031	  3032	  3035	  3056	  3057	  3059	  3060	  3062	  3063	  3064
	  3065	  3067	  3069	  3070	  3072	  3073	  3099	  3103	  3121	  3122	  3124	  3129	  3136	  3137
	  3140	  3142	  3148	  3149	  3155	  3190	  3194	  3195	  3199	  3210	  3216	  3218	  3236	  3237
	  3239	  3240	  3246	  3259	  3260	  3262	  3263	  3265	  3267	  3269	  3270	  3272	  3273	  3274
	  3275	  3286	  3287	  3289	  3299	  3300	  3301	  3302	  3303	  3304	  3305	  3309	  3317	  3331
	  3332	  3347	  3352	  3363	  3366	  3368	  3369	  3371	  3390	  3391	  3392	  3393	  3394	  3395
	  3407	  3408	  3409	  3410	  3444	  3445	  3478	  3479	  3480	  3486	  3488	  3490	  3492	  3493
	  3494	  3495	  3530	  3546	  3547	  3548	  3558	  3561	  3562	  3563	  3564	  3565	  3585	  3587
	  3590	  3592	  3593	  3594	  3596	  3597	  3598
T2	   262	   263	   273	   274	   278	   324	   325	   326	   327	   328	   340	   416	   417	   491
	   533	   534	   535	   539	   540	   541	   560	   562	   563	   564	   565	   566	   569	   570
	   651	   652	   653	   654	   657	   658	   659	   660	   663	   664	   665	   666	   669	   670
	   671	   672	   884	   886	   887	   902	   904	   905	   907	   917	   918	   989	   990	  1033
	  1035	  1110	  1111	  1251	  1273	  1295	  1317	  1420	  1421	  1434	  1436	  1437	  1438	  1439
	  1444	  1445	  1447	  1469	  1470	  1471	  1472	  1473	  1474	  1475	  1568	  1569	  1577	  1578
	  1581	  1630	  1633	  1637	  1638	  1667	  1669	  1671	  1673	  1700	  1702	  1705	  1707	  1716
	  1730	  1736	  1738	  1803	  1861	  1865	  1870	  1890	  1892	  1893	  1897	  1898	  1906	  1907
	  1926	  1927	  1928	  1929	  1934	  1936	  1937	  1938	  1951	  1952	  1954	  1955	  1956	  1957
	  1958	  1960	  1970	  1972	  1974	  2010	  2011	  2014	  2015	  2018	  2029	  2030	  2036	  2037
	  2038	  2052	  2056	  2141	  2143	  2144	  2150	  2153	  2155	  2161	  2162	  2171	  2172	  2173
	  2180	  2182	  2191	  2192	  2198	  2209	  2210	  2211	  2262	  2263	  2277	  2284	  2285	  2296
	  2297	  2307	  2323	  2324	  2329	  2336	  2338	  2355	  2380	  2381	  2406	  2412	  2413	  2415
	  2416	  2417	  2418	  2420	  2425	  2451	  2452	  2455	  2473	  2475	  2538	  2604	  2628	  2629
	  2636	  2637	  2678	  2679	  2691	  2700	  2707	  2723	  2724	  2730	  2735	  2736	  2737	  2741
	  2742	  2743	  2744	  2747	  2748	  2752	  2761	  2762	  2768	  2769	  2775	  2776	  2777	  2778
	  2779	  2782	  2786	  2788	  2795	  2804	  2806	  2809	  2810	  2827	  2828	  2831	  2845	  2846
	  2847	  2869	  2871	  2875	  2884	  2885	  2886	  2887	  2889	  2892	  2895	  2897	  2999	  3000
	  3001	  3004	  3026	  3027	  3028	  3030	  3032	  3034	  3035	  3049	  3050	  3054	  3068	  3075
	  3093	  3094	  3101	  3102	  3144	  3145	  3147	  3161	  3196	  3197	  3198	  3200	  3213	  3237
	  3238	  3239	  3241	  3242	  3243	  3244	  3245	  3246	  3258	  3259	  3261	  3262	  3265	  3266
	  3268	  3269	  3271	  3272	  3276	  3286	  3287	  3288	  3289	  3446	  3448	  3476	  3479	  3488
	  3489	  3490	  3491	  3494	  3545	  3547
T3	   274	   276	   280	   282	   879	   881	   882	   883	   891	   999	  1000	  1393	  1394	  1395
	  1396	  1398	  1399	  1400	  1417	  1421	  1457	  1459	  1461	  1462	  1463	  1488	  1489	  1578
	  1579	  1583	  1585	  1871	  1875	  1880	  1950	  1952	  1956	  1960	  1961	  1969	  1970	  1971
	  1973	  1981	  1983	  1985	  1989	  2012	  2013	  2015	  2018	  2019	  2021	  2022	  2023	  2032
	  2053	  2055	  2262	  2263	  2264	  2313	  2376	  2377	  2385	  2393	  2396	  2399	  2401	  2402
	  2405	  2416	  2426	  2428	  2429	  2431	  2438	  2440	  2442	  2450	  2451	  2457	  2459	  2460
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

	  2477	  2479	  2480	  2506	  2507	  2515	  2518	  2525	  2528	  2531	  2533	  2534	  2537	  2550	  2581
	  2590	  2605	  2606	  2657	  2659	  2660	  2681	  2682	  2683	  2724	  2725	  2726	  2727	  2729
	  2771	  2780	  2784	  2793	  2794	  2799	  2802	  2841	  2842	  2844	  2847	  3097	  3098	  3104
	  3109	  3138	  3139	  3141	  3152	  3154	  3162	  3300	  3304
T4	   123	   124	   135	   143	   223	   226	   235	   245	   246	   265	   266	   278	   279	   280
	   282	   283	   286	   287	   288	   289	   584	   594	   612	   613	   623	   626	   875	  1068
	  1069	  1331	  1340	  1348	  1417	  1418	  1419	  1424	  1426	  1446	  1449	  1450	  1458	  1460
	  1489	  1490	  1513	  1571	  1572	  1592	  1597	  1767	  1768	  1846	  1847	  1869	  1873	  1874
	  1914	  1915	  1982	  1985	  1988	  2023	  2024	  2026	  2027	  2050	  2054	  2129	  2177	  2178
	  2225	  2226	  2257	  2260	  2261	  2287	  2288	  2299	  2300	  2382	  2383	  2462	  2463	  2465
	  2482	  2483	  2485	  2512	  2513	  2599	  2600	  2656	  2657	  2659	  2738	  2795	  2796	  2797
	  2798	  2799	  2801	  2803	  2805	  2806	  2840	  2844	  2846	  2858	  2859	  2890	  2891	  3329
	  3411	  3413
TIN	    50	   100	  2959#
TOUT	    50	   100	  2972#
TPOPJ	   415	   464%	   553	  3343	  3396	  3599
TPOPJ1	   464%	   550
TST1UN	   549%	   549
TSTDSK	  3134%	  3134
TSTKTJ	    30%	  1922
TTYATC	  2887
TTYFND	   637	  3158%	  3158
TTYUUO	    37%	    46
U	   250	   251	   291	   293	   295	   296	   327	   328	   330	   336	   337	   339	   340	   344
	   345	   347	   348	  1040	  1078	  1079	  1088	  1092	  1559	  1560	  1581	  1582	  1583	  1585
	  1586	  1636	  1639	  1662	  1667	  1676	  1678	  1684	  1695	  1700	  1709	  1722	  1729	  1730
	  1743	  1751	  1803	  1840	  1848	  1916	  1928	  2140	  2141	  2146	  2156	  2158	  2170	  2171
	  2179	  2180	  2181	  2190	  2191	  2201	  2203	  2206	  2210	  2240	  2241	  2244	  2862	  2870
	  2871	  3157	  3159	  3443	  3445	  3446	  3447	  3448	  3450	  3451
UCALL	    37%	    42
UCALLI	    37%	    45
UCBADD	  1159#
UCBHNG	  1317#
UCBINI	  1212#
UCBINW	  1193#
UCBLEV	  1176#
UCBMEM	  1251#
UCBRLI	  1230#
UCBSTS	  1273#
UCBWAK	  1295#
UCLS0	   335#	   341
UCLS1	   330	   338	   344#
UCLS2	   216	   224	   231	   237#
UCLS2A	   253#	   270
UCLS2B	   256	   273#
UCLS2C	   264	   267#
UCLS2D	   275	   283	   286#
UCLS3	   241	   247	   302#	   322
UCLS3C	   277	   284#
UCLS4	   228	   232#
UCLS5	   220#	   230
UCLS6	   249	   252	   319#
UCLS7	   245#	   321
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

UCLSBI	   219	   225#
UCLSBO	   244	   248#
UDEN	    59	    96	   580#
UDGF	    57	    98	  1336#
UDLK	    59	    96	   602#
UDLKC	   588	   609	   622#
UDSI	    58	    97	  1498#
UDSI1	  1507	  1510#
UDSIP	  1499#	  1517
UDSIP0	  1503#	  1526	  1528
UDSO	    58	    97	  1547#
UDSO1	  1586	  1592#
UDSO2	  1562#	  1576
UDSO2C	  1570	  1574#
UDSO3	  1564	  1577#
UDSO3A	  1580	  1587#
UDSO4	  1556	  1558	  1561	  1593#
UDSOP	  1531	  1548#
UDSOP0	  1539	  1541	  1552#
UFDRD	   107	   131#
UINBF	    53	   103	   387#	  1757
UINIC1	   522	   526#
UINIT	    42	   466#
UINIT0	   440	   470#
UINIT1	   490#
UINIT4	   534	   538#
UINIT5	   540	   546#
UINITA	   475	   477#
UINITC	   509	   518#
UINITE	   486	   493	   552#
UINITL	   508#	   513	   516
UINITZ	   537	   545	   560#
ULDUPX	   982%	  1045	  1086
UMTAPE	    57	    99	  1344#
UNIUPT	   982%	  1087
UNWUPT	   982%	  1048
UOBF1	   381#	   397
UOPEN	    46	   422	   425	   439#
UOUT	    54	    95	  2117#
UOUT1	  2121	  2124#	  2976
UOUTBF	    53	   103	   371#	  2200
UPTACP	    23%	  2421
UPTENB	  3367%	  3367
UPTHCU	    23%	   117	   423	   424	   473	   508	   510	   526	  2868	  2872	  3372
UPTJDA	    23%	   119	   308	   384	   402	   411	   472	   511	   518	   546	   618	   631	   893	  1658
	  2132	  2862	  2869	  3325	  3368	  3369	  3370	  3371
UPTJOB	   982%	  1005	  1018
UPTOFD	   983%	   991
UPTSIM	   519	  1820%
URENAM	    48	    98	  1327#
USDEN	   110	   579#
USTATO	    51	   102	  2907#
USTATS	    52	   101	  2918#
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

USTATZ	    52	   102	  2931#
UUOMNR	    37%	    44	    45	    47	    48
UUOSK1	   104	   139#
UUOTAB	    42#
UUYCPR	   696#
UUYCTG	   695#
UUYSVM	   697#
VCLEAU	  1108#
VFLCKU	  1142#
VMAPUU	   108	   700#
VMOVPG	   113	   739#
VREMOU	  1109#
VREMV2	  1110#
VREP3A	  1058	  1065#
VREPL1	  1006	  1010#
VREPL2	  1009	  1012	  1014#
VREPL4	  1029	  1032#
VREPL5	  1013	  1025	  1030#
VREPL6	  1016	  1018#
VREPL7	  1017	  1027#
VREPLU	   988#
VREPLX	  1026	  1030	  1052#
VSMAPU	   111	   724#
W	    67	    68	    69	    71	    85	    89	   117	   119	   308	   376	   379	   381	   383	   384
	   392	   394	   402	   408	   410	   411	   413	   414	   417	   423	   424	   472	   473	   482
	   507	   508	   518	   519	   521	   525	   546	   585	   606	   617	   618	   631	   634	   641
	   893	   956	   963	   996	   998	  1001	  1002	  1007	  1010	  1014	  1032	  1039	  1043	  1046
	  1057	  1068	  1077	  1090	  1658	  2132	  2862	  2863	  2866	  3093	  3124	  3129	  3191	  3192
	  3193	  3211	  3212	  3216	  3217	  3218	  3219	  3220	  3222	  3318	  3323	  3325	  3328	  3330
	  3338	  3339	  3341
WAIT	   104	   148#
WAIT1	    26%	   152	   268	   285	   297	   628	   648	  1573	  1590	  1629	  1747	  1769	  1776	  1781
	  2227	  2239	  2661	  2857	  3347	  3534
WAITI	  1776#	  2131
WAITIO	   213	  1503	  1552	  1774#
WAITO	  1655	  1775	  1781#
WCLA	  1783	  1792#
WCLAI	  1778	  1787#
WLKUPT	   982%	  1021	  1027
WLKUPX	   983%	  1052
WPOPJ	   595	   614	   634#
WSYNC	    26%	  1704	  1761	  1924	  2065	  2184	  2219	  2292
XREPLU	   935	   996#
ZZ	    67#	    67	   251#	   251	   255#	   255	   274#	   274	   278#	   278	   282#	   282	   293#	   293
	   295#	   295	   296#	   296	   327#	   327	   336#	   336	   339#	   339	   345#	   345	   347#	   347
	   348#	   348	   381#	   381	   417#	   417	   439#	   439	   478#	   478	   515#	   515	   525#	   525
	   528#	   528	   532#	   532	   538#	   538	   562#	   562	   566#	   566	   570#	   570	   675#	   675
	   885#	   885	   900#	   900	   907#	   907	   918#	   918	   953#	   953	   960#	   960	   963#	   963
	   989#	   989	   997#	   997	   998#	   998	  1079#	  1079	  1092#	  1092	  1119#	  1119	  1128#	  1128
	  1212#	  1212	  1251#	  1251	  1252#	  1252	  1273#	  1273	  1274#	  1274	  1295#	  1295	  1296#	  1296
	  1317#	  1317	  1318#	  1318	  1393#	  1393	  1437#	  1437	  1450#	  1450	  1463#	  1463	  1476#	  1476
	  1497#	  1497	  1516#	  1516	  1530#	  1530	  1546#	  1546	  1560#	  1560	  1563#	  1563	  1578#	  1578
	  1581#	  1581	  1585#	  1585	  1633#	  1633	  1636#	  1636	  1639#	  1639	  1667#	  1667	  1673#	  1673
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Symbol cross reference

	  1676#	  1676	  1678#	  1678	  1684#	  1684	  1689#	  1689	  1691#	  1691	  1695#	  1695	  1696#	  1696	  1700#
	  1700	  1702#	  1702	  1705#	  1705	  1707#	  1707	  1709#	  1709	  1716#	  1716	  1722#	  1722	  1730#
	  1730	  1736#	  1736	  1743#	  1743	  1751#	  1751	  1803#	  1803	  1889#	  1889	  1890#	  1890	  1898#
	  1898	  1899#	  1899	  1901#	  1901	  1918#	  1918	  1919#	  1919	  1928#	  1928	  1929#	  1929	  1936#
	  1936	  1938#	  1938	  1983#	  1983	  1985#	  1985	  2003#	  2003	  2011#	  2011	  2012#	  2012	  2027#
	  2027	  2037#	  2037	  2141#	  2141	  2144#	  2144	  2146#	  2146	  2153#	  2153	  2155#	  2155	  2156#
	  2156	  2158#	  2158	  2171#	  2171	  2172#	  2172	  2180#	  2180	  2181#	  2181	  2182#	  2182	  2191#
	  2191	  2192#	  2192	  2203#	  2203	  2206#	  2206	  2210#	  2210	  2211#	  2211	  2241#	  2241	  2244#
	  2244	  2324#	  2324	  2336#	  2336	  2377#	  2377	  2385#	  2385	  2399#	  2399	  2428#	  2428	  2429#
	  2429	  2440#	  2440	  2472#	  2472	  2473#	  2473	  2507#	  2507	  2515#	  2515	  2518#	  2518	  2531#
	  2531	  2581#	  2581	  2605#	  2605	  2613#	  2613	  2628#	  2628	  2842#	  2842	  2844#	  2844	  2866#
	  2866	  2874#	  2874	  2919#	  2919	  3001#	  3001	  3004#	  3004	  3008#	  3008	  3028#	  3028	  3030#
	  3030	  3032#	  3032	  3191#	  3191	  3205#	  3205	  3211#	  3211	  3214#	  3214	  3217#	  3217	  3219#
	  3219	  3237#	  3237	  3244#	  3244	  3246#	  3246	  3259#	  3259	  3265#	  3265	  3363#	  3363	  3366#
	  3366	  3445#	  3445	  3446#	  3446	  3447#	  3447	  3448#	  3448	  3451#	  3451	  3474#	  3474
ZZ1	    67#	    67	   251#	   251	   255#	   255	   274#	   274	   278#	   278	   282#	   282	   293#	   293
	   295#	   295	   296#	   296	   327#	   327	   336#	   336	   339#	   339	   345#	   345	   347#	   347
	   348#	   348	   381#	   381	   417#	   417	   439#	   439	   478#	   478	   515#	   515	   525#	   525
	   528#	   528	   532#	   532	   538#	   538	   562#	   562	   566#	   566	   570#	   570	   675#	   675
	   885#	   885	   900#	   900	   907#	   907	   918#	   918	   953#	   953	   960#	   960	   963#	   963
	   989#	   989	   997#	   997	   998#	   998	  1079#	  1079	  1092#	  1092	  1119#	  1119	  1128#	  1128
	  1212#	  1212	  1251#	  1251	  1252#	  1252	  1273#	  1273	  1274#	  1274	  1295#	  1295	  1296#	  1296
	  1317#	  1317	  1318#	  1318	  1393#	  1393	  1437#	  1437	  1450#	  1450	  1463#	  1463	  1476#	  1476
	  1497#	  1497	  1516#	  1516	  1530#	  1530	  1546#	  1546	  1560#	  1560	  1563#	  1563	  1578#	  1578
	  1581#	  1581	  1585#	  1585	  1633#	  1633	  1636#	  1636	  1639#	  1639	  1667#	  1667	  1673#	  1673
	  1676#	  1676	  1678#	  1678	  1684#	  1684	  1689#	  1689	  1691#	  1691	  1695#	  1695	  1696#	  1696
	  1700#	  1700	  1702#	  1702	  1705#	  1705	  1707#	  1707	  1709#	  1709	  1716#	  1716	  1722#	  1722
	  1730#	  1730	  1736#	  1736	  1743#	  1743	  1751#	  1751	  1803#	  1803	  1889#	  1889	  1890#	  1890
	  1898#	  1898	  1899#	  1899	  1901#	  1901	  1918#	  1918	  1919#	  1919	  1928#	  1928	  1929#	  1929
	  1936#	  1936	  1938#	  1938	  1983#	  1983	  1985#	  1985	  2003#	  2003	  2011#	  2011	  2012#	  2012
	  2027#	  2027	  2037#	  2037	  2141#	  2141	  2144#	  2144	  2146#	  2146	  2153#	  2153	  2155#	  2155
	  2156#	  2156	  2158#	  2158	  2171#	  2171	  2172#	  2172	  2180#	  2180	  2181#	  2181	  2182#	  2182
	  2191#	  2191	  2192#	  2192	  2203#	  2203	  2206#	  2206	  2210#	  2210	  2211#	  2211	  2241#	  2241
	  2244#	  2244	  2324#	  2324	  2336#	  2336	  2377#	  2377	  2385#	  2385	  2399#	  2399	  2428#	  2428
	  2429#	  2429	  2440#	  2440	  2472#	  2472	  2473#	  2473	  2507#	  2507	  2515#	  2515	  2518#	  2518
	  2531#	  2531	  2581#	  2581	  2605#	  2605	  2613#	  2613	  2628#	  2628	  2842#	  2842	  2844#	  2844
	  2866#	  2866	  2874#	  2874	  2919#	  2919	  3001#	  3001	  3004#	  3004	  3008#	  3008	  3028#	  3028
	  3030#	  3030	  3032#	  3032	  3191#	  3191	  3205#	  3205	  3211#	  3211	  3214#	  3214	  3217#	  3217
	  3219#	  3219	  3237#	  3237	  3244#	  3244	  3246#	  3246	  3259#	  3259	  3265#	  3265	  3363#	  3363
	  3366#	  3366	  3445#	  3445	  3446#	  3446	  3447#	  3447	  3448#	  3448	  3451#	  3451	  3474#	  3474
%UPT	    23%	   117	   119	   308	   384	   402	   411	   423	   424	   472	   473	   508	   510	   511
	   518	   519	   526	   546	   618	   631	   893	   991	  1005	  1018	  1658	  2132	  2421	  2862
	  2868	  2869	  2872	  3325	  3367	  3368	  3369	  3370	  3371	  3372
.ARCHM	   894	   950	  1056	  1114
.ARVAR	  1070
.ARVAW	  1067
.FDSLF	   992
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Macro/Opdef cross reference

CORE	  3208
CSHREF	  2330	  2339	  2432	  2584	  2630	  2638
CSHUNL	  2370	  2570
CSHVAL	  2500
FDEERP	   898	   962	  1091	  1118
IFCPU	  2325	  2346	  2370	  2430	  2496	  2500	  2569	  2582	  2619	  2620	  2647	  3402
IFNCPU	  2421	  2441
NOSCHE	  3055
PFALL	  2880	  3310	  3354
PJRST	   957	  1048	  1331	  2288	  2807	  3123	  3527
PRINTF	  3133
PXCT	    67	   251	   255	   274	   278	   282	   293	   295	   296	   327	   336	   339	   345	   347
	   348	   381	   417	   439	   478	   515	   525	   528	   532	   538	   562	   566	   570	   675
	   885	   900	   907	   918	   953	   960	   963	   989	   997	   998	  1079	  1092	  1119	  1128
	  1212	  1251	  1252	  1273	  1274	  1295	  1296	  1317	  1318	  1393	  1437	  1450	  1463	  1476
	  1497	  1516	  1530	  1546	  1560	  1563	  1578	  1581	  1585	  1633	  1636	  1639	  1667	  1673
	  1676	  1678	  1684	  1689	  1691	  1695	  1696	  1700	  1702	  1705	  1707	  1709	  1716	  1722
	  1730	  1736	  1743	  1751	  1803	  1889	  1890	  1898	  1899	  1901	  1918	  1919	  1928	  1929
	  1936	  1938	  1983	  1985	  2003	  2011	  2012	  2027	  2037	  2141	  2144	  2146	  2153	  2155
	  2156	  2158	  2171	  2172	  2180	  2181	  2182	  2191	  2192	  2203	  2206	  2210	  2211	  2241
	  2244	  2324	  2336	  2377	  2385	  2399	  2428	  2429	  2440	  2472	  2473	  2507	  2515	  2518
	  2531	  2581	  2605	  2613	  2628	  2842	  2844	  2866	  2874	  2919	  3001	  3004	  3008	  3028
	  3030	  3032	  3191	  3205	  3211	  3214	  3217	  3219	  3237	  3244	  3246	  3259	  3265	  3363
	  3366	  3445	  3446	  3447	  3448	  3451	  3474
PXGEN	    67	   251	   255	   274	   278	   282	   293	   295	   296	   327	   336	   339	   345	   347
	   348	   381	   417	   439	   478	   515	   525	   528	   532	   538	   562	   566	   570	   675
	   885	   900	   907	   918	   953	   960	   963	   989	   997	   998	  1079	  1092	  1119	  1128
	  1212	  1251	  1252	  1273	  1274	  1295	  1296	  1317	  1318	  1393	  1437	  1450	  1463	  1476
	  1497	  1516	  1530	  1546	  1560	  1563	  1578	  1581	  1585	  1633	  1636	  1639	  1667	  1673
	  1676	  1678	  1684	  1689	  1691	  1695	  1696	  1700	  1702	  1705	  1707	  1709	  1716	  1722
	  1730	  1736	  1743	  1751	  1803	  1889	  1890	  1898	  1899	  1901	  1918	  1919	  1928	  1929
	  1936	  1938	  1983	  1985	  2003	  2011	  2012	  2027	  2037	  2141	  2144	  2146	  2153	  2155
	  2156	  2158	  2171	  2172	  2180	  2181	  2182	  2191	  2192	  2203	  2206	  2210	  2211	  2241
	  2244	  2324	  2336	  2377	  2385	  2399	  2428	  2429	  2440	  2472	  2473	  2507	  2515	  2518
	  2531	  2581	  2605	  2613	  2628	  2842	  2844	  2866	  2874	  2919	  3001	  3004	  3008	  3028
	  3030	  3032	  3191	  3205	  3211	  3214	  3217	  3219	  3237	  3244	  3246	  3259	  3265	  3363
	  3366	  3445	  3446	  3447	  3448	  3451	  3474
SCHEDU	  3077
STOPCD	    10	   520	  1023	  1028	  1812	  1813	  1833	  1834	  2464	  2484	  3105	  3153
UMOVE	    67	   439	   478	   532	   538	   675	   885	   907	   953	   989	   997	   998	  1212	  1251
	  1252	  1273	  1274	  1295	  1296	  1317	  1318	  1393	  1516	  1530	  1578	  1667	  1707	  1918
	  2171	  2180	  2191	  2472	  2473	  2581	  2628
UMOVEM	   381	   900	   918	   963	  1079	  1092	  1119	  1128	  1437	  1450	  1463	  1476	  1938	  2027
	  2324	  2919	  3001	  3028	  3211	  3217
UXCTBU	   514	   524	   527	  2865	  2873	  3204	  3362	  3365
WRPI	  2461	  2466	  2481	  2486
WRUBR	  2421
XCTBU	   251	   255	   293	   295	   296	   327	   336	   339	   345	   347	   348	   417	   515	   525
	   528	   562	   566	   570	  1497	  1546	  1560	  1563	  1581	  1585	  1633	  1636	  1639	  1673
	  1676	  1678	  1684	  1689	  1691	  1695	  1696	  1700	  1702	  1705	  1709	  1716	  1722	  1730
	  1736	  1743	  1751	  1803	  1889	  1890	  1898	  1899	  1901	  1919	  1928	  1929	  1936	  1983
	  1985	  2011	  2012	  2037	  2141	  2144	  2146	  2153	  2155	  2156	  2158	  2172	  2181	  2182
	  2192	  2203	  2206	  2210	  2211	  2241	  2244	  2377	  2385	  2399	  2428	  2429	  2440	  2507
IOCSS - IO COMMON SUBROUTINES	MACRO 12.5-46.0 14:38 13-JAN-88
IOCSS.MAC	 9-OCT-87 18:01		Macro/Opdef cross reference

	  2515	  2518	  2531	  2605	  2613	  2842	  2844	  2866	  2874	  3004	  3008	  3030	  3032	  3191	  3205
	  3214	  3219	  3237	  3244	  3246	  3259	  3265	  3363	  3366	  3445	  3446	  3447	  3448	  3451
	  3474
XCTFU	    67	   274	   278	   282	   439	   478	   532	   538	   675	   885	   907	   953	   960	   989
	   997	   998	  1212	  1251	  1252	  1273	  1274	  1295	  1296	  1317	  1318	  1393	  1516	  1530
	  1578	  1667	  1707	  1918	  2171	  2180	  2191	  2336	  2472	  2473	  2581	  2628
XCTTU	   381	   900	   918	   963	  1079	  1092	  1119	  1128	  1437	  1450	  1463	  1476	  1938	  2003
	  2027	  2324	  2919	  3001	  3028	  3211	  3217
XP	    49	    56	  1602
$END	  3601 } rf
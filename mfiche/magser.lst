MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KSSYM.MAC IN COMMON ONLY
     7					.CREF
     8									TAPE>>
     9				; This file is PRINTF.MAC
    10				DEFINE PRINTF(A,B,C,D),<IF2,<;;Output message on MONKS build only
    11				PRINTX A B C D>>
    12
    13				SUBTTL KS-10 PARAMETER DEFINTIONS FOR PDP-10 MONITOR
    14				.XCREF
    15
    16				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSIORG.MAC
    17
    18					IF2,<IFNDEF LISTSN,<		;LIST KSIORG.MAC IN COMMON ONLY
    19					.CREF
    20									TAPE>>
    21				TITLE MAGSER Quick and dirty tape service routine for KS-10 TM02s
    22				SUBTTL This hack written by Daniel S. Blom
    23				; based on FTASER.MAC and TRHKON.MAC.
    24
    25					STOPCD(,ENTRY,MAGSER)^
    26					ENTRY	MAGSER		;For library searches
    27	000000'	260040	000000*	MAGSER::PUSHJ	P,DIE		;**** Default stopcode for "MAGSER" ****
    28	000001'	554147	634562		SIXBIT	/MAGSER/  	;Title of module
    29	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "MAGSER+nnn(nnnnnn)"
    30			000000'	S$NAME==MAGSER			;For STOPCDs with no arguments
    31					SALL>
    32				^
    33
    34				OPDEF CALL [PUSHJ P,]
    35				OPDEF RET [POPJ P,]
    36
    37				;EXTERNALS:
    38
    39				EXTERN TMX0CB,MAGDDS,TU0CB,MTUDBL,PILOW,PIHIGH,TIBTBL,BITTBL
    40				EXTERN MTREQ,MTAVAL,MTWAIT,JBTABT
    41				EXTERN TKBCBA,TKBIUN,TKBCUN
    42				EXTERN DEVUDB,DEVCNT,DEVFNJ,DEVDWC
    43				EXTERN DEVER1,DEVDIO,DEVMD1
    44				EXTERN TUBDDB,UNITYP,TUBHC,TUBKDB,TUYTMN,TUYTUN,TUBIWC,TUBS
    45				EXTERN TUBEC,TUBSB
    46
    47				EXTERN SETHNG,PIOMOD,CPOPJ,CPOPJ1,WAIT1,SETIOD
    48				EXTERN HNGSTP,JBTIOA,PJOBN,SYDNM4,SYDCOM,JBTLIC
    49				EXTERN DSKPIF,DSKPIN,PAGWAK,PGYDIO
    50				EXTERN TUBIFC,TUBCNT,TUBCLS,TUBER1,TUBER2
    51
    52				;Device registers
    53				DEFINE RHREG(REGNAME,OFFSET,BITLST,MSB)
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 1
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

    54				<ZZ==100000
    55				IFNB <MSB>,<ZZ==MSB>
    56				REGNAME'OFS==OFFSET
    57				IRP BITLST,<REGNAME'BITLST==ZZ
    58				ZZ==ZZ/2
    59				>>
    60
    61				EXTIO (CS1,772440,<SC,TRE,MCPE,,DVA,PSEL,A17,A16,RDY,IE,F4,F3,F2,F1,F0,GO>)
    62			000000	CS1OFS==0
    63				    ;FUNCTION CODES + GO BIT.
    64			000007		F.REWI==7
    65			000027		F.WTM==27
    66			000031		F.SKR==31
    67			000033		F.BSR==33
    68			000003		F.RO==3
    69			000025		F.EG==25
    70			000011		F.DC==11
    71			000071		F.RF==71
    72			000061		F.WF==61
    73
    74				RHREG (CS2,10,<DLT,WOE,UPE,NED,NEM,PGE,MXF,MDPE,OR,IR,CLR,PAT,BAI,,,U0>)
    75				RHREG (DS,12,<ATA,ERR,PIP,MOL,WRL,EOT,,DPR,DRY,SSC,PES,SDWN,IOB,TM,BOT,OM>)
    76				RHREG (WC,2)
    77				RHREG (AS,16)
    78				RHREG (ER,14,<COR,UNS,OPI,DTE,NEF,CS,FCE,NSG,PEF,INC,DPA,FMT,CPA,RMR,ILR,ILF>)
    79				RHREG (BA,4)
    80				RHREG (TC,32,<ACC,TCW,FCS,EAO,,,,DE0,,,,FS0,EP,,,SS0>)
    81				RHREG (FC,6)
    82				RHREG (CK,20)
    83
    84				;Unit characteeristics.  Those marked with '*' are also stored in
    85				; Lh(UNITYP) in the UDB of a unit.  The others are only returned
    86				; by the UGETF uuo.
    87			400000	WRPROT==400000	;Write protected (DSWRL on)
    88			040000	LOADPT==40000	;Tape at load point
    89			020000	TAPEIN==20000	;Tape at EOT.
    90			000100	TRK9==100	;* 9 track tape
    91			000010	DS1600==10	;* 1600cpi
    92			000004	DS800==4	;* 800cpi
    93				;Bits in DEVIOS (which is frequently cached in S):
    94			010000	SFDONE==10000	;SF/BSF finished.
    95			020000	HASCTL==20000	;Job using this channel has controller locked.
    96			040000	HNGTAP==40000
    97			001000	IOLEND==1000
    98
    99				;These are the only entry points:
   100				    INTERN MAGINT,MAGDSP,MAGINI,SYDTMX
   101
   102	000003'	777777	740000	    MSKCTD: XWD 777777,740000	;MASK TO CHANGE THE COUNT BYTE
   103								;FROM THE DDB INTO A NUMBER.
   104	000004'	777777	774000	    MSKCTU: XWD 777777,774000	;MASK TO CHANGE THE COUNT BYTE
   105								;FROM UNIT CMD WORD INTO A NUMBER.
   106			777760	    MSKMMD==777760		;MASKS OUT ALL BUT MEM ADDR
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 1-2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   107								;FROM DDB WORDS.
   108			777700	    MSKMMU==777700		;MASKS OUT ALL BUT MEM ADDR
   109								;FROM UNIT CMD WORDS.
   110	000005'	777777	774000	    DATASZ: XWD 777777,774000	;-(2**11).
   111
   112				;The address space available to devices on UBA3 is 64. pages, which may
   113				; be mapped anywhere in KS10 memory through use of the paging RAM.
   114				; The first page of the space has been reserved for the line printer. The
   115				; next 32 pages are reserved for the mag tape driver.The rest of the
   116				; pages are for KMC/PDP10 communication.
   117				EXTERNAL UBATAP,UBACM0		;Start of tape paging RAM area and end
   118			010465	UBAFST==4000*UBATAP
   119	000006'	000000	000000*	MAXXFR: -40000+UBAFST/2		;- <Largest single transfer we can make>
   120
   121				;Noise record sizes.
   122				;These specify the largest record size in frames which
   123				; will be totally ignored by the read circuitry.
   124			000015	NRSPE== ^D13	;PE operation.
   125			000015	NRSNRZ== ^D13	;NRZ operation, see p.3-13, DEC
   126						; publication EK-TJU16-MM-002.
   127
   128
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   129
   130				;Dispatch table used by device independent routines.
   131
   132	777776			 	PHASE -2
   133	000007'	254000	000516'	DDO:	JRST TMXWRT
   134	000010'	254000	000515'	DDI:	JRST TMXRED
   135	000011'				DEPHASE
   136	000000			MAGDSP:	PHASE 0
   137	000011'	000000	000015	DDXZ:	DSPSIZ
   138	000012'	263040	000000	DDINT:	RET
   139	000013'	004400	004400	DBYT:	4400,,4400
   140	000014'	201300	000000*	DVSIZ:	MOVEI T1,MAGDDS
   141	000015'	254000	000027'	DINI:	JRST MAGINI
   142	000016'	254000	000123'	DHNG:	JRST TMXHNG
   143	000017'	254000	000063'	DRL:	JRST TMXREL
   144	000020'	254000	000071'	DCL:	JRST TMXCLS
   145	000021'	254000	000516'	DOU:	JRST TMXWRT
   146	000022'	254000	000515'	DIN:	JRST TMXRED
   147	000023'	263040	000000	DZAP:	RET
   148	000024'	254000	000627'	DGTRD:	JRST TMXGRD
   149	000025'	254000	000364'	DMT:	JRST FTAPE
   150	000026'	254000	000300'	DGF:	JRST TMXUGF
   151			000015		DSPSIZ==.-1
   152	000027'				DEPHASE
   153
   154
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 3
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   155
   156				COMMENT %@@SUBROUTINE MAGINI
   157				Initializion routine for TM02/TU45A magtape system.
   158					(1) Sets Lh(UNITYP) to 0 if the device is off line, or to
   159					    DS800+DS1600 if it is online.
   160
   161				@@DESTROYS T1, T2, T3.
   162				@@CALLED by SYSINI with the PI system off. @@%
   163
   164	000027'	261040	000016	MAGINI:	PUSH P,P3
   165	000030'	261040	000005		PUSH P,U
   166	000031'	201400	000100		MOVEI T3,UBAINI		;Clear UBA.
   167	000032'	713420	001726'		WRIO T3,@[UA3,,UBAADR]
   168	000033'	201400	000000*		MOVEI T3,PIHIGH*10+6	;Set PIA.
   169	000034'	713420	001726'		WRIO T3,@[UA3,,UBAADR]
   170	000035'	201400	000000*		MOVEI T3,TMX0CB		;KDB
   171	000036'	200710	000000*		MOVE P3,TKBCBA(T3)	;Rh11C base address
   172	000037'	200350	000000*		MOVE T2,TKBIUN(T3)	;AOBJN pointer to vector of adrs of UDBs
   173	000040'	200300	000016		MOVE	T1,P3		;UNIBUS address of RH11
   174	000041'	260040	000000*		PUSHJ	P,UBGOOD##	;Does it exist?
   175	000042'	254000	000060'		  JRST	FINOUT		;No!
   176
   177	000043'	200247	000000	TMXIN1:	MOVE U,(T2)		;Here to test another unit.
   178	000044'	135300	000000*		LDB T1,TUYTMN		;Select TM02
   179	000045'	713316	000010		WRIO T1,CS2OFS(P3)
   180	000046'	135300	000000*		LDB T1,TUYTUN		;Select TU45
   181	000047'	713316	000032		WRIO T1,TCOFS(P3)
   182	000050'	712316	000012		RDIO T1,DSOFS(P3)	;Get drive status
   183	000051'	606300	010000		TRNN T1,DSMOL		;On line?
   184	000052'	634300	000006		 TDZA T1,T1		;No, remember
   185	000053'	201300	000014		  MOVEI T1,DS800+DS1600	;Yes, 800/1600 bpi
   186	000054'	516305	000000*		HRLZM T1,UNITYP(U)	;Clear hung counter.
   187	000055'	253340	000043'		AOBJN T2,TMXIN1
   188	000056'	201300	000040		MOVEI T1,CS2CLR		;Clear Rh11 in case nxu selected.
   189	000057'	713316	000010		WRIO T1,CS2OFS(P3)
   190	000060'	262040	000005	FINOUT:	POP P,U
   191	000061'	262040	000016		POP P,P3
   192	000062'	263040	000000		RET
   193
   194
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 4
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   195				COMMENT %@@SUBROUTINE TMXREL
   196				RELEAS uuo.
   197				Waits for I/O to complete for the unit and then clears function in progress
   198				(the halves of devfnj), and devsts.
   199				@@ENTRY Expects F=DDB.
   200				@@ACCUM SETS S TO DEVIOS.
   201				@@CALLS WAIT1.
   202				@@CALLED UUO. @@%
   203
   204	000063'	260040	000000*	TMXREL:	CALL WAIT1		;Wait until device stops
   205	000064'	402004	000000*		SETZM DEVFNJ(F)		;No byte adjustment
   206	000065'	402004	000000*		SETZM DEVMD1(F)		;Turn off IBM compatability
   207	000066'	202004	000002		MOVEM S,DEVIOS(F)	;Save S.
   208	000067'	402004	000012		SETZM DEVSTS(F)
   209	000070'	263040	000000		RET
   210
   211
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 5
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   212				COMMENT %@@SUBROUTINE TMXCLS
   213				Process CLOSE uuo.
   214				If output has been done, an attempt is made to
   215				write two tape marks (logical eot) on the tape and then to
   216				backspace over one of them.  This routine does nothing if
   217				output hasn't been done.
   218				@@EXPECTS F=DDB.
   219				@@DESTROYS all but U, F.
   220				@@CALLS WAIT1, FT1CM2 (PART OF THE TMXPE ROUTINE), SAVAIL,
   221				FHGSTP, AND ITS OWN INTERNAL ROUTINE TMXCL6.
   222				@@ERRORS If the tape is write locked, just exit (ioimpm has
   223				been set at interrupt level.).
   224				@@CALLED UUO. @@%
   225
   226	000071'	607200	004000	TMXCLS:	TLNN F,OUTPB		;Were we doing output?
   227	000072'	263040	000000		 RET			;No, nothing to do.
   228	000073'	260040	000063*		CALL WAIT1		;Yes, wait for device to stop.
   229	000074'	201540	000002		MOVEI M,I.WTM		;Write tape mark.
   230	000075'	550244	000000*		HRRZ U,DEVUDB(F)
   231	000076'	260040	000110'		CALL TMXCL6
   232	000077'	602000	400000		TRNE S,IOIMPM		;Write locked?
   233	000100'	263040	000000		 RET			;Yes, just return.
   234	000101'	201540	000002		MOVEI M,I.WTM		;No, write second mark
   235	000102'	260040	000110'		CALL TMXCL6
   236	000103'	201540	000004		MOVEI M,I.BSR		;Backup one record.
   237	000104'	260040	000110'		CALL TMXCL6
   238	000105'	620000	020000		TRZ S,IODEND		;Clear EOF.
   239	000106'	202004	000002		MOVEM S,DEVIOS(F)
   240	000107'	263040	000000		RET
   241
   242	000110'	260040	000612'	TMXCL6:	CALL SAVAIL		;See if it's online
   243	000111'	260040	000553'	TMXCL7:	CALL GETCTL		;Grab controller.
   244	000112'	260040	000440'		CALL FT1CM2		;Start function
   245	000113'	260040	000073*		CALL WAIT1		;Wait for operation to complete.
   246	000114'	616000	001727'		TDNN S,[HNGTAP,,IODERR+IODTER]	;Trouble?
   247	000115'	263040	000000		 RET			;N, return.
   248	000116'	260040	001477'	TMXCL8:	CALL FHGSTP		;Yes, tell the user.
   249	000117'	200004	000002		MOVE S,DEVIOS(F)
   250	000120'	603000	040000		TLNE S,HNGTAP		;Still hung?
   251	000121'	254000	000116'		 JRST TMXCL8		;Yes, try again.
   252	000122'	254000	000111'		JRST TMXCL7		;No, try operation again.
   253
   254
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 6
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   255				COMMENT %@@SUBROUTINE TMXHNG
   256				Call here from once a second code in UUOCON after PDVCNT
   257				field counts to zero.  Current implementation gives
   258				127. seconds between calls here.
   259				If IOACT has been on through 2 calls, we say the
   260				device is hung.
   261				@@EXPECTS F=DDB.
   262				@@DESTROYS T1, T2.
   263				@@EXIT Skip returns unless it thinks the device is hung, in
   264				which case it cleans up some locations and then non-skip
   265				returns.
   266				@@CALLS SETHNG, SDCIOA, AND CPOPJ.
   267				@@%
   268
   269				DEFINE DSKOFF <WRPI DSKPIF>
   270				DEFINE DSKON <WRPI DSKPIN>
   271
   272
   273	000123'			TMXHNG:
   274	000123'	700600	000000*		DSKOFF
   275	000124'	200004	000002		MOVE S,DEVIOS(F)
   276	000125'	606000	010000		TRNN S,IOACT		;Did an interrupt sneak in?
   277	000126'	254000	000143'		 JRST TMXHC2		;Yes, say not hung
   278	000127'	261040	000005		PUSH P,U
   279	000130'	261040	000016		PUSH P,P3
   280	000131'	550244	000075*		HRRZ U,DEVUDB(F)	;U=UDB
   281	000132'	550345	000000*		HRRZ T2,TUBKDB(U)	;T2=KDB
   282	000133'	200707	000036*		MOVE P3,TKBCBA(T2)	;Rh11C base address
   283	000134'	550305	000054*		HRRZ T1,UNITYP(U)	;Is this the second time here?
   284	000135'	326300	000146'		JUMPN T1,TMXHN8		;J-Yes, in which case we say it's hung.
   285	000136'	340300	000000		AOJ T1,			;Count times through here.
   286	000137'	542305	000134*		HRRM T1,UNITYP(U)
   287	000140'	260040	000000*	TMXHCT:	CALL SETHNG		;Reset hung count
   288	000141'	262040	000016	TMXHC3:	POP P,P3
   289	000142'	262040	000005		POP P,U
   290	000143'	700600	000000*	TMXHC2:	DSKON
   291	000144'	202004	000002		MOVEM	S,DEVIOS(F)	;MAKE SURE ANY CHANGED BITS ARE STORED INTO DDB
   292								;(IOACT, HASCTL)
   293	000145'	254000	000000*		JRST CPOPJ1
   294
   295	000146'	350005	000000*	TMXHN8:	AOS TUBHC(U)		;Say it's hung
   296	000147'	623000	020000		TLZE S,HASCTL
   297	000150'	260040	000564'		 CALL RELCTL
   298	000151'	553004	000000*		HRRZS DEVER1(F)		;Turn off error processing
   299	000152'	402005	000000*		SETZM TUBER1(U)		;Clear error rec. state.
   300	000153'	135300	000046*		LDB T1,TUYTUN		;Get TU45 #
   301	000154'	200306	000000*		MOVE T1,TIBTBL(T1)
   302	000155'	713316	000016		WRIO T1,ASOFS(P3)	;Clear ATA bit for this unit.
   303	000156'	260040	000161'		CALL SDCIOA		;Unlock pages if I/O, and clear fcn
   304	000157'	370001	777776		SOS -2(P)		;Setup for single return
   305	000160'	254000	000141'		JRST TMXHC3
   306
   307				COMMENT %@@SUBROUTINE SDCIOA/SDCIO2
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 6-2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   308				Decrement the "don't swap while
   309				ioact" count (JBTIOA) AND say no function is in progress.
   310				1. Clear the function code in the Lh(DEVFNJ).
   311				2. For read and write functions, decrease JBTIOA for the job.
   312				@@ENTRY F=DDB, T1=function in progress.
   313				@@DESTROYS T1, T2.
   314				@@CALLED UUO, I-level. @@%
   315
   316	000161'	554304	000064*	SDCIOA:	HLRZ T1,DEVFNJ(F)	;Get function which the device just finished.
   317	000162'	305300	000011		CAIGE T1,FTC		;Data transfer command?
   318	000163'	254000	000167'		 JRST SDCIO4		;No, just say no current operation.
   319	000164'	135300	000000*	SDCIO2:	LDB T1,PJOBN		;Yes, one less reason why he's locked in core
   320	000165'	370006	000000*		SOS JBTIOA(T1)
   321	000166'	260040	000171'	SDCIO3:	CALL DDIO		;Mark I/O done on all pages.
   322	000167'	553004	000161*	SDCIO4:	HRRZS DEVFNJ(F)		;Remember function finished.
   323	000170'	263040	000000		RET
   324
   325
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 7
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   326				COMMENT #
   327				@@SUBROUTINE DDIO
   328				Decrement PGYDIO for pages from DEVDIO to the end of the list.
   329				Calls PAGWAK to wake waiters for the page if PGYDIO goes to zero.
   330				@@DESTROYS T1, T2.
   331				@@ #
   332
   333	000171'	261040	000011	DDIO:	PUSH P,T4
   334	000172'	550444	000000*		HRRZ T4,DEVDIO(F)	;T4/ Address of list.
   335	000173'	336311	000000		SKIPN T1,(T4)		;Anything there?
   336	000174'	254000	000207'		 JRST POPT4J		;No.
   337	000175'	261040	000003		PUSH P,PG
   338	000176'	261040	000002		PUSH P,J
   339	000177'	260040	000232'	DECDI2:	CALL BUFKRN		;Free pages specified by IOWDs up to next 0.
   340	000200'	135340	000000*		LDB T2,PIOMOD		;Done if D or DR.
   341	000201'	301340	000016		CAIL T2,DR
   342	000202'	254000	000205'		 JRST .+3
   343	000203'	332311	000001		SKIPE T1,1(T4)		;B - need 2 consequative 0s to finish.
   344	000204'	344440	000177'		 AOJA T4,DECDI2
   345	000205'	262040	000002		POP P,J
   346	000206'	262040	000003		POP P,PG
   347	000207'	262040	000011	POPT4J:	POP P,T4
   348	000210'	263040	000000		RET
   349
   350				COMMENT #
   351				@@SUBROUTINE BDIO
   352				Decrease the I/O use count on all pages specified by the list of IOWDs
   353				pointed at by DEVDIO.  Wakes jobs waiting for pages which
   354				are no longer unavailable by virtue of being used in tape I/O.
   355				@@ #
   356
   357	000211'	261040	000006	BDIO:	PUSH P,T1
   358	000212'	261040	000007		PUSH P,T2
   359	000213'	261040	000011		PUSH P,T4
   360	000214'	261040	000003		PUSH P,PG
   361	000215'	261040	000002		PUSH P,J
   362	000216444	000172*		HRRZ T4,DEVDIO(F)	;T4:=Address of list of IOWDs comprising xfr
   363	000217'	336311	000000		SKIPN T1,(T4)
   364	000220'	256000	001730'		 STOPCD (.,JOB,MTANIB,,<No IOWDs in BDIO>)
   365	000221'	260040	000232'		CALL BUFKRN		;Process until next 0 word
   366	000222'	201451	000001		MOVEI T4,1(T4)		;Skip over 0
   367	000223'	542444	000216*		HRRM T4,DEVDIO(F)
   368	000224'	262040	000002		POP P,J
   369	000225'	262040	000003		POP P,PG
   370	000226'	262040	000011		POP P,T4
   371	000227'	262040	000007		POP P,T2
   372	000230'	262040	000006		POP P,T1
   373	000231'	263040	000000		RET
   374
   375
   376				;Routine used by BDIO AND DDIO.
   377				;Enter with T1 the contents of the IOWD pointed at by T4.
   378				;Go through the vector of IOWDs, starting with the one at c(T4) and
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 7-2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   379				; decrease the I/O active count for each page, waking up jobs waiting
   380				; for the pages if it goes to 0.
   381				;Leaves T4 pointing to the next 0 word in the vector.
   382				;Destroys T1, T2, T4, PG, J.
   383	000232'	260040	000237'	BUFKRN:	CALL DPL		;Decrement lock count for this page.
   384	000233'	201451	000001		MOVEI T4,1(T4)
   385	000234'	332311	000000		SKIPE T1,(T4)
   386	000235'	254000	000232'		 JRST BUFKRN
   387	000236'	263040	000000		RET
   388
   389				;Decrement lock count for page pointed to by IOWD in T1.
   390	000237'	340300	000000	DPL:	AOJ T1,			;-COUNT AND ADDRESS-1+1.
   391	000240'	135140	001733'		LDB PG,[POINT 13,T1,26] ;GET PHYSICAL PAGE NUMBER.
   392	000241'	135300	000000*		LDB T1,PGYDIO		;GET DIRECT I/O COUNT.
   393	000242'	375000	000006		SOSGE T1		;SHOULD BE NON-ZERO.
   394	000243'	256000	001734'		 STOPCD (.,JOB,MTAICZ,,<I/O count zero>)
   395	000244'	137300	000241*		DPB T1,PGYDIO
   396	000245'	336000	000006		SKIPN T1		;Still doing I/O on this page?
   397	000246'	324740	000000*		 PJRST PAGWAK		;No, wake up waiters, if any.
   398	000247'	263040	000000		RET
   399
   400
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 8
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   401				COMMENT %@@SUBROUTINE SYDTMX
   402				SYSDVF UUO.
   403				@@%
   404
   405	000250'	340540	000000	SYDTMX:	AOJ	M,		;POINT M TO THE UNIT NAME.
   406	000251'	704313	000000		UMOVE	T1,(M)		;T1/ UNIT NAME.
   407	000252'	200340	000000*		MOVE	T2,TMX0CB+TKBIUN;Pointer to vector of UDB addresses
   408	000253'	326300	000256'		JUMPN	T1,FTDVF2	;J-Don't want the first unit
   409	000254'	201240	000000*		MOVEI	U,TU0CB		;First UDB.
   410	000255'	254000	000267'		JRST	FTDVF7
   411	000256'	336247	000000	FTDVF2:	SKIPN	U,(T2)
   412	000257'	254000	000000*		 JRST	SYDNM4
   413	000260'	550245	000000*		HRRZ	U,TUBDDB(U)
   414	000261'	316305	000000		CAMN	T1,DEVNAM(U)	;Is this the name we're looking for?
   415	000262'	254000	000265'		 JRST	FTDVF5		;J-Yes.
   416	000263'	253340	000256'		AOBJN	T2,FTDVF2	;No, try another unit
   417	000264'	254000	000257*		JRST	SYDNM4		;None left.
   418	000265'	336247	000001	FTDVF5:	SKIPN	U,1(T2)		;We're supposed to get the first after that
   419	000266'	254000	000264*		 JRST	SYDNM4		;There isn't one.
   420	000267'	550305	000260*	FTDVF7:	HRRZ	T1,TUBDDB(U)	;Get the name of the unit
   421	000270'	200306	000000		MOVE	T1,DEVNAM(T1)
   422	000271'	705313	000000		UMOVEM	T1,(M)		;Save its name.
   423	000272'	201300	000000*		MOVEI	T1,MTUDBL	;T1:=Length of UDB
   424	000273'	205340	240000		MOVSI	T2,LICSYS!LICSPY
   425	000274'	616342	000000*		TDNN	T2,JBTLIC(J)
   426	000275'	254000	000145*		 JRST	CPOPJ1
   427	000276'	363600	000275*		SOJLE	P1,CPOPJ1
   428	000277'	344540	000000*		AOJA	M,SYDCOM
   429
   430
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 9
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   431				COMMENT %@@SUBROUTINE TMXUGF
   432				UGETF UUO.
   433
   434				If Rh(E)=0,	Return the byte count of the last user record filled to
   435						E+1.
   436					 1,	Return Min(6,Lh(E)) words of 0 starting at E.
   437					 2,	Return the following into E+1:
   438							Bit 0: Hardware write locked
   439							Bits 1&2: always 0
   440							Bit 3: Copy of DS.BOT
   441							Bit 4: Copy of DS.EOT
   442							Bit 5: Always 0 (IBM compatible)
   443							Bit 12: Always 0 (7 track)
   444							Bits 13-17: 14 (1600/800 cpi)
   445
   446				@@ENTRY M=E, F=DDB.
   447				@@ACCUM SAVES F AND M.  OTHER ACS MAY BE DESTROYED.
   448				@@CALLS WAIT1, SGTDEV, FHGSTP.
   449				@@ERRORS Any of the following cause E+1 to be set to -1:
   450				1. E does not have one of the forms described under purpose.
   451				2. Rh(E)=0 and the mode is neitherl D nor DR.
   452				3. Rh(E)=1 and LH(E)<1.
   453				@@CALLED UUO. @@%
   454
   455	000300'	256200	001737'	TMXUGF:	UHRRZ T3,(M)		;Function type
   456	000301'	307400	000002		CAIG T3,2		;Legal?
   457	000302'	254000	000305'		 JRST FFUGF2		;Yes.
   458	000303'	256200	001740'	FFUERR:	XCTTU <SETOM 1(M)>	;Flag error by setting E+1:=-1;
   459	000304'	263040	000000		RET
   460
   461	000305'	260040	000113*	FFUGF2:	CALL WAIT1		;Wait for device to stop
   462	000306'	550244	000131*	FFUGF3:	HRRZ U,DEVUDB(F)	;UDB
   463	000307'	554305	000137*		HLRZ T1,UNITYP(U)	;Set unit characteristics
   464	000310'	254030	001741'		JRST @[EXP UGET0,UGET1,UGET2](T3)	;Process function
   465				    ;Function 0.
   466	000311'	135300	000200*	UGET0:	LDB T1,PIOMOD		;Mode D or DR?
   467	000312'	305300	000016		CAIGE T1,DR
   468	000313'	254000	000303'		 JRST FFUERR		;No.
   469	000314'	200304	000000*		MOVE T1,DEVDWC(F)	;Yes, give user the byte count
   470	000315'	705313	000001	FFUSTO:	UMOVEM T1,1(M)
   471	000316'	263040	000000		RET
   472				    ;Function 1.
   473	000317'	403300	000007	UGET1:	SETZB T1,T2		;Since this function makes no sense, return 0.
   474	000320'	256200	001744'		XCTTU <DMOVEM T1,1(M)>
   475	000321'	256200	001744'		XCTTU <DMOVEM T1,1(M)>
   476	000322'	256200	001744'		XCTTU <DMOVEM T1,1(M)>
   477	000323'	263040	000000		RET
   478				    ;Function 2
   479	000324'	326300	000332'	UGET2:	JUMPN T1,FFUS2		;Is the unit available?
   480	000325'	260040	000573'	FFUS1:	CALL SGTDEV		;No, try to get it.
   481	000326'	254000	000332'		 JRST FFUS2		;Got it.
   482	000327'	260040	001477'		CALL FHGSTP		;Tell the user it's hung.
   483	000330'	200004	000002		MOVE S,DEVIOS(F)
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 9-2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   484	000331'	254000	000325'		JRST FFUS1		;Loop until the problem has been fixed.
   485	000332'	260040	000553'	FFUS2:	CALL GETCTL		;Get back controller.
   486	000333'	550244	000306*		HRRZ U,DEVUDB(F)	;UDB
   487	000334'	550345	000132*		HRRZ T2,TUBKDB(U)	;KDB
   488	000335'	200347	000133*		MOVE T2,TKBCBA(T2)	;Base address of Rh11C
   489	000336'	135300	000044*		LDB T1,TUYTMN		;Select TM02
   490	000337'	713307	000010		WRIO T1,CS2OFS(T2)
   491	000340'	135300	000153*		LDB T1,TUYTUN		;Select TU45A
   492	000341'	713307	000032		WRIO T1,TCOFS(T2)
   493	000342'	712307	000012		RDIO T1,DSOFS(T2)	;Get its status
   494	000343'	515340	000014		HRLZI T2,14		;1600/800 cpi density
   495	000344'	602300	004000		TRNE T1,DSWRL		;Write locked?
   496	000345'	661340	400000		 TLO T2,WRPROT
   497	000346'	602300	000002		TRNE T1,DSBOT		;BOT?
   498	000347'	661340	040000		 TLO T2,LOADPT
   499	000350'	602300	002000		TRNE T1,DSEOT		;EOT?
   500	000351'	661340	020000		 TLO T2,TAPEIN
   501	000352'	705353	000001		UMOVEM T2,1(M)		;Give the status to the user
   502	000353'	324740	000564'		PJRST RELCTL		;Give up controller
   503
   504
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 10
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   505				COMMENT %@@SUBROUTINE FTAPE
   506				MTAPE uuo.
   507
   508				0 Wait	10 Go to LEOT  100 Core dump mode
   509				1 REW	11 REW/UNL     101 4 8-bit bytes per word mode
   510				3 WTM	13 ERG
   511				6 SKR	16 SKF
   512				7 BSR	17 BSF
   513				@@ENTRY M=E, F=DDB, S=DEVIOS.
   514				An additional entry point is FT1CM2.
   515				@@ACCUM Saves F. Others may be destroyed. Sets U=UDB and S=DEVIOS.
   516				@@CALLS WAIT1, CPOPJ, SAVAIL, UNISE0, SUBRGO, AND ITS INTERNAL
   517				ROUTINE FT1CM2.
   518				@@CALLED UUO. @@%
   519
   520				    ;Dispatch table for functions. Odd in Lh.
   521	000354'	000425'	000402'	FTPTBL:	FT1CMD,,MTPERR
   522	000355'	000425'	000402'		FT1CMD,,MTPERR
   523	000356'	000402'	000402'		MTPERR,,MTPERR
   524	000357'	000425'	000425'		FT1CMD,,FT1CMD
   525	000360'	000425'	000470'		FT1CMD,,FTLEOT
   526	000361'	000425'	000402'		FT1CMD,,MTPERR
   527	000362'	000402'	000402'		MTPERR,,MTPERR
   528	000363'	000425'	000425'		FT1CMD,,FT1CMD
   529
   530	000364'	260040	000305*	FTAPE:	CALL WAIT1		;Wait until device finished.
   531	000365'	551553	000000		HRRZI M,(M)		;Nothing to do if funtion 0.
   532	000366'	322540	000000*		JUMPE M,CPOPJ
   533
   534	000367'	260040	000612'	FTP2:	CALL SAVAIL		;Make sure unit is available
   535	000370'	554305	000307*		HLRZ T1,UNITYP(U)	;Unit characteristics
   536	000371'	301540	000100		CAIL M,100		;9 track function ?
   537	000372'	254000	000404'		 JRST FT9TRK		; yes
   538	000373'	602540	777760		TRNE M,777760		;<100, so must be in [0,17]
   539	000374'	254000	000402'		 JRST MTPERR		;No.
   540	000375'	241540	777777	FTP6:	ROT M,-1		;Go to function dependent code.
   541	000376'	331000	000013		SKIPL M
   542	000377'	334313	000354'		 SKIPA T1,FTPTBL(M)
   543	000400'	554313	000354'		  HLRZ T1,FTPTBL(M)
   544	000401'	254006	000000		JRST (T1)
   545
   546				    ;Here if the function is illegal.
   547	000402'	660000	400000	MTPERR:	TRO S,IOIMPM		;Mark illegal.
   548	000403'	254000	000411'		JRST FTOUT		;Store S in DEVIOS and return
   549
   550				    ;Set status flags for 9 track operation. (F=76,77,100).
   551	000404'	303540	000101	FT9TRK:	CAILE M,101		;Legal function
   552	000405'	254000	000402'		JRST MTPERR		;no
   553	000406'	135300	001745'		LDB T1,[POINT 2,M,35]	;Yes.  Set up mode information.
   554	000407'	542304	000065*		HRRM T1,DEVMD1(F)
   555	000410'	513004	000167*		HLLZS DEVFNJ(F)		;No byte adjustment.
   556	000411'	202004	000002	FTOUT:	MOVEM S,DEVIOS(F)	;Save S.
   557	000412'	263040	000000		RET
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 10-2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   558
   559	000001			FT1TBL:	PHASE 1
   560	000413'	000107	000366*	I.REWI:!F.REWI+CS1IE,,CPOPJ		;1
   561	000414'	000127	000413*	I.WTM:!	F.WTM+CS1IE,,CPOPJ		;2
   562	000415'	000131	000465'	I.SKR:!	F.SKR+CS1IE,,SPC		;3 Need to set up FC for these two.
   563	000416'	000133	000465'	I.BSR:!	F.BSR+CS1IE,,SPC		;4
   564	000417'	000103	000414*	I.RO:!	F.RO+CS1IE,,CPOPJ		;5
   565	000420'	000125	000417*	I.EG:!	F.EG+CS1IE,,CPOPJ		;6
   566	000421'	000131	000445'	I.SF:!	F.SKR+CS1IE,,FTSKB2		;7 These two implemented as SKR/BSR
   567	000422'	000133	000445'	I.BF:!	F.BSR+CS1IE,,FTSKB2		;10 until error (tape mark hit).
   568	000011			FTC:!
   569	000423'	000171	000000	I.RF:!	F.RF+CS1IE,,			;11
   570	000424'	000161	000000	I.WF:!	F.WF+CS1IE,,			;12
   571	000425'				DEPHASE
   572
   573				    ;Simple functions: REW,WTM,SKR,BSR,REW&UNL,ERG,SKF,BSF ->
   574				    ;(1,3,6,7,11,13,16,17)
   575	000425'	337000	000013	FT1CMD:	SKIPG M
   576	000426'	340540	000000		 AOJ M,			;(S+0,S+1,3,S+3,S+4,S+5,7,S+7) ->
   577								; (1,2,3,4,5,6,7,10)
   578	000427'	260040	000553'		CALL GETCTL		;Grab the controller
   579	000430'	261040	000013		PUSH P,M		;In case completes before return
   580	000431'	260040	000440'		CALL FT1CM2		;Issue drive command.
   581	000432'	262040	000013		POP P,M
   582	000433'	553000	000013		HRRZS M
   583	000434'	302540	000001		CAIE M,I.REWI		;Rewind or rewind offline.
   584	000435'	306540	000005		 CAIN M,I.RO
   585	000436'	260040	000564'		  CALL RELCTL		;Y.  Don't need controller anymore.
   586	000437'	263040	000000		RET
   587	000440'	506544	000410*	FT1CM2:	HRLM M,DEVFNJ(F)	;Remember what this unit's doing.
   588	000441'	260040	001526'		CALL UNISE0		;Select unit, set mode, put Rh11C adr in P2.
   589	000442'	200313	000412'		MOVE T1,FT1TBL-1(M)
   590	000443'	260046	000000		CALL (T1)		;Perform any special setup needed for this fcn
   591	000444'	324740	001453'		PJRST SUBRGO		;Start device.
   592				;Here to skip over a file forwards or backwards.  This is
   593				; implemented as a number of skip record operations.
   594				; Rescheduling is allowed so that a job skipping a single
   595				; large file can't tie up the tape controller indefinately.
   596	000445'	274040	001746'	FTSKB2:	SUB P,[1,,1]		;flush return to FT1CM2.
   597	000446'	561340	777766	FTSKBL:	HRROI T2,-12		;This many records allowed
   598	000447'	550244	000333*		HRRZ U,DEVUDB(F)
   599	000450'	550645	000334*		HRRZ P2,TUBKDB(U)
   600	000451'	200655	000335*		MOVE P2,TKBCBA(P2)
   601	000452'	713355	000006		WRIO T2,FCOFS(P2)
   602	000453'	202004	000002		MOVEM S,DEVIOS(F)
   603	000454'	260040	001453'		CALL SUBRGO		;Start device.
   604	000455'	260040	000364*		CALL WAIT1		;Wait until finished
   605	000456'	200004	000002		MOVE S,DEVIOS(F)
   606	000457'	603000	010000		TLNE S,SFDONE		;I level say tape mark or eot?
   607	000460'	263040	000000		 RET			;Yes, so finished.
   608	000461'	260040	000553'		CALL GETCTL		;No, get controller.
   609	000462'	506544	000440*		HRLM M,DEVFNJ(F)
   610	000463'	260040	001526'		CALL UNISE0		;Select unit again.
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 10-3
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   611	000464'	254000	000446'		JRST FTSKBL		; ... and try another bunch of skrs.
   612	000465'	211340	000001	SPC:	MOVNI T2,1		;Skip one record.
   613	000466'	713355	000006		WRIO T2,FCOFS(P2)
   614	000467'	263040	000000		RET
   615
   616				;LEOT (10).
   617				;
   618				;    1. BSR over possible tape mark.
   619				;    2. SKF.  If it's EOT, we're done.  Otherwise, we've seen 1 tape mark.
   620				;    3. SKR.  If it's EOT, we're done.  If it's an EOF, we're done also and
   621				;	have seen 2 tape marks in a row.  Otherwise, go to 2.
   622				;    4. BSR over the last of the two consequative tape marks we saw.
   623
   624	000470'	260040	000553'	FTLEOT:	CALL GETCTL		;Grab controller.
   625	000471'	201540	000004		MOVEI M,I.BSR		;1. BSR
   626	000472'	260040	000440'		CALL FT1CM2
   627	000473'	260040	000455*		CALL WAIT1
   628	000474'	260040	000553'	FTLEO1:	CALL GETCTL		;Get controller.
   629	000475'	201540	000007		MOVEI M,I.SF		;2. SKF	
   630	000476'	260040	000440'		CALL FT1CM2
   631	000477'	260040	000473*		CALL WAIT1
   632	000500'	603000	001000		TLNE S,IOLEND		;EOT?
   633	000501'	263040	000000		 RET			;Yes
   634	000502'	260040	000553'		CALL GETCTL		;get controller
   635	000503'	201540	000003		MOVEI M,I.SKR		;3. SKR
   636	000504'	260040	000440'		CALL FT1CM2
   637	000505'	260040	000477*		CALL WAIT1
   638	000506'	616000	001747'		TDNN S,[XWD IOLEND,IODEND]	;EOT/EOF?
   639	000507'	254000	000474'		 JRST FTLEO1		;No,loop.
   640	000510'	606000	020000		TRNN S,IODEND		;EOF?
   641	000511'	263040	000000		 RET			;No, so it's EOT.
   642	000512'	260040	000553'		CALL GETCTL		;Get controller.
   643	000513'	201540	000004		MOVEI M,I.BSR		;4. BSR to leave tape after 1st of 2 tape marks
   644	000514'	254000	000440'		JRST FT1CM2		; at its end.
   645
   646
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 11
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   647				COMMENT %@@SUBROUTINE TMXRED/WRT
   648				Read and write the tape.
   649				In buffered mode if a transfer of 0 words is specified, the routine returns.
   650				Otherwise it starts the device and returns.
   651				@@ENTRY S=DEVIOS, F=DDB.
   652				@@ACCUM SAVES F AND M.  OTHERS MAY BE DESTROYED.  Sets U=UDB, S=DEVIOS.
   653				@@CALLS SAVAIL, WAIT1, SRFX, AND SDCIO2.
   654				@@ERRORS CERTAIN BAD DDB LISTS (SEE SRFX.).
   655				@@CALLED UUO. @@%
   656
   657	000515'	625000	000020	TMXRED:	TLZA S,IO		;Remember if read or write.
   658	000516'	661000	000020	TMXWRT:	 TLO S,IO
   659	000517'	260040	000612'		CALL SAVAIL		;Check the unit is available.
   660	000520'	550304	000011		HRRZ T1,DEVCLS(F)	;Start from the beginning of the list
   661	000521'	542304	000223*		HRRM T1,DEVDIO(F)	; for busy page calculations.
   662	000522'	554305	000370*		HLRZ T1,UNITYP(U)	;Unit characteristics.
   663	000523'	260040	000505*		CALL WAIT1		;Wait until device stops.
   664	000524'	260040	000553'		CALL GETCTL		;Get controller.
   665	000525'	135300	000311*		LDB T1,PIOMOD		;Mode.
   666	000526'	301300	000016		CAIL T1,DR		;D or DR?
   667	000527'	627000	000002		 TLZN S,IOBEG		;Y; new IOWD?
   668	000530'	334000	000000		  SKIPA			;NvN
   669	000531'	402004	000314*		SETZM DEVDWC(F)		;Y&Y; remember nothing transferred yet.
   670	000532'	402004	000000*		SETZM DEVCNT(F)		;Not continuing IOWD processing.
   671	000533'	550244	000447*		HRRZ U,DEVUDB(F)
   672	000534'	402005	000152*		SETZM TUBER1(U)		;Not yet in error recovery.
   673	000535'	201300	000011		 MOVEI T1,I.RF		;Remember what we're doing.
   674	000536'	603000	000020		TLNE S,IO
   675	000537'	201300	000012		 MOVEI T1,I.WF
   676	000540'	506304	000462*		HRLM T1,DEVFNJ(F)
   677	000541'	135340	000164*		LDB T2,PJOBN		;Prevent user from being swapped.
   678	000542'	350007	000165*		AOS JBTIOA(T2)
   679	000543'	260040	001552'		CALL SRFX		;Set up registers for transfer.
   680	000544'	254000	000551'		 JRST TMXRW1		;Start operation.
   681	000545'	350004	000013		AOS DEVABC(F)		;B mode, empty buffer.
   682	000546'	260040	001220'		CALL FREBUF
   683	000547'	260040	000564'		Call	Relctl		;Release MT resource
   684	000550'	324740	000164'		PJRST SDCIO2
   685	000551'	260040	001454'	TMXRW1:	CALL SUBRG1		;Start operation.
   686	000552'	263040	000000		RET
   687
   688				;GETCTL, RELCTL.  Handle interlocking for tape controller.
   689				;Enter with DDB adr in F.  Leave GETCTL with controller
   690				; locked, HASCTL set, JBTABT set to RELCTL.
   691				; Leave RELCTL with controller unlocked.  Usually called
   692				; at interrupt level after completion of the operation.
   693	000553'	352000	000000*	GETCTL:	AOSE MTREQ
   694	000554'	260040	000000*		 CALL MTWAIT
   695	000555'	261040	000002		PUSH P,J
   696	000556'	135100	000541*		LDB J,PJOBN		;Get user's job #
   697	000557'	201300	000564'		MOVEI T1,RELCTL
   698	000560'	552302	000000*		HRRZM T1,JBTABT(J)	;Set abort location.
   699	000561'	262040	000002		POP P,J
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 11-2
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   700	000562'	661000	020000		TLO S,HASCTL	;Remember we have conroller.
   701	000563'	263040	000000		RET
   702	000564'	371000	000553*	RELCTL:	SOSL MTREQ
   703	000565'	476000	000000*		 SETOM MTAVAL
   704	000566'	261040	000002		PUSH P,J
   705	000567'	135100	000556*		LDB J,PJOBN		;Get user's job #
   706	000570'	402002	000560*		SETZM JBTABT(J)		;Clear abort location.
   707	000571'	262040	000002		POP P,J
   708	000572'	263040	000000		RET
   709
   710
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 12
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   711				COMMENT %@@SUBROUTINE SGTDEV
   712				See if a tape is now available although it wasn't when the system
   713				came up.  Sets Lh(UNITYP) as appropriate if the device is
   714				available.  Skips if the unit remains unavailable.
   715				@@ENTRY U=UDB, F=DDB.
   716				@@CALLS SUBRSN, SUBRG2, WAIT1, SFISKN, AND SFISUN.
   717				@@CALLED UUO. @@%
   718
   719	000573'	261040	000010	SGTDEV: PUSH P,T3
   720	000574'	261040	000015		PUSH P,P2
   721	000575'	260040	000553'		CALL GETCTL		;Get controller.
   722	000576'	260040	001526'		CALL UNISE0		;Select unit.
   723	000577'	712415	000012		RDIO T3,DSOFS(P2)	;Get this unit's status
   724	000600'	606400	010000		TRNN T3,DSMOL		;Is it available?
   725	000601'	254000	000610'		 JRST SGTDE1		;J-No
   726	000602'	201400	000014		MOVEI T3,DS800+DS1600	;Yes, set up unit information
   727	000603'	516405	000522*		HRLZM T3,UNITYP(U)	;Clear hung counter.
   728	000604'	260040	000564'	SGTDE0:	CALL RELCTL		;Release controller.
   729	000605'	262040	000015		POP P,P2
   730	000606'	262040	000010		POP P,T3
   731	000607'	263040	000000		RET
   732	000610'	350001	777776	SGTDE1:	AOS -2(P)		;Skip return-unit still unavailable
   733	000611'	254000	000604'		JRST SGTDE0
   734
   735
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 13
MAGSER.MAC	25-NOV-87 15:41		This hack written by Daniel S. Blom

   736				COMMENT %@@SUBROUTINE SAVAIL
   737				Unit now online?
   738					No: Tell user via FHGSTP, loop until it is.
   739					Yes: Check HNGTAP in DEVIOS.
   740						Not set: Return.
   741						Set: Check status to see if intervention still
   742						   required.  If so, tell the user via HNGSTP,
   743						   and continue checking HNGTAP.  If not, return.
   744				@@ENTRY F=DDB.
   745				@@DESTROYS S, T4. (U is set to UDB and S to DEVIOS).
   746				@@CALLS SGTDEV, FHGSTP, SUBRSN, AND WAIT1.
   747				@@CALLED UUO.@@%
   748
   749	000612'	261040	000006	SAVAIL:	PUSH P,T1
   750	000613'	550244	000533*		HRRZ U,DEVUDB(F)	;U=UDB
   751
   752				    ;Check that the unit is online.
   753	000614'	260040	000573'	SAVAL2:	CALL SGTDEV		;See if it is there now.
   754	000615'	254000	000620'		 JRST SAVAL4
   755	000616'	260040	001477'		CALL FHGSTP		;Nope.  Tell the user and try again.
   756	000617'	254000	000614'		JRST SAVAL2
   757
   758				    ;Here when the unit is online.
   759	000620'	200004	000002	SAVAL4:	MOVE S,DEVIOS(F)	;Is HNGTAP set?
   760	000621'	607000	040000		TLNN S,HNGTAP
   761	000622'	254000	000625'		 JRST SAVAL8		;No.
   762	000623'	260040	001477'		CALL FHGSTP		;Yes, tell user.
   763	000624'	254000	000620'		JRST SAVAL4
   764	000625'	262040	000006	SAVAL8:	POP P,T1
   765	000626'	263040	000000		RET
   766
   767	000627'	261040	000010	TMXGRD: PUSH P,T3
   768	000630'	261040	000011		PUSH P,T4
   769	000631'	260040	000612'		CALL SAVAIL
   770	000632'	262040	000011		POP P,T4
   771	000633'	262040	000010		POP P,T3
   772	000634'	263040	000000		RET
   773
   774
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

   775				SUBTTL INTERRUPT PROCESSING
   776
   777				;Interrupt processing module for TM02s.
   778
   779				;U=UDB, F=DDB, J=KDB, P2=Rh11C base address, S=DEVIOS.
   780
   781				;The code assumes that tape operations may not be overlapped.  All
   782				; routines which perform tape operations must wait until the previous
   783				; one, if any, has finished; one way to do this is to call WAIT1.
   784
   785	000635'	000000	000000	SAVDS:	0			;Save TM02 status here.
   786	000636'			TBVMAG: BLOCK 2			;save location for the time base
   787	000640'			MTXACS:	BLOCK 20		;Storage for ACs.
   788	000660'	777750	000660'	MAGPDP:	-30,,.			;Initial I-level push down pointer.
   789	000661'				BLOCK 30
   790	000711'	000000	000000	MAGINT:	0
   791	000712'	702200	000636'		TBSAVE TBVMAG		;save the current value of time base
   792	000713'	202740	000657'		MOVEM 17,MTXACS+17
   793	000714'	201740	000640'		MOVEI 17,MTXACS
   794	000715'	251740	000656'		BLT 17,MTXACS+16
   795	000716'	200040	000660'		MOVE P,MAGPDP
   796	000717'	201100	000035*		MOVEI J,TMX0CB		;KDB.  Here we set up the record pointers.
   797	000720'	200642	000451*		MOVE P2,TKBCBA(J)	;Base address of the Rh11C.
   798	000721'	201300	000000		MOVEI T1,0
   799	000722'	713315	000010		WRIO T1,CS2OFS(P2)	;Select TM02
   800	000723'	712315	000012		RDIO T1,DSOFS(P2)
   801	000724'	202300	000635'		MOVEM T1,SAVDS		;Preserve SSC
   802	000725'	260040	000736'		CALL CHKCUN		;Check current unit.
   803	000726'	260040	000753'		CALL CHKSSC		;Check for rewind complete.
   804	000727'	712315	000000		RDIO T1,CS1OFS(P2)
   805	000730'	606300	000001		TRNN T1,CS1GO		;Controller busy?
   806					 JRST [	MOVEI T1,CS1IE	;No, ensure interrupts enabled.
   807						WRIO T1,CS1OFS(P2)
   808	000731'	254000	001750'			JRST .+1]
   809	000732'	205740	000640'		MOVSI 17,MTXACS
   810	000733'	251740	000017		BLT 17,17
   811	000734'	702600	000636'		TBSET TBVMAG		;reset the time base for charging
   812	000735'	254520	000711'		JEN @MAGINT
   813
   814				;Interrupt by unit controller is currently talking to.
   815	000736'	336242	000000*	CHKCUN:	SKIPN U,TKBCUN(J)	;Waiting for this unit?
   816	000737'	263040	000000		 RET
   817	000740'	402002	000736*		SETZM TKBCUN(J)		;Idle until we start it again.
   818	000741'	200205	000267*		MOVE F,TUBDDB(U)	;Get DDB associated with this unit.
   819	000742'	200004	000002		MOVE S,DEVIOS(F)	;Get device status.
   820	000743'	260040	001531'		CALL UNISEL		;Select unit.
   821	000744'	712415	000012		RDIO T3,DSOFS(P2)	;Unit status.
   822	000745'	712355	000000		RDIO T2,CS1OFS(P2)	;RH11C status.
   823	000746'	554544	000540*		HLRZ M,DEVFNJ(F)	;Most recent function issued.
   824	000747'	332305	000534*		SKIPE T1,TUBER1(U)	;Doing error recovery?
   825	000750'	254006	000000		 JRST (T1)		;Co-routine call.
   826	000751'	326573	001054'		JUMPN M,@ODD-1(M)	;Function done interrupt service.
   827	000752'	263040	000000		RET
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-2
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

   828
   829				;Check for rewind start/finish or drives offline.
   830	000753'	200302	000037*	CHKSSC:	MOVE T1,TKBIUN(J)	;Pointer to vector of UDB adrs.
   831	000754'	200340	000635'		MOVE T2,SAVDS		;Get orginial status
   832	000755'	602340	000100		TRNE T2,DSSSC		;Rewind done or offline.
   833	000756'	254000	000761'		 JRST CHKRW4
   834	000757'	712355	000016		RDIO T2,ASOFS(P2)
   835	000760'	322340	000420*		JUMPE T2,CPOPJ		;Also poll if any ATA asserted.
   836	000761'	261040	000006	CHKRW4:	PUSH P,T1
   837	000762'	550246	000000		HRRZ U,(T1)		;U:=UDB
   838	000763'	316242	000740*		CAMN U,TKBCUN(J)	;Handled specially.
   839	000764'	254000	001015'		 JRST CHKRW3
   840	000765'	550205	000741*		HRRZ F,TUBDDB(U)	;F:=DDB
   841	000766'	200004	000002		MOVE S,DEVIOS(F)	;S:=DDB.DEVIOS
   842	000767'	260040	001531'		CALL UNISEL		;Select unit
   843	000770'	712415	000012		RDIO T3,DSOFS(P2)	;See if rewind complete.
   844	000771'	260040	001214'		CALL CLRATA		;Guarentee ATA is off.
   845	000772'	260040	001020'		CALL CHKOFL		;Process MOL state changes.
   846	000773'	550345	000000*		HRRZ T2,TUBS(U)		;Expecting rewind done int?
   847	000774'	322340	001015'		JUMPE T2,CHKRW3
   848	000775'	554445	000773*		HLRZ T4,TUBS(U)
   849	000776'	602400	020000		TRNE T3,DSPIP
   850	000777'	326440	001015'		 JUMPN T4,CHKRW3
   851	001000'	513005	000775*		HLLZS TUBS(U)
   852	001001'	712355	000000		RDIO T2,CS1OFS(P2)
   853	001002'	606340	040000		TRNN T2,CS1TRE		;Errors?
   854	001003'	602400	040000		 TRNE T3,DSERR
   855	001004'	254000	001014'		  JRST CHKRW1		;Yes, flag and wake user.
   856	001005'	660000	004000		TRO S,IOBOT
   857	001006'	630000	001753'		TDZ S,[XWD IOLEND,IOTEND]	;Update our idea of the status.
   858	001007'	201300	000111		MOVEI T1,F.DC+CS1IE
   859	001010'	713315	000000		WRIO T1,CS1OFS(P2)	;Clear drive.
   860	001011'	554544	000746*		HLRZ M,DEVFNJ(F)	;Load function identifier
   861	001012'	260040	001122'		CALL MTICE
   862	001013'	254000	001015'		JRST CHKRW3
   863	001014'	260040	001133'	CHKRW1:	CALL INTERR
   864	001015'	262040	000006	CHKRW3:	POP P,T1
   865	001016'	253300	000761'		AOBJN T1,CHKRW4
   866	001017'	263040	000000		RET
   867				;Here to check for unit changing MOL state.
   868	001020'	554345	001000*	CHKOFL:	HLRZ T2,TUBS(U)
   869	001021'	322340	001030'		JUMPE T2,CHKOF1
   870	001022'	602400	010000		TRNE T3,DSMOL
   871	001023'	263040	000000		 RET
   872	001024'	553005	001020*		HRRZS TUBS(U)
   873	001025'	201340	000111	CHKOF2:	MOVEI T2,F.DC+CS1IE
   874	001026'	713355	000000		WRIO T2,CS1OFS(P2)
   875	001027'	263040	000000		RET
   876	001030'	606400	010000	CHKOF1:	TRNN T3,DSMOL
   877	001031'	263040	000000		 RET
   878	001032'	563005	001024*		HRROS TUBS(U)
   879	001033'	254000	001025'		JRST CHKOF2
   880	
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-3
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

   881
   882				    ;Here when an operation is complete.
   883	001034'	603000	000001	MTDONE:	TLNE S,IOW
   884	001035'	260040	000000*		 CALL SETIOD		;Wake up waiter since device has finished.
   885	001036'	554544	001011*		HLRZ M,DEVFNJ(F)
   886	001037'	302540	000001		CAIE M,I.REWI
   887	001040'	306540	000005		 CAIN M,I.RO
   888	001041'	254000	001044'		  JRST MTDON1
   889	001042'	623000	020000		TLZE S,HASCTL		;Have controller?
   890	001043'	260040	000564'		 CALL RELCTL		;Y, no longer need it.
   891	001044'	620000	010000	MTDON1:	TRZ S,IOACT
   892	001045'	202004	000002		MOVEM S,DEVIOS(F)
   893	001046'	260040	000161'		CALL SDCIOA		;Unlock pages if xfr, say no current operation.
   894	001047'	260040	001214'	ODREW2:	CALL CLRATA		;Clear ATA.
   895	001050'	201300	000100		MOVEI T1,CS1IE
   896	001051'	713315	000000		WRIO T1,CS1OFS(P2)
   897	001052'	263040	000000		RET
   898
   899	001053'	260040	001475'	FXDSM1:	CALL FSTHNG		;Reset hung timeout vars & mark unit as idle.
   900	001054'	263040	000000		RET
   901
   902				;This table maps between the operation code stored in Lh(DEVFNJ) and the
   903				; I-level routine to be called when an interrupt is received after the
   904				; operation has been initiated.
   905	000001			ODD:	PHASE 1
   906	001055'	000000	001067'	I.REWI:!MTAIFC			;1 Rewind (handled specially)
   907	001056'	000000	001113'	I.WTM:!	OD.WTM			;2 Write Tape Mark
   908	001057'	000000	001104'	I.SKR:!	OD.SKR			;3 Skip Record
   909	001060'	000000	001104'	I.BSR:!	OD.BSR			;4 Backspace Record
   910	001061'	000000	001070'	I.RO:!	OD.RO			;5 Rewind Offline
   911	001062'	000000	001113'	I.EG:!	OD.EG			;6 Erase gap
   912	001063'	000000	001076'	I.SF:!	OD.SF			;7 Skip file
   913	001064'	000000	001076'	I.BF:!	OD.BF			;10 Backspace file
   914	001065'	000000	001140'	I.RF:!	OD.RF			;11 Read forward
   915	001066'	000000	001140'	I.WF:!	OD.WF			;12 Write forward
   916	001067'				DEPHASE
   917
   918	001067'	256000	001754'	MTAIFC:: STOPCD (.,JOB,MTAIFC,,<Illegal Function Code>)
   919
   920	001070'	606340	040000	OD.RO:	TRNN T2,CS1TRE		;Errors?
   921	001071'	602400	040000		 TRNE T3,DSERR
   922	001072'	254000	001133'		  JRST INTERR		;Yes.
   923	001073'	606400	010000		TRNN T3,DSMOL		;Drive still online?
   924	001074'	553005	000603*		 HRRZS UNITYP(U)	;Flag offline.
   925	001075'	254000	001122'		JRST MTICE		;Yes.
   926	001076'			OD.SF:OD.BF:
   927	001076'	606340	040000		TRNN T2,CS1TRE		;Errors?
   928	001077'	602400	040000		 TRNE T3,DSERR
   929	001100'	665000	010000		  TLOA S,SFDONE		;Yes, flag finished.
   930	001101'	621000	010000		   TLZ S,SFDONE		;No, flag need to do some more.
   931	001102'	602400	002004		TRNE T3,DSTM+DSEOT	;See TM?
   932	001103'	661000	010000		 TLO S,SFDONE
   933	001104'			OD.SKR: OD.BSR:
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-4
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

   934	001104'	712315	000014		RDIO T1,EROFS(P2)
   935	001105'	626300	001000		TRZN T1,ERFCE		;Frame count error?
   936	001106'	254000	001113'		 JRST MTICE0
   937	001107'	326300	001113'		JUMPN T1,MTICE0		;Yes, any other errors?
   938	001110'	201300	000111		MOVEI T1,F.DC+CS1IE	;No, clear error condition.
   939	001111'	713315	000000		WRIO T1,CS1OFS(P2)
   940	001112'	712415	000012		RDIO T3,DSOFS(P2)
   941	001113'			OD.EG:OD.WTM:
   942	001113'	602400	000004	MTICE0:	TRNE T3,DSTM
   943	001114'	670000	001757'		 TDO S,[IOEND,,IODEND]
   944	001115'	602400	002000		TRNE T3,DSEOT
   945	001116'	674000	001753'		 TDOA S,[IOLEND,,IOTEND]
   946	001117'	630000	001753'		  TDZ S,[IOLEND,,IOTEND]
   947	001120'	602400	000002		TRNE T3,DSBOT
   948	001121'	660000	004000		 TRO S,IOBOT
   949	001122'	135300	000340*	MTICE:	LDB T1,TUYTUN		;Clear ATA bit for the unit.
   950	001123'	200306	000154*		MOVE T1,TIBTBL(T1)
   951	001124'	713315	000016		WRIO T1,ASOFS(P2)
   952	001125'	712415	000012		RDIO T3,DSOFS(P2)	;Get status again.
   953	001126'	712355	000000		RDIO T2,CS1OFS(P2)
   954	001127'	606340	040000		TRNN T2,CS1TRE		;Check for errors.
   955	001130'	602400	040000		 TRNE T3,DSERR
   956	001131'	334000	000000		  SKIPA
   957	001132'	254000	001034'		   JRST MTDONE
   958	001133'	660000	200000	INTERR:	TRO S,IODERR		;Yes, flag error for higher level routines.
   959	001134'	260040	001411'		CALL RECDER		;Record device error for CHKPNT.
   960	001135'	201300	040011		MOVEI T1,F.DC+CS1TRE
   961	001136'	713315	000000		WRIO T1,CS1OFS(P2)
   962	001137'	254000	001034'		JRST MTDONE
   963
   964	001140'			OD.RF:OD.WF:
   965	001140'	260040	001214'		CALL CLRATA
   966	001141'	606340	040000	RWDON3:	TRNN T2,CS1TRE		;Errors?
   967	001142'	602400	040000		 TRNE T3,DSERR
   968	001143'	334000	000000		  SKIPA
   969	001144'	254000	001154'		   JRST RWDON1		;No.
   970				    ;Here when reading/writing complete, device errors.
   971				    ;IOBKTL should be set if the user request is less than the record size.
   972	001145'	712355	000014		RDIO T2,EROFS(P2)	;Yes, get error register.
   973	001146'	202344	000151*		MOVEM T2,DEVER1(F)	;Save it.
   974	001147'	626340	001000		TRZN T2,ERFCE		;FCE may indicate EOF if it's the only error.
   975	001150'	254000	001247'		 JRST RWERR		;Not FCE.
   976	001151'	326340	001247'		JUMPN T2,RWERR		;Any other errors?
   977	001152'	201300	040011	RWDON2:	MOVEI T1,F.DC+CS1TRE	;Attempt to clear errors.
   978	001153'	713315	000000		WRIO T1,CS1OFS(P2)
   979				    ;Here after error recovery (if any) finished.
   980	001154'	602400	000004	RWDON1:	TRNE T3,DSTM		;No, TM?
   981	001155'	670000	001757'		 TDO S,[IOEND,,IODEND]	;Yes, end of file.
   982	001156'	602400	002000		TRNE T3,DSEOT		;EOT?
   983	001157'	670000	001753'		 TDO S,[IOLEND,,IOTEND]
   984	001160'	302540	000012		CAIE M,I.WF		;Writing?
   985	001161'	254000	001200'		 JRST RD		;No.
   986				    ;Writing complete.
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-5
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

   987	001162'	135340	000525*		LDB T2,PIOMOD
   988	001163'	305340	000016		CAIGE T2,DR		;Buffered mode?
   989	001164'	260040	001220'		 CALL FREBUF		;Yes, free buffer.
   990	001165'	336004	000532*	IOC:	SKIPN DEVCNT(F)		;More to do?
   991	001166'	254000	001034'		 JRST MTDONE		;No, operation complete.
   992	001167'	260040	001552'	IOC0:	CALL SRFX		;Yes, set up to do it.
   993					 JRST [ CALL SUBRG1
   994	001170'	254000	001760'			JRST IOC1]
   995	001171'	254000	001034'		  JRST MTDONE		;Here if buffered mode and nothing to do.
   996	001172'	607000	000001	IOC1:	TLNN S,IOW		;Is the user waiting for I/O to complete?
   997	001173'	263040	000000		 RET			;No, dismiss.
   998	001174'	135340	001162*		LDB T2,PIOMOD		;Yes, wake him up if it's buffered mode.
   999	001175'	305340	000016		CAIGE T2,DR
  1000	001176'	260040	001035*		 CALL SETIOD
  1001	001177'	263040	000000		RET			;Dismiss.
  1002				    ;Reading complete.
  1003	001200'	135340	001174*	RD:	LDB T2,PIOMOD		;Get software mode.
  1004	001201'	305340	000016		CAIGE T2,DR		;Buffered?
  1005	001202'	254000	001205'		 JRST RDB		;Yes.
  1006	001203'	260040	001222'		CALL SDMPCT		;Set DEVDWC.
  1007	001204'	254000	001165'		JRST IOC		;See if there's more to do.
  1008	001205'	260040	001220'	RDB:	CALL FREBUF		;Free buffer.
  1009	001206'	260040	001225'		CALL SBUFCT		;Set DEVBWC.
  1010	001207'	332004	001165*		SKIPE DEVCNT(F)		;More to do?
  1011	001210'	254000	001167'		 JRST IOC0		;Yes, start work on the next buffer.
  1012	001211'	254000	001034'		JRST MTDONE		;No.
  1013
  1014				;Here to clear various status bits.
  1015	001212'	201300	040011	FINOP:	MOVEI T1,F.DC+CS1TRE	;Clear RH11C, TU45 error state.
  1016	001213'	713315	000000		WRIO T1,CS1OFS(P2)
  1017	001214'	135300	001122*	CLRATA:	LDB T1,TUYTUN		;Clear ATA bit for this unit.
  1018	001215'	200306	001123*		MOVE T1,TIBTBL(T1)
  1019	001216'	713315	000016		WRIO T1,ASOFS(P2)
  1020	001217'	263040	000000		RET
  1021
  1022				;Here to free pages involved in a buffered mode I/O operation.
  1023	001220'	350004	000013	FREBUF:	AOS DEVABC(F)
  1024	001221'	254000	000211'		JRST BDIO
  1025
  1026				;Here to increment DEVDWC by the number of words transferred because of
  1027				; the last D or DR mode operation.
  1028	001222'	260040	001233'	SDMPCT:	CALL CNTWDS
  1029	001223'	272304	000531*		ADDM T1,DEVDWC(F)
  1030	001224'	263040	000000		RET
  1031
  1032				;After a B mode transfer, compute how many words were actually transferred.
  1033	001225'	260040	001233'	SBUFCT:	CALL CNTWDS
  1034	001226'	550304	000014		HRRZ T1,DEVBWC(F)
  1035	001227'	202346	000000		MOVEM T2,(T1)
  1036	001230'	340300	000000		AOJ T1,
  1037	001231'	542304	000014		HRRM T1,DEVBWC(F)
  1038	001232'	263040	000000		RET
  1039
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-6
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

  1040				;Return in T1 the words transferred by the last transfer.
  1041	001233'	712355	000002	CNTWDS:	RDIO T2,WCOFS(P2)
  1042	001234'	332000	000007		SKIPE T2
  1043	001235'	670340	001762'		 TDO T2,[-1,,600000]
  1044	001236'	200305	000000*		MOVE T1,TUBIWC(U)	;Initial word count.
  1045	001237'	274340	000006		SUB T2,T1
  1046	001240'	242340	777777		LSH T2,-1		;Convert to PDP10 words.
  1047	001241'	263040	000000		RET
  1048
  1049				;Here to start or continue error recovery procedure after transfer
  1050				; done interrupt.
  1051	001242'	202305	000747*	ERGO:	MOVEM T1,TUBER1(U)
  1052	001243'	260040	001454'		CALL SUBRG1
  1053	001244'	263040	000000		RET
  1054	001245'	202305	001242*	ERGO1:	MOVEM T1,TUBER1(U)
  1055	001246'	263040	000000		RET
  1056	001247'			RWERR:
  1057	001247'	712315	000014		RDIO T1,EROFS(P2)
  1058	001250'	302540	000011		CAIE M,I.RF
  1059	001251'	254000	001312'		 JRST WRERR
  1060	001252'	606300	102700		TRNN T1,ERINC+ERPEF+ERNSG+ERCS+ERCOR
  1061	001253'	254000	001374'		 JRST RDLOSE
  1062	001254'	201300	000024		MOVEI T1,24		;20. retries.
  1063	001255'	202305	000000*		MOVEM T1,TUBER2(U)
  1064	001256'	260040	001212'		CALL FINOP
  1065	001257'	201540	000004	RDERR:	MOVEI M,I.BSR		;Backup one record.
  1066	001260'	260040	000440'		CALL FT1CM2
  1067	001261'	265300	001245'		JSP T1,ERGO1
  1068	001262'	606340	040000		TRNN T2,CS1TRE
  1069	001263'	602400	040000		 TRNE T3,DSERR
  1070	001264'	254000	001374'		  JRST RDLOSE
  1071	001265'	260040	001212'		CALL FINOP
  1072	001266'	200305	000000*		MOVE T1,TUBCNT(U)	;Retry read operation.
  1073	001267'	202304	001207*		MOVEM T1,DEVCNT(F)
  1074	001270'	200305	000000*		MOVE T1,TUBCLS(U)
  1075	001271'	202304	000011		MOVEM T1,DEVCLS(F)
  1076	001272'	260040	001552'		CALL SRFX
  1077	001273'	255000	000000		 JFCL
  1078	001274'	201300	000011		MOVEI T1,I.RF
  1079	001275'	516304	001036*		HRLZM T1,DEVFNJ(F)
  1080	001276'	265300	001242'		JSP T1,ERGO
  1081	001277'	606340	040000		TRNN T2,CS1TRE
  1082	001300'	254000	001425'		 JRST RDWON
  1083	001301'	602340	020000		TRNE T2,CS1MCPE
  1084	001302'	254000	001306'		 JRST RDERR2
  1085	001303'	712315	000014		RDIO T1,EROFS(P2)
  1086	001304'	620300	001000		TRZ T1,ERFCE
  1087	001305'	322300	001425'		JUMPE T1,RDWON
  1088	001306'	377005	001255*	RDERR2:	SOSG TUBER2(U)		;Out of retries?
  1089	001307'	254000	001374'		 JRST RDLOSE
  1090	001310'	260040	001212'		CALL FINOP
  1091	001311'	254000	001257'		JRST RDERR
  1092	001312'	606300	102700	WRERR:	TRNN T1,ERINC+ERPEF+ERNSG+ERCS+ERCOR
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-7
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

  1093	001313'	254000	001375'		 JRST WRLOSE
  1094	001314'	201300	000024		MOVEI T1,24		;Number of retries.
  1095	001315'	202305	001306*		MOVEM T1,TUBER2(U)
  1096	001316'	712355	000006	WRERR1:	RDIO T2,FCOFS(P2)	;-Number of frames left.
  1097	001317'	260040	001212'		CALL FINOP
  1098	001320'	332000	000007		SKIPE T2
  1099	001321'	434340	001763'		 IOR T2,[-1,,760000]
  1100	001322'	274345	000000*		SUB T2,TUBIFC(U)	;Initial frame count.
  1101	001323'	135400	001764'		LDB T3,[POINT 2,S,^D28]	;Density specification.
  1102	001324'	302400	000003		CAIE T3,3
  1103	001325'	634400	000010		 TDZA T3,T3
  1104	001326'	201400	000001		  MOVEI T3,1		;1=PE, 0=NRZ.
  1105	001327'	317350	001765'		CAMG T2,[EXP NRSPE,NRSNRZ](T3)	;Wrote enough to matter?
  1106	001330'	254000	001354'		 JRST WRERR3		;No, so don't erase.
  1107	001331'	230350	001767'		IDIV T2,[EXP ^D1550*3,^D760*3](T3)
  1108	001332'	340340	000000		AOJ T2,
  1109	001333'	202345	001322*		MOVEM T2,TUBIFC(U)	;# of 3 in. segments to erase.
  1110	001334'	201540	000004		MOVEI M,I.BSR		;Back over record just written.
  1111	001335'	260040	000440'		CALL FT1CM2
  1112	001336'	265300	001245'		JSP T1,ERGO1
  1113	001337'	606340	040000		TRNN T2,CS1TRE
  1114	001340'	602400	040000		 TRNE T3,DSERR
  1115	001341'	254000	001375'		  JRST WRLOSE
  1116	001342'	260040	001212'		CALL FINOP
  1117	001343'	201540	000006	WRERR2: MOVEI M,I.EG		;Erase tape.
  1118	001344'	260040	000440'		CALL FT1CM2
  1119	001345'	265300	001245'		JSP T1,ERGO1
  1120	001346'	606340	040000		TRNN T2,CS1TRE
  1121	001347'	602400	040000		 TRNE T3,DSERR
  1122	001350'	254000	001375'		  JRST WRLOSE
  1123	001351'	260040	001212'		CALL FINOP
  1124	001352'	373005	001333*		SOSLE TUBIFC(U)
  1125	001353'	254000	001343'		 JRST WRERR2
  1126	001354'	200305	001266*	WRERR3: MOVE T1,TUBCNT(U)
  1127	001355'	202304	001267*		MOVEM T1,DEVCNT(F)
  1128	001356'	200305	001270*		MOVE T1,TUBCLS(U)
  1129	001357'	202304	000011		MOVEM T1,DEVCLS(F)
  1130	001360'	260040	001552'		CALL SRFX
  1131	001361'	255000	000000		 JFCL
  1132	001362'	515540	000012		HRLZI M,I.WF
  1133	001363'	202544	001275*		MOVEM M,DEVFNJ(F)
  1134	001364'	265300	001242'		JSP T1,ERGO
  1135	001365'	260040	001214'		CALL CLRATA
  1136	001366'	606340	040000		TRNN T2,CS1TRE
  1137	001367'	254000	001426'		 JRST WRWON
  1138	001370'	377005	001315*		SOSG TUBER2(U)
  1139	001371'	254000	001375'		 JRST WRLOSE
  1140	001372'	260040	001212'		CALL FINOP
  1141	001373'	254000	001316'		JRST WRERR1
  1142				;HERE WHEN ERROR RECOVERY DIDN'T WORK.
  1143	001374'	334540	001771'	RDLOSE:	SKIPA M,[I.RF]
  1144	001375'	201540	000012	WRLOSE:	 MOVEI M,I.WF
  1145	001376'	506544	001363*		HRLM M,DEVFNJ(F)
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 14-8
MAGSER.MAC	25-NOV-87 15:41		INTERRUPT PROCESSING

  1146	001377'	712355	000014		RDIO T2,EROFS(P2)
  1147	001400'	606340	102700		TRNN T2,ERINC+ERPEF+ERNSG+ERCS+ERCOR
  1148	001401'	664000	200000		 TROA S,IODERR		;Say device in error
  1149	001402'	660000	100000		  TRO S,IODTER		;Say medium fouled up.
  1150	001403'	602000	200000		TRNE S,IODERR		;Device error?
  1151	001404'	260040	001411'		 CALL RECDER		;Y, log it for CHKPNT.
  1152	001405'	712415	000012		RDIO T3,DSOFS(P2)
  1153	001406'	260040	001212'		CALL FINOP
  1154	001407'	402005	001245*		SETZM TUBER1(U)
  1155	001410'	254000	001152'		JRST RWDON2
  1156				;Here to record a device error for CHKPNT to look at.
  1157	001411'	550244	000613*	RECDER:	HRRZ U,DEVUDB(F)
  1158	001412'	350005	000000*		AOS TUBEC(U)		;One more device error.
  1159	001413'	200300	001772'		MOVE T1,[POINT 18,TUBSB(U)]	;Save registers.
  1160	001414'	550345	000450*		HRRZ T2,TUBKDB(U)
  1161	001415'	200347	000720*		MOVE T2,TKBCBA(T2)
  1162	001416'	505340	777762		HRLI T2,-16
  1163	001417'	200400	000007	RECDE1:	MOVE T3,T2
  1164	001420'	505400	000003		HRLI T3,3
  1165	001421'	712410	000000		RDIO T3,(T3)
  1166	001422'	136400	000006		IDPB T3,T1
  1167	001423'	253340	001417'		AOBJN T2,RECDE1
  1168	001424'	263040	000000		RET
  1169				;HERE WHEN ERROR RECOVERY SUCCEEDED IN COMPLETING OPERATION.
  1170	001425'	334540	001771'	RDWON:	SKIPA M,[I.RF]
  1171	001426'	201540	000012	WRWON:	 MOVEI M,I.WF
  1172	001427'	506544	001376*		HRLM M,DEVFNJ(F)
  1173	001430'	402005	001407*		SETZM TUBER1(U)
  1174	001431'	254000	001140'		JRST OD.RF
  1175
  1176
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 15
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1177				SUBTTL UTILITY SUBROUTINES.
  1178
  1179				COMMENT %@@SUBROUTINE RSBO
  1180				Reset status in S and UDB before operation is initiated.
  1181				@@EXPECTS U=UDB, F=DDB.
  1182				@@CALLS FSTHNG.
  1183				@@%
  1184
  1185	001432'	620000	004000	RSBO:	TRZ S,IOBOT
  1186	001433'	620000	764000		TRZ S,IOIMPM!IODERR!IODTER!IOBKTL!IODEND!IOBOT
  1187	001434'	261040	000006		PUSH P,T1
  1188	001435'	261040	000007		PUSH P,T2
  1189	001436'	261040	000016		PUSH P,P3
  1190	001437'	550105	001414*		HRRZ J,TUBKDB(U)	;KDB.
  1191	001440'	660000	010000		TRO S,IOACT		;Set S to reflect the start of I/O.
  1192	001441'	607000	001000		TLNN S,IOLEND
  1193	001442'	624000	002000		 TRZA S,IOTEND
  1194	001443'	660000	002000		  TRO S,IOTEND
  1195	001444'	202004	000002		MOVEM S,DEVIOS(F)	;Save S.
  1196	001445'	260040	001475'		CALL FSTHNG		;Reset hung device vars & clear previous fcn.
  1197	001446'	402004	001146*		SETZM DEVER1(F)		;No error status.
  1198	001447'	262040	000016		POP P,P3
  1199	001450'	262040	000007		POP P,T2
  1200	001451'	262040	000006		POP P,T1
  1201	001452'	263040	000000		RET
  1202
  1203				COMMENT %@@SUBROUTINE SUBRGO
  1204				Start device performing opertion specififed by Lh(DEVFNJ).
  1205				@@DESTROYS T2.
  1206				@@ENTRY U=UDB, F=DDB.
  1207				@@CALLS SUBRS0, RSBO.
  1208				@@%
  1209
  1210	001453'	260040	001432'	SUBRGO: CALL RSBO
  1211	001454'	554304	001427*	SUBRG1:	HLRZ T1,DEVFNJ(F)	;Function code.
  1212	001455'	554306	000412'		HLRZ T1,FT1TBL-1(T1)	;Device command for this code.
  1213	001456'	550345	001437*		HRRZ T2,TUBKDB(U)	;T2:=KDB.
  1214	001457'	200647	001415*		MOVE P2,TKBCBA(T2)	;Rh11C base address.
  1215	001460'	302300	000103		CAIE T1,F.RO+CS1IE
  1216	001461'	306300	000107		 CAIN T1,F.REWI+CS1IE
  1217	001462'	254000	001470'		  JRST SUBRG2
  1218	001463'	700600	000123*		DSKOFF
  1219	001464'	713315	000000		WRIO T1,CS1OFS(P2)
  1220	001465'	552247	000763*		HRRZM U,TKBCUN(T2)
  1221	001466'	700600	000143*		DSKON
  1222	001467'	263040	000000		RET
  1223	001470'	700600	001463*	SUBRG2:	DSKOFF			;Here on rewind.
  1224	001471'	713315	000000		WRIO T1,CS1OFS(P2)
  1225	001472'	542305	001032*		HRRM T1,TUBS(U)
  1226	001473'	700600	001466*		DSKON
  1227	001474'	263040	000000		RET
  1228
  1229
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 16
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1230				COMMENT %@@SUBROUTINE FSTHNG
  1231				Reset the hung timeout variables for the device
  1232				@@ENTRY U=UDB, F=DDB.
  1233				@@CALLS SETHNG.
  1234				@@CALLED UUO, I-level. @@%
  1235
  1236	001475'	513005	001074*	FSTHNG:	HLLZS UNITYP(U)		;CLEAR THE PREV WAS WAIT FLAG.
  1237	001476'	324740	000140*		PJRST SETHNG		;RESET THE HUNG TIME.
  1238
  1239				COMMENT %@@SUBROUTINE FHGSTP
  1240				Save some ACs and call HNGSTP, which tells the user that the device
  1241				he wants to use isn't ready.
  1242				@@ENTRY F=DDB.
  1243				@@DESTROYS T4.
  1244				@@CALLED UUO. @@%
  1245
  1246	001477'	261040	000005	FHGSTP:	PUSH P,U
  1247	001500'	261040	000003		PUSH P,PG
  1248	001501'	261040	000012		PUSH P,W
  1249	001502'	261040	000013		PUSH P,M
  1250	001503'	261040	000006		PUSH P,T1
  1251	001504'	261040	000007		PUSH P,T2
  1252	001505'	261040	000010		PUSH P,T3
  1253	001506'	260040	000000*		CALL HNGSTP
  1254	001507'	262040	000010		POP P,T3
  1255	001510'	262040	000007		POP P,T2
  1256	001511'	262040	000006		POP P,T1
  1257	001512'	262040	000013		POP P,M
  1258	001513'	262040	000012		POP P,W
  1259	001514'	262040	000003		POP P,PG
  1260	001515'	262040	000005		POP P,U
  1261	001516'	263040	000000		RET
  1262
  1263
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 17
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1264				COMMENT %@@SUBROUTINE UNISE0
  1265				Set up TC register before a transfer.
  1266				@@ENTRY S=DEVIOS, U=UDB, F=DDB.
  1267				@@DESTROYS T1.
  1268				@@CALLED UUO. @@%
  1269
  1270				;Density, index by software density minus 1.
  1271	001517'	000000	001400	DENTBL:	EXP 3B27,3B27,4B27
	001520'	000000	001400
	001521'	000000	002000
  1272
  1273				;Frames per word,,mode.  Index by software mode.
  1274	001522'	000005	000000	MODTBL:	5,,0B31			;0 Core dump
  1275	001523'	000004	000060		4,,3B31			;1 4 8-bit bytes per word
  1276	001524'	000005	000040		5,,2B31			;2 Ascii
  1277	001525'	000005	000040		5,,2B31			;3 Ascii
  1278
  1279	001526'	550244	001411*	UNISE0:	HRRZ U,DEVUDB(F)	;Get UDB of device.
  1280	001527'	550645	001456*		HRRZ P2,TUBKDB(U)	;KDB.
  1281	001530'	200655	001457*		MOVE P2,TKBCBA(P2)	;Rh11C base address.
  1282	001531'	261040	000007	UNISEL:	PUSH P,T2
  1283	001532'	135300	001764'		LDB T1,[POINT 2,S,^D28] ;Requested density.
  1284	001533'	336000	000006		SKIPN T1		;0 means, "system default".
  1285	001534'	201300	000003		 MOVEI T1,3		;System defult is the highest.
  1286	001535'	200306	001516'		MOVE T1,DENTBL-1(T1)
  1287	001536'	135340	001773'		LDB T2,[POINT 2,DEVMD1(F),35]	;Get software tape format.
  1288	001537'	670307	001522'		TDO T1,MODTBL(T2)
  1289	001540'	602000	001000		TRNE S,IOPAR
  1290	001541'	660300	000010		 TRO T1,TCEP
  1291	001542'	135340	000336*		LDB T2,TUYTMN		;Select TM02.
  1292	001543'	713355	000010		WRIO T2,CS2OFS(P2)
  1293	001544'	135340	001214*		LDB T2,TUYTUN
  1294	001545'	660307	000000		TRO T1,(T2)		;Select TU45A, and set mode information.
  1295	001546'	713315	000032		WRIO T1,TCOFS(P2)
  1296	001547'	712355	000012		RDIO T2,DSOFS(P2)
  1297	001550'	262040	000007		POP P,T2
  1298	001551'	263040	000000		RET
  1299
  1300
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 18
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1301				COMMENT %@@SUBROUTINE SRFX
  1302				In DEVCLS(F) is a pointer to a vector of "IOWDS" each of which is in the
  1303				format: bits 0-13: ones complement word count which specifies at
  1304				most one page; bits 14-35: one less than the first core address to be
  1305				used for this transfer.  The vector is terminated by a 0 word in D and DR
  1306				modes; in B mode, after each buffer is a 0 word and a second 0 word appears
  1307				after the last buffer.  Note that in B and D modes, the core addresses
  1308				to be used in a single transfer must be contiguous.
  1309				The device registers are set up according to this vector and the software
  1310				I/O mode.  In D mode, the entire list is done in one transfer.  This limits
  1311				the size of records to around 31. pages since the WC register can only
  1312				specify 2^16-1 18. bit words.  In DR mode, the list is stepped through
  1313				and 200 word records are read or written; successive transfers are
  1314				initiated at I-level (using DEVCNT as the state variable).  In B mode,
  1315				records are the same size as the buffers.
  1316				At I-level, the job is awakened after each buffer is trasferrd in B mode;
  1317				it is left in IOW until the entire transfer is finished in D or DR mode.
  1318				@@ENTRY F=DDB.
  1319				@@DESTROYS T1, T2, U.
  1320				@@CALLS UNISE0, STODTS, SDTCAL, AND RSBO.
  1321				@@ERRORS CERTAIN ILLEGAL DDB LISTS (TOO LARGE A BUFFER, A
  1322				ZERO DATA COUNT FOR D OR DR MODES) CAUSE A STOPCODE.
  1323				@@CALLED UUO, I-level. @@%
  1324
  1325	001552'	261040	000015	SRFX:	PUSH P,P2
  1326	001553'	261040	000011		PUSH P,T4
  1327	001554'	261040	000013		PUSH P,M
  1328	001555'	261040	000003		PUSH P,PG
  1329	001556'	260040	001526'		CALL UNISE0		;Setup TC register, U.
  1330	001557'	200304	001355*		MOVE T1,DEVCNT(F)	;Save for error recovery.
  1331	001560'	202305	001354*		MOVEM T1,TUBCNT(U)
  1332	001561'	200304	000011		MOVE T1,DEVCLS(F)
  1333	001562'	202305	001356*		MOVEM T1,TUBCLS(U)
  1334	001563'	336304	001557*		SKIPN T1,DEVCNT(F)	;Continuing?
  1335	001564'	200304	000011		 MOVE T1,DEVCLS(F)	;No.
  1336	001565'	336446	000000		SKIPN T4,(T1)		;Get the IOWD.
  1337	001566'	256000	001774'		 STOPCD (.,JOB,MTANIS,,<No IOWD in SRFX>)
  1338	001567'	135540	001777'		LDB M,[POINT 14,T4,13]	;Number of words to do on this page.
  1339	001570'	332004	001563*		SKIPE DEVCNT(F)
  1340	001571'	554544	001570*		 HLRZ M,DEVCNT(F)
  1341	001572'	135140	001200*		LDB PG,PIOMOD		;Get mode.
  1342	001573'	306140	000016		CAIN PG,DR		;Different code for different modes
  1343	001574'	254000	001613'		 JRST SRFDR
  1344	001575'	302140	000017		CAIE PG,D
  1345	001576'	254000	001601'		 JRST SRFB
  1346
  1347				    ;D mode.  One transfer uses the whole space specified by the vector.
  1348	001577'	260040	001642'		CALL SETADR
  1349	001600'	254000	001634'		JRST SRTDON
  1350
  1351				    ;B mode.  One record is transferred per buffer.
  1352	001601'	322540	001606'	SRFB:	JUMPE M,SRFB1		;J-No words to transfer
  1353	001602'	260040	001642'		CALL SETADR
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 18-2
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1354	001603'	400540	000000		SETZ M,			;See if there is another buffer.
  1355	001604'	200300	000007		MOVE T1,T2
  1356	001605'	254000	001626'		JRST SRFDR0
  1357	
  1358	001606'	332006	000001	SRFB1:	SKIPE 1(T1)		;Only legal if this is last word in the list
  1359	001607'	256000	002000'		 STOPCD (.,JOB,MTALNZ,,<Last word Not Zero>)
  1360	001610'	402004	001571*		SETZM DEVCNT(F)		;Not continuing
  1361	001611'	350001	777774		Aos	-4(P)		;Skip return
  1362	001612'	254000	001635'		Jrst	Srtdo1		;Tell higher level routine
  1363
  1364				    ;DR mode.  Record size is at most 200 words.
  1365	001613'	336440	000013	SRFDR:	SKIPN T4,M
  1366	001614'	256000	002003'		 STOPCD (.,JOB,MTAXIP,,<Xfer already in Progress>)
  1367	001615'	670440	000003'		TDO T4,MSKCTD
  1368	001616'	311440	002006'		CAML T4,[-200]
  1369	001617'	334540	000011		 SKIPA M,T4
  1370	001620'	211540	000200		  MOVNI M,200
  1371	001621'	274440	000013		SUB T4,M
  1372	001622'	261040	000011		PUSH P,T4
  1373	001623'	260040	001642'		CALL SETADR
  1374	001624'	262040	000013		POP P,M
  1375	001625'	326540	001632'		JUMPN M,SRFDR1		;Any more left on this IOWD?
  1376	001626'	340300	000000	SRFDR0:	AOJ T1,			;No, move on to the next.
  1377	001627'	336006	000000		SKIPN (T1)		;Have we reached the end of the vector?
  1378	001630'	634300	000006		 TDZA T1,T1		;No, zero continuation word.  I-level will
  1379								; wake up the job.
  1380	001631'	135540	002007'		  LDB M,[POINT 14,(T1),13]	;Yes, this many words to transfer.
  1381	001632'	552304	001610*	SRFDR1:	HRRZM T1,DEVCNT(F)	;Set up for I-level continuation.
  1382	001633'	506544	001632*		HRLM M,DEVCNT(F)
  1383				;	JRST SRTDON
  1384
  1385	001634'	260040	001432'	SRTDON:	CALL RSBO		;Set flags in S, clear DDB error variables.
  1386	001635'	262040	000003	Srtdo1:	POP P,PG
  1387	001636'	262040	000013		POP P,M
  1388	001637'	262040	000011		POP P,T4
  1389	001640'	262040	000015		POP P,P2
  1390	001641'	263040	000000		RET
  1391
  1392				;Set up memory registers for a transfer: the paging RAM, WC, FC, BA
  1393				; registers.
  1394				;On entry, T1/ Address of IOWD, and if in DR mode:
  1395				; T4/ -# words to transfer; M/ -# words in this IOWD;
  1396				; Lh(DEVCNT): -# words left to transfer on this IOWD, not including
  1397				; the current transfer.
  1398				;Returns with P2 set to the Rh11C base address, and T2 to the IOWD after
  1399				; the last one processed; thus (T2)=0 in D or B mode.
  1400	001642'	553000	000006	SETADR:	HRRZS T1
  1401	001643'	261040	000006		PUSH P,T1		;-2(P): address of current IOWD.
  1402	001644'	261040	000006		PUSH P,T1		;-1(P): address of first IOWD in DDB vector.
  1403	001645'	261040	002010'		PUSH P,[0]		;(P): words in transfer.
  1404	001646'	550645	001527*		HRRZ P2,TUBKDB(U)	;KDB
  1405	001647'	200655	001530*		MOVE P2,TKBCBA(P2)	;Get Rh11C base address.
  1406	001650'	135300	002011'		LDB T1,[POINT 9,@-1(P),35]	;1. Set BA register.
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 18-3
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1407	001651'	340300	000000		AOJ T1,			;First address used this page.
  1408	001652'	135440	001572*		LDB T4,PIOMOD
  1409	001653'	302440	000016		CAIE T4,DR
  1410	001654'	254000	001663'		 JRST SETAD0
  1411	001655'	574344	001633*		HLRE T2,DEVCNT(F)	;-Number of words left
  1412	001656'	322340	001663'		JUMPE T2,SETAD0
  1413	001657'	135440	002012'		LDB T4,[POINT 14,@-1(P),13]	;-Total words to transfer to this page.
  1414	001660'	670440	000003'		TDO T4,MSKCTD
  1415	001661'	274340	000011		SUB T2,T4		;Number of words done already.
  1416	001662'	271307	000000		ADDI T1,(T2)
  1417	001663'	405300	000777	SETAD0:	ANDI T1,777
  1418	001664'	242300	000002		LSH T1,2
  1419	001665'	271300	000000*		ADDI T1,UBAFST		;We use space starting here.+1 since IOWD.
  1420	001666'	713315	000004		WRIO T1,BAOFS(P2)
  1421	001667'	200300	002013'		MOVE T1,[UA3,,PGRADR+UBAFST/4000]	;2. Set UBA 3's paging RAM.
  1422	001670'	135340	002014'	SETXF1:	LDB T2,[POINT 21,@-2(P),35]	;PDP-10 page this -11 page goes to.
  1423	001671'	340340	000000		AOJ T2,
  1424	001672'	242340	777767		LSH T2,-9
  1425	001673'	201147	140000		MOVEI PG,PGRFST+PGRVAL(T2)
  1426	001674'	713160	000006		WRIO PG,@T1
  1427	001675'	340300	000000		AOJ T1,
  1428	001676'	135440	002015'		LDB T4,[POINT 14,@-2(P),13]	;This many words this page.
  1429	001677'	670440	000003'		TDO T4,MSKCTD
  1430	001700'	272441	000000		ADDM T4,(P)
  1431	001701'	350001	777776		AOS -2(P)
  1432	001702'	135440	001652*		LDB T4,PIOMOD
  1433	001703'	332021	777776		SKIPE @-2(P)		;Reached the end of the vector?
  1434	001704'	306440	000016		 CAIN T4,DR		;DR mode?
  1435	001705'	334000	000000		  SKIPA			;YvY: nothing more to do
  1436	001706'	254000	001670'		   JRST SETXF1		;N&N: process another IOWD.
  1437
  1438	001707'	200341	000000		MOVE T2,(P)		;3. Set up WC register.
  1439	001710'	306440	000016		CAIN T4,DR		;DR mode?
  1440	001711'	200340	000013		 MOVE T2,M		;Y, size already calculated.
  1441	001712'	242340	000001		LSH T2,1
  1442	001713'	713355	000002		WRIO T2,WCOFS(P2)
  1443	001714'	202345	001236*		MOVEM T2,TUBIWC(U)	;Save initial ord count.
  1444	001715'	262040	000007		POP P,T2		;(P). 4. Set up FC register.
  1445	001716'	135300	001773'		LDB T1,[POINT 2,DEVMD1(F),35]	;Software mode.
  1446	001717'	554306	001522'		HLRZ T1,MODTBL(T1)	;Frames per word.
  1447	001720'	221346	000000		IMULI T2,(T1)
  1448	001721'	713355	000006		WRIO T2,FCOFS(P2)
  1449	001722'	202345	001352*		MOVEM T2,TUBIFC(U)	;Save initial frame count for e.r.
  1450	001723'	262040	000006		POP P,T1		;-1(P)
  1451	001724'	262040	000007		POP P,T2		;-2(P)
  1452	001725'	263040	000000		RET
  1453
  1454	001726'	000003	763100		$END	(MAG)

  1455	001727'	040000	300000

  1456	001730'	260040	000000*

MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 18-4
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1457	001731'	556441	565142

  1458	001732'	000002	000000

  1459	001733'	111500	000006

  1460	001734'	260040	001730*

  1461	001735'	556441	514372

  1462	001736'	000002	000000

  1463	001737'	550413	000000

  1464	001740'	476013	000001

  1465	001741'	000000	000311'

  1466	001742'	000000	000317'

  1467	001743'	000000	000324'

  1468	001744'	124313	000001

  1469	001745'	000200	000013

  1470	001746'	000001	000001

  1471	001747'	001000	020000

  1472	001750'	201300	000100

  1473	001751'	713315	000000

  1474	001752'	254000	000732'

  1475	001753'	001000	002000

  1476	001754'	260040	001734*

  1477	001755'	556441	514643

  1478	001756'	000002	000000

  1479	001757'	000040	020000

  1480	001760'	260040	001454'

  1481	001761'	254000	001172'

  1482	001762'	777777	600000

  1483	001763'	777777	760000
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 18-5
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.


  1484	001764'	070200	000000

  1485	001765'	000000	000015

  1486	001766'	000000	000015

  1487	001767'	000000	011052

  1488	001770'	000000	004350

  1489	001771'	000000	000011

  1490	001772'	442205	000000*

  1491	001773'	000204	000407*

  1492	001774'	260040	001754*

  1493	001775'	556441	565163

  1494	001776'	000002	000000

  1495	001777'	261600	000011

  1496	002000'	260040	001774*

  1497	002001'	556441	545672

  1498	002002'	000002	000000

  1499	002003'	260040	002000*

  1500	002004'	556441	705160

  1501	002005'	000002	000000

  1502	002006'	777777	777600

  1503	002007'	261606	000000

  1504	002010'	000000	000000

  1505	002011'	001121	777777

  1506	002012'	261621	777777

  1507	002013'	000003	000000*

  1508	002014'	002521	777776

  1509	002015'	261621	777776

MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 18-6
MAGSER.MAC	25-NOV-87 15:41		UTILITY SUBROUTINES.

  1510						;End of MAGSER (MAGLIT: MAGEND:)
  1511
NO ERRORS DETECTED
PROGRAM BREAK IS 002016
7K CORE USED
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 19
MAGSER.MAC	25-NOV-87 15:41		SYMBOL TABLE

ASOFS		000016	SPD	D		000017	SIN	DSSDWN		000020	SPD	FTDVF2		000256'	
BAOFS		000004	SPD	DATASZ		000005'		DSSSC		000100	SPD	FTDVF5		000265'	
BDIO		000211'		DBYT		000002	SIN	DSTM		000004	SPD	FTDVF7		000267'	
BITTBL		000000	EXT	DCL		000007	SIN	DSWRL		004000	SPD	FTLEO1		000474'	
BUFKRN		000232'		DDI	777777	777777	SIN	DVSIZ		000003	SIN	FTLEOT		000470'	
CALL	260040	000000		DDINT		000001	SIN	DZAP		000012	SIN	FTOUT		000411'	
CHKCUN		000736'		DDIO		000171'		ERCOR		100000	SPD	FTP2		000367'	
CHKOF1		001030'		DDO	777777	777776	SIN	ERCPA		000010	SPD	FTP6		000375'	
CHKOF2		001025'		DDXZ		000000	SIN	ERCS		002000	SPD	FTPTBL		000354'	
CHKOFL		001020'		DECDI2		000177'		ERDPA		000040	SPD	FTSKB2		000445'	
CHKRW1		001014'		DENTBL		001517'		ERDTE		010000	SPD	FTSKBL		000446'	
CHKRW3		001015'		DEVABC		000013	SIN	ERFCE		001000	SPD	FXDSM1		001053'	
CHKRW4		000761'		DEVBWC		000014	SIN	ERFMT		000020	SPD	GETCTL		000553'	
CHKSSC		000753'		DEVCLS		000011	SIN	ERGO		001242'		HASCTL		020000	SPD
CKOFS		000020	SPD	DEVCNT		001655'	EXT	ERGO1		001245'		HNGSTP		001506'	EXT
CLRATA		001214'		DEVDIO		000521'	EXT	ERILF		000001	SPD	HNGTAP		040000	SPD
CNTWDS		001233'		DEVDWC		001223'	EXT	ERILR		000002	SPD	I.BF		000010	SPD
CPOPJ		000760'	EXT	DEVER1		001446'	EXT	ERINC		000100	SPD	I.BSR		000004	SPD
CPOPJ1		000276'	EXT	DEVFNJ		001454'	EXT	ERNEF		004000	SPD	I.EG		000006	SPD
CS1		010000	SPD	DEVIOS		000002	SIN	ERNSG		000400	SPD	I.REWI		000001	SPD
CS1A16		000400	SPD	DEVMD1		001773'	EXT	EROFS		000014	SPD	I.RF		000011	SPD
CS1A17		001000	SPD	DEVNAM		000000	SIN	EROPI		020000	SPD	I.RO		000005	SPD
CS1ADR		772440	SPD	DEVSTS		000012	SIN	ERPEF		000200	SPD	I.SF		000007	SPD
CS1DVA		004000	SPD	DEVUDB		001526'	EXT	ERRMR		000004	SPD	I.SKR		000003	SPD
CS1F0		000002	SPD	DGF		000015	SIN	ERUNS		040000	SPD	I.WF		000012	SPD
CS1F1		000004	SPD	DGTRD		000013	SIN	F		000004	INT	I.WTM		000002	SPD
CS1F2		000010	SPD	DHNG		000005	SIN	F.BSR		000033	SPD	INTERR		001133'	
CS1F3		000020	SPD	DIE		002003'	EXT	F.DC		000011	SPD	IO		000020	SIN
CS1F4		000040	SPD	DIN		000011	SIN	F.EG		000025	SPD	IOACT		010000	SIN
CS1GO		000001	SPD	DINI		000004	SIN	F.REWI		000007	SPD	IOBEG		000002	SIN
CS1IE		000100	SPD	DMT		000014	SIN	F.RF		000071	SPD	IOBKTL		040000	SIN
CS1MCP		020000	SPD	DOU		000010	SIN	F.RO		000003	SPD	IOBOT		004000	SIN
CS1OFS		000000	SPD	DPL		000237'		F.SKR		000031	SPD	IOC		001165'	
CS1PSE		002000	SPD	DR		000016	SIN	F.WF		000061	SPD	IOC0		001167'	
CS1RDY		000200	SPD	DRL		000006	SIN	F.WTM		000027	SPD	IOC1		001172'	
CS1SC		100000	SPD	DS		001000	SPD	FCOFS		000006	SPD	IODEND		020000	SIN
CS1TRE		040000	SPD	DS1600		000010	SPD	FFUERR		000303'		IODERR		200000	SIN
CS2		000002	SPD	DS800		000004	SPD	FFUGF2		000305'		IODTER		100000	SIN
CS2BAI		000010	SPD	DSATA		100000	SPD	FFUGF3		000306'		IOEND		000040	SIN
CS2CLR		000040	SPD	DSBOT		000002	SPD	FFUS1		000325'		IOIMPM		400000	SIN
CS2DLT		100000	SPD	DSDPR		000400	SPD	FFUS2		000332'		IOLEND		001000	SPD
CS2IR		000100	SPD	DSDRY		000200	SPD	FFUSTO		000315'		IOPAR		001000	SIN
CS2MDP		000400	SPD	DSEOT		002000	SPD	FHGSTP		001477'		IOTEND		002000	SIN
CS2MXF		001000	SPD	DSERR		040000	SPD	FINOP		001212'		IOW		000001	SIN
CS2NED		010000	SPD	DSIOB		000010	SPD	FINOUT		000060'		J		000002	INT
CS2NEM		004000	SPD	DSKPIF		001470'	EXT	FREBUF		001220'		JBTABT		000570'	EXT
CS2OFS		000010	SPD	DSKPIN		001473'	EXT	FSTHNG		001475'		JBTIOA		000542'	EXT
CS2OR		000200	SPD	DSMOL		010000	SPD	FT1CM2		000440'		JBTLIC		000274'	EXT
CS2PAT		000020	SPD	DSOFS		000012	SPD	FT1CMD		000425'		LICSPY		200000	SIN
CS2PGE		002000	SPD	DSOM		000001	SPD	FT1TBL		000413'		LICSYS		040000	SIN
CS2U0		000001	SPD	DSPES		000040	SPD	FT9TRK		000404'		LOADPT		040000	SPD
CS2UPE		020000	SPD	DSPIP		020000	SPD	FTAPE		000364'		M		000013	INT
CS2WOE		040000	SPD	DSPSIZ		000015	SPD	FTC		000011	SPD	MAGDDS		000014'	EXT
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88 PAGE 19-2
MAGSER.MAC	25-NOV-87 15:41		SYMBOL TABLE

MAGDSP		000011'	INT	PGRVAL		040000	SPD	SFDONE		010000	SPD	TMXRW1		000551'	
MAGEND		002015'	INT	PGYDIO		000244'	EXT	SGTDE0		000604'		TMXUGF		000300'	
MAGINI		000027'	INT	PIHIGH		000000	EXT	SGTDE1		000610'		TMXWRT		000516'	
MAGINT		000711'	INT	PILOW		000000	EXT	SGTDEV		000573'		TRK9		000100	SPD
MAGLIT		001726'	INT	PIOMOD		001702'	EXT	SPC		000465'		TU0CB		000254'	EXT
MAGPDP		000660'		PJOBN		000567'	EXT	SRFB		001601'		TUBCLS		001562'	EXT
MAGSER		000000'	ENT	PJRST	324740	000000		SRFB1		001606'		TUBCNT		001560'	EXT
MAXXFR		000006'		POPT4J		000207'		SRFDR		001613'		TUBDDB		000765'	EXT
MODTBL		001522'		PX.MEM		000004	SPD	SRFDR0		001626'		TUBEC		001412'	EXT
MSKCTD		000003'		PXCT	256000	000000		SRFDR1		001632'		TUBER1		001430'	EXT
MSKCTU		000004'		RD		001200'		SRFX		001552'		TUBER2		001370'	EXT
MSKMMD		777760	SPD	RDB		001205'		SRTDO1		001635'		TUBHC		000146'	EXT
MSKMMU		777700	SPD	RDERR		001257'		SRTDON		001634'		TUBIFC		001722'	EXT
MTAICZ		000243'	INT	RDERR2		001306'		SUBRG1		001454'		TUBIWC		001714'	EXT
MTAIFC		001067'	INT	RDIO	712000	000000		SUBRG2		001470'		TUBKDB		001646'	EXT
MTALNZ		001607'	INT	RDLOSE		001374'		SUBRGO		001453'		TUBS		001472'	EXT
MTANIB		000220'	INT	RDTIME	702200	000000		SYDCOM		000277'	EXT	TUBSB		001772'	EXT
MTANIS		001566'	INT	RDWON		001425'		SYDNM4		000266'	EXT	TUYTMN		001542'	EXT
MTAVAL		000565'	EXT	RECDE1		001417'		SYDTMX		000250'	INT	TUYTUN		001544'	EXT
MTAXIP		001614'	INT	RECDER		001411'		T1		000006	INT	U		000005	INT
MTDON1		001044'		RELCTL		000564'		T2		000007	INT	UA3		000003	SPD
MTDONE		001034'		RET	263040	000000		T3		000010	INT	UBAADR		763100	SPD
MTICE		001122'		RSBO		001432'		T4		000011	INT	UBACM0		000000	EXT
MTICE0		001113'		RWDON1		001154'		TAPEIN		020000	SPD	UBAFST		010465	SPD
MTPERR		000402'		RWDON2		001152'		TBVMAG		000636'		UBAINI		000100	SPD
MTREQ		000564'	EXT	RWDON3		001141'		TC		000002	SPD	UBATAP		000000	EXT
MTUDBL		000272'	EXT	RWERR		001247'		TCACC		100000	SPD	UBGOOD		000041'	EXT
MTWAIT		000554'	EXT	S		000000	INT	TCDE0		000400	SPD	UGET0		000311'	
MTXACS		000640'		S$ENTR	777777	777775	SIN	TCEAO		010000	SPD	UGET1		000317'	
NODIE		000000	EXT	S$EVEN		000006	SIN	TCEP		000010	SPD	UGET2		000324'	
NRSNRZ		000015	SPD	S$HALT	777777	777777	SIN	TCFCS		020000	SPD	UMOVE	704000	000000	
NRSPE		000015	SPD	S$INFO		000005	SIN	TCFS0		000020	SPD	UMOVEM	705000	000000	
OD.BF		001076'		S$JOB		000002	SIN	TCOFS		000032	SPD	UNISE0		001526'	
OD.BSR		001104'		S$NAME		000000'	SPD	TCSS0		000001	SPD	UNISEL		001531'	
OD.EG		001113'		S$NONA		000000	SIN	TCTCW		040000	SPD	UNITYP		001475'	EXT
OD.RF		001140'		S$PATC		000007	SIN	TIBTBL		001215'	EXT	W		000012	INT
OD.RO		001070'		S$TEMP	000002	000000	SPD	TKBCBA		001647'	EXT	WAIT1		000523'	EXT
OD.SF		001076'		S$XCT	777777	777776	SIN	TKBCUN		001465'	EXT	WCOFS		000002	SPD
OD.SKR		001104'		SAVAIL		000612'		TKBIUN		000753'	EXT	WRERR		001312'	
OD.WF		001140'		SAVAL2		000614'		TMX0CB		000717'	EXT	WRERR1		001316'	
OD.WTM		001113'		SAVAL4		000620'		TMXCL6		000110'		WRERR2		001343'	
ODD		001055'		SAVAL8		000625'		TMXCL7		000111'		WRERR3		001354'	
ODREW2		001047'		SAVDS		000635'		TMXCL8		000116'		WRIO	713000	000000	
OUTPB		004000	SIN	SBUFCT		001225'		TMXCLS		000071'		WRLOSE		001375'	
P		000001	INT	SDCIO2		000164'		TMXGRD		000627'		WRPI	700600	000000	
P1		000014	INT	SDCIO3		000166'		TMXHC2		000143'		WRPROT		400000	SPD
P2		000015	INT	SDCIO4		000167'		TMXHC3		000141'		WRTIME	702600	000000	
P3		000016	INT	SDCIOA		000161'		TMXHCT		000140'		WRWON		001426'	
PAGWAK		000246'	EXT	SDMPCT		001222'		TMXHN8		000146'		ZZ	445557	664555	SPD
PG		000003	INT	SETAD0		001663'		TMXHNG		000123'		
PGRADR		763000	SPD	SETADR		001642'		TMXIN1		000043'		
PGRFST		100000	SPD	SETHNG		001476'	EXT	TMXRED		000515'		
PGRVAL		040000	SPD	SETIOD		001176'	EXT	

MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

ASOFS	    77#	   302	   834	   951	  1019
BAOFS	    79#	  1420
BDIO	   357#	  1024
BITTBL	    39%
BUFKRN	   339	   365	   383#	   386
CHKCUN	   802	   815#
CHKOF1	   869	   876#
CHKOF2	   873#	   879
CHKOFL	   845	   868#
CHKRW1	   855	   863#
CHKRW3	   839	   847	   850	   862	   864#
CHKRW4	   833	   836#	   865
CHKSSC	   803	   830#
CKOFS	    82#
CLRATA	   844	   894	   965	  1017#	  1135
CNTWDS	  1028	  1033	  1041#
CPOPJ	    47%	   532	   560	   561	   564	   565	   835
CPOPJ1	    47%	   293	   426	   427
CS1	    61#
CS1A16	    61#
CS1A17	    61#
CS1ADR	    61#
CS1DVA	    61#
CS1F0	    61#
CS1F1	    61#
CS1F2	    61#
CS1F3	    61#
CS1F4	    61#
CS1GO	    61#	   805
CS1IE	    61#	   560	   561	   562	   563	   564	   565	   566	   567	   569	   570	   806	   858	   873
	   895	   938	  1215	  1216
CS1MCP	    61#	  1083
CS1OFS	    62#	   804	   807	   822	   852	   859	   874	   896	   939	   953	   961	   978	  1016	  1219
	  1224
CS1PSE	    61#
CS1RDY	    61#
CS1SC	    61#
CS1TRE	    61#	   853	   920	   927	   954	   960	   966	   977	  1015	  1068	  1081	  1113	  1120	  1136
CS2	    74#
CS2BAI	    74#
CS2CLR	    74#	   188
CS2DLT	    74#
CS2IR	    74#
CS2MDP	    74#
CS2MXF	    74#
CS2NED	    74#
CS2NEM	    74#
CS2OFS	    74#	   179	   189	   490	   799	  1292
CS2OR	    74#
CS2PAT	    74#
CS2PGE	    74#
CS2U0	    74#
CS2UPE	    74#
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

CS2WOE	    74#
D	  1344
DATASZ	   110#
DBYT	   139#
DCL	   144#
DDI	   134#
DDINT	   138#
DDIO	   321	   333#
DDO	   133#
DDXZ	   137#
DECDI2	   339#	   344
DENTBL	  1271#	  1286
DEVABC	   681	  1023
DEVBWC	  1034	  1037
DEVCLS	   660	  1075	  1129	  1332	  1335
DEVCNT	    42%	   670	   990	  1010	  1073	  1127	  1330	  1334	  1339	  1340	  1360	  1381	  1382	  1411
DEVDIO	    43%	   334	   362	   367	   661
DEVDWC	    42%	   469	   669	  1029
DEVER1	    43%	   298	   973	  1197
DEVFNJ	    42%	   205	   316	   322	   555	   587	   609	   676	   823	   860	   885	  1079	  1133	  1145
	  1172	  1211
DEVIOS	   207	   239	   249	   275	   291	   483	   556	   602	   605	   759	   819	   841	   892	  1195
DEVMD1	    43%	   206	   554	  1287	  1445
DEVNAM	   414	   421
DEVSTS	   208
DEVUDB	    42%	   230	   280	   462	   486	   598	   671	   750	  1157	  1279
DGF	   150#
DGTRD	   148#
DHNG	   142#
DIE	    26	    26%	    27	   364	   394	   918	  1337	  1359	  1366
DIN	   146#
DINI	   141#
DMT	   149#
DOU	   145#
DPL	   383	   390#
DR	   341	   467	   666	   988	   999	  1004	  1342	  1409	  1434	  1439
DRL	   143#
DS	    75#
DS1600	    91#	   185	   726
DS800	    92#	   185	   726
DSATA	    75#
DSBOT	    75#	   497	   947
DSDPR	    75#
DSDRY	    75#
DSEOT	    75#	   499	   931	   944	   982
DSERR	    75#	   854	   921	   928	   955	   967	  1069	  1114	  1121
DSIOB	    75#
DSKPIF	    49%	   274	  1218	  1223
DSKPIN	    49%	   290	  1221	  1226
DSMOL	    75#	   183	   724	   870	   876	   923
DSOFS	    75#	   182	   493	   723	   800	   821	   843	   940	   952	  1152	  1296
DSOM	    75#
DSPES	    75#
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

DSPIP	    75#	   849
DSPSIZ	   137	   151#
DSSDWN	    75#
DSSSC	    75#	   832
DSTM	    75#	   931	   942	   980
DSWRL	    75#	   495
DVSIZ	   140#
DZAP	   147#
ERCOR	    78#	  1060	  1092	  1147
ERCPA	    78#
ERCS	    78#	  1060	  1092	  1147
ERDPA	    78#
ERDTE	    78#
ERFCE	    78#	   935	   974	  1086
ERFMT	    78#
ERGO	  1051#	  1080	  1134
ERGO1	  1054#	  1067	  1112	  1119
ERILF	    78#
ERILR	    78#
ERINC	    78#	  1060	  1092	  1147
ERNEF	    78#
ERNSG	    78#	  1060	  1092	  1147
EROFS	    78#	   934	   972	  1057	  1085	  1146
EROPI	    78#
ERPEF	    78#	  1060	  1092	  1147
ERRMR	    78#
ERUNS	    78#
F	   205	   206	   207	   208	   226	   230	   239	   249	   275	   280	   291	   298	   316	   322
	   334	   362	   367	   462	   469	   483	   486	   554	   555	   556	   587	   598	   602	   605
	   609	   660	   661	   669	   670	   671	   676	   681	   750	   759	   818	   819	   823	   840
	   841	   860	   885	   892	   973	   990	  1010	  1023	  1029	  1034	  1037	  1073	  1075	  1079
	  1127	  1129	  1133	  1145	  1157	  1172	  1195	  1197	  1211	  1279	  1287	  1330	  1332	  1334
	  1335	  1339	  1340	  1360	  1381	  1382	  1411	  1445
F.BSR	    67#	   563	   567
F.DC	    70#	   858	   873	   938	   960	   977	  1015
F.EG	    69#	   565
F.REWI	    64#	   560	  1216
F.RF	    71#	   569
F.RO	    68#	   564	  1215
F.SKR	    66#	   562	   566
F.WF	    72#	   570
F.WTM	    65#	   561
FCOFS	    81#	   601	   613	  1096	  1448
FFUERR	   458#	   468
FFUGF2	   457	   461#
FFUGF3	   462#
FFUS1	   480#	   484
FFUS2	   479	   481	   485#
FFUSTO	   470#
FHGSTP	   248	   482	   755	   762	  1246#
FINOP	  1015#	  1064	  1071	  1090	  1097	  1116	  1123	  1140	  1153
FINOUT	   175	   190#
FREBUF	   682	   989	  1008	  1023#
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

FSTHNG	   899	  1196	  1236#
FT1CM2	   244	   580	   587#	   626	   630	   636	   644	  1066	  1111	  1118
FT1CMD	   521	   522	   524	   525	   526	   528	   575#
FT1TBL	   559#	   589	  1212
FT9TRK	   537	   551#
FTAPE	   149	   530#
FTC	   317	   568#
FTDVF2	   408	   411#	   416
FTDVF5	   415	   418#
FTDVF7	   410	   420#
FTLEO1	   628#	   639
FTLEOT	   525	   624#
FTOUT	   548	   556#
FTP2	   534#
FTP6	   540#
FTPTBL	   521#	   542	   543
FTSKB2	   566	   567	   596#
FTSKBL	   597#	   611
FXDSM1	   899#
GETCTL	   243	   485	   578	   608	   624	   628	   634	   642	   664	   693#	   721
GINST	   455#	   455	   456	   458#	   458	   459	   474#	   474	   475	   475#	   476	   476#	   477
HASCTL	    95#	   296	   700	   889
HNGSTP	    48%	  1253
HNGTAP	    96#	   246	   250	   760
I.BF	   567#	   913#
I.BSR	   236	   563#	   625	   643	   909#	  1065	  1110
I.EG	   565#	   911#	  1117
I.REWI	   560#	   583	   886	   906#
I.RF	   569#	   673	   914#	  1058	  1078	  1143	  1170
I.RO	   564#	   584	   887	   910#
I.SF	   566#	   629	   912#
I.SKR	   562#	   635	   908#
I.WF	   570#	   675	   915#	   984	  1132	  1144	  1171
I.WTM	   229	   234	   561#	   907#
INTERR	   863	   922	   958#
IO	   657	   658	   674
IOACT	   276	   891	  1191
IOBEG	   667
IOBKTL	  1186
IOBOT	   856	   948	  1185	  1186
IOC	   990#	  1007
IOC0	   992#	  1011
IOC1	   994	   996#
IODEND	   238	   638	   640	   943	   981	  1186
IODERR	   246	   958	  1148	  1150	  1186
IODTER	   246	  1149	  1186
IOEND	   943	   981
IOIMPM	   232	   547	  1186
IOLEND	    97#	   632	   638	   857	   945	   946	   983	  1192
IOPAR	  1289
IOTEND	   857	   945	   946	   983	  1193	  1194
IOW	   883	   996
J	   338	   345	   361	   368	   425	   695	   696	   698	   699	   704	   705	   706	   707	   796
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

	   797	   815	   817	   830	   838	  1190
JBTABT	    40%	   698	   706
JBTIOA	    48%	   320	   678
JBTLIC	    48%	   425
LICSPY	   424
LICSYS	   424
LISTSN	     3	     6
LOADPT	    88#	   498
M	   229	   234	   236	   405	   406	   422	   428	   455	   458	   470	   474	   475	   476	   501
	   531	   532	   536	   538	   540	   541	   542	   543	   551	   553	   575	   576	   579	   581
	   582	   583	   584	   587	   589	   609	   625	   629	   635	   643	   823	   826	   860	   885
	   886	   887	   984	  1058	  1065	  1110	  1117	  1132	  1133	  1143	  1144	  1145	  1170	  1171
	  1172	  1249	  1257	  1327	  1338	  1340	  1352	  1354	  1365	  1369	  1370	  1371	  1374	  1375
	  1380	  1382	  1387	  1440
MAGDDS	    39%	   140
MAGDSP	   100	   136#
MAGEND	  1510#
MAGINI	   100	   141	   164#
MAGINT	   100	   790#	   812
MAGLIT	  1454#
MAGPDP	   788#	   795
MAGSER	    26	    27#	    30
MAXXFR	   119#
MODTBL	  1274#	  1288	  1446
MSKCTD	   102#	  1367	  1414	  1429
MSKCTU	   104#
MSKMMD	   106#
MSKMMU	   108#
MTAICZ	   394#
MTAIFC	   906	   918#
MTALNZ	  1359#
MTANIB	   364#
MTANIS	  1337#
MTAVAL	    40%	   703
MTAXIP	  1366#
MTDON1	   888	   891#
MTDONE	   883#	   957	   962	   991	   995	  1012
MTICE	   861	   925	   949#
MTICE0	   936	   937	   942#
MTPERR	   521	   522	   523	   526	   527	   539	   547#	   552
MTREQ	    40%	   693	   702
MTUDBL	    39%	   423
MTWAIT	    40%	   694
MTXACS	   787#	   792	   793	   794	   809
NODIE	    26%
NRSNRZ	   125#	  1105
NRSPE	   124#	  1105
OD.BF	   913	   926#
OD.BSR	   909	   933#
OD.EG	   911	   941#
OD.RF	   914	   964#	  1174
OD.RO	   910	   920#
OD.SF	   912	   926#
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

OD.SKR	   908	   933#
OD.WF	   915	   964#
OD.WTM	   907	   941#
ODD	   826	   905#
ODREW2	   894#
OUTPB	   226
P	    27	    34	    35	   164	   165	   174	   190	   191	   278	   279	   288	   289	   304	   333
	   337	   338	   345	   346	   347	   357	   358	   359	   360	   361	   364	   368	   369	   370
	   371	   372	   394	   579	   581	   596	   695	   699	   704	   707	   719	   720	   729	   730
	   732	   749	   764	   767	   768	   770	   771	   795	   836	   864	   918	  1187	  1188	  1189
	  1198	  1199	  1200	  1246	  1247	  1248	  1249	  1250	  1251	  1252	  1254	  1255	  1256	  1257
	  1258	  1259	  1260	  1282	  1297	  1325	  1326	  1327	  1328	  1337	  1359	  1361	  1366	  1372
	  1374	  1386	  1387	  1388	  1389	  1401	  1402	  1403	  1406	  1413	  1422	  1428	  1430	  1431
	  1433	  1438	  1444	  1450	  1451
P1	   427
P2	   599	   600	   601	   613	   720	   723	   729	   797	   799	   800	   804	   807	   821	   822
	   834	   843	   852	   859	   874	   896	   934	   939	   940	   951	   952	   953	   961	   972
	   978	  1016	  1019	  1041	  1057	  1085	  1096	  1146	  1152	  1214	  1219	  1224	  1280	  1281
	  1292	  1295	  1296	  1325	  1389	  1404	  1405	  1420	  1442	  1448
P3	   164	   171	   173	   179	   181	   182	   189	   191	   279	   282	   288	   302	  1189	  1198
PAGWAK	    49%	   397
PG	   337	   346	   360	   369	   391	  1247	  1259	  1328	  1341	  1342	  1344	  1386	  1425	  1426
PGRADR	  1421
PGRFST	  1425
PGRVAL	  1425
PGYDIO	    49%	   392	   395
PIHIGH	    39%	   168
PILOW	    39%
PIOMOD	    47%	   340	   466	   665	   987	   998	  1003	  1341	  1408	  1432
PJOBN	    48%	   319	   677	   696	   705
POPT4J	   336	   347#
PX.MEM	   455	   458	   474	   475	   476
RD	   985	  1003#
RDB	  1005	  1008#
RDERR	  1065#	  1091
RDERR2	  1084	  1088#
RDLOSE	  1061	  1070	  1089	  1143#
RDWON	  1082	  1087	  1170#
RECDE1	  1163#	  1167
RECDER	   959	  1151	  1157#
RELCTL	   297	   502	   585	   683	   697	   702#	   728	   890
RSBO	  1185#	  1210	  1385
RWDON1	   969	   980#
RWDON2	   977#	  1155
RWDON3	   966#
RWERR	   975	   976	  1056#
S	   207	   232	   238	   239	   246	   249	   250	   275	   276	   291	   296	   483	   547	   556
	   602	   605	   606	   632	   638	   640	   657	   658	   667	   674	   700	   759	   760	   819
	   841	   856	   857	   883	   889	   891	   892	   929	   930	   932	   943	   945	   946	   948
	   958	   981	   983	   996	  1101	  1148	  1149	  1150	  1185	  1186	  1191	  1192	  1193	  1194
	  1195	  1283	  1289
S$ENTR	    26	    32	   365	   395	   919	  1338	  1360	  1367
S$EVEN	   364	   394	   918	  1337	  1359	  1366
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

S$HALT	    26	   364	   394	   918	  1337	  1359	  1366
S$INFO	   364	   394	   918	  1337	  1359	  1366
S$JOB	   364	   365	   394	   395	   918	   919	  1337	  1338	  1359	  1360	  1366	  1367
S$NAME	    30#
S$NONA	    29	    32	   365	   395	   919	  1338	  1360	  1367
S$PATC	   364	   394	   918	  1337	  1359	  1366
S$TEMP	    26#	    26	   364#	   364	   394#	   394	   918#	   918	  1337#	  1337	  1359#	  1359	  1366#	  1366
S$XCT	    32	   365	   395	   919	  1338	  1360	  1367
SAVAIL	   242	   534	   659	   749#	   769
SAVAL2	   753#	   756
SAVAL4	   754	   759#	   763
SAVAL8	   761	   764#
SAVDS	   785#	   801	   831
SBUFCT	  1009	  1033#
SDCIO2	   319#	   684
SDCIO3	   321#
SDCIO4	   318	   322#
SDCIOA	   303	   316#	   893
SDMPCT	  1006	  1028#
SETAD0	  1410	  1412	  1417#
SETADR	  1348	  1353	  1373	  1400#
SETHNG	    47%	   287	  1237
SETIOD	    47%	   884	  1000
SETXF1	  1422#	  1436
SFDONE	    94#	   606	   929	   930	   932
SGTDE0	   728#	   733
SGTDE1	   725	   732#
SGTDEV	   480	   719#	   753
SPC	   562	   563	   612#
SRFB	  1345	  1352#
SRFB1	  1352	  1358#
SRFDR	  1343	  1365#
SRFDR0	  1356	  1376#
SRFDR1	  1375	  1381#
SRFX	   679	   992	  1076	  1130	  1325#
SRTDO1	  1362	  1386#
SRTDON	  1349	  1385#
SUBRG1	   685	   993	  1052	  1211#
SUBRG2	  1217	  1223#
SUBRGO	   591	   603	  1210#
SYDCOM	    48%	   428
SYDNM4	    48%	   412	   417	   419
SYDTMX	   100	   405#
T1	   140	   173	   178	   179	   180	   181	   182	   183	   184	   185	   186	   188	   189	   283
	   284	   285	   286	   300	   301	   302	   316	   317	   319	   320	   335	   343	   357	   363
	   372	   385	   390	   391	   392	   393	   395	   396	   406	   408	   414	   420	   421	   422
	   423	   463	   466	   467	   469	   470	   473	   474	   475	   476	   479	   489	   490	   491
	   492	   493	   495	   497	   499	   535	   542	   543	   544	   553	   554	   589	   590	   660
	   661	   662	   665	   666	   673	   675	   676	   697	   698	   749	   764	   798	   799	   800
	   801	   804	   805	   806	   807	   824	   825	   830	   836	   837	   858	   859	   864	   865
	   895	   896	   934	   935	   937	   938	   939	   949	   950	   951	   960	   961	   977	   978
	  1015	  1016	  1017	  1018	  1019	  1029	  1034	  1035	  1036	  1037	  1044	  1045	  1051	  1054
	  1057	  1060	  1062	  1063	  1067	  1072	  1073	  1074	  1075	  1078	  1079	  1080	  1085	  1086
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

	  1087	  1092	  1094	  1095	  1112	  1119	  1126	  1127	  1128	  1129	  1134	  1159	  1166	  1187	  1200
	  1211	  1212	  1215	  1216	  1219	  1224	  1225	  1250	  1256	  1283	  1284	  1285	  1286	  1288
	  1290	  1294	  1295	  1330	  1331	  1332	  1333	  1334	  1335	  1336	  1355	  1358	  1376	  1377
	  1378	  1380	  1381	  1400	  1401	  1402	  1406	  1407	  1416	  1417	  1418	  1419	  1420	  1421
	  1426	  1427	  1445	  1446	  1447	  1450
T2	   172	   177	   187	   281	   282	   340	   341	   358	   371	   407	   411	   416	   418	   424
	   425	   473	   487	   488	   490	   492	   493	   494	   496	   498	   500	   501	   597	   601
	   612	   613	   677	   678	   822	   831	   832	   834	   835	   846	   847	   852	   853	   868
	   869	   873	   874	   920	   927	   953	   954	   966	   972	   973	   974	   976	   987	   988
	   998	   999	  1003	  1004	  1035	  1041	  1042	  1043	  1045	  1046	  1068	  1081	  1083	  1096
	  1098	  1099	  1100	  1105	  1107	  1108	  1109	  1113	  1120	  1136	  1146	  1147	  1160	  1161
	  1162	  1163	  1167	  1188	  1199	  1213	  1214	  1220	  1251	  1255	  1282	  1287	  1288	  1291
	  1292	  1293	  1294	  1296	  1297	  1355	  1411	  1412	  1415	  1416	  1422	  1423	  1424	  1425
	  1438	  1440	  1441	  1442	  1443	  1444	  1447	  1448	  1449	  1451
T3	   166	   167	   168	   169	   170	   171	   172	   455	   456	   464	   719	   723	   724	   726
	   727	   730	   767	   771	   821	   843	   849	   854	   870	   876	   921	   923	   928	   931
	   940	   942	   944	   947	   952	   955	   967	   980	   982	  1069	  1101	  1102	  1103	  1104
	  1105	  1107	  1114	  1121	  1152	  1163	  1164	  1165	  1166	  1252	  1254
T4	   333	   334	   335	   343	   344	   347	   359	   362	   363	   366	   367	   370	   384	   385
	   768	   770	   848	   850	  1326	  1336	  1338	  1365	  1367	  1368	  1369	  1371	  1372	  1388
	  1408	  1409	  1413	  1414	  1415	  1428	  1429	  1430	  1432	  1434	  1439
TAPEIN	    89#	   500
TBVMAG	   786#	   791	   811
TC	    80#
TCACC	    80#
TCDE0	    80#
TCEAO	    80#
TCEP	    80#	  1290
TCFCS	    80#
TCFS0	    80#
TCOFS	    80#	   181	   492	  1295
TCSS0	    80#
TCTCW	    80#
TIBTBL	    39%	   301	   950	  1018
TKBCBA	    41%	   171	   282	   488	   600	   797	  1161	  1214	  1281	  1405
TKBCUN	    41%	   815	   817	   838	  1220
TKBIUN	    41%	   172	   407	   830
TMX0CB	    39%	   170	   407	   796
TMXCL6	   231	   235	   237	   242#
TMXCL7	   243#	   252
TMXCL8	   248#	   251
TMXCLS	   144	   226#
TMXGRD	   148	   767#
TMXHC2	   277	   290#
TMXHC3	   288#	   305
TMXHCT	   287#
TMXHN8	   284	   295#
TMXHNG	   142	   273#
TMXIN1	   177#	   187
TMXRED	   134	   146	   657#
TMXREL	   143	   204#
TMXRW1	   680	   685#
TMXUGF	   150	   455#
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Symbol cross reference

TMXWRT	   133	   145	   658#
TRK9	    90#
TU0CB	    39%	   409
TUBCLS	    50%	  1074	  1128	  1333
TUBCNT	    50%	  1072	  1126	  1331
TUBDDB	    44%	   413	   420	   818	   840
TUBEC	    45%	  1158
TUBER1	    50%	   299	   672	   824	  1051	  1054	  1154	  1173
TUBER2	    50%	  1063	  1088	  1095	  1138
TUBHC	    44%	   295
TUBIFC	    50%	  1100	  1109	  1124	  1449
TUBIWC	    44%	  1044	  1443
TUBKDB	    44%	   281	   487	   599	  1160	  1190	  1213	  1280	  1404
TUBS	    44%	   846	   848	   851	   868	   872	   878	  1225
TUBSB	    45%	  1159
TUYTMN	    44%	   178	   489	  1291
TUYTUN	    44%	   180	   300	   491	   949	  1017	  1293
U	   165	   177	   186	   190	   230	   278	   280	   281	   283	   286	   289	   295	   299	   409
	   411	   413	   414	   418	   420	   462	   463	   486	   487	   535	   598	   599	   662	   671
	   672	   727	   750	   815	   818	   824	   837	   838	   840	   846	   848	   851	   868	   872
	   878	   924	  1044	  1051	  1054	  1063	  1072	  1074	  1088	  1095	  1100	  1109	  1124	  1126
	  1128	  1138	  1154	  1157	  1158	  1159	  1160	  1173	  1190	  1213	  1220	  1225	  1236	  1246
	  1260	  1279	  1280	  1331	  1333	  1404	  1443	  1449
UA3	   167	   169	  1421
UBAADR	   167	   169
UBACM0	   117%
UBAFST	   118#	   119	  1419	  1421
UBAINI	   166
UBATAP	   117%	   118
UBGOOD	   174%	   174
UGET0	   464	   466#
UGET1	   464	   473#
UGET2	   464	   479#
UNISE0	   588	   610	   722	  1279#	  1329
UNISEL	   820	   842	  1282#
UNITYP	    44%	   186	   283	   286	   463	   535	   662	   727	   924	  1236
W	  1248	  1258
WAIT1	    47%	   204	   228	   245	   461	   530	   604	   627	   631	   637	   663
WCOFS	    76#	  1041	  1442
WRERR	  1059	  1092#
WRERR1	  1096#	  1141
WRERR2	  1117#	  1125
WRERR3	  1106	  1126#
WRLOSE	  1093	  1115	  1122	  1139	  1144#
WRPROT	    87#	   496
WRWON	  1137	  1171#
ZZ	    61#	    61	    74#	    74	    75#	    75	    76#	    77#	    78#	    78	    79#	    80#	    80	    81#
	    82#	   455#	   455	   458#	   458	   474#	   474	   475#	   475	   476#	   476
ZZ1	   455#	   455	   458#	   458	   474#	   474	   475#	   475	   476#	   476
MAGSER Quick and dirty tape service routine for KS-10 TM02s	MACRO 12.5-46.0 14:16 13-JAN-88
MAGSER.MAC	25-NOV-87 15:41		Macro/Opdef cross reference

CALL	    34#	   204	   228	   231	   235	   237	   242	   243	   244	   245	   248	   287	   297	   303
	   321	   339	   365	   383	   461	   480	   482	   485	   530	   534	   578	   580	   585	   588
	   590	   603	   604	   608	   610	   624	   626	   627	   628	   630	   631	   634	   636	   637
	   642	   659	   663	   664	   679	   682	   683	   685	   694	   721	   722	   728	   753	   755
	   762	   769	   802	   803	   820	   842	   844	   845	   861	   863	   884	   890	   893	   894
	   899	   959	   965	   989	   992	   993	  1000	  1006	  1008	  1009	  1028	  1033	  1052	  1064
	  1066	  1071	  1076	  1090	  1097	  1111	  1116	  1118	  1123	  1130	  1135	  1140	  1151	  1153
	  1196	  1210	  1253	  1329	  1348	  1353	  1373	  1385
DSKOFF	   269#	   274	  1218	  1223
DSKON	   270#	   290	  1221	  1226
EXTIO	    61
PJRST	   397	   502	   591	   684	  1237
PRINTF	    10#
PXCT	   455	   458	   474	   475	   476
PXGEN	   455	   458	   474	   475	   476
RDIO	   182	   493	   723	   800	   804	   821	   822	   834	   843	   852	   934	   940	   952	   953
	   972	  1041	  1057	  1085	  1096	  1146	  1152	  1165	  1296
RDTIME	   791
RET	    35#	   138	   147	   192	   209	   227	   233	   240	   247	   323	   348	   373	   387	   398
	   459	   471	   477	   557	   586	   607	   614	   633	   641	   686	   701	   708	   731	   765
	   772	   816	   827	   866	   871	   875	   877	   897	   900	   997	  1001	  1020	  1030	  1038
	  1047	  1053	  1055	  1168	  1201	  1222	  1227	  1261	  1298	  1390	  1452
RHREG	    54#	    74	    75	    76	    77	    78	    79	    80	    81	    82
STOPCD	    25	   364	   394	   918	  1337	  1359	  1366
TBSAVE	   791
TBSET	   811
UHRRZ	   455
UMOVE	   406
UMOVEM	   422	   470	   501
WRIO	   167	   169	   179	   181	   189	   302	   490	   492	   601	   613	   799	   807	   859	   874
	   896	   939	   951	   961	   978	  1016	  1019	  1219	  1224	  1292	  1295	  1420	  1426	  1442
	  1448
WRPI	   274	   290	  1218	  1221	  1223	  1226
WRTIME	   811
XCTBU	   455
XCTTU	   458	   474	   475	   476
$END	  14542 K
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE	LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420
     9				SUBTTL	T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71
    10
    11					STOPCD(,ENTRY,LPTSER)^
    12					ENTRY	LPTSER		;For library searches
    13	000000'	260040	000000*	LPTSER::PUSHJ	P,DIE		;**** Default stopcode for "LPTSER" ****
    14	000001'	546064	634562		SIXBIT	/LPTSER/  	;Title of module
    15	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "LPTSER+nnn(nnnnnn)"
    16			000000'	S$NAME==LPTSER			;For STOPCDs with no arguments
    17					SALL>
    18				^
    19
    20				IFNCPU(<KI,KL>),<PRINTX ?This version of LPTSER works on KI and KL only
    21						END>
    22
    23				;THE FOLLOWING EXTERNAL SYMBOLS ARE DEFINED IN COMMON:
    24
    25					EXTERNAL CPOPJ1,CPOPJ
    26
    27				;THE FOLLOWING EXTERNAL SYMBOLS ARE DEFINED IN CLOCK1:
    28
    29					EXTERNAL SETIOD
    30
    31				;THE FOLLOWING EXTERNAL SYMBOLS ARE DEFINED IN ERRCON:
    32
    33					EXTERNAL HNGSTP, ERROCI
    34
    35				;THE FOLLOWING EXTERNAL SYMBOLS ARE DEFINED IN UUOCON:
    36
    37					EXTERNAL ADVBFE, IOSET, OUT, SETACT, STOIOS, DEVERR
    38
    39				;THE FOLLOWING SYMBOLS ARE REFERENCED OUTSIDE OF LPTSER:
    40
    41					INTERN	LPTINT, LPTNXT, LPTECM, LPTDON, LPTDSP
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 2
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

    42				;LINE PRINTER CONTROL REGISTER MNEMONIC DEFINITIONS
    43
    44			002000		LPTCLR==1B25			;CLEAR LINE PRINTER BUFFER
    45			001000		LPTLOV==1B26			;LINE OVERFLOW FLAG (PDP-6 ONLY)
    46			000400		LPTERR==1B27			;ERROR FLAG
    47			000200		LPTBSY==1B28			;BUSY FLAG
    48			000100		LPTDON==1B29			;DONE FLAG
    49			000070		LPTECM==7B32			;ERROR CHANNEL MASK
    50
    51			000300		LPTBDM==LPTBSY+LPTDON		;BUSY/DONE FLAG MASK
    52
    53				;LINE PRINTER DEVICE DEPENDENT I/O STATUS MNEMONIC DEFINITIONS
    54
    55			400000		LPTEND==400000			;CLOSE UUO HAS BEEN DONE
    56			200000		LPTSYN==200000			;CRFF AFTER CLOSE UUO HAS BEEN SENT
    57			100000		LPTRBL==100000			;LPT TROUBLE DETECTED AT INTERRUPT LEVEL
    58			040000		LPTPAR==40000			;PARTIAL BUFFER ALREADY OUTPUT
    59
    60				;BITS IN RH OF S
    61
    62			000100		LPTNFF==100			;SUPPRESS FREE FORM FEEDS
    63
    64				;LINE PRINTER DEVICE DATA BLOCK ADDRESSING MNEMONIC DEFINITIONS
    65
    66					EXTERN	LPTCON,LPTPTR,LPTCH,LPTSVE,LPTEX1,LPTSV2,LPTECH
    67					EXTERN	LPTDNE,LPTCSO,LPTCSZ,LPTCNI,LPTCNO,LPTDTO,LPTBKO
    68					EXTERN	LPXSTS,SIZLPT
    69					EXTERN	WSYNC
    70
    71				;LINE PRINTER SERVICE DISPATCH TABLE
    72
    73	000000			LPTDSP:	PHASE 0
    74	000003'	000000	000012	DDXZ:	DSPSIZ
    75	000004'	263040	000000	DDINT:	POPJ P,
    76	000005'	004400	004400	DBYT:	4400,,4400
    77	000006'	201300	000000*	DVSIZ:	MOVEI T1,SIZLPT
    78	000007'	254000	000017'	DINI:	JRST LPTINI
    79	000010'	254000	000016'	DHNG:	JRST LPTHNG
    80	000011'	254000	000016'	DRL:	JRST LPTREL
    81	000012'	254000	000026'	DCL:	JRST LPTCLS
    82	000013'	254000	000031'	DOU:	JRST LPTOUT
    83	000014'	254000	000000*	DIN:	JRST ERROCI
    84	000015'	254000	000220'	DXFR:	JRST LPTXFR
    85			000012		DSPSIZ==.-1
    86	000016'				DEPHASE
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 3
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

    87				;LINE PRINTER INITIALIZATION, HUNG DEVICE AND RELEASE CODE
    88
    89					;LPTINI IS CALLED AT SYSTEM INITIALIZATION TIME FROM
    90					;IOGO IN SYSINI WITH THE DDB ADDRESS IN F
    91
    92					;LPTHNG IS CALLED FROM DEVCHK IN UUOCON (IOCSS) WITH
    93					;THE DDB ADDRESS IN F WHENEVER A LINE PRINTER
    94					;HUNG DEVICE COUNT IS DECREMENTED TO ZERO
    95
    96					;LPTREL IS CALLED FROM RELEA1 IN UUOCON WITH THE DDB
    97					;ADDRESS IN F WHENEVER A RELEASE UUO IS EXECUTED
    98					;FOR A LINE PRINTER
    99
   100					;EACH OF THE ABOVE ROUTINES MUST:
   101					;
   102					;	1.  CLEAR THE SPECIFIED LINE PRINTER
   103					;	2.  DEASSIGN BOTH THE ERROR AND DONE INTERRUPT
   104					;	     CHANNELS FOR THAT LINE PRINTER
   105					;	3.  CLEAR THE SKIP CHAIN INTERRUPT MASK FLAGS
   106					;	     FOR THAT LINE PRINTER
   107
   108					;NOTE:  THE LPTINI CODE FORCES IOGO IN SYSINI TO INVOKE
   109					;       LPTINI FOR EACH LINE PRINTER ON THE SYSTEM RATHER
   110					;       THAN FOR THE NORMAL CASE WHERE IT INVOKES THE
   111					;       INITIALIZATION CODE ONCE FOR EACH DISPATCH TABLE.
   112					;
   113					;       THEREFORE, THE CORRECT OPERATION OF THE LPTINI CODE
   114					;       IS DEPENDANT UPON THE IOGO CODE WHICH SHOULD BE:
   115					;
   116					;		PUSHJ P,DINI(P3)
   117					;		HRRZM P3,SAVITM
   118
   119	000016'			LPTHNG:
   120	000016'			LPTREL:
   121	000016'	370001	000000		SOS	(P)		;COUNTERACT SKIP RETURN
   122	000017'	201240	002000	LPTINI:	MOVEI	U,LPTCLR	;CLEAR THE LINE PRINTER
   123	000020'	256004	000000*		XCT	LPTCNO(F)
   124	000021'	256004	000000*		XCT LPXSTS(F)	;CONI INTO DEVSTS FOR 96 CHR CHECK
   125	000022'	513004	000000*		HLLZS	LPTCON(F)	;CLEAR SKIP CHAIN MASK FLAGS
   126	000023'	621000	140000		TLZ	S,LPTRBL!LPTPAR	;CLEAR TROUBLE FLAGS
   127	000024'	260040	000000*		PUSHJ	P,STOIOS
   128	000025'	254000	000000*		JRST	CPOPJ1		;SKIP RETURN IF ENTERED AT LPTINI
   129									; TO FORCE CALL FOR EACH LPT
   130
   131				;LINE PRINTER CLOSE UUO ROUTINE
   132
   133	000026'	661000	400000	LPTCLS:	TLO	S,LPTEND	;TURN ON THE END FLAG
   134	000027'	621000	340000		TLZ	S,LPTSYN+LPTRBL+LPTPAR ;TURN OFF SYNCHRONIZATION FLAG
   135	000030'	202004	000002		MOVEM	S,DEVIOS(F)	;SAVE S IN THE DDB
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 4
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

   136				;LINE PRINTER OUTPUT UUO ROUTINE
   137
   138	000031'	627000	100000	LPTOUT: TLZN	S,LPTRBL	;TROUBLE DETECTED?
   139	000032'	254000	000035'		JRST	LPTOU2		;NO
   140	000033'	202004	000002		MOVEM	S,DEVIOS(F)	;YES, SAVE NEW STATUS
   141	000034'	260040	000000*	LPTSTP:	PUSHJ	P,HNGSTP	;HALT JOB UNTIL I/O IS OK
   142	000035'	201240	000000	LPTOU2:	MOVEI	U,0	;CLEAR LP FLAGS
   143	000036'	661000	000020		TLO	S,IO		;INDICATE OUTPUT
   144	000037'	256004	000020*		XCT	LPTCNO(F)	;CLEAR ALL FLAGS
   145	000040'	201240	000400		MOVEI	U,LPTERR	;MASK FOR ERROR FLAG
   146	000041'	256004	000000*		XCT	LPTCSZ(F)	;ERROR?
   147	000042'	254000	000034'		JRST	LPTSTP	;YES.
   148	000043'	200244	000000*		MOVE	U,LPTCH(F)	;SET UP CHANNEL ASSIGNMENT
   149	000044'	607000	000002		TLNN	S,IOBEG	;FIRST OUTPUT?
   150	000045'	254000	000052'		JRST	LPTGO	;NO
   151	000046'	550304	000011		HRRZ	T1,DEVCLS(F)	;YES,SET UP INITIAL BLKO POINTER
   152	000047'	275300	000001		SUBI	T1,1		;TO BUFFER ADDRESS - 1
   153	000050'	202304	000000*		MOVEM	T1,LPTPTR(F)	; AND STORE IT
   154	000051'	640240	002100		TRC	U,LPTDON!LPTCLR	;CLEAR LPTDON AND SET LPTCLR
   155	000052'	260040	000000*	LPTGO:	PUSHJ	P,SETACT	;SET I/O ACTIVE, ETC.
   156	000053'	505240	001500		HRLI	U,LPTLOV+LPTERR+LPTDON
   157	000054'	700600	000400		WRPI	LI.PIF	;TURN OFF ALL INTERRUPTS
   158	000055'	256004	000037*		XCT	LPTCNO(F)	;DO IT TO IT
   159	000056'	546244	000022*		HLRM	U,LPTCON(F)	;SET CHAIN MASK BITS
   160	000057'	700600	000200		WRPI	LI.PIN	;TURN ON INTERRUPTS AGAIN
   161	000060'	607000	400000		TLNN	S,LPTEND	;CLOSE?
   162	000061'	263040	000000		POPJ	P,		;NO. RETURN
   163	000062'	260040	000000*		PUSHJ	P,WSYNC		;YES. GO TO I/O WAIT FOR BUFFER TO EMPTY
   164	000063'	627000	100000		TLZN	S,LPTRBL	;ANY ERRORS?
   165	000064'	263040	000000		POPJ	P,		;NO
   166	000065'	254000	000034'		JRST	LPTSTP		;YES. TELL OPERATOR AND HANG
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 5
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

   167				;
   168				; ADVANCE BUFFER POINTER.
   169				;   ON ENTRY (T1)= LAST BLKO POINTER
   170				;   SKIP RETURN INDICATES BUFFER NOT EMPTY
   171				;   NO-SKIP RETURN INDICATES BUFFER IS EMPTY
   172				;
   173	000066'	553000	000006	ABOP:	HRRZS	T1		;CLEAR COUNT
   174	000067'	340300	000000		AOJ	T1,		;INCREMENT ADDRESS
   175	000070'	550344	000011		HRRZ	T2,DEVCLS(F)	;BUFFER POINTER
   176	000071'	311307	777777		CAML	T1,-1(T2)	;OUT .GE. LAST ?
   177	000072'	200300	000007		MOVE	T1,T2		;YES. OUT = FIRST
   178	000073'	542307	777776		HRRM	T1,-2(T2)	;STORE NEW OUT POINTER
   179	000074'	204307	777776		MOVS	T1,-2(T2)	;SWAP IN AND OUT
   180	000075'	312307	777776		CAME	T1,-2(T2)	;IN .EQ. OUT?
   181	000076'	350001	000000		AOS	(P)		;NO. BUFFER CONTAINS DATA
   182	000077'	263040	000000		POPJ	P,		;RETURN
   183				;
   184
   185				;
   186				;  SET UP NEW BLKO POINTER FOR NEXT BLOCK
   187				;  IN MONITOR BUFFER.  ASSUMES BUFFER IS
   188				;  NOT EMPTY.
   189				;    ON EXIT (T1)= NEW POINTER
   190				;
   191	000100'	550404	000011	BPTSET:	HRRZ	T3,DEVCLS(F)	;GET BUFFER POINTER
   192	000101'	554310	777776		HLRZ	T1,-2(T3)	;LOAD IN POINTER
   193	000102'	550350	777776		HRRZ	T2,-2(T3)	;LOAD OUT POINTER
   194	000103'	274300	000007		SUB	T1,T2		;COMPUTE LENGTH
   195	000104'	325300	000107'		JUMPGE	T1,BPTSE1	;JUMP IF IN .GE. OUT
   196	000105'	550310	777777		HRRZ	T1,-1(T3)	;GET LAST POINTER
   197	000106'	274300	000007		SUB	T1,T2		;COMPUTE LENGTH TO END OF BUFFER
   198	000107'	210300	000006	BPTSE1:	MOVN	T1,T1		;NEGATE COUNT
   199	000110'	370000	000007		SOS	T2		;COMPUTE ADDRESS - 1
   200	000111'	504300	000007		HRL	T1,T2		;COMBINE ADDRESS AND LENGTH
   201	000112'	207000	000006		MOVSS	T1		; IN PROPER ORDER
   202	000113'	263040	000000		POPJ	P,		;RETURN
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 6
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

   203				;LINE PRINTER INTERRUPT SERVICE ROUTINE
   204
   205	000114'	256004	000021*	LPTINT:	XCT	LPXSTS(F)	;STORE CONI STATUS IN DDB
   206	000115'	256004	000000*		XCT	LPTECH(F)	;SKIP IF NO ERROR CHANNEL ASSIGNED
   207	000116'	256004	000000*		XCT	LPTDNE(F)	;SKIP IF DONE FLAG IS UP
   208	000117'	254000	000166'		JRST	LPTER1		; BRANCH TO ERROR SERVICE ROUTINE
   209	000120'	331004	000050*		SKIPL	LPTPTR(F)	;BLKO COUNT TO 0 ON PREV. INTERRUPT?
   210	000121'	254004	000000*		JRST	LPTSVE(F)	; YES, GO SAVE ORIGINAL AC'S
   211	000122'	353004	000014		AOSLE	DEVWUC(F)	;ADVANCE EARLY STARTUP COUNT
   212	000123'	254004	000121*		JRST	LPTSVE(F)	;COUNT EXHAUSTED SO START UP USER
   213	000124'	256004	000000*		XCT	LPTBKO(F)	; NO, SEND NEXT WORD FOR PRINTING
   214	000125'	254004	000000*		JRST	LPTEX1(F)	;LAST WORD SENT BUT INTERRUPT PENDING
   215	000126'	254004	000125*		JRST	LPTEX1(F)	;GO RESTORE F AND RETURN
   216
   217	000127'			LPTNXT:					;ENTER HERE AFTER DDB ROUTINE SAVES
   218									; ORIGINAL AC'S IN PROPER CHANNEL
   219									; SAVE AREA AND SETS UP F
   220									; TO POINT TO DDB AGAIN
   221
   222	000127'	260040	000000*		PUSHJ	P,IOSET		;SET AC R:= JOB AREA ADDRESS AND
   223									; AC S:= DEVIOS IN THE DDB
   224	000130'	603000	100000		TLNE	S,LPTRBL	;TROUBLE DETECTED ON INTERRUPT
   225	000131'	254000	000216'		JRST	LPTERG		;YES, FIX IT
   226	000132'	623000	000002		TLZE	S,IOBEG		;NO, FIRST BUFFER SINCE INIT?
   227	000133'	254000	000157'		JRST	LPTBG1		; YES, GO OUTPUT A CRFF
   228	000134'	200304	000120*		MOVE	T1,LPTPTR(F)	;GET OLD BLKO POINTER
   229	000135'	260040	000066'		PUSHJ	P,ABOP	; NO, ADVANCE TO NEXT BLOCK
   230	000136'	254000	000145'		JRST	LPTOFF		;CANNOT ADVANCE, BUFFER EMPTY
   231	000137'	260040	000100'		PUSHJ	P,BPTSET	;SET UP NEW BLKO POINTER
   232	000140'	202304	000134*		MOVEM	T1,LPTPTR(F)	;STORE NEW POINTER
   233	000141'	576304	000014		HLREM	T1,DEVWUC(F)	;SET WAKE UP COUNT TO SAME AS BLOCKO COUNT
   234	000142'	623000	000001	LPTWCK:	TLZE	S,IOW		;IS JOB WAITING FOR I/O COMPLETION?
   235	000143'	260040	000000*		PUSHJ	P,SETIOD	; YES, ARRANGE FOR JOB TO RUN AGAIN
   236	000144'	254000	000024*		JRST	STOIOS		;SAVE S, RESET HUNG DEVICE COUNT
   237									; AND DISMISS INTERRUPT
   238
   239	000145'	607000	400000	LPTOFF:	TLNN	S,LPTEND	;SKIP IF CLOSE HAS BEEN DONE
   240	000146'	254000	000152'		JRST	LPTOF1		; GO TURN PRINTER OFF UNTIL NEXT OUTPUT
   241	000147'	667000	200000		TLON	S,LPTSYN	;HAS FINAL CRFF BEEN OUTPUT?
   242	000150'	254000	000162'		JRST	LPTBG2		; NO, SO GO DO IT
   243	000151'	621000	400000		TLZ	S,LPTEND	; YES, SO CLEAR END FLAG
   244	000152'	620000	010000	LPTOF1:	TRZ	S,IOACT		;CLEAR I/O ACTIVE BIT
   245	000153'	201240	000000		MOVEI	U,0		;CLEAR U AND
   246	000154'	256004	000055*		XCT	LPTCNO(F)	; TURN LPT OFF
   247	000155'	513004	000056*		HLLZS	LPTCON(F)	;CLEAR SKIP CHAIN MASK FLAGS
   248	000156'	254000	000142'		JRST	LPTWCK		; AND BRANCH
   249
   250	000157'	200304	000140*	LPTBG1:	MOVE	T1,LPTPTR(F)	;OLD BLKO POINTER
   251	000160'	260040	000100'		PUSHJ	P,BPTSET	;SET UP INITIAL BLKO POINTER *******
   252	000161'	202304	000157*		MOVEM	T1,LPTPTR(F)	;STORE NEW POINTER
   253	000162'	201240	000223'	LPTBG2:	MOVEI	U,[EXP 15B6+14B13]	;SEND OUT A CRFF
   254	000163'	606000	000100		TRNN	S,LPTNFF	;SKIP IF SUPPRESSING FF (100 MODE)
   255	000164'	256004	000000*		XCT	LPTDTO(F)
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 6-2
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

   256	000165'	254000	000144*		JRST	STOIOS		;GO DISMISS ITERRUPT
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 7
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

   257				;LINE PRINTER ERROR HANDLING ROUTINE
   258
   259	000166'	202244	000000*	LPTER1:	MOVEM	U,LPTSV2(F)	;SAVE U IN DDB
   260	000167'	201240	001000		MOVEI	U,LPTLOV	;GET LINE OVERFLOW ERROR MASK
   261	000170'	256004	000000*		XCT	LPTCSO(F)	;SKIP IF LINE OVERFLOW FLAG IS ON
   262	000171'	254000	000177'		JRST	LPTER2		; GO CHECK IF PREVIOUS ERROR OCCURRED
   263	000172'	210240	000224'		MOVN	U,[EXP 1000001]	;DECREMENT BLK0 POINTER
   264	000173'	272244	000161*		ADDM	U,LPTPTR(F)
   265	000174'	201240	000225'		MOVEI	U,[EXP 15B6+12B13]	;PRINT CRLF
   266	000175'	256004	000164*		XCT	LPTDTO(F)
   267	000176'	254000	000210'		JRST	LPTER4
   268
   269	000177'	256004	000115*	LPTER2:	XCT	LPTECH(F)	;SKIP IF ERROR INTERRUPT NOT ASSIGNED
   270	000200'	254000	000212'		JRST	LPTER5		; ERROR CONDITION DETECTED
   271	000201'	256004	000000*		XCT	LPTCNI(F)	;GET HARDWARE STATUS
   272	000202'	405240	000300		ANDI	U,LPTBDM	;EXTRACT BUSY AND DONE FLAGS
   273	000203'	430244	000043*		XOR	U,LPTCH(F)	;PUT CHANNEL ASSIGNMENTS BACK IN
   274	000204'	431240	000100		XORI	U,LPTDON	;RECOMPLEMENT LPTDON TO PREVIOUS STATE
   275	000205'	256004	000154*		XCT	LPTCNO(F)	;SEND IT OUT TO THE LPT
   276	000206'	201240	001500		MOVEI	U,LPTLOV!LPTERR!LPTDON	;ENABLE FOR ALL INTERRUPTS
   277	000207'	542244	000155*		HRRM	U,LPTCON(F)	;SAVE SKIP CHAIN MASK FLAGS
   278	000210'	200244	000166*	LPTER4:	MOVE	U,LPTSV2(F)	;RESTORE SAVED ACCUMULATOR
   279	000211'	254004	000126*		JRST	LPTEX1(F)	; AND GO DISMISS INTERRUPT
   280
   281	000212'	205240	140000	LPTER5:	MOVSI	U,LPTRBL!LPTPAR	;INDICATE TROUBLE NOTICED ON
   282	000213'	436244	000002		ORM	U,DEVIOS(F)	; INTERRUPT LEVEL
   283	000214'	200244	000210*		MOVE	U,LPTSV2(F)	;RESTORE U
   284	000215'	254004	000123*		JRST	LPTSVE(F)	;GO SAVE ALL AC'S
   285
   286				;RETURN HERE WITH ACS SAVED
   287	000216'	260040	000152'	LPTERG:	PUSHJ	P,LPTOF1	;TURN OFF LPT, CLEAR IOACT
   288	000217'	254000	000000*		JRST	DEVERR		;CAUSE UUOCON TO RETRY ON UUO LEVEL
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 8
LPTSER.MAC	20-SEP-87 13:41		T. N. MCMANUS /TNM/CHW/RCC   TS 7 JUL 71

   289				;
   290				;	DEVICE DEPENDENT TRANSFER FROM USER BUFFER
   291				;	ON ENTRY: LH(T2)=DATA AREA IN USER BUFFER
   292				;	          RH(T2)=ADDRESS OF NEXT BLOCK IN MONITOR BUFFER
   293				;		  (T3)  =LAST ADDRESS + 1 IN MONITOR BUFFER OF DATA TO BE TRANSFERRED
   294				;	          (T1)  =NO. OF WORDS IN BLOCK TO BE XFERRED
   295				;	ON EXIT: (T1)  RETURNS NO. OF WORDS ACTUALLY XFERRED
   296				;
   297	000220'	256040	000226'	LPTXFR:	XCTFU <BLT T2,-1(T3)>	;ALL SET UP FOR BLT
   298	000221'	350001	000000		AOS	(P)		;SKIP  RETURN
   299	000222'	263040	000000		POPJ	P,
   300
   301	000223'	064300	000000		$END	(LP1)

   302	000224'	000001	000001

   303	000225'	064240	000000

   304	000226'	251350	777777

   305						;End of LPTSER (LP1LIT: LP1END:)
   306
NO ERRORS DETECTED
PROGRAM BREAK IS 000227
6K CORE USED
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 9
LPTSER.MAC	20-SEP-87 13:41		SYMBOL TABLE

ABOP		000066'		LPTDON		000100	SIN	STOIOS		000165'	EXT	
ADVBFE		000000	EXT	LPTDSP		000003'	INT	T1		000006	INT	
BPTSE1		000107'		LPTDTO		000175'	EXT	T2		000007	INT	
BPTSET		000100'		LPTECH		000177'	EXT	T3		000010	INT	
CPOPJ		000000	EXT	LPTECM		000070	SIN	U		000005	INT	
CPOPJ1		000025'	EXT	LPTEND		400000	SPD	WRPI	700600	000000		
CPUKI		000001	SPD	LPTER1		000166'		WSYNC		000062'	EXT	
CPUKL		000002	SPD	LPTER2		000177'		ZZ		425464	SPD	
CPUTYP		000002	SPD	LPTER4		000210'		
CPZZ		000000	SPD	LPTER5		000212'		
DBYT		000002	SIN	LPTE00216'		
DCL		000007	SIN	LPTERR		000400	SPD	
DDINT		000001	SIN	LPTEX1		000211'	EXT	
DDXZ		000000	SIN	LPTGO		000052'		
DEVCLS		000011	SIN	LPTHNG		000016'		
DEVERR		000217'	EXT	LPTINI		000017'		
DEVIOS		000002	SIN	LPTINT		000114'	INT	
DEVWUC		000014	SIN	LPTLOV		001000	SPD	
DHNG		000005	SIN	LPTNFF		000100	SPD	
DIE		000000'	EXT	LPTNXT		000127'	INT	
DIN		000011	SIN	LPTOF1		000152'		
DINI		000004	SIN	LPTOFF		000145'		
DOU		000010	SIN	LPTOU2		000035'		
DRL		000006	SIN	LPTOUT		000031'		
DSPSIZ		000012	SPD	LPTPAR		040000	SPD	
DVSIZ		000003	SIN	LPTPTR		000173'	EXT	
DXFR		000012	SIN	LPTRBL		100000	SPD	
ERROCI		000014'	EXT	LPTREL		000016'		
F		000004	INT	LPTSER		000000'	ENT	
HNGSTP		000034'	EXT	LPTSTP		000034'		
IO		000020	SIN	LPTSV2		000214'	EXT	
IOACT		010000	SIN	LPTSVE		000215'	EXT	
IOBEG		000002	SIN	LPTSYN		200000	SPD	
IOSET		000127'	EXT	LPTWCK		000142'		
IOW		000001	SIN	LPTXFR		000220'		
LI.PIF		000400	SPD	LPXSTS		000114'	EXT	
LI.PIN		000200	SPD	NODIE		000000	EXT	
LP1END		000226'	INT	OUT		000000	EXT	
LP1LIT		000223'	INT	P		000001	INT	
LPTBDM		000300	SPD	PX.MEM		000004	SPD	
LPTBG1		000157'		PX.SRC		000001	SPD	
LPTBG2		000162'		PXCT	256000	000000		
LPTBKO		000124'	EXT	S		000000	INT	
LPTBSY		000200	SPD	S$ENTR	777777	777775	SIN	
LPTCH		000203'	EXT	S$HALT	777777	777777	SIN	
LPTCLR		002000	SPD	S$NAME		000000'	SPD	
LPTCLS		000026'		S$NONA		000000	SIN	
LPTCNI		000201'	EXT	S$TEMP	777775	000000	SPD	
LPTCNO		000205'	EXT	S$XCT	777777	777776	SIN	
LPTCON		000207'	EXT	SETACT		000052'	EXT	
LPTCSO		000170'	EXT	SETIOD		000143'	EXT	
LPTCSZ		000041'	EXT	SIZLPT		000006'	EXT	
LPTDNE		000116'	EXT	

LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88
LPTSER.MAC	20-SEP-87 13:41		Symbol cross reference

ABOP	   173#	   229
ADVBFE	    37%
BPTSE1	   195	   198#
BPTSET	   191#	   231	   251
CPOPJ	    25%
CPOPJ1	    25%	   128
CPUKI	    20
CPUKL	    20
CPUTYP	    20
CPZZ	    20#	    20
DBYT	    76#
DCL	    81#
DDINT	    75#
DDXZ	    74#
DEVCLS	   151	   175	   191
DEVERR	    37%	   288
DEVIOS	   135	   140	   282
DEVWUC	   211	   233
DHNG	    79#
DIE	    12	    12%	    13
DIN	    83#
DINI	    78#
DOU	    82#
DRL	    80#
DSPSIZ	    74	    85#
DVSIZ	    77#
DXFR	    84#
ERROCI	    33%	    83
F	   123	   124	   125	   135	   140	   144	   146	   148	   151	   153	   158	   159	   175	   191
	   205	   206	   207	   209	   210	   211	   212	   213	   214	   215	   228	   232	   233	   246
	   247	   250	   252	   255	   259	   261	   264	   266	   269	   271	   273	   275	   277	   278
	   279	   282	   283	   284
GINST	   297#	   297	   298
HNGSTP	    33%	   141
IO	   143
IOACT	   244
IOBEG	   149	   226
IOSET	    37%	   222
IOW	   234
LI.PIF	   157
LI.PIN	   160
LISTSN	     3	     6
LP1END	   305#
LP1LIT	   301#
LPTBDM	    51#	   272
LPTBG1	   227	   250#
LPTBG2	   242	   253#
LPTBKO	    67%	   213
LPTBSY	    47#	    51
LPTCH	    66%	   148	   273
LPTCLR	    44#	   122	   154
LPTCLS	    81	   133#
LPTCNI	    67%	   271
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88
LPTSER.MAC	20-SEP-87 13:41		Symbol cross reference

LPTCNO	    67%	   123	   144	   158	   246	   275
LPTCON	    66%	   125	   159	   247	   277
LPTCSO	    67%	   261
LPTCSZ	    67%	   146
LPTDNE	    67%	   207
LPTDON	    41	    48#	    51	   154	   156	   274	   276
LPTDSP	    41	    73#
LPTDTO	    67%	   255	   266
LPTECH	    66%	   206	   269
LPTECM	    41	    49#
LPTEND	    55#	   133	   161	   239	   243
LPTER1	   208	   259#
LPTER2	   262	   269#
LPTER4	   267	   278#
LPTER5	   270	   281#
LPTERG	   225	   287#
LPTERR	    46#	   145	   156	   276
LPTEX1	    66%	   214	   215	   279
LPTGO	   150	   155#
LPTHNG	    79	   119#
LPTINI	    78	   122#
LPTINT	    41	   205#
LPTLOV	    45#	   156	   260	   276
LPTNFF	    62#	   254
LPTNXT	    41	   217#
LPTOF1	   240	   244#	   287
LPTOFF	   230	   239#
LPTOU2	   139	   142#
LPTOUT	    82	   138#
LPTPAR	    58#	   126	   134	   281
LPTPTR	    66%	   153	   209	   228	   232	   250	   252	   264
LPTRBL	    57#	   126	   134	   138	   164	   224	   281
LPTREL	    80	   120#
LPTSER	    12	    13#	    16
LPTSTP	   141#	   147	   166
LPTSV2	    66%	   259	   278	   283
LPTSVE	    66%	   210	   212	   284
LPTSYN	    56#	   134	   241
LPTWCK	   234#	   248
LPTXFR	    84	   297#
LPXSTS	    68%	   124	   205
NODIE	    12%
OUT	    37%
P	    13	    75	   121	   127	   141	   155	   162	   163	   165	   181	   182	   202	   222	   229
	   231	   235	   251	   287	   298	   299
PX.MEM	   297
PX.SRC	   297
S	   126	   133	   134	   135	   138	   140	   143	   149	   161	   164	   224	   226	   234	   239
	   241	   243	   244	   254
S$ENTR	    12	    18
S$HALT	    12
S$NAME	    16#
S$NONA	    15	    18
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88
LPTSER.MAC	20-SEP-87 13:41		Symbol cross reference

S$TEMP	    12#	    12
S$XCT	    18
SETACT	    37%	   155
SETIOD	    29%	   235
SIZLPT	    68%	    77
STOIOS	    37%	   127	   236	   256
T1	    77	   151	   152	   153	   173	   174	   176	   177	   178	   179	   180	   192	   194	   195
	   196	   197	   198	   200	   201	   228	   232	   233	   250	   252
T2	   175	   176	   177	   178	   179	   180	   193	   194	   197	   199	   200	   297
T3	   191	   192	   193	   196	   297
U	   122	   142	   145	   148	   154	   156	   159	   245	   253	   259	   260	   263	   264	   265
	   272	   273	   274	   276	   277	   278	   281	   282	   283
WSYNC	    69%	   163
ZZ	   297#	   297
ZZ1	   297#	   297
LPTSER - LINE PRINTER SERVICE ROUTINE FOR MULTIPLE LINE PRINTERS - V1420	MACRO 12.5-46.0 14:35 13-JAN-88
LPTSER.MAC	20-SEP-87 13:41		Macro/Opdef cross reference

IFNCPU	    20
PXCT	   297
PXGEN	   297
STOPCD	    11
WRPI	   157	   160
XCTFU	   297
$END	   3012@ …
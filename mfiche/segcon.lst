SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA
     9
    10					STOPCD(,ENTRY,SEGCON)^
    11					ENTRY	SEGCON		;For library searches
    12	000000'	260040	000000*	SEGCON::PUSHJ	P,DIE		;**** Default stopcode for "SEGCON" ****
    13	000001'	634547	435756		SIXBIT	/SEGCON/  	;Title of module
    14	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "SEGCON+nnn(nnnnnn)"
    15			000000'	S$NAME==SEGCON			;For STOPCDs with no arguments
    16					SALL>
    17				^
    18
    19				COMMENT @
    20				THIS SEGCON PROVIDES SHARABLE "HIGH SEGMENTS" BY MAPPING
    21				FILES WITH .SHR EXTENSION
    22
    23				ALL FILES OF EXTENSION .SHR OR .HGH ON DSK ARE MAPPED. .SAV,
    24				.LOW, ETC. AND ALL MAGTAPE FILES ARE READ INTO FRESHLY-
    25				CREATED PRIV PAGES USING INPUT UUO, THEN PAGES MADE RDO IF
    26				HIGH SEG.
    27
    28				THIS SEGCON ASSUMES ALL FILES TO BE OF "OLD" PRE-VM FORMAT
    29				WHICH CONTAIN NO MAP INFO (BUT WHICH MAY POSSIBLY BE ZERO-
    30				COMPRESSED..  .LOW, .SAV ONLY).  .SHR AND .HGH FILES ARE ASSUMED
    31				TO CONTAIN THE EXACT CORE IMAGE DESIRED FOR PAGES 400 &FF.
    32
    33				@
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 2
SEGCON.MAC	28-OCT-87 00:02		S.MAC - with system parameter file for P035/D, January 1988

    34				;GENERAL SYMBOLS AND EXTERNALS
    35
    36			000000	RUNCHN==0	;THE CHANNEL ON WHICH ALL SEGCON I/O DONE
    37			000035	FNCMDP==35	;MAP DISK PAGE CHANIO FUNCTION
    38
    39				;	EXTERNS FROM COMMON FOR LMAP DEFN
    40				EXTERN %UPT,%UPS,XPNCOR,UPTSTS,SG.SWR
    41				EXTERN UPTREL,UPTHRL,UPTJDA,UPTXAC,UPTPDL,%UPLMA,LMMEXS
    42				EXTERN UPTPID,UPTSPD,UPTSTV
    43
    44				;	EXTERNS FROM JOBDAT
    45				EXTERN JOBREL,JOBHRL,JOBNSV,JOBSA,JOBVER,JOBPOP,JOB41
    46				EXTERN JOBCOR,JOBS41,JOBDDT,JOBREN,JOBFF,JOBSVM,JOBSV,JOBSDD
    47				EXTERN JOBDA,JOBFDV,JOBEXM,JOBHRN,JOBHCR
    48
    49				;	JOB TABLES
    50				EXTERN JOB,JBTSTS,JBTPRV,JBTNAM,JBTLIC,JBTSLC,JBTFPN
    51				EXTERN JBTUPM,JBTMPC,JBTRCT,JBTSIN
    52
    53				;MISC EXTERNS
    54				EXTERN CPOPJ,CPOPJ1,TPOPJ
    55
    56				;	EXTERNS FROM CORE1
    57				EXTERN .WSRNG,PS.CPR,CRLIM%,CRDFL%,DOXCT
    58				EXTERN WSATM%,PTPRF%,WS.ADD,PTNVP%
    59
    60				;EXTERNS FROM ERRCON
    61				EXTERNAL ERRDNA,ERREUF,ERRFNF,ERRNSF,ERRPGN,ERRTRE,ERRJSU,ERRJSV
    62				EXTERNAL ERRCAN,ERRMHB,ERRRMF,ERRMGF,ERRNSA
    63
    64				;SEGCON PERFORMANCE COUNTERS
    65	000003'	000000	000000	URUNCT::	EXP 0	;NO. OF RUN UUO'S DONE
    66	000004'	000000	000000	RNSGCT::	EXP 0	;RUNSEGS
    67	000005'	000000	000000	GTSGCT::	EXP 0	;GETSEGS
    68
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 3
SEGCON.MAC	28-OCT-87 00:02		S.MAC - with system parameter file for P035/D, January 1988

    69				COMMENT ! PDL STRUCTURE OBSERVED BY ALMOST EVERYONE IN SEGCON.
    70
    71				THIS PDL STRUCTURE IS NOT POPPED BACK UP FOR SUCCESS EXITS
    72				FROM SEGCON EXCEPT FOR THE GETSEG UUO. ALL PHOLD-TYPE FAILURE
    73				EXITS AND SUCCESS EXITS LEAVE IT PUSHED DOWN.  THE SGRELE
    74				FAILURE EXIT TO THE USER PUSHES UPTPDL ONTO THE TOP OF
    75				THE PDL AND JRSTS USRXIT. THE RNSEG SUCCESS EXIT PUSHES
    76				JOBSA ONTO THE PDL AND JRSTS USRXIT.
    77				!
    78
    79	000000				PHASE 0
    80	000006'	000000	000000	XPAMOD:! 0	;MODE TO INIT RUNCHN
    81
    82				;BITS IN LH OF XPAMOD:
    83					INTERNAL NOSHR,HSLIC,LSLIC
    84			000001		NOSHR==1	;FOR SGSET/SAVJOB COMMUNICATION
    85			000002		HSLIC==2	;1 SAYS HL XPALIC SETUP FOR HS FILE
    86							; (ALSO USED TO FLAG PID SETUP IN XPAHPD)
    87			000004		LSLIC==4	;1 SAYS RH XPALIC SETUP FOR LS FILE
    88							; (ALSO USED TO FLAG PID SETUP IN XPAPID)
    89
    90	000007'	000000	000000	XPADEV:! 0		;DEVICE (TYPICALLY DSK OR SYS)
    91	000010'	000000	000000	XPALKB:! 0		;EXTENDED LOOKUP BLOCK WRD 0 (LENGTH)
    92	000011'	000000	000000	XPAPPN:! 0
    93	000012'	000000	000000	XPANAM:! 0
    94	000013'	000000	000000	XPAEXT:! 0		;EXT FOR THIS LOOKUP, NOT NECESSAIRILY
    95							;THE ONE THE USER TYPED. SEE XPAUXT
    96	000014'	000000	000000	XPAPRV:! 0
    97	000015'	000000	000000	XPASIZ:! 0
    98	000010				BLOCK 17-<.-XPALKB>
    99	000027'	000000	000000	XPASTS:! 0		;RIB STATUS
   100	000030'	000000	000000	XPAELB:! 0
   101	000031'	000000	000000	XPAXT1:! 0
   102	000032'	000000	000000	XPAQTF:! 0
   103	000033'	000000	000000	XPAQTO:! 0
   104	000034'	000000	000000	XPAMXA:! 0
   105	000035'	000000	000000	XPAUSD:! 0
   106	000036'	000000	000000	XPAAUT:! 0
   107	000031				BLOCK 2		;UNM AND UN1
   108	000041'	000000	000000	XPATRU:! 0
   109	000042'	000000	000000	XPAXT2:! 0
   110	000043'	000000	000000	XPAALP:! 0
   111	000044'	000000	000000	XPASNM:! 0
   112	000045'	000000	000000	XPAPJC:! 0	;-
   113	000046'	000000	000000	XPAPJ1:! 0	;-
   114	000047'	000000	000000	XPAPJ2:! 0	;-
   115	000050'	000000	000000	XPAPID:! 0	;PROCESSOR ID
   116
   117				;BITS IN RH OF XPASTS WHICH CAUSE SEGCON TO REFUSE TO LOAD:
   118			011762		BADBIT==RIPBFS!RIPHWE!RIPHRE!RIPBDR!RIPBDA
   119					EXTERN RIPBDA,RIPBDR,RIPHRE,RIPHWE,RIPBFS
   120				;ADD MORE WORDS OF EXTENDED LOOKUP BLOCK HERE IF DESIRED
   121			000040	SGLLB==.-XPALKB-1		;LENGTH OF SEGCON LOOKUP BLOCK
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 3-2
SEGCON.MAC	28-OCT-87 00:02		S.MAC - with system parameter file for P035/D, January 1988

   122
   123	000051'	000000	000000	XPAUN1:! 0
   124	000052'	000000	000000	XPAUN2:! 0
   125	000053'	000000	000000	XPAUXT:! 0		;EXTENSION (MAYBE NONE) OFFERED BY USER
   126	000054'	000000	000000	XPANEW:! 0		;LICENSES TO PASS,,NEW CORE ARGUMENT
   127	000055'	000000	000000	XPALIC:! 0		;HISEG LICENSE,,LOWSEG LICENSE FROM FILES
   128	000056'	000000	000000	XPAHPD:! 0		;PLACE TO REMEMBER FIRST PID SEEN
   129	000057'	000000	000000	XPACOM:! 0		;PLACE TO SAVE IO COMMAND WORD
   130			000052	SGLEB==.-XPAMOD		;LENGTH ENTIRE BLOCK
   131	000060'				DEPHASE
   132
   133				COMMENT ! REGISTER PG IS SET TO POINT TO THE BASE OF THIS BLOCK
   134				 BY SAVARG ROUTINE. REGISTER P IS ADVANCED TO POINT TO THE WORD
   135				 FOLLOWING THE BLOCK. IN GENERAL THE
   136				 PDL LOOKS LIKE THIS:
   137					FLAGS,,RETURN ADDR	;NOT NEEDED.
   138					XPAMOD	-B	<------(PG)
   139					.	 L
   140					.	 O
   141					.	 C
   142					XPACOM	-K
   143					.
   144					DATA PUSHED P, AFTER ARG BLOCK SETUP
   145					.	<-----(P)
   146				!
   147
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 4
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   148				SUBTTL ARGUMENT SETUP ROUTINES
   149
   150				COMMENT @ SUBROUTINE GTUARG
   151
   152				FUNCTION: GET USER ARGS FROM HIS CORE TO EXEC PDL FOR
   153					RUN,RUNSEG/GETSEG. RETURN (PG) SETUP TO POINT
   154					TO THE ARG BLOCK IN PDL. SETUP XPACOM, XPAMOD
   155
   156				CALL:	MOVE T1,<CONTENTS OF USER AC> T1/ ADDR INCR,,ARG BLOCK
   157					PUSHJ P,GTUARG
   158					RETURN HERE ALWAYS. (PG) BEGINS THE ARG BLOCK
   159							     (P2)=FILENAME ALSO IN XPANAM(PG)
   160
   161
   162				CALLS: SAVARG,SG2A,SG3
   163				RESTRICTIONS:
   164				DESTROYS:	T1,T2,T3,T4,P1,P2,P3,P4,W,U, RH(M), PG
   165				PRESERVES:
   166							 PRESERVES LH AC "M"--VERY IMPORTANT.
   167					EVERYONE IN THIS MODULE MUST PRESERVE LH OF M INCASE
   168					ERROR EXIT NEEDS TO BE TAKEN. SGRELE EXPECTS LH(M)
   169					TO CONTAIN ORIGINAL LH(UPTMUU): USER AC #.
   170
   171					AT (P)----> START-INCREMENT,,USER ARGBLOCK ADDR
   172
   173				@
   174
   175
   176	000060'			GTUARG::
   177	000060'	540540	000006		HRR	M,T1		;MOVE ADR. OF ARG LIST TO M
   178	000061'	200340	000006		MOVE	T2,T1		;SAVE FOR START INCR IN LH
   179	000062'	256200	002524'		UMOVE	U,0(M)		;DEVICE NAME
   180	000063'	256200	002525'		UMOVE   P2,1(M)		;FILENAME
   181	000064'	256200	002526'		UMOVE	P1,2(M)		;EXTENSION
   182	000065'	256200	002527'		UMOVE	T4,4(M)		;PPN
   183	000066'	256200	002530'		UMOVE	T3,5(M)		;LICENSE TO PASS,,CORE REQUESTED
   184	000067'	322440	000075'		JUMPE	T4,GETARG	;NO PPN SPECIFIED
   185	000070'	603440	777777		TLNE	T4,-1		;REAL PPN?
   186	000071'	254000	000075'		  JRST	GETARG		;YES.
   187	000072'	256200	002531'		UMOVE	P3,(T4)		;GET FIRST WORD OF USER NAME
   188	000073'	256200	002532'		UMOVE	P4,1(T4)	;GET SECOND WORD OF USER NAME
   189	000074'	201440	000001		MOVEI	T4,1		;INDICATE USER NAME, NOT PPN
   190	000075'			GETARG:
   191	000075'	621500	000007		TLZ	W,NOSHR!HSLIC!LSLIC	;CLEAR FLAGS IN MODE WORD
   192	000076'	541500	000016		HRRI	W,DR		;SET DUMP RECORDS MODE (MAGTAPE!)
   193	000077'	265300	000222'		JSP	T1,SAVARG	;PUT THINGS IN PDL, SETUP PG/BLOCK ADDR
   194	000100'	261040	000007		PUSH	P,T2		;START-INCR,USERBLOCK
   195	000101'	256200	002533'		XCTBU	<HLLZS JOBCOR>
   196	000102'	260040	000412'		PUSHJ	P,SG3
   197	000103'	254023	777777		JRST	@-1(PG)		;RETURN TO OUR CALLER.
   198
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 5
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   199				COMMENT	@ SUBROUTINE GNUARG
   200				; ROUTINE TO SAVE ARGUMENTS FOR GET/RUN/SAVE FRMOPS, ETC. IN PDL.
   201				; THE ARGUMENTS ARE RETURNED ON THE STACK, P IS ADVENCED PAST END OF
   202				; BLOCK SO THINGS CAN STILL BE PUSHED; PG POINTS TO BASE OF ARG BLOCK
   203				; ON STACK - ACCESS TO ARGUMENTS SHOULD BE RELATIVE TO PG NOT P.
   204				; THE STRUCTURE OF THE PDL IS DESCRIBED BEGINNING AT XPAMOD:! .
   205
   206				EXPECTS:	
   207					W/	FLAGS,,???
   208					M/	ADDR OF USER ARGUMENT [-CNT,,ADR]
   209
   210				CALL:	PUSHJ	P,GNUARG	;WARNING - MUNGS STACK
   211					  error return		;stack restored
   212					success return		;stack munged
   213
   214				RESTRICTIONS:	MUNGS STACK!
   215				DESTROYS:	T1,T2,U,RH(W),PG
   216				PRESERVES:
   217
   218				@
   219
   220	000104'	000003	000043		XPAUN1(PG)		;UN1
   221	000105'	000003	000044		XPAUN2(PG)		;UN2
   222	000106'			GNUTAB:	; table of argument destinations
   223	000106'	000001	000000		(P)			;START INCR IN LH
   224	000107'	000003	000001		XPADEV(PG)		;DEVICE
   225	000110'	000003	000003		XPAPPN(PG)		;PPN
   226	000111'	000003	000004		XPANAM(PG)		;NAME
   227	000112'	000003	000045		XPAUXT(PG)		;EXTENSION
   228	000113'	000003	000046		XPANEW(PG)		;CORE (NEW)
   229			000006	GNULEN==.-GNUTAB
   230
   231	000114'			GNUARG::
   232	000114'	541500	000016		HRRI	W,DR		;DUMP RECORDS MODE
   233	000115'	250501	000000		EXCH	W,(P)		;W _ RETURN ADDRESS; (P) _ FLAGS
   234	000116'	200140	000001		MOVE	PG,P		;PG/-XX,,BASE OF ARG BLOCK
   235	000117'	270040	002534'		ADD	P,[SGLEB,,SGLEB];ADVANCE STACK PAST BLOCK
   236	000120'	325040	000142'		JUMPGE	P,GNUPDL	;CRASH IF WE OVERFLOWED
   237								;NOTE - P REALLY ONE PAST WHAT IT NEEDS
   238								;TO BE, THIS IS FOR THE START INCR
   239	
   240	000121'	256200	002535'		UMOVE	T2,(M)		;GET THE ARGUMENT COUNT
   241	000122'	560300	000013		HRRO	T1,M		;PUT THE ADDRESS IN RH (OF WORD 0)
   242	000123'	641307	000000		TLC	T1,(T2)		;T1/ -<CNT+1>,,ADR FOR USER BLOCK
   243	000124'	200340	002536'		MOVE	T2,[XWD -GNULEN,GNUTAB] ;DESTINATION INDEX
   244	000125'	256200	002537'	GNUALP: UMOVE	U,(T1)		;GET THE DATA WORD
   245	000126'	202267	000000		MOVEM	U,@(T2)		;SAVE IT ON PDL
   246	000127'	252300	000135'		AOBJP	T1,GNUA1	;UPDATE USER POINTER (IF OVERFLOW, DONE)
   247	000130'	253340	000125'		AOBJN	T2,GNUALP	;UPDATE OUR POINTER (IF OVERFLOW, ERR)
   248								; BAD ARGUMENT COUNT ERROR
   249	000131'	200040	000003		MOVE	P,PG		;RESTORE STACK
   250	000132'	250501	000000		EXCH	W,(P)		;RESTORE RETURN ADDRESS
   251	000133'	263040	000000		POPJ	P,		;ERROR RETURN
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 5-2
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   252
   253	000134'	402027	000000		SETZM	@(T2)		;ZERO OUT THE UNSPECIFIED STUFF
   254	000135'	253340	000134'	GNUA1:	AOBJN	T2,.-1		;ANY UNSPECIFIED STUFF LEFT?
   255	
   256	000136'	201340	000106'		MOVEI	T2,GNUTAB	;ADR OF TABLE FOR GNUPPN
   257	000137'	260040	000143'		PUSHJ	P,GNUPPN	;GET USERNAME IF LH(PPN) IS 0
   258	000140'	402003	000047	GNUA2:	SETZM	XPALIC(PG)	;GET LICENSES OFF FILES
   259	000141'	254012	000001		JRST	1(W)		;SKIP RETURN (SIC)
   260
   261	000142'	256000	000000'	GNUPDL:	 STOPCD			;PDL OV WHILE STACKING GET/RUN/SAVE ARGS
   262
   263
   264				; CALL GNUPPN TO MAKE SURE THE PPN IS REAL, IF NOT, IT WILL FETCH
   265				; THE USERNAME THROUGH TABLE-1,-2
   266				;	T2/ ADDR OF DESTINATION TABLE
   267
   268	000143'	332327	000002	GNUPPN:	SKIPE	T1,@2(T2)	;GET PPN
   269	000144'	603300	777777		 TLNE	T1,-1		;IS IT A USER NAME?
   270	000145'	263040	000000		  POPJ	P,		; REAL PPN or NULL (leave it alone)
   271	000146'	256200	002537'		UMOVE	U,0(T1)		;GET FIRST WORD
   272	000147'	202267	777776		MOVEM	U,@-2(T2)	;SAVE IT
   273	000150'	256200	002540'		UMOVE	U,1(T1)		;GET SECOND WORD
   274	000151'	202267	777777		MOVEM	U,@-1(T2)	;SAVE IT
   275	000152'	201240	000001		MOVEI	U,1		;CODE 1 FOR PPN MEANS USE UN1,UN2
   276	000153'	202267	000002		MOVEM	U,@2(T2)	;SAVE IT
   277	000154'	263040	000000		POPJ	P,
   278
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 6
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   279				COMMENT	@ SUBROUTINE GNUARX
   280				; ROUTINE TO SAVE ARGUMENTS FOR GET/RUN/SAVE FRMOPS, ETC. IN %UPX+UPTXAC
   281
   282				EXPECTS:	
   283					W/	FLAGS,,???
   284					M/	ADDR OF USER ARGUMENT [-CNT,,ADR]
   285					%UPX ALL SET UP AND LOCKED
   286
   287				CALL:	PUSHJ	P,GNUARG	
   288					  error return		
   289					success return		
   290
   291				RESTRICTIONS:	
   292				DESTROYS:	T1,T2,U,RH(W),PG
   293				PRESERVES:
   294
   295				@
   296
   297				EXTERNAL %UPX
   298
   299	000155'	000000	000000*		%UPX+UPTXAC+P3		;UN1
   300	000156'	000000	000000*		%UPX+UPTXAC+P4		;UN2
   301	000157'			GNUTBX:	; table of argument destinations
   302	000157'	000000	000000*		%UPX+UPTXAC+S		;START INCR IN LH
   303	000160'	000000	000000*		%UPX+UPTXAC+U		;DEVICE
   304	000161'	000000	000000*		%UPX+UPTXAC+T4		;PPN
   305	000162'	000000	000000*		%UPX+UPTXAC+P2		;NAME
   306	000163'	000000	000000*		%UPX+UPTXAC+P1		;EXTENSION
   307	000164'	000000	000000*		%UPX+UPTXAC+T3		;CORE (NEW)
   308			000006	GNULNX==.-GNUTBX
   309
   310	000165'			GNUARX::
   311	000165'	541500	000016		HRRI	W,DR		;DUMP RECORDS MODE
   312	000166'	202500	000000*		MOVEM	W,%UPT+UPTXAC+W	;MODE AND FLAGS
   313	000167'	256200	002535'		UMOVE	T2,(M)		;GET THE ARGUMENT COUNT
   314	000170'	560300	000013		HRRO	T1,M		;PUT THE ADDRESS IN RH (OF WORD 0)
   315	000171'	641307	000000		TLC	T1,(T2)		;T1/ -<CNT+1>,,ADR FOR USER BLOCK
   316	000172'	200340	002541'		MOVE	T2,[XWD -GNULNX,GNUTBX] ;DESTINATION INDEX
   317	000173'	256200	002537'	GNUAXL: UMOVE	U,(T1)		;GET THE DATA WORD
   318	000174'	202267	000000		MOVEM	U,@(T2)		;SAVE IT IN %UPX
   319	000175'	252300	000201'		AOBJP	T1,GNUAX1	;UPDATE USER POINTER (IF OVERFLOW, DONE)
   320	000176'	253340	000173'		AOBJN	T2,GNUAXL	;UPDATE OUR POINTER (IF OVERFLOW, ERR)
   321								; BAD ARGUMENT COUNT ERROR
   322	000177'	263040	000000		POPJ	P,		;ERROR RETURN
   323
   324	000200'	402027	000000		SETZM	@(T2)		;ZERO OUT THE UNSPECIFIED STUFF
   325	000201'	253340	000200'	GNUAX1:	AOBJN	T2,.-1		;ANY UNSPECIFIED STUFF LEFT?
   326	
   327	000202'	201340	000157'		MOVEI	T2,GNUTBX	;ADR OF TABLE FOR GNUPPN
   328	000203'	260040	000143'		PUSHJ	P,GNUPPN	;GET USERNAME IF LH(PPN) IS 0
   329	000204'	202500	000000*		MOVEM	W,%UPX+UPTXAC+W	;SAVE FLAGS AND MODE
   330	000205'	254000	000000*		JRST	CPOPJ1
   331
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 7
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   332				COMMENT ! ROUTINE SETOPN
   333				FUNCTION: SETUP T1-T3 FOR OPEN OF RUNCHN
   334				EXPECTS: PG/BLOCK IN PDL
   335				!
   336	000206'			SETOPN:
   337	000206'	200303	000000		MOVE T1,XPAMOD(PG)
   338	000207'	200343	000001		MOVE T2,XPADEV(PG)
   339	000210'	201400	000000		MOVEI T3,0		;ALWAYS IN DR MODE, NO BUFF HDRS
   340	000211'	263040	000000		POPJ P,
   341
   342
   343				COMMENT ! ROUTINE SETACS - FOR SAVJOB ONLY
   344				FUNCTION: SET UP T1-T3 FOR OPEN, P1-P4 FOR SHORT ENTER BLOCK
   345				!
   346	000212'	260040	000206'	SETACS: PUSHJ P,SETOPN
   347	000213'	200603	000004		MOVE P1,XPANAM(PG)
   348	000214'	200643	000045		MOVE P2,XPAUXT(PG)
   349	000215'	201700	000000		MOVEI P3,0		;DATE, ALWAYS CURRENT
   350	000216'	200743	000003		MOVE P4,XPAPPN(PG)
   351	000217'	306740	000001		CAIN P4,1
   352	000220'	541743	000043		HRRI P4,XPAUN1(PG)
   353	000221'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 8
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   354				COMMENT @ SUBROUTINE SAVARG
   355				; ROUTINE TO SAVE ARGUMENTS FROM COMMAND STRING IN PDL
   356				;  ARGUMENTS ARE DEFINED RELATIVE TO BASE REGISTER PG
   357				;
   358
   359				CALL:	GET ACS LOADED FROM UPTXAC (RUN/GET CMD..SGSET)
   360					OR
   361					GET ACS LOADED FROM USER CORE (UUOS..GTUARG)
   362					JSP T1,SAVARG
   363					RETURN HERE. (P) ADVANCED PAST END OF BLOCK
   364							(PG) POINTS AT BLOCK
   365
   366				RESTRICTIONS:
   367				DESTROYS:
   368
   369				@
   370
   371
   372	000222'			SAVARG:
   373	000222'	261040	000012		PUSH P,W	;MODE+FLAGS
   374	0'	200140	000001		MOVE PG,P	;PG/-XX,,BASE ADDR OF ARG BLOCK
   375	000224'	270040	002542'		ADD P,[SGLEB-1,,SGLEB-1];ADV P PAST ENTIRE BLOCK
   376	000225'	325040	000237'		JUMPGE P,SVARG2	;PDL OV
   377	000226'	202243	000001		MOVEM U,XPADEV(PG)
   378	000227'	202443	000003		MOVEM T4,XPAPPN(PG)	;PPN OR CODE 1
   379	000230'	202643	000004		MOVEM P2,XPANAM(PG)
   380	000231'	202603	000045		MOVEM P1,XPAUXT(PG)
   381	000232'	202703	000043		MOVEM P3,XPAUN1(PG)
   382	000233'	202743	000044		MOVEM P4,XPAUN2(PG)
   383	000234'	202403	000046		MOVEM T3,XPANEW(PG)	;LICENSES TO PASS,NEW CORE ALLOC
   384	000235'	402003	000047		SETZM XPALIC(PG)	;HI&LOW SEG LICENSES FROM FILES
   385	000236'	254006	000000		JRST (T1)	;RETURN TO OUR CALLER
   386				;NOTE: AFTER RETURNING, GARBAGE STILL LIES IN THE LOCATIONS
   387				; IN BLOCK NOT EXPLICITLY SET. SETLKB CLEARS THIS
   388
   389
   390	000237'	256000	000000'	SVARG2:	 STOPCD		;OVERFLEW PDL!
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 9
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   391				COMMENT @ ROUTINE SGSET AND SGSETD
   392
   393				FUNCTION: GET THE "RUN","SAVE","SSAVE","GET"
   394					COMMAND ARGS TO UPTXAC  AREA THEN SCHEDULE
   395					THE APPROPRIATE MONITOR JOB.
   396
   397				CALLERS:	SGSETD:  SAVE/SSAVE ONLY
   398						SGSET:	 GET, RUNCOM
   399					NOTE: IMPLICIT "RUN" COMMANDS (LOGIN,LOGOUT,RESRUN..)
   400						COME THRU THERE TOO.
   401
   402				CALL:	MOVE S,XWD FLAGS, ADDR OF MONITOR JOB TO RUN
   403					MOVSI T2,DEVICE NAME
   404					MOVE W, PHONLY BIT IF NEEDED (KJOB)
   405					MOVE J,JOB NO. OF JOB TYPING THIS COMMAND
   406					SET JBTNAM(J) AS APPROPRIATE..0 OR FILENAME
   407					PJRST SGSET
   408
   409				EXIT:	THIS JOB SET TO RUN THE MONITOR JOB IN S
   410					RETURN TO CLOCK LEVEL COMMAND PROCESSING
   411
   412				DESTROYS:
   413				RESTRICTIONS:
   414				CALLS: CTEXT,CTEX1,PJPGNO,MAPUPS,COMTYS,DECIN1
   415
   416				LOCATIONS SET: SGSET LEAVES DATA IN THESE LOCS, WHICH GETS
   417				PICKED UP INTO THE INDICATED ACS WHEN THE MONJOB RUNS.
   418				XGADEV..U	XGAMOD..W	XGAPPN..T4	XGAEXT..P1
   419				XGANAM..P2	XGANEW..T3	XGAUN1..P3	XGAUN2..P4
   420
   421				JBTNAM(J) IS ALSO SET UPON EXIT
   422
   423				FLAGS & OTHER ARGS:
   424				SAVE/SSAVE CALL.. S_<0 OR NSRBIT>,,SAVJOB; JBTNAM(J)_0
   425				GET CALL..S_0,,GETJOB; JBTNAM(J)_0; T2_"DSK"
   426				RUNCOM CALL..(ALSO RCOM,ARCOM,RESRUN)
   427					S_1B16,,RUNJOB  THIS 1B16 TELLS PJPGNO TO PICK UP
   428						%UPT+UPTRPN FOR PPN. RESTR CMD MODE
   429					S_1B17,,RUNJB2 KJOB RUN ENTRY+1 ON LOGOUT
   430					S_0,,RUNJOB NORMAL RUN ENTRY+0
   431					T2_"DSK" OR "SYS"
   432					JBTNAM(J)_0 OR FILENAME
   433
   434				@
   435
   436	000240'	205340	446353	SGSETD::	MOVSI T2,'DSK';ASSUME DSK
   437	000241'	261040	000007	SGSET::	PUSH P,T2	;SAVE DEVICE NAME
   438	000242'	260040	000000*		PUSHJ P,MAPUPS##;MAKE LMAP&UPT ADDR'ABLE IN EXEC SLOT
   439							;(DESTROY T1-T4,PG ONLY)
   440	000243'	262040	000000*		POP P,XGADEV	;PUT DEVICE AWAY FOR MON JOB
   441	000244'	402000	000000*		SETZM %UPS+UPTPID	;CLEAR PID AND SAVED PID FOR RUN GET AND
   442	000245'	402000	000000*		SETZM %UPS+UPTSPD	; SAVE COMMANDS.
   443	000246'	404500	002543'		AND W,[XWD PHONLY,0]	;SAVE PHONLY
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 9-2
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   444	000247'	603000	400000		TLNE	S,NSRBIT
   445	000250'	661500	000001		TLO	W,NOSHR		;INDICATE NON-SHAREABLE HIGH SEG
   446	000251'	202500	000000*		MOVEM W,XGAMOD	;SAVE PHYSICAL ONLY BIT
   447	000252'	260040	000000*		PUSHJ P,CTEXT1##;GET T2/SIXBIT TEXT
   448	000253'	322340	000325'		JUMPE T2,SGSET4	;SEE IF "(DIRECTORY)"
   449	000254'	302400	000072		CAIE T3,":"		;END WITH :?
   450	000255'	254000	000260'		JRST SGSETF		;NO
   451	000256'	202340	000000*		MOVEM T2,XGADEV
   452	000257'	260040	000000*		PUSHJ P,CTEXT##
   453	000260'	336000	000007	SGSETF:	SKIPN T2
   454	000261'	200342	000000*		MOVE T2,JBTNAM(J)
   455	000262'	322340	000000*		JUMPE T2,NOTENF##
   456	000263'	402000	000000*		SETZM XGAPPN
   457	000264'			SGSET3:
   458	000264'	202342	000261*		MOVEM T2,JBTNAM(J)	;SAVE FILE NAME FOR SYSTAT COMMAND
   459	000265'	202340	000000*		MOVEM T2,XGANAM		;FOR LATER PICKUP BY SETACS
   460	000266'	201340	000000		MOVEI T2,0		;ASSUME USER DID NOT SPECIFY AN EXTENSION
   461								; 0 WILL BE TURNED INTO SAV OR DMP
   462	000267'	306400	000056		CAIN T3,"."		;IS AN EXTENSION SPECIFIED
   463	000270'	260040	000257*		PUSHJ P,CTEXT##		;YES. GET EXTENSION
   464	000271'	557000	000007		HLRZS T2		;SEE IF THE USER
   465	000272'	302340	635062		CAIE T2,(SIXBIT /SHR/)  ;HAS SPECIFIED AN
   466	000273'	306340	504750		CAIN T2,(SIXBIT /HGH/)  ;IMPROPER LOW EXTENSION
   467	000274'	254000	000356'		JRST SGSET5		;COMPLAIN
   468	000275'	306340	636762		CAIN T2,(SIXBIT/SWR/)	;WRITEABLE HISEG?
   469	000276'	254000	000356'		JRST SGSET5		;YES,COMPLAIN
   470	000277'	516340	000000*		HRLZM T2,XGAEXT		;STORE IT FOR LOOKUP
   471	000300'	260040	000000*		PUSHJ P,PJPGNO##	;GET PROJ. PROG. NO.
   472	000301'	332000	000015		SKIPE P2		;DO NOT STORE IF NONE
   473	000302'	202640	000000*		MOVEM P2,XGAPPN	;STORE 0 IF NO []'S TYPED BY USER
   474	000303'	260040	000000*		PUSHJ P,DECIN1##;AMOUNT OF CORE (OPTIONAL THIRD ARG.) IN 1K BLOCKS
   475	000304'	254000	000322'		JRST SGSET1		;DOES NOT RETURN IF ERROR, RETURN HERE IF NO ARG. T2/0
   476	000305'	254000	000000*		JRST COMERA##		;ILLEGAL CHARACTER
   477	000306'	322340	000000*		JUMPE T2,COMERR##
   478	000307'	201300	000012		MOVEI T1,^D10
   479	000310'	303400	000040		CAILE T3," "	;IF HE GAVE AN ARG WITHOUT "P" OR "K"
   480	000311'	306400	000113		CAIN T3,"K"
   481	000312'	254000	000316'		JRST SGSET2	;OR WITH "K", SHIFT ^D10
   482	000313'	201300	000011		MOVEI T1,^D9	;ELSE 9 IF "P"
   483	000314'	302400	000120		CAIE T3,"P"	;MEANS PAGES
   484	000315'	254000	000306*		JRST COMERR##	;HE TERMINATED WITH SOMETHING ELSE
   485	000316'	242346	000000	SGSET2:	LSH T2,(T1)	;CONVERT TO WORDS
   486	000317'	275340	000001		SUBI T2,1
   487	000320'	303340	777777		CAILE T2,777777	;BOMB IF HE SAID MORE THAN ALL OF CORE
   488	000321'	254000	000315*		JRST COMERR##
   489	000322'	552340	000000*	SGSET1:	HRRZM T2,XGANEW		;LICENSE_0,,CORE_WORDS FROM ARG TYPED
   490	000323'	550340	000000		HRRZ T2,S		;SCHEDULE MONITOR JOB
   491								; GUARRANTEE LH OF PC WORD IS 0, SINCE IT WILL
   492								; BE ADDED TO STARTING ADDRESS(IF RUN COM)
   493	000324'	254000	000000*		JRST MSTART##		;START JOB WITH PC IN MONITOR MODE
   494
   495				;READ (USERNAME),STICK IN XGAUN1,2
   496
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 9-3
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   497	000325'	200400	000000*	SGSET4:	MOVE T3,TTCMCH##
   498	000326'	302400	000050		CAIE T3,"("
   499	000327'	254000	000260'		JRST SGSETF
   500	000330'	205340	446353		MOVSI T2,'DSK'
   501	000331'	202340	000000*		MOVEM T2,XGADEV
   502	000332'	205640	440600		MOVSI P2,(POINT 6,0)
   503	000333'	541640	000000*		HRRI P2,XGAUN1
   504	000334'	201340	000001		MOVEI T2,1
   505	000335'	202340	000000*		MOVEM T2,XGAPPN
   506	000336'	201340	000014		MOVEI T2,^D12		;MAX NUMBER OF CHRS
   507	000337'	402000	000000*		SETZM XGAUN1
   508	000340'	402000	000000*		SETZM XGAUN2
   509	000341'	260040	000000*	RUNM1:	PUSHJ P,COMTYS##
   510	000342'	307400	000040		CAIG T3,40
   511	000343'	254000	000262*		JRST NOTENF##	;DID NOT FINISH
   512	000344'	306400	000051		CAIN T3,")"
   513	000345'	254000	000352'		JRST UNMDN
   514	000346'	275400	000040		SUBI T3,40
   515	000347'	361340	000341'		SOJL T2,RUNM1
   516	000350'	136400	000015		IDPB T3,P2
   517	000351'	254000	000341'		JRST RUNM1
   518				;TERMINATING ")" RECEIVED
   519	000352'	260040	000341*	UNMDN:	PUSHJ P,COMTYS##;SKIP )
   520	000353'	260040	000252*		PUSHJ P,CTEXT1##;GET FILE NAME
   521	000354'	326340	000264'		JUMPN T2,SGSET3
   522	000355'	254000	000343*		JRST NOTENF##
   523	000356'			SGSET5:	;USER TYPED RUN[GET/SAVE/SSAVE] FILE.[SHR/HGH/SWR]
   524	000356'	265300	000000*		JSP T1,ERRMES##
   525					ASCIZ /
   526	000357'	064252	046212	PLEASE DONT SPECIFY A HISEGMENT EXTENSION/
	000360'	406470	520210
	000361'	476352	420246
	000362'	502130	344614
	000363'	545010	120220
	000364'	446470	543632
	000365'	426352	420212
	000366'	542510	547246
	000367'	446371	600000
   527
   528				; EXEC AC LOCATION DEFINITIONS FOR PASSING PARAMETERS
   529				; BETWEEN COMMAND LEVEL AND UUO LEVEL.
   530
   531				DEFINE XX(A,B)
   532				<A==B>
   533			012107		XX 	XGADEV,%UPS+UPTXAC+U
   534			012115		XX	XGAMOD,%UPS+UPTXAC+W
   535			012123		XX	XGAPPN,%UPS+UPTXAC+T4
   536			012131		XX	XGAEXT,%UPS+UPTXAC+P1
   537			012137		XX	XGANAM,%UPS+UPTXAC+P2
   538			012145		XX	XGANEW,%UPS+UPTXAC+T3
   539			012153		XX	XGAUN1,%UPS+UPTXAC+P3
   540			012161		XX	XGAUN2,%UPS+UPTXAC+P4
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 10
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   541				COMMENT % ROUTINES SG1,SG3
   542
   543				FUNCTION:	FOR SAVJOB,RUNJOB,RUNJB2 SG1 SETS UP THE
   544					FAMILIAR PDL STRUCTURE WITH ARG BLOCK POINTED TO
   545					BY PG, DIDDLES FLAGS IN XPAMOD, DOES RESET, ETC.
   546
   547					SG3 DOES: XPACOM(PG)_(IF (DDT OR JOBFF-1>UPTREL)
   548						THEN (-UPTREL+JOBSVM,,JOBSVM)
   549						ELSE (1-JOBFF+JOBSVM,,JOBSVM)  )
   550
   551				IMPORTANT: THIS IS WHERE IO MODE GETS SET TO DR=16. DUMP RECORDS.
   552					FOR DISK, THIS MODE = DUMP. BUT FOR MAGTAPE, THIS MODE
   553					MAKES A BIG DIFFERENCE. CODE IN READLS AND READHS
   554					ASSUMES THAT DATA IS ON TAPE THIS WAY. READLS READS
   555					IOWD WORDS FROM TAPE OR UNTIL EOF. EOF EXPECTED AFTER
   556					HI AND LO SEGS ON TAPE.
   557
   558					THE JRST@ -1(PG) EXIT RETURNS CONTROL TO SG1'S CALLER.
   559
   560				CALL:	JSP T2,SG1..
   561					PUSHJ P,SG3..
   562				RETURNS: A CALL FROM LOC:  JSP T2,SG1 LEAVES PDL AS FOLLOWS ON RETURN:
   563
   564					FLAGS,,LOC+1	(NOT NEEDED ONCE SG1 HAS RETURNED)
   565					XPAMOD		<-----(PG)
   566					 ..
   567					 ..
   568					XPACOM		<-----(P)
   569				%
   570
   571
   572	000370'	265300	000000*	SG1:	JSP T1,MONSTR##		;SETUP J,P,PUSH T2,T1
   573	000371'	265300	000222'		JSP T1,SAVARG		;SAVE ARGUMENTS IN PDL
   574	000372'	205300	000000*		MOVSI T1,LMMEXS		;IF VP 0 DOES NOT EXIST,
   575	000373'	612300	000000*		TDNE T1,%UPLMA+0	;BETTER CREATE IT SO THAT
   576	000374'	254000	000402'		JRST SG1A		;ALL REFS TO JOBDATA AREA WILL
   577	000375'	403300	000007		SETZB T1,T2		;SUCCEED. FROM T1/0 TO T2/0,
   578	000376'	260040	001531'		PUSHJ P,CORXPN		;CREATE. CLOB T1,W
   579					JRST [PUSH P,[0]	;CANT CREATE PG 0, COMPLAIN.
   580	000377'	254000	002545'			JSP T1, NOROOM]
   581	000400'	201300	000777		MOVEI T1,777
   582	000401'	542300	000000*		HRRM T1,%UPT+UPTREL
   583	000402'			SG1A:
   584
   585	000402'	047000	000000		CALLI 0		;RESET
   586	000403'	200503	000000		MOVE W,XPAMOD(PG)	;GET PHYSICAL ONLY FLAG
   587	000404'	541500	000016		HRRI W,DR		;DUMP RECORD MODE = 16 (FOR MAGTAPE'S BENEFIT)
   588	000405'	404500	002547'		AND W,[XWD PHONLY!NOSHR,-1] ;NOTE HSLIC,LSLIC_0 HERE
   589	000406'	202503	000000		MOVEM W,XPAMOD(PG)
   590	000407'	256200	002533'		XCTBU <HLLZS JOBCOR>	;SO CKSARG WILL WORK ?
   591								; WORK ON FIRST CALL(SAVE AND GET)
   592	000410'	260040	000412'		PUSHJ	P,SG3
   593	000411'	254023	777777		JRST @-1(PG)		;RETURN
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 10-2
SEGCON.MAC	28-OCT-87 00:02		ARGUMENT SETUP ROUTINES

   594
   595
   596
   597	000412'			SG3::	
   598
   599	000412'	256200	002550'		UMOVE T1,JOBFF	;FIRST FREE LOC IN JOB(SET FROM LH OF
   600								; JOBSA WHICH IS SET BY LOADER
   601	000413'	201306	777777		MOVEI T1,-1(T1)	;MAKE LAST LOC TO SAVE OR GET(MAKE 0=777777)
   602	000414'	256200	002551'		XCTBU <SKIPN JOBDDT>  ;SAVE ALL IF DDT IN USE
   603	000415'	256200	002552'		XCTBU <CAMLE	T1,JOBREL>	;NO, ADDRESS TOO LARGE?
   604	000416'	256200	002553'		UMOVE T1,JOBREL		;YES, DUMP ALL OF CORE RATHER THAN GIVE
   605								; ADDRESS CHECK MESSAGE-HIGHEST REL.ADR.
   606	000417'	213000	000006		MOVNS T1		;-HIGHEST ADR TO SAVE OR GET
   607	000420'	271300	000000*		ADDI T1,JOBSVM		;LOWER CORE NOT DUMPED
   608	000421'	505300	000420*		HRLI T1,JOBSVM		;IE FIRST LOC-1 TO BE DUMPED
   609	000422'	206303	000051		MOVSM T1,XPACOM(PG)	;STORE IOWD WORD OF THIS SIZE CORE
   610
   611	000423'	263040	000000		POPJ P,
   612
   613				COMMENT ! CHANGE LINES 5400:5500 IF LH UPTREL EVER USED
   614					FOR ANYTHING !
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 11
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   615				SUBTTL UTILITY ROUTINES
   616				COMMENT @ SOBROUTINE SGDO
   617				FUNCTION: EXECUTE THE INPUT/OUTPUT UUO AT (P), CHECK FOR
   618					IO ERRORS & ABORT IF SO (NO RETURN TO SGDO CALLER)
   619					EXPAND LOWSEG CORE IF NEEDED, & RETURN.
   620				CALL:	SETUP DUMP MODE IOLIST
   621					PUSHJ P,SGDO
   622					INPUT/OUTPUT UUO
   623					RETURN HERE IF NO ERRORS, CORE EXPANDED
   624				RESTRICTIONS:
   625				CALLS: EXPAND,SGIOCK
   626				DESTROYS:
   627
   628				@
   629
   630
   631	000424'	256021	000000	SGDO:	XCT @(P)		;EXECUTE INPUT OR OUTPUT M
   632	000425'	260040	000433'		PUSHJ	P,SGIOCK	;CHECK FOR ERRORS ON IO
   633	000426'	260040	001053'		PUSHJ P,EXPAND	;EXPAND CORE IMAGE
   634	000427'	205300	000000*		MOVSI	T1,XPNCOR	;CLEAR CORE EXPANDED BIT
   635	000430'	412300	000000*		ANDCAM	T1,%UPT+UPTSTS
   636	000431'	350001	000000		AOS (P)		;SKIP OVER M IN CALLING SEQUENCE
   637	000432'	263040	000000		POPJ	P,
   638
   639
   640				COMMENT @ SUBROUTINE SGIOCK
   641				FUNCTION: CHECK IF ANY OF IOBKTL,IODTER,IODERR,IOMPM HAPPENED
   642					ON LAST UUO FOR CHANNEL RUNCHN. IF NO, RETURN. IF
   643					YES, RETURN TO USER OR CMD LEVEL, NO RETURN TO
   644					SGIOCK CALLER.
   645				DESTROYS:	S,T1.
   646				RETURNS: S/ IO STATUS FOR RUNCHN
   647				CALL:	PUSHJ P,SGIOCK
   648					RETURN HERE IO OK, S/STATUS
   649				RESTRICIONS:
   650				CALLS: SGRELE TO DECIDE WHERE TO GO FOR THE ERROR RETURN
   651
   652
   653				RIBERB:	ENTRY RIBERB USED WHEN LOOKUP FINDS FILE WITH RIBSTS
   654						ERROR BITS. FAKES A TRANSMISSION ERROR.
   655
   656				MAPIOF:	ENTRY MAPIOF FOR USE WHEN VMAP UUO RETURNS
   657					ERROR CODE FOR CONDITION WHICH WOULD HAVE GIVEN IOIMPM,
   658					IODTER, ETC WITH INPUT UUO UNDER OLD MONITOR. VMAP SETS
   659					NO DEVIOS BITS.
   660				@
   661
   662	000433'			SGIOCK::
   663	000433'	062000	000000		GETSTS RUNCHN,S	
   664	000434'	606000	740000		TRNN S,IOBKTL!IODTER!IODERR!IOIMPM	;ANY ERRORS ON SAVE-GET DEVICE?
   665	000435'	263040	000000		POPJ P,		;NO, GIVE OK RETURN
   666	000436'			RIBERB:
   667	000436'	201300	000006	MAPIOF:	MOVEI T1,TRNERR	;YES, ERROR CODE IN CASE THIS IS RUN UUO
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 11-2
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   668								; (TRANSMISSION ERROR)
   669	000437'	260040	000547'		PUSHJ P,SGRELE	;RELEASE DEVICE AND ERROR RETURN TO USER IF RUN M
   670							; OR RETURN HERE.
   671	000440'	200703	000004		MOVE	P3,XPANAM(PG)	;Error exit wants file name
   672	000441'	510743	000005		HLLZ	P4,XPAEXT(PG)	; and extension for type-out
   673	000442'	324740	000000*		PJRST	ERRTRE		;PRINT TRANSMISSION ERROR MESSAGE.
   674
   675				COMMENT ! ROUTINE DOLOOK
   676				FUNCTION: SETUP THE LOOKUP BLOCK, DO THE EXTENDED LOOKUP
   677					CK RIB ERROR BITS, FAKE A TRANSMISSION ERROR IF ANY ON.
   678					RETURN THINGS IN P2-P4
   679				EXPECTS: T1/EXT TO TRY
   680					PG/ BLOCK
   681					XPANAM,XPAPPN,XPAUN1,UN2 SET
   682				DESTROYS: T1,P2,P3,P4
   683				RETURNS: NOSKIP IF LOOKUP FAILED
   684					 NORETURN IF RIB ERROR BITS
   685					 SKIP RETURN P2/0,,EXT
   686						     P3/FILE PROT BITS 27-35
   687						   P4/SIZE IN WORDS
   688				!
   689	000443'	202303	000005	DOLOOK:	MOVEM T1,XPAEXT(PG)
   690	000444'	200303	000003		MOVE T1,XPAPPN(PG)
   691	000445'	306300	000001		CAIN T1,1
   692	000446'	541303	000043		HRRI T1,XPAUN1(PG)
   693	000447'	202303	000003		MOVEM T1,XPAPPN(PG)
   694	000450'	201300	000040*		MOVEI T1,UUPPID##+SGLLB	;GET COUNT, FLAG PID ACCESS.
   695	000451'	202303	000002		MOVEM T1,XPALKB(PG)
   696	000452'	205303	000006		MOVSI T1,XPAPRV(PG)
   697	000453'	541303	000007		HRRI T1,XPAPRV+1(PG)
   698	000454'	402006	777777		SETZM -1(T1)
   699	000455'	251303	000042		BLT T1,XPALKB+SGLLB(PG)	;ZERO OUT FROM XPAPRV TO END
   700	000456'	076003	000002		LOOKUP RUNCHN,XPALKB(PG)
   701	000457'	263040	000000		  POPJ P,
   702	000460'	200303	000021		MOVE T1,XPASTS(PG)	;RIB STATUS BITS
   703	000461'	602300	000000*		TRNE T1,BADBIT
   704	000462'	254000	000436'		JRST RIBERB		;FAIL,FAKE TRANSMISSION ERROR
   705	000463'	554643	000005		HLRZ P2,XPAEXT(PG)
   706	000464'	200743	000007		MOVE P4,XPASIZ(PG)
   707	000465'	135700	002554'		LDB P3,[POINT 9,XPAPRV(PG),8]
   708	000466'	254000	000205*		JRST CPOPJ1
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 12
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   709				COMMENT @ SUBROUTINE CKIOWD
   710				FUNCTION: VERIFY THAT XPANEW (USER CORE ARG) IF GIVEN IS
   711					AT LEAST LARGE AS SIZE OF THE FILE TO BE READ. IF
   712					NOT CAUSE "XX PAGES NEEDED" & STOP,
   713					(OR FRETURN TO RUNUUO WITH NECERR 'NOT ENUF CORE')
   714				CALL:	HRLE T2,-NO WORDS IN FILE
   715					PUSHJ P,CKIOWD
   716					RETURN HERE T1/ MAX(XPANEW,WORDS IN FILE) IOR 1777
   717				FAIL:	NO RETURN TO CKIOWD CALLER--EXIT THRU SGRELE
   718				DESTROYS:
   719				RESTRICTIONS:
   720				@
   721
   722	000467'	201300	000421*	CKIOWD:	MOVEI T1,JOBSVM	;FIRST LOC-1 READ OR WRITTEN IN USER AREA
   723	000470'	274300	000007		SUB T1,T2		;HIGHEST LOC=FIRST LOC-1+LENGTH OF FILE
   724								; FALL INTO CKSARG
   725
   726				COMMENT @ SUBROUTINE CKSARG
   727				FUNCTION: VERIFY THAT XPANEW (IF GIVEN (NON-ZERO)), IS AT
   728					LEAST AS LARGE AS JOBCOR VALUE PASSED IN T1.
   729					IF NOT, FRETURN THRU SGRELE TO CMD/USER, NO
   730					RETURN TO CKSARG CALLER. IF YES, RETURN
   731					T1/ MAX(XPANEW,JOBCOR)
   732				RESTRICTION: JOBDAT MUST HAVE BEEN INITIALIZED BEFORE
   733					JOBCOR VALUE PICKED UP & PASSED TO CKSARG.
   734					COULD BE INIT'ZD FROM VESTIG. JOBDAT BY INIJDA.
   735				CALL:	UHRRZ T1,JOBCOR
   736					PUSHJ P,CKSARG
   737					RETURN HERE T1/ MAX(XPANEW,JOBCOR) IOR 1777
   738
   739				@
   740
   741	000471'	435300	001777	CKSARG:	IORI T1,1777		;MAKE SURE 1K-1
   742	000472'	261040	000006		PUSH P,T1		;SAVE IT (ALSO CORRECT PLACE FOR NOROOM)
   743	000473'	550303	000046		HRRZ T1,XPANEW(PG)	;GET REQUESTED
   744	000474'	322300	000000*		JUMPE T1,TPOPJ		;NONE, USE SIZE FROM FILE
   745	000475'	435300	001777		IORI T1,1777		;USER CORE ARG 1K INCREMENTS
   746	000476'	315301	000000		CAMGE T1,(P)		;DOES HE WANT AT LEAST WHATS NEEDED?
   747	000477'	265300	000502'		JSP T1, NOROOM		;NO, ERROR
   748	000500'	202301	000000		MOVEM T1,(P)		;YES, SAVE IT
   749	000501'	254000	000474*		JRST TPOPJ		;AND RETURN
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 13
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   750
   751				COMMENT @ ERROR EXIT NOROOM
   752				FUNCTION: FRETURN TO USER WITH NECERR OR TO CMD LEVEL
   753					WITH "XX PAGES NEEDED" MSG. NO RETURN TO NOROOM CALLER.
   754				CALL:	PUSH P,WORDS USER CORE REQ WHICH FAILED/WAS BAD
   755					JRST NOROOM
   756				NOTE: MANY PLACES JSP T1,NOROOM AS AN AID TO DEBUGGING
   757
   758				RESTRICTIONS:
   759				@
   760
   761	000502'	201300	000010	NOROOM:	MOVEI T1,NECERR	;ERROR CODE IN CASE THIS IS RUN M(NOT ENOUGH CORE)
   762	000503'	260040	000547'		PUSHJ P,SGRELE	;RELEASE DEVICE AND ERROR RETURN TO USER IF RUN M
   763							; OR RETURN HERE.
   764	000504'	262040	000013		POP P,M		;GET AMOUNT OF CORE REQUESTED
   765	000505'	242540	777767		LSH	M,-^D9	;TURN TO PAGES.
   766	000506'	271540	000001		ADDI	M,1	;ADD 1
   767	000507'	324740	000000*		PJRST	ERRPGN		;PRINT N PAGES NEEDED.
   768
   769
   770
   771
   772
   773				COMMENT @ ERROR EXIT SGERRA
   774				FUNCTION:	TO FAIL-RETURN TO USER/CMD LEVEL WHEN
   775					OPEN UUO FAILS FOR A CMD/UUO. DECISION HOW TO
   776					RETURN MADE BY SGRELE.
   777				@
   778	000510'	201300	000011	SGERRA:	MOVEI T1,DNAERR	;ERROR CODE IN CASE RUN UUO(DEVICE NOT AVAILABLE)
   779	000511'	260040	000547'		PUSHJ P,SGRELE	;RETURN TO USER IF RUN UUO
   780							; OR RETURN HERE.
   781	000512'	201203	000001		MOVEI	F,XPADEV-DEVNAM(PG) ;SO DEVNAM(F) GIVES DEVICE NAME.
   782	000513'	324740	000000*		PJRST	ERRDNA		;PRINT DEVICE XXX NOT AVAILABLE
   783
   784
   785
   786
   787				COMMENT @ ERROR EXIT NOFILE
   788				FUNCTION: TO RETURN TO USER/CMD LEVEL WHEN FILE LOOKUP FAILS.
   789				ENTER:	PDL LOOKUP BLOCK AS RETURNED BY FAILING LOOKUP, PG/BLOCK
   790
   791				@
   792
   793	000514'	201300	000000	NOFILE:	MOVEI T1,FNFERR	;ERROR CODE IN CASE THIS IS RUN M(FILE NOT FOUND)
   794								; CHANGE ERROR CODE TO DISK ERROR CODE IF DEV IS DSK
   795	000515'	260040	000544'		PUSHJ P,SGRELL	;RETURN DISK LOOKUP OR ENTER ERROR CODE IF DSK
   796								; RELEASE DEVICE AND ERROR RETURN TO USER IF HE WANTED
   797								; OR RETURN HERE.
   798	000516'	200703	000004		MOVE P3,XPANAM(PG)	;GET NAME IN P3
   799	000517'	510743	000045		HLLZ P4,XPAUXT(PG)	;AND EXTENTION IN P4 FOR ERRFNF
   800	000520'	324740	000000*		PJRST ERRFNF		;PRINT FILE(.EXT) NOT FOUND
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 14
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   801				COMMENT @ SUBROUTINE GETCOR
   802				FUNCTION: GIVEN CORUUO ARG IN T1, DO CORE UUO & RETURN THE
   803					ARG UNCHANGED. IF UUO FAILS, DO "NOROOM" STUFF.
   804				RESTRICTION: WILL NOT THROW AWAY CORE. ONLY USED TO INCREASE
   805					SIZE OF LOWSEG, NEVER CALLED WITH NON-ZERO
   806					LH(T1).
   807				@
   808
   809	000521'	261040	000006	GETCOR: PUSH P,T1	;SAVE CORE ARG IN CASE OF ERROR
   810	000522'	256200	002555'		XCTBU <HRRZ T1,JOBREL>	;CURRENT LOWSEG SIZE
   811	000523'	311301	000000		CAML T1,0(P)		;SKIP IF CURRENT .LT. REQUEST
   812	000524'	254000	000501*		JRST TPOPJ		;DONT BOTHER DOING UUO
   813	000525'	200301	000000		MOVE T1,0(P)
   814	000526'	047300	000011		CALLI T1,11		;CORE UUO
   815	000527'	265300	000502'		JSP T1, NOROOM		;NOT AVAILABLE, PRINT ERROR AND AMOUNT TRYING FOR
   816	000530'	254000	000524*		JRST TPOPJ
   817
   818
   819
   820				COMMENT @ ERROR EXIT GETERR
   821				FUNCTION: FOR EXPAND AND GETJB IF FILE FORMAT APPEARS NOT
   822				 TO BE A SAVE FILE.
   823				@
   824
   825	000531'	201300	000007	GETERR:	MOVEI T1,NSFERR	;ERROR CODE IN CASE THIS IS RUN M(NOT SAVE FILE)
   826	000532'	260040	000547'		PUSHJ P,SGRELE	;RELEASE DEVICE AND ERROR RETURN TO USER IF RUN M
   827	000533'	324740	000000*		PJRST ERRNSF		;PRINT NOT A SAVE FILE.
   828
   829
   830				;SUBROUTINE TO ADJUST LOW SEG CORE ACCORDING TO ARG
   831				; ON GET OR PREVIOUS SAVE
   832				;CALL:	PUSHJ P,LOWFIN
   833				;	ALWAYS RETURN
   834
   835	000534'	256200	002556'	LOWFIN:	XCTBU <HRRZ T1,JOBCOR>	;CORE ARG FROM PREVIOUS SAVE(THIS MONITOR
   836								; ALWAYS STORES SOMETHING)
   837	000535'	336000	000006		SKIPN T1		;IS THIS AN OLD FORMAT FILE WITH NO CORE ARG TO SAVE?
   838	000536'	256200	002553'		UMOVE T1,JOBREL		;YES, USE ASSIGNMENT MADE WEN LOW FILE READ IN
   839	000537'	260040	000471'		PUSHJ P,CKSARG	;RETURN ONLY IF USER'S SUPLLIED ARG IS 0 OR NOT
   840								; SMALLER THAN SAVE CORE ARG, RETURN LARGER
   841	000540'	260040	000521'		PUSHJ P,GETCOR	;TRY TO GET THIS AMOUNT OF CORE
   842	000541'	256200	002553'		UMOVE T1,JOBREL		;HIGHEST LOC ASSIGNED TO LOW SEG
   843	000542'	256200	002557'		XCTBU <HRRM T1,JOBCOR>	;SET INITIAL CORE ASSIGNMENT IN JOB DATA AREA FOR
   844								; USER TO USE TO RESET CORE TO INITIAL SETTING WHEN
   845								; PROGRAM IS RESTARTED
   846	000543'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 15
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   847				COMMENT @ SUBROUTINE SGRELE, ENTRY SGRELL
   848				FUNCTION: SGRELE RETURNS ERROR CODE IN T1 TO USER UUO FAIL-RETURN,
   849				 IF PC.USR IS ON (THIS IS HOW WE KNOW WHETHER WE CAME FROM A UUO OR
   850				 FROM A CMD..BUT VARIOUS ROUTINES ZERO PC.USR TO FORCE CMD
   851				 FRETURNS) UNLESS A HALT FOLLOWS THE UUO,IN WHICH CASE
   852				 RETURN TO CMD LEVEL.
   853					ENTRY SGRELL IS TO RETURN DSK LOOKUP ERROR
   854
   855					IF THE RETURN IS TO CMD LEVEL, CODE RETURNED TO JRSTS OFF TO ERR??? FOR THE ERROR INVOL
   856				VED.
   857
   858					SGRELE RELEASES THE RUNCHN DEVICE.
   859
   860				EXPECTS: PG/BLOCK  M/ USER AC# BITS 4-12   J/JOB
   861				@
   862
   863	000544'			SGRELL:				;LOOKUP OR ENTER FAILURE
   864	000544'	200344	000004		MOVE T2,DEVMOD(F)	;IS THIS DEVICE A DISK?
   865	000545'	603340	200000		TLNE T2,DVDSK
   866	000546'	550303	000005		HRRZ T1,XPAEXT(PG)	;YES, RETURN DISK SERVICE ERROR CODE
   867	000547'	200340	000000*	SGRELE:	MOVE T2,%UPT+UPTPDL	;GET FIRST PC ON PD LIST
   868	000550'	607340	010000		TLNN T2,PC.USR		;IS IT IN USER MODE(IE USER M)?
   869	000551'	254000	000563'		JRST SGREL		;NO, MUST BE MONITOR COMMAND OR CALLER OVERLAYED
   870								; RELEASE DEVICE, FIND TTY, AND RETURN TO CALLER
   871	000552'	135540	002560'		LDB M,[POINT 4,M,12] 	;GET CALLING AC NUMBER
   872	000553'	256200	002561'		XCTBU <HLRZ T2,(T2)> 	;GET OPCODE OF RETURN INST
   873	000554'	306340	254200		CAIN T2,(HALT)		;RETURNING TO HALT?
   874	000555'	254000	000563'		JRST SGREL		;YES, RELEASE DEVICE,FIND TTY, AND RETURN TO CALLER
   875								;SAVE SPACE GIVEN BACK AT USRXIT
   876	000556'			SGRLE2:	
   877	000556'	256200	002562'		UMOVEM T1,(M)		;STORE ERROR NUMBER IN USER AC.
   878	000557'	332000	000000*		SKIPE %UPT+UPTJDA+RUNCHN;SKIP UNNECESSARY RELEASE
   879	000560'	071000	000000		RELEAS RUNCHN,		;RELEASE DEVICE(IF INITED)
   880	000561'	261040	000000*		PUSH P,%UPT+UPTPDL	;PUT RETURN ON END OF PDLIST
   881	000562'	254000	000000*		JRST USRXIT##		;AND RETURN TO USER TO HANDLE ERROR
   882
   883
   884				COMMENT @ SUBROUTINE SGREL
   885				FUNCTION: RELEASE THE FUNCHN DEVICE IF INITTED. IF MAGTAPE,
   886					SKIP TO EOF UNLESS END-OF-TAPE.
   887				CALL:	PUSHJ P,SGREL
   888					RETURN HERE F/ FLAGS,,RUNCHN DDB
   889				DESTROYS: F
   890				RESTRICTIONS:
   891				CALLS:
   892				CALLERS: SAVGET AND SEGCON STUFF
   893				@
   894
   895	000563'	336200	000000*	SGREL:	SKIPN F,%UPT+UPTJDA+RUNCHN	;SKIP IF STILL INITTED
   896	000564'	263040	000000		POPJ P,
   897	000565'	261040	000006		PUSH P,T1
   898	000566'	200304	000004		MOVE T1,DEVMOD(F)
   899	000567'	603300	000020		TLNE T1,DVMTA		;MAGTAPE?
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 15-2
SEGCON.MAC	28-OCT-87 00:02		UTILITY ROUTINES

   900	000570'	607200	010000		TLNN F,INPB	;YES, WAS AN INPUT DONE?
   901	000571'	254000	000575'		JRST SGREL1		;NO
   902	000572'	070000	000001		CLOSE RUNCHN,CLSOUT		;YES, CLOSE MTA INPUT
   903	000573'	061000	022000		STATO RUNCHN,IOTEND+IODEND	;AT END OF APTE?
   904	000574'	072000	000016		MTAPE RUNCHN,16		;NO SKIP TO EOF
   905	000575'	071000	000000	SGREL1:	RELEASE RUNCHN,		;NO RELEASE DEVICE
   906	000576'	262040	000006		POP P,T1
   907	000577'	263040	000000		POPJ P,		;RETURN
   908
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 16
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

   909				SUBTTL SAVJOB
   910				COMMENT @ MONITOR JOB SAVJOB - SAVE JOB AREA ON FILE/TAPE
   911				FUNCTION:
   912					FOR MAGTAPE:
   913				IF HISEG EXISTS SAVE IT UNCOMPRESSED ELSE WRITE A NULL HISEG;
   914				IF LOWSEG EXISTS SAVE IT ZERO-COMPRESSED ELSE
   915					WRITE A ZERO-COMPRESSED EMPTY LOWSEG;;
   916				PRINT "JOB SAVED";
   917	
   918					FOR DISK:
   919				IF HISEG EXISTS THEN BEGIN "HS"
   920					SAVE IT UNCOMPRESSED ON (FN.HGH IF NOSHR ELSE FN.SHR)
   921					DELETE OBSELETE .SHR OR .HGH
   922					IF USER GAVE EXT THEN DONE "HS"
   923					IF NO LOWSEG REQUIRED THEN DELETE OBSOLETE .LOW & GOTO SAVFIN
   924					EXT_'LOW'
   925					END "HS";
   926				SAVE COMPRESSED LOWSEG OF WHATEVER SIZE ON FN.<EXT OR 'SAV'>;
   927				SAVFIN: PRINT "JOB SAVED";
   928				PRINT "JOB SAVED";
   929
   930				ENTRY: MONITOR JOB RUN BY SCHEDULER. MUST SET UP OWN ACS
   931					ALSO CALLED BY FRMOP AT SAVFMU.
   932				EXIT: CORE UN-COMPRESSED
   933
   934				IDIOSYNCRACIES:
   935
   936				RESTRICTIONS: EXPECTS PREVIOUS CONTEXT = USER SPACE
   937
   938				DESTROYS:
   939
   940				@
   941
   942				INTERNAL SAVJOB,SAVFRM,SAVFMU
   943
   944	000600'			SAVFRM:
   945	000600'	265340	000370'	SAVJOB: JSP T2,SG1		;SETUP AC P,J,PG,RESET DEVICES
   946	000601'	261040	002544'		PUSH P,[0]		;A PLACE FOR SAVE OF EXT OF FILE CREATED
   947	000602'	260040	002211'	SAVFMU:	PUSHJ P,HSEXIS		;SKIP IF NO HISEG
   948	000603'	334340	000000*		SKIPA T2,%UPT+UPTHRL
   949	000604'	254000	000610'		JRST SAVJ2
   950	000605'	553000	000007		HRRZS T2
   951	000606'	275340	377777		SUBI T2,377777		;SIZE CURRENT HISEG
   952	000607'	260040	002151'		PUSHJ P,ADJCOR		;REDUCE XPANEW (IF GIVEN ) BY SIZE CURR HISEG
   953	000610'	564343	000051	SAVJ2:	HLRO T2,XPACOM(PG)	;SET BY SG3 VIA SG1 CALL
   954						;TO [JOBSVM-(C(JOBFF)-1)] OR [JOBSVM-C(UPTREL)]
   955	000611'	260040	000467'		PUSHJ P,CKIOWD	;VALIDATE XPANEW,RETURN T1/MAX(REAL SIZE,XPANEW)
   956	000612'	256200	002557'		XCTBU <HRRM T1,JOBCOR>	;WHEN FILE GOTTEN THIS WILL BE USED
   957	000613'	260040	000212'		PUSHJ P,SETACS
   958	000614'	050000	000006		OPEN RUNCHN,T1
   959	000615'	254000	000510'		 JRST SGERRA
   960	000616'	200200	000000*		MOVE F,%UPT+UPTJDA+RUNCHN
   961				;IF NO HISEG THEN BEGIN IF DVMTA THEN SAVNUL END
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 16-2
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

   962	000617'	260040	002211'		PUSHJ P,HSEXIS
   963	000620'	254000	000625'		JRST SAVJ3
   964	000621'	200444	000004		MOVE T4,DEVMOD(F)
   965	000622'	603440	000020		TLNE T4,DVMTA
   966	000623'	260040	001037'		PUSHJ P,SAVNUL	;DESTROYS MANY ACS
   967	000624'	254000	000730'		JRST SAVJB5
   968				;ELSE BEGIN /*HISEG EXISTS*/
   969	000625'	260040	000212'	SAVJ3:	PUSHJ P,SETACS		;GETS T1, P1-P4 AGAIN
   970	000626'	205640	635062		MOVSI P2,'SHR'
   971	000627'	603300	000001		TLNE T1,NOSHR		;FROM SGSET. OFF IF SSAVE CMD
   972	000630'	205640	504750		MOVSI P2,'HGH'
   973	000631'	077000	000014		ENTER RUNCHN,P1
   974	000632'	254000	001024'		JRST SAVERR
   975	000633'	502641	000000		HLLM P2,0(P)	;REMEMBER THE EXT WE CREATED
   976	000634'	550340	000000*		HRRZ T2,%UPT+UPTHRL	;NON-ZERO SINCE WE KNOW HS EXISTS
   977	000635'	275340	377777		SUBI T2,377777	;T2/ 1ST FREE IN HS,RELATIVE TO 400000
   978	000636'	256200	002563'		XCTFU <HLLZ T1,JOBHRL> ;FIRST FREE IN HISEG,SET BY LOADER
   979	000637'	603300	777777		TLNE T1,-1	;HAS LOADER SET IT OR WAS THIS SEG CREATED
   980	000640'	256200	002564'		XCTFU <SKIPE JOBDDT>;BY REMAP? IS USER USING DDT?
   981	000641'	256200	002565'		XCTBU <HRLM T2,JOBHRL> ;SET 1ST FREE TO 1 PAST END
   982				;IF HISEG NOT LOADED FROM .SWR FILE AND USER HAS WRITE (OR COW) PRIV
   983				; ON HISEG (TEST PG 400 ONLY),INIT'ZE VESTIGIAL JOBDATA AREA.
   984
   985	000642'	200300	000000*		MOVE T1,%UPT+UPTSTS
   986	000643'	603300	000000*		TLNE T1,SG.SWR
   987	000644'	254000	000672'		JRST SAVJB4
   988	000645'	200300	002566'		MOVE T1,[<CPRRDW>B7+1B17+400]
   989	000646'	047300	777710		VPROT T1,
   990	000647'	334000	000000		SKIPA		;SIGH. SEE IF WE CAN MAKE IT COW FOR HIM
   991	000650'	254000	000654'		JRST SAVJB3	;RDW SUCCEEDED. INIT'ZE.
   992	000651'	200300	002567'		MOVE T1,[<CPRCOW>B7+1B17+400]
   993	000652'	047300	777710		VPROT T1,
   994	000653'	254000	000672'		 JRST SAVJB4	;CANNOT DO EITHER, PROCEED W/O COMPLAINT
   995	000654'	200300	002570'	SAVJB3:	MOVE T1,[XWD -100,377777]	;FAKE PDL POINTER
   996	000655'	256240	002571'		XCTBU <PUSH T1,JOBSA>	;0 SAVE JOB STARTING ADDRESS (RH)
   997								;   AND INITIAL FIRST FREE LOC (LH)
   998	000656'	256240	002572'		XCTBU <PUSH T1,JOB41>	;1 SAVE USER LOC 41(USER M HANDLER JSR)
   999	000657'	256240	002573'		XCTBU <PUSH T1,JOBCOR>	;2 SAVE USER TYPED THIRD (CORE) ARG (RH) AND
  1000								;   HIGHEST DATA LOC LOADED IN LOW SEG (LH)
  1001	000660'	256200	002574'		XCTBU <HRR T2,JOBREN>	;  SAVE REENTER COMMAND STARTING ADDRESS
  1002	000661'	256200	002575'		XCTFU <HLL T2,JOBHRL>	;   & 1ST FREE LOC (REL TO 400000) SET BY LOADER
  1003	000662'	256040	002576'		XCTTU <PUSH T1,T2>	;3
  1004	000663'	256240	002577'		XCTBU <PUSH T1,JOBVER>	;4 SAVE BOTH HALVES OF PROGRAM VERSION NUMBER
  1005								;   LH IS USED FOR PROGRAMMER NUMBER LAST MODIFYING
  1006	000664'	256040	002600'		XCTTU <PUSH T1,P1>	;5 HISEG NAME
  1007	000665'	253300	000666'		AOBJN T1,.+1		;6 LEAVE JOBHSM ALONE FOR DDT
  1008				PRINTF(<[SAVJB3+10: Page 400 (locations 400000 and 377777) hardcoded in SAVE]>)
  1009	000666'	256040	002603'		XCTTU <PUSH T1,[BYTE(9)0,400,(18)0]>;7 STARTING AT PAGE 400
  1010	000667'	200300	002604'		MOVE T1,[<CPRRED>B7+1B17+400]
  1011	000670'	047300	777710		VPROT T1,
  1012	000671'	256000	000000'		 STOPCD		;SHOULD NEVER HAPPEN    ;;SAVJB3+15
  1013				 ;OUTPUT THE ENTIRE HISEG UNCOMPRESSED
  1014	000672'	256200	002563'	SAVJB4:	XCTFU <HLLZ T1,JOBHRL> ; 1ST FREE = LENGTH+1
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 16-3
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

  1015	000673'	336000	000006		SKIPN T1		;NEVER ALLOW 0 WORDCOUNT
  1016					JRST [HRLZ T1,%UPT+UPTHRL	;IN CASE LH JOBHRL NOT
  1017						SUB T1,[377777,,0]		;SET UP
  1018	000674'	254000	002606'			JRST .+1]
  1019	000675'	213000	000006		MOVNS T1	;-SIZE,,0
  1020	000676'	541300	377777		HRRI T1,377777	;T1/IOWD SIZE,400000
  1021	000677'	201340	000000		MOVEI T2,0	;T1,T2 IOLIST
  1022	000700'	067000	000006		OUTPUT RUNCHN,T1
  1023	000701'	260040	000433'		PUSHJ P,SGIOCK	;RET ONLY IF ALL OK
  1024	000702'	070000	000000		CLOSE RUNCHN,
  1025				;DELETE .SHR IF .HGH WRITTEN AND VICE VERSA
  1026	000703'	260040	000212'		PUSHJ P,SETACS
  1027	000704'	510641	000000		HLLZ P2,0(P)	;THE EXT WE CREATED
  1028	000705'	316640	002611'		CAMN P2,[SIXBIT/SHR/]
  1029	000706'	334640	002612'		SKIPA P2,[SIXBIT/HGH/]
  1030	000707'	205640	635062		MOVSI P2,(SIXBIT/SHR/)
  1031	000710'	260040	001032'		PUSHJ P,DELET
  1032				COMMENT @
  1033				IF (USER GAVE NO EXTENSION) THEN
  1034					BEGIN
  1035					EXT_'LOW';
  1036					IF LH(JOBCOR)<JOBDA THEN
  1037					 BEGIN
  1038					 DELETE FN.LOW
  1039					 IF DVMTA THEN OPEN CHANNEL & SAVNUL;
  1040					 GOTO SAVFIN;
  1041					 END;
  1042					END;
  1043				@
  1044
  1045	000711'	260040	000212'		PUSHJ P,SETACS
  1046	000712'	326640	000730'		JUMPN P2,SAVJB5
  1047	000713'	205640	545767		MOVSI P2,'LOW'
  1048	000714'	202643	000045		MOVEM P2,XPAUXT(PG)
  1049	000715'	256200	002613'		XCTBU <HLRZ T4,JOBCOR>
  1050	000716'	301440	000000*		CAIL T4,JOBDA
  1051	000717'	254000	000730'		JRST SAVJB5
  1052	000720'	260040	001032'		PUSHJ P,DELET	;ZAP FN.LOW
  1053	000721'	200444	000004		MOVE T4,DEVMOD(F)
  1054	000722'	607440	000020		TLNN T4,DVMTA
  1055	000723'	254000	001012'		JRST SAVFIN
  1056	000724'	050000	000006		OPEN RUNCHN,T1
  1057	000725'	254000	000510'		 JRST SGERRA
  1058	000726'	260040	001037'		PUSHJ P,SAVNUL
  1059	000727'	254000	001012'		JRST SAVFIN
  1060				;END /*HISEG EXISTS */
  1061				;HERE WHEN THERE IS NO HS TO SAVE, OR THERE IS A .LOW OR .EXT TO
  1062				;SAVE ALONG WITH THE .HGH/.SHR. F STILL SETUP
  1063
  1064	000730'	260040	000212'	SAVJB5:	PUSHJ P,SETACS	;WILL PICK UP .LOW IF HISEG NEEDED LOW
  1065	000731'	050000	000006		OPEN RUNCHN,T1	;
  1066	000732'	254000	000510'		 JRST SGERRA
  1067	000733'	336000	000015		SKIPN P2
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 16-4
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

  1068	000734'	205640	000000*		MOVSI P2,SAVDMP##;NONE OFFERED, USE .SAV
  1069	000735'	077000	000014		ENTER RUNCHN,P1
  1070	000736'	254000	001024'		 JRST SAVERR
  1071				;REMEMBER TO POP EXT OUT OF STACK SAVERR OR SAVFIN
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 17
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

  1072				;FALL THRU FROM ABOVE TO COMPRESS CORE FOR SAVJOB, THEN WRITE
  1073	000737'	256200	002614'		UMOVE T1,JOB41   	;SAVE USER M HANDLING JSR
  1074	000740'	256200	002615'		UMOVEM T1,JOBS41	;IN UPPER PART OF JOB DATA AREA
  1075	000741'	256200	002616'		XCTBU <SETZM JOBEXM>
  1076	000742'	256200	002617'		XCTBU <SETZM JOBFDV>
  1077	000743'	256200	002620'		UMOVE T1,JOBDDT	;SAVE DDT STARTING ADDRESS HIGHER UP IN JOB DATA AREA
  1078	000744'	256200	002621'		UMOVEM T1,JOBSDD	;SO COMPRESS ALWAYS MOVES CODE DOWN
  1079	000745'	256200	002622'		XCTBU <HRRZ	T3,JOBSA>	;SAV START ADDRESS FOR 10DMP
  1080	000746'	201300	000000*		MOVEI	T1,JOBSV ;POINT TO 1ST DATA WORD
  1081	000747'	201340	000000*		MOVEI	T2,JOBSDD ;IT STARTS AT JOBSDD
  1082	000750'	564103	000051		HLRO J,XPACOM(PG)	;IOWD FOR THIS SIZE CORE(-LENGTH TO WRITE)
  1083	000751'	213000	000002		MOVNS J		;POSITIVE LENGTH
  1084	000752'	271100	000467*		ADDI J,JOBSVM	;ADD IN FIRST LOC-1 TO WRITE=HIGHEST LOC TO WRITE
  1085								; TO MAKE END TEST
  1086	000753'	202300	000005	CMPLP1:	MOVEM	T1,U		;SAVE 1ST LOC FOR IOWD
  1087	000754'	313340	000002	CMPLPA:	CAMLE	T2,J	 ;SEARCH FOR 1ST NON-0 WORD
  1088	000755'	344300	000772'		 AOJA	T1,CMPTHR	  ;THROUGH
  1089	000756'	256200	002623'	 XCTBU <SKIPN	(T2)>		 ;THIS A DATA WORD?
  1090	000757'	344340	000754'		 AOJA	T2,CMPLPA	;NO. KEEP LOOKING
  1091	000760'	211600	000001		MOVNI	P1,1		;YES. P1 WILL BE AN IOWD
  1092	000761'	505607	777777		HRLI	P1,-1(T2)	;1ST LOCATION - 1
  1093	000762'			CMPLP2:
  1094	000762'	256240	002624'	 XCTBU <PUSH	T1,(T2)>	;SAVE A DATA WORD
  1095	000763'	350000	000007		AOS	T2
  1096	000764'	317340	000002		CAMG	T2,J	;AT TOP?
  1097	000765'	256200	002623'	 XCTBU <SKIPN	(T2)>		;NO. NEXT WORD NON-0?
  1098	000766'	254000	000770'		 JRST	.+2		;NO. THROUGH THIS BLOCK
  1099	000767'	364600	000762'		SOJA	P1,CMPLP2	;COUNT THE WORD AND CHECK NEXT
  1100	000770'	256200	002625'	 XCTBU <MOVSM	P1,(U)>		;SAVE IOWD IN FRONT OF BLOCK
  1101	000771'	344300	000753'		AOJA	T1,CMPLP1	;LOOK FOR NEXT NON-0 BLOCK
  1102
  1103	000772'	505400	254000	CMPTHR:	HRLI	T3,254000	;SET A JRST C(JOBSA)
  1104	000773'	256200	002626'		UMOVEM	T3,-1(T1)	;AT END OF FILE
  1105	000774'	275300	000746*		SUBI	T1,JOBSV	;COMPUTE WORD COUNT
  1106	000775'	210340	000006		MOVN	T2,T1		;MAKE AN IOWD
  1107	000776'	504343	000051		HRL	T2,XPACOM(PG)	;START ADDRESS
  1108	000777'	207000	000007		MOVSS T2
  1109	001000'	205300	000427*		MOVSI	T1,XPNCOR	;FLAG THAT CORE NEEDS EXPANDING
  1110	001001'	436300	000000*		ORM	T1,%UPT+UPTSTS
  1111								; CORE ON START ,DDT,SAVE, REENTER,SSAVE IN CASE
  1112								; THIS SAVE IO DOES NOT GO TO COMPLETION. (CONTROL C
  1113								; OR DEVICE FULL, SO THAT CORE DOES NOT GET EXPANDED
  1114	001002'	200300	000007	SVLSUU:	MOVE 	T1,T2
  1115	001003'	403340	000010		SETZB	T2,T3
  1116	001004'	321300	001010'		JUMPL	T1,SVLSU1	;check for overflow; (+)
  1117	001005'	200340	000006		MOVE	T2,T1		;too big - break it in half
  1118	001006'	505300	400000		HRLI	T1,-400000
  1119	001007'	270340	002627'		ADD	T2,[400000,,400000]
  1120	001010'	260040	000424'	SVLSU1:	PUSHJ 	P,SGDO		;WILL EXECUTE THE FOLLOWING UUO:
  1121	001011'	067000	000006		OUTPUT 	RUNCHN,T1	;CK ERRORS,EXPAND
  1122								; RETURN HERE ONLY IF NO ERRORS
  1123								;FIX J? DOES IT MATTER?
  1124
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 17-2
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

  1125	001012'			SAVFIN:
  1126	001012'	262040	000006		POP 	P,T1		;FIX STACK,GET EXT SAVED
  1127	001013'	260040	000563'		PUSHJ 	P,SGREL		;RELEASE RUNCHN
  1128	001014'	200340	000000*		MOVE	T2,%UPT+UPTPDL	;GET ULTIMATE RETURN ADDRESS
  1129	001015'	607340	010000		TLNN 	T2,PC.USR	;IS IT IN USER MODE (IE. A UUO)?
  1130	001016'	254000	001021'		 JRST	SAVFN1		; NO - MUST BE COMMAND
  1131	001017'	350000	000007		AOS	T2		;SKIP RETURN FROM UUO
  1132	001020'	254000	000562*		JRST	USRXIT##	;GO HOME
  1133	001021'	200703	000004	SAVFN1: MOVE 	P3,XPANAM(PG)	;GET NAME OF THING WE SAVED.
  1134	001022'	400740	000000		SETZ 	P4,		;NO EXTENSION TO BE TYPED.
  1135	001023'	324740	000000*		PJRST 	ERRJSV		;JOB SAVED EXIT CONDITION.
  1136
  1137	001024'			SAVERR:
  1138	001024'	262040	000006		POP P,T1		;FIX STACK,GET SAVED EXT
  1139	001025'	201300	000002		MOVEI T1,PRTERR		;PROT ERR IN CASE RET TO USER
  1140				;*;	HRRZS %UPT+UPTPDL	;DON'T RET TO USER, PC.USR_0;REMOVED FOR SAVE FRMOP
  1141	001026'	260040	000547'		PUSHJ P,SGRELE		;RELEASE RUNCHN & RETURN HERE
  1142	001027'	200700	000014		MOVE P3,P1		;GET FAILING FILE NAME IN P3
  1143	001030'	510740	000015		HLLZ P4,P2		;AND FAILING EXT IN P4
  1144	001031'	324740	000000*		PJRST ERREUF		;PRINT ATTEMPTED ENTER UUO FAILED.
  1145
  1146				COMMENT @ SUBROUTINE DELET
  1147				FUNCTION: FOR SAVJOB, TO DELETE OBSOLETE FILES WHEN
  1148					A NEW ONE HAS BEEN SAVED.
  1149				CALL:	GET P1-P4 SETUP FOR LOOKUP OF FILE TO DELETE
  1150					PUSHJ P,DELET
  1151					RETURN HERE ALWAYS
  1152				DESTROYS:	P2,P3,P4.  P2 LEFT-HALF = EXT IS PRESERVED
  1153				@
  1154
  1155	001032'	076000	000014	DELET:	LOOKUP RUNCHN,P1
  1156	001033'	263040	000000		POPJ P,
  1157	001034'	055000	002544'		RENAME RUNCHN,[0]
  1158	001035'	255000	000000		JFCL
  1159	001036'	263040	000000		POPJ P,
  1160
  1161				COMMENT @ SUBROUTINE SAVNUL
  1162				FUNCTION: WRITE A NULL SEGMENT TO MAGTAPE
  1163					THIS ROUTINE WRITES A LITTLE RECORD WHICH GETS READ
  1164					ON MAGTAPE GET AS A VESTIGIAL JOB DATA AREA.  ITS
  1165					JOBHRN LOC HAS ZERO WHICH MEANS THAT THERE REALLY
  1166					IS NO HISEG.  ITS JOBHCR LOC HAS DATA USED TO SET
  1167					XPANEW ON THE GET SO THAT THE LOWSEG GETTER READLS
  1168					HAS SOME IDEA HOW MUCH CORE TO GRAB FOR THE INPUT
  1169					OPERATION TO WRITE ON.  AFTER READHS USES THE JOBHCR
  1170					DATA THIS NULL HISEG IS DESTROYED.
  1171				CALL:	OPEN RUNCHN,
  1172					PUSHJ P,SAVNUL
  1173					RETURN HERE IF ALL IO OK ELSE FRETURN THRU SGIOCK
  1174				DESTROYS: LOTS OF ACS:  T1,T2,T3..
  1175				RESTRICTIONS: USE ONLY WHEN NO REAL HISEG EXISTS
  1176				IDIOSYNCRACIES: SINCE THIS ROUTINE MAY BE CALLED UPON TO
  1177				 WRITE A NULL-HISEG RECORD WHEN THERE IS A CORE IMAGE
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 17-3
SEGCON.MAC	28-OCT-87 00:02		SAVJOB

  1178				 OF 777 PGS IN THE LOWSEG, IT CANNOT COMPOSE THE RECORD
  1179				 TO BE WRITTEN TO TAPE IN ITS STANDARD VESTIGIAL JOBDAT
  1180				 LOCATION AT 400000.  SO IT IS COMPOSED AT LOC
  1181				 JOBNSV IN THE LOSEG JOBDAT.  ANY DATA THERE IS OVERWRITTEN;
  1182				 NORMALLY THERE WOULD BE NONE, SINCE JOBNSV LIES WITHIN
  1183				 THE JOBJDA ARRAY WHICH WOULD AT THIS TIME BE EMPTY SINCE
  1184				 ALL CHANNELS ARE CLOSED.
  1185
  1186				SEE ROUTINES READHS AND READLS AND GETMTJ FOR MORE
  1187				UNDERSTANDING OF MAGTAPE GET/RUN.
  1188				@
  1189
  1190	001037'			SAVNUL:	
  1191	001037'	201300	000000*		MOVEI	T1,JOBNSV
  1192	001040'	256200	002630'		XCTBU	SETZM JOBHRN(T1) ;THIS SAYS NO HISEG REALLY EXISTS
  1193	001041'	256200	002631'		UMOVE	T2,JOBCOR
  1194	001042'	256200	002632'		UMOVEM	T2,JOBHCR(T1)	;THIS SAYS SIZE OF LOSEG, IF ANY
  1195								;CORE ARG GIVEN TO SAVE CMD
  1196	001043'	211300	000001*		MOVNI	T1,JOBHRN+1	;-(SIZE OF RECORD)
  1197	001044'	505300	777777*		HRLI	T1,JOBNSV-1	;LOC WHERE RECORD COMPOSED
  1198	001045'	206300	000007		MOVSM	T1,T2		;T2/ OUTPUT IOWD
  1199	001046'	201400	000000		MOVEI	T3,0		;END OF IOLIST
  1200	001047'	067000	000007		OUTPUT	RUNCHN,T2	;WRITE THE NULL SEGMENT
  1201	001050'	260040	000433'		PUSHJ	P,SGIOCK	;CHECK FOR ERRORS (RETURN IF OK)
  1202	001051'	070000	000000		CLOSE	RUNCHN,		;WRITE EOF
  1203	001052'	263040	000000		POPJ	P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 18
SEGCON.MAC	28-OCT-87 00:02		EXPAND

  1204				SUBTTL EXPAND
  1205				COMMENT @ ROUTINE EXPAND
  1206				FUNCTION: EXPAND A CONTRACTED LOW SEGMENT IF (JOBSV)<0
  1207					  SET JOBHRL TO HISEG END IF HISEG EXISTS. USED BY
  1208					  SAVJOB VIA SGDO AFTER COMPRESSING CORE FOR SAVE.
  1209					  USED BY RUNJOB/GETJOB VIA SGDO.
  1210				CALL:	MOVE J,JOB NUMBER
  1211					PUSHJ P,EXPAND
  1212					RETURN HERE SUCCESS
  1213				FAILURE EXITS: GETERR OR NOROOM..NO RET TO EXPAND CALLER
  1214				CALLS:	GETCOR, GETERR, HSSIZE
  1215				RESTRICTIONS:
  1216				DESTROYS: P1,P2,T1,T2
  1217
  1218				@
  1219	001053'			EXPAND:	
  1220	001053'	256200	002633'		XCTBU <SKIPL	T1,JOBSV> ;IF FIRST LOC IS POSITIVE
  1221	001054'	254000	001132'		JRST	SGDOER		;OLD FORMAT, SO DONT EXPAND
  1222				;COME HERE TO DO THE ACTUAL EXPANSION OF A FILE
  1223	001055'	201300	000774*	EXPND1:	MOVEI T1,JOBSV ;IT WAS READ INTO JOBSV
  1224	001056'	256200	002634'		UMOVE	T2,(T1)	;FIRST IOWD
  1225	001057'			EXPLP1:	
  1226	001057'	564600	000007		HLRO	P1,T2	;YES. GET WORDCOUNT
  1227	001060'	213000	000014		MOVNS	P1		;+N
  1228	001061'	506600	000007		HRLM	P1,T2	;CONVERT IOWD TO +N IN LH
  1229	001062'	271314	000001		ADDI	T1,1(P1)	 ;ADDRESS OF NEXT IOWD
  1230	001063'	271354	000000		ADDI	T2,(P1)	;YES. CHANGE RH OF IOWD
  1231	001064'	256200	002635'		XCTBU <EXCH	T2,(T1)>	;MAKE IT XWD +N,A+N-1 AFTER DATA BLOCK
  1232	001065'	321340	001057'		JUMPL	T2,EXPLP1	;CONTINUE IF NEXT THING IS AN IOWD
  1233	001066'	554600	000007		HLRZ P1,T2
  1234	001067'	302600	254000		CAIE P1,(JRST)
  1235	001070'	306600	254200		CAIN P1,(HALT)
  1236	001071'	334000	000000		SKIPA
  1237	001072'	254000	001057'		JRST EXPLP1		;ASSUME JUST LARGE COUNT
  1238	001073'	261040	000006		PUSH	P,T1		;SAVE DATA LOCATION
  1239	001074'	256200	002636'		XCTBU <HRRZ	T1,(T1)>	  ;TOP REAL LOCATION NEEDED
  1240
  1241	001075'	660300	001777		TRO	T1,1777	;MAKE IT NK-1
  1242	001076'	260040	000521'		PUSHJ	P,GETCOR	;NO. GET IT
  1243	001077'	262040	000007	EXPCOR:	POP	P,T2
  1244	001100'	550300	000000*		HRRZ T1,%UPT+UPTREL	;TOP CORE ADDR
  1245								;(OK TO USE UPTREL INSTEAD - USER CAN'T BE RUNNING)
  1246	001101'	551607	000000		HRRZI P1,(T2)		;TOP DATA LOC
  1247	001102'	505614	000001		HRLI	P1,1(P1)	;SET TO ZERO TO TOP OF CORE
  1248	001103'	541614	000002		HRRI	P1,2(P1)
  1249	001104'	301314	000001		CAIL T1,1(P1)		;ATLEAST 1 WORD TO TOP OF CORE?
  1250	001105'	256200	002637'		XCTBU <SETZM	-1(P1)>		;YES CLEAR FIRST ONE
  1251	001106'	303314	000001		CAILE T1,1(P1)		;MORE THAN ONE WORD TO TOP OF CORE?
  1252	001107'	256240	002640'		XCTBU <BLT	P1,(T1)>	;YES. CLEAR TO TOP OF CORE
  1253	001110'	561307	000000		HRROI	T1,(T2)	;FROM DATA POINTER
  1254	001111'	256200	002641'	EXPLP2:	XCTBU <HRRZ	P1,(T1)>	;TO DATA POINTER
  1255	001112'	305606	000000		CAIGE P1,(T1)		;MAKE SURE WE DO NOT GO BACKWARDS
  1256	001113'	254000	000531'		JRST GETERR		;CAN HAPPEN TOO MANY IOWDS W/O 0'S
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 18-2
SEGCON.MAC	28-OCT-87 00:02		EXPAND

  1257	001114'	256200	002642'		XCTBU <HLRZ	P2,(T1)>	;WORD COUNT
  1258	001115'	275355	000001		SUBI	T2,1(P2)	;POINT T2 TO PREVIOUS IOWD
  1259	001116'	256200	002643'		XCTBU <SETZM	(T1)>		;ZERO THIS IOWD
  1260	001117'	374000	000006		SOSA	T1		;POINT TO DATA
  1261	001120'	370000	000014	EXPLP3:	SOS	P1
  1262	001121'	305600	000747*		CAIGE P1,JOBSDD	;DON'T STORE DATA BELOW JOBSDD
  1263	001122'	374000	000006		SOSA T1
  1264	001123'	256240	002644'		XCTBU <POP	T1,(P1)>	;MOVE A DATA WORD
  1265	001124'	256200	002645'		XCTBU <SETZM	1(T1)>		;ZERO WHERE IT CAME FROM
  1266	001125'	367640	001120'		SOJG	P2,EXPLP3		;LOOP IF MORE DATA
  1267	001126'	303340	001055*		CAILE	T2,JOBSV 		;THROUGH?
  1268	001127'	254000	001111'		JRST	EXPLP2		;NO. DO NEXT BLOCK
  1269	001130'	256200	002646'		XCTBU <EXCH	P2,JOBSDD> ;YES. ZERO JOBSDD
  1270	001131'	256200	002647'		UMOVEM P2,JOBDDT	;SET USER DDT STR ADR
  1271	001132'	205300	001000*	SGDOER:	MOVSI T1,XPNCOR		;EXPANDED
  1272	001133'	412300	000000*		ANDCAM T1,%UPT+UPTSTS	;CLEAR FLAG      (WAS ANDCM ..AA)
  1273	001134'	260040	002211'		PUSHJ P,HSEXIS
  1274	001135'	334340	000000*		SKIPA T2,%UPT+UPTHRL
  1275	001136'	263040	000000		POPJ P,
  1276	001137'	256200	002650'		XCTBU <HRRM T2,JOBHRL> ;MAY NOT HAVE BEEN ABLE TO WHILE
  1277						;COMPRESSED..JOBHRL GETS MOVED
  1278	001140'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 19
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1279				SUBTTL GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO
  1280				COMMENT @ GETJOB MONITOR JOB FOR ".GET" COMMAND
  1281				ENTRY: RUN BY SCHEDULER AFTER SETUP BY SGSET. NO ACS SETUP.
  1282					ALSO BY FRMOP AT GETFMU.
  1283				@
  1284				INTERNAL GETJOB,GETFRM,GETFMU
  1285
  1286	001141'			GETFRM:
  1287	001141'	265340	000370'	GETJOB:	JSP T2,SG1		;SETUP PDL WITH TYPED ARGS,(PG)..
  1288	001142'	200100	000000*		MOVE J,JOB
  1289	001143'	507302	000000*	GETFMU:	HRLS T1,JBTLIC(J)
  1290	001144'	506302	000000*		HRLM T1,JBTSLC(J)
  1291	001145'	260040	001242'		PUSHJ P,MGETJB		;GET THE JOB, RTN ONLY IF ALL OK
  1292	001146'	200703	000004		MOVE P3,XPANAM(PG)	;GET NAME OF THING WE GOT
  1293	001147'	400740	000000		SETZ P4,		;NO EXTENSION
  1294	001150'	324740	000000*		PJRST ERRJSU		;JOB SETUP EXIT CONDITION
  1295
  1296				COMMENT @ RUNJOB, RUNJB2 (FOR MONITOR RUN ENTRY+1 ON LOGOUT)
  1297				FUNCTION: DO THE ".RUN" COMMAND. RUNJB2 ENTRY FOR SETTING
  1298					UP START ADDRESS = ENTRY+1.  USE MOST OF THE CODE
  1299					FOR RUNUUO.
  1300				ENTRY: FROM SCHEDULER AFTER SETUP BY SGSET.
  1301					ALSO BY FRMOP AT RUNFM1.  NOTE FRMOP'S MONJOB LEAVES
  1302					START INCRIMENT IN S, SO IT RUN US AT RUNFRM.
  1303				@
  1304				INTERNAL RUNJOB,RUNJB2,RUNFRM,RUNFMU
  1305
  1306	001151'	265340	000370'	RUNJOB:	JSP T2,SG1		;SETUP ACS
  1307	001152'	261040	002544'		PUSH P,[0]		;START INCR=0
  1308	001153'	200100	001142*	RUNFMU:	MOVE J,JOB
  1309	001154'	507302	001143*		HRLS T1,JBTLIC(J)
  1310	001155'	506302	001144*		HRLM T1,JBTSLC(J)
  1311	001156'	260040	001242'		PUSHJ P,MGETJB		;GET THE JOB,
  1312	001157'	254000	001216'		JRST RNSEG		;FINISH UP AS IF RUNUUO
  1313
  1314	001160'	265340	000370'	RUNJB2:	JSP T2,SG1		;SETUP ACS
  1315	001161'	261040	002651'		PUSH P,[1,,0]		;START INCR=1
  1316	001162'	254000	001153'		JRST RUNFMU
  1317
  1318	001163'	265340	000370'	RUNFRM:	JSP T2,SG1		;SETUP ACS
  1319	001164'	261040	000000		PUSH P,S		;SAVE START INCR
  1320	001165'	254000	001153'		JRST RUNFMU
  1321
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 20
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1322				Comment !	LOGOFF uuo
  1323
  1324					MOVS ac,[start-address-increment]
  1325					LOGOFF ac,		; if JBTSTS[KJP]=0 then run SYS:LOGOUT
  1326								; else run the ALP program (if any)
  1327					  <error return>	; return here if can't run program,
  1328								; if this instr is a HALT, print msg
  1329								; on user's tty
  1330					<no-ALP-set return>	; return here if there is no ALP in
  1331								; effect and JBTSTS[KJP]=1
  1332
  1333					JBTSTS[KJP] is set by LOGOUT program before doing LOGOFF uuo.
  1334					This way, a LOGOUT uuo may be used by any program to start the
  1335					logout sequence.  It is used by LOGOUT, however, to run the
  1336					ALP if one exists.
  1337				!
  1338				EXTERN	UPTALD,UPTALP,UPTALN,SYSPPN,LGONAM
  1339
  1340	001166'			LOGOFF::
  1341	001166'	200240	000000*		MOVE	U,%UPT+UPTALD	; device name
  1342	001167'	200440	000000*		MOVE	T4,%UPT+UPTALP	; PPN
  1343	001170'	200640	000000*		MOVE	P2,%UPT+UPTALN	; program name
  1344
  1345	001171'	200402	000000*		MOVE	T3,JBTSTS(J)
  1346	001172'	602400	000100		TRNE	T3,KJP		; test for JBTSTS[KJP]
  1347	001173'	254000	001200'		  JRST	RUNAL1
  1348
  1349	001174'	661500	400000		TLO	W,PHONLY	; force physical only for this
  1350	001175'	205240	637163		MOVSI	U,(SIXBIT "SYS"); get real logout device
  1351	001176'	400440	000000		SETZ	T4,		; no ppn
  1352	001177'	200640	000000*		MOVE	P2,LGONAM	; get real logout name
  1353
  1354	001200'	322640	000466*	RUNAL1:	JUMPE	P2,CPOPJ1	; uuo is no-op if no prog to run
  1355	001201'	200340	000006		MOVE	T2,T1		; start address increment
  1356	001202'	621340	777776		TLZ	T2,-2		; only let start at ST and ST+1
  1357	001203'	403600	000010		SETZB	P1,T3		; no ext, no lic, no core
  1358	001204'	260040	000075'		PUSHJ	P,GETARG	; put args on stack
  1359	001205'	202642	000264*		MOVEM	P2,JBTNAM(J)	; show new name
  1360	001206'	260040	001243'		PUSHJ	P,GETJB		; get both segments (if any)
  1361	001207'	324740	001216'		PJRST	RNSEG		; do rest as if run uuo
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 21
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1362				COMMENT @ RUN UUO
  1363				;CALL:	MOVE AC,[XWD N,D]
  1364				;	CALL AC,[SIXBIT /RUN/]
  1365				;	ERROR RETURN		;UNLESS LH=HALT(PRINT CONSOLE MESS. IF YES)
  1366				;	IK OK, TRANSFER TO C(JOBSA)+N FOR NEW PROGRAM
  1367
  1368				;WHERE:	D/	DEVICE NAME
  1369				;	D+1/	FILE NAME
  1370				;	D+2/	FILE EXT OR 0 (LH SIXBIT)
  1371				;	D+3/	IGNORED
  1372				;	D+4/	PPN OR 0 (CURR UFD) OR 0,,ADDRESS OF SIXBIT/12-CHAR USERNAME/
  1373				;	D+5/	XWD LICENSE TO PASS,,NEW CORE ASSIGNMENT
  1374				@
  1375
  1376					INTERN URUN,RNSEG,GTJBFN
  1377
  1378	001210'	260040	000000*	URUN:	PUSHJ P,RESET##		;RELEASE DEVICES
  1379								; WARNING! THIS GOES VERY DEEP IN PDL
  1380	001211'	256200	002652'		UMOVE T1,(M)		;RESTORE CONTENTS OF USER'S CALLING AC
  1381	001212'	260040	000060'		PUSHJ P,GTUARG	;SETUP USUAL ARG BLOCK IN PDL
  1382							;START ADDR INCR AT LH 0(P).
  1383							;AC "M" PRESERVED IN CASE SGRELE NEEDS IT.
  1384	001213'	202642	001205*		MOVEM P2,JBTNAM(J)
  1385	001214'	350000	000003'		AOS URUNCT		;KEEP TRACK OF RUN UUO'S DONE
  1386	001215'	260040	001243'		PUSHJ P,GETJB		;GET BOTH LOW AND HIGH SEGMENTS
  1387
  1388
  1389				; RNSEG  .. FALL THRU OR COME HERE FROM RUNSEGUUO OR RUNJOB (RUN CMD)
  1390	001216'	200100	001153*	RNSEG:	MOVE J,JOB
  1391	001217'	201340	400000		MOVEI T2,PVEXO
  1392	001220'	616342	000000*		TDNN T2,JBTPRV(J)	;CHECK IF RUN ONLY
  1393	001221'	254000	001224'		JRST URUN1B		;NO
  1394	001222'	525340	000001		HRLOI T2,1
  1395	001223'	406341	000000		ANDM T2,(P)		;YES, RESET START INC TO 0 OR 1
  1396	001224'	554341	000000	URUN1B:	HLRZ T2,(P)
  1397	001225'	307340	000001		CAIG T2,1
  1398	001226'	254000	001231'		JRST URUN2		;ALL OK
  1399	001227'	507342	001154*		HRLS T2,JBTLIC(J)	;NOT 1 OR 0, RESET LICENSE
  1400	001230'	506342	001155*		HRLM T2,JBTSLC(J)
  1401	001231'	205340	000001	URUN2:	MOVSI T2,JACCT		;IN NORMAL CASE, RESET JACCT
  1402	001232'	412342	001171*		ANDCAM T2,JBTSTS(J)
  1403	001233'	554341	000000	URUN4:	HLRZ	T2,(P)		;GET STARTING ADDRESS INCREMENT(0 IF RUN COM)
  1404	001234'	256200	002653'		XCTBU	<ADD T2,JOBSA>	;Add starting address (don't use ADDB)
  1405	001235'	606340	777700		TRNN	T2,777700	;SEE IF LEGITIMATE START ADDRESS
  1406	001236'	324740	000000*		PJRST	ERRNSA		;SAY NO START ADDRESS.
  1407	001237'	505340	012000		HRLI	T2,PC.USR!PC.PUB ;SET USER MODE BIT IN PC
  1408	001240'	261040	000007		PUSH	P,T2		;PUT ON PD LIST
  1409	001241'	254000	001020*		JRST	USRXIT##	;ENTER NEW PROGRAM AS IF FROM UUO
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 22
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1410				COMMENT @ PROCEDURE GETJB AND MGETJB
  1411
  1412				FUNCTION:	TO GET BOTH "HIGH" & "LOW" SEGMENTS SETUP
  1413					FOR THE RUNUUO,GET/RUN CMDS. CALLED BY URUN1,GETJOB.
  1414
  1415				CALL:	GET USER ARGS TO PDL FROM TTY OR ARG BLOCK
  1416					MOVE PG,ADDR OF ARG BLOCK IN PDL
  1417					PUSH P,START-ADDR-INCR,,ARB BITS
  1418					PUSHJ P,GETJB (FOR RUNUUO)
  1419				   OR,	PUSHJ P,MGETJB (RUN,GET COMMANDS)
  1420					RETURN ON SUCCESS
  1421				FAILURE:FAIL EXITS FROM GETJB DO NOT RETURN TO ITS CALLER: THEY
  1422					GO THRU SGRELE WHICH RETURNS EITHER TO USER OR
  1423					CMD LEVEL PHOLD WITH MSG.
  1424
  1425				RETURNS:	MOST AC'S DESTROYED
  1426					LICENSE SET UP
  1427					ACCOUNTING RECORD WRITTEN (GTJBFN DOES THIS)
  1428					EXO BIT SETUP
  1429					PREVIOUS MEMORY VREMOVED BEFORE CURRENT CORE IMAGE
  1430					 LOADED
  1431
  1432				FILE SEARCH SEQUENCE: FN.SHR( THEN FN.EXT OR FN.LOW IF EXT=0),
  1433					FN.HGH(FN.<EXT OR 'LOW'>),
  1434					FN.<EXT OR 'SAV'>,
  1435					FN.'SWR'
  1436
  1437				ENTRIES: GETJB	FOR RUNUUO. CAUSES DELAY IN REMOVE OF EXISTING PAGES
  1438					MGETJB FOR RUN/GET COMMANDS. VREMOV ALL CORE EXCEPT PG 1
  1439						BEFORE ANY LOOKUPS, ETC.
  1440
  1441				@
  1442
  1443	001242'	634240	000005	MGETJB: TDZA U,U	;MONITOR JOB ENTRY
  1444	001243'	201240	000001	GETJB:	MOVEI U,1	;RUNUUO ENTRY
  1445	001244'	702600	400000*		NOCHARGE		;NO MICROCYCLES DURING RUN OR GET
  1446	001245'	201300	004000		MOVEI T1,PVEXOG	;TURN OFF PVEXOG. ROUTINE "FOUND"
  1447	001246'	412302	001220*		ANDCAM T1,JBTPRV(J);IN LOOKUP CODE WILL TURN IT ON IF
  1448						;GETB IS ON (WHICH IT WILL BE,SEE BELOW), YET
  1449						;USER HASNT GOT READ PRIV ON THE FILE. ERGO
  1450						;HE HAS EXO PRIV ONLY.
  1451	001247'	326240	001253'		JUMPN U,GETJB0	;IF USER CALLED, KEEP CORE UNTIL LOOKUPS SUCCEED
  1452	001250'	260040	000000*		PUSHJ P,TIMADJ##
  1453	001251'	260040	001554'		PUSHJ P,KILLLS	;VREMOV PAGES 1-377 LEAVE PG 0
  1454	001252'	260040	001563'		PUSHJ P,KILLHS	;VREMOV PAGES 400 - 777
  1455	001253'	260040	000206'	GETJB0:	PUSHJ P,SETOPN	;T1-T3 FOR OPEN
  1456	001254'	050000	000006		OPEN RUNCHN,T1
  1457	001255'	254000	000510'		 JRST SGERRA
  1458	001256'	205200	000010		MOVSI F,GETB
  1459	001257'	437200	000000*		IORB F,%UPT+UPTJDA+RUNCHN	;GET BIT ON IN F,MEMORY
  1460									;GETLIC CALLED FROM GTJBFN
  1461									;NEEDS GETB IN F
  1462	001260'	205300	635062		MOVSI T1,'SHR'	;BEGIN FILE SEARCH SEQUENCE
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 22-2
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1463	001261'	260040	000443'		PUSHJ P,DOLOOK
  1464					 JRST [	MOVSI T1,'HGH'
  1465						PUSHJ P,DOLOOK
  1466						 JRST [	SKIPN T1,XPAUXT(PG)
  1467							MOVSI T1,SAVDMP##
  1468							PUSHJ P,DOLOOK
  1469							 JRST [	MOVSI T1,'SWR'
  1470								PUSHJ P,DOLOOK
  1471								JRST NOFILE
  1472								JRST GETJB1]
  1473							JRST GETJB1]
  1474	001262'	254000	002665'			JRST GETJB1]
  1475				;WHEN WE GET HERE, P2/0,,EXT P3/FILE PROT P4/SIZE IN WORDS
  1476	001263'			GETJB1:
  1477	001263'	322240	001267'		JUMPE U,GETJB2	;IF RUN/GET CMD, ALREADY REMOVED CORE
  1478	001264'	260040	001250*		PUSHJ P,TIMADJ##;NEW SPACE-TIME INTEGRAL. DESTROY NO ACS
  1479					;HERE IT WOULD BE NICE TO CHECK P4/XPASIZ
  1480					;AGAINST USERS PVYCOR AND GIVE HIM A NOROOM FRETURN
  1481					;BEFORE WE HAVE DESTROYED HIS CORE IMAGE. HOWEVER
  1482					;SINCE LOWSEGS ARE COMPRESSED, XPASIZ/WORDS DOESNT
  1483					;REFLECT THE ACTUAL CORE REQUIREMENT SO NOTHING WOULD
  1484					;BE GAINED. WHEN WE CHANGE TO MAPPING LOWSEGS COW AND
  1485					;NO COMPRSSION IN ANY FILES, THEN WE COULD DO
  1486					;THE CHECK HERE. XPASIZ WOULD BE REAL PAGES IN FILE.
  1487	001265'	260040	001554'		PUSHJ P,KILLLS	;VREMOV OLD LOWSEG 1-377. UPTREL FIXED
  1488	001266'	260040	001563'		PUSHJ P,KILLHS	;AND OLD HISEG, 400-777. UPTHRL FIXED
  1489	001267'	553000	000000*	GETJB2:	HRRZS %UPT+UPTPDL	;PC.USR_0 NO MORE RETURN TO USER
  1490					;SETZB T1,T2	;START=STOP=VP 0. TRY TO CREATE PG 0
  1491					;PUSHJ P,CORXPN	;IF ALREADY EXISTS, FRETURN W/0,,CREXV%
  1492					;JFCL		;FAILED,PROBABLY EXISTS
  1493	001270'	205300	000643*		MOVSI T1,SG.SWR
  1494	001271'	412300	000000*		ANDCAM T1,%UPT+UPTSTS	;CLEAR FLAG; MAPHS SETS IF NEEDED
  1495	001272'	200444	000004		MOVE T4,DEVMOD(F)
  1496	001273'	603440	000020		TLNE T4,DVMTA
  1497	001274'	254000	001373'		JRST GETMTJ	;GET MAGTAPE JOB SPECIAL CONSIDERATIONS
  1498	001275'	200340	000017		MOVE T2,P4	;T2/SIZE IN WORDS
  1499	001276'	306640	636762		CAIN P2,'SWR'
  1500	001277'	254000	001302'		JRST GETJB3
  1501	001300'	302640	635062		CAIE P2,'SHR'
  1502	001301'	306640	504750		CAIN P2,'HGH'	;IF ASKING FOR HISEG, ADJUST XPANEW
  1503				GETJB3:	JUMPG T2,[ PUSHJ P,ADJCOR	;DOWNWARD BY SIZE IN T2
  1504	001302'	327340	002671'			   JRST .+1]
  1505				;IF NOT 'SWR','HGH' OR 'SHR', DO LOWJOB
  1506	001303'	306640	636762		CAIN P2,'SWR'
  1507	001304'	254000	001324'		JRST HGHJOB
  1508	001305'	302640	635062		CAIE P2,'SHR'
  1509	001306'	306640	504750		CAIN P2,'HGH'
  1510	001307'	254000	001324'		JRST HGHJOB
  1511				; LOWJOB..FALL THRU FROM ABOVE IF EXT IS FOR LOWSEG,
  1512				; OR COME HERE FROM SHRJB4 BELOW WHEN HISEG FILE
  1513				; REQUERES A <128K LOW FILE TO BE READ.
  1514				;   ENTER WITH P4/ SIZE AS USUAL EXCEPT IF DVMTA, P4/0
  1515
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 22-3
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1516	001310'			LOWJOB:
  1517	001310'	260040	001572'		PUSHJ P,READLS	;READ,EXPAND IF NECESSARY
  1518	001311'	265300	001403'		 JSP T1, GTJBNR		;NOROOM FAIL EXIT
  1519	001312'	260040	000534'		PUSHJ P,LOWFIN	;GIVE WHATEVER MORE CORE XPANEW REQURES
  1520	001313'	256200	002673'		UMOVE T1,JOBS41	;RESTORE USER UUO JSR LOC
  1521	001314'	256200	002674'		UMOVEM T1,JOB41
  1522	001315'	260040	000000*		PUSHJ P,GETLIC##;GET T1/0,,FILE LIC; SKIP IF MAGTAPE. EXPECTS F
  1523	001316'	334000	000000		SKIPA
  1524	001317'	201300	000000		MOVEI T1,0
  1525	001320'	542303	000047		HRRM T1,XPALIC(PG)
  1526	001321'	205300	000004		MOVSI T1,LSLIC
  1527	001322'	436303	000000		IORM T1,XPAMOD(PG)	;INDICATE A LOWSEG LIC GOTTEN & SETUP
  1528	001323'	324740	001407'		PJRST GTJBFN	;FINISH UP LICENSE,EXO,ACT RECORD,..
  1529
  1530	001324'			HGHJOB:
  1531	001324'			SHRJOB:	;ENTER HERE WITH FILE LOOKED-UP & P4/SIZE IN WORDS
  1532	001324'	260040	002032'		PUSHJ P,MAPHS		;MAKE SHAREABLE RDO FILE PAGES
  1533					JSP T1,[ CAIN T4,FALCOR
  1534						JRST GTJBNR	;NO ROOM,CORE LIMIT FAILURE
  1535	001325'	265300	002675'			JRST MAPIOF]	;OTHER ERROR. SAY "TRANSMISS. ERROR".
  1536				; SHRJB2..COME HERE FROM GETMTJ TOO
  1537	001326'	260040	002220'	SHRJB2:	PUSHJ P,INIJDA	;MOVE DOWN VESTIGIAL JOBDAT
  1538	001327'	260040	001315*		PUSHJ P,GETLIC##;EXPECTS F. GET T1/0,,FILE LIC;
  1539	001330'	334000	000000		SKIPA		;GOOD RTN
  1540	001331'	201300	000000		MOVEI T1,0	;MAGTAPE RETURN
  1541	001332'	506303	000047		HRLM T1,XPALIC(PG)
  1542	001333'	205300	000002		MOVSI T1,HSLIC	;INDICATE A HISEG LIC
  1543	001334'	436303	000000		IORM T1,XPAMOD(PG)	;GOTTEN & SETUP
  1544	001335'	200303	000042		MOVE T1,XPAPID(PG)	;GET WHATEVER PID THERE IS ON THIS FILE
  1545	001336'	202303	000050		MOVEM T1,XPAHPD(PG)	;AND SAVE IT AS THE HISEG PID.
  1546	001337'	256200	002700'		XCTBU <HLRZ T2,JOBCOR>	;DOES THIS HISEG NEED
  1547						;A LOW FILE READ? TRUE IF DATA TO BE LOADED
  1548						;ABOVE JOBDAT AREA.
  1549	001340'	332303	000045		SKIPE T1,XPAUXT(PG)	;IF HE HAVE AN EXT,
  1550	001341'	254000	001345'		JRST SHRJB4		;READ IT REGARDLESS. OTHERWISE,
  1551	001342'	305340	000716*		CAIGE T2,JOBDA		;DATA EXISTS ABOVE JOBDAT?
  1552	001343'	254000	001355'		JRST SHRJB3		;NO, CREATE BLANK LOSEG; NO FILE TO READ IN
  1553	001344'	205300	545767		MOVSI T1,'LOW'		;DIDNT GIVE AN EXT, TRY LOW
  1554	001345'			SHRJB4:
  1555	001345'	260040	000443'		PUSHJ P,DOLOOK	;RETURN P2,P3,P4 SUCCESS SKIP
  1556					 JRST [	PUSHJ P,KILLHS
  1557						;JSP T1,REPDP
  1558	001346'	254000	002701'			JRST NOFILE]	;RET TO USER OR CMD LEVEL
  1559	001347'	200444	000004		MOVE T4,DEVMOD(F)
  1560	001350'	603440	000020		TLNE T4,DVMTA
  1561	001351'	201740	000000		MOVEI P4,0		;FORCE USE OF XPANEW FOR MT
  1562	001352'	305740	400000		CAIGE P4,400000		;P4/WORDS IN (COMPRESSED) FILE
  1563	001353'	254000	001310'		JRST LOWJOB		;READ & CREATE LOWSEG
  1564	001354'	265300	001403'		JSP T1,GTJBNR		;SIZE >128K; NOROOM FAIL
  1565
  1566				;COME HERE WHEN HIGH FILE REQUIRES NO LOW FILE DATA TO BE
  1567				;READ IN. CREATE A BLANK LOWSEG
  1568
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 22-4
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1569	001355'			SHRJB3:
  1570	001355'	200300	002703'		MOVE T1,[JOBDA,,JOBDA+1]	;CLEAR PG 0 FROM TOP OF
  1571	001356'	256200	002704'		XCTBU <SETZM -1(T1)>	;JOBDATA AREA TO 777
  1572	001357'	256240	002705'		XCTBU <BLT T1,777>	;INCASE PREV PROG LEFT ANY DATA THERE
  1573	001360'	256200	002706'		XCTFU <HRRZ T2,JOBCOR>	;T2/SIZE TO MAKE THE LOWSEG
  1574	001361'	435340	001777		IORI T2,1777
  1575	001362'	200740	000007		MOVE P4,T2	;INCASE CORXPN FAILS,& FOR UPTREL BELOW
  1576	001363'	242340	777767		LSH T2,-9
  1577	001364'	201300	000001		MOVEI T1,1	;FROM PG 1 TO T2/STOP PG.
  1578	001365'	260040	001531'		PUSHJ P,CORXPN	;CREATE PRIV RDW PAGES
  1579	001366'	254000	001403'		 JRST GTJBNR	;NO ROOM
  1580	001367'	542740	000000*		HRRM P4,%UPT+UPTREL
  1581	001370'	256200	002707'		XCTBU <HRRZM P4,JOBREL>
  1582	001371'	260040	000534'		PUSHJ P,LOWFIN	;ADD WHATEVER MORE CORE XPANEW SAYS
  1583	001372'	324740	001407'		PJRST GTJBFN	;FINISH UP, SUCCESS.
  1584
  1585	001373'			GETMTJ:	;DEVICE IS MAGTAPE. FIND OUT IF HISEG EXISTS ON TAPE.
  1586					;NONE EXISTS IF JOBHRN IN RECORD ON TAPE = 0.
  1587					;THIS MONITOR & PREVIOUS ONES ALWAYS WRITE 2 FILES ON TAPE
  1588					;FOR ANY SAVE, WHETHER 2 SEG OR NOT.
  1589	001373'	201740	000000		MOVEI P4,0	;IMPORTANT. P4 HAS "FILE SIZE". SEE READLS
  1590	001374'	260040	001727'		PUSHJ P,READHS		;READ INTO PRIV PGS, MAKE RDO
  1591	001375'	254000	001326'		JRST SHRJB2		;SUCCESS. GOOD HISEG READ.
  1592	001376'	322300	001403'		JUMPE T1,GTJBNR		;FAILURE. T1/0 IF NO ROOM
  1593	001377'	307300	000001		CAIG T1,1		;FAILURE. CODE T1=1?
  1594	001400'	324740	000000*		PJRST ERRMHB		;YES. HISEG FORMAT BAD OR SYS ERRORS
  1595	001401'	260040	001563'		PUSHJ P,KILLHS	;FAILURE CODE 2. ZERO LENGTH HISEG
  1596	001402'	254000	001310'		JRST LOWJOB		;SO KILL 1 PG CREATED & GO GET LOW
  1597				;COME HERE IF MAPHS,READHS,READLS FAILS. P4/SIZE IN WORDS
  1598				; OF FILE . SET UP FOR " XX PAGES REQUIRED" MESSAGE & GO
  1599
  1600	001403'			GTJBNR:	;JSP T1,REPDP	;FIX STACK
  1601	001403'	261040	000017		PUSH P,P4	;NOOOM EXPECTS THIS
  1602	001404'	260040	001554'		PUSHJ P,KILLLS	;DESTROY CORE IMAGE SINCE LICENSE,EXO
  1603	001405'	260040	001563'		PUSHJ P,KILLHS	;ETC NOT YET SET.
  1604	001406'	265300	000502'		JSP T1,NOROOM
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 23
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1605				COMMENT @ SUBROUTINE GTJBFN
  1606
  1607				FUNCTION: COMMON FINISH-UP ROUTINE FOR GET/RUN,RUNUUO,
  1608					RUNSEGUUO.
  1609					SETUP  LICENSE.  WRITE STREAM ACCT'G RECORD.
  1610					SET EXO BIT IF NEED BE.  RELEASE RUNCHN
  1611
  1612				EXPECTS: F/RUNCHN DDB J/JOB  XPAMOD/ HSLIC,LSLIC SETUP
  1613					XPALIC/ LICENSE(HI FILE),,LICENSE(LOW FILE) SETUP IF ANY
  1614					PG/ ADDR OF ARG BLK IN PDL
  1615				CALL:
  1616					PUSHJ P,GTJBFN
  1617					RETURN HERE
  1618
  1619				DESTROYS:T1,T2,T3,T4
  1620				CALLS: MAXLIC,ACTWRT,SGREL,LICMSK,GETLIC (ONLY USER OF GETLIC)
  1621					LICSAM (ONLY USER OF LICSAM AS OF 8/77)
  1622
  1623				IDIOSYNCRACIES:	THIS ROUTINE IMPLEMENTS A POLICY THAT NO LICENSED
  1624					'SWR' FILE WILL BE ALLOWED TO RUN WITHOUT THE EXECUTE-ONLY
  1625					BIT SET IN JBTPRV. THESE FILES RUN WITH MAX-WRITE SET, SO
  1626					MODIFICATIONS MADE BY THE RUNNING COPY TO ITSELF CHANGE
  1627					THE FILE PAGES DIRECTLY.
  1628					A FURTHER POLICY IMPLEMENTED HERE IS: IF BOTH
  1629					HIGH AND LOW FILES WERE GOTTEN, THE RESULTING LICENSE WILL
  1630					BE THE "AND" OF THE 2 FILE LICENSES--ONLY THOSE IN
  1631					COMMON TO THE 2 FILES WILL BE SET.
  1632					THE SAME POLICY IS USED FOR SETTING UP PIDS - IF THE CORE
  1633					IMAGE WAS OBTAINED FROM TWO FILES, THE PIDS FROM THE FILES
  1634					MUST MATCH EXACTLY OR NO PID IS GIVEN.
  1635				@
  1636
  1637				EXTERNAL %UPT,UPTMFR,JBTMFR,ALLMFR,EXOMFR,JBTPNO,RDXMFR
  1638
  1639	001407'			GTJBFN::
  1640	001407'	510343	000046		HLLZ T2,XPANEW(PG)	;LICENSE CALLER WANTS TO PASS
  1641	001410'	544342	001227*		HLR T2,JBTLIC(J)	;WHAT HE HAS
  1642	001411'	260040	000000*		PUSHJ P,LICMSK##	;CAN PASS NO MORE THAN HE HAS
  1643								;RETURN T2/...,,LIC TO PASS
  1644	001412'	200404	000004		MOVE T3,DEVMOD(F)
  1645	001413'	603400	200000		TLNE T3,DVDSK
  1646	001414'	334404	000017		SKIPA T3,DEVPPN(F)	;CALC NEW JBTFPN
  1647	001415'	201400	000000		MOVEI T3,0		;NONE IF OFF MAGTAPE
  1648	001416'	312402	000000*		CAME T3,JBTFPN(J)	;IF NOT FROM SAME UFD,
  1649	001417'	620340	002040		TRZ T2,LICRMT!LICHR	;CANNOT PASS HF or HR
  1650	001420'	202402	001416*		MOVEM T3,JBTFPN(J)	;SET NEW JBTFPN
  1651	001421'	261040	000007		PUSH P,T2		;PASSED LIC
  1652	001422'	200303	000000		MOVE T1,XPAMOD(PG)	;FLAGS HSLIC,LSLIC
  1653	001423'	200343	000047		MOVE T2,XPALIC(PG)	;2 LICENSES
  1654	001424'	641300	000006		TLC T1, HSLIC!LSLIC
  1655	001425'	647300	000006		TLCN T1,HSLIC!LSLIC		;SKIP IF BOTH NOT ON ORIGINALLY
  1656					JRST [	PUSHJ P,LICSAM##;BOTH HI & LOW GOTTEN. RETURN T2/ ...,,LICENSES
  1657								;COMMON TO BOTH HALVES
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 23-2
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1658						MOVE T3,XPAHPD(PG) ;GET HISEG PID
  1659						CAME T3,XPAPID(PG) ;MAKE SURE ITS SAME AS LOSEG PID
  1660						SETZM XPAPID(PG)	;NOT, HE GETS NO PID AT ALL.
  1661	001426'	254000	002710'			JRST GTJBF1]
  1662	001427'	607300	000002		TLNN T1,HSLIC		;JUST HISEG?
  1663	001430'	254000	001434'		JRST GTJBF1		;NO, JUST LOSEG, XPAPID AND T2 SETUP OK
  1664	001431'	557000	000007		HLRZS T2		;GET HISEG LICENSE IN T2
  1665	001432'	200403	000050		MOVE T3,XPAHPD(PG)	;AND HISEG PID IS ONE TO USE
  1666	001433'	202403	000042		MOVEM T3,XPAPID(PG)
  1667	001434'	200402	001246*	GTJBF1:	MOVE T3,JBTPRV(J)
  1668	001435'	200440	000000*		MOVE T4,%UPT+UPTSTS
  1669	001436'	603440	001270*		TLNE T4,SG.SWR
  1670	001437'	606340	777777		TRNN T2,-1
  1671	001440'	334000	000000		SKIPA			;NOT A SWR FILE OR NO LICENSE
  1672	001441'	664400	004000		TROA  T3,PVEXOG
  1673	001442'	602400	004000		TRNE T3,PVEXOG		;LOOKUP MAY ALSO HAVE SET THIS BIT
  1674	001443'	664400	400000		TROA T3,PVEXO		;PVEXOG ON, GOTTA SET PVEXO
  1675	001444'	620400	400000		TRZ  T3,PVEXO		;NOT ON,RESET PVEXO
  1676	001445'	202402	001434*		MOVEM T3,JBTPRV(J)
  1677	001446'	504342	001410*		HRL T2,JBTLIC(J)	;T2/JOB LIC,,FILE LIC
  1678	001447'	260040	000000*		PUSHJ P,MAXLIC##	;T2/...,MAX OF THESE
  1679	001450'	262040	000006		POP P,T1		;T1/PASSED LIC
  1680	001451'	504340	000006		HRL T2,T1		;T2/PASS,,MAX(FILE,JOB)
  1681	001452'	260040	001447*		PUSHJ P,MAXLIC##	;T2/..,,MAX OF THESE
  1682	001453'	506342	001446*		HRLM T2,JBTLIC(J)
  1683	001454'	506342	001230*		HRLM T2,JBTSLC(J)
  1684	001455'	200402	001445*		MOVE	T3,JBTPRV(J)	;GET PVEXO AGAIN AFTER MAXLIC SMASHED IT
  1685	001456'	201300	000000*		MOVEI	T1,EXOMFR	;ASSUME EXECUTE ONLY
  1686	001457'	602400	400000		TRNE	T3,PVEXO	;IS IT?
  1687	001460'	254000	001472'		JRST	GTJBF2		;YES.
  1688	001461'	201300	000000*		MOVEI	T1,RDXMFR	;ASSUME EXECUTE ONLY + READING THINGS
  1689	001462'	504342	001453*		HRL	T2,JBTLIC(J)	;GET FRAME'S LIC,,PROCESS LIC
  1690	001463'	621340	002040		TLZ	T2,LICRMT!LICHR	;IF PROCESS HAS HF or HR, FORCE MISMATCH
  1691	001464'	260040	001452*		PUSHJ	P,MAXLIC##	;GET MAX OF THOSE
  1692	001465'	550402	001462*		HRRZ	T3,JBTLIC(J)	;GET JOB LICENSE AGAIN
  1693	001466'	302407	000000		CAIE	T3,(T2)		;MAKE SURE FRAME HAS ALL LICENSE BEING GIVEN TO THIS PROCESS
  1694	001467'	254000	001472'		JRST	GTJBF2		;LICENSES ARE DIFFERENT, DOESN'T GET ALL ACCESS
  1695	001470'	336003	000042		SKIPN	XPAPID(PG)	;IF ITS NOT GOING TO HAVE A PID,
  1696	001471'	201300	000000*		MOVEI	T1,ALLMFR	;THEN HE CAN HAVE ALL ACCESS.
  1697	001472'	200406	000000	GTJBF2:	MOVE	T3,(T1)
  1698	001473'	202402	000000*		MOVEM	T3,JBTMFR(J)	;SET UP FIRST WORD
  1699	001474'	205406	000001		MOVSI	T3,1(T1)	;BLT FROM THAT TABLE
  1700	001475'	541400	000000*		HRRI	T3,%UPT+UPTMFR	;TO MIR TABLE
  1701	001476'	251400	000000*		BLT	T3,%UPT+UPTMFR+.ARSIZ-1
  1702	001477'	350002	000000*		AOS	JBTPNO(J)	;OK, WE'RE IN A NEW PROG NOW. INVALIDATE
  1703								; ALL RIGHTS GIVEN AWAY BY PAST FRAME OCCUPANT.
  1704
  1705	001500'	200303	000042		MOVE	T1,XPAPID(PG)	;GET FINAL PID DETERMINATION (SEE ABOVE)
  1706	001501'	202300	000000*		MOVEM	T1,%UPT+UPTPID	;SET IT UP.
  1707	001502'	402000	000000*		SETZM	%UPT+UPTSPD	;NO PREVIOUS PID.
  1708	001503'	402000	000000*		SETZM	%UPT+UPTSTV	;NO START VECTOR YET.
  1709					EXTERN ACTWRT
  1710	001504'	201300	000000		MOVEI T1,0
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 23-3
SEGCON.MAC	28-OCT-87 00:02		GETJB - MAIN ROUTINE TO LOAD CORE IMAGES FOR RUN/GET/RUNUUO

  1711	001505'	260040	000000*		PUSHJ P,ACTWRT		;WRITE TYPE 0 ACT RECORD IF NEEDED
  1712	001506'	201300	000016		MOVEI T1,16		;WRITE LICENSE RECORD IF
  1713	001507'	260040	001505*		PUSHJ P,ACTWRT		;NEEDED
  1714	001510'	260040	000563'		PUSHJ P,SGREL		;RELEASE DEVICES
  1715	001511'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 24
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1716				SUBTTL HI AND LOW "SEGMENT" GETTERS
  1717
  1718				;HISEG ROUTINES THAT WERE ELIMINATED IN THE PAGING MONITOR
  1719				;*; ASGHGH:: CHKMED:: ANYSAV:: DODELE:: IFDELE:: RELSEG:: CLRNAM:: KILHGC::
  1720				;*; HRESET:: RNMSEG::
  1721
  1722	001512'	263040	000000	USPY::	POPJ P,		;NO MORE SPY UUO. (Why not?)
  1723
  1724
  1725				COMMENT @ SUBROUTINE KILPGS VERSION 2 CALL UUOS
  1726				FUNCTION: VCLEAR PAGES FROM T1/START VP TO T2/STOP VP
  1727				EXPECTS: T1,T2,J/JOB
  1728				CALL:	MOVEI T1,START VP
  1729					MOVEI T2,STOP VP
  1730					PUSHJ P,KILPGS
  1731					ALWAYS RETURN HERE
  1732				FAIL:	STOPCD IF START .GT. STOP.
  1733				CALLS:	VCLEAR UUO
  1734				DESTROYS: T1,T2,W
  1735				IDIOSYNCRACIES: IF START=STOP, VCLEAR THAT PAGE ONLY.
  1736				RESTRICTIONS: CALL ONLY AT UUO LEVEL DUE TO VCLEAR WAIT
  1737
  1738				@
  1739
  1740	001513'	313300	000007	KILPGS::CAMLE T1,T2
  1741	001514'	256000	000000'		 STOPCD                         ;;KILPGS+1
  1742	001515'	616300	002715'		TDNN T1,[-1,,777000]	;ALLOW PAGE NOS. 0-777 ONLY
  1743	001516'	612340	002715'		TDNE T2,[-1,,777000]
  1744	001517'	256000	000000'		 STOPCD                         ;;KILPGS+4
  1745	001520'	551507	000001		HRRZI W,1(T2)
  1746	001521'	274500	000006		SUB W,T1
  1747	001522'	517000	000012		HRLZS W
  1748	001523'	434500	000006		IOR W,T1	;W/[STOP-START+1],,START
  1749	001524'	554342	000000*		HLRZ T2,JBTUPM(J)	;EXISTENT PAGES
  1750	001525'	322340	000000*		JUMPE T2,CPOPJ		;NOTHING TO DO
  1751	001526'	047500	777712		VCLEAR W,
  1752	001527'	256000	000000'		 STOPCD		;ANY ERROR IMPLIES BAD PAGE NO  ;;KILPGS+14
  1753	001530'	263040	000000		POPJ P,
  1754
  1755
  1756				COMMENT @ SUBROUTINE CORXPN VERSION 2
  1757				FUNCTION: TO VCREAT PAGES FROM T1/START PG TO T2/STOP PG
  1758					STATUS PRIV RDW, & PUT THEM IN UWS.
  1759				RESTRICTIONS: STOPCD IF START .GT. STOP
  1760					LMAP MUST BE IN %UPT..
  1761				DESTROYS: W,T1
  1762				CALL:	MOVEI T1,START VP#
  1763					MOVEI T2,STOP VP#
  1764					PUSHJ P,CORXPN
  1765					ERROR RTN, T1 CLOBBERED, W/ VP#,,ERROR CODE
  1766					SUCCESS RTN T1,T2 UNCHANGED
  1767				@
  1768
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 24-2
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1769	001531'	315340	000006	CORXPN::CAMGE T2,T1
  1770	001532'	256000	000000'		 STOPCD                         ;;CORXPN+1
  1771	001533'	616300	002715'		TDNN T1,[-1,,777000]
  1772	001534'	612340	002715'		TDNE T2,[-1,,777000]
  1773	001535'	256000	000000'		 STOPCD                         ;;CORXPN+4
  1774	001536'	551507	000001		HRRZI W,1(T2)
  1775	001537'	274500	000006		SUB W,T1
  1776	001540'	517000	000012		HRLZS W
  1777	001541'	434500	000006		IOR W,T1	;W/ [STOP-START+1],,START
  1778	001542'	261040	000012		PUSH P,W
  1779	001543'	661500	006000		TLO W,(<CPRRDW>B7)
  1780	001544'	047500	777711		VCREAT W,
  1781					 JRST [	POP P,T1
  1782	001545'	254000	002716'			POPJ P,]
  1783	001546'	262040	000012		POP P,W
  1784	001547'	661500	000000*		TLO W,WS.ADD	;ADD-TO-UWS BIT
  1785	001550'	200300	002720'		MOVE T1,[XWD .WSRNG,W]	;SET WS BY RANGE, ARG BLOCK W
  1786	001551'	047300	777704		WSCTL T1,
  1787					PUSHJ P, [HRRZS T1	;ERROR CODE
  1788						CAIE T1,WSATM%	;"ADDED TOO MUCH"?
  1789						 STOPCD                 ;;CORXPN+22
  1790	001552'	260040	002721'			POPJ P,]
  1791	001553'	254000	001200*		JRST CPOPJ1
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 25
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1792				COMMENT @ SUBROUTINE KILLLS
  1793				FUNCTION: KILL PAGES 1-377, LEAVE PG 0 ALONE, SET JOBREL/0,,777
  1794				RESTRICTION: DESIRED LMAP MUST BE IN %UPT..; THIS ROUTINE
  1795					WRITES ON JOBDATA AREA IN USER SPACE SO PREVIOUS
  1796					CONTEXT MUST NOT BE MONITOR SPACE.
  1797				RETURN:	NOSKIP RTN ALWAYS
  1798				DESTROY:T1,T2,W, (PG?,..)
  1799				@
  1800	001554'	201300	000777	KILLLS::MOVEI T1,777
  1801	001555'	260040	000000*		UXCTBU <HRRZM T1,JOBREL>
  1802	001556'	256200	002725'
  1803	001557'	542300	000000*		HRRM T1,%UPT+UPTREL
  1804	001560'	201300	000001		MOVEI T1,1
  1805	001561'	201340	000377		MOVEI T2,377
  1806	001562'	324740	001513'		PJRST KILPGS
  1807
  1808
  1809				COMMENT @ SUBROUTINE KILLHS-- KILL EVERYTING FROM 400 - 777
  1810
  1811				RESTRUCTION: DESIRED LMAP MUST BE MAPPED IN %UPT..
  1812				DESTROYS: T1,T2,W, RESETS JOBHRL
  1813				RETURNS:	ALWAYS NOSKIP RETURN
  1814				CALLS: KILPGS
  1815				@
  1816
  1817	001563'	201300	000400	KILLHS::MOVEI T1,400
  1818	001564'	201340	000777		MOVEI T2,777
  1819							;CLEAR LH JOBHRL=1ST FREE IN HISEG,
  1820	001565'	260040	001555*		UXCTTU <SETZM JOBHRL>	;RH_HI ADDR
  1821	001566'	256200	002726'
  1822	001567'	513000	000000*		HLLZS %UPT+UPTHRL
  1823	001570'	324740	001513'		PJRST KILPGS
  1824
  1825
  1826				COMMENT ! DO NOT CALL KILLLS OR KILLHS FROM WITHIN
  1827					UUO'S ISSUED BY THE MONITOR, WITHOUT CHANGING THE
  1828					EXECUTIVE XCT'S HERE TO USE DOXCT
  1829					IN CORE1.
  1830				!
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 26
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1831				COMMENT @ SUBROUTINE READLS
  1832
  1833				FUNCTION: CREATE A "LOW SEGMENT" OF PRIVATE RDW PAGES
  1834					COPIED FROM THE FILE/DEVICE ON RUNCHN.
  1835	
  1836					SET JOBREL&UPTREL WHEN DONE. SEGMENT SIZE IN 1K INCREMENTS
  1837
  1838					READLS ASSUMES THAT ADJCOR HAS BEEN CALLED FIRST IF
  1839					A HISEG EXISTS, TO REDUCE XPANEW. READLS VALIDATES
  1840					XPANEW AGAINST THE SIZE PRESENTED IN P4, USING CKIOWD.
  1841					CKIOWD DOES NOROOM IF XPANEW IS TOO SMALL.
  1842
  1843					READLS IS THE ONLY PLACE CKIOWD IS CALLED DURING A GET.
  1844
  1845
  1846					WHERE POSSIBLE, READLS WILL MAP THE REQUESTED LOW
  1847					FILE INTO USER SPACE ABOVE UPTREL/HRL AND
  1848					BLT THE WHOLE BUSINESS DOWN INTO ITS PROPER POSITION
  1849					BEFORE CALLING EXPAND.
  1850
  1851
  1852				EXPECTS: PG/ ADDR OF ARG BLOCK IN PDL
  1853					F/DDB FOR RUNCHN
  1854					P2-P4 AS RETURNED BY DOLOOK, P4/SIZE IN WORDS
  1855						(EXCEPT IF DVMTA, P4/0)
  1856					PAGE 0 EXISTS, NO OTHER LOWSEG MEMORY
  1857					XPACOM(PG)/ XXX,,JOBSVM
  1858					J/JOB
  1859				CALL:
  1860					PUSHJ P,READLS
  1861					 ERROR RETURN
  1862					SUCCESS RETURN
  1863					(ANY I/O ERRORS RETURN DIRECTLY TO USER/CMD LEVEL VIA SGIOCK)
  1864				DESTROYS: T1-4,,,S
  1865				RETURNS:	RUNCHN OPEN, RDW MEMORY ASSIGNED& IO COMPLETE
  1866					FILE EXPANDED IF EXPANSION NEEDED
  1867
  1868				RESTRICTIONS: THIS ROUTINE WRITES ON JOBREL IN PREVIOUS
  1869						CONTEXT. THAT HAD BETTER BE THE USER SPACE.
  1870					ALSO THIS CALLS EXPAND WHICH WRITES ON PREVIOUS SPACE.
  1871				CALLS: CORXPN,SGDO(SGIOCK,EXPAND),VCREATE,PAGSTS,INPUTUUO
  1872
  1873				MAGTAPE IDIOSYNCRACIES:  P4/0 FORCES USE OF XPANEW IOR 1777
  1874					WHICH IS THE VALUE RETURNED BY CKIOWD. THUS IF USER
  1875					GIVES NO CORE ARG HE GETS 1K AND RECORDS ON TAPE WILL
  1876					BE READ INTO THAT 1K UNTIL IT OR RECORDS ARE EXHAUSTED.
  1877					IF THERE ARE MORE THAN 1K OF RECORDS, THE REST
  1878					ARE LOST AND (IS THERE AN ERROR INDICATION?) MERRILY
  1879					WE PROCEED.
  1880
  1881				@
  1882
  1883	001571'	000000	000001	RDLSW:	EXP 1	;PATCH THIS SWITCH TO TURN OFF MAPPING LOWSEGS
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 26-2
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1884	001572'	321740	001525*	READLS::JUMPL P4,CPOPJ	;FILE TOO BIG OR SIZE .GT.0 ( ? ! )
  1885	001573'	303740	777777		CAILE P4,777777
  1886	001574'	263040	000000		POPJ P,
  1887	001575'	210340	000017		MOVN T2,P4
  1888	001576'	260040	000467'		PUSHJ P,CKIOWD	;RET IF ALL OK, T1/MAX(SIZE,XPANEW) IOR 1777
  1889	001577'	261040	000006		PUSH P,T1	;SAVE +(SIZE OF CORE AREA)
  1890	001600'	210340	000006		MOVN T2,T1
  1891	001601'	271340	000752*		ADDI T2,JOBSVM
  1892	001602'	332000	000017		SKIPE P4	;IF MAG TAPE, IOWD LENGTH = XPANEW-JOBSVM
  1893	001603'	210340	000017		MOVN T2,P4	;ELSE FOR DSK,FILE LENGTH
  1894	001604'	506343	000051		HRLM T2,XPACOM(PG); -LENGTH,,JOBSVM
  1895	001605'	242300	777767		LSH T1,-9	;FOR CORXPN. STOP PG
  1896	001606'	201340	000001		MOVEI T2,1	;START PG.
  1897	001607'	250300	000007		EXCH T1,T2
  1898	001610'	260040	001531'		PUSHJ P,CORXPN	;FROM 1 TO (XPANEW OR FILE SIZE) IOR 1777
  1899	001611'	254000	000530*		JRST TPOPJ	;FIX PDL GET SIZE BACK,FAIL RETURN
  1900	001612'	262040	000006		POP P,T1	;SAVED +SIZE
  1901	001613'	256200	002727'		UMOVEM T1,JOBREL
  1902	001614'	542300	000000*		HRRM T1,%UPT+UPTREL
  1903	001615'	332000	000017		SKIPE P4	;MAG TAPE DEVICE?
  1904	001616'	336000	001571'		SKIPN RDLSW	;SWITCH PATCHED?
  1905	001617'	254000	001716'		JRST RDLSUU	;MT OR JUST DO INPUT UUO ALWAYS
  1906
  1907	001620'	550340	000000*		HRRZ T2,%UPT+UPTHRL
  1908	001621'	317340	000006		CAMG T2,T1	;IF END OF HISEG < END LOWSEG
  1909	001622'	200340	000006		MOVE T2,T1	;USE END OF LOWSEG
  1910	001623'	201447	000001		MOVEI T4,1(T2)
  1911	001624'	242440	777767		LSH T4,-9	;T4/BEG PG NO OF MAPPING AREA
  1912	001625'	200400	000017		MOVE T3,P4	;GET T3 TO
  1913	001626'	271400	000777		ADDI T3,777	;BE FILE SIZE IN
  1914	001627'	242400	777767		LSH T3,-9	;PAGES
  1915	001630'	201300	777777		MOVEI T1,777777	;END OF 256K
  1916	001631'	274300	000007		SUB T1,T2	;WORDS AVAIL FROM END LOW[HI]SEG TO END MEMORY
  1917	001632'	242300	777767		LSH T1,-9	;AVAIL PGS
  1918	001633'	315300	000010		CAMGE T1,T3	;AVAIL .GE. FILE SIZE?
  1919	001634'	254000	001716'		JRST RDLSUU	;NO, DO INPUT UUO
  1920	001635'	514340	000010		HRLZ T2,T3	;T2/<CONTIG>,,0
  1921	001636'	540340	000011		HRR T2,T4	;T2/<CONTIG>,,BEG VP FOR MAPPING
  1922	001637'	200440	000007		MOVE T4,T2	;A COPY FOR VREMOV BELOW
  1923	001640'	661340	002000		TLO T2,(<CPRRED>B7)
  1924	001641'	261042	001455*		PUSH P,JBTPRV(J)
  1925	001642'	201300	000177		MOVEI T1,177
  1926	001643'	137300	000000*		DPB T1,PVYCOR##	;CAN HAVE 256K FOR A MOMENT
  1927	001644'	201400	000001		MOVEI T3,1	;FILE PAGE TO BEGIN MAPPING
  1928	001645'	200300	002730'		MOVE T1,[FNCMDP,,RUNCHN]
  1929	001646'	043300	000007		CHANIO T1,T2	;T2,T3 IS THE ARG BLOCK. MAP THE WHOLE FILE
  1930	001647'	254000	001705'		  JRST RDLSFM	;TROUBLE. ANALYZE
  1931	001650'	262042	001641*		POP P,JBTPRV(J)	;BACK TO HIS CORE LIMIT
  1932	001651'	564343	000051		HLRO T2,XPACOM(PG)	;-WORDS IN FILE
  1933	001652'	213000	000007		MOVNS T2
  1934	001653'	200400	000007		MOVE T3,T2	;A COPY FOR BLT PTR COMPUTE BELOW
  1935	001654'	271340	000177		ADDI T2,177	;ROUND UP TO BLOCK BDRY
  1936	001655'	242340	777771		LSH T2,-7	;T2/BLOCKS IN FILE
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 26-3
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1937	001656'	272340	000000*		ADDM T2,JBTRCT	;TREAT AS IF THESE BLOCKS WERE INPUT
  1938	001657'	272342	001656*		ADDM T2,JBTRCT(J)
  1939	001660'	260040	000000*		PUSHJ P,GTCGSZ##;GET T1/CHARG SIZE IN K. CLOBBER NO AC'S
  1940	001661'	220300	000007		IMUL T1,T2	;T1/BLKS READ * JOB SIZE
  1941	001662'	272300	000000*		ADDM T1,JBTSIN
  1942	001663'	272302	001662*		ADDM T1,JBTSIN(J)
  1943	001664'	200340	000011		MOVE T2,T4	;CONTIG,,BEG VP
  1944	001665'	661340	001547*		TLO T2,WS.ADD
  1945	001666'	200300	002731'		MOVE T1,[.WSRNG,,T2]
  1946	001667'	047300	777704		WSCTL T1,	;T2 IS ARG BLOCK
  1947	001670'	255000	000000		JFCL
  1948	001671'	550303	000051		HRRZ T1,XPACOM(PG)
  1949	001672'	271300	000001		ADDI T1,1	;T1/USERADDR=JOBSV
  1950	001673'	550340	000011		HRRZ T2,T4	;T2/BEG PG MAPPING AREA
  1951	001674'	242340	000011		LSH T2,9	;CONVERT VP# TO WORD NO.,MAPPED AREA
  1952	001675'	504300	000007		HRL T1,T2	;T1/MAPPED WORD ADDR,,JOBSV
  1953	001676'	550343	000051		HRRZ T2,XPACOM(PG)	;T2/JOBSVM
  1954	001677'	270340	000010		ADD T2,T3	;T2/JOBSV+FILESIZE-1=END OF BLT
  1955	001700'	256240	002732'		XCTBU <BLT T1,(T2)>	;FROM HI USER SPACE TO LOW
  1956	001701'	047440	777713		VREMOV T4,	;GET RID OF MAPPED STUFF NOW,BLT DONE
  1957	001702'	256000	000000'		 STOPCD                 ;;READLS+many
  1958	001703'	260040	001053'		PUSHJ P,EXPAND	;FINISH UP LIKE SGDO
  1959	001704'	254000	001553*		JRST CPOPJ1	;& SKIP RETURN
  1960
  1961	001705'	262042	001650*	RDLSFM:	POP P,JBTPRV(J)	;MAP THE WHOLE FILE FAILED.
  1962	001706'	550400	000006		HRRZ T3,T1	;MAP ERROR CODE
  1963	001707'	302400	000000*		CAIE T3,FALLKO	;LOOKUP ONLY
  1964	001710'	306400	000000*		CAIN T3,FALBDS	;BAD SAT
  1965	001711'	254000	000436'		JRST MAPIOF	;GIVE "TRANS. ERROR" MSG & STOP JOB
  1966	001712'	302400	000000*		CAIE T3,FALHOL	;FILE HAD A HOLE?
  1967	001713'	306400	000000*		CAIN T3,FALRBE	;RIB ERR
  1968	001714'	254000	000436'		JRST MAPIOF
  1969	001715'	256000	000000'		 STOPCD		;SOME OTHER ERROR. BUG. ;;RDLSFM+10
  1970
  1971				; RDLSUU -- DO LOWSEG VIA INPUT UUO AS IN OLD SYSTEM.
  1972				;	build IOWD command list in T1,T2,T3 - may have to break it
  1973				;	in half if lh(XPACOM) so big it appears positive
  1974
  1975	001716'	200303	000051	RDLSUU:	MOVE 	T1,XPACOM(PG)
  1976	001717'	403340	000010		SETZB	T2,T3
  1977	001720'	321300	001724'		JUMPL	T1,RDLSU1	;check for overflow; (+)
  1978	001721'	200340	000006		MOVE	T2,T1		;too big - break it in half
  1979	001722'	505300	400000		HRLI	T1,-400000
  1980	001723'	270340	002627'		ADD	T2,[400000,,400000]
  1981	001724'	260040	000424'	RDLSU1:	PUSHJ 	P,SGDO		;WILL EXECUTE THE FOLLOWING UUO:
  1982	001725'	066000	000006		INPUT 	RUNCHN,T1	;AND EXPAND CORE IF REQURED
  1983								;(EXPAND MAY DO CORE UUO & CHANGE
  1984								;JOBREL & UPTREL)
  1985	001726'	254000	001704*		JRST CPOPJ1
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 27
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  1986				COMMENT @ SUBROUTINE READHS
  1987
  1988				FUNCTION: CREATE A PRIVATE RDO "HISEG" OF PAGES
  1989					READ OFF OF MAGTAPE ON RUNCHN, USING INPUT UUO.
  1990
  1991					NOT USED FOR FILES ON DSK. ONLY ON MAG TAAPE
  1992
  1993					SET JOBHRL, UPTHRL PROPERLY
  1994
  1995				CALL:	
  1996					MOVE F,%UPT+UPTJDA+RUNCHN
  1997					PUSHJ P,READHS
  1998					 SUCCESS RTN: ALL I/O COMPLETE,MEM MADE RDO,
  1999						RUNCHN OPEN.
  2000					 ERROR RETURN: SOME (MAYBE 0) RDW MEMORY ASSIGNED,
  2001						RUNCHN OPEN.
  2002						T1/ 0 - CORXPN FAIL. NOROOM
  2003						T1/1 -  SIZE ON TAPE BAD or VPROT failure
  2004						T1/ 2 - SIZE ON TAPE 0 - NULL HISEG RECORDED
  2005							or EOF seen
  2006				DESTROYS: T1-T4
  2007				CALLS: INPUT,VPROT,CORXPN,SGIOCK
  2008				I/O ERROR: SGIOCK EXITS TO USER/CMD LEVEL IF
  2009					ANY I/O ERROR. NO RETURN TO READHS.
  2010				RESTRICTIONS: WRITES ON JOBHRL IN PREVIOUS CONTEXT. MAKE SURE
  2011						THAT THAT IS USER SPACE. (PC.UIO !)
  2012				@
  2013
  2014
  2015	001727'	200404	000004	READHS::MOVE T3,DEVMOD(F)
  2016	001730'	607400	000020		TLNN T3,DVMTA	;IF ITS NOT A MAG TAPE DEVICE,
  2017	001731'	256000	000000'		 STOPCD		;CALLER CONFUSED        ;;READHS+2
  2018	001732'	201340	000000*		MOVEI T2,<MTSIZ##+377777>B<^D35+^D9>	;STOP PG
  2019	001733'	201300	000400		MOVEI T1,400	;START
  2020	001734'	260040	001531'		PUSHJ P,CORXPN
  2021	001735'	254000	002024'		JRST RDHSE0	;FRET ERR CODE 0
  2022	001736'	205300	000000*		MOVSI T1,-MTSIZ##
  2023	001737'	541300	377777		HRRI T1,400000-1; -(SIZE),,377777
  2024	001740'	201340	000000		MOVEI T2,0	;IOLST_T1,T2
  2025	001741'	066000	000006		INPUT RUNCHN,T1	;READ THE STUFF
  2026	001742'	260040	000433'		PUSHJ P,SGIOCK	;RET IF ALL OK, ELSE TO USER/CMD LEVEL
  2027	001743'	602000	020000		TRNE S,IODEND		;EOF? S SETUP BY SGIOCK
  2028	001744'	254000	002026'		JRST RDHSE2		;THERE IS NO HISEG
  2029	001745'	256200	002733'		UHLRZ	T2,JOBHCR+400000	;HI LOSEG NONZERO DATA LOC
  2030	001746'	256200	002734'		UHRRZ	T1,JOBHCR+400000	;SAVE TO TAPE CORE ARG
  2031	001747'	317300	000007		CAMG	T1,T2			;USE THE LARGER VALUE
  2032	001750'	200300	000007		MOVE	T1,T2
  2033	001751'	201340	777777		MOVEI	T2,-1			;NOW MAKE SURE XPANEW
  2034	001752'	616343	000046		TDNN	T2,XPANEW(PG)		;IS SET UP FOR READLS
  2035	001753'	542303	000046		HRRM	T1,XPANEW(PG)		;OTHERWISE ONLY 1K ASSIGNED
  2036									;FOR READING LOWSEG OFF OF TAPE
  2037	001754'	256200	002735'		UHLRZ T2,JOBHRN+400000	;REAL SIZE OF THE HISEG
  2038					JUMPE T2,[MTAPE RUNCHN,16	;SKIP OVER EOF
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 27-2
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2039	001755'	322340	002736'			  JRST RDHSE2]	;FRET CODE 2
  2040	001756'	261040	000007		PUSH P,T2
  2041	001757'	307340	000000*		CAIG T2,MTSIZ##	;WHOLE HS IN 1 RECORD?
  2042	001760'	254000	001777'		 JRST RDHS1	;YUP
  2043	001761'	271340	400000		ADDI T2,400000
  2044	001762'	242340	777767		LSH T2,-9	;STOP PAGE
  2045	001763'	201300	000401		MOVEI T1,401	;START PAGE. ALREADY CREATED PG 400
  2046	001764'	307340	000777		CAIG T2,777	;
  2047	001765'	315340	000006		CAMGE T2,T1	;VALIDATE SIZE RECORDED ON TAPE
  2048					 JRST [POP P,T1	;BAD
  2049	001766'	254000	002740'			JRST RDHSE1]	;FRET CODE 1
  2050	001767'	260040	001531'		PUSHJ P,CORXPN
  2051					  JRST [POP P,T1	;FRETURN NOROOM
  2052	001770'	254000	002742'			JRST RDHSE0]	;CODE 0
  2053	001771'	210301	000000		MOVN T1,0(P)	;-SIZE
  2054	001772'	205306	001757*		MOVSI T1,MTSIZ##(T1)	;-(SIZE-MTSIZ),,0 ADJUST FOR
  2055	001773'	541300	377777*		HRRI T1,377777+MTSIZ##	;1 RECORD ALREADY READ
  2056						;T1/ -SIZE+MTSIZE,,377777+MTSIZ = IOWD
  2057	001774'	201340	000000		MOVEI T2,0	;T1,T2 ARE IOLST
  2058	001775'	066000	000006		INPUT RUNCHN,T1
  2059	001776'	260040	000433'		PUSHJ P,SGIOCK	;RETURNS ONLY IF NO IO ERRORS
  2060	001777'	061000	022000	RDHS1:	STATO RUNCHN,IOTEND+IODEND	;MAGTAPE AT END OF TAPE OR END OF FILE?
  2061	002000'	072000	000016		MTAPE RUNCHN,16		;NO, SKIP OVER THE EOF
  2062	002001'	060000	000016		SETSTS RUNCHN,DR		;RESET THE EOF BIT
  2063				;NOW MAKE HISEG MEMORY RDO.
  2064	002002'	200301	000000		MOVE T1,0(P)	;T1/SIZE
  2065	002003'	271300	000777		ADDI T1,777	;CONTIG=SIZE+777 LSH -9
  2066	002004'	242300	777767		LSH T1,-9
  2067	002005'	517000	000006		HRLZS T1	;IN LH
  2068	002006'	434300	002744'		IOR T1,[<CPRRED>B7+400]
  2069	002007'	047300	777710		VPROT T1,	;MAKE PGS 400->LENGTH RDO
  2070					JRST [POP P,T1	;FAIL,RETURN
  2071	002010'	254000	002740'			JRST RDHSE1] ; CODE 1
  2072	002011'	200400	002604'		MOVE T3,[<CPRRED>B7+1B17+400]	;FOR ADD1PG
  2073	002012'	262040	000006		POP P,T1	;+SIZE
  2074	002013'	201346	000777		MOVEI T2,777(T1);PAGES IN SEG = SIZE+777 LSH -9
  2075	002014'	242340	777767		LSH T2,-9	;FOR ADD1PG
  2076	002015'	271300	377777		ADDI T1,377777
  2077	002016'	602300	001000		TRNE T1,1000	;SKIP IF NEEDS 1 PG TO MAKE 1K MULTIPLE
  2078	002017'	664300	001777		TROA T1,1777	;ALREADY OK
  2079	002020'	260040	002161'		PUSHJ P,ADD1PG
  2080	002021'	256200	002745'		UMOVEM T1,JOBHRL
  2081	002022'	542300	000000*		HRRM T1,%UPT+UPTHRL
  2082	002023'	263040	000000		POPJ P,		;SUCCESS EXIT NOSKIP
  2083
  2084				;FAILURE RETURNS TO SETUP T1
  2085	002024'	265300	002027'	RDHSE0:	JSP T1,RDHSEX
  2086	002025'	265300	002027'	RDHSE1:	JSP T1,RDHSEX
  2087	002026'	265300	002027'	RDHSE2:	JSP T1,RDHSEX
  2088	002027'	275300	002025'	RDHSEX:	SUBI T1,RDHSE0+1
  2089	002030'	553000	000006		HRRZS T1
  2090	002031'	254000	001726*		JRST CPOPJ1	;SKIP RTN FAILURE
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 28
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2091				COMMENT ! ROUTINE MAPHS
  2092				FUNCTION: CREATE A SEGMENT OF SHAREABLE PAGES MAPPED
  2093					READ-ONLY FROM THE FILE OPEN ON RUNCHN, MAPPING
  2094					INTO CONTIGUOUS VP'S STARTING AT 400. MAP CONTIGUOUS
  2095					FILE PAGES STARTING AT FILE PG 1. ASSUME
  2096					THAT THE FILE CONTAINS A LITERAL CORE IMAGE.
  2097					(NO ZERO-COMPRESSION).
  2098
  2099					FOR 'SWR' FILES ONLY, MAP PAGES MAX-WRITEABLE,
  2100					BUT CURR PROT = RDO, SAME AS OTHERS.
  2101
  2102
  2103					CREATE AN EXTRA PRIVATE WITH READ-ONLY CURRENT
  2104					PROTECTION AT THE END OF THE "SEGMENT" IF
  2105					ONE IS NEEDED TO MAKE AN EVEN 1K SIEGMENT SIZE.
  2106
  2107					SET JOBHRL AND UPTHRL APPROPRIATELY. PUT ALL MAPPED
  2108					PAGES IN UWS IF POSSIBLE. FLAG SG.SWR IN
  2109					UPTSTS SET IF SEGMENT CAME FROM A .SWR FILE.
  2110
  2111				EXPECTS: F/DDB 	GETB SET UNLESS GETSEG; J/JOB
  2112					P4/FILE SIZE IN WORDS
  2113					P2/0,,EXT FROM LOOKUP
  2114					P3/PROTECTION OF FILE FROM XPAPRV
  2115				CALL:	PUSHJ P,MAPHS
  2116					ERROR RETURN: T4/VMAP ERROR CODE. SOME MEMORY ASSIGNED,
  2117							RUNCHN OPEN.
  2118					SUCCESS: CHAN OPEN, ALL MAPPING COMPLETE, SOME
  2119						(HOLPFULLY ALL) PAGES IN UWS
  2120				DESTROYS: T1-T4
  2121				RESTRICTION: WRITES ON PREVIOUS ADDRESS SPACE AT JOBHRL. MAKE
  2122					SURE THIS IS USER SPACE.
  2123				idiosyncracies:  This routine implements "writeable high-segments"
  2124				by a kludge.  When the extension is ".SWR" and the UUO is
  2125				RUN or RUNSEG, we set ENTRB so that MAP will set LMPMXW in all
  2126				slots.  Then we immediately turn off ENTRB. [Note that the
  2127				user may not have priv to, and may not have ever done, an ENTER
  2128				on the SWR file--this is what ENTRB usually implies].  If he
  2129				has not got at least update priv on the file, we set PVEXOG in
  2130				JBTPRV so that PVEXO will get set and he wont be able to meddle
  2131				with the prog/file.  If the ext is SWR and uuo is GETSEG, we
  2132				give him ENTRB only if he has update priv, and we don't bother with
  2133				PVEXOG.
  2134				!
  2135				EXTERN CHKACC	;IN FILFND
  2136				EXTERN FNCUPD,FNCRED,FNCEXC	;IN COMMOD
  2137				EXTERN FALCOR,FALRBE,FALBDS,FALLKO,FALHOL	;IN MAPIO
  2138				EXTERN GETLI1	;IN FILUUO (PART OF GETLIC)
  2139
  2140	002032'	201440	000000*	MAPHS::	MOVEI T4,FALCOR	;IN CASE WE FRET RIGHT HERE
  2141	002033'	323740	001572*		JUMPLE P4,CPOPJ	;FRET TOO SMALL
  2142	002034'	303740	377777		CAILE P4,400000-1
  2143	002035'	263040	000000		POPJ P,		;FRET TOO BIG
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 28-2
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2144	002036'	200344	000004		MOVE T2,DEVMOD(F)
  2145	002037'	607340	200000		TLNN T2,DVDSK	;IS IT A MAPPING DEVICE? SKIP IF YES
  2146	002040'	256000	000000'		 STOPCD		;CALLER CONFUSED.       ;;MAPHS+6
  2147	002041'	261040	000017		PUSH P,P4	;SIZE
  2148	002042'	302640	636762		CAIE P2,'SWR'
  2149	002043'	254000	002066'		JRST MAPHS1	;NOT FANCY. JUST SHR OR HGH
  2150	002044'	201300	000000*		MOVEI T1,FNCRED	;GETSEG NEEDS READ PRIV
  2151	002045'	603200	000010		TLNE F,GETB
  2152	002046'	201300	000000*		MOVEI T1,FNCEXC	;RUN/RUNSEG NEEDS EXECUTE PRIV
  2153	002047'	200440	000016		MOVE T4,P3	;PROT FROM LOOKUP
  2154	002050'	200344	000017		MOVE T2,DEVPPN(F)
  2155	002051'	260040	000000*		PUSHJ P,CHKACC	;CAN HE EXECUTE[READ] IT?. SKIP YES
  2156	002052'	254000	002066'		JRST MAPHS1	;NO. MAP WILL FAIL
  2157	002053'	201300	000000*		MOVEI T1,FNCUPD
  2158	002054'	200440	000016		MOVE T4,P3	;PROT FROM LOOKUP
  2159	002055'	200344	000017		MOVE T2,DEVPPN(F)
  2160	002056'	260040	002051*		PUSHJ P,CHKACC	;SKIP IF FNCUPD OK. CLOB T1-T4 ONLY
  2161							;EXPECTS J/JOB,T1,T2,T4
  2162	002057'	334300	002746'		SKIPA T1,[PVEXOG]	;NO UPDATE ACCESS
  2163	002060'	201300	000000		MOVEI T1,0		;UPDATE ACCESS ALLOWED. NO EXO BIT
  2164	002061'	607200	000010		TLNN F,GETB		;SKIP IF RUN/RUNSEG
  2165					 JRST [JUMPN T1,MAPHS1	;GETSEG: IF NO UPDATE ACCESS,
  2166	002062'	254000	002747'			JRST MAPHS0]	;[T1/PVEXOG], AVOID SETTING
  2167							;ENTRB. ELSE T1/0 UPDATE ACCESS OK, SET ENTRB
  2168	002063'	436302	001705*		IORM T1,JBTPRV(J)
  2169	002064'	205200	020000	MAPHS0:	MOVSI F,ENTRB		;KLUDGE: TRICK VMAP UUO INTO
  2170	002065'	436200	000000*		IORM F,%UPT+UPTJDA+RUNCHN  ;SETTING MAX-WRITE BITS
  2171	002066'	550341	000000	MAPHS1:	HRRZ T2,(P)	;SIZE
  2172	002067'	271340	000777		ADDI T2,777	;CALCULATE CONTIG FOR VMAP
  2173	002070'	242340	777767		LSH T2,-9
  2174	002071'	261040	000007		PUSH P,T2	;SAVE CONTIG FOR CHARGING,ADD1PG
  2175	002072'	517000	000007		HRLZS T2
  2176	002073'	434340	002744'		IOR T2,[<CPRRED>B7+400]	;T2/<PROT>B7+<CONTIG>B17+400
  2177	002074'	201400	000001		MOVEI T3,1	;FILE PAGE NO.
  2178	002075'	200300	002730'		MOVE T1,[FNCMDP,,RUNCHN] ;FNC MAP DSK PAGES,,RUN CHANN
  2179	002076'	043300	000007		CHANIO T1,T2	;T2,T3 IS THE ARG BLOCK
  2180	002077'	254000	002133'		JRST MAPHSE	;RECOVER FROM ERROR
  2181	002100'	205200	020000		MOVSI F,ENTRB
  2182	002101'	413200	000000*		ANDCAB F,%UPT+UPTJDA+RUNCHN	;FIX F,ENTRB OFF IN BOTH
  2183	002102'	621340	776000		TLZ T2,(<377>B7)
  2184	002103'	661340	001665*		TLO T2,WS.ADD	;PUT PAGECOUNT PGS IN UWS
  2185	002104'	200300	002731'		MOVE T1,[XWD .WSRNG,T2]	;FROM 400 ON, WSCTL FUNCTION .WSRNG
  2186	002105'	047300	777704		WSCTL T1,
  2187					PUSHJ P, [HRRZS T1	;ERROR CODE
  2188						CAIE T1,WSATM%	;"ADDED TOO MUCH"?
  2189						 STOPCD		;BUG PROBABLY   ;;MAPHS1+many
  2190	002106'	260040	002721'			POPJ P,]	;OK TO IGNORE
  2191	002107'	260040	000000*		PUSHJ P,GETLI1		;GET T1/HI SEG FILE LICENSE
  2192	002110'	200441	000000		MOVE T4,0(P)		;CONTIG. PAGES FOR CHARGING
  2193	002111'	602300	000200		TRNE T1,LICXC		;XC LICENSE?
  2194	002112'	254000	002116'		  JRST NOCHRG		;YES. DON'T CHARGE FOR GET
  2195	002113'	272440	000000*		ADDM T4,JBTMPC		;SYSTEM MAPPED PAGE COUNT
  2196	002114'	272442	002113*		ADDM T4,JBTMPC(J)	;CHARGE THIS GUY
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 28-3
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2197	002115'	260040	000000*		PUSHJ P,CHGPWS##;TAKE T4. CHARGE FOR PUT IN WS. CLOB T1-T4
  2198	002116'	200400	002604'	NOCHRG:	MOVE T3,[<CPRRED>B7+1B17+400]	;FOR ADD1PG
  2199	002117'	262040	000007		POP P,T2	;CONTIG.
  2200	002120'	262040	000006		POP P,T1	;SIZE
  2201	002121'	271300	377777		ADDI T1,377777	;PROSPECTIVE JOBHRL
  2202	002122'	602300	001000		TRNE T1,1000	;SKIP IF NOT 1K BOUNDARY YET
  2203	002123'	664300	001777		TROA T1,1777	;IT'S OK, SKIP & SET JOBHRL
  2204	002124'	260040	002161'		PUSHJ P,ADD1PG	;RETURN T1/JOBHRL VALUE. TAKE T2/ T3/
  2205	002125'	256200	002745'		UMOVEM T1,JOBHRL	;CLEAR LH=1ST FREE,SET RH=HI ADDR
  2206	002126'	542300	000000*		HRRM T1,%UPT+UPTHRL
  2207	002127'	205300	001436*		MOVSI T1,SG.SWR	
  2208	002130'	306640	636762		CAIN P2,'SWR'	;IF .SWR FILE, FLAG THAT
  2209	002131'	436300	000000*		IORM T1,%UPT+UPTSTS	;IT IS, FOR SAVJOB & SETUWP UUO
  2210	002132'	254000	002031*		JRST CPOPJ1
  2211
  2212				;HERE IF CHANIO VMAP FAILS.
  2213
  2214	002133'	262040	000011	MAPHSE:	POP P,T4	;CONTIG, FORGET IT
  2215	002134'	262040	000011		POP P,T4	;SIZE. FORGET IT
  2216	002135'	205200	020000		MOVSI F,ENTRB
  2217	002136'	413200	000000*		ANDCAB F,%UPT+UPTJDA+RUNCHN	;ENTRB OFF IN F,MEMORY
  2218	002137'	550440	000006		HRRZ T4, T1	;ERROR CODE
  2219	002140'	302440	001707*		CAIE T4,FALLKO	;LOOKUP ONLY
  2220	002141'	306440	002032*		CAIN T4,FALCOR	;OVER CORE LIMIT
  2221	002142'	263040	000000		 POPJ P,
  2222	002143'	302440	001713*		CAIE T4,FALRBE	;RIB ERR
  2223	002144'	306440	001710*		CAIN T4,FALBDS	;BAD SAT
  2224	002145'	263040	000000		 POPJ P,
  2225	002146'	306440	001712*		CAIN T4,FALHOL	;HOLE IN FILE?
  2226	002147'	263040	000000		 POPJ P,
  2227	002150'	256000	002751'	MAPHSF:	 STOPCD (.,JOB,MAPHSF,PRTT1##,<Unexpected error from CHANIO VMAP>)
  2228
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 29
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2229				COMMENT @ SUBROUTINE ADJCOR
  2230				FUNCTION: COMPARE XPANEW (USERS NEW-CORE-SIZE ARG) WITH SIZE
  2231					OF THE HISEG PASSED IN T2, AND REDUCE XPANEW AS
  2232					FOLLOWS:
  2233					IF SIZE .LE. 0 THEN STOPCD   CALLER CONFUSED
  2234					IF XPANEW=0 THEN RETURN, USER DIDNOT SPECIFY NEWCORE
  2235					IF XPANEW>SIZE THEN XPANEW:=XPANEW-SIZE
  2236					ELSE RETURN
  2237				CALL:	MOVE T2,SIZE OF PROSPECTIVE HS TO BE READ IN/MAPPED IN
  2238						OR,
  2239					MOVE T2,SIZE OF EXISTING HISEG  (SAVE COMMAND)
  2240					MOVE PG, ADDR OF USER ARG BLOCK IN UPTPDL
  2241					PUSHJP,ADJCOR
  2242					RETURN HERE T1,T2 DESTROYED, XPANEW ADJUSTED DOWNWARD
  2243				RESTRICTIONS: DONT CALL IF SIZE(HISEG) OR SIZE(FILE)=0
  2244				IDIOSYNCRACIES:
  2245				@
  2246
  2247
  2248	002151'	337000	000007	ADJCOR:	SKIPG T2
  2249	002152'	256000	000000'		STOPCD                  ;;ADJCOR+1
  2250	002153'	550303	000046		HRRZ T1,XPANEW(PG)
  2251	002154'	322300	002033*		JUMPE T1,CPOPJ
  2252	002155'	313300	000007		CAMLE T1,T2	;SKIP IF XPANEW .LE. SIZE
  2253	002156'	274300	000007		SUB T1,T2
  2254	002157'	542303	000046		HRRM T1,XPANEW(PG)
  2255	002160'	263040	000000		POPJ P,
  2256
  2257				COMMENT @ SUBROUTINE ADD1PG
  2258
  2259				FUNCTION: FOR READHS,MAPHS. IF "SEGMENT" CREATED WAS
  2260					NOT AN EVEN NUMBER OF PAGES, ADD 1 MORE PAGE AT ITS
  2261					END, AND
  2262					RETURN T1/ JOBHRL VALUE TO SET
  2263
  2264				CALL:	MOVE T2,COUNT OF PAGES CURRENTLY IN THE "SEGMENT"
  2265					MOVE T3,<PROT>B7+1B17+BEGINNING PG NO OF SEGMENT
  2266					PUSHJ P,ADD1PG
  2267					RETURN HERE, T1/UPTHRL VALUE
  2268
  2269				ERROR EXIT: IF VCREAT FAILS, SET UP P4 FOR GTJBNR
  2270					(GET JOB NOROOM EXIT) AND JSP. PDL GETS FIXED THERE.
  2271
  2272				DESTROY: T2,T3,T4,W,PG
  2273				RETURNS: T1/ VALUE FOR UPT<REL/HRL>
  2274				RESTRICTIONS:CALL ONLY IF 1 MORE PG NEEDED. DONT USE FOR LOWSEG
  2275
  2276				@
  2277
  2278	002161'	200500	000010	ADD1PG:	MOVE W,T3
  2279	002162'	337000	000007		SKIPG T2	;GOTTA BE AT LEAST ONE PG
  2280	002163'	256000	000000'		 STOPCD		;CALLER CONFUSED        ;;ADD1PG+2
  2281	002164'	270500	000007		ADD W,T2	;W/<PROT>B7+1B17+NEW LAST PG IN SEG
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 29-2
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2282	002165'	047500	777711		VCREAT W,	;W/<PROT>B7+1B17,,PAGE#
  2283					  JRST [HLRZ P4,W	;FOR GTJBNR,FAILING VP#
  2284						LSH  P4,9	;WORDS
  2285						HRRZS W		;VCREAT ERROR
  2286						CAIE W,CRLIM%	;OVER CORE LIMITS?
  2287						CAIN W,CRDFL%	;OR NO DISK?
  2288						JSP T1,GTJBNR	;KILL MEMORY & SAY "XX PGS NEEDED"
  2289						 STOPCD 	;OTHER ERRORS IMPLY BUG ;;ADD1PG+5
  2290	002166'	254000	002755'	];WARNING: MACRO generates bad code if "]" immediately follows "STOPCD"
  2291	002167'	621500	776000		TLZ W,(<377>B7)
  2292	002170'	661500	002103*		TLO W,WS.ADD	;W/<ADD>B7+1B17+VP#
  2293	002171'	200300	002720'		MOVE T1,[XWD .WSRNG,W]
  2294	002172'	047300	777704		WSCTL T1,	;ADD TO WS BY RANGE
  2295	002173'	255000	000000		JFCL		;PROBABLY "ADDED TOO MUCH" ERROR.
  2296	002174'	550300	000012		HRRZ T1,W
  2297	002175'	242300	000011		LSH T1,9
  2298	002176'	435300	001777		IORI T1,1777
  2299	002177'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 30
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2300				COMMENT @ SUBROUTINES LSSIZE, HSSIZE
  2301				FUNCTION:	RETURN SIZE IN PAGES OF "LOWSEG" AND "HISEG"
  2302					FOR THE JOB WHOSE CONTEXT PAGES ARE MAPPED IN %UPT...
  2303				CALL:	MAP IN APPROPRIATE CONTEXT PGS
  2304					PUSHJ P,LSSIZE
  2305					OR
  2306					PUSHJ P,HSSIZE
  2307					SUCCESS RETURN  T2/NUMBER OF PAGES OR ZERO IF NONE
  2308				DESTROY: T2
  2309				RESTRICTIONS:
  2310
  2311				IDIOSYNCRACIES:  THE VALUE RETURNED IS THE PAGE NO. (RELATIVE TO 0 OR 400) OF
  2312					THE HIGHEST PAGE IN THE "SEGMENT".  IF IT HAS HOLES,
  2313					THEN THE VALUE RETURNED IS NOT REALLY THE SIZE OF THE
  2314					SEGMENT
  2315
  2316				@
  2317
  2318	002200'			LSSIZE::
  2319	002200'	550340	000000*		HRRZ T2,%UPT+UPTREL
  2320	002201'	242340	777767		LSH T2,-9
  2321	002202'	263040	000000		POPJ P,
  2322
  2323	002203'			HSSIZE::
  2324	002203'	336340	000000*		SKIPN T2,%UPT+UPTHRL
  2325	002204'	263040	000000		POPJ P,			;RET T2/0
  2326	002205'	553000	000007		HRRZS T2
  2327	002206'	242340	777767		LSH T2,-9
  2328	002207'	275340	000377		SUBI T2,377
  2329	002210'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 31
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2330				COMMENT @ SUBROUTINE HSEXIS
  2331
  2332				FUNCTION:	SKIP IF HISEG DOES NOT EXIST FOR THIS USER.
  2333					WHAT THIS MEANS IS: DO NOT  SKIP IF USER CREATED A SET
  2334					OF PAGES IN THE RANGE 400-777 VIA A REMAP,RUNSEG OR
  2335					GETSEG UUO, OR BY RUN OR GET CMD ON A .HGH OR .SHR FILE.
  2336
  2337				RESTRICTIONS:  CALL ONLY WHEN CONTEXT PAGES FOR JOB IN QUESTION
  2338					ARE MAPPED IN %UPT..
  2339
  2340				DESTROYS: T1
  2341				CALL:	PUSHJ P,HSEXIS
  2342					RETURN HISEG EXISTS
  2343					RETURN HISEG DOES NOT EXIST
  2344
  2345				@
  2346
  2347	002211'			HSEXIS::
  2348	002211'	550300	000000*		HRRZ T1,%UPT+UPTHRL
  2349	002212'	326300	002154*		JUMPN T1,CPOPJ
  2350	002213'	254000	002132*		JRST CPOPJ1
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 32
SEGCON.MAC	28-OCT-87 00:02		HI AND LOW "SEGMENT" GETTERS

  2351				COMMENT @ SUBROUTINE REPDP
  2352
  2353				FUNCTION: RESET PDL POINTER AS IT WAS BEFORE GTUARG OR SG1 WAS CALLED;
  2354					IE, BEFORE THE USER ARG BLOCK WAS SET UP FOR REFERENCE
  2355					BY XPAXXX(PG).
  2356				EXPECTS: (PG) POINTING AT 0TH WORD OF ARG BLOCK
  2357				CALL:	JSP T1,REPDP
  2358					ALWAYS RETURNS HERE. T1 PRESERVED,PG DESTROYED
  2359				@
  2360
  2361	002214'	200040	000003	REPDP:	MOVE P,PG
  2362	002215'	202301	777777		MOVEM T1,-1(P)	;OVERWRITE THE PUSHJ P,GTUARG CALL
  2363	002216'	262040	000003		POP P,PG	;GET XPADEV,CLOBBER PG
  2364	002217'	263040	000000		POPJ P,
  2365
  2366				COMMENT @ SUBROUTINE INIJDA - INIT JOB DATA AREA.
  2367
  2368				FUNCTION: FOR RUNUUO,RUN/GET CMDS, MOVE VESTIGIAL
  2369					JOBDAT DOWN.
  2370				CALL:	PUSHJ P,INIJDA
  2371					ALWAYS RETURN HERE
  2372				DESTROY: T1,T2
  2373				RESTRICTION: USE WHEN PAGE 0 EXISTS AND "HISEG" EXISTS
  2374					USE ONLY WHEN PREVIOUS CONTEXT = USER SPACE (PC.UIO )
  2375				@
  2376
  2377				PRINTF(<[INIJDA: Page 400 (locations 400000 and 377777) hardcoded in GET]>)
  2378	002220'			INIJDA:
  2379	002220'	205300	001126*		MOVSI T1,JOBSV		;CLEAR JOB DATA AREA
  2380	002221'	541300	000001*		HRRI T1,JOBSV+1		;WHERE IO WOULD BE DONE INTO
  2381	002222'	256200	002764'		XCTTU <SETZM JOBSV>	;IF A LOW FILE EXISTS
  2382	002223'	256240	002765'		XCTBU <BLT T1,JOBDA-1> ;DO THIS IN CASE THERE IS NO LOW FILE
  2383	002224'	256200	002766'		XCTTU <SETZM JOBDDT>	;ALSO CLEAR DDT STARTING ADDRESS
  2384	002225'	561300	400000*		HRROI T1,JOBPOP+400000	;ABSOLUTE ADDRESS OF HIGH SEG(LH=-1 FOR
  2385								; POPS SO NO PDL UNDERFLOW)
  2386	002226'	256240	002767'		XCTBU <POP T1,JOBVER>	;RESTORE BOTH HALVES OF PROG. VERSION NO.
  2387	002227'	256040	002770'		XCTFU <POP T1,T2>		;RESTORE
  2388	002230'	256200	002771'		XCTBU <HLLM T2,JOBHRL> ; 1ST FREE LOC IN HISEG,REL TO 400000
  2389	002231'	256200	002772'		XCTBU <HRRZM T2,JOBREN> ;PROGRAM REENTER ADR, LH=0
  2390								; SAVED FOR FUTURE USE
  2391	002232'	256240	002773'		XCTBU <POP T1,JOBCOR> ;HIGHEST DATA LOC IN LOW SEG(LH)
  2392								; AMOUNT OF CORE IN RH TO BE ASSIGNED(#K-1)
  2393	002233'	256240	002774'		XCTBU <POP T1,JOB41>	;USER M HANDLER JSR
  2394	002234'	256240	002775'		XCTBU <POP T1,JOBSA>	;FIRST FREE LOC IN LOW SEG(LH), START COMMAND
  2395								; STARTING ADDRESS(RH)
  2396	002235'	263040	000000		POPJ P,
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 33
SEGCON.MAC	28-OCT-87 00:02		REMAP

  2397				SUBTTL REMAP
  2398				COMMENT @ UREMAP - KERNEL OF REMAP UUO
  2399
  2400				FUNCTION: EMULATE THE FUNCTION OF THE OLD PRE-VM SYSTEM REMAP
  2401					UUO AS CLOSELY AS POSSIBLE. DIFFERENCES:
  2402				1) THE OLD LOWSEG CAN BE DAMAGED AND PARTIALLY GONE
  2403				   BEFFORE THE REMAP IS COMPLETE.
  2404				2) THIS REMAP WILL NOT FAIL-RETURN TO THE USER ON ERROR
  2405				   IF ANY CHANGE HAS BEEN MADE TO VM SPACE AT OR ABOVE
  2406				   HIS CALLING PC VALUE
  2407
  2408				DESTROYS: T1-T4,P1-P4,F,S,
  2409				EXPECTS: PROPER LMAP MAPPED, J/JOB, T1/REQUESTED NEW TOP OF LOWSEG
  2410				RESTRICTIONS: THIS ROUTINE WRITES ON PREVIOUS CONTEXT AT JOBREL
  2411					AND JOBHRL. DON'T CALL FROM EXEC IF PC.UIO=0
  2412				@
  2413
  2414
  2415	002236'			UREMAP::
  2416	002236'	321300	002212*		JUMPL T1,CPOPJ
  2417	002237'	435300	001777		IORI T1,1777
  2418	002240'	307300	377777		CAIG T1,400000-1
  2419	002241'	256200	002552'		XCTBU <CAMLE T1,JOBREL>
  2420	002242'	263040	000000		POPJ P,
  2421	002243'	200600	000006		MOVE P1,T1
  2422	002244'	201200	000000		MOVEI F,0	;FLAGS. 1B35=0 SAYS NO CHANGE TO VM SPACE
  2423	002245'	260040	002211'		PUSHJ P,HSEXIS	;SKIP IF NO HISEG. THIS IS IMPORTANT.
  2424						;PAGES MAY EXIST ABOVE 400 AS PART OF "LOWSEG"
  2425						;BEING REMAPPED. KILL ONLY "HISEG" PAGES.
  2426					PUSHJ P,[TRO F,1	;FLAG CHANGE MADE VM SPACE
  2427	002246'	260040	002776'			PJRST KILLHS]
  2428	002247'	256200	003000'		XCTBU <HRRZ P4,JOBREL>
  2429	002250'	316600	000017		CAMN P1,P4
  2430	002251'	263040	000000		POPJ P,		;FAIL RET W/OLD HISEG GONE
  2431	002252'	211000	000001		MOVNI S,1	;SETUP S AS FLAG: IF REQUEST=377777
  2432	002253'	306600	377777		CAIN P1,377777	;THEN NO NEED TO REPLICATE PAGES, JUST
  2433	002254'	201000	000000		MOVEI S,0	;MAKE THEN RDO WHERE THEY ARE.
  2434	002255'	661200	400000		TLO F,(1B0)	;FLAG IN F: IF LOWSEG>128K & REQ<377777,
  2435	002256'	303740	377777		CAILE P4,377777	;THEN TOP PART OF LOWSEG WILL BE IN THE
  2436	002257'	301600	377777		CAIL P1,377777	;WAY FOR LAST FEW REPLICATES. MUST VREMOV
  2437	002260'	254000	002262'		JRST .+2	;PAGES ONE AT A TIME AS THEY ARE REPLICATED
  2438	002261'	621200	400000		TLZ F,(1B0)	;OTHERWISE CAN VREMOV ALL IN ONE CALL AT END
  2439	002262'			UREMP2:	;SAVE PVYCOR USER MAX CORE SIZE AND SET TO MAX
  2440					;SO REPLICATES DONT GO OVER MAX CORE.
  2441					;CHECK OUT HISEG SIZE, & SET UP FOR REPLICATE LOOP
  2442	002262'	261042	002063*		PUSH P,JBTPRV(J)	;SAVE HIS PVYCOR & STUFF
  2443	002263'	201300	000177		MOVEI T1,177		;CAN HAVE 255K DURING REMAP
  2444	002264'	137300	001643*		DPB T1,PVYCOR##
  2445	002265'	242740	777767		LSH P4,-9	;PAGE NO. LAST PG TO REMAP
  2446	002266'	551714	000001		HRRZI P3,1(P1)
  2447	002267'	242700	777767		LSH P3,-9	;PAGE NO. 1ST PG TO REMAP (REQ+1)LSH -9
  2448	002270'	275756	000400		SUBI P4,400(P3)	;PROSPECTIVE HISEG>400000 WORDS?
  2449	002271'	327740	002344'		JUMPG P4,URMPFX	;YES. ILLEGAL
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 33-2
SEGCON.MAC	28-OCT-87 00:02		REMAP

  2450	002272'	271756	000400		ADDI P4,400(P3)	;RESTORE P4
  2451					JUMPE S,[ SUB P4,P3	;COUNT OF PAGES MOVED
  2452						HRLZI T2,1(P4)	;CONTIG. PG. COUNT FOR VPROT
  2453						HRR T2,P3
  2454						TLO T2,(<CPRRED>B7)
  2455						VPROT T2,	;SET RDO PROT ON PGS 400->END
  2456						JRST URMPFX
  2457	002273'	322000	003001'			JRST UREMP7]	;FINISH UP
  2458	002274'	201300	000007		MOVEI T1,T2	;POINT AT ARG BLOCK T2:T3
  2459	002275'	200400	000017		MOVE T3,P4	;FOR T3_LAST(P4) STEP -1 UNTIL FIRST(P3)
  2460						;REPLICATE(SOURCE=T3,PROT=RDO,DEST=400+T3-P3)
  2461						;IF (F=0) THEN VREMOV(PAGE=SOURCE PAGE=T3)
  2462						;ELSE WAIT TO DO REMOV'S UNTIL LOOP DONE
  2463						;DONE LOOP
  2464	002276'	550340	000010	UREMP3:	HRRZ T2,T3
  2465	002277'	271340	000400		ADDI T2,400
  2466	002300'	274340	000016		SUB T2,P3
  2467	002301'	661340	002001		TLO T2,(<CPRRED>B7+1B17)	;T2/<PROT>B7+1B17,,DEST. VP#
  2468	002302'	047300	777714		VREPL T1,	;T3/SOURCE VP#.  T1/ ARG BLOCK
  2469	002303'	254000	002344'		JRST URMPFX
  2470	002304'	660200	000001		TRO F,1		;FLAG THAT VM SPACE CHANGED
  2471	002305'	321200	002312'	UREMP4:	JUMPL F,UREMP5	;F/1B0 IF DONT NEED TO VREMOVE PAGE AT A TIME
  2472	002306'	550340	000010		HRRZ T2,T3
  2473	002307'	661340	000001		TLO  T2,1	;T2/<COUNT=1>,,VP#
  2474					;TLO T2,(1B7)	;NO CLR REF BIT
  2475	002310'	047340	777713		VREMOV T2,
  2476	002311'	254000	002344'		JRST URMPFX
  2477	002312'	275400	000001	UREMP5:	SUBI T3,1	;STEP -1
  2478	002313'	311400	000016		CAML T3,P3	;UNTIL P3
  2479	002314'	254000	002276'		JRST UREMP3
  2480	002315'	274740	000016		SUB P4,P3	;COUNT OF PAGES MOVED
  2481	002316'	515357	000001		HRLZI T2,1(P4)	;CONTIGUOUS PG CT FOR VREMOV
  2482	002317'	540340	000016		HRR T2,P3	;START VP#
  2483	002320'	325200	002323'		JUMPGE F,UREMP6	;JUMP IF WE ALREADY DID THE VREMOVS
  2484					;TLO T2,(1B7)	;NO CLR REF BIT
  2485	002321'	047340	777713		VREMOV T2,
  2486	002322'	254000	002344'		JRST URMPFX
  2487	002323'	541340	000400	UREMP6:	HRRI T2,400	;<CONTIG>,,START VP#
  2488	002324'	661340	002170*		TLO T2,WS.ADD	;ADD-TO-UWS BIT
  2489	002325'	200300	002731'		MOVE T1,[XWD .WSRNG,T2]	;ADD TO WS BY RANGE
  2490	002326'	047300	777704		WSCTL T1,
  2491					PUSHJ P, [HRRZS T1	;ERROR CODE
  2492						CAIN T1,WSATM%	;"ADDED TOO MUCH"?
  2493						POPJ P,		;OK TO IGNORE
  2494						STOPCD		;BUG IN UREMAP  ;;UREMP6+5
  2495	002327'	260040	003010'	];WARNING: MACRO generates bad code if "];;" immediately follows "STOPCD"
  2496
  2497				;FROM UREMP2 TO UREMP7 JBTPRV(J) IS SAVED ON PDL. RESTORE
  2498				;IT, SET JOBHRL & UPTHRL ETC.
  2499
  2500	002330'	262042	002262*	UREMP7:	POP P,JBTPRV(J)
  2501	002331'	242740	000011		LSH P4,9	;WORDS. SIZE NEW HISEG
  2502	002332'	435740	400777		IORI P4,400000+777;NEW LAST HISEG ADDR
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 33-3
SEGCON.MAC	28-OCT-87 00:02		REMAP

  2503	002333'	260040	001565*		UXCTBU  <HRRM P4,JOBHRL>	;SET RH; LH= 1ST FREE IN HS, LEAVE ALONE
  2504	002334'	256200	003014'
  2505	002335'	542740	000000*		HRRM P4,%UPT+UPTHRL	;AND SYSTEM'S COPY
  2506	002336'	260040	002333*		UXCTTU  <MOVEM P1,JOBREL>	;KEEP LH JOBREL CLEAR
  2507	002337'	256200	003015'
  2508	002340'	542600	000000*		HRRM P1,UPTREL+%UPT
  2509	002341'	205300	002127*		MOVSI T1,SG.SWR		;CLEAR THE "SWR" SEGMENT STATUS
  2510	002342'	412300	000000*		ANDCAM T1,%UPT+UPTSTS	;BIT. THIS SEG CREATED BY REMAP
  2511	002343'	254000	002213*		JRST CPOPJ1
  2512
  2513	002344'			URMPFX:	;HERE IF SOME VUUO FAILED,ETC. F/1B35 SET IF ANYTHING
  2514					;DONE TO VM SPACE. (IE.,KILLHS,VREPL,VREMOV)
  2515					;P1/REQUESTED JOBREL=ADDRESS AT WHICH WE BEGAN DIDDLING VM SPACE
  2516					;0(P)/ SAVED JBTPRV, WITH PVYCOR
  2517
  2518	002344'	262042	002330*		POP P,JBTPRV(J)
  2519	002345'	550300	000000*		HRRZ T1,%UPT+UPTPDL	;USERS CALLING PC
  2520	002346'	602200	000001		TRNE F,1
  2521	002347'	317300	000014		CAMG T1,P1		;IF CALLERS PC ABOVE REQUEST AND
  2522	002350'	263040	000000		POPJ P,
  2523	002351'	324740	000000*		PJRST ERRRMF	;REMAP UUO FAILURE
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 34
SEGCON.MAC	28-OCT-87 00:02		RUNSEG/GETSEG

  2524				SUBTTL RUNSEG/GETSEG
  2525
  2526				COMMENT ! URUNHI -- KERNEL OF RUNSEG UUO
  2527					  UGETHI -- KERNEL OF GETSEG UUO
  2528				FUNCTION: CALLED LIKE RUNUUO. REPLACE ANY EXISTING PAGES
  2529					IN HISEG (ANY PAGES WHATSOEVER IN 400-777) WITH
  2530					THE CORE IMAGE LIVING IN THE FILE NAMED BY THE
  2531					USER. IGNORE THE USER'S EXTENSION: SEARCH FOR
  2532					FN.SHR, FH.HGH, FINALLY FN.SWR. IF NONE OF THESE
  2533					FOUND, FRETURN. IF ONE IS FOUND, MAP IT IN UNLESS
  2534					IT'S ON MAGTAPE, IN WHICH CASE READ IT IN.
  2535
  2536					FOR GETSEG, RETURN AFTER VM SET UP. FOR RUNSEG,
  2537					INITIALIZE SOME OF JOBDAT FROM VESTIGIAL JOBDAT,
  2538					SETUP EXO,LICENSE AND WRITE ACT RECORD, RESET
  2539					TRAPS, AND RUN HIM FROM JOBSA FROM THE VESTIG. JOBDAT.
  2540
  2541				DESTROYS: MOST AC'S
  2542				EXPECTS: J/JOB, T1/USER ADDR INCR,,ARG BLK ADDR
  2543
  2544				IDIOSYNCRACIES: DESTROYS OLD HISEG BEFORE NEW ONE READ
  2545					IN (UNLIKE PRE-VM SYSTEM). NO RETURN TO USER IF
  2546					ERROR OCCURS AFTER OLD HISEG REMOVED.
  2547
  2548				!
  2549
  2550	002352'			URUNHI::
  2551	002352'	350000	000004'		AOS RNSGCT		;KEEP TRACK OF RUNSEG'S DONE
  2552	002353'	260040	000060'		PUSHJ P,GTUARG	;PUT USER ARGS IN PDL, SETUP PG
  2553	002354'	202642	001213*		MOVEM P2,JBTNAM(J)
  2554	002355'	205200	000010		MOVSI F,GETB
  2555	002356'	254000	002362'		JRST RNGT0	;COMMON CODE
  2556
  2557	002357'			UGETHI::
  2558	002357'			UGTSEG::
  2559	002357'	350000	000005'		AOS GTSGCT		;KEEP TRACK OF GETSEG'S DONE
  2560	002360'	260040	000060'		PUSHJ P,GTUARG
  2561	002361'	201200	000000		MOVEI F,0	;NO GETB. USER MUST HAVE READ ACCESS TO
  2562							;FILE FOR GETSEG TO WORK
  2563
  2564				PRINTF(<[UGTSEG: Page 400 (locations 400000 and 377777) hardcoded in GETSEG]>)
  2565
  2566	002362'			RNGT0:	;COMMON RUNSEG/GETSEG CODE.
  2567	002362'	256200	003016'		XCTBU <HRRZ T4,JOBREL>
  2568	002363'	301440	400000		CAIL T4,400000	;IF HE ALREADY HAS >128K LOWSEG,
  2569	002364'	254000	002455'		JRST NORMFX	;CANT DO RUN/GETSEG
  2570	002365'	607200	000010		TLNN F,GETB	;SKIP IF RUNSEG
  2571	002366'	254000	002374'		JRST RNGT1
  2572	002367'	200302	002344*		MOVE T1,JBTPRV(J)	;IF CURRENTLY EXECUTE-ONLY,
  2573	002370'	602300	400000		TRNE T1,PVEXO		;MAKE SURE NEXT PROGRAM IS
  2574	002371'	664300	004000		TROA T1,PVEXOG		;EXECUTE ONLY ALSO
  2575	002372'	620300	004000		TRZ T1,PVEXOG
  2576	002373'	202302	002367*		MOVEM T1,JBTPRV(J)
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 34-2
SEGCON.MAC	28-OCT-87 00:02		RUNSEG/GETSEG

  2577	002374'			RNGT1:
  2578	002374'	260040	000206'		PUSHJ P,SETOPN	;SETUP T1-T3
  2579	002375'	050000	000006		OPEN RUNCHN,T1
  2580	002376'	254000	000510'		JRST SGERRA	;HANDLES RET TO USER/CMD LEVEL
  2581	002377'	437200	000000*		IORB F,%UPT+UPTJDA+RUNCHN	;SET GETB RUNSEG ONLY
  2582	002400'	205300	635062		MOVSI T1,'SHR'	;BEGIN SEARCH SEQ
  2583	002401'	260040	000443'		PUSHJ P,DOLOOK
  2584					 JRST [	MOVSI T1,'HGH'
  2585						PUSHJ P,DOLOOK
  2586						 JRST [	MOVSI T1,'SWR'
  2587							PUSHJ P,DOLOOK
  2588							JRST NOFILE
  2589							JRST RNGT2]
  2590	002402'	254000	003023'			JRST RNGT2]
  2591	002403'			RNGT2:	;HERE P2,P3,P4 ARE RETURNED BY DOLOOK P4/SIZE IN WORDS
  2592	002403'	260040	001264*		PUSHJ P,TIMADJ##	;NEW SPACE-TIME INTEGRAL. NO AC CLOB
  2593	002404'	260040	001563'		PUSHJ P,KILLHS	;NO MEM ABOVE 400 ON RETURN
  2594	002405'	205300	002341*		MOVSI T1,SG.SWR
  2595	002406'	412300	000000*		ANDCAM T1,%UPT+UPTSTS
  2596	002407'	550300	000000*		HRRZ T1,%UPT+UPTPDL	;USER'S CALLING PC
  2597	002410'	301300	400000		CAIL T1,400000		;IF FROM JUST-DELETED HISEG,
  2598	002411'	553000	000000*		HRRZS %UPT+UPTPDL	;NO FRETURN TO USER. PC.USR_0
  2599	002412'	200304	000004		MOVE T1,DEVMOD(F)	;F SETUP FROM IORB ABOVE
  2600	002413'	603300	000020		TLNE T1,DVMTA	;IF MAGTAPE, READ PAGES
  2601					JRST [	PUSHJ P,READHS	;USING INPUT UUO
  2602						JRST RNGT3	;SUCCESS
  2603	002414'	254000	003027'			PJRST ERRMGF]	;MAGTAPE GET FAILURE
  2604	002415'	260040	002032'		PUSHJ P,MAPHS		;MAP THE PAGES
  2605	002416'	254000	002451'		JRST RNGTF0		;TROUBLE
  2606	002417'			RNGT3:	;SUCCESS..NEW CORE IMAGE GOTTEN
  2607	002417'	607200	000010		TLNN F,GETB		;IF GETSEG,
  2608					JRST [	JSP T1,REPDP	;FIX PDL,
  2609						PUSHJ P,SGREL	;RELEASE RUNCHN
  2610						MOVSI T1,PC.USR
  2611						IORM T1,%UPT+UPTPDL	;(IN CASE WAS TURNED OFF)
  2612	002420'	254000	003032'			JRST CPOPJ1]	;SRETURN TO USER.
  2613	002421'	260040	001327*		PUSHJ P,GETLIC##;TAKES F. GET T1/..,,FILE LIC
  2614	002422'	334000	000000		SKIPA		;DSK RTN
  2615	002423'	201300	000000		MOVEI T1,0	;MAG TAPE RTN
  2616	002424'	506303	000047		HRLM T1,XPALIC(PG)	;
  2617	002425'	205300	000002		MOVSI T1,HSLIC
  2618	002426'	436303	000000		IORM T1,XPAMOD(PG)
  2619	002427'	200303	000042		MOVE T1,XPAPID(PG)	;GET PID, IF ANY, FROM HS FILE
  2620	002430'	202303	000050		MOVEM T1,XPAHPD(PG)	;PUT WHERE GTJBFN WANTS IT
  2621	002431'	260040	001407'		PUSHJ P,GTJBFN
  2622	002432'	561340	400000*		HRROI T2,JOBPOP+400000	;MOVE VESTIGIAL JOBDAT DOWN
  2623	002433'	256240	003037'		XCTBU <POP T2,JOBVER>
  2624	002434'	256040	003040'		XCTFU <POP T2,T1>
  2625	002435'	256200	003041'		XCTBU <HRRZM T1,JOBREN>
  2626	002436'	256240	003042'		XCTBU <POP T2,JOBCOR>
  2627	002437'	256240	003043'		XCTBU <POP T2,JOB41>
  2628	002440'	256040	003040'		XCTFU <POP T2,T1>	;LEAVE JOBFF ALONE
  2629	002441'	256200	003044'		XCTBU <HRRM T1,JOBSA>	;IN LH OF JOBSA
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 34-3
SEGCON.MAC	28-OCT-87 00:02		RUNSEG/GETSEG

  2630	002442'	256200	002766'		XCTBU <SETZM JOBDDT>
  2631	002443'	201300	000000		MOVEI T1,0
  2632	002444'	260040	000000*		PUSHJ P,APRENB##	;RESET TRAPS
  2633	002445'	200302	001232*		MOVE	T1,JBTSTS(J)
  2634	002446'	620300	200400		TRZ	T1,WAKFLG+EXCFLG	;RESET WAKE AND EXIT IN CHILD
  2635	002447'	202302	002445*		MOVEM	T1,JBTSTS(J)	; INTERRUPT PENDING FLAGS
  2636	002450'	254000	001216'		JRST RNSEG	;GO START HIM UP
  2637
  2638	002451'			RNGTF0:	;MAPHS FAILED. T4/CODE
  2639	002451'	302440	002141*		CAIE T4,FALCOR	;OVER CORE LIMIT
  2640	002452'	254000	000436'		JRST MAPIOF	;GIVE POPJ TRNERR CODE TO USER OR
  2641							;RETURN TO CMD LEVEL IF PC.USR OFF, WITH
  2642							;MSG "TRANS. ERROR".
  2643	002453'	200440	000017		MOVE T4,P4	;SIZE RETURNED BY DOLOOK
  2644	002454'	260040	001563'		PUSHJ P,KILLHS	;ZAP ANY PORTION OF HISEG GOTTEN,
  2645	002455'			NORMFX:
  2646					;JSP T1,REPDP
  2647	002455'	261040	000011		PUSH P,T4	;NOROOM EXPECTS THIS
  2648	002456'	265300	000502'		JSP T1,NOROOM	;AND SAY "XX PAGES NEEDED"
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO

  2649				SUBTTL SETUWP UUO
  2650				COMMENT @ USTUWP - KERNEL OF SETUWP
  2651				FUNCTION: SET PROT ON ALL HISEG PAGES (ANY PAGES BETWEEN
  2652					400 AND UPTHRL) TO READ-ONLY (USER ARG NON-ZERO) OR
  2653				COPY-ON-WRITE (USER ARG 0) OR READ-WRITE (USER ARG 0
  2654				AND SEGNEMT WAS MAPPED FROM A 'SWR' FILE.
  2655
  2656
  2657				EXPECTS: T1/ARG (0:SET RDW   1:SET RDO)
  2658					J/JOB    M/USER AC#
  2659				DESTROYS: T1-T4,P1
  2660				RESTRICTIONS:
  2661				@
  2662
  2663	002457'			USTUWP::
  2664	002457'	200600	000006		MOVE P1,T1	;USERS ARG
  2665	002460'	260040	002211'		PUSHJ P,HSEXIS	
  2666	002461'	254000	002464'		JRST USTUW0	;HS EXISTS
  2667	002462'	350001	000000		AOS (P)		;GIVE SKIP RTN
  2668	002463'	254000	000000*		JRST RTZER##	;NONE,GIVE OK RETURN WITH 0
  2669							;AS PREVIOUS UWP SETTING
  2670
  2671				PRINTF(<[USTUWP: Page 400 (locations 400000 and 377777) hardcoded in SETUWP]>)
  2672
  2673	002464'	201340	000400	USTUW0:	MOVEI T2,400
  2674	002465'	047340	777707		PAGSTS T2,
  2675	002466'	256000	000000'		 STOPCD		;NOT SUPPOSED TO HAPPEN         ;;USTUW0+2
  2676	002467'	405340	000000*		ANDI T2,PS.CPR	;STATUS OF PG 400 CUR PROT ONLY
  2677	002470'	301340	000002		CAIL T2,CPRCOW
  2678	002471'	634340	000007		TDZA T2,T2
  2679	002472'	201340	000001		MOVEI T2,1
  2680	002473'	256200	003045'		UMOVEM T2,(M)	;RETURN (IF CPRRED THEN 1 ELSE 0) TO USER
  2681	002474'	260040	002203'		PUSHJ P,HSSIZE	;RETURN T2/PAGES IN HISEG
  2682	002475'	517000	000007		HRLZS T2
  2683	002476'	200400	002744'		MOVE T3,[<CPRRED>B7+400]
  2684	002477'	326600	002505'		JUMPN P1,USTUW1	;WANTS RDO
  2685	002500'	200300	000000*		MOVE T1,%UPT+UPTSTS
  2686	002501'	201400	000400		MOVEI T3,400
  2687	002502'	607300	002405*		TLNN T1,SG.SWR
  2688	002503'	665400	004000		TLOA T3,(<CPRCOW>B7)	;COW IF HGH OR SHR FILE
  2689	002504'	661400	006000		TLO  T3,(<CPRRDW>B7)	;RDW IF SWR FILE
  2690	002505'	434340	000010	USTUW1:	IOR T2,T3	;T2/<PROT>B7+<CONTIG>B17+400
  2691	002506'	047340	777710		VPROT T2,
  2692	002507'	334000	000000		SKIPA
  2693	002510'	254000	002343*		JRST CPOPJ1	;SUCCESS
  2694	002511'	200440	000007	USTUW2:	MOVE T4,T2	;SAVE VPROT ERROR CODE
  2695	002512'	260040	002203'		PUSHJ P,HSSIZE
  2696	002513'	517000	000007		HRLZS T2
  2697	002514'	434340	002744'		IOR T2,[<CPRRED>B7+400]	;MAKE HISEG RDO AGAIN
  2698	002515'	047340	777710		VPROT T2,
  2699	002516'	255000	000000		JFCL		;IFNORE FAILURES
  2700	002517'	550300	000011		HRRZ T1,T4	;ORIGINAL VPROT ERROR CODE
  2701	002520'	302300	000000*		CAIE T1,PTPRF%	;PROT EXCEEDS ALLOWABLE
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-2
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO

  2702	002521'	306300	000000*		CAIN T1,PTNVP%	;NON-EXISTENT VP (USER MAY HAVE VREMOVED ONE)
  2703	002522'	263040	000000		 POPJ P,
  2704	002523'	256000	000000'	USTUW3:	 STOPCD		;OTHER ERROR IMPLIES BUG
  2705
  2706	002524'	200253	000000		$END	(SEG)

  2707	002525'	200653	000001

  2708	002526'	200613	000002

  2709	002527'	200453	000004

  2710	002530'	200413	000005

  2711	002531'	200711	000000

  2712	002532'	200751	000001

  2713	002533'	513000	000000*

  2714	002534'	000052	000052

  2715	002535'	200353	000000

  2716	002536'	777772	000106'

  2717	002537'	200246	000000

  2718	002540'	200246	000001

  2719	002541'	777772	000157'

  2720	002542'	000051	000051

  2721	002543'	400000	000000

  2722	002544'	000000	000000

  2723	002545'	261040	002544'

  2724	002546'	265300	000502'

  2725	002547'	400001	777777

  2726	002550'	200300	000000*

  2727	002551'	336000	000000*

  2728	002552'	313300	000000*

  2729	002553'	200300	002552*

  2730	002554'	331103	000006
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-3
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO


  2731	002555'	550300	002553*

  2732	002556'	550300	002533*

  2733	002557'	542300	002556*

  2734	002560'	270400	000013

  2735	002561'	554347	000000

  2736	002562'	202313	000000

  2737	002563'	510300	000000*

  2738	002564'	332000	002551*

  2739	002565'	506340	002563*

  2740	002566'	006001	000400

  2741	002567'	004001	000400

  2742	002570'	777700	377777

  2743	002571'	261300	000000*

  2744	002572'	261300	000000*

  2745	002573'	261300	002557*

  2746	002574'	540340	000000*

  2747	002575'	500340	002565*

  2748	002576'	261300	000007

  2749	002577'	261300	000000*

  2750	002600'	261300	000014

  2751	002601'	000400	000000

  2752	002602'	000000	000000

  2753	002603'	261300	002601'

  2754	002604'	002001	000400

  2755	002605'	377777	000000

  2756	002606'	514300	000000*

SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-4
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO

  2757	002607'	274300	002605'

  2758	002610'	254000	000675'

  2759	002611'	635062	000000

  2760	002612'	504750	000000

  2761	002613'	554440	002573*

  2762	002614'	200300	002572*

  2763	002615'	202300	000000*

  2764	002616'	402000	000000*

  2765	002617'	402000	000000*

  2766	002620'	200300	002564*

  2767	002621'	202300	001121*

  2768	002622'	550400	002571*

  2769	002623'	336007	000000

  2770	002624'	261307	000000

  2771	002625'	206605	000000

  2772	002626'	202406	777777

  2773	002627'	400000	400000

  2774	002630'	402006	000000*

  2775	002631'	200340	002613*

  2776	002632'	202346	000000*

  2777	002633'	331300	002220*

  2778	002634'	200346	000000

  2779	002635'	250346	000000

  2780	002636'	550306	000000

  2781	002637'	402014	777777

  2782	002640'	251606	000000

  2783	002641'	550606	000000
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-5
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO


  2784	002642'	554646	000000

  2785	002643'	402006	000000

  2786	002644'	262314	000000

  2787	002645'	402006	000001

  2788	002646'	250640	002621*

  2789	002647'	202640	002620*

  2790	002650'	542340	002575*

  2791	002651'	000001	000000

  2792	002652'	200313	000000

  2793	002653'	270340	002622*

  2794	002654'	205300	636762

  2795	002655'	260040	000443'

  2796	002656'	254000	000514'

  2797	002657'	254000	001263'

  2798	002660'	336303	000045

  2799	002661'	205300	000734*

  2800	002662'	260040	000443'

  2801	002663'	254000	002654'

  2802	002664'	254000	001263'

  2803	002665'	205300	504750

  2804	002666'	260040	000443'

  2805	002667'	254000	002660'

  2806	002670'	254000	001263'

  2807	002671'	260040	002151'

  2808	002672'	254000	001303'

  2809	002673'	200300	002615*

SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-6
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO

  2810	002674'	202300	002614*

  2811	002675'	306440	002451*

  2812	002676'	254000	001403'

  2813	002677'	254000	000436'

  2814	002700'	554340	002631*

  2815	002701'	260040	001563'

  2816	002702'	254000	000514'

  2817	002703'	000000*	000001*

  2818	002704'	402006	777777

  2819	002705'	251300	000777

  2820	002706'	550340	002700*

  2821	002707'	552740	002555*

  2822	002710'	260040	000000*

  2823	002711'	200403	000050

  2824	002712'	312403	000042

  2825	002713'	402003	000042

  2826	002714'	254000	001434'

  2827	002715'	777777	777000

  2828	002716'	262040	000006

  2829	002717'	263040	000000

  2830	002720'	000000*	000012

  2831	002721'	553000	000006

  2832	002722'	302300	000000*

  2833	002723'	256000	000000'

  2834	002724'	263040	000000

  2835	002725'	552300	002707*

  2836	002726'	402000	002650*
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-7
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO


  2837	002727'	202300	002725*

  2838	002730'	000035	000000

  2839	002731'	000000*	000007

  2840	002732'	251307	000000

  2841	002733'	554340	400000*

  2842	002734'	550300	400000*

  2843	002735'	554340	400000*

  2844	002736'	072000	000016

  2845	002737'	254000	002026'

  2846	002740'	262040	000006

  2847	002741'	254000	002025'

  2848	002742'	262040	000006

  2849	002743'	254000	002024'

  2850	002744'	002000	000400

  2851	002745'	202300	002726*

  2852	002746'	000000	004000

  2853	002747'	326300	002066'

  2854	002750'	254000	002064'

  2855	002751'	260040	000000*

  2856	002752'	554160	506346

  2857	002753'	400002	000000

  2858	002754'	000000	000000*

  2859	002755'	554740	000012

  2860	002756'	242740	000011

  2861	002757'	553000	000012

  2862	002760'	302500	000000*

SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-8
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO

  2863	002761'	306500	000000*

  2864	002762'	265300	001403'

  2865	002763'	256000	000000'

  2866	002764'	402000	002633*

  2867	002765'	251300	777777*

  2868	002766'	402000	002647*

  2869	002767'	262300	002577*

  2870	002770'	262300	000007

  2871	002771'	502340	002745*

  2872	002772'	552340	002574*

  2873	002773'	262300	002706*

  2874	002774'	262300	002674*

  2875	002775'	262300	002653*

  2876	002776'	660200	000001

  2877	002777'	324740	001563'

  2878	003000'	550740	002727*

  2879	003001'	274740	000016

  2880	003002'	515357	000001

  2881	003003'	540340	000016

  2882	003004'	661340	002000

  2883	003005'	047340	777710

  2884	003006'	254000	002344'

  2885	003007'	254000	002330'

  2886	003010'	553000	000006

  2887	003011'	306300	002722*

  2888	003012'	263040	000000

  2889	003013'	256000	000000'
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-9
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO


  2890	003014'	542740	002771*

  2891	003015'	202600	003000*

  2892	003016'	550440	003015*

  2893	003017'	205300	636762

  2894	003020'	260040	000443'

  2895	003021'	254000	000514'

  2896	003022'	254000	002403'

  2897	003023'	205300	504750

  2898	003024'	260040	000443'

  2899	003025'	254000	003017'

  2900	003026'	254000	002403'

  2901	003027'	260040	001727'

  2902	003030'	254000	002417'

  2903	003031'	324740	000000*

  2904	003032'	265300	002214'

  2905	003033'	260040	000563'

  2906	003034'	205300	010000

  2907	003035'	436300	000000*

  2908	003036'	254000	002510*

  2909	003037'	262340	002767*

  2910	003040'	262340	000006

  2911	003041'	552300	002772*

  2912	003042'	262340	002773*

  2913	003043'	262340	002774*

  2914	003044'	542300	002775*

  2915	003045'	202353	000000

SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 35-10
SEGCON.MAC	28-OCT-87 00:02		SETUWP UUO

  2916						;End of SEGCON (SEGLIT: SEGEND:)
  2917
NO ERRORS DETECTED
PROGRAM BREAK IS 003051
9K CORE USED
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 36
SEGCON.MAC	28-OCT-87 00:02		SYMBOL TABLE

ACTWRT		001507'	EXT	ERRPGN		000507'	EXT	GTJBFN		001407'	INT	KILLHS		001563'	INT
ADD1PG		002161'		ERRRMF		002351'	EXT	GTJBNR		001403'		KILLLS		001554'	INT
ADJCOR		002151'		ERRTRE		000442'	EXT	GTSGCT		000005'	INT	KILPGS		001513'	INT
ALLMFR		001471'	EXT	EXCFLG		000400	SIN	GTUARG		000060'	INT	KJP		000100	SIN
APRENB		002444'	EXT	EXOMFR		001456'	EXT	HGHJOB		001324'		LGONAM		001177'	EXT
BADBIT		011762	SPD	EXPAND		001053'		HSEXIS		002211'	INT	LICHR		000040	SIN
CHANIO	043000	000000		EXPCOR		001077'		HSLIC		000002	SIN	LICMSK		001411'	EXT
CHGPWS		002115'	EXT	EXPLP1		001057'		HSSIZE		002203'	INT	LICRMT		002000	SIN
CHKACC		002056'	EXT	EXPLP2		001111'		INIJDA		002220'		LICSAM		002710'	EXT
CKIOWD		000467'		EXPLP3		001120'		INPB		010000	SIN	LICXC		000200	SIN
CKSARG		000471'		EXPND1		001055'		IOBKTL		040000	SIN	LMMEXS		000372'	EXT
CLSOUT		000001	SIN	F		000004	INT	IODEND		020000	SIN	LOGOFF		001166'	INT
CMPLP1		000753'		FALBDS		002144'	EXT	IODERR		200000	SIN	LOWFIN		000534'	
CMPLP2		000762'		FALCOR		002675'	EXT	IODTER		100000	SIN	LOWJOB		001310'	
CMPLPA		000754'		FALHOL		002146'	EXT	IOIMPM		400000	SIN	LSLIC		000004	SIN
CMPTHR		000772'		FALLKO		002140'	EXT	IOTEND		002000	SIN	LSSIZE		002200'	INT
COMERA		000305'	EXT	FALRBE		002143'	EXT	ITMCHN		000000	EXT	M		000013	INT
COMERR		000321'	EXT	FNCEXC		002046'	EXT	J		000002	INT	MAPHS		002032'	INT
COMTYS		000352'	EXT	FNCMDP		000035	SPD	JACCT		000001	SIN	MAPHS0		002064'	
CORXPN		001531'	INT	FNCRED		002044'	EXT	JBTFPN		001420'	EXT	MAPHS1		002066'	
CPOPJ		002236'	EXT	FNCUPD		002053'	EXT	JBTLIC		001465'	EXT	MAPHSE		002133'	
CPOPJ1		003036'	EXT	FNFERR		000000	SIN	JBTMFR		001473'	EXT	MAPHSF		002150'	
CPRCOW		000002	SIN	GETARG		000075'		JBTMPC		002114'	EXT	MAPIOF		000436'	
CPRRDW		000003	SIN	GETB		000010	SIN	JBTNAM		002354'	EXT	MAPUPS		000242'	EXT
CPRRED		000001	SIN	GETCOR		000521'		JBTPNO		001477'	EXT	MAXLIC		001464'	EXT
CRDFL%		002761'	EXT	GETERR		000531'		JBTPRV		002373'	EXT	MGETJB		001242'	
CRLIM%		002760'	EXT	GETFMU		001143'	INT	JBTRCT		001657'	EXT	MO.LAC		400000	SPD
CTEXT		000270'	EXT	GETFRM		001141'	INT	JBTSIN		001663'	EXT	MONSTR		000370'	EXT
CTEXT1		000353'	EXT	GETJB		001243'		JBTSLC		001454'	EXT	MSTART		000324'	EXT
DECIN1		000303'	EXT	GETJB0		001253'		JBTSTS		002447'	EXT	MTR		000024	SPD
DELET		001032'		GETJB1		001263'		JBTUPM		001524'	EXT	MTSIZ		001772'	EXT
DEVMOD		000004	SIN	GETJB2		001267'		JOB		001216'	EXT	NECERR		000010	SIN
DEVNAM		000000	SIN	GETJB3		001302'		JOB41		003043'	EXT	NOCHRG		002116'	
DEVPPN		000017	SIN	GETJOB		001141'	INT	JOBCOR		003042'	EXT	NODIE		000000	EXT
DIE		002751'	EXT	GETLI1		002107'	EXT	JOBDA		001342'	EXT	NOFILE		000514'	
DNAERR		000011	SIN	GETLIC		002421'	EXT	JOBDDT		002766'	EXT	NORMFX		002455'	
DOLOOK		000443'		GETMTJ		001373'		JOBEXM		002616'	EXT	NOROOM		000502'	
DOXCT		002336'	EXT	GNUA1		000135'		JOBFDV		002617'	EXT	NOSHR		000001	SIN
DR		000016	SIN	GNUA2		000140'		JOBFF		002550'	EXT	NOTENF		000355'	EXT
DVDSK		200000	SIN	GNUALP		000125'		JOBHCR		002632'	EXT	NSFERR		000007	SIN
DVMTA		000020	SIN	GNUARG		000114'	INT	JOBHRL		003014'	EXT	NSRBIT		400000	SIN
ENTRB		020000	SIN	GNUARX		000165'	INT	JOBHRN		002630'	EXT	P		000001	INT
ERRCAN		000000	EXT	GNUAX1		000201'		JOBNSV		001037'	EXT	P1		000014	INT
ERRDNA		000513'	EXT	GNUAXL		000173'		JOBPOP		000000	EXT	P2		000015	INT
ERREUF		001031'	EXT	GNULEN		000006	SPD	JOBREL		003016'	EXT	P3		000016	INT
ERRFNF		000520'	EXT	GNULNX		000006	SPD	JOBREN		003041'	EXT	P4		000017	INT
ERRJSU		001150'	EXT	GNUPDL		000142'		JOBS41		002673'	EXT	PAGSTS	047000	777707	
ERRJSV		001023'	EXT	GNUPPN		000143'		JOBSA		003044'	EXT	PC.PUB		002000	SIN
ERRMES		000356'	EXT	GNUTAB		000106'		JOBSDD		002646'	EXT	PC.USR		010000	SIN
ERRMGF		003031'	EXT	GNUTBX		000157'		JOBSV		002764'	EXT	PG		000003	INT
ERRMHB		001400'	EXT	GTCGSZ		001660'	EXT	JOBSVM		001601'	EXT	PHONLY		400000	SIN
ERRNSA		001236'	EXT	GTJBF1		001434'		JOBVER		003037'	EXT	PJPGNO		000300'	EXT
ERRNSF		000533'	EXT	GTJBF2		001472'		KILLHS		001563'	INT	PJRST	324740	000000	
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88 PAGE 36-2
SEGCON.MAC	28-OCT-87 00:02		SYMBOL TABLE

PRTERR		000002	SIN	S$NONA		000000	SIN	SYSPPN		000000	EXT	W		000012	INT
PRTT1		002754'	EXT	S$PATC		000007	SIN	T1		000006	INT	WAKFLG		200000	SIN
PS.CPR		002467'	EXT	S$TEMP		000000	SPD	T2		000007	INT	WS.ADD		002324'	EXT
PTNVP%		002521'	EXT	S$XCT	777777	777776	SIN	T3		000010	INT	WSATM%		003011'	EXT
PTPRF%		002520'	EXT	SAVARG		000222'		T4		000011	INT	WSCTL	047000	777704	
PVEXO		400000	SIN	SAVDMP		002661'	EXT	TIMADJ		002403'	EXT	XGADEV		012107	SPD
PVEXOG		004000	SIN	SAVERR		001024'		TPOPJ		001611'	EXT	XGAEXT		012131	SPD
PVYCOR		002264'	EXT	SAVFIN		001012'		TRNERR		000006	SIN	XGAMOD		012115	SPD
PX.MEM		000004	SPD	SAVFMU		000602'	INT	TTCMCH		000325'	EXT	XGANAM		012137	SPD
PX.SRC		000001	SPD	SAVFN1		001021'		U		000005	INT	XGANEW		012145	SPD
PXCT	256000	000000		SAVFRM		000600'	INT	UGETHI		002357'	INT	XGAPPN		012123	SPD
RDHS1		001777'		SAVJ2		000610'		UGTSEG		002357'	INT	XGAUN1		012153	SPD
RDHSE0		002024'		SAVJ3		000625'		UNMDN		000352'		XGAUN2		012161	SPD
RDHSE1		002025'		SAVJB3		000654'		UPTALD		000000	EXT	XPAALP		000035	SPD
RDHSE2		002026'		SAVJB4		000672'		UPTALN		000000	EXT	XPAAUT		000030	SPD
RDHSEX		002027'		SAVJB5		000730'		UPTALP		000000	EXT	XPACOM		000051	SPD
RDLSFM		001705'		SAVJOB		000600'	INT	UPTHRL		000000	EXT	XPADEV		000001	SPD
RDLSU1		001724'		SAVNUL		001037'		UPTJDA		000000	EXT	XPAELB		000022	SPD
RDLSUU		001716'		SEGCON		000000'	ENT	UPTMFR		000000	EXT	XPAEXT		000005	SPD
RDLSW		001571'		SEGEND		003050'	INT	UPTPDL		000000	EXT	XPAHPD		000050	SPD
RDXMFR		001461'	EXT	SEGLIT		002524'	INT	UPTPID		000000	EXT	XPALIC		000047	SPD
READHS		001727'	INT	SETACS		000212'		UPTREL		000000	EXT	XPALKB		000002	SPD
READLS		001572'	INT	SETOPN		000206'		UPTSPD		000000	EXT	XPAMOD		000000	SPD
REPDP		002214'		SG.SWR		002502'	EXT	UPTSTS		000000	EXT	XPAMXA		000026	SPD
RESET		001210'	EXT	SG1		000370'		UPTSTV		000000	EXT	XPANAM		000004	SPD
RIBERB		000436'		SG1A		000402'		UPTXAC		000000	EXT	XPANEW		000046	SPD
RIPBDA		000000	EXT	SG3		000412'	INT	UREMAP		002236'	INT	XPAPID		000042	SPD
RIPBDR		000000	EXT	SGDO		000424'		UREMP2		002262'		XPAPJ1		000040	SPD
RIPBFS		000000	EXT	SGDOER		001132'		UREMP3		002276'		XPAPJ2		000041	SPD
RIPHRE		000000	EXT	SGERRA		000510'		UREMP4		002305'		XPAPJC		000037	SPD
RIPHWE		000000	EXT	SGIOCK		000433'	INT	UREMP5		002312'		XPAPPN		000003	SPD
RNGT0		002362'		SGLEB		000052	SPD	UREMP6		002323'		XPAPRV		000006	SPD
RNGT1		002374'		SGLLB		000040	SPD	UREMP7		002330'		XPAQTF		000024	SPD
RNGT2		002403'		SGREL		000563'		URMPFX		002344'		XPAQTO		000025	SPD
RNGT3		002417'		SGREL1		000575'		URUN		001210'	INT	XPASIZ		000007	SPD
RNGTF0		002451'		SGRELE		000547'		URUN1B		001224'		XPASNM		000036	SPD
RNSEG		001216'	INT	SGRELL		000544'		URUN2		001231'		XPASTS		000021	SPD
RNSGCT		000004'	INT	SGRLE2		000556'		URUN4		001233'		XPATRU		000033	SPD
RTZER		002463'	EXT	SGSET		000241'	INT	URUNCT		000003'	INT	XPAUN1		000043	SPD
RUNAL1		001200'		SGSET1		000322'		URUNHI		002352'	INT	XPAUN2		000044	SPD
RUNCHN		000000	SPD	SGSET2		000316'		USPY		001512'	INT	XPAUSD		000027	SPD
RUNFMU		001153'	INT	SGSET3		000264'		USRXIT		001241'	EXT	XPAUXT		000045	SPD
RUNFRM		001163'	INT	SGSET4		000325'		USTUW0		002464'		XPAXT1		000023	SPD
RUNJB2		001160'	INT	SGSET5		000356'		USTUW1		002505'		XPAXT2		000034	SPD
RUNJOB		001151'	INT	SGSETD		000240'	INT	USTUW2		002511'		XPNCOR		001132'	EXT
RUNM1		000341'		SGSETF		000260'		USTUW3		002523'		ZZ	005557	664555	SPD
S		000000	INT	SHRJB2		001326'		USTUWP		002457'	INT	%UPLMA		000373'	EXT
S$ENTR	777777	777775	SIN	SHRJB3		001355'		UUPPID		000000	EXT	%UPS		000000	EXT
S$EVEN		000006	SIN	SHRJB4		001345'		VCLEAR	047000	777712		%UPT		000000	EXT
S$HALT	777777	777777	SIN	SHRJOB		001324'		VCREAT	047000	777711		%UPX		000000	EXT
S$INFO		000005	SIN	SVARG2		000237'		VPROT	047000	777710		.ARSIZ		000001	SIN
S$JOB		000002	SIN	SVLSU1		001010'		VREMOV	047000	777713		

SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

ACTWRT	  1709%	  1711	  1713
ADD1PG	  2079	  2204	  2278#
ADJCOR	   952	  1503	  2248#
ALLMFR	  1637%	  1696
APRENB	  2632%	  2632
BADBIT	   118#	   703
CHGPWS	  2197%	  2197
CHKACC	  2135%	  2155	  2160
CKIOWD	   722#	   955	  1888
CKSARG	   741#	   839
CLSOUT	   902
CMPLP1	  1086#	  1101
CMPLP2	  1093#	  1099
CMPLPA	  1087#	  1090
CMPTHR	  1088	  1103#
COMERA	   476%	   476
COMERR	   477%	   477	   484%	   484	   488%	   488
COMTYS	   509%	   509	   519%	   519
CORXPN	   578	  1578	  1769#	  1898	  2020	  2050
CPOPJ	    54%	  1750	  1884	  2141	  2251	  2349	  2416
CPOPJ1	    54%	   330	   708	  1354	  1791	  1959	  1985	  2090	  2210	  2350	  2511	  2612	  2693
CPRCOW	   992	  2677	  2688
CPRRDW	   988	  1779	  2689
CPRRED	  1010	  1923	  2068	  2072	  2176	  2198	  2454	  2467	  2683	  2697
CRDFL%	    57%	  2287
CRLIM%	    57%	  2286
CTEXT	   452%	   452	   463%	   463
CTEXT1	   447%	   447	   520%	   520
DECIN1	   474%	   474
DELET	  1031	  1052	  1155#
DEVMOD	   864	   898	   964	  1053	  1495	  1559	  1644	  2015	  2144	  2599
DEVNAM	   781
DEVPPN	  1646	  2154	  2159
DIE	    11	    11%	    12	  2227
DNAERR	   778
DOLOOK	   689#	  1463	  1465	  1468	  1470	  1555	  2583	  2585	  2587
DOXCT	    57%	  1801	  1820	  2503	  2506
DR	   192	   232	   311	   587	  2062
DVDSK	   865	  1645	  2145
DVMTA	   899	   965	  1054	  1496	  1560	  2016	  2600
ENTRB	  2169	  2181	  2216
ERRCAN	    62%
ERRDNA	    61%	   782
ERREUF	    61%	  1144
ERRFNF	    61%	   800
ERRJSU	    61%	  1294
ERRJSV	    61%	  1135
ERRMES	   524%	   524
ERRMGF	    62%	  2603
ERRMHB	    62%	  1594
ERRNSA	    62%	  1406
ERRNSF	    61%	   827
ERRPGN	    61%	   767
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

ERRRMF	    62%	  2523
ERRTRE	    61%	   673
EXCFLG	  2634
EXOMFR	  1637%	  1685
EXPAND	   633	  1219#	  1958
EXPCOR	  1243#
EXPLP1	  1225#	  1232	  1237
EXPLP2	  1254#	  1268
EXPLP3	  1261#	  1266
EXPND1	  1223#
F	   781	   864	   895	   898	   900	   960	   964	  1053	  1458	  1459	  1495	  1559	  1644	  1646
	  2015	  2144	  2151	  2154	  2159	  2164	  2169	  2170	  2181	  2182	  2216	  2217	  2422	  2426
	  2434	  2438	  2470	  2471	  2483	  2520	  2554	  2561	  2570	  2581	  2599	  2607
FALBDS	  1964	  2137%	  2223
FALCOR	  1533	  2137%	  2140	  2220	  2639
FALHOL	  1966	  2137%	  2225
FALLKO	  1963	  2137%	  2219
FALRBE	  1967	  2137%	  2222
FNCEXC	  2136%	  2152
FNCMDP	    37#	  1928	  2178
FNCRED	  2136%	  2150
FNCUPD	  2136%	  2157
FNFERR	   793
GETARG	   184	   186	   190#	  1358
GETB	  1458	  2151	  2164	  2554	  2570	  2607
GETCOR	   809#	   841	  1242
GETERR	   825#	  1256
GETFMU	  1284	  1289#
GETFRM	  1284	  1286#
GETJB	  1360	  1386	  1444#
GETJB0	  1451	  1455#
GETJB1	  1472	  1473	  1474	  1476#
GETJB2	  1477	  1489#
GETJB3	  1500	  1503#
GETJOB	  1284	  1287#
GETLI1	  2138%	  2191
GETLIC	  1522%	  1522	  1538%	  1538	  2613%	  2613
GETMTJ	  1497	  1585#
GINST	   179#	   179	   180	   180#	   181	   181#	   182	   182#	   183	   183#	   184	   187#	   187	   188
	   188#	   189	   195#	   195	   196	   240#	   240	   241	   244#	   244	   245	   271#	   271	   272
	   273#	   273	   274	   313#	   313	   314	   317#	   317	   318	   590#	   590	   591	   599#	   599
	   600	   602#	   602	   603	   603#	   604	   604#	   605	   810#	   810	   811	   835#	   835	   836
	   838#	   838	   839	   842#	   842	   843	   843#	   844	   872#	   872	   873	   877#	   877	   878
	   956#	   956	   957	   978#	   978	   979	   980#	   980	   981	   981#	   982	   996#	   996	   997
	   998#	   998	   999	   999#	  1000	  1001#	  1001	  1002	  1002#	  1003	  1003#	  1004	  1004#	  1005
	  1006#	  1006	  1007	  1009#	  1009	  1010	  1014#	  1014	  1015	  1049#	  1049	  1050	  1073#	  1073
	  1074	  1074#	  1075	  1075#	  1076	  1076#	  1077	  1077#	  1078	  1078#	  1079	  1079#	  1080	  1089#
	  1089	  1090	  1094#	  1094	  1095	  1097#	  1097	  1098	  1100#	  1100	  1101	  1104#	  1104	  1105
	  1192#	  1192	  1193	  1193#	  1194	  1194#	  1195	  1220#	  1220	  1221	  1224#	  1224	  1225	  1231#
	  1231	  1232	  1239#	  1239	  1240	  1250#	  1250	  1251	  1252#	  1252	  1253	  1254#	  1254	  1255
	  1257#	  1257	  1258	  1259#	  1259	  1260	  1264#	  1264	  1265	  1265#	  1266	  1269#	  1269	  1270
	  1270#	  1271	  1276#	  1276	  1277	  1380#	  1380	  1381	  1404#	  1404	  1405	  1520#	  1520	  1521
	  1521#	  1522	  1546#	  1546	  1547	  1571#	  1571	  1572	  1572#	  1573	  1573#	  1574	  1581#	  1581
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

	  1582	  1802#	  1802	  1803	  1821#	  1821	  1822	  1901#	  1901	  1902	  1955#	  1955	  1956	  2029#	  2029
	  2030	  2030#	  2031	  2037#	  2037	  2038	  2080#	  2080	  2081	  2205#	  2205	  2206	  2381#	  2381
	  2382	  2382#	  2383	  2383#	  2384	  2386#	  2386	  2387	  2387#	  2388	  2388#	  2389	  2389#	  2390
	  2391#	  2391	  2392	  2393#	  2393	  2394	  2394#	  2395	  2419#	  2419	  2420	  2428#	  2428	  2429
	  2504#	  2504	  2505	  2507#	  2507	  2508	  2567#	  2567	  2568	  2623#	  2623	  2624	  2624#	  2625
	  2625#	  2626	  2626#	  2627	  2627#	  2628	  2628#	  2629	  2629#	  2630	  2630#	  2631	  2680#	  2680
	  2681
GNUA1	   246	   254#
GNUA2	   258#
GNUALP	   244#	   247
GNUARG	   231#
GNUARX	   310#
GNUAX1	   319	   325#
GNUAXL	   317#	   320
GNULEN	   229#	   243
GNULNX	   308#	   316
GNUPDL	   236	   261#
GNUPPN	   257	   268#	   328
GNUTAB	   222#	   229	   243	   256
GNUTBX	   301#	   308	   316	   327
GTCGSZ	  1939%	  1939
GTJBF1	  1661	  1663	  1667#
GTJBF2	  1687	  1694	  1697#
GTJBFN	  1376	  1528	  1583	  1639#	  2621
GTJBNR	  1518	  1534	  1564	  1579	  1592	  1600#	  2288
GTSGCT	    67#	  2559
GTUARG	   176#	  1381	  2552	  2560
HGHJOB	  1507	  1510	  1530#
HSEXIS	   947	   962	  1273	  2347#	  2423	  2665
HSLIC	    83	    85#	   191	  1542	  1654	  1655	  1662	  2617
HSSIZE	  2323#	  2681	  2695
INIJDA	  1537	  2378#
INPB	   900
IOBKTL	   664
IODEND	   903	  2027	  2060
IODERR	   664
IODTER	   664
IOIMPM	   664
IOTEND	   903	  2060
ITMCHN	  1445	  1445%
J	   454	   458	  1082	  1083	  1084	  1087	  1096	  1288	  1289	  1290	  1308	  1309	  1310	  1345
	  1359	  1384	  1390	  1392	  1399	  1400	  1402	  1447	  1641	  1648	  1650	  1667	  1676	  1677
	  1682	  1683	  1684	  1689	  1692	  1698	  1702	  1749	  1924	  1931	  1938	  1942	  1961	  2168
	  2196	  2442	  2500	  2518	  2553	  2572	  2576	  2633	  2635
JACCT	  1401
JBTFPN	    50%	  1648	  1650
JBTLIC	    50%	  1289	  1309	  1399	  1641	  1677	  1682	  1689	  1692
JBTMFR	  1637%	  1698
JBTMPC	    51%	  2195	  2196
JBTNAM	    50%	   454	   458	  1359	  1384	  2553
JBTPNO	  1637%	  1702
JBTPRV	    50%	  1392	  1447	  1667	  1676	  1684	  1924	  1931	  1961	  2168	  2442	  2500	  2518	  2572
	  2576
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

JBTRCT	    51%	  1937	  1938
JBTSIN	    51%	  1941	  1942
JBTSLC	    50%	  1290	  1310	  1400	  1683
JBTSTS	    50%	  1345	  1402	  2633	  2635
JBTUPM	    51%	  1749
JOB	    50%	  1288	  1308	  1390
JOB41	    45%	   998	  1073	  1521	  2393	  2627
JOBCOR	    46%	   195	   590	   835	   843	   956	   999	  1049	  1193	  1546	  1573	  2391	  2626
JOBDA	    47%	  1050	  1551	  1570	  2382
JOBDDT	    46%	   602	   980	  1077	  1270	  2383	  2630
JOBEXM	    47%	  1075
JOBFDV	    47%	  1076
JOBFF	    46%	   599
JOBHCR	    47%	  1194	  2029	  2030
JOBHRL	    45%	   978	   981	  1002	  1014	  1276	  1821	  2080	  2205	  2388	  2504
JOBHRN	    47%	  1192	  1196	  2037
JOBNSV	    45%	  1191	  1197
JOBPOP	    45%	  2384	  2622
JOBREL	    45%	   603	   604	   810	   838	   842	  1581	  1802	  1901	  2419	  2428	  2507	  2567
JOBREN	    46%	  1001	  2389	  2625
JOBS41	    46%	  1074	  1520
JOBSA	    45%	   996	  1079	  1404	  2394	  2629
JOBSDD	    46%	  1078	  1081	  1262	  1269
JOBSV	    46%	  1080	  1105	  1220	  1223	  1267	  2379	  2380	  2381
JOBSVM	    46%	   607	   608	   722	  1084	  1891
JOBVER	    45%	  1004	  2386	  2623
KILLHS	  1454	  1488	  1556	  1595	  1603	  1817#	  2427	  2593	  2644
KILLLS	  1453	  1487	  1602	  1800#
KILPGS	  1740#	  1806	  1823
KJP	  1346
LGONAM	  1338%	  1352
LICHR	  1649	  1690
LICMSK	  1642%	  1642
LICRMT	  1649	  1690
LICSAM	  1656%	  1656
LICXC	  2193
LISTSN	     3	     6
LMMEXS	    41%	   574
LOGOFF	  1340#
LOWFIN	   835#	  1519	  1582
LOWJOB	  1516#	  1563	  1596
LSLIC	    83	    87#	   191	  1526	  1654	  1655
LSSIZE	  2318#
M	   177	   179	   180	   181	   182	   183	   240	   241	   313	   314	   764	   765	   766	   871
	   877	  1380	  2680
MAPHS	  1532	  2140#	  2604
MAPHS0	  2166	  2169#
MAPHS1	  2149	  2156	  2165	  2171#
MAPHSE	  2180	  2214#
MAPHSF	  2227#
MAPIOF	   667#	  1535	  1965	  1968	  2640
MAPUPS	   438%	   438
MAXLIC	  1678%	  1678	  1681%	  1681	  1691%	  1691
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

MGETJB	  1291	  1311	  1443#
MO.LAC	  1445
MONSTR	   572%	   572
MSTART	   493%	   493
MTR	  1445
MTSIZ	  2018%	  2018	  2022%	  2022	  2041%	  2041	  2054%	  2054	  2055%	  2055
NECERR	   761
NOCHRG	  2194	  2198#
NODIE	    11%
NOFILE	   793#	  1471	  1558	  2588
NORMFX	  2569	  2645#
NOROOM	   580	   747	   761#	   815	  1604	  2648
NOSHR	    83	    84#	   191	   445	   588	   971
NOTENF	   455%	   455	   511%	   511	   522%	   522
NSFERR	   825
NSRBIT	   444
P	    12	   194	   196	   223	   233	   234	   235	   236	   249	   250	   251	   257	   270	   277
	   322	   328	   340	   346	   353	   373	   374	   375	   376	   437	   438	   440	   447	   452
	   463	   471	   474	   509	   519	   520	   578	   579	   592	   611	   631	   632	   633	   636
	   637	   665	   669	   701	   742	   746	   748	   762	   764	   779	   795	   809	   811	   813
	   826	   839	   841	   846	   880	   896	   897	   906	   907	   946	   947	   952	   955	   957
	   962	   966	   969	   975	  1023	  1026	  1027	  1031	  1045	  1052	  1058	  1064	  1120	  1126
	  1127	  1138	  1141	  1156	  1159	  1201	  1203	  1238	  1242	  1243	  1273	  1275	  1278	  1291
	  1307	  1311	  1315	  1319	  1358	  1360	  1378	  1381	  1386	  1395	  1396	  1403	  1408	  1452
	  1453	  1454	  1455	  1463	  1465	  1468	  1470	  1478	  1487	  1488	  1503	  1517	  1519	  1522
	  1532	  1537	  1538	  1555	  1556	  1578	  1582	  1590	  1595	  1601	  1602	  1603	  1642	  1651
	  1656	  1678	  1679	  1681	  1691	  1711	  1713	  1714	  1715	  1722	  1753	  1778	  1781	  1782
	  1783	  1787	  1790	  1801	  1820	  1886	  1888	  1889	  1898	  1900	  1924	  1931	  1939	  1958
	  1961	  1981	  2020	  2026	  2040	  2048	  2050	  2051	  2053	  2059	  2064	  2070	  2073	  2079
	  2082	  2143	  2147	  2155	  2160	  2171	  2174	  2187	  2190	  2191	  2192	  2197	  2199	  2200
	  2204	  2214	  2215	  2221	  2224	  2226	  2227	  2255	  2299	  2321	  2325	  2329	  2361	  2362
	  2363	  2364	  2396	  2420	  2423	  2426	  2430	  2442	  2491	  2493	  2500	  2503	  2506	  2518
	  2522	  2552	  2560	  2578	  2583	  2585	  2587	  2592	  2593	  2601	  2604	  2609	  2613	  2621
	  2632	  2644	  2647	  2665	  2667	  2681	  2695	  2703
P1	   181	   306	   347	   380	   536	   973	  1006	  1069	  1091	  1092	  1099	  1100	  1142	  1155
	  1226	  1227	  1228	  1229	  1230	  1233	  1234	  1235	  1246	  1247	  1248	  1249	  1250	  1251
	  1252	  1254	  1255	  1261	  1262	  1264	  1357	  2421	  2429	  2432	  2436	  2446	  2507	  2508
	  2521	  2664	  2684
P2	   180	   305	   348	   379	   472	   473	   502	   503	   516	   537	   705	   970	   972	   975
	  1027	  1028	  1029	  1030	  1046	  1047	  1048	  1067	  1068	  1143	  1257	  1258	  1266	  1269
	  1270	  1343	  1352	  1354	  1359	  1384	  1499	  1501	  1502	  1506	  1508	  1509	  2148	  2208
	  2553
P3	   187	   299	   349	   381	   539	   671	   707	   798	  1133	  1142	  1292	  2153	  2158	  2446
	  2447	  2448	  2450	  2451	  2453	  2466	  2478	  2480	  2482
P4	   188	   300	   350	   351	   352	   382	   540	   672	   706	   799	  1134	  1143	  1293	  1498
	  1561	  1562	  1575	  1580	  1581	  1589	  1601	  1884	  1885	  1887	  1892	  1893	  1903	  1912
	  2141	  2142	  2147	  2283	  2284	  2428	  2429	  2435	  2445	  2448	  2449	  2450	  2451	  2452
	  2459	  2480	  2481	  2501	  2502	  2504	  2505	  2643
PC.PUB	  1407
PC.USR	   868	  1129	  1407	  2610
PG	   197	   220	   221	   224	   225	   226	   227	   228	   234	   249	   258	   337	   338	   347
	   348	   350	   352	   374	   377	   378	   379	   380	   381	   382	   383	   384	   586	   589
	   593	   609	   671	   672	   689	   690	   692	   693	   695	   696	   697	   699	   700	   702
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

	   705	   706	   707	   743	   781	   798	   799	   866	   953	  1048	  1082	  1107	  1133	  1292	  1466
	  1525	  1527	  1541	  1543	  1544	  1545	  1549	  1640	  1652	  1653	  1658	  1659	  1660	  1665
	  1666	  1695	  1705	  1894	  1932	  1948	  1953	  1975	  2034	  2035	  2250	  2254	  2361	  2363
	  2616	  2618	  2619	  2620
PHONLY	   443	   588	  1349
PJPGNO	   471%	   471
PRTERR	  1139
PRTT1	  2227%	  2227
PS.CPR	    57%	  2676
PTNVP%	    58%	  2702
PTPRF%	    58%	  2701
PVEXO	  1391	  1674	  1675	  1686	  2573
PVEXOG	  1446	  1672	  1673	  2162	  2574	  2575
PVYCOR	  1926%	  1926	  2444%	  2444
PX.MEM	   179	   180	   181	   182	   183	   187	   188	   195	   240	   244	   271	   273	   313	   317
	   590	   599	   602	   603	   604	   810	   835	   838	   842	   843	   872	   877	   956	   978
	   980	   981	   996	   998	   999	  1001	  1002	  1003	  1004	  1006	  1009	  1014	  1049	  1073
	  1074	  1075	  1076	  1077	  1078	  1079	  1089	  1094	  1097	  1100	  1104	  1192	  1193	  1194
	  1220	  1224	  1231	  1239	  1250	  1252	  1254	  1257	  1259	  1264	  1265	  1269	  1270	  1276
	  1380	  1404	  1520	  1521	  1546	  1571	  1572	  1573	  1581	  1802	  1821	  1901	  1955	  2029
	  2030	  2037	  2080	  2205	  2381	  2382	  2383	  2386	  2387	  2388	  2389	  2391	  2393	  2394
	  2419	  2428	  2504	  2507	  2567	  2623	  2624	  2625	  2626	  2627	  2628	  2629	  2630	  2680
PX.SRC	   996	   998	   999	  1003	  1004	  1006	  1009	  1094	  1252	  1264	  1572	  1955	  2382	  2386
	  2387	  2391	  2393	  2394	  2623	  2624	  2626	  2627	  2628
RDHS1	  2042	  2060#
RDHSE0	  2021	  2052	  2085#	  2088
RDHSE1	  2049	  2071	  2086#
RDHSE2	  2028	  2039	  2087#
RDHSEX	  2085	  2086	  2087	  2088#
RDLSFM	  1930	  1961#
RDLSU1	  1977	  1981#
RDLSUU	  1905	  1919	  1975#
RDLSW	  1883#	  1904
RDXMFR	  1637%	  1688
READHS	  1590	  2015#	  2601
READLS	  1517	  1884#
REPDP	  2361#	  2608
RESET	  1378%	  1378
RIBERB	   666#	   704
RIPBDA	   118	   119%
RIPBDR	   118	   119%
RIPBFS	   118	   119%
RIPHRE	   118	   119%
RIPHWE	   118	   119%
RNGT0	  2555	  2566#
RNGT1	  2571	  2577#
RNGT2	  2589	  2590	  2591#
RNGT3	  2602	  2606#
RNGTF0	  2605	  2638#
RNSEG	  1312	  1361	  1376	  1390#	  2636
RNSGCT	    66#	  2551
RTZER	  2668%	  2668
RUNAL1	  1347	  1354#
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

RUNCHN	    36#	   663	   700	   878	   879	   895	   902	   903	   904	   905	   958	   960	   973	  1022
	  1024	  1056	  1065	  1069	  1121	  1155	  1157	  1200	  1202	  1456	  1459	  1928	  1982	  2025
	  2038	  2058	  2060	  2061	  2062	  2170	  2178	  2182	  2217	  2579	  2581
RUNFMU	  1304	  1308#	  1316	  1320
RUNFRM	  1304	  1318#
RUNJB2	  1304	  1314#
RUNJOB	  1304	  1306#
RUNM1	   509#	   515	   517
S	   302	   444	   490	   663	   664	  1319	  2027	  2431	  2433	  2451
S$ENTR	    11	    17	   261	   390	  1012	  1741	  1744	  1752	  1770	  1773	  1789	  1957	  1969	  2017
	  2146	  2189	  2228	  2249	  2280	  2289	  2494	  2675	  2704
S$EVEN	  2227
S$HALT	    11	   261	   390	  1012	  1741	  1744	  1752	  1770	  1773	  1789	  1957	  1969	  2017	  2146
	  2189	  2227	  2249	  2280	  2289	  2494	  2675	  2704
S$INFO	  2227
S$JOB	  2227	  2228
S$NAME	    15#	   261	   390	  1012	  1741	  1744	  1752	  1770	  1773	  1789	  1957	  1969	  2017	  2146
	  2189	  2249	  2280	  2289	  2494	  2675	  2704
S$NONA	    14	    17	   261	   390	  1012	  1741	  1744	  1752	  1770	  1773	  1789	  1957	  1969	  2017
	  2146	  2189	  2228	  2249	  2280	  2289	  2494	  2675	  2704
S$PATC	  2227
S$TEMP	    11#	    11	   261#	   261	   390#	   390	  1012#	  1012	  1741#	  1741	  1744#	  1744	  1752#	  1752
	  1770#	  1770	  1773#	  1773	  1789#	  1789	  1957#	  1957	  1969#	  1969	  2017#	  2017	  2146#	  2146
	  2189#	  2189	  2227#	  2227	  2249#	  2249	  2280#	  2280	  2289#	  2289	  2494#	  2494	  2675#	  2675
	  2704#	  2704
S$XCT	    17	   261	   390	  1012	  1741	  1744	  1752	  1770	  1773	  1789	  1957	  1969	  2017	  2146
	  2189	  2228	  2249	  2280	  2289	  2494	  2675	  2704
SAVARG	   193	   372#	   573
SAVDMP	  1068%	  1068	  1467%	  1467
SAVERR	   974	  1070	  1137#
SAVFIN	  1055	  1059	  1125#
SAVFMU	   942	   947#
SAVFN1	  1130	  1133#
SAVFRM	   942	   944#
SAVJ2	   949	   953#
SAVJ3	   963	   969#
SAVJB3	   991	   995#
SAVJB4	   987	   994	  1014#
SAVJB5	   967	  1046	  1051	  1064#
SAVJOB	   942	   945#
SAVNUL	   966	  1058	  1190#
SEGCON	    11	    12#	    15
SEGEND	  2916#
SEGLIT	  2706#
SETACS	   346#	   957	   969	  1026	  1045	  1064
SETOPN	   336#	   346	  1455	  2578
SG.SWR	    40%	   986	  1493	  1669	  2207	  2509	  2594	  2687
SG1	   572#	   945	  1287	  1306	  1314	  1318
SG1A	   576	   583#
SG3	   196	   592	   597#
SGDO	   631#	  1120	  1981
SGDOER	  1221	  1271#
SGERRA	   778#	   959	  1057	  1066	  1457	  2580
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

SGIOCK	   632	   662#	  1023	  1201	  2026	  2059
SGLEB	   130#	   235	   375
SGLLB	   121#	   694	   699
SGREL	   869	   874	   895#	  1127	  1714	  2609
SGREL1	   901	   905#
SGRELE	   669	   762	   779	   826	   867#	  1141
SGRELL	   795	   863#
SGRLE2	   876#
SGSET	   437#
SGSET1	   475	   489#
SGSET2	   481	   485#
SGSET3	   457#	   521
SGSET4	   448	   497#
SGSET5	   467	   469	   523#
SGSETD	   436#
SGSETF	   450	   453#	   499
SHRJB2	  1537#	  1591
SHRJB3	  1552	  1569#
SHRJB4	  1550	  1554#
SHRJOB	  1531#
SVARG2	   376	   390#
SVLSU1	  1116	  1120#
SVLSUU	  1114#
SYSPPN	  1338%
T1	   177	   178	   193	   241	   242	   244	   246	   268	   269	   271	   273	   314	   315	   317
	   319	   337	   385	   478	   482	   485	   524	   572	   573	   574	   575	   577	   580	   581
	   582	   599	   601	   603	   604	   606	   607	   608	   609	   634	   635	   667	   689	   690
	   691	   692	   693	   694	   695	   696	   697	   698	   699	   702	   703	   722	   723	   741
	   742	   743	   744	   745	   746	   747	   748	   761	   778	   793	   809	   810	   811	   813
	   814	   815	   825	   835	   837	   838	   842	   843	   866	   877	   897	   898	   899	   906
	   956	   958	   971	   978	   979	   985	   986	   988	   989	   992	   993	   995	   996	   998
	   999	  1003	  1004	  1006	  1007	  1009	  1010	  1011	  1014	  1015	  1016	  1017	  1019	  1020
	  1022	  1056	  1065	  1073	  1074	  1077	  1078	  1080	  1086	  1088	  1094	  1101	  1104	  1105
	  1106	  1109	  1110	  1114	  1116	  1117	  1118	  1121	  1126	  1138	  1139	  1191	  1192	  1194
	  1196	  1197	  1198	  1220	  1223	  1224	  1229	  1231	  1238	  1239	  1241	  1244	  1249	  1251
	  1252	  1253	  1254	  1255	  1257	  1259	  1260	  1263	  1264	  1265	  1271	  1272	  1289	  1290
	  1309	  1310	  1355	  1380	  1446	  1447	  1456	  1462	  1464	  1466	  1467	  1469	  1493	  1494
	  1518	  1520	  1521	  1524	  1525	  1526	  1527	  1533	  1540	  1541	  1542	  1543	  1544	  1545
	  1549	  1553	  1564	  1570	  1571	  1572	  1577	  1592	  1593	  1604	  1652	  1654	  1655	  1662
	  1679	  1680	  1685	  1688	  1696	  1697	  1699	  1705	  1706	  1710	  1712	  1740	  1742	  1746
	  1748	  1769	  1771	  1775	  1777	  1781	  1785	  1786	  1787	  1788	  1800	  1802	  1803	  1804
	  1817	  1889	  1890	  1895	  1897	  1900	  1901	  1902	  1908	  1909	  1915	  1916	  1917	  1918
	  1925	  1926	  1928	  1929	  1940	  1941	  1942	  1945	  1946	  1948	  1949	  1952	  1955	  1962
	  1975	  1977	  1978	  1979	  1982	  2019	  2022	  2023	  2025	  2030	  2031	  2032	  2035	  2045
	  2047	  2048	  2051	  2053	  2054	  2055	  2058	  2064	  2065	  2066	  2067	  2068	  2069	  2070
	  2073	  2074	  2076	  2077	  2078	  2080	  2081	  2085	  2086	  2087	  2088	  2089	  2150	  2152
	  2157	  2162	  2163	  2165	  2168	  2178	  2179	  2185	  2186	  2187	  2188	  2193	  2200	  2201
	  2202	  2203	  2205	  2206	  2207	  2209	  2218	  2250	  2251	  2252	  2253	  2254	  2288	  2293
	  2294	  2296	  2297	  2298	  2348	  2349	  2362	  2379	  2380	  2382	  2384	  2386	  2387	  2391
	  2393	  2394	  2416	  2417	  2418	  2419	  2421	  2443	  2444	  2458	  2468	  2489	  2490	  2491
	  2492	  2509	  2510	  2519	  2521	  2572	  2573	  2574	  2575	  2576	  2579	  2582	  2584	  2586
	  2594	  2595	  2596	  2597	  2599	  2600	  2608	  2610	  2611	  2615	  2616	  2617	  2618	  2619
	  2620	  2624	  2625	  2628	  2629	  2631	  2633	  2634	  2635	  2648	  2664	  2685	  2687	  2700
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

	  2701	  2702
T2	   178	   194	   240	   242	   243	   245	   247	   253	   254	   256	   268	   272	   274	   276
	   313	   315	   316	   318	   320	   324	   325	   327	   338	   436	   437	   448	   451	   453
	   454	   455	   458	   459	   460	   464	   465	   466	   468	   470	   477	   485	   486	   487
	   489	   490	   500	   501	   504	   505	   506	   515	   521	   577	   723	   864	   865	   867
	   868	   872	   873	   945	   948	   950	   951	   953	   976	   977	   981	  1001	  1002	  1003
	  1021	  1081	  1087	  1089	  1090	  1092	  1094	  1095	  1096	  1097	  1106	  1107	  1108	  1114
	  1115	  1117	  1119	  1128	  1129	  1131	  1193	  1194	  1198	  1200	  1224	  1226	  1228	  1230
	  1231	  1232	  1233	  1243	  1246	  1253	  1258	  1267	  1274	  1276	  1287	  1306	  1314	  1318
	  1355	  1356	  1391	  1392	  1394	  1395	  1396	  1397	  1399	  1400	  1401	  1402	  1403	  1404
	  1405	  1407	  1408	  1498	  1503	  1546	  1551	  1573	  1574	  1575	  1576	  1640	  1641	  1649
	  1651	  1653	  1664	  1670	  1677	  1680	  1682	  1683	  1689	  1690	  1693	  1740	  1743	  1745
	  1749	  1750	  1769	  1772	  1774	  1805	  1818	  1887	  1890	  1891	  1893	  1894	  1896	  1897
	  1907	  1908	  1909	  1910	  1916	  1920	  1921	  1922	  1923	  1929	  1932	  1933	  1934	  1935
	  1936	  1937	  1938	  1940	  1943	  1944	  1945	  1950	  1951	  1952	  1953	  1954	  1955	  1976
	  1978	  1980	  2018	  2024	  2029	  2031	  2032	  2033	  2034	  2037	  2038	  2040	  2041	  2043
	  2044	  2046	  2047	  2057	  2074	  2075	  2144	  2145	  2154	  2159	  2171	  2172	  2173	  2174
	  2175	  2176	  2179	  2183	  2184	  2185	  2199	  2248	  2252	  2253	  2279	  2281	  2319	  2320
	  2324	  2326	  2327	  2328	  2387	  2388	  2389	  2452	  2453	  2454	  2455	  2458	  2464	  2465
	  2466	  2467	  2472	  2473	  2475	  2481	  2482	  2485	  2487	  2488	  2489	  2622	  2623	  2624
	  2626	  2627	  2628	  2673	  2674	  2676	  2677	  2678	  2679	  2680	  2682	  2690	  2691	  2694
	  2696	  2697	  2698
T3	   183	   307	   339	   383	   449	   462	   479	   480	   483	   497	   498	   510	   512	   514
	   516	   538	  1079	  1103	  1104	  1115	  1199	  1345	  1346	  1357	  1644	  1645	  1646	  1647
	  1648	  1650	  1658	  1659	  1665	  1666	  1667	  1672	  1673	  1674	  1675	  1676	  1684	  1686
	  1692	  1693	  1697	  1698	  1699	  1700	  1701	  1912	  1913	  1914	  1918	  1920	  1927	  1934
	  1954	  1962	  1963	  1964	  1966	  1967	  1976	  2015	  2016	  2072	  2177	  2198	  2278	  2459
	  2464	  2472	  2477	  2478	  2683	  2686	  2688	  2689	  2690
T4	   182	   184	   185	   187	   188	   189	   304	   378	   535	   964	   965	  1049	  1050	  1053
	  1054	  1342	  1351	  1495	  1496	  1533	  1559	  1560	  1668	  1669	  1910	  1911	  1921	  1922
	  1943	  1950	  1956	  2140	  2153	  2158	  2192	  2195	  2196	  2214	  2215	  2218	  2219	  2220
	  2222	  2223	  2225	  2567	  2568	  2639	  2643	  2647	  2694	  2700
TIMADJ	  1452%	  1452	  1478%	  1478	  2592%	  2592
TPOPJ	    54%	   744	   749	   812	   816	  1899
TRNERR	   667
TTCMCH	   497%	   497
U	   179	   244	   245	   271	   272	   273	   274	   275	   276	   303	   317	   318	   377	   533
	  1086	  1100	  1341	  1350	  1443	  1444	  1451	  1477
UGETHI	  2557#
UGTSEG	  2558#
UNMDN	   513	   519#
UPTALD	  1338%	  1341
UPTALN	  1338%	  1343
UPTALP	  1338%	  1342
UPTHRL	    41%	   948	   976	  1016	  1274	  1822	  1907	  2081	  2206	  2324	  2348	  2505
UPTJDA	    41%	   878	   895	   960	  1459	  2170	  2182	  2217	  2581
UPTMFR	  1637%	  1700	  1701
UPTPDL	    41%	   867	   880	  1128	  1489	  2519	  2596	  2598	  2611
UPTPID	    42%	   441	  1706
UPTREL	    41%	   582	  1244	  1580	  1803	  1902	  2319	  2508
UPTSPD	    42%	   442	  1707
UPTSTS	    40%	   635	   985	  1110	  1272	  1494	  1668	  2209	  2510	  2595	  2685
UPTSTV	    42%	  1708
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

UPTXAC	    41%	   299	   300	   302	   303	   304	   305	   306	   307	   312	   329	   533	   534	   535
	   536	   537	   538	   539	   540
UREMAP	  2415#
UREMP2	  2439#
UREMP3	  2464#	  2479
UREMP4	  2471#
UREMP5	  2471	  2477#
UREMP6	  2483	  2487#
UREMP7	  2457	  2500#
URMPFX	  2449	  2456	  2469	  2476	  2486	  2513#
URUN	  1376	  1378#
URUN1B	  1393	  1396#
URUN2	  1398	  1401#
URUN4	  1403#
URUNCT	    65#	  1385
URUNHI	  2550#
USPY	  1722#
USRXIT	   881%	   881	  1132%	  1132	  1409%	  1409
USTUW0	  2666	  2673#
USTUW1	  2684	  2690#
USTUW2	  2694#
USTUW3	  2704#
USTUWP	  2663#
UUPPID	   694%	   694
W	   191	   192	   232	   233	   250	   259	   311	   312	   329	   373	   443	   445	   446	   534
	   586	   587	   588	   589	  1349	  1745	  1746	  1747	  1748	  1751	  1774	  1775	  1776	  1777
	  1778	  1779	  1780	  1783	  1784	  1785	  2278	  2281	  2282	  2283	  2285	  2286	  2287	  2291
	  2292	  2293	  2296
WAKFLG	  2634
WS.ADD	    58%	  1784	  1944	  2184	  2292	  2488
WSATM%	    58%	  1788	  2188	  2492
XGADEV	   440	   451	   501	   533#
XGAEXT	   470	   536#
XGAMOD	   446	   534#
XGANAM	   459	   537#
XGANEW	   489	   538#
XGAPPN	   456	   473	   505	   535#
XGAUN1	   503	   507	   539#
XGAUN2	   508	   540#
XPAALP	   110#
XPAAUT	   106#
XPACOM	   129#	   609	   953	  1082	  1107	  1894	  1932	  1948	  1953	  1975
XPADEV	    90#	   224	   338	   377	   781
XPAELB	   100#
XPAEXT	    94#	   672	   689	   705	   866
XPAHPD	   128#	  1545	  1658	  1665	  2620
XPALIC	   127#	   258	   384	  1525	  1541	  1653	  2616
XPALKB	    91#	    98	   121	   695	   699	   700
XPAMOD	    80#	   130	   337	   586	   589	  1527	  1543	  1652	  2618
XPAMXA	   104#
XPANAM	    93#	   226	   347	   379	   671	   798	  1133	  1292
XPANEW	   126#	   228	   383	   743	  1640	  2034	  2035	  2250	  2254
XPAPID	   115#	  1544	  1659	  1660	  1666	  1695	  1705	  2619
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

XPAPJ1	   113#
XPAPJ2	   114#
XPAPJC	   112#
XPAPPN	    92#	   225	   350	   378	   690	   693
XPAPRV	    96#	   696	   697	   707
XPAQTF	   102#
XPAQTO	   103#
XPASIZ	    97#	   706
XPASNM	   111#
XPASTS	    99#	   702
XPATRU	   108#
XPAUN1	   123#	   220	   352	   381	   692
XPAUN2	   124#	   221	   382
XPAUSD	   105#
XPAUXT	   125#	   227	   348	   380	   799	  1048	  1466	  1549
XPAXT1	   101#
XPAXT2	   109#
XPNCOR	    40%	   634	  1109	  1271
ZZ	   179#	   179	   180#	   180	   181#	   181	   182#	   182	   183#	   183	   187#	   187	   188#	   188
	   195#	   195	   240#	   240	   244#	   244	   271#	   271	   273#	   273	   313#	   313	   317#	   317
	   590#	   590	   599#	   599	   602#	   602	   603#	   603	   604#	   604	   810#	   810	   835#	   835
	   838#	   838	   842#	   842	   843#	   843	   872#	   872	   877#	   877	   956#	   956	   978#	   978
	   980#	   980	   981#	   981	   996#	   996	   998#	   998	   999#	   999	  1001#	  1001	  1002#	  1002
	  1003#	  1003	  1004#	  1004	  1006#	  1006	  1009#	  1009	  1014#	  1014	  1049#	  1049	  1073#	  1073
	  1074#	  1074	  1075#	  1075	  1076#	  1076	  1077#	  1077	  1078#	  1078	  1079#	  1079	  1089#	  1089
	  1094#	  1094	  1097#	  1097	  1100#	  1100	  1104#	  1104	  1192#	  1192	  1193#	  1193	  1194#	  1194
	  1220#	  1220	  1224#	  1224	  1231#	  1231	  1239#	  1239	  1250#	  1250	  1252#	  1252	  1254#	  1254
	  1257#	  1257	  1259#	  1259	  1264#	  1264	  1265#	  1265	  1269#	  1269	  1270#	  1270	  1276#	  1276
	  1380#	  1380	  1404#	  1404	  1520#	  1520	  1521#	  1521	  1546#	  1546	  1571#	  1571	  1572#	  1572
	  1573#	  1573	  1581#	  1581	  1802#	  1802	  1821#	  1821	  1901#	  1901	  1955#	  1955	  2029#	  2029
	  2030#	  2030	  2037#	  2037	  2080#	  2080	  2205#	  2205	  2381#	  2381	  2382#	  2382	  2383#	  2383
	  2386#	  2386	  2387#	  2387	  2388#	  2388	  2389#	  2389	  2391#	  2391	  2393#	  2393	  2394#	  2394
	  2419#	  2419	  2428#	  2428	  2504#	  2504	  2507#	  2507	  2567#	  2567	  2623#	  2623	  2624#	  2624
	  2625#	  2625	  2626#	  2626	  2627#	  2627	  2628#	  2628	  2629#	  2629	  2630#	  2630	  2680#	  2680
ZZ1	   179#	   179	   180#	   180	   181#	   181	   182#	   182	   183#	   183	   187#	   187	   188#	   188
	   195#	   195	   240#	   240	   244#	   244	   271#	   271	   273#	   273	   313#	   313	   317#	   317
	   590#	   590	   599#	   599	   602#	   602	   603#	   603	   604#	   604	   810#	   810	   835#	   835
	   838#	   838	   842#	   842	   843#	   843	   872#	   872	   877#	   877	   956#	   956	   978#	   978
	   980#	   980	   981#	   981	   996#	   996	   998#	   998	   999#	   999	  1001#	  1001	  1002#	  1002
	  1003#	  1003	  1004#	  1004	  1006#	  1006	  1009#	  1009	  1014#	  1014	  1049#	  1049	  1073#	  1073
	  1074#	  1074	  1075#	  1075	  1076#	  1076	  1077#	  1077	  1078#	  1078	  1079#	  1079	  1089#	  1089
	  1094#	  1094	  1097#	  1097	  1100#	  1100	  1104#	  1104	  1192#	  1192	  1193#	  1193	  1194#	  1194
	  1220#	  1220	  1224#	  1224	  1231#	  1231	  1239#	  1239	  1250#	  1250	  1252#	  1252	  1254#	  1254
	  1257#	  1257	  1259#	  1259	  1264#	  1264	  1265#	  1265	  1269#	  1269	  1270#	  1270	  1276#	  1276
	  1380#	  1380	  1404#	  1404	  1520#	  1520	  1521#	  1521	  1546#	  1546	  1571#	  1571	  1572#	  1572
	  1573#	  1573	  1581#	  1581	  1802#	  1802	  1821#	  1821	  1901#	  1901	  1955#	  1955	  2029#	  2029
	  2030#	  2030	  2037#	  2037	  2080#	  2080	  2205#	  2205	  2381#	  2381	  2382#	  2382	  2383#	  2383
	  2386#	  2386	  2387#	  2387	  2388#	  2388	  2389#	  2389	  2391#	  2391	  2393#	  2393	  2394#	  2394
	  2419#	  2419	  2428#	  2428	  2504#	  2504	  2507#	  2507	  2567#	  2567	  2623#	  2623	  2624#	  2624
	  2625#	  2625	  2626#	  2626	  2627#	  2627	  2628#	  2628	  2629#	  2629	  2630#	  2630	  2680#	  2680
%UPLMA	    41%	   575
%UPS	    40%	   441	   442	   533	   534	   535	   536	   537	   538	   539	   540
%UPT	    40%	   312	   582	   635	   867	   878	   880	   895	   948	   960	   976	   985	  1016	  1110
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Symbol cross reference

	  1128	  1244	  1272	  1274	  1341	  1342	  1343	  1459	  1489	  1494	  1580	  1637%	  1668	  1700	  1701
	  1706	  1707	  1708	  1803	  1822	  1902	  1907	  2081	  2170	  2182	  2206	  2209	  2217	  2319
	  2324	  2348	  2505	  2508	  2510	  2519	  2581	  2595	  2596	  2598	  2611	  2685
%UPX	   297%	   299	   300	   302	   303	   304	   305	   306	   307	   329
.ARSIZ	  1701
.WSRNG	    57%	  1785	  1945	  2185	  2293	  2489
SEGCON - SEGCON FOR PAGING SYSTEM VERS 2 AAA	MACRO 12.5-46.0 14:37 13-JAN-88
SEGCON.MAC	28-OCT-87 00:02		Macro/Opdef cross reference

CHANIO	  1929	  2179
NOCHAR	  1445
PAGSTS	  2674
PJRST	   673	   767	   782	   800	   827	  1135	  1144	  1294	  1361	  1406	  1528	  1583	  1594	  1806
	  1823	  2427	  2523	  2603
PRINTF	  1008	  2377	  2564	  2671
PXCT	   179	   180	   181	   182	   183	   187	   188	   195	   240	   244	   271	   273	   313	   317
	   590	   599	   602	   603	   604	   810	   835	   838	   842	   843	   872	   877	   956	   978
	   980	   981	   996	   998	   999	  1001	  1002	  1003	  1004	  1006	  1009	  1014	  1049	  1073
	  1074	  1075	  1076	  1077	  1078	  1079	  1089	  1094	  1097	  1100	  1104	  1192	  1193	  1194
	  1220	  1224	  1231	  1239	  1250	  1252	  1254	  1257	  1259	  1264	  1265	  1269	  1270	  1276
	  1380	  1404	  1520	  1521	  1546	  1571	  1572	  1573	  1581	  1802	  1821	  1901	  1955	  2029
	  2030	  2037	  2080	  2205	  2381	  2382	  2383	  2386	  2387	  2388	  2389	  2391	  2393	  2394
	  2419	  2428	  2504	  2507	  2567	  2623	  2624	  2625	  2626	  2627	  2628	  2629	  2630	  2680
PXGEN	   179	   180	   181	   182	   183	   187	   188	   195	   240	   244	   271	   273	   313	   317
	   590	   599	   602	   603	   604	   810	   835	   838	   842	   843	   872	   877	   956	   978
	   980	   981	   996	   998	   999	  1001	  1002	  1003	  1004	  1006	  1009	  1014	  1049	  1073
	  1074	  1075	  1076	  1077	  1078	  1079	  1089	  1094	  1097	  1100	  1104	  1192	  1193	  1194
	  1220	  1224	  1231	  1239	  1250	  1252	  1254	  1257	  1259	  1264	  1265	  1269	  1270	  1276
	  1380	  1404	  1520	  1521	  1546	  1571	  1572	  1573	  1581	  1802	  1821	  1901	  1955	  2029
	  2030	  2037	  2080	  2205	  2381	  2382	  2383	  2386	  2387	  2388	  2389	  2391	  2393	  2394
	  2419	  2428	  2504	  2507	  2567	  2623	  2624	  2625	  2626	  2627	  2628	  2629	  2630	  2680
STOPCD	    10	   261	   390	  1012	  1741	  1744	  1752	  1770	  1773	  1789	  1957	  1969	  2017	  2146
	  2189	  2227	  2249	  2280	  2289	  2494	  2675	  2704
UHLRZ	  2029	  2037
UHRRZ	  2030
UMOVE	   179	   180	   181	   182	   183	   187	   188	   240	   244	   271	   273	   313	   317	   599
	   604	   838	   842	  1073	  1077	  1193	  1224	  1380	  1520
UMOVEM	   877	  1074	  1078	  1104	  1194	  1270	  1521	  1901	  2080	  2205	  2680
UXCTBU	  1801	  2503
UXCTTU	  1820	  2506
VCLEAR	  1751
VCREAT	  1780	  2282
VPROT	   989	   993	  1011	  2069	  2455	  2691	  2698
VREMOV	  1956	  2475	  2485
VREPL	  2468
WSCTL	  1786	  1946	  2186	  2294	  2490
XCTBU	   195	   590	   602	   603	   810	   835	   843	   872	   956	   981	   996	   998	   999	  1001
	  1004	  1049	  1075	  1076	  1079	  1089	  1094	  1097	  1100	  1192	  1220	  1231	  1239	  1250
	  1252	  1254	  1257	  1259	  1264	  1265	  1269	  1276	  1404	  1546	  1571	  1572	  1581	  1802
	  1955	  2029	  2030	  2037	  2382	  2386	  2388	  2389	  2391	  2393	  2394	  2419	  2428	  2504
	  2567	  2623	  2625	  2626	  2627	  2629	  2630
XCTFU	   179	   180	   181	   182	   183	   187	   188	   240	   244	   271	   273	   313	   317	   599
	   604	   838	   842	   978	   980	  1002	  1014	  1073	  1077	  1193	  1224	  1380	  1520	  1573
	  2387	  2624	  2628
XCTTU	   877	  1003	  1006	  1009	  1074	  1078	  1104	  1194	  1270	  1521	  1821	  1901	  2080	  2205
	  2381	  2383	  2507	  2680
XX	   532#	   533	   534	   535	   536	   537	   538	   539	   540
$END	  2706 T 1
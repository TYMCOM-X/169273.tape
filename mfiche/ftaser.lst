FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.
     9				SUBTTL
    10
    11					STOPCD(,ENTRY,FTASER)^
    12					ENTRY	FTASER		;For library searches
    13	000000'	260040	000000*	FTASER::PUSHJ	P,DIE		;**** Default stopcode for "FTASER" ****
    14	000001'	466441	634562		SIXBIT	/FTASER/  	;Title of module
    15	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "FTASER+nnn(nnnnnn)"
    16			000000'	S$NAME==FTASER			;For STOPCDs with no arguments
    17					SALL>
    18				^
    19
    20				IFNCPU(<KI,KL>),<PRINTX FTASER works on KI and KL only>
    21
    22				COMMENT %@@MODULE FTASER
    23				@@PURPOSE DEVICE DEPENDENT CODE FOR THE IBM 3803/3420 FTAS ON
    24				THE PDP-10.
    25
    26				@@ENTRY ALL OF THE ROUTINES IN THIS MODULE EXPECT P TO BE
    27				A PDL AC.
    28
    29				@@TABLES ALMOST ALL OF THE ROUTINES IN THIS MODULE USE
    30				THE DDB AND UNIT DB.
    31
    32				@@FUNCTION THE DETAILED COMMAND CODES, ERROR BIT DEFINITIONS,
    33				ETC. CAN BE FOUND IN THE FIRST SEVERAL PAGES OF THE FTASER
    34				SOURCE LISTING.
    35
    36				@@RESTRICTIONS THE COMMENTS UNDER THE RESTRICTIONS HEADINGS
    37				FOR EACH SUBR IN THIS MODULE TO THE EFFECT THAT THE SUBR
    38				IS CALLED AT A GIVEN LEVEL MEANS THAT THAT IS THE LEVEL THAT
    39				IT IS PRESENTLY CALLED AT,  NOT THAT THAT IS THE ONLY
    40				LEVEL THAT IT COULD BE CALLED AT.  THIS HAS BEEN DONE BECAUSE
    41				IT WILL AID IN UNDERSTANDING THE FUNCTION OF THE SUBRS
    42				AND BECAUSE IN MANY CASES BECAUSE OF A ROUTINE'S FUNCTION IT
    43				WOULD BE NONSENSICAL TO CONSIDER CALLING IT AT A DIFFERENT
    44				LEVEL. @@%
    45
    46
    47				;EXTERNALS:
    48
    49				    ;IN CHANNEL DB.
    50					EXTERN CHNSTB,CHNGO,CHNCLR,CHNBMX,CHNIIE,CHNACT,CHNMER
    51
    52				    ;IN KONTROLLER DB.
    53					EXTERN KONBMX,KONBSU,KONPTR
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 1
FTASER.MAC	25-NOV-87 15:39		

    54					EXTERN FTXMCH,FTXSNS,FTXSTS,FTXSS1,FTXSS2
    55					EXTERN FTXSMY,FTXSM0,FTXBSY,FTXSPR,FTXSP1,FTXSX1
    56					EXTERN FTCMLN
    57
    58				    ;IN UNIT DB.
    59					EXTERN FTA0CB,FTADDS,FTA0DB,FTULNH
    60
    61					EXTERN DEVUDB,DEVCNT,DEVFNJ,DEVADD,DEVDWC,DEVACT
    62					EXTERN DEVER1,DEVER2,DEVNOI,DEVOUT,DEVINS,DEV40,DEVDIO
    63
    64					EXTERN UNIDDB,UNILNK,UNIKNT,UNIERO,UNICMD,UNIDON,UNITYP
    65					EXTERN UNIDCR,UNIDCN,UNIDC1,UNISX1,UNISX2,UNISX3
    66					EXTERN FDHFUN,FDHCNT,FDHCNI,FDNRE1,FDNWR1,FDMEMR
    67					EXTERN FDNREE,FDNWRE,FDERBT,FDCNI1,FDCNIE,FDSENS,FDSCHR
    68
    69				    ;OTHER.
    70					EXTERN SETHNG,PIOMOD,CPOPJ,CPOPJ1,WAIT1,OUT,SETIOD
    71					EXTERN HNGSTP,JBTIOA,PJOBN,SYDNM4,SYDCOM,JBTLIC,PWAIT1
    72					EXTERN DSKPIF,DSKPIN,PAGWAK,PGYDIO
    73
    74
    75				;INTERNALS:
    76
    77				    INTERN FTXINT,FTADSP,SYDFTA
    78
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 2
FTASER.MAC	25-NOV-87 15:39		

    79				;FORMAT OF SA-10 WORDS:
    80
    81				;    UNIT COMMAND LIST WORDS:
    82
    83				;        DEVICE COMMAND WORDS:
    84
    85				;            BITS	MEAN
    86				;            0		1=NO MEMORY TRANSFER, 0=MEM TRANS.
    87				;     	     1&4	00-WORD MODE
    88				;            		01-BYTE MODE
    89				;            		10-NATURAL MODE
    90				;            		11-TAPE COMPATABILITY MODE
    91				;            2		1=EXECUTE,0=HALT
    92				;            3		CHAIN TO NEXT COMMAND
    93				;            5		PROGRAM INTERRUPT
    94				;            6		1=IGNORE LENGTH ERR,0=DON'T IGNORE
    95				;            8-15	DEVICE COMMAND
    96				;            16-23	DEVICE ADDRESS
    97
    98				;        DATA WORDS:
    99
   100				;            BITS	MEAN
   101				;            0		1=THIS IS THE LAST DATA WORD IN THIS
   102				;	    		GROUP, 0=NOT LAST.
   103				;            1-11	2'S COMPLEMENT OF WORD/BYTE COUNT
   104				;            14-35	1ST MEM ADDR, UNLESS 0 & WE ARE READING
   105				;			FROM THE DEVICE, IN WHICH CASE MEANS
   106				;			NO DATA TRANSFER.
   107
   108				;        TRANSFERS IN CHANNEL:
   109
   110				;            BITS	MEAN
   111				;            0		MUST BE 0
   112				;            1		MUST BE 1
   113				;            14-35	ADDR OF NEXT COMMAND
   114
   115
   116				;    BMX WORDS:
   117
   118				;	     BITS	MEAN
   119				;	     0-7	DEVICE ADDRESS
   120				;	     8-11	1101-START DEVICE
   121				;	    		1110-WAITING ON DEVICE
   122				;	    		1111-TERMINATED DEVICE
   123				;	    		0000-END OF LIST
   124				;	     14-35	ADDR OF DEVICE(UNIT) CMD LST
   125
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 3
FTASER.MAC	25-NOV-87 15:39		

   126				;FORMAT OF SA-10 WORDS (CONT.):
   127
   128				;    INSTRUCTIONS:
   129
   130				;	 CONO:
   131
   132				;	     BITS	MEAN
   133				;	     18		RESET SA10
   134				;	     19		CLEAR MEMORY ERRORS
   135				;	     30		1(0)=SET(CLEAR) ACCORDING TO THE
   136				;	    		FOLLOWING BITS:
   137				;	    		    BIT		MEANS
   138				;	    		    26		1-CLOCK:
   139				;	    				    IF RUNNING:
   140				;	    					SET=NOOP
   141				;	    					CLEAR=STOP
   142				;	    				    IF NOT RUNNING:
   143				;	    					SET=START
   144				;	  	  				CLEAR=PULSE.
   145				;	    		    27-29	0-NOOP
   146				;	    				3-RESET THE CHANNEL
   147				;	    				SPECIFIED BY BITS 31&32.
   148				;	    				4-GO FLAG
   149				;	    				5-STATUS REQUEST FLAG
   150				;	    				6-STATUS FLAG
   151				;	    				7-INTERRUPT ENABLE FLAG.
   152				;	     31-32	CHANNEL
   153				;	     33-35	PIA
   154
   155				;	 CONI:
   156
   157				;	     BITS	MEAN
   158				;	     18		PI REQUEST
   159				;	     19		P.E.
   160				;	     20		NXM
   161				;	     21-24	INTERRUPT ENABLE ON CHAN 0,1,2,3.
   162				;	     25-28	GO FLAG          "    "        "
   163				;	     29-32	STATUS FLAG      "    "        "
   164				;	     33-35	PIA
   165
   166				;	 DATAI:
   167
   168				;	     READS ONE OF 6 WORDS:
   169				;	        WORD	BITS OF INTEREST
   170				;		0	-
   171				;		1	16-35 MEM ADDR FOR WHICH WE GOT A MEM ERR.
   172				;		2	16&17 CHANNEL FOR WHICH WE GOT A MEM ERR.
   173				;		3-5	-
   174				;	     (TO SELECT THE WORD READ, DO A CONO CLR+NOOP+BITS
   175				;	      30-32 SPECIFYING THE WORD NUMBER.)
   176
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 4
FTASER.MAC	25-NOV-87 15:39		

   177				;FLAGS:
   178
   179				    ;FOR UNIT CMDS:
   180
   181			400000		NOMXFR==400000
   182			100000		EXECUT==100000
   183			040000		CMDCHN==40000
   184			010000		FRCINT==10000
   185			004000		IGNLEN==4000
   186			002000		OFFSET==2000
   187			540000		    CNEXNO==CMDCHN!EXECUT!NOMXFR
   188
   189					;DATA MODES.
   190			220000		    MODE9D==220000
   191			020000		    MODE9I==020000
   192			200000		    MODE7==200000
   193			020000		    MODE7I==020000
   194
   195					;CMDS, SHIFTED FOR BITS 8-15, PLUS OTHER FLAGS.
   196			540114		    MS7T2==CNEXNO!114
   197			540514		    MS7T5==CNEXNO!514
   198			541114		    MS7T8==CNEXNO!1114
   199			540214		    MS7TE2==CNEXNO!214
   200			540614		    MS7TE5==CNEXNO!614
   201			541214		    MS7TE8==CNEXNO!1214
   202			540314		    MS7TO2==CNEXNO!314
   203			540714		    MS7TO5==CNEXNO!714
   204			541314		    MS7TO8==CNEXNO!1314
   205			541454		    MS9T8==CNEXNO!1454
   206			541414		    MS9T16==CNEXNO!1414
   207			541514		    MS9T62==CNEXNO!1514
   208			160020		    SENSE==EXECUT!CMDCHN!MODE9I!20
   209			540034		    REW==CNEXNO!34
   210			500034		    REWNCH==EXECUT!NOMXFR!34
   211			540174		    WTM==CNEXNO!174
   212			540334		    SKR==CNEXNO!334
   213			540234		    BSR==CNEXNO!234
   214			540074		    REWUNL==CNEXNO!74
   215			500074		    RWUNCH==EXECUT!NOMXFR!74
   216			540134		    ERG==CNEXNO!134
   217			140010		    READFW==EXECUT!CMDCHN!10
   218			000014		    READBK==14
   219			144004		    WRITE==EXECUT!CMDCHN!IGNLEN!4
   220			162154		    TIE==EXECUT!CMDCHN!MODE9I!OFFSET!154
   221
   222				    ;FOR TRANSFERS IN CHANNEL:
   223			200000		TIC==200000
   224
   225
   226				    ;FOR DATA WORDS:
   227			400000		LASDAT==400000
   228
   229
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 4-2
FTASER.MAC	25-NOV-87 15:39		

   230				    ;FOR HALTS:
   231			400000		HALT==400000
   232
   233
   234				    ;FOR BMX WORDS:
   235			000015		STRTDV==15
   236			000017		TERMDV==17
   237
   238
   239				    ;TO SET UP BMX MODE:
   240			400000		BMX==400000
   241
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 5
FTASER.MAC	25-NOV-87 15:39		

   242				;FLAGS (CONT.):
   243
   244				    ;FOR CONOS:
   245			400000		CLERSA==400000
   246			200000		CLRMER==200000
   247
   248				    ;FOR CONIS:
   249			300000		MEMERR==300000
   250
   251				    ;IN THE FIRST STATUS WORD:
   252			400000		ASYNCH==400000
   253			100000		SELERR==100000
   254			040000		 BUSIN==40000
   255			020000		CNTLER==20000
   256			004000		LENERR==4000
   257			002000		PRGINT==2000
   258			001000		  ATTN==1000
   259			000400		STAMOD==400
   260			000200		 CUEND==200
   261			000100		  BUSY==100
   262			000040		CHNEND==40
   263			000020		DEVEND==20
   264			000010		UNITCK==10
   265			000004		UNITEX==4
   266
   267				    ;IN BYTE 0 OF SENSE DATA.
   268				    ;(ASSUMING BYTE 0 IS LEFT-ADJUSTED).
   269			400000		CMDREJ==400000
   270			200000		INTREQ==200000
   271			100000		BUSOUT==100000
   272			040000		EQPCHK==40000
   273			020000		DATCHK==20000
   274			010000		OVERUN==10000
   275			002000		CNVCHK==2000
   276
   277				    ;FOR UNIT/KONTROLLER CHARACTERISTICS:
   278				    ;(RETURNED TO THE USER BY A UGETF, AND SOME ALSO KEPT IN
   279				    ;LH(UNITYP) FOR THE UNIT AND LH(FTXMCH) FOR THE KONT.).
   280			400000		WRPROT==400000
   281			200000		TUA==200000
   282			100000		TUB==100000
   283			000002		READY==2
   284			040000		LOADPT==40000
   285			020000		TAPEIN==20000
   286			010000		IBMCMP==10000
   287			000100		TRK9==100  ;(JUST FOR KONTROLLER).
   288			000040		TRK7==40
   289			000020		DS6250==20
   290			000010		DS1600==10
   291			000004		DS800==4
   292			000002		DS556==2
   293			000001		DS200==1
   294
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 5-2
FTASER.MAC	25-NOV-87 15:39		

   295				    ;IN S.
   296			400000		COMPAT==400000
   297			200000		HNGFTA==200000
   298			100000		IOLEND==100000
   299
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 6
FTASER.MAC	25-NOV-87 15:39		

   300				;BYTE POINTERS FOR SENSE DATA.
   301
   302					;WHEN SENSING INTO UNIT CMD AREA.
   303	000003'	300110	000003*	BYUUN7:	POINT 1,UNICMD+3(T3),^D11    ;UNIT HAS 7 TRACK CAPABILITY.
   304	000004'	270110	000003*	BYULDP: POINT 1,UNICMD+3(T3),^D12    ;LOAD POINT.
   305	000005'	310210	000003*	BYUTAB: POINT 2,UNICMD+3(T3),^D10    ;TU A AND B.
   306	000006'	250110	000003*	BYUWPT: POINT 1,UNICMD+3(T3),^D14    ;FILE PROTECTED.
   307	000007'	410110	000004*	BYUTIN: POINT 1,UNICMD+4(T3),2       ;TAPE INDICATE.
   308	000010'	210110	000004*	BYUDUL:	POINT 1,UNICMD+4(T3),^D18    ;UNIT IS DUAL DENSITY.
   309	000011'	170110	000004*	BYUMDL:	POINT 1,UNICMD+4(T3),^D20    ;UNIT MODEL NUMBER.
   310	000012'	270110	000005*	BYUK62:	POINT 1,UNICMD+5(T3),^D12    ;KONT CAN 6250.
   311	000013'	320210	000006*	BYUK79:	POINT 2,UNICMD+6(T3),9       ;KONT NRZI CAPABILITY.
   312
   313					;WHEN SENSING INTO THE KONT. DB.
   314	000014'	330102	000000*	BYKNOI: POINT 1,FTXSTS(J),8	     ;NOISE BIT.
   315	000015'	270102	000014*	BYKLDP:	POINT 1,FTXSTS(J),^D12       ;LOAD POINT.
   316	000016'	240102	000015*	BYKNTC:	POINT 1,FTXSTS(J),^D15       ;NOT CAPABLE.
   317	000017'	300102	000001*	BYKIDB:	POINT 1,FTXSTS+1(J),^D11     ;ID BURST CHECK.
   318	000020'	200102	000001*	BYK160: POINT 1,FTXSTS+1(J),^D19     ;MODE OF TAPE UNIT,
   319								     ;DEPENDING ON MODEL NO.
   320	000021'	140402	000001*	BYKMDL: POINT 4,FTXSTS+1(J),^D23     ;UNIT MODEL NO.
   321
   322
   323				;FLAGS FOR KONTROLLER MODELS:
   324			000001	    MODEL1==1
   325			000002	    MODEL2==2
   326
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 7
FTASER.MAC	25-NOV-87 15:39		

   327				;"FUNCTIONS IN PROGRESS" ARE:
   328				;    (ORDER OF ASSIGNMENTS MATTERS):
   329
   330			000001	    FNPREW==1	;REWIND.
   331			000002	    FNPWTM==2	;WTM.
   332			000003	    FNPSKR==3	;SKR.
   333			000004	    FNPBSR==4	;BSR.
   334			000005	    FNPRWU==5	;REWIND/UNLOAD.
   335			000006	    FNPERG==6	;ERG.
   336			000007	    FNPSKF==7	;SKF.
   337			000010	    FNPBSF==10	;BSF.
   338			000011	    FNPUGF==11	;UGETF OR MTAPE SENSE.
   339			000012	    FNPRED==12	;READ.
   340			000013	    FNPWRT==13	;WRITE.
   341
   342
   343				;TABLE USED BY VARIOUS PLACES (MTAPE FNS, CMD SEQUENCE
   344				;GENERATORS, ETC.).
   345				;    (ORDER OF TABLE MATTERS):
   346
   347	000022'			    FT1TBL:
   348	000022'	000000	500034	    TBLREW: REWNCH
   349	000023'	000000	540174	    TBLWTM: WTM
   350	000024'	000000	540334	    TBLSKR: SKR
   351	000025'	000000	540234	    TBLBSR: BSR
   352	000026'	000000	500074	    TBLRWU: RWUNCH
   353	000027'	000000	540134	    TBLERG: ERG
   354	000030'	000000	162154	    TBLTIE: TIE
   355
   356
   357				;MISC.:
   358
   359	000031'	777777	740000	    MSKCTD: XWD 777777,740000	;MASK TO CHANGE THE COUNT BYTE
   360								;FROM THE DDB INTO A NUMBER.
   361	000032'	777777	774000	    MSKCTU: XWD 777777,774000	;MASK TO CHANGE THE COUNT BYTE
   362								;FROM UNIT CMD WORD INTO A NUMBER.
   363			777760	    MSKMMD==777760		;MASKS OUT ALL BUT MEM ADDR
   364								;FROM DDB WORDS.
   365			777700	    MSKMMU==777700		;MASKS OUT ALL BUT MEM ADDR
   366								;FROM UNIT CMD WORDS.
   367	000033'	777777	774000	    DATASZ: XWD 777777,774000	;-(2**11).
   368
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 8
FTASER.MAC	25-NOV-87 15:39		

   369				;ERROR RETRY COUNTS.
   370			000012	    INSERR==^D10
   371			000017	    NOISE==^D15
   372			000017	    OUTERR==^D15
   373
   374				;INTERRUPT ERROR FLAGS.
   375				;    (ORDER OF ASSIGNMENT MATTERS).
   376				;    (MINUS ERRORS ARE FATAL):
   377		777777	777777	    ERSELE==-1		;SELECT ERROR.
   378		777777	777776	    ERBSIN==-2		;BUS IN PARITY ERROR.
   379		777777	777775	    ERCNTL==-3		;CONTROL ERROR.
   380		777777	777774	    EREQCK==-4		;EQUIPMENT CHECK.
   381		777777	777773	    ERINRQ==-5		;INTERVENTION REQUIRED.
   382		777777	777772	    ERCMRJ==-6		;CMD REJECT.
   383		777777	777771	    ERNTCP==-7		;NOT CAPABLE.
   384		777777	777770	    ERSPBY==-8		;SPUROUS BUSY.
   385		777777	777767	    ERCNSN==-9		;CAN'T SENSE OR DEVICE BUSY.
   386			000012	    ERMEMR==^D10	;MEMORY ERROR.
   387			000013	    ERBSOU==^D11	;BUS OUT CHECK.
   388			000014	    EROVRN==^D12	;OVERRUN.
   389			000015	    ERDCER==^D13	;DATA CHECK--ERASE GAP.
   390			000016	    ERWWTM==^D14	;DATA CHECK-WRITE/WRITE TAPE MARK.
   391			000017	    ERDCRE==^D15	;DATA CHECK--READING.
   392			000020	    ERIDBR==^D16	;ID BURST CHECK.
   393			000021	    ERPRGI==^D17	;THIS IS JUST FOR FDERBT PURPOSES.  IT
   394							;MEANS WE PROCESSED A PROGRAM INTRPT
   395							;THAT HAD UNIT EXCEPTION ON.
   396
   397
   398				;ERROR LOGGING.
   399
   400				    ;FDHFUN--FN IN PROGRESS AT HUNG.
   401				    ;FDHCNT--NO. OF HUNGS.
   402				    ;FDHCNI--CONI AT HUNG.
   403
   404				    ;FDNRE1--NO. OF FAILS ON 1ST ATTEMPTS TO READ A RECORD.
   405				    ;FDNWR1-- "  "    "    "  "     "     " WRITE "   "
   406				    ;FDNREE--NO. OF FAILS ON ALL ATTEMPTS TO READ A RECORD.
   407				    ;FDNWRE-- "   "   "    "  "       "    " WRITE "   "
   408
   409				    ;FDERBT--HAS A BIT SET FOR EACH ERROR WE EVER SEE (BIT IS
   410				             ;ABS. MAGNITUDE OF ERXXXX).
   411
   412				    ;FDCNI1--ERROR BIT FOR LAST 1ST FAILURE ON A CMD.
   413				    ;FDCNIE--ERROR BIT FOR LAST TOTAL FAILURE ON A CMD.
   414
   415				    ;FDSENS--SENSE BYTES FROM THE LAST GOOD SENSE DUE TO A
   416					     ;UNIT CHECK.
   417
   418				    ;DEVSTS--LH IS LIKE FDERBT; RH IS INCREMENTED EVERYTIME
   419				    	     ;FDNRE1 OR FDNWR1 IS INCREMENTED.  DEVSTS IS
   420					     ;CLEARED AT RELEASE.
   421
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 9
FTASER.MAC	25-NOV-87 15:39		

   422
   423				;DISPATCH TABLE.
   424
   425	777776				PHASE -2
   426	000034'	254000	000772'	DDO:	JRST FTAWRT
   427	000035'	254000	000771'	DDI:	JRST FTARED
   428	000036'				DEPHASE
   429	000000			FTADSP:	PHASE 0
   430	000036'	000000	000015	DDXZ:	DSPSIZ
   431	000037'	263040	000000	DDINT:	POPJ P,
   432	000040'	004400	004400	DBYT:	4400,,4400
   433	000041'	201300	000000*	DVSIZ:	MOVEI T1,FTADDS
   434	000042'	254000	000054'	DINI:	JRST FTAINI
   435	000043'	254000	000353'	DHNG:	JRST FTAHNG
   436	000044'	254000	000313'	DRL:	JRST FTAREL
   437	000045'	254000	000321'	DCL:	JRST FTACLS
   438	000046'	254000	000772'	DOU:	JRST FTAWRT
   439	000047'	254000	000771'	JRST FTARED
   440	000050'	263040	000000	DZAP:	POPJ P,
   441	000051'	254000	001141'	DGTRD:	JRST FTAGRD
   442	000052'	254000	000644'	DMT:	JRST FTAPE
   443	000053'	254000	000552'	DGF:	JRST FTAUGF
   444			000015		DSPSIZ==.-1
   445	000054'				DEPHASE
   446
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 10
FTASER.MAC	25-NOV-87 15:39		

   447
   448				COMMENT %@@SUBROUTINE FTAINI
   449
   450				@@PURPOSE INITIALIZATION ROUTINE.
   451
   452					(1) SETS UP UNIT 7/9 TRK AND DENSITY INFO IN LH(UNITYP)
   453					    OR ZEROES IT TO MARK THAT THE UNIT NEEDS INITIAL-
   454					    IZATION.
   455					(2) SETS UP PART OF DEVICE LIST ENTRY FOR ALL DEVICES
   456					    WHOSE KONTROLLER IS ACCESSIBLE.
   457
   458				@@ACCUM DESTROYS T1, T2, AND T3.
   459				@@FUNCTION
   460				SENSES EACH UNIT (GIVES UP ON ALL UNITS ON A GIVEN KONTROLLER
   461				IF IT CAN'T ACCESS THE KONTROLLER FOR ONE OF THE UNITS)
   462				TO DETERMINE THE INFORMATION NECESSARY TO SET UP UNITYP.
   463				RETRIES A FEW TIMES IF NECESSARY.
   464
   465				@@EXIT SEE PURPOSE.
   466
   467				@@CALLS SUBRSN, SFISKN, AND SFISUN, AND ITS OWN ROUTINE SCLRCH
   468				(WHICH CLEARS THE STATUS FLAG FOR A CHANNEL).
   469
   470				@@ERRORS
   471				IF A KONTROLLER IS INACCESSIBLE OR ALWAYS RETURNS
   472				ERRORS, ALL OF ITS UNITS ARE MARKED INACCESSIBLE BY
   473				SETTING LH(UNITYP) IN THEIR UNIT DBS TO 0.  IF A UNIT IS IN-
   474				ACCESSIBLE OR ALWAYS RETURNS ERRORS, OR IF IT CANNOT BE
   475				USED FOR SOME OTHER REASON (EX: HAS NRZI ONLY AND KONTROLLER
   476				DOES NOT HANDLE NRZI) ITS LH(UNITYP) IS ALSO SET TO 0.
   477				(WHENEVER A USER ATTEMPTS TO USE A UNIT WITH 0 IN THE LH(UNITYP)
   478				AN ATTEMPT WILL BE MADE TO INITIALIZE LH(UNITYP) BY THE ROUTINE
   479				SAVAIL.).
   480
   481				@@RESTRICTIONS CALLED BY SYSINI, WITH THE PI SYSTEM OFF. @@%
   482
   483
   484				COMMENT %@@SUBROUTINE SFISKN
   485				@@PURPOSE ORIGINALLY THIS WAS A PART OF THE SYSTEM INITIALIZATION
   486				ROUTINE.  IT AND SFISUN WERE MADE INTO SUBRS SO THEY COULD ALSO
   487				BE CALLED IF THE UNITS BECAME AVAILABLE AFTER THE SYSTEM
   488				CAME UP.
   489				@@ENTRY EXPECTS T2=KONT DB, T3=UNIT DB, AND THE SENSE INFORMATION
   490				IN ITS USUAL PLACE IN THE UNIT COMMAND LIST AREA.
   491				@@ACCUM DESTROYS T1.
   492				@@FUNCTION SAVES THE KONT 6250 CAPABILITY AND KONT NRZI (7 OR 9
   493				TRACK) CAPABILITY BITS IN BOTH LH(FTXMCH) AND T4.
   494				@@EXIT SEE FUNCTION.
   495				@@RESTRICTIONS CALLED AT SYSTEM INITIALIZATION TIME OR AT UUO
   496				LEVEL. @@%
   497
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 11
FTASER.MAC	25-NOV-87 15:39		

   498				COMMENT %@@SUBROUTINE SFISUN
   499				@@PURPOSE ORIGINALLY THIS WAS A PART OF THE SYSTEM INITIALIZATION
   500				ROUTINE.  IT AND SFISKN WERE MADE INTO SUBRS SO THEY COULD ALSO
   501				BE CALLED IF THE UNITS BECAME AVAILABLE AFTER THE SYSTEM
   502				CAME UP.
   503				@@ENTRY EXPECTS T3=UNIT DB, T4=LH(FTXMCH), AND THE SENSE
   504				INFORMATION IN ITS USUAL PLACE IN THE UNIT'S COMMAND LIST
   505				AREA.
   506				@@ACCUM DESTROYS T2.
   507				@@FUNCTION SETS UP T1 AND THE LH(UNITYP) WITH DENSITY AND 7
   508				TRACK INFO FOR THE UNIT.
   509				@@EXIT SEE FUNCTION.
   510				@@RESTRICTIONS CALLED AT SYSTEM INITIALIZATION TIME OR AT UUO
   511				LEVEL. @@%
   512	000054'	261040	000016	FTAINI:	PUSH	P,P3
   513	000055'	261040	000011		PUSH	P,T4
   514	000056'	261040	000005		PUSH	P,U
   515	000057'	261040	000004		PUSH	P,F
   516	000060'	201400	000000*		MOVEI	T3,FTA0CB	;T3=UNIT DB.
   517	000061'	202400	000301'		MOVEM	T3,FIUNIT
   518	000062'	200350	000000*		MOVE	T2,UNIKNT(T3)	;T2=CHN DB,,KONT DB.
   519
   520				    ;LOOK AT THE NEXT KONTROLLER.
   521	000063'	202340	000302'	FINXKN:	MOVEM	T2,FIKONT
   522	000064'	402000	000304'		SETZM	FIFLAG		;MARK AS 1ST LOOK AT KONT.
   523	000065'	554307	000000*		HLRZ	T1,KONBMX(T2)	;ADJUST
   524	000066'	271300	000001		ADDI	T1,1		;FOR SPECIAL SENSE
   525	000067'	506307	000065*		HRLM	T1,KONBMX(T2)	;LOCATION.
   526	000070'	550307	000000*		HRRZ	T1,FTXMCH(T2)	;CHAN. NO. (STATUS FLAG.).
   527	000071'	202300	000303'		MOVEM	T1,FICHAN	;SAVE IT.
   528	000072'	554440	000007		HLRZ	T4,T2		;GET CHANNEL DB.
   529	000073'	200251	000000*		MOVE	U,CHNSTB(T4)	;U=4 WORD AREA ADDRESS+1.
   530	000074'	201711	000000*		MOVEI	P3,CHNBMX(T4)	;SET CHANNEL
   531	000075'	505700	600000		HRLI	P3,TIC!BMX	;TO BMX
   532	000076'	202705	777777		MOVEM	P3,-1(U)	;MODE.
   533	000077'	400700	000000		SETZ	P3,		;UNIT 0.
   534	000100'	510311	000000*		HLLZ	T1,CHNCLR(T4)	;RESET
   535	000101'	660300	400000		TRO	T1,CLERSA	;THE
   536	000102'	256000	000006		XCT	T1		;SA10.
   537	000103'	553010	000000*	FINXUN:	HRRZS	UNITYP(T3)	;ZERO THE UNIT CHARACTERISTICS.
   538	000104'	201440	000012		MOVEI	T4,^D10		;COUNT OF ERROR RETRIES
   539	000105'	202440	000305'		MOVEM	T4,FIRTCN	;ALLOWED EACH UNIT.
   540	000106'	200210	000000*		MOVE	F,UNIDDB(T3)
   541	000107'	260040	003045'		PUSHJ	P,SUBRSN	;GEN SENSE/DW/HALT.
   542	000110'	402005	000000		SETZM	(U)		;JUST TO BE SAFE.
   543	000111'	554307	000067*		HLRZ	T1,KONBMX(T2)	;GET BMX
   544	000112'	271316	000000		ADDI	T1,(P3)		;ADDR.
   545	000113'	550447	000000*		HRRZ	T4,KONBSU(T2)	;DEV
   546	000114'	271456	000000		ADDI	T4,(P3)		;ADDR
   547	000115'	402006	000000		SETZM	(T1)		;TO
   548	000116'	137440	004177'		DPB	T4,[POINT 8,(T1),7] ;DEV LIST.
   549
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 12
FTASER.MAC	25-NOV-87 15:39		

   550	000117'	201450	000000*	FIGO:	MOVEI	T4,UNICMD(T3)	;POINT THE DEV LIST
   551	000120'	542446	000000		HRRM	T4,(T1)		;ENTRY TO THE UNIT CMD LIST.
   552	000121'	201440	000015		MOVEI	T4,STRTDV	;PUT START INTO THE DEV
   553	000122'	137440	004200'		DPB	T4,[POINT 4,(T1),^D11] ;LIST.
   554	000123'	554440	000007		HLRZ	T4,T2		;T4=CHAN DB.
   555	000124'	200451	000000*		MOVE	T4,CHNGO(T4)	;GO, BUT
   556	000125'	620440	000007		TRZ	T4,7		;TURN OFF
   557	000126'	256000	000011		XCT	T4		;PIA FIELD.
   558
   559				    ;WAIT.
   560	000127'	661440	000040		TLO	T4,40		;CHANGE TO CONI.
   561	000130'	541440	000006		HRRI	T4,T1		;CONI SAXN,T1.
   562	000131'	201340	141520		MOVEI	T2,^D50000	;WAIT COUNT.
   563	000132'	256000	000011	FIWAIT:	XCT	T4		;DO CONI.
   564	000133'	612300	000303'		TDNE	T1,FICHAN	;STATUS FLAG FOR THIS CHN UP?
   565	000134'	254000	000147'		JRST	FILOOK		;YES.
   566	000135'	367340	000132'		SOJG	T2,FIWAIT	;MAYBE TRY AGAIN.
   567
   568				    ;HERE ON NO STATUS FLAG AFTER A LONG WHILE.
   569	000136'	550410	000000*	FIDIE:	HRRZ	T3,UNILNK(T3)	;GET NEXT UNIT.
   570	000137'	322400	000274'		JUMPE	T3,FINOUT	;JUMP IF NONE LEFT.
   571	000140'	200350	000062*		MOVE	T2,UNIKNT(T3)	;GET KONT.
   572	000141'	312340	000302'		CAME	T2,FIKONT	;SAME AS LAST KONT?
   573	000142'	254000	000145'		JRST	FIDIE2		;NO, SO CAN TRY THIS UNIT.
   574	000143'	553010	000103*		HRRZS	UNITYP(T3)	;YES.  MAKE UNIT UNAVAILABLE.
   575	000144'	254000	000136'		JRST	FIDIE		;GO TO NEXT UNIT.
   576	000145'	202400	000301'	FIDIE2:	MOVEM	T3,FIUNIT	;TRY THIS
   577	000146'	254000	000063'		JRST	FINXKN		;KONTROLLER.
   578
   579
   580				    ;HERE WITH FIFLAG=0(1ST TRY AT A KONT) OR =-1 (NOT FIRST).
   581	000147'	200445	000000	FILOOK:	MOVE	T4,(U)		;GET 1ST STATUS WORD.
   582	000150'	200340	000302'		MOVE	T2,FIKONT	;RESTORE T2/CHANNEL,,KONT.
   583	000151'	606300	300000		TRNN	T1,MEMERR	;ERRORS?
   584	000152'	603440	163100		TLNE	T4,SELERR!BUSIN!CNTLER!PRGINT!ATTN!BUSY
   585	000153'	254000	000160'		JRST	FIRTRY		;RETRY.
   586	000154'	336000	000304'		SKIPN	FIFLAG		;NEED TO SET UP KONT?
   587	000155'	254000	000204'		JRST	FISEKN		;YES.
   588	000156'	554447	000070*		HLRZ	T4,FTXMCH(T2)	;NO.
   589	000157'	254000	000223'		JRST	FISETU		;SET UP UNIT INFO.
   590
   591				    ;HERE ON RETRY.
   592	000160'	603440	000100	FIRTRY:	TLNE	T4,BUSY		;SPURIOUS
   593	000161'	607440	000400		TLNN	T4,STAMOD	;CU BUSY?
   594	000162'	254000	000176'		JRST	FIRTR2		;NO.
   595	000163'	260040	000306'		PUSHJ	P,SCLRCH	;YES, CLEAR THE STATUS FLAG.
   596	000164'	261040	000007		PUSH	P,T2		;SAVE T2.
   597	000165'	201340	141520		MOVEI	T2,^D50000	;WAIT FOR
   598	000166'	510311	000124*		HLLZ	T1,CHNGO(T4)	;THE STATUS FLAG TO BE STORED.
   599	000167'	661300	000040		TLO	T1,40		;MAKE THIS
   600	000170'	541300	000011		HRRI	T1,T4		;A
   601	000171'	256000	000006		XCT	T1		;CONI T4.
   602	000172'	616440	000303'		TDNN	T4,FICHAN	;STATUS FLAG THERE?
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 12-2
FTASER.MAC	25-NOV-87 15:39		

   603	000173'	367340	000171'		SOJG	T2,.-2		;NO, LOOK AGAIN.
   604					JUMPE	T2,[POP P,T2	;RESTORE T2.
   605	000174'	322340	004201'			JRST FIDIE]	;GO DIE IF NO STATUS.
   606	000175'	262040	000007		POP	P,T2		;RESTORE T2.
   607	000176'	377000	000305'	FIRTR2:	SOSG	FIRTCN		;RETRIES LEFT?
   608	000177'	254000	000264'		JRST	FIGTN2		;NO.
   609	000200'	260040	000306'	FIRTR4:	PUSHJ	P,SCLRCH	;CLEAR THE STATUS.
   610	000201'	554307	000111*		HLRZ	T1,KONBMX(T2)	;GET BMX
   611	000202'	271316	000000		ADDI	T1,(P3)		;ADDR.
   612	000203'	254000	000117'		JRST	FIGO
   613
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 13
FTASER.MAC	25-NOV-87 15:39		

   614					;SET UP KONT INFO.
   615	000204'	260040	000206'	FISEKN:	PUSHJ	P,SFISKN	;SUBR SO CAN BE ONLINE LATER.
   616	000205'	254000	000223'		JRST	FISETU		;LOOK AT UNIT.
   617	000206'	554447	000156*	SFISKN:	HLRZ	T4,FTXMCH(T2)	;GET MODEL NO.
   618	000207'	302440	000002		CAIE	T4,MODEL2	;MODEL 2?
   619	000210'	254000	000214'		JRST	FISEK2		;NO.
   620	000211'	135300	000012'		LDB	T1,BYUK62	;YES,  CAN THE KONT
   621	000212'	322300	000214'		JUMPE	T1,FISEK2	;6250?
   622	000213'	660440	000020		TRO	T4,DS6250	;YES.
   623				    ;N.B., IBM'S VALUES OF BYKN79 ARE 00=NONE OF 7 OR 9,
   624				    ;01=7, 10=9, 11=SPARE.  CALCOMP'S VALUES ARE 00=NONE OF 7 OR 9,
   625				    ;01=NEVER USED, 10=9, AND 11=7.
   626	000214'	135300	000013'	FISEK2:	LDB	T1,BYUK79	;GET KONT. NRZI CAPABILITY.
   627	000215'	602300	000001		TRNE	T1,1		;7TRK NRZI?
   628	000216'	660440	000040		TRO	T4,TRK7		;YES.
   629	000217'	602300	000002		TRNE	T1,2		;9 TRK NRZI?
   630	000220'	660440	000100		TRO	T4,TRK9		;YES.
   631	000221'	506447	000206*		HRLM	T4,FTXMCH(T2)	;STORE KONT. INFORMATION.
   632	000222'	263040	000000		POPJ	P,
   633
   634
   635				    ;SET UP UNIT INFO.
   636	000223'	135340	000005'	FISETU:	LDB	T2,BYUTAB	;IS THE UNIT READY?  (ELSE
   637	000224'	302340	000002		CAIE	T2,READY	;DON'T BELIEVE IT.).
   638	000225'	254000	000263'		JRST	FIGTNX		;NO.
   639	000226'	260040	000230'		PUSHJ	P,SFISUN	;SUBR SO CAN BE ONLINE LATER.
   640	000227'	254000	000263'		JRST	FIGTNX
   641	000230'	201310	000000*	SFISUN:	MOVEI	T1,FDSCHR(T3)	;SAVE THE SENSE INFORMATION
   642	000231'	505310	000003*		HRLI	T1,UNICMD+3(T3)	;WHEN THE UNIT
   643	000232'	201346	000005		MOVEI	T2,5(T1)	;CHARACTERISTICS ARE SET FOR
   644	000233'	251307	000000		BLT	T1,(T2)		;STC.
   645	000234'	135340	000003'		LDB	T2,BYUUN7	;UNIT 7 TRK BIT.
   646	000235'	322340	000244'		JUMPE	T2,FIST9T	;7 OR 9 TRACK UNIT?
   647
   648				    ;7 TRACK UNIT.
   649	000236'	606440	000040		TRNN	T4,TRK7		;KONT 7 TRACK CAPAB?
   650	000237'	263040	000000		POPJ	P,		;NO--WHAT A LOSER.
   651	000240'	515300	000046		HRLZI	T1,TRK7!DS556!DS800
   652	000241'	602440	000002		TRNE	T4,2		;MODEL 2 HAS 200 DENS.
   653	000242'	661300	000001		TLO	T1,DS200
   654	000243'	254000	000261'		JRST	FISTOT		;GO STORE INFO.
   655
   656				    ;9 TRACK UNIT.
   657	000244'	400300	000000	FIST9T:	SETZ	T1,
   658	000245'	135340	000011'		LDB	T2,BYUMDL	;UNIT MODEL IS
   659	000246'	326340	000254'		JUMPN	T2,FIST94	;3/5/7 OR 4/6/8?
   660				    ;9 TRACK, MODEL 3/5/7.
   661	000247'	135340	000010'		LDB	T2,BYUDUL	;3/5/7. 1600/800 OR 1600.
   662	000250'	322340	000260'		JUMPE	T2,FISTO0	;DUAL?
   663	000251'	602440	000140		TRNE	T4,TRK9!TRK7	;KONT HAS 9 NRZI?
   664	000252'	661300	000004		TLO	T1,DS800	;YES. 1600/800.
   665	000253'	254000	000260'		JRST	FISTO0		;NO. JUST 1600.
   666				    ;9 TRACK, MODEL 4/6/8.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 13-2
FTASER.MAC	25-NOV-87 15:39		

   667	000254'	602440	000020	FIST94:	TRNE	T4,DS6250	;4/6/8.  6250/1600 OR 6250.
   668	000255'	661300	000020		TLO	T1,DS6250	;KONT HAS 6250 CAPAB.
   669	000256'	135340	000010'		LDB	T2,BYUDUL	;DUAL BIT.
   670	000257'	322340	000261'		JUMPE	T2,FISTOT	;UNIT HAS DUAL?
   671	000260'	661300	000010	FISTO0:	TLO	T1,DS1600
   672	000261'	502310	000143*	FISTOT:	HLLM	T1,UNITYP(T3)	;SAVE IN UNIT DB.
   673	000262'	263040	000000		POPJ	P,
   674
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 14
FTASER.MAC	25-NOV-87 15:39		

   675				    ;GET NEXT UNIT.
   676	000263'	476000	000304'	FIGTNX:	SETOM	FIFLAG		;FLAG ALREADY SEEN THIS KONT.
   677	000264'	260040	000306'	FIGTN2:	PUSHJ	P,SCLRCH	;CLEAR THE STATUS FLAG.
   678	000265'	550410	000136*		HRRZ	T3,UNILNK(T3)	;HERE WHEN MAYBE ALREADY SEEN THIS KONT.
   679	000266'	322400	000274'		JUMPE	T3,FINOUT	;JUMP ON NO NEXT UNIT.
   680	000267'	552400	000301'		HRRZM	T3,FIUNIT
   681	000270'	200350	000140*		MOVE	T2,UNIKNT(T3)	;T2=KONT.
   682	000271'	316340	000302'		CAMN	T2,FIKONT	;SAME AS LAST KONT?
   683	000272'	344700	000103'		AOJA	P3,FINXUN	;YES.
   684	000273'	254000	000063'		JRST	FINXKN		;GO TO NEXT KONT.
   685	000274'	262040	000004	FINOUT:	POP	P,F		;
   686	000275'	262040	000005		POP	P,U		;STOP.
   687	000276'	262040	000011		POP	P,T4
   688	000277'	262040	000016		POP	P,P3
   689	000300'	263040	000000		POPJ	P,
   690
   691	000301'	000000	000000	FIUNIT: Z			;UNIT DB.
   692	000302'	000000	000000	FIKONT: Z			;CHANNEL DB,, KONT DB.
   693	000303'	000000	000000	FICHAN: Z			;CHANNEL STATUS FLAG.
   694	000304'	000000	000000	FIFLAG: Z
   695	000305'	000000	000000	FIRTCN: Z			;RETRY COUNT.
   696
   697
   698				;"SUBR" (CALLED ONLY BY FTAINI) TO CLEAR THE STATUS FLAG FOR A CHANNEL.
   699	000306'	554440	000302'	SCLRCH:	HLRZ	T4,FIKONT	;GET CHN DB ADDR.
   700	000307'	200311	000100*		MOVE	T1,CHNCLR(T4)	;
   701	000310'	620300	000007		TRZ	T1,7		;
   702	000311'	256000	000006		XCT	T1		;
   703	000312'	263040	000000		POPJ	P,
   704
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 15
FTASER.MAC	25-NOV-87 15:39		

   705				COMMENT %@@SUBROUTINE FTAREL
   706				@@PURPOSE RELEASE ROUTINE.
   707				@@ENTRY EXPECTS F=DDB.
   708				@@ACCUM SETS S TO DEVIOS.
   709				@@FUNCTION WAITS FOR IO TO COMPLETE FOR THE UNIT AND THEN CLEARS
   710				COMPAT IN DEVIOS, IBM BYTE ADJUSTMENT AND FUNCTION IN PROGRESS
   711				(THE HALVES OF DEVFNJ), AND DEVSTS.
   712				@@EXIT SEE FUNCTION.
   713				@@CALLS WAIT1.
   714				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
   715
   716
   717	000313'	260040	000000*	FTAREL:	PUSHJ	P,WAIT1		;WAIT FOR IO TO COMPLETE.
   718	000314'	621000	400000		TLZ	S,COMPAT	;TURN OFF IBM COMPATABILITY.
   719	000315'	402004	000000*		SETZM	DEVFNJ(F)	;TURN OFF IBM BYTE ADJUSTMENT.
   720	000316'	202004	000002		MOVEM	S,DEVIOS(F)	;STORE S.
   721	000317'	402004	000012		SETZM	DEVSTS(F)	;CLEAR DEVSTS.
   722	000320'	263040	000000		POPJ	P,
   723
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 16
FTASER.MAC	25-NOV-87 15:39		

   724				COMMENT %@@SUBROUTINE FTACLS
   725				@@PURPOSE CLOSE ROUTINE.
   726				@@ENTRY EXPECTS F=DDB.
   727				@@ACCUM SAVES U AND F.  OTHERS MAY BE DESTROYED.
   728				@@FUNCTION IF OUTPUT HAS BEEN DONE, AN ATTEMPT IS MADE TO
   729				WRITE TWO TAPE MARKS (LOGICAL EOT) ON THE TAPE AND THEN TO
   730				BACKSPACE OVER ONE OF THEM.
   731				@@CALLS WAIT1, FT1CM2 (PART OF THE FTAPE ROUTINE), SAVAIL,
   732				FHGSTP, AND ITS OWN INTERNAL ROUTINE FTACL6.
   733				@@ERRORS IF THE TAPE IS WRITE LOCKED, JUST EXIT (IOIMPM HAS
   734				BEEN SET AT INTERRUPT LEVEL.).
   735				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
   736
   737
   738	000321'	607200	004000	FTACLS:	TLNN	F,OUTPB		;OUTPUT BEEN DONE?
   739	000322'	263040	000000		POPJ	P,		;NO.
   740	000323'	260040	000313*		PUSHJ	P,WAIT1		;WAIT.
   741	000324'	201540	000002		MOVEI	M,FNPWTM	;SET UP FOR WTM
   742	000325'	550404	000000*		HRRZ	T3,DEVUDB(F)	;AND
   743	000326'	260040	000340'		PUSHJ	P,FTACL6	;GO.
   744	000327'	602000	400000		TRNE	S,IOIMPM	;WRITE LOCKED?
   745	000330'	263040	000000		POPJ	P,		;YES.
   746	000331'	201540	000002		MOVEI	M,FNPWTM	;SET UP FOR WTM
   747	000332'	260040	000340'		PUSHJ	P,FTACL6	;AND GO.
   748	000333'	201540	000004		MOVEI	M,FNPBSR	;SET UP BSR
   749	000334'	260040	000340'		PUSHJ	P,FTACL6	;AND GO.
   750	000335'	620000	020000		TRZ	S,IODEND	;CLEAR EOF
   751	000336'	202004	000002		MOVEM	S,DEVIOS(F)	;SINCE WRITING.
   752	000337'	263040	000000		POPJ	P,
   753
   754	000340'	260040	001077'	FTACL6:	PUSHJ	P,SAVAIL	;MAKE THE DEVICE AVAILABLE.
   755	000341'	260040	000720'	FTACL7:	PUSHJ	P,FT1CM2	;GO.
   756	000342'	260040	000323*		PUSHJ	P,WAIT1		;WAIT.
   757	000343'	607000	200000		TLNN	S,HNGFTA	;INTERVENTION REQUIRED?
   758	000344'	263040	000000		POPJ	P,		;NO.
   759	000345'	260040	003025'	FTACL8:	PUSHJ	P,FHGSTP	;YES, SAY SO.
   760	000346'	200004	000002		MOVE	S,DEVIOS(F)	;STILL
   761	000347'	607000	200000		TLNN	S,HNGFTA	;REQUIRED?
   762	000350'	254000	000341'		JRST	FTACL7		;NO, TRY AGAIN.
   763	000351'	260040	001113'		PUSHJ	P,SAVA45	;YES, MAKE THE DEVICE AVAIL.
   764	000352'	254000	000341'		JRST	FTACL7		;TRY AGAIN.
   765
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 17
FTASER.MAC	25-NOV-87 15:39		

   766				COMMENT %@@SUBROUTINE FTAHNG
   767				@@PURPOSE HUNG DEVICE ROUTINE.
   768				@@ENTRY EXPECTS F=DDB.
   769				@@ACCUM DESTROYS T1 AND T2.
   770				@@FUNCTION IF THE DEVICE CODE IS NEITHER WAIT NOR START, SOME-
   771				THING IS WRONG, SO HANG.  IF THE DEVICE CODE IS WAIT, WAS IT
   772				PREVIOUSLY WAIT? YES--HANG.  NO--MARK PREVIOUS IS WAIT AND
   773				RETURN.  THE DEVICE CODE IS START; IS THE CHANNEL ACTIVE?  NO--
   774				HANG.  YES--RETURN.
   775				@@EXIT SKIP RETURNS UNLESS IT THINKS THE DEVICE IS HUNG, IN
   776				WHICH CASE IT CLEANS UP SOME LOCATIONS AND THEN NON-SKIP
   777				RETURNS.
   778				@@CALLS SETHNG, SDCIOA, AND CPOPJ.
   779				@@ERRORS SEE FUNCTION AND EXIT CONDITIONS.
   780				@@RESTRICTIONS @@%
   781
   782				DEFINE DSKOFF <WRPI DSKPIF>
   783				DEFINE DSKON <WRPI DSKPIN>
   784
   785	000353'	700600	000000*	FTAHNG: DSKOFF
   786	000354'	606000	010000		TRNN	S,IOACT		;DID AN INTERRUPT SNEAK IN?
   787	000355'	254000	000374'		JRST	FTAHC2		;YES.
   788	000356'	261040	000010		PUSH	P,T3		;SAVE T3.
   789	000357'	550404	000325*		HRRZ	T3,DEVUDB(F)	;T3=UNIT DB.
   790	000360'	550350	000270*		HRRZ	T2,UNIKNT(T3)	;T2=ADDR OF KONT PART
   791	000361'	554347	000201*		HLRZ	T2,KONBMX(T2)	;OF DEVICE LIST.
   792	000362'	135300	004203'		LDB	T1,[POINT 3,DEVADD(F),^D23] ;T1=UNIT NO.
   793	000363'	270340	000006		ADD	T2,T1		;T2=ADDR OF DEV LIST ENTRY.
   794	000364'	135300	004204'		LDB	T1,[POINT 4,(T2),^D11] ;T1=CODE.
   795	000365'	302300	000016		CAIE	T1,16		;WAIT CODE?
   796	000366'	254000	000376'		JRST	FTAHN4		;NO.
   797	000367'	550310	000261*		HRRZ	T1,UNITYP(T3)	;YES. GET PREV WAS WAIT FLG.
   798	000370'	326300	000406'		JUMPN	T1,FTAHN8	;JUMP ON PREV WAS WAIT.
   799	000371'	350010	000367*		AOS	UNITYP(T3)	;FLAG PREV IS NOW WAIT.
   800	000372'	260040	000000*	FTAHCT:	PUSHJ	P,SETHNG	;RESET THE HUNG TIME.
   801	000373'	262040	000010		POP	P,T3		;RESTORE T3.
   802	000374'	700600	000000*	FTAHC2:	DSKON
   803	000375'	254000	000000*		JRST	CPOPJ1		;CONTINUE.
   804
   805	000376'	302300	000015	FTAHN4:	CAIE	T1,15		;START CODE?
   806	000377'	254000	000406'		JRST	FTAHN8		;NO--STRANGE ERROR OR HUNG.
   807	000400'	554310	000360*		HLRZ	T1,UNIKNT(T3)	;GET THE CHANNEL ACTIVE
   808	000401'	200306	000000*		MOVE	T1,CHNACT(T1)	;FLAG WORD.
   809	000402'	316304	000000*		CAMN	T1,DEVACT(F)	;WHAT IT WAS WHEN WE STARTED?
   810	000403'	254000	000406'		JRST	FTAHN8		;YES--HUNG.
   811	000404'	202304	000402*		MOVEM	T1,DEVACT(F)	;NO--UPDATE US.
   812	000405'	254000	000372'		JRST	FTAHCT		;CONTINUE.
   813
   814	000406'	350010	000000*	FTAHN8:	AOS	FDHCNT(T3)	;COUNT HUNG OCCURRENCE.
   815	000407'	553004	000000*		HRRZS	DEVER1(F)	;TURN OFF E.P.
   816	000410'	554310	000400*		HLRZ	T1,UNIKNT(T3)	;GET CHANNEL DB.
   817	000411'	510306	000166*		HLLZ	T1,CHNGO(T1)	;T1 HAS CONO.
   818	000412'	661300	000040		TLO	T1,40		;MAKE CONI.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 17-2
FTASER.MAC	25-NOV-87 15:39		

   819	000413'	541310	000000*		HRRI	T1,FDHCNI(T3)	;CONI SAXN,FDHCNI(T3).
   820	000414'	256000	000006		XCT	T1		;LOG CONI AT HUNG.
   821	000415'	135300	004204'		LDB	T1,[POINT 4,(T2),^D11] ;IF THE DEVICE LIST ENTRY
   822	000416'	306300	000017		CAIN	T1,TERMDV	;IS NOT TERMINATE,
   823	000417'	254000	000426'		JRST	FTAHN9		;THEN
   824	000420'	554310	000410*		HLRZ	T1,UNIKNT(T3)	;WHAP A UNIT. T1/ CHN DB.
   825	000421'	200306	000411*		MOVE	T1,CHNGO(T1)	;MAKE
   826	000422'	640300	000700		TRC	T1,7B29		;SELECTIVE RESET.
   827	000423'	256000	000006		XCT	T1		;CAUSE CONTROL ERROR.
   828	000424'	201300	000017		MOVEI	T1,TERMDV	;PUT TERMINATE INTO
   829	000425'	137300	004204'		DPB	T1,[POINT 4,(T2),^D11] ;DEV LIST ENTRY.
   830	000426'	554304	000315*	FTAHN9:	HLRZ	T1,DEVFNJ(F)	;GET FN IN
   831	000427'	552310	000000*		HRRZM	T1,FDHFUN(T3)	;PROGRESS WHEN HUNG.
   832	000430'	262040	000010		POP	P,T3		;RESTORE T3.
   833	000431'	260040	000434'		PUSHJ	P,SDCIOA	;DEC DON'T SWAP CNT AND CLR FNP.
   834	000432'	700600	000374*		DSKON
   835	000433'	263040	000000		POPJ	P,
   836
   837				COMMENT %@@SUBROUTINE SDCIOA
   838				@@PURPOSE SUBR TO DECREMENT THE "DON'T SWAP WHILE
   839				IOACT" COUNT (JBTIOA) AND TURN OFF THE FNP.
   840				@@ENTRY EXPECTS F=DDB AND T1=FNP.  ADDITIONAL ENTRY POINT IS
   841				SDCIO2.
   842				@@ACCUM DESTROYS T1 AND T2.
   843				@@FUNCTION (1) CLEAR THE FNP KEY IN THE LH(DEVFNJ), AND (2)
   844				FOR FNS READ AND WRITE, DEC JBTIOA AS WELL.
   845				@@EXIT SEE FUNCTION.
   846				@@RESTRICTIONS CALLED AT BOTH UUO AND INTERRUPT LEVEL. @@%
   847
   848	000434'	305300	000012	SDCIOA:	CAIGE	T1,FNPRED	;READ OR WRITE?
   849	000435'	254000	000441'		JRST	SDCIO4		;NO.
   850	000436'	135300	000000*	SDCIO2:	LDB	T1,PJOBN	;YES, GET JOB NO.
   851	000437'	370006	000000*		SOS	JBTIOA(T1)	;ADJ DON'T SWP WHILE "IO" CNT.
   852	000440'	260040	000443'	SDCIO3:	PUSHJ	P,DECDIO	;ADJ PGYDIOS & MAYBE PAGWAK.
   853	000441'	553004	000426*	SDCIO4:	HRRZS	DEVFNJ(F)	;CLEAR THE FNP.
   854	000442'	263040	000000		POPJ	P,
   855
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 18
FTASER.MAC	25-NOV-87 15:39		

   856				COMMENT #
   857				@@SUBROUTINE DECDIO
   858				@@PURPOSE
   859				DECS PGYDIO FOR THE PAGES OF THE COMMAND WORDS BETWEEN WHERE
   860				DEVDIO POINTS AND THE END OF THE LIST.
   861				CALLS PAGWAK IF PGYDIO GOES TO ZERO.
   862				@@ENTRY
   863				EXPECTS
   864				@@ACCUM
   865				DESTROYS T1 AND T2.
   866				@@ #
   867
   868	000443'	261040	000011	DECDIO:	PUSH	P,T4		;
   869	000444'	550444	000000*		HRRZ	T4,DEVDIO(F)	;GET T4/ ADDR OF LIST.
   870	000445'	336311	000000		SKIPN	T1,(T4)		;ALL DONE WITH BUFFERED?
   871					JRST	[POP P,T4	;YES.
   872	000446'	254000	004205'			POPJ P,]	;
   873	000447'	261040	000003		PUSH	P,PG		;SAVE PG AND
   874	000450'	261040	000002		PUSH	P,J		;J.
   875	000451'	260040	000504'	DECDI2:	PUSHJ	P,BUFKRN	;PROCESS UP TO THE NEXT 0.
   876	000452'	135340	000000*		LDB	T2,PIOMOD	;DONE IF D OR
   877	000453'	301340	000016		CAIL	T2,DR		;DR.
   878	000454'	254000	000457'		JRST	.+3		;
   879	000455'	332311	000001		SKIPE	T1,1(T4)	;BUFFERED, NEED
   880	000456'	344440	000451'		AOJA	T4,DECDI2	;TWO ZEROES TO BE DONE.
   881	000457'	262040	000002		POP	P,J		;RESTORE J
   882	000460'	262040	000003		POP	P,PG		;AND PG.
   883	000461'	262040	000011		POP	P,T4		;RESTORE T4.
   884	000462'	263040	000000		POPJ	P,
   885
   886
   887
   888
   889				COMMENT #
   890				@@SUBROUTINE BUFDIO
   891				@@PURPOSE
   892				FOR BUFFERED MODE, DECS PGYDIO FOR THE PAGES OF THE COMMAND
   893				WORDS BETWEEN WHERE DEVDIO POINTS AND THE NEXT ZERO.  LEAVES
   894				DEVDIO POINTING AT THE WORD AFTER THE ZERO WORD.
   895				CALLS PAGWAK IF PGYDIO GOES TO ZERO.
   896				@@ENTRY
   897				EXPECTS
   898				@@ACCUM
   899				DESTROYS NO ACS.
   900				@@ #
   901
   902	000463'	261040	000006	BDIO:	PUSH	P,T1		;
   903	000464'	261040	000007		PUSH	P,T2		;
   904	000465'	261040	000011		PUSH	P,T4		;
   905	000466'	261040	000003		PUSH	P,PG		;SAVE PG AND
   906	000467'	261040	000002		PUSH	P,J		;J.
   907	000470'	550444	000444*		HRRZ	T4,DEVDIO(F)	;GET T4/ ADDR OF LIST.
   908	000471'	336311	000000		SKIPN	T1,(T4)		;
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 18-2
FTASER.MAC	25-NOV-87 15:39		

   909	000472'	256000	004207'		 STOPCD (.,JOB,MTANIB,,<No IOWDs in BDIO>)
   910	000473'	260040	000504'		PUSHJ	P,BUFKRN	;PROCESS TO THE NEXT 0.
   911	000474'	201451	000001		MOVEI	T4,1(T4)	;ADJUST
   912	000475'	542444	000470*		HRRM	T4,DEVDIO(F)	;DEVDIO.
   913	000476'	262040	000002		POP	P,J		;RESTORE J
   914	000477'	262040	000003		POP	P,PG		;AND PG.
   915	000500'	262040	000011		POP	P,T4		;
   916	000501'	262040	000007		POP	P,T2		;
   917	000502'	262040	000006		POP	P,T1		;
   918	000503'	263040	000000		POPJ	P,
   919
   920
   921
   922
   923				;TINY SUBR USED BY BDIO AND DECDIO.
   924				;  EXPECTS T1/ CONTENTS OF CMD WORD, T4/ ADDR OF THAT CMD WORD.
   925				;  RETURNS T4/ ADDR OF NEXT ZERO WORD.
   926				;  DESTROYS T1, T2, T4, PG, AND J.
   927	000504'	271300	000001	BUFKRN:	ADDI	T1,1		;-COUNT AND ADDRESS-1+1.
   928	000505'	135140	004212'		LDB	PG,[POINT 13,T1,26] ;GET PHYSICAL PAGE NUMBER.
   929	000506'	135300	000000*		LDB	T1,PGYDIO	;GET DIRECT I/O COUNT.
   930	000507'	365300	000511'		SOJGE	T1,.+2		;SHOULD BE NON-ZERO.
   931	000510'	256000	000000'		 STOPCD                 ;;BUFKRN+4
   932	000511'	137300	000506*		DPB	T1,PGYDIO	;
   933	000512'	326300	000514'		JUMPN	T1,.+2		;
   934	000513'	260040	000000*		PUSHJ	P,PAGWAK	;WAKE UP ALL THE JOBS.
   935	000514'	201451	000001		MOVEI	T4,1(T4)	;GO TO NEXT WORD.
   936	000515'	332311	000000		SKIPE	T1,(T4)		;ALL DONE?
   937	000516'	254000	000504'		JRST	BUFKRN		;NO.
   938	000517'	263040	000000		POPJ	P,
   939
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 19
FTASER.MAC	25-NOV-87 15:39		

   940				COMMENT %@@SUBROUTINE SYDFTA
   941				@@PURPOSE CODE FOR THE SYSDVF UUO.
   942				@@ENTRY
   943				@@ACCUM
   944				@@FUNCTION
   945				@@EXIT
   946				@@CALLS
   947				@@ERRORS
   948				@@RESTRICTIONS @@%
   949
   950	000520'	271540	000001	SYDFTA:	ADDI	M,1		;POINT M TO THE UNIT NAME.
   951	000521'	256200	004213'		UMOVE	T1,(M)		;T1/ UNIT NAME.
   952	000522'	201240	000000*		MOVEI	U,FTA0DB	;U/ 1ST UNIT'S DDB ADDR.
   953	000523'	326300	000527'		JUMPN	T1,FTDVF2	;JUMP UNLESS WANT 1ST UNIT.
   954	000524'	200240	000000*		MOVE	U,DEVUDB+FTA0DB	;POINT TO UNIT BLOCK
   955	000525'	200300	000522*		MOVE	T1,FTA0DB+DEVNAM ;GET NAME OF 1ST UNIT.
   956	000526'	254000	000543'		JRST	FTDVF7		;GO FINISH UP.
   957	000527'	316305	000000	FTDVF2:	CAMN	T1,DEVNAM(U)	;MATCH?
   958	000530'	254000	000536'		  JRST	FTDVF5		;YES.
   959	000531'	550245	000357*		HRRZ	U,DEVUDB(U)	;NO.  U/ UNIT DB ADDR.
   960	000532'	336245	000265*		SKIPN	U,UNILNK(U)	;GET NEXT UNIT DB ADDR?
   961	000533'	254000	000000*		  JRST	SYDNM4		;NO, NO UNITS LEFT.
   962	000534'	200245	000106*		MOVE	U,UNIDDB(U)	;YES, U/ DDB ADDR.
   963	000535'	254000	000527'		JRST	FTDVF2		;GO LOOK AT THIS UNIT.
   964	000536'	200245	000531*	FTDVF5:	MOVE	U,DEVUDB(U)	;FOUND MATCH.
   965	000537'	336245	000532*		SKIPN	U,UNILNK(U)	;IS THERE A NEXT UNIT?
   966	000540'	254000	000533*		  JRST	SYDNM4		;NO.
   967	000541'	200305	000534*		MOVE	T1,UNIDDB(U)	;YES, GET AND
   968	000542'	200306	000000		MOVE	T1,DEVNAM(T1)	;STORE ITS
   969	000543'	256200	004214'	FTDVF7:	UMOVEM	T1,(M)		;NAME.
   970	000544'	201300	000000*		MOVEI	T1,FTULNH	;T1/ LENGTH OF UDB.
   971	000545'	205340	240000		MOVSI	T2,LICSYS!LICSPY;
   972	000546'	616342	000000*		TDNN	T2,JBTLIC(J)	;
   973	000547'	254000	000375*		  JRST	CPOPJ1		;
   974	000550'	363600	000547*		SOJLE	P1,CPOPJ1	;
   975	000551'	344540	000000*		AOJA	M,SYDCOM	;
   976
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 20
FTASER.MAC	25-NOV-87 15:39		

   977				COMMENT %@@SUBROUTINE FTAUGF
   978				@@PURPOSE UGETF ROUTINE.
   979
   980				IF RH(E)=0,	RETURN BYTE COUNT FOR LAST USER RECORD FILLED TO E+1.
   981					=1,	GET LH(E) SENSE WORDS INTO E+1, E+2, ETC.
   982						(IF LH(E) IS >6, 6 WORDS ARE RETURNED.).
   983					=2,	COMPACTED SENSE DATA INTO E+1 AS FOLLOWS:
   984							BIT 0 -- FILE PROTECTED
   985							BITS 1&2 -- TUA&B
   986							BIT 3 -- LOAD POINT
   987							BIT 4 -- TAPE INDICATE
   988							BIT 5 -- IBM COMPATIBLE UNIT
   989							BIT 12 -- 7 TRACK
   990							BITS 13 TO 17 -- 6250,1600,800,556,200
   991
   992				@@ENTRY EXPECTS M TO BE ADDR OF E AND F=DDB.
   993				@@ACCUM SAVES F AND M.  OTHER ACS MAY BE DESTROYED.
   994				@@FUNCTION FOR ARG 0, PICK UP CONTENTS OF DEVDWC.  FOR ARGS 1
   995				AND 2, SENSE THE UNIT AND DETERMINE THE INFORMATION.
   996				@@CALLS WAIT1, SGTDEV, FHGSTP, SUBRSN, AND SUBRG2.
   997				@@ERRORS ANY OF THE FOLLOWING CAUSE E+1 TO BE SET TO -1:
   998				(1) E DOES NOT HAVE ONE OF THE FORMS DESCRIBED UNDER PURPOSE.
   999				(2) RH(E)=0 AND THE MODE IS NEITHER D NOR DR.
  1000				(3) RH(E)=1 AND LH(E)<1.
  1001				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
  1002
  1003
  1004	000552'	256200	004215'	FTAUGF:	UHRRZ U,(M)		;GET RH(E).
  1005	000553'	307240	000002		CAIG	U,2		;ARG IN
  1006	000554'	254000	000557'		JRST	FFUGF2		;BOUNDS?
  1007	000555'	256200	004216'	FFUERR:	XCTTU	<SETOM 1(M)> ;ERROR
  1008	000556'	263040	000000		POPJ	P,		;RETURN.
  1009
  1010	000557'	260040	000342*	FFUGF2:	PUSHJ	P,WAIT1		;WAIT FOR IOACT TO GO OFF.
  1011	000560'	550404	000536*	FFUGF3:	HRRZ	T3,DEVUDB(F)	;GET UNIT DB ADDR.
  1012	000561'	554310	000371*		HLRZ	T1,UNITYP(T3)	;GET UNIT CHARACTERISTICS.
  1013	000562'	327240	000571'		JUMPG	U,FFUSEN	;GO TO PERFORM FUNCTION.
  1014
  1015				    ;ARG 0.
  1016	000563'	135300	000452*		LDB	T1,PIOMOD	;MUST BE DR OR
  1017	000564'	305300	000016		CAIGE	T1,DR		;D, ELSE
  1018	000565'	254000	000555'		JRST	FFUERR		;ERROR.
  1019	000566'	200304	000000*		MOVE	T1,DEVDWC(F)	;GET BYTE COUNT.
  1020	000567'	256200	004217'	FFUSTO:	UMOVEM T1,1(M) 		;STORE IN E+1
  1021	000570'	263040	000000		POPJ	P,		;AND RETURN.
  1022
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 21
FTASER.MAC	25-NOV-87 15:39		

  1023				    ;ARGS 1 AND 2.
  1024	000571'	326300	000577'	FFUSEN:	JUMPN	T1,FFUS2	;JUMP ON AVAILABLE UNIT.
  1025	000572'	260040	001034'	FFUS1:	PUSHJ	P,SGTDEV	;TRY TO GET IT.
  1026	000573'	254000	000577'		JRST	FFUS2		;WIN.
  1027	000574'	260040	003025'		PUSHJ	P,FHGSTP	;SAY TROUBLE.
  1028	000575'	200004	000002		MOVE	S,DEVIOS(F)	;RESTORE S.
  1029	000576'	254000	000572'		JRST	FFUS1		;TRY AGAIN.
  1030	000577'	260040	003045'	FFUS2:	PUSHJ	P,SUBRSN	;GET SENSE CMD SET UP.
  1031	000600'	551300	000011		HRRZI	T1,FNPUGF	;SET UP
  1032	000601'	506304	000441*		HRLM	T1,DEVFNJ(F)	;FN IN PROGRESS.
  1033	000602'	260040	003014'		PUSHJ	P,SUBRG2	;GO.
  1034	000603'	260040	000557*		PUSHJ	P,WAIT1		;WAIT.
  1035	000604'	366240	000616'		SOJN	U,FFUAR2	;GO TO ARG 1 OR ARG 2.
  1036
  1037				    ;ARG=1
  1038	000605'	256200	004220'	FFUAR1:	UHLRZ T2,(M)		;GET LH(E).
  1039	000606'	303340	000006		CAILE	T2,6		;MAX. OF
  1040	000607'	201340	000006		MOVEI	T2,6		;SIX WORDS.
  1041	000610'	322340	000555'		JUMPE	T2,FFUERR	;MUST BE AT LEAST 1.
  1042	000611'	515310	000003*		HRLZI	T1,UNICMD+3(T3) ;SET UP TO
  1043	000612'	541313	000001		HRRI	T1,1(M)		;BLT.
  1044	000613'	271353	000000		ADDI	T2,(M)		;BLT AND
  1045	000614'	256200	004221'		XCTTU	<BLT T1,(T2)> ;THEN
  1046	000615'	263040	000000		POPJ	P,		;RETURN.
  1047
  1048				    ;ARG=2.
  1049	000616'	510310	000561*	FFUAR2:	HLLZ	T1,UNITYP(T3)	;GET TRK, DENSITY INF.
  1050	000617'	135340	000006'		LDB	T2,BYUWPT	;FILE PROTECTED?
  1051	000620'	322340	000622'		JUMPE	T2,.+2		;JUMP ON NO,
  1052	000621'	661300	400000		TLO	T1,WRPROT	;ELSE SET BIT.
  1053	000622'	135340	000005'		LDB	T2,BYUTAB	;GET TUA&B
  1054	000623'	137340	004222'		DPB	T2,[POINT 2,T1,2] ;AND STORE THEM.
  1055	000624'	135340	000007'		LDB	T2,BYUTIN	;AT
  1056	000625'	322340	000627'		JUMPE	T2,.+2		;EOT?
  1057	000626'	661300	020000		TLO	T1,TAPEIN	;YES.
  1058	000627'	135340	000004'		LDB	T2,BYULDP	;AT
  1059	000630'	322340	000632'		JUMPE	T2,.+2		;LOAD POINT?
  1060	000631'	661300	040000		TLO	T1,LOADPT	;YES.
  1061	000632'	661300	010000		TLO	T1,IBMCMP	;IBM COMPATIBLE UNIT.
  1062	000633'	254000	000567'		JRST	FFUSTO		;SET UP E AND RETURN.
  1063
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 22
FTASER.MAC	25-NOV-87 15:39		

  1064				COMMENT %@@SUBROUTINE FTAPE
  1065				@@PURPOSE SET UP AND GO FOR MTAPE FUNCTIONS.
  1066				0 WAIT	10 GO TO LEOT  100 DEC, 9 TRACK	        201 7 TRACK SPECIAL, ADJ 0
  1067				1 REW	11 REW/UNL     101 IBM,     "   ADJ 0	202    "      "        "  1
  1068				3 WTM	13 ERG         102  "       "    "  1	203    "      "        "  2
  1069				6 SKR	16 SKF         103  "       "    "  2	204    "      "        "  3
  1070				7 BSR	17 BSF         104  "       "    "  3
  1071				@@ENTRY EXPECTS M=ADDR OF E, F=DDB, AND S=DEVIOS.
  1072				AN ADDITIONAL ENTRY POINT IS FT1CM2.
  1073				@@ACCUM SAVES F. OTHERS MAY BE DESTROYED. SETS T3=UNIT DB ADDR
  1074				AND S=DEVIOS.
  1075				@@CALLS WAIT1, CPOPJ, SAVAIL, SUBRSM, SUBRGO, AND ITS INTERNAL
  1076				ROUTINE FT1CM2.
  1077				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
  1078
  1079
  1080				    ;DISPATCH TABLE FOR FNS.
  1081	000634'	000716'	000675'	FTPTBL:	XWD FT1CMD,FTDIE
  1082	000635'	000716'	000675'		XWD FT1CMD,FTDIE
  1083	000636'	000675'	000675'		XWD FTDIE,FTDIE
  1084	000637'	000716'	000716'		XWD FT1CMD,FT1CMD
  1085	000640'	000716'	000750'		XWD FT1CMD,FTLEOT
  1086	000641'	000716'	000675'		XWD FT1CMD,FTDIE
  1087	000642'	000675'	000675'		XWD FTDIE,FTDIE
  1088	000643'	000730'	000730'		XWD FTSKBS,FTSKBS
  1089
  1090
  1091	000644'	260040	000603*	FTAPE:	PUSHJ	P,WAIT1		;WAIT FOR IOACT TO GO OFF.
  1092	000645'	551553	000000		HRRZI	M,(M)		;GET FN.
  1093	000646'	322540	000000*		JUMPE	M,CPOPJ		;FN 0 IS DONE.
  1094
  1095	000647'	260040	001077'	FTP2:	PUSHJ	P,SAVAIL	;MAKE THE UNIT AVAILABLE.
  1096	000650'	554310	000616*		HLRZ	T1,UNITYP(T3)	;UNIT CHAR TO T1.
  1097	000651'	303540	000204		CAILE	M,204		;FN OUT OF BOUNDS?
  1098	000652'	254000	000675'		JRST	FTDIE		;YES.
  1099	000653'	301540	000201		CAIL	M,201		;BETWEEN 201 AND 204?
  1100	000654'	254000	000677'		JRST	FT7SPC		;YES, 7 TRK SPECIAL.
  1101	000655'	303540	000104		CAILE	M,104		;<= 104?
  1102	000656'	254000	000675'		JRST	FTDIE		;NO.
  1103	000657'	301540	000100		CAIL	M,100		;FNS 100-104 GO
  1104	000660'	254000	000703'		JRST	FT9TRK		;TO FT9TRK.
  1105
  1106	000661'	602540	777760		TRNE	M,777760	;FN OUT OF
  1107	000662'	254000	000675'		JRST	FTDIE		;BOUNDS.
  1108
  1109	000663'	606000	001000		TRNN	S,IOPAR		;EVEN PARITY?
  1110	000664'	254000	000670'		JRST	FTP6		;NO.
  1111	000665'	603000	400000		TLNE	S,COMPAT	;YES, ONLY
  1112	000666'	606300	000040		TRNN	T1,TRK7		;LEGAL IF IBM
  1113	000667'	254000	000675'		JRST	FTDIE		;MODE AND 7 TRACK.
  1114
  1115	000670'	241540	777777	FTP6:	ROT	M,-1		;GET
  1116	000671'	321540	000673'		JUMPL	M,.+2		;DISPATCH
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 22-2
FTASER.MAC	25-NOV-87 15:39		

  1117	000672'	334313	000634'		SKIPA	T1,FTPTBL(M)	;ADDR
  1118	000673'	554313	000634'		HLRZ	T1,FTPTBL(M)	;AND
  1119	000674'	254006	000000		JRST	(T1)		;GO.
  1120
  1121				    ;HERE ON USER ERROR.
  1122	000675'	660000	400000	FTDIE:	TRO	S,IOIMPM	;FLAG AND
  1123	000676'	254000	000714'		JRST	FTOUT		;EXIT.
  1124
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 23
FTASER.MAC	25-NOV-87 15:39		

  1125				    ;7 TRACK SPECIAL MODE.
  1126	000677'	606300	000040	FT7SPC:	TRNN	T1,TRK7		;7 TRACK?
  1127	000700'	254000	000675'		JRST	FTDIE		;NO.
  1128	000701'	275540	000100		SUBI	M,100		;YES,
  1129	000702'	254000	000710'		JRST	FTOUT0		;OKAY.
  1130
  1131				    ;9 TRACK FNS (100 TO 104).
  1132	000703'	606000	001000	FT9TRK:	TRNN	S,IOPAR		;EVEN PARITY IS A NO-NO.
  1133	000704'	602300	000040		TRNE	T1,TRK7		;POSSIBLE TO DO 9 TRACK?
  1134	000705'	254000	000675'		JRST	FTDIE		;NO--DIE.
  1135	000706'	306540	000100		CAIN	M,100		;DEC=COMPAT
  1136	000707'	625000	400000		TLZA	S,COMPAT	;OFF,
  1137	000710'	665000	400000	FTOUT0:	TLOA	S,COMPAT	;IBM=COMPAT ON.
  1138	000711'	254000	000714'		JRST	FTOUT		;
  1139	000712'	275540	000101		SUBI	M,101		;STORE THE
  1140	000713'	552544	000601*		HRRZM	M,DEVFNJ(F)	;BYTE ADJUST FOR IBM MODE.
  1141	000714'	202004	000002	FTOUT:	MOVEM	S,DEVIOS(F)	;STORE S AND
  1142	000715'	263040	000000		POPJ	P,		;EXIT.
  1143
  1144
  1145				    ;1 CMD FNS (1,3,6,7,11,13).
  1146	000716'	327540	000720'	FT1CMD:	JUMPG	M,FT1CM2	;"FN IN
  1147	000717'	201553	000001		MOVEI	M,1(M)		;PROGRESS" TO LH
  1148	000720'	506544	000713*	FT1CM2:	HRLM	M,DEVFNJ(F)	;OF DEVFNJ.
  1149	000721'	260040	003066'		PUSHJ	P,SUBRSM	;SM CMD TO UNICMD.
  1150	000722'	514313	000021'		HRLZ	T1,FT1TBL-1(M)	;SET UP THE ACTUAL
  1151	000723'	670304	000000*		TDO	T1,DEVADD(F)	;FN AND DEV ADDR AND
  1152	000724'	202310	000001*		MOVEM	T1,UNICMD+1(T3)	;STORE IT.
  1153	000725'	515300	400000		HRLZI	T1,HALT		;HALT
  1154	000726'	202310	000002*		MOVEM	T1,UNICMD+2(T3)	;CMD.
  1155	000727'	324740	003016'		PJRST	SUBRGO		;GO.
  1156
  1157				    ;SKF AND BSF (16 AND 17).
  1158	000730'	201240	000007	FTSKBS:	MOVEI	U,FNPSKF	;"FN IN
  1159	000731'	327540	000733'		JUMPG	M,.+2		;PROGRESS" TO
  1160	000732'	201240	000010		MOVEI	U,FNPBSF	;LH OF
  1161	000733'	506244	000720*	FTSKB2:	HRLM	U,DEVFNJ(F)	;DEVFNJ.
  1162	000734'	260040	003066'		PUSHJ	P,SUBRSM	;SM CMD TO UNICMD.
  1163	000735'	201340	000011		MOVEI	T2,9		;GEN A
  1164	000736'	514305	000015'		HRLZ	T1,FT1TBL-5(U)	;CMD LIST
  1165	000737'	670304	000723*		TDO	T1,DEVADD(F)	;FULL OF
  1166	000740'	201250	000000		MOVEI	U,(T3)		;SKR'S AND
  1167	000741'	202305	000001*	FTSKB4:	MOVEM	T1,UNICMD+1(U)	;BSR'S
  1168	000742'	340240	000743'		AOJ	U,.+1		;AND THEN
  1169	000743'	367340	000741'		SOJG	T2,FTSKB4	;GEN A
  1170	000744'	202305	000001*		MOVEM	T1,UNICMD+1(U)	;HALT
  1171	000745'	515300	400000		HRLZI	T1,HALT		;CMD AND
  1172	000746'	202305	000002*		MOVEM	T1,UNICMD+2(U)	;THEN
  1173	000747'	324740	003016'		PJRST	SUBRGO		;GO.
  1174
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 24
FTASER.MAC	25-NOV-87 15:39		

  1175				    ;LEOT (10).
  1176				    ;
  1177				    ;    1ST, BSR SINCE MAY BE AN EOF OR CONTAIN EOT.
  1178				    ;    2ND, SKF.  DONE IF EOT.  IN ANY EVENT, SAW AN EOF.
  1179				    ;    3RD, SKR.  DONE IF EOT.  DONE ALSO IF EOF SINCE
  1180				    ;    	TWO IN A ROW (IF THIS CASE, ADJUST TAPE BY A
  1181				    ;		BSR BEFORE EXITING.).
  1182				    ;    THEN, GO TO 2ND TO KEEP TRYING.
  1183
  1184	000750'	201540	000004	FTLEOT:	MOVEI	M,FNPBSR	;1ST STEP--
  1185	000751'	260040	000720'		PUSHJ	P,FT1CM2	;BSR.
  1186	000752'	260040	000644*		PUSHJ	P,WAIT1		;WAIT FOR COMPLETION.
  1187	000753'	201240	000007	FTLEO4:	MOVEI	U,FNPSKF	;2ND STEP--
  1188	000754'	260040	000733'		PUSHJ	P,FTSKB2	;SKF.
  1189	000755'	260040	000752*		PUSHJ	P,WAIT1		;WAIT.
  1190	000756'	603000	100000		TLNE	S,IOLEND	;DONE IF
  1191	000757'	263040	000000		POPJ	P,		;EOT.
  1192	000760'	201540	000003		MOVEI	M,FNPSKR	;3RD STEP--
  1193	000761'	260040	000720'		PUSHJ	P,FT1CM2	;SKR.
  1194	000762'	260040	000755*		PUSHJ	P,WAIT1		;WAIT.
  1195	000763'	616000	004223'		TDNN	S,[XWD IOLEND,IODEND] ;DONE ON EOT
  1196	000764'	254000	000753'		JRST	FTLEO4		;OR EOF.
  1197	000765'	606000	020000		TRNN	S,IODEND	;EOF?
  1198	000766'	263040	000000		POPJ	P,		;NO.  EOT/DONE.
  1199	000767'	201540	000004		MOVEI	M,FNPBSR	;FIN WITH
  1200	000770'	254000	000720'		JRST	FT1CM2		;BSR.
  1201
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 25
FTASER.MAC	25-NOV-87 15:39		

  1202				COMMENT %@@SUBROUTINE FTARED/WRT
  1203				@@PURPOSE READ AND WRITE ROUTINES.
  1204				@@ENTRY EXPECTS S=DEVIOS AND F=DDB.
  1205				@@ACCUM SAVES F AND M.  OTHERS MAY BE DESTROYED.  SETS T3=UNIT
  1206				DDB AND S=DEVIOS.
  1207				@@FUNCTION CAUSES THE UNIT CMD AREA TO BE SET UP WITH THE
  1208				APPROPRIATE COMMANDS TO DO THE READS/WRITES SPECIFIED BY THE
  1209				DDB LIST, SETS UP, AND GOES.  (EXCEPT IF THIS IS A BUFFERED
  1210				MODE REQUEST WITH A 0 COUNT, IN WHICH CASE IT JUST RETURNS.).
  1211				@@CALLS SAVAIL, WAIT1, SCOMBL, SUBRG1, AND SDCIO2.
  1212				@@ERRORS CERTAIN BAD DDB LISTS (SEE SCOMBL.).
  1213				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
  1214	000771'	625000	000020	FTARED:	TLZA	S,IO		;SET IO BIT ON FOR WRITE AND OFF
  1215	000772'	661000	000020	FTAWRT:	TLO	S,IO		;FOR READ. ALSO USE AS A FLAG.
  1216	000773'	260040	001077'		PUSHJ	P,SAVAIL	;MAKE THE UNIT AVAILABLE.
  1217	000774'	550304	000011		HRRZ	T1,DEVCLS(F)	;START DIO CALCS AT
  1218	000775'	542304	000475*		HRRM	T1,DEVDIO(F)	;BEGINNING OF LIST.
  1219	000776'	554310	000650*		HLRZ	T1,UNITYP(T3)	;UNIT CHAR TO T3.
  1220	000777'	606000	001000		TRNN	S,IOPAR		;EVEN PARITY?
  1221	001000'	254000	001004'		JRST	FTARW3		;NO.
  1222	001001'	603000	400000		TLNE	S,COMPAT	;YES, ONLY LEGAL IF IBM
  1223	001002'	606300	000040		TRNN	T1,TRK7		;MODE AND
  1224	001003'	254000	001026'		JRST	FTARW5		;7 TRACK.
  1225	001004'	260040	000762*	FTARW3:	PUSHJ	P,WAIT1		;WAIT FOR UNIT CMD LIST TO FREE UP.
  1226	001005'	135300	000563*		LDB	T1,PIOMOD	;GET MODE.
  1227	001006'	301300	000016		CAIL	T1,DR		;DUMP OR DR AND BEGINNING OF
  1228	001007'	627000	000002		TLZN	S,IOBEG		;IOWD MEAN NOTHING READ YET.
  1229	001010'	254000	001012'		JRST	.+2		;DEVDWC HOLDS COUNT OF ITEMS
  1230	001011'	402004	000566*		SETZM	DEVDWC(F)	;READ FROM START OF LAST IOWD.
  1231	001012'	402004	000000*		SETZM	DEVCNT(F)	;NOTHING CONTINUED YET.
  1232	001013'	201300	000012		MOVEI	T1,FNPRED	;SET UP THE
  1233	001014'	603000	000020		TLNE	S,IO		;FN IN PROGRESS
  1234	001015'	201300	000013		MOVEI	T1,FNPWRT	;IN
  1235	001016'	506304	000733*		HRLM	T1,DEVFNJ(F)	;DEVFNJ.
  1236	001017'	135340	000436*		LDB	T2,PJOBN	;GET THE JOB NO.
  1237	001020'	350007	000437*		AOS	JBTIOA(T2)	;INC "DON'T SWP WHILE "IO" CNT.
  1238	001021'	260040	003127'		PUSHJ	P,SCOMBL	;SET UP THE UNIT CMD LIST.
  1239	001022'	254000	003017'		JRST	SUBRG1		;GO.
  1240	001023'	350004	000013		AOS	DEVABC(F)	;ONLY GET HERE ON OUTPUT.
  1241	001024'	260040	000463'		PUSHJ	P,BDIO		;DEC PGYDIOS.
  1242	001025'	324740	000436'		PJRST	SDCIO2		;RETURN HERE ON NOTHING TO DO.
  1243
  1244	001026'	135300	001005*	FTARW5:	LDB	T1,PIOMOD	;ADJUST DEVABC IF BUFFERED
  1245	001027'	305300	000016		CAIGE	T1,DR		;MODE.
  1246	001030'	350004	000013		AOS	DEVABC(F)	;
  1247	001031'	660000	400000		TRO	S,IOIMPM	;SET IMPROPER
  1248	001032'	202004	000002		MOVEM	S,DEVIOS(F)	;MODE.
  1249	001033'	324740	000440'		PJRST	SDCIO3		;EXIT, CLEARING PGYDIOS.
  1250
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 26
FTASER.MAC	25-NOV-87 15:39		

  1251				COMMENT %@@SUBROUTINE SGTDEV
  1252				@@PURPOSE SUBR TO GET A DEVICE IF IT WASN'T AVAILABLE WHEN
  1253				THE SYSTEM CAME UP.
  1254				@@ENTRY EXPECTS T3=UNIT DB AND F=DDB.
  1255				@@ACCUM DESTROYS NO ACS.
  1256				@@FUNCTION SETS UP PART OF THE DEVICE LIST ENTRY.
  1257				TRIES TO SENSE THE UNIT TO GET THE INFORMATION
  1258				FOR LH(UNITYP); IF SUCCESSFUL, ALSO STORES KONTROLLER CAPABI-
  1259				LITIES IN LH(FTXMCH).
  1260				@@EXIT SKIP RETURNS IF CAN'T ACCESS THE UNIT.
  1261				@@CALLS SUBRSN, SUBRG2, WAIT1, SFISKN, AND SFISUN.
  1262				@@ERRORS SKIP RETURN IF COULDN'T ACCESS THE UNIT.
  1263				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
  1264
  1265	001034'	261040	000006	SGTDEV:	PUSH	P,T1		;SAVE
  1266	001035'	261040	000007		PUSH	P,T2		;SOME OF
  1267	001036'	261040	000011		PUSH	P,T4		;THE
  1268	001037'	261040	000016		PUSH	P,P3		;ACS.
  1269	001040'	135700	004203'		LDB	P3,[POINT 3,DEVADD(F),^D23] ;GET UNIT NO.
  1270	001041'	550350	000420*		HRRZ	T2,UNIKNT(T3)	;T2/ KONT DB ADDRESS.
  1271	001042'	554307	000361*		HLRZ	T1,KONBMX(T2)	;T1/START OF DEVICE LIST.
  1272	001043'	550347	000113*		HRRZ	T2,KONBSU(T2)	;T2/KONTROLLER DEVICE ADDRESS.
  1273	001044'	271316	000000		ADDI	T1,(P3)		;ADDRESS OF UNIT'S ENTRY.
  1274	001045'	271356	000000		ADDI	T2,(P3)		;UNIT'S DEVICE ADDRESS.
  1275	001046'	402006	000000		SETZM	(T1)		;ZERO THE DEVICE LIST ENTRY.
  1276	001047'	137340	004177'		DPB	T2,[POINT 8,(T1),7] ;
  1277	001050'	402010	000003*		SETZM	UNICMD+3(T3)	;0 TU A&B JUST IN CASE.
  1278	001051'	402010	000011*		SETZM	UNICMD+11(T3)	;FLAG FOR 1ST TRY.
  1279	001052'	260040	003045'		PUSHJ	P,SUBRSN	;SET UP A SENSE CMD.
  1280	001053'	551300	000011		HRRZI	T1,FNPUGF	;SET FN IN
  1281	001054'	506304	001016*		HRLM	T1,DEVFNJ(F)	;PROGRESS.
  1282	001055'	260040	003014'		PUSHJ	P,SUBRG2	;GO.
  1283	001056'	260040	001004*		PUSHJ	P,WAIT1		;WAIT.
  1284	001057'	135340	000005'		LDB	T2,BYUTAB	;CAN WE BELIEVE
  1285	001060'	306340	000002		CAIN	T2,READY	;THIS DEVICE?
  1286	001061'	254000	001064'		JRST	SGTDV4		;YES.
  1287	001062'	350001	777774		AOS	-4(P)		;SKIP RETURN ON LOSE.
  1288	001063'	254000	001072'		JRST	SGTDV5		;
  1289	001064'	550350	001041*	SGTDV4:	HRRZ	T2,UNIKNT(T3)	;GET KONT DB ADDRESS BACK.
  1290	001065'	554447	000221*		HLRZ	T4,FTXMCH(T2)	;SET UP KONT CAPABILITIES.
  1291	001066'	620440	000160		TRZ	T4,TRK9!TRK7!DS6250
  1292	001067'	506447	001065*		HRLM	T4,FTXMCH(T2)	;
  1293	001070'	260040	000206'		PUSHJ	P,SFISKN	;YES, SET UP KONTROLLER INFO.
  1294	001071'	260040	000230'		PUSHJ	P,SFISUN	;SET UP UNIT INFO.
  1295	001072'	262040	000016	SGTDV5:	POP	P,P3		;RESTORE
  1296	001073'	262040	000011		POP	P,T4		;THE ACS THAT
  1297	001074'	262040	000007		POP	P,T2		;WERE
  1298	001075'	262040	000006		POP	P,T1		;SAVED.
  1299	001076'	263040	000000		POPJ	P,
  1300
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 27
FTASER.MAC	25-NOV-87 15:39		

  1301				COMMENT %@@SUBROUTINE SAVAIL
  1302				@@PURPOSE SUBR TO MAKE THE UNIT AVAILABLE.
  1303				@@ENTRY EXPECTS F=DDB.
  1304				@@ACCUM DESTROYS S, T3, AND T4.
  1305				(T3 IS SET TO UNIT DB AND S TO DEVIOS).
  1306				@@FUNCTION
  1307					 IS LH(UNITYP)<>0 (UNIT INITIALIZED AT SYSTEM START)?
  1308						1. IF NO, CALL SGTDEV REPEATEDLY UNTIL IT
  1309						   WINS (EACH TIME IT FAILS TELL THE USER WITH
  1310						   FHGSTP). WHEN IT WINS, RETURN.
  1311						2. IF YES, THEN CHECK HNGFTA IN DEVIOS.
  1312							A. IF HNGFTA IS NOT SET, RETURN.
  1313							B. IF HNGFTA IS SET, SENSE TO SEE IF
  1314							   INTERVENTION IS STILL REQUIRED.
  1315							   IF IT IS, SAY SO VIA HNGSTP.  ON
  1316							   CONTINUE FROM HNGSTP, GO TO STEP 2.
  1317							   IF IT IS NOT, CLEAR HNGFTA & RETURN.
  1318				@@EXIT RETURNS WHEN THE UNIT IS PROBABLY AVAILABLE (SEE
  1319				FUNCTION AND ERRORS.).
  1320				@@CALLS SGTDEV, FHGSTP, SUBRSN, SUBRG2, AND WAIT1.
  1321				@@ERRORS NOTE THAT THIS ROUTINE DOES NOT ALWAYS SENSE TO
  1322				SEE THAT THE UNIT IS AVAILABLE; IF LH(UNITYP) IS SET AND
  1323				HNGFTA IS NOT SET, IT JUST RETURNS, EVEN THOUGH THE UNIT MAY
  1324				REALLY NOT BE READY. THIS IS TO AVOID SENSING BEFORE EVERY
  1325				OPERATION.
  1326				@@RESTRICTIONS CALLED AT UUO LEVEL.@@%
  1327				;
  1328				;SETS UP T3 AND S.
  1329
  1330	001077'	261040	000006	SAVAIL:	PUSH	P,T1		;SAVE T1.
  1331	001100'	550404	000560*		HRRZ	T3,DEVUDB(F)	;T3=UNIT DDB ADDRESS.
  1332	001101'	554310	000776*		HLRZ	T1,UNITYP(T3)	;UNIT AVAIL AT SYSTEM START?
  1333	001102'	326300	001107'		JUMPN	T1,SAVAL4	;JUMP ON YES.
  1334
  1335				    ;HERE WHEN UNIT WAS NOT UP WHEN SYSTEM CAME UP.
  1336	001103'	260040	001034'	SAVAL2:	PUSHJ	P,SGTDEV	;NO, TRY TO GET IT NOW.
  1337	001104'	254000	001137'		JRST	SAVAL8		;WON, GO RETURN.
  1338	001105'	260040	003025'		PUSHJ	P,FHGSTP	;LOST, SAY SO.
  1339	001106'	254000	001103'		JRST	SAVAL2		;TRY AGAIN.
  1340
  1341				    ;HERE WHEN UNIT IS UP.
  1342	001107'	200004	000002	SAVAL4:	MOVE	S,DEVIOS(F)	;IS HNGFTA
  1343	001110'	607000	200000		TLNN	S,HNGFTA	;SET?
  1344	001111'	254000	001137'		JRST	SAVAL8		;NO, SO RETURN.
  1345	001112'	254000	001114'		JRST	SAVAL5		;YES.
  1346	001113'	261040	000006	SAVA45:	PUSH	P,T1		;SAVE OF T1 DUE TO RELS BELOW.
  1347	001114'	260040	003045'	SAVAL5:	PUSHJ	P,SUBRSN	;YES, SET UP THE SENSE.
  1348	001115'	551300	000011		HRRZI	T1,FNPUGF	;SET UP
  1349	001116'	506304	001054*		HRLM	T1,DEVFNJ(F)	;THE FN IN PROGRESS.
  1350	001117'	402010	000003*		SETZM	UNICMD+3(T3)	;JUST TO BE SAFE, 0 TO INTREQ.
  1351	001120'	261040	000007		PUSH	P,T2		;SAVE T2.
  1352	001121'	260040	003014'		PUSHJ	P,SUBRG2	;GO.
  1353	001122'	262040	000007		POP	P,T2		;RESTORE T2.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 27-2
FTASER.MAC	25-NOV-87 15:39		

  1354	001123'	260040	000000*		PUSHJ	P,PWAIT1	;WAIT.
  1355	001124'	200004	000002		MOVE	S,DEVIOS(F)	;GET NEW S.
  1356	001125'	200310	000003*		MOVE	T1,UNICMD+3(T3)	;INT REQ
  1357	001126'	603300	200000		TLNE	T1,INTREQ	;STILL?
  1358	001127'	254000	001133'		JRST	SAVAL6		;YES, GO SAY SO.
  1359	001130'	621000	200000		TLZ	S,HNGFTA	;NO, SO CLEAR
  1360	001131'	202004	000002		MOVEM	S,DEVIOS(F)	;IT.
  1361	001132'	254000	001137'		JRST	SAVAL8		;GO RETURN.
  1362	001133'	260040	003025'	SAVAL6:	PUSHJ	P,FHGSTP	;SAY INT REQ.
  1363	001134'	200004	000002		MOVE	S,DEVIOS(F)	;INTRPT LEVEL
  1364	001135'	603000	200000		TLNE	S,HNGFTA	;CLEARED HNGFTA?
  1365	001136'	254000	001114'		JRST	SAVAL5		;NO, GO SEE IF CLEAR.
  1366
  1367	001137'	262040	000006	SAVAL8:	POP	P,T1		;RESTORE T1.
  1368	001140'	263040	000000		POPJ	P,		;
  1369
  1370
  1371
  1372	001141'	261040	000010	FTAGRD:	PUSH	P,T3		;
  1373	001142'	261040	000011		PUSH	P,T4		;
  1374	001143'	260040	001077'		PUSHJ	P,SAVAIL	;
  1375	001144'	262040	000011		POP	P,T4		;
  1376	001145'	262040	000010		POP	P,T3		;
  1377	001146'	263040	000000		POPJ	P,
  1378
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 28
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1379				SUBTTL INTERRUPT PROCESSING
  1380
  1381				COMMENT %@@SUBROUTINE FTXINT
  1382				@@PURPOSE INTERRUPT PROCESSING @@%
  1383
  1384				;THE DDB INTERRUPT/ERROR LOCS OF SPECIAL INTEREST HERE ARE:
  1385				;
  1386				;	DEVER1:	LH=1 IF JUST SENSED DUE TO A UNIT CHECK, ELSE 0.
  1387				;		RH=ADDR OF CMD WE LAST SAW AN ERROR ON.
  1388				;		   (REALLY ADDR OF NEXT CMD).
  1389				;
  1390				;	DEVER2: LH=PHASE OF DATA CHECK-READ RECOVERY, OR 0.
  1391				;		RH=0 IF TAPE CLEANING IS ALLOWED (I.E., WE
  1392				;		   DID NOT HIT THE LOAD POINT WHILE TC).
  1393				;
  1394				;	DEVNOI: # OF ALLOWED NOISE RECORDS PER "REAL RECORD".
  1395				;
  1396				;	DEVOUT: # OF ALLOWED "OUTSIDE" ERRORS LEFT FOR THIS
  1397				;		RECORD.
  1398				;
  1399				;	DEVINS: # OF ALLOWED "INSIDE" ERRORS PER DC-R, OR RETRY
  1400				;		COUNT FOR DC-R PHASES 4 AND 5.
  1401				;
  1402				;	DEV40:  40 COUNT FOR DC-R PHASES.
  1403				;
  1404				;	    ;STORAGE DURING DC-R RECOVERY:
  1405				;	UNIDCR: SAVED READ CMD.
  1406				;	UNIDCN: SAVED NEXT CMD.
  1407				;	UNIDC1: ADDR OF READ CMD.
  1408				;
  1409				;
  1410				;PHASES OF DC-R RECOVERY ARE:
  1411				;
  1412				;    1		READING FORWARDS 40 TIMES.
  1413				;    2		READING BACKWARDS 40 TIMES.
  1414				;    3		READING BACKWARDS 40 TIMES, AFTER A WIN BUT LENGTH
  1415				;    		ERROR IN PHASE 2.  ADJUSTED COUNTS AND MEM ADDRS.
  1416				;    11,12,13	TAPE CLEANING SEQUENCE, PART 1, WITHIN PHASES 1,
  1417				;		2,3.
  1418				;    21,22,23	TAPE CLEANING SEQUENCE, PART 2, WITHIN PHASES 1,
  1419				;		2,3.
  1420				;    4		ADJUST TAPE WITH SKR AND STOP.  (THIS FLAG IS ALSO USED
  1421				;		FOR TAPE ADJUSTMENT WHEN WE DIED ON WRITING.)
  1422				;    5		ADJUST TAPE WITH SKR AND CONTINUE.
  1423				;    6		ADJUST TAPE WITH BSR FOR PHASE 7.
  1424				;    7		ONCE ONLY READ FORWARDS AFTER PHASES 2 OR 3 HAVE FAILED.
  1425				;
  1426				;
  1427				;ON ENTRY, J=KONT DB AND R=CHANNEL DB.
  1428				;
  1429				;WORKING ACS ARE T3=UNIT DB, F=DDB, R=CHANNEL DB, J=KONT DB,
  1430				;P3="UNIT NUMBER", U=4 WORD AREA ADDRESS+1, AND S.
  1431				;
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 28-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1432				;OTHER ACS DESTROYED ARE T1,T2,T4, AND M.
  1433
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 29
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1434				    ;SET UP T1,T3,S,U,P3, AND F.
  1435	001147'	200243	000073*	FTXINT:	MOVE	U,CHNSTB(PG)	;U=4 WORD AREA ADDR+1.
  1436	001150'	200305	000000		MOVE	T1,(U)		;T1=1ST STATUS WORD.
  1437	001151'	202302	000000*		MOVEM	T1,FTXSX1(J)	;SAVE IT FOR DEBUGGING.
  1438	001152'	135700	004224'		LDB	P3,[POINT 3,T1,^D23] ;P3=UNIT NO.
  1439	001153'	332422	000000*		SKIPE	T3,@KONPTR(J)	;T3=UNIT DB.
  1440	001154'	254000	001167'		JRST	FTXIN2
  1441	001155'	603300	400000		TLNE	T1,ASYNCH	;INTRPT FOR NON-EXIST UNIT.
  1442	001156'	607300	000200		TLNN	T1,CUEND	;BETTER BY ASYNCH CUEND,
  1443	001157'	254000	001164'		JRST	FTXIN1		;ELSE IT IS SPURIOUS.
  1444	001160'	603300	000020		TLNE	T1,DEVEND
  1445	001161'	254000	001164'		JRST	FTXIN1
  1446	001162'	402002	000000*		SETZM	FTXBSY(J)	;HERE ON ASYNCH CUEND.
  1447	001163'	254000	002075'		JRST	FXBSY4		;GO RESTART WAITERS.
  1448	001164'	350002	000000*	FTXIN1:	AOS	FTXSPR(J)	;INC COUNT OF SPURIOUS INTRPTS.
  1449	001165'	202302	000000*		MOVEM	T1,FTXSP1(J)	;SAVE LAST ONE.
  1450	001166'	254000	001473'		JRST	FXDSM2		;DISMISS.
  1451	001167'	200210	000541*	FTXIN2:	MOVE	F,UNIDDB(T3)	;F=DDB.
  1452	001170'	200004	000002		MOVE	S,DEVIOS(F)	;GET S.
  1453	001171'	202310	000000*		MOVEM	T1,UNISX1(T3)	;SAVE
  1454	001172'	200345	000001		MOVE	T2,1(U)		;SAXBAS LOCS
  1455	001173'	202350	000000*		MOVEM	T2,UNISX2(T3)	;FOR
  1456	001174'	200345	000002		MOVE	T2,2(U)		;DEBUGGING
  1457	001175'	202350	000000*		MOVEM	T2,UNISX3(T3)	;PURPOSES.
  1458
  1459	001176'	603300	000100		TLNE	T1,BUSY		;BUSY SET?
  1460	001177'	254000	001210'		JRST	FTXIN4		;YES.
  1461	001200'	332002	001162*		SKIPE	FTXBSY(J)	;NO, RESTART SINCE PREV BUSY+CUEND?
  1462	001201'	260040	002151'		PUSHJ	P,SSTAL0	;YES, RESTART WAITING UNITS.
  1463	001202'	402002	001200*		SETZM	FTXBSY(J)
  1464	001203'	603300	000200		TLNE	T1,CUEND	;NOT BUSY + CUEND +
  1465	001204'	603300	000020		TLNE	T1,DEVEND	;NOT DEVEND IS ASYNCH CUEND.
  1466	001205'	254000	001210'		JRST	FTXIN4		;NO.
  1467	001206'	607300	000014		TLNN	T1,UNITCK!UNITEX ;EXCEPT UC OR UE.
  1468	001207'	254000	002075'		JRST	FXBSY4		;YES, GO RESTART WAITERS.
  1469
  1470
  1471				;IS THERE A FN IN PROGRESS?
  1472	001210'	554544	001116*	FTXIN4:	HLRZ	M,DEVFNJ(F)	;GET FN.
  1473	001211'	326540	001217'		JUMPN	M,FXERCK	;JUMP ON REALLY A FN.
  1474	001212'	603300	000010		TLNE	T1,UNITCK	;IF UNIT CHECK,
  1475	001213'	254000	002025'		JRST	FXUCG1		;WE MUST SENSE.
  1476	001214'	621000	200000		TLZ	S,HNGFTA	;ELSE MAYBE THE UNIT
  1477	001215'	202004	000002		MOVEM	S,DEVIOS(F)	;WAS READIED.
  1478	001216'	254000	001473'		JRST	FXDSM2		;DISMISS.
  1479
  1480
  1481
  1482				    ;HERE WHEN A FN IS IN PROGRESS.
  1483				;CHECK FOR ERRORS (SEQUENCE OF CHECKING IS IMPORTANT).
  1484	001217'	331003	001147*	FXERCK:	SKIPL	CHNSTB(PG)	;FIRST SEE IF NO ERRORS OR
  1485	001220'	603300	162310		TLNE	T1,SELERR!BUSIN!CNTLER!PRGINT!CUEND!BUSY!UNITCK
  1486	001221'	254000	001713'		JRST	FXER1		;OTHER INTERESTING THINGS
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 29-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1487	001222'	554444	000407*		HLRZ	T4,DEVER1(F)	;INCLUDING JUST SENSING AFTER A
  1488	001223'	326440	001745'		JUMPN	T4,FXSNC2	;UC HAS HAPPENED.
  1489	001224'	550344	001222*	FXERC6:	HRRZ	T2,DEVER1(F)	;WERE WE ERROR PROCESSING?
  1490	001225'	322340	001453'		JUMPE	T2,FXNRML	;JUMP ON NO.
  1491	001226'	554444	000000*		HLRZ	T4,DEVER2(F)	;GET PHASE OF DC-R.
  1492	001227'	322440	001453'		JUMPE	T4,FXNRML	;JUMP ON NOT IN DC-R RECOVERY.
  1493	001230'	302440	000007		CAIE	T4,7		;WIN ON PHASES 1
  1494	001231'	306440	000001		CAIN	T4,1		;OR 7 IS
  1495	001232'	254000	001453'		JRST	FXNRML		;REALLY A WIN.
  1496	001233'	550445	000001		HRRZ	T4,1(U)		;MAYBE GOT PAST
  1497	001234'	307447	000000		CAIG	T4,(T2)		;ERROR?
  1498	001235'	254000	001240'		JRST	FXWON		;NO.
  1499	001236'	302447	000001		CAIE	T4,1(T2)	;SPECIAL CASE OF WIN ON PHASES 2 OR 3?
  1500	001237'	254000	001453'		JRST	FXNRML		;NO.
  1501
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 30
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1502				;HERE WHEN WON ON A PHASE OF DC-R RECOVERY.
  1503				;(PHASES 2,3,4,5 OR TC1(11,12,13) OR TC2(21,22,23).).
  1504
  1505	001240'	554444	001226*	FXWON:	HLRZ	T4,DEVER2(F)	;GET PHASE.
  1506	001241'	305440	000011		CAIGE	T4,11		;TAPE CLEANING?
  1507	001242'	254000	001261'		JRST	FXWON1		;NO.
  1508
  1509				    ;WON ON TC.
  1510	001243'	201300	000012		MOVEI	T1,INSERR	;WE WILL NOW EITHER
  1511	001244'	552304	000000*		HRRZM	T1,DEVINS(F)	;TC2 OR READ AGAIN.
  1512	001245'	301440	000021		CAIL	T4,21		;WON ON TC2?
  1513	001246'	254000	001254'		JRST	FXWON0		;YES.
  1514
  1515				    ;WON ON TC1.
  1516	001247'	271440	000010		ADDI	T4,10		;SHOW THIS IS
  1517	001250'	506444	001240*		HRLM	T4,DEVER2(F)	;TC2.
  1518	001251'	515300	540334		HRLZI	T1,SKR		;SET
  1519	001252'	260040	003611'		PUSHJ	P,STC12		;UP TC2 SEQUENCE AND
  1520	001253'	254000	001473'		JRST	FXDSM2		;GO.
  1521
  1522				    ;WON ON TC2.
  1523	001254'	275440	000020	FXWON0:	SUBI	T4,20		;CHANGE THE PHASE
  1524	001255'	506444	001250*		HRLM	T4,DEVER2(F)	;BACK TO 1, 2, OR 3.
  1525	001256'	550450	000000*		HRRZ	T4,UNIDC1(T3)	;GEN SM,TIE,
  1526	001257'	260040	003652'		PUSHJ	P,STIE		;TIC.
  1527	001260'	254000	001473'		JRST	FXDSM2		;GO.
  1528
  1529				    ;WON ON PHASES 2,3,4,5, OR 6.
  1530	001261'	135340	001026*	FXWON1:	LDB	T2,PIOMOD	;GET MODE.
  1531	001262'	254031	001261'		JRST	@.-1(T4)
  1532	001263'	000000	001324'		FXWON2		;WON ON PHASE 2.
  1533	001264'	000000	001427'		FXWON3		;WON ON PHASE 3.
  1534	001265'	000000	001270'		FXWON4		;WON ON PHASE 4.
  1535	001266'	000000	001303'		FXWON5		;WON ON PHASE 5.
  1536	001267'	000000	002627'		FXWNP7		;WON ON PHASE 6.
  1537
  1538				    ;WON ON PHASE 4.
  1539	001270'	301340	000016	FXWON4:	CAIL	T2,DR		;BUFFERED?
  1540	001271'	254000	001465'		JRST	FXSTOP		;NO, STOP.
  1541	001272'	554304	001210*		HLRZ	T1,DEVFNJ(F)	;YES.
  1542	001273'	302300	000013		CAIE	T1,FNPWRT	;WRITING?
  1543	001274'	254000	001300'		JRST	FXWN44		;NO.
  1544	001275'	350004	000013		AOS	DEVABC(F)	;YES.
  1545	001276'	260040	000463'		PUSHJ	P,BDIO		;DEC PGYDIOS.
  1546	001277'	254000	001465'		JRST	FXSTOP
  1547	001300'	607000	000040	FXWN44:	TLNN	S,IOEND		;READING.  BUMP BUFFER COUNT?
  1548	001301'	260040	003555'		PUSHJ	P,SBUFZR	;YES.
  1549	001302'	254000	001465'		JRST	FXSTOP		;STOP.
  1550
  1551				    ;WON ON PHASE 5.
  1552				    ;(HERE ON BUFFERED OR (DR AND NEITHER HALT NOR IOBKTL)).
  1553	001303'	306340	000016	FXWON5:	CAIN	T2,DR		;BUFFERED?
  1554	001304'	254000	001315'		JRST	FXWN57		;NO, DR.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 30-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1555	001305'	550304	001224*		HRRZ	T1,DEVER1(F)	;T1=ADDR OF
  1556	001306'	360300	001307'		SOJ	T1,.+1		;LAST DW.
  1557	001307'	260040	003546'		PUSHJ	P,SBUFCT	;CALC (DEVBWC) AND DEVABC.
  1558	001310'	204310	000000*		MOVS	T1,UNIDCN(T3)	;HALT
  1559	001311'	306300	400000		CAIN	T1,HALT		;NEXT?
  1560	001312'	254000	001465'		JRST	FXSTOP		;YES.
  1561	001313'	603000	000001		TLNE	S,IOW		;NO.
  1562	001314'	260040	000000*		PUSHJ	P,SETIOD	;UNWAIT.
  1563	001315'	550444	001305*	FXWN57:	HRRZ	T4,DEVER1(F)	;RESTORE
  1564	001316'	200310	001310*		MOVE	T1,UNIDCN(T3)	;NEXT
  1565	001317'	202311	000000		MOVEM	T1,(T4)		;CMD.
  1566	001320'	260040	003640'		PUSHJ	P,SSMTIC	;GEN SM, TIC.
  1567	001321'	402004	001315*		SETZM	DEVER1(F)	;TURN OFF
  1568	001322'	402004	001255*		SETZM	DEVER2(F)	;E.P.
  1569	001323'	254000	001473'		JRST	FXDSM2		;GO.
  1570
  1571
  1572				    ;WON ON PHASE 2.
  1573	001324'	607300	000004	FXWON2:	TLNN	T1,UNITEX	;UNIT EXCEPTION?
  1574	001325'	254000	001341'		JRST	FXWN21		;NO.
  1575	001326'	301340	000016		CAIL	T2,DR		;YES.  SAW
  1576	001327'	664000	020000		TROA	S,IODEND	;TM
  1577	001330'	620000	020000		TRZ	S,IODEND	;SO
  1578	001331'	661000	000040		TLO	S,IOEND		;SET UP S.
  1579
  1580				    ;COMMON ROUTINE FOR END, READ NOTHING IN LAST "REQUEST",
  1581				    ;ADJUST TAPE.
  1582				    ;HERE ON SAW TAPE MARK ON PHASE 2, AND SOME FATAL ERRORS.
  1583	001332'	302340	000016	FCMRDA:	CAIE	T2,DR		;DR?
  1584	001333'	254000	001441'		JRST	FXWNP4		;NO.
  1585	001334'	550305	000001		HRRZ	T1,1(U)		;YES.
  1586	001335'	260040	003451'		PUSHJ	P,SGPREV
  1587	001336'	201311	777777		MOVEI	T1,-1(T4)
  1588	001337'	260040	003533'		PUSHJ	P,SDMPCT
  1589	001340'	254000	001441'		JRST	FXWNP4		;ALL GO TO PHASE 4.
  1590
  1591	001341'	607300	004000	FXWN21:	TLNN	T1,LENERR	;LENGTH ERROR?
  1592	001342'	254000	001427'		JRST	FXWON3		;NO.
  1593	001343'	260040	004053'		PUSHJ	P,SLENER	;YES.
  1594	001344'	254000	001424'		JRST	FXWN28		;TAPE > REQUEST.
  1595	001345'	603000	400000		TLNE	S,COMPAT	;TAPE < REQ.
  1596	001346'	254000	001354'		JRST	FXWN22		;MAYBE SET
  1597	001347'	200330	001256*		MOVE	T1,@UNIDC1(T3)	;THE ODD
  1598	001350'	606440	000001		TRNN	T4,1		;NO.
  1599	001351'	625300	002000		TLZA	T1,2000		;OF
  1600	001352'	661300	002000		TLO	T1,2000		;WORDS
  1601	001353'	202330	001347*		MOVEM	T1,@UNIDC1(T3)	;BIT.
  1602	001354'	200540	000011	FXWN22:	MOVE	M,T4		;SAVE ACTUAL.
  1603	001355'	550304	001321*		HRRZ	T1,DEVER1(F)	;SET UP  T1
  1604	001356'	201306	777777		MOVEI	T1,-1(T1)	;FOR SWRDRD.
  1605	001357'	260040	003513'		PUSHJ	P,SWRDRD	;T4=REQUEST.
  1606	001360'	340300	001361'		AOJ	T1,.+1		;T1=ADDR OF 1ST DW.
  1607	001361'	274440	000013		SUB	T4,M		;T4=REQUEST-TAPE.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 30-3
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1608	001362'	135540	004225'	FXWN23:	LDB	M,[POINT ^D11,(T1),^D11] ;FIND
  1609	001363'	670540	000032'		TDO	M,MSKCTU	;UNUSED
  1610	001364'	270440	000013		ADD	T4,M		;DATA
  1611	001365'	323440	001367'		JUMPLE	T4,.+2		;WORDS.
  1612	001366'	344300	001362'		AOJA	T1,FXWN23	;T1=ADDR OF 1ST USED DW.
  1613	001367'	321440	001371'		JUMPL	T4,.+2		;JUMP ON EXACTLY
  1614	001370'	344300	001376'		AOJA	T1,FXWN25	;FINISHED DW.
  1615	001371'	135340	004226'		LDB	T2,[POINT ^D24,(T1),^D35] ;ADJUST
  1616	001372'	270340	000013		ADD	T2,M		;THE
  1617	001373'	274340	000011		SUB	T2,T4		;"1ST"
  1618	001374'	137440	004227'		DPB	T4,[POINT ^D11,T2,^D11] ;DATA
  1619	001375'	202346	000000		MOVEM	T2,(T1)		;WORD.
  1620	001376'	200350	001353*	FXWN25:	MOVE	T2,UNIDC1(T3)	;T2=ADDR OF CMD.
  1621	001377'	301346	777777		CAIL	T2,-1(T1)	;MOVE?
  1622	001400'	254000	001413'		JRST	FXWN26		;NO NEED.
  1623	001401'	200547	000000		MOVE	M,(T2)		;YES. MOVE
  1624	001402'	402007	000000		SETZM	(T2)		;THE CMD
  1625	001403'	305346	777776		CAIGE	T2,-2(T1)	;DOWN AND ZERO THE
  1626	001404'	344340	001402'		AOJA	T2,.-2		;UNUSED PLACES SO SDMPCT/SBUFST
  1627	001405'	202547	000001		MOVEM	M,1(T2)		;WILL WORK.
  1628	001406'	271340	000001		ADDI	T2,1		;NOTE THE
  1629	001407'	202350	001376*		MOVEM	T2,UNIDC1(T3)	;NEW POSITION OF CMD.
  1630	001410'	550444	001355*		HRRZ	T4,DEVER1(F)	;MARK
  1631	001411'	515540	400000		HRLZI	M,LASDAT	;LAST DW AS
  1632	001412'	436551	777777		IORM	M,-1(T4)	;LAST.
  1633	001413'	201540	000003	FXWN26:	MOVEI	M,3		;SET UP FOR PHASE 3.
  1634				    ;GO ON START OF PHASES 2,3, OR 7.
  1635	001414'	551300	000050	FXPHGO:	HRRZI	T1,^D40		;SET 40
  1636	001415'	552304	000000*		HRRZM	T1,DEV40(F)	;COUNT.
  1637	001416'	551300	000012		HRRZI	T1,INSERR	;SET
  1638	001417'	202304	001244*	FXPHG2:	MOVEM	T1,DEVINS(F)	;INSIDE ERROR COUNTS.
  1639	001420'	506544	001322*		HRLM	M,DEVER2(F)	;STORE PHASE.
  1640	001421'	550450	001407*		HRRZ	T4,UNIDC1(T3)	;GEN SM,
  1641	001422'	260040	003640'		PUSHJ	P,SSMTIC	;TIC
  1642	001423'	254000	001473'		JRST	FXDSM2		;GO.
  1643
  1644
  1645				    ;HERE ON TAPE > REQUEST
  1646	001424'	302340	000017	FXWN28:	CAIE	T2,D		;BUFFERED AND DR
  1647	001425'	660000	040000		TRO	S,IOBKTL	;SET IOBKTL.
  1648	001426'	254000	002627'		JRST	FXWNP7		;GO TO PHASE 4.
  1649
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 31
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1650				    ;WON ON PHASE 3 OR ON PHASE 2 WITH NO LEN ERR.
  1651	001427'	305340	000016	FXWON3:	CAIGE	T2,DR		;BUFFERED?
  1652	001430'	254000	001443'		JRST	FXWNP5		;YES.  JUST GO TO PHASE 5.
  1653	001431'	302340	000016		CAIE	T2,DR		;DR?
  1654	001432'	254000	001436'		JRST	FXWN32		;NO.  D.
  1655	001433'	204310	001316*		MOVS	T1,UNIDCN(T3)	;DR.  NEXT IS HALT?
  1656	001434'	302300	400000		CAIE	T1,HALT		;HALT?
  1657	001435'	254000	001443'		JRST	FXWNP5		;NO, GO TO PHASE 5.
  1658	001436'	550444	001410*	FXWN32:	HRRZ	T4,DEVER1(F)	;YES.  SET UP T1
  1659	001437'	201311	777777		MOVEI	T1,-1(T4)	;FOR SDMPCT.
  1660	001440'	260040	003533'		PUSHJ	P,SDMPCT	;CALC DEVDWC AND
  1661								;STOP WITH PHASE 4.
  1662
  1663
  1664				    ;SET UP PHASE 4 (ADJUST AND STOP).
  1665	001441'	551540	000004	FXWNP4:	HRRZI	M,4		;PHASE IS 4.
  1666	001442'	254000	001444'		JRST	FXWNAJ		;
  1667
  1668				    ;SET UP PHASE 5 (ADJUST AND CONTINUE).
  1669	001443'	551540	000005	FXWNP5:	HRRZI	M,5		;PHASE IS 5.
  1670	001444'	515300	540334	FXWNAJ:	HRLZI	T1,SKR		;GEN SKR.
  1671	001445'	254000	001450'		JRST	FXWNA2
  1672
  1673				    ;SET UP PHASE 6 (ADJUST FOR PHASE 7.).
  1674	001446'	551540	000006	FXWNP6:	HRRZI	M,6		;PHASE IS 6.
  1675	001447'	515300	540234		HRLZI	T1,BSR		;GEN BSR.
  1676	001450'	506544	001420*	FXWNA2:	HRLM	M,DEVER2(F)	;STORE PHASE.
  1677	001451'	260040	003733'		PUSHJ	P,SSKBSR	;GEN SM/SKR OR BSR/HALT AND RETRY COUNT.
  1678	001452'	254000	001473'		JRST	FXDSM2		;GO.
  1679
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 32
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1680				;"NORMAL" (I.E., ONLY UNIT EXCEPTION OR LENGTH ERROR) END OF
  1681				;INTERRUPT PROCESSING.
  1682				;
  1683				;AT START, M=FN IN PROGRESS AND T1=1ST STATUS WORD.
  1684
  1685	001453'	402004	001450*	FXNRML:	SETZM	DEVER2(F)	;TURN OFF ERROR
  1686	001454'	402004	001436*		SETZM	DEVER1(F)	;PROCESSING.
  1687	001455'	307540	000010		CAIG	M,FNPBSF	;MTAPE FN?
  1688	001456'	254000	001500'		JRST	FXNMMT		;YES.
  1689	001457'	301540	000012		CAIL	M,FNPRED	;NO.  FTARED/WRT?
  1690	001460'	254000	001545'		JRST	FXNMRW		;YES.
  1691	001461'	135300	000007'		LDB	T1,BYUTIN	;MUST BE UGETF OR MTAPE SENSE.
  1692	001462'	322300	001464'		JUMPE	T1,.+2		;TAPE INDICATE ON?
  1693	001463'	674000	004230'		TDOA	S,[XWD IOLEND,IOTEND] ;YES, SET EOT.
  1694	001464'	630000	004230'	FXSTP0:	TDZ	S,[XWD IOLEND,IOTEND]
  1695
  1696
  1697				    ;DISMISS THE INTERRUPT.
  1698	001465'	603000	000001	FXSTOP:	TLNE	S,IOW
  1699	001466'	260040	001314*		PUSHJ	P,SETIOD
  1700	001467'	620000	010000		TRZ	S,IOACT
  1701	001470'	202004	000002		MOVEM	S,DEVIOS(F)
  1702	001471'	554304	001272*		HLRZ	T1,DEVFNJ(F)	;GET THE FN IN PROGRESS.
  1703	001472'	260040	000434'		PUSHJ	P,SDCIOA	;DEC DON'T SWAP CNT AND CLR FNP.
  1704	001473'	256003	000421*	FXDSM2:	XCT	CHNGO(PG)
  1705	001474'	256003	000307*		XCT	CHNCLR(PG)
  1706	001475'	263040	000000		POPJ	P,
  1707
  1708				    ;DISMISS THE INTERRUPT.
  1709	001476'	260040	003023'	FXDSM1:	PUSHJ	P,FSTHNG
  1710	001477'	254000	001473'		JRST	FXDSM2
  1711
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 33
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1712				;NORMAL END OF INTERRUPT PROCESSING FOR MTAPE FNS.
  1713				;
  1714				;N.B., UNIT EXCEPTION HERE MEANS (1) WTM OR ERG SAW EOT, OR
  1715				;(2) SKR(SKF) OR BSR(BSF) SAW A TM.
  1716
  1717
  1718	001500'	303540	000006	FXNMMT:	CAILE	M,FNPERG	;1 CMD FNS?
  1719	001501'	254000	001527'		JRST	FXMT6		;NO.
  1720
  1721				    ;NORMAL END OF INTERRUPT PROCESSING FOR MTAPE 1 CMD FNS.
  1722				    ;(REW, REW/UNL, ERG, WTM, SKR, BSR).
  1723	001502'	306540	000005		CAIN	M,FNPRWU	;REWIND UNLOAD?
  1724	001503'	254000	001473'		JRST	FXDSM2		;YES, IGNORE THIS INITIAL INTRPT.
  1725	001504'	302540	000001		CAIE	M,FNPREW	;REWIND?
  1726	001505'	254000	001511'		JRST	FXMT2		;NO.
  1727	001506'	607300	000020		TLNN	T1,DEVEND	;YES, WHICH INTRPT?
  1728	001507'	254000	001473'		JRST	FXDSM2		;1ST ONE, IGNORE IT.
  1729	001510'	254000	001523'		JRST	FXMT0		;LAST ONE, PROCESS IT.
  1730	001511'	302540	000006	FXMT2:	CAIE	M,FNPERG	;ERG OR
  1731	001512'	306540	000002		CAIN	M,FNPWTM	;WTM?
  1732	001513'	254000	001517'		JRST	FXMT00		;YES.
  1733	001514'	603300	000004		TLNE	T1,UNITEX	;NO, BSR OR SKR.
  1734	001515'	660000	020000		TRO	S,IODEND	;IF UNITEX, SAW TM.
  1735	001516'	254000	001532'		JRST	FXMTSN		;GO SENSE FOR EOT.
  1736	001517'	603300	000004	FXMT00:	TLNE	T1,UNITEX	;HERE ON ERG OR WTM.
  1737	001520'	674000	004230'		TDOA	S,[XWD IOLEND,IOTEND] ;IF UNITEX, SAW
  1738	001521'	630000	004230'		TDZ	S,[XWD IOLEND,IOTEND] ;AN
  1739	001522'	254000	001465'		JRST	FXSTOP		;EOT.
  1740	001523'	630000	004230'	FXMT0:	TDZ	S,[XWD IOLEND,IOTEND] ;HERE ON REW
  1741	001524'	336004	001454*		SKIPN	DEVER1(F)	;BSR/F MAY GET HERE FROM EP
  1742	001525'	660000	004000		TRO	S,IOBOT		;BUT EP DOES NOT SET IOBOT.
  1743	001526'	254000	001465'		JRST	FXSTOP		;
  1744
  1745
  1746				    ;NORMAL END OF INTERRUPT PROCESSING FOR MTAPE >1 CMD FNS.
  1747	001527'	607300	000004	FXMT6:	TLNN	T1,UNITEX	;UNIT EXCEPTION?
  1748	001530'	254000	001543'		JRST	FXMT7		;NO, CONTINUE.
  1749	001531'	660000	020000		TRO	S,IODEND	;YES, SAW EOF.
  1750	001532'	202004	000002	FXMTSN:	MOVEM	S,DEVIOS(F)	;STORE S.
  1751	001533'	260040	003045'		PUSHJ	P,SUBRSN	;YES.  SENSE
  1752	001534'	201300	000011		MOVEI	T1,FNPUGF	;FOR
  1753	001535'	506304	001471*		HRLM	T1,DEVFNJ(F)	;EOT.
  1754	001536'	201310	000117*		MOVEI	T1,UNICMD(T3)
  1755	001537'	260040	002745'		PUSHJ	P,SUBSTI
  1756	001540'	402004	001524*		SETZM	DEVER1(F)
  1757	001541'	402004	001453*		SETZM	DEVER2(F)
  1758	001542'	254000	001473'		JRST	FXDSM2
  1759	001543'	260040	002760'	FXMT7:	PUSHJ	P,SUBRST
  1760	001544'	254000	001473'		JRST	FXDSM2
  1761
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 34
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1762				;NORMAL END OF INTERRUPT PROCESSING FOR FTARED/WRT.
  1763
  1764	001545'	135340	001261*	FXNMRW:	LDB	T2,PIOMOD	;T2=MODE.
  1765	001546'	607300	000004		TLNN	T1,UNITEX	;UNIT EXCEPTION?
  1766	001547'	254000	001611'		JRST	FXRW5		;NO.
  1767
  1768
  1769				    ;HERE ON UNIT EXCEPTION.
  1770	001550'	302540	000013		CAIE	M,FNPWRT	;WRITING?
  1771	001551'	254000	001567'		JRST	FXRW2		;NO.
  1772
  1773				    ;HERE ON WRITING AND UNIT EXCEPTION.
  1774	001552'	670000	004230'		TDO	S,[XWD IOLEND,IOTEND] ;TRIED TO WRITE PAST EOT.
  1775	001553'	301340	000016		CAIL	T2,DR		;THIS IS A CROCK FOR
  1776	001554'	254000	001465'		JRST	FXSTOP		;A HARDWARE PROBLEM THAT
  1777	001555'	550305	000001		HRRZ	T1,1(U)		;OCCURRED ON C33, IN WHICH
  1778	001556'	554306	777777		HLRZ	T1,-1(T1)	;UNIT EX ON WRITE PAST EOT DID
  1779	001557'	302300	400000		CAIE	T1,HALT		;NOT BREAK CHAINING, CAUSING
  1780	001560'	254000	001564'		JRST	FCMWR4		;THE LAST BUFFER TO BE PROCESSED
  1781	001561'	254000	001465'		JRST	FXSTOP		;TWICE, 1=PRGINT,2=HALT+UNITEX.
  1782				    ;COMMON ROUTINE FOR MUST STOP WRITING.  ADJUSTS DEVABC
  1783				    ;FOR BUFFERED MODE.
  1784	001562'	301340	000016	FCMWRT:	CAIL	T2,DR		;IF BUFFERED,
  1785	001563'	254000	001465'		JRST	FXSTOP		;
  1786	001564'	350004	000013	FCMWR4:	AOS	DEVABC(F)	;BUMP BUFFER COUNT.
  1787	001565'	260040	000463'		PUSHJ	P,BDIO		;DEC PGYDIOS.
  1788	001566'	254000	001465'		JRST	FXSTOP		;STOP.
  1789
  1790				    ;HERE ON READING AND UNIT EXCEPTION.
  1791	001567'	661000	000040	FXRW2:	TLO	S,IOEND		;TRIED TO
  1792	001570'	305340	000016		CAIGE	T2,DR		;READ PAST
  1793	001571'	254000	001574'		JRST	.+3		;EOT.
  1794	001572'	660000	020000		TRO	S,IODEND	;D OR
  1795	001573'	254000	001600'		JRST	FCMRD1		;DR.
  1796	001574'	620000	020000		TRZ	S,IODEND	;BUFFERED.
  1797	001575'	254000	001465'		JRST	FXSTOP		;
  1798
  1799				;COMMON ROUTINE FOR END, READ NOTHING IN LAST "REQUEST".
  1800				;HERE ON READ EOF OR FATAL READ ERROR.
  1801	001576'	305340	000016	FCMRD0:	CAIGE	T2,DR		;D OR DR?
  1802	001577'	254000	001607'		JRST	FCMRD2		;NO.
  1803	001600'	302340	000016	FCMRD1:	CAIE	T2,DR		;YES.  DR?
  1804	001601'	254000	001465'		JRST	FXSTOP		;D.  DONE.
  1805	001602'	550305	000001		HRRZ	T1,1(U)		;DR.  SET UP T1.
  1806	001603'	260040	003451'		PUSHJ	P,SGPREV	;T4=ADDR OF PREVIOUS CMD.
  1807	001604'	201311	777777		MOVEI	T1,-1(T4)	;SET UP
  1808	001605'	260040	003533'		PUSHJ	P,SDMPCT	;DEVDWC.
  1809	001606'	254000	001465'		JRST	FXSTOP		;STOP.
  1810	001607'	260040	003555'	FCMRD2:	PUSHJ	P,SBUFZR	;0 TO (DEVBWC), BUMP DEVABC.
  1811	001610'	254000	001465'		JRST	FXSTOP		;STOP.
  1812
  1813
  1814
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 34-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1815				    ;HERE ON A HALT OR LENGTH ERROR.
  1816	001611'	302540	000013	FXRW5:	CAIE	M,FNPWRT	;WRITING?
  1817	001612'	254000	001630'		JRST	FXRW7		;NO.
  1818	001613'	630000	004230'		TDZ	S,[XWD IOLEND,IOTEND] ;YES, NO UE SO NOT PAST EOT.
  1819
  1820				    ;WRITING, HALT.
  1821	001614'	302340	000017	FXRWCN:	CAIE	T2,D		;BUF OR DR AND MORE TO DO?
  1822	001615'	336004	001012*	FXRWC2:	SKIPN	DEVCNT(F)	;MORE TO DO?
  1823	001616'	254000	001465'		JRST	FXSTOP		;NO.
  1824	001617'	260040	003127'		PUSHJ	P,SCOMBL	;YES.  SET IT UP
  1825	001620'	254000	001622'		JRST	.+2		;AND GO.
  1826	001621'	254000	001465'		JRST	FXSTOP		;DONE.
  1827	001622'	607000	000001		TLNN	S,IOW		;IN IOW?
  1828	001623'	254000	001473'		JRST	FXDSM2		;NO, JUST CONTINUE.
  1829	001624'	135340	001545*		LDB	T2,PIOMOD	;GET MODE.
  1830	001625'	302340	000016		CAIE	T2,DR		;DR?
  1831	001626'	260040	001466*		PUSHJ	P,SETIOD	;NO,  BUFF. CALL SETIOD.
  1832	001627'	254000	001473'		JRST	FXDSM2		;CONTINUE.
  1833
  1834				    ;READING, HALT OR LEN ERR.
  1835	001630'	603300	004000	FXRW7:	TLNE	T1,LENERR	;LENGTH ERROR?
  1836	001631'	254000	001640'		JRST	FXRW9		;YES.
  1837
  1838				    ;READING, HALT.
  1839	001632'	305340	000016		CAIGE	T2,DR		;BUFFERED?
  1840	001633'	254000	001615'		JRST	FXRWC2		;YES, GO SEE IF MORE TO DO.
  1841	001634'	550305	000001		HRRZ	T1,1(U)		;NO.  T1= ADDR OF LAST
  1842	001635'	275300	000002		SUBI	T1,2		;DATA WORD.
  1843	001636'	260040	003533'	FXRW8:	PUSHJ	P,SDMPCT	;SDMPCT(SET UP DEVDWC).
  1844	001637'	254000	001614'		JRST	FXRWCN		;GO SEE IF MORE TO DO.
  1845
  1846				    ;READING, LENGTH ERROR.
  1847	001640'	260040	004053'	FXRW9:	PUSHJ	P,SLENER	;SOME LEN ERR PROCESSING.
  1848	001641'	254000	001700'		JRST	FXRW15		;HERE ON TAPE >REQUEST.
  1849
  1850				    ;TAPE < REQUEST.
  1851	001642'	306340	000016		CAIN	T2,DR		;DR?
  1852	001643'	254000	001661'		JRST	FXRW12		;YES.
  1853	001644'	302340	000017		CAIE	T2,D		;NO, D?
  1854	001645'	254000	001650'		JRST	.+3		;NO.
  1855	001646'	272444	001011*	FXRW10:	ADDM	T4,DEVDWC(F)	;YES, D.
  1856	001647'	254000	001465'		JRST	FXSTOP
  1857	001650'	260040	003566'		PUSHJ	P,SBUFST	;BUFFERED. STORE T4 IN (DEVBWC).
  1858	001651'	260040	003471'	FXRW11:	PUSHJ	P,SGDEV1	;IS THE NEXT
  1859	001652'	554311	000000		HLRZ	T1,(T4)		;COMMAND A
  1860	001653'	306300	400000		CAIN	T1,HALT		;HALT?
  1861	001654'	254000	001615'		JRST	FXRWC2		;YES.
  1862	001655'	603000	000001		TLNE	S,IOW		;NO.  TAKE OUT OF
  1863	001656'	260040	001626*		PUSHJ	P,SETIOD	;IOW AND GEN A
  1864	001657'	260040	003640'		PUSHJ	P,SSMTIC	;SM AND TIC AND THEN
  1865	001660'	254000	001473'		JRST	FXDSM2		;CONTINUE.
  1866
  1867				    ;TAPE < REQUEST, DR.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 34-3
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1868	001661'	200540	000011	FXRW12:	MOVE	M,T4		;M HAS TAPE COUNT.
  1869	001662'	260040	003471'		PUSHJ	P,SGDEV1	;GET AND SAVE
  1870	001663'	261040	000011		PUSH	P,T4		;ADDR OF
  1871	001664'	201311	777777		MOVEI	T1,-1(T4)	;NEXT CMD.
  1872	001665'	260040	003513'		PUSHJ	P,SWRDRD	;T4 HAS REQUEST.
  1873	001666'	274440	000013		SUB	T4,M		;T4 HAS REQUEST - TAPE.
  1874	001667'	210440	000011		MOVN	T4,T4		;ADJUST DEVDWC SO COMES OUT OKAY
  1875	001670'	272444	001646*		ADDM	T4,DEVDWC(F)	;WHEN WORD COUNT CALCED AT END.
  1876	001671'	262040	000006		POP	P,T1		;T1 HAS ADDR OF NEXT CMD.
  1877	001672'	554446	000000	FXRW13:	HLRZ	T4,(T1)		;IS THE NEXT CMD
  1878	001673'	306440	400000		CAIN	T4,HALT		;A HALT?
  1879	001674'	364300	001636'		SOJA	T1,FXRW8	;YES, SEE IF MORE TO DO.
  1880	001675'	551446	000000		HRRZI	T4,(T1)		;
  1881	001676'	260040	003640'		PUSHJ	P,SSMTIC	;GEN SM & TIC AND THEN
  1882	001677'	254000	001473'		JRST	FXDSM2		;CONTINUE.
  1883
  1884
  1885				    ;TAPE > REQUEST.
  1886	001700'	306340	000016	FXRW15:	CAIN	T2,DR		;DR?
  1887	001701'	254000	001707'		JRST	FXRW16		;YES.
  1888	001702'	306340	000017		CAIN	T2,D		;NO, D?
  1889	001703'	254000	001646'		JRST	FXRW10		;YES.
  1890	001704'	260040	003566'		PUSHJ	P,SBUFST	;BUFFERED. STORE T4 IN (DEVBWC).
  1891	001705'	660000	040000		TRO	S,IOBKTL	;THIS IS A FATAL ERROR.
  1892	001706'	254000	001465'		JRST	FXSTOP		;STOP.
  1893
  1894				    ;TAPE > REQUEST, DR.
  1895	001707'	660000	040000	FXRW16:	TRO	S,IOBKTL	;FLAG ERROR.
  1896	001710'	260040	003471'		PUSHJ	P,SGDEV1	;T1=ADDR OF
  1897	001711'	200300	000011		MOVE	T1,T4		;NEXT CMD FOR
  1898	001712'	254000	001672'		JRST	FXRW13		;HALT CHECK.
  1899
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 35
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1900				    ;HERE WITH AN ERROR OR OTHER INTERESTING THING.
  1901	001713'	603300	002000	FXER1:	TLNE	T1,PRGINT	;PROGRAMMED INTRPT?
  1902	001714'	254000	001765'		JRST	FXPRGI		;YES.
  1903	001715'	603300	000010		TLNE	T1,UNITCK	;NO.  UNIT CHECK?
  1904	001716'	254000	002012'		JRST	FXUCGO		;YES.
  1905	001717'	607300	000100		TLNN	T1,BUSY		;NO.  BUSY?
  1906	001720'	254000	001730'		JRST	FXER11		;NO.
  1907	001721'	554444	001540*		HLRZ	T4,DEVER1(F)	;YES.  DURING SENSE DUE TO
  1908	001722'	326440	001725'		JUMPN	T4,.+3		;A UC? IF SO, JUMP.
  1909	001723'	603300	000620		TLNE	T1,STAMOD!CUEND!DEVEND ;NO.  REAL DEVICE BUSY?
  1910	001724'	254000	002040'		JRST	FXBUSY		;NO.
  1911	001725'	260040	002151'		PUSHJ	P,SSTAL0	;YES OR DURING S DUE TO UC.
  1912	001726'	326440	001741'		JUMPN	T4,FXSNC1	;JUMP IF DURING S DUE TO UC.
  1913	001727'	254000	001743'		JRST	FXSNC0		;ELSE REAL DEVICE BUSY.
  1914	001730'	603300	000200	FXER11:	TLNE	T1,CUEND	;CONTROL UNIT END?
  1915	001731'	254000	002077'		JRST	FXBSY6		;YES.
  1916	001732'	554444	001721*		HLRZ	T4,DEVER1(F)	;NO.  SENSE DUE TO UC?
  1917	001733'	322440	002175'		JUMPE	T4,FXEROR	;NO.  MAY ALSO BE SELERR/BUSIN/CNTLER/MEMERR.
  1918
  1919
  1920				    ;HERE ON JUST SENSED DUE TO UC AND ONE OR MORE OF SELECT
  1921				    ;ERROR, BUSIN, CONTROL ERROR, AND MEM ERROR ARE ON.
  1922	001734'	260040	002151'		PUSHJ	P,SSTAL0	;RESTART ANY WAITING UNITS.
  1923	001735'	200442	000000*		MOVE	T4,FTXSS1(J)	;WERE
  1924	001736'	607440	160000		TLNN	T4,SELERR!BUSIN!CNTLER ;OLD ERRORS
  1925	001737'	335002	000000*		SKIPGE	FTXSMY(J)	;INCLUDING MEM ERROR?
  1926	001740'	254000	001751'		JRST	FXSNC4		;YES--SO SENSE INFO DOESN'T MATTER.
  1927	001741'	554342	001042*	FXSNC1:	HLRZ	T2,KONBMX(J)	;CLEAR THE SPECIAL
  1928	001742'	476007	777777		SETOM	-1(T2)		;SENSE LOC.
  1929	001743'	571340	777767	FXSNC0:	HRREI	T2,ERCNSN	;FLAG TYPE OF ERROR AND GO TO
  1930	001744'	254000	002366'		JRST	FXER09		;E. P.
  1931				    ;OK HERE--SINCE SENSE INFO IS OK OR ELSE WE DON'T NEED IT.
  1932	001745'	260040	002151'	FXSNC2:	PUSHJ	P,SSTAL0
  1933	001746'	201310	000000*		MOVEI	T1,FDSENS(T3)	;LOG THE
  1934	001747'	505302	000016*		HRLI	T1,FTXSTS(J)	;SENSE
  1935	001750'	251310	000005*		BLT	T1,FDSENS+5(T3)	;BYTES.
  1936	001751'	554302	001741*	FXSNC4:	HLRZ	T1,KONBMX(J)	;CLEAR THE SPECIAL
  1937	001752'	476006	777777		SETOM	-1(T1)		;SENSE LOC.
  1938	001753'	200302	000000*		MOVE	T1,FTXSS2(J)	;RESTORE
  1939	001754'	202305	000001		MOVEM	T1,1(U)		;THE
  1940	001755'	135300	004231'		LDB	T1,[POINT 1,FTXSMY(J),0] ;OLD STATUS
  1941	001756'	137300	004232'		DPB	T1,[POINT 1,CHNSTB(PG),0] ;AND
  1942	001757'	200302	000000*		MOVE	T1,FTXSM0(J)	;BOTH WORDS
  1943	001760'	202303	000000*		MOVEM	T1,CHNMER(PG)	;OF
  1944	001761'	200302	001735*		MOVE	T1,FTXSS1(J)	;MEM
  1945	001762'	202305	000000		MOVEM	T1,(U)		;ERR INFORMATION.
  1946	001763'	553004	001732*		HRRZS	DEVER1(F)	;TURN OFF THE S DUE TO U C FLAG.
  1947	001764'	254000	002175'		JRST	FXEROR		;GO PROCESS ERROR.
  1948
  1949
  1950				   ;HERE ON PROGRAMMED INTERRUPT.
  1951	001765'	402004	001541*	FXPRGI:	SETZM	DEVER2(F)	;TURN OFF E.P.
  1952	001766'	135340	001624*		LDB	T2,PIOMOD	;GET MODE.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 35-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  1953	001767'	301340	000016		CAIL	T2,DR		;HERE BUFFERED OR DR.  WHICH?
  1954	001770'	254000	001473'		JRST	FXDSM2		;DR.
  1955	001771'	607000	000020		TLNN	S,IO		;BUFFERED.  WRITING?
  1956	001772'	254000	002000'		JRST	FXPRG1		;NO.
  1957	001773'	350004	000013		AOS	DEVABC(F)	;YES.  BUMP BUFFER
  1958	001774'	260040	000463'		PUSHJ	P,BDIO		;DEC PGYDIOS.
  1959	001775'	603300	000004		TLNE	T1,UNITEX	;CROCK FOR HARDWARE PROBLEM
  1960	001776'	670000	004230'		TDO	S,[XWD IOLEND,IOTEND] ;ON C33.
  1961	001777'	254000	002003'		JRST	FXPRG2		;COUNT.
  1962	002000'	550305	000001	FXPRG1:	HRRZ	T1,1(U)		;BUFFERED.
  1963	002001'	201306	777777		MOVEI	T1,-1(T1)	;POINT T1 TO LAST DATA WORD TO
  1964	002002'	260040	003546'		PUSHJ	P,SBUFCT	;SET UP (DEVBWC) AND DEVABC.
  1965	002003'	550305	000001	FXPRG2:	HRRZ	T1,1(U)		;CALL SETIOD IF
  1966	002004'	554306	000000		HLRZ	T1,(T1)		;WAITING, UNLESS
  1967	002005'	306300	400000		CAIN	T1,HALT		;NEXT IS
  1968	002006'	254000	001473'		JRST	FXDSM2		;HALT.
  1969	002007'	603000	000001		TLNE	S,IOW		;WAITING?
  1970	002010'	260040	001656*		PUSHJ	P,SETIOD	;YES.
  1971	002011'	254000	001473'		JRST	FXDSM2
  1972
  1973
  1974				    ;HERE ON A UNIT CHECK, NEED TO SENSE.
  1975	002012'	201440	000001	FXUCGO:	MOVEI	T4,1		;MARK SENSE.
  1976	002013'	506444	001763*		HRLM	T4,DEVER1(F)	;SENSE DUE TO UC.
  1977	002014'	202302	001761*		MOVEM	T1,FTXSS1(J)	;SAVE 1ST AND 2ND
  1978	002015'	200305	000001		MOVE	T1,1(U)		;STATUS
  1979	002016'	202302	001753*		MOVEM	T1,FTXSS2(J)	;WORDS
  1980	002017'	200303	001760*		MOVE	T1,CHNMER(PG)	;AND
  1981	002020'	202302	001757*		MOVEM	T1,FTXSM0(J)	;BOTH
  1982	002021'	200303	001217*		MOVE	T1,CHNSTB(PG)	;MEM ERR INFOS
  1983	002022'	502302	001737*		HLLM	T1,FTXSMY(J)	;IN KONT DB.
  1984	002023'	621300	700000		TLZ	T1,700000	;CLEAR THE MEM ERR
  1985	002024'	502303	002021*		HLLM	T1,CHNSTB(PG)	;FLAGS.
  1986	002025'	137700	004233'	FXUCG1:	DPB	P3,[POINT 3,FTXSNS(J),^D23] ;SET UP A SENSE.
  1987	002026'	201302	000000*		MOVEI	T1,FTXSNS(J)	;POINT THE
  1988	002027'	554342	001751*		HLRZ	T2,KONBMX(J)	;SPECIAL SENSE LOC
  1989	002030'	275340	000001		SUBI	T2,1		;IN THE DEVICE
  1990	002031'	552307	000000		HRRZM	T1,(T2)		;LIST TO THE SENSE.
  1991	002032'	201300	000015		MOVEI	T1,STRTDV	;DPB A START
  1992	002033'	137300	004204'		DPB	T1,[POINT 4,(T2),^D11] ;CODE INTO IT.
  1993	002034'	135300	004234'		LDB	T1,[POINT 8,DEVADD(F),^D23] ;PUT THE DEVICE ADDR
  1994	002035'	137300	004235'		DPB	T1,[POINT 8,(T2),7] ;INTO IT.
  1995	002036'	260040	003023'		PUSHJ	P,FSTHNG	;SET THE HUNG TIME
  1996	002037'	254000	001473'		JRST	FXDSM2		;AND GO.
  1997
  1998
  1999				    ;HERE ON BUSY.
  2000	002040'	603300	000400	FXBUSY:	TLNE	T1,STAMOD	;BUSY + STATUS MODIFIER + ?
  2001	002041'	254000	002050'		JRST	FXBSY2		;YES.
  2002				    ;HERE ON BUSY+POSSIBLY CUEND).
  2003				    ;I.E., BUSY+CUEND OR BUSY+DEVEND.
  2004	002042'	603300	000200	FXBSY1:	TLNE	T1,CUEND	;BUSY+CUEND?
  2005	002043'	476002	001202*		SETOM	FTXBSY(J)	;YES, FLAG RESTART.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 35-3
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2006	002044'	260040	002165'		PUSHJ	P,SAJSNS	;
  2007	002045'	400300	000000		SETZ	T1,		;RESTART
  2008	002046'	260040	002141'		PUSHJ	P,SSTONE	;THIS ONE UNIT AND
  2009	002047'	254000	001473'		JRST	FXDSM2		;DISMISS THE INTERUPT.
  2010				    ;HERE ON BUSY + SM + ?
  2011	002050'	554450	001101*	FXBSY2:	HLRZ	T4,UNITYP(T3)	;ATTEMPTING TO INITIALIZE?
  2012	002051'	326440	002065'		JUMPN	T4,FXBSY3	;JUMP ON NO.
  2013	002052'	332010	000011*		SKIPE	UNICMD+11(T3)	;YES,  FIRST TRY?
  2014	002053'	254000	002065'		JRST	FXBSY3		;NO, ASSUME REAL KU BUSY.
  2015	002054'	476010	000011*		SETOM	UNICMD+11(T3)	;YES.  SET NOT 1ST TRY.
  2016	002055'	554442	002027*		HLRZ	T4,KONBMX(J)	;GET DEVICE LIST ADDRESS
  2017	002056'	271456	000000		ADDI	T4,(P3)		;FOR THIS UNIT.
  2018	002057'	551550	001536*		HRRZI	M,UNICMD(T3)	;POINT THE DEV LIST
  2019	002060'	542551	000000		HRRM	M,(T4)		;TO THE START OF THE CMD LIST.
  2020	002061'	201540	000015		MOVEI	M,STRTDV	;SET START CODE
  2021	002062'	137540	004236'		DPB	M,[POINT 4,(T4),^D11] ;IN THE DEVICE LIST ENTRY.
  2022	002063'	260040	003023'		PUSHJ	P,FSTHNG	;
  2023	002064'	254000	001473'		JRST	FXDSM2		;
  2024	002065'	211456	000000	FXBSY3:	MOVNI	T4,(P3)		;SET THE
  2025	002066'	551540	400000		HRRZI	M,400000	;UNIT BUSY
  2026	002067'	242551	000000		LSH	M,(T4)		;BIT IN
  2027	002070'	436542	002022*		IORM	M,FTXSMY(J)	;FTXSMY.
  2028	002071'	260040	002165'		PUSHJ	P,SAJSNS	;
  2029	002072'	260040	003023'		PUSHJ	P,FSTHNG
  2030	002073'	607300	000200		TLNN	T1,CUEND	;BUSY+SM+CUEND?
  2031	002074'	254000	001473'		JRST	FXDSM2		;NO, BUSY+SM. DISMISS.
  2032	002075'	260040	002132'	FXBSY4:	PUSHJ	P,SSTALL	;HERE ON CUEND OR BUSY+SM+CUEND,
  2033	002076'	254000	001473'		JRST	FXDSM2		;SO RESTART ALL BUSY-BITTED
  2034								;UNITS AND DISMISS THE INTRPT.
  2035				    ;HERE ON NOT BUSY+CUEND+DEVEND.
  2036	002077'	607300	000004	FXBSY6:	TLNN	T1,UNITEX	;UNIT EXCEPTION?
  2037	002100'	254000	002105'		JRST	FXBS63		;NO.  SEE IF DONE.
  2038	002101'	554444	001535*		HLRZ	T4,DEVFNJ(F)	;YES. STOP IF
  2039	002102'	302440	000007		CAIE	T4,FNPSKF	;SKIP FILE OR
  2040	002103'	306440	000010		CAIN	T4,FNPBSF	;BACKSPACE FILE.
  2041	002104'	254000	002123'		JRST	FXBS65		;STOP.
  2042	002105'	554442	002055*	FXBS63:	HLRZ	T4,KONBMX(J)	;SEE IF
  2043	002106'	271456	000000		ADDI	T4,(P3)		;WE FINISHED
  2044	002107'	550451	000000		HRRZ	T4,(T4)		;THE LIST OF
  2045	002110'	554311	000000		HLRZ	T1,(T4)		;COMMANDS.
  2046	002111'	306300	400000		CAIN	T1,HALT		;DID WE?
  2047	002112'	254000	002116'		JRST	FXBS64		;YES.
  2048	002113'	554311	777777		HLRZ	T1,-1(T4)	;MAYBE NOT.
  2049	002114'	302300	400000		CAIE	T1,HALT		;DID WE?
  2050	002115'	254000	002127'		JRST	FXBSY7		;NO.
  2051	002116'	200305	000000	FXBS64:	MOVE	T1,(U)		;
  2052	002117'	603300	400000		TLNE	T1,ASYNCH	;ASYNCH NON-INTERESTING
  2053	002120'	603300	164004		TLNE	T1,SELERR!BUSIN!CNTLER!LENERR!UNITEX ;STATUS
  2054	002121'	254000	002123'		JRST	FXBS65		;DOES NOT
  2055	002122'	202445	000001		MOVEM	T4,1(U)		;UP PROPERLY.
  2056	002123'	260040	002151'	FXBS65:	PUSHJ	P,SSTAL0	;YES.
  2057	002124'	515300	000200		HRLZI	T1,CUEND	;TURN OFF CUEND
  2058	002125'	413305	000000		ANDCAB	T1,(U)		;IN T1 & STATUS.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 35-4
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2059	002126'	254000	001217'		JRST	FXERCK		;FALL THRU AGAIN.
  2060	002127'	476002	002043*	FXBSY7:	SETOM	FTXBSY(J)	;DIDN'T FINISH.  FLAG
  2061	002130'	260040	003640'		PUSHJ	P,SSMTIC	;RESTART OTHERS AND GEN A SM/TIC
  2062	002131'	254000	001473'		JRST	FXDSM2		;TO US AND GO AGAIN.
  2063
  2064				;SUBR TO RESTART ALL BUSY-BITTED UNITS. (DESTROYS SOME ACS).
  2065	002132'	514302	002070*	SSTALL:	HRLZ	T1,FTXSMY(J)	;GET BUSY BITS. (ENTRY POINT)
  2066	002133'	513002	002132*		HLLZS	FTXSMY(J)	;CLEAR THEM.
  2067	002134'	400700	000000		SETZ	P3,		;START AT UNIT 0.
  2068	002135'	243300	002137'	SSTAL2:	JFFO	T1,.+2		;UNITS LEFT?
  2069	002136'	263040	000000		POPJ	P,		;NO, ALL DONE.
  2070	002137'	242307	000001		LSH	T1,1(T2)	;GET RID OF BIT.
  2071	002140'	271707	000000		ADDI	P3,(T2)		;UPDATE UNIT.
  2072	002141'	554442	002105*	SSTONE:	HLRZ	T4,KONBMX(J)	;GET BMX ADDR. (ENTRY POINT).
  2073	002142'	271456	000000		ADDI	T4,(P3)		;GET UNIT ADDR.
  2074	002143'	551540	000015		HRRZI	M,STRTDV	;PUT THE START
  2075	002144'	137540	004236'		DPB	M,[POINT 4,(T4),^D11] ;CODE.
  2076	002145'	550551	000000		HRRZ	M,(T4)		;ADJUST BACK
  2077	002146'	275540	000001		SUBI	M,1		;THE ADDR OF
  2078	002147'	542551	000000		HRRM	M,(T4)		;THE CMDS.
  2079	002150'	344700	002135'		AOJA	P3,SSTAL2	;GO TO NEXT UNIT.
  2080
  2081
  2082				;SUBR TO RESTART ALL BUSY-BITTED UNITS. (DESTROYS NO ACS).
  2083	002151'	261040	000016	SSTAL0:	PUSH	P,P3
  2084	002152'	261040	000006		PUSH	P,T1
  2085	002153'	261040	000007		PUSH	P,T2
  2086	002154'	261040	000011		PUSH	P,T4
  2087	002155'	261040	000013		PUSH	P,M
  2088	002156'	260040	002132'		PUSHJ	P,SSTALL
  2089	002157'	262040	000013		POP	P,M
  2090	002160'	262040	000011		POP	P,T4
  2091	002161'	262040	000007		POP	P,T2
  2092	002162'	262040	000006		POP	P,T1
  2093	002163'	262040	000016		POP	P,P3
  2094	002164'	263040	000000		POPJ	P,
  2095
  2096
  2097				;SUBR TO COMPENSATE FOR GETTING TO THE END OF THE CMD LIST
  2098				;ON SENSE WHEN BUSY.  (OTHER CMDS THAN SENSE GET TO START+1).
  2099				;
  2100				;DESTROYS T2 AND T4.
  2101
  2102	002165'	554344	002101*	SAJSNS:	HLRZ	T2,DEVFNJ(F)	;NORMAL
  2103	002166'	302340	000011		CAIE	T2,FNPUGF	;SENSE?
  2104	002167'	263040	000000		POPJ	P,		;NO, NO SENSE AT ALL.
  2105	002170'	554442	002141*		HLRZ	T4,KONBMX(J)	;SENSE.  PUT THE
  2106	002171'	271456	000000		ADDI	T4,(P3)		;START ADDR +1
  2107	002172'	551350	000001*		HRRZI	T2,UNICMD+1(T3)	;INTO
  2108	002173'	542351	000000		HRRM	T2,(T4)		;THE DEVICE LIST.
  2109	002174'	263040	000000		POPJ	P,		;
  2110
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 36
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2111				    ;HERE ON AN ERROR OR HITTING LOAD POINT OR INTERV. REQ.
  2112				    ;THE PURPOSE OF THIS ROUTINE IS TO CHECK FOR ERRORS IN THE
  2113				    ;PROPER SEQUENCE AND SET UP THE ERROR FLAG IN T2 FOR FXER0.
  2114				    ;
  2115				    ;EXPECTS THE 1ST STATUS WORD IN T1.
  2116				    ;
  2117				    ;DESTROYS T1, T4, AND M.
  2118
  2119				    ;FIRST, FIND THE TYPE OF "ERROR".
  2120	002175'	607300	020000	FXEROR:	TLNN	T1,CNTLER	;CONTROL ERROR?
  2121	002176'	254000	002207'		JRST	FXERR2		;NO.
  2122	002177'	571340	777775		HRREI	T2,ERCNTL	;CNTRL ERR OR MEM ERR.
  2123	002200'	331003	002024*		SKIPL	CHNSTB(PG)	;MEMORY ERROR?
  2124	002201'	254000	002205'		JRST	FXERR1		;NO, REALLY A CONTROL ERROR.
  2125	002202'	571340	000012		HRREI	T2,ERMEMR	;YES, REALLY A MEMORY ERROR.
  2126	002203'	200443	002017*		MOVE	T4,CHNMER(PG)	;SAVE CHNMER IN THE UNIT DB
  2127	002204'	202450	000000*		MOVEM	T4,FDMEMR(T3)	;ERROR AREA.
  2128	002205'	260040	002753'	FXERR1:	PUSHJ	P,SUBTRM	;JUST IN CASE, PUT TERM IN THE
  2129	002206'	254000	002366'		JRST	FXER09		;DEV LIST. GO SET IODERR.
  2130	002207'	571340	777777	FXERR2:	HRREI	T2,ERSELE	;SELECT ERROR OR
  2131	002210'	607300	140000		TLNN	T1,SELERR!BUSIN	;BUS IN?
  2132	002211'	254000	002215'		JRST	FXER00		;NO.
  2133	002212'	607300	100000		TLNN	T1,SELERR	;YES, SELECT ERROR?
  2134	002213'	571340	777776		HRREI	T2,ERBSIN	;NO, BUS IN.
  2135	002214'	254000	002366'		JRST	FXER09		;GO SET IODERR.
  2136
  2137				    ;HERE ALSO LOOK AT SENSE BYTE 0.
  2138	002215'	200442	001747*	FXER00:	MOVE	T4,FTXSTS(J)	;GET BYTE 0.
  2139	002216'	607440	040000		TLNN	T4,EQPCHK	;EQUIPMENT CHECK?
  2140	002217'	254000	002225'		JRST	FXER01		;NO.
  2141	002220'	571340	777774		HRREI	T2,EREQCK	;FOR MODEL 2, EQUIP
  2142	002221'	554542	001067*		HLRZ	M,FTXMCH(J)	;CHECK IS
  2143	002222'	607300	000020		TLNN	T1,DEVEND	;ONLY VALID IF
  2144	002223'	607540	000002		TLNN	M,MODEL2	;DEV END IS ALSO SET
  2145	002224'	254000	002366'		JRST	FXER09		;GO SET IODERR.
  2146	002225'	571340	000013	FXER01:	HRREI	T2,ERBSOU	;BUS
  2147	002226'	603440	100000		TLNE	T4,BUSOUT	;OUT CHECK?
  2148	002227'	254000	002367'		JRST	FXER0		;YES.
  2149	002230'	607440	200000		TLNN	T4,INTREQ	;INTERVENTION REQUIRED?
  2150	002231'	254000	002243'		JRST	FXER02		;NO.
  2151	002232'	571340	777773		HRREI	T2,ERINRQ	;YES.
  2152	002233'	603300	000020		TLNE	T1,DEVEND	;DEV END?
  2153	002234'	254000	002237'		JRST	.+3		;YES.
  2154	002235'	661000	200010		TLO	S,IOSTBL!HNGFTA	;NO.  FLAG INT REQ FOR UUOCON.
  2155	002236'	254000	002366'		JRST	FXER09		;(CAN'T CALL HNGSTP HERE).
  2156	002237'	554544	002165*		HLRZ	M,DEVFNJ(F)	;DEV END.
  2157	002240'	306540	000005		CAIN	M,FNPRWU	;REW/UNL?
  2158	002241'	254000	001464'		JRST	FXSTP0		;YES, OKAY.
  2159	002242'	661000	200010		TLO	S,IOSTBL!HNGFTA	;NO, FLAG INT REQ FOR UUOCON.
  2160	002243'	607440	400000	FXER02:	TLNN	T4,CMDREJ	;COMMAND REJECT?
  2161	002244'	254000	002250'		JRST	FXER03		;NO.
  2162	002245'	660000	400000		TRO	S,IOIMPM	;YES.  SET IOIMPM.
  2163	002246'	571340	777772		HRREI	T2,ERCMRJ	;THIS AND NOT CAPABLE ARE THE ONLY FATAL ERRORS
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 36-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2164	002247'	254000	002367'		JRST	FXER0		;THAT DON'T SET IODERR.
  2165	002250'	571340	000014	FXER03:	HRREI	T2,EROVRN	;OVER-
  2166	002251'	603440	010000		TLNE	T4,OVERUN	;RUN?
  2167	002252'	254000	002367'		JRST	FXER0		;YES.
  2168	002253'	135340	000015'		LDB	T2,BYKLDP	;NO.  LOAD POINT?
  2169	002254'	322340	002305'		JUMPE	T2,FXER05	;JUMP ON NO.
  2170
  2171				    ;HERE ON LOAD POINT.
  2172				    ;ONLY BSR/BSF/TC1/ROR ARE INTERESTING.
  2173	002255'	554544	002237*		HLRZ	M,DEVFNJ(F)	;GET FN IN PROGRESS.
  2174	002256'	302540	000004		CAIE	M,FNPBSR	;BSR/BSF GO TO
  2175	002257'	306540	000010		CAIN	M,FNPBSF	;NORMAL END OF
  2176	002260'	254000	001523'		JRST	FXMT0		;MTAPE 1 CMD FNS.
  2177	002261'	550544	002013*		HRRZ	M,DEVER1(F)	;GET ADDR OF LAST ERROR.
  2178	002262'	322540	002305'		JUMPE	M,FXER05	;LOAD PT. OKAY IF NOT IN E. P.
  2179	002263'	550345	000001		HRRZ	T2,1(U)		;GET CMD STOPPED ON.
  2180	002264'	303353	000000		CAILE	T2,(M)		;GOT PAST?
  2181	002265'	254000	002305'		JRST	FXER05		;YES.  OKAY.
  2182	002266'	554544	001765*		HLRZ	M,DEVER2(F)	;NO.  GET PHASE OF DC-R RECOVERY.
  2183	002267'	322540	002305'		JUMPE	M,FXER05	;NONE.
  2184	002270'	302540	000002		CAIE	M,2		;DIED IN ROR?
  2185	002271'	254000	002301'		JRST	FXER04		;NO.
  2186	002272'	350010	000000*		AOS	FDNREE(T3)	;YES,
  2187	002273'	515340	000004		HRLZI	T2,4		;LOG
  2188	002274'	436350	000000*		IORM	T2,FDERBT(T3)	;INFO
  2189	002275'	436344	000012		IORM	T2,DEVSTS(F)	;EVERYWHERE
  2190	002276'	202350	000000*		MOVEM	T2,FDCNIE(T3)	;AND
  2191	002277'	135340	001766*		LDB	T2,PIOMOD	;GO
  2192	002300'	254000	001576'		JRST	FCMRD0		;DIE COMPLETELY.
  2193	002301'	307540	000013	FXER04:	CAIG	M,13		;IN
  2194	002302'	305540	000011		CAIGE	M,11		;TC1?
  2195	002303'	254000	002305'		JRST	FXER05		;NO.
  2196	002304'	254000	003745'		JRST	FSLDPT		;YES, ADJUST TAPE AND CONT. WITH NORMAL ERR PROCESSING.
  2197
  2198	002305'	607440	020000	FXER05:	TLNN	T4,DATCHK	;DATA CHECK?
  2199	002306'	254000	002322'		JRST	FXER06		;NO.
  2200	002307'	554544	002255*		HLRZ	M,DEVFNJ(F)	;YES. READ/W-WTM/ OR ERG?
  2201	002310'	571340	000017		HRREI	T2,ERDCRE	;
  2202	002311'	306540	000012		CAIN	M,FNPRED	;DC-READ?
  2203	002312'	254000	002367'		JRST	FXER0		;YES.
  2204	002313'	571340	000015		HRREI	T2,ERDCER	;NO.
  2205	002314'	306540	000006		CAIN	M,FNPERG	;ERG FN?
  2206	002315'	254000	002367'		JRST	FXER0		;YES, ERG ERROR.
  2207	002316'	550445	000001		HRRZ	T4,1(U)		;NO, IN
  2208	002317'	301450	002057*		CAIL	T4,UNICMD(T3)	;ERROR SPACE?
  2209	002320'	571340	000016		HRREI	T2,ERWWTM	;NO, W/WTM.
  2210	002321'	254000	002367'		JRST	FXER0		;YES, ERG.
  2211	002322'	607440	002000	FXER06:	TLNN	T4,CNVCHK	;DATA CONVERTER CHECK?
  2212	002323'	254000	002352'		JRST	FXER65		;NO.
  2213	002324'	402004	002266*		SETZM	DEVER2(F)	;YES, TURN OFF E.P.
  2214	002325'	200305	000000		MOVE	T1,(U)		;RESTORE T1
  2215	002326'	554544	002307*		HLRZ	M,DEVFNJ(F)	;AND M AND GO
  2216	002327'	603300	004000		TLNE	T1,LENERR	;PROCESS ODD NO. OF
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 36-3
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2217	002330'	254000	001545'		JRST	FXNMRW		;WORDS READ.
  2218	002331'	550305	000001		HRRZ	T1,1(U)		;GET T1= ADDR OF NEXT LOC.
  2219	002332'	135340	002277*		LDB	T2,PIOMOD	;GET MODE.
  2220	002333'	301340	000016		CAIL	T2,DR		;BUFFERED?
  2221	002334'	254000	002340'		JRST	FXER62		;NO, D OR DR.
  2222	002335'	201306	777777		MOVEI	T1,-1(T1)	;YES, BUFFERED.
  2223	002336'	260040	003546'		PUSHJ	P,SBUFCT	;CALC.
  2224	002337'	254000	001651'		JRST	FXRW11		;
  2225	002340'	554446	000000	FXER62:	HLRZ	T4,(T1)		;D OR DR.  GET NEXT LOC.
  2226	002341'	302440	400000		CAIE	T4,HALT		;LAST REQUEST?
  2227	002342'	254000	002347'		JRST	FXER64		;NO, GO CONTINUE.
  2228	002343'	271300	000001		ADDI	T1,1		;YES, PRETEND U POINTED TO
  2229	002344'	542305	000001		HRRM	T1,1(U)		;HALT+1.
  2230	002345'	275300	000002		SUBI	T1,2		;GO
  2231	002346'	254000	001636'		JRST	FXRW8		;PROCESS.
  2232	002347'	551446	000000	FXER64:	HRRZI	T4,(T1)		;GEN SM AND
  2233	002350'	260040	003640'		PUSHJ	P,SSMTIC	;TIC AND
  2234	002351'	254000	001473'		JRST	FXDSM2		;GO.
  2235	002352'	135440	000016'	FXER65:	LDB	T4,BYKNTC	;NOT CAPABLE?
  2236	002353'	322440	002357'		JUMPE	T4,FXER07	;NO.
  2237	002354'	660000	400000		TRO	S,IOIMPM	;YES.  SETS IOIMPM.
  2238	002355'	571340	777771		HRREI	T2,ERNTCP	;LIKE CMD REJ, DOES NOT
  2239	002356'	254000	002367'		JRST	FXER0		;SET IODERR, EVEN THO FATAL.
  2240	002357'	514442	002221*	FXER07:	HRLZ	T4,FTXMCH(J)	;GET KONT. MODEL NO.
  2241	002360'	603440	000002		TLNE	T4,MODEL2	;MODEL 2?
  2242	002361'	254000	002365'		JRST	FXER08		;NO.
  2243	002362'	571340	000020		HRREI	T2,ERIDBR	;YES, ID BURST CHECK IS POSSIBLE.
  2244	002363'	135440	000017'		LDB	T4,BYKIDB	;DID IT OCCUR?
  2245	002364'	326440	002367'		JUMPN	T4,FXER0	;JUMP ON YES.
  2246	002365'	571340	777774	FXER08:	HRREI	T2,EREQCK	;THIS IS AN EQUIP. CHK.
  2247	002366'	660000	200000	FXER09:	TRO	S,IODERR	;FATAL ERRS EXCEPT CMD REJ/NOT CAPABLE SET IODERR.
  2248
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 37
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2249				;HERE WITH THE ERROR FLAG IN T2.
  2250	002367'	205300	700000	FXER0:	MOVSI	T1,700000	;CLEAR THE
  2251	002370'	412303	002200*		ANDCAM	T1,CHNSTB(PG)	;MEM ERR FLAG.
  2252	002371'	515300	400000		HRLZI	T1,400000	;SET
  2253	002372'	331440	000007		SKIPL	T4,T2		;UP
  2254	002373'	211447	000000		MOVNI	T4,(T2)		;BOTH
  2255	002374'	242311	000000		LSH	T1,(T4)		;DEVSTS
  2256	002375'	436304	000012		IORM	T1,DEVSTS(F)	;AND
  2257	002376'	436310	002274*		IORM	T1,FDERBT(T3)	;FDERBT.
  2258	002377'	323340	002416'		JUMPLE	T2,FXER16	;JUMP ON FATAL.
  2259	002400'	602000	000100		TRNE	S,IONRCK	;NON-FATAL, ALLOWED TO RETRY?
  2260	002401'	254000	002416'		JRST	FXER16		;NO.
  2261				    ;HERE ON NON-FATAL.
  2262	002402'	554544	002326*		HLRZ	M,DEVFNJ(F)	;SPECIAL CASE CHECK FOR WRITE IN
  2263	002403'	302540	000013		CAIE	M,FNPWRT	;CASE LOST PLACE ON THE TAPE.
  2264	002404'	254000	002445'		JRST	FXEREP		;NOT WRITE.
  2265	002405'	302340	000020		CAIE	T2,ERIDBR	;WRITE.  ONE OF THE ERRORS THAT
  2266	002406'	306340	000015		CAIN	T2,ERDCER	;CAN'T LOSE ITS PLACE?
  2267	002407'	254000	002445'		JRST	FXEREP		;YES.
  2268	002410'	261040	000006		PUSH	P,T1		;NO. SAVE T1 FROM SNOICT.
  2269	002411'	260040	004165'		PUSHJ	P,SNOICT	;GET T4/COUNT DONE.
  2270	002412'	262040	000006		POP	P,T1		;RESTORE T1.
  2271	002413'	303440	000014		CAILE	T4,^D12		;DIE IF MAYBE NOISE RECORD.
  2272	002414'	254000	002445'		JRST	FXEREP		;ELSE CONTINUE.
  2273	002415'	660000	100000		TRO	S,IODTER	;CALL THIS A DATA ERROR.
  2274
  2275
  2276				    ;FATAL ERROR.
  2277	002416'	202310	002276*	FXER16:	MOVEM	T1,FDCNIE(T3)	;STORE LAST FATAL ERROR.
  2278	002417'	554344	002402*		HLRZ	T2,DEVFNJ(F)	;IS THIS ALSO
  2279	002420'	550444	002261*		HRRZ	T4,DEVER1(F)	;THE 1ST ERROR FOR THIS CMD?
  2280	002421'	322440	002425'		JUMPE	T4,FXER21	;JUMP ON YES.
  2281	002422'	550545	000001		HRRZ	M,1(U)		;STILL
  2282	002423'	307551	000000		CAIG	M,(T4)		;MAYBE
  2283	002424'	254000	002434'		JRST	FXER22		;NO.
  2284	002425'	202310	000000*	FXER21:	MOVEM	T1,FDCNI1(T3)	;LOG 1ST ERROR FOR THIS CMD.
  2285	002426'	305340	000012		CAIGE	T2,FNPRED	;READ OR WRITE?
  2286	002427'	254000	001465'		JRST	FXSTOP		;NO, DONE.
  2287	002430'	271350	777766*		ADDI	T2,FDNRE1-FNPRED(T3) ;YES,
  2288	002431'	350007	000000		AOS	(T2)		;LOG IN FDNRE1 OR FDNWR1
  2289	002432'	350004	000012		AOS	DEVSTS(F)	;AND DEVSTS.
  2290	002433'	254000	002437'		JRST	FXER23		;
  2291	002434'	305340	000012	FXER22:	CAIGE	T2,FNPRED	;NOT 1ST ERROR.  R/W?
  2292	002435'	254000	001465'		JRST	FXSTOP		;NO, DONE.
  2293	002436'	271350	777766*		ADDI	T2,FDNRE1-FNPRED(T3) ;
  2294	002437'	350007	000002	FXER23:	AOS	2(T2)		;LOG ERROR IN FDNREE OR FDNWRE.
  2295	002440'	200300	000007		MOVE	T1,T2		;
  2296	002441'	135340	002332*		LDB	T2,PIOMOD	;GET MODE.
  2297	002442'	306310	000000*		CAIN	T1,FDNRE1(T3)	;READ?
  2298	002443'	254000	001576'		JRST	FCMRD0		;YES, GO TO COMMON END ROUTINE.
  2299	002444'	254000	001562'		JRST	FCMWRT		;WRITING, GO TO COMMON END ROUTINE.
  2300
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 38
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2301				;ERROR PROCESSING.
  2302				;
  2303				;IF THIS IS THE FIRST ERROR FOR THIS RECORD/CMD, JUST SET UP THE
  2304				;ERROR PROCESSING AND GO.  OTHERWISE, WORRY ABOUT WHERE WE ARE
  2305				;IN DC-R RECOVERY, IF SOME OF THE OLD ERROR RECOVERY MUST BE
  2306				;RETAINED DUE TO TAPE SPACING, IF WE ARE OUT OF RETRIES, ETC.
  2307
  2308	002445'	550544	002420*	FXEREP:	HRRZ	M,DEVER1(F)	;GET OLD ERROR LOC.
  2309	002446'	322540	002452'		JUMPE	M,FEPFS1	;CURRENT=1ST ERR FOR THIS UNIT CMD LIST?
  2310	002447'	550445	000001		HRRZ	T4,1(U)		;NO, CURRENT ERR LOC TO T4.
  2311	002450'	307453	000000		CAIG	T4,(M)		;GOT PAST OLD ERROR?
  2312	002451'	254000	002513'		JRST	FEPOLD		;NO.
  2313
  2314
  2315				    ;HERE ON 1ST NON-FATAL ERROR IN A RECORD.
  2316	002452'	202310	002425*	FEPFS1:	MOVEM	T1,FDCNI1(T3)	;LOG 1ST-NON-FATAL.
  2317	002453'	554304	002417*		HLRZ	T1,DEVFNJ(F)	;
  2318	002454'	305300	000012		CAIGE	T1,FNPRED	;READ/WRITE?
  2319	002455'	254000	002460'		JRST	.+3		;NO.
  2320	002456'	271310	777766*		ADDI	T1,FDNRE1-FNPRED(T3) ;YES.  LOG
  2321	002457'	350006	000000		AOS	(T1)		;1ST R/W
  2322	002460'	350004	000012		AOS	DEVSTS(F)	;ERROR.
  2323	002461'	260040	003471'		PUSHJ	P,SGDEV1	;POINT DEVER1 TO
  2324	002462'	552444	002445*		HRRZM	T4,DEVER1(F)	;THE NEXT CMD.
  2325	002463'	306340	000017		CAIN	T2,ERDCRE	;DC-R?
  2326	002464'	254000	002471'		JRST	FEPFS4		;YES.
  2327	002465'	402004	002324*		SETZM	DEVER2(F)	;CLEAR PHASE AND NO TC.
  2328	002466'	551300	000016		HRRZI	T1,OUTERR-1	;SET UP
  2329	002467'	202304	000000*		MOVEM	T1,DEVOUT(F)	;DEVOUT.
  2330	002470'	254000	002511'		JRST	FEPNEW		;
  2331	002471'	201300	000001	FEPFS4:	MOVEI	T1,1		;THERE ON DC-R.
  2332	002472'	516304	002465*		HRLZM	T1,DEVER2(F)	;DC-R PHASE 1.
  2333	002473'	551300	000050		HRRZI	T1,^D40		;SET UP
  2334	002474'	202304	001415*		MOVEM	T1,DEV40(F)	;THE 40 COUNT.
  2335	002475'	551300	000012		HRRZI	T1,INSERR	;SET UP THE
  2336	002476'	202304	001417*		MOVEM	T1,DEVINS(F)	;INSIDE COUNT.
  2337	002477'	551300	000017		HRRZI	T1,NOISE	;SET UP THE
  2338	002500'	202304	000000*		MOVEM	T1,DEVNOI(F)	;NOISE COUNT.
  2339	002501'	550305	000001		HRRZ	T1,1(U)		;SET
  2340	002502'	260040	003451'		PUSHJ	P,SGPREV	;UP
  2341	002503'	202450	001421*		MOVEM	T4,UNIDC1(T3)	;UNIDC1.
  2342	002504'	260040	004156'		PUSHJ	P,SNOISE	;NOISE RECORD?
  2343	002505'	254000	002511'		JRST	FEPNEW		;NO.
  2344	002506'	200450	002503*		MOVE	T4,UNIDC1(T3)	;YES, SET UP T4 FOR
  2345	002507'	260040	003640'		PUSHJ	P,SSMTIC	;GEN SM, TIC.
  2346	002510'	254000	001473'		JRST	FXDSM2		;GO.
  2347	002511'	260040	004106'	FEPNEW:	PUSHJ	P,SNEW		;GEN AN ERROR PROCEDURE AND
  2348	002512'	254000	001473'		JRST	FXDSM2		;GO.
  2349
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 39
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2350				    ;HERE ON AN ERROR WHEN WE ARE E.P. ALREADY.
  2351	002513'	554444	002472*	FEPOLD:	HLRZ	T4,DEVER2(F)	;ARE WE ALREADY IN DC-R RECOVERY?
  2352	002514'	326440	002554'		JUMPN	T4,FEPOL2	;YES, PROBABLY.
  2353
  2354
  2355				    ;HERE WHEN WE ARE NOT ALREADY IN DC-R RECOVERY.
  2356	002515'	372004	002467*		SOSE	DEVOUT(F)	;ALLOWED ANOTHER OUTSIDE ERR?
  2357	002516'	254000	002545'		JRST	FEPL06		;YES.
  2358	002517'	307340	000013		CAIG	T2,ERBSOU	;NO.  CALL MEM ERR OR BUS OUT
  2359	002520'	664000	200000		TROA	S,IODERR	;DEV ERR,
  2360	002521'	660000	100000		TRO	S,IODTER	;CALL OTHERS DATA ERRORS.
  2361	002522'	202310	002416*		MOVEM	T1,FDCNIE(T3)	;LOG FATAL ERROR.
  2362	002523'	554304	002453*		HLRZ	T1,DEVFNJ(F)	;READ OR
  2363	002524'	305300	000012		CAIGE	T1,FNPRED	;WRITE?
  2364	002525'	254000	001465'		JRST	FXSTOP		;NO.
  2365	002526'	271310	777766*		ADDI	T1,FDNREE-FNPRED(T3) ;LOG
  2366	002527'	350006	000000		AOS	(T1)		;FATAL R/W ERROR.
  2367	002530'	200540	000007		MOVE	M,T2		;SAVE ERROR.
  2368	002531'	135340	002441*		LDB	T2,PIOMOD	;GET MODE.
  2369	002532'	302300	000012		CAIE	T1,FNPRED	;READ?
  2370	002533'	254000	002537'		JRST	FEPL04		;NO.
  2371	002534'	302540	000013		CAIE	M,ERBSOU	;YES.  BUS OUT
  2372	002535'	254000	001576'		JRST	FCMRD0		;REQUIRES ADJUST,
  2373	002536'	254000	001332'		JRST	FCMRDA		;ELSE NOT ADJUST.
  2374	002537'	302540	000013	FEPL04:	CAIE	M,ERBSOU	;BUS OUT ERR AND
  2375	002540'	254000	001562'		JRST	FCMWRT		;NO
  2376	002541'	200345	000000		MOVE	T2,(U)		;DEV END
  2377	002542'	607340	000020		TLNN	T2,DEVEND	;REQUIRE
  2378	002543'	254000	001441'		JRST	FXWNP4		;ADJUST (VIA PHASE 4) BEFORE STOP.
  2379	002544'	254000	001562'		JRST	FCMWRT		;ALL OTHERS JUST STOP.
  2380	002545'	306340	000017	FEPL06:	CAIN	T2,ERDCRE	;YES, NEW ERROR DC-R?
  2381	002546'	254000	002471'		JRST	FEPFS4		;YES.  MUST BE IN NORMAL SPACE.
  2382	002547'	550445	000001		HRRZ	T4,1(U)		;NO,
  2383	002550'	303450	002317*		CAILE	T4,UNICMD(T3)	;NEW ERR IN THE ERR SPACE?
  2384	002551'	254000	002511'		JRST	FEPNEW		;NO, IN NORMAL SPACE.
  2385	002552'	260040	004140'	FEPMOD:	PUSHJ	P,SMOD		;NEW ERROR IS IN ERROR SPACE, SO
  2386	002553'	254000	001473'		JRST	FXDSM2		;MODIFY ERROR SPACE AND RETRY.
  2387
  2388				    ;HERE WHEN WE ARE ALREADY IN DC-R RECOVERY.
  2389				    ;WE MAY HAVE BEEN IN PHASES 1-7 OR TC1(11,12,13)
  2390				    ;OR TC2(21,22,23).
  2391
  2392	002554'	307440	000003	FEPOL2:	CAIG	T4,3		;ALREADY IN PHASES 1,2, OR 3?
  2393	002555'	254000	002605'		JRST	FEPOL3		;YES.
  2394
  2395				    ;HERE WHEN DIED IN PHASES 4,5,6,7, OR TC.
  2396	002556'	372004	002476*		SOSE	DEVINS(F)	;INSIDE/RETRIES LEFT?
  2397	002557'	254000	002552'		JRST	FEPMOD		;YES, GO SET THEM UP.
  2398	002560'	307340	000013		CAIG	T2,ERBSOU	;NO.  CALL MEM ERR OR BUS OUT
  2399	002561'	664000	200000		TROA	S,IODERR	;DEV ERR,
  2400	002562'	660000	100000		TRO	S,IODTER	;CALL OTHERS DATA ERRORS.
  2401	002563'	302440	000004		CAIE	T4,4		;LOG FATAL ERR FOR
  2402	002564'	306440	000005		CAIN	T4,5		;TC.  (PHASES
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 39-2
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2403	002565'	254000	002570'		JRST	.+3		;4 AND 5 HAVE
  2404	002566'	202310	002522*		MOVEM	T1,FDCNIE(T3)	;ALREADY
  2405	002567'	350010	002272*		AOS	FDNREE(T3)	;LOGGED.
  2406	002570'	135340	002531*		LDB	T2,PIOMOD	;GET MODE.
  2407	002571'	306440	000004		CAIN	T4,4		;WITH PHASE 4, WIN OR
  2408	002572'	254000	001270'		JRST	FXWON4		;LOSE MAKES NO DIFFERENCE.
  2409	002573'	302440	000005		CAIE	T4,5		;PHASE 5 OR 6 OR 7 OR TC?
  2410	002574'	254000	001576'		JRST	FCMRD0		;NOT 5, STOP WITH NOTHING IN CURRENT READ.
  2411	002575'	260040	003471'		PUSHJ	P,SGDEV1	;PHASE 5.
  2412	002576'	201311	777777		MOVEI	T1,-1(T4)	;READ EVERYTHING
  2413	002577'	301340	000016		CAIL	T2,DR		;ALTHOUGH
  2414	002600'	254000	002603'		JRST	.+3		;WE CAN NEITHER ADJUST
  2415	002601'	260040	003546'		PUSHJ	P,SBUFCT	;THE TAPE NOR
  2416	002602'	254000	001465'		JRST	FXSTOP		;CONTINUE.
  2417	002603'	260040	003533'		PUSHJ	P,SDMPCT	;DEVDWC
  2418	002604'	254000	001465'		JRST	FXSTOP		;AND STOP.
  2419
  2420
  2421				    ;HERE WHEN ALREADY IN DC-R RECOVERY PHASES 1,2, OR 3.
  2422	002605'	306340	000017	FEPOL3:	CAIN	T2,ERDCRE	;NEW=DC-R?
  2423	002606'	254000	002647'		JRST	FEPOL4		;YES.
  2424	002607'	372004	002556*		SOSE	DEVINS(F)	;NO.  INSIDE ERROR TRIES LEFT?
  2425	002610'	254000	002643'		JRST	FEPL33		;YES.
  2426				    ;LOST COMPLETELY ON THIS RECORD.
  2427	002611'	307340	000013		CAIG	T2,ERBSOU	;CALL MEM ERR OR BUS OUT
  2428	002612'	664000	200000		TROA	S,IODERR	;DEV ERR,
  2429	002613'	660000	100000		TRO	S,IODTER	;CALL OTHERS DATA ERRORS.
  2430	002614'	350010	002567*		AOS	FDNREE(T3)	;LOG
  2431	002615'	202310	002566*		MOVEM	T1,FDCNIE(T3)	;ERROR INFO.
  2432				    ;DECIDE IF CALC AND ADJUST, OR JUST CALC.
  2433	002616'	201547	000000		MOVEI	M,(T2)		;SAVE ERROR FLAG.
  2434	002617'	135340	002570*		LDB	T2,PIOMOD	;GET MODE.
  2435	002620'	302440	000001		CAIE	T4,1		;PHASE 1?
  2436	002621'	254000	002625'		JRST	FEPL32		;NO, 2 OR 3.
  2437	002622'	302540	000013		CAIE	M,ERBSOU	;YES.  1 AND OVRN OR MEM ERR
  2438	002623'	254000	001332'		JRST	FCMRDA		;ADJUSTS, ELSE
  2439	002624'	254000	001576'		JRST	FCMRD0		;CAN'T ADJUST.
  2440	002625'	302540	000013	FEPL32:	CAIE	M,ERBSOU	;PHASES 2 OR 3 AND OVRN
  2441	002626'	254000	001446'		JRST	FXWNP6		;ADJUST, ELSE DON'T ADJUST.
  2442
  2443				    ;SET UP PHASE 7.
  2444	002627'	200310	000000*	FXWNP7:	MOVE	T1,UNIDCR(T3)	;RESTORE READ
  2445	002630'	202330	002506*		MOVEM	T1,@UNIDC1(T3)	;FORWARDS CMD.
  2446	002631'	200310	001433*		MOVE	T1,UNIDCN(T3)	;RESTORE
  2447	002632'	550444	002462*		HRRZ	T4,DEVER1(F)	;THE
  2448	002633'	202311	000000		MOVEM	T1,(T4)		;NEXT CMD.
  2449	002634'	261040	000002		PUSH	P,J		;REVERSE
  2450	002635'	474100	000000		SETO	J,		;THE
  2451	002636'	260040	004002'		PUSHJ	P,SREVRS	;DATA WORDS.
  2452	002637'	262040	000002		POP	P,J		;RESTORE J.
  2453	002640'	201540	000007		MOVEI	M,7		;PHASE IS 7.
  2454	002641'	201300	000001		MOVEI	T1,1		;ONE TRY ONLY.
  2455	002642'	254000	001417'		JRST	FXPHG2
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 39-3
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2456
  2457				    ;RETRY AFTER AN INSIDE ERROR.
  2458	002643'	550305	000001	FEPL33:	HRRZ	T1,1(U)		;NEW ERROR IN
  2459	002644'	307310	002550*		CAIG	T1,UNICMD(T3)	;ERROR SPACE?
  2460	002645'	254000	002552'		JRST	FEPMOD		;YES.
  2461	002646'	254000	002511'		JRST	FEPNEW		;NO.
  2462
  2463
  2464				    ;HERE WHEN DIED WITH A DC-R, WHEN ALREADY IN PHASES 1,2, OR 3.
  2465	002647'	200540	000006	FEPOL4:	MOVE	M,T1		;SAVE ERROR BIT.
  2466	002650'	260040	004156'		PUSHJ	P,SNOISE	;NOISE RECORD?
  2467	002651'	254000	002665'		JRST	FEPL45		;NO.
  2468	002652'	135340	002617*		LDB	T2,PIOMOD	;YES.
  2469	002653'	327300	002660'		JUMPG	T1,FEPL42	;JUMP ON MORE ALLOWED.
  2470	002654'	660000	100000		TRO	S,IODTER	;FLAG DATA ERROR.
  2471	002655'	350010	002614*		AOS	FDNREE(T3)	;LOG
  2472	002656'	202550	002615*		MOVEM	M,FDCNIE(T3)	;ERROR.
  2473	002657'	254000	001576'		JRST	FCMRD0		;GO CALC. (CAN'T ADJUST).
  2474	002660'	550305	000001	FEPL42:	HRRZ	T1,1(U)		;MORE ALLOWED,
  2475	002661'	360300	002662'		SOJ	T1,.+1		;SO
  2476	002662'	260040	003451'		PUSHJ	P,SGPREV	;TRY
  2477	002663'	260040	003640'		PUSHJ	P,SSMTIC	;AGAIN.
  2478	002664'	254000	001473'		JRST	FXDSM2		;GO.
  2479	002665'	376304	002474*	FEPL45:	SOSN	T1,DEV40(F)	;NOT A NOISE RECORD.  CHECK 40
  2480	002666'	254000	002706'		JRST	FEPOL5		;COUNT=0?  YES, GO TO CHANGE PHASE OR DIE.
  2481				    ;TRY TO EITHER READ AGAIN OR TC.
  2482	002667'	551440	000012		HRRZI	T4,INSERR	;SET UP INSIDE
  2483	002670'	552444	002607*		HRRZM	T4,DEVINS(F)	;ERROR COUNT.
  2484	002671'	261040	000007		PUSH	P,T1+1		;IS
  2485	002672'	231300	000004		IDIVI	T1,4		;IT
  2486	002673'	200300	000007		MOVE	T1,T1+1		;TIME
  2487	002674'	262040	000007		POP	P,T1+1		;TO TC?
  2488	002675'	326300	002511'		JUMPN	T1,FEPNEW	;JUMP ON NO.
  2489	002676'	550444	002513*		HRRZ	T4,DEVER2(F)	;YES, CAN WE TC?
  2490	002677'	326440	002511'		JUMPN	T4,FEPNEW	;JUMP ON NO.
  2491	002700'	554444	002676*		HLRZ	T4,DEVER2(F)	;YES.  CHANGE PHASE
  2492	002701'	271440	000010		ADDI	T4,10		;TO
  2493	002702'	506444	002700*		HRLM	T4,DEVER2(F)	;TC1.
  2494	002703'	515300	540234		HRLZI	T1,BSR		;GEN THE
  2495	002704'	260040	003611'		PUSHJ	P,STC12		;TC1 SEQUENCE.
  2496	002705'	254000	001473'		JRST	FXDSM2		;GO.
  2497
  2498				    ;HERE ON END OF PHASES 1,2, OR 3.
  2499	002706'	554304	002702*	FEPOL5:	HLRZ	T1,DEVER2(F)	;END OF
  2500	002707'	302300	000001		CAIE	T1,1		;PHASE 1?
  2501	002710'	254000	002715'		JRST	FEPL51		;NO.
  2502	002711'	554350	002050*		HLRZ	T2,UNITYP(T3)	;YES.  ROR IS NOT
  2503	002712'	602340	000040		TRNE	T2,TRK7		;POSSIBLE FOR 7
  2504	002713'	603000	400000		TLNE	S,COMPAT	;TRACK ODD
  2505	002714'	254000	002724'		JRST	FEPL52		;PARITY.
  2506	002715'	350010	002655*	FEPL51:	AOS	FDNREE(T3)	;COUNT ERROR.
  2507	002716'	660000	100000		TRO	S,IODTER	;FLAG DATA ERROR.
  2508	002717'	202550	002656*		MOVEM	M,FDCNIE(T3)	;LOG FATAL ERROR.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 39-4
FTASER.MAC	25-NOV-87 15:39		INTERRUPT PROCESSING

  2509	002720'	135340	002652*		LDB	T2,PIOMOD	;GET MODE.
  2510	002721'	302300	000001		CAIE	T1,1		;PHASE 1?
  2511	002722'	254000	002627'		JRST	FXWNP7		;GO TO PHASE 7.
  2512	002723'	254000	001576'		JRST	FCMRD0		;GO TO CALC (NO ADJUSTMENT NEEDED.).
  2513				    ;SET UP PHASE 2.
  2514	002724'	200330	002630*	FEPL52:	MOVE	T1,@UNIDC1(T3)	;SET UP
  2515	002725'	202310	002627*		MOVEM	T1,UNIDCR(T3)	;UNIDCR.
  2516	002726'	621300	010000		TLZ	T1,FRCINT	;TURN OFF
  2517	002727'	201340	000014		MOVEI	T2,READBK	;PRGINT
  2518	002730'	137340	004237'		DPB	T2,[POINT 8,T1,^D15] ;IN
  2519	002731'	202330	002724*		MOVEM	T1,@UNIDC1(T3)	;THE READ (NOW BACKWARDS) CMD.
  2520	002732'	550444	002632*		HRRZ	T4,DEVER1(F)	;SET
  2521	002733'	200311	000000		MOVE	T1,(T4)		;UP
  2522	002734'	202310	002631*		MOVEM	T1,UNIDCN(T3)	;UNIDCN.
  2523	002735'	515300	400000		HRLZI	T1,HALT		;MAKE THE
  2524	002736'	202311	000000		MOVEM	T1,(T4)		;"NEXT CMD" = HALT.
  2525	002737'	261040	000002		PUSH	P,J		;REVERSE
  2526	002740'	400100	000000		SETZ	J,		;THE
  2527	002741'	260040	004002'		PUSHJ	P,SREVRS	;DWS.
  2528	002742'	262040	000002		POP	P,J		;RESTORE J.
  2529	002743'	201540	000002		MOVEI	M,2		;SET PHASE=2
  2530	002744'	254000	001414'		JRST	FXPHGO		;SET UP AND GO.
  2531
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 40
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2532				SUBTTL UTILITY SUBROUTINES.
  2533
  2534
  2535				COMMENT %@@SUBROUTINE SUBSTI
  2536				@@PURPOSE SUBR WHICH POINTS THE DEV LIST
  2537				ENTRY TO RH(T1), DPBS START, CLRS "PREV WAS WAIT" FLAG, AND
  2538				RESETS THE HUNG TIME.
  2539				@@ENTRY EXPECTS J=KONT DB, F=DDB, AND P3=UNIT NO.
  2540				@@ACCUM DESTROYS T1 AND T2.
  2541				@@CALLS FSTHNG.
  2542				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  2543
  2544	002745'	554342	002170*	SUBSTI:	HLRZ	T2,KONBMX(J)	;GET POINTER TO
  2545	002746'	271356	000000		ADDI	T2,(P3)		;DEV LIST ENTRY.
  2546	002747'	542307	000000		HRRM	T1,(T2)		;POINT IT.
  2547	002750'	201300	000015		MOVEI	T1,STRTDV	;DPB THE
  2548	002751'	137300	004204'		DPB	T1,[POINT 4,(T2),^D11] ;START CODE.
  2549	002752'	324740	003023'		PJRST	FSTHNG		;SET HUNG TIME & CLR PREV=WAIT.
  2550
  2551
  2552				COMMENT %@@SUBROUTINE SUBTRM
  2553				@@PURPOSE SUBROUTINE WHICH DPBS TERMINATE
  2554				INTO THE DEVICE LIST ENTRY.
  2555				@@ENTRY EXPECTS J=KONT DB AND P3=UNIT NO.
  2556				@@ACCUM DESTROYS T1 AND T4.
  2557				@@RESTRICTIONS @@%
  2558
  2559
  2560	002753'	554442	002745*	SUBTRM:	HLRZ	T4,KONBMX(J)	;GET POINTER TO
  2561	002754'	271456	000000		ADDI	T4,(P3)		;DEV LIST ENTRY.
  2562	002755'	201300	000017		MOVEI	T1,TERMDV	;TERMINATE CODE.
  2563	002756'	137300	004236'		DPB	T1,[POINT 4,(T4),^D11] ;STORE IT.
  2564	002757'	263040	000000		POPJ	P,		;RETURN.
  2565
  2566
  2567				COMMENT %@@SUBROUTINE SUBRST/SUBRS0
  2568				@@PURPOSE SUBR WHICH SETS UP S, ERR PROCESSING, AND
  2569				POINTS THE DEV LIST ENTRY TO UNICMD AND DPBS START INTO IT.
  2570				@@ACCUM DESTROYS NO ACS.
  2571				@@ENTRY EXPECTS UNIT DB ADDR IN T3 AND F=DDB.
  2572				ENTRY POINT SUBRST CLEARS IOBOT; ENTRY POINT SUBRS0 DOES NOT.
  2573				@@CALLS FSTHNG.
  2574				@@RESTRICTIONS @@%
  2575
  2576	002760'	620000	004000	SUBRST:	TRZ	S,IOBOT
  2577	002761'	620000	764000	SUBRS0:	TRZ	S,IOIMPM!IODERR!IODTER!IOBKTL!IODEND!IOBOT ;
  2578	002762'	261040	000006		PUSH	P,T1		;SAVE T1
  2579	002763'	261040	000007		PUSH	P,T2		;AND T2
  2580	002764'	261040	000016		PUSH	P,P3		;AND P3.
  2581	002765'	660000	010000		TRO	S,IOACT		;SET
  2582	002766'	607000	100000		TLNN	S,IOLEND	;BITS
  2583	002767'	624000	002000		TRZA	S,IOTEND	;IN
  2584	002770'	660000	002000		TRO	S,IOTEND	;S.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 40-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2585	002771'	202004	000002		MOVEM	S,DEVIOS(F)	;STORE S.
  2586	002772'	554350	001064*		HLRZ	T2,UNIKNT(T3)	;SET
  2587	002773'	200347	000401*		MOVE	T2,CHNACT(T2)	;CHANNEL ACTIVE
  2588	002774'	202344	000404*		MOVEM	T2,DEVACT(F)	;FLAG WORD.
  2589	002775'	550350	002772*		HRRZ	T2,UNIKNT(T3)	;T2=KONT DB.
  2590	002776'	135700	004203'		LDB	P3,[POINT 3,DEVADD(F),^D23]
  2591	002777'	554347	002753*		HLRZ	T2,KONBMX(T2)
  2592	003000'	271356	000000		ADDI	T2,(P3)
  2593	003001'	201310	002644*		MOVEI	T1,UNICMD(T3)
  2594	003002'	542307	000000		HRRM	T1,(T2)		;POINT THE DEV LIST.
  2595	003003'	201300	000015		MOVEI	T1,STRTDV	;STORE THE START
  2596	003004'	137300	004204'		DPB	T1,[POINT 4,(T2),^D11] ;CODE.
  2597	003005'	260040	003023'		PUSHJ	P,FSTHNG	;SET HUNG TIME & CLR PREV=WAIT.
  2598	003006'	402004	002732*		SETZM	DEVER1(F)	;CLEAR THE
  2599	003007'	402004	002706*		SETZM	DEVER2(F)	;E. P.
  2600	003010'	262040	000016		POP	P,P3		;RESTORE P3
  2601	003011'	262040	000007		POP	P,T2		;AND T2
  2602	003012'	262040	000006		POP	P,T1		;AND T1.
  2603	003013'	263040	000000		POPJ	P,		;RETURN.
  2604
  2605
  2606				COMMENT %@@SUBROUTINE SUBRG2/SUBRGO/SUBRG1
  2607				@@PURPOSE SUBROUTINE WHICH SETS UP S, DEV LIST ENTRY (FOR START
  2608				OF NORMAL CMD AREA), AND ERROR PROCESSING, AND THEN GOES.
  2609				@@ACCUM DESTROYS T2.
  2610				@@ENTRY EXPECTS UNIT DB ADDR IN T3 AND F=DDB.
  2611				ENTRY POINT SUBRGO SETS UP AND GOES; ENTRY POINT SUBRG2 DOES THE
  2612				SAME, EXCEPT IT DOES NOT CLEAR IOBOT; ENTRY POINT SUBRG1 JUST
  2613				GOES.
  2614				@@CALLS SUBRS0 AND SUBRST.
  2615				@@RESTRICTIONS @@%
  2616
  2617	003014'	260040	002761'	SUBRG2:	PUSHJ	P,SUBRS0	;LIKE SUBRST, BUT DON'T CLR IOBOT.
  2618	003015'	254000	003017'		JRST	SUBRG1
  2619	003016'	260040	002760'	SUBRGO:	PUSHJ	P,SUBRST	;SETS UP S AND THE DEV LIST ENTRY.
  2620	003017'	554350	002775*	SUBRG1:	HLRZ	T2,UNIKNT(T3)	;T2=CHAN DB.
  2621	003020'	256007	000000*		XCT	CHNIIE(T2)	;START
  2622	003021'	256007	001473*		XCT	CHNGO(T2)	;UP AND
  2623	003022'	263040	000000		POPJ	P,		;RETURN.
  2624
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 41
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2625				COMMENT %@@SUBROUTINE FSTHNG
  2626				@@PURPOSE SUBROUTINE TO CLEAR THE "PREVIOUS WAS WAIT" HUNG
  2627				TIME FLAG (RH(UNITYP)) AND RESET THE HUNG TIME.
  2628				@@ACCUM DESTROYS NO ACS.
  2629				@@ENTRY EXPECTS T3=UNIT DB ADDR AND F=DDB.
  2630				@@CALLS SETHNG.
  2631				@@RESTRICTIONS CALLED AT BOTH UUO AND INTERRUPT LEVEL. @@%
  2632
  2633	003023'	513010	002711*	FSTHNG:	HLLZS	UNITYP(T3)	;CLEAR THE PREV WAS WAIT FLAG.
  2634	003024'	324740	000372*		PJRST	SETHNG		;RESET THE HUNG TIME.
  2635
  2636
  2637
  2638				COMMENT %@@SUBROUTINE FHGSTP
  2639				@@PURPOSE SUBROUTINE TO SAVE SOME ACS AND CALL HNGSTP (THE
  2640				DEVICE NOT READY MESSAGE SENDER.).
  2641				@@ENTRY EXPECTS F=DDB.
  2642				@@ACCUM DESTROYS T4.
  2643				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
  2644
  2645	003025'	261040	000005	FHGSTP:	PUSH	P,U
  2646	003026'	261040	000003		PUSH	P,PG		;
  2647	003027'	261040	000012		PUSH	P,W
  2648	003030'	261040	000013		PUSH	P,M
  2649	003031'	261040	000006		PUSH	P,T1
  2650	003032'	261040	000007		PUSH	P,T2
  2651	003033'	261040	000010		PUSH	P,T3
  2652	003034'	260040	000000*		PUSHJ	P,HNGSTP
  2653	003035'	262040	000010		POP	P,T3
  2654	003036'	262040	000007		POP	P,T2
  2655	003037'	262040	000006		POP	P,T1
  2656	003040'	262040	000013		POP	P,M
  2657	003041'	262040	000012		POP	P,W
  2658	003042'	262040	000003		POP	P,PG
  2659	003043'	262040	000005		POP	P,U
  2660	003044'	263040	000000		POPJ	P,
  2661
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 42
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2662				COMMENT %@@SUBROUTINE SUBRSN
  2663				@@PURPOSE SUBR TO SET UP A SENSE IN THE NORMAL CMD SPACE.
  2664				@@ENTRY EXPECTS UNIT DB ADDR IN T3 AND F=DDB.
  2665				@@ACCUM DESTROYS NO ACS.
  2666				@@RESTRICTIONS THIS IS A "UUO TYPE" SENSE INTO THE NORMAL
  2667				COMMAND AREA.  IT IS NOT NOT NOT THE ERROR SENSE INTO THE
  2668				KONTROLLER DB AREA.  IT IS DONE BY UGETF, INITIALIZATION, ETC. @@%
  2669
  2670	003045'	261040	000007	SUBRSN:	PUSH	P,T2		;SAVE T2.
  2671	003046'	200344	000737*		MOVE	T2,DEVADD(F)	;BUILD
  2672	003047'	661340	160020		TLO	T2,SENSE	;SENSE CMD.
  2673	003050'	202350	003001*		MOVEM	T2,UNICMD(T3)	;STORE IT.
  2674	003051'	201350	000003*		MOVEI	T2,UNICMD+3(T3) ;BUILD
  2675	003052'	661340	775000		TLO	T2,(BYTE (1)1(11)-^D24) ;DATA WORD.
  2676	003053'	202350	000001*		MOVEM	T2,UNICMD+1(T3)	;STORE IT.
  2677	003054'	515340	400000		HRLZI	T2,HALT		;STORE
  2678	003055'	202350	000002*		MOVEM	T2,UNICMD+2(T3)	;HALT CMD.
  2679	003056'	262040	000007		POP	P,T2		;RESTORE T2.
  2680	003057'	263040	000000		POPJ	P,		;RETURN.
  2681
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 43
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2682				COMMENT %@@SUBROUTINE SUBRSM
  2683				@@PURPOSE SUBR TO GEN A SM CMD IN UNICMD.
  2684				CMD HAS CMD CHAIN AND EXECUTE AND DEVICE ADDRESS.
  2685				SUBRSM LOOKS AT THE DENSITY AND PARITY FIELDS IN THE STATUS
  2686				WORD PLUS THE DENSITY AND 7 TRACK BITS IN UNITYP.
  2687				@@ENTRY EXPECTS S=DEVIOS, T3=UNI DB, AND F=DDB.
  2688				@@@ACCUM DESTROYS T1.
  2689				@@EXIT SEE PURPOSE.
  2690				@@RESTRICTIONS CALLED AT UUO LEVEL. @@%
  2691				;
  2692				;DESTROYS AC T1.
  2693				;EXPECTS UNIT DB ADDR IN T3 AND F=DDB.
  2694				;
  2695				;IF TWO DENSITIES ARE AVAILABLE AND THE USER ASKS FOR
  2696				;MEDIUM DENSITY, LOW DENSITY IS RETURNED.
  2697
  2698	003060'	541454	540114	SUBSTB:	XWD MS9T8,MS7T2
  2699	003061'	541414	540514		XWD MS9T16,MS7T5
  2700	003062'	541514	541114		XWD MS9T62,MS7T8
  2701
  2702	003063'	540214	540314	SUBST1:	XWD MS7TE2,MS7TO2
  2703	003064'	540614	540714		XWD MS7TE5,MS7TO5
  2704	003065'	541214	541314		XWD MS7TE8,MS7TO8
  2705
  2706
  2707	003066'	261040	000007	SUBRSM:	PUSH	P,T2		;SAVE T2.
  2708	003067'	135300	004240'		LDB	T1,[POINT 2,S,^D28] ;GET DENSITY ASKED.
  2709	003070'	326300	003072'		JUMPN	T1,.+2		;STANDARD DENSITY=
  2710	003071'	201300	000003		MOVEI	T1,3		;HIGHEST DENSITY.
  2711	003072'	510350	003023*		HLLZ	T2,UNITYP(T3)	;GET TRK/DENS AVAIL.
  2712	003073'	607340	000040		TLNN	T2,TRK7		;7 OR 9 TRACK?
  2713	003074'	254000	003114'		JRST	SUBSM4
  2714
  2715				    ;7 TRACK (800/556 OR 800/556/200.)
  2716	003075'	307300	000001		CAIG	T1,1		;IF ASK LOW
  2717	003076'	603340	000001		TLNE	T2,DS200	;BUT NO 200
  2718	003077'	254000	003101'		JRST	.+2		;THEN
  2719	003100'	201300	000002		MOVEI	T1,2		;GET 556.
  2720	003101'	514346	003057'		HRLZ	T2,SUBSTB-1(T1)	;NORMAL 7 TRACK
  2721	003102'	607000	400000		TLNN	S,COMPAT	;MODE?
  2722	003103'	254000	003107'		JRST	SUBSM2		;YES.
  2723	003104'	514346	003062'		HRLZ	T2,SUBST1-1(T1)	;NO.  EVEN OR
  2724	003105'	602000	001000		TRNE	S,IOPAR		;ODD
  2725	003106'	510346	003062'		HLLZ	T2,SUBST1-1(T1)	;PARITY.
  2726	003107'	200300	000007	SUBSM2:	MOVE	T1,T2		;MOVE IT TO T1.
  2727	003110'	670304	003046*	SUBSOT:	TDO	T1,DEVADD(F)	;AND
  2728	003111'	202310	003050*		MOVEM	T1,UNICMD(T3)	;STORE.
  2729	003112'	262040	000007		POP	P,T2		;RESTORE T2 AND
  2730	003113'	263040	000000		POPJ	P,		;RETURN.
  2731
  2732				    ;9 TRACK(6250 OR 6250/1600 OR 1600 OR 1600/800.).
  2733	003114'	302300	000001	SUBSM4:	CAIE	T1,1		;ONLY 1 AND 2 SINCE NO
  2734	003115'	275300	000001		SUBI	T1,1		;9 TRK HAS >2 DENS.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 43-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2735	003116'	607340	000020		TLNN	T2,DS6250
  2736	003117'	254000	003124'		JRST	SUBSM6		;GO TO 1600 OR 1600/800.
  2737	003120'	607340	000010		TLNN	T2,DS1600	;HERE ON 6250 OR 6250/1600.
  2738	003121'	201300	000002		MOVEI	T1,2		;PLAIN 6250.
  2739	003122'	510306	003060'	SUBSMT:	HLLZ	T1,SUBSTB(T1)	;SET UP AND
  2740	003123'	254000	003110'		JRST	SUBSOT		;RETURN.
  2741	003124'	607340	000004	SUBSM6:	TLNN	T2,DS800	;HERE ON 1600 OR 1600/800.
  2742	003125'	201300	000002		MOVEI	T1,2		;PLAIN 1600.
  2743	003126'	364300	003122'		SOJA	T1,SUBSMT	;SET UP AND RETURN.
  2744
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 44
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2745				COMMENT %@@SUBROUTINE SCOMBL
  2746				@@PURPOSE SUBR TO GENERATE CMDS FROM THE DDB CMD BUFFER INTO
  2747				THE UNIT CMD AREA.
  2748				@@ENTRY EXPECTS UNIT DB ADDR IN T3 AND F=DDB.
  2749				@@ACCUM DESTROYS T1, T2, AND U.
  2750				@@FUNCTION GOES TO ONE OF 3 SECTIONS DEPENDING ON WHETHER THE
  2751				MODE IS D, B, OR DR.  D MODE, UNLIKE B AND DR, CAN ALWAYS
  2752				PROCESS A COMPLETE DDB LIST IN ONE UNIT COMMAND AREA.  D MODE
  2753				IS THEREFORE STRAIGHTFORWARD.  B MODE CALCS HOW MANY SPACES IN
  2754				THE UNIT CMD LIST IT NEEDS FOR THE NEXT BUFFER;  IF IT CAN FIT
  2755				IT IN, IT DOES AND THEN LOOKS AT THE NEXT BUFFER;  IF IT
  2756				CAN'T FIT IT IN, IT SETS UP A CONTINUATION WORD IN DEVCNT.
  2757				FRCINT (CAUSE A PROGRAM INTERRUPT) IS SET FOR EACH B CMD SO
  2758				THAT THE BUFFERS CAN BE PROCESSED INDIVIDUALLY.
  2759				DR SPINS OFF 200 WORD OR LESS RECORDS FROM THE DDB LIST
  2760				INTO THE UNIT CMD LIST;  IF IT HAS EXHAUSTED THE UNIT CMD
  2761				LIST BEFORE THE DDB LIST IS DONE, IT STORES CONTINATION
  2762				INFORMATION IN DEVCNT AND LH(DEVUDB).
  2763				(AT ENTRY, DEVCNT<>0 IS THE FLAG TO B AND DR MODES THAT THEY
  2764				HAVE TO START IN THE MIDDLE OF THE DDB LIST.)
  2765
  2766				ALL 3 MODES GO TO SCMFIN TO GEN A HALT CMD, SET UP S, ETC.,
  2767				AND THEN SCOMBL RETURNS.
  2768
  2769				IBM 9 TRACK BYTE ADJUSTMENTS ARE AS FOLLOWS: (A) BUFFERED--
  2770				SUBTRACTED FROM EACH BUFFER BYTE COUNT, (B) DUMP--SUBTRACTED
  2771				FROM EACH "DUMP RECORD" COUNT, AND (C) DUMP RECORDS--SUBTRACTED
  2772				FROM EACH RECORD COUNT.
  2773				@@EXIT SKIP RETURNS IF BUFFERED MODE AND THE CONT OF DATA
  2774				TO TRANSFER IS 0.
  2775				@@CALLS SUBRSM, STOCMD, STODTS, SDTCAL, AND SUBRST.
  2776				@@ERRORS CERTAIN ILLEGAL DDB LISTS (TOO LARGE A BUFFER, A
  2777				ZERO DATA COUNT FOR D OR DR MODES) CAUSE A STOPCD.
  2778				@@RESTRICTIONS CALLED AT BOTH UUO AND INTERRUPT LEVEL. @@%
  2779
  2780				;DEVER1 AND DEVNOI ARE USED FOR TEMP STORAGE HERE ONLY.
  2781
  2782
  2783	003127'	260040	003066'	SCOMBL:	PUSHJ	P,SUBRSM	;GEN SM IN UNICMD.
  2784	003130'	201350	000001*		MOVEI	T2,UNICMD+1(T3)	;T2=DEST PNTR.
  2785	003131'	135240	002720*		LDB	U,PIOMOD	;GET MODE.
  2786	003132'	261040	000011		PUSH	P,T4		;SAVE T4
  2787	003133'	261040	000013		PUSH	P,M		;AND M
  2788	003134'	261040	000003		PUSH	P,PG		;AND PG.
  2789	003135'	306240	000016		CAIN	U,DR		;DR GOES
  2790	003136'	254000	003175'		JRST	SCOMDR		;TO SCOMDR.
  2791	003137'	302240	000017		CAIE	U,D		;BUFFERED GOES
  2792	003140'	254000	003147'		JRST	SCOMBF		;TO SCOMBF.
  2793
  2794				    ;DUMP.
  2795	003141'	200304	000011		MOVE	T1,DEVCLS(F)	;TI=ORIGIN PNTR.
  2796	003142'	336006	000000		SKIPN	(T1)		;MUST BE
  2797	003143'	256000	000000'		STOPCD			;SOMETHING.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 44-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2798	003144'	260040	003317'		PUSHJ	P,STOCMD	;GEN A R/W CMD INTO T2.
  2799	003145'	260040	003355'		PUSHJ	P,STODTS	;GEN THE DATA WORDS.
  2800	003146'	254000	003306'		JRST	SCMFIN		;GO FINISH UP.
  2801
  2802				    ;BUFFERED.
  2803	003147'	332304	001615*	SCOMBF:	SKIPE	T1,DEVCNT(F)	;CONTINUING?
  2804	003150'	254000	003154'		JRST	SCMBF1		;YES.
  2805	003151'	200304	000011	SCMBF0:	MOVE	T1,DEVCLS(F)	;NOT CONTINUING.
  2806	003152'	336006	000000		SKIPN	(T1)		;MUST BE
  2807	003153'	256000	000000'		STOPCD			;SOMETHING THE FIRST TIME.
  2808	003154'	260040	003413'	SCMBF1:	PUSHJ	P,SDTCAL	;U=# DATA WORDS+2
  2809	003155'	322240	003167'		JUMPE	U,SCMBF3	;NEEDED.
  2810	003156'	301240	000000*		CAIL	U,FTCMLN	;FOR THIS BUFFER.
  2811	003157'	256000	004241'		 STOPCD (.,JOB,MTATMW,,<Too many data words>)
  2812				 ;;SCMBF1+3
  2813	003160'	271247	000000		ADDI	U,(T2)		;
  2814	003161'	307250	000000*		CAIG	U,UNIDON(T3)	;ROOM?
  2815	003162'	254000	003165'		JRST	SCMBF2		;YES.
  2816	003163'	202304	003147*		MOVEM	T1,DEVCNT(F)	;NO.  SET UP CONTINUATION
  2817	003164'	254000	003306'		JRST	SCMFIN		;AND GO FINISH UP.
  2818	003165'	260040	003317'	SCMBF2:	PUSHJ	P,STOCMD	;GEN A R/W CMD TO (T2).
  2819	003166'	260040	003355'		PUSHJ	P,STODTS	;GEN ALL THE DATA WORDS.
  2820	003167'	201306	000001	SCMBF3:	MOVEI	T1,1(T1)	;AT EO BUFFER.  AT EO
  2821	003170'	332006	000000		SKIPE	(T1)		;LIST?
  2822	003171'	254000	003154'		JRST	SCMBF1		;NO.
  2823	003172'	302350	000001*		CAIE	T2,UNICMD+1(T3)	;YES--ANYTHING TO DO?
  2824	003173'	254000	003305'		JRST	SCMFN0		;YES.
  2825	003174'	254000	003311'		JRST	SCMFN2		;NO.
  2826
  2827				    ;DUMP RECORDS.
  2828	003175'	336544	003163*	SCOMDR:	SKIPN	M,DEVCNT(F)	;CONTINUING?
  2829	003176'	254000	003201'		JRST	SCMDR1		;NO.
  2830	003177'	554304	001100*		HLRZ	T1,DEVUDB(F)	;YES.  SET UP T1
  2831	003200'	254000	003204'		JRST	SCMDR2		;AND GO.
  2832	003201'	200304	000011	SCMDR1:	MOVE	T1,DEVCLS(F)	;
  2833	003202'	336546	000000		SKIPN	M,(T1)		;NOT CONTINUING.  MUST BE SOMETHING
  2834	003203'	256000	000000'		 STOPCD			;THE FIRST TIME.;;SCMDR1+2
  2835	003204'	211240	000200	SCMDR2:	MOVNI	U,^D128		;SET UP
  2836	003205'	607000	400000		TLNN	S,COMPAT	;THE "ALMOST 200
  2837	003206'	254000	003212'		JRST	SCMD25		;WORD"
  2838	003207'	240240	000002		ASH	U,2		;SIZE
  2839	003210'	550444	002523*		HRRZ	T4,DEVFNJ(F)	;IN
  2840	003211'	271251	000000		ADDI	U,(T4)		;DEVNOI.
  2841	003212'	202244	002500*	SCMD25:	MOVEM	U,DEVNOI(F)	;
  2842	003213'	135440	004244'	SCMDR3:	LDB	T4,[POINT ^D14,M,^D13] ;GET THE
  2843	003214'	670440	000031'		TDO	T4,MSKCTD	;COUNT FROM THIS
  2844	003215'	603000	400000		TLNE	S,COMPAT	;DDB
  2845	003216'	240440	000002		ASH	T4,2		;WORD.
  2846	003217'	621540	777760		TLZ	M,MSKMMD	;GET THE CORRECT
  2847	003220'	271540	000001		ADDI	M,1		;MEM ADDR ALSO.
  2848	003221'	200244	003212*	SCMDR4:	MOVE	U,DEVNOI(F)	;RECORD SIZE=ABOUT 200 WORDS.
  2849	003222'	305350	777774*		CAIGE	T2,UNIDON-4(T3)	;ROOM FOR SM,R/W,D,D,HALT?
  2850	003223'	254000	003233'		JRST	SCMDR6		;YES.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 44-3
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2851	003224'	603000	400000		TLNE	S,COMPAT	;NO, GET WORD COUNT OR
  2852	003225'	240440	777776		ASH	T4,-2		;BYTE COUNT.
  2853	003226'	275540	000001		SUBI	M,1		;SET
  2854	003227'	137440	004244'		DPB	T4,[POINT ^D14,M,^D13] ;UP
  2855	003230'	202544	003175*		MOVEM	M,DEVCNT(F)	;FOR
  2856	003231'	506304	003177*		HRLM	T1,DEVUDB(F)	;CONTINUATION.
  2857	003232'	254000	003306'		JRST	SCMFIN		;GO GEN A HALT CMD.
  2858	003233'	552344	003006*	SCMDR6:	HRRZM	T2,DEVER1(F)	;SAVE CMD LOC.
  2859	003234'	260040	003317'		PUSHJ	P,STOCMD	;GEN A READ CMD.
  2860	003235'	317440	000005	SCMDR7:	CAMG	T4,U		;COUNT>=REST OF RECORD?
  2861	003236'	254000	003264'		JRST	SCMDR8		;YES.
  2862	003237'	200140	000011		MOVE	PG,T4		;SET PG UP WITH COUNT
  2863	003240'	603000	400000		TLNE	S,COMPAT	;POSSIBLY THIS
  2864	003241'	332006	000001		SKIPE	1(T1)		;IS A
  2865	003242'	254000	003245'		JRST	.+3		;SHORT
  2866	003243'	550144	003210*		HRRZ	PG,DEVFNJ(F)	;LAST
  2867	003244'	270140	000011		ADD	PG,T4		;RECORD.
  2868	003245'	260040	003347'		PUSHJ	P,STODAT	;FOR STODAT.
  2869	003246'	201306	000001		MOVEI	T1,1(T1)	;AT END OF
  2870	003247'	332546	000000		SKIPE	M,(T1)		;LIST?
  2871	003250'	254000	003254'		JRST	SCMD75		;NO.
  2872	003251'	515140	400000		HRLZI	PG,LASDAT	;YES.  TURN OFF
  2873	003252'	436147	777777		IORM	PG,-1(T2)	;DATA CHAINING.
  2874	003253'	254000	003305'		JRST	SCMFN0
  2875	003254'	274240	000011	SCMD75:	SUB	U,T4		;NO, CORRECT "RECORD SIZE".
  2876	003255'	135440	004244'		LDB	T4,[POINT ^D14,M,^D13] ;SET
  2877	003256'	670440	000031'		TDO	T4,MSKCTD	;UP
  2878	003257'	603000	400000		TLNE	S,COMPAT	;THE
  2879	003260'	240440	000002		ASH	T4,2		;COUNT.
  2880	003261'	621540	777760		TLZ	M,MSKMMD	;GET CORRECT
  2881	003262'	271540	000001		ADDI	M,1		;MEM ADDR.
  2882	003263'	254000	003235'		JRST	SCMDR7		;GO GEN ANOTHER DATA WORD.
  2883	003264'	200140	000005	SCMDR8:	MOVE	PG,U		;SET PG UP WITH CURRENT
  2884	003265'	260040	003347'		PUSHJ	P,STODAT	;FOR STODAT.
  2885	003266'	515140	400000		HRLZI	PG,LASDAT	;TURN OFF
  2886	003267'	436147	777777		IORM	PG,-1(T2)	;DATA CHAINING.
  2887	003270'	607000	400000		TLNN	S,COMPAT	;SET UP U TO
  2888	003271'	254000	003274'		JRST	.+3		;ADJUST
  2889	003272'	550144	003243*		HRRZ	PG,DEVFNJ(F)	;T4 AND
  2890	003273'	275243	000000		SUBI	U,(PG)		;M.
  2891	003274'	274440	000005		SUB	T4,U		;ADJUST COUNT.
  2892	003275'	322440	003302'		JUMPE	T4,SCMD84	;JUMP ON EXACTLY DONE.
  2893	003276'	603000	400000		TLNE	S,COMPAT	;ADJUST THE
  2894	003277'	240240	777776		ASH	U,-2		;MEM ADDR FOR WHAT
  2895	003300'	274540	000005		SUB	M,U		;WE JUST PROCESSED.
  2896	003301'	254000	003221'		JRST	SCMDR4		;GO GEN ANOTHER CMD.
  2897	003302'	201306	000001	SCMD84:	MOVEI	T1,1(T1)	;INCREMENT ORIGIN PNTR.
  2898	003303'	332546	000000		SKIPE	M,(T1)		;EOR (AND EOL) ?
  2899	003304'	254000	003213'		JRST	SCMDR3		;GO GEN ANOTHER CMD.
  2900
  2901
  2902	003305'	402004	003230*	SCMFN0:	SETZM	DEVCNT(F)	;CLEAR CONTINUATION.
  2903	003306'	515140	400000	SCMFIN:	HRLZI	PG,HALT		;HALT
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 44-4
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2904	003307'	202147	000000		MOVEM	PG,(T2)		;CMD.
  2905	003310'	260040	002760'		PUSHJ	P,SUBRST		;SET UP S, HUNG TIME, DEV LIST AND E.P.
  2906	003311'	262040	000003	SCMFN2:	POP	P,PG		;RESTORE PG.
  2907	003312'	262040	000013		POP	P,M		;AND M
  2908	003313'	262040	000011		POP	P,T4		;AND T4.
  2909	003314'	306350	000001*		CAIN	T2,UNICMD+1(T3)	;BUFFERED, NOTHING TO DO?
  2910	003315'	350001	000000		AOS	(P)		;YES.
  2911	003316'	263040	000000		POPJ	P,		;RETURN.
  2912
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 45
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2913				COMMENT %@@SUBROUTINE STOCMD
  2914				@@PURPOSE SUBR TO STORE A READ FORWARDS OR A WRITE CMD IN (T2).
  2915				CMD HAS CMD CHAIN AND MODE.  CMD HAS PRGINT, IF BUFFERED.
  2916				T2 IS INCREMENTED BY ONE ON EXIT.
  2917				@@ENTRY EXPECTS UNIT DB ADDR IN T3, S=DEVIOS, AND F=DDB.
  2918				@@ACCUM NO ACS ARE DESTROYED.
  2919				@@FUNCTION  SEE PURPOSE.  INFO IN S AND DEVADD IS USED TO
  2920				BUILD THE COMMAND.
  2921				@@EXIT SEE PURPOSE.
  2922				@@RESTRICTIONS CALLED AT BOTH THE UUO AND INTERRUPT LEVELS. @@%
  2923
  2924
  2925	003317'	261040	000006	STOCMD:	PUSH	P,T1		;SAVE T1
  2926	003320'	261040	000007		PUSH	P,T2		;AND T2.
  2927	003321'	200304	003110*		MOVE	T1,DEVADD(F)	;T1 TEMPORARILY HOLDS THE CMD.
  2928	003322'	135340	003131*		LDB	T2,PIOMOD	;GET MODE.
  2929	003323'	305340	000016		CAIGE	T2,DR		;SET PRGM INTRPT FLAG
  2930	003324'	661300	010000		TLO	T1,FRCINT	;FOR BUFFERED MODE.
  2931
  2932				    ;SET MODE.
  2933	003325'	554350	003072*		HLRZ	T2,UNITYP(T3)	;GET INFO.
  2934	003326'	606340	000040		TRNN	T2,TRK7		;7 TRACK?
  2935	003327'	254000	003334'		JRST	STOCM4		;NO.
  2936	003330'	607000	400000		TLNN	S,COMPAT	;YES.  SPECIAL MODE?
  2937	003331'	665300	200000		TLOA	T1,MODE7	;NO.
  2938	003332'	661300	020000		TLO	T1,MODE7I	;YES.
  2939	003333'	254000	003337'		JRST	STOCM6		;
  2940	003334'	607000	400000	STOCM4:	TLNN	S,COMPAT	;9 TRACK.  IBM?
  2941	003335'	665300	220000		TLOA	T1,MODE9D	;NO.  DEC.
  2942	003336'	661300	020000		TLO	T1,MODE9I	;YES. IBM.
  2943
  2944	003337'	607000	000020	STOCM6:	TLNN	S,IO		;WRITING?
  2945	003340'	665300	140010		TLOA	T1,READFW	;NO. READ CMD.
  2946	003341'	661300	144004		TLO	T1,WRITE	;YES. WRITE CMD.
  2947	003342'	262040	000007		POP	P,T2		;RESTORE T2.
  2948	003343'	202307	000000		MOVEM	T1,(T2)		;STORE CMD.
  2949	003344'	340340	003345'		AOJ	T2,.+1		;BUMP T2.
  2950	003345'	262040	000006		POP	P,T1		;RESTORE T1.
  2951	003346'	263040	000000		POPJ	P,		;RETURN.
  2952
  2953
  2954				COMMENT %@@SUBROUTINE STODAT
  2955				@@PURPOSE SUBR TO STORE A DATA WORD IN (T2).
  2956				DATA CHAINS.
  2957				@@ENTRY EXPECTS PG HAS WORD OR BYTE COUNT AND M HAS MEMORY ADDRESS.
  2958				@@ACCUM DESTROYS NO ACS.
  2959				@@FUNCTION BUILDS A DATA WORD IN (T2) FROM THE INFORMATION
  2960				IN PG AND M.  INCS T2.
  2961				@@EXIT SEE FUNCTION.
  2962				T2 IS INCREMENTED BY ONE ON EXIT.
  2963				@@RESTRICTIONS CALLED AT BOTH UUO AND INTERRUPT LEVEL. @@%
  2964
  2965
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 45-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  2966	003347'	621540	777700	STODAT:	TLZ	M,MSKMMU	;JUST IN CASE.
  2967	003350'	202547	000000		MOVEM	M,(T2)		;STORE MEM ADDR.
  2968	003351'	312140	000033'		CAME	PG,DATASZ
  2969	003352'	137140	004245'		DPB	PG,[POINT ^D11,(T2),^D11]
  2970	003353'	340340	003354'		AOJ	T2,.+1
  2971	003354'	263040	000000		POPJ	P,
  2972
  2973
  2974				COMMENT %@@SUBROUTINE STODTS
  2975				@@PURPOSE SUBR TO GENERATE DATA WORDS FROM THE DDB WORDS
  2976				STARTING AT (T1) AND CONTINUING UNTIL A 0 DDB WORD IS HIT.
  2977				@@ENTRY EXPECTS T1=ORIGIN PNTR, T2=DEST PNTR, F=DDB, AND T3=UNIT DB.
  2978				@@ACCUM DESTROYS ACS T4, PG, AND M.
  2979				@@EXIT ON EXIT T1 POINTS TO THE 0 DDB WORD AND T2 POINTS TO THE NEXT
  2980				DESTINATION.
  2981				@@CALLS STODAT.
  2982				@@RESTRICTIONS CALLED AT BOTH UUO AND INTERRUPT LEVELS @@%
  2983
  2984	003355'	200546	000000	STODTS:	MOVE	M,(T1)		;SET UP MEM ADDR.
  2985	003356'	135440	004244'	STODS1:	LDB	T4,[POINT ^D14,M,^D13] ;GET THE
  2986	003357'	322440	003363'		JUMPE	T4,STOD15	;COUNT
  2987	003360'	670440	000031'		TDO	T4,MSKCTD	;OF WORDS
  2988	003361'	603000	400000		TLNE	S,COMPAT	;OR
  2989	003362'	240440	000002		ASH	T4,2		;BYTES.
  2990	003363'	621540	777760	STOD15:	TLZ	M,MSKMMD	;POINT TO CORRECT
  2991	003364'	271540	000001		ADDI	M,1		;MEM ADDR.
  2992	003365'	603000	400000		TLNE	S,COMPAT	;LAST DDB WORD IN
  2993	003366'	332006	000001		SKIPE	1(T1)		;IBM 9 TRACK?
  2994	003367'	254000	003372'		JRST	STODS2		;NO.
  2995	003370'	550144	003272*		HRRZ	PG,DEVFNJ(F)	;YES,
  2996	003371'	271443	000000		ADDI	T4,(PG)		;ADJUST COUNT.
  2997	003372'	311440	000033'	STODS2:	CAML	T4,DATASZ	;COUNT > COUNT FIELD?
  2998	003373'	254000	003403'		JRST	STODS4		;NO.
  2999	003374'	200140	000033'		MOVE	PG,DATASZ	;YES.  DO MAXIMUM.
  3000	003375'	260040	003347'		PUSHJ	P,STODAT	;GEN THE DATA WORD.
  3001	003376'	274440	000003		SUB	T4,PG		;ADJUST THE COUNT.
  3002	003377'	603000	400000		TLNE	S,COMPAT	;ADJUST
  3003	003400'	240140	777776		ASH	PG,-2		;THE MEM
  3004	003401'	274540	000003		SUB	M,PG		;ADDR.
  3005	003402'	254000	003372'		JRST	STODS2		;GO GEN ANOTHER DATA WORD.
  3006	003403'	200140	000011	STODS4:	MOVE	PG,T4		;HERE ON END OF DDB WORD.
  3007	003404'	260040	003347'		PUSHJ	P,STODAT	;GEN THE DATA WORD.
  3008	003405'	201306	000001		MOVEI	T1,1(T1)	;GET NEXT DDB WORD, AND
  3009	003406'	332546	000000		SKIPE	M,(T1)		;IF IT IS <> 0,
  3010	003407'	254000	003356'		JRST	STODS1		;CONTINUE.
  3011	003410'	515140	400000		HRLZI	PG,LASDAT	;DONE.  TURN OFF DATA
  3012	003411'	436147	777777		IORM	PG,-1(T2)	;CHAINING IN LAST DATA WORD.
  3013	003412'	263040	000000		POPJ	P,
  3014
  3015
  3016				COMMENT %@@SUBROUTINE SDTCAL
  3017				@@PURPOSE SUBR TO FIND OUT HOW MANY DATA WORDS WE NEED
  3018				FOR THIS BUFFER.  RETURN ANSWER+2 (R/W AND HALT) IN U.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 45-3
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3019				THIS IS A LOOK AHEAD ROUTINE TO SEE IF WE CAN FIT THIS
  3020				BUFFER INTO THE SPACE LEFT IN OUR COMMAND AREA.
  3021				@@ENTRY EXPECTS T1 = ADDR OF THE 1ST DDB DATA LOC WE ARE INTERESTED IN.
  3022				@@ACCUM DESTROYS AC T4.
  3023				@@EXIT SEE PURPOSE.
  3024				@@ERRORS IF ONE OF THE DDB WORDS HAS A 0 COUNT FIELD, THE
  3025				NEXT DDB WORD MUST BE 0, ELSE STOPCD.
  3026				@@RESTRICTIONS CALLED AT BOTH UUO AND INTERRUPT LEVELS. @@%
  3027
  3028	003413'	261040	000006	SDTCAL:	PUSH	P,T1		;SAVE T1
  3029	003414'	261040	000003		PUSH	P,PG		;AND PG.
  3030	003415'	400240	000000		SETZ	U,		;U HOLDS THE COUNT.
  3031	003416'	135440	004246'	SDTCL1:	LDB	T4,[POINT ^D14,(T1),^D13] ;GET THE COUNT
  3032	003417'	326440	003424'		JUMPN	T4,SDTCL2	;FROM ONE DDB WORD.
  3033	003420'	340300	003421'		AOJ	T1,.+1		;IF 0, CAN
  3034	003421'	332006	000000		SKIPE	(T1)		;ONLY BE ONE
  3035	003422'	256000	000000'		 STOPCD			;ENTRY FOR      ;;SDTCL1+4
  3036	003423'	254000	003446'		JRST	SDTCL4		;THIS BUFFER.
  3037	003424'	670440	000031'	SDTCL2:	TDO	T4,MSKCTD	;CORRECT FORM.
  3038	003425'	607000	400000		TLNN	S,COMPAT	;BYTE MODE?
  3039	003426'	254000	003434'		JRST	SDTCL3		;NO.
  3040	003427'	240440	000002		ASH	T4,2		;YES, CORRECT COUNT.
  3041	003430'	332006	000001		SKIPE	1(T1)		;IF
  3042	003431'	254000	003434'		JRST	SDTCL3		;LAST,
  3043	003432'	550144	003370*		HRRZ	PG,DEVFNJ(F)	;ADJUST
  3044	003433'	271443	000000		ADDI	T4,(PG)		;THE COUNT.
  3045	003434'	270440	000033'	SDTCL3:	ADD	T4,DATASZ	;ROUND UP
  3046	003435'	271440	000001		ADDI	T4,1		;A LITTLE.
  3047	003436'	261040	000012		PUSH	P,T4+1		;SAVE T4+1.
  3048	003437'	230440	000033'		IDIV	T4,DATASZ	;CONVERT TO DW'S.
  3049	003440'	262040	000012		POP	P,T4+1		;RESTORE T4+1.
  3050	003441'	270240	000011		ADD	U,T4		;ADD INTO U.
  3051	003442'	201306	000001		MOVEI	T1,1(T1)	;LOOK AT NEXT DDB WORD.
  3052	003443'	332006	000000		SKIPE	(T1)		;LAST?
  3053	003444'	254000	003416'		JRST	SDTCL1		;NO, CONTINUE.
  3054	003445'	271240	000002		ADDI	U,2		;ADD IN R/W AND HALT.
  3055	003446'	262040	000003	SDTCL4:	POP	P,PG		;RESTORE PG.
  3056	003447'	262040	000006		POP	P,T1		;AND T1.
  3057	003450'	263040	000000		POPJ	P,
  3058
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 46
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3059				COMMENT %@@SUBROUTINE SGPREV
  3060				@@PURPOSE SUBR TO GET THE ADDR OF THE PREVIOUS READ CMD INTO T4.
  3061				THIS SUBR STARTS AT THE TOP OF THE COMMAND LIST AND WORKS
  3062				DOWN, SINCE WE CAN'T WORK UP.
  3063				@@ENTRY EXPECTS T3=UNIT DB AND T1=ADDR OF PRESENT CMD OR BETWEEN
  3064				PRESENT AND PREVIOUS.
  3065				(T1 MUST POINT TO A LOCATION > 1ST CMD).
  3066				@@ACCUM DESTROYS NO ACS.
  3067				@@EXIT SEE PURPOSE.
  3068				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL.  @@%
  3069
  3070				;The SA10 reports the address of the COUNT,,ADDR word that was being
  3071				;processed when the error occurred.  There may have been several other
  3072				;COUNT,,ADDR words between this one and the READ/WRITE command that this
  3073				;word belongs to.  Search for the READ/WRITE command.
  3074
  3075	003451'	261040	000007	SGPREV:	PUSH	P,T2		;SAVE T2.
  3076								;T1 has pointer from RH of location 302
  3077	003452'	201350	000001*		MOVEI	T2,UNICMD+1(T3)	;Skip set-density, get addr of read cmd
  3078	003453'	200440	000007		MOVE	T4,T2		;Use top of command list if FTACFC
  3079	003454'	301310	003111*		CAIL	T1,UNICMD(T3)	;Does it point before the command list
  3080	003455'	303310	003161*		CAILE	T1,UNIDON(T3)	; or after the end of the command list?
  3081	003456'	256000	004247'		 STOPCD	(CPOPJ,INFO,FTACFC,,<FTA error - Cannot Find Command>);;SGPREV+3
  3082	003457'	336007	000000	SGPRV2:	SKIPN	(T2)		;SKIP 0
  3083	003460'	344340	003457'		AOJA	T2,.-1		;FILLERS.
  3084	003461'	551447	000000		HRRZI	T4,(T2)		;SAVE CURRENT.
  3085	003462'	340340	003463'		AOJ	T2,.+1		;POINT TO 1ST DATA WORD.
  3086	003463'	331007	000000	SGPRV3:	SKIPL	(T2)		;LAST DATA WORD IS < 0.
  3087	003464'	344340	003463'		AOJA	T2,SGPRV3	;WALK DOWN THE DATA WORDS.
  3088	003465'	303307	000001		CAILE	T1,1(T2)	;GONE PAST CMD?
  3089	003466'	344340	003457'		AOJA	T2,SGPRV2	;T2=ADDR OF NEXT CMD.
  3090	003467'	262040	000007	SGPRV4:	POP	P,T2		;RESTORE T2.
  3091	003470'	263040	000000		POPJ	P,		;RETURN.
  3092
  3093
  3094				COMMENT %@@SUBROUTINE SGDEV1
  3095				@@PURPOSE SUBR TO GET THE "ADDRESS OF THE CMD WE STOPPED ON WITH
  3096				AN ERROR" INTO T4.
  3097				FOR NON-READ/NON-WRITE, ADDR=ADDR OF FAILED CMD+1.
  3098				FOR READ/WRITE, ADDR=ADDR OF NEXT READ/WRITE CMD.
  3099				@@ENTRY EXPECTS T3=UNIT DB AND U=4 WORD AREA ADDR+1.
  3100				@@ACCUM DESTROYS NO ACS.
  3101				@@EXIT SEE PURPOSE.
  3102				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3103
  3104	003471'	261040	000006	SGDEV1:	PUSH	P,T1		;SAVE T1.
  3105	003472'	550445	000001		HRRZ	T4,1(U)		;T4=ADDR OF NEXT CMD.
  3106	003473'	554304	003432*		HLRZ	T1,DEVFNJ(F)	;GET FN IN PROGRESS.
  3107	003474'	303450	000001*		CAILE	T4,UNICMD+1(T3)	;IN ERROR SPACE
  3108	003475'	305300	000012		CAIGE	T1,FNPRED	;OR NOT R/W?
  3109	003476'	254000	003511'		JRST	SGDEV5		;YES.
  3110	003477'	201310	000001*		MOVEI	T1,UNICMD+1(T3)	;R/W.  T1=1ST CMD ADDR.
  3111	003500'	336006	000000	SGDEV2:	SKIPN	(T1)		;SKIP 0
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 46-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3112	003501'	344300	003500'		AOJA	T1,.-1		;FILLERS.
  3113	003502'	340300	003503'		AOJ	T1,.+1		;T1=1ST DATA WORD ADDR.
  3114	003503'	331006	000000	SGDEV3:	SKIPL	(T1)		;LAST DATA WORD IS < 0.
  3115	003504'	344300	003503'		AOJA	T1,SGDEV3	;TRY AGAIN.
  3116	003505'	340300	003506'		AOJ	T1,.+1		;T1=ADDR OF NEXT R/W CMD.
  3117	003506'	305311	000000		CAIGE	T1,(T4)		;GOT PAST ERROR?
  3118	003507'	254000	003500'		JRST	SGDEV2		;NO.
  3119	003510'	551446	000000		HRRZI	T4,(T1)		;GOT PAST ERROR.  T4=ADDR.
  3120	003511'	262040	000006	SGDEV5:	POP	P,T1		;RESTORE T1.
  3121	003512'	263040	000000		POPJ	P,		;AND RETURN.
  3122
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 47
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3123				COMMENT %@@SUBROUTINE SWRDRD
  3124				@@PURPOSE SUBR WHICH RETURNS IN T4 THE SUM OF THE WORD/BYTE
  3125				COUNTS BETWEEN THE DATA WORD POINTED TO BY (T1) AND THE PREVIOUS
  3126				READ CMD INCLUSIVE.  ON EXIT, T1 POINTS TO THE PREVIOUS READ
  3127				CMD.
  3128				@@ENTRY EXPECTS T3=UNIT DB AND T1 AS STATED IN PURPOSE.
  3129				(T1 MUST POINT TO A LOC > 1ST CMD.).
  3130				@@ACCUM DESTROYS NO ACS.
  3131				@@EXIT SEE PURPOSE.
  3132				@@CALLS SGPREV.
  3133				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3134
  3135	003513'	261040	000007	SWRDRD:	PUSH	P,T2		;SAVE T2
  3136	003514'	261040	000013		PUSH	P,M		;AND M.
  3137	003515'	260040	003451'		PUSHJ	P,SGPREV	;GET T4=ADDR OF PREVIOUS CMD.
  3138	003516'	261040	000011		PUSH	P,T4		;STORE IT.
  3139	003517'	201551	000001		MOVEI	M,1(T4)		;M HAS ADDR OF 1ST DATA WORD.
  3140	003520'	400440	000000		SETZ	T4,		;T4 HOLDS COUNT.
  3141	003521'	313540	000006	SWRDR1:	CAMLE	M,T1		;MORE DATA WORDS TO LOOK AT?
  3142	003522'	254000	003527'		JRST	SWRDR5		;
  3143	003523'	135340	004252'		LDB	T2,[POINT ^D11,(M),^D11] ;GET A COUNT.
  3144	003524'	670340	000032'		TDO	T2,MSKCTU	;MAKE A CORRECT NO.
  3145	003525'	274440	000007		SUB	T4,T2		;ADD IT INTO THE COUNT.
  3146	003526'	344540	003521'		AOJA	M,SWRDR1
  3147	003527'	262040	000006	SWRDR5:	POP	P,T1		;YES.  GET ADDR.
  3148	003530'	262040	000013		POP	P,M		;RESTORE M
  3149	003531'	262040	000007		POP	P,T2		;AND T2.
  3150	003532'	263040	000000		POPJ	P,		;RETURN.
  3151
  3152
  3153				COMMENT %@@SUBROUTINE SDMPCT
  3154				@@PURPOSE SUBR WHICH RETURNS IN DEVBWC THE SUM OF THE WORD/BYTE
  3155				COUNTS BETWEEN THE DATA WORD POINTED TO BY (T1) AND THE
  3156				BEGINNING OF THE UNIT CMD LIST INCLUSIVELY.
  3157				@@ENTRY EXPECTS T3=UNIT DB AND T1 AS STATED UNDER PURPOSE.
  3158				(T1 MUST POINT TO A LOC > 1ST CMD.).
  3159				@@ACCUM DESTROYS NO ACS.
  3160				@@EXIT SEE PURPOSE.
  3161				@@CALLS SWRDRD.
  3162				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL.  @@%
  3163
  3164	003533'	261040	000013	SDMPCT:	PUSH	P,M		;SAVE M.
  3165	003534'	400540	000000		SETZ	M,		;M HOLDS COUNT.
  3166	003535'	307310	000001*	SDMPC2:	CAIG	T1,UNICMD+1(T3)	;AT B OF LIST?
  3167	003536'	254000	003543'		JRST	SDMPC4		;YES.
  3168	003537'	260040	003513'		PUSHJ	P,SWRDRD	;NO.  GET NEXT COUNT.
  3169	003540'	270540	000011		ADD	M,T4		;ADD IT IN.
  3170	003541'	332006	777777		SKIPE	-1(T1)		;Done if no previous command
  3171	003542'	364300	003535'		SOJA	T1,SDMPC2	;SEE IF CONTINUE.
  3172	003543'	272544	001670*	SDMPC4:	ADDM	M,DEVDWC(F)	;DONE.  STORE COUNT IN DEVDWC.
  3173	003544'	262040	000013		POP	P,M		;RESTORE M.
  3174	003545'	263040	000000		POPJ	P,		;RETURN.
  3175
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 47-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3176				COMMENT %@@SUBROUTINE SBUFCT
  3177				@@PURPOSE SUBR WHICH SUMS THE WORD/BYTE COUNTS BETWEEN THE DATA
  3178				WORD POINTED TO BY T1 AND THE PREVIOUS READ CMD, INCLUSIVELY,
  3179				AND STORES IT IN DEVBWC.  ALSO INCREMENTS DEVABC.
  3180				@@ENTRY EXPECTS T3=UNIT DB, T1=ADDR OF A DATA WORD, F=DDB, AND
  3181				S=DEVIOS.
  3182				@@ACCUM DESTROYS NO ACS.
  3183				@@EXIT SEE PURPOSE.
  3184				@@CALLS SWRDRD AND SBUFST.
  3185				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3186
  3187	003546'	261040	000011	SBUFCT:	PUSH	P,T4
  3188	003547'	261040	000006		PUSH	P,T1
  3189	003550'	260040	003513'		PUSHJ	P,SWRDRD	;GET COUNT.
  3190	003551'	260040	003566'		PUSHJ	P,SBUFST	;
  3191	003552'	262040	000006		POP	P,T1
  3192	003553'	262040	000011		POP	P,T4
  3193	003554'	263040	000000		POPJ	P,
  3194
  3195
  3196				COMMENT %@@SUBROUTINE SBUFZR
  3197				@@PURPOSE SUBR WHICH "STORES" A ZERO COUNT FOR THE CURRENT
  3198				BUFFER READ.
  3199				@@ENTRY EXPECTS F=DDB.
  3200				@@ACCUM DESTROYS NO ACS.
  3201				@@FUNCTION STORES 0 VIA DEVBWC. INCS DEVABC.
  3202				@@EXIT SEE FUNCTION.
  3203				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3204
  3205	003555'	261040	000006	SBUFZR:	PUSH	P,T1
  3206	003556'	260040	000463'		PUSHJ	P,BDIO		;DEC PGYDIOS.
  3207	003557'	550304	000014		HRRZ	T1,DEVBWC(F)
  3208	003560'	402006	000000		SETZM	(T1)
  3209	003561'	340300	003562'		AOJ	T1,.+1
  3210	003562'	542304	000014		HRRM	T1,DEVBWC(F)
  3211	003563'	350004	000013		AOS	DEVABC(F)
  3212	003564'	262040	000006		POP	P,T1
  3213	003565'	263040	000000		POPJ	P,
  3214
  3215
  3216				COMMENT %@@SUBROUTINE SBUFST
  3217				@@PURPOSE SUBR WHICH "STORES" (T4) FOR THE CURRENT BUFFER
  3218				READ.
  3219				@@ENTRY EXPECTS F=DDB AND S=DEVIOS.
  3220				@@ACCUM DESTROYS T1.
  3221				@@FUNCTION STORES (T4) VIA DEVBWC.  INCS DEVABC.
  3222				@@EXIT SEE FUNCTION.
  3223				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3224
  3225	003566'	607000	400000	SBUFST:	TLNN	S,COMPAT	;BIT COUNT?
  3226	003567'	254000	003602'		JRST	SBUFS2		;NO, AS IS.
  3227	003570'	261040	000007		PUSH	P,T2		;YES.  SAVE T2.
  3228	003571'	200300	000011		MOVE	T1,T4		;COUNT TO T1.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 47-3
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3229	003572'	231300	000004		IDIVI	T1,4		;T1/WORDS T2/BYTES.
  3230	003573'	221300	000044		IMULI	T1,^D36		;CONVERT TO BITS.
  3231	003574'	322340	003577'		JUMPE	T2,SBUFS1	;JUMP ON NO BYTES.
  3232	003575'	242340	000003		LSH	T2,3		;CONVERT TO BITS.
  3233	003576'	270300	000007		ADD	T1,T2		;SUM TO T1.
  3234	003577'	661300	400000	SBUFS1:	TLO	T1,400000	;TURN ON BIT FLAG BIT.
  3235	003600'	262040	000007		POP	P,T2		;RESTORE T2.
  3236	003601'	200440	000006		MOVE	T4,T1		;SUM TO T4.
  3237	003602'	260040	000463'	SBUFS2:	PUSHJ	P,BDIO		;DEC PGYDIOS.
  3238	003603'	550304	000014		HRRZ	T1,DEVBWC(F)	;
  3239	003604'	202446	000000		MOVEM	T4,(T1)		;STORE THE COUNT.
  3240	003605'	340300	003606'		AOJ	T1,.+1		;INCREMENT TNE
  3241	003606'	542304	000014		HRRM	T1,DEVBWC(F)	;STORAGE ADDRESS.
  3242	003607'	350004	000013		AOS	DEVABC(F)
  3243	003610'	263040	000000		POPJ	P,
  3244
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 48
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3245				COMMENT %@@SUBROUTINE STC12
  3246				@@PURPOSE SUBR TO GENERATE THE 1ST OR 2ND PART OF THE TAPE
  3247				CLEANING SEQUENCE, RESET THE INSIDE ERROR COUNT, AND SET UP
  3248				THE DEV LIST.
  3249				@@ENTRY EXPECTS T3=UNIT DB AND T1=BSR(TC1) OR SKR(TC2).
  3250				@@ACCUM DESTROYS NO ACS.
  3251				@@CALLS SCMGN5 (IN SSMTIC/SREW...SSKTIE).
  3252				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL.  @@%
  3253
  3254	003611'	261040	000013	STC12:	PUSH	P,M
  3255	003612'	261040	000007		PUSH	P,T2
  3256	003613'	200350	003454*		MOVE	T2,UNICMD(T3)	;SET UP A SM AT THE
  3257	003614'	202350	000000*		MOVEM	T2,UNIERO(T3)	;TOP OF THE ERROR SPACE.
  3258	003615'	551540	000004		HRRZI	M,4
  3259	003616'	554344	003007*		HLRZ	T2,DEVER2(F)	;GET PHASE.
  3260	003617'	312300	004253'		CAME	T1,[XWD SKR,0] 	;SET UP TC2?
  3261	003620'	450340	000000		SETCA	T2,		;NO, TC1.
  3262	003621'	602340	000002		TRNE	T2,2
  3263	003622'	340540	003623'		AOJ	M,.+1
  3264	003623'	670304	003321*		TDO	T1,DEVADD(F)	;FINISH PROTOTYPE CMD.
  3265	003624'	261040	000010		PUSH	P,T3		;SAVE T3.
  3266	003625'	202310	000001*		MOVEM	T1,UNIERO+1(T3)
  3267	003626'	340400	000000		AOJ	T3,
  3268	003627'	367540	003625'		SOJG	M,.-2
  3269	003630'	515300	400000		HRLZI	T1,HALT		;GEN AND STORE A
  3270	003631'	202310	000001*		MOVEM	T1,UNIERO+1(T3)	;HALT CMD.
  3271	003632'	262040	000010		POP	P,T3
  3272	003633'	201300	000012		MOVEI	T1,INSERR	;RESET INSIDE ERROR
  3273	003634'	202304	002670*		MOVEM	T1,DEVINS(F)	;COUNT.
  3274	003635'	201310	003614*		MOVEI	T1,UNIERO(T3)
  3275	003636'	262040	000007		POP	P,T2
  3276	003637'	254000	003730'		JRST	SCMGN5		;FINISH UP IN MAIN SUBR.
  3277
  3278
  3279				COMMENT %@@SUBROUTINE SSMTIC/SREW/SBSR/SSTIE/SBSERG/SBSTIE/SSKTIE
  3280				@@PURPOSE SUBR, WITH VARIOUS ENTRY POINTS, WHICH GENERATES
  3281				VARIOUS SEQUENCES OF ERROR RECOVERY AND TAPE POSITIONING.
  3282				THE SEQUENCES ARE ALL OF THE FORM SM/CMD1/..../CMDN/TIC, WHERE
  3283				THE CMDS ARE OPTIONAL AND THE TIC IS TO THE RH(T4).
  3284				ALSO SETS UP THE DEV LIST ENTRY, ETC.
  3285				@@ENTRY EXPECTS T4 AS A POINTER, T3=UNIT DB, P3=UNIT NUMBER, AND F=DDB.
  3286				SCMGN5 IS THE ADDITIONAL ENTRY POINT.
  3287				@@ACCUM DESTROYS ACS T1 AND T4.
  3288				@@CALLS SUBSTI.
  3289				@@RESTRICTION CALLED AT INTERRRUPT LEVEL.S @@%
  3290
  3291	003640'	201300	003645'	SSMTIC:	MOVEI	T1,SSEND	;SM/TIC.
  3292	003641'	254000	003675'		JRST	SCMGN1
  3293
  3294	003642'	201300	003644'	SREW:	MOVEI	T1,.+2		;SM/REW/TIC.
  3295	003643'	254000	003675'		JRST	SCMGN1
  3296	003644'	540034	000000		XWD	REW,0
  3297	003645'	000000	000000	SSEND:	Z
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 48-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3298
  3299	003646'	201300	003650'	SBSR:	MOVEI	T1,.+2		;SM/BSR/TIC.
  3300	003647'	254000	003675'		JRST	SCMGN1
  3301	003650'	540234	000000		XWD	BSR,0
  3302	003651'	000000	000000		Z
  3303
  3304	003652'	201300	003654'	STIE:	MOVEI	T1,.+2		;SM/TIE/TIC.
  3305	003653'	254000	003675'		JRST	SCMGN1
  3306	003654'	162154	000000		XWD	TIE,0
  3307	003655'	000000	000000		Z
  3308
  3309	003656'	201300	003660'	SBSERG:	MOVEI	T1,.+2		;SM/BSR/ERG/TIC.
  3310	003657'	254000	003675'		JRST	SCMGN1
  3311	003660'	540234	000000		XWD	BSR,0
  3312	003661'	540134	000000		XWD	ERG,0
  3313	003662'	000000	000000		Z
  3314
  3315	003663'	201300	003665'	SBSTIE:	MOVEI	T1,.+2		;SM/BSR/TIE/TIC.
  3316	003664'	254000	003675'		JRST	SCMGN1
  3317	003665'	540234	000000		XWD	BSR,0
  3318	003666'	162154	000000		XWD	TIE,0
  3319	003667'	000000	000000		Z
  3320
  3321	003670'	201300	003672'	SSKTIE:	MOVEI	T1,.+2		;SM/SKR/TIE/TIC.
  3322	003671'	254000	003675'		JRST	SCMGN1
  3323	003672'	540334	000000		XWD	SKR,0
  3324	003673'	162154	000000		XWD	TIE,0
  3325	003674'	000000	000000		Z
  3326
  3327	003675'	261040	000013	SCMGN1:	PUSH	P,M		;SAVE M AND
  3328	003676'	261040	000011		PUSH	P,T4		;T4.
  3329	003677'	200550	003613*		MOVE	M,UNICMD(T3)	;GET AND STORE THE
  3330	003700'	202550	003635*		MOVEM	M,UNIERO(T3)	;SM CMD.
  3331	003701'	201550	000001*		MOVEI	M,UNIERO+1(T3)	;M IS POINTER TO ERROR SPACE.
  3332	003702'	200446	000000	SCMGN3:	MOVE	T4,(T1)		;GET NEXT CMD TO GENERATE.
  3333	003703'	322440	003724'		JUMPE	T4,SCMGN4	;END OF LIST?
  3334	003704'	670444	003623*	SCMG33:	TDO	T4,DEVADD(F)	;
  3335	003705'	202453	000000		MOVEM	T4,(M)		;STORE CMD.
  3336	003706'	200446	000000		MOVE	T4,(T1)		;GET CMD AGAIN.
  3337	003707'	312440	004254'		CAME	T4,[XWD TIE,0]	;TIE?
  3338	003710'	254000	003722'		JRST	SCMG35		;NO.
  3339	003711'	554442	002357*		HLRZ	T4,FTXMCH(J)	;YES.  SEE IF A TIE CMD WILL BE
  3340	003712'	602440	000140		TRNE	T4,TRK7!TRK9	;ACCEPTABLE TO THE KONTROLLER.
  3341	003713'	254000	003716'		JRST	.+3		;YES IT WILL.
  3342	003714'	205440	004000		MOVSI	T4,IGNLEN	;NO, IT WILL
  3343	003715'	436453	000000		IORM	T4,(M)		;GIVE LENGTH ERROR.
  3344	003716'	201442	002215*		MOVEI	T4,FTXSTS(J)	;BUILD DATA
  3345	003717'	505440	777700		HRLI	T4,777700	;WORD.
  3346	003720'	271540	000001		ADDI	M,1		;ADJUST PNTR TO ERROR SPACE.
  3347	003721'	202453	000000		MOVEM	T4,(M)		;STORE DATA WORD.
  3348	003722'	340540	003723'	SCMG35:	AOJ	M,.+1		;MOVE DOWN IN ERROR SPACE.
  3349	003723'	344300	003702'	SCMG36:	AOJA	T1,SCMGN3	;POINT TO NEXT REQUEST.
  3350	003724'	262040	000011	SCMGN4:	POP	P,T4		;SET UP
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 48-3
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3351	003725'	661440	200000		TLO	T4,TIC		;THE TIC
  3352	003726'	202453	000000		MOVEM	T4,(M)		;CMD.
  3353	003727'	201310	003700*		MOVEI	T1,UNIERO(T3)	;SET UP THE DEVICE
  3354	003730'	260040	002745'	SCMGN5:	PUSHJ	P,SUBSTI	;LIST ENTRY, ETC.
  3355	003731'	262040	000013		POP	P,M
  3356	003732'	263040	000000		POPJ	P,
  3357
  3358
  3359				COMMENT %@@SUBROUTINE SSKBSR
  3360				@@PURPOSE SUBR TO GENERATE SM/SKR OR BSR/HALT, SET UP THE
  3361				DEVICE LIST ENTRY, AND RESET DEVINS;  FOR VARIOUS TAPE ADJUSTMENTS.
  3362				@@ENTRY EXPECTS T3=UNIT DB, T1= BSR OR SKR, J=KONT DB, AND
  3363				P3=UNIT NO.
  3364				@@ACCUM DESTROYS ACS T1 AND T2.
  3365				@@CALLS SUBSTI.
  3366				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3367
  3368	003733'	670304	003704*	SSKBSR:	TDO	T1,DEVADD(F)	;SKR OR BSR
  3369	003734'	202310	000001*		MOVEM	T1,UNIERO+1(T3)	;CMD.
  3370	003735'	200310	003677*		MOVE	T1,UNICMD(T3)	;SM
  3371	003736'	202310	003727*		MOVEM	T1,UNIERO(T3)	;CMD
  3372	003737'	515300	400000		HRLZI	T1,HALT		;HALT
  3373	003740'	202310	000002*		MOVEM	T1,UNIERO+2(T3)	;CMD.
  3374	003741'	201300	000012		MOVEI	T1,^D10		;SET UP
  3375	003742'	202304	003634*		MOVEM	T1,DEVINS(F)	;RETRY COUNT.
  3376	003743'	201310	003736*		MOVEI	T1,UNIERO(T3)
  3377	003744'	254000	002745'		JRST	SUBSTI
  3378
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 49
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3379				COMMENT %@@SUBROUTINE FSLDPT
  3380				@@PURPOSE "SUBR" (NEVER RETURNS) TO HANDLE HITTING LOAD
  3381				POINT DURING TAPE CLEANING.
  3382				@@ENTRY EXPECTS T2=ADDR OF FAILED CMD+1, M=PHASE OF DC-R RECOVERY,
  3383				F=DDB, J=KONT. DB, P3=UNIT NO., PG=CHAN DB, AND T3=UNIT DB.
  3384				@@ACCUM DESTROYS M,T1,T2, AND T4.
  3385				@@FUNCTION MARK THAT WE SHOULD NOT TAPE CLEAN FOR THIS RECORD.
  3386				GENERATE THE APPROPRIATE TAPE ADJUSTMENT.  SET UP AND GO.
  3387				@@CALLS SUBSTI AND FXDSM1.
  3388				@@RESTRICTIONS @@%
  3389
  3390	003745'	542544	003616*	FSLDPT:	HRRM	M,DEVER2(F)	;TURN OFF TC.
  3391	003746'	515300	540334		HRLZI	T1,SKR		;T1=A SKR
  3392	003747'	670304	003733*		TDO	T1,DEVADD(F)	;CMD.
  3393	003750'	202310	000001*		MOVEM	T1,UNIERO+1(T3)	;AT LEAST 1 NEEDED.
  3394	003751'	275350	000002*		SUBI	T2,UNIERO+2(T3)	;T2=NO. OF BSR'S DONE-1.
  3395	003752'	302540	000011		CAIE	M,11		;PHASE 1 AND
  3396	003753'	302340	000001		CAIE	T2,1		;NEED SKR/BSR?
  3397	003754'	254000	003762'		JRST	FSLDP4		;NO, JUST SKR'S.
  3398	003755'	515300	540234		HRLZI	T1,BSR		;YES.  STORE
  3399	003756'	670304	003747*		TDO	T1,DEVADD(F)	;THE
  3400	003757'	202310	000002*		MOVEM	T1,UNIERO+2(T3)	;BSR.
  3401	003760'	201450	000003*		MOVEI	T4,UNIERO+3(T3)	;HALT.
  3402	003761'	254000	003770'		JRST	FSLDP6
  3403	003762'	306540	000011	FSLDP4:	CAIN	M,11		;PHASE 1?
  3404	003763'	275340	000002		SUBI	T2,2		;YES.
  3405	003764'	201450	000002*		MOVEI	T4,UNIERO+2(T3)	;HERE FOR JUST
  3406	003765'	361340	003770'		SOJL	T2,.+3		;A
  3407	003766'	202311	000000		MOVEM	T1,(T4)		;SEQ. OF
  3408	003767'	344440	003765'		AOJA	T4,.-2		;SKR'S
  3409	003770'	515300	400000	FSLDP6:	HRLZI	T1,HALT		;PLUS
  3410	003771'	202311	000000		MOVEM	T1,(T4)		;HALT.
  3411	003772'	554304	003745*		HLRZ	T1,DEVER2(F)	;PRETEND
  3412	003773'	271300	000010		ADDI	T1,10		;THIS
  3413	003774'	506304	003772*		HRLM	T1,DEVER2(F)	;IS TC2.
  3414	003775'	201300	000012		MOVEI	T1,INSERR	;RESTORE THE INSIDE
  3415	003776'	202304	003742*		MOVEM	T1,DEVINS(F)	;ERROR COUNT.
  3416	003777'	201310	003743*		MOVEI	T1,UNIERO(T3)	;POINT THE
  3417	004000'	260040	002745'		PUSHJ	P,SUBSTI	;DEV LIST,
  3418	004001'	254000	001476'		JRST	FXDSM1		;AND GO.
  3419
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 50
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3420				COMMENT %@@SUBROUTINE SREVRS
  3421				@@PURPOSE SUBR TO REVERSE THE DATA WORDS FROM READING BACKWARDS
  3422				TO READING FORWARDS OR VICE VERSA.
  3423				@@ENTRY EXPECTS J=0 FOR TO BACKWARDS, -1 FOR TO FORWARDS.
  3424				EXPECTS T3=UUNIT DB, F=DDB, AND S=DEVIOS.
  3425				@@ACCUM DESTROYS T1,T2,T4, AND M.
  3426				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3427
  3428	004002'	200310	002731*	SREVRS:	MOVE	T1,UNIDC1(T3)	;T1=
  3429	004003'	340300	004004'		AOJ	T1,.+1		;ADDR OF 1ST DW.
  3430	004004'	550444	003233*		HRRZ	T4,DEVER1(F)	;T4=
  3431	004005'	360440	004006'		SOJ	T4,.+1		;ADDR OF LAST DW.
  3432	004006'	261040	000003		PUSH	P,PG		;SAVE PG.
  3433	004007'	400140	000000		SETZ	PG,		;R HOLDS SUM.
  3434	004010'	135540	004225'	SREVR2:	LDB	M,[POINT ^D11,(T1),^D11] ;DATA
  3435	004011'	135340	004226'		LDB	T2,[POINT ^D24,(T1),^D35] ;WORDS
  3436	004012'	670540	000032'		TDO	M,MSKCTU	;BE REVERSED.
  3437	004013'	261040	000013		PUSH	P,M		;SAVE COUNT.
  3438	004014'	603000	400000		TLNE	S,COMPAT	;WORD
  3439	004015'	242540	777776		LSH	M,-2		;COUNT TO M.
  3440	004016'	271540	000001		ADDI	M,1		;ADJUSTMENT.
  3441	004017'	322100	004022'		JUMPE	J,SREVR3	;ADJUST
  3442	004020'	270340	000013		ADD	T2,M		;THE
  3443	004021'	254000	004023'		JRST	.+2		;MEM
  3444	004022'	274340	000013	SREVR3:	SUB	T2,M		; ADDR.
  3445	004023'	262040	000013		POP	P,M		;RESTORE COUNT.
  3446	004024'	137540	004227'		DPB	M,[POINT ^D11,T2,^D11] ;CREATE NEW DW.
  3447	004025'	202346	000000		MOVEM	T2,(T1)		;STORE ADJUSTED WORD.
  3448	004026'	274140	000013		SUB	PG,M		;SAVE COUNT OF WORDS.
  3449	004027'	305311	000000	SREVR4:	CAIGE	T1,(T4)		;DONE WITH INTERNAL ADJUST?
  3450	004030'	344300	004010'		AOJA	T1,SREVR2	;NO.
  3451	004031'	200310	004002*		MOVE	T1,UNIDC1(T3)	;YES, RESTORE
  3452	004032'	340300	004033'		AOJ	T1,.+1		;T1=ADDR OF 1ST DW.
  3453	004033'	607000	400000		TLNN	S,COMPAT	;SET
  3454	004034'	606140	000001		TRNN	PG,1		;BIT
  3455	004035'	254000	004040'		JRST	SREVR7		;7 OF CMD TO
  3456	004036'	515540	002000		HRLZI	M,2000		;WORD MODE AND
  3457	004037'	436546	777777		IORM	M,-1(T1)	;ODD NO. OF WORDS.
  3458	004040'	200546	000000	SREVR7:	MOVE	M,(T1)		;EXCH
  3459	004041'	250551	000000		EXCH	M,(T4)		;THE
  3460	004042'	202546	000000		MOVEM	M,(T1)		;WORDS.
  3461	004043'	340300	004044'		AOJ	T1,.+1		;ADJUST PNTR.
  3462	004044'	305311	000000		CAIGE	T1,(T4)		;DONE?
  3463	004045'	364440	004040'		SOJA	T4,SREVR7	;NO.
  3464	004046'	550444	004004*		HRRZ	T4,DEVER1(F)	;YES.  TURN
  3465	004047'	515140	400000		HRLZI	PG,LASDAT	;ON THE LAST
  3466	004050'	436151	777777		IORM	PG,-1(T4)	;DATA FLAG.
  3467	004051'	262040	000003		POP	P,PG		;RESTORE PG.
  3468	004052'	263040	000000		POPJ	P,
  3469
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 51
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3470				COMMENT %@@SUBROUTINE SLENER
  3471				@@PURPOSE SUBR CALLED ON LENGTH ERROR.
  3472				IF TAPE > REQUEST, RETURNS T4/REQUEST.
  3473				"   "   <    "   ,    "    T4/TAPE AND SKIP RETURNS.
  3474				@@ENTRY EXPECTS T3=UNIT DB AND U=4 WORD AREA ADDR+1.
  3475				@@ACCUM DESTROYS NO ACS.
  3476				@@EXIT SEE PURPOSE.
  3477				@@CALLS SGDEV1, SGPREV, SWRDRD, AND CPOPJ1.
  3478				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3479
  3480
  3481	004053'	261040	000006	SLENER:	PUSH	P,T1		;SAVE T1
  3482	004054'	261040	000007		PUSH	P,T2		;AND T2.
  3483	004055'	135340	004255'		LDB	T2,[POINT ^D12,1(U),^D11] ;GET COUNT.
  3484	004056'	260040	003471'		PUSHJ	P,SGDEV1	;GET T4=NEXT CMD ADDR.
  3485	004057'	550305	000001		HRRZ	T1,1(U)		;TAPE >REQUEST OR
  3486	004060'	301311	000000		CAIL	T1,(T4)		;REQ>TAPE?
  3487	004061'	322340	004101'		JUMPE	T2,SLTGR	;JUMP ON TAPE>REQ.
  3488
  3489				    ;HERE ON TAPE < REQUEST.
  3490	004062'	322340	004064'		JUMPE	T2,.+2		;MAKE STATUS COUNT
  3491	004063'	670340	000032'		TDO	T2,MSKCTU	;CORRECT NUMBER.
  3492	004064'	260040	003451'		PUSHJ	P,SGPREV	;T4=PREVIOUS CMD.
  3493	004065'	275300	000002		SUBI	T1,2		;T1=ADDR OF 1ST DW BEFORE FAILED DW.
  3494	004066'	307311	000000		CAIG	T1,(T4)		;ONE THERE?
  3495	004067'	634440	000011		TDZA	T4,T4		;NO.  T4 COUNT =0.
  3496	004070'	260040	003513'	SLTLR1:	PUSHJ	P,SWRDRD	;T4=COUNT EXCEPT FOR FAILED DW.
  3497	004071'	550305	000001		HRRZ	T1,1(U)		;GET
  3498	004072'	135300	004256'		LDB	T1,[POINT ^D11,-1(T1),^D11] ;THE
  3499	004073'	670300	000032'		TDO	T1,MSKCTU	;COUNT
  3500	004074'	274300	000007	SLTLR4:	SUB	T1,T2		;LAST COUNT - LEFT OVER.
  3501	004075'	274440	000006		SUB	T4,T1		;BEFORE + THIS = TOTAL.
  3502	004076'	262040	000007		POP	P,T2		;RESTORE T2
  3503	004077'	262040	000006		POP	P,T1		;AND T1
  3504	004100'	254000	000550*		JRST	CPOPJ1		;SKIP RETURN.
  3505
  3506				    ;HERE ON TAPE > REQUEST.
  3507	004101'	360300	004102'	SLTGR:	SOJ	T1,.+1		;POINT T1 TO THE LAST DATA WORD.
  3508	004102'	260040	003513'		PUSHJ	P,SWRDRD	;T4=REQUEST.
  3509	004103'	262040	000007		POP	P,T2		;RESTORE T2
  3510	004104'	262040	000006		POP	P,T1		;AND T1.
  3511	004105'	263040	000000		POPJ	P,		;RETURN.
  3512
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 52
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3513				COMMENT %@@SUBROUTINE SNEW
  3514				@@PURPOSE SUBR TO GENERATE AN ERROR PROCEDURE, WHEN NO OLD
  3515				ERROR PROCEDURES MATTER.
  3516				@@ENTRY EXPECTS ERROR FLAG IN T2, T3=UNIT DB, P3=UNIT NUMBER,
  3517				U=ADDR OF 4 WORD AREA+1, J=KONT DB, AND F=DDB.
  3518				SNEW4 IS AN ADDITIONAL ENTRY POINT.
  3519				@@ACCUM DESTROYS T1, T2, AND T4.
  3520				@@FUNCTION DETERMINES WHOCH CMDS TO SET UP IN THE UNIT'S
  3521				ERROR SPACE, AND SETS THEM UP.
  3522				@@EXIT SEE FUNCTION.
  3523				@@CALLS SGPREV, SBSERG, SREW, SBSTIE, SSKTIE, SSMTIC, SBSR, AND SUBSTI.
  3524				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3525
  3526				IF2,<PRINTX [Should use BMX pointer if async error status]>
  3527	004106'	550305	000001	SNEW:	HRRZ	T1,1(U)		;SET UP T4 FOR THE CMD
  3528				;22-Jun-87 - crash dump on F38 shows that SA10 may leave garbage at 1(U)
  3529	004107'	260040	003451'		PUSHJ	P,SGPREV	;GENERATORS TO TIC TO.
  3530	004110'	305340	000016		CAIGE	T2,ERWWTM
  3531	004111'	254000	004122'		JRST	SNEW2
  3532
  3533	004112'	306340	000016		CAIN	T2,ERWWTM
  3534	004113'	254000	003656'		JRST	SBSERG		;DATA CHECK-WRT OR WTM(14).
  3535	004114'	306340	000020		CAIN	T2,ERIDBR
  3536	004115'	254000	003642'		JRST	SREW		;ID BURST CHECK(16).
  3537	004116'	554344	003774*		HLRZ	T2,DEVER2(F)	;GET PHASE.
  3538	004117'	306340	000001		CAIN	T2,1		;PHASE 1 BSR,
  3539	004120'	254000	003663'		JRST	SBSTIE		;PHASES
  3540	004121'	254000	003670'		JRST	SSKTIE		;2 AND 3 SKR.
  3541
  3542				    ;HERE WITH MEM ERR(10), BUS OUT CHECK(11), OVERRUN(12), OR
  3543				    ;DATA CHECK-ERG(13).
  3544	004122'	306340	000015	SNEW2:	CAIN	T2,ERDCER	;DC-ERG?
  3545	004123'	254000	004136'		JRST	SNEW4		;YES.
  3546	004124'	554544	003473*		HLRZ	M,DEVFNJ(F)	;NO.  GET FN IN PROGRESS.
  3547	004125'	302340	000013		CAIE	T2,ERBSOU	;BUS OUT?
  3548	004126'	254000	004134'		JRST	SNEW31		;NO.
  3549	004127'	200345	000000		MOVE	T2,(U)		;YES,  BUS OUT.  GET STATUS WORD.
  3550	004130'	603340	000020		TLNE	T2,DEVEND	;DEVICE END
  3551	004131'	302540	000013		CAIE	M,FNPWRT	;AND WRITING?
  3552	004132'	254000	003640'		JRST	SSMTIC		;NO.
  3553	004133'	254000	003646'		JRST	SBSR		;YES, NEED TO BACKSPACE.
  3554	004134'	301540	000012	SNEW31:	CAIL	M,FNPRED	;HERE ON MEM ERR AND OVRN.
  3555	004135'	254000	003646'		JRST	SBSR		;BACKSPACE IF READ/WRITE.
  3556	004136'	201310	003735*	SNEW4:	MOVEI	T1,UNICMD(T3)	;HERE ON TRY AGAIN.
  3557	004137'	254000	002745'		JRST	SUBSTI
  3558
  3559
  3560				COMMENT %@@SUBROUTINE SMOD
  3561				@@PURPOSE SUBR TO GEN AN ERROR PROCEDURE WHEN THE OLD ERROR
  3562				PROCEDURE MATTERS.
  3563				@@ENTRY EXPECTS U=ADDR OF 4 WORD AREA+1, T3=UNIT DB,
  3564				P3=UNIT NUMBER, J=KONT DB, AND F=DDB.
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 52-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3565				@@ACCUM DESTROYS T1, T2, AND T4.
  3566				@@CALLS SUBSTI.
  3567				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3568				;THE NEW ERRORS THAT CAN OCCUR IN ERR SPACE ARE MEM ERR, BUS OUT,
  3569				;OVRN, AND DC-ERG.  ALL OF THESE UNDER THESE CIRCUMSTANCES JUST
  3570				;RETRY.
  3571
  3572	004140'	550345	000001	SMOD:	HRRZ	T2,1(U)		;GET ADDR OF
  3573	004141'	360340	004142'		SOJ	T2,.+1		;FAILED CMD.
  3574	004142'	307350	003777*		CAIG	T2,UNIERO(T3)	;NEED TO REARRANGE ERR SPACE?
  3575	004143'	254000	004136'		JRST	SNEW4		;NO.
  3576	004144'	201310	000001*		MOVEI	T1,UNIERO+1(T3)	;YES.
  3577	004145'	200447	000000		MOVE	T4,(T2)		;MOVE UP THE CMDS
  3578	004146'	202446	000000	SMOD2:	MOVEM	T4,(T1)		;UNTIL HALT OR TIC
  3579	004147'	340340	004150'		AOJ	T2,.+1		;IS SEEN (BOTH HAVE
  3580	004150'	200447	000000		MOVE	T4,(T2)		;EXECUT
  3581	004151'	603440	100000		TLNE	T4,EXECUT	;=0).
  3582	004152'	344300	004146'		AOJA	T1,SMOD2	;NOT SEEN YET.
  3583	004153'	202446	000001		MOVEM	T4,1(T1)	;STORE HALT/TIC.
  3584	004154'	201310	004142*		MOVEI	T1,UNIERO(T3)	;SET UP DEV LIST TO POINT TO THE
  3585	004155'	254000	002745'		JRST	SUBSTI		;TOP OF ERROR SPACE.
  3586
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 53
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3587				COMMENT %@@SUBROUTINE SNOISE
  3588				@@PURPOSE SUBR TO DETERMINE IF THE RECORD WE JUST GOT A
  3589				DC-R ON WAS A NOISE RECORD.
  3590
  3591				IF NOT A NOISE RECORD, NORMAL RETURN.
  3592				IF A NOISE RECORD, SKIP RETURN WITH DECREMENTED DEVNOI IN
  3593				T1.
  3594				@@ENTRY EXPECTS T3=UNIT DB, F=DDB, J=KONT DB, AND U=ADDR OF 4
  3595				WORD AREA+1.
  3596				@@ACCUM DESTROYS T1 AND T4.
  3597				@@FUNCTION CALL SNOICT TO GET A COUNT OF THE BYTES READ. THE
  3598				RECORD IS A NOISE RECORD IF THE COUNT IS LESS THAN 12 AND
  3599				THE NOISE BIT IS NOT SET.
  3600				@@EXIT SEE PURPOSE.
  3601				@@CALLS SNOICT, CPOPJ, AND CPOPJ1.
  3602				@@RESTRICTIONS @@%
  3603
  3604
  3605	004156'	260040	004165'	SNOISE:	PUSHJ	P,SNOICT	;GET COUNT TO T4 IN BYTES.
  3606	004157'	301440	000014		CAIL	T4,^D12		;POSSIBLE NOISE RECORD?
  3607	004160'	263040	000000		POPJ	P,		;NO.
  3608	004161'	135440	000014'		LDB	T4,BYKNOI	;YES.
  3609	004162'	326440	000646*		JUMPN	T4,CPOPJ	;NOISE BIT SET?
  3610	004163'	370304	003221*		SOS	T1,DEVNOI(F)	;NO.
  3611	004164'	254000	004100*		JRST	CPOPJ1
  3612
  3613
  3614				COMMENT %@@SUBROUTINE SNOICT
  3615				@@PURPOSE SUBR TO CALC THE NUMBER OF BYTES ACTUALLY READ
  3616				OR WRITTEN FOR THIS COMMAND AND RETURN THE COUNT IN T4.
  3617				@@ENTRY EXPECTS T3=UNIT DB AND U=ADDR OF 4 WORD AREA+1.
  3618				@@ACCUM DESTROYS T1.
  3619				@@EXIT SEE PURPOSE.
  3620				@@CALLS SWRDRD.
  3621				@@RESTRICTIONS CALLED AT INTERRUPT LEVEL. @@%
  3622	004165'	550305	000001	SNOICT:	HRRZ	T1,1(U)		;GET COUNT
  3623	004166'	360300	004167'		SOJ	T1,.+1		;OF
  3624	004167'	260040	003513'		PUSHJ	P,SWRDRD	;WORDS
  3625	004170'	135300	004255'		LDB	T1,[POINT ^D12,1(U),^D11] ;OR
  3626	004171'	322300	004174'		JUMPE	T1,.+3		;BYTES THAT
  3627	004172'	670300	000032'		TDO	T1,MSKCTU	;WERE
  3628	004173'	270440	000006		ADD	T4,T1		;READ.
  3629	004174'	607000	400000		TLNN	S,COMPAT	;IF THIS WAS WORD MODE,
  3630	004175'	240440	000002		ASH	T4,2		;CONVERT TO A BYTE COUNT.
  3631	004176'	263040	000000		POPJ	P,		;RETURN.
  3632
  3633	004177'	341006	000000		$END	(FTA)

  3634	004200'	300406	000000

  3635	004201'	262040	000007

  3636	004202'	254000	000136'
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 53-2
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.


  3637	004203'	140304	003756*

  3638	004204'	300407	000000

  3639	004205'	262040	000011

  3640	004206'	263040	000000

  3641	004207'	260040	000000*

  3642	004210'	556441	565142

  3643	004211'	000002	000000

  3644	004212'	111500	000006

  3645	004213'	200313	000000

  3646	004214'	202313	000000

  3647	004215'	550253	000000

  3648	004216'	476013	000001

  3649	004217'	202313	000001

  3650	004220'	554353	000000

  3651	004221'	251307	000000

  3652	004222'	410200	000006

  3653	004223'	100000	020000

  3654	004224'	140300	000006

  3655	004225'	301306	000000

  3656	004226'	003006	000000

  3657	004227'	301300	000007

  3658	004230'	100000	002000

  3659	004231'	430102	002133*

  3660	004232'	430103	002370*

  3661	004233'	140302	002026*

  3662	004234'	141004	004203*

FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 53-3
FTASER.MAC	25-NOV-87 15:39		UTILITY SUBROUTINES.

  3663	004235'	341007	000000

  3664	004236'	300411	000000

  3665	004237'	241000	000006

  3666	004240'	070200	000000

  3667	004241'	260040	004207*

  3668	004242'	556441	645567

  3669	004243'	000002	000000

  3670	004244'	261600	000013

  3671	004245'	301307	000000

  3672	004246'	261606	000000

  3673	004247'	260040	000000*

  3674	004250'	466441	434643

  3675	004251'	000005	004162*

  3676	004252'	301313	000000

  3677	004253'	540334	000000

  3678	004254'	162154	000000

  3679	004255'	301405	000001

  3680	004256'	301306	777777

  3681						;End of FTASER (FTALIT: FTAEND:)
  3682
NO ERRORS DETECTED
PROGRAM BREAK IS 004257
8K CORE USED
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 54
FTASER.MAC	25-NOV-87 15:39		SYMBOL TABLE

ASYNCH		400000	SPD	DDI	777777	777777	SIN	EREQCK	777777	777774	SPD	FFUGF3		000560'	
ATTN		001000	SPD	DDINT		000001	SIN	ERG		540134	SPD	FFUS1		000572'	
BDIO		000463'		DDO	777777	777776	SIN	ERIDBR		000020	SPD	FFUS2		000577'	
BMX		400000	SPD	DDXZ		000000	SIN	ERINRQ	777777	777773	SPD	FFUSEN		000571'	
BSR		540234	SPD	DECDI2		000451'		ERMEMR		000012	SPD	FFUSTO		000567'	
BUFKRN		000504'		DECDIO		000443'		ERNTCP	777777	777771	SPD	FHGSTP		003025'	
BUSIN		040000	SPD	DEV40		002665'	EXT	EROVRN		000014	SPD	FICHAN		000303'	
BUSOUT		100000	SPD	DEVABC		000013	SIN	ERPRGI		000021	SPD	FIDIE		000136'	
BUSY		000100	SPD	DEVACT		002774'	EXT	ERSELE	777777	777777	SPD	FIDIE2		000145'	
BYK160		000020'		DEVADD		004234'	EXT	ERSPBY	777777	777770	SPD	FIFLAG		000304'	
BYKIDB		000017'		DEVBWC		000014	SIN	ERWWTM		000016	SPD	FIGO		000117'	
BYKLDP		000015'		DEVCLS		000011	SIN	EXECUT		100000	SPD	FIGTN2		000264'	
BYKMDL		000021'		DEVCNT		003305'	EXT	F		000004	INT	FIGTNX		000263'	
BYKNOI		000014'		DEVDIO		000775'	EXT	FCMRD0		001576'		FIKONT		000302'	
BYKNTC		000016'		DEVDWC		003543'	EXT	FCMRD1		001600'		FILOOK		000147'	
BYUDUL		000010'		DEVEND		000020	SPD	FCMRD2		001607'		FINOUT		000274'	
BYUK62		000012'		DEVER1		004046'	EXT	FCMRDA		001332'		FINXKN		000063'	
BYUK79		000013'		DEVER2		004116'	EXT	FCMWR4		001564'		FINXUN		000103'	
BYULDP		000004'		DEVFNJ		004124'	EXT	FCMWRT		001562'		FIRTCN		000305'	
BYUMDL		000011'		DEVINS		003776'	EXT	FDCNI1		002452'	EXT	FIRTR2		000176'	
BYUTAB		000005'		DEVIOS		000002	SIN	FDCNIE		002717'	EXT	FIRTR4		000200'	
BYUTIN		000007'		DEVNAM		000000	SIN	FDERBT		002376'	EXT	FIRTRY		000160'	
BYUUN7		000003'		DEVNOI		004163'	EXT	FDHCNI		000413'	EXT	FISEK2		000214'	
BYUWPT		000006'		DEVOUT		002515'	EXT	FDHCNT		000406'	EXT	FISEKN		000204'	
CHNACT		002773'	EXT	DEVSTS		000012	SIN	FDHFUN		000427'	EXT	FISETU		000223'	
CHNBMX		000074'	EXT	DEVUDB		003231'	EXT	FDMEMR		002204'	EXT	FIST94		000254'	
CHNCLR		001474'	EXT	DGF		000015	SIN	FDNRE1		002442'	EXT	FIST9T		000244'	
CHNEND		000040	SPD	DGTRD		000013	SIN	FDNREE		002715'	EXT	FISTO0		000260'	
CHNGO		003021'	EXT	DHNG		000005	SIN	FDNWR1		000000	EXT	FISTOT		000261'	
CHNIIE		003020'	EXT	DIE		004241'	EXT	FDNWRE		000000	EXT	FIUNIT		000301'	
CHNMER		002203'	EXT	DIN		000011	SIN	FDSCHR		000230'	EXT	FIWAIT		000132'	
CHNSTB		004232'	EXT	DINI		000004	SIN	FDSENS		001746'	EXT	FNPBSF		000010	SPD
CLERSA		400000	SPD	DMT		000014	SIN	FEPFS1		002452'		FNPBSR		000004	SPD
CLRMER		200000	SPD	DOU		000010	SIN	FEPFS4		002471'		FNPERG		000006	SPD
CMDCHN		040000	SPD	DR		000016	SIN	FEPL04		002537'		FNPRED		000012	SPD
CMDREJ		400000	SPD	DRL		000006	SIN	FEPL06		002545'		FNPREW		000001	SPD
CNEXNO		540000	SPD	DS1600		000010	SPD	FEPL32		002625'		FNPRWU		000005	SPD
CNTLER		020000	SPD	DS200		000001	SPD	FEPL33		002643'		FNPSKF		000007	SPD
CNVCHK		002000	SPD	DS556		000002	SPD	FEPL42		002660'		FNPSKR		000003	SPD
COMPAT		400000	SPD	DS6250		000020	SPD	FEPL45		002665'		FNPUGF		000011	SPD
CPOPJ		004251'	EXT	DS800		000004	SPD	FEPL51		002715'		FNPWRT		000013	SPD
CPOPJ1		004164'	EXT	DSKPIF		000353'	EXT	FEPL52		002724'		FNPWTM		000002	SPD
CPUKI		000001	SPD	DSKPIN		000432'	EXT	FEPMOD		002552'		FRCINT		010000	SPD
CPUKL		000002	SPD	DSPSIZ		000015	SPD	FEPNEW		002511'		FSLDP4		003762'	
CPUTYP		000002	SPD	DVSIZ		000003	SIN	FEPOL2		002554'		FSLDP6		003770'	
CPZZ		000000	SPD	DZAP		000012	SIN	FEPOL3		002605'		FSLDPT		003745'	
CUEND		000200	SPD	EQPCHK		040000	SPD	FEPOL4		002647'		FSTHNG		003023'	
D		000017	SIN	ERBSIN	777777	777776	SPD	FEPOL5		002706'		FT1CM2		000720'	
DATASZ		000033'		ERBSOU		000013	SPD	FEPOLD		002513'		FT1CMD		000716'	
DATCHK		020000	SPD	ERCMRJ	777777	777772	SPD	FFUAR1		000605'		FT1TBL		000022'	
DBYT		000002	SIN	ERCNSN	777777	777767	SPD	FFUAR2		000616'		FT7SPC		000677'	
DCL		000007	SIN	ERCNTL	777777	777775	SPD	FFUERR		000555'		FT9TRK		000703'	
DDI	777777	777777	SIN	ERDCER		000015	SPD	FFUGF2		000557'		FTA0CB		000060'	EXT
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 54-2
FTASER.MAC	25-NOV-87 15:39		SYMBOL TABLE

FTA0DB		000525'	EXT	FTXSS1		002014'	EXT	FXPRG1		002000'		IO		000020	SIN
FTACFC		003456'	INT	FTXSS2		002016'	EXT	FXPRG2		002003'		IOACT		010000	SIN
FTACL6		000340'		FTXSTS		003716'	EXT	FXPRGI		001765'		IOBEG		000002	SIN
FTACL7		000341'		FTXSX1		001151'	EXT	FXRW10		001646'		IOBKTL		040000	SIN
FTACL8		000345'		FXBS63		002105'		FXRW11		001651'		IOBOT		004000	SIN
FTACLS		000321'		FXBS64		002116'		FXRW12		001661'		IODEND		020000	SIN
FTADDS		000041'	EXT	FXBS65		002123'		FXRW13		001672'		IODERR		200000	SIN
FTADSP		000036'	INT	FXBSY1		002042'		FXRW15		001700'		IODTER		100000	SIN
FTAEND		004256'	INT	FXBSY2		002050'		FXRW16		001707'		IOEND		000040	SIN
FTAGRD		001141'		FXBSY3		002065'		FXRW2		001567'		IOIMPM		400000	SIN
FTAHC2		000374'		FXBSY4		002075'		FXRW5		001611'		IOLEND		100000	SPD
FTAHCT		000372'		FXBSY6		002077'		FXRW7		001630'		IONRCK		000100	SIN
FTAHN4		000376'		FXBSY7		002127'		FXRW8		001636'		IOPAR		001000	SIN
FTAHN8		000406'		FXBUSY		002040'		FXRW9		001640'		IOSTBL		000010	SIN
FTAHN9		000426'		FXDSM1		001476'		FXRWC2		001615'		IOTEND		002000	SIN
FTAHNG		000353'		FXDSM2		001473'		FXRWCN		001614'		IOW		000001	SIN
FTAINI		000054'		FXER0		002367'		FXSNC0		001743'		J		000002	INT
FTALIT		004177'	INT	FXER00		002215'		FXSNC1		001741'		JBTIOA		001020'	EXT
FTAPE		000644'		FXER01		002225'		FXSNC2		001745'		JBTLIC		000546'	EXT
FTARED		000771'		FXER02		002243'		FXSNC4		001751'		KONBMX		002777'	EXT
FTAREL		000313'		FXER03		002250'		FXSTOP		001465'		KONBSU		001043'	EXT
FTARW3		001004'		FXER04		002301'		FXSTP0		001464'		KONPTR		001153'	EXT
FTARW5		001026'		FXER05		002305'		FXUCG1		002025'		LASDAT		400000	SPD
FTASER		000000'	ENT	FXER06		002322'		FXUCGO		002012'		LENERR		004000	SPD
FTAUGF		000552'		FXER07		002357'		FXWN21		001341'		LICSPY		200000	SIN
FTAWRT		000772'		FXER08		002365'		FXWN22		001354'		LICSYS		040000	SIN
FTCMLN		003156'	EXT	FXER09		002366'		FXWN23		001362'		LOADPT		040000	SPD
FTDIE		000675'		FXER1		001713'		FXWN25		001376'		M		000013	INT
FTDVF2		000527'		FXER11		001730'		FXWN26		001413'		MEMERR		300000	SPD
FTDVF5		000536'		FXER16		002416'		FXWN28		001424'		MODE7		200000	SPD
FTDVF7		000543'		FXER21		002425'		FXWN32		001436'		MODE7I		020000	SPD
FTLEO4		000753'		FXER22		002434'		FXWN44		001300'		MODE9D		220000	SPD
FTLEOT		000750'		FXER23		002437'		FXWN57		001315'		MODE9I		020000	SPD
FTOUT		000714'		FXER62		002340'		FXWNA2		001450'		MODEL1		000001	SPD
FTOUT0		000710'		FXER64		002347'		FXWNAJ		001444'		MODEL2		000002	SPD
FTP2		000647'		FXER65		002352'		FXWNP4		001441'		MS7T2		540114	SPD
FTP6		000670'		FXERC6		001224'		FXWNP5		001443'		MS7T5		540514	SPD
FTPTBL		000634'		FXERCK		001217'		FXWNP6		001446'		MS7T8		541114	SPD
FTSKB2		000733'		FXEREP		002445'		FXWNP7		002627'		MS7TE2		540214	SPD
FTSKB4		000741'		FXEROR		002175'		FXWON		001240'		MS7TE5		540614	SPD
FTSKBS		000730'		FXERR1		002205'		FXWON0		001254'		MS7TE8		541214	SPD
FTULNH		000544'	EXT	FXERR2		002207'		FXWON1		001261'		MS7TO2		540314	SPD
FTXBSY		002127'	EXT	FXMT0		001523'		FXWON2		001324'		MS7TO5		540714	SPD
FTXIN1		001164'		FXMT00		001517'		FXWON3		001427'		MS7TO8		541314	SPD
FTXIN2		001167'		FXMT2		001511'		FXWON4		001270'		MS9T16		541414	SPD
FTXIN4		001210'		FXMT6		001527'		FXWON5		001303'		MS9T62		541514	SPD
FTXINT		001147'	INT	FXMT7		001543'		HALT		400000	SPD	MS9T8		541454	SPD
FTXMCH		003711'	EXT	FXMTSN		001532'		HNGFTA		200000	SPD	MSKCTD		000031'	
FTXSM0		002020'	EXT	FXNMMT		001500'		HNGSTP		003034'	EXT	MSKCTU		000032'	
FTXSMY		004231'	EXT	FXNMRW		001545'		IBMCMP		010000	SPD	MSKMMD		777760	SPD
FTXSNS		004233'	EXT	FXNRML		001453'		IGNLEN		004000	SPD	MSKMMU		777700	SPD
FTXSP1		001165'	EXT	FXPHG2		001417'		INSERR		000012	SPD	MTANIB		000472'	INT
FTXSPR		001164'	EXT	FXPHGO		001414'		INTREQ		200000	SPD	MTATMW		003157'	INT
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 54-3
FTASER.MAC	25-NOV-87 15:39		SYMBOL TABLE

NODIE		004247'	EXT	SBUFST		003566'		SGPRV2		003457'		SUBSM2		003107'	
NOISE		000017	SPD	SBUFZR		003555'		SGPRV3		003463'		SUBSM4		003114'	
NOMXFR		400000	SPD	SCLRCH		000306'		SGPRV4		003467'		SUBSM6		003124'	
OFFSET		002000	SPD	SCMBF0		003151'		SGTDEV		001034'		SUBSMT		003122'	
OUT		000000	EXT	SCMBF1		003154'		SGTDV4		001064'		SUBSOT		003110'	
OUTERR		000017	SPD	SCMBF2		003165'		SGTDV5		001072'		SUBST1		003063'	
OUTPB		004000	SIN	SCMBF3		003167'		SKR		540334	SPD	SUBSTB		003060'	
OVERUN		010000	SPD	SCMD25		003212'		SLENER		004053'		SUBSTI		002745'	
P		000001	INT	SCMD75		003254'		SLTGR		004101'		SUBTRM		002753'	
P1		000014	INT	SCMD84		003302'		SLTLR1		004070'		SWRDR1		003521'	
P3		000016	INT	SCMDR1		003201'		SLTLR4		004074'		SWRDR5		003527'	
PAGWAK		000513'	EXT	SCMDR2		003204'		SMOD		004140'		SWRDRD		003513'	
PG		000003	INT	SCMDR3		003213'		SMOD2		004146'		SYDCOM		000551'	EXT
PGYDIO		000511'	EXT	SCMDR4		003221'		SNEW		004106'		SYDFTA		000520'	INT
PIOMOD		003322'	EXT	SCMDR6		003233'		SNEW2		004122'		SYDNM4		000540'	EXT
PJOBN		001017'	EXT	SCMDR7		003235'		SNEW31		004134'		T1		000006	INT
PJRST	324740	000000		SCMDR8		003264'		SNEW4		004136'		T2		000007	INT
PRGINT		002000	SPD	SCMFIN		003306'		SNOICT		004165'		T3		000010	INT
PWAIT1		001123'	EXT	SCMFN0		003305'		SNOISE		004156'		T4		000011	INT
PX.MEM		000004	SPD	SCMFN2		003311'		SREVR2		004010'		TAPEIN		020000	SPD
PXCT	256000	000000		SCMG33		003704'		SREVR3		004022'		TBLBSR		000025'	
READBK		000014	SPD	SCMG35		003722'		SREVR4		004027'		TBLERG		000027'	
READFW		140010	SPD	SCMG36		003723'		SREVR7		004040'		TBLREW		000022'	
READY		000002	SPD	SCMGN1		003675'		SREVRS		004002'		TBLRWU		000026'	
REW		540034	SPD	SCMGN3		003702'		SREW		003642'		TBLSKR		000024'	
REWNCH		500034	SPD	SCMGN4		003724'		SSEND		003645'		TBLTIE		000030'	
REWUNL		540074	SPD	SCMGN5		003730'		SSKBSR		003733'		TBLWTM		000023'	
RWUNCH		500074	SPD	SCOMBF		003147'		SSKTIE		003670'		TERMDV		000017	SPD
S		000000	INT	SCOMBL		003127'		SSMTIC		003640'		TIC		200000	SPD
S$ENTR	777777	777775	SIN	SCOMDR		003175'		SSTAL0		002151'		TIE		162154	SPD
S$EVEN		000006	SIN	SDCIO2		000436'		SSTAL2		002135'		TRK7		000040	SPD
S$HALT	777777	777777	SIN	SDCIO3		000440'		SSTALL		002132'		TRK9		000100	SPD
S$INFO		000005	SIN	SDCIO4		000441'		SSTONE		002141'		TUA		200000	SPD
S$JOB		000002	SIN	SDCIOA		000434'		STAMOD		000400	SPD	TUB		100000	SPD
S$NAME		000000'	SPD	SDMPC2		003535'		STC12		003611'		U		000005	INT
S$NONA		000000	SIN	SDMPC4		003543'		STIE		003652'		UNICMD		004136'	EXT
S$PATC		000007	SIN	SDMPCT		003533'		STOCM4		003334'		UNIDC1		004031'	EXT
S$TEMP	000005	000000	SPD	SDTCAL		003413'		STOCM6		003337'		UNIDCN		002734'	EXT
S$XCT	777777	777776	SIN	SDTCL1		003416'		STOCMD		003317'		UNIDCR		002725'	EXT
SAJSNS		002165'		SDTCL2		003424'		STOD15		003363'		UNIDDB		001167'	EXT
SAVA45		001113'		SDTCL3		003434'		STODAT		003347'		UNIDON		003455'	EXT
SAVAIL		001077'		SDTCL4		003446'		STODS1		003356'		UNIERO		004154'	EXT
SAVAL2		001103'		SELERR		100000	SPD	STODS2		003372'		UNIKNT		003017'	EXT
SAVAL4		001107'		SENSE		160020	SPD	STODS4		003403'		UNILNK		000537'	EXT
SAVAL5		001114'		SETHNG		003024'	EXT	STODTS		003355'		UNISX1		001171'	EXT
SAVAL6		001133'		SETIOD		002010'	EXT	STRTDV		000015	SPD	UNISX2		001173'	EXT
SAVAL8		001137'		SFISKN		000206'		SUBRG1		003017'		UNISX3		001175'	EXT
SBSERG		003656'		SFISUN		000230'		SUBRG2		003014'		UNITCK		000010	SPD
SBSR		003646'		SGDEV1		003471'		SUBRGO		003016'		UNITEX		000004	SPD
SBSTIE		003663'		SGDEV2		003500'		SUBRS0		002761'		UNITYP		003325'	EXT
SBUFCT		003546'		SGDEV3		003503'		SUBRSM		003066'		W		000012	INT
SBUFS1		003577'		SGDEV5		003511'		SUBRSN		003045'		WAIT1		001056'	EXT
SBUFS2		003602'		SGPREV		003451'		SUBRST		002760'		WRITE		144004	SPD
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88 PAGE 54-4
FTASER.MAC	25-NOV-87 15:39		SYMBOL TABLE

WRPI	700600	000000		
WRPROT		400000	SPD	
WTM		540174	SPD	
ZZ		425464	SPD	

FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

ASYNCH	   252#	  1441	  2052
ATTN	   258#	   584
BDIO	   902#	  1241	  1545	  1787	  1958	  3206	  3237
BMX	   240#	   531
BSR	   213#	   351	  1675	  2494	  3301	  3311	  3317	  3398
BUFKRN	   875	   910	   927#	   937
BUSIN	   254#	   584	  1485	  1924	  2053	  2131
BUSOUT	   271#	  2147
BUSY	   261#	   584	   592	  1459	  1485	  1905
BYK160	   318#
BYKIDB	   317#	  2244
BYKLDP	   315#	  2168
BYKMDL	   320#
BYKNOI	   314#	  3608
BYKNTC	   316#	  2235
BYUDUL	   308#	   661	   669
BYUK62	   310#	   620
BYUK79	   311#	   626
BYULDP	   304#	  1058
BYUMDL	   309#	   658
BYUTAB	   305#	   636	  1053	  1284
BYUTIN	   307#	  1055	  1691
BYUUN7	   303#	   645
BYUWPT	   306#	  1050
CHNACT	    50%	   808	  2587
CHNBMX	    50%	   530
CHNCLR	    50%	   534	   700	  1705
CHNEND	   262#
CHNGO	    50%	   555	   598	   817	   825	  1704	  2622
CHNIIE	    50%	  2621
CHNMER	    50%	  1943	  1980	  2126
CHNSTB	    50%	   529	  1435	  1484	  1941	  1982	  1985	  2123	  2251
CLERSA	   245#	   535
CLRMER	   246#
CMDCHN	   183#	   187	   208	   217	   219	   220
CMDREJ	   269#	  2160
CNEXNO	   187#	   196	   197	   198	   199	   200	   201	   202	   203	   204	   205	   206	   207	   209
	   211	   212	   213	   214	   216
CNTLER	   255#	   584	  1485	  1924	  2053	  2120
CNVCHK	   275#	  2211
COMPAT	   296#	   718	  1111	  1136	  1137	  1222	  1595	  2504	  2721	  2836	  2844	  2851	  2863	  2878
	  2887	  2893	  2936	  2940	  2988	  2992	  3002	  3038	  3225	  3438	  3453	  3629
CPOPJ	    70%	  1093	  3081	  3609
CPOPJ1	    70%	   803	   973	   974	  3504	  3611
CPUKI	    20
CPUKL	    20
CPUTYP	    20
CPZZ	    20#	    20
CUEND	   260#	  1442	  1464	  1485	  1909	  1914	  2004	  2030	  2057
D	  1646	  1821	  1853	  1888	  2791
DATASZ	   367#	  2968	  2997	  2999	  3045	  3048
DATCHK	   273#	  2198
DBYT	   432#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

DCL	   437#
DDI	   427#
DDINT	   431#
DDO	   426#
DDXZ	   430#
DECDI2	   875#	   880
DECDIO	   852	   868#
DEV40	    62%	  1636	  2334	  2479
DEVABC	  1240	  1246	  1544	  1786	  1957	  3211	  3242
DEVACT	    61%	   809	   811	  2588
DEVADD	    61%	   792	  1151	  1165	  1269	  1993	  2590	  2671	  2727	  2927	  3264	  3334	  3368	  3392
	  3399
DEVBWC	  3207	  3210	  3238	  3241
DEVCLS	  1217	  2795	  2805	  2832
DEVCNT	    61%	  1231	  1822	  2803	  2816	  2828	  2855	  2902
DEVDIO	    62%	   869	   907	   912	  1218
DEVDWC	    61%	  1019	  1230	  1855	  1875	  3172
DEVEND	   263#	  1444	  1465	  1727	  1909	  2143	  2152	  2377	  3550
DEVER1	    62%	   815	  1487	  1489	  1555	  1563	  1567	  1603	  1630	  1658	  1686	  1741	  1756	  1907
	  1916	  1946	  1976	  2177	  2279	  2308	  2324	  2447	  2520	  2598	  2858	  3430	  3464
DEVER2	    62%	  1491	  1505	  1517	  1524	  1568	  1639	  1676	  1685	  1757	  1951	  2182	  2213	  2327
	  2332	  2351	  2489	  2491	  2493	  2499	  2599	  3259	  3390	  3411	  3413	  3537
DEVFNJ	    61%	   719	   830	   853	  1032	  1140	  1148	  1161	  1235	  1281	  1349	  1472	  1541	  1702
	  1753	  2038	  2102	  2156	  2173	  2200	  2215	  2262	  2278	  2317	  2362	  2839	  2866	  2889
	  2995	  3043	  3106	  3546
DEVINS	    62%	  1511	  1638	  2336	  2396	  2424	  2483	  3273	  3375	  3415
DEVIOS	   720	   751	   760	  1028	  1141	  1248	  1342	  1355	  1360	  1363	  1452	  1477	  1701	  1750
	  2585
DEVNAM	   955	   957	   968
DEVNOI	    62%	  2338	  2841	  2848	  3610
DEVOUT	    62%	  2329	  2356
DEVSTS	   721	  2189	  2256	  2289	  2322
DEVUDB	    61%	   742	   789	   954	   959	   964	  1011	  1331	  2830	  2856
DGF	   443#
DGTRD	   441#
DHNG	   435#
DIE	    12	    12%	    13	   909	  2811	  3081
DIN	   439#
DINI	   434#
DMT	   442#
DOU	   438#
DR	   877	  1017	  1227	  1245	  1539	  1553	  1575	  1583	  1651	  1653	  1775	  1784	  1792	  1801
	  1803	  1830	  1839	  1851	  1886	  1953	  2220	  2413	  2789	  2929
DRL	   436#
DS1600	   290#	   671	  2737
DS200	   293#	   653	  2717
DS556	   292#	   651
DS6250	   289#	   622	   667	   668	  1291	  2735
DS800	   291#	   651	   664	  2741
DSKPIF	    72%	   785
DSKPIN	    72%	   802	   834
DSPSIZ	   430	   444#
DVSIZ	   433#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

DZAP	   440#
EQPCHK	   272#	  2139
ERBSIN	   378#	  2134
ERBSOU	   387#	  2146	  2358	  2371	  2374	  2398	  2427	  2437	  2440	  3547
ERCMRJ	   382#	  2163
ERCNSN	   385#	  1929
ERCNTL	   379#	  2122
ERDCER	   389#	  2204	  2266	  3544
ERDCRE	   391#	  2201	  2325	  2380	  2422
EREQCK	   380#	  2141	  2246
ERG	   216#	   353	  3312
ERIDBR	   392#	  2243	  2265	  3535
ERINRQ	   381#	  2151
ERMEMR	   386#	  2125
ERNTCP	   383#	  2238
EROVRN	   388#	  2165
ERPRGI	   393#
ERSELE	   377#	  2130
ERSPBY	   384#
ERWWTM	   390#	  2209	  3530	  3533
EXECUT	   182#	   187	   208	   210	   215	   217	   219	   220	  3581
F	   515	   540	   685	   719	   720	   721	   738	   742	   751	   760	   789	   792	   809	   811
	   815	   830	   853	   869	   907	   912	  1011	  1019	  1028	  1032	  1140	  1141	  1148	  1151
	  1161	  1165	  1217	  1218	  1230	  1231	  1235	  1240	  1246	  1248	  1269	  1281	  1331	  1342
	  1349	  1355	  1360	  1363	  1451	  1452	  1472	  1477	  1487	  1489	  1491	  1505	  1511	  1517
	  1524	  1541	  1544	  1555	  1563	  1567	  1568	  1603	  1630	  1636	  1638	  1639	  1658	  1676
	  1685	  1686	  1701	  1702	  1741	  1750	  1753	  1756	  1757	  1786	  1822	  1855	  1875	  1907
	  1916	  1946	  1951	  1957	  1976	  1993	  2038	  2102	  2156	  2173	  2177	  2182	  2189	  2200
	  2213	  2215	  2256	  2262	  2278	  2279	  2289	  2308	  2317	  2322	  2324	  2327	  2329	  2332
	  2334	  2336	  2338	  2351	  2356	  2362	  2396	  2424	  2447	  2479	  2483	  2489	  2491	  2493
	  2499	  2520	  2585	  2588	  2590	  2598	  2599	  2671	  2727	  2795	  2803	  2805	  2816	  2828
	  2830	  2832	  2839	  2841	  2848	  2855	  2856	  2858	  2866	  2889	  2902	  2927	  2995	  3043
	  3106	  3172	  3207	  3210	  3211	  3238	  3241	  3242	  3259	  3264	  3273	  3334	  3368	  3375
	  3390	  3392	  3399	  3411	  3413	  3415	  3430	  3464	  3537	  3546	  3610
FCMRD0	  1801#	  2192	  2298	  2372	  2410	  2439	  2473	  2512
FCMRD1	  1795	  1803#
FCMRD2	  1802	  1810#
FCMRDA	  1583#	  2373	  2438
FCMWR4	  1780	  1786#
FCMWRT	  1784#	  2299	  2375	  2379
FDCNI1	    67%	  2284	  2316
FDCNIE	    67%	  2190	  2277	  2361	  2404	  2431	  2472	  2508
FDERBT	    67%	  2188	  2257
FDHCNI	    66%	   819
FDHCNT	    66%	   814
FDHFUN	    66%	   831
FDMEMR	    66%	  2127
FDNRE1	    66%	  2287	  2293	  2297	  2320
FDNREE	    67%	  2186	  2365	  2405	  2430	  2471	  2506
FDNWR1	    66%
FDNWRE	    67%
FDSCHR	    67%	   641
FDSENS	    67%	  1933	  1935
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

FEPFS1	  2309	  2316#
FEPFS4	  2326	  2331#	  2381
FEPL04	  2370	  2374#
FEPL06	  2357	  2380#
FEPL32	  2436	  2440#
FEPL33	  2425	  2458#
FEPL42	  2469	  2474#
FEPL45	  2467	  2479#
FEPL51	  2501	  2506#
FEPL52	  2505	  2514#
FEPMOD	  2385#	  2397	  2460
FEPNEW	  2330	  2343	  2347#	  2384	  2461	  2488	  2490
FEPOL2	  2352	  2392#
FEPOL3	  2393	  2422#
FEPOL4	  2423	  2465#
FEPOL5	  2480	  2499#
FEPOLD	  2312	  2351#
FFUAR1	  1038#
FFUAR2	  1035	  1049#
FFUERR	  1007#	  1018	  1041
FFUGF2	  1006	  1010#
FFUGF3	  1011#
FFUS1	  1025#	  1029
FFUS2	  1024	  1026	  1030#
FFUSEN	  1013	  1024#
FFUSTO	  1020#	  1062
FHGSTP	   759	  1027	  1338	  1362	  2645#
FICHAN	   527	   564	   602	   693#
FIDIE	   569#	   575	   605
FIDIE2	   573	   576#
FIFLAG	   522	   586	   676	   694#
FIGO	   550#	   612
FIGTN2	   608	   677#
FIGTNX	   638	   640	   676#
FIKONT	   521	   572	   582	   682	   692#	   699
FILOOK	   565	   581#
FINOUT	   570	   679	   685#
FINXKN	   521#	   577	   684
FINXUN	   537#	   683
FIRTCN	   539	   607	   695#
FIRTR2	   594	   607#
FIRTR4	   609#
FIRTRY	   585	   592#
FISEK2	   619	   621	   626#
FISEKN	   587	   615#
FISETU	   589	   616	   636#
FIST94	   659	   667#
FIST9T	   646	   657#
FISTO0	   662	   665	   671#
FISTOT	   654	   670	   672#
FIUNIT	   517	   576	   680	   691#
FIWAIT	   563#	   566
FNPBSF	   337#	  1160	  1687	  2040	  2175
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

FNPBSR	   333#	   748	  1184	  1199	  2174
FNPERG	   335#	  1718	  1730	  2205
FNPRED	   339#	   848	  1232	  1689	  2202	  2285	  2287	  2291	  2293	  2318	  2320	  2363	  2365	  2369
	  3108	  3554
FNPREW	   330#	  1725
FNPRWU	   334#	  1723	  2157
FNPSKF	   336#	  1158	  1187	  2039
FNPSKR	   332#	  1192
FNPUGF	   338#	  1031	  1280	  1348	  1752	  2103
FNPWRT	   340#	  1234	  1542	  1770	  1816	  2263	  3551
FNPWTM	   331#	   741	   746	  1731
FRCINT	   184#	  2516	  2930
FSLDP4	  3397	  3403#
FSLDP6	  3402	  3409#
FSLDPT	  2196	  3390#
FSTHNG	  1709	  1995	  2022	  2029	  2549	  2597	  2633#
FT1CM2	   755	  1146	  1148#	  1185	  1193	  1200
FT1CMD	  1081	  1082	  1084	  1085	  1086	  1146#
FT1TBL	   347#	  1150	  1164
FT7SPC	  1100	  1126#
FT9TRK	  1104	  1132#
FTA0CB	    59%	   516
FTA0DB	    59%	   952	   954	   955
FTACFC	  3081#
FTACL6	   743	   747	   749	   754#
FTACL7	   755#	   762	   764
FTACL8	   759#
FTACLS	   437	   738#
FTADDS	    59%	   433
FTADSP	    77	   429#
FTAEND	  3681#
FTAGRD	   441	  1372#
FTAHC2	   787	   802#
FTAHCT	   800#	   812
FTAHN4	   796	   805#
FTAHN8	   798	   806	   810	   814#
FTAHN9	   823	   830#
FTAHNG	   435	   785#
FTAINI	   434	   512#
FTALIT	  3633#
FTAPE	   442	  1091#
FTARED	   427	   439	  1214#
FTAREL	   436	   717#
FTARW3	  1221	  1225#
FTARW5	  1224	  1244#
FTASER	    12	    13#	    16
FTAUGF	   443	  1004#
FTAWRT	   426	   438	  1215#
FTCMLN	    56%	  2810
FTDIE	  1081	  1082	  1083	  1086	  1087	  1098	  1102	  1107	  1113	  1122#	  1127	  1134
FTDVF2	   953	   957#	   963
FTDVF5	   958	   964#
FTDVF7	   956	   969#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

FTLEO4	  1187#	  1196
FTLEOT	  1085	  1184#
FTOUT	  1123	  1138	  1141#
FTOUT0	  1129	  1137#
FTP2	  1095#
FTP6	  1110	  1115#
FTPTBL	  1081#	  1117	  1118
FTSKB2	  1161#	  1188
FTSKB4	  1167#	  1169
FTSKBS	  1088	  1158#
FTULNH	    59%	   970
FTXBSY	    55%	  1446	  1461	  1463	  2005	  2060
FTXIN1	  1443	  1445	  1448#
FTXIN2	  1440	  1451#
FTXIN4	  1460	  1466	  1472#
FTXINT	    77	  1435#
FTXMCH	    54%	   526	   588	   617	   631	  1290	  1292	  2142	  2240	  3339
FTXSM0	    55%	  1942	  1981
FTXSMY	    55%	  1925	  1940	  1983	  2027	  2065	  2066
FTXSNS	    54%	  1986	  1987
FTXSP1	    55%	  1449
FTXSPR	    55%	  1448
FTXSS1	    54%	  1923	  1944	  1977
FTXSS2	    54%	  1938	  1979
FTXSTS	    54%	   314	   315	   316	   317	   318	   320	  1934	  2138	  3344
FTXSX1	    55%	  1437
FXBS63	  2037	  2042#
FXBS64	  2047	  2051#
FXBS65	  2041	  2054	  2056#
FXBSY1	  2004#
FXBSY2	  2001	  2011#
FXBSY3	  2012	  2014	  2024#
FXBSY4	  1447	  1468	  2032#
FXBSY6	  1915	  2036#
FXBSY7	  2050	  2060#
FXBUSY	  1910	  2000#
FXDSM1	  1709#	  3418
FXDSM2	  1450	  1478	  1520	  1527	  1569	  1642	  1678	  1704#	  1710	  1724	  1728	  1758	  1760	  1828
	  1832	  1865	  1882	  1954	  1968	  1971	  1996	  2009	  2023	  2031	  2033	  2062	  2234	  2346
	  2348	  2386	  2478	  2496
FXER0	  2148	  2164	  2167	  2203	  2206	  2210	  2239	  2245	  2250#
FXER00	  2132	  2138#
FXER01	  2140	  2146#
FXER02	  2150	  2160#
FXER03	  2161	  2165#
FXER04	  2185	  2193#
FXER05	  2169	  2178	  2181	  2183	  2195	  2198#
FXER06	  2199	  2211#
FXER07	  2236	  2240#
FXER08	  2242	  2246#
FXER09	  1930	  2129	  2135	  2145	  2155	  2247#
FXER1	  1486	  1901#
FXER11	  1906	  1914#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

FXER16	  2258	  2260	  2277#
FXER21	  2280	  2284#
FXER22	  2283	  2291#
FXER23	  2290	  2294#
FXER62	  2221	  2225#
FXER64	  2227	  2232#
FXER65	  2212	  2235#
FXERC6	  1489#
FXERCK	  1473	  1484#	  2059
FXEREP	  2264	  2267	  2272	  2308#
FXEROR	  1917	  1947	  2120#
FXERR1	  2124	  2128#
FXERR2	  2121	  2130#
FXMT0	  1729	  1740#	  2176
FXMT00	  1732	  1736#
FXMT2	  1726	  1730#
FXMT6	  1719	  1747#
FXMT7	  1748	  1759#
FXMTSN	  1735	  1750#
FXNMMT	  1688	  1718#
FXNMRW	  1690	  1764#	  2217
FXNRML	  1490	  1492	  1495	  1500	  1685#
FXPHG2	  1638#	  2455
FXPHGO	  1635#	  2530
FXPRG1	  1956	  1962#
FXPRG2	  1961	  1965#
FXPRGI	  1902	  1951#
FXRW10	  1855#	  1889
FXRW11	  1858#	  2224
FXRW12	  1852	  1868#
FXRW13	  1877#	  1898
FXRW15	  1848	  1886#
FXRW16	  1887	  1895#
FXRW2	  1771	  1791#
FXRW5	  1766	  1816#
FXRW7	  1817	  1835#
FXRW8	  1843#	  1879	  2231
FXRW9	  1836	  1847#
FXRWC2	  1822#	  1840	  1861
FXRWCN	  1821#	  1844
FXSNC0	  1913	  1929#
FXSNC1	  1912	  1927#
FXSNC2	  1488	  1932#
FXSNC4	  1926	  1936#
FXSTOP	  1540	  1546	  1549	  1560	  1698#	  1739	  1743	  1776	  1781	  1785	  1788	  1797	  1804	  1809
	  1811	  1823	  1826	  1856	  1892	  2286	  2292	  2364	  2416	  2418
FXSTP0	  1694#	  2158
FXUCG1	  1475	  1986#
FXUCGO	  1904	  1975#
FXWN21	  1574	  1591#
FXWN22	  1596	  1602#
FXWN23	  1608#	  1612
FXWN25	  1614	  1620#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

FXWN26	  1622	  1633#
FXWN28	  1594	  1646#
FXWN32	  1654	  1658#
FXWN44	  1543	  1547#
FXWN57	  1554	  1563#
FXWNA2	  1671	  1676#
FXWNAJ	  1666	  1670#
FXWNP4	  1584	  1589	  1665#	  2378
FXWNP5	  1652	  1657	  1669#
FXWNP6	  1674#	  2441
FXWNP7	  1536	  1648	  2444#	  2511
FXWON	  1498	  1505#
FXWON0	  1513	  1523#
FXWON1	  1507	  1530#
FXWON2	  1532	  1573#
FXWON3	  1533	  1592	  1651#
FXWON4	  1534	  1539#	  2408
FXWON5	  1535	  1553#
GINST	   951#	   951	   952	   969#	   969	   970	  1004#	  1004	  1005	  1007#	  1007	  1008	  1020#	  1020
	  1021	  1038#	  1038	  1039	  1045#	  1045	  1046
HALT	   231#	  1153	  1171	  1559	  1656	  1779	  1860	  1878	  1967	  2046	  2049	  2226	  2523	  2677
	  2903	  3269	  3372	  3409
HNGFTA	   297#	   757	   761	  1343	  1359	  1364	  1476	  2154	  2159
HNGSTP	    71%	  2652
IBMCMP	   286#	  1061
IGNLEN	   185#	   219	  3342
INSERR	   370#	  1510	  1637	  2335	  2482	  3272	  3414
INTREQ	   270#	  1357	  2149
IO	  1214	  1215	  1233	  1955	  2944
IOACT	   786	  1700	  2581
IOBEG	  1228
IOBKTL	  1647	  1891	  1895	  2577
IOBOT	  1742	  2576	  2577
IODEND	   750	  1195	  1197	  1576	  1577	  1734	  1749	  1794	  1796	  2577
IODERR	  2247	  2359	  2399	  2428	  2577
IODTER	  2273	  2360	  2400	  2429	  2470	  2507	  2577
IOEND	  1547	  1578	  1791
IOIMPM	   744	  1122	  1247	  2162	  2237	  2577
IOLEND	   298#	  1190	  1195	  1693	  1694	  1737	  1738	  1740	  1774	  1818	  1960	  2582
IONRCK	  2259
IOPAR	  1109	  1132	  1220	  2724
IOSTBL	  2154	  2159
IOTEND	  1693	  1694	  1737	  1738	  1740	  1774	  1818	  1960	  2583	  2584
IOW	  1561	  1698	  1827	  1862	  1969
J	   314	   315	   316	   317	   318	   320	   874	   881	   906	   913	   972	  1437	  1439	  1446
	  1448	  1449	  1461	  1463	  1923	  1925	  1927	  1934	  1936	  1938	  1940	  1942	  1944	  1977
	  1979	  1981	  1983	  1986	  1987	  1988	  2005	  2016	  2027	  2042	  2060	  2065	  2066	  2072
	  2105	  2138	  2142	  2240	  2449	  2450	  2452	  2525	  2526	  2528	  2544	  2560	  3339	  3344
	  3441
JBTIOA	    71%	   851	  1237
JBTLIC	    71%	   972
KONBMX	    53%	   523	   525	   543	   610	   791	  1271	  1927	  1936	  1988	  2016	  2042	  2072	  2105
	  2544	  2560	  2591
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

KONBSU	    53%	   545	  1272
KONPTR	    53%	  1439
LASDAT	   227#	  1631	  2872	  2885	  3011	  3465
LENERR	   256#	  1591	  1835	  2053	  2216
LICSPY	   971
LICSYS	   971
LISTSN	     3	     6
LOADPT	   284#	  1060
M	   741	   746	   748	   950	   951	   969	   975	  1004	  1007	  1020	  1038	  1043	  1044	  1092
	  1093	  1097	  1099	  1101	  1103	  1106	  1115	  1116	  1117	  1118	  1128	  1135	  1139	  1140
	  1146	  1147	  1148	  1150	  1159	  1184	  1192	  1199	  1472	  1473	  1602	  1607	  1608	  1609
	  1610	  1616	  1623	  1627	  1631	  1632	  1633	  1639	  1665	  1669	  1674	  1676	  1687	  1689
	  1718	  1723	  1725	  1730	  1731	  1770	  1816	  1868	  1873	  2018	  2019	  2020	  2021	  2025
	  2026	  2027	  2074	  2075	  2076	  2077	  2078	  2087	  2089	  2142	  2144	  2156	  2157	  2173
	  2174	  2175	  2177	  2178	  2180	  2182	  2183	  2184	  2193	  2194	  2200	  2202	  2205	  2215
	  2262	  2263	  2281	  2282	  2308	  2309	  2311	  2367	  2371	  2374	  2433	  2437	  2440	  2453
	  2465	  2472	  2508	  2529	  2648	  2656	  2787	  2828	  2833	  2842	  2846	  2847	  2853	  2854
	  2855	  2870	  2876	  2880	  2881	  2895	  2898	  2907	  2966	  2967	  2984	  2985	  2990	  2991
	  3004	  3009	  3136	  3139	  3141	  3143	  3146	  3148	  3164	  3165	  3169	  3172	  3173	  3254
	  3258	  3263	  3268	  3327	  3329	  3330	  3331	  3335	  3343	  3346	  3347	  3348	  3352	  3355
	  3390	  3395	  3403	  3434	  3436	  3437	  3439	  3440	  3442	  3444	  3445	  3446	  3448	  3456
	  3457	  3458	  3459	  3460	  3546	  3551	  3554
MEMERR	   249#	   583
MODE7	   192#	  2937
MODE7I	   193#	  2938
MODE9D	   190#	  2941
MODE9I	   191#	   208	   220	  2942
MODEL1	   324#
MODEL2	   325#	   618	  2144	  2241
MS7T2	   196#	  2698
MS7T5	   197#	  2699
MS7T8	   198#	  2700
MS7TE2	   199#	  2702
MS7TE5	   200#	  2703
MS7TE8	   201#	  2704
MS7TO2	   202#	  2702
MS7TO5	   203#	  2703
MS7TO8	   204#	  2704
MS9T16	   206#	  2699
MS9T62	   207#	  2700
MS9T8	   205#	  2698
MSKCTD	   359#	  2843	  2877	  2987	  3037
MSKCTU	   361#	  1609	  3144	  3436	  3491	  3499	  3627
MSKMMD	   363#	  2846	  2880	  2990
MSKMMU	   365#	  2966
MTANIB	   909#
MTATMW	  2811#
NODIE	    12%	  3081
NOISE	   371#	  2337
NOMXFR	   181#	   187	   210	   215
OFFSET	   186#	   220
OUT	    70%
OUTERR	   372#	  2328
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

OUTPB	   738
OVERUN	   274#	  2166
P	    13	   431	   440	   512	   513	   514	   515	   541	   595	   596	   604	   606	   609	   615
	   632	   639	   650	   673	   677	   685	   686	   687	   688	   689	   703	   717	   722	   739
	   740	   743	   745	   747	   749	   752	   754	   755	   756	   758	   759	   763	   788	   800
	   801	   832	   833	   835	   852	   854	   868	   871	   872	   873	   874	   875	   881	   882
	   883	   884	   902	   903	   904	   905	   906	   909	   910	   913	   914	   915	   916	   917
	   918	   934	   938	  1008	  1010	  1021	  1025	  1027	  1030	  1033	  1034	  1046	  1091	  1095
	  1142	  1149	  1162	  1185	  1186	  1188	  1189	  1191	  1193	  1194	  1198	  1216	  1225	  1238
	  1241	  1265	  1266	  1267	  1268	  1279	  1282	  1283	  1287	  1293	  1294	  1295	  1296	  1297
	  1298	  1299	  1330	  1336	  1338	  1346	  1347	  1351	  1352	  1353	  1354	  1362	  1367	  1368
	  1372	  1373	  1374	  1375	  1376	  1377	  1462	  1519	  1526	  1545	  1548	  1557	  1562	  1566
	  1586	  1588	  1593	  1605	  1641	  1660	  1677	  1699	  1703	  1706	  1709	  1751	  1755	  1759
	  1787	  1806	  1808	  1810	  1824	  1831	  1843	  1847	  1857	  1858	  1863	  1864	  1869	  1870
	  1872	  1876	  1881	  1890	  1896	  1911	  1922	  1932	  1958	  1964	  1970	  1995	  2006	  2008
	  2022	  2028	  2029	  2032	  2056	  2061	  2069	  2083	  2084	  2085	  2086	  2087	  2088	  2089
	  2090	  2091	  2092	  2093	  2094	  2104	  2109	  2128	  2223	  2233	  2268	  2269	  2270	  2323
	  2340	  2342	  2345	  2347	  2385	  2411	  2415	  2417	  2449	  2451	  2452	  2466	  2476	  2477
	  2484	  2487	  2495	  2525	  2527	  2528	  2564	  2578	  2579	  2580	  2597	  2600	  2601	  2602
	  2603	  2617	  2619	  2623	  2645	  2646	  2647	  2648	  2649	  2650	  2651	  2652	  2653	  2654
	  2655	  2656	  2657	  2658	  2659	  2660	  2670	  2679	  2680	  2707	  2729	  2730	  2783	  2786
	  2787	  2788	  2798	  2799	  2808	  2811	  2818	  2819	  2859	  2868	  2884	  2905	  2906	  2907
	  2908	  2910	  2911	  2925	  2926	  2947	  2950	  2951	  2971	  3000	  3007	  3013	  3028	  3029
	  3047	  3049	  3055	  3056	  3057	  3075	  3081	  3090	  3091	  3104	  3120	  3121	  3135	  3136
	  3137	  3138	  3147	  3148	  3149	  3150	  3164	  3168	  3173	  3174	  3187	  3188	  3189	  3190
	  3191	  3192	  3193	  3205	  3206	  3212	  3213	  3227	  3235	  3237	  3243	  3254	  3255	  3265
	  3271	  3275	  3327	  3328	  3350	  3354	  3355	  3356	  3417	  3432	  3437	  3445	  3467	  3468
	  3481	  3482	  3484	  3492	  3496	  3502	  3503	  3508	  3509	  3510	  3511	  3529	  3605	  3607
	  3624	  3631
P1	   974
P3	   512	   530	   531	   532	   533	   544	   546	   611	   683	   688	  1268	  1269	  1273	  1274
	  1295	  1438	  1986	  2017	  2024	  2043	  2067	  2071	  2073	  2079	  2083	  2093	  2106	  2545
	  2561	  2580	  2590	  2592	  2600
PAGWAK	    72%	   934
PG	   873	   882	   905	   914	   928	  1435	  1484	  1704	  1705	  1941	  1943	  1980	  1982	  1985
	  2123	  2126	  2251	  2646	  2658	  2788	  2862	  2866	  2867	  2872	  2873	  2883	  2885	  2886
	  2889	  2890	  2903	  2904	  2906	  2968	  2969	  2995	  2996	  2999	  3001	  3003	  3004	  3006
	  3011	  3012	  3029	  3043	  3044	  3055	  3432	  3433	  3448	  3454	  3465	  3466	  3467
PGYDIO	    72%	   929	   932
PIOMOD	    70%	   876	  1016	  1226	  1244	  1530	  1764	  1829	  1952	  2191	  2219	  2296	  2368	  2406
	  2434	  2468	  2509	  2785	  2928
PJOBN	    71%	   850	  1236
PRGINT	   257#	   584	  1485	  1901
PWAIT1	    71%	  1354
PX.MEM	   951	   969	  1004	  1007	  1020	  1038	  1045
READBK	   218#	  2517
READFW	   217#	  2945
READY	   283#	   637	  1285
REW	   209#	  3296
REWNCH	   210#	   348
REWUNL	   214#
RWUNCH	   215#	   352
S	   718	   720	   744	   750	   751	   757	   760	   761	   786	  1028	  1109	  1111	  1122	  1132
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

	  1136	  1137	  1141	  1190	  1195	  1197	  1214	  1215	  1220	  1222	  1228	  1233	  1247	  1248	  1342
	  1343	  1355	  1359	  1360	  1363	  1364	  1452	  1476	  1477	  1547	  1561	  1576	  1577	  1578
	  1595	  1647	  1693	  1694	  1698	  1700	  1701	  1734	  1737	  1738	  1740	  1742	  1749	  1750
	  1774	  1791	  1794	  1796	  1818	  1827	  1862	  1891	  1895	  1955	  1960	  1969	  2154	  2159
	  2162	  2237	  2247	  2259	  2273	  2359	  2360	  2399	  2400	  2428	  2429	  2470	  2504	  2507
	  2576	  2577	  2581	  2582	  2583	  2584	  2585	  2708	  2721	  2724	  2836	  2844	  2851	  2863
	  2878	  2887	  2893	  2936	  2940	  2944	  2988	  2992	  3002	  3038	  3225	  3438	  3453	  3629
S$ENTR	    12	    18	   910	   931	  2797	  2807	  2812	  2834	  3035	  3082
S$EVEN	   909	  2811	  3081
S$HALT	    12	   909	   931	  2797	  2807	  2811	  2834	  3035	  3081
S$INFO	   909	  2811	  3081	  3082
S$JOB	   909	   910	  2811	  2812
S$NAME	    16#	   931	  2797	  2807	  2834	  3035
S$NONA	    15	    18	   910	   931	  2797	  2807	  2812	  2834	  3035	  3082
S$PATC	   909	  2811	  3081
S$TEMP	    12#	    12	   909#	   909	   931#	   931	  2797#	  2797	  2807#	  2807	  2811#	  2811	  2834#	  2834
	  3035#	  3035	  3081#	  3081
S$XCT	    18	   910	   931	  2797	  2807	  2812	  2834	  3035	  3082
SAJSNS	  2006	  2028	  2102#
SAVA45	   763	  1346#
SAVAIL	   754	  1095	  1216	  1330#	  1374
SAVAL2	  1336#	  1339
SAVAL4	  1333	  1342#
SAVAL5	  1345	  1347#	  1365
SAVAL6	  1358	  1362#
SAVAL8	  1337	  1344	  1361	  1367#
SBSERG	  3309#	  3534
SBSR	  3299#	  3553	  3555
SBSTIE	  3315#	  3539
SBUFCT	  1557	  1964	  2223	  2415	  3187#
SBUFS1	  3231	  3234#
SBUFS2	  3226	  3237#
SBUFST	  1857	  1890	  3190	  3225#
SBUFZR	  1548	  1810	  3205#
SCLRCH	   595	   609	   677	   699#
SCMBF0	  2805#
SCMBF1	  2804	  2808#	  2822
SCMBF2	  2815	  2818#
SCMBF3	  2809	  2820#
SCMD25	  2837	  2841#
SCMD75	  2871	  2875#
SCMD84	  2892	  2897#
SCMDR1	  2829	  2832#
SCMDR2	  2831	  2835#
SCMDR3	  2842#	  2899
SCMDR4	  2848#	  2896
SCMDR6	  2850	  2858#
SCMDR7	  2860#	  2882
SCMDR8	  2861	  2883#
SCMFIN	  2800	  2817	  2857	  2903#
SCMFN0	  2824	  2874	  2902#
SCMFN2	  2825	  2906#
SCMG33	  3334#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

SCMG35	  3338	  3348#
SCMG36	  3349#
SCMGN1	  3292	  3295	  3300	  3305	  3310	  3316	  3322	  3327#
SCMGN3	  3332#	  3349
SCMGN4	  3333	  3350#
SCMGN5	  3276	  3354#
SCOMBF	  2792	  2803#
SCOMBL	  1238	  1824	  2783#
SCOMDR	  2790	  2828#
SDCIO2	   850#	  1242
SDCIO3	   852#	  1249
SDCIO4	   849	   853#
SDCIOA	   833	   848#	  1703
SDMPC2	  3166#	  3171
SDMPC4	  3167	  3172#
SDMPCT	  1588	  1660	  1808	  1843	  2417	  3164#
SDTCAL	  2808	  3028#
SDTCL1	  3031#	  3053
SDTCL2	  3032	  3037#
SDTCL3	  3039	  3042	  3045#
SDTCL4	  3036	  3055#
SELERR	   253#	   584	  1485	  1924	  2053	  2131	  2133
SENSE	   208#	  2672
SETHNG	    70%	   800	  2634
SETIOD	    70%	  1562	  1699	  1831	  1863	  1970
SFISKN	   615	   617#	  1293
SFISUN	   639	   641#	  1294
SGDEV1	  1858	  1869	  1896	  2323	  2411	  3104#	  3484
SGDEV2	  3111#	  3118
SGDEV3	  3114#	  3115
SGDEV5	  3109	  3120#
SGPREV	  1586	  1806	  2340	  2476	  3075#	  3137	  3492	  3529
SGPRV2	  3082#	  3089
SGPRV3	  3086#	  3087
SGPRV4	  3090#
SGTDEV	  1025	  1265#	  1336
SGTDV4	  1286	  1289#
SGTDV5	  1288	  1295#
SKR	   212#	   350	  1518	  1670	  3260	  3323	  3391
SLENER	  1593	  1847	  3481#
SLTGR	  3487	  3507#
SLTLR1	  3496#
SLTLR4	  3500#
SMOD	  2385	  3572#
SMOD2	  3578#	  3582
SNEW	  2347	  3527#
SNEW2	  3531	  3544#
SNEW31	  3548	  3554#
SNEW4	  3545	  3556#	  3575
SNOICT	  2269	  3605	  3622#
SNOISE	  2342	  2466	  3605#
SREVR2	  3434#	  3450
SREVR3	  3441	  3444#
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

SREVR4	  3449#
SREVR7	  3455	  3458#	  3463
SREVRS	  2451	  2527	  3428#
SREW	  3294#	  3536
SSEND	  3291	  3297#
SSKBSR	  1677	  3368#
SSKTIE	  3321#	  3540
SSMTIC	  1566	  1641	  1864	  1881	  2061	  2233	  2345	  2477	  3291#	  3552
SSTAL0	  1462	  1911	  1922	  1932	  2056	  2083#
SSTAL2	  2068#	  2079
SSTALL	  2032	  2065#	  2088
SSTONE	  2008	  2072#
STAMOD	   259#	   593	  1909	  2000
STC12	  1519	  2495	  3254#
STIE	  1526	  3304#
STOCM4	  2935	  2940#
STOCM6	  2939	  2944#
STOCMD	  2798	  2818	  2859	  2925#
STOD15	  2986	  2990#
STODAT	  2868	  2884	  2966#	  3000	  3007
STODS1	  2985#	  3010
STODS2	  2994	  2997#	  3005
STODS4	  2998	  3006#
STODTS	  2799	  2819	  2984#
STRTDV	   235#	   552	  1991	  2020	  2074	  2547	  2595
SUBRG1	  1239	  2618	  2620#
SUBRG2	  1033	  1282	  1352	  2617#
SUBRGO	  1155	  1173	  2619#
SUBRS0	  2577#	  2617
SUBRSM	  1149	  1162	  2707#	  2783
SUBRSN	   541	  1030	  1279	  1347	  1751	  2670#
SUBRST	  1759	  2576#	  2619	  2905
SUBSM2	  2722	  2726#
SUBSM4	  2713	  2733#
SUBSM6	  2736	  2741#
SUBSMT	  2739#	  2743
SUBSOT	  2727#	  2740
SUBST1	  2702#	  2723	  2725
SUBSTB	  2698#	  2720	  2739
SUBSTI	  1755	  2544#	  3354	  3377	  3417	  3557	  3585
SUBTRM	  2128	  2560#
SWRDR1	  3141#	  3146
SWRDR5	  3142	  3147#
SWRDRD	  1605	  1872	  3135#	  3168	  3189	  3496	  3508	  3624
SYDCOM	    71%	   975
SYDFTA	    77	   950#
SYDNM4	    71%	   961	   966
T1	   433	   523	   524	   525	   526	   527	   534	   535	   536	   543	   544	   547	   548	   551
	   553	   561	   564	   583	   598	   599	   600	   601	   610	   611	   620	   621	   626	   627
	   629	   641	   642	   643	   644	   651	   653	   657	   664	   668	   671	   672	   700	   701
	   702	   792	   793	   794	   795	   797	   798	   805	   807	   808	   809	   811	   816	   817
	   818	   819	   820	   821	   822	   824	   825	   826	   827	   828	   829	   830	   831	   848
	   850	   851	   870	   879	   902	   908	   917	   927	   928	   929	   930	   932	   933	   936
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

	   951	   953	   955	   957	   967	   968	   969	   970	  1012	  1016	  1017	  1019	  1020	  1024	  1031
	  1032	  1042	  1043	  1045	  1049	  1052	  1054	  1057	  1060	  1061	  1096	  1112	  1117	  1118
	  1119	  1126	  1133	  1150	  1151	  1152	  1153	  1154	  1164	  1165	  1167	  1170	  1171	  1172
	  1217	  1218	  1219	  1223	  1226	  1227	  1232	  1234	  1235	  1244	  1245	  1265	  1271	  1273
	  1275	  1276	  1280	  1281	  1298	  1330	  1332	  1333	  1346	  1348	  1349	  1356	  1357	  1367
	  1436	  1437	  1438	  1441	  1442	  1444	  1449	  1453	  1459	  1464	  1465	  1467	  1474	  1485
	  1510	  1511	  1518	  1541	  1542	  1555	  1556	  1558	  1559	  1564	  1565	  1573	  1585	  1587
	  1591	  1597	  1599	  1600	  1601	  1603	  1604	  1606	  1608	  1612	  1614	  1615	  1619	  1621
	  1625	  1635	  1636	  1637	  1638	  1655	  1656	  1659	  1670	  1675	  1691	  1692	  1702	  1727
	  1733	  1736	  1747	  1752	  1753	  1754	  1765	  1777	  1778	  1779	  1805	  1807	  1835	  1841
	  1842	  1859	  1860	  1871	  1876	  1877	  1879	  1880	  1897	  1901	  1903	  1905	  1909	  1914
	  1933	  1934	  1935	  1936	  1937	  1938	  1939	  1940	  1941	  1942	  1943	  1944	  1945	  1959
	  1962	  1963	  1965	  1966	  1967	  1977	  1978	  1979	  1980	  1981	  1982	  1983	  1984	  1985
	  1987	  1990	  1991	  1992	  1993	  1994	  2000	  2004	  2007	  2030	  2036	  2045	  2046	  2048
	  2049	  2051	  2052	  2053	  2057	  2058	  2065	  2068	  2070	  2084	  2092	  2120	  2131	  2133
	  2143	  2152	  2214	  2216	  2218	  2222	  2225	  2228	  2229	  2230	  2232	  2250	  2251	  2252
	  2255	  2256	  2257	  2268	  2270	  2277	  2284	  2295	  2297	  2316	  2317	  2318	  2320	  2321
	  2328	  2329	  2331	  2332	  2333	  2334	  2335	  2336	  2337	  2338	  2339	  2361	  2362	  2363
	  2365	  2366	  2369	  2404	  2412	  2431	  2444	  2445	  2446	  2448	  2454	  2458	  2459	  2465
	  2469	  2474	  2475	  2479	  2484	  2485	  2486	  2487	  2488	  2494	  2499	  2500	  2510	  2514
	  2515	  2516	  2518	  2519	  2521	  2522	  2523	  2524	  2546	  2547	  2548	  2562	  2563	  2578
	  2593	  2594	  2595	  2596	  2602	  2649	  2655	  2708	  2709	  2710	  2716	  2719	  2720	  2723
	  2725	  2726	  2727	  2728	  2733	  2734	  2738	  2739	  2742	  2743	  2795	  2796	  2803	  2805
	  2806	  2816	  2820	  2821	  2830	  2832	  2833	  2856	  2864	  2869	  2870	  2897	  2898	  2925
	  2927	  2930	  2937	  2938	  2941	  2942	  2945	  2946	  2948	  2950	  2984	  2993	  3008	  3009
	  3028	  3031	  3033	  3034	  3041	  3051	  3052	  3056	  3079	  3080	  3088	  3104	  3106	  3108
	  3110	  3111	  3112	  3113	  3114	  3115	  3116	  3117	  3119	  3120	  3141	  3147	  3166	  3170
	  3171	  3188	  3191	  3205	  3207	  3208	  3209	  3210	  3212	  3228	  3229	  3230	  3233	  3234
	  3236	  3238	  3239	  3240	  3241	  3260	  3264	  3266	  3269	  3270	  3272	  3273	  3274	  3291
	  3294	  3299	  3304	  3309	  3315	  3321	  3332	  3336	  3349	  3353	  3368	  3369	  3370	  3371
	  3372	  3373	  3374	  3375	  3376	  3391	  3392	  3393	  3398	  3399	  3400	  3407	  3409	  3410
	  3411	  3412	  3413	  3414	  3415	  3416	  3428	  3429	  3434	  3435	  3447	  3449	  3450	  3451
	  3452	  3457	  3458	  3460	  3461	  3462	  3481	  3485	  3486	  3493	  3494	  3497	  3498	  3499
	  3500	  3501	  3503	  3507	  3510	  3527	  3556	  3576	  3578	  3582	  3583	  3584	  3610	  3622
	  3623	  3625	  3626	  3627	  3628
T2	   518	   521	   523	   525	   526	   528	   543	   545	   554	   562	   566	   571	   572	   582
	   588	   596	   597	   603	   604	   606	   610	   617	   631	   636	   637	   643	   644	   645
	   646	   658	   659	   661	   662	   669	   670	   681	   682	   790	   791	   793	   794	   821
	   829	   876	   877	   903	   916	   971	   972	  1038	  1039	  1040	  1041	  1044	  1045	  1050
	  1051	  1053	  1054	  1055	  1056	  1058	  1059	  1163	  1169	  1236	  1237	  1266	  1270	  1271
	  1272	  1274	  1276	  1284	  1285	  1289	  1290	  1292	  1297	  1351	  1353	  1454	  1455	  1456
	  1457	  1489	  1490	  1497	  1499	  1530	  1539	  1553	  1575	  1583	  1615	  1616	  1617	  1618
	  1619	  1620	  1621	  1623	  1624	  1625	  1626	  1627	  1628	  1629	  1646	  1651	  1653	  1764
	  1775	  1784	  1792	  1801	  1803	  1821	  1829	  1830	  1839	  1851	  1853	  1886	  1888	  1927
	  1928	  1929	  1952	  1953	  1988	  1989	  1990	  1992	  1994	  2070	  2071	  2085	  2091	  2102
	  2103	  2107	  2108	  2122	  2125	  2130	  2134	  2141	  2146	  2151	  2163	  2165	  2168	  2169
	  2179	  2180	  2187	  2188	  2189	  2190	  2191	  2201	  2204	  2209	  2219	  2220	  2238	  2243
	  2246	  2253	  2254	  2258	  2265	  2266	  2278	  2285	  2287	  2288	  2291	  2293	  2294	  2295
	  2296	  2325	  2358	  2367	  2368	  2376	  2377	  2380	  2398	  2406	  2413	  2422	  2427	  2433
	  2434	  2468	  2502	  2503	  2509	  2517	  2518	  2544	  2545	  2546	  2548	  2579	  2586	  2587
	  2588	  2589	  2591	  2592	  2594	  2596	  2601	  2620	  2621	  2622	  2650	  2654	  2670	  2671
	  2672	  2673	  2674	  2675	  2676	  2677	  2678	  2679	  2707	  2711	  2712	  2717	  2720	  2723
	  2725	  2726	  2729	  2735	  2737	  2741	  2784	  2813	  2823	  2849	  2858	  2873	  2886	  2904
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

	  2909	  2926	  2928	  2929	  2933	  2934	  2947	  2948	  2949	  2967	  2969	  2970	  3012	  3075	  3077
	  3078	  3082	  3083	  3084	  3085	  3086	  3087	  3088	  3089	  3090	  3135	  3143	  3144	  3145
	  3149	  3227	  3231	  3232	  3233	  3235	  3255	  3256	  3257	  3259	  3261	  3262	  3275	  3394
	  3396	  3404	  3406	  3435	  3442	  3444	  3446	  3447	  3482	  3483	  3487	  3490	  3491	  3500
	  3502	  3509	  3530	  3533	  3535	  3537	  3538	  3544	  3547	  3549	  3550	  3572	  3573	  3574
	  3577	  3579	  3580
T3	   303	   304	   305	   306	   307	   308	   309	   310	   311	   516	   517	   518	   537	   540
	   550	   569	   570	   571	   574	   576	   641	   642	   672	   678	   679	   680	   681	   742
	   788	   789	   790	   797	   799	   801	   807	   814	   816	   819	   824	   831	   832	  1011
	  1012	  1042	  1049	  1096	  1152	  1154	  1166	  1219	  1270	  1277	  1278	  1289	  1331	  1332
	  1350	  1356	  1372	  1376	  1439	  1451	  1453	  1455	  1457	  1525	  1558	  1564	  1597	  1601
	  1620	  1629	  1640	  1655	  1754	  1933	  1935	  2011	  2013	  2015	  2018	  2107	  2127	  2186
	  2188	  2190	  2208	  2257	  2277	  2284	  2287	  2293	  2297	  2316	  2320	  2341	  2344	  2361
	  2365	  2383	  2404	  2405	  2430	  2431	  2444	  2445	  2446	  2459	  2471	  2472	  2502	  2506
	  2508	  2514	  2515	  2519	  2522	  2586	  2589	  2593	  2620	  2633	  2651	  2653	  2673	  2674
	  2676	  2678	  2711	  2728	  2784	  2814	  2823	  2849	  2909	  2933	  3077	  3079	  3080	  3107
	  3110	  3166	  3256	  3257	  3265	  3266	  3267	  3270	  3271	  3274	  3329	  3330	  3331	  3353
	  3369	  3370	  3371	  3373	  3376	  3393	  3394	  3400	  3401	  3405	  3416	  3428	  3451	  3556
	  3574	  3576	  3584
T4	   513	   528	   529	   530	   534	   538	   539	   545	   546	   548	   550	   551	   552	   553
	   554	   555	   556	   557	   560	   561	   563	   581	   584	   588	   592	   593	   598	   600
	   602	   617	   618	   622	   628	   630	   631	   649	   652	   663	   667	   687	   699	   700
	   868	   869	   870	   871	   879	   880	   883	   904	   907	   908	   911	   912	   915	   935
	   936	  1267	  1290	  1291	  1292	  1296	  1373	  1375	  1487	  1488	  1491	  1492	  1493	  1494
	  1496	  1497	  1499	  1505	  1506	  1512	  1516	  1517	  1523	  1524	  1525	  1531	  1563	  1565
	  1587	  1598	  1602	  1607	  1610	  1611	  1613	  1617	  1618	  1630	  1632	  1640	  1658	  1659
	  1807	  1855	  1859	  1868	  1870	  1871	  1873	  1874	  1875	  1877	  1878	  1880	  1897	  1907
	  1908	  1912	  1916	  1917	  1923	  1924	  1975	  1976	  2011	  2012	  2016	  2017	  2019	  2021
	  2024	  2026	  2038	  2039	  2040	  2042	  2043	  2044	  2045	  2048	  2055	  2072	  2073	  2075
	  2076	  2078	  2086	  2090	  2105	  2106	  2108	  2126	  2127	  2138	  2139	  2147	  2149	  2160
	  2166	  2198	  2207	  2208	  2211	  2225	  2226	  2232	  2235	  2236	  2240	  2241	  2244	  2245
	  2253	  2254	  2255	  2271	  2279	  2280	  2282	  2310	  2311	  2324	  2341	  2344	  2351	  2352
	  2382	  2383	  2392	  2401	  2402	  2407	  2409	  2412	  2435	  2447	  2448	  2482	  2483	  2489
	  2490	  2491	  2492	  2493	  2520	  2521	  2524	  2560	  2561	  2563	  2786	  2839	  2840	  2842
	  2843	  2845	  2852	  2854	  2860	  2862	  2867	  2875	  2876	  2877	  2879	  2891	  2892	  2908
	  2985	  2986	  2987	  2989	  2996	  2997	  3001	  3006	  3031	  3032	  3037	  3040	  3044	  3045
	  3046	  3047	  3048	  3049	  3050	  3078	  3084	  3105	  3107	  3117	  3119	  3138	  3139	  3140
	  3145	  3169	  3187	  3192	  3228	  3236	  3239	  3328	  3332	  3333	  3334	  3335	  3336	  3337
	  3339	  3340	  3342	  3343	  3344	  3345	  3347	  3350	  3351	  3352	  3401	  3405	  3407	  3408
	  3410	  3430	  3431	  3449	  3459	  3462	  3463	  3464	  3466	  3486	  3494	  3495	  3501	  3577
	  3578	  3580	  3581	  3583	  3606	  3608	  3609	  3628	  3630
TAPEIN	   285#	  1057
TBLBSR	   351#
TBLERG	   353#
TBLREW	   348#
TBLRWU	   352#
TBLSKR	   350#
TBLTIE	   354#
TBLWTM	   349#
TERMDV	   236#	   822	   828	  2562
TIC	   223#	   531	  3351
TIE	   220#	   354	  3306	  3318	  3324	  3337
TRK7	   288#	   628	   649	   651	   663	  1112	  1126	  1133	  1223	  1291	  2503	  2712	  2934	  3340
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Symbol cross reference

TRK9	   287#	   630	   663	  1291	  3340
TUA	   281#
TUB	   282#
U	   514	   529	   532	   542	   581	   686	   952	   954	   957	   959	   960	   962	   964	   965
	   967	  1004	  1005	  1013	  1035	  1158	  1160	  1161	  1164	  1166	  1167	  1168	  1170	  1172
	  1187	  1435	  1436	  1454	  1456	  1496	  1585	  1777	  1805	  1841	  1939	  1945	  1962	  1965
	  1978	  2051	  2055	  2058	  2179	  2207	  2214	  2218	  2229	  2281	  2310	  2339	  2376	  2382
	  2458	  2474	  2645	  2659	  2785	  2789	  2791	  2809	  2810	  2813	  2814	  2835	  2838	  2840
	  2841	  2848	  2860	  2875	  2883	  2890	  2891	  2894	  2895	  3030	  3050	  3054	  3105	  3483
	  3485	  3497	  3527	  3549	  3572	  3622	  3625
UNICMD	    64%	   303	   304	   305	   306	   307	   308	   309	   310	   311	   550	   642	  1042	  1152
	  1154	  1167	  1170	  1172	  1277	  1278	  1350	  1356	  1754	  2013	  2015	  2018	  2107	  2208
	  2383	  2459	  2593	  2673	  2674	  2676	  2678	  2728	  2784	  2823	  2909	  3077	  3079	  3107
	  3110	  3166	  3256	  3329	  3370	  3556
UNIDC1	    65%	  1525	  1597	  1601	  1620	  1629	  1640	  2341	  2344	  2445	  2514	  2519	  3428	  3451
UNIDCN	    65%	  1558	  1564	  1655	  2446	  2522
UNIDCR	    65%	  2444	  2515
UNIDDB	    64%	   540	   962	   967	  1451
UNIDON	    64%	  2814	  2849	  3080
UNIERO	    64%	  3257	  3266	  3270	  3274	  3330	  3331	  3353	  3369	  3371	  3373	  3376	  3393	  3394
	  3400	  3401	  3405	  3416	  3574	  3576	  3584
UNIKNT	    64%	   518	   571	   681	   790	   807	   816	   824	  1270	  1289	  2586	  2589	  2620
UNILNK	    64%	   569	   678	   960	   965
UNISX1	    65%	  1453
UNISX2	    65%	  1455
UNISX3	    65%	  1457
UNITCK	   264#	  1467	  1474	  1485	  1903
UNITEX	   265#	  1467	  1573	  1733	  1736	  1747	  1765	  1959	  2036	  2053
UNITYP	    64%	   537	   574	   672	   797	   799	  1012	  1049	  1096	  1219	  1332	  2011	  2502	  2633
	  2711	  2933
W	  2647	  2657
WAIT1	    70%	   717	   740	   756	  1010	  1034	  1091	  1186	  1189	  1194	  1225	  1283
WRITE	   219#	  2946
WRPROT	   280#	  1052
WTM	   211#	   349
ZZ	   951#	   951	   969#	   969	  1004#	  1004	  1007#	  1007	  1020#	  1020	  1038#	  1038	  1045#	  1045
ZZ1	   951#	   951	   969#	   969	  1004#	  1004	  1007#	  1007	  1020#	  1020	  1038#	  1038	  1045#	  1045
FTASER -- CODE FOR SA-10 -- IBM 3803/3420 TAPES ON THE PDP-10.	MACRO 12.5-46.0 14:35 13-JAN-88
FTASER.MAC	25-NOV-87 15:39		Macro/Opdef cross reference

DSKOFF	   782#	   785
DSKON	   783#	   802	   834
IFNCPU	    20
PJRST	  1155	  1173	  1242	  1249	  2549	  2634
PXCT	   951	   969	  1004	  1007	  1020	  1038	  1045
PXGEN	   951	   969	  1004	  1007	  1020	  1038	  1045
STOPCD	    11	   909	   931	  2797	  2807	  2811	  2834	  3035	  3081
UHLRZ	  1038
UHRRZ	  1004
UMOVE	   951
UMOVEM	   969	  1020
WRPI	   785	   802	   834
XCTBU	  1004	  1038
XCTFU	   951
XCTTU	   969	  1007	  1020	  1045
$END	  3633  y )c
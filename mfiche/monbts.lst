MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KSSYM.MAC IN COMMON ONLY
     7					.CREF
     8									TAPE>>
     9				; This file is PRINTF.MAC
    10				DEFINE PRINTF(A,B,C,D),<IF2,<;;Output message on MONKS build only
    11				PRINTX A B C D>>
    12
    13				SUBTTL KS-10 PARAMETER DEFINTIONS FOR PDP-10 MONITOR
    14				.XCREF
    15
    16				;THIS MODULE ASSEMBLED WITH KS-10 PARAMETER FILE - KSIORG.MAC
    17
    18					IF2,<IFNDEF LISTSN,<		;LIST KSIORG.MAC IN COMMON ONLY
    19					.CREF
    20									TAPE>>
    21				TITLE	MONBTS - Monitor resident BOOTStrap
    22
    23					STOPCD(,ENTRY,MONBTS)^
    24					ENTRY	MONBTS		;For library searches
    25	000000'	260040	000000*	MONBTS::PUSHJ	P,DIE		;**** Default stopcode for "MONBTS" ****
    26	000001'	555756	426463		SIXBIT	/MONBTS/  	;Title of module
    27	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "MONBTS+nnn(nnnnnn)"
    28			000000'	S$NAME==MONBTS			;For STOPCDs with no arguments
    29					SALL>
    30				^
    31
    32				PRINTF(<[Need to implement BUGDMP for CRASH.EXE]>)
    33	000003'	260040	000000*	BUGDMP::PUSHJ	P,INLMES##	;Dump core into SYS:CRASH.EXE
    34					 ASCIZ /
    35	000004'	064250	252616	BUGDMP - No crash dump for this stopcode
	000005'	422332	020132
	000006'	202355	720306
	000007'	713036	364100
	000010'	623535	570100
	000011'	633376	220350
	000012'	643236	320346
	000013'	723376	061736
    36	000014'	623121	505000	/
    37	000015'	263040	000000		POPJ	P,		;Return to DIE in ERRCON
    38
    39	000016'	260040	000003'	REBOOT:	PUSHJ	P,BUGDMP	;Dump core into SYS:CRASH.EXE
    40	000017'	254000	000025'		JRST	NEWMON		;Reload the monitor
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

    41				SUBTTL	Load BOOTS from the disk
    42
    43				IFCPU(<KS,F3>),<EXTERN UPT.PN,EPT.PN	;Here from a 146 restart
    44	000020'	700600	000400	BOTLOD::SYSPIF			;Turn off PI system
    45	000021'	701140	000226'		WRUBR	[LG.LAB+LG.LUB+0B8+0B11+400000+UPT.PN];Select AC block 0
    46	000022'	701200	000000*		WREBR	EPT.PN		;Turn off paging (bit 22 is off)
    47	000023'	402000	000000*		SETZM	BTSTR##		;Flag to not do /D
    48				IFCPU (F3),<TNCONO 0>		;Reset interface to node
    49				IFCPU (F3),<DATAO PI,[-1]>	;Turn on all the lights
    50				IFNCPU(KS),<WRADB [0]>		;Clear address break
    51	000024'	200040	000000*		MOVE	P,.CPEPD##	;Reset stack
    52					PFALL	NEWMON
    53				> ;END IFCPU(<KS,F3>)
    54
    55			775000		BOOTS=:1000000-3000	;BOOTS resides in the top 3 pages of core
    56
    57	000025'	201200	775000	NEWMON::MOVEI	F,BOOTS		;Load BOOTS into pages 775,776,777
    58	000026'	542200	000062'		HRRM	F,BOOTCL	; ...
    59
    60				IFCPU(<KI,KL>),<;LOOK FOR BOOTS ON 3330 DRIVES.
    61					MOVSI	J,-7		;INIT CHANNEL COUNTER
    62				BPBR0:	SETZ	W,		;INITIAL DEVICE
    63				BPBR2:	MOVE	PG,BTADR	;<# OF WORDS,,DISK PAGE ADDR> FOR BOOTS
    64					HRRZ	F,BOOTCL	;BOOTS CORE ADDRESS (as set up by CRSDEV)
    65					PUSHJ	P,SAXPRD	;PROCURE BOOTS
    66					 JRST	BPBR		;COULD NOT GET IT
    67					JSP	T4,ISBOOT	;HAS BOOTS BEEN LOADED?
    68				BPBR:	MOVEI	W,1(M)		;NO: INCREMENT DEVICE COUNTER
    69					CAIG	W,77		;HAS MAXIMUM BEEN REACHED?
    70					 JRST	BPBR2		;NO: TRY NEXT UNIT
    71					AOBJN	J,BPBR0		;CONTINUE IF MORE CHANNELS TO TRY
    72					JRST	BOTLOD##	;Try the paper-tape/DECtape routine, BOTLOD.MAC
    73				> ;END IFCPU(<KI,KL>)
    74
    75				IFCPU (<KS,F3>),<;READ BOOTS FROM KS OR F3 UNITS
    76	000027'	205500	777770		MOVSI	W,-8		;INIT UNIT COUNTER
    77	000030'	200140	000061'	RMXPBT:	MOVE	PG,BTADR	;<# OF WORDS,,DISK PAGE ADDR> FOR BOOTS
    78	000031'	550200	000062'		HRRZ	F,BOOTCL	;BOOTS CORE ADDRESS (as set up by BTPREP)
    79				IFCPU(F3),<PUSHJ P,APXPRD>
    80	000032'	260040	000115'	IFCPU(KS),<PUSHJ P,RMXPRD>
    81	000033'	334000	000000		  SKIPA			;FAILED
    82	000034'	265440	000050'		JSP	T4,ISBOOT	;GOT SOMETHING, SEE IF BOOTS
    83	000035'	253500	000030'		AOBJN	W,RMXPBT	;NOT BOOTS, TRY NEXT UNIT IF ONE
    84				IFCPU (KS),<
    85	000036'	205500	777770		MOVSI	W,-8		;Try alternate location
    86	000037'	200140	000227'	RMXBT1:	MOVE	PG,[1600,,11]	;Location of KS boots prior to P034/P20
    87	000040'	550200	000062'		HRRZ	F,BOOTCL	;Core address
    88	000041'	260040	000115'		PUSHJ	P,RMXPRD
    89	000042'	334000	000000		  SKIPA			;Not there either
    90	000043'	265440	000050'		JSP	T4,ISBOOT	;Double check
    91	000044'	253500	000037'		AOBJN	W,RMXBT1
    92				> ;END IFCPU(KS)
    93	000045'	201600	000230'	NOBOOT:	MOVEI	P1,[ASCIZ / ?Can't read BOOTS!! /]
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 2-2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

    94	000046'	265300	000000*		JSP	T1,CTYTYP##	;Type out message
    95	000047'	254200	000020'		HALT	BOTLOD		;Can't find BOOTS anywhere
    96				> ;END IFCPU(<KS,F3>)
    97
    98	000050'	550340	000062'	ISBOOT:	HRRZ	T2,BOOTCL	;GET BOOTS STARTING ADDR
    99	000051'	200407	000000		MOVE	T3,(T2)		;GET FIRST WORD OF BOOTS
   100	000052'	312400	000064'		CAME	T3,BOOTFI	;IS IT CORRECT?
   101	000053'	254011	000000		 JRST	(T4)		;NO: RETURN
   102					MOVEI	P1,[ASCIZ /
   103				"BOOTS loaded"
   104	000054'	201600	000235'	  /]
   105	000055'	265300	000046*		JSP	T1,CTYTYP##	;TYPE OUT MESSAGE
   106	000056'	201040	000023*		MOVEI	1,BTSTR##	;GET ADDR OF BOOTS COMMAND STRING
   107	000057'	550100	000062'		HRRZ	2,BOOTCL	;GET BOOTS STARTING ADDR
   108	000060'	254002	000005		JRST	5(2)		;PASS CONTROL TO BOOTS
   109
   110			002600	BCDSZ==3000-200			;SIZE OF BOOTS CODE (was 7 blocks)
   111			003000	BCDSSZ==BCDSZ+200		;SIZE OF BOOTS + SAX SAVE AREA
   112	000061'	002600	000003	BTADR:	BCDSZ,,3		;SIZE OF BOOTS, DISK ADDR
   113	000062'	775200	775000	BOOTCL:	XWD -BCDSZ,BOOTS
   114	000063'	000000	000000		0
   115
   116	000064'	700200	200000	BOOTFI:	WRAPR	200000		;First word of BOOTS is CONO APR,200000
   117
   118
   119				;PRIMITIVE DISK READ SET UP AND DISPATCH
   120	000065'	260040	000073'	PMDRD::	PUSHJ	P,PMDSET	;SET UP TO READ
   121	000066'	550306	000101'		HRRZ	T1,PMDDSP(T1)	;GET READ ADDRESS
   122	000067'	324746	000000		PJRST	(T1)		;READ FROM SELECTED UNIT
   123
   124				;PRIMITIVE DISK WRITE SET UP AND DISPATCH
   125	000070'	260040	000073'	PMDWT::	PUSHJ	P,PMDSET	;SET UP TO WRITE
   126	000071'	554306	000101'		HLRZ	T1,PMDDSP(T1)	;GET WRITE ADDRESS
   127	000072'	324746	000000		PJRST	(T1)		;WRITE TO SELECTED UNIT
   128
   129				;SET UP FOR PRIMITIVE DISK ROUTINES
   130	000073'	135100	000000*	PMDSET:	LDB	J,UNYSCN##	;GET CHANNEL NUMBER
   131	000074'	135500	000000*		LDB	W,UNYPUN##	;GET UNIT NUMBER OFFSET
   132	000075'	135300	000000*		LDB	T1,UNYKTP##	;GET DEVICE TYPE
   133	000076'	607140	777777		TLNN	PG,-1		;IS # OF WORDS SPECIFIED?
   134	000077'	661140	001000		 TLO	PG,1000		;NO: DEFAULT TO ONE PAGE
   135				IFCPU(<KI,KL>),<
   136					LDB	T2,UNYBPR##	;Get blocks per record
   137					CAIE	T2,4		;Record size set to 4 blocks to a page
   138					SKIPGE	UNICHR##(U)	;Formatted in pages? (sign bit set)
   139					 JRST	PMDST1		;Yes, formatted in pages
   140					MOVEI	T2,200		;Formatted in blocks if UNICHR is positive
   141					MOVEM	T2,SAWPR	;Words per record
   142					LDB	T2,UNYBPT##	;Blocks per track
   143					MOVEM	T2,SARPT	;Records per track
   144					LDB	T2,UNYBPY##	;Blocks per track
   145					MOVEM	T2,SARPC	;Records per cylinder
   146					POPJ	P,
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 2-3
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   147				PMDST1:	MOVEI	T2,1000		;Formatted in pages if UNICHR is negative
   148					MOVEM	T2,SAWPR	;Words per record
   149					LDB	T2,UNYPPT##	;Pages per track
   150					MOVEM	T2,SARPT	;Records per track
   151					LDB	T2,UNYPPY##	;Pages per cylinder
   152					MOVEM	T2,SARPC	;Records per cylinder
   153				>  ;End IFCPU(KI,KL)
   154	000100'	263040	000000		POPJ	P,
   155
   156				;PRIMITIVE DRIVER DISPATCH TABLE
   157	000101'			PMDDSP:	;WRITER,,READER
   158	000101'	000110'	000110'		XWD BADPWT,BADPRD	;0  DR
   159	000102'	000110'	000110'		XWD BADPWT,BADPRD	;1  FH
   160	000103'	000110'	000110'		XWD BADPWT,BADPRD	;2  DP
   161	000104'	000110'	000110'		XWD BADPWT,BADPRD	;3  MD
   162	000105'	000110'	000110'		XWD SAXPWT,SAXPRD	;4  SAX
   163	000106'	000116'	000115'		XWD RMXPWT,RMXPRD	;5  RM/RP
   164	000107'	000110'	000110'		XWD APXPWT,APXPRD	;6  F3 CDC/AMPEX DRIVES
   165
   166				IFNCPU(KS),<RMXPWT: RMXPRD:>
   167	000110'			IFNCPU(F3),<APXPWT: APXPRD:>
   168	000110'			IFNCPU(<KI,KL>),<SAXPWT: SAXPRD:>
   169	000110'			BADPWT:
   170				BADPRD:	MOVEI	P1,[ASCIZ /?Unit data block messed up
   171	000110'	201600	000242'	/]
   172	000111'	265300	000055*		JSP	T1,CTYTYP##
   173	000112'	263040	000000		POPJ	P,
   174	000113'	350001	000000	CPOPJ1:	AOS	(P)		;SKIP RETURN
   175	000114'	263040	000000	CPOPJ:	POPJ	P,		;NO SKIP RETURN
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 3
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   176				IFCPU(<KI,KL>),<SUBTTL	Primitive READ/WRITE routines for SA-10
   177				
   178				COMMENT !PRIMITIVE ROUTINES TO READ OR WRITE A SPECIFIED NUMBER OF
   179					 WORDS STARTING AT AN ARBITRARY DISK PAGE FROM/TO ANY 3330
   180					 TYPE DRIVE CONNECTED TO AN SA-10.
   181					 PARAMETERS:	PG/ # OF WORDS,,DISK PAGE
   182							F/ CORE ADDR (NOT NECESSARILY ON PG BOUNDARY)
   183							J/ 1B33  SA-10
   184							   3B35  SUB-CHANNEL
   185							W/ UNIT
   186					 CALL:	PUSHJ P,SAXPRD  TO READ
   187						PUSHJ P,SAXPWT  TO WRITE
   188					 RETURN:	SUCCESS: M=W, SKIP RETURN
   189							ERROR: NON-SKIP RETURN
   190							       M=W OR 77  IF CHANNEL NOT AVAILABLE
   191								=W OR 7  IF NO MORE UNITS ON THIS
   192									 KONTROLLER
   193								=W  IF UNIT NUMBER GOOD BUT OTHER ERROR
   194					 ACS ALTERED:	T1-T4,M,P1-P3
   195				!
   196				
   197				SAXPWT:	MOVEI	P1,SAXWCD
   198					SKIPA
   199				SAXPRD:	MOVEI	P1,SAXRCD
   200					DPB	P1,SAYBB	;STORE READ OR WRITE CODE
   201				    ;STORE DEVICE ADDRESS IN COMMANDS.
   202					MOVEI	T1,SAUN0(W)	;COMPUTE DEVICE ADDRESS
   203					MOVE	M,[POINT 8,SACLST,23] ;B HOLDS PNTR.
   204					DPB	T1,M		;DEV ADDR TO SEEK
   205					HRRI	M,2(M)		;
   206					DPB	T1,M		;DEV ADDR TO SEARCH ID EQUAL.
   207					HRRI	M,3(M)		;
   208					DPB	T1,M		;DEV ADDR TO READ/WRITE CMD.
   209				
   210					MOVN	T1,SAWPR	;Negative of words per record
   211					LSH	T1,^D24		;Put in bits 0-11, zero bits 12-17
   212					HRR	T1,F		;Physical address (24 bits)
   213					MOVEM	T1,SACADR	;SET INIT DESTINATION ADDR
   214				
   215				;PG has # of words in LH, disk page address in RH
   216				
   217					SETZ	P3,		;INIT RECORD INDEX
   218				NEXREC:	HRRZ	T1,PG		;COPY PAGE NUM
   219					LSH	T1,P2WLSH	;PAGES TO WORDS
   220					IDIV	T1,SAWPR	;CONVERT TO RECORD NUM
   221					ADD	T1,P3		;COMPUTE CURRENT RECORD NUM
   222					IDIV	T1,SARPC	;COMPUTE CYLINDER,
   223					IDIV	T2,SARPT	; HEAD,
   224					ADDI	T3,1		; AND RECORD NUMBERS
   225					DPB	T1,SAYCC	;STORE CYLINDER NUMBER
   226					DPB	T2,SAYCC+1	;STORE HEAD NUMBER
   227					DPB	T3,SAYCC+2	;STORE RECORD NUMBER
   228				
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 3-2
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   229					MOVEI	P1,SAX1AD	;GET ADDR OF SA-10 1
   230					TRNE	J,4		;SKIP IF SELECTED SA-10
   231					 MOVEI	P1,SAX2AD	;GET ADDR OF SA-10 2
   232					HRRZ	M,J		;WHICH SA-10?
   233					LSH	M,2
   234					ADDI	M,SAXREG	;NOW HAVE BASE FOR THIS CHANNEL
   235					MOVEI	T1,SACLST
   236					HRLI	T1,200000	;TIC COMMAND
   237					MOVEM	T1,(M)		;STORE IN BASE AREA
   238					MOVEI	P2,1		;SET A UNIQUE BIT IN P2 THAT CORR. TO
   239					LSH	P2,(J)		; THE SA-10, SUB-CHAN BEING REFERENCED
   240					TDNE	P2,CHNFLG	;DO WE KNOW ITS NOT THERE
   241					 JRST	STRT4A		;YES, GIVE UP ON IT
   242					MOVEI	T1,21
   243					SETCMI	T2,(J)
   244					ORI	T2,-4		;ZERO EXTRANEOUS BIT IF SET
   245					LSH	T1,7(T2)	;SET UP BIT FOR STAT FLAG FOR THIS CHAN
   246					SETCA	T2,		;RECOVER CHANNEL NUMBER
   247					LSH	T2,3		;CONVERT TO CORRECT POSITION FOR CONO
   248					HRL	T2,T1		;SAVE STATUS BIT IN LEFT HALF
   249				RESTAR:	PUSHJ	P,IOCNI		;READ STATUS
   250					JUMPE	T4,STRT4	;JUMP IF SA-10 IS MISSING
   251					MOVEI	T1,640(T2)
   252					PUSHJ	P,IOCNO		;SET STATUS BIT
   253					MOVEI	T1,440(T2)
   254					PUSHJ	P,IOCNO		;AND GO FLAG
   255					MOVEI	T1,600(T2)
   256					PUSHJ	P,IOCNO		;AND THEN CLEAR STATUS
   257					MOVEI	T4,^D100000
   258					HLRZ	T1,T2		;GET STATUS BIT
   259					PUSHJ	P,IOCNSO	;AND DO THE CONSO
   260					 SOJG	T4,.-1
   261					JUMPE	T4,STRT4	;JUMP ON TIMEOUT
   262					MOVE	T4,1(M)		;GET STATUS
   263					TLNE	T4,(1B2)
   264					 JRST	STRT4A		;SELECT ERROR
   265					MOVEI	T1,400000	;IN CASE WE HAVE TO RESET
   266					TLNN	T4,BSY
   267					 JRST	STRT3		;NOT BUSY
   268					TLNE	T4,SM		;BUSY+STATUS MODIFIER?
   269					 JRST	STRT2		;YES
   270					TLNE	T4,CUE
   271					 JRST	RESTAR		;JUMP ON BUSY+CU END
   272				STRT3:	TLNN	T4,CE+DE	;CHANNEL END AND DEVICE END?
   273					 JRST	STRT5		;NO. ERROR
   274					TLNN	T4,175114	;OTHER ERRORS?
   275					 JRST	NEXRC1		;THIS RECORD PROC. OK, CONTINUE
   276				STRT5:	PUSHJ	P,IOCNO		;T1 IS LOADED WITH BIT 18
   277					HRRZ	M,W		;UNIT NUM SUPPLIED WAS GOOD
   278					POPJ	P,
   279				
   280				STRT4:	IORM	P2,CHNFLG	;MARK CHANNEL NOT THERE
   281					MOVEI	T1,77		;AND WORD FOR BAD CHANNEL
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 3-3
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   282					SKIPA
   283				STRT4A:	MOVEI	T1,7		;AND WORD FOR NO MORE DEV ON KONT
   284					MOVE	M,W		;COPY UNIT NUMBER
   285					TDO	M,T1		;SET TO TOP OF MULT OF 10
   286					POPJ	P,
   287				
   288				STRT2:	MOVEI	T1,600(T2)
   289					PUSHJ	P,IOCNO		;CLEAR STATUS
   290					HLR	T1,T2		;NO WAIT FOR STATUS BIT
   291					PUSHJ	P,IOCNSO
   292					 JRST	.-1
   293					MOVE	T4,1(M)
   294					TLNE	T4,CUE
   295					 JRST	RESTAR
   296					JRST	STRT2
   297				
   298				NEXRC1:	MOVE	T1,SAWPR	;LOAD RECORD SIZE
   299					ADDM	T1,SACADR	;POINT TO NEXT RECORD LOCATION IN CORE
   300					ADDI	P3,1		;INCREMENT RECORD COUNTER
   301					HLRZ	T1,PG		;Get requested number of words
   302					IDIV	T1,SAWPR	;Convert to number of records
   303					CAMGE	P3,T1		;Done all of them?
   304					 JRST	NEXREC		;NO: DO NEXT RECORD
   305					MOVE	M,W		;UNIT NUM SUPPLIED WAS GOOD
   306					JRST	CPOPJ1		;SUCCESS RETURN
   307				
   308				IOCNSO:	MOVSI	T3,(CONSO (T1))	;SETUP IO INSTR.
   309				IOXCT:	DPB	P1,[POINT 7,T3,9];PUT IN I/O DEVICE FIELD
   310					XCT	T3		;DO THE IO
   311					 POPJ	P,		;NO SKIP RETURN
   312					JRST	CPOPJ1
   313				
   314				IOCNI:	SKIPA	T3,[CONI T4]	;FOR SA-10
   315				IOCNO:	MOVSI	T3,(CONO (T1))
   316					JRST	IOXCT
   317				
   318				; SA-10 COMMAND LIST AND DEFINITIONS
   319				
   320				CMDLST:
   321				SACLST:	BYTE	(8)72,7		;SEEK
   322					BYTE	(12)-6(24)SACARG
   323				SACIDE:	BYTE	(8)73,61	;SEARCH ID EQUAL
   324					BYTE	(12)-5(24)SACARG
   325				SACTIC:	XWD	200000,SACIDE	;TIC
   326				SACCMD:	BYTE	(8)160		;READ OR WRITE
   327				SACADR:	BYTE	(12)-1(24)0	;-WORD COUNT(SAWPR), START ADDRESS
   328					0			;Zero terminates command list
   329				
   330				SACARG:	BLOCK	2		;SEEK/SEARCH BLOCK
   331				
   332				SAYBB:	POINT	8,SACCMD,15
   333				SAYCC:	POINT	32,SACARG,31
   334					POINT	16,SACARG+1,15
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 3-4
MONBTS.MAC	20-SEP-87 13:43		Load BOOTS from the disk

   335					POINT	8,SACARG+1,23
   336				
   337				CHNFLG:	Z			;DEFECTIVE CHANNEL FLAG WORD
   338				
   339				;These 3 locations will be updated by PMDSET to the correct values
   340				; The values here are defaults for loading BOOTS from 3330 formatted in blocks.
   341				; Note that if the disk does not match these values, control will eventually
   342				; go to BOTLOD, which is capable of reading all four formats.
   343				SAWPR:	DEC 128		;Words per record       ( 512, 512, 128)
   344				SARPT:	DEC  18		;Records per track      (   5,   7,  25)
   345				SARPC:	DEC 18*19-2	;Records per cylinder   (5*19,7*30,25*30-2)
   346				
   347				SAXWCD==5	;Disk write code
   348				SAXRCD==6	;Disk read code
   349				SAUN0==300	;Unit 0 at X'C0'
   350				SAXREG==300
   351				SAX1AD==274_-2		;SA-10 1
   352				SAX2AD==400_-2		;SA-10 2
   353				BSY==(BYTE (8)0,20)
   354				CUE==(BYTE (8)0,40)
   355				SM==(BYTE (8)0,100)
   356				CE==(BYTE (8)0,10)
   357				DE==(BYTE (8)0,4)
   358				> ;END IFCPU(<KI,KL>)
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 4
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   359				IFCPU (KS),<SUBTTL	Primitive READ/WRITE routines for RM03/RP06
   360
   361				COMMENT	!PRIMITIVE ROUTINES TO READ OR WRITE A SPECIFIED NUMBER OF
   362					 WORDS STARTING AT AN ARBITRARY DISK PAGE FROM/TO AN
   363					 RM03/RP06 DISK DRIVE INTERFACED TO A KS THRU A UBA.
   364					 PARAMETERS:	PG/ # OF WORDS,,DISK PAGE
   365							F/ CORE ADDR (NOT NECESSARILY ON PAGE BOUNDARY)
   366							W/ UNIT
   367					 CALL:	PUSHJ P,RMXPRD	TO READ
   368						PUSHJ P,RMXPWT	TO WRITE
   369					 RETURN:	SUCCESS: SKIP
   370							FAILURE: NON-SKIP
   371					 ACS ALTERED:	T1-T4,P1-P2
   372				!
   373
   374				DEFINE	RDREG(DEST,REG)	;EXPECTS THE UBA NUMBER IN T2
   375				<	RDIO	DEG'ADR(T2)>
   376
   377				DEFINE	WRREG(SRC,REG)	;EXPECTS THE UBA NUMBER IN T2
   378				<	WRIO	SRC,REG'ADR(T2)>
   379
   380
   381	000115'	334600	000250'	RMXPRD:	SKIPA	P1,[F.RD]	;DO DISK READ
   382	000116'	201600	000061	RMXPWT:	MOVEI	P1,F.WD		;DO DISK WRITE
   383	000117'	515340	000001		HRLZI	T2,UA1	;SET THE ADDRESS TO UBA1
   384	000120'	201400	000040		MOVEI T3,CS2CLR
   385	000121'	713407	776710		WRREG T3,CS2;			CLEAR RH11
   386	000122'	713507	776710		WRREG W,CS2;			SELECT UNIT
   387	000123'	712447	776712		RDREG T4,DS;			DRIVE EXISTS?
   388	000124'	712407	776710		RDREG T3,CS2
   389	000125'	606400	010000		TRNN T3,CS2NED
   390	000126'	606440	010000		  TRNN T4,DSMOL
   391	000127'	263040	000000		   POPJ	P,
   392	000130'	201440	000021		MOVEI T4,F.RIP			;READ IN PRESET
   393	000131'	713447	776700		WRREG T4,CS1
   394	000132'	201440	303240		MOVEI T4,^D100000
   395	000133'	201400	000200		MOVEI T3,DSDRY		;WAIT UNTIL INITIALIZATION DONE
   396	000134'	711407	776712		TION  T3,DSADR(T2)
   397	000135'	367440	000134'		  SOJG T4,.-1
   398	000136'	323440	000225'		JUMPLE	T4,RMPOPJ
   399	000137'	712447	776712		RDREG T4,DS
   400	000140'	602440	040000		TRNE T4,DSERR
   401	000141'	263040	000000		  POPJ	P,
   402	000142'	201440	000007		MOVEI T4,F.RECA
   403	000143'	713447	776700		WRREG T4,CS1;			ISSUE RECALIBRATE
   404	000144'	201400	303240		MOVEI T3,^D100000
   405	000145'	712447	776712		RDREG T4,DS
   406	000146'	606440	000200		TRNN T4,DSDRY
   407	000147'	367400	000145'		 SOJG T3,.-2
   408	000150'	323400	000225'		JUMPLE T3,RMPOPJ
   409	000151'	602440	040000		TRNE T4,DSERR
   410	000152'	263040	000000		 POPJ	P,
   411				;TRY UNIT
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 4-2
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   412	000153'	712647	776726		RDREG	P2,DT
   413	000154'	405640	000002		ANDI	P2,2		;Adr is function of unit type.
   414	000155'	242640	777777		LSH	P2,-1		;0:RM03, 1:RP06
   415	000156'	201300	000224		MOVEI	T1,^D148	;CALCULATE
   416	000157'	302640	000000		CAIE	P2,0		; ABSOLUTE
   417	000160'	201300	000574		 MOVEI	T1,^D380	; DISK
   418	000161'	550400	000003		HRRZ	T3,PG		; SECTOR
   419	000162'	242400	000002		LSH	T3,2		; ADDR
   420	000163'	230400	000006		IDIV	T3,T1		; FROM
   421	000164'	713407	776734		WRREG	(T3,DC)		; UNIT
   422	000165'	200400	000011		MOVE	T3,T4		; RELATIVE
   423	000166'	201300	000036		MOVEI	T1,^D30		; PAGE
   424	000167'	302640	000000		CAIE	P2,0		; NUMBER
   425	000170'	201300	000024		MOVEI	T1,^D20		; AND
   426	000171'	230400	000006		IDIV	T3,T1		; PASS
   427	000172'	137400	000251'		DPB	T3,[POINT 5,T4,27]	; TO
   428	000173'	713447	776706		WRREG	(T4,DA)		; DRIVE
   429	000174'	554400	000003		HLRZ	T3,PG		;SET WORD COUNT
   430	000175'	242400	000001		LSH	T3,1		;(2 UNIBUS words per KS10 word)
   431	000176'	213000	000010		MOVNS	T3
   432	000177'	713407	776702		WRREG T3,WC
   433	000200'	200440	000004		MOVE T4,F		;SET VIRTUAL CORE ADDRESS
   434	000201'	400400	000000		SETZ T3,		;SET VIRTUAL CORE ADR
   435	000202'	245400	777767		ROTC T3,-9
   436	000203'	241400	000013		ROT T3,13
   437	000204'	713407	776704		WRREG T3,BA
   438	000205'	200400	000252'		MOVE T3,[UA1,,PGRADR]
   439	000206'	660440	140000		TRO T4,PGRFST+PGRVAL		;SET PHYSICAL CORE ADR
   440	000207'	713460	000010		WRIO T4,@T3
   441	000210'	340440	000000		AOJ T4,
   442	000211'	340400	000000		AOJ T3,
   443	000212'	713460	000010		WRIO T4,@T3
   444	000213'	713607	776700		WRREG P1,CS1
   445	000214'	201400	000144		movei	t3,^D100	;busy wait loop index
   446	000215'	201440	003720	rmp1:	movei	t4,^D2000	;bus saturation avoidance loop index
   447	000216'	367440	000216'		sojg	t4,.		;only do read every few ms to avoid
   448								; saturating the bus
   449	000217'	712447	776700		RDREG T4,CS1
   450	000220'	606440	000200		TRNN T4,CS1RDY		;done?
   451	000221'	367400	000215'		 sojg	t3,rmp1		;no, try again if haven't timed out
   452	000222'	323400	000225'		JUMPLE	T3,RMPOPJ
   453	000223'	606440	040000		TRNN	T4,CS1TRE	;ANY ERRORS?
   454	000224'	350001	000000		AOS	(P)		;NO: READ/WRITE SUCCEEDED
   455	000225'	263040	000000	RMPOPJ:	POPJ	P,
   456				>;END IFCPU KS
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 5
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   457				IFCPU(F3),<	SUBTTL	Primitive READ/WRITE routines for FOONLY
   458				
   459				RTYCNT==20000
   460				
   461				DRVTYP==CDC
   462				CDC==1
   463				AMPEX==0
   464				
   465				IFE DRVTYP-CDC,<
   466				SPT==^D8		;SECTORS PER TRACK (DEPENDS ON HOW FORMATTED)
   467				TPC==^D10		;TRACKS PER CYLINDER (NUMBER OF HEADS)
   468				CPU==^D823-^D10		;CYLINDERS PER UNIT (TAKE AWAY SOME FOR MAINTAINENCE)
   469				>
   470				IFE DRVTYP-AMPEX,<
   471				SPT==^D8		;SECTORS PER TRACK
   472				TPC==^D5		;TRACKS PER CYL (NUMBER OF HEADS)
   473				CPU==^D815-^D5		;CYLINDERS PER UNIT (TAKE AWAY SOME FOR MAINTAINENCE)
   474				>;END IFN AMPEX
   475				PPC==SPT*TPC		;PAGES PER CYLINDER
   476				BPC==PPC*4		;BLOCKS PER CYLINDER
   477				PPU==PPC*CPU		;PAGES PER UNIT
   478				SPT==^D8		;SECTORS PER TRACK
   479				BPT==SPT*^D4		;BLOCKS PER TRACK
   480				USPR==^D17300		;MICROSECONDS PER REVOLUTION.
   481				
   482				;DISK IOTS AND REGISTER BIT NAMES.
   483				PRINTF(<[F3 disk definitions are duplicated in MONBTS and APXKON]>)
   484				
   485				OPDEF RCMD	[715000000000]	;READ COMMAND REGISTER
   486					SUNT==1B0		;SELECTED UNIT NOT THERE (SELECT ERROR)
   487					SUWP==1B1		;SELECTED UNIT WRITE PROTECT
   488					SUNR==1B2		;SELECTED UNIT NOT READY
   489				;---
   490					SUOC==1B3		;SELECTED UNIT ON CYLINDER
   491								; SHOULD ALWAYS BE SET EXCEPT AFTER RECAL UNTIL HEADS ALIGN
   492					SUSE==1B4		;SELECTED UNIT SEEK ERROR (DETECTED BY DRIVE)
   493								; RECAL MANDATORY AFTER THIS ERROR, FAULT CLEAR WILL NOT TURN T
   494				HIS OFF.
   495					SUF==1B5		;SELECTED UNIT FAULT (DETECTED BY DRIVE)
   496				;---
   497					SUA==1B6		;SELECTED UNIT ATTENTION
   498								; SET BY LEADING EDGE OF ON CYLINDER (BIT 3)
   499					HDECC==1B7		;ECC ERROR ON HEADER
   500					CI==1B8			;CONTROL IDLE (ONLY IF NO DATA XFER AND NO SEEKS OR RECALS GOIN
   501				G)
   502				;---
   503					SECC==1B9		;SOFT ECC ERROR (NOT YET IMPLEMENTED IN F3 MICROCODE)
   504					HECC==1B10		;ECC UNRECOVERABLE ERROR
   505				
   506				;FOLLOWING BITS ARE DETECTED BY CONTROLLER:
   507					ROE==1B11		;READ OVERRUN ERROR
   508				;---
   509					WOE==1B12		;WRITE OVERRUN ERROR
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 5-2
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   510					SOE==1B13		;SECTOR OVERRUN ERROR
   511					IPE==1B14		;INTERNAL PARITY ERROR (ONLY VALID IF AE, BIT 28, IS ZERO)
   512				;---
   513				
   514				;FOLLOWING ARE FROM LAST LCMD
   515				
   516					USC==1B15		;USE SECTOR COUNTER (FOR RPS, TELLS
   517								; CONTROLLER TO LISTEN TO DRIVE POSITION)
   518					REL==1B16		;RELEASE (FOR MULTI-PROCESSOR INTERLOCKING)
   519					RECAL==1B17		;RECALIBRATE (RESETS SEEK ERROR) (USE WITH COMMAND 4)
   520				;---
   521					FC==1B18		;FAULT CLEAR (RESETS SEL UNIT FAULT - USE COMMAND 4)
   522				;	19 UNUSED
   523				;	20 UNUSED
   524				;---
   525					SOM==1B21		;SERVO OFFSET MINUS
   526					SOP==1B22		;SERVO OFFSET PLUS (OFFSET ONLY ON AMPEX DRIVES, NOT CDC)
   527					CFM==1B23		;COMMAND FROM MEMORY
   528								; SENDS DATA FROM MEMORY TO DISK (USE WITH WRITE COMMANDS)
   529				;---
   530					CMD0==1B24		;COMMAND BITS
   531					CMD1==1B25
   532					CMD2==1B26
   533				;---
   534					CMD32==1B27		;32 BIT MODE PACKING
   535						READ==0B26		;READ PAGE
   536						WRITE==CFM+1B26	;WRITE PAGE (WITH CFM FOR CONVENIENCE)
   537						WRITEA==3B26	;WRITE ALL (SECTOR AND FORMAT DATA)
   538						CF==4B26		;CONTROL FUNCTION
   539				;		SEEK==5B26		;SEEK. (NOT IMPLEMENTED YET . . .)
   540				
   541				;END OF FROM RCMD BITS
   542					AE==1B28		;ANY  ERROR (EXCEPT IPE, BIT 14)
   543					AA==1B29		;ANY UNIT ATTENTION
   544				;---
   545				
   546				;FROM LCMD
   547					AAIE==1B30		;ANY ATTENTION INTERRUPT ENABLE
   548				
   549					NA==1B31		;NOT ACTIVE
   550					DIE==1B32		;DONE INTERRUPT ENABLE (SET BY DCONO WITH NOZERO PI ASSIGNMENT)
   551				
   552				;---
   553				;BITS 33, 34 NOT IMPLEMENTED.
   554				
   555					MPE==1B35		;MEMORY PARITY ERROR
   556				;---
   557				OPDEF RMA	[716000000000]	;READ MEMORY ADDRESS
   558				OPDEF RDA	[717000000000]	;READ DISK ADDRESS (IN PAGES)
   559					AMSUNI==^D3		;SIZE OF UNIT BYTE
   560					AMPUNI==^D6		;RIGHTMOST BIT
   561					ROTUNI==-<AMPUNI+1>	;NUMBER OF PLACES TO ROTATE TO GET UNIT FIELD IN
   562					AMSCYL==^D12
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 5-3
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   563					AMPCYL==^D19
   564					AMSTRK==^D8
   565					AMPTRK==^D27
   566					AMSSEC==^D8
   567					AMPSEC==^D35
   568					LDAMSK==034000,,177400	;MASK FOR $0% AND $0O IN DDT
   569				OPDEF RECC	[720000000000]	;READ CONTROL REGISTER
   570				OPDEF LCMD	[721000000000]	;LOAD COMMAND REGISTER
   571					USC==1B15		;USE SECTOR COUNTER (FOR RPS, TELLS
   572								; CONTROLLER TO LISTEN TO DRIVE POSITION)
   573					REL==1B16		;RELEASE (FOR MULTI-PROCESSOR INTERLOCKING)
   574					RECAL==1B17		;RECALIBRATE (RESETS SEEK ERROR) (USE WITH COMMAND 4)
   575					FC==1B18		;FAULT CLEAR (RESETS SEL UNIT FAULT - USE COMMAND 4)
   576					SOM==1B21		;SERVO OFFSET MINUS
   577					SOP==1B22		;SERVO OFFSET PLUS (OFFSET ONLY ON AMPEX DRIVES, NOT CDC)
   578					CFM==1B23		;COMMAND FROM MEMORY
   579								; SENDS DATA FROM MEMORY TO DISK (USE WITH WRITE COMMANDS)
   580					CMD0==1B24		;COMMAND BITS
   581					CMD1==1B25
   582					CMD2==1B26
   583					CMD32==1B27		;32 BIT MODE PACKING
   584						READ==0B26		;READ PAGE
   585						WRITE==CFM+1B26	;WRITE PAGE (WITH CFM FOR CONVENIENCE)
   586						WRITEA==3B26	;WRITE ALL (SECTOR AND FORMAT DATA)
   587						CF==4B26		;CONTROL FUNCTION
   588				;		SEEK==5B26		;SEEK. (NOT IMPLEMENTED YET . . .)
   589					AAIE==1B30		;ANY ATTENTION INTERRUPT ENABLE
   590					DIE==1B32		;DONE INTERRUPT ENABLE (SET BY DCONO WITH NOZERO PI ASSIGNMENT)
   591				
   592				OPDEF LMA	[722000000000]	;LOAD MEMORY ADDRESS
   593				OPDEF LDA	[723000000000]	;LOAD DISK ADDRESS
   594					SU==1B7			;SELECT UNIT
   595								;MUST BE CLEARED AND SET TO SELECT A UNIT.
   596				OPDEF LECC	[724000000000]	;CLEARS ECC LOGIC, STARTS AND INITS CONTROL.
   597					SC==1			;START CONTROL
   598					IC==2			;INIT CONTROL (SEND BEFORE STARTING CMD)
   599				OPDEF DCONO	[740000000000]	;CONO TO DISK CONTROL TO SET PI ASSIGNMENT
   600				OPDEF DCONI	[741000000000]	;CONI FROM DISK CONTROL OPCODE
   601					DIDLE==10		;SET IF CONTROL IS IDLE
   602					DPIA==7B35		;PI ASSIGNMENT.
   603								;NOTE THAT NONZERO PI ASSIGNMENT SETS DIE (SEE LCMD)
   604				OPDEF DCONSO	[742000000000]
   605				OPDEF DCONSZ	[743000000000]
   606				
   607				;ROUTINE TO START A FUNCTION UP ON CONTROL
   608				
   609				DOKON:	LECC	[IC]		;INIT CONTROL
   610					LCMD	T1		;DO THE COMMAND
   611					LECC	[SC]		;START CONTROLLER
   612					POPJ	P,		;AND RETURN.
   613				
   614				CLRKON:	MOVE	T1,[CF+FC]	;COMMAND FUNCTION FAULT CLEAR
   615				DOWKON:	PUSHJ	P,DOKON		;DO THE COMMAND AND THEN
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 5-4
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   616				WATKON:	MOVEI	T2,RTYCNT	;NUMBER OF TIMES TO WAIT
   617					RCMD	T1
   618					TLNN	T1,(CI)		;CONTLOL IDLE YET?
   619					SOJG	T2,.-2		;NO
   620					JUMPG	T2,CPOPJ1	;JUMP IF IT WENT IDLE
   621					POPJ	P,		;DIDN'T.
   622				
   623				APINI:	HRRZ	T1,W	;GET UNIT SELECTED
   624					ROT	T1,ROTUNI
   625					LDA	T1
   626					TLO	T1,(<SU>)
   627					LDA	T1
   628					PUSHJ	P,CLRKON	;CLEAR CONTROL
   629					  JFCL			;IGNORE ERRORS FOR NOW
   630					RCMD	T1		;GET STATUS
   631					TLNE	T1,(<SUNT!SUNR>) ;NON-SKIP IF NOT THERE OR NOT READY
   632					POPJ	P,
   633					PUSHJ	P,CLRKON	;CLEAR OUT CONTROL AGAIN
   634					  POPJ	P,		;TIMEOUT
   635					MOVE	T1,[CF+FC+RECAL]
   636					PUSHJ	P,DOWKON	;DO A RECAL IN CASE IT HAD SEEK ERROR
   637					  POPJ	P,		;NO GOOD.
   638					MOVSI	T1,^D10		;WAIT A LONG TIME
   639					RCMD	T2
   640					TRNN	T2,NA		;SKIP IF NOT ACTIVE ANYMORE.
   641					SOJG	T1,.-2
   642					JUMPE	T1,CPOPJ	;GO IF TIMED OUT
   643					RCMD	T1		;GET STATUS BITS AGAIN
   644					TRNN	T1,AE		;ERROR RETURN IF ANY ERRORS
   645					AOS	(P)		;NO ERRORS
   646					POPJ	P,
   647				
   648				COMMENT ! PRIMITIVE ROUTINES TO READ OR WRITE A SPECIFIED NUMBER OF
   649					 WORDS STARTING AT AN ARBITRARY DISK PAGE FROM/TO AN
   650					 AMPEX OR CDC DISK DRIVE ON A FOONLY-F3.
   651					 PARAMETERS:	PG/ # OF WORDS,,DISK PAGE
   652							F/ CORE ADDR (NOT NECESSARILY ON PAGE BOUNDARY)
   653							W/ UNIT
   654					 CALL:	PUSHJ P,APXPRD	TO READ
   655						PUSHJ P,APXPWT	TO WRITE
   656					 RETURN:	SUCCESS: SKIP
   657							FAILURE: NON-SKIP
   658					 ACS ALTERED:	T1-T4,P1-P2
   659				!
   660				
   661				APXPRD:	SKIPA	P2,[APREAD]
   662				APXPWT:	MOVEI	P2,APWRIT	;APPROPRIATE ROUTINE TO CALL.
   663					PUSHJ	P,APINI		;INIT THE UNIT
   664					  POPJ	P,		;COULDN'T INIT THE DRIVE.
   665					PUSH	P,PG		;NEED TO SAVE THIS
   666					PUSH	P,F		;SO CAN DO MORE THAN ONE REC AND PRESERVE ARGS.
   667					HLRZ	T1,PG		;GET COUNT OF WORDS WANTED.
   668					TRZE	T1,777		;If not a multiple of 1000
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 5-5
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   669					 ADDI	T1,1000		; round up
   670					LSH	T1,-9		;TURN INTO PAGES.
   671					MOVNS	T1		;- COUNT
   672					HRL	PG,T1		;MAKE INTO AN AOBJN POINTER
   673				APXPX1:	PUSHJ	P,(P2)		;CALL THE ROUTINE TO DO ONE PAGE
   674					  JRST	APXPER		;NO GOOD.
   675					ADDI	F,1000		;ADVANCE MEMORY ADDRESS
   676					AOBJN	PG,APXPX1
   677					AOS	-2(P)		;OK, GIVE SUCCESS RETURN.
   678				
   679				APXPER:	POP	P,F
   680					POP	P,PG
   681					POPJ	P,
   682				
   683				;HERE TO READ OR WRITE ONE PAGE WITH RH(PG) CONTAINING THE BLOCK NUMBER
   684				; W CONTAINING THE UNIT NUMBER AND F CONTANING THE MEMORY ADDRESS.
   685				
   686				APWRIT:	SKIPA	P1,[WRITE]
   687				APREAD:	 MOVEI	P1,READ
   688					HRRZ	T1,PG		;GET PAGE NUMBER
   689					IDIVI	T1,PPC		;GET T1/CYL, T2/PAGES INTO CYL
   690					IDIVI	T2,SPT		;GET T2/TRACK, T3/SECTOR IN TRACK
   691					DPB	T2,[POINT AMSTRK,T3,AMPTRK]
   692					DPB	T1,[POINT AMSCYL,T3,AMPCYL]
   693					HRRZ	T1,W
   694					ROT	T1,ROTUNI	;GET UNIT NUMBER INTO POSITION
   695					TDO	T3,T1
   696					LDA	T3
   697					TLO	T3,(<SU>)
   698					LDA	T3
   699					PUSHJ	P,CLRKON	;CLEAR OUT CONTROL
   700					  JFCL			;IGNORE, WILL CATCH LATER.
   701					LMA	F		;LOAD MEMORY ADDRESS
   702								;NUMBER OF WORDS IS ALWAYS 1000
   703					MOVE	T1,P1		;GET COMMAND INTO T1 FOR DOKON
   704					PUSHJ	P,DOKON	;START THE TRANSFER
   705					MOVSI	T1,^D10		;TIMEOUT IS ABOUT 10 SECONDS.
   706					RCMD	T2
   707					TRNN	T2,NA
   708					 SOJG	T1,.-2
   709					JUMPE	T1,CPOPJ	;TIMED OUT, ERROR
   710					RCMD	T1		;OK, GET COMMAND
   711					TRNE	T1,AE		;MAKE SURE NO ERROR BITS ON
   712					 POPJ	P,		;SORRY.
   713					TLNE	T1,(<IPE>)	;THIS IS ONLY VALID IF AE OFF
   714					POPJ	P,		;NO GOOD.
   715					RMA	T1
   716					TLZ	T1,777774	;CLEAR UNUSED BITS
   717					SUB	T1,F		;GET NUMBER OF WORDS XFERRED
   718					CAIE	T1,1000
   719					 POPJ	P,		;WRONG COUNT
   720					JRST	CPOPJ1		;OK, SUCCESSFUL XFER.
   721				>;END IFCPU (F3)
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 5-6
MONBTS.MAC	20-SEP-87 13:43		Primitive READ/WRITE routines for RM03/RP06

   722
   723	000226'	500000	400000*		$END	(BTS)

   724	000227'	001600	000011

   725	000230'	200167	741702

   726	000231'	671176	420344

   727	000232'	627034	420204

   728	000233'	476372	451502

   729	000234'	204164	000000

   730	000235'	064244	241236

   731	000236'	476512	320330

   732	000237'	677034	462710

   733	000240'	210321	220100

   734	000241'	000000	000000

   735	000242'	376535	664750

   736	000243'	203114	172302

   737	000244'	203055	467706

   738	000245'	655015	562746

   739	000246'	717134	420352

   740	000247'	700321	200000

   741	000250'	000000	000071

   742	000251'	100500	000011

   743	000252'	000001	763000

   744						;End of MONBTS (BTSLIT: BTSEND:)
   745
NO ERRORS DETECTED
PROGRAM BREAK IS 000253
7K CORE USED
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88 PAGE 6
MONBTS.MAC	20-SEP-87 13:43		SYMBOL TABLE

APXPRD		000110'		NOBOOT		000045'		
APXPWT		000110'		NODIE		000000	EXT	
BAADR		776704	SPD	P		000001	INT	
BADPRD		000110'		P1		000014	INT	
BADPWT		000110'		P2		000015	INT	
BCDSSZ		003000	SPD	PG		000003	INT	
BCDSZ		002600	SPD	PGRADR		763000	SPD	
BOOTCL		000062'		PGRFST		100000	SPD	
BOOTFI		000064'		PGRVAL		040000	SPD	
BOOTS		775000	INT	PI		000004	SPD	
BOTLOD		000020'	INT	PI.OFF		000400	SPD	
BTADR		000061'		PJRST	324740	000000		
BTSEND		000252'	INT	PMDDSP		000101'		
BTSLIT		000226'	INT	PMDRD		000065'	INT	
BTSTR		000056'	EXT	PMDSET		000073'		
BUGDMP		000003'	INT	PMDWT		000070'	INT	
CPOPJ		000114'		RDIO	712000	000000		
CPOPJ1		000113'		REBOOT		000016'		
CPUF3		000004	SPD	RMP1		000215'		
CPUKI		000001	SPD	RMPOPJ		000225'		
CPUKL		000002	SPD	RMXBT1		000037'		
CPUKS		000003	SPD	RMXPBT		000030'		
CPUTYP		000003	SPD	RMXPRD		000115'		
CPZZ		000000	SPD	RMXPWT		000116'		
CS1ADR		776700	SPD	S$ENTR	777777	777775	SIN	
CS1RDY		000200	SPD	S$HALT	777777	777777	SIN	
CS1TRE		040000	SPD	S$NAME		000000'	SPD	
CS2ADR		776710	SPD	S$NONA		000000	SIN	
CS2CLR		000040	SPD	S$TEMP	777775	000000	SPD	
CS2NED		010000	SPD	S$XCT	777777	777776	SIN	
CTYTYP		000111'	EXT	SAXPRD		000110'		
DAADR		776706	SPD	SAXPWT		000110'		
DCADR		776734	SPD	T1		000006	INT	
DIE		000000'	EXT	T2		000007	INT	
DSADR		776712	SPD	T3		000010	INT	
DSDRY		000200	SPD	T4		000011	INT	
DSERR		040000	SPD	TION	711000	000000		
DSMOL		010000	SPD	UA1		000001	SPD	
DTADR		776726	SPD	UNYKTP		000075'	EXT	
EPT.PN		000022'	EXT	UNYPUN		000074'	EXT	
F		000004	INT	UNYSCN		000073'	EXT	
F.RD		000071	SPD	UPT.PN		000000	EXT	
F.RECA		000007	SPD	W		000012	INT	
F.RIP		000021	SPD	WCADR		776702	SPD	
F.WD		000061	SPD	WRAPR	700200	000000		
INLMES		000003'	EXT	WREBR	701200	000000		
ISBOOT		000050'		WRIO	713000	000000		
J		000002	INT	WRUBR	701140	000000		
LG.LAB	400000	000000	SPD	.CPEPD		000024'	EXT	
LG.LUB	100000	000000	SPD	
MONBTS		000000'	ENT	
NEWMON		000025'	INT	

MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Symbol cross reference

APXPRD	   164	   167#
APXPWT	   164	   167#
BAADR	   437
BADPRD	   158	   159	   160	   161	   170#
BADPWT	   158	   159	   160	   161	   169#
BCDSSZ	   111#
BCDSZ	   110#	   111	   112	   113
BOOTCL	    58	    78	    87	    98	   107	   113#
BOOTFI	   100	   116#
BOOTS	    55#	    57	   113
BOTLOD	    44#	    95
BTADR	    77	   112#
BTSEND	   744#
BTSLIT	   723#
BTSTR	    47%	    47	   106%	   106
BUGDMP	    33#	    39
CPOPJ	   175#
CPOPJ1	   174#
CPUF3	    43	    48	    49	    75	    79	   167	   457
CPUKI	    60	   135	   168	   176
CPUKL	    60	   135	   168	   176
CPUKS	    43	    50	    75	    80	    84	   166	   359
CPUTYP	    43	    48	    49	    50	    60	    75	    79	    80	    84	   135	   166	   167	   168	   176
	   359	   457
CPZZ	    43#	    43	    48#	    48	    49#	    49	    50#	    50	    60#	    60	    75#	    75	    79#	    79
	    80#	    80	    84#	    84	   135#	   135	   166#	   166	   167#	   167	   168#	   168	   176#	   176
	   359#	   359	   457#	   457
CS1ADR	   393	   403	   444	   449
CS1RDY	   450
CS1TRE	   453
CS2ADR	   385	   386	   388
CS2CLR	   384
CS2NED	   389
CTYTYP	    94%	    94	   105%	   105	   172%	   172
DAADR	   428
DCADR	   421
DIE	    24	    24%	    25
DSADR	   387	   396	   399	   405
DSDRY	   395	   406
DSERR	   400	   409
DSMOL	   390
DTADR	   412
EPT.PN	    43%	    46
F	    57	    58	    78	    87	   433
F.RD	   381
F.RECA	   402
F.RIP	   392
F.WD	   382
INLMES	    33%	    33
ISBOOT	    82	    90	    98#
J	   130
LG.LAB	    45
LG.LUB	    45
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Symbol cross reference

LISTSN	     3	     6
MONBTS	    24	    25#	    28
NEWMON	    40	    52	    57#
NOBOOT	    93#
NODIE	    24%
P	    25	    33	    37	    39	    51	    80	    88	   120	   125	   154	   173	   174	   175	   391
	   401	   410	   454	   455
P1	    93	   102	   170	   381	   382	   444
P2	   412	   413	   414	   416	   424
PG	    77	    86	   133	   134	   418	   429
PGRADR	   438
PGRFST	   439
PGRVAL	   439
PI	    44
PI.OFF	    44
PMDDSP	   121	   126	   157#
PMDRD	   120#
PMDSET	   120	   125	   130#
PMDWT	   125#
REBOOT	    39#
RMP1	   446#	   451
RMPOPJ	   398	   408	   452	   455#
RMXBT1	    86#	    91
RMXPBT	    77#	    83
RMXPRD	    80	    88	   163	   381#
RMXPWT	   163	   382#
S$ENTR	    24	    30
S$HALT	    24
S$NAME	    28#
S$NONA	    27	    30
S$TEMP	    24#	    24
S$XCT	    30
SAXPRD	   162	   168#
SAXPWT	   162	   168#
T1	    94	   105	   121	   122	   126	   127	   132	   172	   415	   417	   420	   423	   425	   426
T2	    98	    99	   383	   385	   386	   387	   388	   393	   396	   399	   403	   405	   412	   421
	   428	   432	   437	   444	   449
T3	    99	   100	   384	   385	   388	   389	   395	   396	   404	   407	   408	   418	   419	   420
	   421	   422	   426	   427	   429	   430	   431	   432	   434	   435	   436	   437	   438	   440
	   442	   443	   445	   451	   452
T4	    82	    90	   101	   387	   390	   392	   393	   394	   397	   398	   399	   400	   402	   403
	   405	   406	   409	   422	   427	   428	   433	   439	   440	   441	   443	   446	   447	   449
	   450	   453
UA1	   383	   438
UNYKTP	   132%	   132
UNYPUN	   131%	   131
UNYSCN	   130%	   130
UPT.PN	    43%	    45
W	    76	    83	    85	    91	   131	   386
WCADR	   432
.CPEPD	    51%	    51
MONBTS - Monitor resident BOOTStrap	MACRO 12.5-46.0 14:10 13-JAN-88
MONBTS.MAC	20-SEP-87 13:43		Macro/Opdef cross reference

IFCPU	    43	    48	    49	    60	    75	    79	    80	    84	   135	   176	   359	   457
IFNCPU	    50	   166	   167	   168
PFALL	    52
PJRST	   122	   127
PRINTF	    10#	    32
RDIO	   387	   388	   399	   405	   412	   449
RDREG	   375#	   387	   388	   399	   405	   412	   449
STOPCD	    23
SYSPIF	    44
TION	   396
WRAPR	   116
WREBR	    46
WRIO	   385	   386	   393	   403	   421	   428	   432	   437	   440	   443	   444
WRREG	   378#	   385	   386	   393	   403	   421	   428	   432	   437	   444
WRUBR	    45
$END	   723    e?»
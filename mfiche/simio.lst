SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK
     9				SUBTTL AAA APRIL 77    TABLES, EXTERNS..
    10
    11					STOPCD(,ENTRY,SIMIO)^
    12					ENTRY	SIMIO		;For library searches
    13	000000'	260040	000000*	SIMIO::PUSHJ	P,DIE		;**** Default stopcode for "SIMIO" ****
    14	000001'	635155	515700		SIXBIT	/SIMIO/  	;Title of module
    15	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "SIMIO+nnn(nnnnnn)"
    16			000000'	S$NAME==SIMIO			;For STOPCDs with no arguments
    17					SALL>
    18				^
    19
    20				COMMENT ~ THE SIMIO DATA BASE RESIDES IN UPT
    21				IT CONSISTS OF A PAGE BITMAP (UPTPBM, 1 WORD) WHICH
    22				HAS A BIT SET FOR EACH PER-PROCESS PAGE IN USE, AN IO COUNT
    23				(UPTIOC, 1 WORD) WHICH IS INCREMENTED EACH TIME A REQUEST
    24				IS SERVICED BY SIMIO, RESET WHEN IT OVERFLOWS 18 BITS, AND USED
    25				AS A SEQUENCE-STAMP TO KEEP TRACK OF THE LEAST-RECENTLY USED
    26				CHANNEL; AN ARRAY UPTPOS[0:MAXCHN] WHICH HAS THE BLOCK POSITION
    27				IN THE DSK FILE ON EACH CHANNEL
    28					0 - NO INPUT DONE, ILLEGAL POSITION (UNLESS SUPERIO)
    29					<0 - ILLEGAL
    30					>0 - BLOCK POSITION WHICH WILL BE READ/WRITTEN NEXT
    31						CALL TO SIMIO. POSITION ADVANCES AS TRANSFER
    32						ROUTINES INBLT,OUTBLT EXIT.
    33				AND AN ARRAY UPTSIM[0:MAXCHN] WHICH HOLDS SIMIO STATUS INFO
    34				FOR EACH CHANNEL:
    35				BYTE(18)<SEQUENCE-STAMP>(1)GOTPHP(1)NEDRMV(1)NEDMAP(1)GOTHOL
    36						(4)0(10)<PER-PROCESS VP# FOR THIS CHAN>
    37
    38				PAGES IN PER-PROCESS AREA ARE ASSIGNED TO CHANNELS AS NEEDED,
    39				AND STOLEN FROM THEM ONLY IF NO PAGE IS FREE TO BE ASSIGNED.
    40				UPYCVP PICKS UP THE PAGE-NUMBER ASSIGNED TO CHANNEL IN W. IF 0, NO
    41				PAGE ASSIGNED.
    42
    43				FOR DEBUGGING, AN EXTRA ARRAY UPTPCN[340:377] IS KEPT TO
    44				VERIFY THAT NO CHANNELS SHARE A PAGE DUE TO ALLOCATION/DE-
    45				ALLOCATION BUGS. THIS CAN COME OUT WHEN CONFIDENCE IS
    46				GAINED.
    47				(6/25/80.  UPTPCN is now removed. /AA)
    48				~
    49
    50			000012	UPSCVP==^D10	;SIZE
    51			000043	UPNCVP==^D35	;POSITION
    52	000003'	001212	000000*	UPYCVP:	POINT UPSCVP,%UPT+UPTSIM(W),UPNCVP	;CHANNEL VIRTUAL PAGE
    53			400000	GOTPHP==1B18	;GOT PAST HIGHEST PG FRETURN FROM FCREATE, THIS CHAN
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 1
SIMIO.MAC	 9-OCT-87 18:31		AAA APRIL 77    TABLES, EXTERNS..

    54			200000	NEDRMV==1B19	;THIS CHAN NEEDS VREMOV OF UPYCVP PAGE
    55			100000	NEDMAP==1B20	;THIS CHAN NEEDS UPTPOS MAPPED INTO UPYCVP
    56			040000	GOTHOL==1B21	;UPTPOS CURRENTLY POINTS AT A HOLE PAGE
    57						;(ANY REFERENCE TO UPYCVP PAGE WILL FAULT FOR
    58						; NXM BECAUSE NO PAGE EXISTS TO MAP IN)
    59
    60
    61				DEFINE PAGE(AC,CELL)
    62				< IFNB <CELL>,<MOVE AC,CELL>
    63					TLNN S,IOSUPR
    64					ADDI AC,3
    65					LSH  AC,-2>
    66
    67					;GENERAL EXTERNS FROM COMMON
    68				EXTERN CPOPJ,CPOPJ1,JOB,%UPT,PBMMSK
    69					;LMAP AND DATABASE EXTERNS FROM COMMON
    70				EXTERN VPUMAX,UPTJDA,NUMCHN
    71				EXTERN UPTPOS,UPTSIM,UPTIOC,UPTPBM
    72				;EXTERN UPTPCN
    73				EXTERN LMYERR
    74					;FILSER EXTERNS FOR ERROR CODES,MISC
    75				EXTERN FALHOL,FALCPL,FALPHP,FALNHL
    76				EXTERN WRTCHG,NOWRT,IOBDRB,ATBSIZ,JBTRCT,JBTSIN,SIMCRE
    77					;MISC
    78				EXTERN ADRERR,GTCGSZ,PIOMOD,SMSTAT
    79					;FROM CORE1
    80				EXTERN EI.OER,EI.DER,EI.DTE,VL.WAT,VLIOE%,PE.NER,FALOPE
    81				EXTERN PS.DTE,PS.DER
    82
    83
    84
    85			000002	FCRID==2	;FCREATE UUO ID FOR SIMIOM,SIMIOS
    86			000040	FNCFCR==40	;FCREATE CHANIO FUNCTION NO.
    87			000001	MAPID==1	;MAP UUO ID
    88			000035	FNCMFP==35	;MAP FILE PAGE CHANIO FUNCTION NO.
    89			000043	FNCMSP==43	;MAP SUPER PAGE CHANIO FUNCTION
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 2
SIMIO.MAC	 9-OCT-87 18:31		EXEC PER PROCESS PAGE ("PPP") MANAGEMENT

    90				SUBTTL EXEC PER PROCESS PAGE ("PPP") MANAGEMENT
    91
    92				COMMENT ~ ROUTINE PPPGET
    93				FUNCTION: FIND A PPP AVAILABLE IN THE BITMAP, MARK IN IN USE,
    94						RETURN ITS PAGE NO.
    95				CALL:	PUSHJ P,PPPGET
    96					FAIL RETURN, NO PAGE AVAIL, T1/T2/GARB T3/GARB
    97					SUCCESS RETURN, T2/0,,VP#
    98				DESTROY: T1-T2
    99				NOTICE:  THIS ROUTINE AND ITS FRIEND BELOW EXPECT
   100					THAT UPTPBM HAS BEEN INITIALIZED TO PBMMSK AT JOB CREATION
   101					TIME.  A BIT SET IN UPTPBM 0-31 INDICATES THAT
   102					THE CORRESPONDING PAGE IS IN USE.
   103				~
   104
   105	000004'	460300	000000*	PPPGET:	SETCM T1,%UPT+UPTPBM	;PICK UP COMPLEMENT, SO JIFFO WORKS
   106	000005'	243300	000007'		JFFO T1,.+2
   107	000006'	263040	000000		POPJ P,		;NO FREE PAGES
   108	000007'	205300	400000		MOVSI T1,(1B0)
   109	000010'	213000	000007		MOVNS T2
   110	000011'	242307	000000		LSH T1,(T2)
   111	000012'	612300	000000*		TDNE T1,PBMMSK		;IF BIT MOVED THIS FAR DOWN,
   112	000013'	256000	000000'		 STOPCD			;UPTPBM IS FOULED UP.   ;;PPPGET+7
   113	000014'	436300	000000*		IORM T1,%UPT+UPTPBM	;PAGE'S BIT_1
   114	000015'	213000	000007		MOVNS T2
   115	000016'	271340	001000		ADDI T2,1000	;1ST PPP PAGE MAPS TO VP# 1000, ETC.
   116	000017'	254000	000000*		JRST CPOPJ1
   117
   118				COMMENT ~ ROUTINE PPPPUT
   119				FUNCTION: MARK A PPP FREE IN BITMAP. STOPCD IF ALREADY MARKED FREE
   120				CALL:	MOVE T1,VP# TO GIVE BACK
   121					PUSHJ P,PPPPUT
   122					RETURN HERE T1,T2 CLOB
   123				~
   124	000020'	275300	001000	PPPPUT:	SUBI T1,1000
   125	000021'	335000	000006		SKIPGE T1
   126	000022'	256000	000000'		 STOPCD                 ;;PPPPUT+2
   127	000023'	205340	400000		MOVSI T2,(1B0)
   128	000024'	213000	000006		MOVNS T1
   129	000025'	242346	000000		LSH T2,(T1)
   130	000026'	616340	000012*		TDNN T2,PBMMSK	;ARE WE PUTTING BACK AN ILLEGAL BIT?
   131	000027'	616340	000000*		TDNN T2,%UPT+UPTPBM ; OR HAS BIT ALREADY BEEN RESET?
   132	000030'	256000	000000'		 STOPCD                 ;;PPPPUT+10
   133	000031'	412340	000000*		ANDCAM T2,%UPT+UPTPBM
   134	000032'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 3
SIMIO.MAC	 9-OCT-87 18:31		EXEC PER PROCESS PAGE ("PPP") MANAGEMENT

   135				COMMENT ~ ROUTINE SIMRLS -- CALLED BY CLOSE CODE
   136				FUNCTION: RETURN ANY PAGE ASSIGNED TO CHANNEL, TO FREELIST.
   137					VREMOV THE PAGE IF IT'S STILL MAPPED.
   138					ZAP SEQUENCE COUNT THIS CHAN.
   139				EXPECTS: F,S,W
   140				DESTROYS: T1-T4
   141
   142				~
   143	000033'	135300	000003'	SIMRLS::LDB T1,UPYCVP
   144	000034'	322300	000044'		JUMPE T1,SIMRL2	;NO PG ASSIGNED,JUST CLEAN UP
   145				;*;	CAME W,%UPT+UPTPCN-1000(T1)	;DEBUG
   146				;*;	 STOPCD                 ;;SIMRLS+3
   147	000035'	200352	000000*		MOVE T2,%UPT+UPTSIM(W)
   148	000036'	602340	140000		TRNE T2,GOTHOL!NEDMAP	;IF PAGE IS A HOLE OR NEEDS
   149								;MAPPING, NOTHING IS THERE TO VREMOV
   150	000037'	254000	000043'		JRST SIMRL1		;HOLE OR NEDMAP, SKIP VREMOV
   151	000040'	260040	000220'		PUSHJ P,SIMRMV		;VREMOV IT,GET UPDATED S/DEVIOS
   152	000041'	202004	000002		MOVEM S,DEVIOS(F)	;MAY HAVE SET IODTER,IODERR
   153	000042'	135300	000003'		LDB T1,UPYCVP		;RECOVER VP#
   154	000043'			SIMRL1:
   155				;*;	SETZM %UPT+UPTPCN-1000(T1)
   156	000043'	260040	000020'		PUSHJ P,PPPPUT		;TAKES T1/VP#
   157	000044'	402012	000000*	SIMRL2:	SETZM %UPT+UPTSIM(W)
   158	000045'	402012	000000*		SETZM %UPT+UPTPOS(W)		;FOR GOOD MEASURE, CLEAR FILE POSN
   159	000046'	263040	000000		POPJ P,
   160
   161				COMMENT ~ ROUTINE SIMENT -- CALLED BY UENTR IN FILUUO
   162				FUNCTION: IF PAGE IS ASSIGNED ON THIS CHANNEL (USER HAS DONE
   163					LOOKUP & SOME INPUT'S),& PAGE DOESNT ALREADY NEED
   164					MAPPING (NEDMAP=1), SET NEDRMV SO THAT THE
   165					PAGE WILL BE UN-MAPPED AND RE-MAPPED, THIS TIME WITH
   166					READ-WRITE PROT.
   167				EXPECTS: W/CHANNEL
   168				DESTROY: T1
   169				CALL:	PUSHJ P,SIMENT
   170					RETURN HERE ALWAYS
   171				~
   172
   173	000047'	135300	000003'	SIMENT::LDB T1,UPYCVP
   174	000050'	322300	000000*		JUMPE T1,CPOPJ
   175	000051'	200312	000000*		MOVE T1,%UPT+UPTSIM(W)
   176	000052'	606300	100000		TRNN T1,NEDMAP
   177	000053'	660300	200000		TRO T1,NEDRMV
   178	000054'	202312	000000*		MOVEM T1,%UPT+UPTSIM(W)
   179	000055'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 4
SIMIO.MAC	 9-OCT-87 18:31		EXEC PER PROCESS PAGE ("PPP") MANAGEMENT

   180				COMMENT ~ ROUTINE STEALP VERSION 2
   181				FUNCTION: SEARCH ALL CHANNELS WITH PAGE ASSIGNED
   182					FOR THE ONE WITH SMALLEST SEQ NO. THIS IS THE LRU CHANNEL.
   183					TAKE ITS PAGE AND GIVE IT TO CURRENT CHANNEL.
   184					LEAVES THE TWO UPTSIM SLOTS AS FOLLOWS:
   185					OLD: SEQUENCE-NUMBER,,NEDMAP=1, NO UPYCVP
   186					NEW: SEQUENCE-NUMBER,,NEDMAP=1,UPYCVP=PER PROCESS PAGE
   187				EXPECTS: W
   188				DESTROYS: T1-T4,PG
   189				CALL:	PUSHJ P,STEALP
   190					RETURN HERE ALWAYS
   191				~
   192
   193	000056'	000000	000000	STEALC:: EXP 0  ;COUNTER HOW MANY TIMES DID SYSTEM STEAL
   194	000057'	350000	000056'	STEALP:	AOS STEALC
   195	000060'	261040	000012		PUSH P,W
   196	000061'	201300	777777		MOVEI T1,777777	;T1/SMALLEST SEQ VALUE YET FOUND
   197	000062'	211340	000001		MOVNI T2,1	;T2/CHANNEL IT WAS FOUND ON. -1 FLAGS NONE
   198	000063'	205500	000000*		MOVSI W,-NUMCHN	;AOBJN
   199	000064'			STELP1:
   200	000064'	135400	000003'		LDB T3,UPYCVP
   201	000065'	322400	000073'		JUMPE T3,STELP3	;NONE ASSIGNED
   202	000066'	554452	000000*		HLRZ T4,%UPT+UPTSIM(W);T4/SEQ NO.
   203	000067'	311440	000006		CAML T4,T1
   204	000070'	254000	000073'		JRST STELP3
   205	000071'	200300	000011		MOVE T1,T4
   206	000072'	550340	000012		HRRZ T2,W
   207	000073'	253500	000064'	STELP3:	AOBJN W,STELP1
   208	000074'	335000	000007		SKIPGE T2	;
   209	000075'	256000	000000'		 STOPCD		;DIDNT FIND CHAN W/PG ASSIGNED,T2 STILL -1 ;;STELP3+2
   210	000076'	200307	000000*		MOVE T1,%UPT+UPTSIM(T2)	;UPTSIM(OLD CHANNEL)
   211	000077'	606300	100000		TRNN T1,NEDMAP	;SKIP IF OLD CHAN ALREADY NEEDED MAP
   212					JRST [	MOVE W,T2	;W_OLD CHAN
   213						PUSH P,F
   214						PUSH P,S
   215						PUSH P,T2
   216						MOVE F,%UPT+UPTJDA(T2) ;F/DDB FOR OLD CHAN
   217						MOVE S,DEVIOS(F)	;S/OLD CHAN STATUS
   218						PUSHJ P,SIMRMV		;F,S,W ALL FOR OLD CHAN
   219						MOVEM S,DEVIOS(F)	;SIMRMV MAY REPORT ERROR IN S
   220						POP P,T2		;T2/OLD CHAN
   221						POP P,S
   222						POP P,F
   223						MOVE T1,%UPT+UPTSIM(T2) ;UPTSIM(OLD CHAN),UPDATED BY SIMRMV
   224	000100'	254000	001527'			JRST .+1]
   225	000101'	262040	000012		POP P,W		;W/CURRENT CHANNEL
   226				;T2/OLD CHAN, T1/UPTSIM(T2), W/CURRENT CHAN
   227	000102'	620300	640000		TRZ T1,NEDRMV!GOTHOL!GOTPHP	;OLD CHAN NEEDS
   228							;ONLY TO MAP, REMOVE DONE. MAPPER WILL
   229							;SET GOTPHP,GOTHOL
   230	000103'	135140	001544'		LDB PG,[POINT UPSCVP,T1,UPNCVP]	;THE VP SLOT WE'RE STEALING
   231				;*;	CAME T2,%UPT+UPTPCN-1000(PG)	;DEBUG
   232				;*;	 STOPCD                 ;;STELP3+many
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 4-2
SIMIO.MAC	 9-OCT-87 18:31		EXEC PER PROCESS PAGE ("PPP") MANAGEMENT

   233	000104'	201440	000000		MOVEI T4,0
   234	000105'	137440	001544'		DPB T4,[POINT UPSCVP,T1,UPNCVP] ;OLD CHAN NOW HAS NO PAGE
   235	000106'	202307	000000*		MOVEM T1,%UPT+UPTSIM(T2)
   236	000107'	200412	000000*		MOVE T3,%UPT+UPTSIM(W)	;T3/UPTSIM(CURRENT CHAN)
   237	000110'	620400	640000		TRZ T3,NEDRMV!GOTHOL!GOTPHP ;CURRENT CHAN DOESNT NEED
   238						;TO REMOVE,THAT'S ALREADY DONE
   239						;GOTHOL & GOTPHP WILL BE SET IF NEEDED WHEN
   240						;PAGE IS MAPPED.
   241	000111'	660400	100000		TRO T3,NEDMAP	;CURR CHAN NEEDS TO MAP UPTPOS DATA
   242	000112'	137140	001545'		DPB PG,[POINT UPSCVP,T3,UPNCVP] ;NEW CHAN NOW HAS VP SLOT
   243	000113'	202412	000000*		MOVEM T3,%UPT+UPTSIM(W)
   244				;*;	MOVEM W,%UPT+UPTPCN-1000(PG)	;DEBUG
   245	000114'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 5
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   246				SUBTTL DATA XFER SETUP ROUTINES
   247				COMMENT ~ ROUTINE SIMIOA -- ASSIGN PG, SETUP MAP,REMOV BITS
   248				FUNCTION:	GET NEW PPP ASSIGNED IF NEEDED. SET NEDRMV
   249					IF HAD TO STEAL A PAGE. SET NEDMAP IF HAD TO
   250					ASSIGN A PAGE. UPDATE SEQUENCE COUNT TO SHOW THE
   251					CURRENT CHANNEL MOST RECENTLY USED.
   252				EXPECTS: F,S,W
   253				DESTROYS: T1-T4,PG
   254				CALL:	PUSHJ P,SIMIOA
   255					RET HERE ALWAYS
   256				~
   257
   258	000115'	135300	000003'	SIMIOA:	LDB T1,UPYCVP	;T1/ASSIGNED PG
   259	000116'	326300	000126'		JUMPN T1,SIMIA3	;GOT ONE ALREADY,NO NEED TO FINAGLE
   260	000117'	260040	000004'		PUSHJ P,PPPGET	;RETRN T2/NEW PG
   261	000120'	254000	000123'		JRST SIMIA1	;NONE TO GET, GOTTA STEAL
   262				;*;	SKIPE %UPT+UPTPCN-1000(T2)	;DEBUG
   263				;*;	 STOPCD		;DEBUG          ;;SIMIOA+5
   264	000121'	137340	000003'		DPB T2,UPYCVP	;W/CHANN GETS THE PG
   265				;*;	MOVEM W,%UPT+UPTPCN-1000(T2)	;DEBUG
   266	000122'	254000	000124'		JRST SIMIA2
   267	000123'	260040	000057'	SIMIA1:	PUSHJ P,STEALP	;GIVES US THE PG OF THE LRU CHANNEL
   268	000124'	201300	100000	SIMIA2:	MOVEI T1,NEDMAP	;CURR CHAN NEEDS TO MAP IN THE
   269	000125'	436312	000000*		IORM T1,%UPT+UPTSIM(W)	;DATA AT %UPT+UPTPOS(W)
   270	000126'	350300	000000*	SIMIA3:	AOS T1,%UPT+UPTIOC		;UPDATE SEQ COUNT
   271	000127'	603300	777777		TLNE T1,-1		;ONLY 18 BITS BEFORE OVERFLOW
   272	000130'	260040	000133'		PUSHJ P,SIMIA5		;FIX OVERFLOW
   273	000131'	506312	000000*		HRLM T1,%UPT+UPTSIM(W)	;STAMP CURR CHAN MOST RECENT
   274	000132'	263040	000000		POPJ P,			;RETURN
   275
   276				COMMENT ~ ROUTINE SIMIA5
   277				FUNCTION: FIX UP WHEN UPTIOC OVERFLOWS 18 BITS. RESET
   278					UPTIOC AND ALL CHANNEL SEQ NOS. THEN RETURN T1
   279					SET FOR STAMP CURR CHAN AGAIN.
   280				~
   281	000133'			SIMIA5:
   282	000133'	402000	000000*		SETZM %UPT+UPTIOC	;IO COUNT BACK TO 0
   283	000134'	205300	000000*		MOVSI T1,-NUMCHN
   284	000135'	553006	000000*		HRRZS %UPT+UPTSIM(T1)	;ZERO LEFT HALF
   285	000136'	253300	000135'		AOBJN T1,.-1
   286	000137'	350300	000000*		AOS T1,%UPT+UPTIOC	;CURR CHAN NOW 1,ALL OTHERS 0
   287	000140'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 6
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   288				COMMENT ~ ROUTINE SIMIOB
   289				FUNCTION:1)IF FILE VIRGIN, DEVPOS_UPTPOS_1,NEDMAP_1,SET J/POS, EXIT.
   290					2) IF A USETI/O HAS HAPPENED (DEVPOS SIGN BIT ON),
   291						UPTPOS_DEVPOS_DEVPOS TLZ 1B0, SET J/POS,
   292						CLEAR GOTPHP & SET NEDRMV IF CHANGING PGS, EXIT.
   293					3) IF NEITHER OF THESE, THEN UPTPOS IS CORRECT BLOCK
   294						POSITION FOR CURRENT DATA XFER. SET J/POS & EXIT.
   295
   296				WHAT IS POS ?
   297				POS IS THE WORD NUMBER IN THE CURRENT PAGE, SET UP FOR BLT'S.
   298				POS ALWAYS AT AN INTEGRAL BLOCK (200 WDS) BOUNDARY:
   299				BLOCK IN FILE:	  1	  2	  3	  4	  5	ETC.
   300				POS VALUE:	000	200	400	600	000	ETC.
   301
   302				CALL:	PUSHJ P,SIMIOB
   303					ALWAYS RETURN HERE, J/POS
   304				EXPECTS: F,S,W,DEVPOS(F) %UPT+UPTPOS(W)
   305				DESTORY: T1,T2,T3,J
   306				~
   307
   308	000141'			SIMIOB:
   309	000141'	623000	000002		TLZE S,IOBEG		;IF VERY FIRST I/O UUO,
   310					JRST [	MOVEM S,DEVIOS(F)
   311						SKIPL T1,DEVPOS(F)	;CHECK FOR USETI/O FIRST
   312						MOVEI T1,1	;OR START FILE AT BLK 1,
   313						TLZ T1,(1B0)	;CLEAR USETI/O FLAG,
   314						MOVEM T1,DEVPOS(F)	;AND NOTE CURRENT
   315						MOVEM T1,%UPT+UPTPOS(W)	;POSN IN BOTH PLACES,
   316	000142'	254000	001546'			JRST SIMIB2]	;NOW GO SET POS
   317	000143'	331304	000000*		SKIPL T1,DEVPOS(F)	;SIGN SET IF ANY USETI/O
   318	000144'	254000	000170'		JRST SIMIB2	;NONE. JUST SEQUENTIAL IN'S OR OUT'S
   319	000145'	621300	400000		TLZ T1,(1B0)
   320	000146'	202304	000143*		MOVEM T1,DEVPOS(F)	;RESTORE WITHOUT USETI/O FLAG
   321	000147'	200352	000000*		MOVE T2,%UPT+UPTPOS(W)	;BLOCK WE'D HAVE TOUCHED NEXT IF NO USETI/O HAD HAPPENED
   322	000150'	200412	000000*		MOVE T3,%UPT+UPTSIM(W)	;STATUS
   323	000151'	202312	000000*		MOVEM T1,%UPT+UPTPOS(W)	;NEW BLOCK
   324	000152'	602400	300000		TRNE T3,NEDMAP!NEDRMV	;IF EITHER BIT IS ON, WE CAN FORGET
   325	000153'	254000	000164'		JRST SIMIB1	;ABOUT UPYCVP PG AND USE THE USETI/O'D PG
   326	000154'	607000	000000*		PAGE (T2)
   327	000155'	271340	000003
   328	000156'	242340	777776			;FORMER PAGE
   329	000157'	607000	000154*		PAGE (T1)
   330	000160'	271300	000003
   331	000161'	242300	777776			;T1/USETIO'D PAGE
   332								;RESET GOTPHP AFTER ANY
   333	000162'	316300	000007		CAMN T1,T2		;USETI/O WHICH CHANGES PAGES,
   334	000163'	254000	000170'		JRST SIMIB2		;BECAUSE BREAKS SEQUENCE OF
   335								;FCREATES AT EOF AND
   336								;WE ARE NOT SURE ANY MORE
   337	000164'	620400	400000	SIMIB1:	TRZ T3,GOTPHP		;THAT NEXT VMAP WOULD GET FALPHP ERROR
   338	000165'	606400	100000		TRNN T3,NEDMAP		;IF PAGE ALREADY MAPPED,SET
   339	000166'	660400	200000		TRO T3,NEDRMV		;NEDRMV TO GET RID OF OLD DATA
   340						;BEFORE MAPPING NEW UPTPOS INTO UPYCVP
SIMIO -- VM SYSTEM SIMULATE OLD-STYFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 6-2
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   341	000167'	202412	000000*		MOVEM T3,%UPT+UPTSIM(W)
   342
   343				;CALCULATE POS FROM CURRENT %UPT+UPTPOS(W)
   344	000170'	200312	000000*	SIMIB2:	MOVE T1,%UPT+UPTPOS(W)	;BLOCK POSITION
   345	000171'	607000	000157*		TLNN S,IOSUPR
   346	000172'	275300	000001		 SUBI T1,1
   347	000173'	231300	000004		IDIVI T1,4		;T2/BLOCKS MOD 4
   348	000174'	242340	000007		LSH T2,B2WLSH  		;T2/WORD POSITION IN PAGE
   349	000175'	552340	000002		HRRZM T2,J
   350	000176'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 7
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   351				COMMENT ~ ROUTINE SIMADV
   352				FUNCTION: ADVANCE UPTPOS BY WORDCOUNT OF JUST-COMPLETED DATA
   353					XFER, WATCHING FOR CROSSING PAGE BOUNDARY
   354				CALL:	MOVE T4,BLOCK COUNT OF XFER
   355					PUSHJ P,SIMADV
   356					RETURN HERE, PAGE DIDNT CHANGE
   357					RETURN HERE, PAGE CHANGED, NEDRMV SET
   358				EXPECTS: F,W,S
   359				DESTROY: T1,T2,T4
   360				~
   361
   362	000177'	200352	000000*	SIMADV:	PAGE (T2,%UPT+UPTPOS(W))
   363	000200'	607000	000171*
   364	000201'	271340	000003
   365	000202'	242340	777776
   366	000203'	273452	000000*		ADDB T4,%UPT+UPTPOS(W)
   367	000204'	200300	000011		MOVE T1,T4
   368	000205'	607000	000200*		PAGE (T4)
   369	000206'	271440	000003
   370	000207'	242440	777776
   371	000210'	250304	000146*		EXCH T1,DEVPOS(F)	;UPDATE DEVPOS, BUT CHECK THAT
   372	000211'	603300	400000		TLNE T1,(1B0)		;USETIO FLAG STILL OFF
   373	000212'	256000	000000'		 STOPCD                         ;;SIMADV+6
   374	000213'	316440	000007		CAMN T4,T2		;PAGE(OLD UPTPOS)=PAGE(NEW UPTPOS)?
   375	000214'	263040	000000		POPJ P,		;YES
   376	000215'	201340	200000		MOVEI T2,NEDRMV
   377	000216'	436352	000000*		IORM T2,%UPT+UPTSIM(W)
   378	000217'	254000	000017*		JRST CPOPJ1
   379
   380
   381				COMMENT ~ ROUTINE SIMRMV
   382				FUNCTION: REMOVE PAGE ASSIGNED TO W/CHANNEL, UNLESS
   383					THAT PAGE IS A HOLE (DISCOVERED DURING INBLT)
   384					IF PAGE IS RDW (ENTRB SET OR DOING SUPER OUTPUT),CHECK FOR
   385					ERROR ON THE VALIDATE AND RETURN UPDATED S/DEVIOS.
   386
   387					SET NEDMAP. CLEAR NEDRMV,GOTHOL
   388
   389				CALL:	PUSHJ P,SIMRMV
   390					RETURN HERE ALWAYS
   391				EXPECTS: F,S,W
   392				DESTROY: T1-T3, UPDATE S/DEVIOS(F)
   393				~
   394
   395	000220'	200412	000000*	SIMRMV:	MOVE T3,%UPT+UPTSIM(W)
   396	000221'	602400	040000		TRNE T3,GOTHOL	;SKIP IF VP HAS A HOLE MAPPED
   397	000222'	254000	000264'		 JRST SIMRM2	;NOTHING MAPPED THERE,JUST CLEAN UP
   398	000223'	135340	000003'		LDB T2,UPYCVP		;ASSIGNED VP#, BETTER BE NON-ZERO
   399	000224'	336000	000007		SKIPN T2
   400	000225'	256000	000000'		 STOPCD                 ;;SIMRMV+5
   401	000226'	505340	000001		HRLI T2,1		;T2/<COUNT=1>,,VP#
   402	000227'	603000	000205*		TLNE S,IOSUPR	;PAGE IS RDW IF SUPER-OUTPUT
   403	000230'	607000	000020		TLNN S,IO	;OR ENTRB, ELSE RDO
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 7-2
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   404	000231'	603200	020000		TLNE F,ENTRB	;IF RDW, NEED TO CHECK SUCCESS
   405	000232'	334000	000000		SKIPA		;OF THE VALIDATE
   406	000233'	254000	000262'		JRST SIMRM1	;RDO--INPUT--PRETTY SIMMPLE
   407				;BEGIN CODE FOR OUTPUT ONLY--AT SOME POINT IN THE USAGE ON
   408				;THIS CHANNEL THE PAGE WAS WRITEABLE EVEN THOUGH WE MAY
   409				;NEVER HAVE WRITTEN IT.
   410	000234'	200300	000007		MOVE T1,T2	;T1/1,,VP#
   411	000235'	047340	777706		PERSET T2,	;PE.NER:=0 IE, WATCH FOR ERRORS
   412	000236'	256000	000000'		 STOPCD                 ;;SIMRMV+many
   413	000237'	047340	777713		VREMOV T2,	;MAY GET FALOPE; OTHERS ARE BUG
   414	000240'	334000	000000		SKIPA
   415	000241'	254000	000264'		JRST SIMRM2	;GREAT! GO CLEAN UP
   416	000242'	553000	000007		HRRZS T2	;T2/ERR CODE
   417	000243'	302340	000000*		CAIE T2,FALOPE
   418	000244'	256000	000000'		 STOPCD                 ;;SIMRMV+many
   419	000245'	200340	000006		MOVE T2,T1	;T2/1,,VP#
   420	000246'	047340	777707		PAGSTS T2,	;GET T2/ERROR BITS ETC.
   421	000247'	256000	000000'		 STOPCD                 ;;SIMRMV+many
   422	000250'	200004	000002		MOVE S,DEVIOS(F);MOST UP-TO-DATE DEVIOS
   423	000251'	603340	000000*		TLNE T2,PS.DTE	;DATA ERR
   424	000252'	660000	100000		TRO S,IODTER
   425	000253'	603340	000000*		TLNE T2,PS.DER	;DEVICE
   426	000254'	660000	200000		TRO S,IODERR
   427	000255'	200340	000006		MOVE T2,T1	;T2/1,,VP#
   428	000256'	505340	000001*		HRLI T2,PE.NER+1 ;T2/<IGNORE ERRORS>+<COUNT=1>,,VP#
   429	000257'	047340	777706		PERSET T2,
   430	000260'	256000	000000'		 STOPCD                 ;;SIMRMV+many
   431	000261'	200340	000006		MOVE T2,T1	;T2/1,,VP#
   432				;END CODE FOR STRICTLY OUTPUT--RDW PAGE. BEGIN COMMON CODE FOR
   433				;FAILING OUTPUT REMOV AND INPUT REMOVE
   434	000262'	047340	777713	SIMRM1:	VREMOV T2,		;PE.NER SET, NOT EVEN FALOPE EXPECTED
   435	000263'	256000	001555'		 STOPCD (.,JOB,SIMRM0,,<Unexpected VREMOV error at SIMRM1+1>)
   436				;EXPECT T3/UPTSIM(W)   CLEAN UP
   437	000264'	620400	240000	SIMRM2:	TRZ T3,NEDRMV!GOTHOL
   438	000265'	660400	100000		TRO T3,NEDMAP
   439	000266'	202412	000000*		MOVEM T3,%UPT+UPTSIM(W)
   440	000267'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 8
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   441				COMMENT ~ ROUTINE SIMIOM -- PAGE MAPPER
   442				FUNCTION: MAP THE UPTPOS PAGE WITH APPROPRIATE PROTECTION INTO
   443					VP ASSIGNED FOR THE CHANNEL. ON OUTPUT, CREATE & MAP
   444					FILE PAGES IF OUTPUT IS INTO A HOLE OR PAST EOF.
   445					ON CREATE FILE PAGE, BACK OFF CHARGES IMPOSED BY THE
   446					UUO, AND LATER ON WHEN BLOCKS ARE XFERRED, CHARGE BY
   447					THE BLOCK.
   448				 PROT_(IF SUPER-OUTPUT OR ENTRB THEN RDW ELSE RDO)
   449
   450				CALL:	PUSHJ P,SIMIOM
   451					 ERROR , T1/UUO IDENTIFIER,,UUO ERROR CODE
   452					SUCCESS
   453				DESTROY: T1-T4
   454				EXPECTS: F,S,W
   455				CALLS: MAPUUO,FCREATE, MAPERR, FCRERR
   456					ON MAP OR FCREATE ERRORS, JSP T2,XXXERR
   457					ERROR CODE IN T1. BY CONVENTION T1 IS THE UUO AC HERE.
   458					THE JSP T2 IS TO ALLOW TRACKING DURING DEBUG. THE XXXERR CODE
   459					WILL POPJ FAIL RETURN UNLESS STOPCD IS INDICATED.
   460
   461				WORKING-SETS: THIS ROUTINE DOES NOT PUT ANY MAPPED PAGE INTO
   462					UWS OR MWS. WHEN THE PAGE IS TOUCHED, IT WILL COME INTO
   463					THE MWS. THE BLTS IN INBLT,OUTBLT ARE THE PLACES
   464					WHERE THE PAGE GETS TOUCHED.
   465
   466				EXITS:  SIMIMX -- SUCCESS. NEDMAP RESET
   467					MAPERR/FCRERR - FAIL.  NEDMAP STILL SET (EXIT THRU SIMIMF)
   468
   469				~
   470	000270'	261040	000014	SIMIOM:	PUSH P,P1
   471	000271'	261040	000015		PUSH P,P2	;USE THESE TWO FOR MAP UUO ARG BLK
   472	000272'	201300	200000		MOVEI T1,NEDRMV		;DEBUG CHK. THIS SHOULD B OFF
   473	000273'	612312	000000*		TDNE T1,%UPT+UPTSIM(W)
   474	000274'	256000	000000'		 STOPCD                 ;;SIMIOM+4
   475	000275'	135600	000003'		LDB P1,UPYCVP	;ASS PG
   476	000276'	505600	002001		HRLI P1,(<CPRRED>B7+1B17)
   477	000277'	603000	000227*		TLNE S,IOSUPR
   478	000300'	607000	000020		TLNN S,IO
   479	000301'	603200	020000		TLNE F,ENTRB
   480	000302'	505600	006001		HRLI P1,(<CPRRDW>B7+1B17)
   481	000303'	200652	000000*		PAGE (P2,%UPT+UPTPOS(W))
   482	000304'	607000	000277*
   483	000305'	271640	000003
   484	000306'	242640	777776
   485	000307'	550300	000012		HRRZ T1,W
   486	000310'	505300	000035		HRLI T1,FNCMFP	;MAP FILE PAGE CHANIO FUNCTION
   487	000311'	603000	000304*		TLNE S,IOSUPR	;UNLESS SUPER
   488	000312'	505300	000043		HRLI T1,FNCMSP
   489	000313'	603000	000020		TLNE S,IO	;SKIP IF PRESENTLY DOING INPUT
   490	000314'	254000	000333'		JRST SIMIM1
   491	000315'	043300	000014		CHANIO T1,P1
   492	000316'	265340	000411'		  JSP T2,MAPERR
   493				;GENERAL SUCCESS EXIT AFTER MAPPING, IN OR OUT. P1,P2
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 8-2
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   494				;ARE MAP ARG BLOCK.
   495	000317'	505600	000001*	SIMIMX:	HRLI P1,PE.NER+1	;P1/<IGNORE>+<COUNT=1>B17+VP#
   496	000320'	047600	777706		PERSET P1,	;TELL SYSTEM TO IGNORE SWAP ERR THIS PG
   497	000321'	256000	000000'		 STOPCD		;NO ERRORS PERMISSABLE THIS UUO ;;SIMIMX+2
   498	000322'	201300	100000		MOVEI T1,NEDMAP		;THIS SHOULD BE ON
   499	000323'	433312	000000*		XORB T1,%UPT+UPTSIM(W)	;RESET IT
   500	000324'	602300	100000		TRNE T1,NEDMAP		;SKIP IF IT WAS
   501	000325'	256000	000000'		 STOPCD
   502	000326'	350001	777776		AOS -2(P)		;BEHIND P1,P2 IN PDL
   503				;GENERAL FAILURE EXIT. T1/UUOID,,CODE
   504	000327'	262040	000015	SIMIMF:	POP P,P2
   505	000330'	262040	000014		POP P,P1
   506	000331'	200004	000002		MOVE S,DEVIOS(F)	;VMAPS MAY HAVE SET DEVIOS BITS
   507	000332'	263040	000000		POPJ P,
   508
   509				;OUTPUT. IF IOSUPR, DO SMAP & DONT ANALYZE FAILURES
   510	000333'	603000	000311*	SIMIM1:	TLNE S,IOSUPR
   511					JRST [CHANIO T1,P1	;DO SUPER-MAP
   512						JSP T2,MAPERR	;LET SIMIOS DISPATCH ON ERR CODE
   513	000334'	254000	001560'		      JRST SIMIMX]	;SUCCESS
   514					;REGULAR OUTPUT. IF ALREADY GOT "PAST HIGHEST PAGE" AND NO USETI/O
   515					;HAS INTERVENED, THEN GO DIRECTLY TO THE FCREATE. OTHERWISE
   516					;TRY TO MAP THE PAGE. THIS MAY GIVE "PAST HIGHEST PAGE"
   517					;ERROR. SET GOTPHP IF SO, & GO CREATE.
   518					;POSSIBLE TO GET APPEND-ONLY FILE VIOLATION HERE.
   519					; SEE IF MAP WILL SUCCEED WITH THE PRIVILEDGE
   520					;BIT GETB ON. (A HACK IN MAPUUO ALLOWS SUCCEED ON MAPPING
   521					;BEFORE EOF IF GETB ON AND IT'S THE VERY LAST PAGE).
   522
   523	000335'	201340	400000		MOVEI T2,GOTPHP
   524	000336'	612352	000000*		TDNE T2,%UPT+UPTSIM(W)
   525	000337'	254000	000376'		JRST SIMIM2	;GOT FALPHP ONCE ALREADY
   526
   527	000340'	043300	000014		CHANIO T1,P1	;TRY TO MAP THE PAGE ONTO WHICH
   528	000341'	334000	000000		SKIPA			;WE'RE GOING TO WRITE
   529	000342'	254000	000317'		JRST SIMIMX	;'RAY!
   530	
   531					;T1/VP#,,MAPUUO ERROR CODE
   532	000343'	202300	000741'		MOVEM	T1,SIMIT1	;Save T1 before we smash it
   533	000344'	553000	000006		HRRZS T1
   534	000345'	306300	000000*		CAIN T1,FALPHP  	;PAST HIGHEST PAGE?
   535					JRST [ MOVEI T1,GOTPHP
   536						IORM T1,%UPT+UPTSIM(W)
   537	000346'	254000	001563'			JRST SIMIM2]
   538	000347'	306300	000000*		CAIN T1,FALHOL	;A HOLE?
   539	000350'	254000	000376'		JRST SIMIM2	;P2/PG NO OF HOLE
   540	000351'	312300	000000*		CAME T1,FALCPL	;POSSIBLE APPEND-ONLY VIOLATION?
   541	000352'	265340	000412'		JSP  T2,MAPER1		;NON OF THESE. BOMB
   542
   543				;DEAL WITH POSSIBLE APPEND-ONLY VIOLATION, OR MAYBE LEGITIMATE
   544				;APPEND REQUEST REQUIRING SPECIAL PRIVILEDGED MAP TO GET THE
   545				;LAST PAGE AND WRITE IN IT.
   546	000353'	603000	000333*		TLNE S,IOSUPR	;IF SUPERIO, CANT BE APPEND ERR
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 8-3
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   547	000354'	265340	000412'		JSP T2,MAPER1
   548	000355'	201340	000000*		MOVEI T2,NOWRT
   549	000356'	616344	000007		TDNN T2,DEVIAD(F)	;APPEND-ONLY FILES HAVE NOWRT ON
   550	000357'	265340	000412'		JSP T2,MAPER1		;SOME OTHER MAP FAILURE
   551	000360'	550344	000000*		HRRZ T2,DEVATB(F)
   552	000361'	135400	000000*		LDB T3,ATYBSZ		;INTEGRAL # BLKS ALREADY IN FILE
   553	000362'	311412	000000*		CAML T3,%UPT+UPTPOS(W)	;SKIP IF CURR POSITION IS
   554								;PAST THE LAST BLOCK (ALTHO IT'S
   555								;IN THE LAST PAGE)
   556	000363'	265340	000412'		JSP T2,MAPER1		;GIVE FALCPL FRETURN, USER NOT
   557								;ADVANCED FAR ENUF IN FILE YET.
   558	000364'	607200	020000		TLNN F,ENTRB		;IF ENTRB OFF, MAP WILL FAIL
   559	000365'	265340	000412'		JSP T2,MAPER1		;SO DONT BOTHER.
   560	000366'	205200	000010		MOVSI F,GETB		;TURN ON PRIVILEDGE FLAG
   561	000367'	436212	000000*		IORM F,%UPT+UPTJDA(W)	;IN MEMORY ONLY (AC F DOESNT MATTER)
   562	000370'	550300	000012		HRRZ T1,W		;CHANIO MAP ARG:
   563	000371'	505300	000035		HRLI T1,FNCMFP		;T1/"MAP FILE PG",,CHANNEL
   564	000372'	043300	000014		CHANIO T1,P1		;TRY PRIVILEDGED MAP APPEND-ONLY
   565					  JSP T2,[ANDCAB F,%UPT+UPTJDA(W)	;GETB_0 IN F,MEMORY
   566	000373'	265340	001566'			 JRST MAPERR]	;NOT EVEN PRIVILEDGED WORKED
   567	000374'	413212	000000*		ANDCAB F,%UPT+UPTJDA(W)	;GETB_0 IN F,MEMORY & RESOTRE F
   568	000375'	254000	000317'		JRST SIMIMX
   569
   570				;CREATING PAGES TO EXTEND FILE OR FILL HOLE: OUTPUT
   571				;NEVER COME HERE IF IOSUPR
   572				;EXPECTS: P1/ MAPUUO ARG   P2/ PAGE NUMBER TO MAP
   573
   574				COMMENT ~ AFTER TRYING TO MAP THE PG, SOMEONE ELSE MAY SNEAK
   575				 IN AND CREATE IT BEFORE WE DO HERE; SO THIS SIMCRE MAY
   576				 FAIL. OR SOMEBODY MAY TRUNCATE FILE AFTER
   577				 WE CREATE THE PG, SO THE MAP HERE MAY FAIL. THESE
   578				 WIERDNESSES ARISE ONLY WHEN SIMULATNEOUS UPDATERS
   579				 ARE FOOLING WITH THE FILE VIA SIMIO. THERE IS NO
   580				 CHECK HERE TO PREVENT AN INFINITE LOOP OF FAILURES
   581				 BECAUSE SUPPOSEDLY THAT WONT EVER HAPPEN. EVENTUALLY EITHER
   582				 THE PAGE WILL GET CREATED & MAPPED BY US, OR CREATED
   583				 BY SOMEBODY ELSE AND MAPPED BY US. ~
   584
   585	000376'	200300	000015	SIMIM2:	MOVE T1,P2	;T1/PG NO. FAILING MAP UUO
   586	000377'	260040	000000*		PUSHJ P,SIMCRE	;EXPECTS T1. CLOB T1-T4,U,PG.
   587						;SIMCRE SUCCEEDS SKIPPING WITH FILE
   588						;SIZE ATBSIZ SET TO WORD 1 IN THIS
   589						;CREATED PG, IFF THIS IS LAST PG IN FILE.
   590					 JSP T2,[MOVEM	T1,SIMIT1	;Save T1 before we smash it
   591						HRRZS T1	;ERR CODE
   592						CAIE T1,FALNHL	;NOT A HOLE?
   593						JRST FCRER1	;SOME OTHER PROBLEM
   594	000400'	265340	001570'			JRST SIMIM3]	;SOME SNEAKY PERSON CREATED IT
   595								;BEHIND OUR BACK. GO MAP IT.
   596				;CREPAG charges user for all 4 blocks in newly created page.  VMOVPG doesn't.
   597				;Need to charge user for only the blocks actually OUTBLT'ed.
   598	000401'	211300	000004		MOVNI	T1,4		;Undo 4 blocks charged
   599	000402'	332000	000000*		SKIPE	CONTIG##	;If CONTIG=0, VMOVPG has not charged user
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 8-4
SIMIO.MAC	 9-OCT-87 18:31		DATA XFER SETUP ROUTINES

   600	000403'	260040	000000*		 PUSHJ	P,WRTCHG	;If CONTIG#0, CREPAG has charged too much
   601	000404'	550300	000012	SIMIM3:	HRRZ T1,W		;NOW TRY TO MAP THE CREATED PG
   602	000405'	505300	000035		HRLI T1,FNCMFP		;CHANIO MAPUUO ARG
   603	000406'	043300	000014		CHANIO T1,P1		;MAP THE (P2) PAGE
   604					 JSP T2,[MOVEM T1,SIMIT1	;Save T1 before it gets smashed
   605						HRRZS T1	;ERR CODE
   606						CAIE T1,FALHOL	;IF HOLE
   607						CAIN T1,FALPHP	;OR PAST HIGHEST PAGE,
   608						 JRST SIMIM2	;TRY TO CREATE (AGAIN?)
   609	000407'	265340	001575'			JRST  MAPER1]	;SOME OTHER PROBLEM
   610	000410'	254000	000317'		JRST SIMIMX		;MAP SUCCEEDED,HOORAY
   611
   612				;UUO FAILURES, COME HERE. T1/DATA,, UUO ERROR NUMBER
   613				;THEN SETUP T1/ UUO IDENTIFIER INTEGER,, UUO ERROR NUMBER,
   614				;AND FAIL RETURN FROM SIMIOM. CALLERS OR THEIR CALLERS
   615				;WILL INTERPRET T1 AND SET BITS IN DEVIOS, ETC.
   616
   617	000411'	202300	000741'	MAPERR:	MOVEM	T1,SIMIT1	;Important data in both halves of T1
   618	000412'	202340	000742'	MAPER1:	MOVEM	T2,SIMIT2	;Save PC
   619	000413'	505300	000001		HRLI	T1,MAPID	;Tell SIMIOS this is a MAP uuo error
   620	000414'	254000	000327'		JRST	SIMIMF		;Fix PDL and return from UUO
   621
   622	000415'	202300	000741'	FCRERR:	MOVEM	T1,SIMIT1	;Important data in both halves of T1
   623	000416'	202340	000742'	FCRER1:	MOVEM	T2,SIMIT2	;Save PC
   624	000417'	505300	000002		HRLI	T1,FCRID	;Tell SIMIOS this is an FCREATE uuo error
   625	000420'	254000	000327'		JRST	SIMIMF		;Fix PDL and return from UUO
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 9
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   626				SUBTTL DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS
   627
   628				COMMENT ~ ROUTINE OUTBLT
   629				FUNCTION: MOVE <USERWC> WORDS TO CURRENT FILE POSITION
   630					FROM USER AND UPDATE MRU CHANN AND CURR FILE POSITION.
   631
   632				CALL:	MOVE T4,[XWD <USERWC>,,<USERADDR>]
   633					HRRZ AC,DEVSER(F)
   634					PUSHJ P,DDO(AC)		;OUTBLT IS THE DSK DUMP OUTPUT ROUTINE
   635					RETURN ALWAYS HERE. S,DEVIOS UPDATED
   636				EXPECTS: F,S,W	(J)=JOB/JOB NO;		PRESERVES F,U,W
   637				DESTROYS: T1-T4,PG,SETS J_JOB
   638				EXITS: OUBLT4 (SUCCESS), SIMIOS( UUO FAILURE) OUBLTE (DATA ERROR)
   639				~
   640
   641	000421'	265300	000551'	OUTBLT::JSP T1,CKARG
   642	000422'	607000	000020		TLNN S,IO	;SHOULD BE ON; IF WAS OFF, SOMEBODY
   643	000423'	256000	000000'		 STOPCD		;GOOFED, CALLED OUTBLT DURING INPUT     ;;OUTBLT+2
   644	000424'	261040	000014		PUSH P,P1	;NEED AC FOR COUNT
   645	000425'	261040	000011		PUSH P,T4	;0(P)/USERWC,,USERADDR DURING THIS ROUTINE (NOT PRESERVED)
   646	000426'	607000	000353*		TLNN S,IOSUPR	;SKIP IF DOING SUPERIO
   647	000427'	254000	000435'		 JRST OUBLTA	;REGULAR IO,NO NEED TO CHECK THIS:
   648	000430'	200344	000007		MOVE T2,DEVIAD(F);GET PRIV BITS SET BY SUPBEG WHEN HE DID
   649	000431'	607340	000355*		TLNN T2,NOWRT	;HIS FIRST SUPER USETI/O/INPUT
   650	000432'	254000	000435'		 JRST OUBLTA	;OK FOR HIM TO WRITE (WA LICENSE)
   651	000433'	660000	400000		TRO S,IOIMPM
   652	000434'	254000	000544'		 JRST OUBLTE	;SLAP HIS HANDS
   653	000435'	260040	000115'	OUBLTA:	PUSHJ P,SIMIOA	;ASSIGN PAGE, UPDATE MRU CHAIN
   654	000436'	260040	000141'	OUBLT0:	PUSHJ P,SIMIOB	;GET J/POS,DEVPOS(F),%UPT+UPTPOS(W) SET
   655	000437'	554301	000000		HLRZ T1,0(P)	;T1/<USERWC>
   656	000440'	201600	001000		MOVEI P1,1000
   657	000441'	274600	000002		SUB P1,J		;1000-POS = SPACE TO END OF PAGE
   658	000442'	311600	000006		CAML P1,T1
   659	000443'	200600	000006		 MOVE P1,T1	;P1_MIN( [1000-POS] , <USERWC> )
   660	000444'	200452	000000*		MOVE T4,%UPT+UPTSIM(W)
   661	000445'	602440	200000		TRNE T4,NEDRMV	;DOES UPYCVP PG NEED VREMOV
   662	000446'	260040	000220'		 PUSHJ P,SIMRMV	;YES; NEDMAP_1
   663	000447'	201440	100000		MOVEI T4,NEDMAP	;DOES UPTPOS PAGE NEED MAPPING IN?
   664	000450'	616452	000000*		TDNN T4,%UPT+UPTSIM(W)	;SKIP YES
   665	000451'	254000	000454'		 JRST OUBLT1		;NO,PAGE ALREADY ADDRESSABLE
   666	000452'	260040	000270'		PUSHJ P,SIMIOM	;YES,TRY TO MAP PAGE. CREATE IT IF HOLE OR PAST EOF.
   667	000453'	324740	000724'		  PJRST SIMIOS	;FAILED. T1/UUOID,,CODE
   668
   669				;COMPUTE BLT POINTERS FOR XFER DATA TO FILE PG ADDRESSABLE IN UPYCVP
   670	000454'	135400	000003'	OUBLT1:	LDB T3,UPYCVP	;T3/ASSIGNED VP# 1000--VPUMAX
   671	000455'	275400	000440		SUBI T3,CNVVPN	;T3/EXEC VP# 340--370 ETC.
   672	000456'	242400	000011		LSH T3,9
   673	000457'	271402	000000		ADDI T3,(J)	;T3/EXEC ADDR OF BLK IN ASSIGNED VP
   674	000460'	504100	000010		HRL J,T3	;J/EXEC ADDR OF BLK,,WORD NO. IN PG
   675	000461'	550440	000010		HRRZ T4,T3
   676	000462'	504401	000000		HRL T3,0(P)	;T3/USERADDR,,FILE WORDADDR
   677	000463'	271454	777777		ADDI T4,-1(P1)	;T4/END OF BLT
   678	000464'			OUBLT2:	;NOW TOUCH PG FOR FIRST TIME, CAUSING PG FLT TO GET DATA
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 9-2
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   679					;OR ASSIGN COR PG OF ZEROS (IF NEW FILE PG).
   680					;BLT WORDS TO FILE PG FROM USER SPACE
   681	000464'	414310	000000		SWAPIN T1,(T3)	;Cause page fault to read in other 3 blocks
   682	000465'	265300	000466'		JSP T1,.+1	;SAVE FLAGS LH OF T1
   683	000466'	254120	001603'		JRSTF @[XWD PC.UIO,.+1]	;FORCE USER MAP
   684	000467'	256040	001604'		XCTFU <BLT T3,(T4)>
   685	000470'	541300	000472'		HRRI T1,.+2	;FIX RH OF T1 FOR
   686	000471'	254120	000006		JRSTF @T1	;RESTORE FLAGS
   687	000472'	260040	001052'		PUSHJ P,ERRINF		;GET S/BITS OR SKIP IF NO ERR
   688	000473'	254000	000544'		 JRST OUBLTE		;SET DEVIOS,FIX STK,RTN
   689
   690	000474'			OUBLT3:	;IF COUNT .NE. 0 MOD 200, BLT ZEROS TO BALANCE OF
   691					;UPTPOS BLOCK IN FILE PAGE: [VP+POS+COUNT,VP+POS+(COUNT IOR 177)]
   692					;AND SET COUNT TO NEXT HIGHER MULTIPLE OF 200
   693
   694	000474'	200340	000014		MOVE T2,P1	;COUNT
   695	000475'	231340	000200		IDIVI T2,200
   696					JUMPE T3,[MOVE T4,T2	;T4/INTEGRAL BLK COUNT
   697	000476'	322400	001605'			JRST OUBLT4]
   698	000477'	554400	000002		HLRZ T3,J	;T3/EXEC VIRT ADDR OF BEGINNING OF BLK
   699	000500'	270400	000014		ADD T3,P1	;ADD COUNT
   700	000501'	550440	000010		HRRZ T4,T3
   701	000502'	435440	000177		IORI T4,200-1	;T4/END BLT: VP+POS+COUNT IOR 177
   702	000503'	507000	000010		HRLS T3
   703	000504'	402010	000000		SETZM (T3)	;POSSIBLE PG. FLT. & DATA ERROR
   704	000505'	541410	000001		HRRI T3,1(T3)	;T3/VP+POS+COUNT,,VP+POS+COUNT+1
   705	000506'	301450	000000		CAIL T4,(T3)	;SKIP IF NO BLT NECESSARY. (1 SETZM ENUF)
   706	000507'	251411	000000		BLT T3,(T4)	;NO REF TO USER SPACE. POSSIBLE
   707							;PG FLT & PERHAPS DATA ERROR.
   708	000510'	260040	001052'		PUSHJ P,ERRINF		;SKIP IF NO ERR
   709	000511'	254000	000544'		JRST OUBLTE		;S/BITS ARE SET
   710	000512'	551447	000001		HRRZI T4,1(T2)	;T4/1+COUNT//200 = NEXT MULTIPLE 200
   711	000513'			OUBLT4:	;ADVANCE UPTPOS BY INTEGRAL BLK COUNT IN T4.
   712					;AND CHARGE USER FOR BLOCKS WRITTEN
   713					;AND UPDATE READ/WRITE COUNTS PER UNIT
   714	000513'	261040	000011		PUSH P,T4
   715	000514'	260040	000177'		PUSHJ P,SIMADV	;CHECKS FOR PG BOUNDARY
   716	000515'	255000	000000		 JFCL		;(DIDNT CROSS, DONT CARE)
   717	000516'	200301	000000		MOVE T1,0(P)	;BLKS XFERRED
   718	000517'	135340	000003'		LDB T2,UPYCVP	;T2/VP# ASSIGNED THIS CHAN
   719	000520'	047340	777676		VDSKPT T2,	;GET T2/RETR. PTR THIS PAGE, SKIP SUCCESS
   720	000521'	334000	000000		 SKIPA		;FAILED, DONT UPDATE.
   721	000522'	260040	000000*		PUSHJ P,SMSTAT	;EXPECTS S/IO+MODE,T1/BLKS, T2/RETR. PTR
   722	000523'	262040	000006		POP P,T1	;# of blocks
   723	000524'	200100	000000*		MOVE J,JOB
   724	000525'	260040	000403*		PUSHJ P,WRTCHG	;CHARGE FOR T1/BLOCKS WRITTEN
   725
   726					;IF MORE WORDCOUNT EXISTS, CONTINUE LOOPING, ELSE
   727					;UNWIND STACK & EXIT
   728
   729	000526'	210340	000014		MOVN T2,P1
   730	000527'	504600	000007		HRL P1,T2	;P1/-COUNT,,COUNT
   731	000530'	273601	000000		ADDB P1,0(P)	;UPDATE 0(P)/USERWC,,USERADDR
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 9-3
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   732	000531'	577000	000014		HLRES P1
   733	000532'	327600	000436'		JUMPG P1,OUBLT0	;WHILE WC.GT. 0 XFER DATA, MAY NEED TO
   734						;MAP ANOTHER FILE PAGE
   735	000533'	135300	000000*		LDB T1,PIOMOD	;IF DUMP OUTPUT, VALIDATE & WAIT.
   736	000534'	305300	000015		CAIGE T1,SD	;SKIP IF DUMP MODE
   737	000535'	254000	000545'		JRST OUBLT6	;FIX PDL & RETURN. BUFFERED
   738	000536'	135300	000003'		LDB T1,UPYCVP
   739	000537'	661300	000001*		TLO T1,VL.WAT+1	;T1/<WAIT>+<COUNT>+VP#
   740	000540'	047300	777702		VALPAG T1,	;DO NOT RETURN UNTIL DATA WRITTEN
   741	000541'	256000	000000'		 STOPCD		;EVEN IO ERR SHOULD SKIP, PE.NER SET !  ;;OUBLT4+many
   742	000542'	200004	000002		MOVE S,DEVIOS(F);MOST UP TO DATE DEVIOS
   743	000543'	260040	001052'		PUSHJ P,ERRINF	;GET BITS IN S,SKIP IF NONE SET
   744
   745	000544'			OUBLTE:	;PAGE SHOWED ERROR WHEN TOUCHED OR VALIDATE FAILED. EXIT
   746					;WITH DEVIOS BITS ON
   747
   748	000544'	202004	000002		MOVEM S,DEVIOS(F)
   749
   750
   751	000545'			OUBLT6: ;HERE FROM OUBLT4 FOR SUCCESS RTN
   752	000545'	262040	000006		POP P,T1	;GET RID OF MODIFIED USERWC,,USERADDR
   753	000546'	262040	000014		POP P,P1
   754	000547'	200100	000524*		MOVE J,JOB	;FOR ALL EXITERS
   755	000550'	263040	000000		POPJ P,
   756
   757				COMMENT ~ ROUTINE CKARG
   758				FUNCTION: CHECK T4/USERWC,,USERADDR FOR INBLT,OUTBLT
   759					GOTO ADRERR IF USER TRYING TO DO IO TO AC'S
   760					STOPCODE IF USERWC BAD (CALLING MONITOR ROUTINE
   761					SHOULD HAVE CAUGHT IT.
   762				ADDRESS-CHECKING FOR I/O:  SINCE ALL 'I/O' IS DONE
   763					WITH BLT'S, IF THE USER OFFERS AN ILLEGAL ADDRESS,
   764					THE BLT WILL GET AN ILL MEM REF WHEN IT PAGE-FAULTS.
   765					SO SOME DATA TRANSFER WILL TAKE PLACE UP TO THE
   766					POINT OF THE ILLEGAL ADDRESS, WHEREAS UNDER THE
   767					OLD DIRECT DUMP & BUFFERED IO SYSTEM ALL
   768					ADDRESSES WERE CHECKED BEFORE ANY I/O BEGAN.
   769				CALL:	MOVE T4,[USERWC,,USERADDR]
   770					JSP T1,CKARG
   771					RETURN HERE, T2/GARB
   772				~
   773	000551'	554340	000011	CKARG:	HLRZ T2,T4
   774	000552'	305340	000001		CAIGE T2,1
   775	000553'	256000	000000'		 STOPCD		;CALLER CONFUSED        ;;CKARG+2
   776	000554'	550340	000011		HRRZ T2,T4	;USERADDR
   777	000555'	307340	000017		CAIG T2,17	;BELOW 17 IS AC'S
   778	000556'	254000	000000*		JRST ADRERR
   779	000557'	254006	000000		JRST (T1)	;RETURN
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 10
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   780				COMMENT ! ROUTINE INBLT
   781				FUNCTION: MOVE <USERWC> WORDS FROM CURRENT FILE POSN TO
   782					<USERADDR>, UPDATE MRU CHANN AND FILE POSN, AND IF
   783					CURR POSN GOES TO FIRST BLK NEXT PAGE, MAP & PREREF
   784					THE PAGE .  IN CASE USER IS TRYING TO
   785					INPUT FROM A HOLE, BLT ZEROS TO HIS DATA AREA.
   786					     DO NOT ENFORCE INTEGRAL-MULTIPLE OF 200-WORD
   787					XFERS, BUT SIMULATE DISK CONTROLLER ADVANCING
   788					TO NEXT BLOCK BOUNDARY BY ADVANCING POS BY INTEGRAL
   789					MULTIPLE OF 200 WORDS, AND CHARGE HIM FOR INTEGRAL
   790					BLOCKS READ.  HANDLE ANY ERRORS, SETTING DEVIOS BITS
   791					VIA SIMIOS EXIT.
   792				EXPECTS: F,S,W, (J)=JOB/JOB NUMBER
   793				DESTROYS: T1-T4,PG, SETS J_JOB
   794				CALL:	MOVE T4,[<USERWC>,,<USERADDR>]
   795					HRRZ AC,DEVSER(F)
   796					PUSHJ P,DDI(AC)		;INBLT IS DSK DUMP INPUT ROUTINE
   797					ALWAYS RETURN HERE. S,DEVIOS UPDATED
   798				EXIT: THRU INBLT5 (SUCCESS), INBLTE (DATA ERROR) OR
   799					SIMIOS (UUO FAILURES)
   800				!
   801
   802	000560'	265300	000551'	INBLT::	JSP T1,CKARG
   803	000561'	261040	000014		PUSH P,P1	;NEED AC FOR COUNT
   804	000562'	261040	000011		PUSH P,T4	;0(P)/ USERWC,,USERADDR DURING INBLT
   805	000563'	603000	000020		TLNE S,IO	;THIS SHOULD BE OFF
   806	000564'	256000	000000'		 STOPCD		;WASNT. SOMEBODY CALLED INBLT DURING OUTPUT ;;INBLT+4
   807	000565'	260040	000115'		PUSHJ P,SIMIOA	;ASSIGN PAGE, UPDATE MRU CHAIN
   808	000566'	260040	000141'	INBLT0:	PUSHJ P,SIMIOB	;GET J/POS,DEVPOS(F),%UPT+UPTPOS(W) SET
   809	000567'	554301	000000		HLRZ T1,0(P)	;T1/<USERWC>
   810	000570'	201600	001000		MOVEI P1,1000
   811	000571'	274600	000002		SUB P1,J	;1000-POS = SPACE TO END OF PG
   812	000572'	311600	000006		CAML P1,T1
   813	000573'	200600	000006		MOVE P1,T1	;P1_MIN( [1000-POS] , <USERWC> )
   814	000574'	201440	200000		MOVEI T4,NEDRMV	;DOES UPYCVP PG NEED REMOVE?
   815	000575'	612452	000000*		TDNE T4,%UPT+UPTSIM(W)
   816	000576'	260040	000220'		PUSHJ P,SIMRMV	;YES,REMOVE,NEDMAP_1; NEDRMV_GOTHOL_0
   817	000577'	201440	040000		MOVEI T4,GOTHOL	;ARE WE LOOKING AT
   818	000600'	612452	000000*		TDNE T4,%UPT+UPTSIM(W)	;HOLE PAGE IN FILE?
   819	000601'	254000	000704'		JRST INBLT7	;YES
   820	000602'	201440	100000		MOVEI T4,NEDMAP	;DOES CURRENT UPTPOS DATA
   821	000603'	616452	000000*		TDNN T4,%UPT+UPTSIM(W)	;NEED MAPPING IN?
   822	000604'	254000	000607'		JRST INBLT1		;NO. DATA MUST ALREADY BE ADDRESSABLE
   823	000605'	260040	000270'		PUSHJ P,SIMIOM		;YES, TRY TO GET IT
   824					JRST [CAME T1,[MAPID,,FALHOL]	;DID WE HIT A HOLE
   825						JRST SIMIOS		;NO,HANDLE OTHER ERRORS
   826						MOVEI T1,GOTHOL	;MAKE NOTE THAT CURR PG
   827						IORM T1,%UPT+UPTSIM(W);IS A HOLE,
   828	000606'	254000	001610'			JRST INBLT7]	;AND GO PROCESS HOLE
   829
   830
   831	000607'			INBLT1:
   832	000607'	135400	000003'		LDB T3,UPYCVP
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 10-2
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   833	000610'	275400	000440		SUBI T3,CNVVPN	;T3/EXEC VP# 340 - 370 ETC.
   834	000611'	242400	000011		LSH T3,9
   835	000612'	271402	000000		ADDI T3,(J)	;T3/EXEC ADDR OF BLK IN ASSIGNED PG
   836	000613'	504100	000010		HRL J,T3	;J/EXEC ADDR OF BLK,,WORD NO IN PG
   837	000614'	517000	000010		HRLZS T3
   838	000615'	540401	000000		HRR T3,0(P)	;T3/DATA WORD ADDR,,USERADDR
   839	000616'	550441	000000		HRRZ T4,0(P)
   840	000617'	271454	777777		ADDI T4,-1(P1)	;T4/END OF BLT=USERADDR+COUNT-1
   841	000620'			INBLT2:	;NOW TOUCH FILE PAGE FOR FIRST TIME. XFER WORDS TO
   842					;USER SPACE. MAY CAUSE PG FLT TO GET DATA PAGE IN.
   843					;P1/COUNT	T3/BLT PTR	T4/ENDING USER ADDR
   844	000620'	554300	000010		HLRZ   T1,T3	;Exec virtual address (a per process page)
   845	000621'	414306	000000		SWAPIN T1,(T1)	;Cause page fault which reads from disk
   846	000622'	265300	000623'		JSP T1,.+1	;SAVE FLAGS
   847	000623'	254120	001615'		JRSTF @[XWD PC.UIO,.+1]	;SET UIO. ENFORCE USER MAP
   848	000624'	256200	001604'		XCTTU <BLT T3,(T4)>	;Possible page fault on destination
   849	000625'	541300	000627'		HRRI T1,.+2	;FIX RH OF T1,
   850	000626'	254120	000006		JRSTF @T1	;RESTORE FLAGS
   851	000627'	260040	001052'		PUSHJ P,ERRINF	;SKIP IF NO ERR
   852	000630'	254000	000720'		 JRST INBLTE	;S/BITS SETUP. SET DEVIOS,EXIT
   853
   854	000631'			INBLT3:	;IF COUNT MOD 200 .NE. 0, SET BLOCK COUNT TO
   855					;NEXT HIGHER INTEGRAL MULTIPLE OF 200.
   856
   857	000631'	200340	000014		MOVE T2,P1	;COUNT
   858	000632'	231340	000200		IDIVI T2,200	;T3/REMDR
   859	000633'	332000	000010		SKIPE T3
   860	000634'	271340	000001		ADDI T2,1
   861	000635'	550440	000007		HRRZ T4,T2	;T4/ACTUAL CHARGE COUNT & COUNT TO
   862							;ADVANCE UPTPOS
   863	000636'			INBLT4:	;ADVANCE UPTPOS BY BLK CNT IN T4,UPDATE UNIT
   864					;READ COUNTS, CHARGE USER FOR HIS I/O
   865	000636'	261040	000011		PUSH P,T4	;INTEGRAL BLOCK COUNT
   866	000637'	260040	000177'		PUSHJ P,SIMADV	;ADVANCE UPTPOS,WATCH FOR PG BOUNDARY
   867	000640'	634400	000010		 TDZA T3,T3	;DIDNT CROSS
   868	000641'	201400	000001		MOVEI T3,1	;CROSSED IT
   869	000642'	261040	000010		PUSH P,T3
   870	000643'	200301	777777		MOVE T1,-1(P)	;BLOCK COUNT
   871	000644'	200100	000547*		MOVE J,JOB
   872	000645'	272300	000000*		ADDM T1,JBTRCT	;UPDATE SYSTEM TOTAL
   873	000646'	272302	000645*		ADDM T1,JBTRCT(J)	;AND THIS GUY'S
   874	000647'	135340	000003'		LDB T2,UPYCVP	;T2/ASSIGNED VP# THIS CHAN
   875	000650'	047340	777676		VDSKPT T2,	;GET T2/RETR. PTR THIS PG
   876	000651'	334000	000000		 SKIPA		;FAILURE (WHY?) DONT UPDATE
   877	000652'	260040	000522*		PUSHJ P,SMSTAT	;UNIT COUNTS: EXPECTS S,T1,T2; CLOB T3,U
   878	000653'	260040	000000*		PUSHJ	P,GTCGSZ	;GET T1/ CHARGING SIZE.
   879	000654'	262040	000010		POP P,T3	;FLAG 1 CROSSED PG BDRY, 0 DIDNT CROSS
   880	000655'	262040	000007		POP P,T2	;BLOCKS
   881	000656'	220300	000007		IMUL T1,T2
   882	000657'	272300	000000*		ADDM T1,JBTSIN	;SYSTEM TOTAL
   883	000660'	272302	000657*		ADDM T1,JBTSIN(J); AND HIS
   884	000661'	210340	000014		MOVN T2,P1
   885	000662'	504600	000007		HRL P1,T2	;P1/-COUNT,,COUNT
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 10-3
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   886	000663'	273601	000000		ADDB P1,0(P)	;UPDATE 0(P)/USERWC,,USERADDR
   887	000664'	577000	000014		HLRES P1
   888	000665'	327600	000566'		JUMPG P1,INBLT0	;WHILE WC>0, XFER DATA. MAY NEED TO MAP
   889							;NEX FILE PG. SIMADV NOTICED THAT.
   890
   891					;WC WENT TO ZERO. IF IOSUPR, REMOVE PG & EXIT. IF
   892					;CROSS FILE PG BOUNDARY, NEDRMV IS SET=1 SO REMOVE IT,
   893					;MAP NEXT PG IN, PREREFERENCE IT & RETURN SUCCESS
   894
   895	000666'	607000	000426*		TLNN S,IOSUPR	;IF IOSUPR, REMOVE UNCONDITIONALLY
   896							;THIS KEEPS US FROM HOLDING ONTO A PAGE
   897							;MAPPED RDO IN CASE HE DOES OUTPUT NEXT.
   898							;(DSKCLN SHOULDNT SUFFER HERE BECAUSE
   899							;IT DOES ALL FULL-PAGE I/O, SO WE'RE
   900							;GOING TO THROW AWAY PG ANYWAY).
   901	000667'	322400	000700'		JUMPE T3,INBLT5	;PAGE DIDNT CHANGE
   902	000670'	260040	000220'		PUSHJ P,SIMRMV		;VREMOV CURRENT,RESET GOTHOL ETC
   903	000671'	603000	000666*		TLNE S,IOSUPR
   904	000672'	254000	000700'		JRST INBLT5
   905	000673'	260040	000270'		PUSHJ P,SIMIOM		;MAP CURRENT UPTPOS
   906	000674'	254000	000700'		JRST INBLT5	;ERROR, HANDLE NEXT TIME
   907	000675'	135300	000003'		LDB T1,UPYCVP	;T1/ASSIGNED PG NO.
   908	000676'	047300	777703		PREREF T1,
   909	000677'	256000	000000'		 STOPCD ;(NEVER SPOSED TO HAPPEN)       ;;INBLT4+many
   910				;GENERAL EXIT
   911	000700'	262040	000011	INBLT5:	POP P,T4	;UNWIND STACK
   912	000701'	262040	000014		POP P,P1	;RESTORE AC
   913	000702'	200100	000644*		MOVE J,JOB	;MAKE SURE FOR ALL EXITERS
   914	000703'	263040	000000		POPJ P,
   915
   916	000704'			INBLT7:	;PROCESS REQUEST TO READ FROM A HOLE. BLT ZEROS IN
   917					;USER SPACE. NO REFERENCE TO PER-PROCESS PAGE. AS LONG
   918					;AS GOTHOL IS ON, DO THIS. NOTE THAT SIMRMV CLEARS
   919					;GOTHOL, AND SIMADV FORCES SIMRMV TO BE CALLED WHEN
   920					;IT DETECTS A PG BOUNDARY WAS CROSSED.
   921					;P1/COUNT	0(P)/USERWC,,USERADDR
   922
   923	000704'	540401	000000		HRR T3,0(P)	;T3/USERADDR
   924	000705'	265300	000706'		JSP T1,.+1	;SAVE FLAGS
   925	000706'	254120	001616'		JRSTF @[XWD PC.UIO,.+1]
   926	000707'	256200	001617'		XCTBU <SETZM (T3)>	;POSSIBLE PG FLT HERE
   927	000710'	507000	000010		HRLS T3
   928	000711'	541410	000001		HRRI T3,1(T3)	;T3/USERADDR,,USERADDR+1
   929	000712'	550441	000000		HRRZ T4,0(P)
   930	000713'	271454	777777		ADDI T4,-1(P1)	;T4/END OF BLT
   931	000714'	301450	000000		CAIL T4,(T3)	;SKIP IF BLT NOT NEEDED. 1 SETZM TOOK CARE OF IT.
   932	000715'	256240	001604'		 XCTBU <BLT T3,(T4)>	;BLT ZEROS "INPUT FROM
   933	000716'	541300	000631'		HRRI T1,INBLT3	;A HOLE" IN USER SPACE. NO REF TO EXEC
   934	000717'	254120	000006		JRSTF @T1	;ADDRESS. RESET FLAGS AFTER FIXING T1 RH
   935							;RETURN INLINE TO INBLT3
   936
   937	000720'			INBLTE: ;DISK PAGE SHOWED UP W/ERROR AFTER
   938					;TOUCHED IT FOR 1ST TIME. EXIT WITH STK FIXED AND
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 10-4
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   939					;DEVIOS SET
   940					;IF SUPERIO, REMOVE PAGE IN CASE HE DOES OUTPUT
   941					;NEXT.  (KEEPS US FROM HOLDING ONTO A PAGE MAPPED RDO)
   942	000720'	202004	000002		MOVEM S,DEVIOS(F)
   943	000721'	603000	000671*		TLNE S,IOSUPR
   944	000722'	260040	000220'		PUSHJ P,SIMRMV	;UPYCVP MUST EXIST OR STOPCD
   945	000723'	254000	000700'		JRST INBLT5
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 11
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   946				COMMENT ~ ERROR EXIT SIMIOS,FOR INBLT,OUTBLT
   947				FUNCTION: TRANSLATE VUUO ERROR CODES INTO DEVIOS ERROR BITS.
   948					RETURN (FAILURE..SINCE ERROR BITS ARE ON)
   949				CALL: MOVE T1,[UUOID,,UUO-ERROR-CODE]
   950					PJRST SIMIOS
   951					RETURNS POPJ TO CALLER'S CALLER
   952				UPDATES: S,DEVIOS, SETS J_JOB TO RESTORE FROM INBLT,OUTBLT
   953				EXPECTS: S,F,T1, ALSO EXPECTS T4,P1 IN PDL
   954				DESTROYS: T1
   955				CALLERS: INBLT, OUTBLT
   956				(AS LONG AS THIS CODE ONLY HANDLES FCREATE & MAP
   957				ERRORS, NO NEED TO VREMOV THE PAGE BEFORE EXITING, BECAUSE
   958				NO PAGE WAS MAPPED IF MAP FAILED, AND MAP NOT DONE IF
   959				FCREATE FAILED.)
   960
   961				STOPCD(SIMIOX) if LH of T1 is out of range (unexpected UUOID)
   962				STOPCD(SIMUUX) if RH of T1 is out of range or an unrecoverable error code
   963				~
   964
   965	000724'	262040	000011	SIMIOS:	POP	P,T4		;GET <USERWC>,,<USERADDR> BACK (MODIFIED)
   966	000725'	262040	000014		POP	P,P1		;RESTORE AC USED FOR WORDCOUNT
   967	000726'	200100	000702*		MOVE	J,JOB
   968	000727'	557000	000006		HLRZS	T1		;Get UUO ID
   969	000730'	202300	000743'		MOVEM	T1,SIMITU	;In case it's bad
   970	000731'	303300	000005		CAILE	T1,%%TL		;Check if it's one of the 5 legal UUO-ID's
   971	000732'	256000	001620'	SIMIOX:: STOPCD (.,JOB,SIMIOX,SIMIOY,<Unexpected UUO at SIMIOS>)
   972				 ;;SIMIOS+6
   973	000733'	256006	000733'		XCT	%%SIMT-MAPID(T1) ;Go to MAP.E or FCR.E
   974
   975	000734'	254000	000744'	%%SIMT:	JRST	MAP.E		;MAP FILE PAGE
   976	000735'	254000	000745'		JRST	FCR.E		;FILE CREATE PAGE
   977	000736'	256000	000732'		 STOPCD (,XCT,SIMIOX)
   978					;VREMOV should never come here
   979	000737'	256000	000732'		 STOPCD (,XCT,SIMIOX)
   980					;PREREF should never come here
   981	000740'	256000	000732'		 STOPCD (,XCT,SIMIOX)
   982					;PAGSTS should never come here
   983			000005	%%TL==.-%%SIMT
   984
   985	000741'			SIMIT1:: BLOCK 2		;T1 stored here by MAPERR or FCRERR
   986			000742'	SIMIT2=:SIMIT1+1		;T2 has PC of where error was detected
   987	000743'			SIMITU:: BLOCK 1		;UUO name stored here
   988
   989	000744'	334300	001624'	MAP.E:	SKIPA	T1,['MAP   ']	;Here on error during MAPF
   990	000745'	200300	001625'	FCR.E:	 MOVE	T1,['FCREAT']	;Here on error during FCREATE
   991	000746'	202300	000743'		MOVEM	T1,SIMITU	;Store name of UUO that failed
   992	000747'	550300	000741'		HRRZ	T1,SIMIT1	;Get the error code
   993	000750'	303300	000027		CAILE	T1,%%ERTL	;Check if it is in the table of known errors
   994	000751'	256000	001626'	SIMUUF:: STOPCD (.,JOB,SIMUUF,SIMIOY,<SIMIO UUO Failure>)
   995					;;FCR.E+3
   996	000752'	256006	001023'		XCT	%%UUET(T1)	;Set S or else STOPCD (,XCT,SIMUUF) ;;FCR.E+4
   997	000753'	202004	000002		MOVEM	S,DEVIOS(F)	;Do something like set IOEND
   998	000754'	263040	000000		POPJ	P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 11-2
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

   999
  1000				;"UUO is FCREAT, returned error code is 123456,,123456, count addr = 200,,1000
  1001
  1002	000755'	260040	000000*	SIMIOY:	PUSHJ	P,INLMES##	;This routine called by STOPCD processor
  1003	000756'	526531	720322		 ASCIZ	/UUO is /	;"MAP" or "FCREAT"
	000757'	715000	000000
  1004	000760'	331340	000743'		SKIPL	T2,SIMITU	;SIXBIT names are negative
  1005	000761'	271340	000020		 ADDI	T2,'0'		;If small integer, make printing digit
  1006	000762'	260040	000000*		PUSHJ	P,PR6BIT##	;Print sixbit (even if right justified)
  1007	000763'	260040	000755*		PUSHJ	P,INLMES##
  1008	000764'	261016	262750		 ASCIZ	/, returned error code = /
	000765'	727455	662710
	000766'	203136	271336
	000767'	711014	367710
	000770'	625007	520000
  1009	000771'	200300	000741'		MOVE	T1,SIMIT1	;Get saved value
  1010	000772'	260040	000000*		PUSHJ	P,HWDPNT##	;Print as halfwords
  1011	000773'	200340	000742'		MOVE	T2,SIMIT2	;Get PC
  1012	000774'	260040	000000*		PUSHJ	P,PCP##		;Output PC of where error was noticed
  1013	000775'	260040	000763*		PUSHJ	P,INLMES##
  1014					 ASCIZ	/
  1015	000776'	064252	767744	Word count and address = /
	000777'	621014	367752
	001000'	673504	060734
	001001'	621014	162310
	001002'	713136	371500
	001003'	365000	000000
  1016	001004'	200300	000011		MOVE	T1,T4
  1017	001005'	260040	000772*		PUSHJ	P,HWDPNT##
  1018	001006'	260040	000775*		PUSHJ	P,INLMES##
  1019	001007'	201004	020100		 ASCIZ	/     Total free pages on disk = /
	001010'	523376	460730
	001011'	203156	262712
	001012'	203414	163712
	001013'	715015	767100
	001014'	623236	365500
	001015'	365000	000000
  1020				PRINTF(<[SIMIOY Check DRBSTR instead of STRDDB?]>)
  1021	001016'	201340	000000*		MOVEI	T2,STRDDB	; Check right structure
  1022	001017'	200307	000000*		MOVE	T1,STRTAL##(T2)	;(see also the CORE command in COMCON)
  1023	001020'	260040	000000*		PUSHJ	P,RADX10##	;Output decimal number (even if negative)
  1024	001021'	260040	000000*		PUSHJ	P,CRLF##
  1025	001022'	324740	000000*		PJRST	DSKCLN##	;Set FULL DSKCLN flag and continue
  1026
  1027
  1028					SALL
  1029	001023'	256000	000751'	%%UUET:	 STOPCD (,XCT,SIMUUF)
  1030					; 0 FALCTG - CONTIG FIELD 0
  1031	001024'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1032					; 1 FALDVR - VM PG OUT OF RANGE
  1033	001025'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1034					; 2 FALCPU - CUR PROT UNDEF
  1035	001026'	256000	000751'		 STOPCD (,XCT,SIMUUF)
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 11-3
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1036					; 3 FALVEX - VM PG EXISTS WHICH SHOULDNT
  1037	001027'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1038					; 4 FALNEX - VM PG DOESNT EXIST WHICH SHOULD
  1039	001030'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1040					; 5 FALSVR - VREPLIC. VP OUT OF RANGE
  1041	001031'	670000	001632'		TDO S,[IOEND,,IODEND]	; 6 FALPHP - PAST EOF, END OF UNIT/STR
  1042	001032'	660000	400000		TRO S,IOIMPM		; 7 FALFPZ - PAGE <0 OR 0
  1043	001033'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1044					;10 FALCOR - PVYCOR LIMIT EXCEEDED
  1045	001034'	660000	100000		TRO S,IODTER		;11 FALRBE - RIB ERR
  1046	001035'	660000	100000		TRO S,IODTER		;12 FALBDS - BAD SAT
  1047	001036'	660000	400000		TRO S,IOIMPM		;13 FALCPL - CUR PROT ILLEGAL
  1048						;SHOULD NEVER GET THIS UNLESS SOMEBODY WITH READ-
  1049						;ABSOLUTE DOES SUPER-USETI THEN OUTPUT, WHICH
  1050						;WILL SNEAK BY ALL CHECKS IN SIMDMP,SIMBOU, BUT
  1051						;FILSER WILL COUGH BECAUSE IT CHECKS WRITE-ABSOLUTE
  1052						;BEFORE DOING SMAP WITH PROT=RDW.
  1053	001037'	660000	400000		TRO S,IOIMPM		;14 FALLKO - TRYING TO MAP LOOKUP-ONLY FILE
  1054	001040'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1055					;15 FALHOL - PAGE IS A HOLE (CATCH THIS IN SIMIOM)
  1056	001041'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1057					;16 FALNHL - FCREATE: NOT A HOLE
  1058	001042'	660000	400000		TRO S,IOIMPM		;17 FALSNM - SUPER MAP NAME BAD
  1059	001043'	660000	100000		TRO S,IODTER		;20 FALOPE - IO ERR ON VALIDATION OF PG VREMOV)
  1060	001044'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1061					;21 FALSAM - SAME PG NOS. (REPLIC,FEXCH)
  1062	001045'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1063					;22 FALSUP - MAP BUT IOSUPR ON. SHOULDNT HAPPEN
  1064	001046'	660000	400000		TRO S,IOIMPM		;23 FALNOF - NO FILE
  1065	001047'	660000	400000		TRO S,IOIMPM		;24 FALNWT - NO WRITE (ENTERED BUT APPEND ONLY,
  1066								;        OR NOT ENTERED: NOTE--UNDER PRE-VM SYS,
  1067								;        NOT ENTERED,IOIMPM; APP ONLY,IOBKTL
  1068	001050'	660000	040000		TRO S,IOBKTL		;25 FALAQA - DISK FULL/QUOTA EXCEEDED
  1069	001051'	256000	000751'		 STOPCD (,XCT,SIMUUF)
  1070					;26 FALCTL - ^C. NOT SPOSED TO GET THIS ERROR
  1071			000027	%%ERTL==.-%%UUET
  1072					XALL
  1073
  1074
  1075				REPEAT 0,<ROUTINE ERRINF, VERSION 1
  1076				FUNCTION: FOR INBLT,OUTBLT, TO SET IODERR/IODTER IN S IF
  1077					PERSTS UUO INDICATES THAT THE PAGE JUST TOUCHED
  1078					HAD EITHER OF THESE ERRORS.
  1079				DESTROYS: T1
  1080				RETURNS: SKIPPING IF NO BITS SET
  1081					NOSKIP IF S/ IODTER,IODERR WERE SET
  1082				
  1083				
  1084				ERRINF:	AOS (P)
  1085					PUSH P,T2
  1086					MOVE T1,[-2,,T1]	;GET 2 WDS DATA INTO T1,T2
  1087					PERSTS T1,		;T2 ONLY ONE OF INTEREST
  1088					 STOPCD			;NO PERMISSABLE ERROR RTNS (inside REPEAT 0)
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 11-4
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1089					JUMPL T2,[SOS -1(P)	;NOSKIP RTN
  1090						TLNE T2,EI.DER	;PAGE GOT DEVICE ERROR?
  1091						TRO S,IODERR
  1092						TLNE T2,EI.DTE	;DATA ERR
  1093						TRO S,IODTER
  1094						JRST .+1]
  1095					POP P,T2
  1096					POPJ P,
  1097				>  ;End of REPEAT 0
  1098				REPEAT 0,<ROUTINE ERRINF, VERSION 2
  1099				FUNCTION: FOR INBLT,OUTBLT, SET IODERR/IODTER IN S IF
  1100					LMYERR IS ON IN LMAP SLOT FOR THE PAGE
  1101					FOR THE CURRENT CHANNEL.
  1102				EXPECTS: W/CHANNEL
  1103				DESTROYS: T1
  1104				RETURNS: SKIPPING IF NO BITS SET IN S
  1105					NON-SKIP IF S/IODTER,IODERR WERE SET
  1106				
  1107				ERRINF:	PUSH P,W
  1108					LDB W,UPYCVP	;W/VP # THIS CHANN
  1109					CAIGE W,1000		;PER PROCESS PG?
  1110					 STOPCD                         ;(inside REPEAT 0)
  1111					LDB T1,LMYERR		;T1/LMAP ERROR BITS THIS PG
  1112					POP P,W
  1113					JUMPE T1,CPOPJ1		;SKIP, NO ERROR
  1114					TRNE T1,LMPDTE
  1115					TRO S,IODTER
  1116					TRNE T1,LMPDER
  1117					TRO S,IODERR
  1118					POPJ P,
  1119				;BIT DEFN'S IN LMYERR FIELD:
  1120				LMPDTE==1
  1121				LMPDER==2
  1122				>  ;END REPEAT 0
  1123
  1124				COMMENT ~ ERRINF, VERSION 3
  1125				FUNCTION: FOR INBLT,OUBLT; SET IODERR/IODTER IN S
  1126					IF PAGSTS UUO SHOWS ERRORS FOR THE PAGE
  1127				NOTE:	PAGSTS LOOKS IN OHT, WHICH MAY RECORD OUTPUT ERRORS
  1128					CAUSED BY OTHER SHARERS OF THIS PAGE
  1129					OR BY SWAP OUT FAILURE. OR PARITY PROBLEMS.
  1130					THESE ARE REPORTED TO HIM NOW ALSO AS IF HE HAD CAUSED THEM.
  1131
  1132				EXPECTS: S/DEVIOS(F)	W/CHANNEL
  1133				DESTROY: T1
  1134				CALL:	PUSHJ P,ERRINF
  1135				 ERROR, S/IODERR,IODTER SET AS NEEDED
  1136				OK, NO BITS SET IN S BY THIS CALL
  1137				~
  1138
  1139
  1140	001052'	135300	000003'	ERRINF:	LDB T1,UPYCVP
  1141	001053'	047300	777707		PAGSTS T1,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 11-5
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1142					 STOPCD                 ;;ERRINF+2 (version 3 of ERRINF)
  1143	001054'	256000	000000'	IFE S$NONAME-S$NONAME,< XCT S$NAME ;**** unnamed STOPCD ****>
  1144	001055'	603300	000251*		TLNE T1,PS.DTE
  1145	001056'	660000	100000		TRO S,IODTER
  1146	001057'	603300	000253*		TLNE T1,PS.DER
  1147	001060'	660000	200000		TRO S,IODERR
  1148	001061'	603300	000000*		TLNE T1,PS.DTE!PS.DER
  1149	001062'	263040	000000		POPJ P,			;THIS CALL CAUSED SOME BIT TO SET
  1150	001063'	254000	000217*		JRST CPOPJ1		;NONE SET THIS CALL
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 12
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1151				COMMENT ~ ROUTINE SIMBIN -- BUFFERED MODE INPUT
  1152				FUNCTION: DSK CLASS BUFFERED INPUT SIMULATION ROUTINE.  FOR
  1153					THAT PORTION OF USER BUFFER RING AT AND AHEAD OF
  1154					DEVIAD(F), WHOSE USE BITS ARE 0,
  1155					TRANSFER DATA FROM DISK PAGE(S) TO BUFFERS, SETTING
  1156					USE BITS AND ADVANCING DEVIAD. RETURN WHEN BUFFER
  1157					ENCOUNTERED WHOSE USEBIT=1.
  1158				CALL:	XCT CLIBUF(DEYCLS)	CAUSES PUSHJ P,SIMBIN
  1159					RETURN HERE ALWAYS
  1160				CALLERS:
  1161				EXPECTS: F,S,W,U/ RING HEADER; DEVIAD(F)/BUFFER TO WRITE ON
  1162				PRESERVES: F,W,U,RING HEADER: DOES NOT TOUCH RING HEADER
  1163				UPDATES: S,DEVIOS; DEVIAD; BUFFER STATUS & WORDCOUNT WORDS
  1164				~
  1165
  1166	001064'			SIMBIN::
  1167	001064'	607200	060000		TLNN F,ENTRB!LOOKB	;GOTTA HAVE ONE OF THESE,
  1168	001065'	603000	000721*		TLNE S,IOSUPR		;OR THIS, ELSE
  1169	001066'	334000	000000		SKIPA
  1170	001067'	660000	400000		TRO S,IOIMPM		;BOMB HIM
  1171	001070'	550344	000007		HRRZ T2,DEVIAD(F)	;NEXT BUFFER TO WRITE ON
  1172	001071'	603000	000040		TLNE S,IOEND		;ALREADY HIT END?
  1173	001072'	660000	020000		TRO S,IODEND		;YES,SIGNAL USER
  1174	001073'	616000	001633'	SIMBI1:	TDNN S,[IOEND,,IOIMPM!IODTER!IODERR!IODEND!IOBKTL]
  1175					XCTBU <SKIPGE (T2)>	;USE BIT ON(BUFF FULL)? SKIP NO
  1176	001074'	256200	001634'
  1177	001075'	254000	001131'		JRST SIMBIX
  1178	001076'	702600	400000*		NOCHARGE		;NO MICROCYCLE CHARGE UNTIL USRXIT
  1179	001077'	551447	000002		HRRZI T4,2(T2)		;<USERADDR> DATA BEGINNING LOCN
  1180	001100'	505440	000200		HRLI T4,200		;DSK BUFFERS DATA ALWAYS 200 WDS
  1181	001101'	550304	000003		HRRZ T1,DEVSER(F)
  1182	001102'	260046	777777		PUSHJ P,DDI(T1)	;XFER 1 BLOCK DATA TO USER
  1183						;PASS T4/<USERWC>,,<USERADDR>
  1184	001103'	201440	000200		MOVEI T4,200		;BUFFER WC IS 200,PROBABLY
  1185	001104'	550304	000007		HRRZ T1,DEVIAD(F)
  1186	001105'	603000	001065*		TLNE S,IOSUPR		;(FOR SURE 200 IF SUPER IO)
  1187	001106'	254000	001122'		JRST SIMBI2		;SKIP THE ABT STUFF
  1188	001107'	550344	000360*		HRRZ T2,DEVATB(F)
  1189	001110'	135400	000361*		LDB T3,ATYBSZ		;TRUE FILE SIZE IN BLOCKS
  1190	001111'	271400	000001		ADDI T3,1		;ADJUST TO ACCOUNT FOR THE FACT
  1191								;THAT UPTPOS ALREADY ADVANCED TO
  1192								;NEXT BLOCK BY INBLT
  1193								;T4/BUFFER WORDCOUNT IS 200
  1194	001112'	313412	000000*		CAMLE T3,%UPT+UPTPOS(W)	;UNLESS AT OR PAST LAST BLK
  1195	001113'	254000	001122'		JRST SIMBI2		;IN FILE. IF PAST, QUIT NOW
  1196	001114'	661000	000040		TLO S,IOEND		;WITHOUT TOUCHING BUFF WC OR
  1197	001115'	312412	000000*		CAME T3,%UPT+UPTPOS(W)	;STATUS. IF AT LAST BLOCK,
  1198	001116'	254000	001131'		JRST SIMBIX		;(PAST LAST BLOCK)
  1199	001117'	135440	000000*		LDB T4,ATYWSZ		;STORE PARTIAL WORDCOUNT OF LAST BLK
  1200	001120'	336000	000011		SKIPN T4		;WHICH IS <200 IF PARTIAL,
  1201	001121'	201440	000200		MOVEI T4,200		;OR 200 IF FULL
  1202	001122'			SIMBI2:	;T4/BUFF WC   T1/DEVIAD   S/CURR STATUS
  1203	001122'	256200	001635'		UMOVEM T4,1(T1)	;INSTALL WORDCOUNT IN BUFF
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 12-2
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1204	001123'	256200	001636'		UMOVEM S,-1(T1)		;INSTALL BUFFER STATUS
  1205	001124'	205340	400000		MOVSI T2,IOUSE
  1206	001125'	256200	001637'		XCTBU <IORB T2,(T1)>	;MARK BUFFER FULL & GET NEXT
  1207	001126'	542344	000007		HRRM T2,DEVIAD(F)	;DEVIAD IS NOW ADVANCED LIKE
  1208								;ADVBFF WOULD DO.
  1209	001127'	606000	000040		TRNN S,IOCON	;SKIP IF SYNC MODE, 1 BUFF AT A TIME
  1210	001130'	254000	001073'		JRST SIMBI1	;CONTINUE UNLESS ERRORS OR HIT FULL BUFF
  1211							;(MEANS WE FINISHED THE RING)
  1212	001131'	202004	000002	SIMBIX:	MOVEM S,DEVIOS(F)
  1213	001132'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 13
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1214				COMMENT ~ ROUTINE SIMBOU - SIMULATED BUFFERED DSK OUTPUT
  1215				FUNCTION: DSK CLASS DEVICE DEPENDENT ROUTINE. MOVES DATA
  1216					TO FILE PAGE(S) FROM USER BUFFER RING BEGINNING
  1217					AT CURRENT (DEVOAD), QUITTING WHEN IT ENCOUNTERS
  1218					A BUFFER THAT'S EMPTY (USE BIT OFF).
  1219					THIS ROUTINE CAN BE CALLED BY USETO AND CLOSE CODE.
  1220					ON EXIT, DEVOAD IS FULLY ADVANCED.
  1221					APPROPRIATE DEVIOS BITS TURNED ON HERE IF ERRORS.
  1222				CALL:	MOVE AC,DSK DEVICE CLASS (DEYCLS)
  1223					XCT CLOBUF(AC)	;CAUSES PUSHJ P,SIMBOU
  1224					RETURN HERE ALWAYS
  1225				EXPECTS: F,S,W,U/RING HEADER--NOT TOUCHED; DEVOAD/BUFFER TO EMPTY
  1226				DESTROYS: T1-T4,PG
  1227				UPDATES:DEVIOS,DEVOAD,ATBSIZ,USER BUFFER STATUS WORDS
  1228				RESTRICTIONS:
  1229				~
  1230
  1231	001133'			SIMBOU::
  1232	001133'	607200	020000		TLNN F,ENTRB
  1233	001134'	603000	001105*		TLNE S,IOSUPR
  1234	001135'	334000	000000		SKIPA
  1235	001136'	254000	001222'		JRST SIMBO3	;GOTTA HAVE IOSUPR OR ENTRB
  1236	001137'	602000	740000		TRNE S,IOIMPM!IODTER!IODERR!IOBKTL ;ERROR ALREADY ?
  1237	001140'	254000	001223'		JRST SIMBO4	;YES,EXIT ADVANCING 1 BUFFER
  1238	001141'	621000	000040		TLZ S,IOEND	;RESET FLAG MAY HAVE BEEN SET BY USETO
  1239	001142'	702600	400000*		NOCHARGE ;NO MICROCYCLES UNTIL USRXIT
  1240	001143'	550344	000010		HRRZ T2,DEVOAD(F)
  1241	001144'			SIMBO1:
  1242	001144'	256200	001640'		XCTBU <SKIPL (T2)>	;BUFFER THATS EMPTY (USEBIT=0)?
  1243	001145'	254000	001227'		JRST SIMBOX
  1244	001146'	256200	001641'		XCTFU <HRRZ T4,1(T2)>	;T4/USER WC
  1245	001147'	333000	000011		SKIPLE T4		;ASSUME 200 IF CRUMMY WC
  1246	001150'	303440	000200		CAILE T4,200		;IE, NOT 1.LE.WC.LE.200
  1247	001151'	201440	000200		MOVEI T4,200
  1248	001152'	261040	000011		PUSH P,T4		;WORDCOUNT
  1249	001153'	517000	000011		HRLZS T4
  1250	001154'	541447	000002		HRRI T4,2(T2)		;USER DATA ADDR STARTS AFTER WC WORD
  1251	001155'	550304	000003		HRRZ T1,DEVSER(F)
  1252	001156'	603000	001134*		TLNE S,IOSUPR		;IF SUPER IO, NO NEED TO FUSS
  1253					JRST [	PUSHJ P,DDO(T1)	;WITH ATB STUFF. PASS T4/WC,,ADDR
  1254						POP P,T1	;GET WC BACK OUT,DONT NEED
  1255	001157'	254000	001642'			JRST SIMBO2]	;AND GO FIX USER BUFF HDR
  1256	001160'	260046	777776		PUSHJ P,DDO(T1)		;CALL DSK DMP SERVICE ROUTINE
  1257								;PASS T4/USERWC,,USERADDR
  1258	001161'	550344	001107*		HRRZ T2,DEVATB(F)
  1259	001162'	135400	001110*		LDB T3,ATYBSZ		;INTEGRAL NO. BLKS IN FILE
  1260	001163'	200452	000000*		MOVE T4,%UPT+UPTPOS(W)	;CURRENT POSITION (ALREADY ADVANCED)
  1261	001164'	275440	000001		SUBI T4,1
  1262	001165'	262040	000006		POP P,T1		;WC, MAY BE <200
  1263	001166'	607000	001156*		PAGE (T3)
  1264	001167'	271400	000003
  1265	001170'	242400	777776			;T3/ACTUAL PAGES NOW IN FILE
  1266	001171'	607000	001166*		PAGE (T4)
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 13-2
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1267	001172'	271440	000003
  1268	001173'	242440	777776			;T4/PG IN WHICH WE JUST WROTE
  1269	001174'	312400	000011		CAME T3,T4		;IF NOT THE SAME, WE WROTE IN HOLE,
  1270	001175'	254000	001212'		JRST SIMBO2		;OR SOMEBODY SNUK IN, TRUNCATED/
  1271								;EXTENDED FILE. LEAVE ABTSIZ ALONE.
  1272	001176'	200452	000000*		MOVE T4,%UPT+UPTPOS(W)	;T4/OUR BLK POSN(ADVANCED).
  1273	001177'	275440	000001		SUBI T4,1		;T4/OUR BLK NO, .GE. 1
  1274	001200'	242440	000007		LSH T4,7		;CONVERT T4 TO ATBSIZ FORMAT:
  1275	001201'	405300	000177		ANDI T1,177		;(INTEGRAL BLKS)LSH 7+
  1276	001202'	273440	000006		ADDB T4,T1		;WORDS MOD 200
  1277	001203'	606300	000177		TRNN T1,177		;COPY IN T1: ROUND UP WHOLE BLOCK
  1278	001204'	271300	000200		ADDI T1,200		;IF WHOLE BLOCK WRITTEN. T1/200+
  1279								;OUR WORDS IN FILE
  1280	001205'	200407	000000*		MOVE T3,ATBSIZ(T2)	;ATBSIZ: ROUND UP WHOLE BLOCK IF
  1281	001206'	606400	000177		TRNN T3,177		;WHOLE BLK WRITTEN (NO PARTIAL WRDS)
  1282	001207'	271400	000200		ADDI T3,200		;T3/200+WORDS IN FILE
  1283	001210'	313300	000010		CAMLE T1,T3		;IF OUR WORDS+200>FILE WORDS+200,
  1284	001211'	202447	001205*		MOVEM T4,ATBSIZ(T2)	;UPDATE
  1285	001212'			SIMBO2:
  1286	001212'	550304	000010		HRRZ T1,DEVOAD(F)
  1287	001213'	256200	001636'		UMOVEM S,-1(T1)		;STORE STATUS IN USER BUFF HDR
  1288	001214'	205340	400000		MOVSI T2,IOUSE
  1289	001215'	256200	001645'		XCTBU <ANDCAB T2,(T1)>	;RESET USE BIT IN CURRENT BUFF,
  1290	001216'	542344	000010		HRRM T2,DEVOAD(F)	;AND GET NEXT BUFF ADDR, TO DDB
  1291	001217'	602000	740040		TRNE S,IOCON!IOIMPM!IODTER!IODERR!IOBKTL ;DID WE GET ANY ERROR?
  1292	001220'	254000	001227'		JRST SIMBOX	;YES, EXIT WITHOUT ADVANCING FURTHER
  1293							;IS IOCON SET? YES EXIT NOW HAVING
  1294							;ADVANCED ONE BUFFER
  1295	001221'	254000	001144'		JRST SIMBO1	;NO ERRORS, T2/NEXT BUFFER IN RING.
  1296	001222'			SIMBO3:	;ERROR BEFORE BEGAN PROCESSING, NEED TO SET IOIMPM
  1297	001222'	660000	400000		TRO S,IOIMPM
  1298	001223'			SIMBO4:	;ERROR BEFORE BEGAN PROCESSING--ADVANCE 1 BUFF,EXIT
  1299	001223'	550304	000010		HRRZ T1,DEVOAD(F)
  1300	001224'	205340	400000		MOVSI T2,IOUSE
  1301	001225'	256200	001645'		XCTBU <ANDCAB T2,(T1)> ;RESET CURRENT BUFFER USE BIT,
  1302	001226'	542344	000010		HRRM T2,DEVOAD(F)	 ;AND GET T2/NEXT BUFF ADDR TO DDB
  1303	001227'	202004	000002	SIMBOX:	MOVEM S,DEVIOS(F)
  1304	001230'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 14
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1305				COMMENT ~ ROUTINE SIMDMP -- SIMIO DUMP MODE INPUT & OUTPUT
  1306				FUNCTTION: PICK UP USER IOWD'S, TRANSLATE THEM INTO INBLT/OUTBLT
  1307					ARG [+<USERWC>,,<USERADDR>], & CALL APPROPRIATE
  1308					SERVICE ROUTINE; CONTINUE UNTIL ERROR BIT OR END OF
  1309					USER DMP MODE COMMAND LIST.
  1310				CALL:	MOVEI M,ADDRESS OF USER IO COMMAND LIST
  1311					MOVEI AC,DSK DEVICE CLASS
  1312					XCT CLODMP(AC) OR XCT CLIDMP(AC) CAUSES PUSHJ P,SIMDMP
  1313					ALWAYS RETURN HERE. S,DEVIOS UPDATED W/ERROR BITS IF NEEDED
  1314				EXPECTS: S,J,F,W, M/ USER CMD LIST ADDR
  1315				DESTROYS: T1-T4
  1316				RESTRICTIONS:
  1317				UPDATES: DEVIOS
  1318				~
  1319
  1320	001231'			SIMDMP::
  1321	001231'	205340	020000		MOVSI T2,ENTRB	;IF OUTPUT, GOTTA HAVE THIS OR SUPERIO;
  1322	001232'	607000	000020		TLNN S,IO	;ELSE IF INPUT, CAN HAVE EITHER OF THESE
  1323	001233'	661340	040000		TLO T2,LOOKB	;OR SUPER. BUT IN ANY CASE,
  1324	001234'	616200	000007		TDNN F,T2	;GOTTA HAVE ONE OF THESE
  1325	001235'	603000	001171*		TLNE S,IOSUPR		;OR THIS, ELSE
  1326	001236'	334000	000000		SKIPA
  1327	001237'	660000	400000		TRO S,IOIMPM		;BOMB HIM
  1328	001240'	702600	400000*		NOCHARGE	;NO MICROCYCLES UNTIL USRXIT
  1329	001241'	603000	000020		TLNE S,IO
  1330	001242'	254000	001245'		JRST SIMD0
  1331	001243'	603000	000040		TLNE S,IOEND	;INPUT. ALREADY HIT END?
  1332	001244'	660000	020000		TRO S,IODEND	;YES,SIGNAL USER
  1333	001245'	211400	000003	SIMD0:	MOVNI T3,3	;THIS IS A "GOTO" COUNT
  1334	001246'	201340	740000	SIMD1:	MOVEI T2,IODTER!IODERR!IOIMPM!IOBKTL	;OUTPUT. ONLY TEST ERROR BITS
  1335	001247'	607000	000020		TLNN S,IO	;(SKIP IF OUTPUT)
  1336	001250'	660340	020000		TRO T2,IODEND	;INPUT. TEST IODEND ALSO
  1337	001251'	256200	001646'		XCTFU <SKIPE T1,(M)>	;T1/USER IOWD. EXIT IF END CMD LIST,
  1338	001252'	602007	000000		TRNE S,(T2)	;OUTPUT: TEST ERRORS; INPUT TEST EOF TOO.
  1339	001253'	254000	001340'		JRST SIMDX	;UPDATE DEVIOS.
  1340	001254'	603300	777777		TLNE T1,-1	;A "GOTO" WORD?
  1341	001255'	254000	001261'		JRST SIMD2	;NO
  1342	001256'	345400	000556*		AOJGE T3,ADRERR	;TOO MANY GOTO WORDS
  1343	001257'	540540	000006		HRR M,T1	;DO THE "GOTO"
  1344	001260'	254000	001246'		JRST SIMD1
  1345
  1346	001261'			SIMD2:	;T1/-USERWC,,USERADDR-1
  1347	001261'	574440	000006		HLRE T4,T1	;T4/-USERWC
  1348	001262'	213000	000011		MOVNS T4
  1349					JUMPLE T4,[TRO S,IOBKTL
  1350	001263'	323440	001647'			JRST SIMDX]
  1351	001264'	261040	000013		PUSH P,M
  1352	001265'	261040	000011		PUSH P,T4		;+USERWC
  1353	001266'	507000	000011		HRLS T4
  1354	001267'	541446	000001		HRRI T4,1(T1)		;T4/+USERWC,,USERADDR
  1355	001270'	550304	000003		HRRZ T1,DEVSER(F)
  1356	001271'	201406	777777		MOVEI T3,DDI(T1)	;WHICH WAY ARE WE GOING, IN OR OUT?
  1357	001272'	603000	000020		TLNE S,IO
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 14-2
SIMIO.MAC	 9-OCT-87 18:31		DEVICE SERVICE ROUTINES CALLED BY INPUT,OUTPUT,USETX,CLOSE UUOS

  1358	001273'	201406	777776		MOVEI T3,DDO(T1)	;OUT
  1359	001274'	603000	001235*		TLNE S,IOSUPR		;IF DOING SUPER IO, NO NEED
  1360					JRST [	PUSHJ P,(T3)	;TO FUSS W/ATB STUFF. CALL IN/OUT
  1361						POP P,T4	;ROUTINE, PASS T4. RETURN,
  1362						POP P,M		;POP USERWC,USER LIST ADDR
  1363	001275'	254000	001651'			AOJA M,SIMD0]	; ADVANCE,DO NEXT IOWD
  1364	001276'	260050	000000		PUSHJ P,(T3)		;DO THE IN/OUT ROUTINE. T4/WC,,ADDR
  1365	001277'	550344	001161*		HRRZ T2,DEVATB(F)	;FOR ALL REFS TO ATYBSZ,ATBSIZ
  1366	001300'	262040	000011		POP P,T4		;T4/USERWC
  1367	001301'	262040	000013		POP P,M			;USER LIST ADDR
  1368	001302'	135300	001162*		LDB T1,ATYBSZ		;T1/ACTUAL BLOCKS IN FILE NOW
  1369	001303'	200412	000000*		MOVE T3,%UPT+UPTPOS(W)	;IN/OUT POSN (ADVANCED)
  1370	001304'	275400	000001		SUBI T3,1		;ADJUST FOR ALREADY ADVANCED
  1371	001305'	607000	000020		TLNN S,IO		;SKIP IF OUTPUT
  1372	001306'	254000	001335'		JRST SIMD3		;DOING INPUT
  1373					;DOING OUTPUT. SEE IF ATBSIZ NEEDS UPDATE
  1374	001307'	621000	000040		TLZ S,IOEND		;RESET FLAG MAY HAVE BEEN SET BY USETO
  1375	001310'	607000	001274*		PAGE (T1)
  1376	001311'	271300	000003
  1377	001312'	242300	777776			;T1/REAL PAGES IN FILE
  1378	001313'	607000	001310*		PAGE (T3)
  1379	001314'	271400	000003
  1380	001315'	242400	777776			;T3/PG IN WHICH WE JUST WROTE
  1381	001316'	312300	000010		CAME T1,T3		;IF DIFFERENT, WE WROTE IN HOLE,
  1382						;OR SOMEONE SNUCK IN, EXTENDED/TRUNCATED FILE
  1383						;SINCE WE MAPPED THIS PG, SO DONT
  1384						;TOUCH ATBSIZ.
  1385	001317'	344540	001245'		AOJA M,SIMD0		;JUST GO FOR NEXT USER IOWD
  1386					;WE ARE IN SAME PAGE
  1387	001320'	200412	000000*		MOVE T3,%UPT+UPTPOS(W)	;CONVERT OUR UPTPOS/USERWC TO
  1388	001321'	275400	000001		SUBI T3,1		;ATBSIZ FORMAT: (INTEGRAL BLKS)LSH 7
  1389	001322'	242400	000007		LSH T3,7		;+WORDS MOD 200
  1390	001323'	405440	000177		ANDI T4,177
  1391	001324'	273400	000011		ADDB T3,T4		;COPY IN T4 ROUND UP WHOLE BLOCK
  1392	001325'	606440	000177		TRNN T4,177		;IF WHOLE BLK WRITTEN (NO PARTIAL
  1393	001326'	271440	000200		ADDI T4,200		;WC) FOR CAMLE BELOW
  1394	001327'	200307	001211*		MOVE T1,ATBSIZ(T2)	;ATBSIZ: ROUND UP BY A WHOLE BLOCK
  1395	001330'	606300	000177		TRNN T1,177		;IF WHOLE BLK (NO PARTIAL WC)
  1396	001331'	271300	000200		ADDI T1,200		;FOR CAMLE. T1/200+FILE WORDS
  1397								;T4/200+OUR WORDS
  1398	001332'	313440	000006		CAMLE T4,T1		;IF WE ARE PAST ATBSIZ,
  1399	001333'	202407	001327*		MOVEM T3,ATBSIZ(T2)	;UPDATE.
  1400	001334'	344540	001245'		AOJA M,SIMD0		;GO GET NEXT USER IOWD
  1401
  1402
  1403	001335'			SIMD3:	;HERE ON INPUT AFTER INBLT
  1404	001335'	311300	000010		CAML T1,T3		;SKIP IF AFTER EOF
  1405	001336'	344540	001245'		AOJA M,SIMD0		;NOT,LEAVE S,DEVIOS ALONE
  1406	001337'	670000	001632'		TDO S,[IOEND,,IODEND]	;SET BOTH BITS NOW & QUIT
  1407
  1408	001340'	202004	000002	SIMDX:	MOVEM S,DEVIOS(F)
  1409	001341'	263040	000000		POPJ P,
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 15
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1410					SUBTTL	USETI/USETO
  1411
  1412
  1413				COMMENT #
  1414				@@SUBROUTINE USETI0
  1415				@@PURPOSE
  1416				USETI ROUTINE.
  1417				@@ENTRY
  1418				EXPECTS F/ DDB, S/ DEVIOS, AND M/ LOG. NO. OF DESIRED BLOCK.
  1419				@@ACCUM
  1420				DESTROYS P1-P3, T1-T4, AND ?
  1421				@@EXIT
  1422				@@ #
  1423
  1424	001342'	702600	400000*	USETI0::	NOCHARGE
  1425	001343'	603000	001313*		TLNE	S,IOSUPR	;SUPER USETI DONE ALREADY?
  1426	001344'	254000	001525'		JRST	SPRCON		;YES. GET NEW BLOCK NUMBER.
  1427	001345'	607200	060000		TLNN	F,LOOKB!ENTRB	;NO. LOOKUP DONE?
  1428	001346'	254000	001512'		JRST	SPRBGN		;NO. SUPER USETI IF PRIVILEGED.
  1429
  1430	001347'	322540	000000*		JUMPE	M,ERRFUL	;
  1431	001350'	603000	000000*		TLNE	S,IOBDRB	;IS THIS FILE DEAD?
  1432	001351'	254000	000000*		JRST	ERRBDR		;YES.
  1433	001352'	621000	000020		TLZ	S,IO		;
  1434	001353'	550344	001277*		HRRZ	T2,DEVATB(F)	;LOC OF ACCESS TABLE.
  1435	001354'	135300	001302*		LDB	T1,ATYBSZ	;HIGHEST REL BLK WRITN IN FILE.
  1436	001355'	326300	001357'		JUMPN	T1,.+2		;NOT SURE THIS
  1437	001356'	476004	000000*		SETOM	DEVFLO(F)	;IS NECESSARY.
  1438	001357'	321540	001364'		JUMPL	M,USTIN2	;WANT TO BE SET UP AFTER EOF?
  1439	001360'	313540	000006		CAMLE	M,T1		;NO.  REQ BLK PAST HIGHEST BLK?
  1440	001361'	254000	001364'		JRST	USTIN2		;YES.
  1441	001362'	202544	000210*		MOVEM	M,DEVPOS(F)	;
  1442	001363'	254000	001367'		JRST	USTIN4		;
  1443	001364'	271300	000001	USTIN2:	ADDI	T1,1		;
  1444	001365'	202304	001362*		MOVEM	T1,DEVPOS(F)	;
  1445	001366'	674000	001632'		TDOA	S,[XWD IOEND,IODEND]
  1446	001367'	630000	001632'	USTIN4:	TDZ	S,[XWD IOEND,IODEND]
  1447	001370'	205300	400000		MOVSI	T1,400000	;FLAG TO SIMIOB
  1448	001371'	436304	001365*		IORM	T1,DEVPOS(F)	;THAT SOMETHING'S HAPPENED.
  1449	001372'	324740	000000*		PJRST	STOIOS		;STORE S AND RETURN.
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1450				COMMENT #
  1451				@@SUBROUTINE USETO0
  1452				@@PURPOSE
  1453				USETO ROUTINE.
  1454				@@ENTRY
  1455				EXPECTS F/ DDB, S/ DEVIOS, AND M/ LOG. NO. OF DESIRED BLOCK.
  1456				@@ACCUM
  1457				DESTROYS
  1458				@@EXIT
  1459				@@ #
  1460
  1461				EXTERN FALRBE,FALAQA,SWEPHO,SETACH,ATYBSZ,ATYWSZ
  1462				EXTERN INLMES,PRNAME,STRDDB,STRNAM,TTYFUW,TTYSTR
  1463				EXTERN DEVATB,DEVFLO,DEVLOK,DEVPOS,DEVSUP,ERRBDR,ERRFUL,ERRIMP
  1464				EXTERN LOKMOD,RELRIB,RELSAT,STOIOS,TRHALT,SUPBEG,SUPBND,UNLFIL
  1465				EXTERN WSCHED,IOSUPR
  1466
  1467	001373'	702600	400000*	USETO0:: NOCHARGE
  1468	001374'	603000	001343*		TLNE	S,IOSUPR	;SUPER USETI OR USETO DONE ALREADY?
  1469					JRST 	[MOVE T1,DEVIAD(F) ;YES, GET NORED,NOWRT BITS
  1470						TLNE T1,NOWRT	;SKIP IF LEGAL TO WRITE
  1471						PJRST ERRIMP	;GIVE IOIMPM
  1472	001375'	254000	001655'			JRST SPRCON]	;GET NEW BLOCK NUMBER.
  1473	001376'	607200	020000		TLNN	F,ENTRB		;NO. ENTER BEEN DONE?
  1474	001377'	254000	001512'		JRST	SPRBGN		;NO. (1ST) SUPER USETO IF LEGAL.
  1475
  1476	001400'	323540	001347*		JUMPLE	M,ERRFUL
  1477	001401'	200004	000002	USETO1:	MOVE	S,DEVIOS(F)	;
  1478	001402'	603000	001350*		TLNE	S,IOBDRB	;
  1479	001403'	254000	001351*		JRST	ERRBDR		;SET SOME FLAG AND EXIT.
  1480	001404'	661000	000020		TLO	S,IO		;
  1481	001405'	332004	000000*		SKIPE	DEVLOK(F)	;
  1482	001406'	256000	000000'		 STOPCD                         ;;USETO1+5
  1483	001407'	550344	001353*		HRRZ	T2,DEVATB(F)	;LOC OF ACCESS TABLE.
  1484	001410'	135300	001354*	USETO2:	LDB	T1,ATYBSZ	;HIGHEST REL BLK WRITN IN FILE.
  1485	001411'	313540	000006		CAMLE	M,T1		;WANT ONE ABOVE HIGHEST?
  1486	001412'	254000	001421'		JRST	USETO4		;YES.
  1487	001413'	200300	000013	USOOUT:	MOVE	T1,M		;
  1488	001414'	661300	400000		TLO	T1,400000	;
  1489	001415'	202304	001371*		MOVEM	T1,DEVPOS(F)	;SIGNAL SIMIOB THAT USETO DONE
  1490	001416'	260040	000000*		PUSHJ	P,UNLFIL	;MAYBE HAVE TO UNLOCK THE FILE.
  1491	001417'	202004	000002		MOVEM	S,DEVIOS(F)
  1492	001420'	263040	000000		POPJ 	P,
  1493
  1494				    ;HERE WHEN WANT BLOCK PAST EOF.
  1495	001421'	313540	001661'	USETO4:	CAMLE	M,[XWD 2000,0]	;(2**35)/128.
  1496					JRST	[PUSHJ P,UNLFIL
  1497	001422'	254000	001662'			PJRST ERRFUL]
  1498	001423'	200440	000006		MOVE	T4,T1		;
  1499	001424'	271440	000003		ADDI	T4,3		;REQ BLK IN LAST
  1500	001425'	620440	000003		TRZ	T4,3		;PARTIAL PAGE OF
  1501	001426'	271440	000001		ADDI	T4,1		;FILE, OR FIRST IN
  1502	001427'	313540	000011		CAMLE	M,T4		;NEXT PAGE?
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16-2
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1503	001430'	254000	001440'		JRST	USETO5		;NO.
  1504	001431'	200440	000013	USOOU4:	MOVE	T4,M		;YES, SET
  1505
  1506				;HERE WHEN THE USETO HAS EXTENDED BY AT LEAST A BLOCK AND PERHAPS ONE
  1507				;OR MORE PAGES. SET THE FILE SIZE, SET IOEND, AND GO TO
  1508				;SET DEVPOS AND FRIENDS. IOEND IS SET TO PREVENT ANY
  1509				;INPUTS FROM SUCCEEDING AFTER THIS USETO WHICH ARE NOT PRECEEDED
  1510				;BY AT LEAST ONE OUTPUT. SIMDMP AND SIMBOU RESET IOEND.
  1511
  1512	001432'	275440	000001		SUBI	T4,1		;THE NEW
  1513	001433'	137440	001410*		DPB	T4,ATYBSZ	;FILE SIZE: BLOCKS,WORDS
  1514	001434'	400440	000000		SETZ	T4,		;WORDS IN LAST BLK
  1515	001435'	137440	001117*		DPB	T4,ATYWSZ	;
  1516	001436'	661000	000040		TLO	S,IOEND		;KEEP INPUT'S FROM SUCCEEDING,
  1517	001437'	254000	001413'		JRST	USOOUT		;& GO DO DEVPOS
  1518
  1519				    ;HERE WHEN EXTENDING FILE.
  1520	001440'	336004	001405*	USETO5:	SKIPN	DEVLOK(F)	;SECOND TIME AROUND?
  1521	001441'	260040	000000*		PUSHJ	P,LOKMOD	;NO, NEED TO LOCK.
  1522	001442'	200004	000002		MOVE	S,DEVIOS(F)	;
  1523	001443'	603000	001402*		TLNE	S,IOBDRB	;
  1524					JRST	[PUSHJ P,UNLFIL ;SET SOME FLAG AND EXIT.
  1525	001444'	254000	001664'			JRST ERRBDR]
  1526	001445'	135400	001433*		LDB	T3,ATYBSZ	;DID THE FILE SIZE CHANGE WHILE
  1527	001446'	312300	000010		CAME	T1,T3		;WE WERE WAITING FOR THE LOCK?
  1528	001447'	254000	001410'		JRST	USETO2		;YES.
  1529	001450'	261040	000013		PUSH	P,M		;NO.
  1530	001451'	260040	000000*		PUSHJ	P,SETACH	;FLAG FILE'S ALLOCATION AS CHANGING
  1531	001452'	271540	000002		ADDI	M,2		;SET UP THE ARGS
  1532	001453'	242540	777776		LSH	M,-2		;FOR SWEEP--M/ OLD
  1533	001454'	242440	777776		LSH	T4,-2		;HPW+1
  1534	001455'	274540	000011		SUB	M,T4		;AND
  1535	001456'	250540	000011		EXCH	M,T4		;T4/ # PAGES TO
  1536	001457'	271540	000001		ADDI	M,1		;CREATE AS
  1537	001460'	400300	000000		SETZ	T1,		;(STOP ON CNTRL C.).
  1538	001461'	260040	000000*		PUSHJ	P,SWEPHO	;HOLES.
  1539	001462'	254000	001470'		JRST	USEROR		;ERROR RETURN.
  1540	001463'	262040	000013		POP	P,M		;SUCCESS RETURN.
  1541	001464'	260040	000000*		PUSHJ	P,RELSAT	;
  1542	001465'	260040	000000*		PUSHJ	P,RELRIB	;
  1543	001466'	550344	001407*		HRRZ	T2,DEVATB(F)	;
  1544	001467'	254000	001431'		JRST	USOOU4		;
  1545
  1546				    ;HERE ON ERROR RETURN FROM SWEEP.  (RIB ERROR, CAN'T
  1547				    ;ALLOCATE, OR CONTROL C WAITING.).
  1548	001470'	262040	000013	USEROR:	POP	P,M		;
  1549	001471'	261040	000006		PUSH	P,T1		;SAVE ERROR CODE FROM SWEPHO
  1550	001472'	260040	001464*		PUSHJ	P,RELSAT	;
  1551	001473'	260040	001465*		PUSHJ	P,RELRIB	;
  1552	001474'	260040	001416*		PUSHJ	P,UNLFIL	;
  1553	001475'	262040	000006		POP	P,T1		;GET CODE BAK.
  1554	001476'	306300	000000*		CAIN	T1,FALRBE	;WAS IT A RIB ERROR?
  1555	001477'	324740	001403*		PJRST	ERRBDR		;YES.
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 16-3
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1556	001500'	550344	001466*		HRRZ	T2,DEVATB(F)	;
  1557	001501'	135340	001445*		LDB	T2,ATYBSZ	;SET DEVPOS 1B0 TO ALERT
  1558	001502'	661340	400000		TLO	T2,400000	;SIMIOB THAT SOME OF THE USETO
  1559	001503'	202344	001415*		MOVEM	T2,DEVPOS(F)	;GOT DONE
  1560	001504'	306300	000000*		CAIN	T1,FALAQA	;ALLOCATION FAILURE?
  1561					JRST	[TRO S,IOBKTL	;SET AN ERROR FLAG,NO DISK
  1562	001505'	254000	001666'			POPJ P,]	;LEFT TO ALLOCATE. RETURN FROM USETO
  1563	001506'	200100	000726*		MOVE	J,JOB		;BETTER SETUP J BEFORE CALLING TRHALT.
  1564	001507'	260040	000000*		PUSHJ	P,TRHALT	; CONTROL C WAITING.
  1565	001510'	260040	000000*		PUSHJ	P,WSCHED	;
  1566	001511'	254000	001401'		JRST	USETO1		;
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1567				    ;HERE ON FIRST SUPER USETI/O.
  1568	001512'	603200	060000	SPRBGN:	TLNE	F,ENTRB+LOOKB
  1569	001513'	254000	001400*		JRST	ERRFUL		;LOSE IF EITHER SO FAR.
  1570	001514'	260040	000000*		PUSHJ	P,SUPBEG	;START UP-CHK PRIV AND NAME.
  1571	001515'	324740	000000*		PJRST	ERRIMP		;SOMETHING WRONG.
  1572	001516'	321540	001513*	SPRCN2:	JUMPL	M,ERRFUL	;OKAY, BUT REQ PAG MUST BE >=0.
  1573	001517'	261040	000013		PUSH	P,M		;
  1574	001520'	242540	777776		LSH	M,B2PLSH	;CONVERT TO PAGES
  1575	001521'	260040	000000*		PUSHJ	P,SUPBND	;CHECK BOUNDS.
  1576					JRST	[POP P,M	;OUT OF BOUNDS.  SET IOBKTL.
  1577	001522'	254000	001670'			JRST ERRFUL]	;
  1578	001523'	262040	000013		POP	P,M		;
  1579	001524'	254000	001413'		JRST	USOOUT		;WIN.
  1580
  1581
  1582
  1583
  1584				    ;HERE ON CONTINUING SUPER IO. INPUT OR OUTPUT
  1585	001525'	550244	000000*	SPRCON:	HRRZ	U,DEVSUP(F)	;GET U/ SPECIFIC UNIT OR 0(STR).
  1586	001526'	254000	001516'		JRST	SPRCN2		;
  1587
  1588	001527'	200500	000007		$END	(SIM)

  1589	001530'	261040	000004

  1590	001531'	261040	000000

  1591	001532'	261040	000007

  1592	001533'	200207	000000*

  1593	001534'	200004	000002

  1594	001535'	260040	000220'

  1595	001536'	202004	000002

  1596	001537'	262040	000007

  1597	001540'	262040	000000

  1598	001541'	262040	000004

  1599	001542'	200307	000000*

  1600	001543'	254000	000101'

  1601	001544'	001200	000006

  1602	001545'	001200	000010

  1603	001546'	202004	000002

SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17-2
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1604	001547'	331304	001503*

  1605	001550'	201300	000001

  1606	001551'	621300	400000

  1607	001552'	202304	001547*

  1608	001553'	202312	000000*

  1609	001554'	254000	000170'

  1610	001555'	260040	000000*

  1611	001556'	635155	625520

  1612	001557'	000002	000000

  1613	001560'	043300	000014

  1614	001561'	265340	000411'

  1615	001562'	254000	000317'

  1616	001563'	201300	400000

  1617	001564'	436312	000000*

  1618	001565'	254000	000376'

  1619	001566'	413212	000000*

  1620	001567'	254000	000411'

  1621	001570'	202300	000741'

  1622	001571'	553000	000006

  1623	001572'	302300	000000*

  1624	001573'	254000	000416'

  1625	001574'	254000	000404'

  1626	001575'	202300	000741'

  1627	001576'	553000	000006

  1628	001577'	302300	000347*

  1629	001600'	306300	000345*

  1630	001601'	254000	000376'
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17-3
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO


  1631	001602'	254000	000412'

  1632	001603'	004000	000467'

  1633	001604'	251411	000000

  1634	001605'	200440	000007

  1635	001606'	254000	000513'

  1636	001607'	000001	001577*

  1637	001610'	312300	001607'

  1638	001611'	254000	000724'

  1639	001612'	201300	040000

  1640	001613'	436312	000000*

  1641	001614'	254000	000704'

  1642	001615'	004000	000624'

  1643	001616'	004000	000707'

  1644	001617'	402010	000000

  1645	001620'	260040	001555*

  1646	001621'	635155	515770

  1647	001622'	400002	000000

  1648	001623'	000000	000755'

  1649	001624'	554160	000000

  1650	001625'	464362	454164

  1651	001626'	260040	001620*

  1652	001627'	635155	656546

  1653	001630'	400002	000000

  1654	001631'	000000	000755'

  1655	001632'	000040	020000

  1656	001633'	000040	760000

SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17-4
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO

  1657	001634'	335007	000000

  1658	001635'	202446	000001

  1659	001636'	202006	777777

  1660	001637'	437346	000000

  1661	001640'	331007	000000

  1662	001641'	550447	000001

  1663	001642'	260046	777776

  1664	001643'	262040	000006

  1665	001644'	254000	001212'

  1666	001645'	413346	000000

  1667	001646'	332313	000000

  1668	001647'	660000	040000

  1669	001650'	254000	001340'

  1670	001651'	260050	000000

  1671	001652'	262040	000011

  1672	001653'	262040	000013

  1673	001654'	344540	001245'

  1674	001655'	200304	000007

  1675	001656'	603300	000431*

  1676	001657'	324740	001515*

  1677	001660'	254000	001525'

  1678	001661'	002000	000000

  1679	001662'	260040	001474*

  1680	001663'	324740	001516*

  1681	001664'	260040	001662*

  1682	001665'	254000	001477*

  1683	001666'	660000	040000
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 17-5
SIMIO.MAC	 9-OCT-87 18:31		USETI/USETO


  1684	001667'	263040	000000

  1685	001670'	262040	000013

  1686	001671'	254000	001663*

  1687						;End of SIMIO  (SIMLIT: SIMEND:)
  1688
NO ERRORS DETECTED
PROGRAM BREAK IS 001672
7K CORE USED
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 18
SIMIO.MAC	 9-OCT-87 18:31		SYMBOL TABLE

ADRERR		001256'	EXT	GOTPHP		400000	SPD	OUTBLT		000421'	INT	SIMD2		001261'	
ATBSIZ		001333'	EXT	GTCGSZ		000653'	EXT	P		000001	INT	SIMD3		001335'	
ATYBSZ		001501'	EXT	HWDPNT		001005'	EXT	P1		000014	INT	SIMDMP		001231'	INT
ATYWSZ		001435'	EXT	INBLT		000560'	INT	P2		000015	INT	SIMDX		001340'	
B2PLSH	777777	777776	SPD	INBLT0		000566'		PAGSTS	047000	777707		SIMEND		001671'	INT
B2WLSH		000007	SPD	INBLT1		000607'		PBMMSK		000026'	EXT	SIMENT		000047'	INT
CHANIO	043000	000000		INBLT2		000620'		PC.UIO		004000	SIN	SIMIA1		000123'	
CKARG		000551'		INBLT3		000631'		PCP		000774'	EXT	SIMIA2		000124'	
CNVVPN		000440	SIN	INBLT4		000636'		PE.NER		000000	EXT	SIMIA3		000126'	
CONTIG		000402'	EXT	INBLT5		000700'		PERSET	047000	777706		SIMIA5		000133'	
CPOPJ		000050'	EXT	INBLT7		000704'		PG		000003	INT	SIMIB1		000164'	
CPOPJ1		001063'	EXT	INBLTE		000720'		PIOMOD		000533'	EXT	SIMIB2		000170'	
CPRRDW		000003	SIN	INLMES		001006'	EXT	PJRST	324740	000000		SIMIM1		000333'	
CPRRED		000001	SIN	IO		000020	SIN	PPPGET		000004'		SIMIM2		000376'	
CRLF		001021'	EXT	IOBDRB		001443'	EXT	PPPPUT		000020'		SIMIM3		000404'	
DDI	777777	777777	SIN	IOBEG		000002	SIN	PR6BIT		000762'	EXT	SIMIMF		000327'	
DDO	777777	777776	SIN	IOBKTL		040000	SIN	PREREF	047000	777703		SIMIMX		000317'	
DEVATB		001500'	EXT	IOCON		000040	SIN	PRNAME		000000	EXT	SIMIO		000000'	ENT
DEVFLO		001356'	EXT	IODEND		020000	SIN	PS.DER		001057'	EXT	SIMIOA		000115'	
DEVIAD		000007	SIN	IODERR		200000	SIN	PS.DTE		001055'	EXT	SIMIOB		000141'	
DEVIOS		000002	SIN	IODTER		100000	SIN	PX.MEM		000004	SPD	SIMIOM		000270'	
DEVLOK		001440'	EXT	IOEND		000040	SIN	PX.SRC		000001	SPD	SIMIOS		000724'	
DEVOAD		000010	SIN	IOIMPM		400000	SIN	PXCT	256000	000000		SIMIOX		000732'	INT
DEVPOS		001552'	EXT	IOSUPR		001374'	EXT	RADX10		001020'	EXT	SIMIOY		000755'	
DEVSER		000003	SIN	IOUSE		400000	SIN	RELRIB		001473'	EXT	SIMIT1		000741'	INT
DEVSUP		001525'	EXT	ITMCHN		000000	EXT	RELSAT		001472'	EXT	SIMIT2		000742'	INT
DIE		001626'	EXT	J		000002	INT	S		000000	INT	SIMITU		000743'	INT
DSKCLN		001022'	EXT	JBTRCT		000646'	EXT	S$ENTR	777777	777775	SIN	SIMLIT		001527'	INT
EI.DER		000000	EXT	JBTSIN		000660'	EXT	S$EVEN		000006	SIN	SIMRL1		000043'	
EI.DTE		000000	EXT	JOB		001506'	EXT	S$HALT	777777	777777	SIN	SIMRL2		000044'	
EI.OER		000000	EXT	LMYERR		000000	EXT	S$INFO		000005	SIN	SIMRLS		000033'	INT
ENTRB		020000	SIN	LOKMOD		001441'	EXT	S$JOB		000002	SIN	SIMRM0		000263'	INT
ERRBDR		001665'	EXT	LOOKB		040000	SIN	S$NAME		000000'	SPD	SIMRM1		000262'	
ERRFUL		001671'	EXT	M		000013	INT	S$NONA		000000	SIN	SIMRM2		000264'	
ERRIMP		001657'	EXT	MAP.E		000744'		S$PATC		000007	SIN	SIMRMV		000220'	
ERRINF		001052'		MAPER1		000412'		S$TEMP		000000	SPD	SIMUUF		000751'	INT
F		000004	INT	MAPERR		000411'		S$XCT	777777	777776	SIN	SMSTAT		000652'	EXT
FALAQA		001504'	EXT	MAPID		000001	SPD	SD		000015	SIN	SPRBGN		001512'	
FALCPL		000351'	EXT	MO.LAC		400000	SPD	SETACH		001451'	EXT	SPRCN2		001516'	
FALHOL		001607'	EXT	MTR		000024	SPD	SIMADV		000177'		SPRCON		001525'	
FALNHL		001572'	EXT	NEDMAP		100000	SPD	SIMBI1		001073'		STEALC		000056'	INT
FALOPE		000243'	EXT	NEDRMV		200000	SPD	SIMBI2		001122'		STEALP		000057'	
FALPHP		001600'	EXT	NODIE		000000	EXT	SIMBIN		001064'	INT	STELP1		000064'	
FALRBE		001476'	EXT	NOWRT		001656'	EXT	SIMBIX		001131'		STELP3		000073'	
FCR.E		000745'		NUMCHN		000000	EXT	SIMBO1		001144'		STOIOS		001372'	EXT
FCRER1		000416'		OUBLT0		000436'		SIMBO2		001212'		STRDDB		001016'	EXT
FCRERR		000415'		OUBLT1		000454'		SIMBO3		001222'		STRNAM		000000	EXT
FCRID		000002	SPD	OUBLT2		000464'		SIMBO4		001223'		STRTAL		001017'	EXT
FNCFCR		000040	SPD	OUBLT3		000474'		SIMBOU		001133'	INT	SUPBEG		001514'	EXT
FNCMFP		000035	SPD	OUBLT4		000513'		SIMBOX		001227'		SUPBND		001521'	EXT
FNCMSP		000043	SPD	OUBLT6		000545'		SIMCRE		000377'	EXT	SWAPIN	414000	000000	
GETB		000010	SIN	OUBLTA		000435'		SIMD0		001245'		SWEPHO		001461'	EXT
GOTHOL		040000	SPD	OUBLTE		000544'		SIMD1		001246'		T1		000006	INT
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88 PAGE 18-2
SIMIO.MAC	 9-OCT-87 18:31		SYMBOL TABLE

T2		000007	INT	
T3		000010	INT	
T4		000011	INT	
TRHALT		001507'	EXT	
TTYFUW		000000	EXT	
TTYSTR		000000	EXT	
U		000005	INT	
UNLFIL		001664'	EXT	
UPNCVP		000043	SPD	
UPSCVP		000012	SPD	
UPTIOC		000000	EXT	
UPTJDA		000000	EXT	
UPTPBM		000000	EXT	
UPTPOS		000000	EXT	
UPTSIM		000000	EXT	
UPYCVP		000003'		
USEROR		001470'		
USETI0		001342'	INT	
USETO0		001373'	INT	
USETO1		001401'		
USETO2		001410'		
USETO4		001421'		
USETO5		001440'		
USOOU4		001431'		
USOOUT		001413'		
USTIN2		001364'		
USTIN4		001367'		
VALPAG	047000	777702		
VDSKPT	047000	777676		
VL.WAT		000000	EXT	
VLIOE%		000000	EXT	
VPUMAX		000000	EXT	
VREMOV	047000	777713		
W		000012	INT	
WRTCHG		000525'	EXT	
WSCHED		001510'	EXT	
ZZ	006353	516045	SPD	
%%ERTL		000027	SPD	
%%SIMT		000734'		
%%TL		000005	SPD	
%%UUET		001023'		
%UPT		000000	EXT	

SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

ADRERR	    78%	   778	  1342
ATBSIZ	    76%	  1280	  1284	  1394	  1399
ATYBSZ	   552	  1189	  1259	  1368	  1435	  1461%	  1484	  1513	  1526	  1557
ATYWSZ	  1199	  1461%	  1515
B2PLSH	  1574
B2WLSH	   348
CKARG	   641	   773#	   802
CNVVPN	   671	   833
CONTIG	   599%	   599
CPOPJ	    68%	   174
CPOPJ1	    68%	   116	   378	  1150
CPRRDW	   480
CPRRED	   476
CRLF	  1024%	  1024
DDI	  1182	  1356
DDO	  1253	  1256	  1358
DEVATB	   551	  1188	  1258	  1365	  1434	  1463%	  1483	  1543	  1556
DEVFLO	  1437	  1463%
DEVIAD	   549	   648	  1171	  1185	  1207	  1469
DEVIOS	   152	   217	   219	   310	   422	   506	   742	   748	   942	   997	  1212	  1303	  1408	  1477
	  1491	  1522
DEVLOK	  1463%	  1481	  1520
DEVOAD	  1240	  1286	  1290	  1299	  1302
DEVPOS	   311	   314	   317	   320	   371	  1441	  1444	  1448	  1463%	  1489	  1559
DEVSER	  1181	  1251	  1355
DEVSUP	  1463%	  1585
DIE	    12	    12%	    13	   435	   971	   994
DSKCLN	  1025%	  1025
EI.DER	    80%
EI.DTE	    80%
EI.OER	    80%
ENTRB	   404	   479	   558	  1167	  1232	  1321	  1427	  1473	  1568
ERRBDR	  1432	  1463%	  1479	  1525	  1555
ERRFUL	  1430	  1463%	  1476	  1497	  1569	  1572	  1577
ERRIMP	  1463%	  1471	  1571
ERRINF	   687	   708	   743	   851	  1140#
F	   152	   213	   216	   217	   219	   222	   310	   311	   314	   317	   320	   371	   404	   422
	   479	   506	   549	   551	   558	   560	   561	   565	   567	   648	   742	   748	   942	   997
	  1167	  1171	  1181	  1185	  1188	  1207	  1212	  1232	  1240	  1251	  1258	  1286	  1290	  1299
	  1302	  1303	  1324	  1355	  1365	  1408	  1427	  1434	  1437	  1441	  1444	  1448	  1469	  1473
	  1477	  1481	  1483	  1489	  1491	  1520	  1522	  1543	  1556	  1559	  1568	  1585
FALAQA	  1461%	  1560
FALCPL	    75%	   540
FALHOL	    75%	   538	   606	   824
FALNHL	    75%	   592
FALOPE	    80%	   417
FALPHP	    75%	   534	   607
FALRBE	  1461%	  1554
FCR.E	   976	   990#
FCRER1	   593	   623#
FCRERR	   622#
FCRID	    85#	   624
FNCFCR	    86#
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

FNCMFP	    88#	   486	   563	   602
FNCMSP	    89#	   488
GETB	   560
GINST	   684#	   684	   685	   848#	   848	   849	   926#	   926	   927	   932#	   932	   933	  1176#	  1176
	  1177	  1203#	  1203	  1204	  1204#	  1205	  1206#	  1206	  1207	  1242#	  1242	  1243	  1244#	  1244
	  1245	  1287#	  1287	  1288	  1289#	  1289	  1290	  1301#	  1301	  1302	  1337#	  1337	  1338
GOTHOL	    56#	   148	   227	   237	   396	   437	   817	   826
GOTPHP	    53#	   227	   237	   337	   523	   535
GTCGSZ	    78%	   878
HWDPNT	  1010%	  1010	  1017%	  1017
INBLT	   802#
INBLT0	   808#	   888
INBLT1	   822	   831#
INBLT2	   841#
INBLT3	   854#	   933
INBLT4	   863#
INBLT5	   901	   904	   906	   911#	   945
INBLT7	   819	   828	   916#
INBLTE	   852	   937#
INLMES	  1002%	  1002	  1007%	  1007	  1013%	  1013	  1018%	  1018	  1462%
IO	   403	   478	   489	   642	   805	  1322	  1329	  1335	  1357	  1371	  1433	  1480
IOBDRB	    76%	  1431	  1478	  1523
IOBEG	   309
IOBKTL	  1068	  1174	  1236	  1291	  1334	  1349	  1561
IOCON	  1209	  1291
IODEND	  1041	  1173	  1174	  1332	  1336	  1406	  1445	  1446
IODERR	   426	  1147	  1174	  1236	  1291	  1334
IODTER	   424	  1045	  1046	  1059	  1145	  1174	  1236	  1291	  1334
IOEND	  1041	  1172	  1174	  1196	  1238	  1331	  1374	  1406	  1445	  1446	  1516
IOIMPM	   651	  1042	  1047	  1053	  1058	  1064	  1065	  1170	  1174	  1236	  1291	  1297	  1327	  1334
IOSUPR	   326	   329	   345	   363	   368	   402	   477	   482	   487	   510	   546	   646	   895	   903
	   943	  1168	  1186	  1233	  1252	  1263	  1266	  1325	  1359	  1375	  1378	  1425	  1465%	  1468
IOUSE	  1205	  1288	  1300
ITMCHN	  1178	  1178%	  1239	  1328	  1424	  1467
J	   349	   657	   673	   674	   698	   723	   754	   811	   835	   836	   871	   873	   883	   913
	   967	  1563
JBTRCT	    76%	   872	   873
JBTSIN	    76%	   882	   883
JOB	    68%	   723	   754	   871	   913	   967	  1563
LISTSN	     3	     6
LMYERR	    73%
LOKMOD	  1464%	  1521
LOOKB	  1167	  1323	  1427	  1568
M	  1337	  1343	  1351	  1362	  1363	  1367	  1385	  1400	  1405	  1430	  1438	  1439	  1441	  1476
	  1485	  1487	  1495	  1502	  1504	  1529	  1531	  1532	  1534	  1535	  1536	  1540	  1548	  1572
	  1573	  1574	  1576	  1578
MAP.E	   975	   989#
MAPER1	   541	   547	   550	   556	   559	   609	   618#
MAPERR	   492	   512	   566	   617#
MAPID	    87#	   619	   824	   973
MO.LAC	  1178	  1239	  1328	  1424	  1467
MTR	  1178	  1239	  1328	  1424	  1467
NEDMAP	    55#	   148	   176	   211	   241	   268	   324	   338	   438	   498	   500	   663	   820
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

NEDRMV	    54#	   177	   227	   237	   324	   339	   376	   437	   472	   661	   814
NODIE	    12%
NOWRT	    76%	   548	   649	  1470
NUMCHN	    70%	   198	   283
OUBLT0	   654#	   733
OUBLT1	   665	   670#
OUBLT2	   678#
OUBLT3	   690#
OUBLT4	   697	   711#
OUBLT6	   737	   751#
OUBLTA	   647	   650	   653#
OUBLTE	   652	   688	   709	   745#
OUTBLT	   641#
P	    13	   107	   134	   151	   156	   159	   179	   195	   213	   214	   215	   218	   220	   221
	   222	   225	   245	   260	   267	   272	   274	   287	   350	   375	   435	   440	   470	   471
	   502	   504	   505	   507	   586	   600	   644	   645	   653	   654	   655	   662	   666	   676
	   687	   708	   714	   715	   717	   721	   722	   724	   731	   743	   752	   753	   755	   803
	   804	   807	   808	   809	   816	   823	   838	   839	   851	   865	   866	   869	   870	   877
	   878	   879	   880	   886	   902	   905	   911	   912	   914	   923	   929	   944	   965	   966
	   971	   994	   998	  1002	  1006	  1007	  1010	  1012	  1013	  1017	  1018	  1023	  1024	  1149
	  1182	  1213	  1248	  1253	  1254	  1256	  1262	  1304	  1351	  1352	  1360	  1361	  1362	  1364
	  1366	  1367	  1409	  1490	  1492	  1496	  1521	  1524	  1529	  1530	  1538	  1540	  1541	  1542
	  1548	  1549	  1550	  1551	  1552	  1553	  1562	  1564	  1565	  1570	  1573	  1575	  1576	  1578
P1	   470	   475	   476	   480	   491	   495	   496	   505	   511	   527	   564	   603	   644	   656
	   657	   658	   659	   677	   694	   699	   729	   730	   731	   732	   733	   753	   803	   810
	   811	   812	   813	   840	   857	   884	   885	   886	   887	   888	   912	   930	   966
P2	   471	   481	   483	   484	   504	   585
PBMMSK	    68%	   111	   130
PC.UIO	   683	   847	   925
PCP	  1012%	  1012
PE.NER	    80%	   428	   495
PG	   230	   242
PIOMOD	    78%	   735
PPPGET	   105#	   260
PPPPUT	   124#	   156
PR6BIT	  1006%	  1006
PRNAME	  1462%
PS.DER	    81%	   425	  1146	  1148
PS.DTE	    81%	   423	  1144	  1148
PX.MEM	   684	   848	   926	   932	  1176	  1203	  1204	  1206	  1242	  1244	  1287	  1289	  1301	  1337
PX.SRC	   684	   932
RADX10	  1023%	  1023
RELRIB	  1464%	  1542	  1551
RELSAT	  1464%	  1541	  1550
S	   152	   214	   217	   219	   221	   309	   310	   326	   329	   345	   363	   368	   402	   403
	   422	   424	   426	   477	   478	   482	   487	   489	   506	   510	   546	   642	   646	   651
	   742	   748	   805	   895	   903	   942	   943	   997	  1041	  1042	  1045	  1046	  1047	  1053
	  1058	  1059	  1064	  1065	  1068	  1145	  1147	  1168	  1170	  1172	  1173	  1174	  1186	  1196
	  1204	  1209	  1212	  1233	  1236	  1238	  1252	  1263	  1266	  1287	  1291	  1297	  1303	  1322
	  1325	  1327	  1329	  1331	  1332	  1335	  1338	  1349	  1357	  1359	  1371	  1374	  1375	  1378
	  1406	  1408	  1425	  1431	  1433	  1445	  1446	  1468	  1477	  1478	  1480	  1491	  1516	  1522
	  1523	  1561
S$ENTR	    12	    18	   112	   126	   132	   209	   373	   400	   412	   418	   421	   430	   436	   474
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

	   497	   501	   643	   741	   775	   806	   909	   972	   977	   979	   981	   995	  1029	  1031	  1033
	  1035	  1037	  1039	  1043	  1054	  1056	  1060	  1062	  1069	  1143	  1482
S$EVEN	   435	   971	   994
S$HALT	    12	   112	   126	   132	   209	   373	   400	   412	   418	   421	   430	   435	   474	   497
	   501	   643	   741	   775	   806	   909	   971	   977	   979	   981	   994	  1029	  1031	  1033
	  1035	  1037	  1039	  1043	  1054	  1056	  1060	  1062	  1069	  1143	  1482
S$INFO	   435	   971	   994
S$JOB	   435	   436	   971	   972	   994	   995
S$NAME	    16#	   112	   126	   132	   209	   373	   400	   412	   418	   421	   430	   474	   497	   501
	   643	   741	   775	   806	   909	  1143	  1482
S$NONA	    15	    18	   112	   126	   132	   209	   373	   400	   412	   418	   421	   430	   436	   474
	   497	   501	   643	   741	   775	   806	   909	   972	   978	   980	   982	   995	  1030	  1032
	  1034	  1036	  1038	  1040	  1044	  1055	  1057	  1061	  1063	  1070	  1143	  1482
S$PATC	   435	   971	   994
S$TEMP	    12#	    12	   112#	   112	   126#	   126	   132#	   132	   209#	   209	   373#	   373	   400#	   400
	   412#	   412	   418#	   418	   421#	   421	   430#	   430	   435#	   435	   474#	   474	   497#	   497
	   501#	   501	   643#	   643	   741#	   741	   775#	   775	   806#	   806	   909#	   909	   971#	   971
	   977#	   977	   979#	   979	   981#	   981	   994#	   994	  1029#	  1029	  1031#	  1031	  1033#	  1033
	  1035#	  1035	  1037#	  1037	  1039#	  1039	  1043#	  1043	  1054#	  1054	  1056#	  1056	  1060#	  1060
	  1062#	  1062	  1069#	  1069	  1143#	  1143	  1482#	  1482
S$XCT	    18	   112	   126	   132	   209	   373	   400	   412	   418	   421	   430	   436	   474	   497
	   501	   643	   741	   775	   806	   909	   972	   977	   978	   979	   980	   981	   982	   995
	  1029	  1030	  1031	  1032	  1033	  1034	  1035	  1036	  1037	  1038	  1039	  1040	  1043	  1044
	  1054	  1055	  1056	  1057	  1060	  1061	  1062	  1063	  1069	  1070	  1143	  1482
SD	   736
SETACH	  1461%	  1530
SIMADV	   362#	   715	   866
SIMBI1	  1174#	  1210
SIMBI2	  1187	  1195	  1202#
SIMBIN	  1166#
SIMBIX	  1177	  1198	  1212#
SIMBO1	  1241#	  1295
SIMBO2	  1255	  1270	  1285#
SIMBO3	  1235	  1296#
SIMBO4	  1237	  1298#
SIMBOU	  1231#
SIMBOX	  1243	  1292	  1303#
SIMCRE	    76%	   586
SIMD0	  1330	  1333#	  1363	  1385	  1400	  1405
SIMD1	  1334#	  1344
SIMD2	  1341	  1346#
SIMD3	  1372	  1403#
SIMDMP	  1320#
SIMDX	  1339	  1350	  1408#
SIMEND	  1687#
SIMENT	   173#
SIMIA1	   261	   267#
SIMIA2	   266	   268#
SIMIA3	   259	   270#
SIMIA5	   272	   281#
SIMIB1	   325	   337#
SIMIB2	   316	   318	   334	   344#
SIMIM1	   490	   510#
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

SIMIM2	   525	   537	   539	   585#	   608
SIMIM3	   594	   601#
SIMIMF	   504#	   620	   625
SIMIMX	   495#	   513	   529	   568	   610
SIMIO	    12	    13#	    16
SIMIOA	   258#	   653	   807
SIMIOB	   308#	   654	   808
SIMIOM	   470#	   666	   823	   905
SIMIOS	   667	   825	   965#
SIMIOX	   971#	   977	   979	   981
SIMIOY	   971	   994	  1002#
SIMIT1	   532	   590	   604	   617	   622	   985#	   986	   992	  1009
SIMIT2	   618	   623	   986#	  1011
SIMITU	   969	   987#	   991	  1004
SIMLIT	  1588#
SIMRL1	   150	   154#
SIMRL2	   144	   157#
SIMRLS	   143#
SIMRM0	   435#
SIMRM1	   406	   434#
SIMRM2	   397	   415	   437#
SIMRMV	   151	   218	   395#	   662	   816	   902	   944
SIMUUF	   994#	  1029	  1031	  1033	  1035	  1037	  1039	  1043	  1054	  1056	  1060	  1062	  1069
SMSTAT	    78%	   721	   877
SPRBGN	  1428	  1474	  1568#
SPRCN2	  1572#	  1586
SPRCON	  1426	  1472	  1585#
STEALC	   193#	   194
STEALP	   194#	   267
STELP1	   199#	   207
STELP3	   201	   204	   207#
STOIOS	  1449	  1464%
STRDDB	  1021	  1462%
STRNAM	  1462%
STRTAL	  1022%	  1022
SUPBEG	  1464%	  1570
SUPBND	  1464%	  1575
SWEPHO	  1461%	  1538
T1	   105	   106	   108	   110	   111	   113	   124	   125	   128	   129	   143	   144	   153	   173
	   174	   175	   176	   177	   178	   196	   203	   205	   210	   211	   223	   227	   230	   234
	   235	   258	   259	   268	   269	   270	   271	   273	   283	   284	   285	   286	   311	   312
	   313	   314	   315	   317	   319	   320	   323	   330	   331	   333	   344	   346	   347	   367
	   371	   372	   410	   419	   427	   431	   472	   473	   485	   486	   488	   491	   498	   499
	   500	   511	   527	   532	   533	   534	   535	   536	   538	   540	   562	   563	   564	   585
	   590	   591	   592	   598	   601	   602	   603	   604	   605	   606	   607	   617	   619	   622
	   624	   641	   655	   658	   659	   681	   682	   685	   686	   717	   722	   735	   736	   738
	   739	   740	   752	   779	   802	   809	   812	   813	   824	   826	   827	   844	   845	   846
	   849	   850	   870	   872	   873	   881	   882	   883	   907	   908	   924	   933	   934	   968
	   969	   970	   973	   989	   990	   991	   992	   993	   996	  1009	  1016	  1022	  1140	  1141
	  1144	  1146	  1148	  1181	  1182	  1185	  1203	  1204	  1206	  1251	  1253	  1254	  1256	  1262
	  1275	  1276	  1277	  1278	  1283	  1286	  1287	  1289	  1299	  1301	  1337	  1340	  1343	  1347
	  1354	  1355	  1356	  1358	  1368	  1376	  1377	  1381	  1394	  1395	  1396	  1398	  1404	  1435
	  1436	  1439	  1443	  1444	  1447	  1448	  1469	  1470	  1484	  1485	  1487	  1488	  1489	  1498
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

	  1527	  1537	  1549	  1553	  1554	  1560
T2	   109	   110	   114	   115	   127	   129	   130	   131	   133	   147	   148	   197	   206	   208
	   210	   212	   215	   216	   220	   223	   235	   264	   321	   327	   328	   333	   348	   349
	   362	   364	   365	   374	   376	   377	   398	   399	   401	   410	   411	   413	   416	   417
	   419	   420	   423	   425	   427	   428	   429	   431	   434	   492	   512	   523	   524	   541
	   547	   548	   549	   550	   551	   556	   559	   565	   590	   604	   618	   623	   648	   649
	   694	   695	   696	   710	   718	   719	   729	   730	   773	   774	   776	   777	   857	   858
	   860	   861	   874	   875	   880	   881	   884	   885	  1004	  1005	  1011	  1021	  1022	  1171
	  1176	  1179	  1188	  1205	  1206	  1207	  1240	  1242	  1244	  1250	  1258	  1280	  1284	  1288
	  1289	  1290	  1300	  1301	  1302	  1321	  1323	  1324	  1334	  1336	  1338	  1365	  1394	  1399
	  1434	  1483	  1543	  1556	  1557	  1558	  1559
T3	   200	   201	   236	   237	   241	   242	   243	   322	   324	   337	   338	   339	   341	   395
	   396	   437	   438	   439	   552	   553	   670	   671	   672	   673	   674	   675	   676	   681
	   684	   696	   698	   699	   700	   702	   703	   704	   705	   706	   832	   833	   834	   835
	   836	   837	   838	   844	   848	   859	   867	   868	   869	   879	   901	   923	   926	   927
	   928	   931	   932	  1189	  1190	  1194	  1197	  1259	  1264	  1265	  1269	  1280	  1281	  1282
	  1283	  1333	  1342	  1356	  1358	  1360	  1364	  1369	  1370	  1379	  1380	  1381	  1387	  1388
	  1389	  1391	  1399	  1404	  1526	  1527
T4	   202	   203	   205	   233	   234	   366	   367	   369	   370	   374	   645	   660	   661	   663
	   664	   675	   677	   684	   696	   700	   701	   705	   706	   710	   714	   773	   776	   804
	   814	   815	   817	   818	   820	   821	   839	   840	   848	   861	   865	   911	   929	   930
	   931	   932	   965	  1016	  1179	  1180	  1184	  1199	  1200	  1201	  1203	  1244	  1245	  1246
	  1247	  1248	  1249	  1250	  1260	  1261	  1267	  1268	  1269	  1272	  1273	  1274	  1276	  1284
	  1347	  1348	  1349	  1352	  1353	  1354	  1361	  1366	  1390	  1391	  1392	  1393	  1398	  1498
	  1499	  1500	  1501	  1502	  1504	  1512	  1513	  1514	  1515	  1533	  1534	  1535
TRHALT	  1464%	  1564
TTYFUW	  1462%
TTYSTR	  1462%
U	  1585
UNLFIL	  1464%	  1490	  1496	  1524	  1552
UPNCVP	    51#	    52	   230	   234	   242
UPSCVP	    50#	    52	   230	   234	   242
UPTIOC	    71%	   270	   282	   286
UPTJDA	    70%	   216	   561	   565	   567
UPTPBM	    71%	   105	   113	   131	   133
UPTPOS	    71%	   158	   315	   321	   323	   344	   362	   366	   481	   553	  1194	  1197	  1260	  1272
	  1369	  1387
UPTSIM	    52	    71%	   147	   157	   175	   178	   202	   210	   223	   235	   236	   243	   269	   273
	   284	   322	   341	   377	   395	   439	   473	   499	   524	   536	   660	   664	   815	   818
	   821	   827
UPYCVP	    52#	   143	   153	   173	   200	   258	   264	   398	   475	   670	   718	   738	   832	   874
	   907	  1140
USEROR	  1539	  1548#
USETI0	  1424#
USETO0	  1467#
USETO1	  1477#	  1566
USETO2	  1484#	  1528
USETO4	  1486	  1495#
USETO5	  1503	  1520#
USOOU4	  1504#	  1544
USOOUT	  1487#	  1517	  1579
USTIN2	  1438	  1440	  1443#
USTIN4	  1442	  1446#
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Symbol cross reference

VL.WAT	    80%	   739
VLIOE%	    80%
VPUMAX	    70%
W	    52	   147	   157	   158	   175	   178	   195	   198	   202	   206	   207	   212	   225	   236
	   243	   269	   273	   315	   321	   322	   323	   341	   344	   362	   366	   377	   395	   439
	   473	   481	   485	   499	   524	   536	   553	   561	   562	   565	   567	   601	   660	   664
	   815	   818	   821	   827	  1194	  1197	  1260	  1272	  1369	  1387
WRTCHG	    76%	   600	   724
WSCHED	  1465%	  1565
ZZ	   684#	   684	   848#	   848	   926#	   926	   932#	   932	  1176#	  1176	  1203#	  1203	  1204#	  1204
	  1206#	  1206	  1242#	  1242	  1244#	  1244	  1287#	  1287	  1289#	  1289	  1301#	  1301	  1337#	  1337
ZZ1	   684#	   684	   848#	   848	   926#	   926	   932#	   932	  1176#	  1176	  1203#	  1203	  1204#	  1204
	  1206#	  1206	  1242#	  1242	  1244#	  1244	  1287#	  1287	  1289#	  1289	  1301#	  1301	  1337#	  1337
%%ERTL	   993	  1071#
%%SIMT	   973	   975#	   983
%%TL	   970	   983#
%%UUET	   996	  1029#	  1071
%UPT	    52	    68%	   105	   113	   131	   133	   147	   157	   158	   175	   178	   202	   210	   216
	   223	   235	   236	   243	   269	   270	   273	   282	   284	   286	   315	   321	   322	   323
	   341	   344	   362	   366	   377	   395	   439	   473	   481	   499	   524	   536	   553	   561
	   565	   567	   660	   664	   815	   818	   821	   827	  1194	  1197	  1260	  1272	  1369	  1387
SIMIO -- VM SYSTEM SIMULATE OLD-STYLE BUFFERED/DUMP IO DSK	MACRO 12.5-46.0 14:38 13-JAN-88
SIMIO.MAC	 9-OCT-87 18:31		Macro/Opdef cross reference

CHANIO	   491	   511	   527	   564	   603
NOCHAR	  1178	  1239	  1328	  1424	  1467
PAGE	    62#	   326	   329	   362	   368	   481	  1263	  1266	  1375	  1378
PAGSTS	   420	  1141
PERSET	   411	   429	   496
PJRST	   667	  1025	  1449	  1471	  1497	  1555	  1571
PREREF	   908
PRINTF	  1020
PXCT	   684	   848	   926	   932	  1176	  1203	  1204	  1206	  1242	  1244	  1287	  1289	  1301	  1337
PXGEN	   684	   848	   926	   932	  1176	  1203	  1204	  1206	  1242	  1244	  1287	  1289	  1301	  1337
STOPCD	    11	   112	   126	   132	   209	   373	   400	   412	   418	   421	   430	   435	   474	   497
	   501	   643	   741	   775	   806	   909	   971	   977	   979	   981	   994	  1029	  1031	  1033
	  1035	  1037	  1039	  1043	  1054	  1056	  1060	  1062	  1069	  1142	  1482
SWAPIN	   681	   845
UMOVEM	  1203	  1204	  1287
VALPAG	   740
VDSKPT	   719	   875
VREMOV	   413	   434
XCTBU	   926	   932	  1175	  1206	  1242	  1289	  1301
XCTFU	   684	  1244	  1337
XCTTU	   848	  1203	  1204	  1287
$END	  1588    	ze'
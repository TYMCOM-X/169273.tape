PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT
     9				SUBTTL	Trap Handler - traps use opcode 0 to switch to Exec mode
    10
    11					STOPCD(,ENTRY,PICON)^
    12					ENTRY	PICON		;For library searches
    13	000000'	260040	000000*	PICON::PUSHJ	P,DIE		;**** Default stopcode for "PICON" ****
    14	000001'	605143	575600		SIXBIT	/PICON/  	;Title of module
    15	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "PICON+nnn(nnnnnn)"
    16			000000'	S$NAME==PICON			;For STOPCDs with no arguments
    17					SALL>
    18				^
    19
    20				EXTERNAL EPLLEN,XACSTL,HIGHJB
    21				EXTERNAL ESTOP,GETOPR,INLMES,JBTUPM,OCTPNT
    22				EXTERNAL JBTSTS,JBTPRV,MLOWQ,JBTFTR
    23				EXTERNAL UPTACP,UPTAC0,UPTPC,UPTPDL,%UPT,%UPS,EPYPSN
    24
    25				;USER TRAP (caused by arithmetic overflow, stack overflow, or TRAP3 flags)
    26
    27				;UUO from Concealed mode, as a result of a Trap, should never happen
    28	000003'	256000	003072'	UUOCTR:: STOPCD (.,JOB,UUOCTR,,<UUO from Concealed mode, Trap>)
    29
    30				;UUO from Public mode, as a result of a Trap
    31	000004'	701140	003075'	UUOPTR::EXECAC				;SWITCH TO EXEC ACS
    32	000005'	336540	000424*		SKIPN	M,%UPT+UPTMUU		;GET THE UUO
    33	000006'	256000	003076'		 STOPCD (.,STOP,UUOZTR,,<Zero address in TRAP uuo>)
    34	000007'	603540	777000		TLNE	M,777000		;IS IT A 0
    35	000010'	254000	000000*		 JRST	UUOPN1##		;NO, USER SUPPLIED INSTRUCTION
    36	000011'	200040	003101'		MOVE	P,[IOWD EPLLEN,%UPT+UPTPDL]
    37	000012'	261040	000425*		PUSH	P,%UPT+UPTMUP		;SAVE RETURN ADDRESS
    38	000013'	254013	000000		JRST	(M)			;DISPATCH
    39
    40
    41				;UUO from Supervisor mode, as a result of a Trap, should never happen
    42	000014'	256000	003102'	UUOSTR:: STOPCD (.,CPU,UUOSTR,,<UUO from Supervisor mode, Trap>)
    43
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2
PICON.MAC	30-OCT-87 17:26		KI Kernel Trap routines

    44				SUBTTL	KI Kernel Trap routines
    45				IFCPU (KI),<	;KI10 exec mode trap (Page Fail, PDL OV)
    46				
    47				;UUO from Kernel mode, as a result of a TRap
    48				UUOKTR::MOVEM	17,@%UPT+UPTACP	;STACK AC'S IN UPT
    49					JSP	17,STKAC
    50					PUSH	P,%UPT+UPTMUP	;SAVE RETURN ADDRESS
    51					HRRZ	17,%UPT+UPTMUU	;Get new address
    52					CAIG	17,1000		;Is it reasonable?
    53					 STOPCD	(,XCT,S..EUE)	;No
    54					JRST	@%UPT+UPTMUU	;DISPATCH ON ADDRESS FROM UUO (ignore opcode)
    55				
    56				STKAC::	EXCH	17,%UPT+UPTACP
    57					HLLM	17,%UPT+UPTACP
    58					HRRZS	17
    59					CAIN	17,%UPT+UPTAC0+20*XACSTL
    60					 STOPCD (.,JOB,UUOAST,,<ACs Stacked Too deep>)	;KI version of STKAC
    61					SUBI	17,17
    62					MOVEM	16,16(17)
    63					MOVE	16,17
    64					BLT	16,15(17)
    65					ADDI	17,37
    66					CAIN	17,%UPT+UPTAC0+20*XACSTL+17
    67					 MOVEI	17,%UPT+UPTAC0+20*XACSTL
    68					HLRZ	T1,%UPT+UPTACP
    69					ADDI	T1,20000
    70					CONI	PAG,T2		;TO PRESERVE PAGE RELOAD COUNTER
    71					TRZ	T2,760000	;CLEAR EXECUTIVE AC STACK POINTER
    72					IOR	T2,T1		;SET FOR STACKED ACS
    73					CONO	PAG,(T2)	;SET THEM
    74					HRL	17,T1
    75					EXCH	17,%UPT+UPTACP
    76					JRST	(17)
    77				
    78				KTRRT1::POP	P,%UPT+UPTMUP	;RESTORE RETURN ADR
    79				KTRRET::MOVSI	T1,PC.TRP	;RETURN FROM EXEC TRAP
    80					ANDCAM	T1,%UPT+UPTMUP
    81					HRRZ	17,%UPT+UPTACP
    82					CAIN	17,%UPT+UPTAC0+20*XACSTL
    83					 MOVEI	17,%UPT+UPTAC0+20*XACSTL+17
    84					SUBI	17,20
    85					HRRM	17,%UPT+UPTACP
    86					SUBI	17,17
    87					MOVSS	17
    88					HLRZ	16,%UPT+UPTACP
    89					SUBI	16,20000
    90					HRLM	16,%UPT+UPTACP
    91					CONI	PAG,T2		;TO PRESERVE PAGE RELOAD COUNTER
    92					TRZ	T2,760000	;CLEAR EXECUTIVE AC STACK POINTER
    93					IOR	T2,16		;SET FOR STACKED ACS
    94					CONO	PAG,(T2)	;SET THEM
    95					BLT	17,17
    96					JRSTF	@%UPT+UPTMUP
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2-2
PICON.MAC	30-OCT-87 17:26		KI Kernel Trap routines

    97				>;END IFCPU KI
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 3
PICON.MAC	30-OCT-87 17:26		KL/KS/F3 Kernel Trap routines

    98				SUBTTL	KL/KS/F3 Kernel Trap routines
    99				IFNCPU(KI),<	;KL/KS/F3 exec mode trap routine (page fail, PDL OV)
   100			000001	IFCPU (KL),<BADTRP==1>		;TO DELINEATE KL10 TRAP BUG CODE
   101			000001	ND BADTRP,0			;KS and F3 do not share KL's bug
   102
   103				;UUO from Kernel mode, as a result of a TRap
   104	000015'	202720	000000*	UUOKTR::MOVEM	16,@%UPT+UPTACP	;SAVE AC 16
   105	000016'	265700	000061'		JSP	16,STKAC	;STACK ACS
   106	000017'	261040	000425*		PUSH	P,%UPT+UPTMUP	;SAVE RETURN ADDRESS ON STACK
   107	000020'	550740	000424*		HRRZ	17,%UPT+UPTMUU	;Get new address
   108	000021'	307740	001000		CAIG	17,1000		;Is it reasonable?
   109	000022'	256000	000000*		 STOPCD	(,XCT,S..EUE)
   110					;No
   111	000023'	254020	000424*		JRST	@%UPT+UPTMUU	;DISPATCH ON ADDRESS IN UUO.
   112
   113				;Page fail comes here, from both Exec and User mode.
   114
   115	000024'	004000	000025'	PGFUIO::XWD	PC.UIO,PGFAIL	;Used by ONCE to set PAGE FAIL NEW PC WORD
   116
   117	000025'	202720	000000*	PGFAIL::MOVEM	16,@%UPT+UPTACP ;SAVE SOMEONE'S AC 16
   118	000026'	200700	000501*		MOVE	16,%UPT+UPTOPP	;GET PAGE FAIL PC
   119	000027'	607700	010000		TLNN	16,PC.USR	;FROM USER?
   120	000030'	254000	000042'		 JRST	PGFAI1		;NO, EXEC. GO STACK ACS.
   121				IFN BADTRP,<;THIS CODE TO GET AROUND KL TRAP INSTRUCTION BUG
   122	000031'	603700	000600		TLNE	16,PC.TRP	;ANY TRAP FLAGS ON
   123	000032'	254000	000045'		 JRST	PGFPCT		;YES, GO DO SPECIAL CHECK
   124				>;END IFN BADTRP
   125	000033'	200720	000000*		MOVE	16,@%UPT+UPTACP	;GET AC 16 BACK FOR USER
   126	000034'	336000	000000*		SKIPN	JOB		;Page fault in the null job?
   127	000035'	264000	000000*	ST.147:: JSR	CRS147##	;Yes, must be manual restart at 147 in user mode
   128	000036'	701140	003075'		EXECAC			;FIRST LEVEL OF EXEC ACS
   129	000037'	200040	003105'		MOVE	P,[IOWD EPLLEN,%UPT+UPTPDL]
   130	000040'	261040	000501*		PUSH	P,%UPT+UPTOPP	;RETURN PC
   131	000041'	254020	000420*		JRST	@%UPT+UPTPGT	;Dispatch to USRMPE or other page trap routine
   132				EXTERN USRMPE			;Default page-fault handler
   133
   134				;Page fail with PC in Exec mode
   135	000042'	265700	000061'	PGFAI1:	JSP	16,STKAC	;STACK REST OF THE ACS
   136	000043'	261040	000501*		PUSH	P,%UPT+UPTOPP	;STACK THE PC
   137	000044'	254120	003106'		JRSTF	@[EXCMPE##]	;CLEAR USER IOT AND GO DO EXEC FAULT.
   138
   139				IFN BADTRP,<
   140
   141				;THE FOLLOWING CODE IS AN ATTEMPT TO COMPENSATE FOR A KL10 HARDWARE
   142				; BUG. THE BUG: IF A TRAP INSTRUCTION (ARITH OVERFLOW, PDL OVERFLOW, TRAP 3)
   143				; CAUSES THE PC TO CHANGE, AND FETCHING THE NEW PC CAUSES A PAGE FAULT,
   144				; THE RELEVANT TRAP FLAGS IN THE LH OF PC ARE STILL SET EVEN THOUGH
   145				; THE TRAP CYCLE HAS COMPLETED. (FETCHING THE FIRST WORD OF THE
   146				; TRAP ROUTINE IS NOT PART OF THE ACTUAL TRAP INSTRUCTION).
   147				; THIS WILL CAUSE A SECOND TRAP, AS IF ONE HAD OCCURRED AT THE
   148				; LOCATION IMMEDIATELY BEFORE THE START OF THE TRAP ROUTINE.
   149				; THE TEMPORARY FIX IS TO SEE IF VIRTUAL ADDRESS AND PC MATCH
   150				; WHEN WE GET A PAGE FAIL OLD PC WITH ANY TRAP FLAGS ON,
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 3-2
PICON.MAC	30-OCT-87 17:26		KL/KS/F3 Kernel Trap routines

   151				; AND TURN THE TRAP FLAGS OFF IF THIS IS TRUE. THE ONLY CASE WHERE
   152				; THIS FAILS IS IF THE TRAP INSTRUCTION CANNOT COMPLETE BECAUSE
   153				; OF A PAGE FAULT FOR THE WORD IMMEDIATELY FOLLOWING THE INSTRUCTION
   154				; THAT CAUSED THE TRAP. THIS CIRCUMSTANCE IS CONSIDERED INFREQUENT
   155				; ENOUGH TO JUSTIFY INSTALLING THIS FIX.
   156
   157	000045'	200720	000000*	PGFPCT:	MOVE	16,@%UPT+UPTACP	;RESTORE USER'S AC 16
   158	000046'	701140	003075'		EXECAC			;SWITCH TO EXEC ACS
   159	000047'	200040	003107'		MOVE	P,[IOWD EPLLEN,%UPT+UPTPDL]
   160	000050'	200300	000501*		MOVE	T1,%UPT+UPTOPP	;GET OLD PAGE FAIL PC
   161	000051'	261040	000006		PUSH	P,T1		;SAVE ON STACK LIKE REGULAR
   162	000052'	430300	000500*		XOR	T1,%UPT+UPTPFW	;1S IN RH WHERE PC AND VA ARE DIFFERENT
   163	000053'	602300	777777		TRNE	T1,-1		;SKIP IF NO DIFFERENCES IN PC AND VA
   164	000054'	254020	000420*		 JRST	@%UPT+UPTPGT	;LEGIT PAGE FAIL DURING TRAP INSTRUCTION
   165	000055'	205300	000600		MOVSI	T1,PC.TRP	;MOST LIKELY THIS IS THE BUG. CLEAR TRAP
   166	000056'	412301	000000		ANDCAM	T1,(P)		;FLAGS IN PC WORD ON STACK
   167	000057'	412300	000501*		ANDCAM	T1,%UPT+UPTOPP	;AND IN OPP (IN CASE SOMEONE LOOKS THERE)
   168	000060'	254020	000420*		JRST	@%UPT+UPTPGT	;AND DISPATCH TO PROPER ROUTINE.
   169				>;END IFN BADTRP
   170
   171				;STILL IN FTKL10
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 4
PICON.MAC	30-OCT-87 17:26		KL/KS/F3 AC STACK ROUTINES

   172				SUBTTL KL/KS/F3 AC STACK ROUTINES
   173
   174				COMMENT ~
   175
   176				THE FOLLOWING IS A STATE TABLE SHOWING WHERE AC DATA LIVES.
   177
   178				CURRENT		PREVIOUS	STACK [CONTEXT SWITCH]
   179				-------		--------	----------------------
   180				USRACB		USRACB		-EMPTY-
   181				EX0ACB(1)	USRACB		-EMPTY-
   182				EX1ACB(1)	EX0ACB(1)	-EMPTY- [EX0ACB(1)]
   183				EX0ACB(2)	EX1ACB(1)	EX0ACB(1) [EX1ACB(1)]
   184				EX1ACB(2)	EX0ACB(2)	EX0ACB(1) EX1ACB(1) [EX0ACB(2)]
   185				EX0ACB(3)	EX1ACB(2)	EX0ACB(1) EX1ACB(1) EX0ACB(2) [EX1ACB(2)]
   186
   187				NOTES:
   188				IF CODE HAS PC.UIO OFF AND WISHES TO TURN IT ON IN ORDER
   189				TO REFERENCE USER SPACE, CONTEXT SWITCHING CODE AND AC STACK
   190				CODE WILL SET PREVIOUS AC BLOCK IN HARDWARE (WRUBR)
   191				TO USRACB, EVEN THOUGH UPTACP INDICATES THE ORIGINAL
   192				PREVIOUS AC BLOCK.
   193
   194				AT CONTEXT SWITCH TIME, THE CURRENT EXEC ACS ARE SAVED
   195				IN UPTXAC IF THE PC IS IN EXEC MODE.
   196
   197				WHEN SETTING USER IOT IN THE PC WORD, IT IS NOT NECESSARY
   198				TO DO A WRUBR  TO SET PREVIOUS AC BLOCK TO USER ACS
   199				UNLESS NECESSARY - HOWEVER, IF PAGE FAULT OR RESCHEDULE
   200				OCCURS PREVIOUS AC BLOCK WILL BE SET TO USER. THEREFORE,
   201				CODE THAT SETS USER IOT IN PC SHOULD ALWAYS RESTORE
   202				STATE OF PREVIOUS AC BLOCK WITH "WRUBR %UPT+UPTACP"
   203				IN THE PLACE WHERE IT RESTORES THE ORIGINAL SETTING
   204				OF USER IOT.
   205
   206				WHILE THE USER IS RUNNING, BOTH CURRENT AND PREVIOUS
   207				AC BLOCKS ARE SET TO USRACB, BUT UPTACP CONTAINS
   208				EX0ACB AS CURRENT AC BLOCK, USRACB AS PREVIOUS AC BLOCK.
   209
   210				~  ;End of COMMENT
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 5
PICON.MAC	30-OCT-87 17:26		KL/KS/F3 AC STACK ROUTINES

   211				COMMENT ~
   212				@@SUBROUTINE STKAC
   213				@@PURPOSE PROVIDE A STACK OF PREVIOUS CONTEXT ACS IN ORDER
   214				TO ALLOW NESTING OF PAGE FAULTS AND UUOS
   215				@@ENTRY
   216					MOVEM	16,@%UPT+UPTACP
   217					JSP	16,STKAC
   218					<ONLY RETURN>
   219				LH OF UPTACP MUST BE SETUP TO REFLECT STATE OF CURRENT
   220				AC STACK.
   221				@@ACCUM PRESERVES DATA IN ALL ACS IN THE BLOCK SET AS CURRENT
   222				AT TIME OF CALL. ON RETURN, CONTENTS OF ALL ACS
   223				EXCEPT FOR P ARE UNSPECIFIED.
   224				@@EXIT AC P SET TO VALUE OF AC P IN ORIGINAL CURRENT BLOCK.
   225				@@RESTRICTIONS ADDRESSES IN AC STACK MUST BE LESS THAN 400000,
   226				SO WRUBR %UPT+UPTACP DOES NOT SET 400000 (INHIBIT ACCT METER STORE)
   227				AC STACK MUST START ON 16 WORD BOUNDARY, SO TRNE 17 CAN BE
   228				USED FOR OVERFLOW CHECK.
   229				~  ;End of COMMENT
   230
   231				IFN USRACB,<PRINTX USER AC BLOCK MUST BE BLOCK 0>
   232				IFN EX0ACB-1,<PRINTX EX0ACB MUST BE SET TO 1>
   233				IFN EX1ACB-2,<PRINTX EX0ACB MUST BE SET TO 2>
   234
   235				COMMENT ~
   236				THIS IS SO TLNE AC,(LG.PAC) IS QUICK CHECK FOR PREVIOUS
   237				BLOCK SET TO USER, AND A TLC CAN BE USED TO QUICKLY SWAP
   238				EX0ACB AND EX1ACB.
   239				@@FUNCTION
   240				IF PREVIOUS AC BLOCK SET TO USER, SET CURRENT AC BLOCK
   241				TO EX1, PREVIOUS TO EX0, COPY AC P FROM EX0 TO ACP IN EX1,
   242				AND RETURN.
   243				IF PREVIOUS AC BLOCK SET TO AN EXEC BLOCK (EVEN IF USER IOT
   244				IS ON AND HARDWARE PREVIOUS BLOCK IS REALLY SET TO USRACB)
   245				SWAP PREVIOUS AND CURRENT AC BLOCKS, SAVE "NEW" CURRENT
   246				(OLD PREVIOUS) ON AC STACK
   247				SETUP P FROM PREVIOUS ACS, AND RETURN.
   248				@@
   249				~  ;End of COMMENT
   250
   251	000061'	250700	000000*	STKAC::	EXCH	16,%UPT+UPTACP	;SAVE PC, GET AC POINTER
   252	000062'	603700	000700		TLNE	16,(LG.PAC)	;PREVIOUS ACS USER?
   253	000063'	254000	000073'		  JRST	STKAC1		;NO, GO STACK PREVIOUS ACS
   254	000064'	505700	402100		HRLI	16,(LG.LAB+<EX1ACB>B8+<EX0ACB>B11)
   255	000065'	250700	000000*		EXCH	16,%UPT+UPTACP	;EX0 NOW PREVIOUS
   256	000066'	250720	000000*		EXCH	16,@%UPT+UPTACP	;GET AC 16 BACK, SAVE PC IN AC STACK
   257	000067'	701140	000000*		WRUBR	%UPT+UPTACP	;NEW AC BLOCK ASSIGNMENTS NOW.
   258	000070'	256200	003110'		XCTFU	<MOVE P,P>	;GET COPY OF P TO USE
   259	000071'	200720	000000*		MOVE	16,@%UPT+UPTACP	;GET PC IN AC 16
   260	000072'	254016	000000		JRST	(16)		;AND RETURN.
   261
   262				;HERE IF PREVIOUS AC BLOCKS SET TO AN EXEC BLOCK - NEED TO STACK IT
   263
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 5-2
PICON.MAC	30-OCT-87 17:26		KL/KS/F3 AC STACK ROUTINES

   264	000073'	641700	003300	STKAC1:	TLC	16,(3B8+3B11)	;2_1 AND 1_2
   265	000074'	250700	000000*		EXCH	16,%UPT+UPTACP	;SAVE POINTER, GET PC
   266	000075'	250720	000000*		EXCH	16,@%UPT+UPTACP	;GET AC 16 BACK, SAVE PC IN STACK.
   267	000076'	701140	000000*		WRUBR	%UPT+UPTACP	;NEW AC BLOCKS NOW.
   268	000077'	250720	000000*		EXCH	16,@%UPT+UPTACP	;SAVE OLD PREVIOUS AC 16 IN STACK,GET PC
   269	000100'	250700	000000*		EXCH	16,%UPT+UPTACP	;GET AC POINTER, SAVE PC
   270	000101'	202756	000001		MOVEM	17,1(16)	;SAVE 17 IN AC STACK (16 THERE TOO)
   271	000102'	201756	777762		MOVEI	17,-16(16)	;0,,WORD 0 OF STACK
   272	000103'	602740	000017		TRNE	17,17		;OVERFLOW?
   273	000104'	256000	003111'		 STOPCD (.,JOB,UUOAST,,<ACs Stacked Too deep>)
   274					;Non KI STKAC
   275	000105'	251756	777777		BLT	17,-1(16)	;SAVE 0-15 IN STACK
   276	000106'	271700	000020		ADDI	16,20		;ADVANCE STACK POINTER
   277	000107'	550740	000016		HRRZ	17,16		;COMPARE ONLY RIGHT HALF
   278	000110'	306740	000000*		CAIN	17,%UPT+UPTAC0+20*XACSTL+16	;MORE ROOM??
   279	000111'	541700	000000*		 HRRI	16,%UPT+UPTAC0+20*XACSTL	;NO - DIE WITH UUOAST NEXT TIME
   280	000112'	250700	000000*		EXCH	16,%UPT+UPTACP	;SAVE NEW POINTER, GET PC
   281	000113'	256200	003110'		XCTFU	<MOVE P,P>	;GET COPY OF P FROM PREVIOUS ACS
   282	000114'	254016	000000		JRST	(16)		;AND RETURN.
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 6
PICON.MAC	30-OCT-87 17:26		KL/KS/F3 AC STACK ROUTINES

   283				;HERE TO UNSTACK ACS AFTER PAGE FAIL OR UUO WHICH HAS NESTED.
   284				; ENTER AT KTRRT1 IF PC IS ON STACK, KTRRET IF PC IS IN
   285				; UPTMUP.
   286
   287	000115'	262040	000425*	KTRRT1::POP	P,%UPT+UPTMUP	;GET PC INTO MUP
   288	000116'	205300	000600	KTRRET::MOVSI	T1,PC.TRP	;CLEAR THESE SO HE WON'T TRAP AGAIN.
   289	000117'	412300	000425*		ANDCAM	T1,%UPT+UPTMUP
   290	000120'	550740	000000*		HRRZ	17,%UPT+UPTACP	;GET STACK POINTER ADDRESS
   291	000121'	302740	000000*		CAIE	17,%UPT+UPTAC0+16 ;ANYTHING STACKED?
   292	000122'	254000	000127'		 JRST	KTRRT2		;YES, MUST RESTORE IT.
   293	000123'	505740	401000		HRLI	17,(LG.LAB+<EX0ACB>B8+<USRACB>B11)
   294	000124'	202740	000000*		MOVEM	17,%UPT+UPTACP	;NO, SET TO TOP LEVEL STATE AGAIN
   295	000125'	701140	000017		WRUBR	17		;AND
   296	000126'	254120	000425*		JRSTF	@%UPT+UPTMUP	;RETURN.
   297
   298				;HERE TO UNSTACK SOME EXEC ACS
   299
   300	000127'	306740	000000*	KTRRT2:	CAIN	17,%UPT+UPTAC0+20*XACSTL ;FULL AT THE MOMENT?
   301	000130'	201740	000000*		  MOVEI	17,%UPT+UPTAC0+20*XACSTL+16 ;YES, RESET POINTER TO REAL PLACE
   302	000131'	275740	000020		SUBI	17,20		;POP A LEVEL OF ACS OFF
   303	000132'	500740	000000*		HLL	17,%UPT+UPTACP	;GET AC BLOCK INFO
   304	000133'	641740	003300		TLC	17,(3B8+3B11)	;1_2 AND 2_1
   305	000134'	202740	000000*		MOVEM	17,%UPT+UPTACP	;SET NEW POINTER
   306	000135'	200700	000425*		MOVE	16,%UPT+UPTMUP	;DID HE HAVE USER IOT SET?
   307	000136'	603700	004000		TLNE	16,PC.UIO
   308	000137'	254000	000144'		 JRST	KTRRT3		;YES, DO THIS DIFFERENTLY.
   309	000140'	205757	777762		MOVSI	17,-16(17)	;1ST LOC,,0
   310	000141'	251740	000017		BLT	17,17		;RESTORE "PREVIOUS" AC DATA
   311	000142'	701140	000000*		WRUBR	%UPT+UPTACP	;NOW MAKE THAT BLOCK PREVIOUS
   312	000143'	254120	000425*		JRSTF	@%UPT+UPTMUP	;AND RETURN.
   313
   314				;HERE IF USER IOT WAS SET AT TIME OF PAGE FAULT OR UUO AND
   315				; UPTACP SAID PREVIOUS AC BLOCK WAS NOT USER. PROGRAM
   316				; TURNED ON USER IOT TO REFER TO USER SPACE, SO RESTORE
   317				; THE SAVED PREVIOUS EXEC ACS AND THEN INSTEAD OF
   318				; MAKING THEM PREVIOUS AC BLOCK, MAKE USER AC BLOCK PREVIOUS
   319				; SO THAT ALL EXECUTIVE XCTS REFER TO USER'S DATA.
   320
   321	000144'	205757	777762	KTRRT3:	MOVSI	17,-16(17)	;1ST STAC,,0
   322	000145'	251740	000017		BLT	17,17		;RESTORE "REAL" PREVIOUS AC DATA
   323								;AC 16 STILL IN AC STACK.
   324	000146'	510700	000000*		HLLZ	16,%UPT+UPTACP	;GET AC BLOCK INFO
   325	000147'	621700	000700		TLZ	16,(LG.PAC)	;USE SPECIFIED CURRENT BLOCK, BUT PREVIOUS BLOCK = USER.
   326	000150'	250720	000000*		EXCH	16,@%UPT+UPTACP	;RESTORE 16, PUT WRUBR  WORD IN AC STACK
   327	000151'	701160	000000*		WRUBR	@%UPT+UPTACP	;SET NEW AC BLOCKS
   328	000152'	254120	000425*		JRSTF	@%UPT+UPTMUP	;AND RETURN.
   329				>;END IFNCPU KI
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 7
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   330				SUBTTL	APRINT - Interrupt from the APR
   331
   332	000153'	700340	007760	APRINT::CONSO	APR,APRMSK	;Any interrupt bit set?
   333	000154'	254000	000000		 JRST	.-.		;Not for APR, continue down skip chain
   334				IFCPU (KS),<TBSAVE TBVAPR>	;Save the time base value
   335	000155'	700240	000000*		CONI	APR,SAVAPR##	;Save APR status for TYPAPR to display
   336	000156'	700300	003340		CONSZ	APR,APFMSK	;Any nasty bits set?
   337	000157'	256000	003114'	APRFAT:: STOPCD (.,CPU,APRFAT,TYPAPR,<Fatal APR error - Hardware failure>)
   338	000160'	124300	000220'		DMOVEM	T1,SAVT1	;SAVE AC
   339				IFCPU (KI),<	;APR interrupt is for clock tick and parity error on KI
   340					CONSZ	APR,APRPAR
   341					 JRST	APRPR1		;PARITY ERROR
   342					RDAPR	T1
   343					ANDI	T1,77		;GET PI CHANELS
   344					WRAPR	APRCLK(T1)	;Re-enable clock interrupt
   345					PFALL	CRSCHK		;Now do once-a-tick stuff
   346				>
   347
   348				IFCPU (F3),<	;APR interrupt is for clock tick and parity error on F3
   349					CONSZ	APR,APRPAR
   350					 JRST	APRPR1		;PARITY ERROR
   351					WRAPR	LP.ESF+LP.CSF+LP.CLK+APRCHN##
   352					PFALL	CRSCHK		;Now do once-a-tick stuff
   353				>
   354
   355				IFCPU (KL),<	;APR interrupt is for memeory errors or cache sweep done
   356	000161'	700340	004400		CONSO	APR,APRPAR!LP.SBE ;Memory error?
   357	000162'	254000	000166'		 JRST	APRIN1		;No, don't do RDERA+SBDIAG on cache sweep done
   358	000163'	700400	000000*		RDERA	SAVERA##	;Log Error Address Register NOW before
   359								; anything else happens
   360	000164'	700500	000000*		SBDIAG	SAVSB0##	;Also SBUS function 0
   361	000165'	700500	000000*		SBDIAG	SAVSB1##	;Also SBUS function 1
   362	000166'	700300	000400	APRIN1:	CONSZ	APR,APRPAR	;PARITY ERROR?
   363	000167'	254000	000306'		 JRST	APRPR1		;PARITY ERROR, GO PROCESS
   364	000170'	700300	004000		CONSZ	APR,LP.SBE	;SBUS ERROR ON ALONE?
   365	000171'	254000	000157'		 JRST	APRFAT		;YES, TREAT THIS SBUS ERROR AS FATAL
   366	000172'	700300	000020		CONSZ	APR,LP.CSD	;CACHE SWEEP DONE?
   367	000173'	254000	000256'		 JRST	APRCSH		;YES.
   368	000174'	256000	003120'		STOPCD (APRINT+1,DEBUG,APRWRN,TYPCSB##,<Spurious APR error>)
   369				 ;Continue
   370				;End of KL APR interrupt routine
   371
   372				;Here for interval timer on KL or KS (it ticks like the KI line-frequency clock)
   373
   374	000175'	000000	000000	ITMINT::0			;JSR HERE FROM EPT ON KL
   375	000176'	702300	010000		CONSZ	TIM,TI.TOV	;MAKE SURE NO OVERFLOW
   376	000177'	256000	003124'		 STOPCD (.+1,DEBUG,APRTIM,,<APR timer overflowed>)
   377				 ;Continue
   378	000200'	124300	000220'		DMOVEM	T1,SAVT1
   379	000201'	353300	000255'		AOSLE	T1,ITMPTR	;GET NEXT INTERVAL WORD
   380	000202'	463300	000255'		 SETCMB	T1,ITMPTR	;RESET FROM 1 TO -2
   381	000203'	702226	000254'		CONO	TIM,@ITMTBL(T1)	;START IT AGAIN WITH PROPER INTERVAL
   382	000204'	200300	000175'		MOVE	T1,ITMINT	;GET PC
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 7-2
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   383	000205'	202300	000000*		MOVEM	T1,APRCHL##	;Pretend we got here from a channel-1 interrupt
   384					PFALL	CRSCHK		;Now do once-a-tick stuff
   385				>;END IFCPU KL
   386
   387				IFCPU (KS),<
   388					CONSZ	APR,LP.HPE+LP.SPE	;TEST FOR HARD OR SOFT PARITY ERROR
   389					 JRST	APRPR1			;GO PROCESS PARITY ERROR
   390				APRP1R:	CONSO	APR,LP.80I		;8080 CONSOLE INTERRUPT?
   391					 JRST	APRKST
   392					SKIPN	DZDO##			;DZ-11 DRIVER?
   393					 JRST	APRI1A			;NO, CHECK FOR CTYSIM.
   394					SETOM	DZINF##			;Need to check DZ for TTY input
   395					JRST	APRI1B			;Do not check CTY if DZ is active
   396				
   397				APRI1A:	SKIPN	CTYDO##			;SEE IF CTY IS ACTIVE AS CONSOLE
   398					 JRST	APRIN1			;NO, JUST TURN OFF 8080 FLAG
   399					SETOM	CTYINF##		;FLAG 8080 INTERRUPT
   400				APRI1B:	WRPI	LI.REQ+<1B35>_<7-6>	;REQUEST CHANNEL 6 INTERRUPT
   401					WRAPR	LP.CSF+LP.80I+APRCHN##	;CLEAR 8080 FLAG
   402					JRST	APREXT			;JUMP TO JEN @APRCHL
   403				
   404				APRIN1:	WRAPR	LP.CSF+LP.80I+APRCHN##	;CLEAR 8080 FLAG
   405				APRKST:	CONSO	APR,LP.ITD		;CHECK THE TIMER FLAG WENT OFF
   406					 JRST	APREXT			; NOT TIMER, GO TO JEN @APRCHL
   407				APRTIM:	DMOVEM	T1,SAVT1		;GOT CLOCK
   408					MOVEI	T1,^D16			;60Hz, assume leap jiffy
   409					AOSG	ITMPTR			;Count triad counter (-1,0,+1)
   410					 SKIPA	T1,[^D17]		;Not leap tick unless triad count is 1
   411					SETCMM	ITMPTR			;Count reached 1, set back to -2
   412					ADDM	T1,ITMLTC		;Add to leap-tick count
   413					SKIPL	ITMLTC			;Is it still negative?
   414					 ADDI	T1,1			;No, adjust for 4.100 vs 4.096 Mhz
   415					LSH	T1,^D12			;Shift to load into timer register
   416					WRINT	T1			;Set 16 or 17 millisecond interval
   417					WRAPR	LP.CSF+LP.ITD+APRCHN##	;Clear interval timer done flag
   418					MOVNI	T1,^D<4096/<4100-4096>>	;KS runs at 4.100 Mhz, not 4.096 Mhz
   419					SKIPL	ITMLTC			;Therefore it needs 4 extra leap-ticks
   420					 ADDM	T1,ITMLTC		; out of every 4096 milliseconds
   421					PFALL	CRSCHK			;Now do once-a-tick stuff
   422				>;END IFCPU (KS)
   423
   424				;Here on all CPUs when the 60Hz clock has ticked.
   425				;T1 and T2 have been saved, stack has not been set up
   426
   427	000206'	332300	000000*	CRSCHK::SKIPE	T1,CRSHWD##	;Check for nonzero in 30
   428	000207'	264000	000222'		 JSR	CRASH1		;Go die
   429	000210'	265300	000000*		JSP	T1,UPDKEY##	;Tell SCNSER to update the key
   430	000211'	350000	000000*		AOS	TIME##		;Time of day
   431	000212'	350000	000000*		AOS	UPTIME##	;Time system has been up
   432	000213'	476000	000000*		SETOM	TIMEF##		;Tell CLOCK1 that the APR clock has ticked
   433	000214'	476000	000000*		SETOM	CLKFLG##	;Another flag for CLOCK1
   434	000215'	700600	000000*		WRPI	REQCLK##	;Request a CH7 clock interrupt
   435	000216'	120300	000220'		DMOVE	T1,SAVT1
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 7-3
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   436	000217'			APREXT:				;Exit from APR interrupt
   437				IFCPU (KS),<TBSET TBVAPR>	;Reset the time base for charging
   438	000217'	254520	000205*		JEN	@APRCHL##	;End of APR interrupt on CH1
   439
   440	000220'			SAVT1:	BLOCK	2		;DMOVE/DMOVEM for T1 and T2
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 8
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   441				;Code to crash when a nonzero value is poked into location 30
   442				;Come here via
   443				;	SKIPE	T1,CRSHWD	;Check for nonzero in 30
   444				;	 JSR	CRASH1
   445
   446	000222'	000000	000000	CRASH1:	0			;This word is set nonzero if we got here
   447	000223'	616300	003127'		TDNN	T1,[-1,,777770]	;Did OPER deposit 1 in 30?  (or 4 on an F3)
   448	000224'	264000	000000*	DM30.1:: JSR	CRASH2##	;Yes, don't output stopcode message
   449				IFCPU (KS),<
   450					SOSL	CRSCNT##	;Time until hard crash
   451					SKIPE	DWNFLG##        ;Tried to crash already?
   452					 JRST	CRASH		;Die now
   453					JRST	@CRASH1		;Wait in case KMC recovers
   454				>;END IFCPU (KS)
   455	000225'	331000	000000*		SKIPL	.CPDWD##	;STOPCD in progress?
   456	000226'	254020	000222'		 JRST	@CRASH1		;Ignore nonzero in 30 while processing stopcode
   457	000227'	265300	000000*		JSP	T1,CHKBAS##	;Let SCNSER determine if base initiated crash
   458	000230'	256000	003130'	CRASH::  STOPCD (.,STOP,CRASH,PRT30,<CRASH requested - Nonzero in 30>)
   459	000231'	254020	000222'		JRST	@CRASH1		;Continue if CHKBAS gives skip return
   460
   461	000232'	260040	000000*	PRT30:	PUSHJ	P,INLMES##	;This routine called by STOPCD processor
   462	000233'	417375	672312		 ASCIZ /Contents of 30: /
	000234'	673516	320336
	000235'	631006	330164
	000236'	200000	000000
   463	000237'	200300	000000*		MOVE	T1,SAV30##	;Get saved value
   464	000240'	260040	000000*		PUSHJ	P,HWDPNT##	;Print as halfwords
   465	000241'	260040	000232*		PUSHJ	P,INLMES##	;Some spacing
   466	000242'	201724	051622		 ASCIZ / = SIXBIT |/
	000243'	542051	152100
	000244'	760000	000000
   467	000245'	200340	000237*		MOVE	T2,SAV30##	;Restore CRSHWD
   468	000246'	260040	000000*		PUSHJ	P,PRNAME##	;Print as sixbit
   469	000247'	260040	000241*		PUSHJ	P,INLMES##
   470	000250'	760000	000000		 ASCIZ /|/
   471	000251'	324740	000000*		PJRST	PRTKEY##	;Output KEY620 and CRLF
   472
   473
   474
   475				IFCPU (KL),<
   476	000252'	000000	063202	ITMTBS:	TO.SIT+TO.CTD+^D1666	;LEAP TICK, TO AVG TO EXACTLY 16.66666 MS
   477	000253'	000000	063203		TO.SIT+TO.CTD+^D1667
   478	000254'	000000	063203	ITMTBL:	TO.SIT+TO.CTD+^D1667
   479	000255'	000000	000000	ITMPTR:	0			;TRIAD COUNTER (-2,-1,0)
   480				>;END IFCPU (KL)
   481
   482				IFCPU (KS),<
   483				ITMTBS:	<^D16>B23	;16 MILLISEC LEAP TICK TO AVERAGE 16.66666MS
   484					<^D17>B23	;17
   485				ITMTBL:	<^D17>B23	;17
   486				ITMPTR:	0		;TRIAD COUNTER (-2,-1,0)
   487				ITMLTC:	0		;Leap-tick count (1 extra msec every 1024 milliseconds)
   488				TBVAPR:	BLOCK	2	;2 WORDS TO SAVE THE TIME BASE VALUE
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 8-2
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   489				>;END IFCPU (KS)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 9
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   490				IFCPU (KL),<
   491
   492				;HERE ON CACHE SWEEP DONE.
   493
   494	000256'	700200	020020*	APRCSH:	CONO	APR,LP.CSF+LP.CSD+APRCHN##	;CLEAR SWEEP DONE.
   495	000257'	350000	000304'		AOS	CSVCNT		;UNLOAD COUNTS AS VALIDATE TOO.
   496	000260'	124300	000220'		DMOVEM	T1,SAVT1	;TUCK THIS AWAY.
   497	000261'	205300	701500		MOVSI	T1,(SWPVA)	;GET VALIDATING INSTRUCTION BACK.
   498	000262'	250300	000277'		EXCH	T1,CSVINS	;NOW CAN DO VALIDATE TO DO VALIDATE.
   499	000263'	603300	000040		TLNE	T1,(<SWPUA>-<SWPVA>);(ONLY DIFFER BY 1 BIT.)
   500	000264'	350000	000303'		 AOS	CSUCNT		;WAS AN UNLOAD, COUNT ONE MORE
   501	000265'	120300	000220'		DMOVE	T1,SAVT1	;GET T1 BACK
   502	000266'	254520	000217*		JEN	@APRCHL		;DISMISS.
   503
   504				;ROUTINES FOR CACHE SWEEPING.
   505
   506				COMMENT ~
   507				THE PROCEDURE TO DO A CACHE SWEEP IS AS FOLLOWS: CALL THE APPROPRIATE
   508				ROUTINE (CSHUNL, CSHVAL MACROS). THEY WILL RETURN THE CURRENT SWEEP
   509				NUMBER FOR THE REQUESTED OPERATION IN T1. THE CALLING ROUTINE THEN
   510				MAY DO SOME EXTRA PROCESSING. BEFORE STARTING THE IO THAT NEEDED THE SWEEP,
   511				CALLER IS RESPONSIBLE FOR WAITING FOR HIS SWEEP TO COMPLETE
   512				BY CAME T1,CS?CNT. WHEN THE NUMBERS NO LONGER MATCH, THE REQUESTED
   513				SWEEP HAS FINISHED.
   514				IN AN IO SYSTEM WHERE REQUESTS THAT NEED SWEEPS ARE QUEUED, THE CURRENT
   515				SWEEP NUMBER AT THE TIME THE REQUEST ENTERS THE QUEUE CAN BE STORED
   516				WITH THE REQUEST. WHEN THE REQUEST IS SERVICED, A SWEEP ONLY NEED
   517				BE INITIATED IF THE CURRENT SWEEP COUNT AND THE ONE STORED WITH
   518				THE REQUEST ARE THE SAME.
   519				~  ;End COMMENT
   520
   521				;CSHUNL MACRO PUSHJS HERE.
   522
   523	000267'	700600	000400	CSUNL::	WRPI	LI.PIF	;MUST NOT ALLOW VALIDATE TO SNEAK IN
   524	000270'	701540	000000		SWPUA			;START THE UNLOAD.
   525				;*;	WRAPR	LP.CSF+LP.CSD+APRCHN##;IN CASE A PREVIOUS SWEEP FINISHED AFTER LI.PIF
   526	000271'	205300	701540		MOVSI	T1,(SWPUA)	;ANYONE WHO DOES VALIDATE MUST REALLY DO AN UNLOAD NOW.
   527	000272'	202300	000277'		MOVEM	T1,CSVINS
   528	000273'	200300	000303'		MOVE	T1,CSUCNT	;RETURN WITH CURRENT SWEEP NUMBER
   529	000274'	700600	000200		WRPI	LI.PIN		;BACK ON
   530	000275'	263040	000000		POPJ	P,
   531
   532				;CSHVAL MACRO PUSHJs TO HERE
   533
   534	000276'	700600	000400	CSVAL::	WRPI	LI.PIF	;TURN OFF PI SYSTEM, DON'T LET SWEEP DONE SNEAK IN
   535	000277'	701500	000000	CSVINS:	SWPVA			;START OUT WITH VALIDATE ALL, CHANGE
   536								; TO UNLOAD ALL WHEN UNLOAD IS IN PROGRESS.
   537				;*;	WRAPR	LP.CSF+LP.CSD+APRCHN##;IN CASE IT SET BEFORE INTERRUPT GOT A CHANCE TO GET IN
   538	000300'	200300	000304'		MOVE	T1,CSVCNT	;PICKUP PROPER VALIDATE COUNT
   539	000301'	700600	000200		WRPI	LI.PIN		;TURN PI BACK ON
   540	000302'	263040	000000		POPJ	P,		;AND RETURN.
   541
   542				;LOCATIONS CONTAINING VALIDATE AND UNLOAD COUNTS. COUNTS ARE
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 9-2
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   543				; USED TO ALLOW ONE SWEEP TO SWEEP FOR MANY REQUESTS. WHEN
   544				; ENTRY IS PUT ON QUEUE, AN ARBITRARY NUMBER OF THE LOW
   545				; ORDER BITS OF THE SWEEP NUMBER IS STORED IN THE ENTRY.
   546				; IF THE STORED SWEEP NUMBER BITS ARE DIFFERENT THAN
   547				; THE CURRENT SWEEP NUMBER BITS AT THE TIME ACTUAL
   548				; DMA I/O IS STARTED, THEN NO SWEEP IS NECESSARY.
   549
   550	000303'	000000	000000	CSUCNT::0			;NUMBER OF UNLOADS DONE
   551	000304'	000000	000000	CSVCNT::0			;NUMBER OF VALIDATES DONE.
   552	000305'	000000	000000	CSHSAV::0			;NUMBER OF SAVED SWEEPS.
   553				>;END IFCPU (KL)
   554
   555
   556
   557				IFCPU (KS),<
   558				;ROUTINE TO INVALIDATE THE ENTIRE CACHE FOR THE KS
   559				;  SAVING ALL THE ACS.
   560				
   561				CSINVL::PUSH	P,T1	;SAVE T1
   562					RDUBR	T1	;GET THE CURRENT UBR
   563					WRUBR	T1	;WRITE UBR CAUSING CACHE TO BE INVALIDATED
   564					POP	P,T1	;RESTORE T1
   565					POPJ	P,	;RETURN
   566				>;END IFCPU (KS)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 10
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   567				;PARITY INTERRUPT
   568				;DO MEMORY SCAN AND TYPE OUT BAD LOCS. THEN HALT.
   569				;REPEAT MEMORY SCAN IF OPER PRESSES CONTINUE
   570				;SCAN ALL OF MEMORY.  IF GET NXM, GO TO NEXT 16K CHUNK.
   571				;PARFLG IS -1 IF NO PAR ERRORS FOUND, ELSE IS = TO COUNT. USEFUL
   572				;IF MEMORY GETS DUMPED BY MISTAKE; WE CAN FIND OUT WHAT HAPPENED
   573
   574				IFCPU (KS),<
   575				PARSPE::0	;COUNT OF SOFT PARITY ERRORS
   576				>; END IFCPU (KS)
   577					EXTERN PARFLG,UUOPNT,SYSDDT,UPSJOB
   578					EXTERN EPT,EPT.PN,PARPC,PARTOT,PARWRD,PARSPR
   579					EXTERN GETCTY,JOB1,PGYADR,PHOLD,WSCHED,ERRPAR
   580
   581				;Enter here from APRINT when APRPAR is set
   582
   583	000306'			APRPR1:
   584	000306'	200300	000266*	IFNCPU(KS),<MOVE T1,APRCHL##>
   585				IFCPU (KI),<WRPI  1B20>		;TURN OFF PARITY INTERRUPT
   586	000307'	700200	044400*	IFCPU (KL),<WRAPR LP.DSF+LP.PAR+LP.SBE+APRCHN##>
   587				IFCPU (F3),<WRAPR LP.DSF+LP.PAR+APRCHN##>
   588				IFCPU (KS),<
   589					CONSZ	APR,LP.SPE	;SKIP IF HARD ERROR
   590					 JRST	[AOS	PARSPE	;ADD ONE TO THE COUNT OF SOFT PARITY ERRORS
   591						WRAPR	LP.CSF+LP.SPE+APRCHN	;CLEAR SOFT ERROR FLAG
   592						JRST	APRP1R]	;RETURN TO WHERE WE CAME FROM
   593					WRAPR	LP.DSF+LP.HPE+APRCHN##	;DISABLE HARD PARITY ERRORS
   594					MOVE	T1,APRCHL##
   595				>;END IFCPU (KS)
   596	000310'	202300	000000*		MOVEM	T1,PARPC	;SAVE STATISTIC
   597	000311'	603300	010000		TLNE	T1,PC.USR	;PARITY ERROR IN USER MODE?
   598	000312'	254520	003134'		JEN	@[PC.UIO,,USEPER];YES. PROCESS AT UUO LEVEL
   599	000313'			EXCPAR:
   600				PRINTF([Need more work at EXCPAR - typeout info on EXEC parity error])
   601	000313'	700600	000400	APRPR2:	WRPI	LI.PIF		;TURN PI SYSTEM OFF
   602	000314'	700200	027400		WRAPR	CLRNXM
   603	000315'	700200	024400		CLPARF
   604	000316'	476000	000000*		SETOM	PARFLG
   605	000317'	201600	000450'		MOVEI	P1,PARMSG
   606	000320'	265300	000410'		JSP	T1,BUGTYP	;REPORT ERROR TO CTY
   607	000321'	265400	000530'	IFCPU (KL),<JSP T3,APRXXX>	;Type APR, ERA, and SBUS info on CTY
   608	000322'	201740	000020	APRER6:	MOVEI	P4,20		;START MEMORY SCAN AT LOC 20
   609	000323'	400300	000000		SETZ	T1,		;IF A PAR ERROR, T1 WILL GET CLOBBERED BY JSP
   610	000324'	200340	000017	APRER1:	MOVE T2,P4		;GET ADDRESS
   611	000325'	242340	777767		LSH T2,-11		;PAGE NUMBER
   612	000326'	660340	600000		TRO T2,PGE.A!PGE.P	;SET ACCESS BITS
   613	000327'	137340	000000*		DPB T2,EPYPSN	;SET UP UPS MAP SLOT TO PAGE [EPTPTR(%UPS.N)]
   614				IFCPU (KI),<;MAYBE THIS IS NECESSARY IN CASE CURUPT NOT SETUP
   615					DATAO	PAG,[IG.LRH+IG.TEN+EPT.PN] ;PUT IT IN PAGING HARDWARE
   616				>;END IFCPU (KI)
   617	000330'	701100	000000*	IFNCPU (KI),<CLRPTO %UPS>
   618	000331'	402000	000000*		SETZM UPSJOB		;JUST IN CASE WE EVER CALL MAPUPS
   619	000332'	200340	000017		MOVE T2,P4
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 10-2
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   620	000333'	405340	000777		ANDI T2,777		;ISOLATE DISPLACEMENT IN PAGE
   621	000334'	200707	000330*		MOVE P3,%UPS(T2)		;REFERENCE LOCATION
   622	000335'	700300	007000		CONSZ	APR,APRNXM	;NXM?
   623					JRST	[TRNE P4,774	;IN FIRST 4 WORDS OF PAGE?
   624						 ADDI P4,37773	;NO. GO TO NEXT 16K
   625						 WRAPR	CLRNXM
   626	000336'	254000	003135'			 JRST APRER2]
   627	000337'	700300	000400		CONSZ	APR,APRPAR	;AN MPE IN THAT LOC?
   628	000340'	254000	000366'		JRST	APRER3		;YES, REPORT IT
   629	000341'	315740	003141'	APRER2:	CAMGE	P4,[17777777]	;END OF MEMORY?
   630	000342'	344740	000324'		AOJA	P4,APRER1	;NO, KEEP GOING
   631	000343'	201600	000444'		MOVEI	P1,NONMSG
   632	000344'	302300	000000		CAIE	T1,
   633	000345'	201600	000462'		MOVEI	P1,DONMSG
   634	000346'	265300	000410'		JSP	T1,BUGTYP	;NO, SAY NONE FOUND
   635	000347'	554600	000000*		HLRZ P1,SYSDDT
   636	000350'	306600	254200		CAIN P1,(HALT)
   637	000351'	254200	000306'		HALT APRPR1		;SEE IF DDT STILL THERE (DEBUG)
   638	000352'	201600	000434'		MOVEI P1,RSCMSG
   639	000353'	265300	000410'		JSP T1,BUGTYP	;TYPE OUT RESCAN MESSAGE
   640	000354'			APRPR4:
   641				IFCPU (<KI,F3>),<
   642					CONSO TTY,TT.ID		;WAIT FOR INPUT CHR
   643					 JRST .-1
   644					DATAI TTY,T1
   645				>;END IFCPU (<KI,F3>)
   646
   647				IFCPU (KL),<
   648	000354'	336000	000456*		SKIPN	EPT+SPCMTI	;INPUT CHAR YET
   649	000355'	254000	000354'		 JRST	.-1		;NO
   650	000356'	200300	000450*		MOVE	T1,EPT+SPCF11	;YES, GET IT
   651	000357'	402000	000456*		SETZM	EPT+SPCMTI	;AND CLEAR FLAG.
   652				>;END IFCPU (KL)
   653				IFCPU (KS),<
   654					SKIPN	T1,CTYIWD##	;INPUT CHAR YET
   655					 JRST	.-1		;NO
   656					SETZM	CTYIWD##	;CLEAR IT
   657				>;END IFCPU (KS)
   658	000360'	405300	000177		ANDI T1,177
   659	000361'	306300	000122		CAIN T1,"R"
   660	000362'	254000	000322'		 JRST APRER6	;RESCAN
   661	000363'	306300	000114		CAIN T1,"L"
   662	000364'	256000	000230'		 STOPCD (,XCT,CRASH)
   663					;Don't know what else to do, CRASH
   664	000365'	254000	000354'		JRST APRPR4	;CONTINUUE WAITING
   665
   666				;REPORT ERROR
   667	000366'	700200	024400	APRER3:	CLPARF
   668	000367'	554600	000017		HLRZ P1,P4	;PRINT LEFT HALF OF ADDRESS
   669	000370'	265300	000415'		JSP	T1,BUGTY6	;REPORT LOCATION
   670	000371'	550600	000017		HRRZ P1,P4	;NOW RIGHT HALF OF ADDRESS
   671	000372'	265300	000415'		JSP T1,BUGTY6	
   672	000373'	201640	000040		MOVEI	P2," "
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 10-3
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   673	000374'	265340	000424'		JSP	T2,BUGTY0
   674	000375'	265340	000424'		JSP	T2,BUGTY0
   675	000376'	554600	000016		HLRZ	P1,P3
   676	000377'	265300	000415'		JSP	T1,BUGTY6	;TYPE OUT LEFT HALT OF CONTENTS
   677	000400'	201640	000054		MOVEI	P2,","
   678	000401'	265340	000424'		JSP	T2,BUGTY0
   679	000402'	265340	000424'		JSP	T2,BUGTY0
   680	000403'	550600	000016		HRRZ	P1,P3
   681	000404'	265300	000415'		JSP	T1,BUGTY6	;THEN RIGHT HALF
   682					MOVEI	P1,[ASCIZ /
   683	000405'	201600	003142'	/]
   684	000406'	265300	000410'		JSP	T1,BUGTYP
   685	000407'	254000	000341'		JRST	APRER2
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 11
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   686				;;
   687				;; Type out ASCIZ string on CTY. Called via
   688				;; JSP T1,BUGTYP with address of string in P1.
   689				;; Clobbers T2,P2,0. Preserves P1 and T1.
   690				;; Functionally equivalent to CTYTYP in SCNSER except
   691				;;  that BUGTYP has no internal PDL usage.
   692
   693	000410'	205000	440714	BUGTYP:	MOVSI	0,440700!P1	;Generate byte pointer in AC 0
   694	000411'	134640	000000		ILDB	P2,0		;Pick up next character
   695	000412'	322646	000000		JUMPE	P2,0(T1)	;Exit if end of string
   696	000413'	265340	000424'		JSP	T2,BUGTY0	;Type character in P2 on CTY
   697	000414'	254000	000411'		JRST	BUGTYP+1	;Loop
   698
   699				;TYPE OUT 6 DIGIT OCTAL NUMBER IN P1 ON CTY
   700				;JSP T1,BUGTY6
   701				;CLOBBERS T2,P2,0
   702	000415'	200000	003143'	BUGTY6:	MOVE	0,[POINT 3,P1,17]
   703	000416'	134640	000000		ILDB	P2,0
   704	000417'	271640	000060		ADDI	P2,"0"
   705	000420'	265340	000424'		JSP	T2,BUGTY0
   706	000421'	603000	770000		TLNE	0,770000
   707	000422'	254000	000416'		JRST	BUGTY6+1
   708	000423'	254006	000000		JRST	(T1)
   709
   710				;TYPE OUT THE SINGLE CHARACTER IN P2 ON THE CTY
   711				;JSP	T2,BUGTY0
   712	000424'			BUGTY0:
   713				IFCPU (<KI,F3>),<
   714					CONSZ	TTY,TT.OB
   715					JRST	.-1
   716					DATAO	TTY,P2
   717					JRST	(T2)
   718				>;END IFCPU (<KI,F3>)
   719
   720				IFCPU (KL),<
   721	000424'	660640	004000		TRO	P2,.DTCTO	;COMMAND TO OUTPUT
   722	000425'	202640	000451*		MOVEM	P2,EPT+SPCCMW
   723	000426'	402000	000455*		SETZM	EPT+SPCMTD	;WAIT FOR DONE
   724	000427'	720200	020000		CONO	DTE,TO11DB	;HELLO 11
   725	000430'	336000	000455*		SKIPN	EPT+SPCMTD	;DONE
   726	000431'	254000	000430'		JRST	.-1		;NO
   727	000432'	405640	000377		ANDI	P2,377		;YES, CLEAR JUNK
   728	000433'	254007	000000		JRST	(T2)		;AND RETURN
   729				>;END IFCPU (KL)
   730
   731				IFCPU (KS),<
   732					SKIPE	CTYOWD##	;MAKE SURE NOTHING IS THERE
   733					JRST	.-1
   734					TRO	P2,CTYOVL	;SET THE VALID CHARACTER FLAG
   735					MOVEM	P2,CTYOWD##	;STORE CHAR
   736					WRAPR	LP.SSF!LP.I8C+APRCHN##	;WHAP THE 8080
   737					SKIPE	CTYOWD##	;WAIT TIL CHAR TAKEN
   738					JRST	.-1
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 11-2
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   739					ANDI	P2,CTYICH	;GET RID OF JUNK
   740					JRST	(T2)		;AND RETURN
   741				>;END IFCPU (KS)
   742
   743	000434'	522632	042500	RSCMSG:	ASCIZ /TYPE R TO RESCAN, L TO LOAD BOOTS
	000435'	511012	447500
	000436'	512132	341602
	000437'	471304	046100
	000440'	522364	046236
	000441'	406104	041236
   744	000442'	476512	306424	/
	000443'	000000	000000
   745
   746	000444'			NONMSG:	ASCIZ /
   747	000444'	064251	647634	NONE FOUND.
	000445'	425010	647652
   748	000446'	472105	606424	/
	000447'	000000	000000
   749	000450'			PARMSG:	ASCIZ /
   750	000450'	064250	554212	EXEC PARITY ERROR
	000451'	415012	040644
	000452'	446513	120212
	000453'	512451	751032
   751	000454'	052311	741500	LOC           CONTENTS
	000455'	201004	020100
	000456'	201004	020100
	000457'	416371	652212
   752	000460'	472512	306424	/
	000461'	000000	000000
   753
   754	000462'			DONMSG:	ASCIZ /
   755	000462'	064251	542632	MEMORY SCAN COMPLETE.
	000463'	476453	120246
	000464'	416031	620206
	000465'	476332	046212
   756	000466'	522125	606424	/
	000467'	000000	000000
   757
   758
   759				;TYPAPR - Called from APRFAT stopcode to decode bits in SAVAPR
   760
   761	000470'	201300	000513'	TYPAPR:	MOVEI	T1,ASTER	;Bunch of asterisks
   762	000471'	260040	000000*		PUSHJ	P,CONMES##
   763	000472'	200300	000505'		MOVE	T1,APRMSG-1	;Header text
   764	000473'	260040	000471*		PUSHJ	P,CONMES##
   765	000474'	205600	777773		MOVSI	P1,-APRMSL	;AOBJN pointer
   766	000475'	550314	000506'	TYPAPL:	HRRZ	T1,APRMSG(P1)	;Get addr of message
   767	000476'	554354	000506'		HLRZ	T2,APRMSG(P1)	;Get bit
   768	000477'	612340	000155*		TDNE	T2,SAVAPR##	;If bit was set in original CONI APR,
   769	000500'	260040	000473*		 PUSHJ	P,CONMES##	; output message
   770	000501'	253600	000475'		AOBJN	P1,TYPAPL	;Only 1 bit at a time is expected
   771	000502'	201300	000513'		MOVEI	T1,ASTER	;Bunch of asterisks
   772	000503'	260040	000500*		PUSHJ	P,CONMES##
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 11-3
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   773	000504'	263040	000000		POPJ	P,		;Return to APRFAT stopcode
   774
   775				PRINTF(<[APRTXT macro needs to be moved into K?SYM]>)
   776				IFCPU (KI),<DEFINE APRTXT,<
   777					APRNXM,,[ASCIZ /NXM=Nonexistant memory /]
   778					APRPOW,,[ASCIZ /PWF=Power failure /]
   779					APRIOP,,[ASCIZ /IOF=IO page failure /]
   780				>>
   781				IFCPU (KL),<DEFINE APRTXT,<
   782					LP.NXM,,[ASCIZ /NXM=Nonexistant memory /]
   783					LP.PWF,,[ASCIZ /PWF=Power failure /]
   784					LP.IOF,,[ASCIZ /IOF=IO page failure /]
   785					LP.CDP,,[ASCIZ /CDP=Cache directory parity /]
   786					LP.ADP,,[ASCIZ /ADP=Address parity /]
   787				>>
   788				IFCPU (KS),<DEFINE APRTXT,<
   789					LP.NXM,,[ASCIZ /NXM=Nonexistant memory /]
   790					LP.PWF,,[ASCIZ /PWF=Power failure /]
   791				>>
   792				IFCPU (F3),<DEFINE APRTXT,<
   793					LP.NXM,,[ASCIZ /NXM=Nonexistant memory /]
   794					LP.PWF,,[ASCIZ /PWF=Power failure /]
   795					LP.IOF,,[ASCIZ /IOF=IO page failure /]
   796				>>
   797
   798	000505'	000000	003144'		[ASCIZ	/**  APR status: /]	;Header text
   799	000506'	002000	003150'	APRMSG:	APRTXT	
   800	000507'	000040	003155'
   801	000510'	001000	003161'
   802	000511'	000200	003166'
   803	000512'	000100	003174'
   804						;Bits in APFMSK
   805			000005		APRMSL==.-APRMSG	;Number of entries in APRTXT
   806	000513'	201005	225032	ASTER:	ASCIZ	/  **
   807	000514'	051245	225124	********************************************************
	000515'	251245	225124
	000516'	251245	225124
	000517'	251245	225124
	000520'	251245	225124
	000521'	251245	225124
	000522'	251245	225124
	000523'	251245	225124
	000524'	251245	225124
	000525'	251245	225124
	000526'	251245	225124
   808	000527'	251241	505000	/
   809
   810				PRINTF(<[APRXXX should be removed]>)
   811				IFCPU (KL),<
   812				;Routine to save CPU status and type it on the CTY
   813				;Called with JSP T3,APRXXX
   814
   815	000530'	202400	000535'	APRXXX:	MOVEM	T3,XXPDL	;Save return PC
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 11-4
PICON.MAC	30-OCT-87 17:26		APRINT - Interrupt from the APR

   816	000531'	201040	000535'		MOVEI	P,XXPDL		;Point to emergency stack
   817	000532'	260040	000000*		PUSHJ	P,CPUSTS##	;Go read CPU status
   818	000533'	260040	000000*		PUSHJ	P,TYPCSB##	;Type it out
   819	000534'	254020	000535'		JRST	@XXPDL		;Return to caller
   820	000535'			XXPDL:	BLOCK	20
   821				>  ;End IFCPU(KL)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 12
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

   822				SUBTTL USER PARITY ERROR
   823
   824				COMMENT ! USEPER
   825				FUNCTION: SCAN ALL ACCESSIBLE MEMORY FOR THE RUNNING JOB;
   826				FOR ALL PAGES WHICH HAVE 1 OR MORE SOFT PARITY ERRORS
   827				DEACTIVATE ALL SLOTS FOR ALL JOBS SHARING THE PAGE;
   828
   829				IF PAGE CLEAN,JUST THROW IT OUT OF CORE. IF DIRTY,
   830				ALSO PUT IT IN OUTPUT-ERROR HASH TABLE.
   831
   832				IF NO PARITY ERROR TURNS UP, PRETEND ALL DIRTY PAGES OF CURRENT
   833				JOB HAVE A PARITY ERROR.
   834
   835				IF ANY PARITY ERROR IS HARD, PRINT MSG, TURN OFF PI'S, AND
   836				GOTO EXEC PARITY ERROR CODE.
   837
   838				NOTICE: THIS CODE RUNS AT UUO LEVEL, HAVING BEEN ENTERED BY
   839				 A JEN FROM APRINT.PI ENABLED.. PARITY INT. DISABLED.
   840				 HOWEVER SINCE THIS CODE RUNS AT UUO LEVEL IN LONG LOOP SCANNING
   841				 PAGES AND DEACTIVATING BAD ONES, SCHEDULER (AND PARTICULARLY,
   842				 SCNSER) DO NOT RUN. AFTER WE KNOW THERE IS NO HARD UPE,
   843				 EXPLICITLY CALL SCHEDULER TO LET SCNSER RUN ETC. ALSO
   844				 MAY BLOCK DURING VCLEAR OF USER CORE. FINE.
   845
   846
   847				ANY PARITY PROBLEMS WITH UPT CAUSE TRANSFER TO EXEC PARITY CODE.
   848
   849				REGISTER ASSIGNMENTS:
   850				W/ VIRT. PG NO.		PG/ PHYS PG NO.		S/FLAGS
   851				P1/USER VIRT. ADDR	P3,P4/LMAP SLOT DATA	J/JOB
   852				F,U/ DDB & LDB FOR CTY OUTPUT
   853				!
   854
   855
   856				;FLAGS IS S, RH:
   857			100000		FOUNDP==100000	;1 IF PARITY ERROR FOUND
   858			200000		BADPAG==200000	;1 IF CURRENT PAGE ALREADY KNOWN BAD
   859			400000		STOPUJ==400000	;1 IF MUST STOP USER JOB. (CURRENTLY
   860							;ALWAYS SET. ON KL10 MAYBE NOT).
   861			040000		PG0UPE==40000	;1 IF USER VP 0 GOT HIT
   862
   863			000004	SPERPT==4	;HOW MANY SOFT PARITY ERRORS TO REPORT
   864
   865
   866				EXTERN CURUPT,DEALMS,REQUE,REMCHT,PGYDIO,PGYDRT,PGYUSE
   867				EXTERN SCNLMC,LMPNER,%UPLMA,UPSJOB,ALR620
   868
   869	000555'	120300	000220'	USEPER::DMOVE	T1,SAVT1	;GET USER'S T1 BACK (IN CASE KL)
   870	000556'	701140	003075'		EXECAC			;GET TO EXEC MODE ACS
   871	000557'	700200	024400		CLPARF			;CLEAR NOW INCASE ANOTHER CH1 INT
   872	000560'	265400	000530'	IFCPU (KL),<JSP T3,APRXXX>	;Type APR, ERA, and SBUS info on CTY
   873	000561'	336100	000034*		SKIPN	J,JOB		;Must have a valid UPT for the stack
   874	000562'	256000	003200'		 STOPCD (.,CPU,NJBPER,,<Parity error in Null Job>)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 12-2
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

   875				 ;;USEPER+3
   876	000563'	200040	003203'		MOVE	P,[-EPLLEN,,%UPT+UPTPDL-1]	;INT CAME FROM USER MODE,
   877						;SO OK TO USE UPTPDL--NOTHING OF INTEREST THERE.
   878	000564'	261040	000310*		PUSH	P,PARPC		;IN CASE WE WANT TO RETURN TO USER
   879				IFCPU (KS),<TBSET TBVAPR>	;RESET THE TIME BASE FOR CHARGING
   880	000565'	702600	400000*		NOCHARGE		;DON'T CHARGE USER FOR PARITY PROCESSING
   881	000566'	260040	000000*		PUSHJ	P,GETCTY	;SETUP F,U FOR SOFT UPE REPORTING
   882								;(ALSO CLEARS OUTPUT BUFFER)
   883	000567'	201000	400000		MOVEI	S,STOPUJ	;FOUNDP_0
   884	000570'	201300	000004		MOVEI	T1,SPERPT	;SOFT UPE REPORT COUNT
   885	000571'	202300	001010'		MOVEM	T1,SPECNT
   886	000572'	201600	000020		MOVEI	P1,20		;SCAN FROM 20 TO 777777
   887	000573'	254000	000600'		JRST	UPEB1		;START SCAN OF PG 0 AT 20
   888
   889				;PROCESS NEXT USER VIRTUAL ADDR. PAGE BDRY TEST
   890
   891	000574'	303600	777777	UPE0:	CAILE	P1,777777	;DONE SCAN YET?
   892	000575'	254000	000656'		 JRST	UPETF		;YES,TEST FOUNDP
   893	000576'	602600	000777		TRNE	P1,777		;ABOUT TO LOOK AT NEW PAGE
   894	000577'	254000	000623'		 JRST	UPE1		;NO
   895
   896				;BEGIN NEW PAGE. SETUP W/VPG, PG/PHYS. IF PAGE NOT
   897				;ACCESSIBLE GOTO NEXT PAGE. MAKE SURE NO UPT MAP
   898				;SLOT PARITY TROUBLE. SET UP %UPS FOR READS
   899
   900	000600'	620000	200000	UPEB1:	TRZ	S,BADPAG	;THIS PAGE NOT BAD YET
   901	000601'	550500	000014		HRRZ	W,P1
   902	000602'	242500	777767		LSH	W,-^D9		;W/VPG
   903	000603'	700200	024400		CLPARF
   904	000604'	701220	000000*		CLRPTA			;FORCE PAGER TO READ UPT SO CATCH PAR ERRS IN UPT
   905	000605'	256200	003204'		XCTBU <MAP PG,(P1)>	;PG_PHYS PG NO+BITS
   906	000606'	700300	000400		CONSZ	APR,APRPAR	;PARITY FLAG FROM READING UPT?
   907	000607'	254000	000732'		 JRST	UPEBA		;YES,TREAT LIKE EXEC PARITY
   908				IFCPU (KI),<TRNE PG,MAP.M>	;ANY MATCH
   909	000610'	603140	200000	IFNCPU(KI),<TLNE PG,PFW.H	;CHECK FOR ANY HARD ERROR
   910	000611'	256000	003205'		 STOPCD (.,STOP,UPTPER,,<Page error in UPT>)
   911	000612'	607140	100000		TLNN	PG,PFW.A>	;SKIP IF CAN READ IT
   912					 JRST	[IORI P1,777	;NO,SCAN ONLY PAGES WITH
   913	000613'	254000	003210'			 JRST UPENXA]	;PGE.A SET
   914	000614'	242140	777767	IFNCPU (KI),<LSH PG,-^D9>	;KL GIVES FULL ADDRESS
   915	000615'	405140	017777		ANDI	PG,17777	;PG/PHYS, NO BITS
   916	000616'	660140	500000		TRO	PG,PGE.A!PGE.W
   917	000617'	137140	000327*		DPB	PG,EPYPSN	; [EPTPTR(%UPS.N)]
   918	000620'	402000	000331*		SETZM	UPSJOB		;TELL MAPUPS THAT %UPS IS CHANGED
   919	000621'	701100	000334*		CLRPTO	%UPS
   920	000622'	620140	500000		TRZ	PG,PGE.A!PGE.W
   921
   922				;READ USER ADDR THRU %UPS; IF PARITY COMES UP, SEE IF SOFT OR HARD.
   923
   924	000623'	700200	024400	UPE1:	CLPARF
   925	000624'	200340	000014		MOVE	T2,P1		;T2/VIRT ADDR
   926	000625'	405340	000777		ANDI	T2,777		;T2/OFFSET WITHIN PAGE
   927	000626'	200307	000621*		MOVE	T1,%UPS(T2)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 12-3
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

   928	000627'	700340	000400		CONSO	APR,APRPAR	;GOT PARITY?
   929	000630'	254000	000655'		 JRST	UPENXA		;NOPE
   930
   931
   932				;*********************
   933				;BEGIN GOT PARITY
   934				;GOT PARITY ERROR THIS ADDR. P1/VIRT ADDR PG/PHYS PG
   935				;W/VPG  T1/BAD PARITY WORD CONTENTS
   936
   937	000631'	202300	000000*	UPED:	MOVEM	T1,PARWRD
   938	000632'	350000	000000*		AOS	PARTOT		;TOTAL PARITY COUNT
   939	000633'	660000	100000		TRO	S,FOUNDP	;NOTE WE GOT ONE
   940	000634'	606000	200000		TRNN	S,BADPAG	;GET ONE YET THIS PAGE?
   941	000635'	260040	001033'		 PUSHJ	P,BPPAGE	;NO,FIRST ONE.
   942
   943				;SEE IF ERROR IS HARD OR SOFT. DO PATTERNS. PAGE IS
   944				;NO LONGER ACTIVE AND HAS BEEN THROWN OUT OF CORE,
   945				;SO THIS CORE PG IS ON A FREE LIST AND WE ARE DESTROYING
   946				;ITS DATA THRU %UPS, WHICH IS WRITEABLE.
   947
   948	000636'	550740	000003	UPED2:	HRRZ	P4,PG
   949	000637'	242740	000011		LSH	P4,^D9		;MAKE P4/PHYSICAL ADDRESS
   950	000640'	201340	000777		MOVEI	T2,777		;FOR PARITY PRINTER
   951	000641'	404340	000014		AND	T2,P1
   952	000642'	434740	000007		IOR	P4,T2		;T2/OFFSET IN PAGE
   953	000643'	205300	777775		MOVSI	T1,-PARLEN
   954	000644'	700200	024400	UPED2A:	CLPARF
   955	000645'	256006	000774'		XCT	PARSET(T1)	;WRITE ON THE WORD
   956	000646'	200407	000626*		MOVE	T3,%UPS(T2)	;SEE WHAT GOT THERE
   957	000647'	312406	000777'		CAME	T3,PARCMP(T1)	;THE RIGHT THING?
   958	000650'	254000	000747'		 JRST	UPEHRD		;NO
   959	000651'	700340	000400		CONSO	APR,APRPAR
   960	000652'	253300	000644'		 AOBJN	T1,UPED2A	;NEXT TEST
   961	000653'	321300	000747'		JUMPL	T1,UPEHRD	;PARITY CAME UP IF T1 NEGATIVE
   962	000654'	260040	001011'		PUSHJ	P,PARSFT	;DEAL WITH SOFT PARITY REPORT
   963								;& GOTO NEXT ADDRESS. FALL THRU
   964					;END UPED..GOT PARITY ERR THIS VIRT ADDR
   965
   966				;END GOT PARITY
   967				;*********************
   968
   969
   970				;END UPE0 LOOP. NEXT VIRT ADDR
   971	000655'	344600	000574'	UPENXA:	AOJA P1,UPE0
   972
   973				;HERE WHEN ENTIRE USER SPACE SCANNED. TEST
   974				;FOUNDP--HOPEFULLY WE GOT A PARITY ERROR SOMEWHERE. IF
   975				;NOT, EITHER IT'S SPURIOUS, OR (WHAT IS MORE
   976				;LIKELY) IT'S A READ-MODIFY-WRITE PARITY ERROR. WE
   977				;CAN'T TELL WHERE IT WAS, SO HAVE TO ASSUME ALL
   978				;HIS ACCESSIBLE DIRTY PAGES ARE BAD. YUCK!
   979
   980	000656'	602000	100000	UPETF:	TRNE	S,FOUNDP	;FIND AT LEAST ONE?
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 12-4
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

   981	000657'	254000	000716'		 JRST	UPEG		;YEA!
   982
   983	000660'	201600	000777		MOVEI	P1,777		;EXAMINE 777,1777,2777,..FOR ACCESSIBLE
   984								;DIRTY PAGES.
   985	000661'	350000	000000*		AOS	PARSPR		;COUNT "SPURIOUS" UPE INTERRUPTS
   986	000662'	201300	000400		MOVEI	T1,ALRCTY	;ALERT OPERS TO EXISTENCE
   987	000663'	436300	000000*		IORM	T1,ALR620	;OF MSG
   988	000664'	260040	000247*		PUSHJ	P,INLMES
   989					 ASCIZ /
   990	000665'	064244	251740	"Spurious" user parity error interrupt/
	000666'	727455	167752
	000667'	715044	072746
	000670'	627444	070302
	000671'	713236	474500
	000672'	627456	267744
	000673'	203235	672312
	000674'	713456	570350
	000675'	000000	000000
   991	000676'	200500	000014	UPEH:	MOVE	W,P1
   992	000677'	242500	777767		LSH	W,-^D9		;W/VPG
   993	000700'	303500	000777		CAILE	W,777
   994	000701'	254000	000716'		 JRST	UPEG		;DONE PAGES 0-777
   995	000702'	256200	003204'		XCTBU <MAP PG,(P1)>	;PG/BITS+PHYS
   996				IFCPU (KI),<TRNE PG,MAP.M>	;ANY MATCH
   997	000703'	603140	200000	IFNCPU(KI),<TLNE PG,PFW.H	;CHECK FOR ANY HARD ERROR
   998	000704'	256000	003212'		 STOPCD (.,CPU,APRHPE,,<Hard Parity Error>)
   999	000705'	607140	100000		TLNN	PG,PFW.A>	;IF KL, MAKE SURE A BIT IS ON.
  1000	000706'	254000	000714'		 JRST	UPEH1		;NO
  1001	000707'	242140	777767	IFNCPU (KI),<LSH PG,-^D9>	;KL GIVES FULL ADDRESS INSTEAD OF PAGE NUMBER.
  1002	000710'	405140	017777		ANDI	PG,17777	;CLEAR BITS
  1003	000711'	135300	000000*		LDB	T1,PGYDRT	;CLEAN PAGES CANNOT HAVE HAD
  1004	000712'	322300	000714'		JUMPE	T1,UPEH1	;READ-MODIFY-WRITE PARITY ERROR
  1005	000713'	260040	001033'		PUSHJ	P,BPPAGE	;EXPECTS J,PG,W
  1006	000714'	271600	001000	UPEH1:	ADDI	P1,1000		;NEXT PAGE
  1007	000715'	254000	000676'		JRST	UPEH
  1008
  1009				;*****************************
  1010				;	FINISHED USER PARITY PROCESSING
  1011
  1012	000716'	262040	000006	UPEG:	POP	P,T1		;USER PC
  1013	000717'	700200	024400		CLPARF
  1014	000720'	700600	000200		WRPI	LI.PIN
  1015				PRINTF(<[Need symbol for KI WRPI 1B21]>)
  1016				IFCPU (KI),<WRPI 1B21>		;ENABLE PARITY INTERRUPT
  1017	000721'	700200	104400*	IFCPU (KL),<WRAPR LP.ESF+LP.PAR+LP.SBE+APRCHN##>
  1018				IFCPU (F3),<WRAPR LP.ESF+LP.PAR+APRCHN##>
  1019				IFCPU (KS),<WRAPR LP.ESF+LP.HPE+APRCHN##>
  1020	000722'	606000	400000		TRNN	S,STOPUJ	;CAN WE LET HIM RUN?
  1021	000723'	254106	000000		 JRSTF	(T1)		;YES..THE FOOL!
  1022	000724'	260040	000000*		PUSHJ	P,WSCHED	;LET SCHEDULER RUN..FINALLY
  1023	000725'	205300	000000*		MOVSI	T1,LMPNER	;IF PG 0 GOT HIT,
  1024	000726'	602000	040000		TRNE	S,PG0UPE	;NEED TO PREVENT EXEC MPE'S ON
  1025	000727'	436300	000000*		 IORM	T1,%UPLMA+0	;RESET REF'S TO JOBDAT (WE'RE GOING TO
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 12-5
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

  1026								;THROW PG AWAY RIGHT AWAY ANYWAY).
  1027	000730'	260040	000000*		PUSHJ	P,JOB1		;RESET,ZAP MEMORY
  1028	000731'	324740	000000*		PJRST	ERRPAR		;PRINT PARITY ERROR AND STOP JOB
  1029
  1030				;**************************************
  1031
  1032
  1033				;GOT PARITY TESTING USER MAP SLOT. W/VPG
  1034
  1035	000732'	700600	000400	UPEBA:	WRPI	LI.PIF
  1036					MOVEI	P1,[ASCIZ /
  1037	000733'	201600	003215'	UPT page parity error, location/]
  1038	000734'	265300	000410'		JSP	T1,BUGTYP
  1039	000735'	554300	000000*		HLRZ	T1,CURUPT
  1040	000736'	405300	017777		ANDI	T1,17777
  1041	000737'	242300	000011		LSH	T1,^D9
  1042	000740'	242500	777777		LSH	W,-1		;VPG/2 = SLOT LOCN
  1043	000741'	434500	000006		IOR	W,T1		;W/PHYSICAL LOCN OF MAP SLOT
  1044	000742'	554600	000012		HLRZ	P1,W		;PRINT HI ORDER
  1045	000743'	265300	000415'		JSP	T1,BUGTY6
  1046	000744'	550600	000012		HRRZ	P1,W
  1047	000745'	265300	000415'		JSP	T1,BUGTY6
  1048	000746'	254000	000313'		JRST	EXCPAR		;AND GO TREAT LIKE EXEC PARITY
  1049
  1050				;A PATTERN FAILED OR PARITY FLAG CAME UP ON PATTERNS
  1051				;P4/PHYS LOCN OF WORD
  1052				;T3/BAD CONTENTS READ
  1053				;T1/PATTERN TABLE INDEX
  1054				;PARWRD/ORIGINAL BAD CONTENTS OF WORD BEFORE TESTS
  1055
  1056				;PRINT DROPPED BIT	(OR OTHER APPROPRIATE MSG)
  1057				;	HARD UPE <LOCN> = <BAD PATTERN> = <ORIGINAL BAD DATA>
  1058
  1059	000747'	200606	000771'	UPEHRD:	MOVE	P1,PARPRT(T1)
  1060	000750'	265300	000410'		JSP	T1,BUGTYP
  1061	000751'	205100	777776		MOVSI	J,-2
  1062	000752'	201600	001002'		MOVEI	P1,HRDUPE
  1063	000753'	265300	000410'		JSP	T1,BUGTYP
  1064	000754'	554600	000017		HLRZ	P1,P4	;ADDRESS UPPER
  1065	000755'	265300	000415'		JSP	T1,BUGTY6
  1066	000756'	550600	000017		HRRZ	P1,P4
  1067	000757'	265300	000415'		JSP	T1,BUGTY6
  1068	000760'	201600	003224'	UPEHR2:	MOVEI	P1,[ASCIZ / = /]
  1069	000761'	265300	000410'		JSP	T1,BUGTYP
  1070	000762'	554600	000010		HLRZ	P1,T3
  1071	000763'	265300	000415'		JSP	T1,BUGTY6
  1072	000764'	550600	000010		HRRZ	P1,T3
  1073	000765'	265300	000415'		JSP	T1,BUGTY6
  1074	000766'	200440	000631*		MOVE	T4,PARWRD
  1075	000767'	253100	000760'		AOBJN	J,UPEHR2
  1076	000770'	254000	000313'		JRST	EXCPAR		;GO TO EXEC PARITY CODE
  1077
  1078				PARPRT:	EXP [ASCIZ/
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 12-6
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

  1079				BIT DROPPED/],[ASCIZ/
  1080				PICKED BIT/], [ASCIZ/
  1081	000771'	000000	003225'	PICKED PARITY/]
	000772'	000000	003230'
	000773'	000000	003233'
  1082
  1083	000774'	476007	000646*	PARSET:	SETOM %UPS(T2)
  1084	000775'	350007	000774*		AOS %UPS(T2)
  1085	000776'	350007	000775*		AOS %UPS(T2)
  1086			000003	PARLEN==.-PARSET
  1087
  1088
  1089	000777'	777777	777777	PARCMP: EXP -1,0,1	;THIS DATA TO MATCH AFTER XCT PARSET(T1)
	001000'	000000	000000
	001001'	000000	000001
  1090
  1091	001002'			HRDUPE: ASCIZ/
  1092	001002'	064251	040644	HARD USER PARITY ERROR /
	001003'	421012	551612
	001004'	511012	040644
	001005'	446513	120212
	001006'	512451	751100
	001007'	000000	000000
  1093
  1094	001010'			SPECNT:	BLOCK 1		;COUNTS HOW MANY SOFT UPE'S TO REPORT
  1095
  1096				;SOFT ERROR. INTERRUPTS STILL ENABLED.
  1097				;EXPECTS: P4/PHYS LOCN OF BAD WORD, PARWRD/ ITS CONTENTS
  1098				;SPECNT/ HOW MANY OF THESE TO REPORT
  1099				;F/CTY DDB   U/SCN LDB
  1100
  1101	001011'	375000	001010'	PARSFT:	SOSGE	SPECNT
  1102	001012'	263040	000000		 POPJ	P,
  1103	001013'	260040	000664*		PUSHJ	P,INLMES
  1104					 ASCIZ /
  1105	001014'	064252	551612	USER PARITY ERROR AT /
	001015'	511012	040644
	001016'	446513	120212
	001017'	512451	751100
	001020'	406504	000000
  1106	001021'	554300	000017		HLRZ	T1,P4
  1107	001022'	260040	000000*		PUSHJ	P,OCTPNT
  1108	001023'	550300	000017		HRRZ	T1,P4
  1109	001024'	260040	001022*		PUSHJ	P,OCTPNT
  1110	001025'	260040	001013*		PUSHJ	P,INLMES
  1111	001026'	201724	000000		 ASCIZ / = /
  1112	001027'	554300	000766*		HLRZ	T1,PARWRD
  1113	001030'	260040	001024*		PUSHJ	P,OCTPNT
  1114	001031'	550300	001027*		HRRZ	T1,PARWRD
  1115	001032'	324740	001030*		PJRST	OCTPNT
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 13
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

  1116				COMMENT ! ROUTINE BPPAGE --  FIRST BAD PARITY FOR PAGE
  1117				FUNCTION: DEACTIVATE ALL SLOTS ON LMA CHAIN FOR THIS
  1118				 PHYSICAL PAGE; IF IT'S DIRTY, ENTER IT IN OHT. THROW IT
  1119				 OUT OF CORE HASH TABLE. MAKE SPECIAL NOTE OF UPE ON PG 0
  1120				EXPECTS: W/VPG PG/PHYS J/JOB
  1121				DESTROYS: M,T1-T4,P3,P4
  1122				PRESERVES: %UPS SET UP ON ENTRY TO PHYS WITH PGE.W FOR PATTERNS
  1123					SETS THIS UP AGAIN ON EXIT. DEALMS AND FRIENDS
  1124					DESTROY IT.
  1125				!
  1126
  1127				EXTERN OHTTAB,INSOHT,OHTPAR,DSKPIF,DSKPIN,PGYSOP
  1128
  1129				DEFINE DSKON  <WRPI DSKPIN>
  1130				DEFINE DSKOFF <WRPI DSKPIF>
  1131
  1132	001033'	261040	000014	BPPAGE:	PUSH	P,P1		;NEED A P AC HERE
  1133	001034'	261040	000004		PUSH	P,F
  1134	001035'	261040	000005		PUSH	P,U		;THESE NEEDED FOR INLMES
  1135	001036'	660000	200000		TRO	S,BADPAG	;NOTE PAGE NOW KNOWN BAD
  1136	001037'	306500	000000		CAIN	W,0
  1137	001040'	660000	040000		 TRO	S,PG0UPE	;NOTE VP 0 GOT HIT
  1138	001041'	135300	000000*		LDB	T1,PGYDIO	;WAIT UNTIL ALL DIO STOPS. INTERRUPTS
  1139	001042'	326300	001041'		JUMPN	T1,.-1		;ARE RUNNING.
  1140	001043'	135300	000617*		LDB	T1,EPYPSN	; [EPTPTR(%UPS.N)]
  1141	001044'	261040	000006		PUSH	P,T1		;SAVE PATTERN SLOT
  1142	001045'	261040	000002		PUSH	P,J
  1143	001046'	261040	000012		PUSH	P,W
  1144	001047'	261040	000003		PUSH	P,PG		;SAVE THESE FROM SCNLMC
  1145	001050'	135600	000000*		LDB	P1,PGYADR	;SAVE DSK PAGE FOR LATER INSOHT
  1146	001051'	261040	000014		PUSH	P,P1
  1147	001052'	135600	000711*		LDB	P1,PGYDRT	;FOR LATER TEST IF NEED INSOHT OR NOT
  1148	001053'	700200	024400		CLPARF
  1149	001054'	265200	000000*		JSP	F,SCNLMC	;BEGIN SCAN LMA CHAIN. SKIP RTN SUCCESS
  1150	001055'	254000	001060'		  JRST	BPPG2		;NO MORE ON CHAIN
  1151								;SKIP: P3,P4/SLOT,J/JOB,W/VP  OF NEXT SLOT
  1152	001056'	260040	000000*		PUSHJ	P,DEALMS	;GETS PG/PHYS FOR THIS W/VP. DEACTIVATE SLOT
  1153								;(SHOULD BE SAME AS PG ON ENTRY)
  1154	001057'	254013	000000	BPPG1:	JRST	(M)		;COROUTINE RETURN TO SCNLMC,STORE SLOT &
  1155								;CONTINUE SCAN OF LMA CHAIN
  1156	001060'	262040	000007	BPPG2:	POP	P,T2		;GET T2/DSK PAGE ADDR
  1157	001061'	322600	001067'		JUMPE	P1,BPPG3	;IF PAGE CLEAN, SKIP THIS
  1158	001062'	700600	000000*		DSKOFF
  1159	001063'	260040	000000*		PUSHJ	P,INSOHT	;PUT IN OHT, GET T4/INDEX
  1160	001064'	205300	000000*		MOVSI	T1,OHTPAR	;MARK WHAT KIND OF ERROR
  1161	001065'	436311	000000*		IORM	T1,OHTTAB(T4)
  1162	001066'	700600	000000*		DSKON
  1163
  1164	001067'	262040	000003	BPPG3:	POP	P,PG
  1165	001070'	262040	000012		POP	P,W
  1166	001071'	262040	000002		POP	P,J
  1167	001072'	700300	000400		CONSZ	APR,APRPAR	;DID WE GET PARITY DURING LMA CHAIN SCAN?
  1168	001073'	254000	000313'		 JRST	EXCPAR		;YES,SIGH
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 13-2
PICON.MAC	30-OCT-87 17:26		USER PARITY ERROR

  1169	001074'	135300	000000*		LDB	T1,PGYUSE	;BY NOW IT SHOULD BE OK TO THROW THIS PG
  1170	001075'	332000	000006		SKIPE	T1		;OUT OF CHT.
  1171	001076'	256000	000000'		 STOPCD
  1172	001077'	262040	000006		POP	P,T1		;%UPS SLOT FOR PATTERNS..NOT AN LMAP
  1173	001100'	137300	001043*		DPB	T1,EPYPSN	; [EPTPTR(%UPS.N)]
  1174	001101'	402000	000620*		SETZM	UPSJOB		;MAKE SURE MAPUPS KNOWS NOT VALID
  1175	001102'	701100	000776*		CLRPTO	%UPS
  1176	001103'	262040	000005		POP	P,U
  1177	001104'	262040	000004		POP	P,F
  1178	001105'	262040	000014		POP	P,P1		;THE ACS WE USED
  1179	001106'	135300	000000*		LDB	T1,PGYSOP	;CAN'T BE SWAP IN, CHECK SWAP OUT
  1180	001107'	326300	000000*		JUMPN	T1,CPOPJ	;IF ITS SOP AND FREE, WAIT FOR NEXT USER TO
  1181							; REFERENCE IT AND HOPE ITS NOT ON ITS WAY OUT AGAIN.
  1182	001110'	324740	000000*		PJRST	REMCHT	;NO I/O, THROW PG OUT OF CHT SO DOESN'T HAPEN AGAIN,
  1183							; & RETURN NO SKIP
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 14
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1184				SUBTTL START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY
  1185
  1186				EXTERN JBTLIC,THSDAT,JBTNAM,HFDBUF,SINTBS,SINTB
  1187				IFCPU (KI),<EXTERN TM2CHL,TM2CHN>
  1188
  1189				COMMENT ! DATABASE
  1190				BESIDES THE DATA KEPT HERE, THERE IS A BUFFER OF HISTOGRAM
  1191				DATA, AND MODIFIED INSTRUCTIONS IN THE SNOOP INTERRUPT
  1192				CODE, AND LINKAGES TO INTERRUPT HARDWARE !
  1193
  1194				;  SAMPLING-INTERVAL CODE TRANSLATION
  1195			000000	%ZZ==0
  1196			000000	LHFITTB==0
  1197				DEFINE TSIC(CODE,COUNT,LEAP)<
  1198				%ZZ==^D'CODE
  1199				IFG %ZZ-LHFITTB,<LHFITTB==%ZZ>
  1200				XWD [^D'COUNT,,^D'LEAP],^D'CODE  >
  1201
  1202				IFNCPU (KS),<
  1203	001111'	003237'	000010	SICTB:	TSIC(8,208,211)	;8 PER TICK, 2.08MS COUNT, 2.11 MS LEAP COUNT
  1204	001112'	003240'	000020		TSIC(16,104,107) ;16/TICK,15 COUNTS @ 1.04MS, 1 @ 1.07MS
  1205	001113'	003241'	000040		TSIC(32,52,55)
  1206	001114'	003242'	000100		TSIC(64,26,29)
  1207			000004	LSICTB==.-SICTB
  1208				>;END IFNCPU (KS)
  1209
  1210				IFCPU (KS),<
  1211				SICTB:	TSIC(8,2,3)	;8 PER TICK, 2MS COUNT, 3MS LEAP TICK
  1212					TSIC(16,1,2)	;16 PER TICK
  1213				LSICTB==.-SICTB	;LENGTH OF SICTB TABLE
  1214				>;END IFCPU (KS)
  1215
  1216			000001	HFUSNP==1		;ADDR SPACE TO HIST MASK
  1217
  1218	001115'			HFPIMK:	;LH OF WORD PI MASK.  1B0 FOR UUO LEVEL
  1219	001115'			HFSTS: BLOCK 1	;RH=STATE CODE
  1220	001116'			HFLOW: BLOCK 1
  1221	001117'			HFHI: BLOCK 1
  1222	001120'			HFSFC: BLOCK 1  	; SAMPLING-FREQUENCY CODE
  1223	001121'			HFCSPN: BLOCK 1  	; CUSP NAME
  1224	001122'			HFUPTM: BLOCK 1  	;UPTIME WHEN SAMPLING BEGAN: DAYS64,,JIFFIES
  1225	001123'			HFDSIZ: BLOCK 1  	;SIZE OF CURRENT HISTOGRAM IN HFDBUF
  1226	001124'			SNITPT: BLOCK 1  	;CIRCULATING POINTER (INDEX INTO) HFITTB
  1227	001125'			SNITMX: BLOCK 1  	;MAX VALUE FOR SNITPT
  1228	001126'			HFITTB: BLOCK LHFITTB 	;TIMER INTERVAL TABLE
  1229	001226'			SAVT12: BLOCK 2		;FOR SNOOPI SAVING T1,T2
  1230				  IFCPU (<KL>),<
  1231	001230'			SNSJSR: BLOCK 1		;SAVE NORMAL INTERVAL-TIMER JSR INSTR
  1232	001231'			SNOOJB:	BLOCK 1		;SNNMI TO SNOOPI FLAG&COMMUNICATION CELL
  1233				>
  1234				IFCPU (KS),<
  1235				SNSJSR:	BLOCK	1	;SAVE INSTRUCTION FOR INTERVAL TIMER PROCESSING
  1236				SNOOJB:	BLOCK	1	;SNNMI TO SNOOPI FLAG & COMMUNICATION CELL
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 14-2
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1237				>
  1238	001232'			HFPITB: BLOCK 10	;ENABLE/DISABLE COUNTING AT PI LEVEL N
  1239							;COUNT IF HFPITB[N] .NE. 0 (FASTER THAN JFFO
  1240							;AND BIT OPERATIONS AT INTERRUPT LEVEL.)
  1241	001242'			HFMODE:	BLOCK 1		;FLAG WHICH ADDR SPACE (USER/MONITOR) IN HIST
  1242
  1243				;CONTIGUOUS BLOCK OF COUNTERS
  1244			001243'	HFCNTB==.
  1245	001243'			TOTCNT: BLOCK 1  	;TOTAL SNOOP INTERRUPTS FIELDED
  1246	001244'			HISTOT: BLOCK 1  	;TOTAL COUNTS IN HISTOGRAM
  1247	001245'			USRCNT: BLOCK 1  	;TOTAL COUNTS IN USER PROGRAMS
  1248	001246'			OORCNT: BLOCK 1  	;TOTAL COUNTS OUT-OF-RANGE IN MONITOR
  1249	001247'			NULCNT: BLOCK 1  	;TOTAL COUNTS IN NULJOB
  1250	001250'			SYSCNT: BLOCK 1  	;TOTAL COUNTS IN MONITOR-MODE
  1251	001251'			PICNT: BLOCK 10	;COUNTS AT EACH PI LEVEL. PICNT[0] FOR UUO LEVEL
  1252			000016	HFCTGL==.-HFCNTB
  1253
  1254				COMMENT ! COUNTER HIERARCHY: (WHEN SAMPLING MONITOR ADDRESSES)
  1255
  1256				TOTCNT =  USRCNT  +  SYSCNT  +  NULCNT
  1257
  1258				SYSCNT =   SUM ( PICNT[I] I=0 TO 7 )  IE, UUO LEVEL+ALL PI'S
  1259
  1260				SYSCNT = HISTOT + OORCNT
  1261
  1262				HISTOT = SUM ( HISTOGRAM[I] ALL I )
  1263
  1264				!
  1265				;COMMON ERROR RETURNS.  EXPECT: M/ XXX,,USER AC NUMBER
  1266
  1267				DEFINE ERRCOD(N,SYM,LABEL)<
  1268				 XP SYM,N
  1269				IFGE <7-N>,<LABEL==ERR0'N>
  1270				IFL <7-N>,<LABEL==ERR'N>
  1271				>
  1272
  1273	001261'	265300	001271'	ERR00:	JSP T1,ECOD	;(0)
  1274	001262'	265300	001271'	ERR01:	JSP T1,ECOD
  1275	001263'	265300	001271'	ERR02:	JSP T1,ECOD
  1276	001264'	265300	001271'	ERR03:	JSP T1,ECOD
  1277	001265'	265300	001271'	ERR04:	JSP T1,ECOD
  1278	001266'	265300	001271'	ERR05:	JSP T1,ECOD
  1279	001267'	265300	001271'	ERR06:	JSP T1,ECOD
  1280	001270'	265300	001271'	ERR07:	JSP T1,ECOD
  1281				;ADD MORE HERE IF NEEDED FOR OTHER UUOS
  1282	001271'	275300	001262'	ECOD:	SUBI T1,ERR00+1
  1283	001272'	256200	003243'		XCTTU <HRRZM T1,(M)>	;RETURN TO USER
  1284	001273'	263040	000000		POPJ P,
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 15
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1285				COMMENT ! SNOOP CALLI
  1286				USER CALL:	MOVE AC,[FUNCTION,,ADDR]
  1287						CALLI AC,-116
  1288						 ERROR, AC/CODE
  1289						SUCCESS, AC UNCHANGED
  1290				ERROR CODES !
  1291					;IF CALLI NOT IMPLEMENTED OR NO SNOOP BUFFER ALLOCATED
  1292					;AT ONCE-TIME, ERROR RETURN AC/UNCHANGED
  1293					ERRCOD(1,SNPNL%,SNOONL)	;NO LICENSE (TAKES RC & WC)
  1294					ERRCOD(2,SNPBF%,SNOOBF)	;BAD FUNCTION CODE
  1295					ERRCOD(3,SNPAR%,SNOOAR)	;ALREADY RUNNING, TRIED TO START
  1296					ERRCOD(4,SNPBL%,SNOOBL)	;BAD LSH (RESOLUTION)
  1297					ERRCOD(5,SNPBR%,SNOOBR)	;BAD RANGE LOW TO HIGH
  1298					ERRCOD(6,SNPBI%,SNOOBI)	;BAD INTERVAL CODE
  1299					ERRCOD(7,SNPBJ%,SNOOBJ)	;BAD JOB NO.
  1300
  1301				;SNOOP UUO FUNCTION CODES=HISTOGRAM FACILITY STATE CODES,
  1302				;PLUS SNOOP UUO DISPATCH.
  1303
  1304	001274'			SNDSP:
  1305	000000				PHASE 0
  1306	000000			HFFMIN:!
  1307	001274'	254000	001312'	HFZAPD:! JRST SNZAP ;ZAPPED: NO HISTO EXISTS, HARDWARE STOPPED
  1308	001275'	254000	001322'	HFSTOP:!	JRST SNSTOP;STOPPED: HDW STOPPED, HISTO EXISTS
  1309	000002			HFFMAX:!
  1310	001276'	254000	001332'	HFRUN:!	JRST SNGO	;RUNNING: HDW RUNNING, HISTO EXISTS
  1311	001277'				DEPHASE
  1312
  1313				COMMENT !	ARG BLOCK DEFN
  1314
  1315				ADDR:	BYTE (17)PI LEVELS INCLUDED (1)ADDR SPACE: 0=SYS 1=USER (18)0
  1316				+1	LOW ADDRESS
  1317				+2	HIGH ADDRESS
  1318				+3	RESOLUTION AS A LSH COUNT, 0.LE.COUNT.LE.^D18
  1319				+4	<JOB> OR 0,,<INTERVAL CODE>
  1320				+5	CUSP NAME OR 0
  1321
  1322				!
  1323			000000		ARGPI==0
  1324			000001		ARGLOW==1
  1325			000002		ARGHI==2
  1326			000003		ARGRES==3
  1327			000004		ARGJOB==4
  1328			000004		ARGSIC==4
  1329			000005		ARGCSP==5
  1330
  1331				;*************************
  1332				;ENTER T1/ FUNCTION,,ADDR	J/JOB
  1333
  1334	001277'			SNOOPU::
  1335	001277'	336000	000000*		SKIPN HFDBUF	;ANY SNOOP BUFFER EXIST?
  1336	001300'	263040	000000		POPJ P,		;NO, FRETURN AC UNCHANGED
  1337					IFCPU (KI),<
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 15-2
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1338					CONO CLK2,CLKSTP+TM2CHN
  1339					CONI CLK2,T2
  1340					JUMPE T2,CPOPJ	;DOESNT EXIST,GIVE AC UNCHANGED FRETURN
  1341					>; END IFCPU (KI)
  1342	001301'	200342	000000*		MOVE T2,JBTLIC(J)
  1343	001302'	641340	600000		TLC T2,LICWCR!LICSPY
  1344	001303'	643340	600000		TLCE T2,LICWCR!LICSPY
  1345	001304'	254000	001262'		 JRST SNOONL
  1346	001305'	554340	000006		HLRZ T2,T1	;T2/FUNC CODE
  1347	001306'	307340	000002		CAIG T2,HFFMAX
  1348	001307'	305340	000000		CAIGE T2,HFFMIN
  1349	001310'	254000	001263'		JRST SNOOBF
  1350	001311'	256007	001274'		XCT SNDSP(T2)
  1351
  1352
  1353
  1354	001312'	550300	001115'	SNZAP:	HRRZ T1,HFSTS
  1355	001313'	402000	001122'		SETZM HFUPTM	;NO MORE BEGINNING TIME
  1356	001314'	402000	001123'		SETZM HFDSIZ	;OR DATA
  1357	001315'	306300	000002		CAIN T1,HFRUN	;IF RUNNING,
  1358	001316'	260040	001467'		PUSHJ P,SNNMI	;NO MORE INTERRUPTS
  1359	001317'	201300	000000		MOVEI T1,HFZAPD
  1360	001320'	542300	001115'		HRRM T1,HFSTS
  1361	001321'	254000	000000*		JRST CPOPJ1
  1362
  1363				;STOP SAMPLING. LEAVE DATA INTACT FOR LATER READING
  1364
  1365	001322'			SNSTOP:
  1366	001322'	550300	001115'		HRRZ T1,HFSTS
  1367	001323'	306300	000000		CAIN T1,HFZAPD	;IF ZAPPED ALREADY,
  1368	001324'	254000	001321*		JRST CPOPJ1	;DO NOTHING, BUT SKIP RTN
  1369	001325'	306300	000002		CAIN T1,HFRUN	;IF RUNNING
  1370	001326'	260040	001467'		PUSHJ P,SNNMI	;NO MORE INTERRUPTS
  1371	001327'	201300	000001		MOVEI T1,HFSTOP
  1372	001330'	542300	001115'		HRRM T1,HFSTS
  1373	001331'	254000	001324*		JRST CPOPJ1
  1374
  1375				; START A RUN. T1/FUNC,,ADDR
  1376				;CLEAR EVERYTHING OUT. GET ARGS & CHECK, SET UP TIMING TABLES,
  1377				;MODIFY INTERRUPT-CODE INSTRUCTIONS, HOOK UP TO INTERRUPT SERVICE,
  1378				;& LET NEXT INTERRUPT START SAMPLING.
  1379
  1380	001332'			SNGO:
  1381	001332'	550340	001115'		HRRZ T2,HFSTS
  1382	001333'	306340	000002		CAIN T2,HFRUN
  1383	001334'	254000	001264'		 JRST SNOOAR	;ALREADY RUNNING, KEEP FROM MISTAKENLY WIPING OUT
  1384	001335'	550340	001277*		HRRZ T2,HFDBUF		;BEG ADDR SNOOP BUFF
  1385	001336'	554400	001335*		HLRZ T3,HFDBUF		;SIZE
  1386	001337'	271407	777777		ADDI T3,-1(T2)		;T3/LAST WRD OF BUFF
  1387	001340'	507000	000007		HRLS T2			;T2/BEG,,BEG
  1388	001341'	271340	000001		ADDI T2,1		;T2/BEG,,BEG+1
  1389	001342'	402007	777777		SETZM -1(T2)
  1390	001343'	251350	000000		BLT T2,(T3)		;ZERO ENTIRE SNOOP BUFFER
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 15-3
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1391	001344'	200340	003244'		MOVE T2,[HFCNTB,,HFCNTB+1]
  1392	001345'	402000	001243'		SETZM HFCNTB
  1393	001346'	251340	001260'		BLT T2,HFCNTB+HFCTGL-1	;CONTIG BLK OF COUNTERS CLEAR
  1394	001347'	200340	003245'		MOVE T2,[SINTB,,SINTB+1] ;SWPPER PERFORMANCE HISTO SCHED1
  1395	001350'	402000	000000*		SETZM SINTB	;CLEAR TO REFLECT CURRENT
  1396	001351'	251340	000000*		BLT T2,SINTB+SINTBS-1		;PERFORMANCE & LOAD
  1397
  1398	001352'	256200	003246'		UMOVE T2,ARGPI(T1)	;PI & UUO LEVEL INCLUDE MASK
  1399	001353'	502340	001115'		HLLM T2,HFPIMK	;SAVE INCASE ANYBODY INQUIRES LATER
  1400	001354'	554400	000007		HLRZ T3,T2
  1401	001355'	620400	777776		TRZ T3,-1-HFUSNP	;ISOLATE PC MODE BIT
  1402	001356'	202400	001242'		MOVEM T3,HFMODE	;SAVE MODE
  1403	001357'	205400	777770		MOVSI T3,-10
  1404	001360'	331000	000007	SNGO1:	SKIPL T2		;THIS BIT ON?
  1405	001361'	634440	000011		TDZA T4,T4		;NO,LEVEL FLAG_0
  1406	001362'	201440	000001		MOVEI T4,1		;YES,LEVEL FLAG_1
  1407	001363'	202450	001232'		MOVEM T4,HFPITB(T3)
  1408	001364'	242340	000001		LSH T2,1
  1409	001365'	253400	001360'		AOBJN T3,SNGO1
  1410
  1411	001366'	256200	003247'		UHRRZ T2,ARGLOW(T1)
  1412	001367'	256200	003250'		UHRRZ T3,ARGHI(T1)
  1413	001370'	317400	000007		CAMG T3,T2
  1414	001371'	254000	001266'		 JRST SNOOBR		;ADDRESS RANGE BAD
  1415	001372'	202400	001117'		MOVEM T3,HFHI
  1416	001373'	202340	001116'		MOVEM T2,HFLOW
  1417	001374'	274400	000007		SUB T3,T2		;T3/HIGH-LOW
  1418
  1419	001375'	256200	003251'		UMOVE T4,ARGRES(T1)	;LSH CTR, 0 TO 18.
  1420	001376'	321440	001265'		JUMPL T4,SNOOBL
  1421	001377'	303440	000022		CAILE T4,^D18
  1422	001400'	254000	001265'		JRST SNOOBL
  1423	001401'	213000	000011		MOVNS T4
  1424	001402'	240411	000000		ASH T3,(T4)		;(HIGH-LOW)/2**RESOLUTION =
  1425								;NO. BUCKETS IN PROPOSED HISTOGRAM
  1426	001403'	554340	001336*		HLRZ T2,HFDBUF		;SIZE SNOOP BUFF=MAX NO. BUCKETS
  1427	001404'	313400	000007		CAMLE T3,T2
  1428	001405'	254000	001266'		 JRST SNOOBR		;HIST WOULD BE LARGER THAN BUFFER
  1429	001406'	202400	001123'		MOVEM T3,HFDSIZ
  1430				;************************************************
  1431	001407'	542440	001555'		HRRM T4,HFLSHC		;MODIFY INTERRUPT LSH INSTR
  1432				;************************************************
  1433	001410'	256200	003252'		UHLRZ T2,ARGJOB(T1)
  1434	001411'	303340	777777*		CAILE T2,JOBN##-1	;LEGIT NUMBER?
  1435	001412'	254000	001270'		JRST SNOOBJ		;NO,LET HIM KNOW
  1436	001413'	336000	000007		SKIPN T2		;DOES HE WANT TO SELECT BY JOB?
  1437	001414'	334340	003253'		SKIPA T2,[JRST HFCSPT]	;NO,JRST WILL DISABLE TEST
  1438	001415'	505340	302300		HRLI T2,(CAIE T1,)	;YES,CAIE T1,<JOBNO> ENABLES
  1439				;************************
  1440	001416'	202340	001543'		MOVEM T2,HFJOB		;MODIFY INT CODE
  1441				;************************
  1442
  1443	001417'	256200	003254'		UMOVE T2,ARGCSP(T1)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 15-4
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1444	001420'	202340	001121'		MOVEM T2,HFCSPN		;CUSP-NAME TO SELECT
  1445	001421'	336000	000007		SKIPN T2		;DO WE WANT TO SELECT BY CUSP?
  1446	001422'	334340	003255'		SKIPA T2,[JRST HFHIST]	;NO,JRST DISABLES
  1447	001423'	200340	003256'		MOVE T2,[MOVE T1,JBTNAM(T1)]  ;YES,MOVE ENABLES
  1448				;********************************
  1449	001424'	202340	001545'		MOVEM T2,HFCSPT		;MODIFY INT CODE
  1450				;*************************************
  1451
  1452	001425'	550340	001403*		HRRZ T2,HFDBUF		;BUFFER BEG ADDR
  1453				;***********************************
  1454	001426'	542340	001557'		HRRM T2,HFGHT		;MODIFY INT CODE; GOOD HIST COUNT INSTR
  1455				;*****************************************
  1456
  1457	001427'	256200	003257'		UHRRZ T1,ARGSIC(T1)	;SAMPLING-INTERVAL CODE
  1458	001430'	205400	777774		MOVSI T3,-LSICTB
  1459	001431'	550350	001111'	SNGO2:	HRRZ T2,SICTB(T3)	;COMPARE PROFFERED CODE AGAINST ITEMS
  1460	001432'	312300	000007		CAME T1,T2		;IN SIC TABLE. MUST MATCH ONE
  1461	001433'	253400	001431'		AOBJN T3,SNGO2
  1462	001434'	325400	001267'		JUMPGE T3,SNOOBI	;IF AOBJN RAN OUT, DIDNT MATCH ANY
  1463	001435'	554410	001111'		HLRZ T3,SICTB(T3)	;T3 POINTS AT XWD COUNT,LEAP-COUNT
  1464	001436'	200410	000000		MOVE T3,(T3)
  1465	001437'	202300	001120'		MOVEM T1,HFSFC
  1466	001440'	202300	001125'		MOVEM T1,SNITMX		;CIRCULATING POINTER RESET VALUE
  1467	001441'	202300	001124'		MOVEM T1,SNITPT		;CIRC POINTER
  1468
  1469	001442'	200440	003260'		MOVE T4,[HFITTB+1,,HFITTB+2]	;CLEAR TIMER TABLE
  1470	001443'	402000	001127'		SETZM HFITTB+1
  1471	001444'	251440	001225'		BLT T4,HFITTB+LHFITTB-1
  1472				  IFCPU (KI),<
  1473					HRRZM T3,HFITTB+0	;LEAP-TICK COUNT ALONE IN TABLE
  1474					>
  1475				  IFCPU (<KL>),<
  1476	001445'	434400	003261'		IOR T3,[TO.SIT+TO.CTD,,TO.SIT+TO.CTD] ;TIMER CONTROL BITS
  1477	001446'	552400	001126'		HRRZM T3,HFITTB+0	;LEAP-TICK COUNT 1ST IN TABLE
  1478	001447'	200300	001125'		MOVE T1,SNITMX		;FROM SNITMX-1 TO 1 FILL TABLE WITH
  1479	001450'	275300	000001		SUBI T1,1
  1480	001451'	556406	001126'	SNGO3:	HLRZM T3,HFITTB(T1)	;0,,NORMAL COUNT+BITS
  1481	001452'	367300	001451'		SOJG T1,SNGO3		;QUIT AFTER STORING HFITTB+1
  1482					> ;END IFCPU (<KL,F3>)
  1483
  1484				IFCPU (KS),<
  1485					HRRZM	T3,HFITTB+0	;LEAP TICK COUNT 1ST IN TABLE
  1486					MOVE	T1,SNITMX	;FROM SNITMX-1 TO 1 FILL TABLE
  1487					SUBI	T1,1		;WITH
  1488				SNGO3:	HLRZM	T3,HFITTB(T1)	;0,,NORMAL COUNT
  1489					SOJG	T1,SNGO3
  1490				>;END IFCPU (KS)
  1491				;NOW HOOK UP TO INTERRUPT SOURCE & RETURN CHEERING
  1492
  1493	001453'	260040	001463'		PUSHJ P,SNSTI	;SNOOP,START INTERRUPTS
  1494	001454'	200300	000211*		MOVE T1,TIME
  1495	001455'	230300	000000*		IDIV T1,JFYSEC
  1496	001456'	504300	000000*		HRL T1,THSDAT
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 15-5
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1497	001457'	202300	001122'		MOVEM T1,HFUPTM	;<DAYS64>,,SECONDS SINCE MIDNITE
  1498	001460'	201300	000002		MOVEI T1,HFRUN
  1499	001461'	542300	001115'		HRRM T1,HFSTS
  1500	001462'	254000	001331*		JRST CPOPJ1
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 16
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1501
  1502				COMMENT ! SNSTI
  1503				FUNCTION: START SNOOP INTERRUPTS.  FOR KL10, POINT THE
  1504					INTERVAL-TIMER AT SNOOPI.  FOR KI10, PUT SNOOPI IN
  1505					THE TM2CHL CHAIN, AT HEAD. TM2CHL IS ASSUMED TO BE
  1506					CHANNEL 1 BY SNOOP CODE.
  1507				CLOBBERS: T1
  1508				!
  1509
  1510				IFCPU (<KL>),<
  1511	001463'	200300	003262'	SNSTI:	MOVE T1,[JSR SNOOPI]
  1512	001464'	250300	000514*		EXCH T1,EPT+EPTITI
  1513	001465'	202300	001230'		MOVEM T1,SNSJSR
  1514	001466'	263040	000000		POPJ P,
  1515				>
  1516
  1517				IFCPU (KS),<
  1518				SNSTI:	MOVE	T1,[JRST SNOOPI]
  1519					EXCH	T1,APRTIM	;SPLICE SNOOPI INTO APRINT CODE
  1520					MOVEM	T1,SNSJSR	;SAVE ORIGINAL INS. (TO BE RESTORED
  1521					POPJ	P,		;WHEN SNOOPI UNSPLICED)
  1522				>;END IFCPU (KS)
  1523
  1524				IFCPU (KI),<
  1525				SNSTI:	MOVE T1,[JRST SNOOPI]
  1526					WRPI	LI.PIF
  1527					EXCH T1,TM2CHL+1
  1528					MOVEM T1,SNOOPI+1	;THE JRST BEHIND THE CONSO/CONSZ
  1529					WRPI	LI.PIN
  1530					DATAO CLK2,HFITTB+0	;THE INTERVAL
  1531					CONO CLK2,CLKON+CLKCDN+CLKCOV+CLKCUT+TM2CHN
  1532					POPJ P,      >
  1533				IFCPU (F3),<SNSTI:	POPJ	P,>
  1534
  1535				COMMENT ! SNNMI -- SNOOP, NO MORE INTERRUPTS
  1536				FUNCTION:
  1537					KL10:
  1538					KS10: SET SNOOJB FLAG FOR SNOOPI INTERRUPT CODE TO
  1539					STOP; SLEEP FOR 1 SECOND (MORE THAN ENUF TIME FOR
  1540					THE CURRENT "TICK" TO COMPLETE) THEN RETURN. SNOOPI
  1541					WILL REPLACE THE JSR TO ITSELF WITH THE ORIGINAL
  1542					INTERVAL-TIMER INTERRUPT INSTRUCTION.
  1543
  1544					KI10:  TAKE SNOOPI OFF TM2CHL CHAIN.
  1545				!
  1546
  1547				IFCPU (KI),<
  1548				SNNMI:	WRPI	LI.PIF
  1549					CONO CLK2,CLKSTP+CLKCLR
  1550					MOVE T1,SNOOPI+1	;JRST BEHIND THE CONSO/CONSZ
  1551					MOVEM T1,TM2CHL+1
  1552					WRPI	LI.PIN
  1553					POPJ P,
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 16-2
PICON.MAC	30-OCT-87 17:26		START/STOP CALLI MONITOR HISTOGRAM SNOOP FACILITY

  1554				>;END IFCPU (KI)
  1555
  1556				IFCPU (<KL>),<
  1557	001467'	336000	001230'	SNNMI:	SKIPN	SNSJSR	;EVER SAVED A JSR?
  1558	001470'	263040	000000		POPJ	P,	;NO, NOTHING TO DO
  1559	001471'	562100	001231'		HRROM	J,SNOOJB;FLAG SNOOPI TO STOP AT END OF "TICK"
  1560	001472'	201300	000001		MOVEI	T1,1	;A SHORT NAP
  1561	001473'	047300	000031		CALLI	T1,+31	;SLEEP T1,
  1562	001474'	263040	000000		POPJ	P,	;IN 1 SEC SNOOPI WILL SURELY HAVE STOPPED
  1563				>;END IFCPU (KL)
  1564
  1565				IFCPU (KS),<
  1566				SNNMI:	SKIPN	SNSJSR	;EVER SAVED A JSR?
  1567					POPJ	P,	;NO, NOTHING TO DO
  1568					HRROM	J,SNOOJB;FLAG SNOOPI TO STOP AT END OF "TICK"
  1569					MOVEI	T1,1	;A SHORT NAP
  1570					CALLI	T1,+31	;SLEEP T1,
  1571					POPJ	P,	;IN 1 SEC SNOOPI WILL SURELY HAVE STOPPED
  1572				>;END IFCPU (KS)
  1573
  1574				IFCPU (F3),<IF2,<PRINTX [SNNMI: SNOOP has not been written for FOONLY]>
  1575				SNNMI:	POPJ	P,>
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 17
PICON.MAC	30-OCT-87 17:26		SNOOP FACILITY INTERRUPT CODE

  1576				SUBTTL SNOOP FACILITY INTERRUPT CODE
  1577
  1578				IFCPU (<KL>), <
  1579
  1580				COMMENT !
  1581				THIS INTERRUPT ROUTINE GETS RUN INSTEAD OF ITMINT. THE JSR
  1582				IN THE EPT GETS ROUTED DIRECTLY HERE.  DEPENDING ON SNOOP
  1583				INTERVAL, THIS ROUTINE IS ENTERED 8,16,32 OR 64
  1584				TIMES PER "TICK"; EVERY 8TH (16TH,32ND OR 64TH) SNOOP INTERRUPT
  1585				DOES THE ITMINT CHORES AND ADJUSTS FOR "LEAP TICKS".
  1586
  1587				USES AND RESTORES: T1,T2
  1588				!
  1589
  1590	001475'	000000	000000	SNOOPI::  0	;JSR DIRECTLY HERE FROM EPT
  1591	001476'	702300	010000		CONSZ TIM,TI.TOV
  1592	001477'	256000	000177'		 STOPCD (,XCT,APRTIM)
  1593					;APR timer overflowed
  1594	001500'	124300	001226'		DMOVEM T1,SAVT12
  1595	001501'	373300	001124'		SOSLE T1,SNITPT		;PTR CIRCULATES "BACKWARDS"
  1596	001502'	254000	001522'		JRST SNOOP1		;NO WRAPAROUND YET
  1597	001503'	200300	001125'		MOVE T1,SNITMX		;MAX VALUE
  1598	001504'	202300	001124'		MOVEM T1,SNITPT		;READY FOR SOSLE NEXT TIME
  1599
  1600				;CHORES FROM ITMINT
  1601	001505'	256000	000206'		XCT CRSCHK	;MAY NOT BE SKIPE 30 IF STAND-ALONE
  1602	001506'	264000	000222'		 JSR CRASH1
  1603	001507'	265300	000210*		JSP T1,UPDKEY##	;Update the key if necessary
  1604	001510'	350000	001454*		AOS TIME
  1605	001511'	350000	000212*		AOS UPTIME
  1606	001512'	476000	000213*		SETOM TIMEF
  1607	001513'	476000	000214*		SETOM CLKFLG
  1608	001514'	700600	000215*		WRPI	REQCLK
  1609	001515'	335000	001231'		SKIPGE SNOOJB		;.LT.0 IF SNOOPI SHOULD STOP ITSELF
  1610					 JRST	[MOVE T1,SNSJSR	;ORIGINAL JSR
  1611						MOVEM T1,EPT+EPTITI ;SNOOPI NO LONGER RUNS
  1612						HRRZS SNOOJB	;LH/0 RESETS FLAG RH/JOB FOR DEBUG
  1613						AOSLE T1,ITMPTR	;ITMINT CHORE..FIGURE OUT LENGTH OF
  1614						SETCMB T1,ITMPTR;NEXT "SUBTICK"
  1615						CONO TIM,@ITMTBL(T1); SET INTERVAL TIMER
  1616	001516'	254000	003263'			JRST SNOOX]	;RESTORE T1,T2 & EXIT
  1617				;NOW LEAP-TICK CHECK
  1618	001517'	353300	000255'		AOSLE T1,ITMPTR		;TRIAD -2,-1,0 COUNTER
  1619					JRST [	SETCMB T1,ITMPTR
  1620						MOVE T1,HFITTB+0
  1621						CONO TIM,-1(T1);LEAP TICK SMALLER BY 1 COUNT
  1622	001520'	254000	003272'			JRST SNOOP2]
  1623	001521'	201300	000000		MOVEI T1,0
  1624				;NORMAL SUBTICK ALREADY SET UP IN HFITTB
  1625	001522'	702226	001126'	SNOOP1:	CONO TIM,@HFITTB(T1)	;EFFECTIVE ADDR SETS UP TIMER
  1626	001523'	200300	001475'	SNOOP2:	MOVE T1,SNOOPI
  1627	001524'	202300	000306*		MOVEM T1,APRCHL		;KEEP OTHER PEOPLE HAPPY
  1628				> ; END IFCPU (KL), FALL THRU TO SNOOP CODE PROPER
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 17-2
PICON.MAC	30-OCT-87 17:26		SNOOP FACILITY INTERRUPT CODE

  1629
  1630
  1631				IFCPU (KS),<
  1632				
  1633				COMMENT !
  1634				THIS INTERRUPT CODE GETS "SPLICED INTO" APR TIMER PROCESSING BY SNSTI.
  1635				COME HERE FROM APRTIM AND EXIT BACK TO APREXT.
  1636				DEPENDING ON THE SNOOP INTERVAL SNOOPI RUNS 8 OR 16 TIMES PER
  1637				"TICK"; EVERY 8TH (16TH) SNOOP INTERRUPT DOES THE TIMER CHORES AND
  1638				ADJUSTS FOR "LEAP TICKS".
  1639				
  1640				USES AND RESTORES: T1,T2
  1641				!
  1642				SNOOPI:: DMOVEM T1,SAVT12
  1643					SOSLE T1,SNITPT		;PTR CIRCULATES "BACKWARDS"
  1644					JRST SNOOP1		;NO WRAPAROUND YET
  1645					MOVE T1,SNITMX		;MAX VALUE
  1646					MOVEM T1,SNITPT		;READY FOR SOSLE NEXT TIME
  1647				
  1648				;CHORES FROM APR TIMER CODE
  1649					XCT CRSCHK	;MAY NOT BE SKIPE 30 IF STAND-ALONE
  1650					 JSR CRASH1
  1651					JSP T1,UPDKEY##	;Update the key if necessary
  1652					AOS TIME
  1653					AOS UPTIME
  1654					SETOM TIMEF
  1655					SETOM CLKFLG
  1656					WRPI	REQCLK
  1657					SKIPGE SNOOJB		;.LT.0 IF SNOOPI SHOULD STOP ITSELF
  1658					 JRST	[MOVE T1,SNSJSR	;ORIGINAL JSR
  1659						MOVEM T1,APRTIM  ;SNOOPI NO LONGER RUNS
  1660						HRRZS SNOOJB	;LH/0 RESETS FLAG RH/JOB FOR DEBUG
  1661						AOSLE T1,ITMPTR	;ITMINT CHORE..FIGURE OUT LENGTH OF
  1662						SETCMB T1,ITMPTR;NEXT "SUBTICK"
  1663						WRINT ITMTBL(T1)
  1664						WRAPR LP.CSF+LP.ITD+APRCHN## ;clr timer done flag
  1665						JRST SNOOX]	;RESTORE T1,T2 & EXIT
  1666				;NOW LEAP-TICK CHECK
  1667					AOSLE T1,ITMPTR		;TRIAD -2,-1,0 COUNTER
  1668					JRST [	SETCMB T1,ITMPTR
  1669						MOVE T1,HFITTB+0
  1670						SUBI	T1,1	;LEAP TICK SMALLER BY 1 COUNT
  1671						JRST SNOOP2]
  1672					MOVEI T1,0
  1673				;NORMAL SUBTICK ALREADY SET UP IN HFITTB
  1674				SNOOP1:	MOVE	T1,HFITTB(T1)	;EFFECTIVE ADDR SETS UP TIMER
  1675				SNOOP2:	LSH	T1,^D12		;POSITION INTERVAL FOR TIMER
  1676					WRINT	T1
  1677					WRAPR	LP.CSF+LP.ITD+APRCHN##	;CLEAR THE TIMER DONE FLAG
  1678					MOVE T1,APRCHL		;FOR SNOOP CODE PROPER SEE BELOW
  1679				>; END IFCPU (KS)
  1680				IFCPU (KI),<
  1681				
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 17-3
PICON.MAC	30-OCT-87 17:26		SNOOP FACILITY INTERRUPT CODE

  1682				COMMENT !
  1683				SECOND DK10 (CLK2) GETS PUT ON HEAD OF CHANNEL 1 CHAIN. DEPENDING
  1684				ON SNOOP INTERVAL, THIS ROUTINE GETS RUN 8,16,32 OR 64 TIMES FOR
  1685				EACH INTERRUPT GENERATED BY THE APR LINE-FREQUENCY CLOCK .
  1686				ACTUALLY, IT IS NOT EXACTLY 8,16 ETC.  WHEN THIS DK10 IS FIRED UP,
  1687				ITS INTERVAL IS SET TO 23.,54.,ETC.; WITHOUT "LEAP" COUNTS, THESE
  1688				INTERVALS CAUSE CLK2 TO GET "BEHIND" THE LINE-FREQUENCY
  1689				CLOCK, WHICH DOESNT MATTER FOR SAMPLING PURPOSES.
  1690				(ALL TIMING IS TAKEN CARE OF BY LINE-FREQUENCY INTERRUPTS
  1691				AND THE FIRST DK10, BOTH ALSO ON THIS CHANNEL AT THE MOMENT).
  1692				
  1693				THIS DK10 IS RUN WITH "USER TIME" OFF--ALL MONITOR-MODE TIME
  1694				INCLUDING INTERRUPT-SERVICE TIME IS COUNTED.
  1695				
  1696				USES AND RESTORES: T1,T2
  1697				!
  1698				
  1699				SNOOPI::
  1700					CONSO CLK2,CLKCDN+CLKCOV
  1701					<JRST .-.>		;INTERRUPT CHAIN, MODIFIED INSTR
  1702					DMOVEM T1,SAVT12
  1703				SNOOP1:
  1704				SNOOP2:	MOVE T1,TM2CHL		;GET PC OF INTERRUPT & FALL THRU
  1705								;TO SNOOP CODE PROPER
  1706				> ; END IFCPU (KI)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 18
PICON.MAC	30-OCT-87 17:26		SNOOP FACILITY INTERRUPT CODE

  1707				;SNOOP CODE PROPER	T1/PC OF INTERRUPT
  1708
  1709	001525'	350000	001243'		AOS TOTCNT	
  1710	001526'	603300	010000		TLNE T1,PC.USR
  1711					 JRST [ SKIPN T1,JOB
  1712						AOSA NULCNT
  1713						AOS USRCNT
  1714						SKIPN HFMODE	;HIST USER PC?
  1715						JRST SNOOX	;NO
  1716	001527'	254000	003276'			JRST HFJOB]	;YES
  1717	001530'	350000	001250'		AOS SYSCNT
  1718	001531'	700640	000006		RDPI	T1	;GET ACTIVE PI CHANNELS
  1719	001532'	405300	037400		ANDI T1,037400	;IGNORE TM2CHL
  1720	001533'	243300	001535'		JFFO T1,.+2	;T2_20+HIGHEST ACTIVE PI #, OR 0
  1721	001534'	201340	000024		MOVEI T2,^D20	;NONE ACTIVE
  1722	001535'	350007	001225'		AOS PICNT-^D20(T2)
  1723	001536'	336007	001206'		SKIPN HFPITB-^D20(T2)	;DO WE INCLUDE COUNTS AT THIS LEVEL?
  1724	001537'	254000	001561'		 JRST SNOOX		;NO
  1725	001540'	332000	001242'		SKIPE HFMODE	;HIST SYS PC?
  1726	001541'	254000	001561'		JRST SNOOX	;NO
  1727	001542'	200300	000561*		MOVE T1,JOB
  1728	001543'	302300	000000	HFJOB:	<CAIE T1,.-.>	;RH_JOB # OF INTEREST, OR INSTRUCTION_SKIPA
  1729	001544'	254000	001561'		JRST SNOOX	;WRONG JOB,NOT INTERESTED
  1730	001545'	200306	000000*	HFCSPT:	<MOVE T1,JBTNAM(T1)>	;OR JRST HFHIST IF NO CUSP TEST
  1731	001546'	312300	001121'		CAME T1,HFCSPN
  1732	001547'	254000	001561'		 JRST SNOOX	;WRONG PROGRAM RUNNING, NOT INTERESTED
  1733	001550'			HFHIST:
  1734	001550'	550300	001475'	  IFCPU (<KL>),< HRRZ T1,SNOOPI>
  1735				  IFCPU (KI),< HRRZ T1,TM2CHL>
  1736				IFCPU (KS),< HRRZ	T1,APRCHL>
  1737	001551'	317300	001117'		CAMG T1,HFHI	;IN-RANGE CHECK
  1738	001552'	315300	001116'		CAMGE T1,HFLOW	;BOTH ARE MONITOR ADDRESSES
  1739	001553'	254000	001560'		JRST HFOOR	;OUTA RANGE
  1740	001554'	274300	001116'		SUB T1,HFLOW	;KONVERT TO HISTOGRAM BUFF INDEX
  1741	001555'	242300	000000	HFLSHC:	<LSH T1,.-.>	;RH_NEG LSH COUNT, OR INSTR_JFCL
  1742							;THIS INSTR IMPLEMENTS ADDRESS RESOLUTION DOWN
  1743							;TO 2^0 = 1-WORD INCREMENTS
  1744	001556'	350000	001244'		AOS HISTOT	;COUNTERPART OF OORCNT
  1745	001557'	354006	000000	HFGHT:	<AOSA .-.(T1)>	;GOOD HISTOG COUNT. INSTR MODIFIED TO
  1746							;PT AT BEG OF SNOOP BUFF ALLOCATED AT ONCE-TIME
  1747							;NO BOUNDS-CHECKING AT INT LEVEL--DONE
  1748							;WHEN HFHI,HFLOW,HFLSHC SET UP AT UUO LEVEL
  1749	001560'	350000	001246'	HFOOR:	AOS OORCNT	;OUT-OF-RANGE (IN MONITOR) COUNT
  1750
  1751				; SNOOP INTERRUPT EXIT
  1752
  1753	001561'	120300	001226'	SNOOX:	DMOVE T1,SAVT12
  1754	001562'	254520	001475'		IFCPU (<KL>), <JEN @SNOOPI>
  1755					IFCPU (KI), <CONO CLK2,CLKCDN+CLKCOV+CLKON+CLKCUT+TM2CHN
  1756						JEN @TM2CHL >
  1757					IFCPU (KS),<JRST APREXT>	;JRST TO JEN @APRCHL
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 19
PICON.MAC	30-OCT-87 17:26		READ-HISTOGRAM CALLI  MONITOR-HISTOGRAM SNOOP FACILITY

  1758				SUBTTL READ-HISTOGRAM CALLI  MONITOR-HISTOGRAM SNOOP FACILITY
  1759
  1760				COMMENT ! RDHIST
  1761				FUNCTION: RETURN HISTOGRAM COUNTERS AND STATE INFO TO RC-LICENSED
  1762					USER, SUSPENDING SAMPLING WHILE DOING SO.
  1763				USER CALL:	MOVE AC,[-COUNT,,ADDR]
  1764						CALLI AC,-117
  1765						 ERROR, AC/CODE
  1766						SUCCESS AC UNCHANGED, ADDR WRITTEN ON FOR COUNT WDS
  1767				ERROR AC: UNCHANGED-- UUO NOT IMPLEMENTED OR HARDWARE NOT PRESENT
  1768					AC/1  MISSING RC LICENSE
  1769					AC/2  ZAPPED STATE-- NO HIST TO READ
  1770					AC/3  <ROOM>,,3  --COUNT WAS TOO SMALL TO RETURN ALL DATA,
  1771							<ROOM> IS SIZE NEEDED. SOME DATA RETURNED,
  1772							UP TO LIMIT IMPOSED BY COUNT.
  1773
  1774				ADDR: PI-INCLUDED MASK,,<SNOOP FACILITY STATE CODE>
  1775				+1	LOW MONITOR ADDR
  1776				+2	HIGH MONITOR ADDR
  1777				+3	RESOLUTION (AS A LSH COUNT .LE. 0)
  1778				+4	<JOB OR 0>,,<DATAVERSION><INTERVAL> <INTERVAL>=10,20,40 OR 100
  1779							;<DATAVERSION>=INDEX OF HISTOGRAM[0] IN
  1780							;RETURNED DATA BLOCK..TO KEEP SNOOPY IN
  1781							;SYNCH W/MONITOR.
  1782				+5	<CUSP> OR 0	;<CUSP>=SIXBIT NAME BEING SELECTED
  1783				+6	UPTIME 		;WHEN SAMPLING BEGAN
  1784				+7	TOTCNT
  1785				+10	HISTOT
  1786				+11	USRCNT
  1787				+12	OORCNT		;OUT-OF-RANGE COUNT
  1788				+13	NULCNT  	;NULJOB COUNTS
  1789				+14	SYSCNT
  1790				+15	PICNT[0]	;COUNTS TAKEN FROM UUO LEVEL
  1791				+16	PICNT[1]=0	;PI LEVEL 1 IGNORED (SAMPLING LEVEL)
  1792				+17	PICNT[2]	;LEVEL 2 COUNTS
  1793				.
  1794				.
  1795				+24	PICNT[7]	;LEVEL 7 COUNTS
  1796				+25	SINTB[0]	;SWAPPER PERFORMANCE HISTO,CELL 0
  1797				.
  1798				.
  1799				+36	SINTB[9]	;(CURRENT)END SWAPPER HISTO
  1800				+37	HISTOGRAM[0]	;COUNTS IN 0TH CELL OF HISTOGRAM
  1801				.
  1802				. AS MUCH MORE AS COUNT ALLOWS
  1803
  1804
  1805				CALL:	JRST HERE FROM UUOCON DISPATCH
  1806				EXPECTS: T1/ -COUNT,,ADDR
  1807					M/ USER AC#
  1808					J/JOB
  1809				!
  1810
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 19-2
PICON.MAC	30-OCT-87 17:26		READ-HISTOGRAM CALLI  MONITOR-HISTOGRAM SNOOP FACILITY

  1811			000037	DATVER==37	;KEEP UPDATING THIS AS INTERESTING ITEMS ARE ADDED
  1812						;TO "PROLOGUE" DATA BLOCK BEFORE REAL HISTOGRAM DATA
  1813						;BEGINS. THIS SHOULD EQUAL INDEX OF HISTOG[0]
  1814
  1815
  1816					ERRCOD(1,RDHNL%,RHNLIC)	;NO LICENSE (RC)
  1817					ERRCOD(2,RDHZP%,RHZAPD)	;ZAPPED, NONE TO READ
  1818					ERRCOD(3,RDHNR%,ZZ)	;INSUFFICIENT ROOM (SPECIAL HANDLING)
  1819
  1820
  1821	001563'			RDHIST::
  1822	001563'	336000	001425*		SKIPN HFDBUF	;ANY SNOOP BUFFER EXIST?
  1823	001564'	263040	000000		POPJ P,		;NO, FRETURN AC UNCHANGED
  1824					IFCPU (KI),<
  1825					CONO CLK2,CLKSTP+TM2CHN
  1826					CONI CLK2,T2
  1827					JUMPE T2,CPOPJ	;DOESNT EXIST,GIVE AC UNCHANGED FRETURN
  1828					>; END IFCPU (KI)
  1829	001565'	205340	200000		MOVSI T2,LICSPY
  1830	001566'	616342	001301*		TDNN T2,JBTLIC(J)
  1831	001567'	254000	001262'		JRST RHNLIC
  1832	001570'	550340	001115'		HRRZ T2,HFSTS
  1833	001571'	306340	000000		CAIN T2,HFZAPD
  1834	001572'	254000	001263'		JRST RHZAPD
  1835	001573'	302340	000002		CAIE T2,HFRUN
  1836	001574'	254000	001600'		JRST RDHS2	;ALREADY STOPPED, NO NEED TO STOP IT WHILE
  1837							;SAMPLING
  1838	001575'	261040	000006		PUSH P,T1	;T1/-COUNT,,ADDR
  1839	001576'	260040	001467'		PUSHJ P,SNNMI	;NO MORE INTERRUPTS
  1840	001577'	262040	000006		POP P,T1
  1841	001600'			RDHS2:	;RETURN A FEW ITEMS FROM SCATTERED LOCATIONS
  1842					;HRRZ T2,HFSTS
  1843					;HLL T2,HFPIMK
  1844	001600'	200340	001115'		MOVE T2,HFSTS
  1845	001601'	252300	001662'		AOBJP T1,RHNORM
  1846	001602'	256200	003304'		UMOVEM T2,-1(T1)
  1847	001603'	200340	001116'		MOVE T2,HFLOW
  1848	001604'	252300	001662'		AOBJP T1,RHNORM
  1849	001605'	256200	003304'		UMOVEM T2,-1(T1)
  1850	001606'	200340	001117'		MOVE T2,HFHI
  1851	001607'	252300	001662'		AOBJP T1,RHNORM
  1852	001610'	256200	003304'		UMOVEM T2,-1(T1)
  1853	001611'	570340	001555'		HRRE T2,HFLSHC	;LSH COUNT .LE. 0
  1854	001612'	252300	001662'		AOBJP T1,RHNORM
  1855	001613'	256200	003304'		UMOVEM T2,-1(T1)
  1856	001614'	200340	001543'		MOVE T2,HFJOB
  1857	001615'	316340	003253'		CAMN T2,[JRST HFCSPT]
  1858	001616'	634340	000007		TDZA T2,T2	;NOT TESTING A JOB, RETURN 0
  1859	001617'	517000	000007		HRLZS T2	;T2/<JOB NO.>,,0
  1860	001620'	540340	001120'		HRR T2,HFSFC	;SAMPLING-FREQUENCY-CODE
  1861	001621'	201400	037000		MOVEI T3,DATVER_^D9
  1862	001622'	434340	000010		IOR T2,T3	;T2/<JOB>,,<DATVER><HFSFC>
  1863	001623'	252300	001662'		AOBJP T1,RHNORM
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 19-3
PICON.MAC	30-OCT-87 17:26		READ-HISTOGRAM CALLI  MONITOR-HISTOGRAM SNOOP FACILITY

  1864	001624'	256200	003304'		UMOVEM T2,-1(T1)
  1865	001625'	200340	001121'		MOVE T2,HFCSPN
  1866	001626'	252300	001662'		AOBJP T1,RHNORM
  1867	001627'	256200	003304'		UMOVEM T2,-1(T1)
  1868	001630'	200340	001122'		MOVE T2,HFUPTM
  1869	001631'	252300	001662'		AOBJP T1,RHNORM
  1870	001632'	256200	003304'		UMOVEM T2,-1(T1)
  1871	001633'			RDHS3:	;RETURN A BUNCH OF ITEMS FROM CONTIGUOUS BLOCK
  1872					;T1/AOBJN LEFT TO GO
  1873	001633'	200400	003305'		MOVE T3,[-HFCTGL,,HFCNTB]
  1874	001634'	200350	000000	RDHS3A:	MOVE T2,(T3)
  1875	001635'	252300	001662'		AOBJP T1,RHNORM
  1876	001636'	256200	003304'		UMOVEM T2,-1(T1)
  1877	001637'	253400	001634'		AOBJN T3,RDHS3A
  1878					;NOW RETURN THE LITTLE SWAPPER PERFORMANCE HISTOGRAM
  1879					;OF PERCENT OF JOBS' MWS'S SWAPPED
  1880	001640'	200400	003306'		MOVE T3,[-SINTBS,,SINTB]
  1881	001641'	200350	000000	RDHS3B:	MOVE T2,(T3)
  1882	001642'	252300	001662'		AOBJP T1,RHNORM
  1883	001643'	256200	003304'		UMOVEM T2,-1(T1)
  1884	001644'	253400	001641'		AOBJN T3,RDHS3B
  1885	001645'			RDHS4:	;TRY TO RETURN HISTO DATA. T1/AOBJN LEFT TO GO
  1886	001645'	201406	777777		movei t3,-1(t1)
  1887	001646'	270400	001123'		ADD T3,HFDSIZ	;T3/END OF DATA IN USER SPACE
  1888	001647'	574340	000006		HLRE T2,T1
  1889	001650'	213000	000007		MOVNS T2
  1890	001651'	315340	001123'		CAMGE T2,HFDSIZ
  1891	001652'	254000	001662'		JRST RHNORM	;AGAIN, NOT ENUF ROOM
  1892	001653'	504300	001563*		HRL T1,HFDBUF	;T1/BEG-OF-BUF,,USER ADDR
  1893	001654'	256200	003307'		XCTTU <BLT T1,(T3)>	;GEEV EET TO HEEM
  1894	001655'	550340	001115'		HRRZ T2,HFSTS
  1895	001656'	350001	000000		AOS (P)		;SUCCESS SKIP RTN
  1896	001657'	306340	000002		CAIN T2,HFRUN	;DO WE NEED TO RESTART SAMPLING?
  1897	001660'	324740	001463'		PJRST SNSTI	;YUP
  1898	001661'	263040	000000		POPJ P,
  1899
  1900	001662'			RHNORM:	;NOT ENOUGH SPACE. SET UP LH OF USER AC WITH <ROOM> NEEDED
  1901	001662'	550300	001123'		HRRZ T1,HFDSIZ
  1902	001663'	271300	000025		ADDI T1,HFCTGL+7
  1903	001664'	517000	000006		HRLZS  T1
  1904	001665'	541300	000003		HRRI T1,RDHNR%	;NO ROOM CODE
  1905	001666'	256200	003310'		UMOVEM T1,(M)
  1906	001667'	550340	001115'		HRRZ T2,HFSTS
  1907	001670'	306340	000002		CAIN T2,HFRUN	;NEED TO RESTART IT?
  1908	001671'	324740	001463'		PJRST SNSTI	;YUP
  1909	001672'	263040	000000		POPJ P,
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 20
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  1910				SUBTTL USER PSEUDO-INTERRUPT ROUTINES
  1911
  1912				;TEST TO SEE IF THE CHANEL IN T1 CAN TAKE A TRAP NOW. SKIP IF SO.
  1913
  1914	001673'	135100	000000*	TSTTRJ::LDB	J,PJOBN##	;SET UP J (F IS ALREADY SET UP)
  1915	001674'	322300	001107*	TSTTRP::JUMPE	T1,CPOPJ	;NO CHANNEL
  1916	001675'	200306	001711'		MOVE	T1,TRPBTS(T1)	;GET THE BIT CONVERSION
  1917	001676'	335002	000000*		SKIPGE	JBTENB(J)	;ARE TRAPS ENABLED?
  1918	001677'	317302	000000*		CAMG	T1,JBTPIP(J)	;AND NO HIGHER IN PROGRESS?
  1919	001700'	263040	000000		 POPJ	P,		;NO TO ONE OF THOSE, NO TRAP
  1920	001701'	612302	001676*		TDNE	T1,JBTENB(J)	;IS THIS CHANNEL ENABLED?
  1921	001702'	350001	000000		 AOS	(P)		;YES, SKIP
  1922	001703'	263040	000000		POPJ	P,		;NO
  1923
  1924				;  TEST IF TRAP IS ARMED.  T1=CHANNEL NUMBER
  1925
  1926	001704'	322300	001674*	TSTARM::JUMPE	T1,CPOPJ
  1927	001705'	200306	001711'		MOVE	T1,TRPBTS(T1)
  1928	001706'	612302	001701*		TDNE	T1,JBTENB(J)	;Check if channel is enabled
  1929	001707'	350001	000000		 AOS	(P)
  1930	001710'	263040	000000		POPJ	P,
  1931
  1932	001711'	000000	000000	TRPBTS:	0		;NO CHANNEL 0
  1933		200000	000000	XXQ==1B1
  1934					REPEAT ^D35,<XXQ
  1935						XXQ==XXQ_-1>
  1936	001712'	200000	000000
  1937	001713'	100000	000000
  1938	001714'	040000	000000
  1939	001715'	020000	000000
  1940	001716'	010000	000000
  1941	001717'	004000	000000
  1942	001720'	002000	000000
  1943	001721'	001000	000000
  1944	001722'	000400	000000
  1945	001723'	000200	000000
  1946	001724'	000100	000000
  1947	001725'	000040	000000
  1948	001726'	000020	000000
  1949	001727'	000010	000000
  1950	001730'	000004	000000
  1951	001731'	000002	000000
  1952	001732'	000001	000000
  1953	001733'	000000	400000
  1954	001734'	000000	200000
  1955	001735'	000000	100000
  1956	001736'	000000	040000
  1957	001737'	000000	020000
  1958	001740'	000000	010000
  1959	001741'	000000	004000
  1960	001742'	000000	002000
  1961	001743'	000000	001000
  1962	001744'	000000	000400
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 20-2
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  1963	001745'	000000	000200
  1964	001746'	000000	000100
  1965	001747'	000000	000040
  1966	001750'	000000	000020
  1967	001751'	000000	000010
  1968	001752'	000000	000004
  1969	001753'	000000	000002
  1970	001754'	000000	000001
  1971	001755'	400000	000000		1B0		;FOR HIBERNATE REQUESTS
  1972
  1973				;SET THE TRAP WAITING BIT. IF THIS CAUSES A HIGHER CHANNEL AND
  1974				;EVERYTHING IS ENABLED, SET JBTAWQ BIT 0. IF JOB IS SLEEPING
  1975				;OR IN TTY IOW AND WE NOW WANT TO TRAP, GET JOB STARTED
  1976
  1977	001756'	135100	001673*	TAKTRJ::LDB	J,PJOBN##	;SET J FROM DDB F POINTS TO
  1978	001757'	322300	001704*	TAKTRP::JUMPE	T1,CPOPJ
  1979	001760'	335306	001711'		SKIPGE	T1,TRPBTS(T1)	;^D36 (SLEEP) IS ONLY NEGATIVE
  1980	001761'	254000	002027'		 JRST	HIBWAK		;WAITING FOR HIBERNATE, WAKE UP
  1981	001762'	335002	001706*	TAKTR2:	SKIPGE	JBTENB(J)	;INTERRUPTS ENABLED?
  1982	001763'	317302	001677*		CAMG	T1,JBTPIP(J)	;AND HIGHER THAN NOW HAPPENING?
  1983	001764'	254000	001767'		 JRST	TAKTR1		;NO
  1984	001765'	612302	001762*		TDNE	T1,JBTENB(J)	;THIS ONE ENABLED?
  1985	001766'	661300	400000		 TLO	T1,(1B0)	;YES, SET WAITING FOR REQUEST
  1986	001767'	437302	000000*	TAKTR1:	IORB	T1,JBTAWQ(J)
  1987	001770'	325300	001757*		JUMPGE	T1,CPOPJ	;WANT A TRAP NOW?
  1988	001771'	135300	000000*	TAKTR3:	LDB	T1,PJBSTS	;YES, FIND OUT STATUS
  1989	001772'	306300	000000*		CAIN	T1,SLPQ
  1990	001773'	254000	002032'		 JRST	HIBWK1		;SLEEPING
  1991	001774'	306300	000000*		CAIN	T1,TIOWQ	;TTYIOW?
  1992	001775'	254000	000000*		 JRST	TTYWAK		;YES, GET IT OUT
  1993	001776'	306300	000000*		CAIN	T1,ILWQ		;CLUB INTERLOCK WAIT?
  1994	001777'	254000	002033'		 JRST	HIBWK2		;YES.  GO "WAKE UP".
  1995	002000'	263040	000000		POPJ P,			;NONE OF THE ABOVE, LET IT GO FOR NOW
  1996
  1997				;TEST A TRAP TO SEE IF WE CAN TAKE IT NOW. IF SO DO, IF NOT
  1998				;SKIP RETURN
  1999
  2000	002001'	135100	001756*	TSTKTJ::LDB	J,PJOBN##
  2001	002002'	260040	001674'	TSTKTP::PUSHJ	P,TSTTRP
  2002	002003'	254000	001462*		 JRST	CPOPJ1		;CAN NOT TAKE IT NOW
  2003	002004'	254000	001762'		JRST	TAKTR2		;GO, BITS ALREADY IN T1
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 21
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2004				;TAKE A TRAP IF WE CAN. MAY BE OLD STYLE. JUST IN CASE, T2 HAS REASON BITS
  2005
  2006	002005'	135100	002001*	TAKOTJ::LDB	J,PJOBN##
  2007	002006'	322300	001770*	TAKOTP:	JUMPE	T1,CPOPJ
  2008	002007'	335306	001711'	TAKOT1:	SKIPGE	T1,TRPBTS(T1)
  2009	002010'	254000	002027'		 JRST	HIBWAK		;SLEEPING
  2010	002011'	331002	001763*		SKIPL	JBTPIP(J)	;OLD STYLE?
  2011	002012'	254000	001762'		 JRST	TAKTR2		;NO, GO DO IT
  2012	002013'	205300	200000		MOVSI	T1,(1B1)
  2013	002014'	612302	002011*		TDNE	T1,JBTPIP(J)	;ALREADY IN A TRAP?
  2014	002015'	254000	002020'		 JRST	TAKOT2		;YES, JUST SAVE BITS
  2015	002016'	436302	002014*		IORM	T1,JBTPIP(J)	;NO, SET TRAP
  2016	002017'	661340	400000		TLO	T2,(1B0)
  2017	002020'	437342	001767*	TAKOT2:	IORB	T2,JBTAWQ(J)	;SAVE REASON AND REQUEST TRAP
  2018	002021'	321340	001771'		JUMPL	T2,TAKTR3	;DO WE WANT TO TRAP NOW?
  2019	002022'	263040	000000		POPJ	P,		;NO
  2020
  2021				;IF TRAP IS REALLY SET (NON-0) ALWAYS SKIP RETURN
  2022
  2023	002023'	135100	002005*	TAKNZJ::LDB	J,PJOBN##
  2024	002024'	322300	002006*		JUMPE	T1,CPOPJ
  2025	002025'	350001	000000		AOS	(P)
  2026	002026'	254000	002007'		JRST	TAKOT1		;MAY BE OLD
  2027
  2028	002027'	135300	001771*	HIBWAK:	LDB	T1,PJBSTS
  2029	002030'	302300	001772*		CAIE	T1,SLPQ		;IS HE SLEEPING?
  2030	002031'	254000	000000*		 JRST	TTSCLR		;NO, CLEAR SLEEP FLAGS
  2031	002032'	260040	002031*	HIBWK1:	PUSHJ	P,TTSCLR
  2032	002033'	201340	000000*	HIBWK2:	MOVEI	T2,RNQ
  2033	002034'	137340	002027*		DPB	T2,PJBSTS
  2034	002035'	254000	000000*		JRST	SETR2		;START UP JOB
  2035
  2036				EXTERNAL SETR2,TTSCLR,JBTAWQ,JBTPIP,JBTENB
  2037				EXTERNAL CPOPJ,CPOPJ1,PJBSTS,RNQ,SLPQ,TIOWQ,TTYWAK,ILWQ
  2038
  2039				;LIKE TSTKTR BUT MAY BE AN OLD STYLE TRAP
  2040
  2041	002036'	331002	002016*	TSTKOT::SKIPL	JBTPIP(J)	;TEST AND TAKE POSSIBLE OLD TRAP
  2042	002037'	254000	002002'		 JRST	TSTKTP		;NEW TYPE
  2043	002040'	322300	002003*		JUMPE	T1,CPOPJ1	;NOT ENABLED
  2044	002041'	205300	200000		MOVSI	T1,(1B1)
  2045	002042'	612302	002036*		TDNE	T1,JBTPIP(J)	;ALREADY IN A TRAP?
  2046	002043'	254000	002040*		 JRST	CPOPJ1		;YES, SKIP RETURN
  2047	002044'	661340	400000		TLO	T2,(1B0)
  2048	002045'	436342	002020*		IORM	T2,JBTAWQ(J)	;SET WANT A TRAP FLAG
  2049	002046'	263040	000000		POPJ	P,		;AND RETURN
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 22
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2050				;ROUTINE TO CHECK FOR WAITING TRAPS AND TAKE THEM. CALLED
  2051				;AT END OF A UUO AND AT CLOCK LEVEL
  2052				;CALLED WITH OLD PC IN T3
  2053
  2054	002047'	322100	002024*	CLKTRP::JUMPE	J,CPOPJ			;NEVER FOR JOB 0
  2055	002050'	603400	010000		TLNE	T3,PC.USR		;DO NOT INTERRUPT OUT OF UUO
  2056	002051'	331302	002045*		SKIPL	T1,JBTAWQ(J)		;IS THERE AN INTERRUPT WAITING?
  2057	002052'	263040	000000		 POPJ	P,			;KEEP OLD PC THE SAME
  2058	002053'	335002	002042*		SKIPGE	JBTPIP(J)
  2059	002054'	254000	002076'		 JRST	CLKTRO			;OLD APRENB SYSTEM
  2060	002055'	404302	001765*		AND	T1,JBTENB(J)		;USE ONLY CHANNELS ENABLED
  2061	002056'	621300	400000		TLZ	T1,(1B0)
  2062	002057'	243300	002061'		JFFO	T1,.+2			;SEE WHICH INTERRUPT IS WAITING
  2063	002060'	254000	002672'		 JRST	CLKNTP			;NO TRAP THERE REALLY, TURN OFF AWQ
  2064	002061'	200307	001711'		MOVE	T1,TRPBTS(T2)		;GET READY TO SET BITS
  2065	002062'	317302	002053*		CAMG	T1,JBTPIP(J)		;IGNORE IF NOT HIGHER
  2066	002063'	254000	002672'		 JRST	CLKNTP			;THAN HIGHEST IN PROG
  2067	002064'	436302	002062*	CLKTR1::IORM	T1,JBTPIP(J)		;SET IN PROGRESS
  2068	002065'	661300	400000		TLO	T1,(1B0)		;ALSO RESET AWAIT REQUEST BIT
  2069	002066'	412302	002051*		ANDCAM	T1,JBTAWQ(J)		;AND CLEAR WAITING
  2070	002067'	554300	000000*		HLRZ	T1,%UPT+UPTENB		;GET INTERRUPT ADDRESS
  2071	002070'	242340	000001		LSH	T2,1
  2072	002071'	271307	777776		ADDI	T1,-2(T2)		;FIND CORRECT LOCATION
  2073	002072'	256200	003311'	CLKPC1::XCTTU	<MOVEM T3,(T1)>		;SAVE OLD PC
  2074	002073'	256200	003312'	CLKPC2::XCTFU	<HRR T3,1(T1)>		;GET NEW PC
  2075	002074'	621400	021000		TLZ	T3,PC.FPD!PC.ADR	;USE SAME FLAGS, EXCEPT TURN OFF
  2076									; FLAGS THAT WILL BE TURNED OFF
  2077									; IF INSTRUCTION AT PC HAD COMPLETED
  2078									; (SO 2 PART INSTRUCTIONS WORK RIGHT IN INTERRUPT ROUTI
  2079				NE)
  2080	002075'	263040	000000		POPJ	P,			;FINISHED
  2081
  2082				EXTERNAL JOBAPR,JOBCNI,JOBTPC,JOBMUU
  2083
  2084	002076'	621300	600000	CLKTRO:	TLZ	T1,600000		;REMAINDER IN JOBCNI BITS
  2085	002077'	256200	003313'		XCTBU	<MOVEM T1,JOBCNI>
  2086	002100'	256200	003314'		XCTBU	<MOVEM T3,JOBTPC>	;SAVE OLD PC
  2087	002101'	200300	000000*		MOVE	T1,%UPT+UPTENB
  2088	002102'	606300	100000		TRNN	T1,ENBUUO
  2089	002103'	254000	002106'		 JRST	CLKTO1			;NOT ENABLED FOR UUO
  2090	002104'	544400	000000*		HLR	T3,%UPT+UPTENB		;TAKE NEW ADDRESS AS SET
  2091	002105'	606400	777777		TRNN	T3,-1			;UNLESS 0
  2092	002106'	256200	003315'	CLKTO1:	XCTBU	<HRR T3,JOBAPR>
  2093	002107'	602300	400000		TRNE	T1,ENBRPT		;REPEAT ENABLED?
  2094	002110'	624300	101000		 TRZA	T1,ENBUUO!ENBCLK	;YES, JUST REMOVE CLOCK AND UUO
  2095	002111'	201300	000000		  MOVEI	T1,0			;NO, REMOVE EVERYTHING
  2096	002112'	254000	002116'		JRST	APRDIS			;GO DISABLE TRAPS (ALMOST LIKE APRENB)
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 23
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2097				;ROUTINES TO DO THE OLD APRENB (AND SETPOV) UUO'S
  2098
  2099				EXTERNAL USRMPT
  2100
  2101	002113'	256200	003316'	SETPOV::XCTBU	<MOVEM T1,JOBAPR>	;SET THE TRAP LOC
  2102	002114'	201300	200000		MOVEI	T1,ENBPDL		;AND SET TO ENABLE PDL OV
  2103					PFALL	APRENB
  2104
  2105	002115'	634340	000007	APRENB::TDZA	T2,T2
  2106	002116'	205340	200000	APRDIS:	 MOVSI	T2,(1B1)		;DO APRENB AND SET IN TRAP FLAG
  2107	002117'	661340	400000		TLO	T2,(1B0)		;SET BIT TO INDICATE OLD SYSTEM
  2108	002120'	202342	002064*		MOVEM	T2,JBTPIP(J)
  2109	002121'	402002	002055*		SETZM	JBTENB(J)
  2110	002122'	402002	002066*		SETZM	JBTAWQ(J)
  2111	002123'	200340	003317'		MOVE	T2,[%UPT+UPTTCB,,%UPT+UPTTCB+1]
  2112									;CLEAR INTERRUPT CELLS IN UPT
  2113	002124'	402007	777777		SETZM	-1(T2)
  2114	002125'	251340	000000*		BLT	T2,%UPT+UPTTCE		;TPN, TP1, U?I, X?I
  2115	002126'	402002	000000*		SETZM	JBTINT##(J)		;CLEAR INTERRUPT CELLS IN JOB TABLES
  2116	002127'	402002	000000*		SETZM	JBTFNT##(J)		;Clear FINASS (but not JBTPNT)
  2117	002130'	202300	000000*		MOVEM	T1,%UPT+UPTENB
  2118	002131'	260040	000000*		PUSHJ	P,TTTCLR		;CLEAR ALL TTY TRAPS
  2119	002132'	205340	255000		MOVSI	T2,(JFCL)
  2120	002133'	602300	000110		TRNE	T1,ENBOV+ENBFOV		;SET OVERFLOW INSTRUCTION
  2121	002134'	201340	002215'		 MOVEI	T2,USROVT		;TO IGNORE OR TRAP
  2122	002135'	202340	000421*		MOVEM	T2,%UPT+UPTOVT		;SO WE DO NOT NEED TO CALL SETAPR
  2123	002136'	201340	000000*		MOVEI	T2,USRMPE
  2124	002137'	602300	020000		TRNE	T1,ENBMPT		;MEM-PROT VIOLATION TO TRAP OR ERR
  2125	002140'	201340	000000*		 MOVEI	T2,USRMPT
  2126	002141'	202340	000420*		MOVEM	T2,%UPT+UPTPGT
  2127	002142'	201340	000000*		MOVEI	T2,ERRPOV		;NOW PDLOV
  2128	002143'	602300	200000		TRNE	T1,ENBPDL
  2129	002144'	201340	002207'		 MOVEI	T2,USRPDT
  2130	002145'	202340	000422*		MOVEM	T2,%UPT+UPTPOV
  2131	002146'	201340	000000*		MOVEI	T2,UUOPNT		;AND UUO
  2132	002147'	602300	100000		TRNE	T1,ENBUUO
  2133	002150'	201340	002222'		 MOVEI	T2,UUOPTT
  2134	002151'	542340	000436*		HRRM	T2,%UPT+UPTPNT
  2135	002152'	201340	000001		MOVEI	T2,1
  2136	002153'	602300	000060		TRNE	T1,ENBHMS!ENBHNG
  2137	002154'	137340	000000*		 DPB	T2,JBYHNG##		;SET HUNG DEVICE TRAP NUMBER
  2138	002155'	205340	777775		MOVSI	T2,-TTYRPT		;NUMBER OF TTY TRAPS TO SET
  2139	002156'	553000	000006		HRRZS	T1
  2140	002157'	550202	000000*		HRRZ	F,TTYTAB(J)
  2141	002160'	261040	000010		PUSH	P,T3			;CLKTRP CALLS THIS, PRESERVE T3
  2142	002161'	616307	002201'	TTYENB:	TDNN	T1,TTYTRB(T2)		;WANT THIS ONE?
  2143	002162'	254000	002176'		 JRST	TTYEN2			;NO
  2144	002163'	261040	000007		PUSH	P,T2			;SAVE ARGUMENT POINTER
  2145	002164'	201400	000001		MOVEI	T3,1			;CHANNEL NUMBER
  2146	002165'	554347	002201'		HLRZ	T2,TTYTRB(T2)		;INTERRUPT NUMBER
  2147	002166'	260040	000000*		PUSHJ	P,TINAS1		;CALL THE SETUP ROUTINE
  2148	002167'	254000	002174'		  JRST	TTYEN1			;NOT WAITING FOR TRAP
  2149	002170'	201300	000001		MOVEI	T1,1			;WANT TRAP, CHANNEL 1
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 23-2
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2150	002171'	200341	000000		MOVE	T2,(P)			;GET POINTER BACK
  2151	002172'	200347	002204'		MOVE	T2,TTYTRF(T2)		;GET THE FLAG
  2152	002173'	260040	002007'		PUSHJ	P,TAKOT1		;SET UP THE TRAP
  2153	002174'	262040	000007	TTYEN1:	POP	P,T2			;RESTORE ARG POINTER
  2154	002175'	550300	000000*		HRRZ	T1,%UPT+UPTENB		;GET BACK ENABLE BITS
  2155	002176'	253340	002161'	TTYEN2:	AOBJN	T2,TTYENB		;TRY NEXT TRAP
  2156	002177'	262040	000010		POP	P,T3
  2157	002200'	263040	000000		POPJ	P,			;ALL FINISHED
  2158
  2159				;TABLE OF INTERRUPT NUMBERS AND ENABLE BITS
  2160
  2161	002201'	000000*	002000	TTYTRB:	XWD TTNESC,ENBESC
  2162	002202'	000000*	004000		XWD TTNCHR,ENBCHR
  2163	002203'	000000*	040000		XWD TTNLIN,ENBLIN
  2164			000003	TTYRPT==.-TTYTRB			;NUMBER
  2165
  2166	002204'	000001	000000	TTYTRF:	XWD FLGESC,0			;FLAGS
  2167	002205'	000000	000400		FLGCHR
  2168	002206'	000000	004000		FLGLIN
  2169
  2170				EXTERNAL TTTCLR,TINAS1,TTNESC,TTNCHR,TTNLIN
  2171				EXTERNAL UPTTPN,UPTTP1,TTYTAB,UPTTCB,UPTTCE
  2172				EXTERNAL USRMPE,ERRPOV,USRMP2
  2173
  2174
  2175				;HERE ON PDL OV. MUST BE AN OLD STYLE TRAP
  2176
  2177	002207'	201300	200000	USRPDT:	MOVEI	T1,FLGPDL
  2178	002210'	262040	000010	COMNT2::POP	P,T3			;GET THE PC FROM PDL
  2179	002211'	200100	001542*	COMINT:	MOVE	J,JOB
  2180	002212'	260040	002076'		PUSHJ	P,CLKTRO		;AND GET IT CORRECTED AND JOBCNI ETC. SET
  2181	002213'	261040	000010	COMNT1::PUSH	P,T3
  2182	002214'	254000	000000*		JRST	USRXIT
  2183
  2184				;HERE ON OLD STYLE OVERFLOW TRAP
  2185
  2186	002215'	201300	000110	USROVT:	MOVEI	T1,FLGFOV!FLGOV
  2187	002216'	262040	000010		POP	P,T3
  2188	002217'	607400	040100		TLNN	T3,PC.FOV!PC.FXU	;SEE IF FLOATING
  2189	002220'	620300	000100		TRZ	T1,FLGFOV		;IF NO, RESET FLAG
  2190	002221'	254000	002211'		JRST	COMINT
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 24
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2191				;HERE ON EITHER OLD OR NEW UUO TRAP
  2192
  2193	002222'	701140	003075'	UUOPTT:	EXECAC				;SWITCH TO EXEC ACS
  2194	002223'	200400	000425*		MOVE	T3,%UPT+UPTMUP
  2195	002224'	200540	000424*		MOVE	M,%UPT+UPTMUU
  2196	002225'	200040	003320'		MOVE	P,[-EPLLEN,,%UPT+UPTPDL-1]	;SET UP PDL
  2197	002226'	200100	002211*		MOVE	J,JOB
  2198	002227'	331002	002120*		SKIPL	JBTPIP(J)		;NEW OR OLD
  2199	002230'	254000	002234'		  JRST	TRPUUO			;NEW
  2200	002231'	256200	003321'		XCTBU	<MOVEM M,JOBMUU>	;SAVE UUO
  2201	002232'	201300	400000		MOVEI	T1,FLGUUO
  2202	002233'	254000	002211'		JRST	COMINT
  2203
  2204	002234'	135300	000000*	TRPUUO:	LDB	T1,JBYUUO##
  2205	002235'	200340	000006		MOVE	T2,T1
  2206	002236'	260040	001674'		PUSHJ	P,TSTTRP		;CAN WE TAKE IT NOW?
  2207	002237'	254000	002245'		  JRST	DSBUUO			;NO, LET THE UUO HAPPEN AND DISABLE
  2208	002240'	256200	003321'		XCTBU	<MOVEM M,JOBMUU>
  2209	002241'	260040	002064'		PUSHJ	P,CLKTR1
  2210	002242'	201300	002146*		MOVEI	T1,UUOPNT
  2211	002243'	542300	000436*		HRRM	T1,%UPT+UPTPNT		;IN TRAP SO DISABLE
  2212	002244'	254000	002213'		JRST	COMNT1
  2213
  2214	002245'	201300	002242*	DSBUUO:	MOVEI	T1,UUOPNT
  2215	002246'	542300	000436*		HRRM	T1,%UPT+UPTPNT
  2216	002247'	254000	000010*		JRST	UUOPN1##		;NOW MAKE THE UUO HAPPEN
  2217
  2218				;SEE IF USER WANTS A CLOCK TRAP
  2219				;CALLED FROM CHANNEL 7
  2220
  2221				EXTERNAL UPTENB
  2222	002250'	200300	000000*	USRCLK::MOVE	T1,%UPT+UPTPC
  2223	002251'	607300	010000		TLNN	T1,PC.USR
  2224	002252'	263040	000000		  POPJ	P,			;NOT IN USER MODE
  2225	002253'	201300	001000		MOVEI	T1,ENBCLK
  2226	002254'	616300	000000*		TDNN	T1,%UPT+UPTENB		;ENABLED FOR IT?
  2227	002255'	263040	000000		  POPJ	P,			;NO
  2228	002256'	331002	002227*		SKIPL	JBTPIP(J)
  2229	002257'	254000	002264'		  JRST	CLKNEW			;NEW STYLE
  2230	002260'	200400	000000*		MOVE	T3,%UPT+UPTPC
  2231	002261'	260040	002076'		PUSHJ	P,CLKTRO
  2232	002262'	202400	000000*		MOVEM	T3,%UPT+UPTPC
  2233	002263'	263040	000000		POPJ	P,
  2234
  2235	002264'	135300	000000*	CLKNEW:	LDB	T1,JBYCLK##
  2236	002265'	326300	001757'		JUMPN	T1,TAKTRP		;TAKE THE TRAP IF ONE THERE
  2237	002266'	513000	000000*		HLLZS	%UPT+UPTENB		;RESET FLAGS
  2238	002267'	263040	000000		POPJ	P,			;AND ALL FINISHED
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 25
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2239				EXTERN PDNMUP
  2240
  2241	002270'	331002	002256*	DISMIS::SKIPL	JBTPIP(J)
  2242	002271'	254000	002317'		JRST	DISNEW			;NEW STYLE
  2243	002272'	256200	003322'		XCTFU	<MOVE T2,2(T1)>		;GET VALUE TO STORE IN AC
  2244	002273'	256200	003323'		XCTTU	<MOVEM T2,(M)>		;AND DO IT
  2245	002274'	540540	000006		HRR	M,T1
  2246	002275'	261042	002122*		PUSH	P,JBTAWQ(J)		;SAVE THIS IN CASE OF ESC FLAG
  2247	002276'	256200	003324'		XCTFU	<MOVE T1,(M)>
  2248	002277'	260040	002115'		PUSHJ	P,APRENB
  2249	002300'	262040	000007		POP	P,T2
  2250	002301'	200300	000000*		MOVE	T1,%UPT+UPTENB
  2251	002302'	603340	000001		TLNE	T2,FLGESC
  2252	002303'	606300	002000		TRNN	T1,ENBESC		;ESCAPE ENABLED AND FLAGGED?
  2253	002304'	254000	002307'		JRST	NODSSC			;NO
  2254	002305'	205340	400001		MOVSI	T2,FLGESC+(1B0)
  2255	002306'	436342	002275*		IORM	T2,JBTAWQ(J)		;SET FOR A TRAP
  2256	002307'	256200	003325'	NODSSC:	XCTFU	<MOVE T1,1(M)>
  2257	002310'	661300	012000		TLO	T1,PC.USR!PC.PUB
  2258	002311'	621300	004037		TLZ	T1,PC.UIO!37		;GET RID OF INDIRECT AND INDEX
  2259	002312'	205340	004000		MOVSI	T2,PC.UIO		;SEE IF USER-IOT WAS SET
  2260	002313'	612341	000000*		TDNE	T2,PDNMUP(P)
  2261	002314'	661300	004000		  TLO	T1,PC.UIO		;IF SO, SET IT AGAIN
  2262	002315'	202301	002313*		MOVEM	T1,PDNMUP(P)		;SAVE THE NEW PC
  2263	002316'	263040	000000		POPJ	P,
  2264
  2265	002317'	200302	002270*	DISNEW:	MOVE	T1,JBTPIP(J)
  2266	002320'	243300	002322'		JFFO	T1,.+2
  2267	002321'	263040	000000		POPJ	P,			;NO TRAPS IN PROGRESS
  2268	002322'	200307	001711'		MOVE	T1,TRPBTS(T2)
  2269	002323'	413302	002317*		ANDCAB	T1,JBTPIP(J)		;TURN OFF IN PROGRESS FLAG
  2270	002324'	242340	000001		LSH	T2,1
  2271	002325'	554400	000000*		HLRZ	T3,%UPT+UPTENB
  2272	002326'	271407	777776		ADDI	T3,-2(T2)
  2273	002327'	256200	003326'		XCTFU	<MOVE T2,(T3)>		;GET THE REUTNR PC
  2274	002330'	661340	012000		TLO	T2,PC.USR!PC.PUB
  2275	002331'	621340	004037		TLZ	T2,PC.UIO!37
  2276	002332'	205400	004000		MOVSI	T3,PC.UIO		;SEE IF USER-IOT WAS SET
  2277	002333'	612401	002315*		TDNE	T3,PDNMUP(P)
  2278	002334'	661340	004000		  TLO	T2,PC.UIO		;IF SO, SET IT AGAIN
  2279	002335'	202341	002333*		MOVEM	T2,PDNMUP(P)		;SAVE THE NEW PC
  2280	002336'	243300	002340'	DISTPC:	JFFO	T1,.+2			;FIND HIGHEST CHANNEL IN PROGRESS
  2281	002337'	201340	000044		MOVEI	T2,^D36			;NONE
  2282	002340'	135300	002234*		LDB	T1,JBYUUO##
  2283	002341'	322300	002346'		JUMPE	T1,UUOOK		;SHOULD WE REENABLE?
  2284	002342'	311300	000007		CAML	T1,T2
  2285	002343'	254000	002346'		  JRST	UUOOK			;NO, HIGHER STILL IN PROGRESS
  2286	002344'	201300	002222'		MOVEI	T1,UUOPTT		;YES
  2287	002345'	542300	000436*		HRRM	T1,%UPT+UPTPNT
  2288	002346'	335302	002306*	UUOOK:	SKIPGE	T1,JBTAWQ(J)		;ALREADY WAITING FOR TRAP
  2289	002347'	263040	000000		  POPJ	P,			;YES, GO NOW
  2290	002350'	404302	002121*		AND	T1,JBTENB(J)		;GET BITS WHICH WANT AND ENABLED
  2291	002351'	335002	002350*		SKIPGE	JBTENB(J)		;IS PI SYSTEM ON AT ALL?
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 25-2
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2292	002352'	317302	002323*		CAMG	T1,JBTPIP(J)		;AND WANT HIGHER THAN NOW?
  2293	002353'	263040	000000		  POPJ	P,			;NO
  2294	002354'	205300	400000		MOVSI	T1,(1B0)
  2295	002355'	436302	002346*		IORM	T1,JBTAWQ(J)		;SET AWAIT REQUEST FLAG
  2296	002356'	263040	000000		POPJ	P,
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 26
PICON.MAC	30-OCT-87 17:26		USER PSEUDO-INTERRUPT ROUTINES

  2297				;ROUTINES TO HANDLE TIME AND CONDITION DISMISS
  2298
  2299	002357'	541040	000000*	ABTUUO::HRRI	P,%UPT+UPTPDL		;SET PDL TO THE RETURN TO USER LOC
  2300	002360'	370001	000000		SOS	(P)			;RETURN POINTING TO UUO
  2301	002361'	200100	002226*		MOVE	J,JOB##
  2302	002362'	260040	000000*		PUSHJ	P,TIMADJ##		;GET OUT OF NO CLOCK STATE
  2303	002363'	254000	002214*		JRST	USRXIT##
  2304
  2305	002364'	335002	002355*	SLEEP::	SKIPGE	JBTAWQ(J)
  2306	002365'	254000	002357'		 JRST	ABTUUO			;DO NOT START SLEEP IF INT WAITING
  2307	002366'	260040	002032*		PUSHJ	P,TTSCLR		;CLEAR ALL TTY SLEEP CONDITIONS
  2308	002367'	220300	001455*		IMUL	T1,JFYSEC		;CONVERT SECONDS TO JIFFIES
  2309	002370'	606300	007777		TRNN	T1,7777			;IF 0
  2310	002371'	201300	000001		MOVEI	T1,1			;SET TO 1 JIFFIE
  2311	002372'	405300	007777		ANDI	T1,7777			;ONLY 12 BITS FOR COMPATABLITY
  2312	002373'	554342	000000*	SLEEP2:	HLRZ	T2,JBTICT(J)		;WILL HE SLEEP LONGER THAN IN
  2313	002374'	313300	000007		CAMLE	T1,T2			;MEMORY PROTECT TIME?
  2314	002375'	563002	002373*	SLEEP1:	 HRROS	JBTICT(J)		;YES, SWAP HIM NOW
  2315	002376'	137100	000000*		DPB	J,CLKJOB##		;SET JOB. ACT AND TYPE ALREADY 0
  2316	002377'	260040	000000*		PUSHJ	P,CHGCLK		;CHANGE OR INSERT CLOCK REQ
  2317	002400'	254000	000000*		JRST	SETSLP			;AND PUT HIM TO SLEEP
  2318
  2319			000000	XP .SLWAK,0
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 27
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2320				SUBTTL	HIBER uuo
  2321
  2322	002401'	335002	002364*	HIBER::	SKIPGE	JBTAWQ(J)
  2323	002402'	254000	002357'		 JRST	ABTUUO			;NO SLEEP IF INT WAITING
  2324	002403'	260040	002366*		PUSHJ	P,TTSCLR		;CLEAR SLEEP CONDITIONS
  2325	002404'	607300	000100		TLNN	T1,HIBPRT		;IS A PORT SPECIFIED?
  2326					 JRST	[HRRZ	F,TTYTAB(J)	;NO USE COMMAND PORT
  2327	002405'	254000	003327'			JRST	HIBPST]		;PORT SET
  2328	002406'	135200	003331'		LDB	F,[POINT HISPRT,T1,HINPRT]	;GET PORT NUMBER
  2329	002407'	260040	000000*		PUSHJ	P,FNDPRT		;FIND THE PORT
  2330	002410'	201200	000000		  MOVEI	F,0			;NONE THERE
  2331	002411'	322200	002047*	HIBPST:	JUMPE	F,CPOPJ			;NO PORT, ERROR RETURN
  2332	002412'	205340	777775		MOVSI	T2,-HIBNUM		;NUMBER OF TTY REASONS
  2333	002413'	261040	000006		PUSH	P,T1
  2334	002414'	510301	000000	HIBTTY:	HLLZ	T1,(P)
  2335	002415'	616307	002466'		TDNN	T1,HIBTAB(T2)		;THIS ONE?
  2336	002416'	254000	002426'		 JRST	HIBNOT			;NO
  2337	002417'	261040	000007		PUSH	P,T2
  2338	002420'	201400	000044		MOVEI	T3,^D36			;SLEEP CHANNEL
  2339	002421'	550347	002466'		HRRZ	T2,HIBTAB(T2)		;NUMBER OF INTERRUPT
  2340	002422'	260040	002166*		PUSHJ	P,TINAS1		;SET IT UP
  2341	002423'	334000	000000		  SKIPA				;NOT SATISFIED
  2342	002424'	254000	002471'		 JRST	NOHIB			;ALREADY SATISFIED
  2343	002425'	262040	000007		POP	P,T2
  2344	002426'	253340	002414'	HIBNOT:	AOBJN	T2,HIBTTY
  2345	002427'	262040	000006		POP	P,T1
  2346	002430'	603300	000040		TLNE	T1,HIBYLB
  2347	002431'	260040	000000*		 PUSHJ	P,TTYYLS		;SEND A YELLOW BALL
  2348	002432'	350001	000000	HIBNTY:	AOS	(P)			;FOR SKIP RETURN
  2349	002433'	607300	000600		TLNN	T1,HIBWKU!HIBFEX	;SHOULD WE ENABLE FOR WAKE UUO OR FRAME EXITS??
  2350	002434'	254000	002451'		 JRST	HIBNWK			;NO
  2351	002435'	400340	000000		SETZ	T2,
  2352	002436'	603300	000200		TLNE	T1,HIBWKU		;ENABLE FOR WAKUUO?
  2353	002437'	660340	200000		 TRO	T2,WAKFLG		;YES
  2354	002440'	603300	000400		TLNE	T1,HIBFEX		;ENABLE FOR EXIT IN CHILD?
  2355	002441'	660340	000400		 TRO	T2,EXCFLG		;YES
  2356	002442'	612342	000000*		TDNE	T2,JBTSTS(J)		;WAITING NOW?
  2357					 JRST	[ANDCAB	T2,JBTSTS(J)
  2358	002443'	254000	003332'			POPJ	P,]		;CLEAR AND GO
  2359	002444'	201340	000044		MOVEI	T2,^D36
  2360	002445'	603300	000200		TLNE	T1,HIBWKU		;ENABLE FOR WAKE UUO?
  2361	002446'	137340	000000*		 DPB	T2,JBYWAK##		;YES.
  2362	002447'	603300	000400		TLNE	T1,HIBFEX		;ENABLE FOR FRAME EXITS?
  2363	002450'	137340	000000*		 DPB	T2,JBYEXC##		;YES.
  2364	002451'	135340	003334'	HIBNWK:	LDB	T2,[POINT HISTIM,T1,HINTIM]
  2365	002452'	553000	000006		HRRZS	T1			;THE TIME
  2366	002453'	322300	002375'		JUMPE	T1,SLEEP1		;NO TIME, FOREVER
  2367	002454'	256007	002462'		XCT	HIBTB1(T2)		;CORRECT TIME REFERENCE
  2368	002455'	220300	002367*		IMUL	T1,JFYSEC
  2369	002456'	231300	001750		IDIVI	T1,^D1000		;CONVERT MS. TO JIFFIES
  2370	002457'	332000	000007		SKIPE	T2
  2371	002460'	271300	000001		 ADDI	T1,1		;ROUND UP
  2372	002461'	254000	002373'		JRST	SLEEP2
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 27-2
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2373
  2374	002462'	255000	000000	HIBTB1:	JFCL
  2375	002463'	254000	002473'		JRST HIBSEC
  2376	002464'	254000	002477'		JRST HIBMIN
  2377	002465'	254000	002477'		JRST HIBMIN
  2378
  2379	002466'	000010	000000*	HIBTAB:	XWD HIBCHR,TTNCHR
  2380	002467'	000020	000000*		XWD HIBLIN,TTNLIN
  2381	002470'	000040	000000*		XWD HIBYLB,TTNYLB
  2382
  2383			000003	HIBNUM==.-HIBTAB
  2384
  2385	002471'	262040	000007	NOHIB:	POP	P,T2
  2386	002472'	254000	000000*		JRST	TPOPJ1
  2387
  2388	002473'	661300	400000	HIBSEC:	TLO	T1,(1B0)		;SET FOR SECONDS
  2389	002474'	622300	600000		TRZE	T1,3B19			;IF OVERFLOW
  2390	002475'	541300	177777		 HRRI	T1,177777		;SET FOR MAX
  2391	002476'	254000	002375'		JRST	SLEEP1
  2392
  2393	002477'	661300	400000	HIBMIN:	TLO	T1,(1B0)
  2394	002500'	622300	600000		TRZE	T1,3B19
  2395	002501'	541300	377777		 HRRI	T1,377777
  2396	002502'	660300	200000		TRO	T1,1B19			;FOR MIN
  2397	002503'	254000	002375'		JRST	SLEEP1
  2398
  2399				EXTERNAL JFYSEC,JBTICT,SETSLP,TTNYLB,TPOPJ1,CHGCLK,FNDPRT,TTYYLS
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 28
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2400				;WAKE UUO. CALL IS
  2401				;
  2402				;	MOVEI	AC,<FRAME DESCRIPTOR>
  2403				;	WAKE	AC,
  2404				;	  <ERROR RETURN>
  2405				;	<SKIP RETURN>
  2406
  2407	002504'	201700	000061	WAKUUO::MOVEI	P3,.ARWAK	;NEED THIS LEVEL OF ACCESS
  2408	002505'	550740	000006		HRRZ	P4,T1		;GET FD IN P4
  2409	002506'	260040	000000*		PUSHJ	P,FARCHK##	;SEE IF CAN DO IT
  2410	002507'	263040	000000		  POPJ	P,		;NO
  2411								;YES, J HAS FRAME NUMBER NOW, ALL CHECKED.
  2412	002510'	205300	040000		MOVSI	T1,JNA		;FRAME EXISTS?
  2413	002511'	616302	002442*		TDNN	T1,JBTSTS(J)
  2414	002512'	263040	000000		 POPJ	P,		;NO, GIVE ERROR.
  2415	002513'	350001	000000		AOS	(P)
  2416	002514'	135300	002446*		LDB	T1,JBYWAK##
  2417	002515'	326300	001757'		JUMPN	T1,TAKTRP	;GO
  2418	002516'	201300	200000		MOVEI	T1,WAKFLG
  2419	002517'	436302	002511*		IORM	T1,JBTSTS(J)	;SET WAITING FLAG IN DEST
  2420	002520'	263040	000000		POPJ	P,
  2421
  2422
  2423				; Wonderful  EVICT  UUO - Wakes a job up when he is about to be hung.
  2424				; Bit 17 set in AC if we are to REALLY do it, otherwise just read and
  2425				; return the channel of the interrupt assignment (if any) in AC.
  2426				; Set JS.EVI if evicting job or JS.EVP if notifying parent.
  2427				; Bit 16 set in AC if we are to ignore .IANIC setting both reading the
  2428				; interrupt channel and causing the interrupt.  Set JS.EVI if evicting
  2429				; the job (bit 17 is set).
  2430
  2431	002521'	256200	003335'	EVICT::	XCTTU	<SETZM (W)>	;IN CASE SOME ERROR
  2432	002522'	261040	000006		PUSH	P,T1
  2433	002523'	201700	000052		MOVEI	P3,.ARHLT	;NEED TO BE ABLE TO HALT HIM TO EVICT
  2434	002524'	550740	000006		HRRZ	P4,T1		;GET FD IN P4
  2435	002525'	260040	002506*		PUSHJ	P,FARCHK	;HAS ACCESS?
  2436	002526'	254000	000000*		  JRST	TPOPJ##		;NO, ERROR
  2437	002527'	262040	000006		POP	P,T1	
  2438	002530'	603300	000002		TLNE	T1,(1B16)	;WANT TO IGNORE .IANIC CHECK
  2439	002531'	254000	002554'		  JRST	EVICT1		;YES, DO IT THE OLD WAY
  2440	002532'	200342	002517*		MOVE	T2,JBTSTS(J)	;GET FLAG BITS
  2441	002533'	607340	040000		TLNN	T2,JNA		;DOES IT EXIST (CHECK ONLY ONCE)
  2442	002534'	263040	000000		  POPJ	P,		;NO, ERROR
  2443	002535'	135340	000000*		LDB	T2,JBYNIC##	;GET INTERRUPT CHANNEL (IF ANY)
  2444	002536'	322340	002554'		JUMPE	T2,EVICT1	;NONE, CHECK NTQ
  2445	002537'	256200	003336'		UMOVEM	T2,(W)		;YES, TELL CALLER IN AC
  2446	002540'	607300	000001		TLNN	T1,(1B17)	;REALLY SIGNAL THE JOB
  2447	002541'	254000	002043*		  JRST	CPOPJ1		;NO, WE ARE DONE, SKIP RETURN
  2448	002542'	261040	000002		PUSH	P,J		;YES, SAVE CURRENT JOB
  2449	002543'	135100	003337'		LDB	J,PRNTBP(J)	;GET PARENT
  2450	002544'	336000	000002		SKIPN	J		;IS THERE ONE?
  2451					  JRST	[POP   P,J	;NO, RESTORE JOB AND
  2452	002545'	254000	003340'			 JRST  EVICT1]	;FALL INTO COMMON CHECK
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 28-2
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2453	002546'	250300	000007		EXCH	T1,T2		;SAVE STATUS BITS, GET TRAP
  2454				if2,<PRINTX [Eviction posting needs to be done before TAKTRP if UUO interruptable]>
  2455	002547'	260040	001757'		PUSHJ	P,TAKTRP	;ISSUE INTERRUPT FOR NOTICE IN CHILD
  2456	002550'	262040	000002		POP	P,J		;RESTORE JOB
  2457	002551'	205340	040000		MOVSI	T2,JS.EVP	; Get eviction notice for parent
  2458	002552'	436342	000000*		IORM	T2,JBTST2##(J)	;  and tack it to the child's door
  2459	002553'	254000	002541*		JRST	CPOPJ1		;DONE, SKIP RETURN
  2460	
  2461	002554'	335342	002532*	EVICT1:	SKIPGE	T2,JBTSTS(J)	;MAKE SURE ITS RUNNING
  2462	002555'	607340	040000		TLNN	T2,JNA		; AND IT EXISTS (REDUNDANT)
  2463	002556'	263040	000000		  POPJ	P,
  2464	002557'	350001	000000		AOS	(P)  		;SKIP RETURN
  2465	002560'	200340	000006		MOVE	T2,T1		;KEEP AROUND THE FLAGS FROM LH(AC)
  2466	002561'	135300	000000*		LDB	T1,JBYNTQ##
  2467	002562'	256200	003342'		UMOVEM	T1,(W)
  2468	002563'	603340	000001		TLNE	T2,(1B17)	;DOES USER WANT US TO REALLY DO IT?
  2469					 JUMPN	T1,[	MOVSI	T2,PVLOS	; logout on stop
  2470							IORM	T2,JBTPRV(J)
  2471							MOVSI	T2,JS.EVI	; Get eviction notice and
  2472							IORM	T2,JBTST2##(J)	;  tack it to the door
  2473	002564'	326300	003343'				JRST	TAKTRP ]	; go cause interrupt
  2474	002565'	263040	000000		POPJ	P,
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 29
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2475				;HERE ARE THE ROUTINES TO HANDLE THE NEW MULTI-LEVEL INTERRUPT
  2476				;STRUCTURE
  2477
  2478				;ROUTINE TO SET INTERRUPT TABLE ADDRESS
  2479				;RH OF AC=INTERRUPT TABLE ADDRESS (0=DO NOT CHANGE)
  2480				;LH OF AC.
  2481				;	BIT 17 TURN OFF SYSTEM
  2482				;	BIT 16 TURN ON SYSTEM
  2483				;	BIT 15 RESET SYSTEM. CLEAR WAITING TRAPS AND PI IN PROG
  2484
  2485	002566'	200340	000000*	INTADR::MOVE	T2,%UPT+UPTENB		;SET TO RETURN OLD VALUE
  2486	002567'	331002	002352*		SKIPL	JBTPIP(J)		;IS NEW SYSTEM ALREADY IN EFFECT?
  2487	002570'	624340	777777		 TRZA	T2,-1			;YES, MAKE SURE R.H. IS 0
  2488	002571'	660340	000001		  TRO	T2,1			;NO, MAKE SURE R.H. IS NON-0
  2489	002572'	256200	003336'		XCTTU	<MOVEM T2,(W)>		;RETURN VALUE TO USER
  2490	002573'	606300	777777		TRNN	T1,-1			;ARE WE SETTING ADDRESS?
  2491					 JRST	[SKIPGE JBTPIP(J)	;NO ALREADY IN NEW SYS?
  2492						  POPJ	P,		;NO, ERROR RETURN
  2493	002574'	254000	003350'			 JRST	INTAD1]		;YES, GO
  2494	002575'	516300	000000*		HRLZM	T1,%UPT+UPTENB		;SAVE INTERRUPT TABLE ADDRESS
  2495	002576'	350001	000000	INTAD1:	AOS	(P)			;SET FOR SKIP RETURN
  2496	002577'	331002	002567*		SKIPL	JBTPIP(J)		;ALREADY NEW SYSTEM?
  2497	002600'	254000	002621'		 JRST	INTAD2			;YES
  2498	002601'	260040	002131*		PUSHJ	P,TTTCLR		;NO, RESET ALL TTY TRAPS
  2499	002602'	402000	000000*		SETZM	%UPT+UPTTPN		;AND APR TRAPS
  2500	002603'	402000	000000*		SETZM	%UPT+UPTTP1		;ALSO OTHER APR TRAPS
  2501	002604'	402002	002126*		SETZM	JBTINT##(J)		;INTERRUPT CELLS IN JOB TABLES
  2502	002605'	402002	002127*		SETZM	JBTFNT##(J)		;Clear FINASS (but not JBTPNT)
  2503	002606'	402002	002577*		SETZM	JBTPIP(J)		;ALSO INTERRUPTS IN PROG
  2504	002607'	402002	002351*		SETZM	JBTENB(J)		;INTERRUPT ENABLED
  2505	002610'	402002	002401*		SETZM	JBTAWQ(J)		;AND INTERRUPTS WAITING
  2506	002611'	205340	255000		MOVSI	T2,(JFCL)
  2507	002612'	202340	000421*		MOVEM	T2,%UPT+UPTOVT		;RESET TRAP CONDITIONS
  2508	002613'	201340	002136*		MOVEI	T2,USRMPE
  2509	002614'	202340	000420*		MOVEM	T2,%UPT+UPTPGT
  2510	002615'	201340	002142*		MOVEI	T2,ERRPOV
  2511	002616'	202340	000422*		MOVEM	T2,%UPT+UPTPOV
  2512	002617'	201340	002245*		MOVEI	T2,UUOPNT
  2513	002620'	542340	000436*		HRRM	T2,%UPT+UPTPNT
  2514	002621'	603300	000004	INTAD2:	TLNE	T1,(1B15)		;SHOULD WE RESET SYSTEM?
  2515	002622'	260040	003060'		 PUSHJ	P,CLRINT		;YES
  2516	002623'	205340	400000		MOVSI	T2,(1B0)		;GET READY TO TURN ON OR OFF
  2517	002624'	603300	000001		TLNE	T1,(1B17)
  2518	002625'	254000	002644'		 JRST	DSBALL			;TURN OFF, GO DO IT
  2519	002626'	603300	000002		TLNE	T1,(1B16)
  2520	002627'	436342	002607*		 IORM	T2,JBTENB(J)		;TURN ON
  2521	002630'	200302	002606*		MOVE	T1,JBTPIP(J)
  2522	002631'	254000	002336'		JRST	DISTPC			;SEE IF SOMETHING SHOULD BE TURNED ON
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 30
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2523				;CALLI TO ENABLE CHANNELS OR DISABLE
  2524				;BIT 0 ON MEANS ENABLE, OFF MEANS DISABLE
  2525				;BITS 1-35 ARE THE CHANNELS TO ENABLE OR DISABLE
  2526
  2527	002632'	335002	002630*	INTENB::SKIPGE	JBTPIP(J)		;MUST HAVE SET NEW SYSTEM
  2528	002633'	263040	000000		 POPJ	P,			;ELSE ERROR RETURN
  2529	002634'	350001	000000		AOS	(P)
  2530	002635'	200342	002627*		MOVE	T2,JBTENB(J)
  2531	002636'	256200	003336'		XCTTU	<MOVEM T2,(W)>		;RETURN OLD ENB WORD
  2532	002637'	627300	400000		TLZN	T1,(1B0)		;ENABLE OR DISABLE?
  2533	002640'	254000	002645'		 JRST	DSBCHL			;DISABLE
  2534	002641'	436302	002635*		IORM	T1,JBTENB(J)		;TURN ON
  2535	002642'	200302	002632*		MOVE	T1,JBTPIP(J)
  2536	002643'	254000	002336'		JRST	DISTPC			;GO SEE IF SOMETHING SHOULD BE RESET
  2537	002644'	200300	000007	DSBALL:	MOVE	T1,T2
  2538	002645'	412302	002641*	DSBCHL:	ANDCAM	T1,JBTENB(J)
  2539	002646'	331302	002610*		SKIPL	T1,JBTAWQ(J)		;IS SOMETHING WAITING
  2540	002647'	263040	000000		 POPJ	P,			;NO
  2541	002650'	254000	002664'		JRST	RSTCH1			;YES, SEE IF WE SHOULD RESET IT
  2542
  2543				;THIS UUO CAUSES AN INTERRUPT OR CLEARS AWAITING REQUEST
  2544				;BIT 0 ON MEANS CAUSE INTERRUPT, OFF MEANS CLEAR WAITING REQ
  2545				;BITS 1-35 ARE THE CHANNELS TO AFFECT
  2546
  2547	002651'	335002	002642*	INTACT::SKIPGE	JBTPIP(J)		;MUST BE NEW STYLE
  2548	002652'	263040	000000		 POPJ	P,
  2549	002653'	350001	000000		AOS	(P)
  2550	002654'	200342	002646*		MOVE	T2,JBTAWQ(J)
  2551	002655'	256200	003336'		XCTTU	<MOVEM T2,(W)>		;RETURN OLD AWQ WORD
  2552	002656'	627300	400000		TLZN	T1,(1B0)
  2553	002657'	254000	002662'		 JRST	RSTCHL
  2554	002660'	436302	002654*		IORM	T1,JBTAWQ(J)
  2555	002661'	254000	002346'		JRST	UUOOK			;SEE IF INTERRUPT NEEDED NOW
  2556
  2557	002662'	413302	002660*	RSTCHL:	ANDCAB	T1,JBTAWQ(J)
  2558	002663'	325300	002411*		JUMPGE	T1,CPOPJ		;DONE IF NOT NOW WAITING
  2559	002664'	621300	400000	RSTCH1:	TLZ	T1,(1B0)
  2560	002665'	404302	002645*		AND	T1,JBTENB(J)		;IS SOMETHING WAITING AND ENABLED
  2561	002666'	313302	002651*		CAMLE	T1,JBTPIP(J)		;HIGHER THAN IN PROG?
  2562	002667'	331002	002665*		SKIPL	JBTENB(J)		;AND CURRENTLY ENABLED
  2563	002670'	334000	000000		 SKIPA				;NO TO ONE OF THESE
  2564	002671'	263040	000000		  POPJ	P,			;YES, GO
  2565	002672'	205300	400000	CLKNTP:	MOVSI	T1,(1B0)
  2566	002673'	412302	002662*		ANDCAM	T1,JBTAWQ(J)		;TURN OFF REQUEST FLAG
  2567	002674'	263040	000000		POPJ	P,
  2568
  2569
  2570	002675'	335302	002666*	REDPIP::SKIPGE	T1,JBTPIP(J)
  2571	002676'	263040	000000		 POPJ	P,			;OLD SYSTEM
  2572	002677'	256200	003310'		UMOVEM	T1,(M)			;RETURN ARG.
  2573	002700'	254000	002553*		JRST	CPOPJ1			;AND RETURN.
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 31
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2574				;ROUTINES TO SET THE TRAP INSTRUCTIONS
  2575
  2576				;TRAP1 1 INSTRUCTION (OVERFLOW)
  2577
  2578	002701'	200340	000421*	SETTR1::MOVE	T2,%UPT+UPTOVT		;GET OLD ONE
  2579	002702'	256200	003336'		UMOVEM	T2,(W)
  2580	002703'	322300	002663*		JUMPE	T1,CPOPJ		;0 IS ERR REQUEST
  2581	002704'	607300	777000		TLNN	T1,777000		;SEE IF WANTS MONITOR TO TAKE OVER
  2582	002705'	205300	255000		 MOVSI	T1,(JFCL)		;YES
  2583	002706'	202300	000421*		MOVEM	T1,%UPT+UPTOVT
  2584	002707'	254000	002700*		JRST	CPOPJ1
  2585
  2586				;TRAP 2 INSTRUCTION (PDL OV)
  2587
  2588	002710'	200340	000422*	SETTR2::MOVE	T2,%UPT+UPTPOV
  2589	002711'	256200	003336'		UMOVEM	T2,(W)
  2590	002712'	322300	002703*		JUMPE	T1,CPOPJ		;0 IS ERR REQUEST
  2591	002713'	607300	777000		TLNN	T1,777000		;MONITOR TO HANDLE?
  2592	002714'	201300	002615*		 MOVEI	T1,ERRPOV		;YES
  2593	002715'	202300	000422*		MOVEM	T1,%UPT+UPTPOV
  2594	002716'	254000	002707*		JRST	CPOPJ1
  2595
  2596				;SET TIMER TO GIVE INTERRUPT
  2597
  2598	002717'	135340	003334'	SETTIM::LDB	T2,[POINT HISTIM,T1,HINTIM]	;GET TYPE (MS, SEC, MIN)
  2599	002720'	553000	000006		HRRZS	T1
  2600	002721'	256007	002733'		XCT	TIMTAB(T2)
  2601	002722'	220300	002455*		IMUL	T1,JFYSEC
  2602	002723'	231300	001750		IDIVI	T1,^D1000		;MS TO JIFFIES
  2603	002724'	622300	400000		TRZE	T1,1B18
  2604	002725'	201300	377777		 MOVEI	T1,377777		;CONVERT LARGEST TO SOMETHING ELSE
  2605	002726'	201340	000101	SETIM1:	MOVEI	T2,<.SLTIM>B30!1B35	;DISP (6) 2B30 TYPE (5) 1B35
  2606	002727'	137340	003353'		DPB	T2,[POINT 11,T1,11]	;SET UP DISPATCH AND TYPE
  2607	002730'	137100	003354'		DPB	J,[POINT 7,T1,18]	;AND JOB
  2608	002731'	350001	000000		AOS	(P)
  2609	002732'	254000	002377*		JRST	CHGCLK			;PUT IN REQUEST
  2610
  2611	002733'	255000	000000	TIMTAB:	JFCL				;MILLI-SECONDS
  2612	002734'	254000	002737'		JRST	TIMSEC			;SECONDS
  2613	002735'	254000	002743'		JRST	TIMMIN			;MINUTES
  2614	002736'	254000	002743'		JRST	TIMMIN			;UNDEF. MINUTES FOR NOW
  2615
  2616	002737'	661300	400000	TIMSEC:	TLO	T1,(1B0)
  2617	002740'	622300	600000		TRZE	T1,3B19
  2618	002741'	541300	177777		 HRRI	T1,177777		;OVERFLOW SET MAX
  2619	002742'	254000	002726'		JRST	SETIM1
  2620
  2621			000002	XP .SLTIM,2
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 32
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2622	002743'	661300	400000	TIMMIN:	TLO	T1,(1B0)
  2623	002744'	622300	600000		TRZE	T1,3B19
  2624	002745'	541300	177777		 HRRI	T1,177777		;OVERFLOW, SET MAX
  2625	002746'	660300	200000		TRO	T1,1B19			;SET FOR MIN
  2626	002747'	254000	002726'		JRST	SETIM1
  2627
  2628	002750'	200100	000006	TIMWAK::MOVE	J,T1			;HERE WHEN TIMER GOES OFF
  2629	002751'	135300	000000*		LDB	T1,JBYTIM##
  2630	002752'	324740	001757'		PJRST	TAKTRP
  2631
  2632				; Here from UUOCON for SETMCY CALLI to set micro-cycle
  2633				; timer from argument in T1. Error returns if arg is negative.
  2634
  2635	002753'	402000	000000*	SETMCY::SETZM	%UPT+UPTMTM##	;Clear previous timer (if any)
  2636	002754'	321300	002712*		JUMPL	T1,CPOPJ	;If negative, give error return
  2637	002755'	261040	000006		PUSH	P,T1		;Preserve
  2638	002756'	260040	002362*		PUSHJ	P,TIMADJ	;Adjust u-cycles for timer accuracy
  2639	002757'	262040	000006		POP	P,T1		;Restore
  2640	002760'	212300	000000*		MOVNM	T1,%UPT+UPTMTM##;Set timer to -<interval>
  2641	002761'	324740	002716*		PJRST	CPOPJ1		;And skip-return
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 33
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2642				;HERE TO SET AN INTERRUPT
  2643
  2644	002762'	554400	000006	INTASS::HLRZ	T3,T1		;THE INTERRUPT NUMBER
  2645	002763'	553000	000006		HRRZS	T1		;THE CHANNEL NUMBER
  2646	002764'	307300	000043		CAIG	T1,^D35
  2647	002765'	301400	000000*		CAIL	T3,INTRNM
  2648	002766'	263040	000000		 POPJ	P,		;BAD ARGUMENT
  2649	002767'	335002	002675*		SKIPGE	JBTPIP(J)	;MUST BE NEW SYSTEM
  2650	002770'	263040	000000		 POPJ	P,
  2651	002771'	135350	000000*		LDB	T2,INTBYP(T3)
  2652	002772'	256200	003336'		XCTTU	<MOVEM T2,(W)>	;RETURN OLD
  2653	002773'	137310	002771*		DPB	T1,INTBYP(T3)	;SET CHANNEL
  2654	002774'	256010	002776'		XCT	INTSET(T3)	;AND CHECK FURTHER WORK
  2655	002775'	254000	002761*		JRST	CPOPJ1
  2656
  2657	002776'	254000	003015'	INTSET:	JRST	INTUUO		;(0) UUO
  2658	002777'	254000	003027'		JRST	INTCLK		;(1) CLOCK
  2659	003000'	254000	003022'		JRST	INTILM		;(2) ILL MEM REF
  2660	003001'	254000	002775*		JRST	CPOPJ1		;(3) HUNG DEVICE
  2661	003002'	254000	003001*		JRST	CPOPJ1		;(4) TIMER
  2662	003003'	254000	003002*		JRST	CPOPJ1		;(5) DEVICE ERROR
  2663	003004'	254000	003036'		JRST	INTWAK		;(6) ENABLE FOR WAKE UUO
  2664	003005'	254000	003003*		JRST	CPOPJ1		;(7) UWS FAULT, SIZE AT LEAST LIMIT
  2665	003006'	254000	003005*		JRST	CPOPJ1		;(10) UWS TRAP, SIZE LESS THAN LIMIT
  2666	003007'	254000	003006*		JRST	CPOPJ1		;(11) REF BIT TRAP
  2667	003010'	254000	003007*		JRST	CPOPJ1		;(12) TRAP ON I/O ERRORS.
  2668	003011'	254000	003010*		JRST	CPOPJ1		;(13) NOTICE TO QUIT (TO BE HUNG)
  2669	003012'	254000	003034'		JRST	INTEXC		;(14) FRAME EXIT INTERRUPT
  2670	003013'	402000	000000*		SETZM	%UPT+UPTMTM	;(15) Micro-cycle interrupt timer
  2671	003014'	254000	003011*		JRST	CPOPJ1		;(16) TRU Limit
  2672
  2673	003015'	201340	002222'	INTUUO:	MOVEI	T2,UUOPTT
  2674	003016'	336000	000006		SKIPN	T1
  2675	003017'	201340	002617*		 MOVEI	T2,UUOPNT
  2676	003020'	542340	000436*		HRRM	T2,%UPT+UPTPNT
  2677	003021'	254000	003014*		JRST	CPOPJ1
  2678
  2679	003022'	201340	002613*	INTILM:	MOVEI	T2,USRMPE
  2680	003023'	332000	000006		SKIPE	T1
  2681	003024'	201340	002140*		 MOVEI	T2,USRMPT
  2682	003025'	202340	000420*		MOVEM	T2,%UPT+UPTPGT
  2683	003026'	254000	003021*		JRST	CPOPJ1
  2684
  2685	003027'	336000	000006	INTCLK:	SKIPN	T1
  2686	003030'	634340	000007		 TDZA	T2,T2		;SET A 0 IF DISABLE
  2687	003031'	201340	001000		  MOVEI	T2,ENBCLK
  2688	003032'	542340	000000*		HRRM	T2,%UPT+UPTENB
  2689	003033'	254000	003026*		JRST	CPOPJ1
  2690
  2691				EXTERNAL INTRNM,INTBYP
  2692
  2693	003034'	201340	000400	INTEXC:	MOVEI	T2,EXCFLG
  2694	003035'	334000	000000		SKIPA
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 33-2
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2695	003036'	201340	200000	INTWAK:	MOVEI	T2,WAKFLG
  2696	003037'	350001	000000		AOS	(P)		;WILL ALWAYS SKIP RETURN
  2697	003040'	616342	002554*		TDNN	T2,JBTSTS(J)	;WAITING ALREADY?
  2698	003041'	263040	000000		 POPJ	P,		;NO, OK
  2699	003042'	412342	003040*		ANDCAM	T2,JBTSTS(J)	;CLEAR FLAG
  2700	003043'	254000	001757'		JRST	TAKTRP		;AND GO
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2701				;HERE FOR CHECKING ON A DEVICE ERROR
  2702
  2703	003044'	200004	000002	DEVECK::MOVE	S,DEVIOS(F)
  2704	003045'	200304	000004	DEVEC1::MOVE	T1,DEVMOD(F)
  2705	003046'	603300	000020		TLNE	T1,DVMTA
  2706	003047'	606000	002000		 TRNN	S,IOTEND	;IS IT MTA AND END OF TAPE?
  2707	003050'	602000	760000		  TRNE	S,IOBKTL+IODTER+IODERR+IOIMPM+IODEND
  2708	003051'	334000	000000		   SKIPA		;AN ERROR
  2709	003052'	263040	000000		  POPJ	P,		;NO ERROR
  2710	003053'	135100	002023*		LDB	J,PJOBN##
  2711	003054'	135300	000000*		LDB	T1,JBYERR##
  2712	003055'	260040	002002'		PUSHJ	P,TSTKTP
  2713	003056'	263040	000000		 POPJ	P,		;TAKEN
  2714	003057'	263040	000000		POPJ	P,		;COULD NOT TAKE, IGNORE
  2715
  2716
  2717				;THIS ROUTINE IS USED TO CLEAR INTERUPT SYSTEM
  2718				;USED PRINCIPLY FROM MONSTR
  2719				;J MUST HAVE JOB NUMBER
  2720
  2721	003060'	402002	002673*	CLRINT::SETZM	JBTAWQ(J)		;NOT WAITING FOR ANY
  2722	003061'	402002	002667*		SETZM	JBTENB(J)		;NOTHING ENABLED
  2723	003062'	402002	002767*		SETZM	JBTPIP(J)		;AND NOTHING IN PROGRESS
  2724	003063'	263040	000000		POPJ	P,
  2725
  2726				;Routine to check access bits in T1.  Call with "MAP T1,ADDR", "PUSHJ P,FLTCHK"
  2727				IFCPU (KI),<
  2728				FLTCHK::TRNE	T1,400000	;IS IT OK?
  2729					TRNN	T1,20000
  2730					 JRST	CPOPJ1##	;YES, SKIP RETURN
  2731					POPJ	P,		;NO, NON SKIP
  2732				>;END IFN FTKI10
  2733
  2734				IFNCPU(KI),<
  2735	003064'	607300	001000	FLTCHK::TLNN	T1,(1B8)	;PAGED REFERENCE?
  2736	003065'	254000	003033*		 JRST	CPOPJ1##	;NO, WILL NOT FAULT
  2737	003066'	607300	200000		TLNN	T1,(1B1)	;BAD FAIL OR
  2738	003067'	607300	100000		TLNN	T1,(1B2)	;NOT ACCESS ALLOWED?
  2739	003070'	263040	000000		 POPJ	P,		;YES TO EITHER, WILL FAULT
  2740	003071'	254000	003065*		JRST	CPOPJ1##	;REF OK. WIN.
  2741				>;END IFN FTKL10!FTKS10
  2742
  2743	003072'	260040	000000*		$END	(PIC)

  2744	003073'	656557	436462

  2745	003074'	000002	000000

  2746	003075'	401000	000000

  2747	003076'	260040	003072*

  2748	003077'	656557	726462
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-2
PICON.MAC	30-OCT-87 17:26		HIBER uuo


  2749	003100'	000001	000000

  2750	003101'	000000*	000000*

  2751	003102'	260040	003076*

  2752	003103'	656557	636462

  2753	003104'	000004	000000

  2754	003105'	000000*	000000*

  2755	003106'	000000	000000*

  2756	003107'	000000*	000000*

  2757	003110'	200040	000001

  2758	003111'	260040	003102*

  2759	003112'	656557	416364

  2760	003113'	000002	000000

  2761	003114'	260040	003111*

  2762	003115'	416062	464164

  2763	003116'	400004	000000

  2764	003117'	000000	000470'

  2765	003120'	260040	003114*

  2766	003121'	416062	676256

  2767	003122'	400003	000154'

  2768	003123'	000000	000533*

  2769	003124'	260040	003120*

  2770	003125'	416062	645155

  2771	003126'	000003	000000

  2772	003127'	777777	777770

  2773	003130'	260040	003124*

  2774	003131'	436241	635000

PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-3
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2775	003132'	400001	000000

  2776	003133'	000000	000232'

  2777	003134'	004000	000555'

  2778	003135'	602740	000774

  2779	003136'	271740	037773

  2780	003137'	700200	027400

  2781	003140'	254000	000341'

  2782	003141'	000017	777777

  2783	003142'	064240	000000

  2784	003143'	220300	000014

  2785	003144'	251244	020202

  2786	003145'	502444	071750

  2787	003146'	607516	571564

  2788	003147'	200000	000000

  2789	003150'	472611	536634

  2790	003151'	677354	574322

  2791	003152'	717514	167350

  2792	003153'	203334	566736

  2793	003154'	713624	000000

  2794	003155'	502570	636640

  2795	003156'	677574	571100

  2796	003157'	633035	166352

  2797	003160'	713124	000000

  2798	003161'	446370	636622

  2799	003162'	475016	060716

  2800	003163'	625014	660722

  2801	003164'	663536	262500
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-4
PICON.MAC	30-OCT-87 17:26		HIBER uuo


  2802	003165'	000000	000000

  2803	003166'	416112	036606

  2804	003167'	607075	062500

  2805	003170'	623236	262706

  2806	003171'	723376	274500

  2807	003172'	703036	264750

  2808	003173'	745000	000000

  2809	003174'	406112	036602

  2810	003175'	623116	262746

  2811	003176'	715016	060744

  2812	003177'	647517	120000

  2813	003200'	260040	003130*

  2814	003201'	565242	604562

  2815	003202'	000004	000000

  2816	003203'	000000*	000000*

  2817	003204'	257154	000000

  2818	003205'	260040	003200*

  2819	003206'	656064	604562

  2820	003207'	000001	000000

  2821	003210'	435600	000777

  2822	003211'	254000	000655'

  2823	003212'	260040	003205*

  2824	003213'	416062	506045

  2825	003214'	000004	000000

  2826	003215'	064252	550250

  2827	003216'	203414	163712

PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-5
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2828	003217'	203414	171322

  2829	003220'	723624	062744

  2830	003221'	713376	226100

  2831	003222'	663374	360750

  2832	003223'	647375	600000

  2833	003224'	201724	000000

  2834	003225'	064250	244650

  2835	003226'	202112	247640

  2836	003227'	502130	400000

  2837	003230'	064252	044606

  2838	003231'	456130	420204

  2839	003232'	446500	000000

  2840	003233'	064252	044606

  2841	003234'	456130	420240

  2842	003235'	406451	152262

  2843	003236'	000000	000000

  2844	003237'	000320	000323

  2845	003240'	000150	000153

  2846	003241'	000064	000067

  2847	003242'	000032	000035

  2848	003243'	552313	000000

  2849	003244'	001243'	001244'

  2850	003245'	000000*	000001*

  2851	003246'	200346	000000

  2852	003247'	550346	000001

  2853	003250'	550406	000002

  2854	003251'	200446	000003
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-6
PICON.MAC	30-OCT-87 17:26		HIBER uuo


  2855	003252'	554346	000004

  2856	003253'	254000	001545'

  2857	003254'	200346	000005

  2858	003255'	254000	001550'

  2859	003256'	200306	001545*

  2860	003257'	550306	000004

  2861	003260'	001127'	001130'

  2862	003261'	060000	060000

  2863	003262'	264000	001475'

  2864	003263'	200300	001230'

  2865	003264'	202300	000514*

  2866	003265'	553000	001231'

  2867	003266'	353300	000255'

  2868	003267'	463300	000255'

  2869	003270'	702226	000254'

  2870	003271'	254000	001561'

  2871	003272'	463300	000255'

  2872	003273'	200300	001126'

  2873	003274'	702206	777777

  2874	003275'	254000	001523'

  2875	003276'	336300	002361*

  2876	003277'	354000	001247'

  2877	003300'	350000	001245'

  2878	003301'	336000	001242'

  2879	003302'	254000	001561'

  2880	003303'	254000	001543'

PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-7
PICON.MAC	30-OCT-87 17:26		HIBER uuo

  2881	003304'	202346	777777

  2882	003305'	777762	001243'

  2883	003306'	000000*	001350*

  2884	003307'	251310	000000

  2885	003310'	202313	000000

  2886	003311'	202406	000000

  2887	003312'	540406	000001

  2888	003313'	202300	000000*

  2889	003314'	202400	000000*

  2890	003315'	540400	000000*

  2891	003316'	202300	003315*

  2892	003317'	000000*	000000*

  2893	003320'	000000*	000000*

  2894	003321'	202540	000000*

  2895	003322'	200346	000002

  2896	003323'	202353	000000

  2897	003324'	200313	000000

  2898	003325'	200313	000001

  2899	003326'	200350	000000

  2900	003327'	550202	002157*

  2901	003330'	254000	002411'

  2902	003331'	331100	000006

  2903	003332'	413342	003042*

  2904	003333'	263040	000000

  2905	003334'	220200	000006

  2906	003335'	402012	000000

  2907	003336'	202352	000000
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 34-8
PICON.MAC	30-OCT-87 17:26		HIBER uuo


  2908	003337'	301402	000000*

  2909	003340'	262040	000002

  2910	003341'	254000	002554'

  2911	003342'	202312	000000

  2912	003343'	205340	400000

  2913	003344'	436342	000000*

  2914	003345'	205340	100000

  2915	003346'	436342	002552*

  2916	003347'	254000	001757'

  2917	003350'	335002	003062*

  2918	003351'	263040	000000

  2919	003352'	254000	002576'

  2920	003353'	301300	000006

  2921	003354'	210700	000006

  2922						;End of PICON  (PICLIT: PICEND:)
  2923
NO ERRORS DETECTED
PROGRAM BREAK IS 003356
9K CORE USED
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 35
PICON.MAC	30-OCT-87 17:26		SYMBOL TABLE

ABTUUO		002357'	INT	CLKPC1		002072'	INT	DTE		000200	SPD	HFCNTB		001243'	SPD
ALR620		000663'	EXT	CLKPC2		002073'	INT	DVMTA		000020	SIN	HFCSPN		001121'	
ALRCTY		000400	SIN	CLKTO1		002106'		ECOD		001271'		HFCSPT		001545'	
APFMSK		003340	SIN	CLKTR1		002064'	INT	ENBCHR		004000	SIN	HFCTGL		000016	SPD
APR		000000	SPD	CLKTRO		002076'		ENBCLK		001000	SIN	HFDBUF		001653'	EXT
APRCHL		001524'	EXT	CLKTRP		002047'	INT	ENBESC		002000	SIN	HFDSIZ		001123'	
APRCHN		000000	EXT	CLRINT		003060'	INT	ENBFOV		000100	SIN	HFFMAX		000002	SPD
APRCSH		000256'		CLRNXM		027400	SIN	ENBHMS		000040	SIN	HFFMIN		000000	SPD
APRDIS		002116'		CLRPT	701100	000000		ENBHNG		000020	SIN	HFGHT		001557'	
APRENB		002115'	INT	COMINT		002211'		ENBLIN		040000	SIN	HFHI		001117'	
APRER1		000324'		COMNT1		002213'	INT	ENBMPT		020000	SIN	HFHIST		001550'	
APRER2		000341'		COMNT2		002210'	INT	ENBOV		000010	SIN	HFITTB		001126'	
APRER3		000366'		CONMES		000503'	EXT	ENBPDL		200000	SIN	HFJOB		001543'	
APRER6		000322'		CPOPJ		002754'	EXT	ENBRPT		400000	SIN	HFLOW		001116'	
APREXT		000217'		CPOPJ1		003071'	EXT	ENBUUO		100000	SIN	HFLSHC		001555'	
APRFAT		000157'	INT	CPUF3		000004	SPD	EPLLEN		000000	EXT	HFMODE		001242'	
APRHPE		000704'	INT	CPUKI		000001	SPD	EPT		000000	EXT	HFOOR		001560'	
APRIN1		000166'		CPUKL		000002	SPD	EPT.PN		000000	EXT	HFPIMK		001115'	
APRINT		000153'	INT	CPUKS		000003	SPD	EPTEBR		000000	EXT	HFPITB		001232'	
APRMSG		000506'		CPUSTS		000532'	EXT	EPTITI		000514	SIN	HFRUN		000002	SPD
APRMSK		007760	SIN	CPUTYP		000002	SPD	EPYPSN		001100'	EXT	HFSFC		001120'	
APRMSL		000005	SPD	CPZZ		000001	SPD	ERR00		001261'		HFSTOP		000001	SPD
APRNXM		007000	SIN	CRASH		000230'	INT	ERR01		001262'		HFSTS		001115'	
APRPAR		000400	SIN	CRASH1		000222'		ERR02		001263'		HFUPTM		001122'	
APRPR1		000306'		CRASH2		000224'	EXT	ERR03		001264'		HFUSNP		000001	SPD
APRPR2		000313'		CRS147		000035'	EXT	ERR04		001265'		HFZAPD		000000	SPD
APRPR4		000354'		CRSCHK		000206'	INT	ERR05		001266'		HIBCHR		000010	SIN
APRTIM		000177'	INT	CRSHWD		000206'	EXT	ERR06		001267'		HIBER		002401'	INT
APRWRN		000174'	INT	CSHSAV		000305'	INT	ERR07		001270'		HIBFEX		000400	SIN
APRXXX		000530'		CSUCNT		000303'	INT	ERRPAR		000731'	EXT	HIBLIN		000020	SIN
ARGCSP		000005	SPD	CSUNL		000267'	INT	ERRPOV		002714'	EXT	HIBMIN		002477'	
ARGHI		000002	SPD	CSVAL		000276'	INT	ESTOP		000000	EXT	HIBNOT		002426'	
ARGJOB		000004	SPD	CSVCNT		000304'	INT	EVICT		002521'	INT	HIBNTY		002432'	
ARGLOW		000001	SPD	CSVINS		000277'		EVICT1		002554'		HIBNUM		000003	SPD
ARGPI		000000	SPD	CURUPT		000735'	EXT	EX0ACB		000001	SIN	HIBNWK		002451'	
ARGRES		000003	SPD	DATVER		000037	SPD	EX1ACB		000002	SIN	HIBPRT		000100	SIN
ARGSIC		000004	SPD	DEALMS		001056'	EXT	EXCFLG		000400	SIN	HIBPST		002411'	
ASTER		000513'		DEVEC1		003045'	INT	EXCMPE		003106'	EXT	HIBSEC		002473'	
BADPAG		200000	SPD	DEVECK		003044'	INT	EXCPAR		000313'		HIBTAB		002466'	
BADTRP		000001	SIN	DEVIOS		000002	SIN	F		000004	INT	HIBTB1		002462'	
BPPAGE		001033'		DEVMOD		000004	SIN	FARCHK		002525'	EXT	HIBTTY		002414'	
BPPG1		001057'		DIE		003212'	EXT	FLGCHR		000400	SIN	HIBWAK		002027'	
BPPG2		001060'		DISMIS		002270'	INT	FLGESC		000001	SIN	HIBWK1		002032'	
BPPG3		001067'		DISNEW		002317'		FLGFOV		000100	SIN	HIBWK2		002033'	
BUGTY0		000424'		DISTPC		002336'		FLGLIN		004000	SIN	HIBWKU		000200	SIN
BUGTY6		000415'		DM30.1		000224'	INT	FLGOV		000010	SIN	HIBYLB		000040	SIN
BUGTYP		000410'		DONMSG		000462'		FLGPDL		200000	SIN	HIGHJB		000000	EXT
CHGCLK		002732'	EXT	DSBALL		002644'		FLGUUO		400000	SIN	HINPRT		000010	SIN
CHKBAS		000227'	EXT	DSBCHL		002645'		FLTCHK		003064'	INT	HINTIM		000021	SIN
CLKFLG		001513'	EXT	DSBUUO		002245'		FNDPRT		002407'	EXT	HISPRT		000011	SIN
CLKJOB		002376'	EXT	DSKPIF		001062'	EXT	FOUNDP		100000	SPD	HISTIM		000002	SIN
CLKNEW		002264'		DSKPIN		001066'	EXT	GETCTY		000566'	EXT	HISTOT		001244'	
CLKNTP		002672'		DTE		000200	SPD	GETOPR		000000	EXT	HRDUPE		001002'	
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 35-2
PICON.MAC	30-OCT-87 17:26		SYMBOL TABLE

HWDPNT		000240'	EXT	JFYSEC		002722'	EXT	PAG		000010	SPD	RDHNL%		000001	SIN
ILWQ		001776'	EXT	JNA		040000	SIN	PARCMP		000777'		RDHNR%		000003	SIN
INLMES		001025'	EXT	JOB		003276'	EXT	PARFLG		000316'	EXT	RDHS2		001600'	
INSOHT		001063'	EXT	JOB1		000730'	EXT	PARLEN		000003	SPD	RDHS3		001633'	
INTACT		002651'	INT	JOBAPR		003316'	EXT	PARMSG		000450'		RDHS3A		001634'	
INTAD1		002576'		JOBCNI		003313'	EXT	PARPC		000564'	EXT	RDHS3B		001641'	
INTAD2		002621'		JOBMUU		003321'	EXT	PARPRT		000771'		RDHS4		001645'	
INTADR		002566'	INT	JOBN		000000	EXT	PARSET		000774'		RDHZP%		000002	SIN
INTASS		002762'	INT	JOBTPC		003314'	EXT	PARSFT		001011'		RDPI	700640	000000	
INTBYP		002773'	EXT	JS.EVI		100000	SIN	PARSPR		000661'	EXT	REDPIP		002675'	INT
INTCLK		003027'		JS.EVP		040000	SIN	PARTOT		000632'	EXT	REMCHT		001110'	EXT
INTENB		002632'	INT	KTRRET		000116'	INT	PARWRD		001031'	EXT	REQCLK		001514'	EXT
INTEXC		003034'		KTRRT1		000115'	INT	PC.ADR		001000	SIN	REQUE		000000	EXT
INTILM		003022'		KTRRT2		000127'		PC.FOV		040000	SIN	RHNLIC		001262'	SPD
INTRNM		002765'	EXT	KTRRT3		000144'		PC.FPD		020000	SIN	RHNORM		001662'	
INTSET		002776'		LG.LAB	400000	000000	SPD	PC.FXU		000100	SIN	RHZAPD		001263'	SPD
INTUUO		003015'		LG.PAC	000700	000000	SPD	PC.PUB		002000	SIN	RNQ		002033'	EXT
INTWAK		003036'		LHFITT		000100	SPD	PC.TRP		000600	SIN	RSCMSG		000434'	
IOBKTL		040000	SIN	LI.PIF		000400	SPD	PC.UIO		004000	SIN	RSTCH1		002664'	
IODEND		020000	SIN	LI.PIN		000200	SPD	PC.USR		010000	SIN	RSTCHL		002662'	
IODERR		200000	SIN	LICSPY		200000	SIN	PDNMUP		002335'	EXT	S		000000	INT
IODTER		100000	SIN	LICWCR		400000	SIN	PFW.A		100000	SIN	S$CPU		000004	SIN
IOIMPM		400000	SIN	LMPNER		000725'	EXT	PFW.H		200000	SIN	S$DEBU		000003	SIN
IOTEND		002000	SIN	LP.ADP		000100	SPD	PG		000003	INT	S$ENTR	777777	777775	SIN
ITMCHN		000000	EXT	LP.CDP		000200	SPD	PG0UPE		040000	SPD	S$EVEN		000006	SIN
ITMINT		000175'	INT	LP.CSD		000020	SPD	PGE.A		400000	SIN	S$HALT	777777	777777	SIN
ITMPTR		000255'		LP.CSF		020000	SPD	PGE.P		200000	SIN	S$INFO		000005	SIN
ITMTBL		000254'		LP.DSF		040000	SPD	PGE.W		100000	SIN	S$JOB		000002	SIN
ITMTBS		000252'		LP.ESF		100000	SPD	PGFAI1		000042'		S$NAME		000000'	SPD
J		000002	INT	LP.IOF		001000	SPD	PGFAIL		000025'	INT	S$NONA		000000	SIN
JBTAWQ		003060'	EXT	LP.NXM		002000	SPD	PGFPCT		000045'		S$PATC		000007	SIN
JBTENB		003061'	EXT	LP.PAR		000400	SPD	PGFUIO		000024'	INT	S$STOP		000001	SIN
JBTFNT		002605'	EXT	LP.PWF		000040	SPD	PGYADR		001050'	EXT	S$TEMP	777776	000000	SPD
JBTFTR		003337'	EXT	LP.SBE		004000	SPD	PGYDIO		001041'	EXT	S$XCT	777777	777776	SIN
JBTICT		002375'	EXT	LSICTB		000004	SPD	PGYDRT		001052'	EXT	S..EUE		000022'	EXT
JBTINT		002604'	EXT	M		000013	INT	PGYSOP		001106'	EXT	SAV30		000245'	EXT
JBTLIC		001566'	EXT	MLOWQ		000000	EXT	PGYUSE		001074'	EXT	SAVAPR		000477'	EXT
JBTNAM		003256'	EXT	MO.LAC		400000	SPD	PHOLD		000000	EXT	SAVERA		000163'	EXT
JBTPIP		003350'	EXT	MTR		000024	SPD	PICEND		003355'	INT	SAVSB0		000164'	EXT
JBTPRV		003344'	EXT	NJBPER		000562'	INT	PICLIT		003072'	INT	SAVSB1		000165'	EXT
JBTST2		003346'	EXT	NODIE		000000	EXT	PICNT		001251'		SAVT1		000220'	
JBTSTS		003332'	EXT	NODSSC		002307'		PICON		000000'	ENT	SAVT12		001226'	
JBTUPM		000000	EXT	NOHIB		002471'		PJBSTS		002034'	EXT	SBDIAG	700500	000000	
JBYCLK		002264'	EXT	NONMSG		000444'		PJOBN		003053'	EXT	SCNLMC		001054'	EXT
JBYERR		003054'	EXT	NULCNT		001247'		PJRST	324740	000000		SETIM1		002726'	
JBYEXC		002450'	EXT	OCTPNT		001032'	EXT	PRNAME		000246'	EXT	SETMCY		002753'	INT
JBYHNG		002154'	EXT	OHTPAR		001064'	EXT	PRT30		000232'		SETPOV		002113'	INT
JBYNIC		002535'	EXT	OHTTAB		001065'	EXT	PRTKEY		000251'	EXT	SETR2		002035'	EXT
JBYNTQ		002561'	EXT	OORCNT		001246'		PVLOS		400000	SIN	SETSLP		002400'	EXT
JBYTIM		002751'	EXT	P		000001	INT	PX.MEM		000004	SPD	SETTIM		002717'	INT
JBYUUO		002340'	EXT	P1		000014	INT	PXCT	256000	000000		SETTR1		002701'	INT
JBYWAK		002514'	EXT	P2		000015	INT	RDERA	700400	000000		SETTR2		002710'	INT
JFYSEC		002722'	EXT	P3		000016	INT	RDHIST		001563'	INT	SICTB		001111'	
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 35-3
PICON.MAC	30-OCT-87 17:26		SYMBOL TABLE

SINTB		003306'	EXT	T1		000006	INT	TTYYLS		002431'	EXT	UUOKTR		000015'	INT
SINTBS		000000	EXT	T2		000007	INT	TYPAPL		000475'		UUOOK		002346'	
SLEEP		002364'	INT	T3		000010	INT	TYPAPR		000470'		UUOPN1		002247'	EXT
SLEEP1		002375'		T4		000011	INT	TYPCSB		003123'	EXT	UUOPNT		003017'	EXT
SLEEP2		002373'		TAKNZJ		002023'	INT	U		000005	INT	UUOPTR		000004'	INT
SLPQ		002030'	EXT	TAKOT1		002007'		UPDKEY		001507'	EXT	UUOPTT		002222'	
SNDSP		001274'		TAKOT2		002020'		UPE0		000574'		UUOSTR		000014'	INT
SNGO		001332'		TAKOTJ		002005'	INT	UPE1		000623'		UUOZTR		000006'	INT
SNGO1		001360'		TAKOTP		002006'		UPEB1		000600'		W		000012	INT
SNGO2		001431'		TAKTR1		001767'		UPEBA		000732'		WAKFLG		200000	SIN
SNGO3		001451'		TAKTR2		001762'		UPED		000631'		WAKUUO		002504'	INT
SNITMX		001125'		TAKTR3		001771'		UPED2		000636'		WRAPR	700200	000000	
SNITPT		001124'		TAKTRJ		001756'	INT	UPED2A		000644'		WRPI	700600	000000	
SNNMI		001467'		TAKTRP		001757'	INT	UPEG		000716'		WRUBR	701140	000000	
SNOOAR		001264'	SPD	THSDAT		001456'	EXT	UPEH		000676'		WSCHED		000724'	EXT
SNOOBF		001263'	SPD	TI.TOV		010000	SPD	UPEH1		000714'		XACSTL		000000	EXT
SNOOBI		001267'	SPD	TIM		000020	SPD	UPEHR2		000760'		XXPDL		000535'	
SNOOBJ		001270'	SPD	TIMADJ		002756'	EXT	UPEHRD		000747'		XXQ		000000	SPD
SNOOBL		001265'	SPD	TIME		001510'	EXT	UPENXA		000655'		ZZ	005557	664555	SPD
SNOOBR		001266'	SPD	TIMEF		001512'	EXT	UPETF		000656'		%UPLMA		000727'	EXT
SNOOJB		001231'		TIMMIN		002743'		UPSJOB		001101'	EXT	%UPS		001102'	EXT
SNOONL		001262'	SPD	TIMSEC		002737'		UPTAC0		000000	EXT	%UPT		000000	EXT
SNOOP1		001522'		TIMTAB		002733'		UPTACP		000000	EXT	%ZZ		000100	SPD
SNOOP2		001523'		TIMWAK		002750'	INT	UPTENB		000000	EXT	.ARHLT		000052	SIN
SNOOPI		001475'	INT	TINAS1		002422'	EXT	UPTIME		001511'	EXT	.ARWAK		000061	SIN
SNOOPU		001277'	INT	TIOWQ		001774'	EXT	UPTMTM		000000	EXT	.CPDWD		000225'	EXT
SNOOX		001561'		TO.CTD		020000	SPD	UPTMUP		000425	SIN	.DTCTO		004000	SIN
SNPAR%		000003	SIN	TO.SIT		040000	SPD	UPTMUU		000424	SIN	.SLTIM		000002	SIN
SNPBF%		000002	SIN	TO11DB		020000	SPD	UPTOPP		000501	SIN	.SLWAK		000000	SIN
SNPBI%		000006	SIN	TOTCNT		001243'		UPTOVT		000421	SIN	
SNPBJ%		000007	SIN	TPOPJ		002526'	EXT	UPTPC		000000	EXT	
SNPBL%		000004	SIN	TPOPJ1		002472'	EXT	UPTPDL		000000	EXT	
SNPBR%		000005	SIN	TRPBTS		001711'		UPTPER		000611'	INT	
SNPNL%		000001	SIN	TRPUUO		002234'		UPTPFW		000500	SIN	
SNSJSR		001230'		TSTARM		001704'	INT	UPTPGT		000420	SIN	
SNSTI		001463'		TSTKOT		002036'	INT	UPTPNT		000436	SIN	
SNSTOP		001322'		TSTKTJ		002001'	INT	UPTPOV		000422	SIN	
SNZAP		001312'		TSTKTP		002002'	INT	UPTTCB		000000	EXT	
SPCCMW		000451	SIN	TSTTRJ		001673'	INT	UPTTCE		000000	EXT	
SPCF11		000450	SIN	TSTTRP		001674'	INT	UPTTP1		000000	EXT	
SPCMTD		000455	SIN	TTNCHR		002466'	EXT	UPTTPN		000000	EXT	
SPCMTI		000456	SIN	TTNESC		000000	EXT	USEPER		000555'	INT	
SPECNT		001010'		TTNLIN		002467'	EXT	USRACB		000000	SIN	
SPERPT		000004	SPD	TTNYLB		002470'	EXT	USRCLK		002250'	INT	
ST.147		000035'	INT	TTSCLR		002403'	EXT	USRCNT		001245'		
STKAC		000061'	INT	TTTCLR		002601'	EXT	USRMP2		000000	EXT	
STKAC1		000073'		TTYEN1		002174'		USRMPE		003022'	EXT	
STOPUJ		400000	SPD	TTYEN2		002176'		USRMPT		003024'	EXT	
SWPUA	701540	000000		TTYENB		002161'		USROVT		002215'		
SWPVA	701500	000000		TTYRPT		000003	SPD	USRPDT		002207'		
SYSCNT		001250'		TTYTAB		003327'	EXT	USRXIT		002363'	EXT	
SYSDDT		000347'	EXT	TTYTRB		002201'		

PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

ABTUUO	  2299#	  2306	  2323
ALR620	   867%	   987
ALRCTY	   986
APFMSK	   336
APR	   332	   335	   336	   356	   362	   364	   366	   494	   603	   622	   627	   667	   871	   903
	   906	   924	   928	   954	   959	  1013	  1148	  1167
APRCHL	   383%	   383	   438%	   438	   502	   584%	   584	  1627
APRCHN	   494%	   494	   586%	   586	  1017%	  1017
APRCSH	   367	   494#
APRDIS	  2096	  2106#
APRENB	  2103	  2105#	  2248
APRER1	   610#	   630
APRER2	   626	   629#	   685
APRER3	   628	   667#
APRER6	   608#	   660
APREXT	   436#
APRFAT	   337#	   365
APRHPE	   998#
APRIN1	   357	   362#
APRINT	   332#	   368
APRMSG	   763	   766	   767	   799#	   805
APRMSK	   332
APRMSL	   765	   805#
APRNXM	   622
APRPAR	   356	   362	   627	   906	   928	   959	  1167
APRPR1	   363	   583#	   637
APRPR2	   601#
APRPR4	   640#	   664
APRTIM	   376#	  1592
APRWRN	   368#
APRXXX	   607	   815#	   872
ARGCSP	  1329#	  1443
ARGHI	  1325#	  1412
ARGJOB	  1327#	  1433
ARGLOW	  1324#	  1411
ARGPI	  1323#	  1398
ARGRES	  1326#	  1419
ARGSIC	  1328#	  1457
ASTER	   761	   771	   806#
BADPAG	   858#	   900	   940	  1135
BADTRP	   100#	   101	   101#	   121	   139
BPPAGE	   941	  1005	  1132#
BPPG1	  1154#
BPPG2	  1150	  1156#
BPPG3	  1157	  1164#
BUGTY0	   673	   674	   678	   679	   696	   705	   712#
BUGTY6	   669	   671	   676	   681	   702#	   707	  1045	  1047	  1065	  1067	  1071	  1073
BUGTYP	   606	   634	   639	   684	   693#	   697	  1038	  1060	  1063	  1069
CHGCLK	  2316	  2399%	  2609
CHKBAS	   457%	   457
CLKFLG	   433%	   433	  1607
CLKJOB	  2315%	  2315
CLKNEW	  2229	  2235#
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

CLKNTP	  2063	  2066	  2565#
CLKPC1	  2073#
CLKPC2	  2074#
CLKTO1	  2089	  2092#
CLKTR1	  2067#	  2209
CLKTRO	  2059	  2084#	  2180	  2231
CLKTRP	  2054#
CLRINT	  2515	  2721#
CLRNXM	   602	   625
COMINT	  2179#	  2190	  2202
COMNT1	  2181#	  2212
COMNT2	  2178#
CONMES	   762%	   762	   764%	   764	   769%	   769	   772%	   772
CPOPJ	  1180	  1915	  1926	  1978	  1987	  2007	  2024	  2037%	  2054	  2331	  2558	  2580	  2590	  2636
CPOPJ1	  1361	  1368	  1373	  1500	  2002	  2037%	  2043	  2046	  2447	  2459	  2573	  2584	  2594	  2641
	  2655	  2660	  2661	  2662	  2664	  2665	  2666	  2667	  2668	  2671	  2677	  2683	  2689	  2736%
	  2736	  2740%	  2740
CPUF3	   348	   587	   641	   713	   792	  1018	  1533	  1574
CPUKI	    45	    99	   339	   585	   614	   617	   641	   713	   776	   908	   909	   914	   996	   997
	  1001	  1016	  1187	  1337	  1472	  1524	  1547	  1680	  1735	  1755	  1824	  2727	  2734
CPUKL	   100	   355	   475	   490	   586	   607	   647	   720	   781	   811	   872	  1017	  1230	  1475
	  1510	  1556	  1578	  1734	  1754
CPUKS	   334	   387	   437	   449	   482	   557	   574	   584	   588	   653	   731	   788	   879	  1019
	  1202	  1210	  1234	  1484	  1517	  1565	  1631	  1736	  1757
CPUSTS	   817%	   817
CPUTYP	    45	    99	   100	   334	   339	   348	   355	   387	   437	   449	   475	   482	   490	   557
	   574	   584	   585	   586	   587	   588	   607	   614	   617	   641	   647	   653	   713	   720
	   731	   776	   781	   788	   792	   811	   872	   879	   908	   909	   914	   996	   997	  1001
	  1016	  1017	  1018	  1019	  1187	  1202	  1210	  1230	  1234	  1337	  1472	  1475	  1484	  1510
	  1517	  1524	  1533	  1547	  1556	  1565	  1574	  1578	  1631	  1680	  1734	  1735	  1736	  1754
	  1755	  1757	  1824	  2727	  2734
CPZZ	    45#	    45	    99#	    99	   100#	   100	   334#	   334	   339#	   339	   348#	   348	   355#	   355
	   387#	   387	   437#	   437	   449#	   449	   475#	   475	   482#	   482	   490#	   490	   557#	   557
	   574#	   574	   584#	   584	   585#	   585	   586#	   586	   587#	   587	   588#	   588	   607#	   607
	   614#	   614	   617#	   617	   641#	   641	   647#	   647	   653#	   653	   713#	   713	   720#	   720
	   731#	   731	   776#	   776	   781#	   781	   788#	   788	   792#	   792	   811#	   811	   872#	   872
	   879#	   879	   908#	   908	   909#	   909	   914#	   914	   996#	   996	   997#	   997	  1001#	  1001
	  1016#	  1016	  1017#	  1017	  1018#	  1018	  1019#	  1019	  1187#	  1187	  1202#	  1202	  1210#	  1210
	  1230#	  1230	  1234#	  1234	  1337#	  1337	  1472#	  1472	  1475#	  1475	  1484#	  1484	  1510#	  1510
	  1517#	  1517	  1524#	  1524	  1533#	  1533	  1547#	  1547	  1556#	  1556	  1565#	  1565	  1574#	  1574
	  1578#	  1578	  1631#	  1631	  1680#	  1680	  1734#	  1734	  1735#	  1735	  1736#	  1736	  1754#	  1754
	  1755#	  1755	  1757#	  1757	  1824#	  1824	  2727#	  2727	  2734#	  2734
CRASH	   458#	   662
CRASH1	   428	   446#	   456	   459	  1602
CRASH2	   448%	   448
CRS147	   127%	   127
CRSCHK	   384	   427#	  1601
CRSHWD	   427%	   427
CSHSAV	   552#
CSUCNT	   500	   528	   550#
CSUNL	   523#
CSVAL	   534#
CSVCNT	   495	   538	   551#
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

CSVINS	   498	   527	   535#
CURUPT	   866%	  1039
DATVER	  1811#	  1861
DEALMS	   866%	  1152
DEVEC1	  2704#
DEVECK	  2703#
DEVIOS	  2703
DEVMOD	  2704
DIE	    12	    12%	    13	    28	    33	    42	   273	   337	   368	   376	   458	   874	   910	   998
DISMIS	  2241#
DISNEW	  2242	  2265#
DISTPC	  2280#	  2522	  2536
DM30.1	   448#
DONMSG	   633	   754#
DSBALL	  2518	  2537#
DSBCHL	  2533	  2538#
DSBUUO	  2207	  2214#
DSKPIF	  1127%	  1158
DSKPIN	  1127%	  1162
DTE	   724
DVMTA	  2705
ECOD	  1273	  1274	  1275	  1276	  1277	  1278	  1279	  1280	  1282#
ENBCHR	  2162
ENBCLK	  2094	  2225	  2687
ENBESC	  2161	  2252
ENBFOV	  2120
ENBHMS	  2136
ENBHNG	  2136
ENBLIN	  2163
ENBMPT	  2124
ENBOV	  2120
ENBPDL	  2102	  2128
ENBRPT	  2093
ENBUUO	  2088	  2094	  2132
EPLLEN	    20%	    36	   129	   159	   876	  2196
EPT	   578%	   648	   650	   651	   722	   723	   725	   904	  1512	  1611
EPT.PN	   578%
EPTEBR	   904	   904%
EPTITI	  1512	  1611
EPYPSN	    23%	   613	   917	  1140	  1173
ERR00	  1273#	  1282
ERR01	  1274#	  1293	  1816
ERR02	  1275#	  1294	  1817
ERR03	  1276#	  1295	  1818
ERR04	  1277#	  1296
ERR05	  1278#	  1297
ERR06	  1279#	  1298
ERR07	  1280#	  1299
ERRPAR	   579%	  1028
ERRPOV	  2127	  2172%	  2510	  2592
ESTOP	    21%
EVICT	  2431#
EVICT1	  2439	  2444	  2452	  2461#
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

EX0ACB	    31	   128	   158	   232	   254	   293	   870	  2193
EX1ACB	   233	   254
EXCFLG	  2355	  2693
EXCMPE	   137%	   137
EXCPAR	   599#	  1048	  1076	  1168
F	  1133	  1149	  1177	  2140	  2326	  2328	  2330	  2331	  2703	  2704
FARCHK	  2409%	  2409	  2435
FLGCHR	  2167
FLGESC	  2166	  2251	  2254
FLGFOV	  2186	  2189
FLGLIN	  2168
FLGOV	  2186
FLGPDL	  2177
FLGUUO	  2201
FLTCHK	  2735#
FNDPRT	  2329	  2399%
FOUNDP	   857#	   939	   980
GETCTY	   579%	   881
GETOPR	    21%
GINST	   258#	   258	   259	   281#	   281	   282	   905#	   905	   906	   995#	   995	   996	  1283#	  1283
	  1284	  1398#	  1398	  1399	  1411#	  1411	  1412	  1412#	  1413	  1419#	  1419	  1420	  1433#	  1433
	  1434	  1443#	  1443	  1444	  1457#	  1457	  1458	  1846#	  1846	  1847	  1849#	  1849	  1850	  1852#
	  1852	  1853	  1855#	  1855	  1856	  1864#	  1864	  1865	  1867#	  1867	  1868	  1870#	  1870	  1871
	  1876#	  1876	  1877	  1883#	  1883	  1884	  1893#	  1893	  1894	  1905#	  1905	  1906	  2073#	  2073
	  2074	  2074#	  2075	  2085#	  2085	  2086	  2086#	  2087	  2092#	  2092	  2093	  2101#	  2101	  2102
	  2200#	  2200	  2201	  2208#	  2208	  2209	  2243#	  2243	  2244	  2244#	  2245	  2247#	  2247	  2248
	  2256#	  2256	  2257	  2273#	  2273	  2274	  2431#	  2431	  2432	  2445#	  2445	  2446	  2467#	  2467
	  2468	  2489#	  2489	  2490	  2531#	  2531	  2532	  2551#	  2551	  2552	  2572#	  2572	  2573	  2579#
	  2579	  2580	  2589#	  2589	  2590	  2652#	  2652	  2653
HFCNTB	  1244#	  1252	  1391	  1392	  1393	  1873
HFCSPN	  1223#	  1444	  1731	  1865
HFCSPT	  1437	  1449	  1730#	  1857
HFCTGL	  1252#	  1393	  1873	  1902
HFDBUF	  1186%	  1335	  1384	  1385	  1426	  1452	  1822	  1892
HFDSIZ	  1225#	  1356	  1429	  1887	  1890	  1901
HFFMAX	  1309#	  1347
HFFMIN	  1306#	  1348
HFGHT	  1454	  1745#
HFHI	  1221#	  1415	  1737	  1850
HFHIST	  1446	  1733#
HFITTB	  1228#	  1469	  1470	  1471	  1477	  1480	  1620	  1625
HFJOB	  1440	  1716	  1728#	  1856
HFLOW	  1220#	  1416	  1738	  1740	  1847
HFLSHC	  1431	  1741#	  1853
HFMODE	  1241#	  1402	  1714	  1725
HFOOR	  1739	  1749#
HFPIMK	  1218#	  1399
HFPITB	  1238#	  1407	  1723
HFRUN	  1310#	  1357	  1369	  1382	  1498	  1835	  1896	  1907
HFSFC	  1222#	  1465	  1860
HFSTOP	  1308#	  1371
HFSTS	  1219#	  1354	  1360	  1366	  1372	  1381	  1499	  1832	  1844	  1894	  1906
HFUPTM	  1224#	  1355	  1497	  1868
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

HFUSNP	  1216#	  1401
HFZAPD	  1307#	  1359	  1367	  1833
HIBCHR	  2379
HIBER	  2322#
HIBFEX	  2349	  2354	  2362
HIBLIN	  2380
HIBMIN	  2376	  2377	  2393#
HIBNOT	  2336	  2344#
HIBNTY	  2348#
HIBNUM	  2332	  2383#
HIBNWK	  2350	  2364#
HIBPRT	  2325
HIBPST	  2327	  2331#
HIBSEC	  2375	  2388#
HIBTAB	  2335	  2339	  2379#	  2383
HIBTB1	  2367	  2374#
HIBTTY	  2334#	  2344
HIBWAK	  1980	  2009	  2028#
HIBWK1	  1990	  2031#
HIBWK2	  1994	  2032#
HIBWKU	  2349	  2352	  2360
HIBYLB	  2346	  2381
HIGHJB	    20%
HINPRT	  2328
HINTIM	  2364	  2598
HISPRT	  2328
HISTIM	  2364	  2598
HISTOT	  1246#	  1744
HRDUPE	  1062	  1091#
HWDPNT	   464%	   464
ILWQ	  1993	  2037%
INLMES	    21%	   461%	   461	   465%	   465	   469%	   469	   988	  1103	  1110
INSOHT	  1127%	  1159
INTACT	  2547#
INTAD1	  2493	  2495#
INTAD2	  2497	  2514#
INTADR	  2485#
INTASS	  2644#
INTBYP	  2651	  2653	  2691%
INTCLK	  2658	  2685#
INTENB	  2527#
INTEXC	  2669	  2693#
INTILM	  2659	  2679#
INTRNM	  2647	  2691%
INTSET	  2654	  2657#
INTUUO	  2657	  2673#
INTWAK	  2663	  2695#
IOBKTL	  2707
IODEND	  2707
IODERR	  2707
IODTER	  2707
IOIMPM	  2707
IOTEND	  2706
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

ITMCHN	   880	   880%
ITMINT	   374#	   382
ITMPTR	   379	   380	   479#	  1613	  1614	  1618	  1619
ITMTBL	   381	   478#	  1615
ITMTBS	   476#
J	   873	  1061	  1075	  1142	  1166	  1342	  1559	  1830	  1914	  1917	  1918	  1920	  1928	  1977
	  1981	  1982	  1984	  1986	  2000	  2006	  2010	  2013	  2015	  2017	  2023	  2041	  2045	  2048
	  2054	  2056	  2058	  2060	  2065	  2067	  2069	  2108	  2109	  2110	  2115	  2116	  2140	  2179
	  2197	  2198	  2228	  2241	  2246	  2255	  2265	  2269	  2288	  2290	  2291	  2292	  2295	  2301
	  2305	  2312	  2314	  2315	  2322	  2326	  2356	  2357	  2413	  2419	  2440	  2448	  2449	  2450
	  2451	  2456	  2458	  2461	  2470	  2472	  2486	  2491	  2496	  2501	  2502	  2503	  2504	  2505
	  2520	  2521	  2527	  2530	  2534	  2535	  2538	  2539	  2547	  2550	  2554	  2557	  2560	  2561
	  2562	  2566	  2570	  2607	  2628	  2649	  2697	  2699	  2710	  2721	  2722	  2723
JBTAWQ	  1986	  2017	  2036%	  2048	  2056	  2069	  2110	  2246	  2255	  2288	  2295	  2305	  2322	  2505
	  2539	  2550	  2554	  2557	  2566	  2721
JBTENB	  1917	  1920	  1928	  1981	  1984	  2036%	  2060	  2109	  2290	  2291	  2504	  2520	  2530	  2534
	  2538	  2560	  2562	  2722
JBTFNT	  2116%	  2116	  2502%	  2502
JBTFTR	    22%	  2449
JBTICT	  2312	  2314	  2399%
JBTINT	  2115%	  2115	  2501%	  2501
JBTLIC	  1186%	  1342	  1830
JBTNAM	  1186%	  1447	  1730
JBTPIP	  1918	  1982	  2010	  2013	  2015	  2036%	  2041	  2045	  2058	  2065	  2067	  2108	  2198	  2228
	  2241	  2265	  2269	  2292	  2486	  2491	  2496	  2503	  2521	  2527	  2535	  2547	  2561	  2570
	  2649	  2723
JBTPRV	    22%	  2470
JBTST2	  2458%	  2458	  2472%	  2472
JBTSTS	    22%	  2356	  2357	  2413	  2419	  2440	  2461	  2697	  2699
JBTUPM	    21%
JBYCLK	  2235%	  2235
JBYERR	  2711%	  2711
JBYEXC	  2363%	  2363
JBYHNG	  2137%	  2137
JBYNIC	  2443%	  2443
JBYNTQ	  2466%	  2466
JBYTIM	  2629%	  2629
JBYUUO	  2204%	  2204	  2282%	  2282
JBYWAK	  2361%	  2361	  2416%	  2416
JFYSEC	  1495	  2308	  2368	  2399%	  2601
JNA	  2412	  2441	  2462
JOB	   126	   873	  1711	  1727	  2179	  2197	  2301%	  2301
JOB1	   579%	  1027
JOBAPR	  2082%	  2092	  2101
JOBCNI	  2082%	  2085
JOBMUU	  2082%	  2200	  2208
JOBN	  1434%	  1434
JOBTPC	  2082%	  2086
JS.EVI	  2471
JS.EVP	  2457
KTRRET	   288#
KTRRT1	   287#
KTRRT2	   292	   300#
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

KTRRT3	   308	   321#
LG.LAB	    31	   128	   158	   254	   293	   870	  2193
LG.PAC	   252	   325
LHFITT	  1196#	  1203	  1203#	  1204	  1204#	  1205	  1205#	  1206	  1206#	  1228	  1471
LI.PIF	   523	   534	   601	  1035
LI.PIN	   529	   539	  1014
LICSPY	  1343	  1344	  1829
LICWCR	  1343	  1344
LISTSN	     3	     6
LMPNER	   867%	  1023
LP.ADP	   803
LP.CDP	   802
LP.CSD	   366	   494
LP.CSF	   494	   603	   667	   871	   903	   924	   954	  1013	  1148
LP.DSF	   586
LP.ESF	  1017
LP.IOF	   801
LP.NXM	   799
LP.PAR	   586	   603	   667	   871	   903	   924	   954	  1013	  1017	  1148
LP.PWF	   800
LP.SBE	   356	   364	   586	   603	   667	   871	   903	   924	   954	  1013	  1017	  1148
LSICTB	  1207#	  1458
M	    32	    34	    38	  1154	  1283	  1905	  2195	  2200	  2208	  2244	  2245	  2247	  2256	  2572
MLOWQ	    22%
MO.LAC	   880
MTR	   880
NJBPER	   874#
NODIE	    12%
NODSSC	  2253	  2256#
NOHIB	  2342	  2385#
NONMSG	   631	   746#
NULCNT	  1249#	  1712
OCTPNT	    21%	  1107	  1109	  1113	  1115
OHTPAR	  1127%	  1160
OHTTAB	  1127%	  1161
OORCNT	  1248#	  1749
P	    13	    28	    33	    36	    37	    42	   106	   129	   130	   136	   159	   161	   166	   258
	   273	   281	   287	   337	   368	   376	   458	   461	   464	   465	   468	   469	   530	   540
	   762	   764	   769	   772	   773	   816	   817	   818	   874	   876	   878	   881	   910	   941
	   962	   988	   998	  1005	  1012	  1022	  1027	  1102	  1103	  1107	  1109	  1110	  1113	  1132
	  1133	  1134	  1141	  1142	  1143	  1144	  1146	  1152	  1156	  1159	  1164	  1165	  1166	  1172
	  1176	  1177	  1178	  1284	  1336	  1358	  1370	  1493	  1514	  1558	  1562	  1823	  1838	  1839
	  1840	  1895	  1898	  1909	  1919	  1921	  1922	  1929	  1930	  1995	  2001	  2019	  2025	  2031
	  2049	  2057	  2080	  2118	  2141	  2144	  2147	  2150	  2152	  2153	  2156	  2157	  2178	  2180
	  2181	  2187	  2196	  2206	  2209	  2224	  2227	  2231	  2233	  2238	  2246	  2248	  2249	  2260
	  2262	  2263	  2267	  2277	  2279	  2289	  2293	  2296	  2299	  2300	  2302	  2307	  2316	  2324
	  2329	  2333	  2334	  2337	  2340	  2343	  2345	  2347	  2348	  2358	  2385	  2409	  2410	  2414
	  2415	  2420	  2432	  2435	  2437	  2442	  2448	  2451	  2455	  2456	  2463	  2464	  2474	  2492
	  2495	  2498	  2515	  2528	  2529	  2540	  2548	  2549	  2564	  2567	  2571	  2608	  2637	  2638
	  2639	  2648	  2650	  2696	  2698	  2709	  2712	  2713	  2714	  2724	  2739
P1	   605	   631	   633	   635	   636	   638	   668	   670	   675	   680	   682	   693	   702	   765
	   766	   767	   770	   886	   891	   893	   901	   905	   912	   925	   951	   971	   983	   991
	   995	  1006	  1036	  1044	  1046	  1059	  1062	  1064	  1066	  1068	  1070	  1072	  1132	  1145
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

	  1146	  1147	  1157	  1178
P2	   672	   677	   694	   695	   703	   704	   721	   722	   727
P3	   621	   675	   680	  2407	  2433
P4	   608	   610	   619	   623	   624	   629	   630	   668	   670	   948	   949	   952	  1064	  1066
	  1106	  1108	  2408	  2434
PAG	    31	   128	   158	   870	   904	  2193
PARCMP	   957	  1089#
PARFLG	   577%	   604
PARLEN	   953	  1086#
PARMSG	   605	   749#
PARPC	   578%	   596	   878
PARPRT	  1059	  1078#
PARSET	   955	  1083#	  1086
PARSFT	   962	  1101#
PARSPR	   578%	   985
PARTOT	   578%	   938
PARWRD	   578%	   937	  1074	  1112	  1114
PC.ADR	  2075
PC.FOV	  2188
PC.FPD	  2075
PC.FXU	  2188
PC.PUB	  2257	  2274
PC.TRP	   122	   165	   288
PC.UIO	   115	   307	   598	  2258	  2259	  2261	  2275	  2276	  2278
PC.USR	   119	   597	  1710	  2055	  2223	  2257	  2274
PDNMUP	  2239%	  2260	  2262	  2277	  2279
PFW.A	   911	   999
PFW.H	   909	   997
PG	   905	   909	   911	   914	   915	   916	   917	   920	   948	   995	   997	   999	  1001	  1002
	  1144	  1164
PG0UPE	   861#	  1024	  1137
PGE.A	   612	   916	   920
PGE.P	   612
PGE.W	   916	   920
PGFAI1	   120	   135#
PGFAIL	   115	   117#
PGFPCT	   123	   157#
PGFUIO	   115#
PGYADR	   579%	  1145
PGYDIO	   866%	  1138
PGYDRT	   866%	  1003	  1147
PGYSOP	  1127%	  1179
PGYUSE	   866%	  1169
PHOLD	   579%
PICEND	  2922#
PICLIT	  2743#
PICNT	  1251#	  1722
PICON	    12	    13#	    16
PJBSTS	  1988	  2028	  2033	  2037%
PJOBN	  1914%	  1914	  1977%	  1977	  2000%	  2000	  2006%	  2006	  2023%	  2023	  2710%	  2710
PRNAME	   468%	   468
PRT30	   458	   461#
PRTKEY	   471%	   471
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

PVLOS	  2469
PX.MEM	   258	   281	   905	   995	  1283	  1398	  1411	  1412	  1419	  1433	  1443	  1457	  1846	  1849
	  1852	  1855	  1864	  1867	  1870	  1876	  1883	  1893	  1905	  2073	  2074	  2085	  2086	  2092
	  2101	  2200	  2208	  2243	  2244	  2247	  2256	  2273	  2431	  2445	  2467	  2489	  2531	  2551
	  2572	  2579	  2589	  2652
RDHIST	  1821#
RDHNL%	  1816#
RDHNR%	  1818#	  1904
RDHS2	  1836	  1841#
RDHS3	  1871#
RDHS3A	  1874#	  1877
RDHS3B	  1881#	  1884
RDHS4	  1885#
RDHZP%	  1817#
REDPIP	  2570#
REMCHT	   866%	  1182
REQCLK	   434%	   434	  1608
REQUE	   866%
RHNLIC	  1816#	  1831
RHNORM	  1845	  1848	  1851	  1854	  1863	  1866	  1869	  1875	  1882	  1891	  1900#
RHZAPD	  1817#	  1834
RNQ	  2032	  2037%
RSCMSG	   638	   743#
RSTCH1	  2541	  2559#
RSTCHL	  2553	  2557#
S	   883	   900	   939	   940	   980	  1020	  1024	  1135	  1137	  2703	  2706	  2707
S$CPU	    42	    43	   337	   338	   874	   875	   998	   999
S$DEBU	   368	   369	   376	   377
S$ENTR	    12	    18	    29	    34	    43	   109	   274	   338	   369	   377	   459	   662	   875	   911
	   999	  1171	  1592
S$EVEN	    28	    33	    42	   273	   337	   368	   376	   458	   874	   910	   998
S$HALT	    12	    28	    33	    42	   109	   273	   337	   368	   376	   458	   662	   874	   910	   998
	  1171	  1592
S$INFO	    28	    33	    42	   273	   337	   368	   376	   458	   874	   910	   998
S$JOB	    28	    29	   273	   274
S$NAME	    16#	  1171
S$NONA	    15	    18	    29	    34	    43	   110	   274	   338	   369	   377	   459	   663	   875	   911
	   999	  1171	  1593
S$PATC	    28	    33	    42	   273	   337	   368	   376	   458	   874	   910	   998
S$STOP	    33	    34	   458	   459	   910	   911
S$TEMP	    12#	    12	    28#	    28	    33#	    33	    42#	    42	   109#	   109	   273#	   273	   337#	   337
	   368#	   368	   376#	   376	   458#	   458	   662#	   662	   874#	   874	   910#	   910	   998#	   998
	  1171#	  1171	  1592#	  1592
S$XCT	    18	    29	    34	    43	   109	   110	   274	   338	   369	   377	   459	   662	   663	   875
	   911	   999	  1171	  1592	  1593
S..EUE	   109	   109%
SAV30	   463%	   463	   467%	   467
SAVAPR	   335%	   335	   768%	   768
SAVERA	   358%	   358
SAVSB0	   360%	   360
SAVSB1	   361%	   361
SAVT1	   338	   378	   435	   440#	   496	   501	   869
SAVT12	  1229#	  1594	  1753
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

SCNLMC	   867%	  1149
SETIM1	  2605#	  2619	  2626
SETMCY	  2635#
SETPOV	  2101#
SETR2	  2034	  2036%
SETSLP	  2317	  2399%
SETTIM	  2598#
SETTR1	  2578#
SETTR2	  2588#
SICTB	  1203#	  1207	  1459	  1463
SINTB	  1186%	  1394	  1395	  1396	  1880
SINTBS	  1186%	  1396	  1880
SLEEP	  2305#
SLEEP1	  2314#	  2366	  2391	  2397
SLEEP2	  2312#	  2372
SLPQ	  1989	  2029	  2037%
SNDSP	  1304#	  1350
SNGO	  1310	  1380#
SNGO1	  1404#	  1409
SNGO2	  1459#	  1461
SNGO3	  1480#	  1481
SNITMX	  1227#	  1466	  1478	  1597
SNITPT	  1226#	  1467	  1595	  1598
SNNMI	  1358	  1370	  1557#	  1839
SNOOAR	  1295#	  1383
SNOOBF	  1294#	  1349
SNOOBI	  1298#	  1462
SNOOBJ	  1299#	  1435
SNOOBL	  1296#	  1420	  1422
SNOOBR	  1297#	  1414	  1428
SNOOJB	  1232#	  1559	  1609	  1612
SNOONL	  1293#	  1345
SNOOP1	  1596	  1625#
SNOOP2	  1622	  1626#
SNOOPI	  1511	  1590#	  1626	  1734	  1754
SNOOPU	  1334#
SNOOX	  1616	  1715	  1724	  1726	  1729	  1732	  1753#
SNPAR%	  1295#
SNPBF%	  1294#
SNPBI%	  1298#
SNPBJ%	  1299#
SNPBL%	  1296#
SNPBR%	  1297#
SNPNL%	  1293#
SNSJSR	  1231#	  1513	  1557	  1610
SNSTI	  1493	  1511#	  1897	  1908
SNSTOP	  1308	  1365#
SNZAP	  1307	  1354#
SPCCMW	   722
SPCF11	   650
SPCMTD	   723	   725
SPCMTI	   648	   651
SPECNT	   885	  1094#	  1101
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

SPERPT	   863#	   884
ST.147	   127#
STKAC	   105	   135	   251#
STKAC1	   253	   264#
STOPUJ	   859#	   883	  1020
SYSCNT	  1250#	  1717
SYSDDT	   577%	   635
T1	   160	   161	   162	   163	   165	   166	   167	   288	   289	   338	   378	   379	   380	   381
	   382	   383	   427	   429	   435	   447	   457	   463	   496	   497	   498	   499	   501	   526
	   527	   528	   538	   584	   596	   597	   606	   609	   632	   634	   639	   650	   658	   659
	   661	   669	   671	   676	   681	   684	   695	   708	   761	   763	   766	   771	   869	   884
	   885	   927	   937	   953	   955	   957	   960	   961	   986	   987	  1003	  1004	  1012	  1021
	  1023	  1025	  1038	  1039	  1040	  1041	  1043	  1045	  1047	  1059	  1060	  1063	  1065	  1067
	  1069	  1071	  1073	  1106	  1108	  1112	  1114	  1138	  1139	  1140	  1141	  1160	  1161	  1169
	  1170	  1172	  1173	  1179	  1180	  1273	  1274	  1275	  1276	  1277	  1278	  1279	  1280	  1282
	  1283	  1346	  1354	  1357	  1359	  1360	  1366	  1367	  1369	  1371	  1372	  1398	  1411	  1412
	  1419	  1433	  1438	  1443	  1447	  1457	  1460	  1465	  1466	  1467	  1478	  1479	  1480	  1481
	  1494	  1495	  1496	  1497	  1498	  1499	  1511	  1512	  1513	  1560	  1561	  1594	  1595	  1597
	  1598	  1603	  1610	  1611	  1613	  1614	  1615	  1618	  1619	  1620	  1621	  1623	  1625	  1626
	  1627	  1710	  1711	  1718	  1719	  1720	  1727	  1728	  1730	  1731	  1734	  1737	  1738	  1740
	  1741	  1745	  1753	  1838	  1840	  1845	  1846	  1848	  1849	  1851	  1852	  1854	  1855	  1863
	  1864	  1866	  1867	  1869	  1870	  1875	  1876	  1882	  1883	  1886	  1888	  1892	  1893	  1901
	  1902	  1903	  1904	  1905	  1915	  1916	  1918	  1920	  1926	  1927	  1928	  1978	  1979	  1982
	  1984	  1985	  1986	  1987	  1988	  1989	  1991	  1993	  2007	  2008	  2012	  2013	  2015	  2024
	  2028	  2029	  2043	  2044	  2045	  2056	  2060	  2061	  2062	  2064	  2065	  2067	  2068	  2069
	  2070	  2072	  2073	  2074	  2084	  2085	  2087	  2088	  2093	  2094	  2095	  2101	  2102	  2117
	  2120	  2124	  2128	  2132	  2136	  2139	  2142	  2149	  2154	  2177	  2186	  2189	  2201	  2204
	  2205	  2210	  2211	  2214	  2215	  2222	  2223	  2225	  2226	  2235	  2236	  2243	  2245	  2247
	  2250	  2252	  2256	  2257	  2258	  2261	  2262	  2265	  2266	  2268	  2269	  2280	  2282	  2283
	  2284	  2286	  2287	  2288	  2290	  2292	  2294	  2295	  2308	  2309	  2310	  2311	  2313	  2325
	  2328	  2333	  2334	  2335	  2345	  2346	  2349	  2352	  2354	  2360	  2362	  2364	  2365	  2366
	  2368	  2369	  2371	  2388	  2389	  2390	  2393	  2394	  2395	  2396	  2408	  2412	  2413	  2416
	  2417	  2418	  2419	  2432	  2434	  2437	  2438	  2446	  2453	  2465	  2466	  2467	  2469	  2490
	  2494	  2514	  2517	  2519	  2521	  2532	  2534	  2535	  2537	  2538	  2539	  2552	  2554	  2557
	  2558	  2559	  2560	  2561	  2565	  2566	  2570	  2572	  2580	  2581	  2582	  2583	  2590	  2591
	  2592	  2593	  2598	  2599	  2601	  2602	  2603	  2604	  2606	  2607	  2616	  2617	  2618	  2622
	  2623	  2624	  2625	  2628	  2629	  2636	  2637	  2639	  2640	  2644	  2645	  2646	  2653	  2674
	  2680	  2685	  2704	  2705	  2711	  2735	  2737	  2738
T2	   467	   610	   611	   612	   613	   619	   620	   621	   673	   674	   678	   679	   696	   705
	   728	   767	   768	   925	   926	   927	   950	   951	   952	   956	  1083	  1084	  1085	  1156
	  1342	  1343	  1344	  1346	  1347	  1348	  1350	  1381	  1382	  1384	  1386	  1387	  1388	  1389
	  1390	  1391	  1393	  1394	  1396	  1398	  1399	  1400	  1404	  1408	  1411	  1413	  1416	  1417
	  1426	  1427	  1433	  1434	  1436	  1437	  1438	  1440	  1443	  1444	  1445	  1446	  1447	  1449
	  1452	  1454	  1459	  1460	  1721	  1722	  1723	  1829	  1830	  1832	  1833	  1835	  1844	  1846
	  1847	  1849	  1850	  1852	  1853	  1855	  1856	  1857	  1858	  1859	  1860	  1862	  1864	  1865
	  1867	  1868	  1870	  1874	  1876	  1881	  1883	  1888	  1889	  1890	  1894	  1896	  1906	  1907
	  2016	  2017	  2018	  2032	  2033	  2047	  2048	  2064	  2071	  2072	  2105	  2106	  2107	  2108
	  2111	  2113	  2114	  2119	  2121	  2122	  2123	  2125	  2126	  2127	  2129	  2130	  2131	  2133
	  2134	  2135	  2137	  2138	  2142	  2144	  2146	  2150	  2151	  2153	  2155	  2205	  2243	  2244
	  2249	  2251	  2254	  2255	  2259	  2260	  2268	  2270	  2272	  2273	  2274	  2275	  2278	  2279
	  2281	  2284	  2312	  2313	  2332	  2335	  2337	  2339	  2343	  2344	  2351	  2353	  2355	  2356
	  2357	  2359	  2361	  2363	  2364	  2367	  2370	  2385	  2440	  2441	  2443	  2444	  2445	  2453
	  2457	  2458	  2461	  2462	  2465	  2468	  2469	  2470	  2471	  2472	  2485	  2487	  2488	  2489
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

	  2506	  2507	  2508	  2509	  2510	  2511	  2512	  2513	  2516	  2520	  2530	  2531	  2537	  2550	  2551
	  2578	  2579	  2588	  2589	  2598	  2600	  2605	  2606	  2651	  2652	  2673	  2675	  2676	  2679
	  2681	  2682	  2686	  2687	  2688	  2693	  2695	  2697	  2699
T3	   607	   815	   872	   956	   957	  1070	  1072	  1385	  1386	  1390	  1400	  1401	  1402	  1403
	  1407	  1409	  1412	  1413	  1415	  1417	  1424	  1427	  1429	  1458	  1459	  1461	  1462	  1463
	  1464	  1476	  1477	  1480	  1861	  1862	  1873	  1874	  1877	  1880	  1881	  1884	  1886	  1887
	  1893	  2055	  2073	  2074	  2075	  2086	  2090	  2091	  2092	  2141	  2145	  2156	  2178	  2181
	  2187	  2188	  2194	  2230	  2232	  2271	  2272	  2273	  2276	  2277	  2338	  2644	  2647	  2651
	  2653	  2654
T4	  1074	  1161	  1405	  1406	  1407	  1419	  1420	  1421	  1423	  1424	  1431	  1469	  1471
TAKNZJ	  2023#
TAKOT1	  2008#	  2026	  2152
TAKOT2	  2014	  2017#
TAKOTJ	  2006#
TAKOTP	  2007#
TAKTR1	  1983	  1986#
TAKTR2	  1981#	  2003	  2011
TAKTR3	  1988#	  2018
TAKTRJ	  1977#
TAKTRP	  1978#	  2236	  2417	  2455	  2473	  2630	  2700
THSDAT	  1186%	  1496
TI.TOV	   375	  1591
TIM	   375	   381	  1591	  1615	  1621	  1625
TIMADJ	  2302%	  2302	  2638
TIME	   430%	   430	  1494	  1604
TIMEF	   432%	   432	  1606
TIMMIN	  2613	  2614	  2622#
TIMSEC	  2612	  2616#
TIMTAB	  2600	  2611#
TIMWAK	  2628#
TINAS1	  2147	  2170%	  2340
TIOWQ	  1991	  2037%
TO.CTD	   476	   477	   478	  1476
TO.SIT	   476	   477	   478	  1476
TO11DB	   724
TOTCNT	  1245#	  1709
TPOPJ	  2436%	  2436
TPOPJ1	  2386	  2399%
TRPBTS	  1916	  1927	  1932#	  1979	  2008	  2064	  2268
TRPUUO	  2199	  2204#
TSTARM	  1926#
TSTKOT	  2041#
TSTKTJ	  2000#
TSTKTP	  2001#	  2042	  2712
TSTTRJ	  1914#
TSTTRP	  1915#	  2001	  2206
TTNCHR	  2162	  2170%	  2379
TTNESC	  2161	  2170%
TTNLIN	  2163	  2170%	  2380
TTNYLB	  2381	  2399%
TTSCLR	  2030	  2031	  2036%	  2307	  2324
TTTCLR	  2118	  2170%	  2498
TTYEN1	  2148	  2153#
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

TTYEN2	  2143	  2155#
TTYENB	  2142#	  2155
TTYRPT	  2138	  2164#
TTYTAB	  2140	  2171%	  2326
TTYTRB	  2142	  2146	  2161#	  2164
TTYTRF	  2151	  2166#
TTYWAK	  1992	  2037%
TTYYLS	  2347	  2399%
TYPAPL	   766#	   770
TYPAPR	   337	   761#
TYPCSB	   368%	   368	   818%	   818
U	  1134	  1176
UPDKEY	   429%	   429	  1603%	  1603
UPE0	   891#	   971
UPE1	   894	   924#
UPEB1	   887	   900#
UPEBA	   907	  1035#
UPED	   937#
UPED2	   948#
UPED2A	   954#	   960
UPEG	   981	   994	  1012#
UPEH	   991#	  1007
UPEH1	  1000	  1004	  1006#
UPEHR2	  1068#	  1075
UPEHRD	   958	   961	  1059#
UPENXA	   913	   929	   971#
UPETF	   892	   980#
UPSJOB	   577%	   618	   867%	   918	  1174
UPTAC0	    23%	   278	   279	   291	   300	   301
UPTACP	    23%	   104	   117	   125	   157	   251	   255	   256	   257	   259	   265	   266	   267	   268
	   269	   280	   290	   294	   303	   305	   311	   324	   326	   327
UPTENB	  2070	  2087	  2090	  2117	  2154	  2221%	  2226	  2237	  2250	  2271	  2485	  2494	  2688
UPTIME	   431%	   431	  1605
UPTMTM	  2635%	  2635	  2640%	  2640	  2670
UPTMUP	    37	   106	   287	   289	   296	   306	   312	   328	  2194
UPTMUU	    32	   107	   111	  2195
UPTOPP	   118	   130	   136	   160	   167
UPTOVT	  2122	  2507	  2578	  2583
UPTPC	    23%	  2222	  2230	  2232
UPTPDL	    23%	    36	   129	   159	   876	  2196	  2299
UPTPER	   910#
UPTPFW	   162
UPTPGT	   131	   164	   168	  2126	  2509	  2682
UPTPNT	  2134	  2211	  2215	  2287	  2513	  2676
UPTPOV	  2130	  2511	  2588	  2593
UPTTCB	  2111	  2171%
UPTTCE	  2114	  2171%
UPTTP1	  2171%	  2500
UPTTPN	  2171%	  2499
USEPER	   598	   869#
USRACB	    31	   128	   158	   231	   293	   870	  2193
USRCLK	  2222#
USRCNT	  1247#	  1713
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

USRMP2	  2172%
USRMPE	   132%	  2123	  2172%	  2508	  2679
USRMPT	  2099%	  2125	  2681
USROVT	  2121	  2186#
USRPDT	  2129	  2177#
USRXIT	  2182	  2303%	  2303
UUOAST	   273#
UUOCTR	    28#
UUOKTR	   104#
UUOOK	  2283	  2285	  2288#	  2555
UUOPN1	    35%	    35	  2216%	  2216
UUOPNT	   577%	  2131	  2210	  2214	  2512	  2675
UUOPTR	    31#
UUOPTT	  2133	  2193#	  2286	  2673
UUOSTR	    42#
UUOZTR	    33#
W	   901	   902	   991	   992	   993	  1042	  1043	  1044	  1046	  1136	  1143	  1165	  2431	  2445
	  2467	  2489	  2531	  2551	  2579	  2589	  2652
WAKFLG	  2353	  2418	  2695
WAKUUO	  2407#
WSCHED	   579%	  1022
XACSTL	    20%	   278	   279	   300	   301
XXPDL	   815	   816	   819	   820#
XXQ	  1933#	  1936	  1937	  1937#	  1938	  1938#	  1939	  1939#	  1940	  1940#	  1941	  1941#	  1942	  1942#
	  1943	  1943#	  1944	  1944#	  1945	  1945#	  1946	  1946#	  1947	  1947#	  1948	  1948#	  1949	  1949#
	  1950	  1950#	  1951	  1951#	  1952	  1952#	  1953	  1953#	  1954	  1954#	  1955	  1955#	  1956	  1956#
	  1957	  1957#	  1958	  1958#	  1959	  1959#	  1960	  1960#	  1961	  1961#	  1962	  1962#	  1963	  1963#
	  1964	  1964#	  1965	  1965#	  1966	  1966#	  1967	  1967#	  1968	  1968#	  1969	  1969#	  1970	  1970#
	  1971	  1971#
ZZ	   258#	   258	   281#	   281	   905#	   905	   995#	   995	  1283#	  1283	  1398#	  1398	  1411#	  1411
	  1412#	  1412	  1419#	  1419	  1433#	  1433	  1443#	  1443	  1457#	  1457	  1818#	  1846#	  1846	  1849#
	  1849	  1852#	  1852	  1855#	  1855	  1864#	  1864	  1867#	  1867	  1870#	  1870	  1876#	  1876	  1883#
	  1883	  1893#	  1893	  1905#	  1905	  2073#	  2073	  2074#	  2074	  2085#	  2085	  2086#	  2086	  2092#
	  2092	  2101#	  2101	  2200#	  2200	  2208#	  2208	  2243#	  2243	  2244#	  2244	  2247#	  2247	  2256#
	  2256	  2273#	  2273	  2431#	  2431	  2445#	  2445	  2467#	  2467	  2489#	  2489	  2531#	  2531	  2551#
	  2551	  2572#	  2572	  2579#	  2579	  2589#	  2589	  2652#	  2652
ZZ1	   258#	   258	   281#	   281	   905#	   905	   995#	   995	  1283#	  1283	  1398#	  1398	  1411#	  1411
	  1412#	  1412	  1419#	  1419	  1433#	  1433	  1443#	  1443	  1457#	  1457	  1846#	  1846	  1849#	  1849
	  1852#	  1852	  1855#	  1855	  1864#	  1864	  1867#	  1867	  1870#	  1870	  1876#	  1876	  1883#	  1883
	  1893#	  1893	  1905#	  1905	  2073#	  2073	  2074#	  2074	  2085#	  2085	  2086#	  2086	  2092#	  2092
	  2101#	  2101	  2200#	  2200	  2208#	  2208	  2243#	  2243	  2244#	  2244	  2247#	  2247	  2256#	  2256
	  2273#	  2273	  2431#	  2431	  2445#	  2445	  2467#	  2467	  2489#	  2489	  2531#	  2531	  2551#	  2551
	  2572#	  2572	  2579#	  2579	  2589#	  2589	  2652#	  2652
%UPLMA	   867%	  1025
%UPS	    23%	   617	   621	   919	   927	   956	  1083	  1084	  1085	  1175
%UPT	    23%	    32	    36	    37	   104	   106	   107	   111	   117	   118	   125	   129	   130	   131
	   136	   157	   159	   160	   162	   164	   167	   168	   251	   255	   256	   257	   259	   265
	   266	   267	   268	   269	   278	   279	   280	   287	   289	   290	   291	   294	   296	   300
	   301	   303	   305	   306	   311	   312	   324	   326	   327	   328	   876	  2070	  2087	  2090
	  2111	  2114	  2117	  2122	  2126	  2130	  2134	  2154	  2194	  2195	  2196	  2211	  2215	  2222
	  2226	  2230	  2232	  2237	  2250	  2271	  2287	  2299	  2485	  2494	  2499	  2500	  2507	  2509
	  2511	  2513	  2578	  2583	  2588	  2593	  2635	  2640	  2670	  2676	  2682	  2688
%ZZ	  1195#	  1203#	  1203	  1204#	  1204	  1205#	  1205	  1206#	  1206
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Symbol cross reference

.ARHLT	  2433
.ARWAK	  2407
.CPDWD	   455%	   455
.DTCTO	   721
.SLTIM	  2605	  2621#
.SLWAK	  2319#
PICON - HANDLE USER PSEUDO INTERRUPTS. ALSO APR INTERRUPT	MACRO 12.5-46.0 14:34 13-JAN-88
PICON.MAC	30-OCT-87 17:26		Macro/Opdef cross reference

APRTXT	   781#	   799
CLPARF	   603	   667	   871	   903	   924	   954	  1013	  1148
CLRPT	   617	   919	  1175
CLRPTA	   904
CLRPTO	   617	   919	  1175
DSKOFF	  1130#	  1158
DSKON	  1129#	  1162
ERRCOD	  1267#	  1293	  1294	  1295	  1296	  1297	  1298	  1299	  1816	  1817	  1818
EXECAC	    31	   128	   158	   870	  2193
IFCPU	    45	   100	   334	   339	   348	   355	   387	   437	   449	   475	   482	   490	   557	   574
	   585	   586	   587	   588	   607	   614	   641	   647	   653	   713	   720	   731	   776	   781
	   788	   792	   811	   872	   879	   908	   996	  1016	  1017	  1018	  1019	  1187	  1210	  1230
	  1234	  1337	  1472	  1475	  1484	  1510	  1517	  1524	  1533	  1547	  1556	  1565	  1574	  1578
	  1631	  1680	  1734	  1735	  1736	  1754	  1755	  1757	  1824	  2727
IFNCPU	    99	   584	   617	   909	   914	   997	  1001	  1202	  2734
ND	   101
NOCHAR	   880
PFALL	   384	  2103
PJRST	   471	  1028	  1115	  1182	  1897	  1908	  2630	  2641
PRINTF	   600	   775	   810	  1015
PRNTBP	  2449
PXCT	   258	   281	   905	   995	  1283	  1398	  1411	  1412	  1419	  1433	  1443	  1457	  1846	  1849
	  1852	  1855	  1864	  1867	  1870	  1876	  1883	  1893	  1905	  2073	  2074	  2085	  2086	  2092
	  2101	  2200	  2208	  2243	  2244	  2247	  2256	  2273	  2431	  2445	  2467	  2489	  2531	  2551
	  2572	  2579	  2589	  2652
PXGEN	   258	   281	   905	   995	  1283	  1398	  1411	  1412	  1419	  1433	  1443	  1457	  1846	  1849
	  1852	  1855	  1864	  1867	  1870	  1876	  1883	  1893	  1905	  2073	  2074	  2085	  2086	  2092
	  2101	  2200	  2208	  2243	  2244	  2247	  2256	  2273	  2431	  2445	  2467	  2489	  2531	  2551
	  2572	  2579	  2589	  2652
RDERA	   358
RDPI	  1718
SBDIAG	   360	   361
STOPCD	    11	    28	    33	    42	   109	   273	   337	   368	   376	   458	   662	   874	   910	   998
	  1171	  1592
SWPUA	   499	   524	   526
SWPVA	   497	   499	   535
TSIC	  1197#	  1203	  1204	  1205	  1206
UHLRZ	  1433
UHRRZ	  1411	  1412	  1457
UMOVE	  1398	  1419	  1443
UMOVEM	  1846	  1849	  1852	  1855	  1864	  1867	  1870	  1876	  1883	  1905	  2445	  2467	  2572	  2579
	  2589
WRAPR	   586	   602	   625	  1017
WRPI	   434	   523	   529	   534	   539	   601	  1014	  1035	  1158	  1162	  1608
WRUBR	   257	   267	   295	   311	   327
XCTBU	   905	   995	  1411	  1412	  1433	  1457	  2085	  2086	  2092	  2101	  2200	  2208
XCTFU	   258	   281	  1398	  1419	  1443	  2074	  2243	  2247	  2256	  2273
XCTTU	  1283	  1846	  1849	  1852	  1855	  1864	  1867	  1870	  1876	  1883	  1893	  1905	  2073	  2244
	  2431	  2445	  2467	  2489	  2531	  2551	  2572	  2579	  2589	  2652
XP	  1293	  1294	  1295	  1296	  1297	  1298	  1299	  1816	  1817	  1818	  2319	  2621
$END	  2743  a	]bU
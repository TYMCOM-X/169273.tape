PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KI-10 PARAMETER FILE - KISYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KISYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE	PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405
     9				SUBTTL	/RCC/GR TS 18 JUL 70
    10
    11					STOPCD(,ENTRY,PTPSER)^
    12					ENTRY	PTPSER		;For library searches
    13	000000'	260040	000000*	PTPSER::PUSHJ	P,DIE		;**** Default stopcode for "PTPSER" ****
    14	000001'	606460	634562		SIXBIT	/PTPSER/  	;Title of module
    15	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "PTPSER+nnn(nnnnnn)"
    16			000000'	S$NAME==PTPSER			;For STOPCDs with no arguments
    17					SALL>
    18				^
    19
    20				IFNCPU(<KI,KL>),<PRINTX PTPSER works only on the KI and KL>
    21
    22				EXTERNAL PTPCHN, PTPSAV, ADVBFE, ITMCT1, SETIOD, SETBYT, IOSET, CKS12
    23				EXTERNAL ERROCI,  OUT, WAIT1,PTPCHL,PIOMOD,CPOPJ
    24				EXTERNAL SETACT,STOIOS,CBLAMB,CBLAUB,WSYNC
    25				INTERNAL PTPINT
    26
    27				;PTP DEVICE DATA BLOCK LINKAGE
    28
    29				; PARAMETER ASSIGNMENTS
    30
    31				;   PTP CONTROL REGISTER
    32			000010		PTPDON==10
    33
    34				;   FORMAT CONTROL
    35			000200		PTPFDN==200
    36				;OUT OF TAPE FLAG
    37			000100		PTPNTP==100
    38
    39				;   SPECIAL IO STATUS WORD ASSIGNMENTS
    40			400000		IODISC==400000
    41			200000		PTPFED==200000
    42			100000		PTPBIN==100000	;CHECKSUM BINARY
    43			040000		PTPIB==40000	;IMAGE BINARY
    44			020000		PTPEND==20000	;CLOSE FLAG
    45			010000		PTPEOT==10000	;END OF TAPE INDICATOR
    46
    47				;   SPECIAL ASCII CHARACTERS
    48				;   DEFINED WITH THE CORRECT PARITY
    49			000377		RUBOUT==377
    50			000011		HORTAB==11
    51			000213		VERTAB==213
    52			000014		FORMFD==14
    53
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 1
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

    54				;PTP DEVICE DATA BLOCK
    55
    56					INTERN	PTPDDB
    57	000000			PTPDDB:	PHASE	0		;TO DEFINE DDB
    58	000003'	606460	000000	DEVNAM:	SIXBIT	/PTP/		;NAME
    59	000004'	002000	000041	DEVCHR:	XWD	4*HUNGST,41	;CHARACERISTICS
    60	000005'	000000	000000	DEVIOS:	0			;I/O STATUS
    61	000006'	000000	000174'	DEVSER:	EXP	PTPDSP		;SERVICE ROUTINE DISPATCH TABLE
    62	000007'	000401	014403	DEVMOD:	XWD	DVPTP+DVOUT,14403;
    63	000010'	000000	000000	DEVLOG:	0
    64	000011'	000000	000000	DEVBUF:	0
    65	000012'	000000	000000	DEVIAD:	0
    66	000013'	000000	000000	DEVPTR:	0
    67	000014'	000000	000030'	DEVCLS:	XWD	00,PTPBUF	;CLASS AND MONITOR BUFFER LOCATION
    68	000015'	000000	000000	DEVSTS:	0
    69	000016'	000062	000000	DEVPWC:	XWD	PTPBL/2,0	;WAKE UP BUFFER COUNT AND PARTIAL WORD COUNT
    70	000017'	000000	000000	DEVWUC:	0			;ACTIVE WAKE UP COUNT
    71	000020'	000000	000000	DEVCTR:	0
    72	000021'	000000	000000	DEVINT:	0
    73	000022'				DEPHASE
    74			000005'	  PTPIOS=PTPDDB+DEVIOS
    75			000012'	  PTPPTR=PTPDDB+DEVIAD
    76			000013'	  PTPADR=PTPDDB+DEVPTR
    77			000015'	  PTPSTS=PTPDDB+DEVSTS
    78			000020'	  PTPCTR=PTPDDB+DEVCTR
    79	000022'	000000	000000	PTPCNT:	0
    80	000023'	000000	000000	PTPCHA:	0
    81	000024'	000000	000000	PTPSIO:	0
    82	000025'	000000	000000	PTPCON:	0
    83			000023	SIZPTP==.-PTPDDB
    84				;
    85				;  MONITOR BUFFER DEFINITION
    86				;
    87			000144	  PTPBL=144			;LENGTH
    88	000026'	000030'	000030'		XWD	PTPBUF,PTPBUF	;IN AND OUT
    89	000027'	000000	000174'		EXP	PTPBUF+PTPBL	;LAST
    90	000030'			PTPBUF:	BLOCK	PTPBL
    91				;
    92
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 2
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

    93
    94
    95				;PTP SERVICE DISPATCH TABLE
    96
    97	000000			PTPDSP:	PHASE 0
    98	000174'	000000	000012	DDXZ:	DSPSIZ
    99	000175'	263040	000000	DDINT:	POPJ P,
   100	000176'	004400	004400	DBYT:	4400,,4400
   101	000177'	201300	000023	DVSIZ:	MOVEI T1,SIZPTP
   102	000200'	254000	000207'	DINI:	JRST PTPINI
   103	000201'	254000	000207'	DHNG:	JRST PTPREL
   104	000202'	254000	000207'	DRL:	JRST PTPREL
   105	000203'	254000	000212'	DCL:	JRST PTPCLS
   106	000204'	254000	000216'	DOU:	JRST PTPOUT
   107	000205'	254000	000000*		DIN:	JRST ERROCI
   108	000206'	254000	000366'	DXFR:	JRST PTPXFR
   109			000012		DSPSIZ==.-1
   110	000207'				DEPHASE
   111
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 3
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   112	000207'			PTPINI:
   113	000207'	710200	000000	PTPREL:	CONO PTP,0
   114	000210'	513000	000025'		HLLZS PTPCON		;CLEAR CONSO FLAG BITS
   115	000211'	263040	000000		POPJ P,		;RETURN
   116
   117	000212'			PTPCLS:
   118	000212'	260040	000000*		PUSHJ	P,WAIT1		;WAIT UNTIL MB IS EMTY
   119	000213'	205000	420000		MOVSI	S,PTPEND+IODISC		;SET CLOSE DONE FLAG
   120	000214'	437004	000002		IORB	S,DEVIOS(F)	;STORE STATUS
   121	000215'	254000	000216'		JRST	PTPOUT		;GO OUTPUT TRAILER
   122
   123
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 4
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   124					EXTERN HNGSTP
   125
   126	000216'	710340	000100	PTPOUT:	CONSO PTP,PTPNTP	;OUT OF TAPE?
   127	000217'	254000	000222'		JRST PTPIN0		;NO -ENTER SERVICE
   128	000220'	260040	000000*		PUSHJ P,HNGSTP	;ISSUE "DEVICE PTP OK?"
   129	000221'	254000	000216'		JRST PTPOUT		;TRY AGAIN WHEN "CONT" TYPED
   130	000222'	623000	000002	PTPIN0:	TLZE S,IOBEG		;VIRGIN DEVICE? (IOBEG:=0)
   131	000223'	254000	000235'		JRST PTPIN2		;YES
   132
   133	000224'			PTPIN1:
   134	000224'	260040	000000*		PUSHJ P,SETACT	;SET ACTIVE FLAG,STORE S, AND
   135								;RESET HUNG DEVICE TIMEOUT COUNT
   136	000225'	505300	000010		HRLI T1,PTPDON		;CONSO FLAG
   137	000226'	541300	000000*		HRRI T1,PTPCHN		;CONO FLAGS
   138	000227'	660300	000010		TRO T1,PTPDON
   139	000230'	700600	000400		WRPI	LI.PIF
   140	000231'	710206	000000		CONO	PTP,(T1)
   141	000232'	546300	000025'		HLRM	T1,PTPCON
   142	000233'	700600	000200		WRPI	LI.PIN
   143	000234'	263040	000000		POPJ P,		;RETURN
   144
   145	000235'	135300	000000*	PTPIN2:	LDB T1,PIOMOD
   146	000236'	661000	200024		TLO S, IOFST+PTPFED+IO	;IOFST:=PTPFED:=IO:=1
   147	000237'	621000	540000		TLZ S,PTPBIN+PTPIB+IODISC	;CLEAR BINARY AND IMAGE BINARY BITS
   148	000240'	306300	000013		CAIN T1,IB		;IMAGE BINARY?
   149	000241'	661000	040000		TLO S,PTPIB		;YES
   150	000242'	306300	000014		CAIN T1,B		;MODE=BINARY?
   151	000243'	661000	100000		TLO S,PTPBIN		;YES, PTPBIN:=1
   152	000244'	201300	000200		MOVEI T1,PTPFDN	;PTPCNT:=PTPFDN
   153	000245'	202300	000022'		MOVEM T1,PTPCNT
   154	000246'	260040	000000*		PUSHJ P,SETBYT	;SETBYT
   155	000247'	540304	000011		HRR	T1,DEVCLS(F)	;BUFFER POINTER
   156	000250'	540306	777776		HRR	T1,-2(T1)	;NEXT WORD TO TAKE FROM BUFFER
   157	000251'	275300	000001		SUBI	T1,1		;ADJUST FOR POINTER
   158	000252'	202300	000012'		MOVEM	T1,PTPPTR	;SET UP BYTE POINTER
   159	000253'	133000	000012'		IBP	PTPPTR		;TO ACTUAL FIRST BYTE
   160	000254'	254000	000224'		JRST PTPIN1
   161
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 5
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   162
   163				;PUNCH INTERRUPT SERVICE
   164
   165	000255'	710360	000025'	PTPINT:	CONSO PTP,@PTPCON
   166	000256'	254000	000255'		JRST PTPINT
   167	000257'	710240	000015'		CONI	PTP,PTPSTS	;STORE CONI STATUS
   168	000260'	710300	000100		CONSZ	PTP,PTPNTP	;ARE WE OUT OF TAPE?
   169	000261'	254000	000475'		JRST	NOTAPE		;YES - GO HANDLE IT
   170	000262'	202000	000024'		MOVEM S,PTPSIO	;PTPSIO:=C(S)  SAVE S
   171	000263'	200000	000005'		MOVE S,PTPIOS		;S:=C(PTPIOS)
   172	000264'	603000	200000		TLNE S,PTPFED		;FEED REQUEST? (PTPFED=1?)
   173	000265'	254000	000357'		JRST PTPS2		;YES
   174	000266'	200000	000024'		MOVE S,PTPSIO		;RESTORE S
   175	000267'	264000	000000*		JSR PTPSAV		;SAVE ACS AND ESTABLISH P
   176	000270'	201200	000003'		MOVEI F,PTPDDB
   177	000271'	260040	000000*		PUSHJ P,IOSET		;R:=(JBTADR 18-35),J:=C(DEVCTR)
   178								;S:=C(PTRIOS)
   179	000272'	623000	400000		TLZE S,IODISC		;DISCONNECT?  (IODISC=1?)
   180	000273'	254000	000440'		JRST PTPADV		;YES
   181	000274'	623000	000004		TLZE	S,IOFST		;START OF NEW MB?
   182	000275'	254000	000310'		JRST	PTPB1		;YES.  SET UP FIRST CHARACTER
   183	000276'	607000	140000		TLNN S,PTPBIN+PTPIB	;BINARY PUNCH MODE?
   184	000277'	254000	000313'		JRST PTP3		;NO
   185
   186	000300'	200300	000023'		MOVE T1,PTPCHA		;BINARY OUTPUT BYTE SIZE=36
   187	000301'	241300	000006		ROT T1,6
   188	000302'	202300	000023'		MOVEM T1,PTPCHA
   189	000303'	405300	000077		ANDI T1,77		;T1:=XX, SIXBIT SUB-BYTE
   190	000304'	271300	000200		ADDI T1,200
   191	000305'	710140	000006		DATAO PTP,T1		;PUNCH 2XX
   192	000306'	371000	000022'		SOSL PTPCNT		;C(PTPCNT):=C(PTPCNT)-1.  WORD DONE?
   193	000307'	254000	000000*		JRST STOIOS		;NO
   194
   195				;FOR BINARY AND IMAGE BINARY
   196	000310'	201300	000005	PTPB1:	MOVEI T1,5		;PTPCNT:=5
   197	000311'	202300	000022'		MOVEM T1,PTPCNT
   198	000312'	254000	000330'		JRST PTP1
   199
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 6
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   200				;FOR ASCII AND IMAGE MODE
   201	000313'	710140	000023'	PTP3:	DATAO PTP,PTPCHA	;PUNCH CHARACTER
   202	000314'	602000	000014		TRNE S,14		;IS MODE AN ALPHA MODE
   203	000315'	254000	000330'		JRST PTP1		;NO
   204	000316'	200240	000023'		MOVE U,PTPCHA
   205	000317'	302240	000011		CAIE U,HORTAB		;HORIZONTAL OR VERTICAL TAB?
   206	000320'	306240	000213		CAIN U,VERTAB
   207	000321'	254000	000465'		JRST PTPP1		;YES
   208	000322'	302240	000014		CAIE U,FORMFD		;FORM FEED?
   209	000323'	254000	000330'		JRST PTP1		;NO
   210	000324'	661000	200000		TLO S,PTPFED	;PTPFED:=PTPEOL:=1
   211	000325'	201240	000020		MOVEI U,20
   212	000326'	202240	000022'		MOVEM U,PTPCNT	;PTPCNT:=20
   213	000327'	254000	000307*		JRST STOIOS
   214
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 7
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   215					EXTERNAL PEVEN8		;IN IOCSS, FOR PARITY IN ASCII
   216
   217				; GET NEXT ITEM FROM BUFFER
   218				;
   219	000330'	550304	000011	PTP1:	HRRZ	T1,DEVCLS(F)	;BUFFER POINTER
   220	000331'	550346	777776	PTP4:	HRRZ	T2,-2(T1)	;OUT
   221	000332'	554406	777776		HLRZ	T3,-2(T1)	;IN
   222	000333'	316340	000010		CAMN	T2,T3		;BUFFER EMPTY?
   223	000334'	254000	000355'		JRST	PTP2		;YES
   224	000335'	135240	000012'	PTP6:	LDB	U,PTPPTR	;NO. GET CHARACTER
   225	000336'	133000	000012'		IBP	PTPPTR		;ADVANCE POINTER MANUALLY
   226	000337'	550400	000012'		HRRZ	T3,PTPPTR	;NEW OUT
   227	000340'	316406	777777		CAMN	T3,-1(T1)	;OUT = LAST?
   228	000341'	200400	000006		MOVE	T3,T1		;YES. OUT:=FIRST
   229	000342'	542406	777776		HRRM	T3,-2(T1)	;STORE IT
   230	000343'	542400	000012'		HRRM	T3,PTPPTR	;ALSO IN POINTER
   231	000344'	135400	000235*		LDB	T3,PIOMOD	;GET MODE
   232	000345'	302400	000000		CAIE	T3,A		;ASCII?
   233	000346'	254000	000353'		JRST	PTP5		;NO.
   234	000347'	322240	000331'		JUMPE	U,PTP4		;YES. JUMP ON ASCII NULL
   235	000350'	200400	000005		MOVE	T3,U		;FOR CALL PEVEN8
   236	000351'	260040	000000*		PUSHJ	P,PEVEN8	
   237	000352'	200240	000010		MOVE	U,T3
   238	000353'	202240	000023'	PTP5:	MOVEM	U,PTPCHA	;NEXT ITEM TO PUNCH
   239	000354'	254000	000327*		JRST	STOIOS		;DISMIS INTERRUPT
   240	000355'	661000	400000	PTP2:	TLO	S,IODISC	
   241	000356'	254000	000354*		JRST 	STOIOS
   242				;PUNCH FEEDER
   243	000357'	402000	000023'	PTPS2:	SETZM	PTPCHA		;PUNCH FEED
   244	000360'	710140	000023'		DATAO PTP,PTPCHA
   245	000361'	377000	000022'		SOSG PTPCNT		;COUNT FEED LINES
   246	000362'	621000	200000		TLZ S,PTPFED		;PTPFED:=0
   247	000363'	202000	000005'		MOVEM S,PTPIOS	;PTPIOS:=C(S)
   248	000364'	200000	000024'		MOVE S,PTPSIO		;RESTORE S
   249	000365'	254520	000000*		JEN @PTPCHL		;DISMISS
   250
   251
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 8
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   252				;
   253				;  DEVICE DEPENDENT TRANSFER ROUTINE
   254				;  ON ENTRY LH(T2)=FROM ADDRESS
   255				;           RH(T2)=TO ADDRESS
   256				;           (T3)  =END ADDRESS +1
   257				;            (T1) = NO. OF WORDS TO TRANSFER
   258				;  ON EXIT (T1)RETURNS THE NO. OF WORDS TRANSFERRED
   259				;
   260				;      NO-SKIP RETURN INDICATES BUFFER COMPLETED
   261				;
   262	000366'	135600	000344*	PTPXFR:	LDB	P1,PIOMOD	;GET MODE
   263	000367'	306600	000014		CAIN	P1,B		;BINARY?
   264	000370'	254000	000374'		JRST	PTPXF1		;YES. SPECIALHANDLING
   265	000371'	256040	000477'		XCTFU <BLT T2,-1(T3)> ;DO TRANSFER
   266	000372'	350001	000000		AOS	(P)		;SKIP RETURN
   267	000373'	263040	000000	PTPXF2:	POPJ	P,
   268
   269	000374'	550600	000007	PTPXF1:	HRRZ	P1,T2		;SAVE MB ADDRESS
   270	000375'	550344	000010		HRRZ	T2,DEVOAD(F)	;BUFFER ADDRESS
   271	000376'	260040	000000*		PUSHJ	P,CKS12		;COMPUTE CHECKSUM
   272	000377'	270344	000010		ADD	T2,DEVOAD(F)	;COMPUTE ADDRESSOF THIRD WORD
   273	000400'	256140	000500'		XCTBU <HRR T1,(T2)>	;FORM CKSUM AND COUNT WORD
   274	000401'	202314	000000		MOVEM	T1,(P1)		;STORE IN MB
   275	000402'	271600	000001		ADDI	P1,1
   276	000403'	550304	000011	PTPXF4:	HRRZ	T1,DEVCLS(F)	;MB ADDRESS
   277	000404'	316606	777777		CAMN	P1,-1(T1)	;NEW IN = LAST?
   278	000405'	550600	000006		HRRZ	P1,T1		;IN:=FIRST
   279	000406'	506606	777776		HRLM	P1,-2(T1)	;STORE NEW POINTER
   280	000407'	260040	000000*	PTPXF5:	PUSHJ	P,CBLAUB	;GET UB DATA INFO
   281	000410'	322440	000373'		JUMPE	T4,PTPXF2	;JUMP IF UB IS EMPTY
   282	000411'	260040	000000*		PUSHJ	P,CBLAMB	;COMPUTE SPACE IN MB
   283	000412'	322300	000426'		JUMPE	T1,PTPXF3	;MB FULL
   284	000413'	313300	000011		CAMLE	T1,T4		;MORE  SPACE THAN NEEDED
   285	000414'	550300	000011		HRRZ	T1,T4		;COUNT FULL BUFFER
   286	000415'	504340	000010		HRL	T2,T3		;SET UP FROM
   287	000416'	550400	000007		HRRZ	T3,T2	
   288	000417'	270400	000006		ADD	T3,T1		;COMPUTE END+1
   289	000420'	256040	000477'		XCTFU <BLT T2,-1(T3)>	;DO TRANSFER
   290	000421'	272304	000013		ADDM	T1,DEVPWC(F)	;ADVANCE PARTIAL WORD COUNT
   291	000422'	550604	000011		HRRZ	P1,DEVCLS(F)	;GET BUFFER POINTER
   292	000423'	554614	777776		HLRZ	P1,-2(P1)	;OLD IN
   293	000424'	270600	000006		ADD	P1,T1		;COMPUTE NEW IN
   294	000425'	254000	000403'		JRST	PTPXF4
   295	000426'	554304	000013	PTPXF3:	HLRZ	T1,DEVPWC(F)	;GET WAKEUP COUNT
   296	000427'	212304	000014		MOVNM	T1,DEVWUC(F)	;SET IT
   297	000430'	260040	000000*		PUSHJ	P,WSYNC		;WAIT FOR ROOM IN MB
   298	000431'	602000	010000		TRNE	S,IOACT
   299	000432'	254000	000407'		JRST	PTPXF5
   300	000433'	260040	000411*		PUSHJ	P,CBLAMB	;CHECK MB
   301	000434'	322300	000407'		JUMPE	T1,PTPXF5	;IF EMPTY GO FILL IT
   302	000435'	550444	000003		HRRZ	T4,DEVSER(F)	;NOT EMPTY SO STARTDEVICE
   303	000436'	260051	000010		PUSHJ	P,DOU(T4)
   304	000437'	254000	000407'		JRST	PTPXF5
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 8-2
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   305
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 9
PTPSER.MAC	 5-JAN-86 23:17		/RCC/GR TS 18 JUL 70

   306
   307				;  BUFFER EMPTY AFTER LAST INTERRUPT
   308				;
   309	000440'	550304	000011	PTPADV:	HRRZ	T1,DEVCLS(F)	;BUFFER POINTER
   310	000441'	550346	777776		HRRZ	T2,-2(T1)	;OUT
   311	000442'	554406	777776		HLRZ	T3,-2(T1)	;IN
   312	000443'	312340	000010		CAME	T2,T3		;STILL EMPTY?
   313	000444'	254000	000335'		JRST	PTP6		;NO. SETUP ITEM AND WAIT FOR ANOTHR INTERRUPT
   314	000445'	607000	020000		TLNN	S,PTPEND	;YES.  CLOSE DONE?
   315	000446'	254000	000452'		JRST	PTP9		;NO. TURN OFF DEVICE
   316	000447'	667000	010000		TLON	S,PTPEOT	;YES. EOT FEED DONE?
   317	000450'	254000	000461'		JRST	PTP10		;NO. GO DO IT
   318	000451'	621000	030000		TLZ	S,PTPEND+PTPEOT	;YES. ALL DONE
   319	000452'	620000	010000	PTP9:	TRZ	S,IOACT		;CLEAR IO ACTIVE
   320	000453'	710200	000000		CONO	PTP,0		;STOP DEVICE
   321	000454'	513000	000025'		HLLZS,PTPCON		;CLEAR INTERRUPT
   322	000455'	623000	000001		TLZE	S,IOW		;JOB WAITING?
   323	000456'	260040	000000*		PUSHJ	P,SETIOD	;YES. WAKE UP
   324	000457'	661000	400000		TLO	S,IODISC	;SET SO NEW DATA WILL GET SET UP
   325	000460'	254000	000356*		JRST	STOIOS		;AND DISMISS INTERRUPT
   326	000461'	201300	000200	PTP10:	MOVEI	T1,200
   327	000462'	202300	000022'		MOVEM	T1,PTPCNT	;SET FEED COUNT
   328	000463'	661000	600000		TLO	S,IODISC+PTPFED; FEED REQUEST
   329	000464'	254000	000460*		JRST	STOIOS		;START FEED
   330
   331	000465'	201240	000377	PTPP1:	MOVEI U,RUBOUT	;PTPCHA:=RUBOUT
   332	000466'	202240	000023'		MOVEM U,PTPCHA
   333	000467'	254000	000464*		JRST STOIOS
   334
   335	000470'	260040	000207'	PTPDSC:	PUSHJ P,PTPREL	;CLEAR PTP CONTROL REG AND CONSO BITS
   336	000471'	620000	010000		TRZ S,IOACT		;IOACT:=0
   337	000472'	661000	000004		TLO S,IOFST		;IOFST:=1
   338	000473'	623000	000001		TLZE S,IOW		;IN A WAIT?  IOW:=0
   339	000474'	260040	000456*		PUSHJ P,SETIOD	;YES.  IOWS:=1
   340
   341						;WHEN END OF TAPE ENCOUNTERED, COME HERE TO FORCE A HUNG DEVICE
   342	000475'	710200	000000	NOTAPE:	CONO	PTP,0		;TURN OFF PTP-RESTART NOT ALLOWED
   343	000476'	254520	000365*		JEN	@PTPCHL		;DISMISS INTERRUPT-BUT NO MORE
   344								;TO BE RECEIVED SINCE PTP NOW OFF
   345
   346	000477'			PTPLIT:	LIT
   347	000477'	251350	777777
   348	000500'	540307	000000
   349	000501'			PT.END:	END
   350
NO ERRORS DED
PROGRAM BREAK IS 000501
6K CORE USED
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88 PAGE 10
PTPSER.MAC	 5-JAN-86 23:17		SYMBOL TABLE

A		000000	SIN	IODISC		400000	SPD	PTPOUT		000216'		
ADVBFE		000000	EXT	IOFST		000004	SIN	PTPP1		000465'		
B		000014	SIN	IOSET		000271'	EXT	PTPPTR		000012'		
CBLAMB		000433'	EXT	IOW		000001	SIN	PTPREL		000207'		
CBLAUB		000407'	EXT	ITMCT1		000000	EXT	PTPS2		000357'		
CKS12		000376'	EXT	LI.PIF		000400	SPD	PTPSAV		000267'	EXT	
CPOPJ		000000	EXT	LI.PIN		000200	SPD	PTPSER		000000'	ENT	
CPUKI		000001	SPD	NODIE		000000	EXT	PTPSIO		000024'		
CPUKL		000002	SPD	NOTAPE		000475'		PTPSTS		000015'		
CPUTYP		000001	SPD	OUT		000000	EXT	PTPXF1		000374'		
CPZZ		000000	SPD	P		000001	INT	PTPXF2		000373'		
DBYT		000002	SIN	P1		000014	INT	PTPXF3		000426'		
DCL		000007	SIN	PEVEN8		000351'	EXT	PTPXF4		000403'		
DDINT		000001	SIN	PIOMOD		000366'	EXT	PTPXF5		000407'		
DDXZ		000000	SIN	PT.END		000501'		PTPXFR		000366'		
DEVBUF		000006	SIN	PTP		000100	SPD	RUBOUT		000377	SPD	
DEVCHR		000001	SIN	PTP1		000330'		S		000000	INT	
DEVCLS		000011	SIN	PTP10		000461'		S$ENTR	777777	777775	SIN	
DEVCTR		000015	SIN	PTP2		000355'		S$HALT	777777	777777	SIN	
DEVIAD		000007	SIN	PTP3		000313'		S$NAME		000000'	SPD	
DEVINT		000016	SIN	PTP4		000331'		S$NONA		000000	SIN	
DEVIOS		000002	SIN	PTP5		000353'		S$TEMP	777775	000000	SPD	
DEVLOG		000005	SIN	PTP6		000335'		S$XCT	777777	777776	SIN	
DEVMOD		000004	SIN	PTP9		000452'		SETACT		000224'	EXT	
DEVNAM		000000	SIN	PTPADR		000013'		SETBYT		000246'	EXT	
DEVOAD		000010	SIN	PTPADV		000440'		SETIOD		000474'	EXT	
DEVPTR		000010	SIN	PTPB1		000310'		SIZPTP		000023	SPD	
DEVPWC		000013	SIN	PTPBIN		100000	SPD	STOIOS		000467'	EXT	
DEVSER		000003	SIN	PTPBL		000144		T1		000006	INT	
DEVSTS		000012	SIN	PTPBUF		000030'		T2		000007	INT	
DEVWUC		000014	SIN	PTPCHA		000023'		T3		000010	INT	
DHNG		000005	SIN	PTPCHL		000476'	EXT	T4		000011	INT	
DIE		000000'	EXT	PTPCHN		000226'	EXT	U		000005	INT	
DIN		000011	SIN	PTPCLS		000212'		VERTAB		000213	SPD	
DINI		000004	SIN	PTPCNT		000022'		WAIT1		000212'	EXT	
DOU		000010	SIN	PTPCON		000025'		WRPI	700600	000000		
DRL		000006	SIN	PTPCTR		000020'		WSYNC		000430'	EXT	
DSPSIZ		000012	SPD	PTPDDB		000003'	INT	X.XBU		000003	SIN	
DVOUT		000001	SIN	PTPDON		000010	SPD	X.XFU		000001	SIN	
DVPTP		000400	SIN	PTPDSC		000470'		
DVSIZ		000003	SIN	PTPDSP		000174'		
DXFR		000012	SIN	PTPEND		020000	SPD	
ERROCI		000205'	EXT	PTPEOT		010000	SPD	
F		000004	INT	PTPFDN		000200	SPD	
FORMFD		000014	SPD	PTPFED		200000	SPD	
HNGSTP		000220'	EXT	PTPIB		040000	SPD	
HORTAB		000011	SPD	PTPIN0		000222'		
HUNGST		000400	SIN	PTPIN1		000224'		
IB		000013	SIN	PTPIN2		000235'		
IO		000020	SIN	PTPINI		000207'		
IOACT		010000	SIN	PTPINT		000255'	INT	
IOBEG		000002	SIN	PTPIOS		000005'		

PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88
PTPSER.MAC	 5-JAN-86 23:17		Symbol cross reference

A	   232
ADVBFE	    22%
B	   150	   263
CBLAMB	    24%	   282	   300
CBLAUB	    24%	   280
CKS12	    22%	   271
CPOPJ	    23%
CPUKI	    20
CPUKL	    20
CPUTYP	    20
CPZZ	    20#	    20
DBYT	   100#
DCL	   105#
DDINT	    99#
DDXZ	    98#
DEVBUF	    64#
DEVCHR	    59#
DEVCLS	    67#	   155	   219	   276	   291	   309
DEVCTR	    71#	    78
DEVIAD	    65#	    75
DEVINT	    72#
DEVIOS	    60#	    74	   120
DEVLOG	    63#
DEVMOD	    62#
DEVNAM	    58#
DEVOAD	   270	   272
DEVPTR	    66#	    76
DEVPWC	    69#	   290	   295
DEVSER	    61#	   302
DEVSTS	    68#	    77
DEVWUC	    70#	   296
DHNG	   103#
DIE	    12	    12%	    13
DIN	   107#
DINI	   102#
DOU	   106#	   303
DRL	   104#
DSPSIZ	    98	   109#
DVOUT	    62
DVPTP	    62
DVSIZ	   101#
DXFR	   108#
ERROCI	    23%	   107
F	   120	   155	   176	   219	   270	   272	   276	   290	   291	   295	   296	   302	   309
FORMFD	    52#	   208
HNGSTP	   124%	   128
HORTAB	    50#	   205
HUNGST	    59
IB	   148
IO	   146
IOACT	   298	   319	   336
IOBEG	   130
IODISC	    40#	   119	   147	   179	   240	   324	   328
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88
PTPSER.MAC	 5-JAN-86 23:17		Symbol cross reference

IOFST	   146	   181	   337
IOSET	    22%	   177
IOW	   322	   338
ITMCT1	    22%
LI.PIF	   139
LI.PIN	   142
LISTSN	     3	     6
NODIE	    12%
NOTAPE	   169	   342#
OUT	    23%
P	    13	    99	   115	   118	   128	   134	   143	   154	   177	   236	   266	   267	   271	   280
	   282	   297	   300	   303	   323	   335	   339
P1	   262	   263	   269	   274	   275	   277	   278	   279	   291	   292	   293
PEVEN8	   215%	   236
PIOMOD	    23%	   145	   231	   262
PT.END	   349#
PTP	   113	   126	   140	   165	   167	   168	   191	   201	   244	   320	   342
PTP1	   198	   203	   209	   219#
PTP10	   317	   326#
PTP2	   223	   240#
PTP3	   184	   201#
PTP4	   220#	   234
PTP5	   233	   238#
PTP6	   224#	   313
PTP9	   315	   319#
PTPADR	    76#
PTPADV	   180	   309#
PTPB1	   182	   196#
PTPBIN	    42#	   147	   151	   183
PTPBL	    69	    87#	    89	    90
PTPBUF	    67	    88	    89	    90#
PTPCHA	    80#	   186	   188	   201	   204	   238	   243	   244	   332
PTPCHL	    23%	   249	   343
PTPCHN	    22%	   137
PTPCLS	   105	   117#
PTPCNT	    79#	   153	   192	   197	   212	   245	   327
PTPCON	    82#	   114	   141	   165	   321
PTPCTR	    78#
PTPDDB	    56	    57#	    74	    75	    76	    77	    78	    83	   176
PTPDON	    32#	   136	   138
PTPDSC	   335#
PTPDSP	    61	    97#
PTPEND	    44#	   119	   314	   318
PTPEOT	    45#	   316	   318
PTPFDN	    35#	   152
PTPFED	    41#	   146	   172	   210	   246	   328
PTPIB	    43#	   147	   149	   183
PTPIN0	   127	   130#
PTPIN1	   133#	   160
PTPIN2	   131	   145#
PTPINI	   102	   112#
PTPINT	    25	   165#	   166
PTPIOS	    74#	   171	   247
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88
PTPSER.MAC	 5-JAN-86 23:17		Symbol cross reference

PTPLIT	   346#
PTPNTP	    37#	   126	   168
PTPOUT	   106	   121	   126#	   129
PTPP1	   207	   331#
PTPPTR	    75#	   158	   159	   224	   225	   226	   230
PTPREL	   103	   104	   113#	   335
PTPS2	   173	   243#
PTPSAV	    22%	   175
PTPSER	    12	    13#	    16
PTPSIO	    81#	   170	   174	   248
PTPSTS	    77#	   167
PTPXF1	   264	   269#
PTPXF2	   267#	   281
PTPXF3	   283	   295#
PTPXF4	   276#	   294
PTPXF5	   280#	   299	   301	   304
PTPXFR	   108	   262#
RUBOUT	    49#	   331
S	   119	   120	   130	   146	   147	   149	   151	   170	   171	   172	   174	   179	   181	   183
	   202	   210	   240	   246	   247	   248	   298	   314	   316	   318	   319	   322	   324	   328
	   336	   337	   338
S$ENTR	    12	    18
S$HALT	    12
S$NAME	    16#
S$NONA	    15	    18
S$TEMP	    12#	    12
S$XCT	    18
SETACT	    24%	   134
SETBYT	    22%	   154
SETIOD	    22%	   323	   339
SIZPTP	    83#	   101
STOIOS	    24%	   193	   213	   239	   241	   325	   329	   333
T1	   101	   136	   137	   138	   140	   141	   145	   148	   150	   152	   153	   155	   156	   157
	   158	   186	   187	   188	   189	   190	   191	   196	   197	   219	   220	   221	   227	   228
	   229	   273	   274	   276	   277	   278	   279	   283	   284	   285	   288	   290	   293	   295
	   296	   301	   309	   310	   311	   326	   327
T2	   220	   222	   265	   269	   270	   272	   273	   286	   287	   289	   310	   312
T3	   221	   222	   226	   227	   228	   229	   230	   231	   232	   235	   237	   265	   286	   287
	   288	   289	   311	   312
T4	   281	   284	   285	   302	   303
U	   204	   205	   206	   208	   211	   212	   224	   234	   235	   237	   238	   331	   332
VERTAB	    51#	   206
WAIT1	    23%	   118
WSYNC	    24%	   297
X.XBU	   273
X.XFU	   265	   289
PTPSER - PAPER TAPE PUNCH SERVICE ROUTINE - V405	MACRO 12.5-46.0 14:49 13-JAN-88
PTPSER.MAC	 5-JAN-86 23:17		Macro/Opdef cross reference

IFNCPU	    20
STOPCD	    11
WRPI	   139	   142
XCTBU	   273
XCTFU	   265	   289  I@Ju
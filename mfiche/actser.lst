ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE ACTSER - STREAM ACCOUNTING SERVICE ROUTINES
     9
    10					STOPCD(,ENTRY,ACTSER)^
    11					ENTRY	ACTSER		;For library searches
    12	000000'	260040	000000*	ACTSER::PUSHJ	P,DIE		;**** Default stopcode for "ACTSER" ****
    13	000001'	414364	634562		SIXBIT	/ACTSER/  	;Title of module
    14	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "ACTSER+nnn(nnnnnn)"
    15			000000'	S$NAME==ACTSER			;For STOPCDs with no arguments
    16					SALL>
    17				^
    18
    19				COMMENT /@@MODULE ACTSER
    20				@@PURPOSE
    21				THIS MODULE CONSISTS OF THE DDB, DISPATCH TABLE , AND
    22				DEVICE DEPENDENT ROUTINES FOR THE ACCOUNTING PSEUDO DEVICE,
    23				ACT.  IN ADDITION THERE ARE SUBROUTINES FOR WRITING ACCOUNTING
    24				RECORDS TO THE MONITOR BUFFER.
    25
    26				THE ACT DEVICE IS A MONITOR BUFFER CLASS DEVICE THT LOOKS LIKE ANY
    27				I-O BUS DEVICE TO THE REST OF THE SYSTEM. @@/
    28
    29				;-EDITED SEP 76 A.ATKINSON FOR NEW STREAM ACCT'G FUNCTIONS
    30				;-USER PROGRAMS CAN NOW WRITE STREAM RECORDS VIA NEW
    31				;-	PUTSAR UUO (SOME RECORD TYPES REQUIRE LICENSE).
    32				;-	NEW RECORD TYPE 7 IMPLEMENTED FOR PROJECT-CODE CHANGE.
    33				;-	NEW REC TYPE 10 TO RECORD XCHARG TRU'S GIVEN AWAY.
    34				;-";-" INDICATES MOD RELATING TO ALL THIS.
    35					EXTERNAL JBTAWQ,JOB,JBTLIC
    36
    37					EXTERNAL CBLAMB,TIME,JFYSEC,CLKTRU,CTMBS,ALR620,DBLMSG
    38					EXTERNAL ACREQ,ACWAIT,ACAVAL,PJOBN
    39				EXTERN CBLEMB,CPOPJ,ERRICO,MBBXFR,SETIOD,THSDAT,CLKTRU
    40				EXTERN JBTSTS,JBTAUN,JBTFPN,JBTPPN,JBTSOK,JBTNAM,TAKTRJ
    41				EXTERN NINTRP,CPOPJ1,TSTARM,TAKTRP,ABTUUO
    42				EXTERN ACSWT,JBTABT,MLOWQ,PJBSTS,RNQ,SETRUN,WSCHED
    43				EXTERN UPTSTS,REC.WR,LSAREC
    44				; DEFINE ACCOUNTING DEVICE DDB
    45
    46	000000			ACTDDB:	PHASE 0
    47	000003'	414364	000000	DEVNAM:	SIXBIT /ACT/
    48	000004'	000000	000100	DEVCHR:	100		;NO HUNG DEVICE TIME
    49	000005'	000000	000000	DEVIOS:	0
    50	000006'	000000	001024'	DEVSER:	EXP ACTDSP
    51	000007'	000002	004400	DEVMOD:	DVIN,,<1_IB>!<1_I>
    52	000010'	000000	000000	DEVLOG:	0
    53	000011'	000000	000000	DEVBUF:	0
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 1
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

    54	000012'	000000	000000	DEVIAD:	0
    55	000013'	000000	000000	DEVOAD:	0
    56	000014'	000000	000024'	DEVCLS:	XWD 0,ACTBUF	;SAME TYPE AS IO BUS DEVICES
    57	000015'	000000	000000	DEVSTS:	0
    58			400000	 XP ACTDED,400000	;WATCHDOG SETS THIS IF CHKPNT DIES
    59	000016'	000000	000000	DEVPWC:	0
    60	000017'	000000	000000	DEVWUC:	0
    61	000020'	000000	000000	DEVCTR:	0
    62	000021'	000000	000000	DEVINT:	0		;SOFTWARE INTERRUPT WORD
    63	000022'				DEPHASE
    64			000017	ACTDDS==.-ACTDDB
    65
    66			001000	ACTBL=1000	;BUFFER SIZE
    67				;DEFINE IN & OUT PTRS, WITH BUFFER CONTAINING INITIAL
    68				; TYPE 11 'SYSTEM UP' RECORD OF 2 WORDS. NEVER WRITTEN BY ANYBODY.
    69	000022'	000026'	000024'		XWD ACTBUF+2,ACTBUF		;IN AND OUT
    70	000023'	000000	001024'		EXP ACTBUF+ACTBL		;LAST
    71	000024'	011000	000002	ACTBUF:	XWD 011000,2	;SYSTEM UP HEADER WORD
    72	000025'	011000	000002		XWD 011000,2	;REPEAT FOR GOOD MEASURE
    73	000026'				BLOCK ACTBL-2	;TOTAL ACTBL WORDS OF BUFFER
    74
    75				; DISPATCH TABLE
    76
    77	000000			ACTDSP:	PHASE 0
    78	001024'	000000	000015	DDXZ:	DSPSIZ
    79	001025'	254000	001066'	DDINT:	JRST INTACT
    80	001026'	004400	004400	DBYT:	4400,,4400
    81	001027'	201300	000017	DVSIZ:	MOVEI T1,ACTDDS
    82	001030'	263040	000000	DINI:	POPJ P,
    83	001031'	263040	000000	DHNG:	POPJ P,
    84	001032'	254000	001052'	DRL:	JRST ACTREL
    85	001033'	263040	000000	DCL:	POPJ P,
    86	001034'	254000	000000*	DOU:	JRST ERRICO
    87	001035'	254000	001042'	DIN:	JRST ACTIN
    88	001036'	254000	001103'	DXFR:	JRST ACTXFR
    89	001037'	263040	000000	DGTRD:	POPJ P,
    90	001040'	254000	001063'	DMT:	JRST ACTEOF
    91	001041'	254000	001207'	DGF:	JRST ACTUGF
    92			000015		DSPSIZ==.-1
    93	001042'				DEPHASE
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

    94				COMMENT /
    95				@@SUBROUTINE ACTIN
    96				@@PURPOSE
    97				DEVICE DEPENDENT FUNCTION FOR INPUT UUO
    98				@@ENTRY
    99				ACCUMULATORS S AND F SET UP TO DEVIOS AND ACTDDB
   100				@@ACCUM
   101				T1,T2,T3
   102				@@TABLES
   103				ACTDDB, ACTBUF
   104				@@FUNCTION
   105				IF MONITOR BUFFER IS NON EMPTY THEN RETURN;
   106				ELSE SET IOACT AND RETURN UNLESS THE MODE (LOW ORDER 9 BITS OF
   107				DEVIOS) IS 110, IN WHICH CASE CLEAR IOACT AND SET IOEND.
   108
   109				THE MODE IS SET TO 110 BY THE MTAPE UUO FOR ACT AND
   110				IS USED TO INDICATE THAT THE CALLER WANTS AND EOF WHEN
   111				THE BUFFER IS EMPTY.
   112				@@EXIT
   113				DEVIOS IS UPDATED
   114				@@CALLS
   115				CBLEMB
   116				@@/
   117
   118	001042'	260040	000000*	ACTIN:	PUSHJ P,CBLEMB		;FIND SPACE IN MONITOR BUFFER
   119	001043'	326300	000000*		JUMPN T1,CPOPJ	;BUFFER IS NON EMPTY. O.K. TO TRANSFER IT
   120	001044'	660000	010000		TRO S,IOACT	;EMPTY BUFFER SET IOACT
   121	001045'	135300	001605'		LDB T1,[POINT 9,DEVIOS(F),35]
   122	001046'	306300	000110		CAIN T1,110		;CALLER WANTS EOF WHEN BUFFER EMPTY?
   123	001047'	650000	001606'		TDC S,[IOEND,,IOACT] ;YES. CLEAR IOACT AND SET IOEND
   124	001050'	202004	000002		MOVEM S,DEVIOS(F)
   125	001051'	263040	000000		POPJ P,
   126
   127				COMMENT /@@SUBROUTINE ACTREL
   128				@@PURPOSE
   129				DEVICE DEPENDENT CODE FOR RELEASE UUO
   130				@@ACCUM
   131				U,W,T1,T2
   132				@@FUNCTION
   133				SENDS "*** ACCOUNTING DEVICE RELEASED ***" MESSAGE TO
   134				OPER & CTY TERMINALS, OR JUST CTY IF NO OPER. AAA JAN 77
   135				@@CALLS
   136				DBLMSG (CLOCK1, PG. 10)
   137				@@/
   138
   139	001052'	261040	000004	ACTREL:	PUSH P,F		;DBLMSG CLOBBERS F,U,T1,..
   140					MOVEI T1,[BYTE (7)7,7,7,7,7	; RING BELL GOOD
   141						ASCIZ /
   142				*** ACCOUNTING DEVICE RELEASED ***
   143	001053'	201300	001607'	/]
   144	001054'	260040	000000*		PUSHJ P,DBLMSG	;SEND TO OPR & CTY ELSE JUST CTY
   145	001055'	201300	000040		MOVEI T1,ALRACT
   146	001056'	436300	000000*		IORM T1,ALR620
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2-2
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   147	001057'	260040	001105'		PUSHJ P,WAKACJ	;IF WAITERS EXIST, UNWAIT ONE OF THEM
   148	001060'	255000	000000		JFCL		;(ALWAYS SKIPS)
   149	
   150	001061'	262040	000004		POP P,F
   151	001062'	263040	000000		POPJ P,
   152
   153				COMMENT /@@SUBROUTINE ACTEOF
   154				@@PURPOSE
   155				TO FLAG THAT THE CALLER WANTS AN EOF WHEN THE
   156				MONITOR BUFFER IS EMPTY
   157				@@ENTRY
   158				F MUST BE SET UP TO ACTDDB
   159				@@ACCUM
   160				T1
   161				@@TABLES
   162				ACTDDB
   163				@@FUNCTION
   164				SETS THE MODE FIELD OF DEVIOS (LOW ORDER 9 BITS) TO 110.  CALLED
   165				VIA MTAPE DISPATCH.
   166				@@EXIT
   167				DEVIOS UPDATED
   168				@@/
   169	001063'	201300	000110	ACTEOF:	MOVEI T1,110
   170	001064'	542304	000002		HRRM T1,DEVIOS(F)	;MAKE SURE IOACT IS RESET
   171	001065'	263040	000000		POPJ P,
   172				; DEVICE DEPENDENT INTERRUPT CHECK ROUTINE
   173				; CALLED FROM UUOCON VIA DDINT DISPATCH (-6)
   174				; ON ENTRY (T2)=INTERRUPT CONDITION CODE
   175
   176				COMMENT /@@SUBROUTINE INTACT
   177				@@PURPOSE
   178				TO CHECK SOFTWARE INTERRUPT CONDITIONS FOR ACT.
   179				@@ENTRY
   180				(T2)=INTERRUPT CONDITION CODE (0-5)
   181				@@ACCUM
   182				T2
   183				@@TABLES
   184				ACTBUF
   185				@@FUNCTION
   186				CALLED FROM INTRMT UUO CODE AND GIVES 0, 1, OR 2 SKIP RETURN:
   187				0 SKIP - INVALID INTERRUPT CONDITION FOR THIS DEVICE
   188
   189				1 SKIP - VALID CONDITION BUT NOT SATISFIED AT THIS TIME
   190
   191				2 SKIP- TAKE IMMEDIATE INTERRUPT
   192				@@/
   193	001066'	256007	001071'	INTACT:	XCT INTTAB(T2)
   194	001067'	350001	000000		AOS (P)		;TRAP NOW CONDITION
   195	001070'	254000	000000*		JRST CPOPJ1	;NO ERROR. BUT NO TRAP EITHER
   196
   197	001071'	260040	001077'	INTTAB:	PUSHJ P,BUFCHK	;CHECK BUFFER FOR INPUT AVAILABLE
   198	001072'	263040	000000		POPJ P,		;ERROR ON OUTPUT
   199	001073'	254000	001070*		JRST CPOPJ1	;NO IMMEDIATE TRAP ON I/O WAIT
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2-3
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   200	001074'	263040	000000		POPJ P,		;NO EOF TRAP
   201	001075'	263040	000000		POPJ P,		;NO ERROR TRAP
   202	001076'	263040	000000		POPJ P,		;NO SPECIAL TRAP
   203
   204	001077'	204340	000022'	BUFCHK:	MOVS T2,ACTBUF-2	;GET BUFFER IN AND OUT POINTERS
   205	001100'	316340	000022'		CAMN T2,ACTBUF-2	;BUFFER EMPTY?
   206	001101'	350001	000000		AOS (P)			;YES.
   207	001102'	263040	000000		POPJ P,			;NO.
   208
   209				; TRANSFER ROUTINE. DO A TRANSFER. THEN UNWAIT SOMEONE
   210				;	IF THE SITUATION WARRANTS (ACJOB .NE. 0)
   211
   212				;REGISTERS:  ASSUMES F, P1,P3 ETC. ARGS FOR MBBXFR
   213				;	     RRETURNS T1,T2,T3 TO CALLER (MBICDR)
   214
   215	001103'	260040	000000*	ACTXFR:	PUSHJ P,MBBXFR	;DO XFER, SKIP SUCCESS
   216	001104'	254000	001043*		JRST CPOPJ
   217				;WAKACJ- WAKE ACT JOB. IF ANY JOB OWNS THE RESOURCE AND IS IN
   218				;MON WAIT QUEUE, HIS JOB IS IN ACJOB. UNWAIT HIM. IF HE
   219				;COMPLETES HE WILL UNWAIT OTHERS.  CALLED BY ACTREL.
   220
   221	001105'	261040	000002	WAKACJ:	PUSH P,J	;OWNERS JOB NO.
   222	001106'	336100	001500'		SKIPN J,ACJOB	;IS THERE AN ACJOB
   223	001107'	254000	001116'		JRST JPOPJ1	;NOPE
   224	001110'	402000	001500'		SETZM ACJOB	;KEEP THIS FROM HAPPENING AGAIN
   225	001111'	261040	000006		PUSH P,T1
   226	001112'	201300	000000*		MOVEI T1,RNQ	;MAKE RUNNABLE
   227	001113'	137300	000000*		DPB T1,PJBSTS	;THE JOB IN J
   228	001114'	260040	000000*		PUSHJ P,SETRUN	;(SETRUN USES ONLY T1)
   229	001115'	262040	000006		POP P,T1
   230	001116'	350001	777777	JPOPJ1:	AOS -1(P)	;RETURN IS BEHIND J
   231	001117'	262040	000002	JPOPJ:	POP P,J
   232	001120'	263040	000000		POPJ P,
   233				COMMENT ! ROUTINE ACTWRT
   234				PURPOSE: PUT AN ACCOUNTING REC INTO STREAM IF NECESSARY.
   235				EXPECTS: T1/ RECORD TYPE
   236					J/ JOB NUMBER FOR WHICH ENTRY TO BE MADE
   237					(SINCE THIS IS ALWAYS CALLED AT UUO LEVEL, THIS
   238					SHOULD BE CURRENT JOB)
   239					UPTSTS/ REC.WR AND LSAREC BITS
   240
   241				TABLES: DEPENDING ON RECORD TYPE, MANY JBT'S AND UPT TABLES
   242					JBTFPN, JBTPPN REF'D HERE
   243				CLOBBERS: T1-T4
   244				FUNCTION:
   245				IF TYPE IS ILLEGAL CRASH SYSTEM. THIS ROUTINE TO BE CALLED ONLY
   246				BY MONITOR WHEN USER DOES SOMETHING (RUN PROG, ETC.) WHICH REQUIRES
   247				A RECORD. NO REFERENCE TO USER CORE..NO PAGE FAULTS ETC POSSIBLE.
   248				PUTSAR & XCHARG DO NOT USE THIS ROUTINE. SEE ACRTAB FOR
   249				RECORD TYPES, SIZES. LICENSE FIELD IN ACRTAB NOT
   250				RELEVANT FOR THIS ROUTINE.
   251				RESTRICTIONS: CALL ONLY AT UUO LEVEL DUE TO POSSIBLE AC WAIT.
   252
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2-4
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   253				ERRORS: STOPCD ON INVALID RECORD TYPE
   254
   255
   256				ACTION FOR EACH RECORD TYPE:
   257				TYPE 0 (RUN): IF JBTFPN=JBTPPN,CLEAR REC.WR&LSAREC,WRITE RECORD
   258					ELSE CLEAR LSAREC,SET REC.WR,WRITE RECORD
   259				TYPE 1 OR 3 (EXIT OR SETNAM): CLEAR REC.WR & LSAREC; IF REC.WR
   260					WAS SET WRITE A RECORD
   261				TYPE 2 (EXIT AC,): IF REC.WR SET WRITE A RECORD
   262				TYPE 4,5,6 (START,REE,DDT): IF JBTFPN=0 OR JBTFPN=JBTPPN,RETURN
   263					IF REC.WR IS SET,RETURN
   264					ELSE SET REC.WR,CLEAR LSAREC,WRITE RECORD,RETURN
   265				TYPE 7 (PROJ CODE): WRITE REC & RETURN
   266				TYPE 10,11 : STOPCD
   267				TYPE 12 (DATE CHANGE,NOT IMPLEMENTED YET): WRITE RECORD & RETURN
   268				TYPE 13 (LOCAL STREAM ACCOUNTING): IF LSAREC SET,RETURN
   269					ELSE SET REC.WR & LSAREC,WRITE RECORD,RETURN
   270
   271				MEANING OF REC.WR=1: A RUN OR LOCAL STREAM ACCTG UUO
   272					HAS PUT A BEGINNING RECORD IN STREAM; NEXT EXIT,
   273					SETNAM ETC. SHOULD PUT OUT AN ENDING RECORD & RESET  REC.WR
   274				MEANING OF LSAREC: 0-NO LOCAL STR.REC PUT OUT SINCE LAST RUN
   275					1-ALREADY PUT ONE OUT, NO MORE ALLOWED.
   276
   277				!
   278				 INTERNAL ACTWRT,ACTDDB,ACTDDS
   279	001121'	331000	000006	ACTWRT:	SKIPL T1		;TYPE NEGATIVE?
   280	001122'	303300	000023		CAILE T1,NACDTS		;OR TOO BIG?
   281	001123'	256000	000000'		STOPCD		;YES. SOMBODY GOOFED
   282	001124'	200340	000000*		MOVE T2,%UPT+UPTSTS	;PICK UP REC.WR & LSAREC STATUS
   283	001125'	256006	001126'		XCT  ACTTAB(T1)	;-DISPATCH ON TYPE,SPECIAL FOR 7
   284
   285
   286				COMMENT ! THE FOLLOWING ACTTAB TABLE MUST AGREE WITH ACRTAB
   287					AS TO LEGAL RECORDS, ETC.
   288				!
   289	001126'	254000	001151'	ACTTAB:	JRST ACTT0	;0- RUN RECORD
   290	001127'	254000	001155'		JRST ACTT1	;1- EXIT
   291	001130'	254000	001164'		JRST ACTT2	;2- EXIT AC,
   292	001131'	254000	001155'		JRST ACTT1	;3- SETNAM UUO
   293	001132'	254000	001167'		JRST ACTT3	;4- START COMMAND
   294	001133'	254000	001167'		JRST ACTT3	;5- REENTER
   295	001134'	254000	001167'		JRST ACTT3	;6- DDT COMMD
   296	001135'	254000	001300'		JRST WRTACR	;-7 CHANGE PROJECT..SEE WRTACT DISPATCH
   297	001136'	256000	000000'		STOPCD		;-10 XCHARG..DONT COME THRU HERE
   298	001137'	256000	000000'		STOPCD		;-11 SYSTEM UP..NEVER SUPPOSED TO BE WRITTEN
   299	001140'	254000	001300'		JRST WRTACR	;-12 DATE CHANGE..SEE WRTACT DISPATCH
   300	001141'	254000	001175'		JRST ACTT13	;-13 LOCAL STR ACCTG
   301	001142'	254000	001300'		JRST WRTACR	;-14 SETLIC UUO
   302	001143'	254000	001300'		JRST WRTACR	;-15 SETE UUO
   303	001144'	254000	001201'		JRST ACTT16	;-16 RUN LICENSE
   304	001145'	256000	000000'	        STOPCD          ;-17 TRANSACTION CHARGE; NOT CALLED THRU HERE
   305	001146'	256000	000000'	        STOPCD          ;-20 ROYALTY BEGIN/END; NOT CALLED THRU HERE
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 2-5
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   306	001147'	256000	000000'	        STOPCD          ;-21 TRU COMP CHKPNT; NOT CALLED THRU HERE
   307	001150'	254000	001204'	        JRST    ACTT22  ;-22 CREAUX
   308			000023	NACDTS==.-ACTTAB
   309
   310	001151'			ACTT0:	;RUN
   311	001151'	200402	000000*		MOVE T3,JBTPPN(J)
   312	001152'	336002	000000*		SKIPN  JBTLIC(J)	;IF LICENSE SET,FORCE RECORD
   313	001153'	312402	000000*		CAME T3,JBTFPN(J)
   314	001154'	254000	001161'		JRST ACTT01		;RAN OUT OF ANOTHER UFD
   315	001155'			ACTT1:	;EXIT,SETNAM
   316	001155'	623340	000000*		TLZE T2,REC.WR!LSAREC	;LSAREC NEVER ON BY ITSELF
   317	001156'	260040	001300'	ACTT02:	PUSHJ P,WRTACR	;T1/TYPE; T2/UPTSTS..PRESERVED. GO WRITE RECORD
   318	001157'	202340	000000*		MOVEM T2,%UPT+UPTSTS	;SAVE UPDATED REC.WR,LSAREC
   319	001160'	263040	000000		POPJ P,
   320	001161'			ACTT01:	;RAN FROM OTHER UFD
   321	001161'	661340	000000*		TLO T2,REC.WR
   322	001162'	621340	000000*		TLZ T2,LSAREC
   323	001163'	254000	001156'		JRST ACTT02
   324
   325	001164'			ACTT2:	;EXIT AC,
   326	001164'	603340	001161*		TLNE T2,REC.WR
   327	001165'	254000	001156'		JRST ACTT02
   328	001166'	263040	000000		POPJ P,
   329
   330	001167'			ACTT3:	;START,REE,DDT
   331	001167'	332402	001153*		SKIPE T3,JBTFPN(J)
   332	001170'	316402	001151*		CAMN T3,JBTPPN(J)
   333	001171'	263040	000000		POPJ P,
   334	001172'	607340	001164*		TLNN T2,REC.WR
   335	001173'	254000	001161'		JRST ACTT01	;GO SET REC.WR,CLEAR LSAREC,WRITE RECORD
   336	001174'	263040	000000		POPJ P,
   337
   338	001175'			ACTT13:	;LOCAL STR ACCT UUO
   339	001175'	603340	001162*		TLNE T2,LSAREC		;IF ON, ALREADY DID THIS. JUST EXIT
   340	001176'	263040	000000		POPJ P,
   341	001177'	661340	000000*		TLO T2,REC.WR!LSAREC	;SET BOTH SO LSAREC PREVENTS
   342						;ANOTHER ONE OF THESE, AND REC.WR CAUSES
   343						;TERMINATING RECORD TO BE WRITTEN
   344	001200'	254000	001156'		JRST ACTT02	;GO WRITE
   345
   346	001201'			ACTT16:	;RUN LICENSE, FOLLOWS RUN RECORD IMMEDIATELY
   347	001201'	332002	001152*		SKIPE JBTLIC(J)	;IF LICENSE GOT SET,
   348	001202'	324740	001300'		PJRST WRTACR	;WRITE RECORD & RETURN
   349	001203'	263040	000000		POPJ P,		;ELSE JUST RETURN
   350
   351	001204'			ACTT22: ;CREAUX
   352	001204'	200440	000000*	        MOVE    T4,AUXEND       ;COMPUTE RECORD
   353	001205'	275440	777771*	        SUBI    T4,AUXSTR-AUXMIN-1      ; SIZE
   354	001206'	324740	001300'	        PJRST   WRTACR          ;DO THE WRITE
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 3
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   355				COMMENT ~ @@SUBROUTINE ACTUGF
   356				@@PURPOSE
   357				PERFORM UGETF FUNCTION FOR ACT DEVICE. GIVEN A RECORD
   358				TYPE IT RETURNS THE SIZE OF THE RECORD
   359				@@ENTRY
   360				(M)=LOCATION OF DATA AND TO RETURN DATA
   361				@@FUNCTION
   362				FOR NOW IF TYPE IS 0 TO 6 RETURNS 7 OTHERWISE 0
   363				@@EXIT
   364				HAS DY STORED IN (M)
   365				@@RESTRICTIONS
   366				CAN BE CALLED ONLY AT UUO LEVEL.@@
   367
   368				ACTUGF:	UMOVE	T1,(M)	;OLD ROUTINE (KLUDGE)
   369					CAIG	T1,6
   370					CAIGE	T1,0
   371					 TDZA	T1,T1	;RETURN 0 IF NOT IN RANGE 0-6
   372					MOVEI	T1,7	;ELSE 7. WHEN MORE TYPES, WILL BE HARDER
   373					UMOVEM	T1,(M)
   374					POPJ	P,
   375				~  ;End COMMENT
   376
   377				;-NEW UGETF CODE PICKS UP REC SIZE OUT OF TABLE ACRTAB:
   378
   379	001207'	256200	001620'	ACTUGF:	UMOVE	T2,(M)	;TYPE TO FIND
   380	001210'	205400	777750		MOVSI	T3,-ACRTL
   381	001211'	135300	001475'	ACTUGA:	LDB	T1,ACYTYP
   382	001212'	316300	000007		CAMN	T1,T2
   383	001213'	254000	001217'		 JRST	ACTUG0
   384	001214'	253400	001211'		AOBJN	T3,ACTUGA
   385	001215'	201300	000000		MOVEI	T1,0	;RETURN 0 IF NOT IN TABLE
   386	001216'	254000	001222'		JRST	ACTUG1
   387
   388	001217'	135300	001477'	ACTUG0:	LDB	T1,ACYSIZ
   389	001220'	135340	001476'		LDB	T2,ACYMIN	;RETURN MIN SIZE IN LHS
   390	001221'	504300	000007		HRL	T1,T2		; IF REC IS VAR LENGTH
   391	001222'	256200	001621'	ACTUG1:	UMOVEM	T1,(M)
   392	001223'	263040	000000		POPJ	P,
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 4
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   393				COMMENT %	SUBROUTINES GETABS (FOR UUO'S) & MGETABS
   394				PURPOSE: CALLED TO GET ACT BUFFER SPACE (HENCE "GETABS")
   395				 & ACT RESOURCE. IF MGETABS/GETABS SUCCESS-RETURNS (SKIP),
   396				 THE CALLER MAY WRITE HIS RECORD;HE HAS BEEN GIVEN THE
   397				 ACT RESOURCE.  HE MUST RELEASE IT WHEN DONE (CALL RELACB).
   398				  GETABS STARTS UP THE OWNER OF THE ACT DEVICE AS MANY TIMES
   399				AS NEEDED TO GET C(P1) WORDS OF RECORD SPACE IN THE BUFFER.
   400				 THE ACT-DEVICE OWNER IS NEVER PUT INTO WAIT FOR HIMSELF
   401				 TO EMPTY THE BUFFER.
   402
   403				IF GETABS/MGETABS FRETURNS (NO SKIP) THEN THE AC RESOURCE
   404				HAS NOT BEEN INTERLOCKED. A UUO MAY FRETURN TO HIS CALLER. THE
   405				MONITOR SHOULD PROCEED DOING NOTHING TO ACT.
   406
   407				VARIOUS STATES OF THE WORLD EXIST WHICH AFFECT THE BEHAVIOUR
   408				OF THESE ROUTINES. SEE COMMENTARY FOLLOWING CODE FOR STATE
   409				DIAGRAM & DISCUSSION.
   410				;-ENTRY
   411					J/ WRITER'S JOB
   412					P1/ SIZE OF HIS RECORD
   413				;-RETURNS:  J,P1-4 PRESERVED.  RH(F)=ACTDDB,
   414						T1,T2,T3,T4 CLOBBERED
   415					NON-SKIP - NO SPACE AVAILABLE & NO ACT OWNER
   416						(OR STREAM DEAD & CALLER IS ACTOWNER). CALLER SHOULD
   417						NOT TRY TO WRITE ACT. PROBABLY BETTER TO FRETURN
   418						TO HIS CALLER.
   419					SKIP - OK TO WRITE INTO ACT BUFFER. CALLER NOW
   420						OWNS AC RESOURCE.
   421				;-TABLES
   422					ACTBUF,ACTDDB,JBTPIP,JBTAWQ,JBTENB
   423				;-CALLS
   424					CTMBS,TAKTRJ,SETIOD
   425				;-RESTRICTIONS
   426					CALL GETABS ONLY FROM UUO LIKE PUTSAR WHICH CAN BE ABORTED
   427					CALL MGETABS ONLY FROM WRTACR.  NO ABORT POSSIBLE
   428				  %
   429
   430	001224'	334200	001622'	MGETABS: SKIPA F,[1B0+ACTDDB]	;SIGN BIT FLAGS MONITOR CALL
   431	001225'	201200	000003'	GETABS:: MOVEI F,ACTDDB		;UUO CALL
   432	001226'	261040	000002		PUSH P,J	;SAVE J FROM TAKTRJ
   433	001227'	261040	000014		PUSH P,P1	;SAVED RECORD SIZE
   434	001230'	205300	400000		MOVSI T1,ACTDED
   435	001231'	200342	000000*		MOVE T2,JBTAUN(J)
   436	001232'	135440	000000*		LDB T4,PJOBN
   437	001233'	430351	001231*		XOR T2,JBTAUN(T4)	;T2_0 IF AUN OWNER=AUN CALLER
   438	001234'	612304	000012		TDNE T1,DEVSTS(F)
   439	001235'	322340	001275'		JUMPE T2,XXFRET	;COMMENTARY PT 1
   440				;INTERLOCK
   441	001236'	352000	000000*		AOSE ACREQ
   442	001237'	260040	000000*		PUSHJ P,ACWAIT	;POSSIBLE WAIT. COMMENTARY PT 2
   443	001240'	402000	000000*		SETZM ACSWT	;CLEAN UP SWAPPER AFTER RESCHEDULE
   444	001241'	201300	001344'		MOVEI T1,RELACB	;"RELACB" ESTABLISHED AS
   445	001242'	202302	000000*		MOVEM T1,JBTABT(J)	;PANIC ABORT ROUTINE
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 4-2
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   446				;RETURN HERE FROM MLOWQ WAIT BELOW
   447	001243'	260040	000000*	MLLOOP:	PUSHJ P,CTMBS	;T1_TOT AVAIL, T2,T3 CLOB
   448	001244'	135440	001232*		LDB T4,PJOBN
   449	001245'	200600	000006		MOVE P1,T1
   450	001246'	274601	000000		SUB P1,(P)	;P1_TOT AVAIL -REQUEST = WHAT'S LEFT
   451					JUMPE T4,[ JUMPGE P1,XXSRET	;COMMENTARY PT 4
   452	001247'	322440	001623'			   JRST RAFRET]	;REL ACT & FAIL
   453				;ACT OWNER EXISTS
   454	001250'	301600	000536		CAIL P1,ACBLIM	;COMMENTARY PT 5
   455	001251'	254000	001260'		JRST GETAB2	;NO NEED TO NOTIFY
   456	001252'	201300	010000		MOVEI T1,IOACT
   457	001253'	413300	000005'		ANDCAB T1,ACTDDB+DEVIOS
   458	001254'	603300	000001		TLNE T1,IOW
   459	001255'	260040	000000*		PUSHJ P,SETIOD	;ACT OWNER OUT OF IO WAIT IF IN IOWAIT
   460	001256'	135300	000000*		LDB T1,NINTRP	;TRAP NO OF "INPUT AVAIL" TRAP
   461	001257'	260040	000000*		PUSHJ P,TAKTRJ	;COMMENTARY PT 5A. CLOB T1,J
   462	001260'			GETAB2:
   463	001260'	200100	000000*		MOVE J,JOB
   464	001261'	325600	001273'		JUMPGE P1,XXSRET	;COMMENTARY PT 6
   465				;NOT ENUF SPACE
   466					JUMPGE F,[	SKIPL JBTAWQ(J)	;POINT 7
   467							JRST GETAB3
   468							PUSHJ P,RELACB ;GIVE BACK AC BEFORE ABORTING.
   469	001262'	325200	001625'				JRST ABTUUO]
   470	001263'	135440	001244*		LDB T4,PJOBN
   471	001264'	316440	001260*		CAMN T4,JOB
   472	001265'	254000	001274'		JRST RAFRET	;POINT 8. REL ACT & FAIL
   473				;MLOWQ WAIT. NOT ENUF SPACE. ACTXFR WAKES US UP & WE TRY AGAIN.
   474	001266'			GETAB3:
   475	001266'	202100	001500'		MOVEM J,ACJOB
   476	001267'	201300	000000*		MOVEI T1,MLOWQ
   477	001270'	137300	001113*		DPB T1,PJBSTS
   478	001271'	260040	000000*		PUSHJ P,WSCHED	;POINT 9
   479	001272'	254000	001243'		JRST MLLOOP	;TRY AGAIN
   480
   481	001273'	354001	777776	XXSRET:	AOSA -2(P)
   482	001274'	260040	001344'	RAFRET:	PUSHJ P,RELACB	;DE-INTERLOCK & FAIL RETURN
   483	001275'	262040	000014	XXFRET:	POP P,P1
   484	001276'	262040	000002		POP P,J
   485	001277'	263040	000000		POPJ P,
   486
   487				COMMENT ! COMMENTARY ON ABOVE:
   488
   489				THIS ROUTINE RESPONDS TO THE FOLLOWING STATE VARIABLES:
   490				EVENT..1)UUO CALL, OR 2)MONITOR CALL
   491				STATE OF STREAM..
   492					1) ACTOWNER EXISTS & ACTDED=0 (STREAM OK)
   493					   BY CONVENTION WE NEVER ALLOW ACTDED=1 IF
   494					   NO ACTOWNER. WHEN NO ACTOWNER, SYSTEM IS UP FOR
   495					   FREE, & ACTDED MUST BE KEPT 0.
   496					2) ACTDED=1 STREAM DEAD
   497					3) ACT NOT OWNED (SYSTEM BEING RUN FOR FREE OR CHKPNT
   498					   IS SLOW IN INITTING ACT)
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 4-3
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   499					   ***NOTE THAT CHKPNT JOB HAS ACT ASSIGNED AT
   500						ALL TIMES EVEN IF IT DIES OR EXITS OR
   501						DOES RELEASE ACTDV. ONLY A DEASSIGN ACT
   502						OR LOGOUT WILL MAKE SYSTEM RUN FOR FREE.***
   503				STATE OF ACT RESOURCE..1)AVAILABLE 2)INTERLOCKED
   504				SPACE IN BUFFER..1)ENUF FOR THIS RECORD  2)INSUFFICIENT
   505				AUN OF CALLER	1)SAME AS ACT DEV OWNER, 2)DIFFERENT
   506				JOB NO. OF CALLER (ONLY TESTED WHEN WRTACR CALLS)
   507						1) SAME AS ACT DEV OWNER
   508						2)DIFFERENT
   509
   510				EVENT,STREAM,RESOURCE,SPACE,CALLER
   511
   512				(STREAM OK)
   513				X111X - SRETURN
   514				X112X - ML WAIT THEN RETEST STATE
   515				X122X- AC WAIT, THEN TEST STATE
   516
   517				(STREAM DEAD)
   518				X2XX1 - FRETURN. THIS IS THE CASE WHERE USER WHOSE AUN MATCHES
   519					THAT OF THE (DECEASED) CHKPNT IS TAKING SOME ACTION--UUO
   520					OR OTHERWISE--WHICH IS TRYING TO WRITE A RECORD.
   521					SINCE ACTDED IS *ALREADY* ON, WE FRETURN SO HE CAN
   522					DO ANYTHING TO GET CHKPNT BACK ALIVE.  NOTE THAT IF
   523					ACTDED GOES ON *AFTER* SUCH A USER HAS ENTERED
   524					AC OR ML WAIT, THE USER CONTINUES TO HANG.  ONLY SUCH
   525					USERS WHO COME IN AFTER ACTDED GOES ON GO FOR FREE.
   526
   527				12XX2 - AC AND/OR ML WAIT, THEN TEST/RETEST STATE. NOTE THAT
   528					EVEN IF ACTDED IS ALREADY ON, A UUO FROM NON-ACTOWNER
   529					AUN GOES INTO AC/ML WAIT IN GETABS. GETABS DOES NOT
   530					FRETURN, BUT CONTINUES TO WAIT, EVEN IF AWAKENED.
   531					THIS ROUTINE WILL FRETURN FOR SUCH A UUO ONLY
   532					IF ACT IS DEASSIGNED (SYSTEM RUNNING FOR FREE) &
   533					NO SPACE EXISTS TO WRITE.  IT CAN BE AWAKENED BY
   534					ACT OWNER COMING ALIVE & DOING RELEASE ACTDEVICE,
   535					(OR INPUT FROM ACTDEVICE, IN WHICH CASE THIS ROUTINE
   536					WILL EVENTUALLY SRETURN WITH SPACE).
   537				22XX2 - ML OR AC WAIT, THEN (RE)TEST STATE.  SOMEBODY
   538					BESIDES ACT OWNER HAS DONE SOMETHING CAUSING MONITOR
   539					TO TRY TO WRITE A RECORD. ML WAIT WILL AWAKE IF
   540					ACTXFR OR ACTREL RUNS. AC WAITERS AWAKE WHEN ML WAITER
   541					DOES RELACB. WHEN STATE IS TESTED OR RETESTED, WE
   542					CONTINUE TO WAIT IF STREAM STILL DEAD. IF ACT
   543					DEASSIGNED,SEE X3XXX STATES BELOW. IF CHKPNT RUNS AGAIN
   544					SUCCESSFULLY, IT RESETS ACTDED IN WHICH CASE SEE X1XXX.
   545
   546				(NO OWNER..NO SYSTEM ACCT'G..RUNNING FOR FREE)
   547
   548				X311X - SRETURN. WE WRITE IN TO BUFF AS LONG AS THERE'S SPACE
   549				X312X - FRETURN. SPACE RAN OUT, FORGET ALL SUBSEQUENT RECORDS.
   550					(ASSUMES CALLER UUO RETURNS SPECIAL "NO ACCTG"
   551					ERROR CODE TO USER, OR WRTACR EXITS DOING NOTHING).
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 4-4
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   552				X32XX - AC WAIT THEN TEST STATE.
   553
   554				POINT 1
   555				FRETURN W/O RESOURCE IF ACTDED=1 & CALLER AUN=OWNER AUN.
   556				NO TEST HERE FOR ACTOWNER IN T4 = 0 SINCE ASSUMPTION
   557				THAT ACTOWNER.NE.0 IF ACTDED=1
   558
   559				POINT 2
   560				IF NO ACT OWNER, OK TO GO INTO ACWAIT BECAUSE
   561				1)NO ONE EVER GOES INTO ML WAIT IF NO ACT OWNER
   562				2)ANY OTHER AC OWNER IS IN PAGE WAIT,ETC & IS SURE TO
   563				WAKE US UP WHEN HE RELEASES RESOURCE AT RELACB
   564
   565				POINT 2A
   566				ITS OK TO PUT ACT DEV OWNER INTO ACWAIT.  IF ACT OWNER
   567				DOES SOMETHING REQUIRING A RECORD YET AC RESOURCE NOT AVAIL,
   568				THEN SOMEONE ELSE OWNS IT. THIS SOMEONE HAS RESCHEDULED
   569				SINCE ACT OWNER IS RUNNING. THE SOMEONE RESCHEDULED
   570				FOR EITHER 1)PAGE FAULT,PARITY ERROR ETC. ,OR 2)ML WAIT,
   571				FOR ACT DEV OWNER. JBTABT HANDLES ILL MEM REF,PARITY
   572				ETC. BY RELEASING AC RESOURCE..IN CWHICH CASE WE WILL
   573				BE AWAKENED. IF PAGE WAIT SATISFIES, THE SOMEONE WILL AWAKEN
   574				US AS HE RELEASES AC RESOURCE.  CASE 2, ML
   575				WAIT, IS IMPOSSIBLE BECAUSE IF THE SOMEONE WAS IN ML WAIT
   576				IT WOULD BE DUE TO LACK OF SPACE, WHICH CAUSES ACTOWNER
   577				TO GET TRAP AT PI LEVEL FOR INPUT AVAILABLE. SO ACTOWNER
   578				WOULD NOW BE RUNNING AT THAT PI LEVEL (WHICH DOES NOT *EVER*
   579				PUT ANYTHING INTO STREAM--KEY ASSUMPTION) WHEREAS
   580				WE KNOW THAT HE IS NOW RUNNING AT SOME LOWER LEVEL PI
   581				PUTTING SOMETHING INTO STREAM.
   582				 BEWARE--ACTOWNER MUST NEVER PUT ANYTHING INTO STREAM
   583					AT THE INPUT AVAILABLE PI LEVEL..EVEN DUE TO EXECUTING
   584					UUO'S WHICH IN THE FUTURE MAY BE CHANGED TO WRITING
   585					STREAM RECORDS THRU WRTACR.
   586
   587				POINT 3 NONEXISTENT
   588
   589				POINT 4
   590				THERE IS NO ACTOWNER. WHILE SPACE EXISTS, SRETURN WITH SPACE &
   591				RESOURCE. WHEN IT RUNS OUT, FRETURN W/O RESOURCE.
   592				CALLER SHOULD DODGE THIS. SEE STATE X312X.
   593				POINT 5
   594				ACBLIM IS ALWAYS GREATER THAN ANY REQUESTED RECORD SIZE.
   595				POINT 5A
   596				HERE WE IGNORE POSSIBLITY THAT ACTOWNER ISNT ARMED FOR THE
   597				INPUT AVAIL INTERRUPT. IT IS OK TO INGORE & GO AHEAD
   598				PUTTING OURSELVES INTO ML WAIT ANYWAY BECAUSE:
   599				1)IF ACTOWNER IS RUNNING HE WILL SOON ARM THE INT, GET THE
   600				TRAP, DO INPUT, AWAKENING ANY ML WAITER.
   601				2)IF ACTOWNER IS DYING OR DEAD, AN OPERATOR WILL EITHER
   602				FIRE HIM UP AGAIN (WAKING UP ML WAITER) OR DEASSIGN ACT,
   603				WHICH WAKES UP ANY ML WAITER, AS ACTREL IS EXECUTING.
   604
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 4-5
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   605				POINT 6
   606				P1>0 MEANS MORE THAN ENOUGH SPACE. P1=0 MEANS EXACTLY ENOUGH.
   607
   608				POINT 7
   609				THE JUMPGE WILL NOT JUMP IF WRTACR CALLED. ON UUO
   610				CALL, WE ABORT THE UUO IF ANY HIGHER PI IS PENDING THAN
   611				THE ONE ACTIVE WHILE THIS UUO WAS DONE; THIS CATCHES THE
   612				CASE WHERE ACTOWNER WRITES TO THE STREAM VIA PUTSAR ON
   613				PI LEVEL 3 & RUNS OUT OF SPACE; ALSO INCLUDES CASES
   614				WHERE OTHER JOBS WITH PI GET ACTIVATED AT A HIGHER LEVEL
   615				BY AN INTERRUPT FROM SCNSER ETC. WHILE THE UUO IS RUNNING.
   616				MIGHT AS WELL LET HIM HAVE IT RAHTER THAN MAKE HIM WAIT
   617				NOW. HE'LL COME BACK AGAIN WHEN HE RE-EXECUTES HIS UUO.
   618				 ***GETABS MUST NOT BE USED IF UUO MAY NOT BE ABORTED
   619				   AT THIS POINT***
   620				IF NO PI IS PENDING, WE DO THE MLOWQ WAIT. WE ARE GUARANTEED
   621				TO COME OUT SINCE WE ARE NOT ACTOWNER BECAUSE ACTOWNER HAS
   622				HIGHER PI NOW PENDING SINCE THERE IS NOT ENOUGH SPACE
   623				AND ACBLIM > ALL RECORD SIZES.  THIS PREVENTS ACTOWNER FROM GOING
   624				INTO ML WAIT FOR HIMSELF.
   625
   626				POINT 8
   627				WRTACR CALLED MGETABS. BEFORE DOING ML WAIT,
   628				CHECK IF WRTACR IS RUNNING BECAUSE MONITOR IS TRYING
   629				TO WRITE A RECORD FOR THE ACTOWNER DUE TO SOME ACTION
   630				OF HIS BESIDES AN EXPLICIT UUO CALL TO
   631				WRITE THE STREAM.  SINCE WE HAVEN'T GOT ANY SPACE,
   632				AND WE CAN'T ABORT OUT OF THE MIDDLE OF THIS UNKNOWN
   633				SYSTEM CALL WHICH CALLED WRTACR, WE HAVE TO MISS A
   634				RECORD.  MIGHT BE INTERESTING SOMETIME TO PUT A COUNTER
   635				IN TO SEE IF THIS EVER HAPPENS.
   636
   637				POINT 9
   638				WAKEUP FOR THIS IS BY ONE OF:
   639				1)ACTXFR RUNS DURING INPUT UUO FROM ACTDEV
   640				2)ACTREL RUNS
   641					A)ACTOWNER DID RELEASE,EXIT ETC.
   642					B)OPERATOR DID DEASSIGN ACT OR LOGGED JOB OUT.
   643				!
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 5
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   644
   645				COMMENT /@@SUBROUTINE WRTACR
   646				@@PURPOSE
   647				TO GENERATE AN ACCOUNTING RECORD OF A SPECIFIED TYPE AND PUT
   648				IT INTO ACTBUF.
   649				@@ENTRY
   650				(T1)=RECORD TYPE 0-7		;-SPECIAL ACTION ON 7
   651				(T4)=RECORD SIZE FOR VARIABLE LENGTH RECORDS
   652				@@ACCUM
   653				T1
   654				@@TABLES
   655				ACTBUF,JBTNAM,JBTFPN,JBTSOK,ACTDDB,JBTAUN
   656				@@GLOBAL
   657				ACREQ,ACAVAL,JFYSEC,TIME,THSDAT
   658				@@FUNCTION
   659				RETURN IMMEDIATELY IF CALLERS AUN=0 (LOGINN NOT YET RUN, SO
   660				ELIMINATE TYPE 0 REC FOR INITIAL LOGINN RUN FOR JOB).
   661				GET ACT BUFFER SPACE. IF CANT, GIVE UP.
   662				WRITE THE RECORD. (TYPES 0-6 DONE HERE. OTHERS HAVE
   663				THEIR OWN ROUTINES WHICH DISPATCH FROM WRTAC1+2 AND
   664				RETURN BACK AT FINBUF.
   665				@@EXIT
   666				1. RECORD IN BUFFER IF POSSIBLE
   667				2. BUFFER POINTERS ADVANCED
   668				3. AC RESOURCE RELEASED.
   669				4. ALL AC'S PRESERVED
   670				@@CALLS
   671				MGETABS,CBLAMB,MORBUF,PUTBUF,CLKTRU
   672				@@RESTRICTIONS
   673				TO BE CALLED ONLY AT UUO LEVEL DUE TO POSSIBLE WAIT
   674				@@/
   675
   676	001300'	261040	000014	WRTACR::PUSH P,P1	;SAVE P1 FOR CALL TO GETABS
   677	001301'	261040	000007		PUSH P,T2	;SAVE FOR CALLER BOTH T2 & F
   678	001302'	261040	000004		PUSH P,F
   679	001303'	336002	001233*		SKIPN JBTAUN(J)	;IF AUN NOT YET SET,
   680	001304'	254000	001333'		JRST ACFULL	;DONT WRITE RECORD
   681	001305'	200400	000006		MOVE T3,T1	;GET TYPE CODE IN T3 FOR ACYSIZ
   682	001306'	261040	000010		PUSH P,T3	;SAVE IT FOR LATER
   683	001307'	301400	000040		CAIL	T3,40	;IF ITS A USER TYPE,
   684	001310'	271400	777763		ADDI	T3,ACUTAB-40 	;PICK UP DATA FROM PROPER PLACE
   685	001311'	135600	001477'		LDB P1,ACYSIZ	;GET SIZE OF THIS TYPE IN P1 FOR GETABS
   686	001312'	135340	001476'	        LDB     T2,ACYMIN       ;IS THIS A VAR LENGTH REC?
   687				        JUMPN   T2,    [CAML    T4,T2       ;YES: IS SIZE SPEC TOO SMALL?
   688				                        CAMLE   T4,P1   ;NO: IS SIZE > MAX?
   689				                        STOPCD          ;YES: NOT ALLOWED
   690				                        MOVE    P1,T4   ;PUT SIZE IN P1 FOR GETABS
   691	001313'	326340	001631'	                        JRST    .+1]
   692	001314'	260040	001224'		PUSHJ P,MGETABS	;GET THAT MUCH SPACE IN ACT BUFFER
   693					JRST [POP P,T3	;DO NOTHING. LOSE RECORD. CANT GET SPACE
   694	001315'	254000	001636'			JRST ACFULL]	 ;BECAUSE NO ACTOWNER OR WE ARE THE
   695							 ;ACTOWNER & BUFFER FULL & WE CANT
   696							 ;PUT OURSELF INTO WAIT,OR ABORT.
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 5-2
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   697				; SUCCESS RETURN MGETABS
   698	001316'			WRTAC1:
   699	001316'	260040	000000*		PUSHJ P,CBLAMB	;GET LOC & SIZ OF CONTIGUOUS BLOCK IN ACTBUF
   700				 ;-FOR TYP 0-6, EXECUTE SMALL ROUTINE TO WRITE THE  HEADER
   701				;-	WORDS STANDARD WITH ALL STREAM RECORDS. FOR TYPE 7,ETC.
   702				;-	DISPATCH TO SPECIAL CODE.
   703
   704
   705	001317'	262040	000010		POP	P,T3		;GET TYPE CODE BACK INTO T3
   706	001320'	200440	000014		MOVE	T4,P1		;GET SIZE IN T4 FOR ROUTINES
   707	001321'	301400	000040		CAIL	T3,40		;ONE OF THE BIGGIES?
   708	001322'	256010	001333'		  XCT	SPCACT-40(T3)	;YES, USE SPECIAL TABLE.  40+
   709	001323'	256010	001350'		XCT	WRTACT(T3)	;DISPATCH ON TYPE
   710
   711				;-RETURN HERE TO COMPLETE LAST 3 WDS OF TYPE 0-6. T1,T2
   712				;-	ARE AS RETURNED BY LAST PUTBUF CALL.
   713
   714	001324'	200402	000000*		MOVE T3,JBTNAM(J)
   715	001325'	260040	001433'		PUSHJ P,PUTBUF
   716	001326'	200402	001167*		MOVE T3,JBTFPN(J)	
   717	001327'	260040	001433'		PUSHJ P,PUTBUF
   718	001330'	200402	000000*		MOVE T3,JBTSOK(J)
   719	001331'	260040	001433'		PUSHJ P,PUTBUF
   720				; FINBUF..JRST HERE FROM SPECIAL ROUTINES FOR TYPES 7,12,ETC.
   721	001332'	260040	001340'	FINBUF:	PUSHJ P,FINAC1	;UN-INTERLOCK, UPDATE BUFFER POINTERS, NON-SKIP EXIT
   722	001333'	262040	000004	ACFULL:	POP P,F
   723	001334'	262040	000007		POP P,T2
   724	001335'	262040	000014		POP P,P1	;RESTORE P1
   725	001336'	263040	000000		POPJ P,
   726
   727				;-FINACB..FINISH UP USE OF ACTBUF.  FOR USE BY UUO'S
   728				;-	WHICH WRITE ACTBUF WITHOUT USING ACTWRT.
   729				;-	(PUTSAR,XCHARG,,)
   730				;-UPDATE BUFF PTRS, UN-INTERLOCK, SKIP EXIT.
   731				;-ENTRY:  T2=AS RETURNED BY LAST PUTBUF=NEXT LOC TO USE
   732				;	  F =ACTDDB   J=JOB
   733
   734				;-CAN BE USED TO CAUSE A SKIP RTN FROM THE UUO IF
   735				;-	PJRST FINACB IS LAST INSTR IN UUO.
   736
   737				;-FINAC1..USED BY WRTACR AT FINBUF. NO SKIP
   738
   739				;-RELACB..TO RELEASE ACT RESOURCE. ENTRY: J=JOB
   740
   741
   742				INTERNAL FINACB,FINAC1,RELACB
   743	001337'	350001	000000	FINACB:	AOS (P)		;FINACB GIVES SKIP RETURN
   744	001340'	553000	000007	FINAC1:	HRRZS T2	;AAA. ELIM ANY GARB IN LH FOR CAML
   745	001341'	311340	000023'		CAML T2,ACTBUF-1	;TEST WRAPAROUND
   746	001342'	201340	000024'		MOVEI T2,ACTBUF
   747	001343'	506340	000022'		HRLM T2,ACTBUF-2	;RECORD NEXT POS. TO USE
   748				;
   749				;RELACB..FALL THRU FROM ABOVE. ALSO JBTABT(J) SET TO POINT
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 5-3
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   750				;  HERE BY GETABS BEFORE ACT OPERATION BEGUN IN CASE ABORT
   751				;  NECESSARY DUE TO PAGE FAIL,ETC.
   752
   753	001344'	371000	001236*	RELACB:	SOSL ACREQ
   754	001345'	476000	000000*		SETOM ACAVAL
   755	001346'	402002	001242*		SETZM JBTABT(J)	;ABORT ROUTINE CLEAR. ACT OPERATION SUCCEEDED
   756	001347'	263040	000000		POPJ P,
   757
   758
   759				;-DISPATCH TABLE FOR WRTACR, TYPE IN T3. XCT WRTACT(T3)
   760
   761	001350'	260040	001400'	WRTACT:	PUSHJ P,WACRHW	;TYPES 0-6, JUST WRITE
   762	001351'	260040	001400'		PUSHJ P,WACRHW	;USUAL HEADER & CONTINUE
   763	001352'	260040	001400'		PUSHJ P,WACRHW	;INLINE IN WRTACR CODE
   764	001353'	260040	001400'		PUSHJ P,WACRHW
   765	001354'	260040	001400'		PUSHJ P,WACRHW
   766	001355'	260040	001400'		PUSHJ P,WACRHW
   767	001356'	260040	001400'		PUSHJ P,WACRHW
   768	001357'	254000	001501'		JRST W7ACR	;7--SPECIAL
   769	001360'	256000	000000'		STOPCD		;10-XCHARG NOT DONE THIS WAY
   770	001361'	256000	000000'		STOPCD		;11-SYSTEM UP..NEVER WRITTEN
   771	001362'	254000	001513'		JRST W12ACR	;12-DATE CHANGE
   772	001363'	260040	001400'		PUSHJ P,WACRHW	;13-LOCAL STR ACCTG. WRITE USUAL HEADER
   773	001364'	254000	001522'		JRST W14ACR	;14-SETLIC UUO
   774	001365'	254000	001522'		JRST W15ACR	;15-SETE UUO
   775	001366'	254000	001532'		JRST W16ACR	;16-RUN LICENSE
   776	001367'	256000	000000'		STOPCD		;17-TRANSACTION CHG, NOT DONE THIS WAY
   777	001370'	256000	000000'		STOPCD		;20-ROYALTY BEGIN/END, NOT DONE THIS WAY
   778	001371'	256000	000000'		STOPCD		;21-TRU COMPONENT CHECKPNT, NOT DONE THIS WAY
   779	001372'	254000	001543'		JRST	W22ACR	;22-AUX CIR CREATION
   780
   781				;TABLE TO WRITE "SPECIAL" (40 OR MORE) RECORDS
   782				;** Instr must not fall through, no JFCLs PUSHJs etc. **
   783				;**    else must change code at WRTAC1+4 from XCT     **
   784
   785	001373'	254000	001564'	SPCACT:	JRST	W40ACR	;WRITE TYPE 40 (LOGIN FOR FRMOP)
   786	001374'	256000	000000'		STOPCD		;(41) CHKPNT, DON'T DO IT FOR NOW
   787	001375'	256000	000000'		STOPCD		;(42) LOGOUT, DON'T DO IT YET.
   788	001376'	256000	000000'		STOPCD		;(43) CHKPNT UPTIME, DON'T DO IT YET.
   789	001377'	256000	000000'		STOPCD		;(44) TATTLE, NOT TO BE WRITTEN LIKE THIS
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 6
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   790				;- SUBROUTINE WACRHW - WRITE ACT 5 HEADER WORDS: HEADER,DATE,
   791				;-	AUN, & TRU'S (DP QTY). COMMON TO ALL MONITOR-GENERATED STREAM RECORDS.
   792				;-	THE MONITOR DATE-STAMPS ALL STREAM RECORDS. EVEN PUTSAR ONES.
   793
   794				;-ENTRY
   795				;	T2=LOC OF CONTIG. BLOCK IN ACTBUF FOR START RECORD
   796				;	T1=LENGTH OF BLOCK
   797				;	T3=RECORD TYPE
   798				;	T4=REC SIZE
   799				;-RETURNS
   800				;	T3,T4 DESTROYED. T1,T2 UPDATED. 5 WORDS WRITTEN.
   801
   802				;-CALLS PUTBUF,MORBUF
   803				INTERNAL WACRHW
   804	001400'			WACRHW:
   805	001400'	137400	001473'		DPB T3,ACYCOD		;INSERT CODE
   806	001401'	137100	001474'		DPB J,ACYJOB		;AND JOB NUMBER
   807	001402'	542447	000000		HRRM T4,(T2)		;AND RECORD SIZE
   808	001403'	260040	001434'		PUSHJ P,MORBUF		;ADVANCE BUFFER
   809	001404'	260040	001422'		PUSHJ	P,GETDT		;GET T3/ DATE,,TIME
   810	001405'	260040	001433'		PUSHJ P,PUTBUF		;AND PUT IN BUFFER
   811	001406'	200402	001303*		MOVE T3,JBTAUN(J)		;GET AUN
   812	001407'	260040	001433'		PUSHJ P,PUTBUF
   813	001410'	261040	000006		PUSH P,T1
   814	001411'	261040	000007		PUSH P,T2
   815	001412'	260040	000000*		PUSHJ P,CLKTRU		;RTN TRU'S T1=LOW,T2=HI ORDER DP. VALUE
   816	001413'	200400	000007		MOVE T3,T2	;T3:=HI ORDER
   817	001414'	200440	000006		MOVE T4,T1	;T4:=LOW ORDER
   818	001415'	262040	000007		POP P,T2
   819	001416'	262040	000006		POP P,T1
   820	001417'	260040	001433'		PUSHJ P,PUTBUF	;STORE T3 HI ORDER IN BUFF
   821	001420'	202447	000000		MOVEM T4,(T2)	;& LOW ORDER
   822	001421'	324740	001434'		PJRST MORBUF	;& ADVANCE PTR & RETURN
   823
   824
   825				; RETURNS T3/ DATE,,TIME    - CLOBBERS T4
   826
   827	001422'	200440	000000*	GETDT:	MOVE	T4,THSDAT
   828	001423'	200400	000000*		MOVE	T3,TIME
   829	001424'	312440	001422*		CAME	T4,THSDAT
   830	001425'	254000	001422'		 JRST	GETDT
   831	001426'	261040	000011		PUSH	P,T4
   832	001427'	230400	000000*		IDIV	T3,JFYSEC
   833	001430'	262040	000011		POP	P,T4
   834	001431'	504400	000011		HRL	T3,T4
   835	001432'	263040	000000		POPJ	P,
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 7
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   836				INTERNAL PUTBUF,MORBUF	;-CALLED FROM UUOCON XCHARG,PUTSAR
   837				; PUT WORD IN MONITOR BUFFER
   838				; ON ENTRY (T2)=CURRENT ADDRESS IN BUFFER
   839				;          (T1)=NO. OF CONTIGUOUS WORDS LEFT IN BUFFER
   840				;          (T3)=WORD TO STORE
   841				;  RETURNS UPDATED T1 AND T2
   842
   843				COMMENT /@@SUBROUTINE PUTBUF (ENTRY MORBUF)
   844				@@PURPOSE
   845				STORE DATA IN MONITOR BUFFER AND ADVANCE POINTER.  IF ENTERED
   846				AT MORBUF ONLY THE POINTERS ARE ADVANCED.
   847				@@ENTRY
   848				(T1)= NO. OF WORDS LEFT IN THIS CONTIGUOUS BLOCK IN THE  BUFFER
   849				(T2)=CURRENT ADDRESS IN BUFFER TO STORE DATA
   850				(T3)=DATA TO BE STORED  (NOT USED BY MORBUF)
   851				@@TABLES
   852				ACTBUF
   853				@@FUNCTION
   854				STORES DATA AND ADVANCES BUFFER POINTERS.  IF BUFFER
   855				HAS WRAPPED AROUND CBLAMB IS CALLED TO SET UP ANOTHER CONTIGUOUS
   856				BLOCK
   857				@@EXIT
   858				(T1)=NO. OF CONTIGUOUS WORDS REMAINING IN CURRENT BLOCK IN BUFFER
   859				(T2)=NEXT ADDRESS IN BUFFER
   860				@@CALLS
   861				CBLAMB
   862				@@/
   863	001433'	202407	000000	PUTBUF:	MOVEM T3,(T2)		;STORE DATA
   864	001434'	271340	000001	MORBUF:	ADDI T2,1		;ADVANCE BUFFER ADDRESS
   865	001435'	367300	001104*		SOJG T1,CPOPJ		;IF ROOM STILL LEFT IN BLOCK
   866	001436'	405340	777777		ANDI T2,777777		;AAA. MAKE SURE LH = 0 FOR CAMN
   867	001437'	316340	000023'		CAMN T2,ACTBUF-1	;WRAPPED AROUND?
   868	001440'	201340	000024'		MOVEI T2,ACTBUF		;YES
   869				;THE FOLLOWING INSTR. UPDATES CORE COPY OF IN PTR
   870				;ONLY AT WRAP-AROUND TIME. THIS IS FOR BENEFIT OF
   871				;CBLAMB. ASIDE FROM WRAPAROUND-TIME, THE T2/IN PTR IS
   872				;NOT RESTORED TO CORE UNTIL RECORD IS COMPLETE.
   873	001441'	506340	000022'		HRLM T2,ACTBUF-2	;SET NEW IN POINTER
   874	001442'	324740	001316*		PJRST CBLAMB		;GET NEXT BLOCK
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 8
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   875				;-DEFINITIONS OF STREAM RECORD TYPES,SIZES. BYTE PTRS, ETC.
   876				EXTERNAL XCHARL,TRNARL,TRNTAR,ROYARL,ROYTAR,TCCTAR,TCCARL
   877				INTERNAL ACRTAB,ACUTAB,ACURTL,ACYSIZ,ACYTYP,ACYMIN
   878
   879				;-MACRO TO DEFINE A RECORD. MAKE ENTRY OF FORMAT:
   880				;  BITS   0-17	LICENSES REQ'D TO WRITE THIS RECORD TYPE
   881				;        18-23	RECORD TYPE OR NUMBER
   882				;        24-29  MIN SIZE IF VAR LEN REC ELSE ZERO
   883				;      	 30-35	SIZE OF THIS REC INCLUDING HEADER WORD; MAX SIZE IF VAR LEN REC
   884
   885				DEFINE ATB(LICENS,NUMB,SIZ,MINSIZ)<
   886				    XWD LICENS,<<NUMB>B23+<MINSIZ>B29+<SIZ>> >
   887
   888
   889			000005	STDHED==5       ;SIZE OF STANDARD HEADER
   890
   891				;-RECORD LENGTHS:
   892			000007	LGIRL==7	;LOGINN. MUST AGREE WITH LOGINN 'GTAB' TABLE ETC.
   893			000041	LGORL==41	;LOGOUT. DITTO MUST AGREE WITH "STMLEN"
   894			000041	CKPRL==41	;CHECKPOINT. DITTO MUST AGREE WITH "CKPLNG"
   895			000003	UPTRL==3	;UPTIME
   896			000002	SYURL==2	;SYSTEM UP RECORD. ONCE ONLY WHEN SYS COMES UP
   897			000006	DATRL==6	;DATE CHG RECORD
   898			000005	TATMIN==STDHED  ;TATTLETALE RECORD MIN SIZE
   899			000025	TATMAX==STDHED+20       ;TATTLETALE RECORD MAX SIZE
   900			000006	AUXMIN==STDHED+1        ;CREAUX RECORD MIN SIZE
   901			010234	AUXMAX==<STDHED+1>+<AUXSTM+6>/5  ;CREAUX RECORD MAX SIZE
   902
   903
   904				;-ACT RECORD TABLE.  TYPES 0-7 WRITTEN BY MONITOR ONLY. NO LIC
   905				; (TYPE 11 NEVER WRITTEN EVEN BY MONITOR.)
   906
   907	001443'	000000	000010	ACRTAB:	ATB 0,0,10,0
   908	001444'	000000	010010		ATB 0,1,10,0
   909	001445'	000000	020010		ATB 0,2,10,0
   910	001446'	000000	030010		ATB 0,3,10,0
   911	001447'	000000	040010		ATB 0,4,10,0
   912	001450'	000000	050010		ATB 0,5,10,0
   913	001451'	000000	060010		ATB 0,6,10,0
   914	001452'	000000	070011		ATB 0,7,11,0
   915	001453'	000200	100000*		ATB LICXC,10,XCHARL,0	;XCHARG
   916	001454'	000000	110002		ATB 0,11,2,0	;NEVER WRITTEN. IN BUFFER AT INIT'ZN
   917	001455'	101000	120006		ATB LICOPR!LICJAL,12,DATRL,0
   918	001456'	000000	130010		ATB 0,13,10,0	;LOCAL STR ACCTG TYPE 13 REC
   919	001457'	000000	140010		ATB 0,14,10,0	;SETLIC UUO TYPE 14
   920	001460'	000000	150010		ATB 0,15,10,0	;SETE UUO TYPE 15
   921	001461'	000000	160003		ATB 0,16,3,0	;RUN LICENSE TYPE 16
   922	001462'	000200	000000*		ATB LICXC,TRNTAR,TRNARL,0	;TRANSACTION CG
   923	001463'	000000	000000*		ATB 0,ROYTAR,ROYARL,0		;ROYALTY BEGIN/END RECORD
   924	001464'	000200	000000*		ATB LICXC,TCCTAR,TCCARL,0	;TRU COMPONENT CHECKPOINT
   925	001465'	000000	000000*		ATB 0,22,AUXMAX,AUXMIN		;CREAUX
   926				;USER TYPES
   927			000023	ACUTAB==.-ACRTAB	;-USED BY PUTSAR
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 8-2
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   928	001466'	001000	400007		ATB LICJAL,40,LGIRL,0	;LOGIN TYPE 40
   929	001467'	001000	410041		ATB LICJAL,41,CKPRL,0	;CHKPNT TYPE 41
   930	001470'	001000	420041		ATB LICJAL,42,LGORL,0	;LOGOUT 42
   931	001471'	001000	430003		ATB LICJAL,43,UPTRL,0	;UPTIME REC (CHKPNT)
   932	001472'	001000	440525		ATB LICJAL,44,TATMAX,TATMIN	;TATTLETALE REC
   933			000005	ACURTL==.-ACUTAB-ACRTAB	;INDEX FOR SEARCH BY PUTSAR UUO
   934			000030	ACRTL==.-ACRTAB	;INDEX FOR ACTUGF
   935
   936				;-BYTE PTRS
   937	001473'	331107	000000	ACYCOD: POINT 9,(T2),8	;TO DPB REC TYPE
   938	001474'	221107	000000	ACYJOB: POINT 9,(T2),17		;TO DPB JOB, INTO HEADER WORD
   939	001475'	140610	001443'	ACYTYP: POINT 6,ACRTAB(T3),23	;TO MATCH TYPE
   940	001476'	060610	001443'	ACYMIN: POINT 6,ACRTAB(T3),29   ;TO GET MIN REC SIZE FOR VAR LEN RECS
   941	001477'	000610	001443'	ACYSIZ: POINT 6,ACRTAB(T3),35	;TO GET REC SIZE
   942
   943				;-MISC
   944	001500'	000000	000000	ACJOB:	EXP 0	;SET TO JOB NO. BY GETABS WHEN JOB OWNS RESOURCE
   945						;& IS IN MLOWQ WAITING FOR CHKPNT TO EMPTY
   946						;BUFF TO MAKE ROOM FOR RECORD. RESET BY WAKACJ.
   947			000536	ACBLIM==^D350	;LIMIT BELOW WHICH WE TRAP ACT JOB TO EMPTY BUFF
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 9
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

   948				EXTERNAL UPTPJC,UPTPJ1,UPTPJ2,JBTCNK,%UPT	;-
   949
   950				;-W7ACR..SPECIAL FOR TYPE 7 (PJC) RECORD
   951
   952				;-ENTRY FROM XCT WRTACT(T3) IN WRTACR
   953				;-RETURN TO WRTACR AT FINBUF
   954
   955	001501'	260040	001400'	W7ACR:	PUSHJ P,WACRHW	;REGS T1-4 SET ALREADY, WRITE HEADER
   956	001502'	200400	000000*		MOVE T3,%UPT+UPTPJC	;FILL OUT WITH
   957	001503'	260040	001433'		PUSHJ P,PUTBUF		;3 WDS OF PROJECT CODE
   958	001504'	200400	000000*		MOVE T3,%UPT+UPTPJ1
   959	001505'	260040	001433'		PUSHJ P,PUTBUF
   960	001506'	200400	000000*		MOVE T3,%UPT+UPTPJ2
   961	001507'	260040	001433'		PUSHJ P,PUTBUF
   962	001510'	200402	000000*		MOVE T3,JBTCNK(J)	;CONNECT SECONDS
   963	001511'	260040	001433'		PUSHJ P,PUTBUF
   964	001512'	254000	001332'		JRST FINBUF	;RETURN T1,T2 TO MIDST OF WRTACR CODE
   965							;TO WRAP UP.
   966
   967				; W12ACR..SPECIAL FOR TYPE 12,DATE CHANGE, RECORD
   968
   969	001513'	260040	001400'	W12ACR:	PUSHJ P,WACRHW	;USUAL HEADER
   970	001514'	504400	001520'		HRL T3,NEWDAT
   971	001515'	540400	001521'		HRR T3,NEWTIM
   972	001516'	260040	001433'		PUSHJ P,PUTBUF
   973	001517'	254000	001332'		JRST FINBUF
   974
   975				;(FOR NOW..LATERS THESE MUST BE EXTERNAL FROM COMCON)
   976	001520'	000000	025252	NEWDAT: EXP 25252
   977	001521'	000000	027272	NEWTIM: EXP 27272
   978
   979	001522'			W14ACR:	;SETLIC UUO. SAME RECORD, DIFFERENT TYPE NO. AS SETE
   980	001522'			W15ACR:	;SETE UUO.
   981	001522'	260040	001400'		PUSHJ P,WACRHW	;WRITE STANDARD HEADER WORDS
   982	001523'	200402	001324*		MOVE T3,JBTNAM(J)
   983	001524'	260040	001433'		PUSHJ P,PUTBUF
   984	001525'	200402	001326*		MOVE T3,JBTFPN(J)
   985	001526'	260040	001433'		PUSHJ P,PUTBUF
   986	001527'	200402	001201*		MOVE T3,JBTLIC(J)
   987	001530'	260040	001433'		PUSHJ P,PUTBUF	;PUT THE NEWLY-SET LICENSE INTO STREAM
   988	001531'	254000	001332'		JRST FINBUF
   989
   990	001532'			W16ACR:	;RUN LICENSE. FOLLOWS IMMEDIATELY AFTER RUN TYPE 0 IN STREAM
   991					;THIS TINY RECORD IS AN ADDENDUM FOR RUN/RUNSEGS WHICH
   992					;SET LICENSE FROM FILE OR FROM JOB LICENSE. JUST 3 WORDS:
   993					;HEADER/ TYPE=16,JOB,LENGTH=3
   994					;DATA 1/ DATE,,TIME
   995					;DATA 2/ JBTLIC
   996	001532'	137400	001473'		DPB T3,ACYCOD
   997	001533'	137100	001474'		DPB J,ACYJOB
   998	001534'	542447	000000		HRRM T4,(T2)
   999	001535'	260040	001434'		PUSHJ P,MORBUF
  1000	001536'	260040	001422'		PUSHJ P,GETDT		;GET T3/ DATE,,TIME
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 9-2
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

  1001	001537'	260040	001433'		PUSHJ P,PUTBUF
  1002	001540'	200402	001527*		MOVE T3,JBTLIC(J)
  1003	001541'	260040	001433'		PUSHJ P,PUTBUF
  1004	001542'	254000	001332'		JRST FINBUF
  1005				;WRITE CREAUX RECORD
  1006				;
  1007				EXTERN  AUXERR,AUXRCP,LDPLNO,AUXEND,AUXSTR,AUXSTM
  1008	001543'	260040	001400'	W22ACR:	PUSHJ	P,WACRHW	;WRITE STANDARD HEADER
  1009	001544'	200400	000000*		MOVE	T3,AUXERR	;GET ERROR CODE, IF ANY,
  1010	001545'	603400	777777		TLNE	T3,-1		; IN LEFT HALF OF T3
  1011	001546'	665400	400000		TLOA	T3,(1B0)	; SET BIT 0 IF
  1012	001547'	517000	000010		HRLZS	T3		; MONITOR DETECTED ERROR
  1013	001550'	331440	000000*		SKIPL	T4,AUXRCP	;GET PORT NUMBER INTO
  1014	001551'	135440	000000*		LDB	T4,LDPLNO	; RIGHT HALF
  1015	001552'	540400	000011		HRR	T3,T4		; OF T3
  1016	001553'	260040	001433'		PUSHJ	P,PUTBUF
  1017	001554'	210440	001204*	        MOVN    T4,AUXEND       ;SET UP AOBJN WORD
  1018	001555'	271440	777777*	        ADDI    T4,AUXSTR-1     ; TO FETCH LOGIN
  1019	001556'	507000	000011	        HRLS    T4              ; STRING
  1020	001557'	541440	000000*	        HRRI    T4,AUXSTR
  1021	001560'	200411	000000	W22ACA: MOVE    T3,(T4)         ;GET A WORD FFROM LOGIN STRING
  1022	001561'	260040	001433'	        PUSHJ   P,PUTBUF        ;PUT IN ACT BUF
  1023	001562'	253440	001560'	        AOBJN   T4,W22ACA       ;REPEAT IF MORE
  1024	001563'	254000	001332'		JRST	FINBUF		;FINISH
  1025
  1026				;HERE TO WRITE LOGIN RECORD FOR FRMOP CREATE FRAME FUNCTION.
  1027
  1028				EXTERN	UPTLOG
  1029
  1030	001564'	137400	001473'	W40ACR:	DPB	T3,ACYCOD	;PUT IN CODE
  1031	001565'	137100	001474'		DPB	J,ACYJOB	;JOB NUMBER
  1032	001566'	542447	000000		HRRM	T4,(T2)		;RECORD SIZE
  1033	001567'	260040	001434'		PUSHJ	P,MORBUF	;(0)CODE AND JOB,,SIZE
  1034	001570'	260040	001422'		PUSHJ	P,GETDT		;GET T3/ DATE,,TIME
  1035	001571'	260040	001433'		PUSHJ	P,PUTBUF	;(1)PUT IN
  1036	001572'	200402	001406*		MOVE	T3,JBTAUN(J)	;GET AUN OF NEWLY CREATED FRAME
  1037	001573'	260040	001433'		PUSHJ	P,PUTBUF	;(2)AUN
  1038	001574'	200400	000000*		MOVE	T3,%UPT+UPTPJC	;USE CALLER'S PROJECT CODE
  1039	001575'	260040	001433'		PUSHJ	P,PUTBUF	;(3)PROJECT CODE 0
  1040	001576'	200400	000000*		MOVE	T3,%UPT+UPTPJ1
  1041	001577'	260040	001433'		PUSHJ	P,PUTBUF	;(4)PROJECT CODE 1
  1042	001600'	200400	000000*		MOVE	T3,%UPT+UPTPJ2
  1043	001601'	260040	001433'		PUSHJ	P,PUTBUF	;(5)PROJECT CODE 2
  1044	001602'	200400	000000*		MOVE	T3,%UPT+UPTLOG	; Use originating job's sup info
  1045	001603'	260040	001433'		PUSHJ	P,PUTBUF	;(6)SUPERVISOR INFO (32 BITS)
  1046	001604'	254000	001332'		JRST	FINBUF		;AND FINISH.
  1047
  1048	001605'	001104	000002		$END	(ACT)

  1049	001606'	000040	010000

  1050	001607'	034160	703416

ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 9-3
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

  1051	001610'	064245	225124

  1052	001611'	202030	341636

  1053	001612'	526352	444634

  1054	001613'	435010	442654

  1055	001614'	446070	520244

  1056	001615'	426310	540646

  1057	001616'	426104	025124

  1058	001617'	250321	200000

  1059	001620'	200353	000000

  1060	001621'	202313	000000

  1061	001622'	400000	000003'

  1062	001623'	325600	001273'

  1063	001624'	254000	001274'

  1064	001625'	331002	000000*

  1065	001626'	254000	001266'

  1066	001627'	260040	001344'

  1067	001630'	254000	000000*

  1068	001631'	311440	000007

  1069	001632'	313440	000014

  1070	001633'	256000	000000'

  1071	001634'	200600	000011

  1072	001635'	254000	001314'

  1073	001636'	262040	000010

  1074	001637'	254000	001333'

  1075						;End of ACTSER (ACTLIT: ACTEND:)
  1076
NO ERRORS DETECTED
PROGRAM BREAK IS 001640
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 9-4
ACTSER.MAC	17-SEP-87 16:39		S.MAC - with system parameter file for P035/D, January 1988

7K CORE USED
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88 PAGE 10
ACTSER.MAC	17-SEP-87 16:39		SYMBOL TABLE

ABTUUO		001630'	EXT	AUXSTR		001557'	EXT	I		000010	SIN	S		000000	INT
ACAVAL		001345'	EXT	BUFCHK		001077'		IB		000013	SIN	S$ENTR	777777	777775	SIN
ACBLIM		000536	SPD	CBLAMB		001442'	EXT	INTACT		001066'		S$HALT	777777	777777	SIN
ACFULL		001333'		CBLEMB		001042'	EXT	INTTAB		001071'		S$NAME		000000'	SPD
ACJOB		001500'		CKPRL		000041	SPD	IOACT		010000	SIN	S$NONA		000000	SIN
ACREQ		001344'	EXT	CLKTRU		001412'	EXT	IOEND		000040	SIN	S$TEMP		000000	SPD
ACRTAB		001443'	INT	CPOPJ		001435'	EXT	IOW		000001	SIN	S$XCT	777777	777776	SIN
ACRTL		000030	SPD	CPOPJ1		001073'	EXT	J		000002	INT	SETIOD		001255'	EXT
ACSWT		001240'	EXT	CTMBS		001243'	EXT	JBTABT		001346'	EXT	SETRUN		001114'	EXT
ACTBL		001000		DATRL		000006	SPD	JBTAUN		001572'	EXT	SPCACT		001373'	
ACTBUF		000024'		DBLMSG		001054'	EXT	JBTAWQ		001625'	EXT	STDHED		000005	SPD
ACTDDB		000003'	INT	DBYT		000002	SIN	JBTCNK		001510'	EXT	SYURL		000002	SPD
ACTDDS		000017	SIN	DCL		000007	SIN	JBTFPN		001525'	EXT	T1		000006	INT
ACTDED		400000	SIN	DDINT		000001	SIN	JBTLIC		001540'	EXT	T2		000007	INT
ACTDSP		001024'		DDXZ		000000	SIN	JBTNAM		001523'	EXT	T3		000010	INT
ACTEND		001637'	INT	DEVBUF		000006	SIN	JBTPPN		001170'	EXT	T4		000011	INT
ACTEOF		001063'		DEVCHR		000001	SIN	JBTSOK		001330'	EXT	TAKTRJ		001257'	EXT
ACTIN		001042'		DEVCLS		000011	SIN	JBTSTS		000000	EXT	TAKTRP		000000	EXT
ACTLIT		001605'	INT	DEVCTR		000015	SIN	JFYSEC		001427'	EXT	TATMAX		000025	SPD
ACTREL		001052'		DEVIAD		000007	SIN	JOB		001264'	EXT	TATMIN		000005	SPD
ACTSER		000000'	ENT	DEVINT		000016	SIN	JPOPJ		001117'		TCCARL		000000	EXT
ACTT0		001151'		DEVIOS		000002	SIN	JPOPJ1		001116'		TCCTAR		000000	EXT
ACTT01		001161'		DEVLOG		000005	SIN	LDPLNO		001551'	EXT	THSDAT		001424'	EXT
ACTT02		001156'		DEVMOD		000004	SIN	LGIRL		000007	SPD	TIME		001423'	EXT
ACTT1		001155'		DEVNAM		000000	SIN	LGORL		000041	SPD	TRNARL		000000	EXT
ACTT13		001175'		DEVOAD		000010	SIN	LICJAL		001000	SIN	TRNTAR		000000	EXT
ACTT16		001201'		DEVPWC		000013	SIN	LICOPR		100000	SIN	TSTARM		000000	EXT
ACTT2		001164'		DEVSER		000003	SIN	LICXC		000200	SIN	UPTLOG		000000	EXT
ACTT22		001204'		DEVSTS		000012	SIN	LSAREC		001175'	EXT	UPTPJ1		000000	EXT
ACTT3		001167'		DEVWUC		000014	SIN	M		000013	INT	UPTPJ2		000000	EXT
ACTTAB		001126'		DGF		000015	SIN	MBBXFR		001103'	EXT	UPTPJC		000000	EXT
ACTUG0		001217'		DGTRD		000013	SIN	MGETAB		001224'		UPTRL		000003	SPD
ACTUG1		001222'		DHNG		000005	SIN	MLLOOP		001243'		UPTSTS		000000	EXT
ACTUGA		001211'		DIE		000000'	EXT	MLOWQ		001267'	EXT	W12ACR		001513'	
ACTUGF		001207'		DIN		000011	SIN	MORBUF		001434'	INT	W14ACR		001522'	
ACTWRT		001121'	INT	DINI		000004	SIN	NACDTS		000023	SPD	W15ACR		001522'	
ACTXFR		001103'		DMT		000014	SIN	NEWDAT		001520'		W16ACR		001532'	
ACURTL		000005	SIN	DOU		000010	SIN	NEWTIM		001521'		W22ACA		001560'	
ACUTAB		000023	SIN	DRL		000006	SIN	NINTRP		001256'	EXT	W22ACR		001543'	
ACWAIT		001237'	EXT	DSPSIZ		000015	SPD	NODIE		000000	EXT	W40ACR		001564'	
ACYCOD		001473'		DVIN		000002	SIN	P		000001	INT	W7ACR		001501'	
ACYJOB		001474'		DVSIZ		000003	SIN	P1		000014	INT	WACRHW		001400'	INT
ACYMIN		001476'	INT	DXFR		000012	SIN	PJBSTS		001270'	EXT	WAKACJ		001105'	
ACYSIZ		001477'	INT	ERRICO		001034'	EXT	PJOBN		001263'	EXT	WRTAC1		001316'	
ACYTYP		001475'	INT	F		000004	INT	PJRST	324740	000000		WRTACR		001300'	INT
ALR620		001056'	EXT	FINAC1		001340'	INT	PUTBUF		001433'	INT	WRTACT		001350'	
ALRACT		000040	SIN	FINACB		001337'	INT	PX.MEM		000004	SPD	WSCHED		001271'	EXT
AUXEND		001554'	EXT	FINBUF		001332'		PXCT	256000	000000		XCHARL		000000	EXT
AUXERR		001544'	EXT	GETAB2		001260'		RAFRET		001274'		XXFRET		001275'	
AUXMAX		010234	SPD	GETAB3		001266'		REC.WR		001172'	EXT	XXSRET		001273'	
AUXMIN		000006	SPD	GETABS		001225'	INT	RELACB		001344'	INT	ZZ	005557	664555	SPD
AUXRCP		001550'	EXT	GETDT		001422'		RNQ		001112'	EXT	%UPT		000000	EXT
AUXSTM		000000	EXT	I		000010	SIN	ROYARL		000000	EXT	

ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88
ACTSER.MAC	17-SEP-87 16:39		Symbol cross reference

ABTUUO	    41%	   469
ACAVAL	    38%	   754
ACBLIM	   454	   947#
ACFULL	   680	   694	   722#
ACJOB	   222	   224	   475	   944#
ACREQ	    38%	   441	   753
ACRTAB	   877	   907#	   927	   933	   934	   939	   940	   941
ACRTL	   380	   934#
ACSWT	    42%	   443
ACTBL	    66#	    70	    73
ACTBUF	    56	    69	    70	    71#	   204	   205	   745	   746	   747	   867	   868	   873
ACTDDB	    46#	    64	   278	   430	   431	   457
ACTDDS	    64#	    81	   278
ACTDED	    58#	   434
ACTDSP	    50	    77#
ACTEND	  1075#
ACTEOF	    90	   169#
ACTIN	    87	   118#
ACTLIT	  1048#
ACTREL	    84	   139#
ACTSER	    11	    12#	    15
ACTT0	   289	   310#
ACTT01	   314	   320#	   335
ACTT02	   317#	   323	   327	   344
ACTT1	   290	   292	   315#
ACTT13	   300	   338#
ACTT16	   303	   346#
ACTT2	   291	   325#
ACTT22	   307	   351#
ACTT3	   293	   294	   295	   330#
ACTTAB	   283	   289#	   308
ACTUG0	   383	   388#
ACTUG1	   386	   391#
ACTUGA	   381#	   384
ACTUGF	    91	   379#
ACTWRT	   278	   279#
ACTXFR	    88	   215#
ACURTL	   877	   933#
ACUTAB	   684	   877	   927#	   933
ACWAIT	    38%	   442
ACYCOD	   805	   937#	   996	  1030
ACYJOB	   806	   938#	   997	  1031
ACYMIN	   389	   686	   877	   940#
ACYSIZ	   388	   685	   877	   941#
ACYTYP	   381	   877	   939#
ALR620	    37%	   146
ALRACT	   145
AUXEND	   352	  1007%	  1017
AUXERR	  1007%	  1009
AUXMAX	   901#	   925
AUXMIN	   353	   900#	   925
AUXRCP	  1007%	  1013
AUXSTM	   901	  1007%
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88
ACTSER.MAC	17-SEP-87 16:39		Symbol cross reference

AUXSTR	   353	  1007%	  1018	  1020
BUFCHK	   197	   204#
CBLAMB	    37%	   699	   874
CBLEMB	    39%	   118
CKPRL	   894#	   929
CLKTRU	    37%	    39%	   815
CPOPJ	    39%	   119	   216	   865
CPOPJ1	    41%	   195	   199
CTMBS	    37%	   447
DATRL	   897#	   917
DBLMSG	    37%	   144
DBYT	    80#
DCL	    85#
DDINT	    79#
DDXZ	    78#
DEVBUF	    53#
DEVCHR	    48#
DEVCLS	    56#
DEVCTR	    61#
DEVIAD	    54#
DEVINT	    62#
DEVIOS	    49#	   121	   124	   170	   457
DEVLOG	    52#
DEVMOD	    51#
DEVNAM	    47#
DEVOAD	    55#
DEVPWC	    59#
DEVSER	    50#
DEVSTS	    57#	   438
DEVWUC	    60#
DGF	    91#
DGTRD	    89#
DHNG	    83#
DIE	    11	    11%	    12
DIN	    87#
DINI	    82#
DMT	    90#
DOU	    86#
DRL	    84#
DSPSIZ	    78	    92#
DVIN	    51
DVSIZ	    81#
DXFR	    88#
ERRICO	    39%	    86
F	   121	   124	   139	   150	   170	   430	   431	   438	   466	   678	   722
FINAC1	   721	   742	   744#
FINACB	   742	   743#
FINBUF	   721#	   964	   973	   988	  1004	  1024	  1046
GETAB2	   455	   462#
GETAB3	   467	   474#
GETABS	   431#
GETDT	   809	   827#	   830	  1000	  1034
GINST	   379#	   379	   380	   391#	   391	   392
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88
ACTSER.MAC	17-SEP-87 16:39		Symbol cross reference

I	    51
IB	    51
INTACT	    79	   193#
INTTAB	   193	   197#
IOACT	   120	   123	   456
IOEND	   123
IOW	   458
J	   221	   222	   231	   311	   312	   313	   331	   332	   347	   432	   435	   445	   463	   466
	   475	   484	   679	   714	   716	   718	   755	   806	   811	   962	   982	   984	   986	   997
	  1002	  1031	  1036
JBTABT	    42%	   445	   755
JBTAUN	    40%	   435	   437	   679	   811	  1036
JBTAWQ	    35%	   466
JBTCNK	   948%	   962
JBTFPN	    40%	   313	   331	   716	   984
JBTLIC	    35%	   312	   347	   986	  1002
JBTNAM	    40%	   714	   982
JBTPPN	    40%	   311	   332
JBTSOK	    40%	   718
JBTSTS	    40%
JFYSEC	    37%	   832
JOB	    35%	   463	   471
JPOPJ	   231#
JPOPJ1	   223	   230#
LDPLNO	  1007%	  1014
LGIRL	   892#	   928
LGORL	   893#	   930
LICJAL	   917	   928	   929	   930	   931	   932
LICOPR	   917
LICXC	   915	   922	   924
LISTSN	     3	     6
LSAREC	    43%	   316	   322	   339	   341
M	   379	   391
MBBXFR	    39%	   215
MGETAB	   430#	   692
MLLOOP	   447#	   479
MLOWQ	    42%	   476
MORBUF	   808	   822	   836	   864#	   999	  1033
NACDTS	   280	   308#
NEWDAT	   970	   976#
NEWTIM	   971	   977#
NINTRP	    41%	   460
NODIE	    11%
P	    12	    82	    83	    85	    89	   118	   125	   139	   144	   147	   150	   151	   171	   194
	   197	   198	   200	   201	   202	   206	   207	   215	   221	   225	   228	   229	   230	   231
	   232	   317	   319	   328	   333	   336	   340	   349	   392	   432	   433	   442	   447	   450
	   459	   461	   468	   478	   481	   482	   483	   484	   485	   676	   677	   678	   682	   692
	   693	   699	   705	   715	   717	   719	   721	   722	   723	   724	   725	   743	   756	   761
	   762	   763	   764	   765	   766	   767	   772	   808	   809	   810	   812	   813	   814	   815
	   818	   819	   820	   831	   833	   835	   955	   957	   959	   961	   963	   969	   972	   981
	   983	   985	   987	   999	  1000	  1001	  1003	  1008	  1016	  1022	  1033	  1034	  1035	  1037
	  1039	  1041	  1043	  1045
P1	   433	   449	   450	   451	   454	   464	   483	   676	   685	   688	   690	   706	   724
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88
ACTSER.MAC	17-SEP-87 16:39		Symbol cross reference

PJBSTS	    42%	   227	   477
PJOBN	    38%	   436	   448	   470
PUTBUF	   715	   717	   719	   810	   812	   820	   836	   863#	   957	   959	   961	   963	   972	   983
	   985	   987	  1001	  1003	  1016	  1022	  1035	  1037	  1039	  1041	  1043	  1045
PX.MEM	   379	   391
RAFRET	   452	   472	   482#
REC.WR	    43%	   316	   321	   326	   334	   341
RELACB	   444	   468	   482	   742	   753#
RNQ	    42%	   226
ROYARL	   876%	   923
ROYTAR	   876%	   923
S	   120	   123	   124
S$ENTR	    11	    17	   281	   297	   298	   304	   305	   306	   689	   769	   770	   776	   777	   778
	   786	   787	   788	   789
S$HALT	    11	   281	   297	   298	   304	   305	   306	   689	   769	   770	   776	   777	   778	   786
	   787	   788	   789
S$NAME	    15#	   281	   297	   298	   304	   305	   306	   689	   769	   770	   776	   777	   778	   786
	   787	   788	   789
S$NONA	    14	    17	   281	   297	   298	   304	   305	   306	   689	   769	   770	   776	   777	   778
	   786	   787	   788	   789
S$TEMP	    11#	    11	   281#	   281	   297#	   297	   298#	   298	   304#	   304	   305#	   305	   306#	   306
	   689#	   689	   769#	   769	   770#	   770	   776#	   776	   777#	   777	   778#	   778	   786#	   786
	   787#	   787	   788#	   788	   789#	   789
S$XCT	    17	   281	   297	   298	   304	   305	   306	   689	   769	   770	   776	   777	   778	   786
	   787	   788	   789
SETIOD	    39%	   459
SETRUN	    42%	   228
SPCACT	   708	   785#
STDHED	   889#	   898	   899	   900	   901
SYURL	   896#
T1	    81	   119	   121	   122	   140	   145	   146	   169	   170	   225	   226	   227	   229	   279
	   280	   283	   381	   382	   385	   388	   390	   391	   434	   438	   444	   445	   449	   456
	   457	   458	   460	   476	   477	   681	   813	   817	   819	   865
T2	   193	   204	   205	   282	   316	   318	   321	   322	   326	   334	   339	   341	   379	   382
	   389	   390	   435	   437	   439	   677	   686	   687	   723	   744	   745	   746	   747	   807
	   814	   816	   818	   821	   863	   864	   866	   867	   868	   873	   937	   938	   998	  1032
T3	   311	   313	   331	   332	   380	   384	   681	   682	   683	   684	   693	   705	   707	   708
	   709	   714	   716	   718	   805	   811	   816	   828	   832	   834	   863	   939	   940	   941
	   956	   958	   960	   962	   970	   971	   982	   984	   986	   996	  1002	  1009	  1010	  1011
	  1012	  1015	  1021	  1030	  1036	  1038	  1040	  1042	  1044
T4	   352	   353	   436	   437	   448	   451	   470	   471	   687	   688	   690	   706	   807	   817
	   821	   827	   829	   831	   833	   834	   998	  1013	  1014	  1015	  1017	  1018	  1019	  1020
	  1021	  1023	  1032
TAKTRJ	    40%	   461
TAKTRP	    41%
TATMAX	   899#	   932
TATMIN	   898#	   932
TCCARL	   876%	   924
TCCTAR	   876%	   924
THSDAT	    39%	   827	   829
TIME	    37%	   828
TRNARL	   876%	   922
TRNTAR	   876%	   922
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88
ACTSER.MAC	17-SEP-87 16:39		Symbol cross reference

TSTARM	    41%
UPTLOG	  1028%	  1044
UPTPJ1	   948%	   958	  1040
UPTPJ2	   948%	   960	  1042
UPTPJC	   948%	   956	  1038
UPTRL	   895#	   931
UPTSTS	    43%	   282	   318
W12ACR	   771	   969#
W14ACR	   773	   979#
W15ACR	   774	   980#
W16ACR	   775	   990#
W22ACA	  1021#	  1023
W22ACR	   779	  1008#
W40ACR	   785	  1030#
W7ACR	   768	   955#
WACRHW	   761	   762	   763	   764	   765	   766	   767	   772	   803	   804#	   955	   969	   981	  1008
WAKACJ	   147	   221#
WRTAC1	   698#
WRTACR	   296	   299	   301	   302	   317	   348	   354	   676#
WRTACT	   709	   761#
WSCHED	    42%	   478
XCHARL	   876%	   915
XXFRET	   439	   483#
XXSRET	   451	   464	   481#
ZZ	   379#	   379	   391#	   391
ZZ1	   379#	   379	   391#	   391
%UPT	   282	   318	   948%	   956	   958	   960	  1038	  1040	  1042	  1044
ACTSER - STREAM ACCOUNTING SERVICE ROUTINES	MACRO 12.5-46.0 14:34 13-JAN-88
ACTSER.MAC	17-SEP-87 16:39		Macro/Opdef cross reference

ATB	   885#	   907	   908	   909	   910	   911	   912	   913	   914	   915	   916	   917	   918	   919
	   920	   921	   922	   923	   924	   925	   928	   929	   930	   931	   932
PJRST	   348	   354	   822	   874
PXCT	   379	   391
PXGEN	   379	   391
STOPCD	    10	   281	   297	   298	   304	   305	   306	   689	   769	   770	   776	   777	   778	   786
	   787	   788	   789
UMOVE	   379
UMOVEM	   391
XCTFU	   379
XCTTU	   391
XP	    58
$END	  1048  e4
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 1
S.MAC	13-JAN-88 11:55		S.MAC - with system parameter file for P035/D, January 1988

     1				SUBTTL	S.MAC - with system parameter file for P035/D, January 1988
     2
     3				IF2,<IFNDEF LISTSN,<TAPE>>	;Skip to PASS2 in all but COMMON.LST
     4				;THIS MODULE ASSEMBLED WITH KL-10 PARAMETER FILE - KLSYM.MAC
     5
     6					IF2,<IFNDEF LISTSN,<		;LIST KLSYM.MAC IN COMMON ONLY
     7								TAPE>>
     8				TITLE	SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE
     9
    10					STOPCD(,ENTRY,SWAMP)^
    11					ENTRY	SWAMP		;For library searches
    12	000000'	260040	000000*	SWAMP::PUSHJ	P,DIE		;**** Default stopcode for "SWAMP" ****
    13	000001'	636741	556000		SIXBIT	/SWAMP/  	;Title of module
    14	000002'	000000	000000		S$NONAME,,0		;?NONAME stopcode "SWAMP+nnn(nnnnnn)"
    15			000000'	S$NAME==SWAMP			;For STOPCDs with no arguments
    16					SALL>
    17				^
    18
    19				EXTERN DEVATB,DEVDRB,DEV1UN
    20
    21				EXTERN DRBALC,DRBMXA
    22
    23				EXTERN PGYDRT,PGYERR
    24
    25				EXTERN ATBALP,ATBDUM
    26
    27				EXTERN UNIMCT,UNIPPU,UNISTR,UNISTT,UNITAL,UNYSPU,UNVRSF
    28				EXTERN UNINAM
    29
    30				EXTERN STRDDB,STRTAL,STRUNI,STRNAM,STROVR,STRBTS,SRPRPT,SRPNDS
    31
    32				EXTERN MAPWTL,MAPWTU,MAPRLS,PCBLNK,PCBPTR,PCISTS,RELSAT,PCBPAG
    33				EXTERN STDPRE,%CTLST,%CTUPT,%SAT.C,PPCBIO,SATWRT,STDREA,PSREQ,STDWAG,STDWRT
    34				EXTERN SIREQ,GETLRS,%CTLRU,SIAVAL,PCMLCC,PCBLCC,PCBSTS,STPREA
    35
    36				EXTERN RBREAL,RBYUNI,RBYPNO,RBSPAR,RBYUN1,RBMASK
    37
    38				EXTERN STTAOB,STTFPC,STTLEN,STTPTR,STYBAD,STYINC,STPBAD,STPCHK
    39				EXTERN STTSTS,STPINC,STPRPT
    40
    41				EXTERN CPOPJ,CPOPJ1,GETER2,IOSALC,UNTTBL,UNPSER,INLMES,PRNAME
    42				EXTERN TTYFUW,TTYSTR,STOIOS,DSKPIF,DSKPIN,CURUPT,EPT
    43				EXTERN SATBAD,DBLMSG,NCTXPG,SATBRD,JBYWPT,UNTLEN,DFRLST
    44
    45
    46
    47				;SOME DEFINITIONS
    48
    49				DEFINE DSKOFF <WRPI DSKPIF>
    50				DEFINE DSKON <WRPI DSKPIN>
    51
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

    52					SUBTTL	DISK ALLOCATION AND DEALLOCATION.
    53
    54				;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    55				;;									;;
    56				;;	GETPAG		GET A PAGE, CONTIGUOUS IF POSSIBLE.  EXPECTS	;;
    57				;;			T2/DISK PNTR TO BE CONTIGUOUS WITH ON A UNIT.	;;
    58				;;			IF T2/0, WILL DISPATCH TO GETAPG.		;;
    59				;;									;;
    60				;;	KEPPAG		IDENTICAL TO GETPAG EXCEPT SUCCESS RETURN	;;
    61				;;			HAS SAT IN %SAT.				;;
    62				;;									;;
    63				;;	GETAPG		GET A PAGE ANYWHERE.				;;
    64				;;									;;
    65				;; Expects:	T1/ BITS 0 TO 33 TO BE ZERO, BIT 34 TO BE THE F BIT	;;
    66				;;		    AND BIT 35 TO BE M BIT FOR THIS REQUEST.		;;
    67				;;		T2/ PREVIOUS DP OR 0 (See above).			;;
    68				;;		T3/ ATB ADDRESS OR 0.  ZERO IS ONLY FOR REAL FILES	;;
    69				;;		    THAT DO NOT HAVE AN ATB.				;;
    70				;;		 F/ DDB IF THIS IS A REAL FILE.  ELSE F IS IGNORED.	;;
    71				;;		 S/ DEVIOS IF THIS IS A REAL FILE.			;;
    72				;;									;;
    73				;; Destroys T1, T2, T3, AND T4.						;;
    74				;;									;;
    75				;;	IF GET A PAGE, SKIP RETURN WITH T2/ DISK POINTER TO PAGE.	;;
    76				;;	NON-SKIP RETURN ON CAN'T GET A PAGE.				;;
    77				;;									;;
    78				;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    79
    80				;Routin	Where called	Why
    81				;------	------------	------------------------------------------------
    82				;KEPPAG	MAPIO:CREPAG	Create file page (including OUTPUT from SIMIO)
    83				;GETPAG	CORE1:KCREAT	Get virtual page for CORE and VCREAT uuos
    84				;GETPAG	FRMSER:CREFRM	Create context pages on CREFRM uuo
    85				;GETAPG	FILFND:INSFAK	Create new UFD page to ENTER filename (was a hole)
    86				;GETAPG	FILFND:INSLNK	Create new UFD page to ENTER filename (overflow page)
    87				;GETAPG	FILRIB:GETRIB	File too big for 1 RIB, create a spare RIB
    88				;GETAPG	FILRIB:NXTPTR	File exceeds 2 levels, create 3rd level of RIB
    89				;GETUPG	FILUUO:UENTR	Create RIB for new file
    90				;GTSPAG	SCHED1:SWICCP	Create context pages on login
    91
    92			000002	FBIT==:2			; T1/ (File)   F BIT == 1B34
    93			000001	MBIT==:1			; T1/ (Memory) M BIT == 1B35
    94
    95				PRINTF(<[KEPPAG,GETPAG,GETAPG Need DRBSTR setup to check DSKCLN done]>)
    96				;Routine to skip if at a cylinder boundry.  PTR in T2, preserves all ACs
    97	000003'	606340	000777	ISCYLB::TRNN	T2,000777	;**HACK** Every 512 pages for now
    98	000004'	350001	000000		 AOS	(P)		;Is a cylinder boundry, skip return
    99	000005'	263040	000000		POPJ	P,
   100
   101	000006'	201440	000000*	KEPPAG::MOVEI	T4,SRPNDS	;DSKCLN NEEDED?
   102	000007'	612440	000000*		TDNE	T4,STRDDB+STRBTS ;
   103	000010'	263040	000000		  POPJ	P,		;YES, TREAT LIKE QUOTA EXCEEDED
   104	000011'	261040	001747'		PUSH	P,[-1]		;FLAG TO KEEP THE SAT
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 2-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   105	000012'	322340	000125'		JUMPE	T2,GETA00	;GETAPG+1
   106	000013'	254000	000023'		JRST	GETPA0		;
   107
   108
   109	000014'	201440	000006*	GETPAG::MOVEI	T4,SRPNDS	;DSKCLN NEEDED AND ASKING FOR A
   110	000015'	612440	000000*		TDNE	T4,STRDDB+STRBTS ;
   111	000016'	606300	000002		TRNN	T1,FBIT		;FILE PAGE?
   112	000017'	334000	000000		 SKIPA			;NO
   113	000020'	263040	000000		  POPJ	P,		;YES, PRETEND QUOTA EXCEEDED
   114	000021'	261040	001750'		PUSH	P,[0]		;FLAG TO NOT KEEP THE SAT
   115	000022'	322340	000125'		JUMPE	T2,GETA00	;GETAPG+1
   116	000023'	607340	000000*	GETPA0:	TLNN	T2,RBMASK-RBREAL;Nonzero T2 - must have only RBREAL set
   117	000024'	607340	000000*		TLNN	T2,RBREAL	;
   118	000025'	256000	000000'		 STOPCD
   119	000026'	301300	000001		CAIL	T1,1		;MAKE SURE AT LEAST ONE OF THE F
   120	000027'	303300	000003		CAILE	T1,3		;& M BITS IS REQUESTED SET.
   121	000030'	256000	000000'		 STOPCD
   122	000031'	261040	000014		PUSH	P,P1		;
   123	000032'	261040	000015		PUSH	P,P2		;
   124	000033'	261040	000003		PUSH	P,PG		;
   125	000034'	261040	000005		PUSH	P,U		;SAVE U.
   126	000035'	261040	000010		PUSH	P,T3		;SAVE ATB.
   127	000036'	261040	000006		PUSH	P,T1		;SAVE REQ SETTING OF F AND M.
   128	000037'	474640	000000		SETO	P2,		;FLAG TO ZAP AOBJN POINTER.
   129	000040'	135400	000000*		LDB	T3,RBYUNI	;SEE IF
   130	000041'	200410	000000*		MOVE	T3,UNTTBL(T3)	; WE ARE
   131	000042'	135440	000000*		LDB	T4,RBYPNO	; GOING OVER
   132	000043'	311450	000000*		CAML	T4,UNIPPU(T3)	; THE END OF UNIT.
   133					 JRST	[PUSHJ P,GETSTT	;YES.  GET T2/ STT ENTRY.
   134	000044'	254000	001751'			 JRST  GETPG1]	;
   135	000045'	271340	000001		ADDI	T2,1		;NO. GET T1/ STT ADR, T2/ ADR
   136	000046'	260040	001024'		PUSHJ	P,GETSTT	;OF STT ENTRY, T3/# PGS INTO SAT, U/UNIT.
   137	000047'	326400	000055'		JUMPN	T3,GETPG2	;OKAY IF NOT 1ST IN A SAT.
   138				    ;HERE TO LOOK AT THE SAT FOR THE PREVIOUS PAGE.
   139	000050'	275340	000000*		SUBI	T2,STTLEN	;BACK UP A SAT.
   140	000051'	200307	000000*	GETPG1:	MOVE	T1,STTPTR(T2)	;ROOM IN THE
   141	000052'	260040	001105'		PUSHJ	P,LOKSAT	; SAT?
   142	000053'	254000	000061'		  JRST	GETP24		;NO.
   143	000054'	254000	000243'		JRST	SEARCH		;YES, GET IT.
   144
   145				    ;HERE TO LOOK AT THE SAT FOR THIS PAGE.
   146	000055'	200307	000051*	GETPG2:	MOVE	T1,STTPTR(T2)	;ROOM ON THIS PAGE'S
   147	000056'	260040	001105'		PUSHJ	P,LOKSAT	;SAT?
   148	000057'	254000	000061'		  JRST	GETP24		;FAIL.
   149	000060'	254000	000070'		JRST	GETP26		;WIN.
   150	000061'	336401	777777	GETP24:	SKIPN	T3,-1(P)	;NO ROOM. REAL FILE?
   151	000062'	254000	000065'		 JRST	GETP25		;YES.
   152	000063'	335010	000000*		SKIPGE	ATBDUM(T3)	;STILL MAYBE.
   153	000064'	254000	000104'		 JRST	GETPG4		;NO, CAN'T BE SINGLE UNIT.
   154	000065'	336004	000000*	GETP25:	SKIPN	DEV1UN(F) 	;SINGLE UNIT STUFF?
   155	000066'	254000	000104'		 JRST	GETPG4		;NO.
   156	000067'	254000	000342'		JRST	GETPGU		;YES.
   157	000070'	261040	000010	GETP26:	PUSH	P,T3		;YES,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 2-3
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   158	000071'	231400	000044		IDIVI	T3,^D36		; IS
   159	000072'	271400	377000		ADDI	T3,%SAT		; THE
   160	000073'	213000	000011		MOVNS	T4		; PAGE
   161	000074'	205300	400000		MOVSI	T1,400000	; WE
   162	000075'	242311	000000		LSH	T1,(T4)		; WANT
   163	000076'	612310	000000		TDNE	T1,FBITS(T3)	; FREE?
   164	000077'	616310	000400		TDNN	T1,MBITS(T3)	;
   165					 JRST	[POP  P,T3	;NO.  GET THE BIRD IN HAND.
   166	000100'	254000	001753'			 JRST SEARCH]
   167	000101'	250300	000010		EXCH	T1,T3		;YES, FINISH
   168	000102'	400640	000000		SETZ	P2,		;PROTECT AOBJN POINTER.
   169	000103'	254000	000271'		JRST	SEADON		;UP.
   170
   171				    ;ROOM ON AN IN-CORE SAT FOR SAME UNIT?
   172	000104'	201400	000001	GETPG4:	MOVEI	T3,1		;ROOM ON AN IN CORE SAT
   173	000105'	260040	001126'		PUSHJ	P,LOKUNI	;FROM THIS SAME UNIT?
   174	000106'	254000	000144'		  JRST	GETAP0		;NO.
   175	000107'	254000	000243'		JRST	SEARCH		;YES, GO FIND IT.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 3
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   176				    ;HERE TO GET SPACE ANYPLACE.
   177				    ;FIND THE UNIT WITH THE MOST FREE SPACE AND SEE IF THERE IS
   178				    ;A SAT IN CORE FROM IT.
   179
   180				;GETUPG = Get a page from unit with most space (for building a RIB).
   181				;Added in P035/B02 to allocate from unit with the most space, even if it
   182				;means that a SAT has to be written out to make room for reading in the
   183				;right one.  This prevents completely full SATs from remaining in core
   184				;and clogging up the SAT PCBs (a situation which would have caused all
   185				;new files to be allocated on one unit, not equally distributed).  The
   186				;unbalanced file distrubution was noticed in December 1986 when systems
   187				;moved from Cupertino building "C" to Solar Way in Fremont.
   188
   189	000110'	201440	000014*	GETUPG::MOVEI	T4,SRPNDS
   190	000111'	612440	000000*		TDNE	T4,STRDDB+STRBTS;DSKCLN needed on structure
   191	000112'	606300	000002		TRNN	T1,FBIT		; and asking for a file page?
   192	000113'	334000	000000		 SKIPA			;OKAY.
   193	000114'	263040	000000		  POPJ	P,		;YES, PRETEND QUOTA EXCEEDED.
   194	000115'	261040	001755'		PUSH	P,[GETUPG]	;-6(P) Flag to get from unit with most space
   195	000116'	254000	000125'		JRST	GETA00
   196
   197	000117'	201440	000110*	GETAPG::MOVEI	T4,SRPNDS
   198	000120'	612440	000000*		TDNE	T4,STRDDB+STRBTS;DSKCLN needed on structure
   199	000121'	606300	000002		TRNN	T1,FBIT		; and asking for a file page?
   200	000122'	334000	000000		 SKIPA			;OKAY.
   201	000123'	263040	000000		  POPJ	P,		;YES, PRETEND QUOTA EXCEEDED.
   202	000124'	261040	001750'		PUSH	P,[0]		;-6(P) FLAG TO NOT KEEP THE SAT.
   203	000125'	301300	000001	GETA00:	CAIL	T1,1		;CHECK REQUESTED SETTINGS
   204	000126'	303300	000003		CAILE	T1,3		;OF F AND M.
   205	000127'	256000	000000'		 STOPCD
   206	000130'	261040	000014		PUSH	P,P1		;-5(P)
   207	000131'	261040	000015		PUSH	P,P2		;-4(P)
   208	000132'	261040	000003		PUSH	P,PG		;-3(P)
   209	000133'	261040	000005		PUSH	P,U		;-2(P)
   210	000134'	261040	000010		PUSH	P,T3		;-1(P)
   211	000135'	261040	000006		PUSH	P,T1		; 0(P)  SAVE REQ SETTING OF F AND M.
   212	000136'	474640	000000		SETO	P2,		;FLAG TO ZAP AOBJN POINTER.
   213	000137'	322400	000142'		JUMPE	T3,GETA01	;NO. REAL FILE?
   214	000140'	335010	000063*		SKIPGE	ATBDUM(T3)	;STILL MAYBE.
   215	000141'	254000	000144'		 JRST	GETAP0		;NO.
   216	000142'	332004	000065*	GETA01:	SKIPE	DEV1UN(F)	;NO, SPECIAL UNIT STUFF?
   217	000143'	254000	000342'		 JRST	GETPGU		;YES.
   218	000144'	260040	001062'	GETAP0:	PUSHJ	P,MOSPAU	;U/UNIT WITH MOST FREE SPACE.
   219	000145'	254000	000352'		  JRST	GETFAL		;NO SPACE.
   220	000146'	200401	777772		MOVE	T3,-6(P)	;Get the keep-SAT flag
   221	000147'	302400	000110'		CAIE	T3,GETUPG	;Special call?
   222	000150'	201400	000001		 MOVEI	T3,1		;No, search only the in-core SATs
   223	000151'	306400	000110'		CAIN	T3,GETUPG	;Special call?
   224	000152'	403401	777772		 SETZB	T3,-6(P)	;Yes, check all SATs on this unit
   225	000153'	260040	001126'		PUSHJ	P,LOKUNI	;Check SATs
   226	000154'	254000	000157'		  JRST	GETAP5		;All in-core SATs are full
   227	000155'	254000	000243'		JRST	SEARCH		;Found a SAT with STTFPC positive
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 4
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   228				    ;NO SAT IN CORE FROM THE UNIT WITH THE MOST FREE SPACE.
   229				    ;ARE ALL THE SAT PCBS "IN USE"?
   230
   231	000156'	000000	000000	SATFUL:: Z			;SET <>0 WHEN ALL THE SAT PCBS ARE FULL.
   232								;=0 MEANS MAY OR MAY NOT BE FULL.
   233	000157'	332000	000156'	GETAP5:	SKIPE	SATFUL		;ARE THE SAT PCBS FULL?
   234	000160'	254000	000167'		 JRST	GETAP6		;YES.
   235	000161'	550340	000000*		HRRZ	T2,%SAT.C+%CTLST ;MAYBE. T2/ ADDR OF A SAT PCB.
   236	000162'	336007	000000*	GETA51:	SKIPN	PCBPTR(T2)	;HAS A DISK POINTER?
   237	000163'	254000	000226'		 JRST	GETAP8		;NO--NOT "IN USE".
   238	000164'	550347	000000*		HRRZ	T2,PCBLNK(T2)	;PROBABLY "IN USE". CONTINUE
   239	000165'	326340	000162'		JUMPN	T2,GETA51	;IF THERE IS A NEXT PCB.
   240	000166'	476000	000156'		SETOM	SATFUL		;MARK THE SAT PCBS FULL.
   241
   242				    ;HERE WHEN ALL SAT PCBS ARE IN USE.  TRY TO GET SPACE ON THE
   243				    ;ONE WITH THE MOST FREE SPACE.
   244	000167'	261040	000015	GETAP6:	PUSH	P,P2		;SAVE P2 AND
   245	000170'	261040	000016		PUSH	P,P3		;P3.
   246	000171'	400600	000000		SETZ	P1,		;P1/ MOST SPACE FOUND SO FAR.
   247	000172'	550700	000000*		HRRZ	P3,%SAT.C+%CTLST ;ADDR OF A SAT PCB.
   248	000173'	200356	000162*	GETA62:	MOVE	T2,PCBPTR(P3) 	;GET ITS
   249	000174'	260040	001034'		PUSHJ	P,GSATST	;STT ENTRY TO T2.
   250	000175'	554407	000000*		HLRZ	T3,STTSTS(T2)	;IN
   251	000176'	602400	000000*		TRNE	T3,STPINC	;CORE?
   252	000177'	602400	000000*		TRNE	T3,STPBAD	;IGNORE BAD ONES.
   253	000200'	254000	000205'		 JRST	GETA65		;
   254	000201'	311607	000000*		CAML	P1,STTFPC(T2)	;YES. MORE SPACE THAN PREVIOUS?
   255	000202'	254000	000205'		 JRST	GETA65		;NO.
   256	000203'	200607	000201*		MOVE	P1,STTFPC(T2)	;YES-P1/ MOST SPACE FOUND AND
   257	000204'	200640	000007		MOVE	P2,T2		;P2/ WHERE FOUND.
   258	000205'	550716	000164*	GETA65:	HRRZ	P3,PCBLNK(P3)	;GET NEXT PCB ADDRESS.
   259	000206'	326700	000173'		JUMPN	P3,GETA62	;JUMP ON ANOTHER
   260	000207'	262040	000016		POP	P,P3		;RESTORE P3.
   261	000210'	326600	000220'		JUMPN	P1,GETA69	;SPACE FOUND IN IN CORE SATS?
   262
   263				    ;HERE ON NO SPACE IN IN-CORE SATS.  READ IN 1ST PARTLY
   264				    ;EMPTY SAT ON THE EMPTIEST UNIT.
   265	000211'	262040	000015		POP	P,P2		;RESTORE P2.
   266	000212'	260040	001062'	GETA66:	PUSHJ	P,MOSPAU	;FIND UNIT WITH MOST FREE SPACE.
   267	000213'	254000	000352'		  JRST	GETFAL		;NO SPACE.
   268	000214'	400400	000000		SETZ	T3,		;FIND ITS FIRST PARTLY EMPTY
   269	000215'	260040	001126'		PUSHJ	P,LOKUNI	;SAT (IN-CORE OR OUT.).
   270	000216'	254000	000212'		  JRST	GETA66		;NONE.
   271	000217'	254000	000243'		JRST	SEARCH		;
   272
   273				    ;HERE ON SPACE FOUND ON IN-CORE SAT.
   274	000220'	200315	000055*	GETA69:	MOVE	T1,STTPTR(P2)	;SET UP T1 AND T2
   275	000221'	200340	000015		MOVE	T2,P2		;FOR LOKSAT.
   276	000222'	262040	000015		POP	P,P2		;RESTORE P2.
   277	000223'	260040	001105'		PUSHJ	P,LOKSAT	;GET PAGE FROM
   278	000224'	254000	000167'		  JRST	GETAP6		;SAT IN CORE
   279	000225'	254000	000243'		JRST	SEARCH		;WITH MOST SPACE.
   280
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 5
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   281				    ;HERE WHEN NOT ALL THE SAT PCBS ARE IN USE.
   282				    ;TRY TO READ IN A SAT FROM UNIT WITH THE MOST FREE SPACE.
   283	000226'	550345	000000*	GETAP8:	HRRZ	T2,UNISTT(U)	;IS THERE A SAT
   284	000227'	554407	000175*	GETA82:	HLRZ	T3,STTSTS(T2)	;ON THIS UNIT
   285	000230'	606400	000177*		TRNN	T3,STPBAD	;THAT IS NOT
   286	000231'	602400	000176*		TRNE	T3,STPINC	;IN CORE?
   287	000232'	254000	000237'		 JRST	GETA83		;
   288	000233'	200307	000220*		MOVE	T1,STTPTR(T2)	;YES,
   289	000234'	260040	001105'		PUSHJ	P,LOKSAT	;IS THERE SPACE IN IT?
   290	000235'	254000	000237'		  JRST	GETA83		;FAILED.  GO TRY AGAIN.
   291	000236'	254000	000243'		JRST	SEARCH		;
   292	000237'	271340	000050*	GETA83:	ADDI	T2,STTLEN	;
   293	000240'	332007	000233*		SKIPE	STTPTR(T2)	;
   294	000241'	254000	000227'		 JRST	GETA82		;
   295	000242'	254000	000144'		JRST	GETAP0		;NO.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 6
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   296				;HERE WHEN THERE IS A FREE PAGE IN A SAT THAT WE HAVE MAP WRT LOCKED.
   297				;ENTER WITH T2/ ADDRESS OF STT ENTRY.
   298
   299	000243'	336307	000000*	SEARCH:	SKIPN	T1,STTAOB(T2)	;IF NOT IN MIDDLE OF THIS SAT,
   300	000244'	200300	001756'	SEARC1:	 MOVE	T1,[XWD -400,%SAT] ;START AT ITS BEGINNING.
   301	000245'	200440	000006		MOVE	T4,T1		;SAVE FOR CHECK BELOW.
   302	000246'	332406	000000	SEAR13:	SKIPE	T3,FBITS(T1)	;ANY BITS FREE IN THIS WORD?
   303	000247'	336606	000400		SKIPN	P1,MBITS(T1)	;
   304	000250'	253300	000246'		 AOBJN	T1,SEAR13	;NO, GO TO NEXT WORD.
   305	000251'	404400	000014		AND	T3,P1		;
   306	000252'	326400	000257'		JUMPN	T3,SEARC2	;
   307	000253'	253300	000246'		AOBJN	T1,SEAR13	;
   308	000254'	316440	001756'	SEAR15:	CAMN	T4,[XWD -400,%SAT] ;OUT OF WORDS. AT BEGINNING?
   00255'	256000	001757'		 STOPCD (.,DISK,SEAR14,,<Error at SEAR15+1 - No bits free in SAT>)
   310	000256'	254000	000244'		JRST	SEARC1		;NO, GO TO THE BEGINNING
   311
   312				    ;HERE ON A FREE BIT IN THIS WORD.
   313	000257'	243400	000261'	SEARC2:	JFFO	T3,.+2		;GET T4/ NO. OF BITS INTO WORD.
   314	000260'	256000	000000'		 STOPCD
   315	000261'	551406	000000		HRRZI	T3,(T1)		;CALC THE
   316	000262'	275400	377000		SUBI	T3,%SAT		;NO. OF
   317	000263'	221400	000044		IMULI	T3,^D36		;PAGES INTO
   318	000264'	271411	000000		ADDI	T3,(T4)		;THIS SAT, AND SAVE FOR
   319	000265'	261040	000010		PUSH	P,T3		;DISK PNTR CALC BELOW.
   320	000266'	213000	000011		MOVNS	T4		;SET THE
   321	000267'	515400	400000		HRLZI	T3,400000	;GOTTEN
   322	000270'	242411	000000		LSH	T3,(T4)		;BITS.
   323	000271'	200441	777777	SEADON:	MOVE	T4,-1(P)	;GET REQUESTED F&M SETTING.
   324	000272'	612406	000000		TDNE	T3,FBITS(T1)	;DEBUGGING
   325	000273'	616406	000400		TDNN	T3,MBITS(T1)	;CHECK.
   326	000274'	256000	000000'		 STOPCD
   327	000275'	606440	000003		TRNN	T4,FBIT!MBIT	;DEBUGGING CHECK.
   328	000276'	256000	000000'		 STOPCD
   329	000277'	602440	000002		TRNE	T4,FBIT		;WANT TO SET F BIT?
   330	000300'	412406	000000		 ANDCAM	T3,FBITS(T1)	;YES, DO SO.
   331	000301'	602440	000001		TRNE	T4,MBIT		;WANT TO SET M BIT?
   332	000302'	412406	000400		 ANDCAM	T3,MBITS(T1)	;YES, DO SO.
   333	000303'	375007	000203*		SOSGE	STTFPC(T2)	;ADJUST THE FREE PAGE COUNT.
   334	000304'	256000	000000'		 STOPCD (SLO)
   335	000305'	322640	000313'		JUMPE	P2,SEARC4	;DON'T TOUCH AOBJN IF GOT SPECIFIC PAGE.
   336				PRINTF (<[Changing AOBJN at SEARC3-3 causes unneeded cylinder movement]>)
   337	000306'	252300	000311'		AOBJP	T1,SEARC3	;
   338	000307'	252300	000311'		AOBJP	T1,SEARC3	;SO ADJUST IT
   339	000310'	253300	000312'		AOBJN	T1,.+2		;UP THREE
   340	000311'	400300	000000	SEARC3:	SETZ	T1,		;WORDS.
   341	000312'	202307	000243*		MOVEM	T1,STTAOB(T2)	;STORE IT.
   342
   343				    ;HERE TO GET THE DISK POINTER TO THE GOTTEN PAGE INTO T2.
   344	000313'	260040	001047'	SEARC4:	PUSHJ	P,GETPNO	;T2/ BASE DISK POINTER.
   345	000314'	262040	000010		POP	P,T3		;RESTORE NO. OF WORDS INTO THIS SAT.
   346	000315'	271350	000000		ADDI	T2,(T3)		;T2/ DISK PNTR TO GOTTEN PAGE.
   347	000316'	661340	000024*		TLO	T2,RBREAL	;
   348	000317'	202341	000000		MOVEM	T2,(P)		;SAVE T2 FROM MAPRLS, F&M UNNECC.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 6-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   349	000320'	200301	777772		MOVE	T1,-6(P)	;FLAG FOR KEEPING SAT.
   350	000321'	326300	000324'		JUMPN	T1,SERC4A	;
   351	000322'	201140	000000*		MOVEI	PG,%SAT.C	;RELEASE THE
   352	000323'	260040	000000*		PUSHJ	P,MAPRLS	;SAT.
   353	000324'	201300	000001	SERC4A:	MOVEI	T1,1		;ARG FOR UPDCNT (ALLOC.).
   354	000325'	200341	000000		MOVE	T2,(P)		;
   355	000326'	135240	000040*		LDB	U,RBYUNI	;
   356	000327'	200245	000041*		MOVE	U,UNTTBL(U)	;
   357	000330'	200341	777777		MOVE	T2,-1(P)	;T2/ ATB ADDB OR 0.
   358	000331'	260040	001161'		PUSHJ	P,UPDACT	;UPDATE COUNTS.
   359	000332'	262040	000007		POP	P,T2		;RESTORE T2/ DISK POINTER.
   360
   361				REPEAT 0,<;This code not fully implemented
   362					MOVEI	T1,SPUFDS##	;Table of pointers to special UFDs
   363				SEARC5:	SKIPL	T3,(T1)		;Get AOBJN pointer
   364					 JRST	SEAR5B		;End of table
   365				SEAR5A:	CAMN	T2,(T3)		;Part of [1,1].UFD or [1,4].UFD?
   366					 STOPCD	(.,DISK,SATRSV,,<SAT error - reserved page gotten>)
   367					AOBJN	T3,SEAR5A
   368					AOJA	T1,SEARC5	;Try next UFD
   369				>  ;End REPEAT 0
   370
   371	000333'	262040	000010	SEAR5B:	POP	P,T3		;RESTORE ACS
   372	000334'	262040	000005		POP	P,U		;RESTORE U.
   373	000335'	262040	000003		POP	P,PG		;
   374	000336'	262040	000015		POP	P,P2		;
   375	000337'	262040	000014		POP	P,P1		;
   376	000340'	262040	000006		POP	P,T1		;CLEAR PDL.
   377	000341'	254000	000000*		JRST	CPOPJ1		;SUCCESS RETURN.
   378
   379
   380				;HERE FOR ALL ON A SPECIAL UNIT.
   381	000342'	200244	000142*	GETPGU:	MOVE	U,DEV1UN(F)	;THIS IS THE UNIT.
   382	000343'	201400	000001		MOVEI	T3,1		;FIRST LOOK AT ITS IN-CORE SATS.
   383	000344'	260040	001126'		PUSHJ	P,LOKUNI	;
   384	000345'	634400	000010		TDZA	T3,T3		;NOT FOUND, SO LOOK AT ALL OF
   385	000346'	254000	000243'		JRST	SEARCH		;
   386	000347'	260040	001126'		PUSHJ	P,LOKUNI	;ITS SATS.
   387	000350'	254000	000352'		JRST	GETFAL		;
   388	000351'	254000	000243'		JRST	SEARCH		;FOUND.
   389
   390
   391	000352'	262040	000006	GETFAL:	POP	P,T1
   392	000353'	262040	000010		POP	P,T3		;
   393	000354'	262040	000005		POP	P,U
   394	000355'	262040	000003		POP	P,PG
   395	000356'	262040	000015		POP	P,P2		;
   396	000357'	262040	000014		POP	P,P1		;
   397	000360'	262040	000006		POP	P,T1		;CLR PDL.
   398	000361'	263040	000000		POPJ	P,
   399
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 7
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   400				COMMENT #
   401				@@SUBROUTINE GTSPAG/GTSAPG
   402				@@PURPOSE
   403				SUBROUTINE TO GET A BLOCK OF CONTIGUOUS PAGES FOR THE SWAPPER
   404				ON THE DISK.
   405				@@ENTRY
   406				THERE ARE TWO ENTRY POINTS:
   407
   408					GTSPAG		GET A BLOCK OF PAGES, STARTING IMMED
   409							AFTER THE SPECIFIED PAGE, IF POSSIBLE.
   410					GTSAPG		GET A BLOCK OF PAGES ANYWHERE.
   411
   412				Note: In P034/P, GTSAPG is not called directly, GTSPAG called from SCHED1 to
   413				allocate 3 disk pages to build a set of context pages for ".LOGIN" request.
   414				At SWICCP+17 in SCHED1, the following are set up for GTSPAG.
   415					T1/ MBIT
   416					T2/ 0 first time, previous page if couldn't get all 3
   417					T3/ 3,,0 = number of context pages in LH
   418
   419				THE GTSPAG ENTRY POINT EXPECTS T2/DISK PNTR TO BE CONTIGUOUS
   420				WITH ON THE UNIT;  IF T2=0, GTSPAG WILL DISPATCH TO GTSAPG.
   421				BOTH ENTRY POINTS EXPECT T1 BITS 0 TO 33 TO BE ZERO, BIT 34
   422				TO BE THE REQUESTED SETTING OF THE F BIT, AND BIT 35 TO BE THE
   423				REQUESTED SETTING OF THE M BIT.
   424				BOTH ENTRY POINTS EXPECT LH(T3)=NO. OF CONTIGUOUS PAGES TO TRY
   425				TO GET.
   426				@@ACCUM
   427				DESTROYS T1, T2, T3, AND T4.
   428				@@EXIT
   429				IF GET AT LEAST ONE PAGE, SKIP RETURN WITH T2/ DISK POINTER TO
   430				FIRST PAGE GOTTEN AND T3/ NO. OF PAGES GOTTEN.
   431				NON-SKIP RETURN ON CAN'T GET A PAGE, WITH T1/ STRTAL (SO=0 MEANS
   432				NO DISK SPACE AVAILABLE, <>0 MEANS WAITING FOR SAT, ETC.).
   433				@@ #
   434
   435				PRINTF(<[GTSPAG,GTSAPG Check for DSKCLN done needs DRBSTR setup for user]>)
   436				    ;CHECK THE ARGS FOR VALIDITY.
   437	000362'	201440	000117*	GTSPAG::MOVEI	T4,SRPNDS	;DSKCLN NEEDED AND ASKING FOR A
   438	000363'	612440	000000*		TDNE	T4,STRDDB+STRBTS ;
   439	000364'	606300	000002		TRNN	T1,FBIT		;FILE PAGE?
   440	000365'	334000	000000		 SKIPA			;OKAY.
   441					  JRST	[SETZ T1,	;YES, PRETEND QUOTA
   442	000366'	254000	001762'			POPJ P,]	;EXCEEDED.
   443	000367'	322340	000447'		JUMPE	T2,GTSAPG	;
   444	000370'	607340	000000*		TLNN	T2,RBMASK-RBREAL ;BE SURE THE RETRIEVAL PNTR
   445	000371'	607340	000316*		TLNN	T2,RBREAL	;IS LEGAL.
   446	000372'	256000	000000'		 STOPCD
   447	000373'	301300	000001		CAIL	T1,1		;BE SURE T1 HAS ONLY THE F AND
   448	000374'	303300	000003		CAILE	T1,3		;M BITS SET.
   449	000375'	256000	000000'		 STOPCD
   450	000376'	607400	777777		TLNN	T3,-1		;CHECK COUNT OF PAGES.
   451	000377'	256000	000000'		 STOPCD
   452
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 7-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   453	000400'	261040	000014		PUSH	P,P1		;
   454	000401'	261040	000015		PUSH	P,P2		;
   455	000402'	261040	000003		PUSH	P,PG		;
   456	000403'	261040	000005		PUSH	P,U		;
   457	000404'	261040	000006		PUSH	P,T1		;SAVE F AND M BITS.
   458	000405'	261040	000010		PUSH	P,T3		;SAVE COUNT, ATB ADDRESS.
   459	000406'	135400	000326*		LDB	T3,RBYUNI	;GOING
   460	000407'	200410	000327*		MOVE	T3,UNTTBL(T3)	;OVER
   461	000410'	135440	000042*		LDB	T4,RBYPNO	;END OF
   462	000411'	311450	000043*		CAML	T4,UNIPPU(T3)	;UNIT?
   463					  JRST	[SETZ  P1,	;YES, CAN'T BE CONTIG.
   464						 PUSHJ P,GETSTT	;
   465	000412'	254000	001764'			 JRST  GTSPG2]	;
   466	000413'	271340	000001		ADDI	T2,1		;NO, GOING OVER END
   467	000414'	260040	001024'		PUSHJ	P,GETSTT	;OF
   468	000415'	200600	000010		MOVE	P1,T3		;
   469	000416'	326400	000420'		JUMPN	T3,GTSPG2	;SAT?
   470	000417'	275340	000237*		SUBI	T2,STTLEN	;
   471				    ;HERE WITH STT ENTRY ADDR IN T2 AND, IF WE CAN TRY FOR
   472				    ;CONTIGUITY, NO. OF BITS INTO SAT IN P1, ELSE P1/0.
   473	000420'	337007	000303*	GTSPG2:	SKIPG	STTFPC(T2)	;
   474	000421'	254000	000467'		  JRST	GTSAP0		;MAYBE BAD, MAYBE NO ROOM.
   475	000422'	135300	000000*		LDB	T1,STYINC	;FORGET IT IF NOT
   476	000423'	322300	000467'		JUMPE	T1,GTSAP0	;IN CORE.
   477				    ;HERE WITH THE SAT WE WANT IN CORE, AND WITH SOME
   478				    ;SPACE.  T2/ HAS STT ENTRY ADDR AND P1/ HAS CONTIG COUNT,
   479				    ;GET PG/ CORE PAGE NUMBER.
   480				    ;CHECK FOR GOODNESS.
   481	000424'	550640	000000*		HRRZ	P2,%SAT.C+%CTLST ;FIND
   482	000425'	554315	000000*	GTSP2A:	HLRZ	T1,PCBPAG(P2)	;THE
   483	000426'	326300	000432'		JUMPN	T1,GTSPG3	;CORE
   484	000427'	550655	000205*		HRRZ	P2,PCBLNK(P2)	;PAGE
   485	000430'	326640	000425'		JUMPN	P2,GTSP2A	;NUMBER
   486	000431'	256000	000000'		 STOPCD
   487	000432'	200307	000240*	GTSPG3:	MOVE	T1,STTPTR(T2)	;AND
   488	000433'	316315	000173*	GTSP3A:	CAMN	T1,PCBPTR(P2)	;STORE
   489	000434'	254000	000440'		  JRST	GTSPG4		;IT
   490	000435'	550655	000427*		HRRZ	P2,PCBLNK(P2)	;IN
   491	000436'	326640	000433'		JUMPN	P2,GTSP3A	;PG.
   492	000437'	256000	000000'		 STOPCD
   493	000440'	554155	000425*	GTSPG4:	HLRZ	PG,PCBPAG(P2)	;
   494	000441'	515300	000000*		HRLZI	T1,PCMLCC	;CHECK THAT THE
   495	000442'	612315	000000*		TDNE	T1,PCBLCC(P2)	;SAT IS NOT LOCKED
   496	000443'	254000	000467'		  JRST	GTSAP0		;UP BY SOMEBODY.
   497
   498	000444'	260040	001256'		PUSHJ	P,SSTCHK	;CHECK SAT FOR GOODNESS
   499	000445'	254000	000544'		  JRST	GTSA52		;OKAY.
   500	000446'	254000	000467'		JRST	GTSAP0		;BAD.  FORGET IT.
   501
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 8
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   502
   503				    ;CHECK THE ARGS FOR VALIDITY.
   504	000447'	201440	000362*	GTSAPG::MOVEI	T4,SRPNDS	;DSKCLN NEEDED AND ASKING FOR A
   505	000450'	612440	000000*		TDNE	T4,STRDDB+STRBTS ;
   506	000451'	606300	000002		TRNN	T1,FBIT		;FILE PAGE?
   507	000452'	334000	000000		 SKIPA			;OKAY.
   508					  JRST	[SETZ T1,	;YES, PRETEND QUOTA
   509	000453'	254000	001762'			 POPJ P,]	;EXCEEDED.
   510	000454'	301300	000001		CAIL	T1,1		;BE SURE T1 HAS ONLY THE F AND
   511	000455'	303300	000003		CAILE	T1,3		;M BITS SET.
   512	000456'	256000	000000'		 STOPCD
   513	000457'	607400	777777		TLNN	T3,-1		;CHECK COUNT OF PAGES.
   514	000460'	256000	000000'		 STOPCD
   515
   516
   517	000461'	261040	000014		PUSH	P,P1		;SAVE
   518	000462'	261040	000015		PUSH	P,P2		;SOME
   519	000463'	261040	000003		PUSH	P,PG		;ACS.
   520	000464'	261040	000005		PUSH	P,U		;WORKING
   521
   522	000465'	261040	000006		PUSH	P,T1		;SAVE F AND M BITS.
   523	000466'	261040	000010		PUSH	P,T3		;SAVE COUNT, ATB ADDRESS.
   524
   525				    ;SET UP P1/ 0 AND P2/ ADDR OF 1ST PRIMARY PCB.
   526	000467'	400600	000000	GTSAP0:	SETZ	P1,		;No best page so far
   527	000470'	700600	000000*		DSKOFF
   528	000471'	550640	000000*		HRRZ	P2,%SAT.C+%CTLST ;SKIP OVER THE
   529	000472'	554415	000440*	GTSP0A:	HLRZ	T3,PCBPAG(P2)	;SECONDARY PCBS.
   530	000473'	326400	000501'		JUMPN	T3,GTSAP4	;JUMP IF A PRIMARY.
   531	000474'	550655	000435*		HRRZ	P2,PCBLNK(P2)	;GET THE NEXT PCB.
   532	000475'	326640	000472'		JUMPN	P2,GTSP0A	;MUST BE SOME PRIMARIES.
   533	000476'	256000	001767'		 STOPCD	(.,STOP,GTSAP1,,<Error at GTSAP0+7>);;GTSAP0+7
   534
   535				    ;LOOK THRU THE PRIMARY PCBS FOR A GOOD, PARTLY EMPTY, IN
   536				    ;CORE SAT, OR FAILING THAT, ONE GOOD, PARTLY EMPTY, AND ON
   537				    ;ITS WAY IN.
   538	000477'	550655	000474*	GTSA40:	HRRZ	P2,PCBLNK(P2)	;GET NEXT PCB.
   539	000500'	322640	000570'		JUMPE	P2,GTSAP7	;JUMP IF NONE LEFT.
   540				      ;HERE WITH A PCB.  SEE IF ITS SAT HAS ANY ROOM.
   541	000501'	336315	000433*	GTSAP4:	SKIPN	T1,PCBPTR(P2)	;IS THERE A SAT IN THIS PCB?
   542	000502'	254000	000570'		  JRST	GTSAP7		;NO, NO MORE SATS IN PCBS.
   543	000503'	135240	000000*		LDB	U,RBYUN1	;YES.  GET
   544	000504'	200245	000407*		MOVE	U,UNTTBL(U)	;T3/
   545	000505'	200405	000226*		MOVE	T3,UNISTT(U)	;ITS
   546	000506'	316310	000432*	GTSA42:	CAMN	T1,STTPTR(T3)	;STT
   547	000507'	254000	000514'		  JRST	GTSA45		;ENTRY
   548	000510'	271400	000417*		ADDI	T3,STTLEN	;ADDR.
   549	000511'	336010	000506*		SKIPN	STTPTR(T3)	;
   550	000512'	256000	001772'		 STOPCD (.,DISK,GTSA43,,<Error at GTSA42 - STTPTR is zero>);;GTSA42+5
   551	000513'	254000	000506'		JRST	GTSA42		;
   552	000514'	336010	000420*	GTSA45:	SKIPN	STTFPC(T3)	;ROOM IN IT?
   553	000515'	254000	000477'		  JRST	GTSA40		;NO, LOOK AT NEXT PCB.
   554	000516'	515300	000441*		HRLZI	T1,PCMLCC	;UUNLOCKED?
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 8-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   555	000517'	612315	000442*		TDNE	T1,PCBLCC(P2)	;
   556	000520'	254000	000477'		  JRST	GTSA40		;NO.
   557				      ;IS THE SAT IN CORE?
   558	000521'	550340	000015		HRRZ	T2,P2		;
   559	000522'	135300	000000*		LDB	T1,PCISTS	;DATA
   560	000523'	602300	000000*		TRNE	T1,STDPRE	;PRESENT?
   561	000524'	254000	000532'		  JRST	GTSA48		;YES, GO CHECK IT FOR GOODNESS.
   562				      ;SAT ISN'T IN CORE.  IS IT ON ITS WAY IN?
   563	000525'	602300	000000*		TRNE	T1,STDREA	;COMING IN?
   564					  JRST	[MOVEI P1,1	;YES, REMEMBER THAT.
   565	000526'	254000	001775'			 JRST  GTSA40]	;
   566	000527'	305600	000001		CAIGE	P1,1		;NO, REMEMBER THAT, TOO,
   567	000530'	201615	000000		  MOVEI	P1,(P2)		;UNLESS ANOTHER ONE ON ITS
   568	000531'	254000	000477'		JRST	GTSA40		;WAY IN.
   569				      ;HERE WITH A PARTLY EMPTY IN CORE SAT.  CHECK IT FOR
   570				      ;GOODNESS.
   571	000532'	551350	000000	GTSA48:	HRRZI	T2,(T3)		;T2/ STT ENTRY ADDR FOR SSTCHK.
   572	000533'	554155	000472*		HLRZ	PG,PCBPAG(P2)	;PG/ CORE PAGE NUMBER.
   573	000534'	260040	001256'		PUSHJ	P,SSTCHK	;CHECK THIS SAT.
   574	000535'	254000	000542'		  JRST	GTSAP5		;OKAY.
   575				PRINTF(<[GTSA48+4 Checking for space should use STR for this unit]>)
   576	000536'	201400	000000*		MOVEI	T3,STRDDB	;T3/ STR DATA BLOCK
   577	000537'	333310	000000*		SKIPLE	T1,STRTAL(T3)	;BAD.  ENOUGH SPACE LEFT TO
   578	000540'	254000	000477'		 JRST	GTSA40		;KEEP LOOKING?
   579	000541'	254000	000660'		JRST	GTSWAT		;NO.
   580
   581				    ;HERE ON GOOD, PARTLY EMPTY IN CORE SAT FOUND.
   582	000542'	700600	000000*	GTSAP5:	DSKON
   583	000543'	400600	000000		SETZ	P1,		;FLAG TO SSERCH FOR NO CONTIG.
   584	000544'	500241	000000	GTSA52:	HLL	U,(P)		;GET U/ COUNT REQ,, UNIT DDB.
   585	000545'	262040	000011		POP	P,T4		;
   586	000546'	250641	000000		EXCH	P2,(P)		;GET P2/ F AND M BITS.
   587	000547'	260040	000670'		PUSHJ	P,SSERCH	;GET T2/RET PNTR, T3/NO. GOTTEN.
   588				      ;IF THIS PCB IS CLEAN AND ON THE LRU-MRU LIST, WE MUST
   589				      ;TAKE IT AS A RESOURCE, AS FINPCB CANNOT TELL THIS
   590				      ;FROM A DIRTY SAT RELEASED BY ITS LAST USER, AND FINPCB
   591				      ;WILL GIVE IT BACK AS A RESOURCE.
   592	000550'	262040	000015		POP	P,P2		;P2/ PCB ADDRESS, AGAIN.
   593	000551'	201440	000003		MOVEI	T4,3		;ADJUST THE SAT WRITE WAIT
   594	000552'	202440	000000*		MOVEM	T4,SATWRT	;COUNT.
   595	000553'	135300	000000*		LDB	T1,PGYDRT	;IS THIS PCB ALREADY
   596	000554'	326300	000663'		JUMPN	T1,GTSWIN	;DIRTY?
   597	000555'	137440	000553*		DPB	T4,PGYDRT	;NO.  IT IS NOW.
   598	000556'	200300	000000*		MOVE	T1,%SAT.C+%CTLRU;IS THIS FORMERLY CLEAN PCB
   599	000557'	336006	000000	GTSA5A:	SKIPN	(T1)		; ON
   600	000560'	254000	000663'		 JRST	GTSWIN		; THE
   601	000561'	312646	000000		CAME	P2,(T1)		; LRU-MRU
   602	000562'	344300	000557'		 AOJA	T1,GTSA5A	; LIST?
   603	000563'	357000	000000*		AOSG	SIREQ		; YES, PRETEND WE
   604	000564'	254000	000663'		 JRST	GTSWIN		; HAVE
   605	000565'	332000	000000*		SKIPE	SIAVAL		; A
   606	000566'	350000	000565*		 AOS	SIAVAL		; RESOURCE.
   607	000567'	254000	000663'		JRST	GTSWIN		;
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 8-3
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   608
   609				    ;HERE WHEN NO ROOM IN A SAT IN CORE.  NOW, UNLESS WAITING,
   610				    ;NEED BOTH A FREE PCB AND A PARTLY EMPTY OUT OF CORE
   611				    ;SAT TO PULL IN.
   612	000570'	306600	000001	GTSAP7:	CAIN	P1,1		;WAIT IF SOMEBODY ON
   613	000571'	254000	000660'		 JRST	GTSWAT		;THEIR WAY IN.
   614	000572'	322600	000602'		JUMPE	P1,GTSA70	;IF SOMEBODY LAYING AROUND,
   615	000573'	201354	000000		MOVEI	T2,(P1)		;DOING NOTHING, BOOT THEM
   616	000574'	135300	000522*		LDB	T1,PCISTS	;AWAKE.
   617	000575'	660300	000525*		TRO	T1,STDREA	;
   618	000576'	137300	000574*		DPB	T1,PCISTS	;
   619	000577'	400440	000000		SETZ	T4,		;
   620	000600'	260040	000000*		PUSHJ	P,PPCBIO	;THIS TURNS ON THE DISK.
   621	000601'	254000	000660'		JRST	GTSWAT		;
   622				      ;CAN WE GET A PCB?
   623	000602'	550640	000000*	GTSA70:	HRRZ	P2,%SAT.C+%CTLST ;NOT IF
   624	000603'	554315	000533*		HLRZ	T1,PCBPAG(P2)	;ANY
   625	000604'	322300	000660'		JUMPE	T1,GTSWAT	;SECONDARIES
   626	000605'	200300	000000*		MOVE	T1,PSREQ	;OR
   627	000606'	347300	000660'		AOJG	T1,GTSWAT	;PS FULL
   628	000607'	200300	000563*		MOVE	T1,SIREQ	;OR
   629	000610'	347300	000660'		AOJG	T1,GTSWAT	;SI FULL.
   630				      ;FIND AN OUT OF CORE PARTLY EMPTY SAT.
   631				PRINTF(<[GTSA70+7 Use right structure or DRBSTR block to look for SAT space]>)
   632	000611'	201240	000536*		MOVEI	U,STRDDB	;Get current structure ** DRBSTR **
   633	000612'	554245	000000*		HLRZ	U,STRUNI(U)	;
   634	000613'	200345	000505*	GTSA71:	MOVE	T2,UNISTT(U)	;FIND
   635	000614'	336007	000511*	GTSA72:	SKIPN	STTPTR(T2)	;A
   636	000615'	254000	000634'		  JRST	GTSA75		;PCB
   637	000616'	336007	000514*		SKIPN	STTFPC(T2)	;WITH ROOM
   638	000617'	254000	000632'		  JRST	GTSA74		;AND
   639	000620'	135300	000422*		LDB	T1,STYINC	;OUT
   640	000621'	326300	000632'		JUMPN	T1,GTSA74	;OF CORE.
   641	000622'	200300	000000*		MOVE	T1,%SAT.C+%CTLST ;AS WELL, IT
   642	000623'	336406	000501*	GTSA73:	SKIPN	T3,PCBPTR(T1)	;CAN'T ALREADY
   643	000624'	254000	000637'		  JRST	GTSA77		;BE IN
   644	000625'	316407	000614*		CAMN	T3,STTPTR(T2)	;A
   645	000626'	254000	000632'		  JRST	GTSA74		;PCB.
   646	000627'	550306	000477*		HRRZ	T1,PCBLNK(T1)	;LOOK AT NEXT PCB.
   647	000630'	326300	000623'		JUMPN	T1,GTSA73	;
   648	000631'	254000	000637'		JRST	GTSA77		;
   649	000632'	271340	000510*	GTSA74:	ADDI	T2,STTLEN	;
   650	000633'	254000	000614'		JRST	GTSA72		;
   651	000634'	554245	000000*	GTSA75:	HLRZ	U,UNISTR(U)	;NEXT UNIT.
   652	000635'	326240	000613'		JUMPN	U,GTSA71	;
   653	000636'	254000	000660'		JRST	GTSWAT		;
   654				      ;FIND A PCB WE CAN READ IN.
   655	000637'	261047	000625*	GTSA77:	PUSH	P,STTPTR(T2)	;
   656	000640'	201140	000322*		MOVEI	PG,%SAT.C	;GET T2/
   657	000641'	260040	000000*		PUSHJ	P,GETLRS	;PCB ADDR.
   658	000642'	256000	000000'		 STOPCD
   659	000643'	262040	000006		POP	P,T1		;
   660	000644'	603300	000371*		TLNE	T1,RBREAL	;DEBUGGING
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 8-4
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   661	000645'	603300	000000*		TLNE	T1,RBMASK-RBREAL	;CHECK.
   662	000646'	256000	000000'		 STOPCD
   663	000647'	202307	000623*		MOVEM	T1,PCBPTR(T2)	;
   664	000650'	135300	000576*		LDB	T1,PCISTS	;SET STATUS
   665	000651'	602300	000000*		TRNE	T1,STDWRT!STDWAG!STDREA ;DEBUGGING CHECK.
   666	000652'	256000	000000'		 STOPCD
   667	000653'	660300	000575*		TRO	T1,STDREA	;TO
   668	000654'	137300	000650*		DPB	T1,PCISTS	;READING, AND
   669	000655'	400440	000000		SETZ	T4,		;START
   670	000656'	260040	000600*		PUSHJ	P,PPCBIO	;THE READ.
   671	000657'	254000	000660'		JRST	GTSWAT		;
   672
   673
   674
   675	000660'	700600	000542*	GTSWAT:	DSKON
   676	000661'	370001	777772		SOS	-6(P)		;
   677	000662'	274040	001777'		SUB	P,[XWD 2,2]	;CLR JUNK FROM PDL.
   678	000663'	262040	000005	GTSWIN:	POP	P,U		;
   679	000664'	262040	000003		POP	P,PG		;
   680	000665'	262040	000015		POP	P,P2		;
   681	000666'	262040	000014		POP	P,P1		;
   682	000667'	254000	000341*		JRST	CPOPJ1		;
   683
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 9
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   684				COMMENT #
   685				@@SUBROUTINE SSERCH
   686				@@PURPOSE
   687				SUBR TO FIND SOME CONTIGUOUS PAGES FOR GTSAPG/PAG.  SETS F AND M
   688				BITS FOR ALL THE PAGES AS REQUESTED BY CALLER.  ADJUSTS
   689				STTFPC, UNITAL, AND STRTAL.
   690				@@ENTRY
   691				EXPECTS T2/ STT ENTRY ADDR,
   692				U/ COUNT OF PAGES TO TRY FOR,, UNIT DB ADDR, P2/ F AND M
   693				BIT SETTINGS.  IF P1 IS NON-ZERO, IT IS A COUNT OF THE NUMBER OF
   694				BITS INTO THE SAT FOR A CONTIGUITY TRY.
   695				%SWP SLOT IS ALREADY SET ON ENTRY.
   696				@@ACCUM
   697				DESTROYS T1-T4 AND P1-P2.
   698				@@EXIT
   699				RETURNS T2/ RETRIEVAL PNTR TO FIRST PAGE GOTTEN AND T3/ NO. OF
   700				PAGES GOTTEN.
   701				@@ #
   702
   703	000670'	261040	000005	SSERCH:	PUSH	P,U		;SAVE REQUESTED COUNT,,UNIT DB.
   704	000671'	557000	000005		HLRZS	U		;U/ REQUESTED COUNT.
   705	000672'	336300	000014		SKIPN	T1,P1		;ASKING FOR CONTIGUITY?
   706	000673'	254000	000713'		  JRST	SSERC0		;NO.
   707	000674'	261040	000007		PUSH	P,T2		;YES, SAVE T2 FROM IDIVI.
   708	000675'	231300	000044		IDIVI	T1,^D36		;GET T1/ NO. OF WORDS
   709	000676'	271300	776000		ADDI	T1,%SWP		;INTO
   710	000677'	213000	000007		MOVNS	T2		;SAT.
   711	000700'	515400	400000		HRLZI	T3,400000	;BUILD THE MASK IN
   712	000701'	242407	000000		LSH	T3,(T2)		;T3.
   713	000702'	200446	000000		MOVE	T4,(T1)		;GET THE ANDED WORD IN
   714	000703'	404446	000400		AND	T4,400(T1)	;T4.
   715	000704'	616440	000010		TDNN	T4,T3		;THIS PAGE FREE?
   716					  JRST	[POP  P,T2	;NO.
   717	000705'	254000	002000'			 JRST SSERC0]	;
   718	000706'	262040	000007		POP	P,T2		;
   719	000707'	261040	000014		PUSH	P,P1		;YES.  SAVE PAGES INTO THE SAT.
   720	000710'	200600	000011		MOVE	P1,T4		;SET P1/ "AND" WORD FOR BELOW.
   721	000711'	505306	001400		HRLI	T1,-400-%SWP(T1) ;T1/ "AOBJN" WORD. T3/MASK.
   722	000712'	254000	000742'		JRST	SSERC3		;JUMP INTO CODE BELOW.
   723
   724				    ;HERE WHEN WE CAN'T START WITH CONTIGUITY.
   725	000713'	336307	000312*	SSERC0:	SKIPN	T1,STTAOB(T2)	;IF NOT IN MIDDLE OF THIS SAT,
   726	000714'	200300	001756'	SSERC1:	  MOVE	T1,[XWD -400,%SAT] ;START AT ITS BEGINNING.
   727	000715'	271300	377000		ADDI	T1,-%SAT+%SWP	;T1/ "AOBJN" WORD.
   728	000716'	554440	000006		HLRZ	T4,T1		;SAVE FOR CHECK BELOW.
   729	000717'	332406	000000	SSER13:	SKIPE	T3,FBITS(T1)	;ANY BITS FREE IN THIS WORD?
   730	000720'	336606	000400		SKIPN	P1,MBITS(T1)	;
   731	000721'	253300	000717'		  AOBJN	T1,SSER13	;NO, GO TO NEXT WORD.
   732	000722'	407400	000014		ANDB	T3,P1		;
   733	000723'	326400	000730'		JUMPN	T3,SSERC2	;
   734	000724'	253300	000717'		AOBJN	T1,SSER13	;
   735	000725'	306440	777400		CAIN	T4,-400		;OUT OF WORDS. GO TO
   736	000726'	256000	000000'		 STOPCD (SLO)
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 9-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   737						;BEGINNING, UNLESS THAT IS
   738	000727'	254000	000714'		JRST	SSERC1		;WHERE WE STARTED.
   739
   740				    ;HERE ON A FREE BIT IN THIS WORD.
   741	000730'	243400	000732'	SSERC2:	JFFO	T3,.+2		;GET T4/ NO. OF BITS INTO WORD.
   742	000731'	256000	000000'		 STOPCD
   743	000732'	551406	000000		HRRZI	T3,(T1)		;CALC THE
   744	000733'	275400	776000		SUBI	T3,%SWP		;NO. OF
   745	000734'	221400	000044		IMULI	T3,^D36		;PAGES INTO
   746	000735'	271411	000000		ADDI	T3,(T4)		;THIS SAT, AND SAVE FOR
   747	000736'	261040	000010		PUSH	P,T3		;DISK PNTR CALC BELOW.
   748	000737'	213000	000011		MOVNS	T4		;GET T3/
   749	000740'	515400	400000		HRLZI	T3,400000	;THE
   750	000741'	242411	000000		LSH	T3,(T4)		;MASK.
   751	000742'	612406	000000	SSERC3:	TDNE	T3,(T1)		;DEBUGGING
   752	000743'	616406	000400		TDNN	T3,400(T1)	;CHECK.
   753	000744'	256000	000000'		 STOPCD
   754	000745'	302640	000001		CAIE	P2,MBIT		;*******DEBUGGING CHECK. CURRENT
   755	000746'	256000	000000'		 STOPCD			;******IMPLEMENTATION ONLY ASKS MBIT.
   756	000747'	602640	000002		TRNE	P2,FBIT		;WANT TO SET F BIT?
   757	000750'	412406	000000		 ANDCAM	T3,(T1)		;YES, DO SO.
   758	000751'	602640	000001		TRNE	P2,MBIT		;WANT TO SET M BIT?
   759	000752'	412406	000400		 ANDCAM	T3,400(T1)	;YES, DO SO.
   760	000753'	363240	000766'		SOJLE	U,SSEFIN	;JUMP IF ALL DONE.
   761	000754'	242400	777777		LSH	T3,-1		;ELSE SHIFT MASK TO NEXT BIT.
   762	000755'	322400	000761'		JUMPE	T3,SSERC4	;JUMP IF RAN OFF END OF WORD.
   763				      ;LOOK AT NEXT BIT IN THE SAME WORD.
   764	000756'	616600	000010	SSER34:	TDNN	P1,T3		;IS THE BIT(PAIR) AVAIL?
   765	000757'	254000	000766'		  JRST	SSEFIN		;NO.
   766	000760'	254000	000742'		JRST	SSERC3		;YES, GO SET THEM AS REQUESTED.
   767				      ;HERE WHEN EO WORD.
   768	000761'	252300	000766'	SSERC4:	AOBJP	T1,SSEFIN	;JUMP IF NO MORE WORDS IN SAT.
   769	000762'	200606	000000		MOVE	P1,(T1)		;ELSE SET UP P1
   770	000763'	404606	000400		AND	P1,400(T1)	;TO THE AND OF THE F AND M BITS,
   771	000764'	515400	400000		HRLZI	T3,400000	;AND GET T3/ MASK OF FIRST BIT.
   772	000765'	254000	000756'		JRST	SSER34		;GO SEE IF THIS BIT PAIR AVAIL.
   773				      ;HERE WHEN DONE.
   774	000766'	554441	777777	SSEFIN:	HLRZ	T4,-1(P)	;GET
   775	000767'	275445	000000		SUBI	T4,(U)		;T4/
   776	000770'	323440	000772'		JUMPLE	T4,.+2		;DEBUGGING
   777	000771'	303440	000000*		CAILE	T4,NCTXPG	;CHECK.
   778	000772'	256000	000000'		 STOPCD
   779	000773'	213000	000011		MOVNS	T4		;-COUNT DONE.
   780	000774'	272447	000616*		ADDM	T4,STTFPC(T2)	;ADJUST THE FREE PAGE COUNT.
   781	000775'	335007	000774*		SKIPGE	STTFPC(T2)	;BETTER NOT HAVE GONE NEGATIVE.
   782	000776'	256000	000000'		 STOPCD (SLO)
   783	000777'	550241	777777		HRRZ	U,-1(P)		;Get saved Unit
   784	001000'	272445	000000*		ADDM	T4,UNITAL(U)	;Adjust free pages on unit
   785	001001'	550245	000634*		HRRZ	U,UNISTR(U)	;Get STR data block, U restored below
   786	001002'	272445	000537*		ADDM	T4,STRTAL(U)	;Adjust free pages on structure
   787	001003'	252300	001006'		AOBJP	T1,SSEFN1	;ADJUST
   788	001004'	252300	001006'		AOBJP	T1,SSEFN1	;"AOBJN"
   789	001005'	253300	001010'		AOBJN	T1,SSERC6	;UP THREE
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 9-3
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   790	001006'	400300	000000	SSEFN1:	SETZ	T1,		;WORDS.
   791	001007'	254000	001012'		JRST	SSRC6A
   792	001010'	620300	776000	SSERC6:	TRZ	T1,%SWP		;
   793	001011'	271300	377000		ADDI	T1,%SAT		;
   794	001012'	202307	000713*	SSRC6A:	MOVEM	T1,STTAOB(T2)	;STORE IT.
   795	001013'	261040	000011		PUSH	P,T4		;SAVE -COUNT DONE.
   796	001014'	260040	001047'		PUSHJ	P,GETPNO	;
   797	001015'	262040	000011		POP	P,T4		;
   798	001016'	262040	000010		POP	P,T3		;CREATE THE
   799	001017'	271350	000000		ADDI	T2,(T3)		;FIRST RETRIEVAL PNTR
   800	001020'	661340	000644*		TLO	T2,RBREAL	;IN T2.
   801	001021'	262040	000005		POP	P,U		;
   802	001022'	214400	000011		MOVM	T3,T4		;RETURN ALSO T3/ COUNT DONE.
   803	001023'	263040	000000		POPJ	P,		;
   804
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 10
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   805				COMMENT #
   806				@@SUBROUTINE GETSTT
   807				@@PURPOSE
   808				GIVEN A DISK POINTER, FIND THE ADDRESS OF ITS SAT'S STT ENTRY.
   809				@@ENTRY
   810				EXPECTS T2/ DISK POINTER.
   811				@@ACCUM
   812				DESTROYS T1, T2, T3, AND U.
   813				@@EXIT
   814				RETURNS T1/ STT ADDRESS, T2/ ADDRESS OF STT ENTRY, T3/ NO. OF PAGES INTO SAT, AND
   815				U/ UNIT DB.
   816				@@ #
   817
   818	001024'	135240	000406*	GETSTT::LDB	U,RBYUNI	;GET U/ UNIT.
   819	001025'	200245	000504*		MOVE	U,UNTTBL(U)	;
   820	001026'	135340	000410*		LDB	T2,RBYPNO	;T2/ PAGE NUMBER.
   821	001027'	231340	022000		IDIVI	T2,400*^D36	;CALC NO. OF THE SAT WE WANT.
   822	001030'	221340	000632*		IMULI	T2,STTLEN	;T2/ADDR OF SAT'S
   823	001031'	550305	000613*		HRRZ	T1,UNISTT(U)	;INFO IN
   824	001032'	271346	000000		ADDI	T2,(T1)		;STT.
   825	001033'	263040	000000		POPJ	P,
   826
   827
   828				COMMENT #
   829				@@SUBROUTINE GSATST
   830				@@PURPOSE
   831				GIVEN THE RET PNTR TO A SAT, FIND THE ADDRESS OF ITS STT ENTRY.
   832				@@ENTRY
   833				EXPECTS T2/ RET PNTR OF SAT.
   834				@@ACCUM
   835				DESTROYS T1, T2, AND U.
   836				@@EXIT
   837				RETURNS T2/ ADDRESS OF STT ENTRY AND U/ UNIT DDB.
   838				@@ #
   839
   840	001034'	135240	001024*	GSATST::LDB	U,RBYUNI	;GET U/ UNIT.
   841	001035'	200245	001025*		MOVE	U,UNTTBL(U)	;
   842	001036'	550305	001031*		HRRZ	T1,UNISTT(U)	;
   843	001037'	336006	000637*		SKIPN	STTPTR(T1)	;
   844	001040'	256000	000000'		 STOPCD (SLO)
   845	001041'	316346	001037*	GSATS2:	CAMN	T2,STTPTR(T1)	;
   846	001042'	254000	001045'		 JRST	GSATS4		;MATCH FOUND.
   847	001043'	271300	001030*		ADDI	T1,STTLEN	;NO, TRY NEXT ONE.
   848	001044'	254000	001041'		JRST	GSATS2		;
   849	001045'	200340	000006	GSATS4:	MOVE	T2,T1		;
   850	001046'	263040	000000		POPJ	P,
   851
   852
   853				COMMENT #
   854				@@SUBROUTINE GETPNO
   855				@@PURPOSE
   856				GIVEN AN STT ENTRY ADDRESS, FIND THE BASE DISK POINTER.
   857				@@ENTRY
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 10-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   858				EXPECTS T2/ STT ENTRY ADDRESS.
   859				@@ACCUM
   860				DESTROYS T1, T2, T3, AND T4.
   861				@@EXIT
   862				RETURNS T2/ BASE DISK POINTER.
   863				@@ #
   864
   865	001047'	261040	000007	GETPNO:	PUSH	P,T2		;SAVE THE STT ENTRY ADDRESS.
   866	001050'	200347	001041*		MOVE	T2,STTPTR(T2)	;GET THE
   867	001051'	135440	001034*		LDB	T4,RBYUNI	;UNIT.
   868	001052'	200311	001035*		MOVE	T1,UNTTBL(T4)	;
   869	001053'	550306	001036*		HRRZ	T1,UNISTT(T1)	;T2/ NO. OF
   870	001054'	262040	000007		POP	P,T2		;WORDS IN STT TABLE TO
   871	001055'	275346	000000		SUBI	T2,(T1)		;THE ENTRY.
   872	001056'	231340	001043*		IDIVI	T2,STTLEN	;T2/ SAT NO.
   873	001057'	221340	022000		IMULI	T2,400*^D36	;T2/ BASE PAGE NUMBER +
   874	001060'	137440	001051*		DPB	T4,RBYUNI	;UNIT = POINTER.
   875	001061'	263040	000000		POPJ	P,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 11
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   876				COMMENT #
   877				@@SUBROUTINE MOSPAU
   878				@@PURPOSE
   879				FIND THE UNIT WITH THE MOST FREE SPACE.
   880				@@ACCUM
   881				DESTROYS T1 AND T2 AND U.
   882				@@EXIT
   883				NON-SKIP RETURNS IF COMPLETELY OUT OF SPACE.
   884				SKIP RETURN WITH U/ UNIT DB ADDR FOR UNIT WITH MOST SPACE.
   885				@@ #
   886
   887				PRINTF(<[MOSPAU Most space on unit n - Needs STRucture DDB DRBSTR?]>)
   888	001062'	201300	000611*	MOSPAU:	MOVEI	T1,STRDDB	;Get right STRucture DDB
   889	001063'	554306	000612*		HLRZ	T1,STRUNI(T1)	;GET UNIT DB ADDR OF 1ST
   890	001064'	200346	001000*		MOVE	T2,UNITAL(T1)	;UNIT ON STR.  T2/ MAX
   891	001065'	200240	000006		MOVE	U,T1		;SPACE FOUND.  U/ WHERE FOUND.
   892	001066'	254000	001073'		JRST	MOSSP4		;
   893	001067'	311346	001064*	MOSSP2:	CAML	T2,UNITAL(T1)	;MORE SPACE ON THIS UNIT?
   894	001070'	254000	001073'		 JRST	MOSSP4		;NO.
   895	001071'	200346	001067*		MOVE	T2,UNITAL(T1)	;YES, REMEMBER
   896	001072'	201246	000000		MOVEI	U,(T1)		;IT.
   897	001073'	554306	001001*	MOSSP4:	HLRZ	T1,UNISTR(T1)	;CONTINUE IF
   898	001074'	326300	001067'		JUMPN	T1,MOSSP2	;ANOTHER UNIT.
   899	001075'	327340	000667*		JUMPG	T2,CPOPJ1	;OKAY IF SPACE.
   900	001076'	550305	001053*		HRRZ	T1,UNISTT(U)	;SEE IF ANY
   901	001077'	332006	000775*	MOSSP5:	SKIPE	STTFPC(T1)	;SPACE ON THIS UNIT.
   902	001100'	254000	001075*		 JRST	CPOPJ1		;YES.
   903	001101'	271300	001056*		ADDI	T1,STTLEN	;
   904	001102'	332006	001050*		SKIPE	STTPTR(T1)	;
   905	001103'	254000	001077'		 JRST	MOSSP5		;
   906	001104'	263040	000000		POPJ	P,		;
   907
   908
   909				COMMENT #
   910				@@SUBROUTINE LOKSAT
   911				@@PURPOSE
   912				SUBR TO GET A SAT AND SEE IF IT HAS ANY FREE PAGES.
   913				@@ENTRY
   914				EXPECTS T1/ DISK POINTER TO THE SAT, T2/ ADDRESS IN STT OF
   915				INFO ABOUT THE SAT.
   916				@@ACCUM
   917				DESTROYS T1.
   918				@@EXIT
   919				IF THE SAT HAS A FREE PAGE:  KEEP THE SAT AND SKIP RETURN.
   920				ELSE: RELEASE THE SAT AND NON-SKIP RETURN.
   921				@@#
   922
   923
   924	001105'	336007	001077*	LOKSAT:	SKIPN	STTFPC(T2)	;ATTEMPT TO AVOID MAPPING A BAD
   925	001106'	263040	000000		 POPJ	P,		;SAT, OR ONE WITH NO ROOM.
   926	001107'	261040	000011		PUSH	P,T4		;SAVE T4.
   927	001110'	261040	000010		PUSH	P,T3		;SAVE T3 AND
   928	001111'	261040	000007		PUSH	P,T2		;T2.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 11-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   929	001112'	201140	000640*		MOVEI	PG,%SAT.C	;GET
   930	001113'	260040	000000*		PUSHJ	P,MAPWTL	;THE SAT.
   931	001114'	200341	000000		MOVE	T2,(P)		;RESTORE ENTRY ADDRESS IN STT.
   932	001115'	336007	001105*		SKIPN	STTFPC(T2)	;ANY FREE PAGES IN THIS SAT?
   933	001116'	254000	001121'		 JRST	LOKST4		;NO.
   934	001117'	260040	001235'		PUSHJ	P,SATCHK	;CHECK SAT FOR CONSISTANCY AND PAGES FREE
   935	001120'	354001	777775		  AOSA	-3(P)		;YES, SKIP RETURN.
   936	001121'	260040	000323*	LOKST4:	 PUSHJ	P,MAPRLS	;NO OR BAD SAT. RELEASE THE SAT.
   937	001122'	262040	000007		POP	P,T2		;RESTORE T2
   938	001123'	262040	000010		POP	P,T3		;AND T3
   939	001124'	262040	000011		POP	P,T4		;AND T4.
   940	001125'	263040	000000	LOKSTB:	POPJ	P,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 12
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   941				COMMENT #
   942				@@SUBROUTINE LOKUNI
   943				@@PURPOSE
   944				SUBR TO SEE IF THERE IS ROOM ON ANY SAT FROM THE SAME UNIT.
   945				THE SATS CONSIDERED HERE ARE ALL IN CORE OR ALL.
   946				@@ENTRY
   947				EXPECTS U/ UNIT DDB AND T3/1 (LOOK AT INCORE SATS) OR 0 (LOOK
   948				AT ALL SATS.).
   949				@@ACCUM
   950				DESTROYS T1, T2, T3, AND T4.
   951				@@EXIT
   952				IF WE FIND ROOM, KEEP THAT SAT AND SKIP RETURN WITH T2/ STT
   953				ENTRY ADDRESS.  ELSE NON-SKIP RETURN.
   954				@@ #
   955
   956	001126'	261040	000014	LOKUNI:	PUSH	P,P1
   957	001127'	261040	000015		PUSH	P,P2
   958	001130'	550605	001076*		HRRZ	P1,UNISTT(U)	;GET ADDRESS OF STT TABLE.
   959	001131'	200640	000010		MOVE	P2,T3		;
   960	001132'	200340	000014	LOKUN1:	MOVE	T2,P1		;SET UP T2 FOR STY PNTRS.
   961	001133'	322640	001136'		JUMPE	P2,LOKUN2	;DEPENDING ON P2,
   962	001134'	135300	000620*		LDB	T1,STYINC	;LOOK ONLY AT IN CORE SATS OR
   963	001135'	322300	001151'		JUMPE	T1,LOKUN3	;AT ALL SATS.
   964	001136'	336014	001115*	LOKUN2:	SKIPN	STTFPC(P1)	;DON'T BOTHER TO LOOK AT BAD OR
   965	001137'	254000	001151'		 JRST	LOKUN3		;EMPTY SATS.
   966	001140'	200314	001102*		MOVE	T1,STTPTR(P1)	;THIS QUALIFIES, SO
   967	001141'	201140	001112*		MOVEI	PG,%SAT.C	;GO MAP
   968	001142'	260040	001113*		PUSHJ	P,MAPWTL	;WRITE LOCK IT.
   969	001143'	336014	001136*		SKIPN	STTFPC(P1)	;DOES IT STILL HAVE FREE PAGES?
   970	001144'	254000	001150'		 JRST	LOKU35		;NO.
   971	001145'	200340	000014		MOVE	T2,P1		;
   972	001146'	260040	001235'		PUSHJ	P,SATCHK	;YES, IS THE SAT GOOD?
   973	001147'	254000	001155'		  JRST	LOKUN4		;FOUND SPACE.
   974	001150'	260040	001121*	LOKU35:	PUSHJ	P,MAPRLS	;NO.  RELEASE IT.
   975	001151'	271600	001101*	LOKUN3:	ADDI	P1,STTLEN	;GO TO NEXT ENTRY.
   976	001152'	332014	001140*		SKIPE	STTPTR(P1)	;ANY NEXT ENTRY?
   977	001153'	254000	001132'		 JRST	LOKUN1		;YES, CONTINUE.
   978	001154'	254000	001156'		JRST	LOKUN5		;
   979	001155'	350001	777776	LOKUN4:	AOS	-2(P)		;FOUND SPACE.
   980	001156'	262040	000015	LOKUN5:	POP	P,P2		;
   981	001157'	262040	000014		POP	P,P1		;
   982	001160'	263040	000000		POPJ	P,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 13
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

   983				COMMENT #
   984				@@SUBROUTINE UPDACT/UPDAC0
   985				@@PURPOSE
   986				SUBRS TO UPDATE VARIOUS COUNTS WHEN ALLOCATING/DEALLOCATING A
   987				PAGE ON THE DISK.  UPDACT UPDATES UNITAL AND STRTAL, UPDAC0
   988				DOES NOT.
   989				@@ENTRY
   990				BOTH SUBRS EXPECTS U/ UNIT, T1/ +1 WHEN ALLOCATING, T1/ -1
   991				WHEN DEALLOCATING, T2/ EITHER 0,,ATB OR 0, ALSO IF THIS IS
   992				A REAL FILE, F/ DDB.  IN ADDITION,
   993				UPDAC0 EXPECTS IN T3 THE NEGATIVE OF THE CONTENTS OF T1.
   994				@@ACCUM
   995				DESTROYS T1, T2, T3, AND T4.
   996				@@ #
   997
   998	001161'	210400	000006	UPDACT:	MOVN	T3,T1		;
   999	001162'	272405	001071*		ADDM	T3,UNITAL(U)	;Adjust Unit
  1000	001163'	550305	001073*		HRRZ	T1,UNISTR(U)	; Get proper STRucture
  1001	001164'	272406	001002*		ADDM	T3,STRTAL(T1)	;Adjust Structure
  1002	001165'	210300	000010		MOVN	T1,T3		; Restore T1
  1003	001166'	603000	000000*	UPDAC0::TLNE	S,IOSALC	;
  1004	001167'	263040	000000		  POPJ	P,		;
  1005	001170'	322340	001174'	UPDAC2::JUMPE	T2,UPDCN1	;JUMP IF A REAL FILE WITHOUT AN ATB.
  1006	001171'	335007	000140*		SKIPGE	ATBDUM(T2)	;REAL FILE?
  1007	001172'	263040	000000		  POPJ	P,		;NO, DON'T TOUCH OTHER COUNTS.
  1008	001173'	272307	000000*		ADDM	T1,ATBALP(T2)	;YES, ADJUST ATBALP.
  1009	001174'	554344	000000*	UPDCN1:	HLRZ	T2,DEVDRB(F)	;
  1010	001175'	200447	000000*		MOVE	T4,DRBALC(T2)	;
  1011	001176'	273407	001175*		ADDB	T3,DRBALC(T2)	;
  1012	001177'	323440	001203'		JUMPLE	T4,UPDCN3	;WAS DRBALC ORIGINALLY POSITIVE
  1013	001200'	325300	001203'		JUMPGE	T1,UPDCN3	;AND T3 POS (T1 <=0)?
  1014	001201'	337007	001176*		SKIPG	DRBALC(T2)	;YES, MAYBE OVERFLOWED FROM
  1015	001202'	254000	001206'		JRST	UPDCN5		;POSITIVE TO NEGATIVE.
  1016	001203'	315407	000000*	UPDCN3:	CAMGE	T3,DRBMXA(T2)	;
  1017	001204'	202407	001203*		MOVEM	T3,DRBMXA(T2)	;
  1018	001205'	263040	000000		POPJ	P,
  1019
  1020	001206'	202447	001201*	UPDCN5:	MOVEM	T4,DRBALC(T2)	;
  1021	001207'	263040	000000		POPJ	P,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 14
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1022				COMMENT #
  1023				@@SUBROUTINE UPDADS
  1024				@@PURPOSE
  1025				SUBR TO UPDATE THE DISK COUNTS (STRTAL, UNITTAL, AND STTFPC)
  1026				WHEN DEALLOCATING A PAGE.  (CALLED FROM REMOVE.).
  1027				@@ENTRY
  1028				EXPECTS T2/ RETRIEVAL PNTR TO PAGE.
  1029				@@ACCUM
  1030				DESTROYS T1, T3, AND T4.
  1031				@@ #
  1032
  1033	001210'	261040	000007	UPDADS::PUSH	P,T2		;SAVE T2 AND
  1034	001211'	261040	000005		PUSH	P,U		;U.
  1035	001212'	260040	001024'		PUSHJ	P,GETSTT	;GET T2/ STT ENTRY ADDR AND
  1036	001213'	350007	001143*		AOS	STTFPC(T2)	;U/ UNIT DDB.
  1037	001214'	350005	001162*		AOS	UNITAL(U)	;
  1038	001215'	550245	001163*		HRRZ	U,UNISTR(U)	;U/ STRucture data block.
  1039	001216'	350005	001164*		AOS	STRTAL(U)	;
  1040	001217'	262040	000005		POP	P,U		;RESTORE U AND
  1041	001220'	262040	000007		POP	P,T2		;T2.
  1042	001221'	263040	000000		POPJ	P,
  1043
  1044				COMMENT ;@@SUBROUTINE DNDADS
  1045				@@PURPOSE TO DECREMENT STRTAL, STTFPC, AND UNITAL
  1046				FOR A FREE PAGE WE ARE ABOUT TO ALLOCATE. USED
  1047				WHEN PUTTING A FREE PAGE INTO BAT BLOCKS (HAPPENS
  1048				WHEN REMOVING A SUPER PAGE THAT HAS HAD AN ERROR)
  1049				@@ENTRY T2/RETRIEVAL POINTER TO PAGE
  1050				@@ACCUM USES T1,T3,T4
  1051				@@;
  1052
  1053	001222'	261040	000007	DNDADS::PUSH	P,T2		;SAVE POINTER
  1054	001223'	261040	000005		PUSH	P,U		;SAVE THIS, WILL BE UDB
  1055	001224'	260040	001024'		PUSHJ	P,GETSTT	;GET STT ENTRY IN T2, UNIT IN U
  1056	001225'	371007	001213*		SOSL	STTFPC(T2)	;ONE LESS PAGE IN THIS SAT.
  1057	001226'	375005	001214*		SOSGE	UNITAL(U)	;AND IN THIS UNIT
  1058	001227'	256000	000000'		 STOPCD (SLO)
  1059						;SOMETHING ISN'T RIGHT.
  1060	001230'	550245	001215*		HRRZ	U,UNISTR(U)	;TTHIS GETS STR DATA BLOCK.
  1061	001231'	370005	001216*		SOS	STRTAL(U)	;THIS CAN GO NEGATIVE LEGALLY.
  1062	001232'	262040	000005		POP	P,U		;RESTORE AND
  1063	001233'	262040	000007		POP	P,T2
  1064	001234'	263040	000000		POPJ	P,		;RETURN.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 15
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1065				COMMENT #
  1066				@@SUBROUTINE SATCHK
  1067				@@PURPOSE
  1068				SUBR TO CHECK THE GOODNESS OF A SAT WHICH HAS JUST BEEN LOCKED
  1069				INTO %SAT.
  1070				@@ENTRY
  1071				EXPECTS T2/ ADDR OF SAT ENTRY IN STT AND U/ UNIT DB.
  1072				@@ACCUM
  1073				DESTROYS T1, T3, AND T4.
  1074				@@EXIT
  1075				NON-SKIP RETURNS IF SAT IS OKAY, ELSE SKIP RETURNS.
  1076				@@ #
  1077
  1078	001235'	510307	000227*	SATCHK:	HLLZ	T1,STTSTS(T2)	;SKIP RETURN IF THE
  1079	001236'	603300	000230*		TLNE	T1,STPBAD	;SAT IS
  1080	001237'	254000	001100*		 JRST	CPOPJ1		;BAD.
  1081	001240'	603300	000000*		TLNE	T1,STPCHK	;ALL DONE IF SAT HAS ALREADY
  1082	001241'	263040	000000		 POPJ	P,		;BEEN CHECKED.
  1083	001242'	414300	377000		SWAPIN	T1,%SAT		;Force in the SAT by causing a page fault
  1084	001243'	205300	001240*		MOVSI	T1,STPCHK	;
  1085	001244'	436307	001235*		IORM	T1,STTSTS(T2)	;Mark it as being checked
  1086	001245'	260040	000000*		PUSHJ	P,GETER2	;Check for read errors
  1087	001246'	326300	001305'		  JUMPN	T1,SATMKR	;Mark read error on this SAT
  1088	001247'	261040	000007		PUSH	P,T2		;No read errors, check consistency
  1089	001250'	200300	001756'		MOVE	T1,[XWD -400,%SAT]
  1090	001251'	260040	001611'		PUSHJ	P,SATCNT	;Count number of available bits in SAT page
  1091	001252'	262040	000007		POP	P,T2		;Restore STT entry address
  1092	001253'	316447	001225*		CAMN	T4,STTFPC(T2)	;See if new count matches free page count
  1093	001254'	263040	000000		 POPJ	P,		;Success
  1094	001255'	254000	001302'		JRST	SATMKC		;Mark count error
  1095
  1096				COMMENT #
  1097				@@SUBROUTINE SSTCHK
  1098				@@PURPOSE
  1099				SUBR TO CHECK THE GOODNESS OF A SAT VIA %SWP.
  1100				ALSO SETS UPT SLOT FOR GOOD SATS.
  1101				GUARANTEED THAT SAT IS IN CORE AND THAT STYBAD IS NOT SET ON
  1102				ENTRY.
  1103				@@ENTRY
  1104				EXPECTS T2/ ADDR OF SAT ENTRY IN STT, U/ UNIT DB, AND PG/
  1105				CORE PAGE NUMBER.
  1106				@@ACCUM
  1107				DESTROYS T1, T3-T4, AND PG.
  1108				@@EXIT
  1109				NON-SKIP RETURNS IF SAT IS OKAY, ELSE SKIP RETURNS.
  1110				@@ #
  1111
  1112	001256'	510307	001244*	SSTCHK:	HLLZ	T1,STTSTS(T2)	;HAS THIS SAT ALREADY BEEN
  1113	001257'	663300	001243*		TLOE	T1,STPCHK	;CHECKED?
  1114	001260'	625300	001257*		 TLZA	T1,STPCHK	;YES, REMEMBER THAT BACKWARDS.
  1115	001261'	436307	001256*		IORM	T1,STTSTS(T2)	;WILL BE CHECKED NOW.
  1116	001262'	135400	000000*		LDB	T3,PGYERR	;
  1117	001263'	326400	001305'		JUMPN	T3,SATMKR	;Mark read error
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 15-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1118	001264'	201403	520000		MOVEI	T3,PGE.A!PGE.W!PGE.C(PG) ;SET
  1119	001265'	137400	002002'		DPB	T3,[EPTPTR(%SWP.N)] ;%SWP SLOT.
  1120	001266'	701100	776000		CLRPTO	%SWP
  1121	001267'	607300	001260*		TLNN	T1,STPCHK	;SAT ALREADY CHECKED?
  1122	001270'	263040	000000		 POPJ	P,		;YES.
  1123	001271'	261040	000007		PUSH	P,T2		;ELSE CHECK FOR CONSISTENCY.
  1124	001272'	200300	002003'		MOVE	T1,[XWD -400,%SWP]
  1125	001273'	260040	001611'		PUSHJ	P,SATCNT	;Count number of available bits
  1126	001274'	262040	000007		POP	P,T2		;RESTORE STT ENTRY ADDR.
  1127	001275'	316447	001253*		CAMN	T4,STTFPC(T2)	;Current count match expected count?
  1128	001276'	263040	000000		 POPJ	P,		;OK, nonskip for success
  1129	001277'	400300	000000		SETZ	T1,		;CLEAR THE
  1130	001300'	137300	002002'		DPB	T1,[EPTPTR(%SWP.N)] ;%SWP SLOT.
  1131	001301'	701100	776000		CLRPTO	%SWP
  1132					PFALL	SATMKC		;Mark count error
  1133
  1134				  ;Here when SAT fails count check
  1135	001302'	200407	001275*	SATMKC:	MOVE	T3,STTFPC(T2)	;Get free count
  1136	001303'	124400	001325'		DMOVEM	T3,BSAT34	;Store expected count and actual count
  1137	001304'	256000	002004'		 STOPCD (SATMRK,INFO,BADSAT,SATMK1,<SAT bit-count error>);;SATCHK+many
  1138
  1139				  ;Here when SAT fails read check
  1140	001305'	350000	000000*	SATMKR:	AOS	SATBRD		;Count bad reads
  1141	001306'	200407	001302*		MOVE	T3,STTFPC(T2)	;Get last known read count
  1142	001307'	201440	777777		MOVEI	T4,777777	;Fake new count
  1143	001310'	124400	001325'		DMOVEM	T3,BSAT34	;Store for SATMK1
  1144	001311'	260040	000000*		PUSHJ	P,DSKCLN##	;Need a FULL DSKCLN to rebuild SAT from scratch
  1145	001312'	256000	002010'		 STOPCD (SATMRK,INFO,REDSAT,SATMK1,<SAT read error>);;SATCHK+12
  1146
  1147				  ;Routine called from STOPCD(BADSAT) and STOPCD(REDSAT)
  1148	001313'	260040	000000*	SATMK1:	PUSHJ	P,PRTDDB##	;Output directory and file name F points to
  1149	001314'	260040	000000*		PUSHJ	P,CRLF##
  1150	001315'	265300	000000*		JSP	T1,BGCTYP##	;Output name and value pairs
  1151	001316'	636464	466043		 SIXBIT /STTFPC/
  1152	001317'	000000	001325'		  BSAT34+0		;Free page count
  1153	001320'	634164	435664		 SIXBIT /SATCNT/
  1154	001321'	000000	001326'		  BSAT34+1		;Actual count
  1155	001322'	634164	426244		 SIXBIT /SATBRD/
  1156	001323'	000000	001305*		  SATBRD		;Count of bad reads
  1157	001324'	000000	000000		   0			;End of list
  1158	001325'			BSAT34:	BLOCK	2	;Store expected count and actual count
  1159
  1160				  ;Here to mark a SAT as bad
  1161	001327'	205300	000000*	SATMRK:	MOVSI	T1,STPBAD!STPRPT;Mark SAT bad and needs report
  1162	001330'	436307	001261*		IORM	T1,STTSTS(T2)
  1163	001331'	400300	000000		SETZ	T1,
  1164	001332'	137300	001134*		DPB	T1,STYINC	;Not in core (try to read it again)
  1165	001333'	550405	001230*		HRRZ	T3,UNISTR(U)	;GET PROPER STRUCTURE
  1166	001334'	551300	000000*		HRRZI	T1,SRPRPT	;MARK STR NEEDS
  1167	001335'	436310	000000*		IORM	T1,STRBTS(T3)	; REPORT.
  1168	001336'	200307	001152*		MOVE	T1,STTPTR(T2)	;SET SATBAD TO
  1169	001337'	621300	000000*		TLZ	T1,RBMASK-RBREAL; THE FIRST
  1170	001340'	336000	000000*		SKIPN	SATBAD		; BAD
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 15-3
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1171	001341'	202300	001340*		 MOVEM	T1,SATBAD	; SAT.
  1172	001342'	205300	000000*		MOVSI	T1,UNPSER	;
  1173	001343'	272305	000000*		ADDM	T1,UNIMCT(U)	;
  1174	001344'	210307	001306*		MOVN	T1,STTFPC(T2)	;Free page count nonzero?
  1175	001345'	322300	001237*		JUMPE	T1,CPOPJ1
  1176	001346'	550405	001333*		HRRZ	T3,UNISTR(U)	;Point to STRDDB
  1177	001347'	272305	001226*		ADDM	T1,UNITAL(U)	;Reduce pages free on unit
  1178	001350'	272310	001231*		ADDM	T1,STRTAL(T3)	;Reduce pages free on structure (STRDDB+STRTAL)
  1179	001351'	402007	001344*		SETZM	STTFPC(T2)	;Mark this SAT as having no free pages
  1180	001352'	254000	001345*		JRST	CPOPJ1
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 16
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1181				COMMENT #
  1182				@@SUBROUTINE RPTSAT
  1183				@@PURPOSE
  1184				SUBR CALLED ONCE A SECOND, TO SEE IF THERE ARE ANY NEWLY
  1185				DISCOVERED BAD SATS TO REPORT TO THE OPER.
  1186				@@ENTRY
  1187				EXPECTS
  1188				@@ACCUM
  1189				DESTROYS T1, T2, AND T4.
  1190				@@ #
  1191
  1192	001353'	336000	001341*	RPTSAT::SKIPN	SATBAD		;ANY BAD SAT SEEN EVER?
  1193	001354'	263040	000000		 POPJ	P,		;NO.
  1194				PRINTF(<[RPTSAT+3++ Check-Clear STRBTS for bad SATs needs STRucture loop]>)
  1195	001355'	201300	001334*		MOVEI	T1,SRPRPT	;YES, ANY NEW ONES
  1196	001356'	616300	000000*		TDNN	T1,STRDDB+STRBTS;SEEN?
  1197	001357'	263040	000000		 POPJ	P,		;NO.
  1198	001360'	412300	000000*		ANDCAM	T1,STRDDB+STRBTS;YES.  CLEAR THE BIT.
  1199	001361'	261040	000005		PUSH	P,U		;
  1200	001362'	261040	000010		PUSH	P,T3		;
  1201	001363'	201240	001062*		MOVEI	U,STRDDB	;U/ STR DB
  1202	001364'	554245	001063*		HLRZ	U,STRUNI(U)	;U/ UNIT DB.
  1203	001365'	515340	000000*		HRLZI	T2,STPRPT	;T2/ MASK FOR STT REPORT BIT.
  1204	001366'	550405	001130*	RPTST1:	HRRZ	T3,UNISTT(U)	;LOOK THRU THIS UNIT'S SATS.
  1205				    ;LOOP FOR EACH SAT FOR THE UNIT.
  1206	001367'	336450	001336*	RPTST2:	SKIPN	T4,STTPTR(T3)	;ANOTHER SAT FOR THIS UNIT?
  1207	001370'	254000	001377'		 JRST	RPTST6		;NO.
  1208	001371'	616350	001330*		TDNN	T2,STTSTS(T3)	;YES, IS IT NEWLY BAD?
  1209	001372'	254000	001375'		 JRST	RPTST4		;NO.
  1210	001373'	412350	001371*		ANDCAM	T2,STTSTS(T3)	;YES, CLEAR ITS REPORT BIT.
  1211	001374'	260040	001404'		PUSHJ	P,CPLSAT	;REPORT THIS NEW BAD SAT.
  1212	001375'	271400	001151*	RPTST4:	ADDI	T3,STTLEN	;TRY FOR
  1213	001376'	254000	001367'		JRST	RPTST2		;ANOTHER SAT FOR THIS UNIT.
  1214	001377'	554245	001346*	RPTST6:	HLRZ	U,UNISTR(U)	;TRY FOR
  1215	001400'	326240	001366'		JUMPN	U,RPTST1	;ANOTHER UNIT ON THIS STR.
  1216	001401'	262040	000010		POP	P,T3		;FINISH
  1217	001402'	262040	000005		POP	P,U		;UP.
  1218	001403'	263040	000000		POPJ	P,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 17
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1219				COMMENT #
  1220				@@SUBROUTINE CPLSAT
  1221				@@PURPOSE
  1222				SUBROUTINE CALLED BY RPTSAT, TO COMPLAIN TO OPR AND CTY THAT
  1223				THERE IS A BAD SAT ON UNIT N AT PAGE M.
  1224				@@ENTRY
  1225				EXPECTS T4/ RETRIEVAL PNTR OF SAT AND U/ UNIT DB ADDR.
  1226				@@ACCUM
  1227				DESTROYS NO ACS.
  1228				@@ #
  1229
  1230	001404'	261040	000014	CPLSAT:	PUSH	P,P1		;
  1231	001405'	261040	000015		PUSH	P,P2		;
  1232	001406'	261040	000004		PUSH	P,F		;
  1233	001407'	261040	000006		PUSH	P,T1		;
  1234	001410'	261040	000007		PUSH	P,T2		;
  1235	001411'	261040	000010		PUSH	P,T3		;
  1236	001412'	261040	000011		PUSH	P,T4		;THIS MUST BE AT TOP-1 OF PDL.
  1237	001413'	261040	000005		PUSH	P,U		;THIS MUST BE AT TOP OF PDL.
  1238					MOVEI	T1,[ASCIZ/ ?
  1239	001414'	201300	002014'	? BAD SAT ON /]
  1240	001415'	260040	000000*		PUSHJ	P,DBLMSG	;
  1241				    ;NOW OUTPUT THE UNIT NAME.
  1242	001416'	550241	000000		HRRZ	U,(P)		;
  1243	001417'	200300	002020'		MOVE	T1,[POINT ^D6,UNINAM(U)] ;
  1244	001420'	200340	002021'		MOVE	T2,[POINT ^D7,P1] ;
  1245	001421'	403600	000015		SETZB	P1,P2		;
  1246	001422'	134400	000006	CPLST2:	ILDB	T3,T1		;GET SIX BIT CHAR.
  1247	001423'	322400	001427'		JUMPE	T3,CPLST3	;
  1248	001424'	271400	000040		ADDI	T3,40		;MAKE SEVEN BIT.
  1249	001425'	136400	000007		IDPB	T3,T2		;STORE IT.
  1250	001426'	254000	001422'		JRST	CPLST2		;
  1251	001427'	201300	000014	CPLST3:	MOVEI	T1,P1		;
  1252	001430'	260040	001415*		PUSHJ	P,DBLMSG	;
  1253	001431'	201300	002022'		MOVEI	T1,[ASCIZ/ AT PAGE /]
  1254	001432'	260040	001430*		PUSHJ	P,DBLMSG	;
  1255				    ;THEN OUTPUT THE PAGE NUMBER.
  1256	001433'	200341	777777		MOVE	T2,-1(P)	;GET T1/
  1257	001434'	135300	001026*		LDB	T1,RBYPNO	;PAGE NUMBER.
  1258	001435'	200400	002021'		MOVE	T3,[POINT ^D7,P1] ;BYTE PNTR TO P1 AND P2.
  1259	001436'	403600	000015		SETZB	P1,P2		;
  1260	001437'	260040	001441'		PUSHJ	P,CPLST4	;
  1261	001440'	254000	001451'		JRST	CPLST6		;
  1262	001441'	231300	000010	CPLST4:	IDIVI	T1,10		;
  1263	001442'	322300	001446'		JUMPE	T1,CPLST5	;
  1264	001443'	261040	000007		PUSH	P,T2		;
  1265	001444'	260040	001441'		PUSHJ	P,CPLST4	;
  1266	001445'	262040	000007		POP	P,T2		;
  1267	001446'	201347	000060	CPLST5:	MOVEI	T2,60(T2)	;
  1268	001447'	136340	000010		IDPB	T2,T3		;
  1269	001450'	263040	000000		POPJ	P,		;
  1270	001451'	201300	000014	CPLST6:	MOVEI	T1,P1
  1271	001452'	260040	001432*		PUSHJ	P,DBLMSG	;
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 17-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1272					MOVEI	T1,[ASCIZ/
  1273	001453'	201300	002024'	/]
  1274	001454'	260040	001452*		PUSHJ	P,DBLMSG	;FINISH UP WITH CRLF.
  1275	001455'	262040	000005		POP	P,U	
  1276	001456'	262040	000011		POP	P,T4		;
  1277	001457'	262040	000010		POP	P,T3		;
  1278	001460'	262040	000007		POP	P,T2		;
  1279	001461'	262040	000006		POP	P,T1		;
  1280	001462'	262040	000004		POP	P,F		;
  1281	001463'	262040	000015		POP	P,P2		;
  1282	001464'	262040	000014		POP	P,P1		;
  1283	001465'	263040	000000		POPJ	P,
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 18
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1284				COMMENT #
  1285				@@SUBROUTINE GIVPGK
  1286				@@PURPOSE
  1287				GIVPGK TURNS OFF THE F BIT FOR A DISK PAGE AND ADJUSTS SOME
  1288				COUNTS.  IT MAY OR MAY NOT
  1289				HAVE A SAT IN %SAT ON ENTRY.  IF IT DOES, IT CHECKS IT AND
  1290				RELEASES IT IF IT IS NOT THE RIGHT ONE.  THEN, IF NECESSARY,
  1291				IT GETS THE CORRECT SAT.
  1292				@@ENTRY
  1293				EXPECTS T2/ DISK POINTER AND F /DDB.
  1294				@@ACCUM
  1295				DESTROYS T1 THRU T4 AND PG.
  1296				@@ #
  1297
  1298	001466'	261040	000005	GIVPGK::PUSH	P,U		;SAVE U FROM FNDSBT.
  1299	001467'	201300	000000*		MOVEI	T1,MAPWTU	;
  1300	001470'	260040	001534'		PUSHJ	P,FNDSBT	;GET SAT, FIND BIT LOC.
  1301	001471'	254000	001505'		  JRST	GIVPG6		;BAD SAT.
  1302	001472'	612310	377000		TDNE	T1,%SAT+FBITS(T3);F BIT BETTER BE ON.
  1303	001473'	256000	002025'		 STOPCD (.,DISK,GIVPG1,,<Error in GIVPGK - F bit is not on>);;GIVPGK+5
  1304	001474'	436310	377000		IORM	T1,%SAT+FBITS(T3);TURN THE F BIT OFF.
  1305	001475'	616310	377400		TDNN	T1,%SAT+MBITS(T3);IS THE M BIT OFF?
  1306	001476'	254000	001505'		 JRST	GIVPG6		;NO.
  1307	001477'	350007	001351*		AOS	STTFPC(T2)	;ONE MORE PAGE IS FREE.
  1308	001500'	474300	000000		SETO	T1,		;UPDATE ALL
  1309	001501'	550344	000000*		HRRZ	T2,DEVATB(F)	;T2/ ATB OR ZERO FOR UPDACT.
  1310	001502'	260040	001161'		PUSHJ	P,UPDACT	;THE COUNTS.
  1311	001503'	262040	000005		POP	P,U		;RESTORE U.
  1312	001504'	263040	000000		POPJ	P,		;RETURN.
  1313
  1314				      ;HERE IF SAT IS BAD, JUST ADJUST A FEW COUNTS.
  1315	001505'	474300	000000	GIVPG6:	SETO	T1,		;UPDATE JUST
  1316	001506'	201400	000001		MOVEI	T3,1		;A FEW
  1317	001507'	550344	001501*		HRRZ	T2,DEVATB(F)	;T2/ ATB OR ZERO FOR UPDAC0.
  1318	001510'	260040	001166'		PUSHJ	P,UPDAC0	;COUNTS.
  1319	001511'	262040	000005		POP	P,U		;RESTORE U.
  1320	001512'	263040	000000		POPJ	P,		;RETURN.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 19
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1321				COMMENT ;@@SUBROUTINE FRMGVP
  1322				@@PURPOSE DEALLOCATE A DISK PAGE WHICH HAS BEEN ALLOCATED
  1323				WITH JUST THE M BIT ON. CALLED BY ERROR CODE IN CREFRM UUO
  1324				WHEN COULDN'T ALLOCATE ALL THE CONTEXT PAGES FOR A NEW JOB.
  1325				@@ENTRY T2/RBREAL+PAGE TO DEALLOCATE (F MUST BE OFF, M MUST BE ON)
  1326				@@ACCUM T1-T4, PG
  1327				@@EXIT ALWAYS NON-SKIP
  1328				RETURNS WITH SAT IN %SAT - CALLER MUST CALL RELSAT AFTER FINISHED CALLING FRMGVP.
  1329				@@;
  1330
  1331				EXTERNAL ADRDUM
  1332
  1333	001513'	316340	000000*	FRMGVP::CAMN	T2,ADRDUM	;IF ITS A DUMMY DISK PAGE,
  1334	001514'	263040	000000		 POPJ	P,		;JUST RETURN.
  1335	001515'	261040	000005		PUSH	P,U		;REAL WORK TO DO, SAVE U
  1336	001516'	201300	001467*		MOVEI	T1,MAPWTU	;GET SAT WRITE UNLOCKED
  1337	001517'	260040	001534'		PUSHJ	P,FNDSBT	;GET SAT, FIND BIT LOC.
  1338	001520'	254000	001532'		  JRST	FRMGVB		;BAD SAT, LEAVE COUNTS DOWN AND RETURN.
  1339	001521'	616310	377000		TDNN	T1,%SAT+FBITS(T3);F BIT HAS TO BE OFF
  1340	001522'	256000	000000'		 STOPCD (SLO)
  1341						;CALLER MUST HAVE GIVEN WRONG PAGE
  1342	001523'	612310	377400		TDNE	T1,%SAT+MBITS(T3);MAKE SURE M BIT WAS ALREADY ON
  1343	001524'	256000	000000'		 STOPCD (SLO)
  1344						;WAS OFF ALREADY, FOO.
  1345	001525'	436310	377400		IORM	T1,%SAT+MBITS(T3);OK, WAS ON, TURN IT OFF (SET TO 1)
  1346	001526'	350007	001477*		AOS	STTFPC(T2)	;ONE MORE FREE PAGE IN THIS SAT
  1347	001527'	350005	001347*		AOS	UNITAL(U)	;ONE MORE PAGE ON THE UNIT
  1348	001530'	550245	001377*		HRRZ	U,UNISTR(U)	;SELECT RIGHT STRUCTURE
  1349	001531'	350005	001350*		AOS	STRTAL(U)	;AND ONE MORE ON THE STRUCTURE
  1350	001532'	262040	000005	FRMGVB:	POP	P,U		;RESTORE U FOR CALLER
  1351	001533'	263040	000000		POPJ	P,		;DONE.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 20
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1352				COMMENT #
  1353				@@SUBROUTINE FNDSBT
  1354				@@PURPOSE
  1355				SUBR TO GET A SAT FOR A GIVEN DISK POINTER, AND THEN SET UP
  1356				T1/ MASK FOR THAT PAGE'S F BIT, U/ UNIT DB, AND T3/ NO. OF
  1357				PAGES INTO THE SAT OF THE F BIT.  ALSO T2/ STT ENTRY ADDRESS.
  1358				@@ENTRY
  1359				EXPECTS T2/ DISK RET PNTR AND T1/ ADDRESS OF A MAP ROUTINE.
  1360				(DOES NOT CHANGE THE LOCKING IF IT ALREADY HAS THE
  1361				CORRECT SAT.).
  1362				@@ACCUM
  1363				DESTROYS T1-T4, PG, AND U.
  1364				@@EXIT
  1365				SEE PURPOSE.
  1366				NON-SKIP RETURNS IF SAT IS BAD, WITH T4/ DISK ADDRESS OF
  1367				SAT.  ELSE SKIP RETURNS WITH T1, T2, T3, AND U SET UP.
  1368				@@ #
  1369
  1370	001534'	322340	001536'	FNDSBT:	JUMPE	T2,.+2		;CHECK THE RET PNTR
  1371	001535'	607340	001020*		TLNN	T2,RBREAL	;A LITTLE.
  1372	001536'	256000	000000'		 STOPCD
  1373	001537'	261040	000006		PUSH	P,T1		;SAVE MAP ROUTINE ADDR.
  1374	001540'	260040	001024'		PUSHJ	P,GETSTT	;GET T2/ STT ENTRY ADDR & T3/ #
  1375	001541'	550320	000000*		HRRZ	T1,@%SAT.C+%CTUPT ;OF PAGES INTO SAT.  JUMP
  1376	001542'	322300	001561'		JUMPE	T1,FNDSB2	;UNLESS ALREADY HAVE A SAT.
  1377	001543'	200306	000647*		MOVE	T1,PCBPTR(T1)	;IS THE SAT THAT WE HAVE, THE
  1378	001544'	200447	001367*		MOVE	T4,STTPTR(T2)	;SAT THAT WE
  1379	001545'	312300	000011		CAME	T1,T4		;WANT?
  1380	001546'	254000	001553'		 JRST	FNDSB1		;NO.
  1381	001547'	262040	000006		POP	P,T1		;YES.  CLEAR PDL.
  1382	001550'	135300	000000*		LDB	T1,STYBAD	;IS IT BAD?
  1383	001551'	326300	000000*		JUMPN	T1,CPOPJ	;JUMP IF BAD.
  1384	001552'	254000	001602'		JRST	FNDSB5		;NO, EASY.
  1385
  1386				      ;HERE TO RELEASE THE CURRENT SAT.
  1387	001553'	201140	001141*	FNDSB1:	MOVEI	PG,%SAT.C	;RELEASE
  1388	001554'	261040	000010		PUSH	P,T3		;
  1389	001555'	261040	000007		PUSH	P,T2		;
  1390	001556'	260040	001150*		PUSHJ	P,MAPRLS	;IT.
  1391	001557'	262040	000007		POP	P,T2		;
  1392	001560'	262040	000010		POP	P,T3		;
  1393				      ;HERE TO GET A NEW SAT.
  1394	001561'	262040	000011	FNDSB2:	POP	P,T4		;T4/ MAP ROUTINE ADDR.
  1395	001562'	135300	001550*		LDB	T1,STYBAD	;IS THE SAT WE WANT BAD?
  1396	001563'	326300	001576'		JUMPN	T1,FNDBAD	;JUMP IF BAD.
  1397	001564'	201140	001553*		MOVEI	PG,%SAT.C	;THE
  1398	001565'	200307	001544*		MOVE	T1,STTPTR(T2)	;SAT
  1399	001566'	261040	000010		PUSH	P,T3		;MAY BE
  1400	001567'	261040	000007		PUSH	P,T2		;GOOD,
  1401	001570'	260051	000000		PUSHJ	P,(T4)		;SO GET IT.
  1402	001571'	200341	000000		MOVE	T2,(P)		;CHECK
  1403	001572'	260040	001235'		PUSHJ	P,SATCHK	;THE SAT.
  1404	001573'	254000	001600'		 JRST	FNDSB4		;OKAY.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 20-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1405	001574'	262040	000007		POP	P,T2		;BAD.
  1406	001575'	262040	000010		POP	P,T3		;
  1407	001576'	200447	001565*	FNDBAD:	MOVE	T4,STTPTR(T2)	;SET T4/ BAD SAT'S ADDRESS.
  1408	001577'	263040	000000		POPJ	P,		;
  1409	001600'	262040	000007	FNDSB4:	POP	P,T2		;GOOD SAT.
  1410	001601'	262040	000010		POP	P,T3		;
  1411
  1412				    ;HERE WITH OUR GOOD SAT.
  1413	001602'	231400	000044	FNDSB5:	IDIVI	T3,^D36		;GET T3/ NO. OF WORDS INTO SAT,
  1414	001603'	213000	000011		MOVNS	T4		;AND
  1415	001604'	205300	400000		MOVSI	T1,400000	;T1/
  1416	001605'	242311	000000		LSH	T1,(T4)		;MASK FOR F BIT.
  1417	001606'	254000	001352*		JRST	CPOPJ1		;
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 21
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1418				COMMENT #
  1419				@@SUBROUTINE GIVPAG
  1420				@@PURPOSE
  1421				GIVPAG IS A "STAND ALONE" SUBR TO TURN OFF A PAGE'S F BIT.
  1422				IT GETS AND RELEASES THE SAT.
  1423				@@ENTRY
  1424				EXPECTS T2/ DISK POINTER AND F/ DDB.
  1425				@@ACCUM DESTROYS
  1426				@@ #
  1427
  1428	001607'	260040	001466'	GIVPAG::PUSHJ	P,GIVPGK	;
  1429	001610'	324740	000000*		PJRST	RELSAT
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 22
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1430				COMMENT #
  1431				@@SUBROUTINE SATCNT
  1432				@@PURPOSE
  1433				SUBR TO COUNT THE NUMBER OF AVAILABLE BIT PAIRS IN A SAT.
  1434				@@ENTRY EXPECTS T1/ AOBJN POINTER TO THE SAT (-400,,addr)
  1435				@@ACCUM
  1436				DESTROYS T1, T2, T3, AND T4.
  1437				@@EXIT
  1438				RETURNS COUNT IN T4.
  1439				@@ #
  1440
  1441
  1442	001611'	400440	000000	SATCNT::SETZ	T4,		;COUNT IS RETURNED IN T4.
  1443	001612'	332346	000000	SATCT2:	SKIPE	T2,(T1)		;IS THE WORD ENTIRELY ZERO?
  1444	001613'	254000	001616'		 JRST	SATCT3		;NO.
  1445	001614'	253300	001612'		AOBJN	T1,SATCT2	;YES.
  1446	001615'	263040	000000		POPJ	P,
  1447	001616'	404346	000400	SATCT3:	AND	T2,400(T1)	;F bit and M bit must both be on to count
  1448	001617'	332000	000007		SKIPE	T2
  1449	001620'	243340	001623'	SATC34:	 JFFO	T2,SATCT4	;GET T3/ NO. OF LEADING ZEROES.
  1450	001621'	253300	001612'		AOBJN	T1,SATCT2
  1451	001622'	263040	000000		POPJ	P,
  1452	001623'	242350	000001	SATCT4:	LSH	T2,1(T3)	;SHIFT OFF THAT BIT.
  1453	001624'	344440	001620'		AOJA	T4,SATC34	;INC COUNT OF SET BITS
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 23
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1454				COMMENT #
  1455				@@SUBROUTINE GETSAT
  1456				@@PURPOSE
  1457				SUBR TO GET INTO %SAT THE SAT FOR THE PAGE SPECIFIED BY THE
  1458				RETRIEVAL PNTR IN T2.  (N.B., T2 HAS THE ADDRESS OF SOME
  1459				PAGE IN THE SAT, NOT THE ADDRESS OF THE SAT ITSELF.).
  1460				SAT WILL BE LOCKED ACCORDING TO T1 UNLESS IT IS ALREADY IN %SAT.
  1461				(MAY OR MAY NOT BE A SAT IN %SAT ON ENTRY.).
  1462				@@ENTRY
  1463				EXPECTS T2/ RETRIEVAL PNTR (RBMASK-RBREAL OFF) AND T1/ ADDR OF A MAP
  1464				ROUTINE (MAPCML, ETC.).
  1465				@@ACCUM
  1466				DESTROYS T1, T3, T4, AND PG.
  1467				@@EXIT
  1468				ON SUCCESS RETURN, SKIP RETURNS AND RETURNS MASK FOR F BIT IN
  1469				T1 AND NO. OF WORDS INTO %SAT OF WORD WITH F BIT IN T3.  HAS
  1470				SAT IN %SAT.
  1471				ON FAIL RETURN, NON-SKIPS AND RETURNS RETRIEVAL PNTR TO BAD
  1472				SAT IN T4.  DOES NOT HAVE SAT.
  1473				@@ #
  1474
  1475	001625'	261040	000007	GETSAT::PUSH	P,T2		;SAVE T2 AND
  1476	001626'	261040	000005		PUSH	P,U		;U.
  1477	001627'	260040	001534'		PUSHJ	P,FNDSBT	;THIS DOES ALL THE WORK.
  1478	001630'	370001	777776		  SOS	-2(P)		;TAKE ERROR RETURN.
  1479	001631'	262040	000005		POP	P,U		;RESTORE U AND
  1480	001632'	262040	000007		POP	P,T2		;T2.
  1481	001633'	254000	001606*		JRST	CPOPJ1		;
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 24
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1482				COMMENT #
  1483				@@SUBROUTINE FPCSET
  1484				@@PURPOSE
  1485				SUBR FOR USE BY DSKCLN'S UUO, TO SET STTFPC FOR ALL SATS
  1486				ON ALL UNITS.
  1487				@@ENTRY
  1488				EXPECTS T1/ ADDR OF AC CONTAINING AOBJN PNTR OF THE FORM
  1489				-NO. OF ARGS,,ADDR OF FIRST ARG.
  1490				@@ACCUM
  1491				DESTROYS T1 THRU T4.
  1492				@@EXIT
  1493				NON-SKIP RETURNS IF NOT THE RIGHT NO. OF VALUES SENT OR IF NO
  1494				UNITS IN STRUCTURE.
  1495				ELSE, SKIP RETURNS.
  1496				@@ #
  1497
  1498				    ;FIRST, BE SURE WE HAVE BEEN GIVEN THE CORRECT NO. OF ARGS.
  1499	001634'	200440	000000*	FPCSET::MOVE	T4,%SAT.C+%CTLST ;DEBUGGING CHECK
  1500	001635'	332011	000000		SKIPE	(T4)		;FOR DSKCLN.
  1501	001636'	256000	000000'		 STOPCD
  1502	001637'	261040	000005		PUSH	P,U		;SAVE U.
  1503	001640'	256200	002030'		UMOVE	T1,(T1)		;GET T1/ AOBJN PNTR.
  1504				PRINTF(<[FPCSET Another DSKCLN UUO routine needs STR setup right]>)
  1505	001641'	201240	001363*		MOVEI	U,STRDDB	;GET U/STR DB (Only one for now)
  1506	001642'	554245	001364*		HLRZ	U,STRUNI(U)	;BETTER BE AT LEAST ONE
  1507	001643'	322240	001721'		JUMPE	U,FPCPOP	;UNIT IN THE STR.
  1508	001644'	400440	000000		SETZ	T4,		;COUNT
  1509	001645'	135400	000000*	FPCSTA:	LDB	T3,UNYSPU	;THE NUMBER
  1510	001646'	274440	000010		SUB	T4,T3		;OF SATS ON ALL
  1511	001647'	554245	001530*		HLRZ	U,UNISTR(U)	;UNITS IN
  1512	001650'	326240	001645'		JUMPN	U,FPCSTA	;THE STRUCTURE.
  1513	001651'	574400	000006		HLRE	T3,T1		;GET NO. OF ARGS USER HAS SENT.
  1514	001652'	312400	000011		CAME	T3,T4		;DO THEY MATCH?
  1515	001653'	254000	001721'		 JRST	FPCPOP		;NO, ERROR RETURN.
  1516
  1517				    ;SET THE STTFPC ENTRIES.
  1518	001654'	201240	001641*		MOVEI	U,STRDDB	;U/ STR (Needs setup as above)
  1519	001655'	402005	001531*		SETZM	STRTAL(U)	; Clear total pages on STR
  1520	001656'	554245	001642*		HLRZ	U,STRUNI(U)	;U/ UNIT.
  1521	001657'	402005	001527*	FPCST3:	SETZM	UNITAL(U)	; Clear total pages on Unit
  1522	001660'	550345	001366*		HRRZ	T2,UNISTT(U)	;T2/ STT ENTRY ADDR.
  1523	001661'	332007	001576*	FPCST4:	SKIPE	STTPTR(T2)	;AT END OF THIS UNIT'S STT?
  1524	001662'	254000	001705'		 JRST	FPCST6		;NO.
  1525	001663'	261040	000006	FPCST5:	PUSH	P,T1		;
  1526	001664'	200305	000411*		MOVE	T1,UNIPPU(U)	;CALCULATE SAFETY FACTOR.
  1527	001665'	261040	000007		PUSH	P,T2		;
  1528	001666'	231300	000000*		IDIVI	T1,UNVRSF	;
  1529	001667'	262040	000007		POP	P,T2		;
  1530	001670'	135440	001645*		LDB	T4,UNYSPU	;
  1531	001671'	221311	000000		IMULI	T1,(T4)		;
  1532	001672'	213000	000006		MOVNS	T1		;
  1533	001673'	273305	001657*		ADDB	T1,UNITAL(U)	;
  1534	001674'	550445	001647*		HRRZ	T4,UNISTR(U)	;Get STR block for this unit
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 24-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1535	001675'	325300	001700'		JUMPGE	T1,FPCS6A	;
  1536	001676'	402005	001673*		SETZM	UNITAL(U)	;
  1537	001677'	334000	000000		SKIPA			;
  1538	001700'	272311	001655*	FPCS6A:	ADDM	T1,STRTAL(T4)	;Adjust STR for safety factor
  1539	001701'	262040	000006		POP	P,T1		;
  1540	001702'	554245	001674*		HLRZ	U,UNISTR(U)	;YES, GO TO
  1541	001703'	326240	001657'		JUMPN	U,FPCST3	;NEXT UNIT.
  1542	001704'	254000	001713'		JRST	FPCPP0
  1543	001705'	256200	002031'	FPCST6:	UMOVE	T3,(T1)		;GET USER'S ARG, AND
  1544	001706'	202407	001526*		MOVEM	T3,STTFPC(T2)	;STORE IT IN STTFPC.
  1545	001707'	272405	001676*		ADDM	T3,UNITAL(U)	;
  1546	001710'	271340	001375*		ADDI	T2,STTLEN	;
  1547	001711'	253300	001661'		AOBJN	T1,FPCST4	;
  1548	001712'	254000	001663'		JRST	FPCST5		;
  1549	001713'	350001	777777	FPCPP0:	AOS	-1(P)		;SUCCESS RETURN.
  1550	001714'	201240	001654*		MOVEI	U,STRDDB	;Get STR block (Needs setup as above)
  1551	001715'	201300	000447*		MOVEI	T1,SRPNDS	;CLEAR THE NEED DSKCLN FLAG
  1552	001716'	412305	001335*		ANDCAM	T1,STRBTS(U)	;FOR THIS STR.
  1553	001717'	332000	000000*		SKIPE	DFRLST		;DEBUGGING CHECK.
  1554	001720'	256000	000000'		 STOPCD
  1555	001721'	262040	000005	FPCPOP:	POP	P,U		;RESTORE U.
  1556	001722'	263040	000000		POPJ	P,		;RETURN.
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 25
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1557				COMMENT #
  1558				@@SUBROUTINE CHKQTA
  1559				@@PURPOSE
  1560				SUBR TO SEE IF THE USER CAN ALLOCATE ONE DISK PAGE.
  1561				@@ENTRY
  1562				EXPECTS F/ DDB.
  1563				@@ACCUM
  1564				DESTROYS T1 AND T4.
  1565				@@EXIT
  1566				SKIP RETURNS IF OKAY TO GET A PAGE.
  1567				ELSE NON-SKIP RETURNS.
  1568				@@ #
  1569
  1570				PRINTF(<[CHKQTA needs STR data block setup - F/DDB already for DRBSTR?]>)
  1571	001723'	201440	001714*	CHKQTA::MOVEI	T4,STRDDB	;STR data block address
  1572	001724'	337011	001700*		SKIPG	STRTAL(T4)	;Any room on STR?
  1573	001725'	254000	001743'		 JRST	ERRFUL
  1574	001726'	336444	000342*		SKIPN	T4,DEV1UN(F)	;SPECIAL UNIT STUFF?
  1575	001727'	254000	001732'		 JRST	CKQOT3		;NO.
  1576	001730'	337011	001707*		SKIPG	UNITAL(T4)	;YES.  ROOM LEFT ON UNIT?
  1577	001731'	254000	001743'		 JRST	ERRFUL		;NO.
  1578	001732'	554444	001174*	CKQOT3:	HLRZ	T4,DEVDRB(F)	;CHECK AGAINST QUOTA
  1579	001733'	200311	001206*		MOVE	T1,DRBALC(T4)
  1580	001734'	301300	000001		CAIL	T1,1		;BELOW QUOTA?
  1581	001735'	254000	001633*		 JRST	CPOPJ1		;YES. OKAY.
  1582	001736'	201440	001723*		MOVEI	T4,STRDDB	;Get STR Pointer
  1583				;;*;;	HRRZ	T4,DRBSTR(T4)	;Get STR PTR (or will this be STR name?)
  1584								; (I choose PTR since STRNAM(PTR) works)
  1585	001737'	274311	000000*		SUB	T1,STROVR(T4)	;CHK MAX OVRDRW ALLOWED IN STR.
  1586	001740'	323300	001743'		JUMPLE	T1,ERRFUL	;
  1587	001741'	254000	001735*		JRST	CPOPJ1		;
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 26
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1588				COMMENT #
  1589				@@SUBROUTINE ERRFUL/ERRBDR/ERRIMP
  1590				@@PURPOSE
  1591				SUBRS TO SET AN ERROR FLAG IN S AND STORE S IN DEVIOS.
  1592				@@ #
  1593
  1594	001742'	664000	100000	ERRBDR::TROA	S,IODTER	;ANY BIT IN A STORM.
  1595	001743'	660000	040000	ERRFUL:: TRO	S,IOBKTL
  1596	001744'	324740	000000*		PJRST	STOIOS##
  1597
  1598	001745'	660000	400000	ERRIMP::TRO	S,IOIMPM
  1599	001746'	324740	001744*		PJRST	STOIOS##
  1600
  1601	001747'	777777	777777		$END	(SWP)

  1602	001750'	000000	000000

  1603	001751'	260040	001024'

  1604	001752'	254000	000051'

  1605	001753'	262040	000010

  1606	001754'	254000	000243'

  1607	001755'	000000	000110'

  1608	001756'	777400	377000

  1609	001757'	260040	000000*

  1610	001760'	634541	622124

  1611	001761'	000010	000000

  1612	001762'	400300	000000

  1613	001763'	263040	000000

  1614	001764'	400600	000000

  1615	001765'	260040	001024'

  1616	001766'	254000	000420'

  1617	001767'	260040	001757*

  1618	001770'	476463	416021

  1619	001771'	000001	000000

  1620	001772'	260040	001767*

SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 26-2
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.

  1621	001773'	476463	412423

  1622	001774'	000010	000000

  1623	001775'	201600	000001

  1624	001776'	254000	000477'

  1625	001777'	000002	000002

  1626	002000'	262040	000007

  1627	002001'	254000	000713'

  1628	002002'	222200	000377*

  1629	002003'	777400	776000

  1630	002004'	260040	000000*

  1631	002005'	424144	634164

  1632	002006'	400005	001327'

  1633	002007'	000000	001313'

  1634	002010'	260040	002004*

  1635	002011'	624544	634164

  1636	002012'	400005	001327'

  1637	002013'	000000	001313'

  1638	002014'	201761	505176

  1639	002015'	202050	142100

  1640	002016'	516032	420236

  1641	002017'	471000	000000

  1642	002020'	440605	000000*

  1643	002021'	440700	000014

  1644	002022'	202032	420240

  1645	002023'	406170	520000

  1646	002024'	064240	000000

  1647	002025'	260040	001772*
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 26-3
SWAMP.MAC	 9-OCT-87 17:35		DISK ALLOCATION AND DEALLOCATION.


  1648	002026'	475166	604721

  1649	002027'	000010	000000

  1650	002030'	200306	000000

  1651	002031'	200406	000000

  1652						;End of SWAMPR (SWPLIT: SWPEND:)
  1653
NO ERRORS DETECTED
PROGRAM BREAK IS 002032
7K CORE USED
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 27
SWAMP.MAC	 9-OCT-87 17:35		SYMBOL TABLE

ADRDUM		001513'	EXT	FPCSTA		001645'		GTSA77		000637'		PCBSTS		000000	EXT
ATBALP		001173'	EXT	FRMGVB		001532'		GTSAP0		000467'		PCISTS		000654'	EXT
ATBDUM		001171'	EXT	FRMGVP		001513'	INT	GTSAP1		000476'	INT	PCMLCC		000516'	EXT
BADSAT		001304'	INT	GETA00		000125'		GTSAP4		000501'		PG		000003	INT
BGCTYP		001315'	EXT	GETA01		000142'		GTSAP5		000542'		PGE.A		400000	SIN
BSAT34		001325'		GETA51		000162'		GTSAP7		000570'		PGE.C		020000	SIN
CHKQTA		001723'	INT	GETA62		000173'		GTSAPG		000447'	INT	PGE.W		100000	SIN
CKQOT3		001732'		GETA65		000205'		GTSP0A		000472'		PGYDRT		000555'	EXT
CLRPT	701100	000000		GETA66		000212'		GTSP2A		000425'		PGYERR		001262'	EXT
CPLSAT		001404'		GETA69		000220'		GTSP3A		000433'		PJRST	324740	000000	
CPLST2		001422'		GETA82		000227'		GTSPAG		000362'	INT	PPCBIO		000656'	EXT
CPLST3		001427'		GETA83		000237'		GTSPG2		000420'		PRNAME		000000	EXT
CPLST4		001441'		GETAP0		000144'		GTSPG3		000432'		PRTDDB		001313'	EXT
CPLST5		001446'		GETAP5		000157'		GTSPG4		000440'		PSREQ		000605'	EXT
CPLST6		001451'		GETAP6		000167'		GTSWAT		000660'		PX.MEM		000004	SPD
CPOPJ		001551'	EXT	GETAP8		000226'		GTSWIN		000663'		PXCT	256000	000000	
CPOPJ1		001741'	EXT	GETAPG		000117'	INT	INLMES		000000	EXT	RBMASK		000000	EXT
CRLF		001314'	EXT	GETER2		001245'	EXT	IOBKTL		040000	SIN	RBREAL		001535'	EXT
CURUPT		000000	EXT	GETFAL		000352'		IODTER		100000	SIN	RBSPAR		000000	EXT
DBLMSG		001454'	EXT	GETLRS		000641'	EXT	IOIMPM		400000	SIN	RBYPNO		001434'	EXT
DEV1UN		001726'	EXT	GETP24		000061'		IOSALC		001166'	EXT	RBYUN1		000503'	EXT
DEVATB		001507'	EXT	GETP25		000065'		ISCYLB		000003'	INT	RBYUNI		001060'	EXT
DEVDRB		001732'	EXT	GETP26		000070'		JBYWPT		000000	EXT	REDSAT		001312'	INT
DFRLST		001717'	EXT	GETPA0		000023'		KEPPAG		000006'	INT	RELSAT		001610'	EXT
DIE		002025'	EXT	GETPAG		000014'	INT	LOKSAT		001105'		RPTSAT		001353'	INT
DNDADS		001222'	INT	GETPG1		000051'		LOKST4		001121'		RPTST1		001366'	
DRBALC		001733'	EXT	GETPG2		000055'		LOKSTB		001125'		RPTST2		001367'	
DRBMXA		001204'	EXT	GETPG4		000104'		LOKU35		001150'		RPTST4		001375'	
DSKCLN		001311'	EXT	GETPGU		000342'		LOKUN1		001132'		RPTST6		001377'	
DSKPIF		000470'	EXT	GETPNO		001047'		LOKUN2		001136'		S		000000	INT
DSKPIN		000660'	EXT	GETSAT		001625'	INT	LOKUN3		001151'		S$DISK		000010	SIN
EPT		000000	EXT	GETSTT		001024'	INT	LOKUN4		001155'		S$ENTR	777777	777775	SIN
EPTPG0		000200	SIN	GETUPG		000110'	INT	LOKUN5		001156'		S$EVEN		000006	SIN
ERRBDR		001742'	INT	GIVPAG		001607'	INT	LOKUNI		001126'		S$HALT	777777	777777	SIN
ERRFUL		001743'	INT	GIVPG1		001473'	INT	MAPRLS		001556'	EXT	S$INFO		000005	SIN
ERRIMP		001745'	INT	GIVPG6		001505'		MAPWTL		001142'	EXT	S$NAME		000000'	SPD
F		000004	INT	GIVPGK		001466'	INT	MAPWTU		001516'	EXT	S$NONA		000000	SIN
FBIT		000002	SIN	GSATS2		001041'		MBIT		000001	SIN	S$PATC		000007	SIN
FBITS		000000	SPD	GSATS4		001045'		MBITS		000400	SPD	S$STOP		000001	SIN
FNDBAD		001576'		GSATST		001034'	INT	MOSPAU		001062'		S$TEMP		000000	SPD
FNDSB1		001553'		GTSA40		000477'		MOSSP2		001067'		S$XCT	777777	777776	SIN
FNDSB2		001561'		GTSA42		000506'		MOSSP4		001073'		SATBAD		001353'	EXT
FNDSB4		001600'		GTSA43		000512'	INT	MOSSP5		001077'		SATBRD		001323'	EXT
FNDSB5		001602'		GTSA45		000514'		NCTXPG		000771'	EXT	SATC34		001620'	
FNDSBT		001534'		GTSA48		000532'		NODIE		002010'	EXT	SATCHK		001235'	
FPCPOP		001721'		GTSA52		000544'		P		000001	INT	SATCNT		001611'	INT
FPCPP0		001713'		GTSA5A		000557'		P1		000014	INT	SATCT2		001612'	
FPCS6A		001700'		GTSA70		000602'		P2		000015	INT	SATCT3		001616'	
FPCSET		001634'	INT	GTSA71		000613'		P3		000016	INT	SATCT4		001623'	
FPCST3		001657'		GTSA72		000614'		PCBLCC		000517'	EXT	SATFUL		000156'	INT
FPCST4		001661'		GTSA73		000623'		PCBLNK		000627'	EXT	SATMK1		001313'	
FPCST5		001663'		GTSA74		000632'		PCBPAG		000603'	EXT	SATMKC		001302'	
FPCST6		001705'		GTSA75		000634'		PCBPTR		001543'	EXT	SATMKR		001305'	
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88 PAGE 27-2
SWAMP.MAC	 9-OCT-87 17:35		SYMBOL TABLE

SATMRK		001327'		SWAMP		000000'	ENT	
SATWRT		000552'	EXT	SWAPIN	414000	000000		
SEADON		000271'		SWPEND		002031'	INT	
SEAR13		000246'		SWPLIT		001747'	INT	
SEAR14		000255'	INT	T1		000006	INT	
SEAR15		000254'		T2		000007	INT	
SEAR5B		000333'		T3		000010	INT	
SEARC1		000244'		T4		000011	INT	
SEARC2		000257'		TTYFUW		000000	EXT	
SEARC3		000311'		TTYSTR		000000	EXT	
SEARC4		000313'		U		000005	INT	
SEARCH		000243'		UNIMCT		001343'	EXT	
SERC4A		000324'		UNINAM		002020'	EXT	
SIAVAL		000566'	EXT	UNIPPU		001664'	EXT	
SIREQ		000607'	EXT	UNISTR		001702'	EXT	
SRPNDS		001715'	EXT	UNISTT		001660'	EXT	
SRPRPT		001355'	EXT	UNITAL		001730'	EXT	
SSEFIN		000766'		UNPSER		001342'	EXT	
SSEFN1		001006'		UNTLEN		000000	EXT	
SSER13		000717'		UNTTBL		001052'	EXT	
SSER34		000756'		UNVRSF		001666'	EXT	
SSERC0		000713'		UNYSPU		001670'	EXT	
SSERC1		000714'		UPDAC0		001166'	INT	
SSERC2		000730'		UPDAC2		001170'	INT	
SSERC3		000742'		UPDACT		001161'		
SSERC4		000761'		UPDADS		001210'	INT	
SSERC6		001010'		UPDCN1		001174'		
SSERCH		000670'		UPDCN3		001203'		
SSRC6A		001012'		UPDCN5		001206'		
SSTCHK		001256'		WRPI	700600	000000		
STDPRE		000523'	EXT	ZZ	000055	576645	SPD	
STDREA		000653'	EXT	%CTLRU		000000	EXT	
STDWAG		000000	EXT	%CTLST		000000	EXT	
STDWRT		000000	EXT	%CTUPT		000000	EXT	
STOIOS		001746'	EXT	%SAT		377000	SIN	
STPBAD		001236'	EXT	%SAT.C		001564'	EXT	
STPCHK		001267'	EXT	%SWP		776000	SIN	
STPINC		000231'	EXT	%SWP.N		000776	SIN	
STPREA		000000	EXT	
STPRPT		001365'	EXT	
STRBTS		001716'	EXT	
STRDDB		001736'	EXT	
STRNAM		000000	EXT	
STROVR		001737'	EXT	
STRTAL		001724'	EXT	
STRUNI		001656'	EXT	
STTAOB		001012'	EXT	
STTFPC		001706'	EXT	
STTLEN		001710'	EXT	
STTPTR		001661'	EXT	
STTSTS		001373'	EXT	
STYBAD		001562'	EXT	

SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

ADRDUM	  1331%	  1333
ATBALP	    25%	  1008
ATBDUM	    25%	   152	   214	  1006
BADSAT	  1137#
BGCTYP	  1150%	  1150
BSAT34	  1136	  1143	  1152	  1154	  1158#
CHKQTA	  1571#
CKQOT3	  1575	  1578#
CPLSAT	  1211	  1230#
CPLST2	  1246#	  1250
CPLST3	  1247	  1251#
CPLST4	  1260	  1262#	  1265
CPLST5	  1263	  1267#
CPLST6	  1261	  1270#
CPOPJ	    41%	  1383
CPOPJ1	    41%	   377	   682	   899	   902	  1080	  1175	  1180	  1417	  1481	  1581	  1587
CRLF	  1149%	  1149
CURUPT	    42%
DBLMSG	    43%	  1240	  1252	  1254	  1271	  1274
DEV1UN	    19%	   154	   216	   381	  1574
DEVATB	    19%	  1309	  1317
DEVDRB	    19%	  1009	  1578
DFRLST	    43%	  1553
DIE	    11	    11%	    12	   309	   533	   550	  1137	  1145	  1303
DNDADS	  1053#
DRBALC	    21%	  1010	  1011	  1014	  1020	  1579
DRBMXA	    21%	  1016	  1017
DSKCLN	  1144%	  1144
DSKPIF	    42%	   527
DSKPIN	    42%	   582	   675
EPT	    42%	  1119	  1130
EPTPG0	  1119	  1130
ERRBDR	  1594#
ERRFUL	  1573	  1577	  1586	  1595#
ERRIMP	  1598#
F	   154	   216	   381	  1009	  1232	  1280	  1309	  1317	  1574	  1578
FBIT	    92#	   111	   191	   199	   327	   329	   439	   506	   756
FBITS	   163	   302	   324	   330	   729	  1302	  1304	  1339
FNDBAD	  1396	  1407#
FNDSB1	  1380	  1387#
FNDSB2	  1376	  1394#
FNDSB4	  1404	  1409#
FNDSB5	  1384	  1413#
FNDSBT	  1300	  1337	  1370#	  1477
FPCPOP	  1507	  1515	  1555#
FPCPP0	  1542	  1549#
FPCS6A	  1535	  1538#
FPCSET	  1499#
FPCST3	  1521#	  1541
FPCST4	  1523#	  1547
FPCST5	  1525#	  1548
FPCST6	  1524	  1543#
FPCSTA	  1509#	  1512
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

FRMGVB	  1338	  1350#
FRMGVP	  1333#
GETA00	   105	   115	   195	   203#
GETA01	   213	   216#
GETA51	   236#	   239
GETA62	   248#	   259
GETA65	   253	   255	   258#
GETA66	   266#	   270
GETA69	   261	   274#
GETA82	   284#	   294
GETA83	   287	   290	   292#
GETAP0	   174	   215	   218#	   295
GETAP5	   226	   233#
GETAP6	   234	   244#	   278
GETAP8	   237	   283#
GETAPG	   197#
GETER2	    41%	  1086
GETFAL	   219	   267	   387	   391#
GETLRS	    34%	   657
GETP24	   142	   148	   150#
GETP25	   151	   154#
GETP26	   149	   157#
GETPA0	   106	   116#
GETPAG	   109#
GETPG1	   134	   140#
GETPG2	   137	   146#
GETPG4	   153	   155	   172#
GETPGU	   156	   217	   381#
GETPNO	   344	   796	   865#
GETSAT	  1475#
GETSTT	   133	   136	   464	   467	   818#	  1035	  1055	  1374
GETUPG	   189#	   194	   221	   223
GINST	  1503#	  1503	  1504	  1543#	  1543	  1544
GIVPAG	  1428#
GIVPG1	  1303#
GIVPG6	  1301	  1306	  1315#
GIVPGK	  1298#	  1428
GSATS2	   845#	   848
GSATS4	   846	   849#
GSATST	   249	   840#
GTSA40	   538#	   553	   556	   565	   568	   578
GTSA42	   546#	   551
GTSA43	   550#
GTSA45	   547	   552#
GTSA48	   561	   571#
GTSA52	   499	   584#
GTSA5A	   599#	   602
GTSA70	   614	   623#
GTSA71	   634#	   652
GTSA72	   635#	   650
GTSA73	   642#	   647
GTSA74	   638	   640	   645	   649#
GTSA75	   636	   651#
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

GTSA77	   643	   648	   655#
GTSAP0	   474	   476	   496	   500	   526#
GTSAP1	   533#
GTSAP4	   530	   541#
GTSAP5	   574	   582#
GTSAP7	   539	   542	   612#
GTSAPG	   443	   504#
GTSP0A	   529#	   532
GTSP2A	   482#	   485
GTSP3A	   488#	   491
GTSPAG	   437#
GTSPG2	   465	   469	   473#
GTSPG3	   483	   487#
GTSPG4	   489	   493#
GTSWAT	   579	   613	   621	   625	   627	   629	   653	   671	   675#
GTSWIN	   596	   600	   604	   607	   678#
INLMES	    41%
IOBKTL	  1595
IODTER	  1594
IOIMPM	  1598
IOSALC	    41%	  1003
ISCYLB	    97#
JBYWPT	    43%
KEPPAG	   101#
LISTSN	     3	     6
LOKSAT	   141	   147	   277	   289	   924#
LOKST4	   933	   936#
LOKSTB	   940#
LOKU35	   970	   974#
LOKUN1	   960#	   977
LOKUN2	   961	   964#
LOKUN3	   963	   965	   975#
LOKUN4	   973	   979#
LOKUN5	   978	   980#
LOKUNI	   173	   225	   269	   383	   386	   956#
MAPRLS	    32%	   352	   936	   974	  1390
MAPWTL	    32%	   930	   968
MAPWTU	    32%	  1299	  1336
MBIT	    93#	   327	   331	   754	   758
MBITS	   164	   303	   325	   332	   730	  1305	  1342	  1345
MOSPAU	   218	   266	   888#
MOSSP2	   893#	   898
MOSSP4	   892	   894	   897#
MOSSP5	   901#	   905
NCTXPG	    43%	   777
NODIE	    11%	  1137	  1145
P	    12	    98	    99	   103	   104	   113	   114	   122	   123	   124	   125	   126	   127	   133
	   136	   141	   147	   150	   157	   165	   173	   193	   194	   201	   202	   206	   207	   208
	   209	   210	   211	   218	   220	   224	   225	   244	   245	   249	   260	   265	   266	   269
	   276	   277	   289	   309	   319	   323	   344	   345	   348	   349	   352	   354	   357	   358
	   359	   371	   372	   373	   374	   375	   376	   383	   386	   391	   392	   393	   394	   395
	   396	   397	   398	   442	   453	   454	   455	   456	   457	   458	   464	   467	   498	   509
	   517	   518	   519	   520	   522	   523	   533	   550	   573	   584	   585	   586	   587	   592
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

	   620	   655	   657	   659	   670	   676	   677	   678	   679	   680	   681	   703	   707	   716	   718
	   719	   747	   774	   783	   795	   796	   797	   798	   801	   803	   825	   850	   865	   870
	   875	   906	   925	   926	   927	   928	   930	   931	   934	   935	   936	   937	   938	   939
	   940	   956	   957	   968	   972	   974	   979	   980	   981	   982	  1004	  1007	  1018	  1021
	  1033	  1034	  1035	  1040	  1041	  1042	  1053	  1054	  1055	  1062	  1063	  1064	  1082	  1086
	  1088	  1090	  1091	  1093	  1122	  1123	  1125	  1126	  1128	  1137	  1144	  1145	  1148	  1149
	  1193	  1197	  1199	  1200	  1211	  1216	  1217	  1218	  1230	  1231	  1232	  1233	  1234	  1235
	  1236	  1237	  1240	  1242	  1252	  1254	  1256	  1260	  1264	  1265	  1266	  1269	  1271	  1274
	  1275	  1276	  1277	  1278	  1279	  1280	  1281	  1282	  1283	  1298	  1300	  1303	  1310	  1311
	  1312	  1318	  1319	  1320	  1334	  1335	  1337	  1350	  1351	  1373	  1374	  1381	  1388	  1389
	  1390	  1391	  1392	  1394	  1399	  1400	  1401	  1402	  1403	  1405	  1406	  1408	  1409	  1410
	  1428	  1446	  1451	  1475	  1476	  1477	  1478	  1479	  1480	  1502	  1525	  1527	  1529	  1539
	  1549	  1555	  1556
P1	   122	   206	   246	   254	   256	   261	   303	   305	   375	   396	   453	   463	   468	   517
	   526	   564	   566	   567	   583	   612	   614	   615	   681	   705	   719	   720	   730	   732
	   764	   769	   770	   956	   958	   960	   964	   966	   969	   971	   975	   976	   981	  1230
	  1244	  1245	  1251	  1258	  1259	  1270	  1282
P2	   123	   128	   168	   207	   212	   244	   257	   265	   274	   275	   276	   335	   374	   395
	   454	   481	   482	   484	   485	   488	   490	   491	   493	   495	   518	   528	   529	   531
	   532	   538	   539	   541	   555	   558	   567	   572	   586	   592	   601	   623	   624	   680
	   754	   756	   758	   957	   959	   961	   980	  1231	  1245	  1259	  1281
P3	   245	   247	   248	   258	   259	   260
PCBLCC	    34%	   495	   555
PCBLNK	    32%	   238	   258	   484	   490	   531	   538	   646
PCBPAG	    32%	   482	   493	   529	   572	   624
PCBPTR	    32%	   236	   248	   488	   541	   642	   663	  1377
PCBSTS	    34%
PCISTS	    32%	   559	   616	   618	   664	   668
PCMLCC	    34%	   494	   554
PG	   124	   208	   351	   373	   394	   455	   493	   519	   572	   656	   679	   929	   967	  1118
	  1387	  1397
PGE.A	  1118
PGE.C	  1118
PGE.W	  1118
PGYDRT	    23%	   595	   597
PGYERR	    23%	  1116
PPCBIO	    33%	   620	   670
PRNAME	    41%
PRTDDB	  1148%	  1148
PSREQ	    33%	   626
PX.MEM	  1503	  1543
RBMASK	    36%	   116	   444	   661	  1169
RBREAL	    36%	   116	   117	   347	   444	   445	   660	   661	   800	  1169	  1371
RBSPAR	    36%
RBYPNO	    36%	   131	   461	   820	  1257
RBYUN1	    36%	   543
RBYUNI	    36%	   129	   355	   459	   818	   840	   867	   874
REDSAT	  1145#
RELSAT	    32%	  1429
RPTSAT	  1192#
RPTST1	  1204#	  1215
RPTST2	  1206#	  1213
RPTST4	  1209	  1212#
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

RPTST6	  1207	  1214#
S	  1003	  1594	  1595	  1598
S$DISK	   309	   310	   334	   550	   551	   736	   782	   844	  1058	  1303	  1304	  1340	  1343
S$ENTR	    11	    17	   118	   121	   205	   310	   314	   326	   328	   334	   446	   449	   451	   486
	   492	   512	   514	   534	   551	   658	   662	   666	   736	   742	   753	   755	   778	   782
	   844	  1058	  1138	  1146	  1304	  1340	  1343	  1372	  1501	  1554
S$EVEN	   309	   533	   550	  1137	  1145	  1303
S$HALT	    11	   118	   121	   205	   309	   314	   326	   328	   334	   446	   449	   451	   486	   492
	   512	   514	   533	   550	   658	   662	   666	   736	   742	   753	   755	   778	   782	   844
	  1058	  1137	  1145	  1303	  1340	  1343	  1372	  1501	  1554
S$INFO	   309	   533	   550	  1137	  1138	  1145	  1146	  1303
S$NAME	    15#	   118	   121	   205	   314	   326	   328	   334	   446	   449	   451	   486	   492	   512
	   514	   658	   662	   666	   736	   742	   753	   755	   778	   782	   844	  1058	  1340	  1343
	  1372	  1501	  1554
S$NONA	    14	    17	   118	   121	   205	   310	   314	   326	   328	   334	   446	   449	   451	   486
	   492	   512	   514	   534	   551	   658	   662	   666	   736	   742	   753	   755	   778	   782
	   844	  1058	  1138	  1146	  1304	  1340	  1343	  1372	  1501	  1554
S$PATC	   309	   533	   550	  1137	  1145	  1303
S$STOP	   533	   534
S$TEMP	    11#	    11	   118#	   118	   121#	   121	   205#	   205	   309#	   309	   314#	   314	   326#	   326
	   328#	   328	   334#	   334	   446#	   446	   449#	   449	   451#	   451	   486#	   486	   492#	   492
	   512#	   512	   514#	   514	   533#	   533	   550#	   550	   658#	   658	   662#	   662	   666#	   666
	   736#	   736	   742#	   742	   753#	   753	   755#	   755	   778#	   778	   782#	   782	   844#	   844
	  1058#	  1058	  1137#	  1137	  1145#	  1145	  1303#	  1303	  1340#	  1340	  1343#	  1343	  1372#	  1372
	  1501#	  1501	  1554#	  1554
S$XCT	    17	   118	   121	   205	   310	   314	   326	   328	   334	   446	   449	   451	   486	   492
	   512	   514	   534	   551	   658	   662	   666	   736	   742	   753	   755	   778	   782	   844
	  1058	  1138	  1146	  1304	  1340	  1343	  1372	  1501	  1554
SATBAD	    43%	  1170	  1171	  1192
SATBRD	    43%	  1140	  1156
SATC34	  1449#	  1453
SATCHK	   934	   972	  1078#	  1403
SATCNT	  1090	  1125	  1442#
SATCT2	  1443#	  1445	  1450
SATCT3	  1444	  1447#
SATCT4	  1449	  1452#
SATFUL	   231#	   233	   240
SATMK1	  1137	  1145	  1148#
SATMKC	  1094	  1132	  1135#
SATMKR	  1087	  1117	  1140#
SATMRK	  1137	  1145	  1161#
SATWRT	    33%	   594
SEADON	   169	   323#
SEAR13	   302#	   304	   307
SEAR14	   309#
SEAR15	   308#
SEAR5B	   371#
SEARC1	   300#	   310
SEARC2	   306	   313#
SEARC3	   337	   338	   340#
SEARC4	   335	   344#
SEARCH	   143	   166	   175	   227	   271	   279	   291	   299#	   385	   388
SERC4A	   350	   353#
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

SIAVAL	    34%	   605	   606
SIREQ	    34%	   603	   628
SRPNDS	    30%	   101	   109	   189	   197	   437	   504	  1551
SRPRPT	    30%	  1166	  1195
SSEFIN	   760	   765	   768	   774#
SSEFN1	   787	   788	   790#
SSER13	   729#	   731	   734
SSER34	   764#	   772
SSERC0	   706	   717	   725#
SSERC1	   726#	   738
SSERC2	   733	   741#
SSERC3	   722	   751#	   766
SSERC4	   762	   768#
SSERC6	   789	   792#
SSERCH	   587	   703#
SSRC6A	   791	   794#
SSTCHK	   498	   573	  1112#
STDPRE	    33%	   560
STDREA	    33%	   563	   617	   665	   667
STDWAG	    33%	   665
STDWRT	    33%	   665
STOIOS	    42%	  1596%	  1596	  1599%	  1599
STPBAD	    38%	   252	   285	  1079	  1161
STPCHK	    38%	  1081	  1084	  1113	  1114	  1121
STPINC	    39%	   251	   286
STPREA	    34%
STPRPT	    39%	  1161	  1203
STRBTS	    30%	   102	   110	   190	   198	   438	   505	  1167	  1196	  1198	  1552
STRDDB	    30%	   102	   110	   190	   198	   438	   505	   576	   632	   888	  1196	  1198	  1201	  1505
	  1518	  1550	  1571	  1582
STRNAM	    30%
STROVR	    30%	  1585
STRTAL	    30%	   577	   786	  1001	  1039	  1061	  1178	  1349	  1519	  1538	  1572
STRUNI	    30%	   633	   889	  1202	  1506	  1520
STTAOB	    38%	   299	   341	   725	   794
STTFPC	    38%	   254	   256	   333	   473	   552	   637	   780	   781	   901	   924	   932	   964	   969
	  1036	  1056	  1092	  1127	  1135	  1141	  1174	  1179	  1307	  1346	  1544
STTLEN	    38%	   139	   292	   470	   548	   649	   822	   847	   872	   903	   975	  1212	  1546
STTPTR	    38%	   140	   146	   274	   288	   293	   487	   546	   549	   635	   644	   655	   843	   845
	   866	   904	   966	   976	  1168	  1206	  1378	  1398	  1407	  1523
STTSTS	    39%	   250	   284	  1078	  1085	  1112	  1115	  1162	  1208	  1210
STYBAD	    38%	  1382	  1395
STYINC	    38%	   475	   639	   962	  1164
SWAMP	    11	    12#	    15
SWPEND	  1652#
SWPLIT	  1601#
T1	   111	   119	   120	   127	   140	   146	   161	   162	   163	   164	   167	   191	   199	   203
	   204	   211	   274	   288	   299	   300	   301	   302	   303	   304	   307	   315	   324	   325
	   330	   332	   337	   338	   339	   340	   341	   349	   350	   353	   376	   391	   397	   439
	   441	   447	   448	   457	   475	   476	   482	   483	   487	   488	   494	   495	   506	   508
	   510	   511	   522	   541	   546	   554	   555	   559	   560	   563	   577	   595	   596	   598
	   599	   601	   602	   616	   617	   618	   624	   625	   626	   627	   628	   629	   639	   640
	   641	   642	   646	   647	   659	   660	   661	   663	   664	   665	   667	   668	   705	   708
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

	   709	   713	   714	   721	   725	   726	   727	   728	   729	   730	   731	   734	   743	   751	   752
	   757	   759	   768	   769	   770	   787	   788	   789	   790	   792	   793	   794	   823	   824
	   842	   843	   845	   847	   849	   868	   869	   871	   888	   889	   890	   891	   893	   895
	   896	   897	   898	   900	   901	   903	   904	   962	   963	   966	   998	  1000	  1001	  1002
	  1008	  1013	  1078	  1079	  1081	  1083	  1084	  1085	  1087	  1089	  1112	  1113	  1114	  1115
	  1121	  1124	  1129	  1130	  1150	  1161	  1162	  1163	  1164	  1166	  1167	  1168	  1169	  1171
	  1172	  1173	  1174	  1175	  1177	  1178	  1195	  1196	  1198	  1233	  1238	  1243	  1246	  1251
	  1253	  1257	  1262	  1263	  1270	  1272	  1279	  1299	  1302	  1304	  1305	  1308	  1315	  1336
	  1339	  1342	  1345	  1373	  1375	  1376	  1377	  1379	  1381	  1382	  1383	  1395	  1396	  1398
	  1415	  1416	  1443	  1445	  1447	  1450	  1503	  1513	  1525	  1526	  1528	  1531	  1532	  1533
	  1535	  1538	  1539	  1543	  1547	  1551	  1552	  1579	  1580	  1585	  1586
T2	    97	   105	   115	   116	   117	   135	   139	   140	   146	   235	   236	   238	   239	   248
	   250	   254	   256	   257	   275	   283	   284	   288	   292	   293	   299	   333	   341	   346
	   347	   348	   354	   357	   359	   443	   444	   445	   466	   470	   473	   487	   558	   571
	   615	   634	   635	   637	   644	   649	   655	   663	   707	   710	   712	   716	   718	   725
	   780	   781	   794	   799	   800	   820	   821	   822	   824	   845	   849	   865	   866	   870
	   871	   872	   873	   890	   893	   895	   899	   924	   928	   931	   932	   937	   960	   971
	  1005	  1006	  1008	  1009	  1010	  1011	  1014	  1016	  1017	  1020	  1033	  1036	  1041	  1053
	  1056	  1063	  1078	  1085	  1088	  1091	  1092	  1112	  1115	  1123	  1126	  1127	  1135	  1141
	  1162	  1168	  1174	  1179	  1203	  1208	  1210	  1234	  1244	  1249	  1256	  1264	  1266	  1267
	  1268	  1278	  1307	  1309	  1317	  1333	  1346	  1370	  1371	  1378	  1389	  1391	  1398	  1400
	  1402	  1405	  1407	  1409	  1443	  1447	  1448	  1449	  1452	  1475	  1480	  1522	  1523	  1527
	  1529	  1544	  1546
T3	   126	   129	   130	   132	   137	   150	   152	   157	   158	   159	   163	   164	   165	   167
	   172	   210	   213	   214	   220	   221	   222	   223	   224	   250	   251	   252	   268	   284
	   285	   286	   302	   305	   306	   313	   315	   316	   317	   318	   319	   321	   322	   324
	   325	   330	   332	   345	   346	   371	   382	   384	   392	   450	   458	   459	   460	   462
	   468	   469	   513	   523	   529	   530	   545	   546	   548	   549	   552	   571	   576	   577
	   642	   644	   711	   712	   715	   729	   732	   733	   741	   743	   744	   745	   746	   747
	   749	   750	   751	   752	   757	   759	   761	   762	   764	   771	   798	   799	   802	   927
	   938	   959	   998	   999	  1001	  1002	  1011	  1016	  1017	  1116	  1117	  1118	  1119	  1135
	  1136	  1141	  1143	  1165	  1167	  1176	  1178	  1200	  1204	  1206	  1208	  1210	  1212	  1216
	  1235	  1246	  1247	  1248	  1249	  1258	  1268	  1277	  1302	  1304	  1305	  1316	  1339	  1342
	  1345	  1388	  1392	  1399	  1406	  1410	  1413	  1452	  1509	  1510	  1513	  1514	  1543	  1544
	  1545
T4	   101	   102	   109	   110	   131	   132	   160	   162	   189	   190	   197	   198	   301	   308
	   318	   320	   322	   323	   327	   329	   331	   437	   438	   461	   462	   504	   505	   585
	   593	   594	   597	   619	   669	   713	   714	   715	   720	   728	   735	   746	   748	   750
	   774	   775	   776	   777	   779	   780	   784	   786	   795	   797	   802	   867	   868	   874
	   926	   939	  1010	  1012	  1020	  1092	  1127	  1142	  1206	  1236	  1276	  1378	  1379	  1394
	  1401	  1407	  1414	  1416	  1442	  1453	  1499	  1500	  1508	  1510	  1514	  1530	  1531	  1534
	  1538	  1571	  1572	  1574	  1576	  1578	  1579	  1582	  1585
TTYFUW	    42%
TTYSTR	    42%
U	   125	   209	   283	   355	   356	   372	   381	   393	   456	   520	   543	   544	   545	   584
	   632	   633	   634	   651	   652	   678	   703	   704	   760	   775	   783	   784	   785	   786
	   801	   818	   819	   823	   840	   841	   842	   891	   896	   900	   958	   999	  1000	  1034
	  1037	  1038	  1039	  1040	  1054	  1057	  1060	  1061	  1062	  1165	  1173	  1176	  1177	  1199
	  1201	  1202	  1204	  1214	  1215	  1217	  1237	  1242	  1243	  1275	  1298	  1311	  1319	  1335
	  1347	  1348	  1349	  1350	  1476	  1479	  1502	  1505	  1506	  1507	  1511	  1512	  1518	  1519
	  1520	  1521	  1522	  1526	  1533	  1534	  1536	  1540	  1541	  1545	  1550	  1552	  1555
UNIMCT	    27%	  1173
UNINAM	    28%	  1243
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Symbol cross reference

UNIPPU	    27%	   132	   462	  1526
UNISTR	    27%	   651	   785	   897	  1000	  1038	  1060	  1165	  1176	  1214	  1348	  1511	  1534	  1540
UNISTT	    27%	   283	   545	   634	   823	   842	   869	   900	   958	  1204	  1522
UNITAL	    27%	   784	   890	   893	   895	   999	  1037	  1057	  1177	  1347	  1521	  1533	  1536	  1545
	  1576
UNPSER	    41%	  1172
UNTLEN	    43%
UNTTBL	    41%	   130	   356	   460	   544	   819	   841	   868
UNVRSF	    27%	  1528
UNYSPU	    27%	  1509	  1530
UPDAC0	  1003#	  1318
UPDAC2	  1005#
UPDACT	   358	   998#	  1310
UPDADS	  1033#
UPDCN1	  1005	  1009#
UPDCN3	  1012	  1013	  1016#
UPDCN5	  1015	  1020#
ZZ	  1503#	  1503	  1543#	  1543
ZZ1	  1503#	  1503	  1543#	  1543
%CTLRU	    34%	   598
%CTLST	    33%	   235	   247	   481	   528	   623	   641	  1499
%CTUPT	    33%	  1375
%SAT	   159	   300	   308	   316	   726	   727	   793	  1083	  1089	  1302	  1304	  1305	  1339	  1342
	  1345
%SAT.C	    33%	   235	   247	   351	   481	   528	   598	   623	   641	   656	   929	   967	  1375	  1387
	  1397	  1499
%SWP	   709	   721	   727	   744	   792	  1120	  1124	  1131
%SWP.N	  1119	  1130
SWAMP	WHERE THE DISK PAGE ALLOCATORS AND FRIENDS LIVE	MACRO 12.5-46.0 14:29 13-JAN-88
SWAMP.MAC	 9-OCT-87 17:35		Macro/Opdef cross reference

CLRPT	  1120	  1131
CLRPTO	  1120	  1131
DSKOFF	    49#	   527
DSKON	    50#	   582	   675
EPTPTR	  1119	  1130
PFALL	  1132
PJRST	  1429	  1596	  1599
PRINTF	    95	   336	   435	   575	   631	   887	  1194	  1504	  1570
PXCT	  1503	  1543
PXGEN	  1503	  1543
STOPCD	    10	   118	   121	   205	   309	   314	   326	   328	   334	   446	   449	   451	   486	   492
	   512	   514	   533	   550	   658	   662	   666	   736	   742	   753	   755	   778	   782	   844
	  1058	  1137	  1145	  1303	  1340	  1343	  1372	  1501	  1554
SWAPIN	  1083
UMOVE	  1503	  1543
WRPI	   527	   582	   675
XCTFU	  1503	  1543
$END	  1601   	hC
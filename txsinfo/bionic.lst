BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 1
BIONIC	MAC	19-Mar-72 01:13		Version and linkage info

     1					TITLE	BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH
     2					Subttl	Version and linkage info
     3
     4						Search MACTEN,JOBDAT,UUOSYM
     5
     6			000005			VER==5				; Version
     7			000000			REL==0				; Release number
     8			000000			EDIT==0				; Edits as of version 5
     9	
    10	000137					LOC 137
    11	000137	000 005 000000 			Byte (9) REL,VER (18) EDIT
    12	000000'					RELOC
    13
    14					Entry	GETCHR,GORUN
    15					Extern	RDNAM,CMDLP,OUTDEC
    16
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 2
BIONIC	MAC	19-Mar-72 01:13		Definitions

    17					Subttl	Definitions
    18
    19			000001			T1=1				; temp ac 1
    20			000002			T2=2				; temp ac 2
    21			000003			T3=3				; temp ac 3
    22			000004			T4=4				; temp ac 4
    23			000006			C=6				; character pointer
    24			000007			PAGE=7				; page pointer
    25			000016			FL=16				; flags
    26			000017			P=17				; stack
    27
    28			000001			FIL==1				; file channel
    29			000002			TTY==2				; tty channel
    30			000003			LOG==3				; log channel
    31
    32			000010			CASSET==10			; Cassette device
    33			000013			D2780==13			; 2780 device code
    34			000010			CRLFLG==10			; Carriage-return flag
    35			000100			DTAFLG==100			; Data seen flag
    36			000015			CR==15				; Carriage-return
    37			000012			LF==12				; Line-Feed
    38		264551	322645			Pattern==264551322645		; 0101-1010 bit pattern "ZZZZ"
    39
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 3
BIONIC	MAC	19-Mar-72 01:13		Page offset definitions

    40					Subttl	Page offset definitions
    41
    42	000000					loc 0
    43
    44	000000				LOGVER:	Block	1			; Logging version
    45	000001				LOGLOG:	Block	1			; Logging count
    46
    47	000002				ERRCNT:	Block	1			; Number of errors found
    48	000003				BUFCNT:	Block	1			; Number of buffers read
    49	000004				RECCNT:	Block	1			; Records processed
    50	000005				UPTIME:	Block	1			; Machine uptime
    51	000006				BIOAUN:	Block	1			; User's AUN
    52	000007				BIOPPN:	Block	1			; User's PPN
    53	000010				BIONAM:	Block	2			; User's Username
    54
    55	000012				CCL:	Block	1			; Entry address
    56	000013				SAVLIC:	Block	1			; User license
    57	000014				OUTDEV:	Block	1			; Device type
    58	000015				PARITY:	Block	1			; Setting of device parity
    59	000016				PAR2:	Block	1			;  ditto
    60
    61	000017				BUFSIZ:	Block	1			; Constant buffer size
    62	000020				BUFPTR:	Block	1			; Pointer into buffer
    63	000021				BIOSIZ:	Block	1			; Byte count for input
    64	000022				BIOBUF:	Block	^D100			; Data buffer for input
    65	000166				DEVDEF:	Block	3			; Device block for OPEN
    66	000171				FILNAM:	Block	4			; File name for lookup
    67	000175				INAM:	Block	5			; File name from scanner
    68
    69	000000'					Reloc
    70
    71					ARRAY	PDL[40]				; Push down list (Stack)
    72					ARRAY	OBUF[3]				; Buffer header for file
    73
    74	000000'	000000	000017		LOGDEV:	EXP	17			; Dump mode (to be mapped)
    75	000001'	44 63 53 00 00 00 		SIXBIT	/DSK/			; Device DSK
    76	000002'	000000	000000			EXP	0			; No buffer headers
    77
    78	000003'	000000	000003		LOGFILE:EXP	3			; Block length 3
    79	000004'	000001	000004			XWD	1,4			; PPN = [1,4] for (SYS)
    80	000005'	42 51 57 56 51 43 		SIXBIT	/BIONIC/		; File= BIONIC
    81	000006'	54 57 47 00 00 00 		SIXBIT	/LOG/			; Type= LOG
    82
    83
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 4
BIONIC	MAC	19-Mar-72 01:13		*** Main-line code ***	SETUP

    84					Subttl	*** Main-line code ***	SETUP
    85
    86	000007'	634 01 0 00 000001 	STPT:	TDZA	T1,T1			; Watch entry point
    87	000010'	474 01 0 00 000000 		SETO	T1,			;   normal=0 or CCL=-1
    88	000011'	200 17 0 00 000463'		MOVE	P,[IOWD 40,PDL]		; Setup Push-down-list
    89	000012'	261 17 0 00 000001 		PUSH	P,T1			; Remember entry point
    90	000013'	047 00 0 00 000000 		RESET				; Reset all
    91
    92	000014'	550 07 0 00 000044 		HRRZ	PAGE,.JBREL		; Get highest address
    93	000015'	271 07 0 00 002000 		ADDI	PAGE,2000		; Add two pages
    94	000016'	047 07 0 00 000011 		CORE	PAGE,			;  to memory
    95	000017'	254 00 0 00 000403'		  JRST	CORERR			; Can't?
    96	000020'	550 07 0 00 000044 		HRRZ	PAGE,.JBREL		; Get highest address
    97	000021'	340 07 0 00 000000 		AOJ	PAGE,			; Add one
    98	000022'	202 07 0 00 000121 		MOVEM	PAGE,.JBFF		; Setup for other calls
    99	000023'	242 07 0 00 777767 		LSH	PAGE,-^D9		; Convert to a page number
   100	000024'	275 07 0 00 000002 		SUBI	PAGE,2			; Remember it for later
   101	000025'	242 07 0 00 000011 		LSH	PAGE,^D9		; Convert back to address
   102
   103	000026'	262 17 0 07 000012 		POP	P,CCL(PAGE)		; Store entry point
   104
   105	000027'	561 01 0 00 777760 		HRROI	T1,.GTLIC		; Get user's license
   106	000030'	047 01 0 00 000041 		GETTAB	T1,
   107	000031'	400 01 0 00 000000 		  Setz	T1,
   108	000032'	202 01 0 07 000013 		MOVEM	T1,SAVLIC(PAGE)
   109	000033'	260 17 0 00 000366'		PUSHJ	P,DISABLE		;  and disable license
   110
   111	000034'	561 01 0 00 777755 		HRROI	T1,.GTAUN		; Get user's AUN
   112	000035'	047 01 0 00 000041 		GETTAB	T1,
   113	000036'	474 01 0 00 000000 		  Seto	T1,
   114	000037'	202 01 0 07 000006 		MOVEM	T1,BIOAUN(PAGE)
   115	000040'	561 01 0 00 000002 		HRROI	T1,.GTPPN		; Get user's PPN
   116	000041'	047 01 0 00 000041 		GETTAB	T1,
   117	000042'	474 01 0 00 000000 		  Seto	T1,
   118	000043'	202 01 0 07 000007 		MOVEM	T1,BIOPPN(PAGE)
   119	000044'	561 01 0 00 777756 		HRROI	T1,.GTUNM		; Get 1st half of username
   120	000045'	047 01 0 00 000041 		GETTAB	T1,
   121	000046'	400 01 0 00 000000 		  Setz	T1,
   122	000047'	202 01 0 07 000010 		MOVEM	T1,BIONAM(PAGE)
   123	000050'	561 01 0 00 777757 		HRROI	T1,.GTUN1		; Get 2nd half of username
   124	000051'	047 01 0 00 000041 		GETTAB	T1,
   125	000052'	400 01 0 00 000000 		  Setz	T1,
   126	000053'	202 01 0 07 000011 		MOVEM	T1,BIONAM+1(PAGE)
   127
   128	000054'	201 01 0 00 000620 		MOVEI	T1,^D400		; Use the maximum buffer size
   129	000055'	332 00 0 07 000012 		SKIPE	CCL(PAGE)		;  except when CCL specified
   130	000056'	260 17 0 00 000372'		  PUSHJ	P,GETSIZ		;  (read size into T1)
   131	000057'	202 01 0 07 000017 		MOVEM	T1,BUFSIZ(PAGE)		; and store it.
   132
   133	000060'	561 01 0 00 000017 	        HRROI	T1,.AXEP		; (17) even parity
   134	000061'	476 00 0 07 000016 	        SETOM	PAR2(PAGE)		; for read
   135	000062'	042 01 0 07 000016 	        AUXCAL	T1,PAR2(PAGE)		;  of parity state
   136
   137	000063'	260 17 0 00 000000*		PUSHJ	P,CMDLP			; GO SCAN FOR A COMMAND
   138
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 5
BIONIC	MAC	19-Mar-72 01:13		RUN COMMAND - Device Initialization

   139					Subttl	RUN COMMAND - Device Initialization
   140
   141	000064'	561 01 0 00 777754 	GORUN:	HRROI	T1,.GTLOG		; (-24) GOING FOR LINE TYPE
   142	000065'	047 01 0 00 000041 		GETTAB	T1,
   143	000066'	400 01 0 00 000000 		 SETZ	T1,			; Error: 0 == unknown
   144	000067'	242 01 0 00 777750 		LSH	T1,-^D24		; Shift to 7777B11 to read
   145	000070'	405 01 0 00 000077 		ANDI	T1,77			;  off the lower 6 bits
   146
   147	000071'	402 00 0 07 000014 		SETZM	OUTDEV(PAGE)		; Initially 0
   148	000072'	201 02 0 00 000010 		MOVEI	T2,CASSET		; For cassette type mode
   149	000073'	306 01 0 00 000013 		CAIN	T1,13			; Check for 2780
   150	000074'	201 02 0 00 000013 		  MOVEI	T2,D2780		; Yes -- use 2780 mode
   151	000075'	202 02 0 07 000166 		MOVEM	T2,DEVDEF(PAGE)		; Store for OPEN
   152	000076'	306 01 0 00 000013 		CAIN	T1,13			; Is this 2780
   153	000077'	476 00 0 07 000014 		  SETOM	OUTDEV(PAGE)		; Flag it as such
   154
   155	000100'	205 01 0 00 646471 		MOVSI	T1,(SIXBIT/TTY/)	; Set default input device
   156	000101'	202 01 0 07 000167 		MOVEM	T1,DEVDEF+1(PAGE)	; to 'TTY'
   157	000102'	402 00 0 07 000170 		SETZM	DEVDEF+2(PAGE)		; without file buffers
   158
   159	000103'	050 02 0 07 000166 		OPEN	TTY,DEVDEF(PAGE)	; Open TTY and set mode
   160	000104'	254 00 0 00 000413'		 JRST	TTYERR			;  Can't ???
   161
   162						OPEN	FIL,[EXP 0
   163							    SIXBIT /DSK/
   164	000105'	050 01 0 00 000464'			    XWD OBUF,0]
   165	000106'	254 00 0 00 000405'		 JRST	INIERR			; Can't init DSK
   166
   167	000107'	051 03 0 00 000467'		OUTSTR	[ASCIZ /OUTPUT TO FILE: /]
   168	000110'	201 04 0 07 000175 		MOVEI	T4,INAM(PAGE)		; Use this block
   169	000111'	260 17 0 00 000000*		PUSHJ	P,RDNAM			;  and read in the file name
   170	000112'	334 00 0 00 000000 		  SKIPA
   171	000113'	255 00 0 00 000000 		JFCL
   172
   173	000114'	201 01 0 00 000003 	RDFIL:	MOVEI	T1,3			; Setup for "short" long
   174	000115'	202 01 0 07 000171 		MOVEM	T1,FILNAM(PAGE)		;  lookup of the file
   175	000116'	201 01 0 07 000175 		MOVEI	T1,INAM(PAGE)		; Address of name block
   176	000117'	332 00 0 01 000000 		SKIPE	(T1)			;  first word blank?
   177	000120'	202 01 0 07 000172 		MOVEM	T1,FILNAM+1(PAGE)	;  no - username addr
   178	000121'	120 01 0 04 000002 		DMOVE	T1,2(T4)		; Copy file.ext (T4) = INAM
   179	000122'	124 01 0 07 000173 		DMOVEM	T1,FILNAM+2(PAGE)	;  into the lookup block
   180	000123'	077 01 0 07 000171 		ENTER	FIL,FILNAM(PAGE)	; Create/supersede the file
   181	000124'	254 00 0 00 000411'		  JRST	WRTERR			;  Can't ???
   182
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 6
BIONIC	MAC	19-Mar-72 01:13		RUN COMMAND (continued) - Block I/O setup

   183					Subttl	RUN COMMAND (continued) - Block I/O setup
   184
   185	000125'	201 02 0 00 000005 		MOVEI	T2,5			; SET INPUT BAUD RATE TO 1200
   186	000126'	561 01 0 00 000015 		HRROI	T1,.AXIBR		; (15) AUXCAL DISPATCH ENTRY
   187	000127'	332 00 0 07 000014 		SKIPE	OUTDEV(PAGE)		; DONT SET BAUD FOR NON-2780
   188	000130'	042 01 0 00 000002 		 AUXCAL	T1,T2			; DO IT.
   189	000131'	336 00 0 07 000014 		SKIPN	OUTDEV(PAGE)		; Is it a cassette?
   190	000132'	051 16 0 00 000021 		 OUTCHI	21			;  Yes, then start it
   191
   192	000133'	403 16 0 07 000004 		SETZB	FL,RECCNT(PAGE)		; Clear flags,record-count
   193	000134'	561 01 0 00 000034 		HRROI	T1,.AXEBM		; Enter BLOCK-IO mode
   194	000135'	042 01 0 00 000000 		AUXCAL T1,
   195						 JRST	[OUTSTR [ASCIZ \COULD NOT SET BLOCK I/O MODE FOR PORT.\]
   196	000136'	254 00 0 00 000503'			JRST FINIS]
   197						OUTSTR  [ASCIZ\READY FOR INPUT
   198	000137'	051 03 0 00 000505'	\]
   199	000140'	332 00 0 07 000014 		SKIPE	OUTDEV(PAGE)		; Skip if not 2780
   200						OUTSTR  [ASCIZ\
   201
   202
   203
   204	000141'	051 03 0 00 000511'	\]
   205	000142'	200 01 0 07 000017 		MOVE	T1,BUFSIZ(PAGE)		; Block I/O buffer 400 long
   206	000143'	202 01 0 07 000021 		MOVEM	T1,BIOSIZ(PAGE)		; beginning at BIOBUF-1
   207	000144'	561 01 0 00 000036 		HRROI	T1,.AXIBS		; Input block & skip
   208	000145'	042 01 0 07 000021 		AUXCAL	T1,BIOSIZ(PAGE)		; This should always FAIL
   209	000146'	255 00 0 00 000000 		  JFCL
   210
   211	000147'	200 01 0 00 000513'		MOVE	T1,[1,,10]		; 10 SEC DELAY HACK FOR J KOPF
   212	000150'	047 01 0 00 000072 		HIBER	T1,			;  zzzzzzzzzzzzzzzzz
   213	000151'	255 00 0 00 000000 		  JFCL				;
   214
   215	000152'	201 01 0 00 000001 		MOVEI	T1,1			; Set Even Parity
   216	000153'	202 01 0 07 000015 	        MOVEM	T1,PARITY(PAGE)		;  on the TTY port
   217	000154'	561 01 0 00 000017 		HRROI	T1,.AXEP
   218	000155'	332 00 0 07 000014 		SKIPE	OUTDEV(PAGE)		; SET PARITY AS A SIGNAL TO THE
   219	000156'	042 01 0 07 000015 		 AUXCAL	T1,PARITY(PAGE)		; REMOTE TO START 2780 PROTOCOL.
   220
   221	000157'	551 01 0 07 000022 		HRRZI	T1,BIOBUF(PAGE)		; Get address of buffer
   222	000160'	505 01 0 00 441000 		HRLI	T1,(POINT 8)		;  and setup an 8-bit
   223	000161'	202 01 0 07 000020 		MOVEM	T1,BUFPTR(PAGE)		;  byte pointer
   224
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 7
BIONIC	MAC	19-Mar-72 01:13		RUN COMMAND (continued) - Data collection loop

   225					Subttl	RUN COMMAND (continued) - Data collection loop
   226
   227	000162'	260 17 0 00 000277'	LP:	PUSHJ	P,MASKIT		; Setup data mask
   228	000163'	200 01 0 07 000017 		MOVE	T1,BUFSIZ(PAGE)		; Use the buffer size
   229	000164'	202 01 0 07 000021 		MOVEM	T1,BIOSIZ(PAGE)		; specified (max = ^D400)
   230	000165'	561 01 0 00 000035 		HRROI	T1,.AXIBW		; (35) input block and wait
   231	000166'	042 01 0 07 000021 		AUXCAL	T1,BIOSIZ(PAGE)		; Get the data!
   232						  JRST	[OUTSTR [ASCIZ \BLOCK INPUT ERROR.\]
   233	000167'	254 00 0 00 000520'		        JRST FINIS]
   234
   235	000170'	063 02 0 00 020000 		STATZ	TTY,20000		; EOF?
   236	000171'	254 00 0 00 000216'		  JRST	LPEND			;  Yes -- skip this rot
   237
   238	000172'	200 01 0 00 000522'		MOVE	T1,[Exp Pattern]	; Bit pattern 0101-1010 repeating
   239	000173'	316 01 0 07 000022 		CAMN	T1,BIOBUF(PAGE)		; Check first word.
   240	000174'	260 17 0 00 000310'		  PUSHJ	P,BIOSKP		; Skip found -- report it
   241
   242	000175'	200 01 0 07 000021 		MOVE	T1,BIOSIZ(PAGE)		; Get count in buffer
   243	000176'	313 01 0 07 000017 		CAMLE	T1,BUFSIZ(PAGE)		; Make sure it's not too big
   244	000177'	200 01 0 07 000017 		  MOVE	T1,BUFSIZ(PAGE)		;  by truncation if necessary
   245	000200'	200 06 0 07 000020 		MOVE	C,BUFPTR(PAGE)		; Get pointer to buffer
   246
   247	000201'	375 00 0 07 000021 	LP2:	SOSGE	BIOSIZ(PAGE)		; Room left?
   248	000202'	254 00 0 00 000216'		  JRST	LPEND			; No --- get some more
   249	000203'	134 01 0 00 000006 		ILDB	T1,C			; Get a byte
   250	000204'	405 01 0 00 000177 		ANDI	T1,177			; Clear to 7 bits
   251	000205'	322 01 0 00 000201'		JUMPE	T1,LP2			; Ignore nulls!!!!
   252	000206'	302 01 0 00 000015 		CAIE	T1,CR			; Handle carriage-returns
   253	000207'	306 01 0 00 000012 		CAIN	T1,LF			;  or line-feeds
   254	000210'	254 00 0 00 000245'		 JRST	DOCRLF			;  separately
   255	000211'	660 16 0 00 000100 		TRO	FL,DTAFLG		; SAY WE HAVE DATA
   256	000212'	602 16 0 00 000010 	NOCR:	TRNE	FL,CRLFLG		; SKIP IF FLAG OFF
   257	000213'	254 00 0 00 000267'		  JRST	INS.LF			; MUST INSERT A LF
   258	000214'	260 17 0 00 000377'	NOCRLF:	PUSHJ	P,DUMP			; PUSH CHAR. TO FILE
   259	000215'	254 00 0 00 000201'		JRST	LP2			; GET NEXT CHAR.
   260
   261	000216'	061 02 0 00 020000 	LPEND:	STATO	TTY,20000		; End?
   262	000217'	254 00 0 00 000162'		  JRST	LP			; No - get more
   263	000220'	606 16 0 00 000010 		TRNN	FL,CRLFLG		; SEE IF CR BUT NO LF YET
   264	000221'	254 00 0 00 000225'		  JRST	LPEND1			; DONE, SO GO ON
   265	000222'	201 01 0 00 000012 		MOVEI	T1,LF			; GET THAT LF
   266	000223'	260 17 0 00 000377'		PUSHJ	P,DUMP
   267	000224'	350 00 0 07 000004 		AOS	RECCNT(PAGE)		; INCREASE COUNT
   268	000225'	070 01 0 00 000000 	LPEND1:	CLOSE FIL,0			; Close output file
   269	000226'	561 01 0 00 000042 		HRROI	T1,.AXLBM		;  and shutdown TTY
   270	000227'	042 01 0 00 000000 		AUXCAL	T1,			;  -- leave block mode --
   271	000230'	255 00 0 00 000000 		  JFCL				;  -- ignoring errors  --
   272	000231'	561 01 0 00 000017 		HRROI T1,.AXEP			; Reset parity in the remote.
   273	000232'	332 00 0 07 000014 		SKIPE	OUTDEV(PAGE)		;  so that program may be
   274	000233'	042 01 0 00 000016 		AUXCAL T1,PAR2  		;  restarted for 2780!
   275	000234'	336 00 0 07 000014 		SKIPN	OUTDEV(PAGE)		; Turn off cassette mode
   276	000235'	051 16 0 00 000023 		 OUTCHI	23			;  for non-2780 devices.
   277						OUTSTR  [ASCIZ/
   278	000236'	051 03 0 00 000510'	/]
   279	000237'	200 01 0 07 000004 		MOVE	T1,RECCNT(PAGE)		; get count of "records"
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 7-1
BIONIC	MAC	19-Mar-72 01:13		RUN COMMAND (continued) - Data collection loop

   280	000240'	260 17 0 00 000000*		PUSHJ	P,OUTDEC		; print it
   281	000241'	051 03 0 00 000523'		OUTSTR  [ASCIZ/ RECORDS INPUT/]	; with the message
   282	000242'	260 17 0 00 000312'		PUSHJ	P,BIOLOG		; and then log usage
   283	000243'	260 17 0 00 000363'		PUSHJ	P,ENABLE		; then restore license
   284	000244'	047 00 0 00 000012 	        EXIT
   285
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 8
BIONIC	MAC	19-Mar-72 01:13		RUN COMMAND (continued) - Handle CR and LF pairs

   286					Subttl	RUN COMMAND (continued) - Handle CR and LF pairs
   287
   288	000245'	306 01 0 00 000012 	DOCRLF: CAIN	T1,LF			;LINE FEED?
   289	000246'	254 00 0 00 000261'		  JRST	DOLF			;PROCESS IT
   290	000247'	302 01 0 00 000015 		CAIE	T1,CR			;CARRIAGE RETURN?
   291	000250'	254 00 0 00 000212'		  JRST	NOCR			;NO, PROCESS NORMALLY
   292	000251'	620 16 0 00 000100 		TRZ	FL,DTAFLG		;TURN DATA FLAG OFF
   293	000252'	666 16 0 00 000010 		TRON	FL,CRLFLG		;SEE IF CR AFTER CR
   294	000253'	254 00 0 00 000214'		  JRST	NOCRLF			;NO, THEN ON WE GO
   295	000254'	201 01 0 00 000012 		MOVEI	T1,LF			;INSERT LF BETWEEN CR'S
   296	000255'	260 17 0 00 000377'		PUSHJ	P,DUMP			;SAVE TO FILE
   297	000256'	350 00 0 07 000004 		AOS	RECCNT(PAGE)		;INCREMENT COUNT
   298	000257'	201 01 0 00 000015 		MOVEI	T1,CR			;GET CR BACK
   299	000260'	254 00 0 00 000214'		JRST	NOCRLF			;GO ON AS BEFORE
   300	000261'	606 16 0 00 000100 	DOLF:	TRNN	FL,DTAFLG		;SEE IF LF AFTER DATA
   301	000262'	254 00 0 00 000274'		  JRST	DONELF			;NO, GO ON AS IS
   302	000263'	201 01 0 00 000015 		MOVEI	T1,CR			;INSURE CR BEFORE LF
   303	000264'	260 17 0 00 000377'		PUSHJ	P,DUMP
   304	000265'	201 01 0 00 000012 		MOVEI	T1,LF			;GET BLACK LF
   305	000266'	254 00 0 00 000274'		JRST	DONELF			;PROCESS LF NOW
   306
   307	000267'	261 17 0 00 000001 	INS.LF:	PUSH	P,T1			;SAVE CHAR.
   308	000270'	201 01 0 00 000012 		MOVEI	T1,LF			;INSERT LF AFTER CR
   309	000271'	260 10 000377'		PUSHJ	P,DUMP			;PUT IT TO FILE
   310	000272'	262 17 0 00 000001 		POP	P,T1			;RETURN WHATEVER
   311	000273'	660 16 0 00 000100 		TRO	FL,DTAFLG		;SET ON FOR RETURNED CHAR
   312	000274'	620 16 0 00 000010 	DONELF:	TRZ	FL,CRLFLG		;SAY DONE WITH CR, LF
   313	000275'	350 00 0 07 000004 		AOS	RECCNT(PAGE)		;ADD TO RECORD COUNT IN
   314	000276'	254 00 0 00 000214'		JRST	NOCRLF			;PROCESS CURRENT CHAR.
   315
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 9
BIONIC	MAC	19-Mar-72 01:13		Debugging and checking routines

   316					Subttl	Debugging and checking routines
   317
   318	000277'	200 01 0 00 000522'	MASKIT:	MOVE	T1,[Exp Pattern]	; Setup our pattern
   319	000300'	202 01 0 07 000022 		MOVEM	T1,BIOBUF(PAGE)		; in the bio-buf data area
   320	000301'	515 01 0 07 000022 		HRLZI	T1,BIOBUF(PAGE)		; then copy it
   321	000302'	541 01 0 07 000023 		HRRI	T1,BIOBUF+1(PAGE)	; throughout
   322	000303'	200 02 0 07 000017 		MOVE	T2,BUFSIZ(PAGE)		; the entire
   323	000304'	242 02 0 00 777776 		LSH	T2,-2			; data buffer.
   324	000305'	271 02 0 07 000021 		ADDI	T2,BIOSIZ(PAGE)
   325	000306'	251 01 0 02 000000 		BLT	T1,(T2)			; Transfer!
   326	000307'	263 17 0 00 000000 		POPJ	P,			; Return
   327
   328	000310'	350 00 0 07 000002 	BIOSKP:	AOS	ERRCNT(PAGE)		; Increment error count
   329	000311'	254 00 0 00 000312'		JRST	BIOLOG			; And LOG the error
   330
   331	000312'	260 17 0 00 000363'	BIOLOG:	PUSHJ	P,ENABLE		; Enable HF SY license
   332	000313'	201 01 0 00 000001 		MOVEI	T1,1			; Version 1
   333	000314'	202 01 0 07 000000 		MOVEM	T1,LOGVER(PAGE)		;  : store it
   334	000315'	200 01 0 00 000526'		MOVE	T1,[Xwd .NSUPT,.GTNSW]	; Get current system uptime
   335	000316'	047 01 0 00 000041 		GETTAB	T1,			;  from the monitor
   336	000317'	474 01 0 00 000000 		  Seto	T1,			;  : use -1 if error
   337	000320'	202 01 0 07 000005 		MOVEM	T1,UPTIME(PAGE)		; Store in time block
   338	000321'	050 03 0 00 000000'		OPEN	LOG,LOGDEV		; Open device DSK
   339	000322'	254 00 0 00 000366'		  JRST	DISABLE			; Can't open - finish up
   340	000323'	076 03 0 00 000003'		LOOKUP	LOG,LOGFILE		; Lookup BIONIC.LOG
   341	000324'	255 00 0 00 000000 		  JFCL				; Ignore error - if any
   342	000325'	077 03 0 00 000003'		ENTER	LOG,LOGFILE		; Enter/supersede file
   343	000326'	254 00 0 00 000366'		  JRST	DISABLE			; Can't enter - finish up
   344	000327'	200 02 0 00 000527'		MOVE	T2,[Xwd .CHCFP,LOG]	; Create a page at the end
   345	000330'	474 03 0 00 000000 		SETO	T3,			;  of the log file
   346	000331'	043 02 0 00 000003 		CHANIO	T2,T3			;  to be mapped below
   347	000332'	254 00 0 00 000360'		  JRST	BIOREL			; If errors - abort
   348	000333'	201 02 0 07 001000 		MOVEI	T2,1000(PAGE)		; Copy page number
   349	000334'	242 02 0 00 777767 		LSH	T2,-^D9			;  as a page (not an addr)
   350	000335'	505 02 0 00 002001 		HRLI	T2,(1B7!1B17)		;  ref bit ! count=1
   351	000336'	047 02 0 00 777712 		VCLEAR	T2,			;  clear page
   352	000337'	255 00 0 00 000000 		 JFCL				;  (show distrust for monitor)
   353	000340'	201 02 0 07 001000 		MOVEI	T2,1000(PAGE)		; Copy page number
   354	000341'	242 02 0 00 777767 		LSH	T2,-^D9			;  as a page (not an addr)
   355	000342'	505 02 0 00 006001 		HRLI	T2,(.PRRW!1B17)		; Get 1,,page#
   356	000343'	200 01 0 00 000530'		MOVE	T1,[Xwd .CHMFP,LOG]	; Setup mapping call
   357	000344'	043 01 0 00 000002 		CHANIO	T1,T2			; Map page from disk
   358	000345'	254 00 0 00 000360'		  JRST	BIOREL			; Skip if error
   359	000346'	350 00 0 07 000001 		AOS	LOGLOG(PAGE)		; then count / copy
   360	000347'	201 01 0 07 001000 		MOVEI	T1,1000(PAGE)		; Get place for store
   361	000350'	504 01 0 00 000007 		HRL	T1,PAGE			; And where to start
   362	000351'	251 01 0 07 001777 		BLT	T1,1777(PAGE)		; Then copy it all
   363	000352'	201 02 0 07 001000 		MOVEI	T2,1000(PAGE)		; Copy page number
   364	000353'	242 02 0 00 777767 		LSH	T2,-^D9			;  as a page (not an addr)
   365	000354'	505 02 0 00 002001 		HRLI	T2,(1B7!1B17)		;  ref bit ! count=1
   366	000355'	047 02 0 00 777712 		VCLEAR	T2,			;  clear page
   367	000356'	255 00 0 00 000000 		 JFCL				;  (show distrust for monitor)
   368	000357'	070 03 0 00 000000 		CLOSE	LOG,			;  Close file
   369	000360'	071 03 0 00 000000 	BIOREL:	RELEASE	LOG,			;  Release channel
   370	000361'	260 17 0 00 000366'		PUSHJ	P,DISABLE		; Disable HF SY license
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 9-1
BIONIC	MAC	19-Mar-72 01:13		Debugging and checking routines

   371	000362'	263 17 0 00 000000 		POPJ	P,			; Return
   372
   373	000363'	200 01 0 07 000013 	ENABLE:	MOVE	T1,SAVLIC(PAGE)		; Get complete license
   374	000364'	047 01 0 00 777770 		SETLIC	T1,			; Set it up
   375	000365'	263 17 0 00 000000 		POPJ	P,			; And return
   376
   377	000366'	504 01 0 07 000013 	DISABLE:HRL	T1,SAVLIC(PAGE)		; Get frame license
   378	000367'	540 01 0 07 000013 		HRR	T1,SAVLIC(PAGE)		;  in both halves
   379	000370'	047 01 0 00 777770 		SETLIC	T1,			; To make sure user
   380	000371'	263 17 0 00 000000 		POPJ	P,			;  has all he has
   381
   382	000372'	201 01 0 00 000334 	GETSIZ:	MOVEI	T1,^D220		; Use a non-standard size
   383	000373'	263 17 0 00 000000 		POPJ	P,			; ...
   384
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 10
BIONIC	MAC	19-Mar-72 01:13		Subroutines, error messages and finish up

   385					Subttl	Subroutines, error messages and finish up
   386
   387	000374'	051 04 0 00 000006 	GETCHR:	INCHWL C			; read a character from tty
   388	000375'	350 00 0 17 000000 	CPOPJ1:	AOS (P)				; then !skip! return
   389	000376'	263 17 0 00 000000 		POPJ P,				; bye!
   390
   391	000377'	377 00 0 00 000422'	DUMP:	SOSG	OBUF+2			; count characters
   392	000400'	067 01 0 00 000000 		 OUTPUT	FIL,			; output when full
   393	000401'	136 01 0 00 000421'		IDPB	T1,OBUF+1		; deposit character
   394	000402'	263 17 0 00 000000 		POPJ	P,			; all done.
   395
   396	000403'	051 03 0 00 000531'	CORERR:	OUTSTR [ASCIZ /COULD NOT INITIALIZE MEMORY PAGE./]
   397	000404'	254 00 0 00 000414'		JRST FINIS
   398	000405'	051 03 0 00 000540'	INIERR:	OUTSTR [ASCIZ /COULD NOT INITIALIZE DSK CHANNEL./]
   399	000406'	254 00 0 00 000414'		JRST FINIS
   400	000407'	051 03 0 00 000547'	RDERR:	OUTSTR [ASCIZ /COULD NOT LOOKUP COMMAND FILE./]
   401	000410'	254 00 0 00 000414'		JRST FINIS
   402	000411'	051 03 0 00 000556'	WRTERR:	OUTSTR [ASCIZ /COULD NOT WRITE TO OUTPUT FILE./]
   403	000412'	254 00 0 00 000414'		JRST FINIS
   404	000413'	051 03 0 00 000565'	TTYERR:	OUTSTR [ASCIZ /COULD NOT INITIALIZE DEVICE TTY./]
   405
   406	000414'	561 01 0 00 000017 	FINIS:  HRROI	T1,.AXEP
   407	000415'	042 01 0 00 000016 	        AUXCAL	T1,PAR2
   408	000416'	260 17 0 00 000363'		PUSHJ	P,ENABLE		; Restore license
   409	000417'	047 00 0 00 000012 	        EXIT   	
   410
   411			000007'			END STPT

NO ERRORS DETECTED

PROGRAM BREAK IS 000574
ABSOLUTE BREAK IS 000202
CPU TIME USED 00:37.598

22P CORE USED
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page S-1
BIONIC	MAC	19-Mar-72 01:13		SYMBOL TABLE

AUXCAL	042000	000000		LOGVER		000000		.GTNSW		000012	spd	
BIOAUN		000006		LOOKUP	076000	000000		.GTPPN		000002	spd	
BIOBUF		000022		LP		000162'		.GTUN1	777777	777757	spd	
BIOLOG		000312'		LP2		000201'		.GTUNM	777777	777756	spd	
BIONAM		000010		LPEND		000216'		.JBFF		000121		
BIOPPN		000007		LPEND1		000225'		.JBREL		000044		
BIOREL		000360'		MASKIT		000277'		.NSUPT		000015	spd	
BIOSIZ		000021		NOCR		000212'		.PRRW	006000	000000	spd	
BIOSKP		000310'		NOCRLF		000214'		
BUFCNT		000003		OBUF		000420'		
BUFPTR		000020		OPEN	050000	000000		
BUFSIZ		000017		OUTCHI	051700	000000		
C		000006		OUTDEC		000240'	ext	
CASSET		000010	spd	OUTDEV		000014		
CCL		000012		OUTPUT	067000	000000		
CHANIO	043000	000000		OUTSTR	051140	000000		
CLOSE	070000	000000		P		000017		
CMDLP		000063'	ext	PAGE		000007		
CORE	047000	000011		PAR2		000016		
CORERR		000403'		PARITY		000015		
CPOPJ1		000375'		PATTER	264551	322645	spd	
CR		000015	spd	PDL		000423'		
CRLFLG		000010	spd	RDERR		000407'		
D2780		000013	spd	RDFIL		000114'		
DEVDEF		000166		RDNAM		000111'	ext	
DISABL		000366'		RECCNT		000004		
DOCRLF		000245'		REL		000000	spd	
DOLF		000261'		RELEAS	071000	000000		
DONELF		000274'		RESET	047000	000000		
DTAFLG		000100	spd	SAVLIC		000013		
DUMP		000377'		SETLIC	047000	777770		
EDIT		000000	spd	STATO	061000	000000		
ENABLE		000363'		STATZ	063000	000000		
ENTER	077000	000000		STPT		000007'		
ERRCNT		000002		T1		000001		
EXIT	047000	000012		T2		000002		
FIL		000001	spd	T3		000003		
FILNAM		000171		T4		000004		
FINIS		000414'		TTY		000002	spd	
FL		000016		TTYERR		000413'		
GETCHR		000374'	ent	UPTIME		000005		
GETCHR	047000	000006		VCLEAR	047000	777712		
GETSIZ		000372'		VER		000005	spd	
GETTAB	047000	000041		WRTERR		000411'		
GORUN		000064'	ent	.AXEBM		000034	spd	
HIBER	047000	000072		.AXEP		000017	spd	
INAM		000175		.AXIBR		000015	spd	
INCHWL	051200	000000		.AXIBS		000036	spd	
INIERR		000405'		.AXIBW		000035	spd	
INS.LF		000267'		.AXLBM		000042	spd	
LF		000012	spd	.CHCFP		000040	spd	
LOG		000003	spd	.CHMFP		000035	spd	
LOGDEV		000000'		.GTAUN	777777	777755	spd	
LOGFIL		000003'		.GTLIC	777777	777760	spd	
LOGLOG		000001		.GTLOG	777777	777754	spd	

BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 1
BIONIC	MAC	19-Mar-72 01:13		Version and linkage info


Symbol cross reference

BIOAUN	    51#	   114
BIOBUF	    64#	   221	   239	   319	   320	   321
BIOLOG	   282	   329	   331#
BIONAM	    53#	   122	   126
BIOPPN	    52#	   118
BIOREL	   347	   358	   369#
BIOSIZ	    63#	   206	   208	   229	   231	   242	   247	   324
BIOSKP	   240	   328#
BUFCNT	    48#
BUFPTR	    62#	   223	   245
BUFSIZ	    61#	   131	   205	   228	   243	   244	   322
C	    23#	   245	   249	   387
CASSET	    32#	   148
CCL	    55#	   103	   129
CMDLP	    15#	   137
CORERR	    95	   396#
CPOPJ1	   388#
CR	    36#	   252	   290	   298	   302
CRLFLG	    34#	   256	   263	   293	   312
D2780	    33#	   150
DEVDEF	    65#	   151	   156	   157	   159
DISABL	   109	   339	   343	   370	   377#
DOCRLF	   254	   288#
DOLF	   289	   300#
DONELF	   301	   305	   312#
DTAFLG	    35#	   255	   292	   300	   311
DUMP	   258	   266	   296	   303	   309	   391#
EDIT	     8#	    11
ENABLE	   283	   331	   373#	   408
ERRCNT	    47#	   328
FIL	    28#	   162	   180	   268	   392
FILNAM	    66#	   174	   177	   179	   180
FINIS	   196	   233	   397	   399	   401	   403	   406#
FL	    25#	   192	   255	   256	   263	   292	   293	   300	   311	   312
GETCHR	    14	   387#
GETSIZ	   130	   382#
GORUN	    14	   141#
INAM	    67#	   168	   175
INIERR	   165	   398#
INS.LF	   257	   307#
LF	    37#	   253	   265	   288	   295	   304	   308
LOG	    30#	   338	   340	   342	   344	   356	   368	   369
LOGDEV	    74#	   338
LOGFIL	    78#	   340	   342
LOGLOG	    45#	   359
LOGVER	    44#	   333
LP	   227#	   262
LP2	   247#	   251	   259
LPEND	   236	   248	   261#
LPEND1	   264	   268#
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 1
BIONIC	MAC	19-Mar-72 01:13		Version and linkage info


Symbol cross reference

MASKIT	   227	   318#
NOCR	   256#	   291
NOCRLF	   258#	   294	   299	   314
OBUF	    72#	   164	   391	   393
OUTDEC	    15#	   280
OUTDEV	    57#	   147	   153	   187	   189	   199	   218	   273	   275
P	    26#	    88	    89	   103	   109	   130	   137	   169	   227	   240	   258	   266	   280	   282
	   283	   296	   303	   307	   309	   310	   326	   331	   370	   371	   375	   380	   383	   388
	   389	   394	   408
PAGE	    24#	    92	    93	    94	    96	    97	    98	    99	   100	   101	   103	   108	   114	   118
	   122	   126	   129	   131	   134	   135	   147	   151	   153	   156	   157	   159	   168	   174
	   175	   177	   179	   180	   187	   189	   192	   199	   205	   206	   208	   216	   218	   219
	   221	   223	   228	   229	   231	   239	   242	   243	   244	   245	   247	   267	   273	   275
	   279	   297	   313	   319	   320	   321	   322	   324	   328	   333	   337	   348	   353	   359
	   360	   361	   362	   363	   373	   377	   378
PAR2	    59#	   134	   135	   274	   407
PARITY	    58#	   216	   219
PATTER	    38#	   238	   318
PDL	    71#	    88
RDERR	   400#
RDFIL	   173#
RDNAM	    15#	   169
RECCNT	    49#	   192	   267	   279	   297	   313
REL	     7#	    11
SAVLIC	    56#	   108	   373	   377	   378
STPT	    86#	   411
T1	    19#	    86	    87	    89	   105	   106	   107	   108	   111	   112	   113	   114	   115	   116
	   117	   118	   119	   120	   121	   122	   123	   124	   125	   126	   128	   131	   133	   135
	   141	   142	   143	   144	   145	   149	   152	   155	   156	   173	   174	   175	   176	   177
	   178	   179	   186	   188	   193	   194	   205	   206	   207	   208	   211	   212	   215	   216
	   217	   219	   221	   222	   223	   228	   229	   230	   231	   238	   239	   242	   243	   244
	   249	   250	   251	   252	   253	   265	   269	   270	   272	   274	   279	   288	   290	   295
	   298	   302	   304	   307	   308	   310	   318	   319	   320	   321	   325	   332	   333	   334
	   335	   336	   337	   356	   357	   360	   361	   362	   373	   374	   377	   378	   379	   382
	   393	   406	   407
T2	    20#	   148	   150	   151	   185	   188	   322	   323	   324	   325	   344	   346	   348	   349
	   350	   351	   353	   354	   355	   357	   363	   364	   365	   366
T3	    21#	   345	   346
T4	    22#	   168	   178
TTY	    29#	   159	   235	   261
TTYERR	   160	   404#
UPTIME	    50#	   337
VER	     6#	    11
WRTERR	   181	   402#
.AXEBM	   193
.AXEP	   133	   217	   272	   406
.AXIBR	   186
.AXIBS	   207
.AXIBW	   230
.AXLBM	   269
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 1
BIONIC	MAC	19-Mar-72 01:13		Version and linkage info


Symbol cross reference

.CHCFP	   344
.CHMFP	   356
.GTAUN	   111
.GTLIC	   105
.GTLOG	   141
.GTNSW	   334
.GTPPN	   115
.GTUN1	   123
.GTUNM	   119
.JBFF	    98
.JBREL	    92	    96
.NSUPT	   334
.PRRW	   355
BIONIC - TEST INPUT FROM 2780 USING NETWORK REMOTE BATCH	MACRO %53B(1156)-1 14:25  8-Nov-85 Page 1
BIONIC	MAC	19-Mar-72 01:13		Version and linkage info


Macro/Opdef cross reference

AUXCAL	   135	   188	   194	   208	   219	   231	   270	   274	   407
CHANIO	   346	   357
CLOSE	   268	   368
CORE	    94
ENTER	   180	   342
EXIT	   284	   409
GETTAB	   106	   112	   116	   120	   124	   142	   335
HIBER	   212
INCHWL	   387
LOOKUP	   340
OPEN	   159	   162	   338
OUTCHI	   190	   276
OUTPUT	   392
OUTSTR	   167	   195	   197	   200	   232	   277	   281	   396	   398	   400	   402	   404
RELEAS	   369
RESET	    90
SETLIC	   374	   379
STATO	   261
STATZ	   235
VCLEAR	   351	   366    \5<
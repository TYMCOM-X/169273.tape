SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76

     1						SUBTTL	Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76
     2
     3					; COPYRIGHTS 1972,1973,1976,1977  STEVENS INSTITUTE OF TECHNOLOGY
     4					; HOBOKEN, NEW JERSEY, 07030
     5					; ALL RIGHTS RESERVED.
     6
     7					  ;UNIVERSALS
     8
     9						SEARCH	JOBDAT		;JOB DATA AREA DEFINITIONS
    10						SEARCH	MACTEN		;DEC-10 COMMON MACROS
    11						SEARCH	UUOSYM		;TOPS10 UUO SYMBOL DEFINITIONS
    12						SEARCH	SNOPRM		;SITBOL PARAMETER FILE
    13
    14					  ;DIRECTIVES
    15
    16						.DIRECT	.XTABM		;EXCLUDE TABS FROM MACRO CALLS
    17						SALL			;SUPPRESS MACRO EXPANSIONS
    18	400000'					TWOSEG	400K		;TWOSEGMENT CODE
    19
    20					  ;VERSION NUMBER
    21
    22			000005			PGVER==5		;MAJOR VERSION NUMBER
    23			000000			PGMIN==0		;MINOR VERSION NUMBER
    24			000207			PGEDT==207		;EDIT LEVEL
    25			000000			PGWHO==0		;CUSTOMER ARGUMENT
    26
    27					  ;TITLE
    28
    29						TITLE.	PG,SNOPG,<Pattern Global Routines>
    30		604700	000000			PGSIX==SIXBIT /PG/	; SNOPG ABBREVIATION IN SIXBIT
    31		502160	000000			PGASC==ASCIZ /PG/	; SNOPG ABBREVIATION IN ASCII
    32						SALL
    33
    34
    35					  ;SHOW UNIVERSAL VERSION NUMBERS
    36
    37	400000'	043100	000450			SHOW.	%%JOBD		;VERSION NUMBER OF JOBDAT
    38	400000'	000200	000025			SHOW.	%%MACT		;VERSION NUMBER OF MACTEN
    39	400000'	001400	000457			SHOW.	%%UUOS		;VERSION NUMBER OF UUOSYM
    40	400000'	000500	000305			SHOW.	%%SNOP		;VERSION NUMBER OF SNOPRM
    41
    42						PGTTL				; Title
    43						PGPTX				; PASS2 message
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 2
SNOPG	MAC	13-Oct-66 22:19		Table of Contents

    44						SUBTTL	Table of Contents
    45
    46					;		Table of Contents for Pattern Global Routines
    47					;
    48					;
    49					;			   Section			      Page
    50					;   1. Table of Contents. . . . . . . . . . . . . . . . . . .    2
    51					;   2. REVISION HISTORY . . . . . . . . . . . . . . . . . . .    3
    52					;   3. PJOIN: BUILD COMPOSITE PATTERN BLOCK FROM 2 PATTS. . .    4
    53					;   4. CONCATENATE PATTERNS AT TOP OF STACK . . . . . . . . .    5
    54					;   5. BUILD ALTERNATION OF PATTERNS AT TOP OF STACK. . . . .    6
    55					;   6. ARBNO: . . . . . . . . . . . . . . . . . . . . . . . .    7
    56					;   7. VA SYNTHESIZE VARIABLE ASSOC PBLOKS. . . . . . . . . .    8
    57					;   8. PPRTBL . . . . . . . . . . . . . . . . . . . . . . . .    9
    58					;   9. MTCH . . . . . . . . . . . . . . . . . . . . . . . . .   10
    59					;  10. SCAN:. . . . . . . . . . . . . . . . . . . . . . . . .   11
    60					;  11. PR.EX. . . . . . . . . . . . . . . . . . . . . . . . .   12
    61					;  12. CONST: . . . . . . . . . . . . . . . . . . . . . . . .   13
    62					;  13. SSTPP: . . . . . . . . . . . . . . . . . . . . . . . .   14
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 3
SNOPG	MAC	13-Oct-66 22:19		REVISION HISTORY

    63						SUBTTL	REVISION HISTORY
    64
    65					COMMENT	\
    66
    67					START OF VERSION 5.
    68					122	RENAME MODULES & CLEAN UP.
    69					152	Fix possible problem with using a floating address.
    70						Reset the address first before using.
    71					164	Change for unevaluated expressions being compiled out of line.
    72					207	Clean up some of the code in here.
    73					\
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 4
SNOPG	MAC	13-Oct-66 22:19		REVISION HISTORY

    74
    75						SUBTTL	PJOIN: BUILD COMPOSITE PATTERN BLOCK FROM 2 PATTS
    76					;	  SECONDARY-LEVEL SUBROUTINE FOR CATP AND ALT
    77					;
    78	400000'	265 11 0 00 000000*	PJOIN:	JSP	TLINK,CVTPAT##		;MAKE SURE RIGHT ARG OK
    79	400001'	003 01 0 00 000031 		ERROR.	1,25			;   IT'S NOT
    80	400002'	262 01 0 00 000000#		POP	STACK,FLAS##+1		;SAVE RT ARG OFF STACK
    81	400003'	262 01 0 00 000000*		POP 	STACK,FLAS##		;   HOLD AS FLOATING ADDRESS
    82							   ;NOW STACK=LFT ARG, FLAS=RT ARG
    83	400004'	265 11 0 00 400000*		JSP	TLINK,CVTPAT##		;MAKE SURE LEFT ARG OK
    84	400005'	003 01 0 00 000030 		ERROR.	1,24			;   IT'S NOT
    85
    86	400006'	550 07 0 01 777777 		HRRZ	S2,-1(STACK)		;GET NEW BLOCK SIZE
    87	400007'	550 00 0 07 000000 		HRRZ	Z,BLENG(S2)		;   =SIZE OF LEFT ARG
    88	400010'	200 12 0 00 000000 		MOVE	T2,Z			;	(SAVE IT)
    89	400011'	550 07 0 00 400003*		HRRZ	S2,FLAS##
    90	400012'	550 14 0 07 000000 		HRRZ	T4,BLENG(S2)		;   +SIZE OF RT ARG (SV IN T4)
    91	400013'	271 00 0 14 777773 		ADDI	Z,-LPHDR(T4)		;   -LPHDR
    92	400014'	200 10 0 00 000000 		MOVE	S3,Z			;SAVE NEW BLOCK SIZE
    93	400015'	265 15 0 00 000000*		JSP	QLINK,GCOLF##		;ASSURE ENOUGH STORAGE
    94
    95						  ; MOVE LEFT ARG PBLOCK INTO NEW BLOCK AS IS
    96
    97	400016'	514 00 0 01 777777 		HRLZ	Z,-1(STACK)		;"FROM" ADDRESS- LEFT ARG
    98	400017'	554 11 0 00 000000 		HLRZ	T1,Z			;   HOLD ADDRESS
    99	400020'	540 00 0 00 000002 		HRR	Z,SURF			;"TO" ADDRESS- NEW BLOCK
   100	400021'	200 07 0 00 000012 		MOVE	S2,T2			;CALC LAST WORD+1 (ADDR)
   101	400022'	270 07 0 00 000002 		ADD	S2,SURF			;   OF NEW BLOCK- "LWA" +1
   102	400023'	251 00 0 07 777777 		BLT	Z,-1(S2)		;MOVE IT
   103
   104	400024'	542 10 0 02 000000 		HRRM	S3,BLENG(SURF)		;PUT IN THE PROPER SIZE
   105
   106						  ; MOVE BODY OF RT ARG PBLOK INTO NEW BLOCK
   107
   108	400025'	550 13 0 00 400011*		HRRZ	T3,FLAS##		;"FROM" ADDRESS- OLD BLOCK
   109	400026'	205 00 0 13 000005 		MOVSI	Z,LPHDR(T3)		;   FIRST WORD TO MOVE
   110	400027'	540 00 0 00 000007 		HRR	Z,S2			;"TO" ADDRESS- JUST AFTER ABOVE 
   111										;   MOVED BLOCK
   112	400030'	271 07 0 14 777773 		ADDI	S2,-LPHDR(T4)		;GIVES LWA MOVE +1
   113	400031'	251 00 0 07 777777 		BLT	Z,-1(S2)		;   MOVE IT
   114					;
   115					;  NOW REGS CONTAIN:
   116					;	T1=ADDR LFT ARG		T2=SIZE LFT ARG
   117					;	T3=ADDR RT ARG		T4=SIZE RT ARG
   118					;	SURF=FWA NEW BLOCK	S3=SIZE NEW BLOCK
   119					;	S2=LWA NEW BLOCK+1
   120
   121						  ; RELOCATE RIGHT ARG INTERNAL REFS
   122
   123	400032'	201 15 0 14 777773 		MOVEI	Q1,-LPHDR(T4)		;CALC NO WDS IN RT ARG
   124	400033'	242 15 0 00 777776 		LSH	Q1,-2			;CALC NO OF NODES
   125	400034'	275 07 0 14 777773 		SUBI	S2,-LPHDR(T4)		;CALC ADDR FIRST NODE OF
   126										;   RT ARG IN NEW BLOK
   127	400035'	201 00 0 12 777773 		MOVEI	Z,-LPHDR(T2)		;NO OF WORDS IN LEFT BLOK
   128	400036'	504 00 0 00 000000 		HRL	Z,Z			;  MAKE DOUBLE RELOCATER
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 4-1
SNOPG	MAC	13-Oct-66 22:19		PJOIN: BUILD COMPOSITE PATTERN BLOCK FROM 2 PATTS

   129	400037'	272 00 0 07 000001 	PJOIN1:	ADDM	Z,PALT&PSUBS(S2)	;RELOCATE NODE'S POINTERS
   130	400040'	271 07 0 00 000004 		ADDI	S2,PNDSZ		;   NEXT NODE ADDRESS
   131	400041'	367 15 0 00 400037'		SOJG	Q1,PJOIN1		;   COUNT HOW MANY
   132
   133						  ;FIX UP STACK AND SURF
   134
   135	400042'	542 02 0 01 777777 		HRRM	SURF,-1(STACK)		;MAKE TOP STACK ELT POINT
   136										;  TO NEW BLOCK
   137	400043'	250 02 0 00 000007 		EXCH	SURF,S2			;UPDATE SURF TO FREE LOC
   138										;  AFTER NEW BLOK
   139					;
   140					;  EXIT-
   141					;	T1 THRU T4 ARE AS ABOVE
   142					;	S2 = ADDRE OF NEW BLOK
   143					;	SURF = ADDR LWA NEW BLOK+1
   144					;
   145	400044'	254 00 0 06 000000 		JRST	(SLINK)
   146
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 5
SNOPG	MAC	13-Oct-66 22:19		PJOIN: BUILD COMPOSITE PATTERN BLOCK FROM 2 PATTS

   147
   148						SUBTTL	CONCATENATE PATTERNS AT TOP OF STACK
   149	400045'	265 06 0 00 400000'	CATP::	JSP	SLINK,PJOIN		; DO PRELIM JOINING
   150	400046'	200 17 0 13 000004 		MOVE	Q3,PMIN(T3)		;FETCH PMIN OF RT ARG
   151	400047'	272 17 0 07 000004 		ADDM	Q3,PMIN(S2)		;   ADD IT TO RESULT PMIN
   152
   153						  ; SET LEFT ARG SUBS'S TO RT ARG POSIT IN NEW BLOCK
   154
   155	400050'	201 15 0 12 777773 		MOVEI	Q1,-LPHDR(T2)		;NO OF WORDS IN LEFT ARG
   156	400051'	242 15 0 00 777776 		LSH	Q1,-2			;  NO OF NODES TO DO
   157	400052'	201 16 0 07 000005 		MOVEI	Q2,LPHDR(S2)		;ADDR OF FIRST NODE
   158	400053'	204 17 0 00 000017 		MOVS	Q3,Q3			;SET UP RESID INCR IN LHS OF REG
   159	400054'	201 00 0 00 400000 		MOVEI	Z,EMPTY			;SET UP TEST FOR EMPTY
   160	400055'	612 00 0 16 000001 	CATP1:	TDNE	Z,PSUBS(Q2)		;IF EMPTY,
   161	400056'	542 12 0 16 000001 		HRRM	T2,PSUBS(Q2)		;   SET TO RT ARG POSIT
   162	400057'	272 17 0 16 000000 		ADDM	Q3,PRESID(Q2)		;INC RESID BY PMIN OF RT ARG
   163	400060'	271 16 0 00 000004 		ADDI	Q2,PNDSZ		;NEXT NODE ADDRESS
   164	400061'	367 15 0 00 400055'		SOJG	Q1,CATP1		;   COUNT HOW MANY
   165
   166	400062'	254 00 0 04 000001 		JRST	1(PLINK)		;ALL DONE, NORMAL EXIT
   167
   168			400000		EMPTY==400000; FLAG CODE FOR EMPTY ALT/SUBS FIELD
   169
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 6
SNOPG	MAC	13-Oct-66 22:19		BUILD ALTERNATION OF PATTERNS AT TOP OF STACK

   170						SUBTTL	BUILD ALTERNATION OF PATTERNS AT TOP OF STACK
   171
   172	400063'	265 06 0 00 400000'	ALT::	JSP	SLINK,PJOIN		;DO PRELIM JOINING
   173	400064'	200 00 0 13 000004 		MOVE	Z,PMIN(T3)		;PMIN OF NEW =
   174	400065'	315 00 0 07 000004 		CAMGE	Z,PMIN(S2)		;  MIN(PMIN/LFT, PMIN/RT)
   175	400066'	202 00 0 07 000004 		MOVEM	Z,PMIN(S2)
   176
   177						  ; SET EMPTY ALT OF ROOT OF LEFT ARG TO RT ARG
   178
   179	400067'	205 16 0 00 000005 		MOVSI	Q2,LPHDR		;INITIAL PBLOK OFFSET...ROOT
   180	400070'	554 15 0 00 000016 	ALTPB0:	HLRZ	Q1,Q2			;THIS NODE IS AT OFFSET
   181	400071'	270 15 0 00 000007 		ADD	Q1,S2			;   PLUS BLOCK
   182	400072'	200 16 0 15 000001 		MOVE	Q2,PALT(Q1)		;LOAD THIS NODE ALT
   183	400073'	325 16 0 00 400070'		JUMPGE	Q2,ALTPB0		;   LOOP WHILE ALT NOT EMPTY
   184	400074'	506 12 0 15 000001 		HRLM	T2,PALT(Q1)	;FOUND IT- RESET TO ROOT OF RT ARG
   185
   186						  ; FORM COMPOSITE PSTART
   187
   188	400075'	200 00 0 11 000002 		MOVE	Z,PSTART(T1)		;ARE DATA TYPES EQUAL?
   189	400076'	554 15 0 00 000000 		HLRZ	Q1,Z
   190	400077'	430 00 0 13 000002 		XOR	Z,PSTART(T3)
   191	400100'	603 00 0 00 777777 		TLNE	Z,-1
   192	400101'	254 00 0 00 400110'		JRST	ALTPB1			;NO- DIFFERENT DATATYPES
   193	400102'	322 15 0 00 400131'		JUMPE	Q1,ALTPB3		;EQUAL. ARE THEY ZEROS?
   194	400103'	302 15 0 00 002001 		CAIE	Q1,IDT			;EQUAL. WHICH KIND?
   195	400104'	254 00 0 00 400113'		JRST	ALTPB2			;   JMP IF CHAR SET(NOT INT)
   196	400105'	200 15 0 11 000003 		MOVE	Q1,PSTART+1(T1)		;   INTEGERS.. ARE THEY EQL?
   197	400106'	316 15 0 13 000003 		CAMN	Q1,PSTART+1(T3)		;
   198	400107'	254 00 0 00 400131'		JRST	ALTPB3			;   YES, OK TO LEAVE IT
   199
   200	400110'	402 00 0 07 000002 	ALTPB1:	SETZM	PSTART(S2)		;NO GOOD-- HAVE TO
   201	400111'	402 00 0 07 000003 		SETZM	PSTART+1(S2)		;   CLEAR IT OUT
   202	400112'	254 00 0 00 400131'		JRST	ALTPB3
   203
   204	400113'	302 15 0 00 004013 	ALTPB2:	CAIE	Q1,CSDT		;NOT INT,  BETTER  BE CHAR SET
   205	400114'	001 17 0 00 000000 		ERROR	15,0		;SYSTEM ERROR- PSTART NE IDT, NE CSDT
   206	400115'	326 00 0 00 400121'		JUMPN	Z,ALTP2A		;THAT'S OK. SPECIAL EASY CASE?
   207	400116'	200 15 0 13 000003 		MOVE	Q1,PSTART+1(T3)		;  YES. IOR THE MASK WORDS.
   208	400117'	436 15 0 07 000003 		IORM	Q1,PSTART+1(S2)
   209	400120'	254 00 0 00 400131'		JRST	ALTPB3
   210
   211	400121'	261 01 0 11 000002 	ALTP2A:	PUSH	STACK,PSTART(T1)	;HAVE TO REALLY OR THE CHAR-
   212	400122'	261 01 0 11 000003 		PUSH	STACK,PSTART+1(T1)	;   ARACTER SETS THE HARD WAY
   213	400123'	261 01 0 13 000002 		PUSH	STACK,PSTART(T3)
   214	400124'	261 01 0 13 000003 		PUSH	STACK,PSTART+1(T3)
   215	400125'	265 11 0 00 000000*		JSP	TLINK,ORCSET##
   216	400126'	550 06 0 01 777775 		HRRZ	S1,-3(STACK)		;GET BACK OUR BLOK ADDRESS
   217	400127'	262 01 0 06 000003 		POP	STACK,PSTART+1(S1)	;   PUT NEW DESCR INTO
   218	400130'	262 01 0 06 000002 		POP	STACK,PSTART(S1)	;     RESULTANT BLOK'S PSTART
   219
   220	400131'	254 00 0 04 000001 	ALTPB3:	JRST	1(PLINK)		;ALL DONE-- NORMAL  EXIT
   221
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 7
SNOPG	MAC	13-Oct-66 22:19		ARBNO:	SYNTHESIZE COMPOSITE PBLOK PATT

   222						SUBTTL	ARBNO:	SYNTHESIZE COMPOSITE PBLOK PATT
   223					;
   224					;  CALLING SEQUENCE:
   225					;	  PUSH STACK, DESCR FOR PATT ARG
   226					;	  JSP  PLINK,ARBNO##
   227					;  RETURN:
   228					;	  PATT ARG GONE FROM STACK, REPL BY RESULT PBLOK DESCR
   229					;
   230	400132'	265 11 0 00 400004*	ARBNO::	JSP	TLINK,CVTPAT##		;ARG ON TOP OF STACK CV TO PATT
   231	400133'	003 01 0 00 000062 		ERROR.	1,50			;   ARBNO PARAM NOT PATT
   232	400134'	200 05 0 01 777777 		MOVE	P2,-1(STACK)		;ASSURE SUFFICIENT STG-
   233	400135'	550 05 0 05 000000 		HRRZ	P2,BLENG(P2)		;   P2=PBLOK SIZE
   234	400136'	201 00 0 05 000010 		MOVEI	Z,2*PNDSZ(P2)		;   Z=NEW BLK SIZE(ADD 2 NILS)
   235	400137'	265 15 0 00 400015*		JSP	QLINK,GCOLF##		;   NOW GUARANTEE THAT MUCH
   236	
   237						  ;  MOVE PARAM PATT P INTO NEW PBLOK
   238
   239	400140'	550 12 0 01 777777 		HRRZ	T2,-1(STACK)		;SAVE PARAM PATT ADD IN T2
   240	400141'	204 00 0 00 000012 		MOVS	Z,T2			;PARAM PATT ADDR IN Z LEFT
   241	400142'	540 00 0 00 000002 		HRR	Z,SURF			;NEW BLK ADDR IN Z RIGHT
   242	400143'	270 00 0 00 400207'		ADD	Z,OFFSET		;  OFFSET THOSE ADDRS OVER HEADS
   243	400144'	200 11 0 00 000005 		MOVE	T1,P2			;T1=OLD PATT BLK SIZE
   244	400145'	270 11 0 00 000000 		ADD	T1,Z			;ADDR OF WD AFTER END OF NEW BL
   245	400146'	251 00 0 11 777772 		BLT	Z,-1-LPHDR(T1)		;   NOW MOVE IT
   246
   247						  ;  SET UP FIRST WORD OF NEW BLOK
   248	400147'	200 00 0 12 000000 		MOVE	Z,BTCODE&BLENG(T2)	;LOAD OLD BLOKHEAD
   249	400150'	271 00 0 00 000010 		ADDI	Z,2*PNDSZ		;   INC BY SIZE INCRMNT
   250	400151'	202 00 0 02 000000 		MOVEM	Z,(SURF)		;STORE IN NEW BLOK
   251
   252						  ;  MOVE A FEW ZEROS AND TWO NIL BLOCKS INTO NEW PATT
   253	400152'	201 00 0 02 000001 		MOVEI	Z,GCFLD(SURF)		;ADDR AFTER NEW BLK HEAD
   254	400153'	505 00 0 00 400173'		HRLI	Z,NILBLK		;ADDR OF PROTO NIL BLOKS
   255	400154'	251 00 0 02 000014 		BLT	Z,PPAT-1(SURF)		;  PUT THE NILS WHERE THEY BELONG
   256
   257						  ; SET UP TO RELOCATE A,S PTRS; ALSO CHG SUBS FLDS
   258	400155'	201 00 0 05 777773 		MOVEI	Z,-LPHDR(P2)		;PUT PBLOK SIZE IN Z
   259	400156'	242 00 0 00 777776 		LSH	Z,-2			;  LOOP COUNT IS SZ/4
   260	400157'	200 11 0 00 401031'		MOVE	T1,[XWD 2*PNDSZ,2*PNDSZ]	;INIT FOR INC INSIDE LOOP
   261	400160'	201 12 0 00 000011 		MOVEI	T2,NIL2			;  INIT FOR ADDR SUBST INSIDE LOOP
   262	400161'	201 06 0 02 000015 		MOVEI	S1,PPAT(SURF)		;  S1=FIRST LOC TO CHG
   263	400162'	201 10 0 00 400000 		MOVEI	S3,EMPTY		;   MORE SETUP FOR THE LOOP
   264
   265	400163'	272 11 0 06 000001 	ARBNO4:	ADDM	T1,PALT&PSUBS(S1)	;RELOCATE THE INTERNAL REFS
   266	400164'	612 10 0 06 000001 		TDNE	S3,PSUBS(S1)		;  IF SGN OF SUBS SET,
   267	400165'	542 12 0 06 000001 		HRRM	T2,PSUBS(S1)		;	MAKE IT POINT TO NIL2
   268	400166'	271 06 0 00 000004 		ADDI	S1,PNDSZ		;BUMP PATT WORD POINTER
   269	400167'	367 00 0 00 400163'		SOJG	Z,ARBNO4		;   AND LOOP TIL DONE
   270
   271						;  UPDATE SURF AND DESCR ON STACK
   272	400170'	542 02 0 01 777777 		HRRM	SURF,-1(STACK)		;MAKE DESC PNT TO NE BLK
   273	400171'	271 02 0 05 000010 		ADDI	SURF,2*PNDSZ(P2)	;BUMP SURF BY SZ OF NEW BLK
   274
   275	400172'	254 00 0 04 000001 		JRST	1(PLINK)		;RETURN OK.  WE CAN'T FAIL
   276
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 7-1
SNOPG	MAC	13-Oct-66 22:19		ARBNO:	SYNTHESIZE COMPOSITE PBLOK PATT

   277
   278	400173'				NILBLK:	REPEAT	LPHDR-1,<0>		;HDR = 0 EXC SZ WD FRST
   279	400173'	000000	000000
   280	400174'	000000	000000
   281	400175'	000000	000000
   282	400176'	000000	000000
   283	400177'	000000	400512'			XWD	0,SC.S		;NIL BLOCK 1  RESID/PGM
   284	400200'	400000	000011			XWD	EMPTY,NIL2		;ALT(NONE)/SUBS
   285	400201'	000000	000000			OCT	0,0			;  ARG DESCR (NONE)
   286	400202'	000000	000000
   287	400203'	000000	400512'			XWD	0,SC.S		;NIL BLOCK 2  RESID/PGM
   288	400204'	000015	400000			XWD	PPAT,EMPTY		;ALT(PPAT)/SUBS(NONE)
   289	400205'	000000	000000			OCT	0,0
   290	400206'	000000	000000
   291
   292	400207'	000005	000015		OFFSET:	XWD	LPHDR,PPAT		;DOUBLE-ADDRESS OFFSET
   293
   294			000005		NIL1==LPHDR		;REL POS OF NILBLK 1
   295			000011		NIL2==NIL1+PNDSZ	;REL POS OF NILBLK 2
   296			000015		PPAT==NIL2+PNDSZ	;REL POS OF PARAM PATT(NEWB)
   297
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 8
SNOPG	MAC	13-Oct-66 22:19		ARBNO:	SYNTHESIZE COMPOSITE PBLOK PATT

   298
   299						SUBTTL	VA SYNTHESIZE VARIABLE ASSOC PBLOKS
   300					;
   301					;	CALLING SEQUENCE:
   302					;	   FOR OPERATION N = P . V (OR P $ V)
   303					;	  PUSH  STK,P
   304					;	  PUSH	STK,V
   305					;	  JSP	PLINK,CNVA  (OR IMVA)
   306					;	RETURN:
   307					;	  N IS LEFT ON THE STK
   308					;	  WE CAN'T FAIL IN THIS ENDEAVOUR
   309					;	  THUS ALWAYS RETURN TO CALL+2
   310					;
   311
   312
   313					;	  -------------------------------
   314					;	  IMMEDIATE VARIABLE ASSOCIATION
   315					;	  ------------------------------
   316
   317	400210'	505 04 0 00 000000*	IMVA::	HRLI	PLINK,PR.IN2##		;USE IMMED NAMING NODE PRIM
   318	400211'	254 00 0 00 400213'		JRST	VA
   319
   320					;	  --------------------------------
   321					;	  CONDTIONAL VARIABLE ASSOCIATION
   322					;	  --------------------------------
   323
   324	400212'	505 04 0 00 000000*	CNVA::	HRLI	PLINK,PR.CN2##		;USE CONDIT NAMING NODE PRIM
   325
   326						  ; VALIDATE AND PROCESS RIGHT ARG
   327
   328	400213'	554 00 0 01 777777 	VA:	HLRZ	Z,-1(STACK)	;CHECK RT ARG
   329	400214'	302 00 0 00 064000 		CAIE	Z,VAR		;OK IF VAR...
   330	400206 00 0 00 034000 		CAIN	Z,TVAR		;OK IF TRAPPED VAR
   331	400216'	254 00 0 00 400224'		JRST	VA1		;  JP IF SO
   332
   333	400217'	265 11 0 00 000000*		JSP	TLINK,CVTVAL	; INSURE A VALUE
   334	400220'	001 17 0 00 000000 		ERROR	15		; THIS SHOULDN'T HAPPEN
   335	400221'	554 00 0 01 777777 		HLRZ	Z,-1(STACK)	; GET DATATYPE
   336	400222'	302 00 0 00 004006 		CAIE	Z,EDT		; OK IF EXPRESSION
   337	400223'	001 16 0 00 000006 		ERROR	14,6		;OTHERWISE TOO BAD
   338
   339	400224'	262 01 0 00 000000#	VA1:	POP	STACK,FLAS##+1		;SAVE OBJECT OF ASSIGNMENT
   340	400225'	262 01 0 00 400025*		POP	STACK,FLAS##		;  FOR A MOMENT
   341
   342						  ; VALIDATE AND PROCESS LEFT ARG
   343
   344	400226'	265 11 0 00 400217*		JSP	TLINK,CVTVAL		;MAKE SURE WE HAVE VALUE
   345	400227'	254 00 0 00 000000*		JRST	FRET1##		; FAIL IF NOT
   346	400230'	265 11 0 00 400132*		JSP	TLINK,CVTPAT		;IT'S NOW ON TOP. CHK IT'S PATTERN
   347	400231'	003 01 0 00 000046 		ERROR.	1,38		;  WASN'T. TOO BAD.
   348
   349						  ;MAKE SURE THERE'S ENOUGH ROOM
   350
   351	400232'	200 06 0 01 777777 		MOVE	S1,-1(STACK)		;OBTAIN ADDR OF P
   352	400233'	550 07 0 06 000000 		HRRZ	S2,BLENG(S1)		;OBTAIN LENGTH OF P
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 8-1
SNOPG	MAC	13-Oct-66 22:19		VA SYNTHESIZE VARIABLE ASSOC PBLOKS

   353	400234'	275 07 0 00 000005 		SUBI	S2,LPHDR		;  LESS HDR GIVES NWDS IN NODES
   354	400235'	201 00 0 07 000015 		MOVEI	Z,LPHDR+NINC(S2)	;GET TOTAL SIZE OF NEW BLK
   355	400236'	265 15 0 00 400137*		JSP	QLINK,GCOLF		;  ASSURE ENOUGH STG FOR NEW BLK
   356
   357						  ;NEW HEADER = P'S HEADER, MOSTLY
   358
   359	400237'	200 06 0 01 777777 		MOVE	S1,-1(STACK)		;HOLD ADDR OF P
   360	400240'	204 00 0 00 000006 		MOVS	Z,S1		;ZLEFT = P'S TOP
   361	400241'	540 00 0 00 000002 		HRR	Z,SURF		;ZRIGHT = N'S TOP
   362	400242'	251 00 0 02 000004 		BLT	Z,LPHDR-1(SURF)	;SET N'S HDR = P'S HDR
   363	400243'	201 00 0 00 000010 		MOVEI	Z,NINC		;BUMP SIZE OF P BY NINC
   364	400244'	272 00 0 02 000000 		ADDM	Z,BLENG(SURF)	;   GIVING SIZE OF N
   365
   366						  ;PLACE THE TWO SPECIAL NILS AT THE TOP OF THE BLK
   367
   368	400245'	205 00 0 00 400300'		MOVSI	Z,NAMN		;ZLEFT = NAMING'S NIL BLOCKS
   369	400246'	541 00 0 02 000005 		HRRI	Z,NN1(SURF)	;ZRIGHT=POSITION IN N BLOK
   370	400247'	251 00 0 02 000012 		BLT	Z,NN2+1(SURF)	;MOVE IN THE 2 NIL NODES
   371	400250'	546 04 0 02 000011 		HLRM	PLINK,NN2(SURF)	;SET THE PROPER KIND OF NODE2
   372	400251'	200 00 0 02 000004 		MOVE	Z,PMIN(SURF)	;SET RESID OF NIL1 = PMIN OF P
   373	400252'	506 00 0 02 000005 		HRLM	Z,PRESID+NN1(SURF)	;  THERE IT GOES
   374	400253'	205 00 0 00 400225*		MOVSI	Z,FLAS		;MOVE THE VAR
   375	400254'	541 00 0 02 000013 		HRRI	Z,NN2+PARG(SURF)	;  INTO THE ARG SPOT
   376	400255'	251 00 0 02 000014 		BLT	Z,NN2+PARG+1(SURF)     ;   OF NIL NODE 2
   377
   378						  ;MOVE P INTO ITS POSITION IN N
   379
   380	400256'	205 00 0 06 000005 		MOVSI	Z,LPHDR(S1)		;ADDR OF 1ST NODE IN P
   381	400257'	541 00 0 02 000015 		HRRI	Z,NPPAT(SURF)		;ADDR FOR THAT NODE IN N
   382	400260'	201 11 0 07 000015 		MOVEI	T1,LPHDR+NINC(S2)	;CALC ADDR OF END OF N
   383	400261'	270 11 0 00 000002 		ADD	T1,SURF			;  PLUS ONE
   384	400262'	251 00 0 11 777777 		BLT	Z,-1(T1)		;MOVE P INTO N.
   385
   386						  ;RELOCATE P'S INTERNAL REFS AND
   387						  ;CHANGE EMPTY SUBSEQ'S TO NN2
   388
   389	400263'	201 06 0 02 000015 		MOVEI	S1,NPPAT(SURF)	;ADDR OF 1ST NODE TO FIX
   390	400264'	242 07 0 00 777776 		LSH	S2,-2		;NUMBER OF NODES TO FIX
   391	400265'	200 00 0 00 401031'		MOVE	Z,[XWD 2*PNDSZ,2*PNDSZ]	;FIX NODE REFS W/THIS
   392	400266'	201 15 0 00 400000 		MOVEI	Q1,EMPTY		;THIS TESTS IF SUBS IS EMPTY
   393	400267'	201 16 0 00 000011 		MOVEI	Q2,NN2		;THIS IS WHAT EMPTY SUBS BECOMES
   394
   395	400270'	272 00 0 06 000001 	VA2:	ADDM	Z,PALT&PSUBS(S1)	;RELOCATE NODE REFS
   396	400271'	612 15 0 06 000001 		TDNE	Q1,PSUBS(S1)		;IS SUBSEQ EMPTY?
   397	400272'	542 16 0 06 000001 		HRRM	Q2,PSUBS(S1)		;   IF SO, CHG TO REF NIL2
   398	400273'	271 06 0 00 000004 		ADDI	S1,PNDSZ		;BUMP ADDR TO NEXT NODE
   399	400274'	367 07 0 00 400270'		SOJG	S2,VA2		;  AND COUNT NODES
   400
   401
   402						  ;FINISH UP AND LEAVE
   403
   404	400275'	542 02 0 01 777777 		HRRM	SURF,-1(STACK)	;CHG DESCR ON STK TO BE N
   405	400276'	200 02 0 00 000011 		MOVE	SURF,T1		;  CHG SURF TO ALLOCATE N'S BLOK
   406	400277'	254 00 0 04 000001 		JRST	1(PLINK)		;WE ALWAYS SUCCEED.
   407
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 8-2
SNOPG	MAC	13-Oct-66 22:19		VA SYNTHESIZE VARIABLE ASSOC PBLOKS

   408
   409						;  PROTOTYPE BLOK FOR THE NIL REGIONS
   410
   411			000005		NN1==LPHDR		;NAME OF NAMING NILBLK 1. JUST BELOW HDR
   412	400300'	000000	000000*		NAMN:	XWD	0,PR.XN1##	;RESID/PROG
   413	400301'	400000	000015			XWD	EMPTY,NPPAT
   414						REPEAT	PNDSZ-2,<0>	;ARG SPACE
   415	400302'	000000	000000
   416	400303'	000000	000000
   417			000011		NN2==NN1+PNDSZ		;NAME OF NAMING NILBLK 2.
   418	400304'	000000	400212*			XWD	0,PR.CN2## ;OR PR.IN2##	;RESID/PROG	PGM ADDR TO BE SET
   419	400305'	400000	400000			XWD	EMPTY,EMPTY	;ALT/SUBS
   420
   421							; HERE GOES THE VARIABLE ARG
   422
   423			000015		NPPAT==NN2+PNDSZ		;NAME OF NAMING P PATTERN
   424			000010		NINC==NPPAT-LPHDR		;SIZE INCREASE OVER ORIG PATT P
   425
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 9
SNOPG	MAC	13-Oct-66 22:19		VA SYNTHESIZE VARIABLE ASSOC PBLOKS

   426
   427						SUBTTL	PPRTBL	PRIMITIVES' ADDRESSES FOR VARIOUS SCAN FAILS
   428
   429						DEFINE	PPENT(X)		<;;GEN PPRTBL ENTRY
   430					D.'X==:.-PPRTBL				;;DEFINE NEG INDEX
   431						IF2 , <IFNDEF PR.'X, <EXTERN PR.'X>>  ;;EXT IF NOT IN THIS PROG
   432						EXP	PR.'X			;;ASSEBMLE IN PRIM'S ADDR>
   433
   434
   435	400306'	000000	400522'			PPENT	(LF)		;LENGTH FAILER
   436	400307'	000000	400607'			PPENT	(EX2)		;UNEVALEX UNRECURSER
   437	400310'	000000	400621'			PPENT	(EX3)		;UNEVALEX RE-RECURSER
   438	400311'	000000000000#			PPENT	(IB2)		;IMMED NAMING BACKUP
   439	400312'	000000000000#			PPENT	(CB2)		;CONDIT NAMING BACKUP
   440	400313'	000000000000#			PPENT	(XB1)		;BOTH NAMING BACKUP #1
   441	400314'	000000	400463'			PPENT	(FUF)	; FULLSCAN UNANCHORED FAILURE
   442	400315'	000000	400470'			PPENT	(CSF)	; CHARACTER SET SCAN FAILURE
   443	400316'	000000	400473'			PPENT	(GAF)	; GLOBAL ANCHORED FAILURE
   444	400317'	000000	400461'			PPENT	(GUF)	; GLOBAL UNANCHORED FAILURE
   445	400320'	000000	400703'			PPENT	(AFL)	; ARB FAIL (GLOBAL)
   446	400321'				PPRTBL:		;THIS LABEL MUST FOLLOW THE TABLE
   447
   448						INTERN	D.EX3
   449
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 10
SNOPG	MAC	13-Oct-66 22:19		PPRTBL	PRIMITIVES' ADDRESSES FOR VARIOUS SCAN FAILS

   450
   451						SUBTTL	MTCH	OVERALL CONTROLLER FOR "?" BINOP
   452					;
   453					;  CALLING SEQUENCE:
   454					;	SET UP HSTACK AND NSTACK'S INITIAL VALUES
   455					;	PUSH	STACK,DESCR FOR SUBJ STR
   456					;	PUSH	STACK,DESCR FOR PATTERN
   457					;	JSP	PLINK,MTCH##
   458					;  RECURSION IS OK ONLY IF "SAVEM" IS PUSHED, RE-INITIALIZED,
   459					;    USED, AND FINALLY POPPED BACK
   460					;  HSR MUST ALWAYS CONTAIN THE RIGHT VALUES WHILE A MATCH IS RUNNING
   461					;    IT IS INITIALIZED AT THE TOP OF MTCH AND MUST BE PROPERLY
   462					;    MAINTAINED THROUGH RECURSION PROCEEDINGS
   463					;  MTCH SAVES EXIT ADDRESS IN MADSAV(LEFT), WHICH IS A RECUR-
   464					;    SION-PROTECTED VARIABLE.
   465					;  MTCH SAVES INITIAL VALUE OF &FULLSCAN IN FULSAV (RIGHT),
   466					;    WHICH IS A MATCH-RECURSION PROTECTED VARIABLE.  THUS YOU
   467					;    CAN'T CHANGE THE VALUE OF &FULLSCAN IN THE MIDDLE OF
   468					;    A MATCH.
   469					;
   470					;	RETURNS TO CALL+1 IF MATCH FAILS OR ABORTS.  ARGS POPPED.
   471					;	RETURN TO CALL+2 WITH TVAR FOR MATCHED SUBSTR ON
   472					;	  THE STACK IN CASE OF SUCCESS
   473					;
   474					;
   475					;
   476					;  DEDICATED USE OF IGNOP AND FLAP DURING MATCHING
   477					;  -----------------------------------------------
   478					;
   479			000000*		MADSAV== IGNOP##	; (LEFT); MTCH RETURN ADDRESS
   480			000000*		FULSAV== IGNOP##	;(RIGHT); MTCH SAMPLED-AND-HELD VALUE OF FULLSCAN
   481		000000000000#		NSSAVE== IGNOP##+1	;  SAVED INIT POS OF NAME STACK
   482		000000000000#		SSSAVE=IGNOP+2	;  SAVED INIT POS OF SYSTEM STACK
   483
   484			000000*		SUBVAR==FLAP##		;  SAVED SUBJECT OF MATCH UNDER GUISE OF VARIABLE
   485					;
   486					;  -----------------------------------------------
   487					;
   488
   489					;
   490					;	  FIRST, MAKE SURE RT ARG IS PATTERN
   491					;
   492	400321'	516 04 0 00 000000*	MTCH::	HRLZM	PLINK,MADSAV		;SAVE MATCH RET ADDR
   493	400322'	265 11 0 00 400226*		JSP	TLINK,CVTVAL		;GET THE VALUE OF RT ARG
   494	400323'	254 00 0 00 000000*		JRST	FRET2##		; FAIL IF IT FAILS
   495	400324'	265 11 0 00 400230*		JSP	TLINK,CVTPAT##		;  ENSURE PATTERN
   496	400325'	003 01 0 00 000024 		ERROR.	1,20			;    DIDN'T WORK- NOT PATT
   497	400326'	262 01 0 00 000000 	MTCH1:	POP	STACK,Z			;HAVE A GOOD PATT ARG
   498	400327'	262 01 0 00 000000*		POP 	STACK,PATT##		;  PUT IT AWAY FOR LATER
   499
   500	400330'	262 01 0 00 000000#		POP	STACK,SUBVAR+1	; SAVE SUBJECT
   501	400331'	262 01 0 00 000000*		POP	STACK,SUBVAR	; FOR LATER
   502	400332'	270 01 0 00 401032'		ADD	STACK,[2,,2]	; PUT IT BACK ON
   503
   504	400333'	265 11 0 00 400322*	MTCH1A:	JSP	TLINK,CVTVAL##		;ASSURE IT'S NOW A VALUE
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 10-1
SNOPG	MAC	13-Oct-66 22:19		MTCH	OVERALL CONTROLLER FOR "?" BINOP

   505	400334'	254 00 0 00 400227*		JRST	FRET1##		; FAIL IF SUBJ FAIL
   506	400335'	265 11 0 00 000000*		JSP	TLINK,CVTSTR##		;MAKE SURE WE HAVE A STRING TO SCAN
   507	400336'	003 01 0 00 000023 		ERROR.	1,19			;LEFT ARG OF MTCH NOT STRING
   508
   509	400337'	402 00 0 00 000000*		CLEARM	CURSOR##		; IN CASE NULL
   510	400340'	265 11 0 00 000000*		JSP	TLINK,STINIT##		; INIT FOR STREAMING THRU LFT ARG
   511	400341'	274 01 0 00 401032'		SUB	STACK,[2,,2]	; POP VALUE
   512					;
   513					;	  OTHER MISCELLANEOUS SETUPS
   514					;
   515	400342'	505 15 0 00 777775 		HRLI	Q1,D.GAF	; ANCHOR FAILURE TENTATIVE
   516	400343'	332 05 0 00 000000*		SKIPE	P2,$FULL##	; &FULLSCAN?
   517	400344'	201 05 0 00 000001 		MOVEI	P2,1		; YES
   518	400345'	542 05 0 00 400321*		HRRM	P2,FULSAV		;  AND SAVE FOR WHOLE MATCH
   519	400346'	200 00 0 00 400337*		MOVE	Z,CURSOR		;INIT MAX STR LENGTH
   520	400347'	202 00 0 00 000000*		MOVEM	Z,MAXLEN##		;  TO TOTAL STR LENGTH
   521	400350'	200 00 0 00 000000*		MOVE	Z,NSTACK##		;SAVE NAME STACK START POS
   522	400351'	202 00 0 00 000000#		MOVEM	Z,NSSAVE		;  FOR THE POST-PROCESSOR
   523	400352'	200 03 0 00 000000*		MOVE	HSR,HSTACK##		;INIT HIST STK REGISTER
   524	400353'	202 01 0 00 000000#		MOVEM	STACK,SSSAVE		;  DITTO. THUS CAN RESTORE ENVIRONS
   525	400354'	336 00 0 00 000000*		SKIPN	$ANCH##		; ON &ANCHOR
   526	400355'	336 00 0 00 400346*		SKIPN	CURSOR		; OR NULL
   527	400356'	254 00 0 00 400415'		JRST	MTCH4		; BYPASS THIS HACKING
   528					;
   529					;	  UNANCHORED SETUP -- SPECIAL CURSOR MOTION
   530					;
   531	400357'	550 00 0 00 400345*	MTCH2:	HRRZ	Z,FULSAV		;BYPASS SPECIAL IF FULLSCAN
   532	400360'	326 00 0 00 400414'		JUMPN	Z,MTCH3			;   FLAG WAS SET
   533	400361'	200 05 0 00 400327*		MOVE	P2,PATT			;CHECK WHERE CURSOR IS TO START LIFE
   534	400362'	200 10 0 05 000003 		MOVE	S3,PSTART+1(P2)		;   PICK UP ARG FOR LATER
   535	400363'	554 07 0 05 000002 		HLRZ	S2,PSTART(P2)		;CHECK STARTER'S DATA TYPE
   536	400364'	205 15 0 00 777776 		MOVSI	Q1,D.GUF	; SET FAIL AS UNANCHORED
   537	400365'	322 07 0 00 400415'		JUMPE	S2,MTCH4		;   NO SPECIAL STARTING POINT
   538	400366'	306 07 0 00 004013 		CAIN	S2,CSDT			;   TRY CHAR SET
   539	400367'	254 00 0 00 400406'		JRST	MTCH2A			;     YES, GO SCAN FOR IT
   540	400370'	205 15 0 00 777775 		MOVSI	Q1,D.GAF	; FAIL IS LIKE &ANCHOR
   541	400371'	325 10 0 00 400375'		JUMPGE	S3,MTCH2J		;   NO, INTEGER. OK IF POSITIVE
   542	400372'	270 10 0 00 400347*		ADD	S3,MAXLEN		;    NEG-RPOS/RTAB-COUNT BACKW
   543	400373'	271 10 0 00 000001 		ADDI	S3,1			;    THAT NEG WAS 1'S COMPL
   544	400374'	321 10 0 00 400473'		JUMPL	S3,PR.GAF	; JUMP IF STRING TOO SMALL
   545	400375'	274 10 0 00 400355*	MTCH2J:SUB	S3,CURSOR		;MOVE CURSOR TO RIGHT PLACE
   546	400376'	327 10 0 00 400473'		JUMPG	S3,PR.GAF	; JUMP IF STRING TOO SMALL
   547	400377'	212 10 0 00 400375*		MOVNM	S3,CURSOR		;   SUB WAS BACKW- COMPL&STR
   548
   549	400400'	270 10 0 00 400372*		ADD	S3,MAXLEN		;NOW S3=MAXLEN-CURSOR
   550	400401'	231 10 0 00 000005 		IDIVI	S3,5			;S3=WORDS, S3+1=BYTES
   551	400402'	272 10 0 00 000000*		ADDM	S3,STPTR##		;  BUMP PTR BY WORD COUNT
   552
   553	400403'	361 11 0 00 400415'		SOJL	S3+1,MTCH4		;EXIT LOOP WHEN BYTE CNT LE 0
   554	400404'	133 00 0 00 400402*		IBP	STPTR##			;  INC BYTEWISE ONCE PER
   555	400405'	254 00 0 00 400403'		JRST	.-2			;  BYTE LEFTOVER AFTER WORDS DONE
   556
   557
   558	400406'	200 05 0 00 400361*	MTCH2A:	MOVE	P2,PATT		; LOAD PATTERN ADDR
   559	400407'	200 10 0 05 000003 		MOVE	S3,PSTART+1(P2) ; LOAD MASK
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 10-2
SNOPG	MAC	13-Oct-66 22:19		MTCH	OVERALL CONTROLLER FOR "?" BINOP

   560	400410'	200 07 0 05 000002 		MOVE	S2,PSTART(P2)	;STREAM FOR THE CHAR SET
   561	400411'	265 11 0 00 000000*		JSP	TLINK,STR.##		;  THAT STARTS THIS MATCH
   562	400412'	254 00 0 00 400473'		JRST	PR.GAF			;NO FIND- GO FAIL
   563
   564	400413'	334 15 0 00 401033'		SKIPA	Q1,[D.CSF,,0]	; BACK HERE ON FAIL
   565
   566						 ; HERE IF &FULLSCAN
   567
   568	400414'	505 15 0 00 777773 	MTCH3:	HRLI	Q1,D.FUF	; FULLSCAN RETRY
   569					;
   570					;	  INIT STACK BOTTOM AND RUN THE SCAN
   571					;
   572	400415'	540 15 0 00 400377*	MTCH4:	HRR	Q1,CURSOR		;PLACE STACK BOTTOM
   573	400416'	261 03 0 00 000015 		PUSH	HSR,Q1			;  SHOWING FAILURE TYPE
   574	400417'	261 03 0 00 400404*		PUSH	HSR,STPTR##		;  AND RESTART POSITION
   575
   576	400420'	201 00 0 00 000005 		MOVEI	Z,LPHDR			;START PATT
   577	400421'	202 00 0 00 000000#		MOVEM	Z,PATT+1		;  POINTING TO ROOT NODE
   578	400422'	476 00 0 00 000000*		SETOM	FUTILE##			;AND SET LENGTH FUTILITY ON
   579
   580	400423'	265 05 0 00 400500'		JSP	P2,SCAN			;TRY THE SCAN
   581
   582					;	  SUCCESS RETURN
   583
   584					;	  MAKE UP UBLOCK SHOWING RESULT OF SUCCESS
   585
   586			000010		UBLKZ==LHDR+6			;SIZE OF OUR UBLOK
   587
   588	400424'	201 00 0 00 000010 		MOVEI	Z,UBLKZ			;ASSURE ENOUGH ROOM
   589	400425'	265 15 0 00 400236*		JSP	QLINK,GCOLF##		;  FOR A 3-DESCR UBLOK
   590	400426'	505 00 0 00 000414 		HRLI	Z,UTBLOK		;MAKE UP BLOK HDR
   591	400427'	202 00 0 02 000000 		MOVEM	Z,BTCODE&BLENG(SURF)	;  = UBLOK/SIZE
   592	400430'	402 00 0 02 000001 		SETZM	GCFLD(SURF)		;GARB FLD = 0
   593	400431'	201 00 0 02 000002 		MOVEI	Z,SSVAL(SURF)		;POSITION OF SUBJ IN NEW BLK
   594	400432'	505 00 0 00 000000*		HRLI	Z,SUBJ##		;REGULAR POS OF SUBJ
   595	400433'	251 00 0 02 000003 		BLT	Z,SSVAL+1(SURF)		;MOVE SUBJ TO UBLK
   596	400434'	201 00 0 02 000004 		MOVEI	Z,SSVAR(SURF)		;POS OF SUBJ/VAR IN NEW BLK
   597	400435'	505 00 0 00 400331*		HRLI	Z,SUBVAR		;POS OF SUBJ/VAR NOW
   598	400436'	251 00 0 02 000005 		BLT	Z,SSVAR+1(SURF)		;MOVE SUBJ/VAR INTO NEW BLOK
   599	400437'	402 00 0 02 000006 		SETZM	<SSHEAD&SSCURS>-1(SURF)	;STR POS INDIC- WD1=0
   600	400440'	200 00 0 00 400415*		MOVE	Z,CURSOR		;   POS AT END OF MTCH
   601	400441'	200 15 0 00 400352*		MOVE	Q1,HSTACK		;   POS AT STRT OF MTCH
   602	400442'	504 00 0 15 000001 		HRL	Z,1(Q1)			;     KEPT ON BOTT OF HIST STK
   603	400443'	202 00 0 02 000007 		MOVEM	Z,SSHEAD&SSCURS(SURF)	;   PUT IT AWAY
   604	400444'	271 02 0 00 000010 		ADDI	SURF,UBLKZ		;AND BUMP SURF PAST THE NEW BLK
   605
   606					;	  MAKE UP TVAR POINTING TO UBLOK AND SSTPP
   607
   608	400445'	201 00 0 02 777770 		MOVEI	Z,-UBLKZ(SURF)		;POSIT OF UBLOK
   609	400446'	505 00 0 00 034000 		HRLI	Z,TVAR			;  FLAG THAT VAR IS TRAPPED
   610	400447'	261 01 0 00 000000 		PUSH 	STACK,Z			;RETURN IT ON THE STACK
   611	400450'	261 01 0 00 401034'		PUSH	STACK,[XWD 0,SSTPP]	;  BOTTOM OF TVAR IS PROG ADDR
   612
   613					;	  PERFORM CONDITIONAL VARIABLE ASSIGNMENTS
   614					;
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 10-3
SNOPG	MAC	13-Oct-66 22:19		MTCH	OVERALL CONTROLLER FOR "?" BINOP

   615
   616	400451'	200 07 0 00 000000#		MOVE	S2,NSSAVE		;SET UP PORTION OF NAMESTACK
   617	400452'	550 10 0 00 400350*		HRRZ	S3,NSTACK		;  THAT WE'VE USED
   618	400453'	202 07 0 00 400452*		MOVEM	S2,NSTACK		;  AND RELEASE IT NOW
   619	400454'	505 07 0 00 000000 		HRLI	S2,0		;PNAMEL WANTS ADDRS ONLY
   620	400455'	265 06 0 00 000000*		JSP	SLINK,PNAMEL##		;AND GO PROCESS IT
   621
   622					;
   623					;	  ALL DONE -- RETURN SUCCESS
   624					;
   625	400456'	200 03 0 00 400441*		MOVE	HSR,HSTACK		;RESTORE H.S. TO ORIG CONDIT
   626	400457'	554 04 0 00 400357*		HLRZ	PLINK,MADSAV		;FETCH BACK OUR RETURN ADDRESS
   627	400460'	254 00 0 04 000001 		JRST	1(PLINK)		;  AND MAKE SUCCESS RETURN
   628					;
   629					;	SCAN FAILURE POINTS
   630					;
   631
   632						 ; UNANCHORED FAILURE (NON CHARACTER SET)
   633
   634	400461'	332 00 0 00 400422*	PR.GUF:	SKIPE	FUTILE			;  IF THE MATCH IS FUTILE,
   635	400462'	254 00 0 00 400473'		JRST	PR.GAF		; DIE
   636	
   637	400463'	200 15 0 03 000001 	PR.FUF:	MOVE	Q1,1(HSR)	; PICK UP RETRY ADDR
   638	400464'	133 00 0 00 400417*		IBP	STPTR##			;BUMP STR POSIT
   639	400465'	371 00 0 00 400440*		SOSL	CURSOR			;  TO NEXT CHAR
   640	400466'	254 00 0 00 400415'		JRST	MTCH4			;  AND TRY AGAIN
   641	400467'	254 00 0 00 400473'		JRST	PR.GAF		; GLOBAL FAIL IF CURSOR GOES NEG
   642
   643						 ; CHARACTER SET RETRY
   644
   645	400470'	133 00 0 00 400464*	PR.CSF:	IBP	STPTR##		; BUMP POINTER
   646	400471'	371 00 0 00 400465*		SOSL	CURSOR		; BUMP CURSOR
   647	400472'	254 00 0 00 400406'		JRST	MTCH2A		; AND TRY CHAR SET
   648					;	JRST	PR.GAF		; DONE IF CURS GOES NEG
   649					;	  GLOBAL SCAN FAILURE POINT -- ANCHORED FAIL/UNANCH RUNOUT
   650					;
   651	400473'	200 00 0 00 000000#	PR.GAF:	MOVE	Z,NSSAVE		;CLEAR OUT NAME STACK
   652	400474'	202 00 0 00 400453*		MOVEM	Z,NSTACK		;   TO ABORT NAMING
   653	400475'	200 03 0 00 400456*		MOVE	HSR,HSTACK		; RESTORE HSTACK
   654	400476'	554 04 0 00 400457*		HLRZ	PLINK,MADSAV		;FIND OUT WHERE TO RETURN TO
   655	400477'	254 00 0 04 000000 		JRST	0(PLINK)		;  GO THERE, FAIL EXIT
   656
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 11
SNOPG	MAC	13-Oct-66 22:19		MTCH	OVERALL CONTROLLER FOR "?" BINOP

   657
   658						SUBTTL	SCAN:	MATCH PROCESSOR FOR ONE PBLOK			
   659					;
   660					;   CALLING SEQUENCE:
   661					;	SET UP PATT,HSR,FUTILE##, CURSOR,MAXLEN,STPTR##
   662					;	JSP	P2,SCAN
   663					;   RECURSION IS OK ONLY IF THE SCAN VARIABLES (BOTT OF "SAVEM")
   664					;	  ARE PUSHED AND POPPED.  SEE ALSO MTCH.
   665					;	SCAN SAVES EXIT-SUCCESS ADDRESS IN SCRAD(RIGHT),
   666					;		WHICH IS A SCAN RECURSION-PROTECTED VARIABLE
   667					;	RETURNS TO CALL+1 IF SUCCESSFUL MATCH
   668					;	RETURNS TO ADDR ON HISTORY STACK IF FAIL
   669					;
   670	400500'	542 05 0 00 000000*	SCAN:	HRRM	P2,SCRAD##	;SAVE SUCCESS RETURN ADDRESS
   671	400501'	200 05 0 00 400406*	SCAN0:	MOVE	P2,PATT		;SET UP PATT BLOK ADDR
   672	400502'	270 05 0 00 000000#		ADD	P2,PATT+1	;  PLUS NODE POS=NODE ADDR
   673	400503'	200 00 0 05 000001 		MOVE	Z,PALT(P2)	;  IS THERE AN ALTERNATE?
   674	400504'	321 00 0 00 400510'		JUMPL	Z,SCAN1		;    NO
   675	400505'	540 00 0 00 400471*		HRR	Z,CURSOR	;    YES-COMPOSE ALT & CURSOR
   676	400506'	261 03 0 00 000000 		PUSH	HSR,Z		; PUSH ALT & CURSOR TO H.S.
   677	400507'	261 03 0 00 400470*		PUSH	HSR,STPTR##	;    WITH THE CORRES STRING POINTER
   678	400510'	200 04 0 05 000000 	SCAN1:	MOVE	P1,PPROG(P2)	;FETCH PRIMITIVE'S ADDR
   679	400511'	254 00 0 04 000000 		JRST	(P1)		;  GO RUN IT
   680					;
   681					;	  THE PRIMITIVE REPORTS SUCCESS
   682					;
   683	400512'	200 05 0 00 400501*	SC.S::	MOVE	P2,PATT		;[152] Relead pattern block address
   684	400513'	270 05 0 00 000000#		ADD	P2,PATT+1	;[152] Point to the current node
   685	400514'	514 00 0 05 000001 		HRLZ	Z,PSUBS(P2)	;IS THERE A SUBSEQ?
   686	400515'	556 00 0 00 000000#		HLRZM	Z,PATT+1	;  (RESET PATT NODE IN CASE)
   687	400516'	325 00 0 00 400501'		JUMPGE	Z,SCAN0		;  JUMP IF HAVE SUBS TO PROCESS
   688	400517'	550 04 0 00 400500*		HRRZ	PLINK,SCRAD	;NO SUBSEQUENT-- OVERALL SUCCESS!
   689	400520'	254 00 0 04 000000 		JRST	(PLINK)		;  GO BACK, TO SUCCESS EXIT
   690					;
   691					;	  THE PRIMITIVE REPORTS MATCH FAILURE
   692					;
   693	400521'	402 00 0 00 400461*	SC.MF::	SETZM	FUTILE	;NOTE THE MATCH MAY NOT BE FUTILE
   694					;
   695					;	  THE PRIMITIVE REPORTS LENGTH FAILURE
   696					;
   697	400522'				PR.LF:			;H.S. PRIMITIVE TO LENGTH-FAIL
   698	400522'	262 03 0 00 400507*	SC.LF::	POP	HSR,STPTR##	;BACK UP TO PREV ALT POSIT
   699	400523'	262 03 0 00 000005 		POP	HSR,P2		;  AND RESET
   700	400524'	552 05 0 00 400505*		HRRZM	P2,CURSOR	;	CURSOR AND
   701	400525'	556 05 0 00 000000#		HLRZM	P2,PATT+1	;	PATT NODE. IS THERE A REAL ALT?
   702	400526'	325 05 0 00 400501'		JUMPGE	P2,SCAN0	;   YES.  GO TRY IT
   703	400527'	574 05 0 00 000005 		HLRE	P2,P2		;   NO.  GET FAIL ADDRESS
   704	400530'	254 00 1 05 400321'		JRST	@PPRTBL(P2)		;	AND GO FAIL
   705
   706
   707
   708
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 12
SNOPG	MAC	13-Oct-66 22:19		SCAN:	MATCH PROCESSOR FOR ONE PBLOK			

   709
   710						SUBTTL	PR.EX	UNEVALUATED EXPRESSION PROCESSING
   711
   712						  ;ENCOUNTER AN UNEVALEX NODE DURING A MATCH
   713
   714	400531'	400 06 0 00 000000 	PR.EX1::CLEAR	S1,
   715	400532'	550 07 0 00 400476*		HRRZ	S2,FULSAV		; WIPE OUT RETURN ADDR
   716	400533'	336 00 0 00 000007 		SKIPN	S2			; THEN ARE WE IN FULLSCAN MODE?
   717	400534'	554 06 0 05 000000 		HLRZ	S1,PRESID(P2)	;CHK IF RESIDUAL
   718	400535'	200 07 0 00 400524*		MOVE	S2,CURSOR		;  IS MORE THAN CURSOR
   719	400536'	274 07 0 00 000006 		SUB	S2,S1			;  HAS LEFT IN THE STRING
   720	400537'	321 07 0 00 400522'		JUMPL	S2,SC.LF		;JUMP IF NOT ENOUGH LEFT
   721
   722	400540'	201 12 0 05 000002 		MOVEI	T2,PARG(P2)		;THAT'S OUR ARG
   723	400541'	265 11 0 00 000000*		JSP	TLINK,PEVAL##		;  EVALUATE IT
   724	400542'	254 00 0 00 400521'		JRST	SC.MF			;  WOULDN'T GO- GO FAIL
   725
   726	400543'	265 11 0 00 400333*		JSP	TLINK,CVTVAL	; ENSURE A VALUE
   727						JRST	[SUB STACK,[2,,2]
   728	400544'	254 00 0 00 401035'			 JRST SC.MF]	; FAIL? THEN GIVE A MATCH FAIL
   729
   730
   731
   732	400545'	265 11 0 00 400324*		JSP	TLINK,CVTPAT		;MAKE USRE WE GOT PATTERN
   733	400546'	003 01 0 00 000013 		ERROR.	1,11			;  DIDN'T.  KILL IT
   734
   735	400547'	200 17 0 01 777777 		MOVE	Q3,-1(STACK)		;OK. SAVE PATT ARG IN Q3
   736	400550'	202 07 0 00 400535*		MOVEM	S2,CURSOR		;DECREASE TO REFLECT
   737	400551'	274 06 0 00 400400*		SUB	S1,MAXLEN		;  THE LIMITING RESIDUAL
   738	400552'	212 06 0 00 400551*		MOVNM	S1,MAXLEN		;  SUB WAS BACKW; COMPL&STR
   739
   740	400553'				EX1A:
   741	400553'	200 00 0 00 400512*		MOVE	Z,PATT			;PUT THE SCAN VARS ONTO 
   742	400554'	202 00 0 01 777777 		MOVEM	Z,-1(STACK)		;  SYSTEM STACK
   743	400555'	200 00 0 00 000000#		MOVE	Z,PATT+1		;  TO SAVE THEM
   744	400556'	504 00 0 00 400517*		HRL	Z,SCRAD			;  THROUGH THE
   745	400557'	202 00 0 01 000000 		MOVEM	Z,0(STACK)		;  SCAN RECURSION COMING
   746
   747	400560'	202 17 0 00 400553*		MOVEM	Q3,PATT			;RESET SCAN VARS
   748	400561'	201 17 0 00 000005 		MOVEI	Q3,LPHDR		;  TO REFLECT THE
   749	400562'	202 17 0 00 000000#		MOVEM	Q3,PATT+1		;  NEW SITUATION
   750
   751	400563'	261 03 0 00 401037'		PUSH	HSR,[XWD D.EX2,0]	;SET FAILURE POINT TO UNRECURSE
   752	400564'	261 03 0 00 000000 		PUSH	HSR,Z			;  DOESN'T NEED ANYTH BUT ADDR
   753
   754	400565'	265 05 0 00 400500'		JSP	P2,SCAN			;TRY THIS SUB-PATTERN
   755	400566'				EXPRET:			;SCAN'S RETURN POINT FOR THE EXPRESSION CALL
   756
   757						  ;SCAN REPORTS SUCCESS
   758
   759	400566'	262 01 0 00 000000 		POP	STACK,Z			;RETRIEVE SCAN VARS
   760	400567'	552 00 0 00 000000#		HRRZM	Z,PATT+1		;  PATTERN NODE
   761	400570'	556 00 0 00 400556*		HLRZM	Z,SCRAD			;  RETURN ADDRESS
   762	400571'	262 01 0 00 000005 		POP	STACK,P2		;  PATTERN BLOCK ADDR
   763	400572'	200 07 0 00 400560*		MOVE	S2,PATT		; SAVE PATTERN SUBSTITUTE
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 12-1
SNOPG	MAC	13-Oct-66 22:19		PR.EX	UNEVALUATED EXPRESSION PROCESSING

   764	400573'	202 05 0 00 400572*		MOVEM	P2,PATT			;    RESTORE USUAL PATT PTR
   765	400574'	270 05 0 00 000000#		ADD	P2,PATT+1		;  P2 IS ALWAYS THE NODE POINTER
   766
   767	400575'	550 00 0 00 400532*		HRRZ	Z,FULSAV		;IF QUICKSCAN
   768	400576'	326 00 0 00 400602'		JUMPN	EXRA			;    MODE,
   769	400577'	554 06 0 05 000000 		HLRZ	S1,PRESID(P2)		;RESTORE FROM THE
   770	400600'	272 06 0 00 400550*		ADDM	S1,CURSOR		;  LIMITATION IMPOSED
   771	400601'	272 06 0 00 400552*		ADDM	S1,MAXLEN		;  BY THE RESIDUAL
   772
   773	400602'				EXRA:
   774	400602'	515 00 0 00 777767 		HRLZI	Z,D.EX3			;SET FUTURE-FAILURE TRAP
   775	400603'	540 00 0 00 000000#		HRR	Z,PATT+1		;SPECIAL ONE FOR SUCCESS THRU HERE
   776	400604'	261 03 0 00 000000 		PUSH	HSR,Z			;UNUSUAL H.S. ENTRY
   777	400605'	261 03 0 00 000007 		PUSH	HSR,S2		; SAVE SUBSTITUTE PATT	
   778
   779	400606'	254 00 0 00 400512'		JRST	SC.S			;REPORT SUCCESSFUL STAR
   780
   781
   782					;
   783					;   --------------------
   784					;   SCAN REPORTS FAILURE
   785					;   --------------------
   786					;
   787
   788	400607'	262 01 0 00 000000 	PR.EX2::	POP	STACK,Z			;RETRIEVE SCAN VARS
   789	400610'	552 00 0 00 000005 		HRRZM	Z,P2			;  HOLD PATT NODE OFFSET
   790	400611'	556 00 0 00 400570*		HLRZM	Z,SCRAD			;  RETURN ADDRESS
   791	400612'	262 01 0 00 400573*		POP	STACK,PATT		;  PATT BLOK ADDR
   792	400613'	270 05 0 00 400612*		ADD	P2,PATT			;RESTORE PATT NODE PTR
   793
   794	400614'	550 00 0 00 400575*		HRRZ	Z,FULSAV		;IF QUICKSCAN
   795	400615'	326 00 0 00 400522'		JUMPN	Z,SC.LF			;    MODE,
   796	400616'	554 06 0 05 000000 		HLRZ	S1,PRESID(P2)		;RESTORE MAXLEN FROM
   797	400617'	272 06 0 00 400601*		ADDM	S1,MAXLEN		;  THE RESIDUAL'S LIMITATION
   798
   799	400620'	254 00 0 00 400522'		JRST	SC.LF			;EVERYTH ELSE IS RESET FROM H.S.
   800
   801					;
   802					;  THESE ROUTINES UTILIZE SCAN VARIABLES SAVED ON SYS STK:
   803					;	+-----------------------+
   804					;	+        P A T T        +
   805					;	+-----------+-----------+
   806					;	+  SCRAD(R) +  PATT+1   +
   807					;	+-----------+-----------+
   808					;
   809					;  IT LOOKS LIKE A PATTERN DATATYPE DESCR.
   810					;
   811
   812
   813						  ;SCAN OF THE STAR NODE'S SUCCESSOR
   814						;REPORTS FAILURE ALL THE WAY BACK INTO
   815						;THE STAR NODE, WHICH HAD SUCCEEDED.
   816						;RE-RECURSE, SO WE CAN KEEP HOPPING BACK
   817						;THRU THE HISTORY STACK IN THE ARG PATTERN
   818
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 12-2
SNOPG	MAC	13-Oct-66 22:19		PR.EX	UNEVALUATED EXPRESSION PROCESSING

   819
   820	400621'				PR.EX3:				;PUT SCAN VARS BACK ONTO STK
   821									;  JUST LIKE PREV CALL TO SCAN
   822	400621'	200 06 0 00 400522*		MOVE	S1,STPTR##		;WE PUT PATT HERE
   823	400622'	261 01 0 00 400613*		PUSH	STACK,PATT	; SAVE ORIGINAL PATT.
   824	400623'	200 05 0 00 400600*		MOVE	P2,CURSOR		;WE PUT PATT+1 HERE
   825	400624'	514 00 0 00 400611*		HRLZ	Z,SCRAD			;THIS IS SCAN'S RETURN ADDR
   826	400625'	540 00 0 00 000005 		HRR	Z,P2			;PUT PATT+1 WITH RET ADDR
   827	400626'	261 01 0 00 000000 		PUSH 	STACK,Z			;AND PUT IT BACK, TOO
   828
   829	400627'	270 05 0 00 400622*		ADD	P2,PATT		;MAKE UP NODE PTR
   830	400630'	550 00 0 00 400614*		HRRZ	Z,FULSAV		;IF QUICKSCAN
   831	400631'	326 00 0 00 400635'		JUMPN	EX3A			;    MODE,
   832	400632'	554 00 0 05 000000 		HLRZ	Z,PRESID(P2)		;  FETCH NODE'S RESID
   833	400633'	274 00 0 00 400617*		SUB	Z,MAXLEN		;  RESET TO HI LEVEL'S LIM'D VALUE
   834	400634'	212 00 0 00 400633*		MOVNM	Z,MAXLEN		;  STORE MAXLEN - RESID
   835
   836	400635'				EX3A:
   837	400635'	202 06 0 00 400627*		MOVEM	S1,PATT			;RESET PATTERN HEADER
   838										;  TO THE EVALUATED EXPRE PATT
   839	400636'	201 06 0 00 400566'		MOVEI	S1,EXPRET	; RESTORE ...
   840	400637'	202 06 0 00 400624*		MOVEM	S1,SCRAD	; RETURN ADDRESS
   841	400640'	254 00 0 00 400522'		JRST	SC.LF			;CURSOR AND STPTR## WILL BE
   842										;  RESET FROM THE H.S.
   843
   844					;
   845					;  THIS ROUTINE UTILIZES A PHONEY H.S. ENTRY:
   846					;	+---------+---------+
   847					;	+  D.EX3  +  PATT+1 +
   848					;	+---------+---------+
   849					;	+      P A T T      +
   850					;	+-------------------+
   851					;  WHERE "PATT" REFERS TO THE UNEVALEX
   852					;
   853
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 13
SNOPG	MAC	13-Oct-66 22:19		PR.EX	UNEVALUATED EXPRESSION PROCESSING

   854
   855						SUBTTL	CONST:	CONSTANT PATTERNS & PRIMITIVE
   856					;
   857					;  PRIMITIVE TO KILL THE WORKS
   858					;
   859	400641'	200 01 0 00 000000#	PR.ABT::	MOVE	STACK,SSSAVE	;RESTORE SYSTEM STATUS 
   860	400642'	254 00 0 00 400473'			JRST 	PR.GAF		;GO FINISH FAILING.
   861
   862					;
   863					;  THE CONSTANT PATTERN FOR ABORT
   864					;
   865	400643'	000404	000011		$ABORT::	XWD	PBLOK,LPHDR+PNDSZ
   866							REPEAT	LPHDR-1,<0>		;GCFLD,PSTRT,PMIN
   867	400644'	000000	000000
   868	400645'	000000	000000
   869	400646'	000000	000000
   870	400647'	000000	000000
   871	400650'	000000	400641'				XWD	0,PR.ABT	;PRESID/PPROG
   872	400651'	400000	400000				XWD	EMPTY,EMPTY		;PALT/PSUBS (NONE)
   873	400652'	000000	000000				OCT	0,0			;PARG (NONE)
   874	400653'	000000	000000
   875
   876					;
   877					;  THE CONSTANT PATTERN FOR ARB
   878					;
   879	400654'	000404	000021		$ARB::	XWD	PBLOK,LPHDR+3*PNDSZ
   880						REPEAT	LPHDR-1,<0>		;GCFLD,PSTRT,PMIN
   881	400655'	000000	000000
   882	400656'	000000	000000
   883	400657'	000000	000000
   884	400660'	000000	000000
   885	400661'	000000	400675'			XWD	0,ARB1		;RESID/PGM		NIL1
   886	400662'	400000	000011			XWD	EMPTY,A.NIL2	;ALT/SUBS	
   887						REPEAT	PNDSZ-2,<0>	;ARG
   888	400663'	000000	000000
   889	400664'	000000	000000
   890			000011		A.NIL2==.-$ARB			;NAME FOR		NIL2
   891	400665'	000000	400512'			XWD	0,SC.S		;RESID/PGM
   892	400666'	000015	400000			XWD	A.LEN1,EMPTY	;ALT/SUBS
   893						REPEAT	PNDSZ-2,<0>	;ARG
   894	400667'	000000	000000
   895	400670'	000000	000000
   896			000015		A.LEN1==.-$ARB		;NAME FOR			LEN(1)
   897	400671'	000000	000000*			XWD	0,PR.LN1##		;RESID/PROG
   898	400672'	400000	000011			XWD	EMPTY,A.NIL2	;ALT/SUBS
   899						REPEAT	PNDSZ-2,<0>	;ARG
   900	400673'	000000	000000
   901	400674'	000000	000000
   902
   903	400675'	261 03 0 00 400521*	ARB1:	PUSH	HSR,FUTILE	; SAVE FUTILE FLAG
   904	400676'	200 00 0 00 400623*		MOVE	Z,CURSOR	; FORM A STACK
   905	400677'	505 00 0 00 777777 		HRLI	Z,D.AFL		; ENTRY
   906	400700'	261 03 0 00 000000 		PUSH	HSR,Z		; TO GET CONTROL BACK
   907	400701'	261 03 0 00 400621*		PUSH	HSR,STPTR##	; UPON GLOBAL FAIL
   908	400702'	254 00 0 00 400512'		JRST	SC.S		; PROCEED WITH SCANNING
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 13-1
SNOPG	MAC	13-Oct-66 22:19		CONST:	CONSTANT PATTERNS & PRIMITIVE

   909
   910	400703'	262 03 0 00 400675*	PR.AFL:	POP	HSR,FUTILE	; RESTORE FUTILE FLAG
   911	400704'	254 00 0 00 400522'		JRST	SC.LF		; AND FAIL
   912
   913					;
   914					;  THE CONSTANT PATTERN FOR BAL
   915					;
   916	400705'	000404	000021		$BAL::	XWD	PBLOK,LPHDR+3*PNDSZ
   917						REPEAT	LPHDR-1,<0>
   918	400706'	000000	000000
   919	400707'	000000	000000
   920	400710'	000000	000000
   921	400711'	000000	000000
   922	400712'	000000	400512'			XWD	0,SC.S
   923	400713'	400000	000011			XWD	EMPTY,B.GBAL
   924	400714'	000000	000000			OCT	0,0
   925	400715'	000000	000000
   926			000011		B.GBAL==.-$BAL		;LABEL FOR GBAL NODE
   927	400716'	000000	000000*			XWD	0,PR.GBL##
   928	400717'	400000	000015			XWD	EMPTY,B.NIL2
   929	400720'	000000	000000			OCT	0,0
   930	400721'	000000	000000
   931			000015		B.NIL2==.-$BAL			;LABEL FOR SECOND NIL NODE
   932	400722'	000000	400512'			XWD	0,SC.S
   933	400723'	000011	400000			XWD	B.GBAL,EMPTY
   934	400724'	000000	000000			OCT	00,0
   935	400725'	000000	000000
   936
   937					;
   938					;  THE CONSTANT PATTERN FOR SUCCEED
   939					;
   940	400726'	000404	000011		$SUCC::	XWD	PBLOK,LPHDR+PNDSZ
   941						REPEAT	LPHDR-1,<0>
   942	400727'	000000	000000
   943	400730'	000000	000000
   944	400731'	000000	000000
   945	400732'	000000	000000
   946	400733'	000000	400512'			XWD	0,SC.S
   947	400734'	400000	400000			XWD	EMPTY,EMPTY
   948	400735'	000000	000000			OCT	0,0
   949	400736'	000000	000000
   950
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 14
SNOPG	MAC	13-Oct-66 22:19		CONST:	CONSTANT PATTERNS & PRIMITIVE

   951
   952						SUBTTL	SSTPP:	SUBSTRING TVAR LOAD & STORE PROCESSOR PGM
   953
   954					;  POSITIONS IN UBLOK, WHICH IS POINTED TO BY TVAR:
   955
   956			000002		SSVAL==LHDR		;ORIGINALLY SUBJ, THE VAL OF MTCH SUBJ
   957			000004		SSVAR==SSVAL+2		;ORIGINALLY SUBVAR, SUBJ AS A VARIABLE
   958								; =0 IF SUBJ WAS NOT A VARIABLE
   959			000007		SSHEAD==SSVAR+3		; (LEFT);	CURSOR AT STRT OF MTCH
   960			000007		SSCURS==SSHEAD		; (RIGHT);	CURSOR AT END  OF MTCH
   961
   962	400737'	254 00 0 00 401015'	SSTPP:	JRST	SSTPPV			;ENTRY TO GET VALUE
   963	400740'	001 16 0 00 000005 		ERROR	14,5			;ENTRY TO GET NAME. HAVE NONE.
   964	400741'				SSTPPA:					;ENTRY TO ASSIGN VALUE
   965					;
   966					;	   ---------------------------------
   967					;	   ASSIGN VALUE TO MATCHED SUBSTRING
   968					;	   ---------------------------------
   969					;
   970					;
   971					;	CALLING SEQUENCE:
   972					;	  JSP SLINK,SSTPP+2
   973					;	    WITH STK TOP = VALUE TO ASSIGN
   974					;	    AND STK NEXT= OUR TVAR DESCRIPTOR
   975					;	RETURN:
   976					;	  JUST AS ASGNVL LEAVES IT
   977					;	  FAIL OR SUCCEED AS DOES ASGNVL
   978					;
   979
   980	400741'	265 11 0 00 400335*		JSP	TLINK,CVTSTR##		;MAKE SURE THE VALUE'S A STR
   981	400742'	003 01 0 00 000022 		ERROR.	1,18			;  IT WASN'T. TOO BAD.
   982	400743'	262 01 0 00 000000#		POP	STACK,IGNOS##+1		;SAVE THE STRING VALUE FOR A 
   983	400744'	262 01 0 00 000000*		POP	STACK,IGNOS##		;  MOMENT(IT'S OK- NO GCOL)
   984					;
   985					;  WE NOW CALL CONCAT TO PUT TOGETHER:
   986					;	THE STR LEFT OF THE MATCH
   987					;	THE NEW VALUE
   988					;	THE STR RIGHT OF THE MATCH
   989					;	  (STACK THEM IN OPPOSITE ORDER)
   990					;
   991	400745'	262 01 0 00 000000 		POP	STACK,Z			;DISCARD TVAR PTR TO SSTPP
   992	400746'	262 01 0 00 400253*		POP	STACK,FLAS		;SAVE TVAR PTR TO UBLOK
   993	400747'	201 00 0 00 000001 		MOVEI	Z,1			;INIT CONCAT PARAM COUNTER
   994	400750'	200 07 0 00 400746*		MOVE	S2,FLAS			;GET ADDR OF UBLOK
   995
   996	400751'	261 01 0 07 000004 		PUSH	STACK,SSVAR(S2)		;IN PREPARATION FOR ASGNVL
   997	400752'	261 01 0 07 000005 		PUSH	STACK,SSVAR+1(S2)	;  CALL, PUT VARIABLE ON STK
   998
   999						  ;  OPTIONALLY PUSH DESCR FOR RT STR ONTO STK
  1000	400753'	570 10 0 07 000007 		HRRE	S3,SSCURS(S2)		;GET THE CURSOR
  1001	400754'	323 10 0 00 400764'		JUMPLE	S3,SSTPPB		;  SKIP RT STR IF NONE
  1002	400755'	261 01 0 07 000002 		PUSH	STACK,SSVAL(S2)		;WD#1 = SDT/PTR SBLOK
  1003	400756'	554 11 0 07 000003 		HLRZ	T1,SSVAL+1(S2)	;GET OFFSET OF SUBJ
  1004	400757'	270 11 0 07 000003 		ADD	T1,SSVAL+1(S2)		;  ADD LENGTH OF SUBJ
  1005	400760'	274 11 0 00 000010 		SUB	T1,S3			;  SUBTR CURSOR
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 14-1
SNOPG	MAC	13-Oct-66 22:19		SSTPP:	SUBSTRING TVAR LOAD & STORE PROCESSOR PGM

  1006	400761'	506 11 0 00 000010 		HRLM	T1,S3			;=NEW OFFSET; JOIN TO CURSOR
  1007	400762'	261 01 0 00 000010 		PUSH	STACK,S3		;RIGHT STRING DESCR DONE
  1008	400763'	271 00 0 00 000001 		ADDI	Z,1			;CONCAT GETS ONE MORE ARG
  1009
  1010						  ; PUSH DESCR FOR NEW SUBSTITUTION
  1011	400764'	261 01 0 00 400744*	SSTPPB:	PUSH	STACK,IGNOS##		;2D CONCAT ARG IS OUR
  1012	400765'	261 01 0 00 000000#		PUSH	STACK,IGNOS+1		;  ASSIGNING VALUE
  1013	
  1014						  ;OPTIONALLY PUSH DESCR FOR LFT STR ONTO STK
  1015	400766'	554 10 0 07 000007 		HLRZ	S3,SSHEAD(S2)		;GET HEAD OF MATCH
  1016	400767'	200 11 0 07 000003 		MOVE	T1,SSVAL+1(S2)		;  GET OFFSET/LNTH OF SUBJ
  1017	400770'	550 12 0 00 000011 		HRRZ	T2,T1			;ISOLATE LENGTH
  1018	400771'	311 10 0 00 000012 		CAML	S3,T2			;  CHECK HEAD LT LNTH
  1019	400772'	254 00 0 00 400777'		JRST	SSTPPC			;HEAD=LNTH: NO LEFT STRING
  1020	400773'	261 01 0 07 000002 		PUSH	STACK,SSVAL(S2)		;WD#1 = SDT/ PTR SBLOK
  1021	400774'	274 11 0 00 000010 		SUB	T1,S3			;WD#2 = OFFSET/LNTH-HEAD
  1022	400775'	261 01 0 00 000011 		PUSH	STACK,T1		;  NOW THE DESCR IS DONE
  1023	400776'	271 00 0 00 000001 		ADDI	Z,1			;AND NOTE ANOTHER ARG
  1024
  1025	400777'	307 00 0 00 000001 	SSTPPC:	CAIG	Z,1			;AT LEAST TWO ARGS FOR CONCAT?
  1026	401000'	254 00 0 00 401003'		JRST	SSTPPD			;  NO, DON'T BOTHER
  1027	401001'	265 11 0 00 000000*		JSP	TLINK,CONCAT##		;OK.  PUT THEM TOGETHER
  1028	401002'	001 13 0 00 000021 		ERROR	11,17			;  STRING RSLT TOO LONG
  1029
  1030	401003'				SSTPPD:
  1031					;
  1032					;	NOW STACK TOP = RESULT STRING
  1033					;	    STACK NXT = SUBVAR, WHAT TO ASSIGN TO
  1034					;	MAKE THE ASSIGNMENT
  1035					;	
  1036	401003'	554 16 0 01 777775 		HLRZ	Q2,-3(STACK)	; LOAD DATATYPE OF SUBJECT
  1037	401004'	602 16 0 00 020000 		TRNE	Q2,NONDC	; IF DATA
  1038	401005'	602 16 0 00 100000 		TRNE	Q2,PDC		; OR IF PROTECTED
  1039	401006'	254 00 0 00 401012'		JRST	SSTPPE		; GO RETURN JUST VALUE
  1040
  1041	401007'	265 11 0 00 000000*		JSP	TLINK,ASGNVL##		;ASSIGN IT
  1042	401010'	254 00 0 06 000000 		JRST	0(SLINK)		;PASS FAILURE BACK
  1043	401011'	254 00 0 06 000001 		JRST	1(SLINK)		;A-OK; ALL DONE.
  1044
  1045						 ; HERE TO JUST RETURN THE VALUE
  1046
  1047	401012'	262 01 0 01 777776 	SSTPPE:	POP	STACK,-2(STACK)	; JUST MOVE THE
  1048	401013'	262 01 0 01 777776 		POP	STACK,-2(STACK)	; DESCRIPTOR DOWN A LEVEL
  1049	401014'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN
  1050					;
  1051					;	-----------------------------------------
  1052					;	FETCH VALUE OF SUBSTRING TRAPPED VARIABLE
  1053					;	-----------------------------------------
  1054					;	  MAKE UP A STRING DESCRIPTOR FOR IT AND RETURN THAT
  1055					;	CALLING SEQUENCE:
  1056					;	  STACK TOP = OUR TVAR DESCR
  1057					;	  JSP	SLINK,SSTPP
  1058					;	RETURN:
  1059					;	  STACK TOP REPLACED BY STR DESCR FOR VALUE
  1060					;	  NEVER FAIL.  RETURN TO CALL+2.
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 14-2
SNOPG	MAC	13-Oct-66 22:19		SSTPP:	SUBSTRING TVAR LOAD & STORE PROCESSOR PGM

  1061					;
  1062	401015'	200 07 0 01 777777 	SSTPPV:	MOVE	S2,-1(STACK)		;GET ADDR OF UBLOK
  1063	401016'	200 00 0 07 000002 		MOVE	Z,SSVAL(S2)		;GET DESCR OF SUBJ
  1064	401017'	202 00 0 01 777777 		MOVEM	Z,-1(STACK)		;RETURN WD#1 = SDT/PTR SBLOK
  1065
  1066	401020'	554 00 0 07 000007 		HLRZ	Z,SSHEAD(S2)		;GET HEAD, LEFT MTCH BOUNDARY
  1067	401021'	200 10 0 00 000000 		MOVE	S3,Z			;  SAVE IF FOR LATER
  1068	401022'	274 00 0 07 000007 		SUB	Z,SSCURS(S2)	;  HEAD LESS CURSOR
  1069	401023'	202 00 0 01 000000 		MOVEM	Z,0(STACK)		;  =SUBSTR LNTH (RIGHT HALF)
  1070
  1071	401024'	554 00 0 07 000003 		HLRZ	Z,SSVAL+1(S2)		;GET ORIGINAL OFFSET
  1072	401025'	270 00 0 07 000003 		ADD	Z,SSVAL+1(S2)		;  PLUS LENGTH
  1073	401026'	274 00 0 00 000010 		SUB	Z,S3			;  LESS HEAD
  1074	401027'	506 00 0 01 000000 		HRLM	Z,0(STACK)		;  GIVES NEW OFFSET
  1075	401030'	254 00 0 06 000001 		JRST	1(SLINK)		;AND WE NEVER FAIL
  1076
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 15
SNOPG	MAC	13-Oct-66 22:19		SSTPP:	SUBSTRING TVAR LOAD & STORE PROCESSOR PGM

  1077
  1078						END

NO ERRORS DETECTED

HI-SEG. BREAK IS 401040
PROGRAM BREAK IS 000000
CPU TIME USED 06:52.759

44P CORE USED
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page S-1
SNOPG	MAC	13-Oct-66 22:19		SYMBOL TABLE

A.LEN1		000015	spd	EXPRET		400566'		PJOIN		400000'		SSVAL		000002	spd	
A.NIL2		000011	spd	EXRA		400602'		PJOIN1		400037'		SSVAR		000004	spd	
ALT		400063'	int	FLAP		400435'	ext	PLINK		000004		STACK		000001		
ALTP2A		400121'		FLAS		400750'	ext	PMIN		000004	sin	STINIT		400340'	ext	
ALTPB0		400070'		FRET1		400334'	ext	PNAMEL		400455'	ext	STPTR		400701'	ext	
ALTPB1		400110'		FRET2		400323'	ext	PNDSZ		000004	sin	STR.		400411'	ext	
ALTPB2		400113'		FULSAV		000000*	spd	PPAT		000015	spd	SUBJ		400432'	ext	
ALTPB3		400131'		FUTILE		400703'	ext	PPROG		000000	sin	SUBVAR		000000*	spd	
ARB1		400675'		GCFLD		000001	sin	PPRTBL		400321'		SURF		000002		
ARBNO		400132'	int	GCOLF		400425'	ext	PR.ABT		400641'	int	T1		000011		
ARBNO4		400163'		HSR		000003		PR.AFL		400703'		T2		000012		
ASGNVL		401007'	ext	HSTACK		400475'	ext	PR.CB2		000000	ext	T3		000013		
B.GBAL		000011	spd	IDT		002001	sin	PR.CN2		400304'	ext	T4		000014		
B.NIL2		000015	spd	IGNOP		400630'	ext	PR.CSF		400470'		TLINK		000011		
BLENG		000000	sin	IGNOS		400764'	ext	PR.EX1		400531'	int	TVAR		034000	sin	
BTCODE		000000	sin	IMVA		400210'	int	PR.EX2		400607'	int	UBLKZ		000010	spd	
CATP		400045'	int	LHDR		000002	sin	PR.EX3		400621'		UTBLOK		000414	sin	
CATP1		400055'		LPHDR		000005	sin	PR.FUF		400463'		VA		400213'		
CNVA		400212'	int	MADSAV		000000*	spd	PR.GAF		400473'		VA1		400224'		
CONCAT		401001'	ext	MAXLEN		400634'	ext	PR.GBL		400716'	ext	VA2		400270'		
CSDT		004013	sin	MTCH		400321'	int	PR.GUF		400461'		VAR		064000	sin	
CURSOR		400676'	ext	MTCH1		400326'		PR.IB2		000000	ext	Z		000000		
CVTPAT		400545'	ext	MTCH1A		400333'		PR.IN2		400210'	ext	$ABORT		400643'	int	
CVTSTR		400741'	ext	MTCH2		400357'		PR.LF		400522'		$ANCH		400354'	ext	
CVTVAL		400543'	ext	MTCH2A		400406'		PR.LN1		400671'	ext	$ARB		400654'	int	
D.AFL	777777	777777	sin	MTCH2J		400375'		PR.XB1		000000	ext	$BAL		400705'	int	
D.CB2	777777	777771	sin	MTCH3		400414'		PR.XN1		400300'	ext	$FULL		400343'	ext	
D.CSF	777777	777774	sin	MTCH4		400415'		PRESID		000000	sin	$SUCC		400726'	int	
D.EX2	777777	777766	sin	NAMN		400300'		PSTART		000002	sin	%%JOBD	043100	000450	spd	
D.EX3	777777	777767	sin	NIL1		000005	spd	PSUBS		000001	sin	%%MACT	000200	000025	spd	
D.FUF	777777	777773	sin	NIL2		000011	spd	Q1		000015		%%SNOP	000500	000305	spd	
D.GAF	777777	777775	sin	NILBLK		400173'		Q2		000016		%%UUOS	001400	000457	spd	
D.GUF	777777	777776	sin	NINC		000010	spd	Q3		000017		
D.IB2	777777	777770	sin	NN1		000005	spd	QLINK		000015		
D.LF	777777	777765	sin	NN2		000011	spd	S1		000006		
D.XB1	777777	777772	sin	NONDC		020000	sin	S2		000007		
E1$11		000000	sin	NPPAT		000015	spd	S3		000010		
E1$18		000000	sin	NSSAVE	000000000000#	pol	SC.LF		400522'	int	
E1$19		000000	sin	NSTACK		400474'	ext	SC.MF		400521'	int	
E1$20		000000	sin	OFFSET		400207'		SC.S		400512'	int	
E1$24		000000	sin	ORCSET		400125'	ext	SCAN		400500'		
E1$25		000000	sin	P1		000004		SCAN0		400501'		
E1$38		000000	sin	P2		000005		SCAN1		400510'		
E1$50		000000	sin	PALT		000001	sin	SCRAD		400637'	ext	
E11$17		000000	sin	PARG		000002	sin	SLINK		000006		
E14$5		000000	sin	PATT		400635'	ext	SSCURS		000007	spd	
E14$6		000000	sin	PBLOK		000404	sin	SSHEAD		000007	spd	
E15$		000000	sin	PDC		100000	sin	SSSAVE	000000000000#	pol	
E15$0		000000	sin	PEVAL		400541'	ext	SSTPP		400737'		
EDT		004006	sin	PGASC	502160	000000	spd	SSTPPA		400741'		
EMPTY		400000	spd	PGEDT		000207	spd	SSTPPB		400764'		
ERR	001000	000000		PGMIN		000000	spd	SSTPPC		400777'		
ERR.	003000	000000		PGSIX	604700	000000	spd	SSTPPD		401003'		
EX1A		400553'		PGVER		000005	spd	SSTPPE		401012'		
EX3A		400635'		PGWHO		000000	spd	SSTPPV		401015'		

SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

A.LEN1	   892	   896#
A.NIL2	   886	   890#	   898
ALT	   172#
ALTP2A	   206	   211#
ALTPB0	   180#	   183
ALTPB1	   192	   200#
ALTPB2	   195	   204#
ALTPB3	   193	   198	   202	   209	   220#
ARB1	   885	   903#
ARBNO	   230#
ARBNO4	   265#	   269
ASGNVL	  1041
B.GBAL	   923	   926#	   933
B.NIL2	   928	   931#
BLENG	    87	    90	   104	   233	   248	   352	   364	   591
BTCODE	   248	   591
CATP	   149#
CATP1	   160#	   164
CNVA	   324#
CONCAT	  1027
CSDT	   204	   538
CURSOR	   509	   519	   526	   545	   547	   572	   600	   639	   646	   675	   700	   718	   736	   770
	   824	   904
CVTPAT	    78	    83	   230	   346	   495	   732
CVTSTR	   506	   980
CVTVAL	   333	   344	   493	   504	   726
D.AFL	   445#	   905
D.CB2	   439#
D.CSF	   442#	   564
D.EX2	   436#	   751
D.EX3	   437#	   448	   774
D.FUF	   441#	   568
D.GAF	   443#	   515	   540
D.GUF	   444#	   536
D.IB2	   438#
D.LF	   435#
D.XB1	   440#
E1$11	   733#
E1$18	   981#
E1$19	   507#
E1$20	   496#
E1$24	    84#
E1$25	    79#
E1$38	   347#
E1$50	   231#
E11$17	  1028#
E14$5	   963#
E14$6	   337#
E15$	   334#
E15$0	   205#
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

EDT	   336
EMPTY	   159	   168#	   263	   284	   288	   392	   413	   419	   872	   886	   892	   898	   923	   928
	   933	   947
EX1A	   740#
EX3A	   831	   836#
EXPRET	   755#	   839
EXRA	   768	   773#
FLAP	   484
FLAS	    80	    81	    89	   108	   339	   340	   374	   992	   994
FRET1	   345	   505
FRET2	   494
FULSAV	   480#	   518	   531	   715	   767	   794	   830
FUTILE	   578	   634	   693	   903	   910
GCFLD	   253	   592
GCOLF	    93	   235	   355	   589
HSR	   523	   573	   574	   625	   637	   653	   676	   677	   698	   699	   751	   752	   776	   777
	   903	   906	   907	   910
HSTACK	   523	   601	   625	   653
IDT	   194
IGNOP	   479	   480	   481	   482
IGNOS	   982	   983	  1011	  1012
IMVA	   317#
LHDR	   586	   956
LPHDR	    91	   109	   112	   123	   125	   127	   155	   157	   179	   245	   258	   278	   292	   294
	   353	   354	   362	   380	   382	   411	   424	   576	   748	   865	   866	   879	   880	   916
	   917	   940	   941
MADSAV	   479#	   492	   626	   654
MAXLEN	   520	   542	   549	   737	   738	   771	   797	   833	   834
MTCH	   492#
MTCH1	   497#
MTCH1A	   504#
MTCH2	   531#
MTCH2A	   539	   558#	   647
MTCH2J	   541	   545#
MTCH3	   532	   568#
MTCH4	   527	   537	   553	   572#	   640
NAMN	   368	   412#
NIL1	   294#	   295
NIL2	   261	   284	   295#	   296
NILBLK	   254	   278#
NINC	   354	   363	   382	   424#
NN1	   369	   373	   411#	   417
NN2	   370	   371	   375	   376	   393	   417#	   423
NONDC	  1037
NPPAT	   381	   389	   413	   423#	   424
NSSAVE	   481#	   522	   616	   651
NSTACK	   521	   617	   618	   652
OFFSET	   242	   292#
ORCSET	   215
P1	   678	   679
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

P2	   232	   233	   234	   243	   258	   273	   516	   517	   518	   533	   534	   535	   558	   559
	   560	   580	   670	   671	   672	   673	   678	   683	   684	   685	   699	   700	   701	   702
	   703	   704	   717	   722	   754	   762	   764	   765	   769	   789	   792	   796	   824	   826
	   829	   832
PALT	   129	   182	   184	   265	   395	   673
PARG	   375	   376	   722
PATT	   498	   533	   558	   577	   671	   672	   683	   684	   686	   701	   741	   743	   747	   749
	   760	   763	   764	   765	   775	   791	   792	   823	   829	   837
PBLOK	   865	   879	   916	   940
PDC	  1038
PEVAL	   723
PGASC	    31#
PGEDT	    24#
PGMIN	    23#
PGSIX	    30#
PGVER	    22#
PGWHO	    25#
PJOIN	    78#	   149	   172
PJOIN1	   129#	   131
PLINK	   166	   220	   275	   317	   324	   371	   406	   492	   626	   627	   654	   655	   688	   689
PMIN	   150	   151	   173	   174	   175	   372
PNAMEL	   620
PNDSZ	   130	   163	   234	   249	   260	   268	   273	   295	   296	   391	   398	   414	   417	   423
	   865	   879	   887	   893	   899	   916	   940
PPAT	   255	   262	   288	   292	   296#
PPROG	   678
PPRTBL	   435	   436	   437	   438	   439	   440	   441	   442	   443	   444	   445	   446#	   704
PR.ABT	   859#	   871
PR.AFL	   445	   910#
PR.CB2	   439	   439#
PR.CN2	   324	   418
PR.CSF	   442	   645#
PR.EX1	   714#
PR.EX2	   436	   788#
PR.EX3	   437	   820#
PR.FUF	   441	   637#
PR.GAF	   443	   544	   546	   562	   635	   641	   651#	   860
PR.GBL	   927
PR.GUF	   444	   634#
PR.IB2	   438	   438#
PR.IN2	   317
PR.LF	   435	   697#
PR.LN1	   897
PR.XB1	   440	   440#
PR.XN1	   412
PRESID	   162	   373	   717	   769	   796	   832
PSTART	   188	   190	   196	   197	   200	   201	   207	   208	   211	   212	   213	   214	   217	   218
	   534	   535	   559	   560
PSUBS	   129	   160	   161	   265	   266	   267	   395	   396	   397	   685
Q1	   123	   124	   131	   155	   156	   164	   180	   181	   182	   184	   189	   193	   194	   196
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

	   197	   204	   207	   208	   392	   396	   515	   536	   540	   564	   568	   572	   573	   601	   602
	   637
Q2	   157	   160	   161	   162	   163	   179	   180	   182	   183	   393	   397	  1036	  1037	  1038
Q3	   150	   151	   158	   162	   735	   747	   748	   749
QLINK	    93	   235	   355	   589
S1	   216	   217	   218	   262	   265	   266	   267	   268	   351	   352	   359	   360	   380	   389
	   395	   396	   397	   398	   714	   717	   719	   737	   738	   769	   770	   771	   796	   797
	   822	   837	   839	   840
S2	    86	    87	    89	    90	   100	   101	   102	   110	   112	   113	   125	   129	   130	   137
	   151	   157	   174	   175	   181	   200	   201	   208	   352	   353	   354	   382	   390	   399
	   535	   537	   538	   560	   616	   618	   619	   715	   716	   718	   719	   720	   736	   763
	   777	   994	   996	   997	  1000	  1002	  1003	  1004	  1015	  1016	  1020	  1062	  1063	  1066
	  1068	  1071	  1072
S3	    92	   104	   263	   266	   534	   541	   542	   543	   544	   545	   546	   547	   549	   550
	   551	   553	   559	   617	  1000	  1001	  1005	  1006	  1007	  1015	  1018	  1021	  1067	  1073
SC.LF	   698#	   720	   795	   799	   841	   911
SC.MF	   693#	   724	   728
SC.S	   283	   287	   683#	   779	   891	   908	   922	   932	   946
SCAN	   580	   670#	   754
SCAN0	   671#	   687	   702
SCAN1	   674	   678#
SCRAD	   670	   688	   744	   761	   790	   825	   840
SLINK	   145	   149	   172	   620	  1042	  1043	  1049	  1075
SSCURS	   599	   603	   960#	  1000	  1068
SSHEAD	   599	   603	   959#	   960	  1015	  1066
SSSAVE	   482#	   524	   859
SSTPP	   611	   962#
SSTPPA	   964#
SSTPPB	  1001	  1011#
SSTPPC	  1019	  1025#
SSTPPD	  1026	  1030#
SSTPPE	  1039	  1047#
SSTPPV	   962	  1062#
SSVAL	   593	   595	   956#	   957	  1002	  1003	  1004	  1016	  1020	  1063	  1071	  1072
SSVAR	   596	   598	   957#	   959	   996	   997
STACK	    80	    81	    86	    97	   135	   211	   212	   213	   214	   216	   217	   218	   232	   239
	   272	   328	   335	   339	   340	   351	   359	   404	   497	   498	   500	   501	   502	   511
	   524	   610	   611	   727	   735	   742	   745	   759	   762	   788	   791	   823	   827	   859
	   982	   983	   991	   992	   996	   997	  1002	  1007	  1011	  1012	  1020	  1022	  1036	  1047
	  1048	  1062	  1064	  1069	  1074
STINIT	   510
STPTR	   551	   554	   574	   638	   645	   677	   698	   822	   907
STR.	   561
SUBJ	   594
SUBVAR	   484#	   500	   501	   597
SURF	    99	   101	   104	   135	   137	   241	   250	   253	   255	   262	   272	   273	   361	   362
	   364	   369	   370	   371	   372	   373	   375	   376	   381	   383	   389	   404	   405	   591
	   592	   593	   595	   596	   598	   599	   603	   604	   608
T1	    98	   188	   196	   211	   212	   243	   244	   245	   260	   265	   382	   383	   384	   405
	  1003	  1004	  1005	  1006	  1016	  1017	  1021	  1022
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

T2	    88	   100	   127	   155	   161	   184	   239	   240	   248	   261	   267	   722	  1017	  1018
T3	   108	   109	   150	   173	   190	   197	   207	   213	   214
T4	    90	    91	   112	   123	   125
TLINK	    78	    83	   215	   230	   333	   344	   346	   493	   495	   504	   506	   510	   561	   723
	   726	   732	   980	  1027	  1041
TVAR	   330	   609
UBLKZ	   586#	   588	   604	   608
UTBLOK	   590
VA	   318	   328#
VA1	   331	   339#
VA2	   395#	   399
VAR	   329
Z	    87	    88	    91	    92	    97	    98	    99	   102	   109	   110	   113	   127	   128	   129
	   159	   160	   173	   174	   175	   188	   189	   190	   191	   206	   234	   240	   241	   242
	   244	   245	   248	   249	   250	   253	   254	   255	   258	   259	   269	   328	   329	   330
	   335	   336	   354	   360	   361	   362	   363	   364	   368	   369	   370	   372	   373	   374
	   375	   376	   380	   381	   384	   391	   395	   497	   519	   520	   521	   522	   531	   532
	   576	   577	   588	   590	   591	   593	   594	   595	   596	   597	   598	   600	   602	   603
	   608	   609	   610	   651	   652	   673	   674	   675	   676	   685	   686	   687	   741	   742
	   743	   744	   745	   752	   759	   760	   761	   767	   774	   775	   776	   788	   789	   790
	   794	   795	   825	   826	   827	   830	   832	   833	   834	   904	   905	   906	   991	   993
	  1008	  1023	  1025	  1063	  1064	  1066	  1067	  1068	  1069	  1071	  1072	  1073	  1074
$ABORT	   865#
$ANCH	   525
$ARB	   879#	   890	   896
$BAL	   916#	   926	   931
$FULL	   516
$SUCC	   940#
SNOPG - Pattern Global Routines  %5(207)	MACRO %53B(1156)-1 21:51 14-Mar-88 Page 1
SNOPG	MAC	13-Oct-66 22:19		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Macro/Opdef cross reference

ERR	   205	   334	   337	   963	  1028
ERR.	    79	    84	   231	   347	   496	   507	   733	   981
ERROR	   205	   334	   337	   963	  1028
ERROR.	    79	    84	   231	   347	   496	   507	   733	   981
PGPTX	    43
PGTTL	    42
PPENT	   429#	   435	   436	   437	   438	   439	   440	   441	   442	   443	   444	   445
SHOW.	    37	    38	    39	    40
TITLE.	    29  U]g 
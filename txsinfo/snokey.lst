SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 1
SNOKEY	MAC	13-Oct-66 22:11		Ma355 -- Gimpel/JDS/MDP/RCM/VB		29-Sep-76

     1						SUBTTL	Ma355 -- Gimpel/JDS/MDP/RCM/VB		29-Sep-76
     2
     3					; Copyright (c) 1972, 1973, 1976, 1977 Stevens Instutite of Technology
     4					; Hoboken, New Jersey, 07030
     5					; All Rights Reserved.
     6
     7					  ; Directives
     8
     9						SALL			; Suppress macro expansions
    10						.DIREC	.XTABM		; Exclude tabs from macro calls
    11	400000'					TWOSEG	400K		; Two segments
    12
    13					  ; Universals
    14
    15						SEARCH	JOBDAT		; Job data area definitions
    16						SEARCH	MACTEN		; DEC-10 macro definitions
    17						SEARCH	UUOSYM		; TOPS10 UUO symbols
    18						SEARCH	SNOPRM		; Sitbol parameter file
    19
    20					  ; Version number
    21
    22			000005			KEYVER==5		; major version number
    23			000000			KEYMIN==0		; Minor version number
    24			000204			KEYEDT==204		; Edit level
    25			000000			KEYWHO==0		; Customer argument
    26
    27					  ; Title
    28
    29						TITLE.	KEY,SNOKEY,<Keywords>
    30		534571	000000			KEYSIX==SIXBIT /KEY/	; SNOKEY ABBREVIATION IN SIXBIT
    31		456133	100000			KEYASC==ASCIZ /KEY/	; SNOKEY ABBREVIATION IN ASCII
    32						SALL
    33
    34
    35					  ; Universals version numbers
    36
    37	400000'	043100	000450			SHOW.	%%JOBD		; JOBDAT's version number
    38	400000'	000200	000025			SHOW.	%%MACT		; MACTEN's version number
    39	400000'	001400	000457			SHOW.	%%UUOS		; UUOSYM's version number
    40	400000'	000500	000305			SHOW.	%%SNOP		; SNOPRM's version number
    41
    42						KEYTTL			; Title
    43						KEYPTX			; PASS2 assembly message
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 2
SNOKEY	MAC	13-Oct-66 22:11		Table of Contents

    44						SUBTTL	Table of Contents
    45
    46					;		Table of Contents for Keywords
    47					;
    48					;
    49					;			   Section			      Page
    50					;   1. Table of Contents. . . . . . . . . . . . . . . . . . .    2
    51					;   2. Revision History . . . . . . . . . . . . . . . . . . .    3
    52					;   3. &VERSION . . . . . . . . . . . . . . . . . . . . . . .    7
    53					;   4. UNPROTECTED KEYWORD TABLE. . . . . . . . . . . . . . .    9
    54					;   5. &HISTOGRAM . . . . . . . . . . . . . . . . . . . . . .   10
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 3
SNOKEY	MAC	13-Oct-66 22:11		Revision History

    55						SUBTTL	Revision History
    56
    57					COMMENT	{
    58					122	Reorganize & cleanup the code
    59					170	Add new keywords for error processing.
    60					204	Add &VERSION keyword to set version and return high seg version.
    61					{
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 4
SNOKEY	MAC	13-Oct-66 22:11		Revision History

    62					;
    63					;
    64					;   3. FUNCTION KEYW
    65					;
    66					; THE CALLING SEQUENCE
    67					;   PUSH   STACK,FIRST WORD OF VARIABLE DESCRIPTOR
    68					;   PUSH   STACK,SECOND    "
    69					;   ERROR RETURN
    70					;   NORMAL RETURN
    71					;
    72					; IN THE CASE OF PROTECTED KEYWORDS A DESCRIPTOR FOR THE VALUE OF THE
    73					; KEYWORD WILL BE RETURNED ON THE STACK.
    74					; IN THE CASE OF AN UNPROTECTED KEYWORD A TRAP VARIABLE WILL BE
    75					; RETURNED
    76					;
    77					;	FUNC	KEYW$,1
    78	400000'	262 01 0 00 000000*	KEYW::	POP	STACK,IGNOP##	; RETRIEVE DESCRIPTOR
    79	400001'	262 01 0 00 000005 		POP	STACK,P2
    80						 ;
    81	400002'	554 06 0 00 000005 		HLRZ	S1,P2		; GET DATATYPE
    82	400003'	306 06 0 00 064000 		CAIN	S1,VAR		; IF NOT A VARIABLE
    83	400004'	332 00 0 00 400000*		SKIPE	IGNOP		; OR IF NOT NATURAL
    84	400005'	001 05 0 00 000001 		ERROR	5,1		; GIVE BAD KEYWORD MESSAGE
    85						 ;
    86	400006'	554 06 0 05 000006 		HLRZ	S1,VKEY(P2)	; RETRIEVE KEY FIELD
    87	400007'	606 06 0 00 000077 		TRNN	S1,KYMASK	; CHECK FOR TRUE KEYWORD NUMBER
    88	400010'	001 05 0 00 000002 		ERROR	5,2		; THE VARIABLE IS NOT A KEYWORD
    89	400011'	405 06 0 00 000077 		ANDI	S1,KYMASK	; AND OUT VFLAGS
    90	400012'	301 06 0 00 000040 		CAIL	S1,40		; JUMP TO PROTECTED OR UNPROTECTED
    91	400013'	254 00 0 00 400017'		JRST	KEYW1		; KEYWORD # LESS THAN 40 THEN PROTECTED
    92					;
    93					;	PROTECTED KEYWORDS
    94					;
    95	400014'	554 07 0 06 400123'		HLRZ	S2,PROTKW(S1)	; PUT KEYWORD NAME INTO S2
    96	400015'	550 06 0 06 400123'		HRRZ	S1,PROTKW(S1)	; TRANSFER TO ROUTINE TO CREATE
    97	400016'	254 00 0 06 000000 		JRST	0(S1)		; DESCRIPTOR
    98					                                ; DESCRIPTOR
    99					;
   100					;	UNPROTECTED KEYWORDS
   101					;
   102	400017'	515 07 0 00 034000 	KEYW1:	HRLZI	S2,TVAR		; CREATE TRAP VARIABLE
   103	400020'	544 07 0 06 400112'		HLR	S2,UPROKW-40(S1); ------------------------------------
   104	400021'	261 01 0 00 000007 		PUSH	STACK,S2	; !    TVAR     !  KEYWORD ADDRESS   !
   105	400022'	550 07 0 06 400112'		HRRZ	S2,UPROKW-40(S1); !-------------!--------------------!
   106	400023'	261 01 0 00 000007 		PUSH	STACK,S2	; !/////////////! ADD TO PROCESS TRAP!
   107	400024'	254 00 0 04 000001 		JRST	1(PLINK)	; !----------------------------------!
   108

SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 5
SNOKEY	MAC	13-Oct-66 22:11		Revision History

   109					;
   110					;    4. TRAP VARIABLE FOR UNPROTECTED KEYWORDS
   111					;
   112					;  PUSH TRAP VARIABLE ONTO STACK AND IF THE KEYWORD IS BEING ASSIGNES A 
   113					; VALUE THIS VALUE IS PUSHED ALSO
   114					;  
   115					;      JSP   PLINK,0(S3)
   116					;      ERROR RETURN
   117					;      NORMAL RETURN
   118					;
   119					;
   120					; THIS CODE WILL BE EXERCISED UPON EVALUATING THE TRAP VARIABLE
   121					; RETURNED DUE TO A REFERENCE TO AN UNPROTECTED KEYWORD
   122					;
   123
   124	400025'	254 00 0 00 400041'	KWINTU:	JRST	KWINT1		; RETRIEVE VALUE
   125	400026'	001 05 0 00 000007 		ERROR	5,7		; CANNOT HAVE A NAME RETURNED
   126	400027'	265 11 0 00 000000*		JSP	TLINK,CVTINT##	; CONVERT VALUE TO INTEGER
   127	400030'	001 05 0 00 000006 		ERROR 	5,6		; ILLEGAL VALUE
   128	400031'	550 07 0 01 777775 		HRRZ	S2,-3(STACK)
   129	400032'	262 01 0 07 000000 		POP	STACK,0(S2)	; PUT NEW VALUE INTO KEYWORD
   130	400033'	262 01 0 00 000000*		POP	STACK,IGNOS##
   131					;
   132					; ERROR TYPE IS THE ONLY UNPROTECTED KEYWORD THAT CAN BE TRACED, ALSO 
   133					; WHEN IT IS ASSIGNED A VALUE BY THE USER WE MUST SIGNAL AN ERROR 
   134					;
   135	400034'	302 07 0 00 000000*		CAIE	S2,$ERRTP##	; IF THE KEYWORD IS NOT
   136	400035'	254 00 0 06 000001 		JRST	1(SLINK)	; ERROR TYPE WE CAN RETURN
   137	400036'	332 00 0 00 000000#		SKIPE	$ERRTP+1	; SEE IF IT IS TRACED
   138	400037'	265 06 0 00 000000*		JSP	SLINK,ETPTRC##	; CALL TRACER
   139	400040'	254 00 0 00 000000*	KWINT2:	JRST	ERRTPA##	; TRANSFER TO PROCESS THIS NUMBER
   140									; AND CHECK FOR SETEXIT ...
   141					;
   142					;   HERE WHEN THE VALUE OF THE KEYWORD IS NEEDED WE CREATE AN INTEGER
   143					;   DESCRIPTOR ON THE STACK.
   144					;
   145	400041'	262 01 0 00 400033*	KWINT1:	POP	STACK,IGNOS	;REMOVE TRAP VARIABLE FROM STACK
   146	400042'	262 01 0 00 000007 		POP	STACK,S2
   147	400043'	261 01 0 00 400334'		PUSH	STACK,[ XWD IDT,0]	; PUSH INTEGER DESCRIPTOR
   148	400044'	261 01 0 07 000000 		PUSH	STACK,0(S2)
   149	400045'	254 00 0 06 000001 		JRST	1(SLINK)
   150

SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 6
SNOKEY	MAC	13-Oct-66 22:11		Revision History

   151					;		5. PROTECTED KEYWORD DESCRIPTORS
   152					;
   153					; DEPENDING ON WHAT TYPE OF VALUE EACH PROTECTED KEYWORD HAS WE CREATE A
   154					; DESCRIPTOR SO THAT THE VALUE CAN BE RETURNED ON THE STACK.
   155					;
   156	400046'	505 07 0 00 004004 	KWPAT:	HRLI	S2,PDT		; PATTERN
   157	400047'	261 01 0 00 000007 		PUSH	STACK,S2
   158	400050'	261 01 0 00 400335'		PUSH	STACK,[0]
   159	400051'	254 00 0 04 000001 		JRST	1(PLINK)
   160	400052'	323 07 0 00 000000*	KWSTR:	JUMPLE	S2,RETNUL##	; USED FOR &RTNTYPE
   161	400053'	261 01 0 00 000000*		PUSH	STACK,SYSTR##	; - IF THE RETURN STRING
   162	400054'	261 01 1 07 000000 		PUSH	STACK,@0(S2)	; IS NOT YET SET RETURN NULL
   163	400055'	254 00 0 04 000001 		JRST	1(PLINK)
   164	400056'	261 01 0 00 400334'	KWINT:	PUSH	STACK,[ XWD IDT,0]	; INTEGER
   165	400057'	261 01 0 07 000000 		PUSH	STACK,0(S2)
   166	400060'	254 00 0 04 000001 		JRST	1(PLINK)
   167	400061'	261 01 0 07 000000 	KWDESC:	PUSH	STACK,0(S2)	; DESCRIPTOR
   168	400062'	261 01 0 07 000001 		PUSH	STACK,1(S2)
   169	400063'	254 00 0 04 000001 		JRST	1(PLINK)
   170	
   171						 ; HERE FOR &COMMAND KEYWORD
   172						 ;
   173	400064'	200 11 0 00 000000*	KWCMD:	MOVE	T1,STBASE	; BASE OF STACK
   174	400065'	261 01 0 11 000001 		PUSH	STACK,1(T1)	; LOAD THE ...
   175	400066'	261 01 0 11 000002 		PUSH	STACK,2(T1)	; COMMAND DESCRIPTOR
   176	400067'	254 00 0 04 000001 		JRST	1(PLINK)	; AND RETURN
   177
   178						 ; HERE FOR &PPN
   179						 ;
   180	400070'	047 12 0 00 000024 	KWPPN:	GETPPN	T2,		; GET PPN
   181	400071'	330 00 0 00 000000 		SKIP			; NO-OP
   182						 ;
   183	400072'	205 00 0 00 001002 		MOVSI	Z,1002		; 'O' FORMAT (DIRTY)
   184	400073'	265 11 0 00 000000*		JSP	TLINK,CVTWD##	; CONVERT TO STRING
   185	400074'	001 17 0 00 000000 		ERROR	15		; CAN'T ERR
   186						 ;
   187	400075'	254 00 0 04 000001 		JRST	1(PLINK)	; NORMAL RETURN
   188
   189	400076'				KWSIZE:	 ; &SIZE KEYWORD
   190						 ;
   191	400076'	200 15 0 00 000000*		MOVE	Q1,CEIL##		; FIND SIZE
   192	400077'	271 15 0 00 000101 		ADDI	Q1,MARGIN+1	; OF LOW CORE
   193	400100'	261 01 0 00 400334'		PUSH	STACK,[IDT,,0]	; AND CONSTRUCT
   194	400101'	261 01 0 00 000015 		PUSH	STACK,Q1	; INTEGER
   195	400102'	254 00 0 04 000001 		JRST	1(PLINK)	; AND RETURN
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 7
SNOKEY	MAC	13-Oct-66 22:11		&VERSION

   196						SUBTTL	&VERSION
   197
   198						; &VERSION keyword (unprotected)
   199
   200
   201	400103'	254 00 0 00 400115'	KWVRSN:	JRST	VERHGH
   202	400104'	001 05 0 00 000007 		 ERROR	5,7		; Cannot be a name
   203
   204						; Here for version (lowseg) redefinition
   205
   206	400105'	265 11 0 00 000000*		JSP	TLINK,CVTSTR##
   207	400106'	001 05 0 00 000006 		 ERROR	5,6		; Improper data type
   208
   209	400107'	205 00 0 00 001002 		MOVSI	Z,1002		; 'O' format
   210	400110'	265 11 0 00 000000*		JSP	TLINK,CVTDW##	; Get the word
   211	400111'	001 05 0 00 000006 		 ERROR	5,6
   212
   213	400112'	202 00 0 00 000137 		MOVEM	Z,.JBVER	; Put the version no. in .JBVER
   214	400113'	274 01 0 00 000000*		SUB	STACK,XWD22##	; Get rid of garbage
   215	400114'	254 00 0 06 000001 		JRST	1(SLINK)	; Return
   216
   217						; Here to return present SITBOL version of highseg.
   218
   219	400115'	274 01 0 00 400113*	VERHGH:	SUB	STACK,XWD22##
   220
   221	400116'	200 12 0 00 400004 		MOVE	T2,.JBHGH+.JBHVR	; Get highseg version no.
   222
   223	400117'	205 00 0 00 001002 		MOVSI	Z,1002		; 'O' format
   224	400120'	265 11 0 00 400073*		JSP	TLINK,CVTWD##	; Convert it to octal-looking string
   225	400121'	001 17 0 00 000000 		 ERROR	15
   226
   227	400122'	254 00 0 06 000001 		JRST	1(SLINK)	; Normal return.
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 8
SNOKEY	MAC	13-Oct-66 22:11		&VERSION

   228					;
   229					;	1. PROTECTED KEYWORD TABLE
   230					;
   231	400123'	000000	000000		PROTKW::	0
   232	400124'	000000*	400046'			XWD	$ABORT##,KWPAT
   233	400125'	000000*	400061'			XWD	$ALPHA##,KWDESC
   234	400126'	000000*	400046'			XWD	$ARB##,KWPAT
   235	400127'	000000*	400046'			XWD	$BAL##,KWPAT
   236	400130'	000000*	400046'			XWD	$FAIL##,KWPAT
   237	400131'	000000*	400046'			XWD	$FENCE##,KWPAT
   238	400132'	000000*	400056'			XWD	$FNCLV##,KWINT
   239	400133'	000000*	400056'			XWD	$LASTN##,KWINT
   240	400134'	000000*	400046'			XWD	$REM##,KWPAT
   241	400135'	000000*	400052'			XWD	$RTNTP##,KWSTR
   242	400136'	000000*	400056'			XWD	$STCNT##,KWINT
   243	400137'	000000*	400056'			XWD	$STFCT##,KWINT
   244	400140'	000000*	400056'			XWD	$STNO##,KWINT
   245	400141'	000000*	400046'			XWD	$SUCC##,KWPAT
   246	400142'	000000*	400056'			XWD	$JOBNO##,KWINT
   247	400143'	000000	400064'			XWD	0,KWCMD
   248	400144'	000000*	400056'			XWD	FRSTNM##,KWINT
   249	400145'	000000	400070'			XWD	0,KWPPN
   250	400146'	000000	400076'			XWD	0,KWSIZE
   251	400147'	000000*	400061'			XWD	ERRPRM##,KWDESC
   252
   253	400150'	000000*	400061'			XWD	ERRNAM##,KWDESC
   254	400151'	000000*	400061'			XWD	ERRMSG##,KWDESC
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 9
SNOKEY	MAC	13-Oct-66 22:11		UNPROTECTED KEYWORD TABLE

   255						SUBTTL	UNPROTECTED KEYWORD TABLE
   256					;
   257	400152'	000000*	400025'		UPROKW::XWD	$ABEND##,KWINTU
   258	400153'	000000*	400025'			XWD     $ANCH##,KWINTU
   259	400154'	000000*	400025'			XWD	$CODE##,KWINTU
   260	400155'	000000*	400025'			XWD	$DUMP##,KWINTU
   261	400156'	000000*	400025'			XWD	$ERRTP##,KWINTU
   262	400157'	000000*	400025'			XWD	$ERRLM##,KWINTU
   263	400160'	000000*	400025'			XWD	$FTRC##,KWINTU
   264	400161'	000000*	400025'			XWD	$FULL##,KWINTU
   265	400162'	000000*	400025'			XWD	$INPUT##,KWINTU
   266	400163'	000000*	400025'			XWD	$MAXL##,KWINTU
   267	400164'	000000*	400025'			XWD     $OUTPT##,KWINTU
   268	400165'	000000*	400025'			XWD     $STLIM##,KWINTU
   269	400166'	000000*	400025'			XWD     $TRACE##,KWINTU
   270	400167'	000000*	400025'			XWD     $TRIM##,KWINTU
   271	400170'	000000*	400176'			XWD	$HIST##,KWHIST	; &HISTOGRAM
   272	400171'	000000*	400025'			XWD	$RAND##,KWINTU	; &RANDOM
   273	400172'	000000*	400025'			XWD	CMPNO##,KWINTU	; &COMPNO
   274	400173'	000000*	400025'			XWD	$ASSOC##,KWINTU	; &ASSOCIATE
   275	400174'	000000*	400025'			XWD	$ERRLV##,KWINTU	; &ERRLEVEL
   276	400175'	000000*	400103'			XWD	$VERSN##,KWVRSN	; &VERSION
   277

SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 10
SNOKEY	MAC	13-Oct-66 22:11		&HISTOGRAM

   278						SUBTTL	&HISTOGRAM
   279
   280						 ; HERE FOR &HISTOGRAM
   281						 ;
   282	400176'	254 00 0 00 400201'	KWHIST:: JRST	HSTVAL		; GET VALUE
   283	400177'	001 05 0 00 000007 		ERROR	5,7		; CANNOT HAVE NAME
   284	400200'	254 00 0 00 400210'		JRST	HSTASG		; MAKE ASSIGNMENT
   285
   286						 ; HERE TO GET VALUE
   287						 ;
   288	400201'	274 01 0 00 400336'	HSTVAL:	SUB	STACK,[2,,2]	; POP STACK
   289						 ;
   290	400202'	261 01 0 00 000000*		PUSH	STACK,$HIST	; PUSH
   291	400203'	261 01 0 00 000000#		PUSH	STACK,$HIST+1	; CURRENT HISTOGRAM
   292						 ;
   293	400204'	205 11 0 00 004003 		MOVSI	T1,SDT		; BUT IF ...
   294	400205'	336 00 0 00 400202*		SKIPN	$HIST		; NOT THERE ...
   295	400206'	202 11 0 01 777777 		MOVEM	T1,-1(STACK)	; MAKE IT NULL
   296						 ;
   297	400207'	254 00 0 06 000001 		JRST	1(SLINK)	; NORMAL RETURN
   298
   299						 ; HERE TO ASSIGN TO &HISTOGRAM
   300						 ;
   301	400210'	265 11 0 00 400027*	HSTASG:	JSP	TLINK,CVTINT	; INSIST ON ...
   302	400211'	001 05 0 00 000006 		ERROR	5,6		; AN INTEGER
   303						 ;
   304	400212'	274 01 0 00 400336'		SUB	STACK,[2,,2]	; POP STACK
   305	400213'	200 10 0 01 000002 		MOVE	S3,2(STACK)	; IF NON-ZERO
   306	400214'	326 10 0 00 400223'		JUMPN	S3,HSTEST	; ESTABLISH NEW &HISTOGRAM
   307						 ;
   308	400215'	201 00 0 00 001000 		MOVEI	Z,1000		; CLEAR 
   309	400216'	413 00 0 00 000000*		ANDCAB	Z,TRFLGS##	; OUT
   310	400217'	047 00 0 00 000016 		APRENB	Z,		; TIME-INTERRUPTS
   311						 ;
   312	400220'	402 00 0 00 400205*		CLEARM	$HIST		; CLEAR
   313	400221'	402 00 0 00 000000#		CLEARM	$HIST+1		; CURRENT VALUE
   314						 ;
   315	400222'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN
   316
   317						 ; HERE TO ESTABLISH A NEW HISTOGRAM
   318						 ;
   319	400223'	321 10 0 00 400227'	HSTEST:	JUMPL	S3,HSTSYS	; JUMP IF FOR SYSTEM
   320						 ;
   321	400224'	550 07 0 00 000000*		HRRZ	S2,CMPNO##	; NEXT COMPILE NUMBER
   322	400225'	201 00 0 00 400315'		MOVEI	Z,PLUG2		; PLUG2 WILL PROCESS IT
   323	400226'	254 00 0 00 400235'		JRST	HSTSY1		; JOIN SYSTEM SETUP
   324
   325						 ; HERE TO SET UP HISTOGRAM FOR SYSTEM
   326						 ;
   327	400227'	201 07 0 00 000000*	HSTSYS:	MOVEI	S2,$ALPHA	; HIGHEST PURE ADDRESS
   328	400230'	620 07 0 00 400000 		TRZ	S2,400000	; ZAP OUT HIGH BIT
   329	400231'	242 07 0 10 000000 		LSH	S2,0(S3)	; DIVIDE BY WORDS PER BUCKET
   330	400232'	340 07 0 00 000000 		AOJ	S2,		; BUMP BY ONE FOR GOOD MEASURE
   331						 ;
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 10-1
SNOKEY	MAC	13-Oct-66 22:11		&HISTOGRAM

   332	400233'	202 10 0 00 000000#		MOVEM	S3,HSTSAV##+1	; SAVE SHIFT VALUE
   333	400234'	201 00 0 00 400310'		MOVEI	Z,PLUG1		; TRAP ADDRESS
   334						 ;
   335						 ; HERE FROM USER HISTOGRAM SETUP
   336						 ;
   337	400235'	202 00 0 00 000000*	HSTSY1:	MOVEM	Z,HSTLOC##	; INDICATE TRAP HANDLER
   338						 ;
   339	400236'	265 00 0 00 000000*		PUSHR	PS		; SAVE REGS
   340	400237'	000006	000004
   341	400240'	202 07 0 00 000000#		MOVEM	S2,HSTSAV+2	; SAVE UPPER BND
   342						 ;
   343	400241'	265 06 0 00 000000*		JSP	SLINK,LINE.##	; CREATE
   344	400242'	000000	000003			XWD	0,3		; A
   345	400243'	004003	400337'			XWD	SDT,["0",,1]	; PROTOTYPE
   346	400244'	004003	400340'			XWD	SDT,[":",,1]	; WITH LB OF 0
   347	400245'	002001	000000#			XWD	IDT,HSTSAV+2	; AND UPPER BOUND S2
   348						 ;
   349	400246'	261 01 0 00 400334'		PUSH	STACK,[IDT,,0]	; INITIAL ...
   350	400247'	261 01 0 00 400335'		PUSH	STACK,[0]	; VALUES
   351	400250'	476 00 0 00 000000*		SETOM	GRFLAG##	; INTO THE GRWNG STORE
   352	400251'	265 04 0 00 000000*		JSP	PLINK,ARRAY##	; MAKE AN ARRAY
   353	400252'	001 17 0 00 000000 		ERROR	15		; CAN'T FAIL
   354	400253'	402 00 0 00 400250*		CLEARM	GRFLAG		; RESET GROWING REGION FLAG
   355	400254'	262 01 0 00 000000#		POP	STHIST+1	; RETRIEVE
   356	400255'	262 01 0 00 400220*		POP	STACK,$HIST	; ARRAY
   357	400256'	265 00 0 00 000000*		POPR	PS		; AND RESTORE REGS.
   358	400257'	000005	000004
   359						 ;
   360	400260'	201 00 0 00 001000 		MOVEI	Z,1000		; ESTABLISH
   361	400261'	437 00 0 00 400216*		IORB	Z,TRFLGS	; OR WITH OTHER FLAGS
   362	400262'	047 00 0 00 000016 		APRENB	Z,		; TRAP
   363						 ;
   364	400263'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN
   365
   366						 ; HERE ON INTERRUPTS OF ANY KIND
   367						 ;
   368	400264'	202 07 0 00 000000*	INTRPT::MOVEM	S2,HSTSAV	; SAVE S2
   369	400265'	250 10 0 00 000000#		EXCH	S3,HSTSAV+1	; AND S3
   370						 ;
   371	400266'	200 07 0 00 000126 		MOVE	S2,.JBCNI	; GET CONDITIONS
   372	400267'	602 07 0 00 001000 		TRNE	S2,1000		; SEE IF TIME BIT IS ON
   373	400270'	254 00 1 00 400235*		JRST	@HSTLOC		; PLUG HISTOGRAM IF SO
   374						 ;
   375	400271'	250 10 0 00 000000#		EXCH	S3,HSTSAV+1	; PUT S3 BACK
   376						 ;
   377	400272'	200 17 0 00 000127 		MOVE	Q3,.JBTPC	; PICK UP OFFENDING ...
   378	400273'	200 17 0 17 777777 		MOVE	Q3,-1(Q3)	; INSTRUCTION
   379	400274'	242 17 0 00 777751 		LSH	Q3,-^D23	; GET AC ...
   380	400275'	405 17 0 00 000017 		ANDI	Q3,17		; INTO Q3-RIGHT
   381	400276'	200 17 0 17 000000 		MOVE	Q3,0(Q3)	; LOAD CONTENTS OF THIS REGISTER
   382						 ;
   383	400277'	200 16 0 00 400261*		MOVE	Q2,TRFLGS##	; MUST RE-ENABLE ...
   384	400300'	047 16 0 00 000016 		APRENB	Q2,		; TRAPS
   385						 ;
   386	400301'	550 15 0 00 000000*		HRRZ	Q1,HSBASE##	; IS HIST. STACK ...
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 10-2
SNOKEY	MAC	13-Oct-66 22:11		&HISTOGRAM

   387	400302'	301 15 0 17 777773 		CAIL	Q1,-5(Q3)	; BEYOND US?
   388	400303'	001 06 0 00 000004 		ERROR	6,4		; YES, NAME STACK
   389						 ;
   390	400304'	550 15 0 00 400064*		HRRZ	Q1,STBASE##	; IS SYSTEM STACK
   391	400305'	301 15 0 17 777773 		CAIL	Q1,-5(Q3)	; BEYOND US?
   392	400306'	001 06 0 00 000003 		ERROR	6,3		; YES, HISTORY
   393						 ;
   394	400307'	001 06 0 00 000002 		ERROR	6,2		; NO, SYSTEM STACK
   395
   396						 ; HERE WHEN A SYS TRAP OCCURS
   397						 ;
   398	400310'	550 07 0 00 000127 	PLUG1:	HRRZ	S2,.JBTPC	; GET PC
   399	400311'	620 07 0 00 400000 		TRZ	S2,400000	; CLEAR HIGH ORDER BIT
   400	400312'	242 07 0 10 000000 		LSH	S2,0(S3)	; SHIFT AS USUAL
   401	400313'	326 07 0 00 400317'		JUMPN	S2,PLUG3	; EITHER JUMP OR ...
   402	400314'	344 07 0 00 400317'		AOJA	S2,PLUG3	; BUMP AND JUMP
   403
   404						 ; HERE WHEN USER TRAP OCCURS
   405						 ;
   406	400315'	336 07 0 00 000000*	PLUG2:	SKIPN	S2,$STNO##	; GET &STNO
   407	400316'	201 07 0 00 000001 		MOVEI	S2,1		; OK, MAKEIT 1
   408						 ;
   409						 ; MERGE HERE FROM SYS TRAPS
   410						 ;
   411	400317'	250 06 0 00 400255*	PLUG3:	EXCH	S1,$HIST	; ADDRESS OF ARRAY
   412	400320'	313 07 0 00 000000#		CAMLE	S2,HSTSAV+2	; WITHIN BOUNDS?
   413	400321'	254 00 0 00 400326'		JRST	PLUG4		; NO
   414						 ;
   415	400322'	350 00 0 06 000010 		AOS	SUBFAC+3(S1)	; BUMP ZERO'TH
   416	400323'	242 07 0 00 000001 		LSH	S2,1		; DOUBLE
   417	400324'	270 07 0 00 000006 		ADD	S2,S1		; ADD ADDRESS OF ARRAY
   418	400325'	350 00 0 07 000010 		AOS	SUBFAC+3(S2)	; INCREMENT
   419						 ;
   420	400326'	250 10 0 00 000000#	PLUG4:	EXCH	S3,HSTSAV+1	; RESTORE 
   421	400327'	250 06 0 00 400317*		EXCH	S1,$HIST	; THINGS
   422						 ;
   423	400330'	200 07 0 00 400277*		MOVE	S2,TRFLGS	; REESTABLISH
   424	400331'	047 07 0 00 000016 		APRENB	S2,		; TRAP
   425	400332'	200 07 0 00 400264*		MOVE	S2,HSTSAV	; RESTORE S2
   426	400333'	254 02 1 00 000127 		JRSTF	@.JBTPC		; AND RETURN
   427
   428
   429						END

NO ERRORS DETECTED

HI-SEG. BREAK IS 400341
PROGRAM BREAK IS 000000
CPU TIME USED 03:07.833

42P CORE USED
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page S-1
SNOKEY	MAC	13-Oct-66 22:11		SYMBOL TABLE

APRENB	047000	000016		KWSIZE		400076'		$ERRTP		400034'	ext	
ARRAY		400251'	ext	KWSTR		400052'		$FAIL		000000	ext	
CEIL		400076'	ext	KWVRSN		400103'		$FENCE		000000	ext	
CMPNO		400224'	ext	KYMASK		000077	sin	$FNCLV		000000	ext	
CVTDW		400110'	ext	LINE.		400241'	ext	$FTRC		000000	ext	
CVTINT		400210'	ext	LREGP		000002	spd	$FULL		000000	ext	
CVTSTR		400105'	ext	LREGS		000003	spd	$HIST		400327'	ext	
CVTWD		400120'	ext	MARGIN		000100	spd	$INPUT		000000	ext	
E15$		000000	sin	P2		000005		$JOBNO		000000	ext	
E5$1		000000	sin	PDT		004004	sin	$LASTN		000000	ext	
E5$2		000000	sin	PLINK		000004		$MAXL		000000	ext	
E5$6		000000	sin	PLUG1		400310'		$OUTPT		000000	ext	
E5$7		000000	sin	PLUG2		400315'		$RAND		000000	ext	
E6$2		000000	sin	PLUG3		400317'		$REM		000000	ext	
E6$3		000000	sin	PLUG4		400326'		$RTNTP		000000	ext	
E6$4		000000	sin	PPL		000005	spd	$STCNT		000000	ext	
ERR	001000	000000		PPR		400256'	ext	$STFCT		000000	ext	
ERRMSG		000000	ext	PROTKW		400123'	int	$STLIM		000000	ext	
ERRNAM		000000	ext	PSHR		400236'	ext	$STNO		400315'	ext	
ERRPRM		000000	ext	Q1		000015		$SUCC		000000	ext	
ERRTPA		400040'	ext	Q2		000016		$TRACE		000000	ext	
ETPTRC		400037'	ext	Q3		000017		$TRIM		000000	ext	
FRSTNM		000000	ext	REGP		000004	spd	$VERSN		000000	ext	
FTDEBU		000000	spd	RETNUL		400052'	ext	%%JOBD	043100	000450	spd	
GETPPN	047000	000024		S1		000006		%%MACT	000200	000025	spd	
GRFLAG		400253'	ext	S2		000007		%%SNOP	000500	000305	spd	
HSBASE		400301'	ext	S3		000010		%%UUOS	001400	000457	spd	
HSTASG		400210'		SDT		004003	sin	.JBCNI		000126		
HSTEST		400223'		SLINK		000006		.JBHGH		400000	spd	
HSTLOC		400270'	ext	STACK		000001		.JBHVR		000004	spd	
HSTSAV		400332'	ext	STBASE		400304'	ext	.JBTPC		000127		
HSTSY1		400235'		SUBFAC		000005	sin	.JBVER		000137		
HSTSYS		400227'		SYSTR		400053'	ext	
HSTVAL		400201'		T1		000011		
IDT		002001	sin	T2		000012		
IGNOP		400004'	ext	TLINK		000011		
IGNOS		400041'	ext	TRFLGS		400330'	ext	
INTRPT		400264'	int	TVAR		034000	sin	
KEYASC	456133	100000	spd	UPROKW		400152'	int	
KEYEDT		000204	spd	VAR		064000	sin	
KEYMIN		000000	spd	VERHGH		400115'		
KEYSIX	534571	000000	spd	VKEY		000006	sin	
KEYVER		000005	spd	XWD22		400115'	ext	
KEYW		400000'	int	Z		000000		
KEYW1		400017'		$ABEND		000000	ext	
KEYWHO		000000	spd	$ABORT		000000	ext	
KWCMD		400064'		$ALPHA		400227'	ext	
KWDESC		400061'		$ANCH		000000	ext	
KWHIST		400176'	int	$ARB		000000	ext	
KWINT		400056'		$ASSOC		000000	ext	
KWINT1		400041'		$BAL		000000	ext	
KWINT2		400040'		$CODE		000000	ext	
KWINTU		400025'		$DUMP		000000	ext	
KWPAT		400046'		$ERRLM		000000	ext	
KWPPN		400070'		$ERRLV		000000	ext	

SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 1
SNOKEY	MAC	13-Oct-66 22:11		Ma355 -- Gimpel/JDS/MDP/RCM/VB		29-Sep-76


Symbol cross reference

ARRAY	   352
CEIL	   191
CMPNO	   273	   321
CVTDW	   210
CVTINT	   126	   301
CVTSTR	   206
CVTWD	   184	   224
E15$	   185#	   225#	   353#
E5$1	    84#
E5$2	    88#
E5$6	   127#	   207#	   211#	   302#
E5$7	   125#	   202#	   283#
E6$2	   394#
E6$3	   392#
E6$4	   388#
ERRMSG	   254
ERRNAM	   253
ERRPRM	   251
ERRTPA	   139
ETPTRC	   138
FRSTNM	   248
FTDEBU	   339	   357
GRFLAG	   351	   354
HSBASE	   386
HSTASG	   284	   301#
HSTEST	   306	   319#
HSTLOC	   337	   373
HSTSAV	   332	   341	   347	   368	   369	   375	   412	   420	   425
HSTSY1	   323	   337#
HSTSYS	   319	   327#
HSTVAL	   282	   288#
IDT	   147	   164	   193	   347	   349
IGNOP	    78	    83
IGNOS	   130	   145
INTRPT	   368#
KEYASC	    31#
KEYEDT	    24#
KEYMIN	    23#
KEYSIX	    30#
KEYVER	    22#
KEYW	    78#
KEYW1	    91	   102#
KEYWHO	    25#
KWCMD	   173#	   247
KWDESC	   167#	   233	   251	   253	   254
KWHIST	   271	   282#
KWINT	   164#	   238	   239	   242	   243	   244	   246	   248
KWINT1	   124	   145#
KWINT2	   139#
KWINTU	   124#	   257	   258	   259	   260	   261	   262	   263	   264	   265	   266	   267	   268	   269
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 1
SNOKEY	MAC	13-Oct-66 22:11		Ma355 -- Gimpel/JDS/MDP/RCM/VB		29-Sep-76


Symbol cross reference

	   270	   272	   273	   274	   275
KWPAT	   156#	   232	   234	   235	   236	   237	   240	   245
KWPPN	   180#	   249
KWSIZE	   189#	   250
KWSTR	   160#	   241
KWVRSN	   201#	   276
KYMASK	    87	    89
LINE.	   343
LREGP	   339	   357
LREGS	   339	   357
MARGIN	   192
P2	    79	    81	    86
PDT	   156
PLINK	   107	   159	   163	   166	   169	   176	   187	   195	   352
PLUG1	   333	   398#
PLUG2	   322	   406#
PLUG3	   401	   402	   411#
PLUG4	   413	   420#
PPL	   339#	   339	   340	   357#	   357	   358
PPR	   357
PROTKW	    95	    96	   231#
PSHR	   339
Q1	   191	   192	   194	   386	   387	   390	   391
Q2	   383	   384
Q3	   377	   378	   379	   380	   381	   387	   391
REGP	   339	   340	   357	   358
RETNUL	   160
S1	    81	    82	    86	    87	    89	    90	    95	    96	    97	   103	   105	   411	   415	   417
	   421
S2	    95	   102	   103	   104	   105	   106	   128	   129	   135	   146	   148	   156	   157	   160
	   162	   165	   167	   168	   321	   327	   328	   329	   330	   341	   368	   371	   372	   398
	   399	   400	   401	   402	   406	   407	   412	   416	   417	   418	   423	   424	   425
S3	   305	   306	   319	   329	   332	   369	   375	   400	   420
SDT	   293	   345	   346
SLINK	   136	   138	   149	   215	   227	   297	   315	   343	   364
STACK	    78	    79	   104	   106	   128	   129	   130	   145	   146	   147	   148	   157	   158	   161
	   162	   164	   165	   167	   168	   174	   175	   193	   194	   214	   219	   288	   290	   291
	   295	   304	   305	   349	   350	   355	   356
STBASE	   173	   390
SUBFAC	   415	   418
SYSTR	   161
T1	   173	   174	   175	   293	   295
T2	   180	   221
TLINK	   126	   184	   206	   210	   224	   301
TRFLGS	   309	   361	   383	   423
TVAR	   102
UPROKW	   103	   105	   257#
VAR	    82
VERHGH	   201	   219#
VKEY	    86
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 1
SNOKEY	MAC	13-Oct-66 22:11		Ma355 -- Gimpel/JDS/MDP/RCM/VB		29-Sep-76


Symbol cross reference

XWD22	   214	   219
Z	   183	   209	   213	   223	   308	   309	   310	   322	   333	   337	   339	   357	   360	   361
	   362
$ABEND	   257
$ABORT	   232
$ALPHA	   233	   327
$ANCH	   258
$ARB	   234
$ASSOC	   274
$BAL	   235
$CODE	   259
$DUMP	   260
$ERRLM	   262
$ERRLV	   275
$ERRTP	   135	   137	   261
$FAIL	   236
$FENCE	   237
$FNCLV	   238
$FTRC	   263
$FULL	   264
$HIST	   271	   290	   291	   294	   312	   313	   355	   356	   411	   421
$INPUT	   265
$JOBNO	   246
$LASTN	   239
$MAXL	   266
$OUTPT	   267
$RAND	   272
$REM	   240
$RTNTP	   241
$STCNT	   242
$STFCT	   243
$STLIM	   268
$STNO	   244	   406
$SUCC	   245
$TRACE	   269
$TRIM	   270
$VERSN	   276
.JBCNI	   371
.JBHGH	   221
.JBHVR	   221
.JBTPC	   377	   398	   426
.JBVER	   213
SNOKEY - Keywords  %5(204)	MACRO %53B(1156)-1 21:50 14-Mar-88 Page 1
SNOKEY	MAC	13-Oct-66 22:11		Ma355 -- Gimpel/JDS/MDP/RCM/VB		29-Sep-76


Macro/Opdef cross reference

APRENB	   310	   362	   384	   424
ERR	    84	    88	   125	   127	   185	   202	   207	   211	   225	   283	   302	   353	   388	   392
	   394
ERROR	    84	    88	   125	   127	   185	   202	   207	   211	   225	   283	   302	   353	   388	   392
	   394
GETPPN	   180
KEYPTX	    43
KEYTTL	    42
MIDENT	   340	   358
POPR	   357
PPADDR	   339#	   340	   357#	   358
PPINIT	   339	   357
PPLENG	   339#	   340	   357#	   358
PUSHR	   339
SHOW.	    37	    38	    39	    40
TITLE.	    29 5@ ]Ï
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76

     1						SUBTTL	MA355/JDS/DRH/MP/RCM/VB		20-AUG-76
     2
     3					; COPYRIGHT 1972,1973,1976,1977 STEVENS INSTITUTE OF TECHNOLOGY
     4					; HOBOKEN, NEW JERSEY 07030
     5					; ALL RIGHTS RESERVED.
     6
     7					  ;UNIVERSALS
     8
     9						SEARCH	SNOPRM		;SITBOL PARAMETERS
    10						SEARCH	JOBDAT		;JOB DATA AREA DEFINITIONS
    11						SEARCH	MACTEN		;DEC-10 MACRO DEFINITIONS
    12					IFN FTOPS10,SEARCH	UUOSYM		;[244] TOPS10 UUO SYMBOLS
    13					IFN FTOPS20,SEARCH	MONSYM		;[244] TOPS-20 JSYS definitions
    14
    15					  ;DIRECTIVES
    16
    17						.DIREC	.XTABM		;EXCLUDE TABS FROM MACRO CALLS
    18						SALL			;SUPPRESS MACRO EXPANSIONS
    19	400000'					TWOSEG	400K		;TWOSEGMENT CODE
    20
    21					  ;VERSION NUMBER
    22
    23			000005			FIOVER==5		;MAJOR VERSION NUMBER
    24			000000			FIOMIN==0		;MINOR VERSION NUMBER
    25			000303			FIOEDT==303		;EDIT LEVEL
    26			000000			FIOWHO==0		;CUSTOMER ARGUMENT
    27
    28					 ;TITLE
    29
    30						TITLE.	FIO,SNOFIO,<I/O and System Interface>
    31		465157	000000			FIOSIX==SIXBIT /FIO/	; SNOFIO ABBREVIATION IN SIXBIT
    32		432231	700000			FIOASC==ASCIZ /FIO/	; SNOFIO ABBREVIATION IN ASCII
    33						SALL
    34
    35
    36					  ;SHOW UNIVERSAL'S VERSION NUMBERS
    37
    38	400000'	000500	000305			SHOW.	%%SNOP		;VERSION NUMBER OF SNOPRM
    39	400000'	000200	000025			SHOW.	%%MACT		;VERSION NUMBER OF MACTEN
    40	400000'	001400	000457		IFN FTOPS10,SHOW.	%%UUOS		;[244] VERSION NUMBER OF UUOSYM
    41					IFN FTOPS20,SHOW.	%%MONS		;[244] MONSYM's version number
    42	400000'	043100	000450			SHOW.	%%JOBD		;VERSION NUMBER OF JOBDAT
    43
    44	000137					LOC	.JBVER		;VERSION NUMBER
    45	000137	000500	000305			VERSION			;SITBOL VERSION NUMBER
    46
    47	400000'					RELOC	400K		;BACK TO THE HIGH SEG
    48
    49						FIOTTL			; Title
    50						FIOPTX			; PASS2 assembly message
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 2
SNOFIO	MAC	15-Mar-69 11:20		Table of Contents

    51						SUBTTL	Table of Contents
    52
    53
    54					;		Table of Contents for SNOFIO - SITBOL I/O and System Interface
    55					;
    56					;
    57					;			   Section			      Page
    58					;   1. Table of Contents. . . . . . . . . . . . . . . . . . .    2
    59					;   2. REVISION HISTORY . . . . . . . . . . . . . . . . . . .    3
    60					;   3. Dispatch table . . . . . . . . . . . . . . . . . . . .    4
    61					;   4. STORAGE INITIALIZATION . . . . . . . . . . . . . . . .    5
    62					;   5. OPENING THE COMMAND STRING . . . . . . . . . . . . . .    9
    63					;   6. FIRST PASS OVER THE COMMAND. . . . . . . . . . . . . .   11
    64					;   7. RECONFIGURATION OF STORAGE . . . . . . . . . . . . . .   13
    65					;   8. 2ND PASS OVER THE COMMAND STRING . . . . . . . . . . .   14
    66					;   9. STORAGE CONTROL. . . . . . . . . . . . . . . . . . . .   17
    67					;  10. P (PRIMARY) ROUTINES FOR I/O . . . . . . . . . . . . .   24
    68					;  11. Primary routines
    69					;       11.1.   DATE. . . . . . . . . . . . . . . . . . . . .   25
    70					;       11.2.   DELETE. . . . . . . . . . . . . . . . . . . .   26
    71					;       11.3.   DETACH. . . . . . . . . . . . . . . . . . . .   27
    72					;       11.4.   ENDFILE . . . . . . . . . . . . . . . . . . .   28
    73					;       11.5.   EXIT. . . . . . . . . . . . . . . . . . . . .   29
    74					;       11.6.   FILE. . . . . . . . . . . . . . . . . . . . .   31
    75					;       11.7.   INPUT . . . . . . . . . . . . . . . . . . . .   33
    76					;       11.8.   MTAPE . . . . . . . . . . . . . . . . . . . .   34
    77					;       11.9.   OUTPUT. . . . . . . . . . . . . . . . . . . .   35
    78					;       11.10.  RENAME. . . . . . . . . . . . . . . . . . . .   36
    79					;       11.11.  RESCAN. . . . . . . . . . . . . . . . . . . .   37
    80					;       11.12.  REWIND. . . . . . . . . . . . . . . . . . . .   38
    81					;       11.13.  RUN . . . . . . . . . . . . . . . . . . . . .   39
    82					;       11.14.  TIME. . . . . . . . . . . . . . . . . . . . .   40
    83					;       11.15.  TTY . . . . . . . . . . . . . . . . . . . . .   41
    84					;  12. TYPE S (SECONDARY) UTILITIES . . . . . . . . . . . . .   42
    85					;  13. Secondary routines
    86					;       13.1.   CVTFMT. . . . . . . . . . . . . . . . . . . .   43
    87					;       13.2.   CVTIO . . . . . . . . . . . . . . . . . . . .   45
    88					;       13.3.   CVTSIO. . . . . . . . . . . . . . . . . . . .   46
    89					;       13.4.   GETOCT. . . . . . . . . . . . . . . . . . . .   47
    90					;       13.5.   IOASSN. . . . . . . . . . . . . . . . . . . .   48
    91					;       13.6.   NONBLK. . . . . . . . . . . . . . . . . . . .   49
    92					;       13.7.   STFILS. . . . . . . . . . . . . . . . . . . .   50
    93					;       13.8.   TVIN & TVOUT. . . . . . . . . . . . . . . . .   52
    94					;  14. TYPE T (TERTIARY) I/O UTILITIES. . . . . . . . . . . .   58
    95					;  15. Tertiary routines
    96					;       15.1.   CLSALL. . . . . . . . . . . . . . . . . . . .   59
    97					;       15.2.   CVTDW . . . . . . . . . . . . . . . . . . . .   60
    98					;       15.3.   CVTWD . . . . . . . . . . . . . . . . . . . .   62
    99					;       15.4.   DTCH. . . . . . . . . . . . . . . . . . . . .   63
   100					;       15.5.   FILECH. . . . . . . . . . . . . . . . . . . .   64
   101					;       15.6.   PEJECT. . . . . . . . . . . . . . . . . . . .   65
   102					;       15.7.   READ. . . . . . . . . . . . . . . . . . . . .   66
   103					;       15.8.   MAKEIO. . . . . . . . . . . . . . . . . . . .   75
   104					;       15.9.   STRIO . . . . . . . . . . . . . . . . . . . .   75
   105					;       15.10.  WRITE . . . . . . . . . . . . . . . . . . . .   80
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 2-1
SNOFIO	MAC	15-Mar-69 11:20		Table of Contents

   106					;  16. TYPE Q (QUATERNARY) I/O UTILITIES. . . . . . . . . . .   85
   107					;  17. Quaternary routines
   108					;       17.1.   ALBUF . . . . . . . . . . . . . . . . . . . .   86
   109					;       17.2.   CLRFSV. . . . . . . . . . . . . . . . . . . .   88
   110					;       17.3.   CLS . . . . . . . . . . . . . . . . . . . . .   89
   111					;       17.4.   LKP . . . . . . . . . . . . . . . . . . . . .   90
   112					;       17.5.   ENTR. . . . . . . . . . . . . . . . . . . . .   91
   113					;       17.6.   MODE. . . . . . . . . . . . . . . . . . . . .   92
   114					;       17.7.   MSTIME. . . . . . . . . . . . . . . . . . . .   93
   115					;       17.8.   OPN . . . . . . . . . . . . . . . . . . . . .   94
   116					;       17.9.   WMPROP. . . . . . . . . . . . . . . . . . . .   95
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 3
SNOFIO	MAC	15-Mar-69 11:20		REVISION HISTORY

   117						SUBTTL	REVISION HISTORY
   118
   119					COMMENT	\
   120					122	RECONFIGURE THE SYSTEM AND RENAME THE MODULES.
   121					130	DELETE THE TMP FILE FROM DISK.
   122					134	Add PORTALs for SNODEB and SNOPAV.
   123					140	FIX PROBLEM WITH FILE SPECIFICATION SCANNER.
   124					141	REMEMBER WERE WE CAME FROM (SAVE .SGNAM, .SGDEV, .SGPPN)
   125					142	Add a third argument to the EXIT function.
   126					143	FIX EDIT 130.
   127					147	Use Y.???? instead of X.????, and use the correct macros
   128						to handle them.
   129					157	Fix a mistake in the dispatch table. 
   130					160	Fix a mistake in edit 143.
   131					166	Finish SFD handling.
   132					172	Fix a slight problem in the command scanner
   133					175	Remove SETDDT UUO from EXIT2
   134					176	FIX PROBLEM WITH SEGDEV & SEGNAM IN SNOFIO
   135					177	FIX SNOFIO SO ^Z'S WORK CORRECTLY
   136					200	TOUCH UP SLIGHT BUG WITH SFD'S.
   137					202	ADD APPEND MODE I/O.
   138					204	Add new keyword &VERSION.
   139					210	Fix a fix to the file spec. scanner.
   140					213	Fix problems with the output associations file.
   141					223	Remove the rewind from the close routine (CLS).
   142					230	Don't bomb if no  line feed in the TMPCOR file.
   143						Also RELEAS channel 17 all  the time.
   144					232	Make absolute errors give real errors (i.e. Experation
   145						date has expired.  NOT ill mem ref).
   146					235	Use correct defaults for proj. and prog. no. if not supplied.
   147					240	Redefine FMT.AP
   148					243	Get the processor type.
   149					244	Add a little support for the FTOPS10 and FTOPS20 feature tests.
   150					245	Add missing PORTAL
   151					246	Redefine some definitions from this module to SNOPRM
   152					251	Add another missing PORTAL
   153					255	Add a Low Segment version number.
   154					260	Fix ENDFILE so that it will close files correctly.
   155					264	Use defaults for SITBOL's name, prefix and extension.
   156					266	Put a JSP in .JB41 instead of a JRST.
   157					273	Don't do the error 15  on a fail from DEVNAM at STIO7.
   158					274	In STRIO a reference to IOPPN should actually be to IOSFD.
   159					275	Append to the end of the listing file after requesting a listing
   160						following an EXIT().
   161					276	Don't die if the nnnSNO.TMP file is protected when deleteing it.
   162					277	Fix a ridiculous bug where TIME(1) returns the value that
   163						its given (1).  typo.
   164					300	Allow EXIT(-1) to work on a KI-KL on EXO SITBOL.
   165					301	In STRIO also check for identical PATH against other files.  This
   166						lack of a check caused two files with different PATH's but the same
   167						name to be treated as one.
   168					303	Another bug in STRIO, PPN is checked in the wrong order, messing up
   169						check of files.
   170					\
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 4
SNOFIO	MAC	15-Mar-69 11:20		Dispatch table

   171						SUBTTL	Dispatch table
   172
   173					;THE FOLLOWING DISPATCH TABLE HAS BEEN ADDED SO THAT .SAV (OR .EXE)
   174					;FILES WILL REMAIN COMPATIBLE WITH FUTURE VERSIONS OF SITBOL.
   175
   176
   177			377770'			JOBHGH==:DSPTBL-.JBHDA	;[270]	MAKE SYMBOL JOBHGH
   178
   179	400000'				DSPTBL::			;START OF THE DISPATCH TABLE
   180	400000'	254 01 0 00 400356'	REENTR:	PORTAL	$REENT		;REENTER ADDRESS
   181	400001'	000001	000001			FUNC	DATE$,1,E,DATES
   182	400002'	254 01 0 00 401204'
   183	400003'	000003	000001			FUNC	DELET$,1,ES,DEL
   184	400004'	254 01 0 00 401225'
   185	400005'	000001	000001			FUNC	DTCH$,1,E,DETCH
   186	400006'	254 01 0 00 401237'
   187	400007'	000001	000001			FUNC	ENDFL$,1,E,ENDFIL
   188	400010'	254 01 0 00 401243'
   189	400011'	000003	000003			FUNC	EXIT$,3,ES,EXIT0
   190	400012'	254 01 0 00 401251'
   191	400013'	000003	000001			FUNC	FILE$,1,ES,FILE
   192	400014'	254 01 0 00 401360'
   193	400015'	000003	000003			FUNC	INPUT$,3,ES,INPUT0
   194	400016'	254 01 0 00 401413'
   195	400017'	000003	000003			FUNC	MTAPE$,3,ES,MTAPE0
   196	400020'	254 01 0 00 401430'
   197	400021'	000003	000003			FUNC	OUTPT$,3,ES,OUTPT0
   198	400022'	254 01 0 00 401465'
   199	400023'	000003	000002			FUNC	RENAM$,2,ES,RENAM
   200	400024'	254 01 0 00 401502'
   201	400025'	000003	000001			FUNC	RSCN$,1,ES,RESCN
   202	400026'	254 01 0 00 401526'
   203	400027'	000003	000001			FUNC	RWND$,1,ES,RWND
   204	400030'	254 01 0 00 401565'
   205	400031'	000003	000002			FUNC	RUN$,2,ES,RUN0
   206	400032'	254 01 0 00 401604'
   207	400033'	000003	000001			FUNC	TIME$,1,ES,TIME0
   208	400034'	254 01 0 00 401630'
   209	400035'	000003	000001			FUNC	TTY$,1,ES,TTY
   210	400036'	254 01 0 00 401642'
   211	400037'	000003	000002			FUNC	LOAD$,2,ES,LOAD##
   212	400040'	254 01 0 00 000000*
   213	400041'	254 01 0 00 000000*	EFCAL$::PORTAL	EFCALL##		;Call an external function
   214	400042'	000003	000001			FUNC	UNLD$,1,ES,UNLD##	;UNLOAD - unload an external function
   215	400043'	254 01 0 00 000000*
   216	400044'	000000	000001			FUNC	KEYW$,1,,KEYW##		;Function KEYW
   217	400045'	254 01 0 00 000000*
   218	400046'	000001	000001			FUNC	DATA$,1,E,DATA##	;DATA - PRIMARY FUNCTION
   219	400047'	254 01 0 00 000000*
   220	400050'	000003	000002			FUNC	FIELD$,2,ES,FIELD##	;FIELD - PRIMARY FUNCTION
   221	400051'	254 01 0 00 000000*
   222	400052'	254 01 0 00 000000*	FLDRF$::PORTAL	FLDREF##		;REF TO FLD OF DEFINED DATA OBJ
   223	400053'	000003	000002			FUNC	DFN$,2,ES,DFN##		;DEFINE
   224	400054'	254 01 0 00 000000*
   225	400055'	000000	377777			FUNC	APPLY$,,A,APPLY##	;APPLY
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 4-1
SNOFIO	MAC	15-Mar-69 11:20		Dispatch table

   226	400056'	254 01 0 00 000000*
   227	400057'	000003	000002			FUNC	ARG$,2,ES,ARG##		;ARG
   228	400060'	254 01 0 00 000000*
   229	400061'	000003	000002			FUNC	LOCAL$,2,ES,LOCAL##	;LOCAL
   230	400062'	254 01 0 00 000000*
   231	400063'	254 01 0 00 000000*	DFF$::	PORTAL	DFF##			;CALL TO DEFINED FUNCTION
   232	400064'	000003	000002			FUNC	STPTR$,2,ES,STOPTR##	;STOPTR
   233	400065'	254 01 0 00 000000*
   234	400066'	000001	000004			FUNC	TRACE$,4,E,TRACE##	;TRACE FUNCTION
   235	400067'	254 01 0 00 000000*
   236	400070'	000002	000002			FUNC	ASGN$,2,S,ASGN##	;ASSIGN FUNCTION
   237	400071'	254 01 0 00 000000*
   238	400072'	000003	000001			FUNC	DUMP$,1,ES,DUMP##	;DUMP FUNCTION
   239	400073'	254 01 0 00 000000*
   240	400074'	254 01 0 00 000000*	ERRA$::	PORTAL	ERRA##			;APR ENTRY POINT
   241	400075'	000001	000001			FUNC	STXT$,1,E,STXT##	;SETEXIT FUNCTION
   242	400076'	254 01 0 00 000000*
   243	400077'	000003	000002			FUNC	CLLCT$,2,ES,CLLCT##	;COLLECT FUNCTION
   244	400100'	254 01 0 00 000000*
   245	400101'	000003	000002			FUNC	ALT$,2,ES,ALT##		;ALTERATIONS OF PATTTERNS
   246	400102'	254 01 0 00 000000*
   247	400103'	000001	000001			FUNC	ARBNO$,1,E,ARBNO##	;ARBNO FUNCTION
   248	400104'	254 01 0 00 000000*
   249	400105'	000002	000002			FUNC	IMVA$,2,S,IMVA##	;
   250	400106'	254 01 0 00 000000*
   251	400107'	000002	000002			FUNC	CNVA$,2,S,CNVA##	;CONDITIONAL VARIABLE ASSOC.
   252	400110'	254 01 0 00 000000*
   253	400111'	000002	000002			FUNC	MTCH$,2,S,MTCH##	;
   254	400112'	254 01 0 00 000000*
   255	400113'	000001	000001			FUNC	ANY$,1,E,ANY##		;ANY
   256	400114'	254 01 0 00 000000*
   257	400115'	000001	000001			FUNC	NTNY$,1,E,NTNY##	;NOTANY
   258	400116'	254 01 0 00 000000*
   259	400117'	000001	000001			FUNC	BREAK$,1,E,BREAK##	;BREAK
   260	400120'	254 01 0 00 000000*
   261	400121'	000001	000001			FUNC	BRKX$,1,E,BRKX##	;BREAKX
   262	400122'	254 01 0 00 000000*
   263	400123'	000001	000001			FUNC	SPAN$,1,E,SPAN##	;SPAN
   264	400124'	254 01 0 00 000000*
   265	400125'	000001	000001			FUNC	LEN$,1,E,LEN##		;LEN
   266	400126'	254 01 0 00 000000*
   267	400127'	000001	000001			FUNC	POS$,1,E,POS##		;POS
   268	400130'	254 01 0 00 000000*
   269	400131'	000001	000001			FUNC	RPOS$,1,E,RPOS##	;RPOS
   270	400132'	254 01 0 00 000000*
   271	400133'	000001	000001			FUNC	RTAB$,1,E,RTAB##	;RTAB
   272	400134'	254 01 0 00 000000*
   273	400135'	000001	000001			FUNC	TAB$,1,E,TAB##		;TAB
   274	400136'	254 01 0 00 000000*
   275	400137'	000000	000001			FUNC	CURS$,1,,CURS##		;
   276	400140'	254 01 0 00 000000*
   277	400141'	000003	000002			FUNC	CLEAR$,2,ES,CLEAR##	;CLEAR
   278	400142'	254 01 0 00 000000*
   279	400143'	000001	000001			FUNC	DTTP$,1,E,DTTP##	;DATATYPE
   280	400144'	254 01 0 00 000000*
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 4-2
SNOFIO	MAC	15-Mar-69 11:20		Dispatch table

   281	400145'	000001	000001			FUNC	FUNCT$,1,E,FUNCT##	;FUNCTION
   282	400146'	254 01 0 00 000000*
   283	400147'	000001	000001			FUNC	TRIM$,1,E,TRIM##	;TRIM
   284	400150'	254 01 0 00 000000*
   285					IFE FTDDT,<
   286						FUNC	LABEL$,1,E,LABEL##	;LABEL
   287					>
   288					IFN FTDDT,<
   289	400151'	000003	000002			FUNC	LABEL$,2,ES,LABEL##	;LABEL
   290	400152'	254 01 0 00 000000*
   291					>
   292	400153'	000003	000003			FUNC	OPSYN$,3,ES,OPSYN##	;OPSYN
   293	400154'	254 01 0 00 000000*
   294	400155'	000000	377777			FUNC	UNDEF$,,,UNDEF##	;[157] Undefined
   295	400156'	254 01 0 00 000000*
   296	400157'	000003	000001			FUNC	CODE$,1,ES,CODE##	;Code function
   297	400160'	254 01 0 00 000000*
   298	400161'	000001	000001			FUNC	ASCII$,1,E,ASCI.0##	;ASCII(n)
   299	400162'	254 01 0 00 000000*
   300	400163'	000003	000002			FUNC	CAT$,2,ES,CAT##		;CAT - CONCATENATION
   301	400164'	254 01 0 00 000000*
   302	400165'	000003	000002			FUNC	DFFR$,2,ES,DFFR##	;DIFFER
   303	400166'	254 01 0 00 000000*
   304	400167'	000003	000002			FUNC	IDENT$,2,ES,IDENT0##	;IDENT - IDENTICAL
   305	400170'	254 01 0 00 000000*
   306	400171'	000003	000002			FUNC	DUPL$,2,ES,DUPL##	;DUPL(s,n)
   307	400172'	254 01 0 00 000000*
   308	400173'	000003	000002			FUNC	LEQ$,2,ES,LEQ##		;LEQ
   309	400174'	254 01 0 00 000000*
   310	400175'	000003	000002			FUNC	LGE$,2,ES,LGE##		;LGE
   311	400176'	254 01 0 00 000000*
   312	400177'	000003	000002			FUNC	LGT$,2,ES,LGT##		;LGT
   313	400200'	254 01 0 00 000000*
   314	400201'	000003	000002			FUNC	LLE$,2,ES,LLE##		;LGE
   315	400202'	254 01 0 00 000000*
   316	400203'	000003	000002			FUNC	LLT$,2,ES,LLT##		;LLT
   317	400204'	254 01 0 00 000000*
   318	400205'	000003	000002			FUNC	LNE$,2,ES,LNE##		;LNE
   319	400206'	254 01 0 00 000000*
   320	400207'	000001	377777			FUNC	LPAD$,,E,LPAD##		;LPAD
   321	400210'	254 01 0 00 000000*
   322	400211'	000001	377777			FUNC	RPAD$,,E,RPAD##		;RPAD
   323	400212'	254 01 0 00 000000*
   324	400213'	000003	000003			FUNC	RPLC$,3,ES,RPLC##	;REPLACE
   325	400214'	254 01 0 00 000000*
   326	400215'	000001	000001			FUNC	RVRS$,1,E,RVRS##	;REVERSE
   327	400216'	254 01 0 00 000000*
   328	400217'	000001	000001			FUNC	SIZE$,1,E,SIZE##	;SIZE
   329	400220'	254 01 0 00 000000*
   330	400221'	000001	000003			FUSTR$,3,E,SBSTR##	;SUBSTR
   331	400222'	254 01 0 00 000000*
   332	400223'	000003	000002			FUNC	TABLE$,2,ES,TABLE##	;TABLE
   333	400224'	254 01 0 00 000000*
   334	400225'	000003	000002			FUNC	ARRAY$,2,ES,ARRAY##	;ARRAY
   335	400226'	254 01 0 00 000000*
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 4-3
SNOFIO	MAC	15-Mar-69 11:20		Dispatch table

   336	400227'	000001	377777			FUNC	ITEM$,,E,ITEM##		;ITEM
   337	400230'	254 01 0 00 000000*
   338	400231'	000001	000001			FUNC	COPY$,1,E,COPY0##	;COPY
   339	400232'	254 01 0 00 000000*
   340	400233'	000003	000002			FUNC	SORT$,2,ES,SORT##	;SORT
   341	400234'	254 01 0 00 000000*
   342	400235'	000003	000002			FUNC	RSORT$,2,ES,RSORT##	;RSORT
   343	400236'	254 01 0 00 000000*
   344	400237'	000001	000001			FUNC	EVAL$,1,E,EVAL##	;EVAL
   345	400240'	254 01 0 00 000000*
   346	400241'	000000	000001			FUNC	NEG$,1,,NEG##		;NEGATE
   347	400242'	254 01 0 00 000000*
   348	400243'	000001	000001			FUNC	QUEST$,1,E,RETNL1	;INTEROGATION ??
   349	400244'	254 01 0 00 000000*
   350	400245'	000001	000001			FUNC	IND$,1,E,IND##		;IND
   351	400246'	254 01 0 00 000000*
   352	400247'	000000	000001			FUNC	NAME$,1,,NAME##		;NAME
   353	400250'	254 01 0 00 000000*
   354	400251'	000001	000003			FUNC	CNVRT$,3,E,CNVRT##	;CONVERT
   355	400252'	254 01 0 00 000000*
   356	400253'	000003	000002			FUNC	GE$,2,SE,GE##		;.GE.
   357	400254'	254 01 0 00 000000*
   358	400255'	000003	000002			FUNC	LE$,2,SE,LE##		;.LE.
   359	400256'	254 01 0 00 000000*
   360	400257'	000003	000002			FUNC	GT$,2,SE,GT##		;.GT.
   361	400260'	254 01 0 00 000000*
   362	400261'	000003	000002			FUNC	LT$,2,SE,LT##		;.LT.
   363	400262'	254 01 0 00 000000*
   364	400263'	000003	000002			FUNC	EQ$,2,SE,EQ##		;.EQ.
   365	400264'	254 01 0 00 000000*
   366	400265'	000003	000002			FUNC	NE$,2,SE,NE##		;.NE.
   367	400266'	254 01 0 00 000000*
   368	400267'	000003	000002			FUNC	REMDR$,2,SE,REMDR##	;REMDR
   369	400270'	254 01 0 00 000000*
   370	400271'	000003	000001			FUNC	INTGR$,1,SE,INTGR##	;INTEGER
   371	400272'	254 01 0 00 000000*
   372	400273'	000003	000001			FUNC	RAND$,1,ES,RAND##	;RANDOM
   373	400274'	254 01 0 00 000000*
   374	400275'	000003	000002			FUNC	SUM$,2,SE,SUM##	;SUM
   375	400276'	254 01 0 00 000000*
   376	400277'	000003	000002			FUNC	DIFF$,2,SE,DIFF##	;DIFFER
   377	400300'	254 01 0 00 000000*
   378	400301'	000003	000002			FUNC	MUL$,2,SE,MUL##		;MUL
   379	400302'	254 01 0 00 000000*
   380	400303'	000003	000002			FUNC	DIV$,2,SE,DIV##		;DIV
   381	400304'	254 01 0 00 000000*
   382	400305'	000003	000002			FUNC	EXP$,2,SE,EXP##		;EXP
   383	400306'	254 01 0 00 000000*
   384	400307'	000003	000001			FUNC	PLUS$,1,SE,PLUS##	;PLUS
   385	400310'	254 01 0 00 000000*
   386	400311'	000003	000001			FUNC	MINUS$,1,SE,MINUS##	;MINUS
   387	400312'	254 01 0 00 000000*
   388	400313'	000001	000001			FUNC	PROTO$,1,E,PROTO##	;PROTOTYPE
   389	400314'	254 01 0 00 000000*
   390	400315'	254 01 0 00 000000*	CRTDT$::PORTAL	CRTDAT##		;[245]
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 4-4
SNOFIO	MAC	15-Mar-69 11:20		Dispatch table

   391	400316'	254 01 0 00 000000*	TRCFN4::PORTAL	TRCFN3##		;[251]
   392					IFN FTDDT,<
   393	400317'	000003	000003			FUNC	IBP$,3,ES,IBP##
   394	400320'	254 01 0 00 000000*
   395	400321'	000003	000003			FUNC	RBP$,3,ES,RBP##
   396	400322'	254 01 0 00 000000*
   397	400323'	000003	000002			FUNC	WHERE$,2,ES,WHERE0##
   398	400324'	254 01 0 00 000000*
   399	400325'	000003	000002			FUNC	CNCT$,2,ES,CNCT##
   400	400326'	254 01 0 00 000000*
   401	400327'	000003	000002			FUNC	DCNCT$,2,ES,DCNCT##
   402	400330'	254 01 0 00 000000*
   403	400331'	254 01 0 00 000000*	$DDCMD::PORTAL	DDTCMD##		;Entry for SNODDT trap
   404
   405					>;End of IFN FTDDT
   406
   407					IFN FTPAV,<
   408	400332'	000003	000002			FUNC	ASSC$,2,ES,ASSC##
   409	400333'	254 01 0 00 000000*
   410	400334'	000003	000002			FUNC	DASSC$,2,ES,DASSC##
   411	400335'	254 01 0 00 000000*
   412					>;END OF IFN FTPAV
   413
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 5
SNOFIO	MAC	15-Mar-69 11:20		STORAGE INITIALIZATION

   414						SUBTTL	STORAGE INITIALIZATION
   415
   416						 ; HERE FOR INCOMPATIBLE HIGH-LOW SEGMENTS
   417
   418	400336'	400 05 0 00 000000 	INITXX:	CLEAR	P2,		; NO &STNO OR &FNCLEVEL
   419	400337'	254 00 0 00 400412'		JRST	INITXY		; ESTABLISH MEMORY
   420
   421						 ; HERE TO SIGNAL AN ERROR WHEN CORE IS IN A
   422						 ; CHAOTIC STATE. P1 CONTAINS THE NEGATIVE OF
   423						 ; AN ERROR NUMBER IN THE FORM 
   424						 ; MAJOR * 1000 + MINOR 
   425
   426	400340'				ABSERR::
   427	400340'	540 05 0 00 000000*		HRR	P2,$STNO##	; SAVE &STNO
   428	400341'	504 05 0 00 000000*		HRL	P2,$FNCLV##	; AND &FNCLEVEL
   429	 
   430	400342'	265 11 0 00 402315'		JSP	TLINK,CLSALL	; CLOSE ALL I/O
   431	400343'	254 00 0 00 400412'		JRST	INITXY		; LEAP INTO FORAY
   432
   433						;[300]	Test high segment version here instead of in low
   434						;[300]	segment so concelled programs work.
   435
   436	400344'	254 01 0 00 400345'	INITR:	PORTAL	.+1		;[300] EXO ENTRY
   437	400345'	336 00 0 00 000000*		SKIPN	LISTF##		;[275] IS THERE A LISTING FILE?
   438	400346'	254 00 0 00 400351'		 JRST	HTEST		;[275] NO -- DON'T WORRY ABOUT IT.
   439	400347'	205 00 0 00 010000 		MOVX	Z,FMT.AP	;[275] APPEND MODE
   440	400350'	202 00 0 00 000000#		MOVEM	Z,LISTF+1	;[275] FOR LISTING FILE.
   441
   442	400351'	510 04 0 00 000000*	HTEST:	HLLZ	P1,HGHVER##	;[300] HIGH SEG VER
   443	400352'	510 05 0 00 400004 		HLLZ	P2,.JBHGH+.JBHVR	;[300] REAL HIGH SEG VERSION NO.
   444	400353'	316 04 0 00 000005 		CAMN	P1,P2		;[300] ARE THEY THE SAME?
   445	400354'	254 00 0 00 400367'		 JRST	INIT		;[300] IT'S OK.
   446	400355'	254 00 0 02 000016 		JRST	EXERRV(SURF)	;[300] NO GOOD, REPORT ERROR.
   447
   448						 ; REENTER POINT - HERE WHEN A REENTER IS TYPED
   449						 ; AT THE TERMINAL FOLLOWING A ^C INTERRUPT
   450
   451	400356'	332 00 0 00 000000*	$REENT:	SKIPE	RSFLAG##
   452	400357'	254 00 0 00 400366'		JRST	$REE
   453	400360'	350 00 0 00 000000*		AOS	$TRACE##		; GIVE A TRACE MESSAGE
   454	400361'	250 17 0 00 000000#		EXCH	Q3,$STCNT##+1	; SAVE Q3
   455	400362'	336 00 0 00 000017 		SKIPN	Q3		; TOUCH NOT IF ALREADY SET
   456	400363'	201 17 0 00 000000#		MOVEI	Q3,NULLST##+1	; POINT TO 0
   457	400364'	250 17 0 00 000000#		EXCH	Q3,$STCNT+1	; FLAG TRACE AND RESTORE Q3
   458	400365'	254 02 1 00 000130 		JRSTF	@.JBOPC		; RESUME PROCESSING
   459
   460	400366'	402 00 0 00 400356*	$REE:	CLEARM	RSFLAG
   461
   462						 ; HERE IS THE MAIN ENTRY POINT!
   463						 ; FLAG ENTRY
   464
   465	400367'	254 01 0 00 400371'	INIT:	PORTAL	.+2		;[300] TO CONCEAL THE HIGH SEG
   466	400370'	254 01 0 00 400372'		PORTAL	.+2		;[300] SAME
   467	400371'	634 04 0 00 000004 		TDZA	P1,P1		; ZERO OUT P1 AND SKIP
   468	400372'	201 04 0 00 000001 		MOVEI	P1,1		; ONE-IZE P1
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 5-1
SNOFIO	MAC	15-Mar-69 11:20		STORAGE INITIALIZATION

   469
   470	400373'	047 00 0 00 000000 		RESET			; RESET ALL I/O
   471
   472	400374'	332 00 0 00 000000*		SKIPE	STFLAG##		; HAVE WE BEEN HERE BEFORE?
   473	400375'	254 00 0 00 400406'		 JRST	INITT		;  YES - SKIP OVER NEXT.
   474
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 6
SNOFIO	MAC	15-Mar-69 11:20		STORAGE INITIALIZATION

   475					IFN FTOPS10,<			;[244]
   476
   477	400376'	336 00 0 00 000011 		SKIPN	.SGDEV		;HAVE A DEVICE ?
   478	400377'	205 11 0 00 637163 		MOVSI	.SGDEV,'SYS'	;NO - ASSUME SYS:
   479	400400'	202 11 0 00 000000*		MOVEM	.SGDEV,SEGDEV##	;AND SAVE IT
   480	400401'	336 00 0 00 000000 		SKIPN	.SGNAM		;HAVE A NAME 
   481	400402'	200 00 0 00 403770'		 MOVE	.SGNAM,[D$NAME]	;[264] NO - ASSUME DEFAULT
   482	400403'	202 00 0 00 000000*		MOVEM	.SGNAM,SEGNAM##	;STORE IT TOO
   483	400404'	202 07 0 00 000000*		MOVEM	.SGPPN,SEGPPN##	;STORE THE PPN TOO
   484
   485					>;[244] End of IFN FTOPS10
   486
   487	400405'	476 00 0 00 400374*		SETOM	STFLAG		; FLAG ENTRY.
   488	400406'	332 00 0 00 400366*	INITT:	SKIPE	RSFLAG		; SAVE FILE?
   489	400407'	254 00 0 00 400417'		JRST	INITXW		; YES
   490
   491	400410'	200 00 0 00 400004 		MOVE	Z,.JBHGH+.JBHVR	; Get high seg version no.
   492	400411'	202 00 0 00 400351*		MOVEM	Z,HGHVER##	; So the EXIT code will be able to test
   493									; segment compatabilty.
   494
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 7
SNOFIO	MAC	15-Mar-69 11:20		STORAGE INITIALIZATION

   495	400412'	402 00 0 00 000000*	INITXY:	CLEARM	FID##		; ZERO FIRST WORD
   496	400413'	200 11 0 00 403771'		MOVE	T1,[FID,,FID+1]	; LOAD FROM-TO ADDR
   497	400414'	251 11 0 00 000000#		BLT	T1,AID-1	; ZERO OUT REST OF FID
   498
   499	400415'	265 15 0 00 000000*		JSP	QLINK,INIMP##	; INITIALIZE IMPURE DATA
   500
   501	400416'	265 06 0 00 401031'		JSP	SLINK,SETMEM	; ESTABLISH THE REST OF MEMEORY
   502
   503	400417'				INITXW:	 ; COMPUTE JOBNO IN 6-BIT, LEFT JUSTIFIED
   504
   505	400417'	047 11 0 00 000030 		PJOB	T1,		; ESTABLISH ...
   506	400420'	202 11 0 00 000000*		MOVEM	T1,$JOBNO##	; &JOBNO
   507
   508	400421'	201 14 0 00 000003 		MOVEI	T4,3		; 3 DIGITS
   509	400422'	231 11 0 00 000012 	INIT1:	IDIVI	T1,^D10		; GET DIGIT TO T2
   510	400423'	271 12 0 00 000020 		ADDI	T2,'0'		; MAKE IT 6-BIT
   511	400424'	246 12 0 00 777772 		LSHC	T2,-6		; SHIFT INTO T3
   512	400425'	367 14 0 00 400422'		SOJG	T4,INIT1	; LOOP ON T4
   513
   514	400426'	512 13 0 00 000000*		HLLZM	T3,JOBNO6##	; SAVE
   515
   516	400427'	201 11 0 00 400000'		MOVEI	T1,REENTR	; ESTABLISH
   517	400430'	202 11 0 00 000124 		MOVEM	T1,.JBREN	; REENTER ADDR
   518
   519	400431'	200 11 0 00 403772'		MOVE	T1,[JSP	Z,ERRA$] ;[266] PLANT
   520	400432'	202 11 0 00 000041 		MOVEM	T1,.JB41	; UUO HANDLER
   521
   522	400433'	201 11 0 00 000000*		MOVEI	T1,INTRPT##	; POINT TO INTERRUPT HANDLER
   523	400434'	202 11 0 00 000125 		MOVEM	T1,.JBAPR	; PLUG JOB DATA AREA
   524
   525	400435'	332 00 0 00 400406*		SKIPE	RSFLAG		; VALID SAVE FILE?
   526	400436'	254 00 0 00 401315'		JRST	FIREUP		; YES, OFF TO RESUME PROCESSING
   527
   528						 ; CHECK FOR HIGH-LOW SEGMENT INCOMPATIBILITY
   529
   530	400437'	325 04 0 00 400444'		JUMPGE	P1,INITXZ	; JUMP UNLESS AN ERROR ...
   531	400440'	476 00 0 00 400435*		SETOM	RSFLAG		; IS TO BE SIGNALLED.
   532	400441'	210 04 0 00 000004 		MOVN	P1,P1		; MAKE INTO A PROPER ERROR
   533	400442'	550 04 0 00 000004 		HRRZ	P1,P1		;[232] FOR ERROR PROCESS.
   534	400443'	254 00 0 00 000000*		JRST	ERRABS##		;   SIGNAL ERROR.
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 8
SNOFIO	MAC	15-Mar-69 11:20		STORAGE INITIALIZATION

   535	400444'				INITXZ:	 ; SET UP TRAP HANDLING
   536
   537					;[243] Here to get the processor type that we are executing on
   538
   539	400444'	400 14 0 00 000000 		SETZ	T4,		;[243] Clear for the value
   540	400445'	255 01 0 00 400446'		JUMPPT	T1,CPDP6,CKA10,CKI10,CKL10 ;[243] Jump on the CP type
   541	400446'	254 00 0 00 400447'
   542	400447'	255 01 0 00 400456'
   543	400450'	525 11 0 00 777776 
   544	400451'	252 11 0 00 400461'
   545	400452'	201 11 0 00 000000 
   546	400453'	251 11 0 00 000000 
   547	400454'	322 11 0 00 400460'
   548	400455'	254 00 0 00 400457'
   549
   550
   551	400456'	001 17 0 00 000000 	CPDP6:	ERROR	15		;[243] PDP-6 ??
   552
   553	400457'	271 14 0 00 000001 	CKL10:	ADDI	T4,1		;[243] Increment
   554	400460'	271 14 0 00 000001 	CKI10:	ADDI	T4,1		;[243] Increment
   555	400461'	271 14 0 00 000001 	CKA10:	ADDI	T4,1		;[243] Increment
   556
   557					;[243] At this point the number in T4 is the same that is found in the
   558					;[243] name REL file block.
   559					;[243]
   560					;[243]	1 - KA10
   561					;[243]  2 - KI10
   562					;[243]  3 - KL10
   563
   564
   565	400462'	202 14 0 00 000000*		MOVEM	T4,CPUTYP##	;[243] Save the CPU number
   566
   567	400463'	201 17 0 00 200000 		MOVX	Q3,AP.POV	; PUSH-OVERFLOW BIT
   568	400464'	202 17 0 00 000000*		MOVEM	Q3,TRFLGS##	; SAVE FLAG
   569	400465'	047 17 0 00 000016 		APRENB	Q3,		; ESTABLISH OVERFLOW
   570
   571
   572	400466'	047 05 0 00 000014 		CALLI	P2,14		; GET WHEN WE IS
   573	400467'	202 05 0 00 000000*		MOVEM	P2,DIM4##	; PRESERVE IT FOR PROSPERITY
   574
   575					DEFINE	EXPIRE(DAY,MONTH,YEAR),<
   576						RADIX	10
   577						EXPDAT==<<<YEAR-1964>*12+MONTH-1>*31+DAY-1>
   578						IFL	<31-DAY>!<12-MONTH>!<2001-YEAR>,<
   579						PRINTX	? Expiration date messed up>
   580						IFE	DAY!MONTH!YEAR,	EXPDAT==RH.ALF
   581						RADIX	8
   582						>
   583
   584						EXPIRE	31,12,1999
   585
   586					IFE FTDEBUG,<
   587	400470'	301 05 0 00 032117 		CAIL	P2,EXPDAT	; ARE WE TOO LATE DOCTOR?
   588	400471'	001 14 0 00 000010 		ERROR	12,8		; YES, NOW DON'T BE TOO UPSET MISS.
   589					>; End of IFN FTDEBUG
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 9
SNOFIO	MAC	15-Mar-69 11:20		OPENING THE COMMAND STRING

   590						SUBTTL	OPENING THE COMMAND STRING
   591
   592
   593						 ; OPEN XXXSNO.TMP (IF NECESSARY)
   594
   595	400472'	322 04 0 00 400531'		JUMPE	P1,INIT2	; AVOID THIS FOR 0 ENTRY POINT
   596
   597	400473'	476 00 0 00 400440*		SETOM	RSFLAG		; SET RESTART FLAG
   598
   599	400474'	050 17 0 00 400526'		OPEN	17,CMSPEC	; OPEN IT ON CHANNEL 17
   600	400475'	001 14 0 00 000001 		ERROR	12,1		; NO DSK?
   601
   602	400476'	542 02 0 00 000121 		HRRM	SURF,.JBFF	; ALLOCATE BUFFER IN FLID
   603	400477'	064 17 0 00 000001 		INBUF	17,1		; ONLY 1 BUFFER NEEDED
   604
   605	400500'	200 15 0 00 403773'		MOVE	Q1,[1,,T1]	; TRY TMPCOR
   606	400501'	205 11 0 00 635657 		MOVSI	T1,D$PRE	;[264] NAME OF SITBOL
   607	400502'	201 12 0 02 777777 		MOVEI	T2,-1(SURF)		; BUFFER LOCATION
   608	400503'	505 12 0 00 777600 		HRLI	T2,-^D128	; NOMINAL BUFFER LENGTH
   609	400504'	047 15 0 00 000044 		TMPCOR	Q1,		; ISSUE TMPCOR UUO
   610	400505'	254 00 0 00 400515'		JRST	INIT1A		; TRY THE DISK
   611
   612						 ; SET UP POINTER LENGTH
   613
   614	400506'	221 15 0 00 000005 		IMULI	Q1,5		; CONVERT TO BYTE COUNT
   615	400507'	202 15 0 00 000000#		MOVEM	Q1,IGNOS##+2	; AND STORE IN BYTE COUNT
   616
   617	400510'	200 16 0 00 403774'		MOVE	Q2,[POINT 7,0]	; SET ...
   618	400511'	540 16 0 00 000002 		HRR	Q2,SURF		; UP ...
   619	400512'	202 16 0 00 000000#		MOVEM	Q2,IGNOS##+1	; POINTER
   620
   621	400513'	071 17 0 00 000000 		RELEAS	17,		;[230] Release this channel
   622	400514'	254 00 0 00 400532'		JRST	INIT3		; JOIN REGULAR PROCESSING
   623
   624	
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 10
SNOFIO	MAC	15-Mar-69 11:20		OPENING THE COMMAND STRING

   625	400515'				INIT1A:
   626						 ; COMPUTE NAME OF FILE
   627
   628	400515'	200 13 0 00 400426*		MOVE	T3,JOBNO6	; GET JOBNO IN LEFT HALF
   629	400516'	541 13 0 00 635657 		HRRI	T3,D$PRE	;[264] COMPLETE THE FILE
   630
   631						 ; NAME IS IN T3, COMPLETE FILE DESCRIPTION
   632
   633	400517'	515 14 0 00 645560 		HRLZI	T4,'TMP'	; EXTENSION TO T4
   634	400520'	403 15 0 00 000016 		SETZB	Q1,Q2		;[276] Zero these words (don't use 2 setz's)
   635
   636	400521'	076 17 0 00 000013 		LOOKUP	17,T3		; LOOK THIS FILE UP
   637	400522'	354 00 0 00 400473*		AOSA	RSFLAG		; NOT FOUND - CLEAR RSFLAG AND SKIP
   638
   639	400523'	374 00 0 00 000000*		SOSA	TMPOPN##	; FLAG TMP FILE OPEN
   640
   641	400524'	254 00 0 00 400367'		JRST	INIT		; TMP FILE NOT THERE, JUST RESTART
   642	400525'	254 00 0 00 400532'		JRST	INIT3		; CONTINUE
   643
   644						 ; SPECIFIER TO OPEN COMMAND-STRING
   645
   646	400526'	000000	000001		CMSPEC:	EXP	1		; ASCII MODE
   647	400527'	44 63 53 00 00 00 		SIXBIT/DSK/		; FROM THE DISK
   648	400530'	000000	000000*			XWD	0,IGNOS##	; INPUT RINGS AT IGNOS
   649
   650						 ; TTY INITIALIZATION
   651
   652	400531'	051 01 0 00 403775'	INIT2:	OUTCHR	["*"]		; OUTPUT A STAR
   653
   654						 ; PREPARE DEPOSITORY FOR COMMAND STRING
   655
   656	400532'	550 11 0 00 000000*	INIT3:	HRRZ	T1,NSTACK##	; WILL BEGIN IN STACK REGION
   657	400533'	270 11 0 00 403776'		ADD	T1,[POINT 7,SCHARS+1] ; PREPARE DEPOSITION POINTER
   658	400534'	400 10 0 00 000000 		CLEAR	S3,		; BYTE COUNT
   659	400535'	402 00 0 00 000000*		CLEARM	IGNOP##		; FLAG TO INDICATE '=' SIGN
   660
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 11
SNOFIO	MAC	15-Mar-69 11:20		OPENING THE COMMAND STRING

   661
   662						SUBTTL	FIRST PASS OVER THE COMMAND
   663
   664
   665	400536'	265 15 0 00 401155'	INIT4:	JSP	QLINK,CM.C	; PICK UP COMMAND CHAR IN Q3
   666	400537'	306 17 0 00 000057 		CAIN	Q3,"/"		; BEGIN SWITCH?
   667	400540'	254 00 0 00 400551'		JRST	IN.SW		; YES
   668
   669	400541'	612 00 0 00 403777'		TXNE	Z,Y.EQ!Y.LA	; CHECK FOR '=' OR '_'
   670	400542'	476 00 0 00 400535*		SETOM	IGNOP##		; YES - SET FLAG
   671
   672	400543'	602 00 0 00 024400 		TXNE	Z,Y.CZ!Y.VM!Y.ALT	; TEST FOR LINE DELIMETER
   673	400544'	254 00 0 00 400606'		JRST	INIT6		; YES - FINISH UP
   674
   675	400545'	306 17 0 00 000015 		CAIN	Q3,15		; IGNORE ...
   676	400546'	254 00 0 00 400536'		 JRST	INIT4		; <CR>'S
   677
   678	400547'	136 17 0 00 000011 	INIT5:	IDPB	Q3,T1		; SAVE BYTE
   679	400550'	344 10 0 00 400536'		AOJA	S3,INIT4	; BUMP COUNT AND LOOP
   680
   681
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 12
SNOFIO	MAC	15-Mar-69 11:20		FIRST PASS OVER THE COMMAND

   682
   683						 ; SWITCH DETECTED
   684
   685	400551'	265 15 0 00 401155'	IN.SW:	JSP	QLINK,CM.C	; GET NEXT CHAR
   686	400552'	400 13 0 00 000000 		CLEAR	T3,		; FLAG
   687	400553'	303 17 0 00 000137 		CAILE	Q3,"_"		; LOWER CASE?
   688	400554'	275 17 0 00 000040 		SUBI	Q3,40		; YES
   689
   690	400555'	306 17 0 00 000103 		CAIN	Q3,"C"		; IS IT CORE?
   691	400556'	200 13 0 00 404000'		MOVE	T3,[^D4000,,C.PAR] ; LENGTH-LOCATION
   692
   693	400557'	306 17 0 00 000123 		CAIN	Q3,"S"		; IS IT STACK?
   694	400560'	200 13 0 00 404001'		MOVE	T3,[^D1000,,S.PAR] ; LENGTH LOCATION
   695
   696	400561'	306 17 0 00 000126 		CAIN	Q3,"V"		; IS IT VTABLE
   697	400562'	200 13 0 00 404002'		MOVE	T3,[^D131,,V.PAR] ; LENGTH-LOCATION
   698
   699	400563'	306 17 0 00 000110 		CAIN	Q3,"H"		; HISTOGRAM?
   700	400564'	254 00 0 00 400604'		JRST	IN.SWH		; YES
   701
   702	400565'	336 00 0 00 000013 		SKIPN	T3		; DID WE FIND ONE?
   703	400566'	001 14 0 00 000013 		ERROR	12,11		; NO - BAD SWITCH
   704
   705						 ; SWITCH PARAMETER PROCESSING
   706
   707	400567'	400 14 0 00 000000 		CLEAR	T4,		; WILL CONTAIN PARAMETER
   708
   709	400570'	265 15 0 00 401155'	IN.SW1:	JSP	QLINK,CM.C	; PICK UP NEXT CHARACTER
   710
   711	400571'	612 00 0 00 404003'		TXNE	Z,Y.EQ!Y.LA!Y.CM!Y.ALT!Y.CZ!Y.VM!Y.BL!Y.TAB!Y.SLSH ; SWITCH DELIMETER
   712	400572'	254 00 0 00 400600'		JRST	IN.SW2		; YES
   713
   714	400573'	607 00 0 00 000040 		TXNN	Z,Y.NUM		; NUMBER ?
   715	400574'	254 00 0 00 400570'		JRST	IN.SW1		; NO - JUST LOOP
   716
   717	400575'	221 14 0 00 000012 		IMULI	T4,^D10		; PLACE FORCES MULTIPLICATION
   718	400576'	271 14 0 17 777720 		ADDI	T4,-"0"(Q3)	; ADD IN NUMERIC VALUE OF CHAR.
   719
   720	400577'	254 00 0 00 400570'		JRST	IN.SW1		; LOOP BACK
   721
   722						 ; END OF SWITCH
   723
   724	400600'	336 00 0 00 000014 	IN.SW2:	SKIPN	T4		; IF T4 HAS NOT BEEN PLUGGED...
   725	400601'	554 14 0 00 000013 		HLRZ	T4,T3		; USE DEFAULT VALUE
   726
   727	400602'	272 14 0 13 000000 		ADDM	T4,0(T3)	; T3 ALSO HAS ADDRESS OF PARAM.
   728
   729	400603'	254 00 0 00 400537'		JRST	INIT4+1		; RESUME SWITCH SEARCH
   730
   731						 ; HISTOGRAM SWITCH
   732
   733	400604'	476 00 0 00 000000*	IN.SWH:	SETOM	AUTOHS##	; AUTO-HISTOGRAM FLAG
   734	400605'	254 00 0 00 400570'		JRST	IN.SW1		; GO BACK FOR MORE
   735
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 13
SNOFIO	MAC	15-Mar-69 11:20		RECONFIGURATION OF STORAGE

   736						SUBTTL	RECONFIGURATION OF STORAGE
   737
   738	400606'	331 00 0 00 400523*	INIT6:	SKIPL	TMPOPN		; TMP FILE OPEN ?
   739	400607'	254 00 0 00 400614'		  JRST	INIT.7		; NO -- THEN CAN'T DELETE IT
   740	400610'	400 11 0 00 000000 		SETZ	T1,		;CLEAR
   741	400611'	055 17 0 00 000011 		RENAME	17,T1		;DELETE THE FILE
   742	400612'	255 00 0 00 000000 		 JFCL			;[276] We really don't care
   743	400613'	071 17 0 00 000000 		RELEAS	17,		;RELEASE CHANNEL
   744	400614'	550 05 0 00 400532*	INIT.7:	HRRZ	P2,NSTACK##	; SAVE LOCATION OF
   745	400615'	271 05 0 00 000001 		ADDI	P2,1		; COMMAND STRING
   746	400616'	265 06 0 00 401031'		JSP	SLINK,SETMEM	; REESTABLISH MEMORY
   747
   748						 ; MAKE COMMAND STRING AN SBLOK
   749
   750	400617'	402 00 0 05 000001 		CLEARM	GCFLD(P2)	; CLEAR GC FIELD OF SBLOK
   751	400620'	201 11 0 10 000016 		MOVEI	T1,5*SCHARS+4(S3) ; COMPUTE # OF ...
   752	400621'	231 11 0 00 000005 		IDIVI	T1,5		; WORDS IN SBLOK
   753	400622'	505 11 0 00 000403 		HRLI	T1,SBLOK	; COMPLETE HEADER WORD
   754	400623'	202 11 0 05 000000 		MOVEM	T1,BTCODE&BLENG(P2)	; HEADER COMPLETE
   755
   756						 ; MOVE SBLOK TO FLOATING STORAGE
   757
   758	400624'	540 15 0 00 000002 		HRR	Q1,SURF		; TO ADDRESS 
   759	400625'	504 15 0 00 000005 		HRL	Q1,P2		; FROM ADDRESS
   760	400626'	200 16 0 00 000002 		MOVE	Q2,SURF		; SAVE SURFACE
   761	400627'	271 02 0 11 000000 		ADDI	SURF,0(T1)	; UPDATE SURFACE
   762	400630'	251 15 0 02 777777 		BLT	Q1,-1(SURF)	; MOVE	SBLOK
   763
   764						 ; CLEAR VTABLE AND STACKS
   765
   766	400631'	200 13 0 00 000000*		MOVE	T3,VTABLE##	; LOAD ADDRESS OF VTABLE
   767	400632'	402 00 0 13 000000 		CLEARM	0(T3)		; ZERO OUT FIRST WORD
   768
   769	400633'	505 13 0 13 000000 		HRLI	T3,0(T3)	; THIS WILL BE THE FROM ADDRESS
   770	400634'	271 13 0 00 000001 		ADDI	T3,1		; MAKE TO ADDRESS
   771	400635'	200 14 0 00 000000*		MOVE	T4,GRID##		; LOAD GRID ADDRESS
   772	400636'	251 13 0 14 777777 		BLT	T3,-1(T4)	; ZERO OUT ALL UP TO GRID
   773
   774						 ; PREPARE DESCRIPTOR FOR COMMAND STRING
   775
   776	400637'	505 16 0 00 004003 		HRLI	Q2,SDT		; STRING DT
   777	400640'	261 01 0 00 000016 		PUSH	STACK,Q2	; PUSH FIRST WORD
   778	400641'	261 01 0 00 000010 		PUSH	STACK,S3	; AND 2ND WORD
   779
   780	400642'	261 01 0 00 000016 		PUSH	STACK,Q2	; REPEAT FOR
   781	400643'	261 01 0 00 000010 		PUSH	STACK,S3	; &COMMAND KEYWORD
   782
   783	400644'	326 10 0 00 400650'		JUMPN	S3,INIT.8	;[244]
   784	400645'	336 00 0 00 400522*		SKIPN	RSFLAG		;[244]
   785	400646'	254 00 0 00 400367'		 JRST	INIT		;[244] TRY AGAIN
   786	400647'	047 00 0 00 000012 	IFN FTOPS10,EXIT		;[244] Return to the monitor
   787					IFN FTOPS20,<
   788						HALTF			;[244] Return to the EXEC
   789						JRST	.-1		;[244] HALTF can continue
   790					>; End of IFN FTOPS20
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 14
SNOFIO	MAC	15-Mar-69 11:20		2ND PASS OVER THE COMMAND STRING

   791						SUBTTL	2ND PASS OVER THE COMMAND STRING
   792
   793
   794					;	COMMAND STRING MINUS SWITCHES IS ON STACK.
   795					;	INPUT FILES ARE PROCESSED FIRST SINCE THIS LEADS 
   796					;	TO FEWER DIFFICULTIES. 
   797
   798
   799	400650'	265 11 0 00 000000*	INIT.8:	JSP	TLINK,STINIT##	;[244] INITIALIZE STREAMING
   800	400651'	001 17 0 00 000000 		ERROR	15		; MUST BE STRING
   801
   802	400652'	200 07 0 00 000000*		MOVE	S2,SYSCT##	; SEARCH FOR ...
   803	400653'	200 10 0 00 403777'		MOVX	S3,Y.EQ!Y.LA	; INPUT ...
   804	400654'	265 11 0 00 000000*		JSP	TLINK,STR.##	; FILES
   805	400655'	634 05 0 00 000005 		TDZA	P2,P2		; FLAG RUNNOUT
   806	400656'	254 00 0 00 400664'		JRST	INIT21		; NORMAL BRANCH
   807
   808	400657'	261 01 0 00 000000*		PUSH	STACK,SUBJ##	; RELOAD ...
   809	400660'	261 01 0 00 000000#		PUSH	STACK,SUBJ##+1	; SUBJECT
   810	400661'	265 11 0 00 400650*		JSP	TLINK,STINIT	; BEGIN AT BEGINNING
   811	400662'	001 17 0 00 000000 		ERROR	15		; IMPOSSIBLE
   812	400663'	254 00 0 00 400667'		JRST	INIT22		; JOIN NORMAL PROCESSING
   813
   814						 ; HERE IF = WAS DETECTED
   815
   816	400664'	370 00 0 00 000000*	INIT21:	SOS	CURSOR		; GET OVER ...
   817	400665'	133 00 0 00 000000*		IBP	STPTR		; CHARACTER
   818
   819	400666'	201 05 0 00 000001 		MOVEI	P2,1		; FLAG CHAR.
   820
   821						 ; MERGE HERE FROM NON = CASE
   822
   823	400667'	476 00 0 00 400530*	INIT22:	SETOM	IGNOS##		; YES WE WNAT FILE CHECKING
   824	400670'	265 06 0 00 402074'		JSP	SLINK,STFILS	; PROCESS INPUT
   825	400671'	001 14 0 00 000015 		ERROR	12,13		; FILES
   826	400672'	001 14 0 00 000036 		ERROR	12,30		; COULDN'T FIND FILE
   827
   828	400673'	200 06 0 01 777777 		MOVE	S1,-1(STACK)	; LOAD STREAM
   829	400674'	202 06 0 00 000000*		MOVEM	S1,COMPIN##	; SET AS COMPILER INPUT
   830	400675'	202 06 0 00 000000*		MOVEM	S1,INFILE	; AND ALOS AS DATA INPUT
   831	400676'	274 01 0 00 000000*		SUB	STACK,XWD22##	; POP STACK
   832
   833	400677'	205 06 0 00 000400 		MOVX	S1,FMT.N	; LET COMPILER ...
   834	400700'	202 06 0 00 000000#		MOVEM	S1,COMPIN##+1	; READ LINE NOS.
   835
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 15
SNOFIO	MAC	15-Mar-69 11:20		2ND PASS OVER THE COMMAND STRING

   836
   837
   838						 ; NOW PROCESS THE OUTPUT LIST
   839
   840	400701'	200 11 0 00 000000*	INIT23:	MOVE	T1,TTYBLK	; LOAD DEFAULT
   841	400702'	202 11 0 00 000000*		MOVEM	T1,OUTF		; OUTPUT FILE
   842
   843	400703'	201 04 0 00 000000#		MOVEI	P1,OUTF-2	; POINT JUST BEFORE FIRST FILE
   844	400704'	322 05 0 00 400734'		JUMPE	P2,INIT25	; LEAP OVER IF NONE
   845
   846	400705'	261 01 0 00 400657*		PUSH	STACK,SUBJ##	; RENEW ...
   847	400706'	261 01 0 00 000000#		PUSH	STACK,SUBJ##+1	; STREAMING ...
   848	400707'	265 11 0 00 400661*		JSP	TLINK,STINIT	; FROM ...
   849	400710'	001 17 0 00 000000 		ERROR	15		; BEGINNING
   850
   851	400711'	201 05 0 00 400731'		MOVEI	P2,DFEXTS	; POINT TO DEFAULT EXT'S
   852
   853						 ; LOOP TO PROCESS OUTPUT FILES
   854
   855	400712'	200 11 0 05 000000 	INIT24:	MOVE	T1,0(P2)	; LOAD DEFAULT EXT.
   856	400713'	202 11 0 00 000000*		MOVEM	T1,DFTEXT##	; SET IT UP
   857	400714'	271 05 0 00 000001 		ADDI	P2,1		; BUMP CURRENT DEFAULT
   858
   859	400715'	265 11 0 00 403037'		JSP	TLINK,STRIO	; GET NEXT DESCR.
   860	400716'	001 14 0 00 000015 		ERROR	12,13		; BAD FILE
   861
   862	400717'	271 04 0 00 000002 		ADDI	P1,2		; POINT TO NEXT BIN
   863
   864	400720'	303 04 0 00 000000*		CAILE	P1,XERRF##	; BEYOND LAST?
   865	400721'	001 14 0 00 000016 		ERROR	12,14		; YES - GIVE MESSAGE
   866
   867	400722'	274 01 0 00 400676*		SUB	STACK,XWD22##	; POP STACK
   868	400723'	332 11 0 01 000001 		SKIPE	T1,1(STACK)	; GET RETURNED IOBLOK
   869	400724'	202 11 0 04 000000 		MOVEM	T1,0(P1)	; BUT USE ONLY IF NONZERO
   870
   871	400725'	302 00 0 00 000075 		CAIE	Z,"="		; LOOK FOR ASSIGNMENT CHAR
   872	400726'	306 00 0 00 000137 		CAIN	Z,"_"		; AND IF FOUND
   873	400727'	254 00 0 00 400734'		JRST	INIT25		; TAKE THIS BRANCH
   874
   875	400730'	254 00 0 00 400712'		JRST	INIT24		; GET NEXT FILE
   876
   877						 ; DEFAULT EXTENSIONS
   878
   879	400731'	54 63 64 00 00 00 	DFEXTS:	SIXBIT	/LST/	; FILE 1
   880	400732'	54 63 64 00 00 00 		SIXBIT	/LST/		; LISTING FILE
   881	400733'	000000	000000			EXP	0		; ERROR FILE
   882
   883	400734'	402 00 0 00 400713*	INIT25:	CLEARM	DFTEXT		; DONE WITH SETTING UP IO
   884
   885
   886						 ; IF /H SWITCH WAS SET ESTABLISH A LISTF FILE ANYWAY
   887
   888	400735'	332 00 0 00 400604*		SKIPE	AUTOHS		; TEST SWITCH
   889	400736'	332 00 0 00 400345*		SKIPE	LISTF		; IF SWITCH OFF OR LISTF THERE
   890	400737'	254 00 0 00 400754'		JRST	INIT29		; TAKE THIS BRANCH
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 15-1
SNOFIO	MAC	15-Mar-69 11:20		2ND PASS OVER THE COMMAND STRING

   891
   892	400740'	265 15 0 00 403633'		JSP	QLINK,CLRFSV	; CLEAR OUT THE VARS.
   893	400741'	205 07 0 00 446353 		MOVSI	S2,'DSK'	; SET
   894	400742'	202 07 0 00 000000*		MOVEM	S2,DEVICE	; VARIOUS
   895	400743'	200 07 0 00 400515*		MOVE	S2,JOBNO6	; PAR-
   896	400744'	541 07 0 00 506364 		HRRI	S2,'HST'	;
   897	400745'	202 07 0 00 000000*		MOVEM	S2,FILNAM	; AMETERS
   898	400746'	205 07 0 00 645560 		MOVSI	S2,'TMP'	; AND
   899	400747'	202 07 0 00 000000*		MOVEM	S2,EXT		; GO
   900	400750'	265 11 0 00 403043'		JSP	TLINK,MAKEIO	; CREATE DSK:TMP.LST
   901	400751'	001 17 0 00 000000 		ERROR	15
   902	400752'	262 01 0 00 000000#		POP	STACK,LISTF+1	; MAKE
   903	400753'	262 01 0 00 400736*		POP	STACK,LISTF	; THE LISTING FILE
   904
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 16
SNOFIO	MAC	15-Mar-69 11:20		2ND PASS OVER THE COMMAND STRING

   905
   906						 ; ESTABLISHING DEFAULT ASSOCIATIONS FOR
   907						 ;		 INPUT & OUTPUT
   908
   909
   910	400754'	261 01 0 00 000000*	INIT29:	PUSH	STACK,SYSTR##	; STRING
   911	400755'	261 01 0 00 000000*		PUSH	STACK,S.INP##	; 'INPUT'
   912
   913	400756'	261 01 0 00 400675*		PUSH	STACK,INFILE	; IO
   914	400757'	261 01 0 00 404004'		PUSH	STACK,[0]	; DESCRIPTOR
   915
   916	400760'	200 00 0 00 404005'		MOVE	Z,[IABLOK,,TVIN] ; TELL IT INPUT
   917	400761'	265 06 0 00 402025'		JSP	SLINK,IOASSN	; MAKE THE CALL
   918
   919
   920	400762'	261 01 0 00 400754*		PUSH	STACK,SYSTR	; STRING
   921	400763'	261 01 0 00 000000*		PUSH	STACK,S.OUT##	; 'OUTPUT'
   922
   923	400764'	261 01 0 00 400702*		PUSH	STACK,OUTF	; IO
   924	400765'	261 01 0 00 404004'		PUSH	STACK,[0]	 ; DESCRIPTOR
   925
   926	400766'	200 00 0 00 404006'		MOVE	Z,[OABLOK,,TVOUT] ; TELL IT OUTPUT
   927	400767'	265 06 0 00 402025'		JSP	SLINK,IOASSN	; MAKE THE CALL
   928	
   929						 ; IO ASSOCIATIONS FOR TTY
   930
   931	400770'	261 01 0 00 400762*		PUSH	STACK,SYSTR	; STRING
   932	400771'	261 01 0 00 000000*		PUSH	STACK,S.TTY##	; 'TTY'
   933	400772'	261 01 0 00 400701*		PUSH	STACK,TTYBLK	; IOBLOK
   934	400773'	261 01 0 00 404004'		PUSH	STACK,[0]	; FOR TTY
   935	400774'	400 00 0 00 000000 		CLEAR	Z,		; NO CHECK NEEDED
   936	400775'	265 06 0 00 401757'		JSP	SLINK,CVTSIO	; MAKE A STREAM OUT OF IT
   937	400776'	001 17 0 00 000000 		ERROR	15		; THIS CAN'T FAIL
   938	400777'	001 17 0 00 000000 		ERROR	15		; THIS CAN'T FAIL EITHER
   939	401000'	200 00 0 00 404005'		MOVE	Z,[IABLOK,,TVIN] ; TELL IT INPUT
   940	401001'	265 06 0 00 402025'		JSP	SLINK,IOASSN	; MAKE THE CALL
   941
   942	401002'	261 01 0 00 400770*		PUSH	STACK,SYSTR	; STRING
   943	401003'	261 01 0 00 400771*		PUSH	STACK,S.TTY##	; 'TTY'
   944	401004'	261 01 0 00 400772*		PUSH	STACK,TTYBLK	; IOBLOK
   945	401005'	261 01 0 00 404004'		PUSH	STACK,[0] 	; FOR TTY
   946	401006'	210 00 0 00 404006'		MOVN	Z,[OABLOK,,TVOUT]	; TELL IT OUTPUT
   947	401007'	265 06 0 00 402025'		JSP	SLINK,IOASSN	; MAKE THE CALL
   948
   949	401010'	254 00 0 00 000000*		JRST	ISTART##	; LET INT HAVE CONTROL
   950
   951
   952						 ; AFTER THE PROGRAM IS DONE, CONTROL COMES HERE
   953
   954
   955	401011'	205 00 0 00 070000 	CLOSIO::MOVSI	Z,(CLOSE)	; LOAD UP A CLOSE
   956	401012'	205 15 0 00 071000 		MOVSI	Q1,(RELEAS)	; AND LOAD UP A RELEASE
   957	401013'	205 17 0 00 000040 		MOVSI	Q3,(1B12)	; LOAD A 1 IN THE AC FIELD
   958	401014'	201 16 0 00 000020 		MOVEI	Q2,20		; # OF CHANS
   959	401015'				CLOSLP:
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 16-1
SNOFIO	MAC	15-Mar-69 11:20		2ND PASS OVER THE COMMAND STRING

   960	401015'	256 00 0 00 000000 		XCT	Z		; DO A CLOSE
   961	401016'	270 00 0 00 000017 		ADD	Z,Q3		; DO THE NEXT CHAN
   962
   963	401017'	256 00 0 00 000015 		XCT	Q1		; THEN RELEASE IT
   964	401020'	270 15 0 00 000017 		ADD	Q1,Q3		; INCREMENT FOR NEXT
   965
   966	401021'	367 16 0 00 401015'		SOJG	Q2,CLOSLP	; LOOP FOR MORE
   967
   968						 ; NOW GO BACK OR EXIT
   969
   970
   971	401022'	336 00 0 00 400645*		SKIPN	RSFLAG##		; DID HE RESTART HIMSELF
   972	401023'	254 00 0 00 400367'		JRST	INIT		; NO - GIVE A STAR
   973
   974	401024'	047 00 0 00 000012 	IFN FTOPS10,EXIT		;[244] Give an EXIT
   975
   976					IFN FTOPS20,<
   977						HALTF			;[244] Give an EXIT
   978						JRST	.-1		;[244] This is continable
   979					>;[244] End of IFN FTOPS20
   980
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 17
SNOFIO	MAC	15-Mar-69 11:20		2ND PASS OVER THE COMMAND STRING

   981
   982						SUBTTL	STORAGE CONTROL
   983
   984					;	STORAGE IS ORDERED AS FOLLOWS:
   985					;	FID - FIXED IMPURE DATA
   986					;	AID - ADJUSTABLE IMPURE DATA
   987					;		VTABLE - VARIABLE BLOCK TABLE
   988					;		STACKS
   989					;			NAME STACK
   990					;			HISTORY STACK
   991					;			SYSTEM STACK
   992					;	GRID - GROWING STORAGE
   993					;	FLID - FLOATING STORAGE
   994
   995						 ; THE FOLLOWING TABLE GIVES EXCESS PERCENTAGES
   996						 ; AND MINIMUM VALUES.
   997
   998	401025'				EMTBL:	RADIX	10
   999	401025'	000016	000045		EM.VT:	XWD	14,37		; VARIABLE BLOCK TABLE
  1000	401026'	000012	001046		EM.ST:	XWD	10,550		; STACKS
  1001	401027'	000024	001046		EM.GR:	XWD	20,550		; GROWING REGION
  1002	401030'	000070	001046		EM.FL:	XWD	56,550		; FLOATING REGION
  1003
  1004						 ; THE STACK BREAK-DOWN FOLLOWS
  1005
  1006			000074			SS%==60		; SYSTEM STACK
  1007			000031			HS%==25		; HISTORY STACK
  1008			000017			NS%==15		; NAME STACK
  1009
  1010						RADIX	8
  1011
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 18
SNOFIO	MAC	15-Mar-69 11:20		STORAGE CONTROL

  1012
  1013					;	JSP	TLINK,SETMEM
  1014					;	RETURN
  1015					;
  1016					;	WILL SET UP MEMORY INITIALIZING 
  1017					;	VARIABLES LIKE SURF, CEIL, ETC.	AFTER THIS
  1018					;	CALL THE AID, GRID AND FLID REGION WILL BE
  1019					;	READY TO USE.
  1020					;
  1021					;	THROUGH IT ALL THE AID AND FLID REGIONS ARE
  1022					;	LEFT UNDISTURBED. AN ENTRY IS MADE IN THE GRID
  1023					;	REGION, VIZ. AN IOBLOK FOR TTY (SETTING UP AN 
  1024					;	IO DESCRIPTOR FOR XERRF. THUS ERROR N,M WILL WORK
  1025					;	AFTER SETMEM IS CALLED.
  1026
  1027						 ; THE SIZES OF THE VARIOUS REGIONS ARE 
  1028						 ; COMPUTED IN REGISTERS. AS FOLLOWS
  1029						 ; VTABLE (T2), STACKS(T3), GRID(T4) AND FLID(Q1)
  1030
  1031	401031'	336 12 0 00 000000*	SETMEM:	SKIPN	T2,V.PAR##	; USE V PARAMETER FOR VTABLE
  1032	401032'	550 12 0 00 401025'		HRRZ	T2,EM.VT	; ELSE USE MINIMUM SIZE
  1033
  1034	401033'	336 13 0 00 000000*		SKIPN	T3,S.PAR##	; USE S PARAMETER FOR STACKS
  1035	401034'	550 13 0 00 401026'		HRRZ	T3,EM.ST	; ELSE USE DEFAULT SIZE
  1036	401035'	305 13 0 00 000400 		CAIGE	T3,^D256	; BUT IF LESS THAN 256
  1037	401036'	221 13 0 00 002000 		IMULI	T3,2000		; HE MUST MEAN K
  1038
  1039	401037'	550 14 0 00 401027'		HRRZ	T4,EM.GR	; DEFAULT SIZE OF GRID
  1040
  1041	401040'	550 15 0 00 401030'		HRRZ	Q1,EM.FL	; DEFAULT SIZE OF FLID
  1042
  1043
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 19
SNOFIO	MAC	15-Mar-69 11:20		STORAGE CONTROL

  1044
  1045						 ; REGISTERS NOW CONTAIN MINIMUM VALUES
  1046						 ; WHAT TO DO WITH THE EXCESS?
  1047						 ; FIRST COMPUTE TOTAL
  1048
  1049	401041'	201 16 0 12 000001 		MOVEI	Q2,1(T2)	; LOAD VTBL SIZE
  1050	401042'	270 16 0 00 000013 		ADD	Q2,T3		; ADD STACK SIZE
  1051	401043'	270 16 0 00 000014 		ADD	Q2,T4		; ADD GRID SIZE
  1052	401044'	270 16 0 00 000015 		ADD	Q2,Q1		; ADD FLID SIZE
  1053	401045'	202 16 0 00 000000*		MOVEM	Q2,IGNOT##	; REQUIRED CORE TO IGNOT
  1054
  1055	401046'	200 17 0 00 000000*		MOVE	Q3,C.PAR##	; LOAD THE C PARAMETER
  1056	401047'	307 17 0 00 000400 		CAIG	Q3,^D256	; IF LESS THAN 256 ...
  1057	401050'	221 17 0 00 002000 		IMULI	Q3,2000		; USE K
  1058
  1059
  1060						 ; IF Q3 IS GREATER THAN Q2 DISTRIBUTE EXCESS
  1061
  1062	401051'	317 17 0 00 000016 		CAMG	Q3,Q2		; GREATER?
  1063	401052'	254 00 0 00 401067'		JRST	SETMM1		; NO - USE WHAT WE HAVE
  1064
  1065	401053'	202 17 0 00 000000*		MOVEM	Q3,TOOMCH##	; UP THE SLACK VALUE
  1066	401054'	202 17 0 00 401045*		MOVEM	Q3,IGNOT##	; REQUIRED CORE TO IGNOT
  1067	401055'	274 17 0 00 000016 		SUB	Q3,Q2		; FIND EXCESS
  1068	401056'	204 17 0 00 000017 		MOVS	Q3,Q3		; INTO LEFT FOR GREATER PRECISION
  1069	401057'	231 17 0 00 000144 		IDIVI	Q3,^D100	; CONVERT TO % UNITS
  1070	401060'	202 17 0 00 000000*		MOVEM	Q3,IGNOQ##	; SAVE THIS QUANTITY
  1071
  1072	401061'	201 16 0 00 000003 		MOVEI	Q2,3		; # OF SLICES MINUS 1
  1073
  1074						 ; LOOP TO DISTRIBUTE EXCESS
  1075
  1076	401062'	554 17 0 16 401025'	SETMM2:	HLRZ	Q3,EMTBL(Q2)	; LOAD EXCESS %
  1077	401063'	220 17 0 00 401060*		IMUL	Q3,IGNOQ##	; MULTIPLY BY EXCESS
  1078	401064'	554 17 0 00 000017 		HLRZ	Q3,Q3		; MOVE TO RIGHT HALF
  1079	401065'	272 17 0 16 000012 		ADDM	Q3,T2(Q2)	; INCREMENT
  1080	401066'	365 16 0 00 401062'		SOJGE	Q2,SETMM2	; LOOP ON Q2
  1081
  1082						 ; ALLOCATE ADDITIONAL CORE IF NEEDED
  1083
  1084	401067'	200 16 0 00 401054*	SETMM1:	MOVE	Q2,IGNOT##	; GET TOTAL LENGTH OF REGION
  1085	401070'	271 16 0 00 000000*		ADDI	Q2,AID##	; ADD LENGTH OF FID
  1086	401071'	202 16 0 00 401067*		MOVEM	Q2,IGNOT##	; SAVE TOTAL
  1087	401072'	047 16 0 00 000011 		CORE	Q2,		; ORDER THIS MUCH CORE
  1088	401073'	001 14 0 00 000012 		ERROR	12,10		; TOO MUCH
  1089
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 20
SNOFIO	MAC	15-Mar-69 11:20		STORAGE CONTROL

  1090
  1091						 ; ESTABLISH FLID
  1092
  1093	401074'	200 16 0 00 401071*		MOVE	Q2,IGNOT##	; RELOAD LAST ADDRESS
  1094	401075'	275 16 0 00 000100 		SUBI	Q2,MARGIN	; POINT JUST BELOW SKY
  1095	401076'	202 16 0 00 000000*		MOVEM	Q2,CEIL##		; ESTABLISH AS CEILING
  1096	401077'	275 16 0 15 777700 		SUBI	Q2,-MARGIN(Q1)	; DEDUCT SIZE OF FLID
  1097	401100'	202 16 0 00 000000*		MOVEM	Q2,FLOOR##	; ESTABLISH AS FLOOR
  1098	401101'	202 16 0 00 000002 		MOVEM	Q2,SURF		; AND SURFACE OF FLOATING REG.
  1099
  1100						 ; ESTABLISH GRID
  1101
  1102	401102'	274 16 0 00 000014 		SUB	Q2,T4		; DEDUCT SIZE OF GRID
  1103	401103'	202 16 0 00 400635*		MOVEM	Q2,GRID		; BASE OF GRID
  1104	401104'	202 16 0 00 000000*		MOVEM	Q2,GSURF##	; ALSO SURFACE OF GRID
  1105
  1106						 ; ESTABLISH STACKS
  1107
  1108	401105'	201 00 0 00 000074 		MOVEI	Z,SS%		; % THAT IS SYSTEM STACK
  1109	401106'	265 15 0 00 401145'		JSP	QLINK,SETSTK	; GO CREATE A STACK
  1110	401107'	202 00 0 00 000001 		MOVEM	Z,STACK		; THIS IS SYSTEM STACK
  1111	401110'	202 00 0 00 000000*		MOVEM	Z,STBASE##	; SAVE BASE FOR GC
  1112
  1113	401111'	201 00 0 00 000031 		MOVEI	Z,HS%		; HISTORY STACK CUT
  1114	401112'	265 15 0 00 401145'		JSP	QLINK,SETSTK	; GO MAKE STACK
  1115	401113'	202 00 0 00 000000*		MOVEM	Z,HSTACK##	; GO ESTABLISH HISTORY STACK
  1116	401114'	202 00 0 00 000000*		MOVEM	Z,HSBASE##	; AND BASE
  1117	401115'	202 00 0 00 000003 		MOVEM	Z,HSR		; SET UP HISTORY STACK REG.
  1118
  1119	401116'	201 00 0 00 000017 		MOVEI	Z,NS%		; NAME STACK PERCENT
  1120	401117'	265 15 0 00 401145'		JSP	QLINK,SETSTK	; GO SET UP A STACK
  1121	401120'	202 00 0 00 400614*		MOVEM	Z,NSTACK##	; ESTABLISH AS ...
  1122	401121'	202 00 0 00 000000*		MOVEM	Z,NSBASE##	; NSTACK
  1123
  1124						 ; ESTABLISH VTABLE##
  1125
  1126	401122'	202 12 0 00 000000*		MOVEM	T2,LVTBL##	; INSERT LENGTH OF VTABLE
  1127	401123'	275 16 0 12 000000 		SUBI	Q2,0(T2)	; POINT TO START OF VTABLE
  1128	401124'	202 16 0 00 400631*		MOVEM	Q2,VTABLE	; INSERT ADDRESS
  1129	401125'	202 12 0 16 777777 		MOVEM	T2,-1(Q2)	; INSERT LENGTH AT TOP OF VTABLE
  1130
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 21
SNOFIO	MAC	15-Mar-69 11:20		STORAGE CONTROL

  1131
  1132						 ; ESTABLISH TTY FOR ERRORS DURING
  1133						 ; COMMAND STRING PROCESSING
  1134
  1135
  1136	401126'	402 00 0 00 000000*		CLEARM	IOBLKS##		; START CHAIN ANEW
  1137	401127'	402 00 0 00 401004*		CLEARM	TTYBLK##		; ZERO OUT OLD BLOK
  1138
  1139	401130'	265 15 0 00 403633'		JSP	QLINK,CLRFSV	; CLEAR VARIABLES
  1140	401131'	205 07 0 00 646471 		MOVSI	S2,'TTY'	; SET ...
  1141	401132'	202 07 0 00 400742*		MOVEM	S2,DEVICE	; DEVICE
  1142
  1143	401133'	265 11 0 00 403043'		JSP	TLINK,MAKEIO	; MAKE THE FILE
  1144	401134'	001 17 0 00 000000 		ERROR	15		; THIS CAN'T HAPPEN
  1145
  1146	401135'	262 01 0 00 000000 		POP	STACK,Z		; POP JUNK
  1147	401136'	262 01 0 00 000014 		POP	STACK,T4	; POP IOBLOK ADDRESS
  1148
  1149	401137'	202 14 0 00 401127*		MOVEM	T4,TTYBLK	; ESTABLISH AS TTY
  1150	401140'	202 14 0 00 400720*		MOVEM	T4,XERRF##	; AND DEFAULT ERROR FILE
  1151
  1152	401141'	350 00 0 14 000002 		AOS	IOMODE(T4)	; INSERT ASCII MODE
  1153	401142'	201 00 0 00 777777 		MOVEI	Z,-1		; SET
  1154	401143'	506 00 0 14 000030 		HRLM	Z,IOTTY(T4)	; FLAG INDICATING TTY
  1155
  1156	401144'	254 00 0 06 000000 		JRST	0(SLINK)	; RETURN
  1157
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 22
SNOFIO	MAC	15-Mar-69 11:20		STORAGE CONTROL

  1158
  1159					;	SETSTK - USED BY SETMEM TO SET UP A STACK POINTER
  1160					;
  1161					; CALLING SEQUENCE:
  1162					;	LOAD Z WITH PERCENTAGE OF TOTAL STACK LENGTH
  1163					;	Q2 POINTS JUST NORTH OF THE STACK
  1164					;	T3 CONTAINS TOTAL ALLOTMENT FOR STACKS
  1165					;	JSP	QLINK,SETSTK
  1166					;	RETURN - Z WILL CONTAIN CORRECT VALUE
  1167					;		- Q2 IS UPDATED
  1168
  1169	401145'	220 00 0 00 000013 	SETSTK:	IMUL	Z,T3		; MULTIPLY % BY LENGTH
  1170	401146'	200 17 0 00 000000 		MOVE	Q3,Z		; MOVE TO AVOID CLOBBERING REG. 1
  1171	401147'	231 17 0 00 000144 		IDIVI	Q3,^D100	; DIVIDE TO OBTAIN LENGTH
  1172
  1173	401150'	210 00 0 00 000017 		MOVN	Z,Q3		; NEED NEG. OF LENGTH
  1174	401151'	504 00 0 00 000000 		HRL	Z,Z		; TO Z
  1175
  1176	401152'	275 16 0 17 000000 		SUBI	Q2,0(Q3)	; UPDATE Q2
  1177	401153'	541 00 0 16 777777 		HRRI	Z,-1(Q2)	; AND POINT TO BASE - 1
  1178
  1179	401154'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  1180
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 23
SNOFIO	MAC	15-Mar-69 11:20		STORAGE CONTROL

  1181
  1182					;	CM.C - COMMAND CHARACTER, READ A
  1183					;
  1184					; CALLING SEQUENCE:
  1185					;	JSP	QLINK,CM.C
  1186					;	RETURN - Q3 CONTAINS NON ZERO CHARACTER
  1187					;		 - Z CONTAINS MASK FROM SYSCT
  1188
  1189	401155'	322 04 0 00 401170'	CM.C:	JUMPE	P1,CM.C2	; JUMP IF TTY INPUT
  1190	401156'	375 00 0 00 000000#		SOSGE	IGNOS+2		; DECREMENT THE BUFFER COUNT
  1191	401157'	254 00 0 00 401172'		JRST	CM.C3		; FILL BUFFER IF EMPTY
  1192	401160'	134 17 0 00 000000#		ILDB	Q3,IGNOS+1	; RETRIEVE NEXT BYTE FROM BUFFER
  1193
  1194						 ; HERE AFTER TTY INPUT OF CHARACTER
  1195
  1196	401161'	322 17 0 00 401155'	CM.C1:	JUMPE	Q3,CM.C		; IGNORES 0'S
  1197
  1198	401162'	306 17 0 00 000032 		CAIN	Q3,32		;A ^Z ???
  1199	401163'	476 00 0 00 401022*		SETOM	RSFLAG		;YUP EXIT  WHEN DONE
  1200	401164'	200 16 0 00 400652*		MOVE	Q2,SYSCT##	; LOAD ADDRESS OF CHAR. TABLE
  1201	401165'	271 16 0 17 000002 		ADDI	Q2,CTBITS(Q3)	; POINT TO MASK
  1202	401166'	200 00 0 16 000000 		MOVE	Z,0(Q2)		; LOAD Z WITH MASK
  1203
  1204	401167'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  1205
  1206						 ; TTY IN
  1207
  1208	401170'	051 04 0 00 000017 	CM.C2:	INCHWL	Q3		; LOAD CHAR.
  1209	401171'	254 00 0 00 401161'		JRST	CM.C1		; JOIN PROCESSING
  1210	 
  1211						 ; HERE TO FILL BUFFER IF EMPTY
  1212
  1213	401172'	331 00 0 00 400606*	CM.C3:	SKIPL	TMPOPN##	;[230] TMP file open ?
  1214	401173'	254 00 0 00 401202'		 JRST	CM.C4		;[230] No - Force a line feed
  1215	401174'	056 17 0 00 000000 		IN	17,		; INPUT A BUFFER
  1216	401175'	254 00 0 00 401155'		JRST	CM.C		; NORMAL
  1217
  1218	401176'	201 17 0 00 000012 		MOVEI	Q3,12		; LINEFEED IF EOF
  1219	401177'	062 17 0 00 000016 		GETSTS	17,Q2		; TEST FOR ...
  1220	401200'	606 07 0 00 020000 		TXNN	S2,IO.EOF	;[230] End Of File ?
  1221	401201'	001 14 0 00 000000 		 ERROR	12,		;[230] Yes - Serious error
  1222
  1223	401202'	201 17 0 00 000012 	CM.C4:	MOVX	Q3,.CHLFD	;[230] Get the line feed
  1224	401203'	254 00 0 00 401161'		JRST	CM.C1		;[230] Return
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 24
SNOFIO	MAC	15-Mar-69 11:20		P (PRIMARY) ROUTINES FOR I/O

  1225						SUBTTL P (PRIMARY) ROUTINES FOR I/O
  1226
  1227					;	DATE() - MM/DD/YY
  1228
  1229					;	DETACH(NAME)
  1230
  1231					;	ENDFILE(FILE-SPEC)
  1232
  1233					;	EXIT()
  1234
  1235					;	FILE(FILE-SPEC-SEQUENCE)
  1236
  1237					;	INPUT(NAME, FILE-SPEC-SEQUENCE, FORMAT)
  1238
  1239					;	MTAPE(FUNCTION, FILE-SPEC)
  1240
  1241					;	OUTPUT(NAME, FILE-SPEC, FORMAT)
  1242
  1243					;	RENAME(FILE-SPEC, FILE-SPEC)
  1244
  1245					;	RESCAN()
  1246
  1247					;	REWIND(FILE-SPEC-SEQUENCE)
  1248
  1249					;	RUN(FILE-SPEC, OFFSET)
  1250
  1251					;	TIME(N)
  1252
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 25
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- DATE

  1253						SUBTTL	Primary routines -- DATE
  1254
  1255					;	DATE()
  1256
  1257	401204'	274 01 0 00 400722*	DATES::	SUB	STACK,XWD22##	; POP USELESS ARGUMENT
  1258	401205'				DATEE::
  1259	401205'	047 05 0 00 000014 	IFN FTOPS10,DATE	P2,		;[244] PLACE CALLI IN P2
  1260
  1261	401206'	231 05 0 00 000037 		IDIVI	P2,^D31		; DAYS ...
  1262	401207'	340 06 0 00 000000 		AOJ	S1,		; TO S1
  1263	401210'	202 06 0 00 400542*		MOVEM	S1,IGNOP	; SAVE DAYS
  1264
  1265	401211'	231 05 0 00 000014 		IDIVI	P2,^D12		; MONTHS ...
  1266	401212'	340 06 0 00 000000 		AOJ	S1,		; TO S1
  1267	401213'	202 06 0 00 000000#		MOVEM	S1,IGNOP+1	; SAVE
  1268
  1269	401214'	271 05 0 00 000100 		ADDI	P2,^D64		; ADD '64 TO PRODUCE YEARS
  1270
  1271	401215'	265 06 0 00 000000*		JSP	SLINK,LINE.##	; PREPARE STRING DATE
  1272	401216'	000000	000005			XWD	0,5		; 5 ARGS
  1273	401217'	002001	000000#			XWD	IDT,IGNOP+1	; MONTH
  1274	401220'	004003	404007'			XWD	SDT,["/",,1]	; /
  1275	401221'	002001	401210*			XWD	IDT,IGNOP	; DAY
  1276	401222'	004003	404007'			XWD	SDT,["/",,1]	; /
  1277	401223'	002001	000005			XWD	IDT,P2		; YEAR
  1278
  1279	401224'	254 00 0 04 000001 		JRST	1(PLINK)	; SUCCESSFUL RETURN
  1280
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 26
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- DELETE

  1281						SUBTTL	Primary routines -- DELETE
  1282
  1283					;	DELETE(FILE-SPEC)
  1284
  1285	401225'	400 00 0 00 000000 	DEL:	SETZ	Z,		; USE ASCII FORMAT
  1286	401226'	265 05 0 00 401365'		JSP	P2,FCHECK	; DOES THE FILE EXIST?
  1287	401227'	254 00 0 04 000000 		JRST	0(PLINK)	; NO - FAIL
  1288
  1289	401230'	265 15 0 00 403633'		JSP	QLINK,CLRFSV	; CLEAR AN AREA
  1290	401231'	200 17 0 14 000021 		MOVE	Q3,IOCHAN(T4)	; LOAD A CHANNEL
  1291	401232'	434 17 0 00 404010'		IOR	Q3,[RENAME FILNAM] ; COMPLETE THE INSTRUCTION
  1292	401233'	256 00 0 00 000017 		XCT	Q3		; DELETE THE FILE
  1293	401234'	001 14 0 00 000020 		ERROR	12,16		; TELL USER IF TROUBLE DEVELOPS
  1294
  1295	401235'	265 15 0 00 403637'		JSP	QLINK,CLS	; RELEASE THE CHANNEL
  1296
  1297	401236'	254 00 0 00 000000*		JRST	RETNUL##		; AND RETURN
  1298
  1299
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 27
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- DETACH

  1300						SUBTTL	Primary routines -- DETACH
  1301
  1302					;	DETACH(FILE-SPEC)
  1303
  1304	401237'	265 11 0 00 000000*	DETCH:	JSP	TLINK,CVTNAM	; ENSURE A NAME
  1305	401240'	003 01 0 00 000076 		ERROR.	1,62		; BAD ARG TO DETACH
  1306
  1307	401241'	265 11 0 00 402417'		JSP	TLINK,DTCH	; CALL SERVICE ROUTINE
  1308	401242'	254 00 0 00 400244*		JRST	RETNL1##	; POP DESCR. AND RETURN NULL
  1309
  1310
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 28
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- ENDFILE

  1311						SUBTTL	Primary routines -- ENDFILE
  1312
  1313					;	ENDFILE (FILE-SPEC)
  1314
  1315	401243'	265 06 0 00 401743'	ENDFIL:	JSP	SLINK,CVTIO	; GET THE IOBLOK
  1316	401244'	001 14 0 00 000015 		ERROR	12,13		; BAD SPEC
  1317
  1318	401245'	262 01 0 00 000000 		POP	STACK,Z		; POP
  1319	401246'	262 01 0 00 000014 		POP	STACK,T4	; ARG
  1320	401247'	265 15 0 00 403637'		JSP	QLINK,CLS	; AND CLOSE THE FILE
  1321
  1322	401250'	254 00 0 00 401236*		JRST	RETNUL##		; RETURN THE NULL STRING
  1323
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 29
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- EXIT

  1324						SUBTTL	Primary routines -- EXIT
  1325
  1326	401251'	205 00 0 00 003003 	EXIT0:	MOVX	Z,FMT.S!FMT.WM	;CONVERT TO SIXBIT
  1327	401252'	265 11 0 00 402322'		JSP	TLINK,CVTDW	;CONVERT THE THIRD ARG TO SIXBIT
  1328	401253'	255 00 0 00 000000 		  JFCL			; STRING TOO LONG - BUT WHO CARES
  1329	401254'	332 00 0 00 000000 		SKIPE	Z		;DON'T SET IT IF ZERO
  1330	401255'	047 00 0 00 000043 		SETNAM	Z,		;SET THE NAME
  1331	401256'	265 11 0 00 000000*		JSP	TLINK,CVTINT##	; INSURE AN INTEGER
  1332	401257'	003 01 0 00 000073 		ERROR.	1,59		; WRONG TYPE
  1333
  1334	401260'	262 01 0 00 000011 		POP	STACK,T1	; GET THE SECOND ARGUMENT
  1335	401261'	262 01 0 00 000000 		POP	STACK,Z		; AND GET RID OF DATATYPE
  1336	401262'	322 11 0 00 401265'		JUMPE	T1,EXIT1	; ZERO SECOND ARGUMENTS DO NOTHING
  1337
  1338						 ; HERE FOR NON-ZERO SECOND ARGUMENT.  BREAK THE BACKWARDS
  1339						 ; LINK IN THE CURRENT CODE BLOCK TO FLUSH SOME CODE.
  1340
  1341	401263'	200 11 0 00 000000*		MOVE	T1,ILOC##	; GET CURRENT CODE BLOCK ADDRESS
  1342	401264'	402 00 0 11 000002 		CLEARM	LCLINK(T1)	; AND CLEAR THE LCLINK FIELD
  1343
  1344						 ; MERGE HERE TO PROCESS THE NORMAL FIRST ARGUMENT
  1345
  1346	401265'	265 11 0 00 401256*	EXIT1:	JSP	TLINK,CVTINT	; ENSURE AN INTEGER FIRST ARGUMENT
  1347	401266'	003 01 0 00 000073 		ERROR.	1,59
  1348
  1349	401267'	265 06 0 00 000000*		JSP	SLINK,CGCOL##	; COMPLETE GC
  1350
  1351	401270'	265 15 0 00 403706'		JSP	QLINK,MSTIME	; SAVE TIME OFF
  1352	401271'	202 00 0 00 000000*		MOVEM	Z,TIME.E##	; HERE
  1353
  1354	401272'	200 00 0 00 404011'		MOVE	Z,[1,,IGNOP]	; SAVE
  1355	401273'	251 00 0 00 000000#		BLT	Z,IGNOP+3	; KEY REGISTERS
  1356
  1357	401274'	337 00 0 01 000000 		SKIPG	0(STACK)	; EXIT 1, TYPE OF EXIT?
  1358	401275'	254 00 0 00 401300'		JRST	EXITLE		; NO, MAKE FURTHER TESTS
  1359
  1360						 ; EXIT(1) 
  1361
  1362	401276'	047 01 0 00 000012 	IFN FTOPS10,EXIT	1,	;[244] YES, MAKE QUICK EXIT!
  1363					IFN FTOPS20,HALTF		;[244] Yes - Make quick exit
  1364	401277'	254 00 0 00 401316'		JRST	FIRE.1	; BACK AGAIN? GO RECOVER
  1365		
  1366						 ; HERE FOR EXIT(-1) AND EXIT(0)
  1367
  1368	401300'	265 11 0 00 402315'	EXITLE:	JSP	TLINK,CLSALL	; CLOSE OUT ALL I/O
  1369	
  1370	401301'	476 00 0 00 401163*	EXIT2:	SETOM	RSFLAG		; AVOID RECYCLING
  1371
  1372						 ; COMPRESS STORAGE
  1373
  1374	401302'	402 00 0 02 000000 		CLEARM	0(SURF)		; BEGIN TO CLEAR ...
  1375	401303'	505 00 0 02 000000 		HRLI	Z,0(SURF)	; UNALLOCATED REGION
  1376	401304'	541 00 0 02 000001 		HRRI	Z,1(SURF)	; SO THAT ZERO-COMPRESS
  1377	401305'	200 11 0 00 401076*		MOVE	T1,CEIL		; IS EFFECTIVE
  1378	401306'	251 00 0 11 000100 		BLT	Z,MARGIN(T1)	; CLEAR IT OUT
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 30
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- EXIT

  1379						 ; NOW SET JOB DATA AREA
  1380
  1381	401307'	271 11 0 00 000100 		ADDI	T1,MARGIN	; POINT TO (CEIL)+MARGIN
  1382	401310'	506 11 0 00 000120 		HRLM	T1,.JBSA	;[175]  set up .JBSA so reset works
  1383	401311'	202 11 0 00 000121 		MOVEM	T1,.JBFF	;[175] set .JBFF for save
  1384
  1385	401312'	332 00 0 01 000000 		SKIPE	0(STACK)	; WAS ARG NEGATIVE?
  1386	401313'	254 00 0 00 401327'		JRST	EXITL		; YES
  1387
  1388						 ; EXIT(0)
  1389
  1390	401314'	047 00 0 00 000012 		EXIT			; ISSUE THE EXIT
  1391
  1392						;-----;
  1393	
  1394						 ; HERE FOR RECOVERY FROM EXIT(0) AND EXIT(-1)
  1395
  1396	401315'	047 00 0 00 000000 	FIREUP:	RESET			; RESET I/O
  1397
  1398	401316'	200 15 0 00 400464*	FIRE.1:	MOVE	Q1,TRFLGS	; GET THE TRAPPING FLAGS
  1399	401317'	047 15 0 00 000016 		APRENB	Q1,		; ENABLE THE TRAPS
  1400
  1401	401320'	200 00 0 00 404012'		MOVE	Z,[IGNOP,,1]	; RESTORE
  1402	401321'	251 00 0 00 000004 		BLT	Z,4		; KEY REGISTERS
  1403
  1404	401322'	265 15 0 00 403706'		JSP	QLINK,MSTIME	; AUGMENT ALL
  1405	401323'	274 00 0 00 401271*		SUB	Z,TIME.E	; TIMES BY AMOUNT SPENT
  1406	401324'	272 00 0 00 000000*		ADDM	Z,TIME.C##	; IN HIBERNATION
  1407	401325'	272 00 0 00 000000*		ADDM	Z,TIME.S##	;
  1408
  1409	401326'	254 00 0 00 401242*		JRST	RETNL1##	; NOW RETURN
  1410
  1411						 ; EXIT(-1)
  1412
  1413	401327'	201 00 0 02 000000 	EXITL:	MOVEI	Z,0(SURF)	; 'TO' ADDRESS
  1414	401330'	505 00 0 00 401337'		HRLI	Z,ADDRN		; 'FROM' ADDRESS
  1415	401331'	251 00 0 02 000021 		BLT	Z,RNLENG(SURF)	; MOVE NUCLEUS PROTOTYPE
  1416
  1417	401332'	542 02 0 02 000004 		HRRM	SURF,EXRECO+1(SURF)	; SAVE RECOVERY ADDRESS
  1418
  1419	401333'	201 11 0 02 000003 		MOVEI	T1,EXRECO(SURF)	; STARTUP ADDRESS
  1420	401334'	542 11 0 00 000120 		HRRM	T1,.JBSA	; SET ENTRY POINT
  1421
  1422	401335'	205 05 0 00 000001 		MOVSI	P2,1		; HIGH SEG DELETE WORD
  1423	401336'	254 00 0 02 000000 		JRST	0(SURF)		; JUMP INTO LOWER CORE 
  1424
  1425						 ; RESTART NUCLEUS
  1426
  1427	000000				ADDRN:	PHASE	0		; ADDRESS OF RN PROTOTYPE
  1428	000000	047 05 0 00 000011 		CORE	P2,		; DELETE HIGH SEGMENT
  1429	000001	001 17 0 00 000000 		ERROR	15
  1430	000002	047 00 0 00 000012 		EXIT			; AND EXIT
  1431	000003	255 00 0 00 000000 	EXRECO:	JFCL			; NOOP
  1432	000004	201 02 0 00 000000 		MOVEI	SURF,.-.	; SELF-BASING INSTRUCTION
  1433	000005	202 02 0 00 401063*		MOVEM	SURF,IGNOQ	;SAVE THE SURF
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 30-1
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- EXIT

  1434	000006	201 04 0 00 400400*		MOVEI	P1,SEGDEV	;POINT TO SYSTEM DESIRED
  1435	000007	047 04 0 00 000040 		GETSEG	P1,		; PULL HIGH SEGMENT IN
  1436	000010	001 17 0 00 000000 		ERROR	15		; SOME SORT OF ERROR
  1437	000011	200 02 0 00 401344*		MOVE	SURF,IGNOQ	;RETRIEVE THE SURF
  1438	000012	201 04 0 00 000006 		MOVEI	P1,LOWVER	;[255] LOW SEGMENT VERSION NUMBER
  1439	000013	312 04 0 00 000000*		CAME	P1,LWVRSN##	;[255] IS IT THE SAME?
  1440	000014	254 00 0 02 000016 		 JRST	EXERRV(SURF)	;[255] REPORT AN ERROR
  1441
  1442	000015	254 00 0 00 400344'		JRST	INITR		;[300] LET THE HIGH SEG TEST VERSION
  1443									;[300] COMPATABILITY.
  1444
  1445	000016	561 04 0 00 750431 	EXERRV:	HRROI	P1,-^D12007	; FLASH THIS ERROR
  1446	000017	047 00 0 00 000000 		RESET			; AND RESET IO
  1447	000020	254 00 0 00 400336'		JRST	INITXX		; MESSAGE
  1448
  1449	401360'					DEPHASE
  1450			000021		RNLENG==.-ADDRN		;LENGTH OF THE BLOCK
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 31
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- FILE

  1451						SUBTTL	Primary routines -- FILE
  1452
  1453					;	FILE(FILE-SPEC)
  1454
  1455	401360'	476 00 0 00 000000 	FILE:	SETOM	Z		; WE WANT FILES CHECKED
  1456	401361'	265 06 0 00 401757'		JSP	SLINK,CVTSIO	; MAKE A STREAM
  1457	401362'	254 00 0 04 000000 		JRST	0(PLINK)	; FAIL FOR BAD SPEC
  1458	401363'	254 00 0 00 000000*		JRST	FRET1##		; FAIL FOR NO FIND
  1459	401364'	254 00 0 00 401326*		JRST	RETNL1		; SUCCEED IF ALL GOES WELL
  1460
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 32
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- FILE

  1461
  1462						 ; FCHECK - FILE CHECK
  1463						 ; CALLING SEQUENCE:
  1464
  1465						 ; MOVE FORMAT WORD TO Z
  1466						 ; PUSH POTENTIAL STRING ONTO STACK
  1467						 ; JSP	P2,FCHECK
  1468						 ; FILE-NOT-FOUND-RETURN, T4 POINTS TO IOBLOK
  1469						 ; FILE-FOUND-RETURN - T4 POINTS TO IOBLOK
  1470						 ;		(FILE IS LEFT OPEN)
  1471
  1472						 ; STACK POPPED IN ALL CASES
  1473
  1474	401365'	202 00 0 00 000000#	FCHECK:	MOVEM	Z,IGNOP+3	; SAVE  FORMAT WORD
  1475	401366'	332 00 0 01 000000 		SKIPE	0(STACK)	; NULL STRING?
  1476	401367'	254 00 0 00 401372'		JRST	FILE2		; NO, GO ON
  1477	401370'	274 01 0 00 401204*		SUB	STACK,XWD22##	; YES, POP AND
  1478	401371'	254 00 0 05 000000 		JRST	0(P2)		; AND FAIL
  1479
  1480	401372'	265 06 0 00 401743'	FILE2:	JSP	SLINK,CVTIO	; OBTAIN INDICATED FILE
  1481	401373'	001 15 0 00 000105 		ERROR	13,69		; BAD ARGUMENT
  1482
  1483	401374'	262 01 0 00 000000 		POP	STACK,Z		; FORMAT WORD
  1484	401375'	262 01 0 00 000014 		POP	STACK,T4	; IOBLOK POINTER
  1485	401376'	336 00 0 00 000014 		SKIPN	T4		; WAS A FILE FOUND
  1486	401377'	001 15 0 00 000105 		ERROR	13,69		; BAD SPEC
  1487
  1488	401400'	332 00 0 14 000021 		SKIPE	IOCHAN(T4)	; IS IT OPEN NOW?
  1489	401401'	254 00 0 05 000001 		JRST	1(P2)		; YES - RETURN
  1490
  1491	401402'	200 00 0 00 000000#		MOVE	Z,IGNOP+3	; RETRIEVE FORMAT WORD
  1492	401403'	265 15 0 00 403701'		JSP	QLINK,MODE	; DETERMINE THE MODE
  1493	401404'	265 15 0 00 403711'		JSP	QLINK,OPN	; OPEN THE FILE
  1494	401405'	001 14 0 00 000034 		ERROR	12,28		; NO OPEN? HIS ERROR
  1495
  1496	401406'	265 15 0 00 403661'		JSP	QLINK,LKP	; LOOK THE FILE UP
  1497	401407'	254 00 0 00 401411'		JRST	FILE1		; COULDN'T FIND IT
  1498
  1499
  1500	401410'	254 00 0 05 000001 		JRST	1(P2)		; AND RETURN
  1501
  1502						 ; HERE IF THE FILE COULDN'T BE FOUND
  1503
  1504	401411'	265 15 0 00 403637'	FILE1:	JSP	QLINK,CLS	; RELEASE THE CHANNEL
  1505	401412'	254 00 0 05 000000 		JRST	0(P2)		; AND FAIL
  1506
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 33
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- INPUT

  1507						SUBTTL	Primary routines -- INPUT
  1508
  1509					;	INPUT(NAME, FILE-SPEC-SEQUENCE, FORMAT)
  1510
  1511	401413'	265 06 0 00 401664'	INPUT0:	JSP	SLINK,CVTFMT	; CONVERT CHARACTERS TO BITS
  1512	401414'	202 00 0 00 000005 		MOVEM	Z,P2		; SAVE FORMAT
  1513
  1514	401415'	400 00 0 00 000000 		CLEAR	Z,		; WE DON'T WANT A FILE CHECK
  1515	401416'	265 06 0 00 401757'		JSP	SLINK,CVTSIO	; CONVERT 2ND ARG TO STREAM
  1516	401417'	001 14 0 00 000015 		ERROR	12,13		; BAD SPECIFICATION
  1517	401420'	001 17 0 00 000000 		ERROR	15		; CAN'T TAKE THIS ONE
  1518	401421'	202 05 0 01 000000 		MOVEM	P2,0(STACK)	; INSERT FORMAT
  1519
  1520	401422'	200 05 0 00 400756*		MOVE	P2,INFILE	; INSERT
  1521	401423'	336 00 0 01 777777 		SKIPN	-1(STACK)	; DEFAULT FILE
  1522	401424'	202 05 0 01 777777 		MOVEM	P2,-1(STACK)	; IF NECESSARY
  1523
  1524	401425'	200 00 0 00 404005'		MOVE	Z,[IABLOK,,TVIN]; ARGUMENTS FOR ...
  1525	401426'	265 06 0 00 402025'		JSP	SLINK,IOASSN	; ASSOCIATION ROUTINE
  1526
  1527	401427'	254 00 0 00 401250*		JRST	RETNUL##		; RETURN NULL STRING
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 34
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- MTAPE

  1528						SUBTTL	Primary routines -- MTAPE
  1529
  1530					;	MTAPE(FUNCTION, FILE-SPEC, FORMAT)
  1531					;		<FORMAT IS OPTIONAL, ASCII ASSUMED IF NOT SPECIFIED>
  1532
  1533
  1534
  1535
  1536	401430'	265 06 0 00 401664'	MTAPE0::JSP	SLINK,CVTFMT		; GET FORMAT WORD
  1537	401431'	265 05 0 00 401365'		JSP	P2,FCHECK		; GET A CHANNEL #
  1538	401432'	255 00 0 00 000000 		JFCL				; WE DONT GIVE A DAMN
  1539	401433'	200 06 0 00 000014 		MOVE	S1,T4			; SAVE IOBLOK ADDR
  1540	401434'	265 11 0 00 401265*		JSP	TLINK,CVTINT##		; RETRIEVE FUNCTION #
  1541	401435'	001 15 0 00 000011 		ERROR	13,9			; BAD 1ST ARG
  1542	401436'	262 01 0 00 000005 		POP	STACK,P2		; SAVE VALUE OF FUNCTION
  1543	401437'	301 05 0 00 000000 		CAIL	P2,0			;IF LT 0
  1544	401440'	303 05 0 00 000006 		CAILE	P2,6			;OR GT 6
  1545	401441'	001 15 0 00 000011 		ERROR	13,9			;THEN 1ST ARG OUT OF RANGE
  1546	401442'	200 07 0 06 000021 		MOVE	S2,IOCHAN(S1)		; GET CHANNEL IN BITS 9-12
  1547	401443'	242 07 0 00 777751 		LSH	S2,-27			; RIGHT JUSTIFY THEM
  1548	401444'	047 07 0 00 000004 		DEVCHR	S2,			; WHAT DEVICE
  1549	401445'	607 07 0 00 000020 		TLNN	S2,20			; DO WE HAVE A MAGTAPE
  1550	401446'	254 00 0 04 000000 		JRST	0(PLINK)			; NO - FAIL
  1551	401447'	200 07 0 05 401456'		MOVE	S2,MTABLE(P2)		; GET MTAPE # FROM TABLE
  1552	401450'	434 07 0 06 000021 		IOR	S2,IOCHAN(S1)		; OR IN THE CHANNEL #
  1553	401451'	434 07 0 00 404013'		IOR	S2,[MTAPE 0,0]		; COMPLETE THE INSTRCTION
  1554	401452'	256 00 0 00 000007 		XCT	S2			; DO IT
  1555	401453'	510 07 0 00 000007 		HLLZ	S2,S2			; CLEAR OUT FUNCTION
  1556	401454'	256 00 0 00 000007 		XCT	S2			; WAIT FOR COMPLETION
  1557	401455'	254 00 0 00 401427*		JRST	RETNUL##		;BRING NULL-STRING HOME TO MOMMA
  1558
  1559
  1560					; MTAPE FUNCTION TABLE FOLLOWS.  ITS USED TO CONVERT THE SITBOL
  1561					; MTAPE FUNCTION NUMBERS TO STANDARD DEC MONITOR CODES
  1562
  1563	401456'	000000	000001		MTABLE:	EXP	1			; REWIND
  1564	401457'	000000	000003			EXP	3			; WRITE A EOF MARK
  1565	401460'	000000	000006			EXP	6			; SKIP A RECORD
  1566	401461'	000000	000007			EXP	7			; BACKSPACE A RECORD
  1567	401462'	000000	000010			EXP	10			; SPACE TO LOGICAL EOT
  1568	401463'	000000	000016			EXP	16			; SKIP 1 FILE
  1569	401464'	000000	000017			EXP	17			; BACKSPACE 1 FILE
  1570
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 35
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- OUTPUT

  1571						SUBTTL	Primary routines -- OUTPUT
  1572
  1573					;	OUTPUT(NAME, FILE-SPEC, FORMAT)
  1574
  1575	401465'	265 11 0 00 000000*	OUTPT0:	JSP	TLINK,CVTSTR##	; ENSURE 3RD ARGUMENT
  1576	401466'	003 01 0 00 000107 		ERROR.	1,71		; IS A STRING
  1577
  1578	401467'	265 06 0 00 401664'		JSP	SLINK,CVTFMT	; CONVERT 3RD ARG TO FORMAT
  1579	401470'	202 00 0 00 000005 		MOVEM	Z,P2		; SAVE RESULT IN P2
  1580
  1581	401471'	265 06 0 00 401743'		JSP	SLINK,CVTIO	; CONVERT 2ND ARG TO FILE
  1582	401472'	001 14 0 00 000015 		ERROR	12,13		; BAD 2ND ARG
  1583	401473'	202 05 0 01 000000 		MOVEM	P2,0(STACK)	; INSERT FORMAT TO COMPLETE DESCR.
  1584
  1585	401474'	200 00 0 00 404006'		MOVE	Z,[OABLOK,,TVOUT]	; LOAD ARGS
  1586
  1587	401475'	200 05 0 00 400764*		MOVE	P2,OUTF##	; INSERT DEFAULT
  1588	401476'	336 00 0 01 777777 		SKIPN	-1(STACK)	; OUTPUT FILE
  1589	401477'	202 05 0 01 777777 		MOVEM	P2,-1(STACK)	; IF NEEDED
  1590	401500'	265 06 0 00 402025'		JSP	SLINK,IOASSN	; FOR COMMON ASSN FUNCTION
  1591
  1592	401501'	254 00 0 00 401455*		JRST	RETNUL##		; RETURN
  1593
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 36
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- RENAME

  1594						SUBTTL	Primary routines -- RENAME
  1595
  1596					;	RENAME(FILE-SPEC,FILE-SPEC)
  1597
  1598	401502'	400 00 0 00 000000 	RENAM:	SETZ	Z,		;  CLEAR FORMAT WORD
  1599	401503'	265 05 0 00 401365'		JSP	P2,FCHECK	; CHECK 2ND FILE
  1600	401504'	254 00 0 00 401363*		JRST	FRET1##		; NOT THERE? FAIL
  1601	401505'	202 14 0 00 401221*		MOVEM	T4,IGNOP##	; SAVE RETURNED VALUE
  1602
  1603	401506'	200 15 0 01 777777 		MOVE	Q1,-1(STACK)	; IS THE FIRST
  1604	401507'	316 15 0 00 000000*		CAMN	Q1,NULLST	; ARGUMENT NULL?
  1605	401510'	254 00 0 00 401504*		JRST	FRET1##		; YES, FAIL
  1606
  1607	401511'	400 00 0 00 000000 		SETZ	Z,		; CLEAR FORMAT TO ASSUME ASCII
  1608	401512'	265 05 0 00 401365'		JSP	P2,FCHECK	; IS FIRST FILE THERE?
  1609	401513'	254 00 0 00 401516'		JRST	RENAM1		; NO - GOOD
  1610	401514'	265 15 0 00 403637'		JSP	QLINK,CLS	; CLOSE IT UP
  1611	401515'	254 00 0 04 000000 		JRST	0(PLINK)	; AND FAIL
  1612	
  1613						 ; HERE IF FIRST FILE IS NOT THERE
  1614						 ; AND 2ND FILE IS THERE AND OPEN
  1615
  1616	401516'	200 05 0 00 401505*	RENAM1:	MOVE	P2,IGNOP##	; OBTAIN
  1617	401517'	200 13 0 05 000021 		MOVE	T3,IOCHAN(P2)	; CHANNEL THAT'S OPEN
  1618	401520'	434 13 0 00 404014'		IOR	T3,[RENAME IONAME(T4)] ; OR IN INSTR
  1619	401521'	256 00 0 00 000013 		XCT	T3		; RENAME THE FILE
  1620	401522'	001 14 0 00 000003 		ERROR	12,3		; COULDN'T RENAME
  1621
  1622	401523'	200 14 0 00 000005 		MOVE	T4,P2		; PICK UP OLD BLOK
  1623	401524'	265 15 0 00 403637'		JSP	QLINK,CLS	; AND CLOSE IT OUT
  1624
  1625	401525'	254 00 0 00 401501*		JRST	RETNUL##		; AND RETURN
  1626
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 37
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- RESCAN

  1627						SUBTTL	Primary routines -- RESCAN
  1628
  1629					;	RESCAN()
  1630
  1631	401526'	051 10 0 00 000001 	RESCN:	RESCAN	1		; RESCAN THE INPUT LINE
  1632	401527'	051 14 0 00 000000 		SKPINL			; IS ANYTHING THERE ?
  1633	401530'	254 00 0 00 401510*		JRST	FRET1##		; NOPE, JUST FAIL
  1634
  1635	401531'	274 01 0 00 401370*		SUB	STACK,XWD22##	; PRUNE STACK
  1636
  1637	401532'	201 00 0 00 000454 		MOVEI	Z,^D300		; LARGEST STRING FROM TTY
  1638	401533'	265 15 0 00 000000*		JSP	QLINK,ASBLOK##	; ALLOCATE SBLOK
  1639	401534'	001 13 0 00 000003 		ERROR	11,3		; TOO BIG
  1640
  1641	401535'	261 01 0 01 777777 		PUSH	STACK,-1(STACK)	; DUPLICATE THE...
  1642	401536'	261 01 0 01 777777 		PUSH	STACK,-1(STACK)	; STRING DESCRIPTOR
  1643
  1644	401537'	265 15 0 00 000000*		JSP	QLINK,CVTPTR##	; CONVERT TO POINTER
  1645	401540'	000000	000000			0			; NO BASING
  1646	401541'	001 17 0 00 000000 		ERROR	15		; CAN'T FAIL
  1647
  1648	401542'	205 06 0 00 777324 		MOVSI	S1,-^D300	; S1 WILL HOLD CHARACTER COUNT
  1649	401543'	200 07 0 00 401164*		MOVE	S2,SYSCT##	; S2 HAS SYSTEM CHARACTER TABLE
  1650
  1651						 ; LOOP TO MAKE THE LAST LINE TYPED A STRING BLOK
  1652
  1653	401544'	051 04 0 00 000015 	RSCNL:	INCHWL	Q1		; INPUT A CHARACTER TO Q1
  1654	401545'	136 15 0 00 000000 		IDPB	Q1,Z		; DEPOSIT IN SBLOK
  1655	401546'	271 15 0 07 000002 		ADDI	Q1,CTBITS(S2)	; POINT TO ITS MASK IN SYSCT
  1656	401547'	200 15 0 15 000000 		MOVE	Q1,0(Q1)	; AND LOAD SAID MASK
  1657	401550'	602 15 0 00 034000 		TXNE	Q1,Y.ALT!Y.VM!Y.CR	; INPUT TERMINATOR ?
  1658	401551'	254 00 0 00 401554'		JRST	RSCNE		; YES, FINISH UP
  1659	401552'	253 06 0 00 401544'		AOBJN	S1,RSCNL	; INCREMENT COUNT AND LOOP
  1660	401553'	001 14 0 00 000025 		ERROR	12,21		; STRING IS TOO LONG
  1661
  1662						 ; HERE WHEN A TERMINATOR IS FOUND
  1663
  1664	401554'	542 06 0 01 000000 	RSCNE:	HRRM	S1,0(STACK)	; STORE LENGTH IN DESCRIPTOR
  1665
  1666	401555'	201 16 0 06 000016 		MOVEI	Q2,^D14(S1)	; COMPUTE TOTAL LENGTH OF SBLOK
  1667	401556'	231 16 0 00 000005 		IDIVI	Q2,5		; CONVERT TO WORDS
  1668	401557'	200 15 0 01 777777 		MOVE	Q1,-1(STACK)	; GET ADDRESS OF SBLOK
  1669	401560'	550 17 0 15 000000 		HRRZ	Q3,BLENG(Q1)	; AND GET THE CURRENT LENGTH
  1670	401561'	542 16 0 15 000000 		HRRM	Q2,BLENG(Q1)	; STORE NEW LENGTH
  1671	401562'	274 17 0 00 000016 		SUB	Q3,Q2		; FIND THE DIFFERENCE
  1672	401563'	274 02 0 00 000017 		SUB	SURF,Q3		; AND PRUNE SURFACE POINTER
  1673
  1674	401564'	254 00 0 04 000001 		JRST	1(PLINK)	; RETURN SUCCESS
  1675
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 38
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- REWIND

  1676						SUBTTL	Primary routines -- REWIND
  1677
  1678					;	REWIND(FILE-SPEC-SEQWUENCE)
  1679
  1680
  1681	401565'	400 00 0 00 000000 	RWND:	SETZ	Z,		; No file check
  1682	401566'	265 06 0 00 401757'		JSP	SLINK,CVTSIO	; CONVERT ARG TO STREAM
  1683	401567'	001 14 0 00 000015 		ERROR	12,13		; BAD SYNTAX
  1684	401570'	001 17 0 00 000000 		ERROR	15		; CAN'T FAIL THIS TEST
  1685
  1686	401571'	200 13 0 01 777777 		MOVE	T3,-1(STACK)	; LOAD ADDRESS OF STBLOK
  1687	401572'	201 12 0 13 000004 		MOVEI	T2,STIOBL(T3)	; POINT TO FIRST IOBLOK
  1688	401573'	550 11 0 13 000000 		HRRZ	T1,BLENG(T3)	; LOAD LENGTH
  1689	401574'	271 11 0 13 000000 		ADDI	T1,0(T3)	; UPPER BOUND
  1690
  1691	401575'	201 10 0 00 000004 		MOVEI	S3,STIOBL	; MAKE FIRST IOBLOK
  1692	401576'	202 10 0 13 000003 		MOVEM	S3,STCF(T3)	; THE CURRENT FILE
  1693
  1694						 ; LOOP TO CLOSE OUT FILES IN STREAM
  1695
  1696	401577'	311 12 0 00 000011 	RWND1:	CAML	T2,T1		; ARE WE STILL BELOW BOUND
  1697	401600'	254 00 0 00 401364*		JRST	RETNL1##	; NO - RETURN
  1698
  1699	401601'	200 14 0 12 000000 		MOVE	T4,0(T2)	; MOVE IOBLOK POINTER
  1700	401602'	265 15 0 00 403637'		JSP	QLINK,CLS	; CLOSE THE FILE
  1701	401603'	344 12 0 00 401577'		AOJA	T2,RWND1	; KEEP LOOPING
  1702
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 39
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- RUN

  1703						SUBTTL	Primary routines -- RUN
  1704
  1705						 ; RUN(FILE,INC)
  1706
  1707
  1708	401604'	265 11 0 00 401434*	RUN0:	JSP	TLINK,CVTINT##	; ENSURE AN INTEGER
  1709	401605'	003 01 0 00 000132 		ERROR.	1,90		;
  1710	401606'	204 05 0 01 000000 		MOVS	P2,0(STACK)	; SAVE IN P2-LEFT
  1711	401607'	274 01 0 00 401531*		SUB	STACK,XWD22##	; REMOVE INTEGER
  1712
  1713	401610'	200 06 0 01 777777 		MOVE	S1,-1(STACK)	; LOOK AT FIRST ARGUMENT
  1714	401611'	316 06 0 00 401507*		CAMN	S1,NULLST##	; COMPARE WITH NULL STRING
  1715	401612'	001 15 0 00 000064 		ERROR	13,52		; BAD FILE SPEC
  1716
  1717	401613'	265 06 0 00 401743'		JSP	SLINK,CVTIO	; GET THE FILE
  1718	401614'	001 15 0 00 000064 		ERROR	13,52		; BAD FILE SPEC
  1719
  1720	401615'	265 11 0 00 402315'		JSP	TLINK,CLSALL	; CLOSE ALL I/O
  1721
  1722	401616'	202 02 0 00 401516*		MOVEM	SURF,IGNOP##	; SAVE CRITICAL
  1723	401617'	202 01 0 00 000000#		MOVEM	STACK,IGNOP##+1	; REGISTERS
  1724
  1725	401620'	200 14 0 01 777777 		MOVE	T4,-1(STACK)	; POINT TO RETRIEVED IOBLOK
  1726	401621'	200 15 0 14 000003 		MOVE	Q1,IODEV(T4)	; TRANSFER
  1727	401622'	202 15 0 14 000004 		MOVEM	Q1,IONAME-1(T4)	; DEVICE
  1728	401623'	541 05 0 14 000004 		HRRI	P2,IONAME-1(T4)	; POINT TO GOODIES
  1729	401624'	047 05 0 00 000035 		RUN	P2,		; ISSUE UUO
  1730
  1731	401625'	200 02 0 00 401616*		MOVE	SURF,IGNOP##	; RESTORE
  1732	401626'	200 01 0 00 000000#		MOVE	STACK,IGNOP##+1	; CRITICAL REG.
  1733	401627'	001 14 0 00 000031 		ERROR	12,25		; AND SIGNAL ERROR
  1734
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 40
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- TIME

  1735						SUBTTL	Primary routines -- TIME
  1736
  1737					;	TIME(N)
  1738					;	RETURNS RUNTIME IF N=0	AND ABSOLUTE TIME IF N = 1
  1739
  1740	401630'	265 11 0 00 401604*	TIME0:	JSP	TLINK,CVTINT##	; ENSURE INTEGER
  1741	401631'	003 01 0 00 000133 		ERROR.	1,91		; BAD ARG
  1742
  1743	401632'	332 00 0 01 000000 		SKIPE	0(STACK)	; TEST N
  1744	401633'	254 00 0 00 401637'		JRST	TIME1		; BRANCH IF NOT 0
  1745
  1746	401634'	265 15 0 00 403706'		JSP	QLINK,MSTIME	; GET TIME SINCE ...
  1747	401635'	274 00 0 00 401324*		SUB	Z,TIME.C##	; END OF COMPILATION
  1748	401636'	254 00 0 00 401640'		JRST	TIME2		; JOIN COMMON RETURN
  1749
  1750						 ; ABSOLUTE TIME
  1751
  1752	401637'	047 00 0 00 000023 	TIME1:	MSTIME	Z,		; ABSOLUTE TIME
  1753
  1754	401640'	202 00 0 01 000000 	TIME2:	MOVEM	Z,0(STACK)	; RETURN ...
  1755	401641'	254 00 0 04 000001 		JRST	1(PLINK)	; Z
  1756
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 41
SNOFIO	MAC	15-Mar-69 11:20		Primary routines -- TTY

  1757						SUBTTL	Primary routines -- TTY
  1758
  1759						 ; TTY()
  1760
  1761	401642'	265 11 0 00 401465*	TTY:	JSP	TLINK,CVTSTR##	; ENSURE A STRING
  1762	401643'	003 01 0 00 000144 		ERROR.	1,100		; GIVE ERROR.
  1763
  1764	401644'	265 15 0 00 401537*		JSP	QLINK,CVTPTR##	; TRY TO MAKE A PTR
  1765	401645'	000000	000000			0			; NO BASING
  1766	401646'	254 00 0 00 401655'		JRST	TTY1		; WHOOPS - NULL STRING
  1767
  1768	401647'	134 15 0 00 000000 		ILDB	Q1,Z		; CHECK
  1769	401650'	302 15 0 00 000103 		CAIE	Q1,"C"		; FOR 'C'
  1770	401651'	001 15 0 00 000075 		ERROR	13,61		; GIVE ERROR IF NOT
  1771
  1772	401652'	051 13 0 00 000000 		SKPINC	0		; CHECK FOR CHAR
  1773	401653'	254 00 0 04 000000 		JRST	0(PLINK)	; NO
  1774	401654'	254 00 0 00 401525*		JRST	RETNUL##	; YES
  1775
  1776						 ; HERE TO TEST FOR A FULL LINE
  1777
  1778	401655'	051 14 0 00 000000 	TTY1:	SKPINL	0		; LINE?
  1779	401656'	254 00 0 00 401530*		JRST	FRET1##		; NO
  1780	401657'	254 00 0 00 401600*		JRST	RETNL1##	; YES
  1781
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 42
SNOFIO	MAC	15-Mar-69 11:20		TYPE S (SECONDARY) UTILITIES

  1782						SUBTTL	TYPE S (SECONDARY) UTILITIES
  1783
  1784					;
  1785
  1786					;	CVTFMT - CONVERT TO FORMAT (STRING TO BITS)
  1787
  1788					;	CVTIO - CONVERT TO IOBLOK (FROM STRING)
  1789
  1790					;	CVTSIO - CONVERT TO STREAM (OF IOBLOKS)
  1791
  1792					;	GETOCT - GET OCTAL NUMBER (FROM THE STREAM)
  1793
  1794					;	IOASSN - DO AN I/O ASSOCIATION
  1795
  1796					;	NONBLK - STREAM TO A NONBLANK
  1797
  1798					;	STFILS - STREAM FOR FILES
  1799
  1800					;	TVIN & TVOUT - TRAPPED VARIABLES FOR I/O
  1801
  1802
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 43
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- CVTFMT

  1803						SUBTTL	Secondary routines -- CVTFMT
  1804
  1805					;	CVTFMT - CONVERTS A DESCRIPTOR TO AN INTERNAL (ONE-WORD)
  1806					;	FORMAT. THE DESCRIPTOR MAY BE STRING OR INTEGER.
  1807					;	IF INTEGER, THE VALUE IS PLACED IN THE RIGHT HALF
  1808					;	OF THE FORMAT. IF STRING, IT MAY CONSIST OF CHARACTERS
  1809					;	CHOSEN FROM THE SET 'TCN' (ASCII MODE) OR BE ONE OF 
  1810					;	'BOSUD' (WORD MODE) OR SIMPLY BE ANY OTHER SINGLE 
  1811					;	CHARACTER (CHARACTER PREFIX). THE LATTER 
  1812					;	IS SO AS TO BE COMPATIBLE WITH SPITBOL.
  1813
  1814					;	BYTE TABLE
  1815					;	CONTAINS CONVERSION CHARACTERISTICS
  1816
  1817			401657'			BTTBL==.-1		; ADDRESS MINUS 1 OF THIS TABLE
  1818
  1819	401660'	000060	000001			XWD	"0",1		; BASE-LENGTH
  1820	401661'	000060	000003			XWD	"0",3		; BASE - LENGTH
  1821	401662'	000040	000006			XWD	" ",6		; BASE - LENGTH
  1822	401663'	000000	000007			XWD	0,7		; BASE - LENGTH
  1823
  1824					; CALLING SEQUENCE:
  1825					;	PUSH DESCRIPTOR ONTO STACK
  1826					;	JSP	SLINK,CVTFMT
  1827					;	RETURN - DESCRIPTOR IS POPPED FROM STACK
  1828					;		(Z CONTAINS THE FORMAT)
  1829
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 44
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- CVTFMT

  1830
  1831	401664'	554 12 0 01 777777 	CVTFMT::HLRZ	T2,-1(STACK)	; GET DATATYPE
  1832	401665'	302 12 0 00 002001 		CAIE	T2,IDT		; IS IT INTEGER?
  1833	401666'	254 00 0 00 401672'		JRST	CVTFM1		; NO, GO HANDLE STRINGS
  1834
  1835						 ; HERE FOR AN INTEGER FORMAT
  1836
  1837	401667'	550 00 0 01 000000 	CVTFM4:	HRRZ	Z,0(STACK)	; LIFT INTEGER TO Z
  1838	401670'	274 01 0 00 401607*		SUB	STACK,XWD22##	; REMOVE DESCRIPTOR
  1839	401671'	254 00 0 06 000000 		JRST	0(SLINK)	; AND RETURN
  1840
  1841						 ; HERE IF STRING OR SOMETHING ELSE
  1842
  1843	401672'	265 11 0 00 401642*	CVTFM1:	JSP	TLINK,CVTSTR##	; MUST BE A STRING HERE
  1844	401673'	003 01 0 00 000107 		ERROR.	1,71		; WRONG DATATYPE
  1845
  1846	401674'	550 14 0 01 000000 		HRRZ	T4,0(STACK)	; LOAD LENGTH
  1847	401675'	265 15 0 00 401644*		JSP	QLINK,CVTPTR	; CONVERT TO POINTER
  1848	401676'	000000	000000			0			; NO BASING NEEDED
  1849	401677'	254 00 0 00 401667'		JRST	CVTFM4		; MUST BE NULL STRING
  1850
  1851	401700'	200 15 0 00 000014 		MOVE	Q1,T4		; SAVE ORIGINAL LENGTJ
  1852
  1853						 ; EXAMINE EACH CHARACTER
  1854
  1855	401701'	400 11 0 00 000000 		CLEAR	T1,		; FLAGS ARE ACCUMULATED HERE
  1856
  1857	401702'	400 12 0 00 000000 	CVTFM2:	CLEAR	T2,		; FLAGS FOR THIS PASS
  1858
  1859	401703'	134 13 0 00 000000 		ILDB	T3,Z		; NEXT BYTE TO T3
  1860
  1861	401704'	306 13 0 00 000124 		CAIN	T3,"T"		; T?
  1862	401705'	205 12 0 00 000100 		MOVX	T2,FMT.T	;[246] TERMINAL CHARACTER FORMAT
  1863
  1864	401706'	306 13 0 00 000116 		CAIN	T3,"N"		; N?
  1865	401707'	205 12 0 00 000400 		MOVX	T2,FMT.N	;[246]
  1866
  1867	401710'	306 13 0 00 000103 		CAIN	T3,"C"		; C?
  1868	401711'	205 12 0 00 000200 		MOVX	T2,FMT.C	;[246]
  1869
  1870	401712'	306 13 0 00 000104 		CAIN	T3,"D"		; D?
  1871	401713'	205 12 0 00 001010 		MOVX	T2,FMT.D!FMT.WM	;[246]
  1872
  1873	401714'	306 13 0 00 000102 		CAIN	T3,"B"		; B?
  1874	401715'	205 12 0 00 001001 		MOVX	T2,FMT.B!FMT.WM	;[246]
  1875
  1876	401716'	306 13 0 00 000117 		CAIN	T3,"O"		; O?
  1877	401717'	205 12 0 00 001002 		MOVX	T2,FMT.O!FMT.WM	;[246]
  1878
  1879	401720'	306 13 0 00 000123 		CAIN	T3,"S"		; S?
  1880	401721'	205 12 0 00 003003 		MOVX	T2,FMT.S!FMT.WM	;[246]
  1881
  1882	401722'	306 13 0 00 000125 		CAIN	T3,"U"		; U?
  1883	401723'	205 12 0 00 003004 		MOVX	T2,FMT.U!FMT.WM	;[246]
  1884
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 44-1
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- CVTFMT

  1885	401724'	306 13 0 00 000101 		CAIN	T3,"A"		; A?
  1886	401725'	205 12 0 00 010000 		MOVX	T2,FMT.AP	;[246]
  1887
  1888	401726'	332 00 0 00 000012 		SKIPE	T2		; DID WE HIT ANYTHING?
  1889	401727'	254 00 0 00 401734'		JRST	CVTFM3		; YES, GO ON
  1890
  1891	401730'	205 12 0 00 004000 		MOVX	T2,FMT.CP	;[246] SINGLE CHAR FORMAT 
  1892	401731'	540 12 0 00 000013 		HRR	T2,T3		; GET CHARACTER TOO.
  1893	401732'	302 15 0 00 000001 		CAIE	Q1,1		; LENGTH = 1, OK
  1894	401733'	001 14 0 00 000035 		ERROR	12,29		; BAD FORMAT
  1895
  1896	401734'	434 11 0 00 000012 	CVTFM3:	IOR	T1,T2		; OR IN THE BITS
  1897	401735'	367 14 0 00 401702'		SOJG	T4,CVTFM2	; CONTINUE WITH LOOP
  1898
  1899						 ; ON LOOP TERMINATION, CHECK COMPATIBILITY
  1900
  1901	401736'	200 00 0 00 000011 		MOVE	Z,T1		; LOAD RESULT
  1902	401737'	603 00 0 00 005000 		TXNE	Z,FMT.WM!FMT.CP	;[246] IF NOT ASCII MODE
  1903	401740'	316 11 0 00 000012 		CAMN	T1,T2		; SEE IF THERE'S ONLY ONE
  1904	401741'	254 00 0 06 000000 		JRST	0(SLINK)	; IF SO - RETURN
  1905	401742'	001 15 0 00 000076 		ERROR	13,62		; ELSE BAD ARGUMENT
  1906
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 45
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- CVTIO

  1907						SUBTTL	Secondary routines -- CVTIO
  1908
  1909					;	CVTIO - CONVERT A DESCRIPTOR TO AN IO DESCRIPTOR.
  1910					;	NULL STRING IMPLIES TTY.
  1911					;
  1912					; CALLING SEQUENCE:
  1913					;	PUSH DESCRIPTOR ONTO STACK
  1914					;	JSP	SLINK,CVTIO
  1915					;	FAIL		; IMPROPER SYNTAX (DESCR POPPED)
  1916					;	SUCCESS		; I/O DESCRIPTOR REPLACES ORIGINAL
  1917
  1918	401743'	265 11 0 00 401672*	CVTIO:	JSP	TLINK,CVTSTR##	; CONVERT TO STRING
  1919	401744'	003 01 0 00 000154 		ERROR.	1,108		; BAD DATATYPE
  1920
  1921	401745'	265 11 0 00 400707*	CVTIO1:	JSP	TLINK,STINIT##	; INITIAIZE STREAMING
  1922	401746'	254 00 0 00 401753'		JRST	CVTIO2		; MUST BE NULL
  1923
  1924	401747'	265 11 0 00 403037'		JSP	TLINK,STRIO	; GO GET NEXT I/O DESCR
  1925	401750'	254 00 0 06 000000 		JRST	0(SLINK)	; BAD VALUE
  1926
  1927	401751'	322 00 0 06 000001 		JUMPE	Z,1(SLINK)	; NORMAL RETURN (IF NO BREAK)
  1928	401752'	254 00 0 06 000000 		JRST	0(SLINK)	; OTHERWISE FAIL
  1929
  1930						 ; NULL STRING
  1931
  1932	401753'	274 01 0 00 401670*	CVTIO2:	SUB	STACK,XWD22##	; POP DESCRIPTOR
  1933	401754'	261 01 0 00 401475*		PUSH	STACK,OUTF##	; RETURN ...
  1934	401755'	261 01 0 00 000000#		PUSH	STACK,OUTF+1	; OUTPUT ...
  1935	401756'	254 00 0 06 000001 		JRST	1(SLINK)	; FILE
  1936
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 46
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- CVTSIO

  1937						SUBTTL	Secondary routines -- CVTSIO
  1938
  1939					;	CVTSIO - CONVERT TO STREAM I/O 
  1940					;	USED BY INPUT, REWIND AND IN GENERAL WHEREVER A STREAM IS
  1941					;	REQUIRED AS OPPOSED TO JUST AN IOBLOK.
  1942					;
  1943					; CALLING SEQUENCE:
  1944					;	PUSH DESCRIPTOR (STRING OR IOBLOK) ONTO STACK
  1945					;	SET Z TO -1 IF FILES SHOULD BE 
  1946					;	CHECKED AND TO 0 OTHERWISE
  1947					;	JSP	SLINK,CVTSIO
  1948					;	BAD-SYNTAX (STACK POPPED)
  1949					;	FILES-NOT-PRESENT (STREAM RETURNED)
  1950					;	NORMAL RETURN (STREAM RETURNED)
  1951
  1952
  1953	401757'	202 00 0 00 400667*	CVTSIO::MOVEM	Z,IGNOS		; SAVE FLAG
  1954	401760'	265 11 0 00 401743*		JSP	TLINK,CVTSTR##	; MAKE SURE IT'S STRING
  1955	401761'	254 00 0 00 401771'		JRST	CVTST3		; TRY IOBLOK
  1956
  1957	401762'	265 11 0 00 401745*	CVTSI2:	JSP	TLINK,STINIT##	; INITIALIZE STREAMING
  1958	401763'	254 00 0 00 401765'		JRST	CVTSI1		; MUST BE NULL STRING
  1959	401764'	254 00 0 00 402074'		JRST	STFILS		; JOIN STREAMING
  1960
  1961	401765'	274 01 0 00 401753*	CVTSI1:	SUB	STACK,XWD22##	; POP NULL STRING OFF
  1962	401766'	261 01 0 00 401422*		PUSH	STACK,INFILE##	; SUBSTITUTE ...
  1963	401767'	261 01 0 00 404004'		PUSH	STACK,[0]	; DEFAULT FILE
  1964	401770'	254 00 0 06 000002 		JRST	2(SLINK)	; RETURN SUCCESSFULLY
  1965
  1966						 ; HERE IF NOT A STRING
  1967
  1968	401771'	554 07 0 01 777777 	CVTST3:	HLRZ	S2,-1(STACK)	; LOAD DT
  1969	401772'	306 07 0 00 004004 		CAIN	S2,PDT		; PATTERN?
  1970	401773'	254 00 0 00 402000'		JRST	CVTST4		; YES
  1971	401774'	302 07 0 00 004015 		CAIE	S2,IODT		; I/O ?
  1972	401775'	003 01 0 00 000106 		ERROR.	1,70		; INCORRECT DATATYPE
  1973
  1974	401776'	201 07 0 00 000001 		MOVEI	S2,1		; ONE IOBLOK
  1975	401777'	254 00 0 00 402113'		JRST	STFLS2		; JOIN FILE STREAMING
  1976
  1977						 ; THERE'S ONLY ONE GUY WHO WOULD WANT TO READ FROM 
  1978						 ; A PATTERN
  1979
  1980	402000'	274 01 0 00 401765*	CVTST4:	SUB	STACK,XWD22##	; POP MEANINGLESS PATTERN
  1981	402001'	261 01 0 00 400753*		PUSH	STACK,LISTF##	; AND PUSH THE 
  1982	402002'	261 01 0 00 000000#		PUSH	STACK,LISTF+1	; LISTING FILE ON
  1983	402003'	254 00 0 00 401771'		JRST	CVTST3		; LOOP BACK AND TRY AGAIN.
  1984
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 47
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- GETOCT

  1985						SUBTTL	Secondary routines -- GETOCT
  1986
  1987					;	GETOCT - WILL STREAM ACROSS BLANKS, CONVERT A
  1988					;	SEQUENCE OF DIGITS TO OCTAL AND EAT UP THE NEXT
  1989					;	BREAK CHARACTER. THE BREAK CHARACTER IS RETURNED IN Q2.
  1990					;
  1991					; CALLING SEQUENCE:
  1992					;	STINIT HAS PREVIOUSLY BEEN CALLED
  1993					;	JSP	SLINK,GETOCT
  1994					;	RETURN	; Z CONTAINS OCTAL NUMBER
  1995
  1996	402004'	202 06 0 00 000000*	GETOCT:	MOVEM	SLINK,GETOSV##	; SAVE RETURN
  1997
  1998	402005'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; ENSURE A NONBLANK
  1999	402006'	254 00 0 00 403406'		JRST	STBOMB		; RUNNOUT MEANS ERROR
  2000
  2001	402007'	205 10 0 00 000040 		MOVX	S3,Y.NUM	; MASK FOR 0-9
  2002	402010'	265 11 0 00 000000*		JSP	TLINK,STRMC##	; FIND END
  2003	402011'	334 00 0 00 000000 		SKIPA			; NO BREAK CHAR
  2004
  2005	402012'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; SKIP PAST BLANKS
  2006	402013'	400 16 0 00 000000 		CLEAR	Q2,		; NO BREAK CHAR
  2007
  2008	402014'	200 06 0 00 000016 		MOVE	S1,Q2		; SAVE BREAK CHAR.
  2009
  2010	402015'	205 00 0 00 000002 		MOVX	Z,FMT.O		;[246] CONVERT TO ...
  2011	402016'	265 11 0 00 402322'		JSP	TLINK,CVTDW	; OCTAL
  2012	402017'	254 00 0 00 403406'		JRST	STBOMB		; ERROR RETURN
  2013
  2014	402020'	200 16 0 00 000006 		MOVE	Q2,S1		; RESTORE Q2
  2015	402021'	322 16 1 00 402004*		JUMPE	Q2,@GETOSV	; QUICK RETURN IF NO BRK
  2016
  2017	402022'	370 00 0 00 400664*		SOS	CURSOR##	; BUMP PAST ...
  2018	402023'	133 00 0 00 400665*		IBP	STPTR##		; BREAK CHAR.
  2019
  2020	402024'	254 00 1 00 402021*		JRST	@GETOSV		; AND RETURN
  2021
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 48
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- IOASSN

  2022						SUBTTL	Secondary routines -- IOASSN
  2023
  2024					;	IOASSN - ASSOCIATES AN IO DESCRIPTOR WITH A NAME.
  2025					;	AN ASSOCIATION BLOK IS ALLOCATED (EITHER IABLOK
  2026					;	OR OABLOK) WHICH CONTAINS THE ORIGINAL VALUE 
  2027					;	PLUS THE IO DESCRIPTOR.
  2028					;
  2029					; CALLING SEQUENCE:
  2030					;	LOAD Z WITH [BLOK TYPE,,TV ADDRESS]
  2031					;	PUSH NAME DESCRIPTOR 
  2032					;	PUSH IO DESCRIPTOR
  2033					;	JSP	SLINK,IOASSN
  2034					;	RETURN		; BOTH DESCRIPTORS CLEARED
  2035					;			; NOTHING RETURNED
  2036					;	IF Z IS NEG. THEN PREVIOUS ASSOCIATIONS ARE NOT REMOVED
  2037
  2038	402025'	202 00 0 00 000000#	IOASSN:	MOVEM	Z,IGNOS+1	; SAVE ARGUMENT
  2039
  2040	402026'	337 00 0 00 000000 		SKIPG	Z		; IF ARG IS ...
  2041	402027'	210 00 0 00 000000 		MOVN	Z,Z		; NEGATIVE
  2042	402030'	202 00 0 00 401757*		MOVEM	Z,IGNOS		; POSIFY IT
  2043
  2044						 ; ALLOCATE AN ASSOCIATION BLOK
  2045
  2046	402031'	541 00 0 00 000006 		HRRI	Z,ALENG		; LENGTH
  2047	402032'	265 15 0 00 000000*		JSP	QLINK,BLOK##	; ALLOCATE A BLOK
  2048	402033'	001 17 0 00 000000 		ERROR	15		; CAN'T FAIL
  2049
  2050	402034'	262 01 0 00 000000#		POP	STACK,FLAS##+1	; SAVE ASSOCIATION ...
  2051	402035'	262 01 0 00 000000*		POP	STACK,FLAS##	; BLOK
  2052
  2053						 ; INSERT GIVEN IO DESCRIPTOR
  2054
  2055	402036'	200 10 0 00 402035*		MOVE	S3,FLAS		; GET ADDRESS OF BLOK
  2056	402037'	262 01 0 10 000005 		POP	STACK,AFILE+1(S3) ; POP 2ND ...
  2057	402040'	262 01 0 10 000004 		POP	STACK,AFILE(S3)	; ARGUMENT
  2058
  2059						 ; FIND ADDRESS OF NAME GIVEN BY FIRST ARG
  2060
  2061	402041'	265 11 0 00 401237*		JSP	TLINK,CVTNAM##	; CONVERT TO NAME
  2062	402042'	003 01 0 00 000105 		ERROR.	1,69		; BAD FIRST ARGUMENT
  2063
  2064	402043'	331 00 0 00 000000#		SKIPL	IGNOS+1		; SKIP IF Z WAS NEG.
  2065	402044'	265 11 0 00 402417'		JSP	TLINK,DTCH	; REMOVE PREVIOUS ASSNS
  2066
  2067	402045'	262 01 0 00 000015 		POP	STACK,Q1	; OFFSET
  2068	402046'	262 01 0 00 000016 		POP	STACK,Q2	; + BLOK HEAD
  2069	402047'	270 15 0 00 000016 		ADD	Q1,Q2		; = ADDRESS
  2070
  2071					IFN FTPAV,<
  2072
  2073						; FIND CORRECT POSITION IN TRAP CHAIN
  2074
  2075	402050'	200 12 0 00 000015 		MOVE	T2,Q1		;POINT TO HEAD OF CHAIN
  2076	402051'	554 00 0 00 402030*		HLRZ	Z,IGNOS		;GET BLOCK TYPE (IABLOCK OR OABLOK)
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 48-1
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- IOASSN

  2077	402052'	306 00 0 00 000426 		CAIN	Z,IABLOK	;INPUT ?
  2078	402053'	201 13 0 00 000310 		 MOVEI	T3,IALVL	;YES - GET DEFAULT LEVEL
  2079	402054'	306 00 0 00 000427 		CAIN	Z,OABLOK	;OUTPUT ?
  2080	402055'	201 13 0 00 000454 		 MOVEI	T3,OALVL	;YES - GET DEFAULT LEVEL
  2081	402056'	265 11 0 00 000000*		JSP	TLINK,FNDPOS##	;FIND THE CORRECT SPOT
  2082	402057'	200 15 0 00 000012 		MOVE	Q1,T2		;MOVE POINTER TO GOOD SPOT INTO Q1
  2083
  2084					>;END OF IFN FTPAV
  2085
  2086						 ; EXCHANGE VALUE IN NAME WITH TVAR
  2087
  2088	402060'	200 00 0 00 402036*		MOVE	Z,FLAS		; ADDRESS OF ASSOCIATION BLOK
  2089	402061'	505 00 0 00 034000 		HRLI	Z,TVAR		; TRAPPED VARIABLE DATATYPE
  2090	402062'	250 00 0 15 000000 		EXCH	Z,0(Q1)		; SWITCH THIS WITH FIRST VALUE WORD
  2091	402063'	202 00 0 10 000002 		MOVEM	Z,AVAL(S3)	; OLD VALUE TO ASSN BLOK
  2092
  2093	402064'	550 00 0 00 402051*		HRRZ	Z,IGNOS		; TVAR ADDRESS
  2094	402065'	250 00 0 15 000001 		EXCH	Z,1(Q1)		; INTO TVAR DESCR
  2095	402066'	202 00 0 10 000003 		MOVEM	Z,AVAL+1(S3)	; OLD 2ND WORD TO ASSN BLOK
  2096
  2097	402067'	254 00 0 06 000000 		JRST	0(SLINK)	; RETURN
  2098
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 49
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- NONBLK

  2099						SUBTTL	Secondary routines -- NONBLK
  2100
  2101					;	NONBLK - STREAM FOR A NONBLANK
  2102					;
  2103					; CALLING SEQUENCE:
  2104					;	JSP	SLINK,NONBLK
  2105					;	RUNNOUT
  2106					;	NORMAL
  2107
  2108	402070'	205 10 0 00 600000 	NONBLK:	MOVX	S3,Y.BL!Y.TAB
  2109	402071'	265 11 0 00 000000*		JSP	TLINK,STR.C##
  2110	402072'	254 00 0 06 000000 		JRST	0(SLINK)
  2111	402073'	254 00 0 06 000001 		JRST	1(SLINK)
  2112
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 50
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- STFILS

  2113						SUBTTL	Secondary routines -- STFILS
  2114
  2115					;	STFILS - A ROUTINE TO PROCESS A SEQUENCE OF 
  2116					;	INPUT FILES. THESE ARE COMBINED INTO A STREAM BLOK.
  2117					;
  2118					; CALLING SEQUENCE:
  2119					;	STINIT HAS PREVIOUSLY BEEN CALLED
  2120					;	SET IGNOS WITH FLAG (FILE CHECK)
  2121					;	JSP	SLINK,STFILS
  2122					;	BAD SYNTAX, STACK UNCHANGED
  2123					;	FILE NOT FOUND (STREAM RETURNED ANYWAY)
  2124					;	NORMAL
  2125
  2126						 ; ENTRY POINT - PUSH IOBLOK POINTERS ONTO STACK
  2127
  2128	402074'	201 07 0 00 000001 	STFILS:	MOVEI	S2,1		; USED TO COUNT DESCRIPTORS
  2129	402075'	202 01 0 00 000000#		MOVEM	STACK,IGNOS+2	; SAVE STACK
  2130	402076'	402 00 0 00 000000#		CLEARM	IGNOS+3		; FLAG TO INDICATE ERROR
  2131
  2132	402077'	265 11 0 00 403037'	STFLS1:	JSP	TLINK,STRIO	; STREAM FOR IO DESCRIPTOR
  2133	402100'	254 00 0 00 402167'		JRST	STFL99		; BAD FILE SPEC
  2134
  2135	402101'	200 10 0 00 000000 		MOVE	S3,Z		; SAVE BREAK CHAR
  2136	402102'	336 00 0 00 402064*		SKIPN	IGNOS		; TEST FILES?
  2137	402103'	254 00 0 00 402106'		JRST	STFLS9		; NO
  2138	402104'	265 11 0 00 402440'		JSP	TLINK,FILECH	; CHECK THE FILE
  2139	402105'	476 00 0 00 000000#		SETOM	IGNOS+3		; BAD FILE FLAG
  2140
  2141	402106'	200 17 0 00 401137*	STFLS9:	MOVE	Q3,TTYBLK	; DEFAULT FILE
  2142	402107'	336 00 0 01 777777 		SKIPN	-1(STACK)	; IS
  2143	402110'	202 17 0 01 777777 		MOVEM	Q3,-1(STACK)	; TTY
  2144
  2145	402111'	322 10 0 00 402113'		JUMPE	S3,STFLS2	; NO MORE FILES
  2146	402112'	344 07 0 00 402077'		AOJA	S2,STFLS1	; INCREMENT & LOOP
  2147
  2148						 ; HERE WHEN STREAMING IS DONE
  2149
  2150	402113'	336 00 0 00 000000#	STFLS2:	SKIPN	IGNOS+3		; ANY BAD FILES?
  2151	402114'	271 06 0 00 000001 		ADDI	SLINK,1		; YES, SKIP INCREMENT
  2152
  2153	402115'	201 00 0 07 000004 		MOVEI	Z,STIOBL(S2)	; LENGTH OF REQUIRED STBLOK
  2154	402116'	265 15 0 00 000000*		JSP	QLINK,GCOLG##	; ENSURE SPACE
  2155	402117'	200 11 0 00 401104*		MOVE	T1,GSURF##	; POINT TO STBLOK BEING FORMED
  2156
  2157	402120'	505 00 0 00 000432 		HRLI	Z,STBLOK	; INSERT TYPE OF BLOK
  2158	402121'	202 00 0 11 000000 		MOVEM	Z,BTCODE&BLENG(T1)	; STUFF INTO BLOK HEADER
  2159	402122'	402 00 0 11 000001 		CLEARM	GCFLD(T1)	; SATISFY GC
  2160
  2161	402123'	201 12 0 00 000004 		MOVEI	T2,STIOBL	; OFFSET TO FIRST IOBLOK
  2162	402124'	202 12 0 11 000003 		MOVEM	T2,STCF(T1)	; MAKE CURRENT FILE
  2163	402125'	201 12 0 11 000003 		MOVEI	T2,STIOBL-1(T1)	; COMPUTE ADDRESS OF ...
  2164	402126'	271 12 0 07 000000 		ADDI	T2,0(S2)	; LAST IOBLOK
  2165	402127'	201 10 0 07 000000 		MOVEI	S3,0(S2)	; LOAD COUNT
  2166
  2167	402130'	262 01 0 00 000000 	STFLS3:	POP	STACK,Z		; JUNK WORD
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 50-1
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- STFILS

  2168	402131'	262 01 0 12 000000 		POP	STACK,0(T2)	; POP FILE WORD
  2169	402132'	275 12 0 00 000001 		SUBI	T2,1		; DECREMENT FOR NEXT
  2170	402133'	367 10 0 00 402130'		SOJG	S3,STFLS3	; COUNT DOWN ON S3
  2171
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 51
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- STFILS

  2172
  2173
  2174						 ; COMPARE WITH PREVIOUS STBLOKS 
  2175						 ; T1 POINTS TO NEWLY FORMED STBLOK
  2176
  2177	402134'	334 12 0 00 000000*		SKIPA	T2,STBLKS##	; LOAD HEAD OF LIST
  2178
  2179	402135'	200 12 0 12 000002 	STFLS4:	MOVE	T2,STNXT(T2)	; TRY NEXT STBLOK
  2180	402136'	322 12 0 00 402156'		JUMPE	T2,STFLS6	; END-OF-LINE
  2181
  2182	402137'	200 00 0 11 000000 		MOVE	Z,BLENG(T1)	; LOAD LENGTH WORD
  2183	402140'	312 00 0 12 000000 		CAME	Z,BLENG(T2)	; COMARE LENGTH WORDS
  2184	402141'	254 00 0 00 402135'		JRST	STFLS4		; LOOP BACK FOR MORE
  2185
  2186	402142'	201 10 0 07 000000 		MOVEI	S3,0(S2)	; LOAD COUNT AGAIN
  2187	402143'	201 15 0 11 000004 		MOVEI	Q1,STIOBL(T1)	; FIRST IOBLOK OF NEW
  2188	402144'	201 16 0 12 000004 		MOVEI	Q2,STIOBL(T2)	; FIRST IOBLOK OF OLD
  2189
  2190						 ; LOOP TO COMPARE STBLOK'S
  2191
  2192	402145'	200 00 0 15 000000 	STFLS5:	MOVE	Z,0(Q1)		; COMPARE ...
  2193	402146'	312 00 0 16 000000 		CAME	Z,0(Q2)		; IOBLOK'S
  2194	402147'	254 00 0 00 402135'		JRST	STFLS4		; DIFFERENT - NEXT STBLOK
  2195
  2196	402150'	340 15 0 00 000000 		AOJ	Q1,		; BUMP IOBLOK ...
  2197	402151'	340 16 0 00 000000 		AOJ	Q2,		; POINTERS ...
  2198	402152'	367 10 0 00 402145'		SOJG	S3,STFLS5	; AND LOOP
  2199
  2200	402153'	261 01 0 00 000012 		PUSH	STACK,T2	; RETURN ...
  2201	402154'	261 01 0 00 404004'		PUSH	STACK,[0]	; FOUND STBLOK ...
  2202	402155'	254 00 0 06 000001 		JRST	1(SLINK)	; NORMALLY
  2203
  2204						 ; NO MATCH WAS FOUND, LINK NEW STBLOK INTO LIST
  2205
  2206	402156'	550 00 0 11 000000 	STFLS6:	HRRZ	Z,BLENG(T1)	; LENGTH OF STBLOK
  2207	402157'	272 00 0 00 402117*		ADDM	Z,GSURF##	; MAKE IT OFFICIAL
  2208
  2209	402160'	505 11 0 00 004015 		HRLI	T1,IODT		; THIS DATATYPE IS OK
  2210	402161'	261 01 0 00 000011 		PUSH	STACK,T1	; RETURN THE ...
  2211	402162'	261 01 0 00 404004'		PUSH	STACK,[0]	; DESCRIPTOR
  2212
  2213	402163'	200 12 0 00 402134*		MOVE	T2,STBLKS	; LOAD FIRST STBLOK
  2214	402164'	202 12 0 11 000002 		MOVEM	T2,STNXT(T1)	; INSERT AS OUR NEXT
  2215	402165'	202 11 0 00 402163*		MOVEM	T1,STBLKS	; MAKE OURS THE FIRST
  2216
  2217	402166'	254 00 0 06 000001 		JRST	1(SLINK)
  2218
  2219						 ; ERROR - BAD SPECIFICATION
  2220
  2221	402167'	200 01 0 00 000000#	STFL99:	MOVE	STACK,IGNOS+2	; RETRIEVE STACK
  2222	402170'	254 00 0 06 000000 		JRST	0(SLINK)	; GIVE ERROR RETURN
  2223
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 52
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- TVIN & TVOUT

  2224						SUBTTL	Secondary routines -- TVIN & TVOUT
  2225
  2226					;	TVIN AND TVOUT - ARE THE S TYPE ROUTINES 
  2227					;	USED TO IMPLEMENT THE TRAPPED VARIABLES ASSOCIATED 
  2228					;	WITH INPUT AND OUTPUT RESPECTIVELY.
  2229
  2230	402171'	254 00 0 00 402177'	TVIN:	JRST	TVREAD		; VALUE
  2231	402172'	254 00 0 00 402231'		JRST	TVNAME		; NAME
  2232	402173'	254 00 0 00 402240'		JRST	TVASGN		; ASSIGNMENT
  2233
  2234	402174'	254 00 0 00 402254'	TVOUT:	JRST	TVFTCH		; VALUE
  2235	402175'	254 00 0 00 402231'		JRST	TVNAME		; NAME
  2236	402176'	254 00 0 00 402263'		JRST	TVWRIT		; ASSIGNMENT
  2237
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 53
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- TVIN & TVOUT

  2238
  2239					;	TVREAD - TRAPPED VARIABLE ON TOP OF STACK -
  2240					;	TO BE REPLACED BY READ-IN VALUE
  2241
  2242	402177'	200 07 0 01 777777 	TVREAD:	MOVE	S2,-1(STACK)	; ADDRESS OF ASSN BLOK
  2243
  2244	402200'	200 13 0 07 000005 		DMOVE	T2,AFILE(S2)	; LOAD FILE WORD
  2245	402201'	200 12 0 07 000004 
  2246									; FORMAT WORD
  2247	402202'	200 10 0 00 000013 		MOVE	S3,T3		; SAVE FORMAT WORD
  2248	402203'	265 11 0 00 402466'		JSP	TLINK,READ	; DO THE READ
  2249	402204'	001 14 0 00 000004 		ERROR	12,4		; INCORRECTIBLE READ
  2250	402205'	254 00 0 06 000000 		JRST	0(SLINK)	; EOF - TAKE FAIL
  2251
  2252	402206'	350 00 0 00 000000*		AOS	NINS##		; INCREMENT READ COUNT
  2253
  2254	402207'	607 10 0 00 001000 		TXNN	S3,FMT.WM	;[246] DID WE READ IN WORD MODE?
  2255	402210'	254 00 0 00 402216'		JRST	TVRD1		; NO - TAKE BRANCH
  2256
  2257	402211'	200 12 0 00 000000 		MOVE	T2,Z		; MOVE WORD FOR CONVERSION
  2258	402212'	200 00 0 00 000010 		MOVE	Z,S3		; FORMAT
  2259	402213'	265 11 0 00 402377'		JSP	TLINK,CVTWD	; CONVERT WORD TO DATA
  2260	402214'	001 17 0 00 000000 		ERROR	15		; CAN'T FAIL
  2261	402215'	254 00 0 00 402220'		JRST	TVRD2		; JUMP OFF TO INSERT VALUE
  2262
  2263						 ; HERE IF READ WAS UNDER ASCII MODE
  2264
  2265	402216'	332 00 0 00 000000*	TVRD1:	SKIPE	$TRIM##		; WAS &TRIM SET?
  2266	402217'	265 11 0 00 000000*		JSP	TLINK,TRIMT##	; YES - DO IT
  2267
  2268						 ; HERE TO PLACE VALUE IN VALUE FIELD
  2269
  2270	402220'	200 07 0 01 777775 	TVRD2:	MOVE	S2,-3(STACK)	; POINT TO ASSN BLOK
  2271	402221'	201 16 0 07 000002 		MOVEI	Q2,AVAL(S2)	; POINT TO VALUE FIELD
  2272	402222'	265 15 0 00 000000*		JSP	QLINK,LOCVAL##	; POINT TO REAL VALUE FIELD
  2273	402223'	262 01 0 16 000001 		POP	STACK,1(Q2)	; POP VALUE ...
  2274	402224'	262 01 0 16 000000 		POP	STACK,0(Q2)	; INTO THIS FIELD
  2275
  2276	402225'	274 01 0 00 402000*		SUB	STACK,XWD22##	; POP TRAPPED VARIABLE
  2277	402226'	261 01 0 16 000000 		PUSH	STACK,0(Q2)	; PLACE VALUE ...
  2278	402227'	261 01 0 16 000001 		PUSH	STACK,1(Q2)	; BACK INTO STACK
  2279	402230'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN
  2280
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 54
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- TVIN & TVOUT

  2281
  2282	402231'	200 07 0 01 777777 	TVNAME:	MOVE	S2,-1(STACK)	; GET ADDRESS OF ASSN BLOK
  2283	402232'	274 01 0 00 402225*		SUB	STACK,XWD22##	; POP DESCRIPTOR
  2284
  2285	402233'	505 07 0 00 004011 		HRLI	S2,NDT		; INSERT DATATYPE
  2286	402234'	261 01 0 00 000007 		PUSH	STACK,S2	; THIS IS FIRST WORD
  2287	402235'	201 10 0 00 000002 		MOVEI	S3,AVAL		; THIS IS OFFSET
  2288	402236'	261 01 0 00 000010 		PUSH	STACK,S3	; PUSH IT
  2289
  2290	402237'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN
  2291
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 55
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- TVIN & TVOUT

  2292
  2293	402240'	262 01 0 00 000010 	TVASGN:	POP	STACK,S3	; POP ...
  2294	402241'	262 01 0 00 000007 		POP	STACK,S2	; VALUE
  2295
  2296	402242'	200 00 0 01 777777 		MOVE	Z,-1(STACK)	; ADDRESS OF ASSN BLOK
  2297	402243'	505 00 0 00 064000 		HRLI	Z,VAR		; MAKE IT A VARIABLE
  2298	402244'	261 01 0 00 000000 		PUSH	STACK,Z		; PUSH VARIABLE ...
  2299	402245'	261 01 0 00 404015'		PUSH	STACK,[AVAL]	; ONTO STACK
  2300
  2301	402246'	261 01 0 00 000007 		PUSH	STACK,S2	; PUSH VALUE ...
  2302	402247'	261 01 0 00 000010 		PUSH	STACK,S3	; BACK ON
  2303
  2304	402250'	265 11 0 00 000000*		JSP	TLINK,ASGNVL##	; DO THE ASSIGNMENT
  2305	402251'	254 00 0 06 000000 		JRST	0(SLINK)	; PASS ANY ERRORS BACK
  2306
  2307	402252'	274 01 0 00 402232*		SUB	STACK,XWD22##	; GET RID OF VARIABLE
  2308
  2309	402253'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN
  2310
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 56
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- TVIN & TVOUT

  2311
  2312	402254'	200 07 0 01 777777 	TVFTCH:	MOVE	S2,-1(STACK)	; GET ADDRESS	OF BLOK
  2313	402255'	274 01 0 00 402252*		SUB	STACK,XWD22##	; REMOVE DESCRIPTOR
  2314
  2315	402256'	261 01 0 07 000002 		PUSH	STACK,AVAL(S2)	; PUSH CURRENT
  2316	402257'	261 01 0 07 000003 		PUSH	STACK,AVAL+1(S2) ; VAL
  2317
  2318	402260'	265 11 0 00 000000*		JSP	TLINK,CVTVAL##	; MAKE IT A VALUE
  2319	402261'	254 00 0 06 000000 		JRST	0(SLINK)	; PASS SUCCESS BACK
  2320	402262'	254 00 0 06 000001 		JRST	1(SLINK)	; AND RETURN SUCCESS
  2321
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 57
SNOFIO	MAC	15-Mar-69 11:20		Secondary routines -- TVIN & TVOUT

  2322
  2323	402263'	336 00 0 00 000000*	TVWRIT:	SKIPN	$OUTPT##	; CHECK &OUTPUT
  2324	402264'	254 00 0 00 402240'		JRST	TVASGN		; OFF - JUST ASSIGN
  2325
  2326	402265'	261 01 0 01 777777 		PUSH	STACK,-1(STACK)	; DUPLICATE OBJECT...
  2327	402266'	261 01 0 01 777777 		PUSH	STACK,-1(STACK)	; FOR ULTIMATE ASSIGNMENT
  2328
  2329	402267'	200 07 0 01 777773 		MOVE	S2,-5(STACK)	; ASSN BLOK PTR
  2330	402270'	200 10 0 07 000005 		MOVE	S3,AFILE+1(S2)	; FORMAT WORD
  2331	402271'	607 10 0 00 000010 		TXNN	S3,FMT.D	;[246] DIRECT?
  2332	402272'	254 00 0 00 402300'		JRST	TVWRT1		; NO -
  2333
  2334	402273'	265 11 0 00 000000*		JSP	TLINK,CVTNUM##	; ENSURE NUMERIC
  2335	402274'	003 01 0 00 000155 		ERROR.	1,109		; BAD VALUE
  2336	402275'	262 01 0 00 000000 		POP	STACK,Z		; BITS TO BE TRANSMITTED
  2337	402276'	262 01 0 01 000000 		POP	STACK,0(STACK)	; PRUNE STACK
  2338	402277'	254 00 0 00 402307'		JRST	TVWRT2		; JUMP TO WRITE
  2339
  2340						 ; HERE FOR NON DIRECT WRITING
  2341
  2342	402300'	265 11 0 00 401760*	TVWRT1:	JSP	TLINK,CVTSTR##	; CONVERT TO STRING IF POSSIBLE
  2343	402301'	265 15 0 00 000000*		JSP	QLINK,DTNAME##	; NO - JUST USE NAME
  2344
  2345	402302'	607 10 0 00 001000 		TXNN	S3,FMT.WM	;[246] WORD MODE?
  2346	402303'	254 00 0 00 402307'		JRST	TVWRT2		; NO
  2347
  2348	402304'	200 00 0 00 000010 		MOVE	Z,S3		; LOAD FORMAT
  2349	402305'	265 11 0 00 402322'		JSP	TLINK,CVTDW	; CONVERT TO WORD
  2350	402306'	001 15 0 00 000100 		ERROR	13,64		; BAD VALUE
  2351
  2352						 ; HERE WITH ITEM READY TO BE OUTPUT
  2353
  2354	402307'	200 12 0 07 000004 	TVWRT2:	MOVE	T2,AFILE(S2)	; LOAD FILE WORD
  2355	402310'	200 13 0 00 000010 		MOVE	T3,S3		; LOAD FORMAT WORD
  2356	402311'	265 11 0 00 403411'		JSP	TLINK,WRITE	; WRITE IT OUT
  2357	402312'	001 14 0 00 000005 		ERROR	12,5		; INCORRECTIBLE
  2358
  2359	402313'	350 00 0 00 000000*		AOS	NOUTS##		; INCREMENT # OF WRITES
  2360	402314'	254 00 0 00 402240'		JRST	TVASGN		; DO AN ASSIGNMENT
  2361
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 58
SNOFIO	MAC	15-Mar-69 11:20		TYPE T (TERTIARY) I/O UTILITIES

  2362						SUBTTL	TYPE T (TERTIARY) I/O UTILITIES
  2363
  2364					;	CLSALL - CLOSE ALL I/O FILES
  2365
  2366					;	CVTDW - CONVERT FROM DATA TO WORD
  2367
  2368					;	CVTWD - CONVERT FROM WORD TO DATA
  2369
  2370					;	DTCH - DETACH ALL ASSOCIATIONS
  2371
  2372					;	FILECH - FILE CHECK
  2373
  2374					;	PEJECT - PAGE EJECT
  2375
  2376					;	READ
  2377
  2378					;	STRIO - STREAM FOR IO
  2379
  2380					;		MAKEIO - (ALTERNATE ENTRY FOR STRIO)
  2381
  2382					;	WRITE
  2383
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 59
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- CLSALL

  2384						SUBTTL	Tertiary routines -- CLSALL
  2385
  2386						 ; CLSALL WILL CLOSE ALL FILES
  2387						 ; CALLING SEQUENCE:
  2388						 ;	 JSP TLINK,CLSALL
  2389						 ;	 RETURN
  2390
  2391	402315'	550 14 0 00 401126*	CLSALL:: HRRZ	T4,IOBLKS	; PICK UP FIRST
  2392
  2393	402316'	322 14 0 11 000000 	CLSAL1:	JUMPE	T4,0(TLINK)	; TEST FOR DONE
  2394	402317'	265 15 0 00 403637'		JSP	QLINK,CLS	; CLOSE IT
  2395	402320'	550 14 0 14 000032 		HRRZ	T4,IONEXT(T4)	; GET NEXT
  2396	402321'	254 00 0 00 402316'		JRST	CLSAL1		; LOOP BACK
  2397
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 60
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- CVTDW

  2398						SUBTTL	Tertiary routines -- CVTDW
  2399
  2400					;	CVTDW - CONVERT FROM DATA TO WORD.
  2401					;
  2402					; CALLING SEQUENCE -
  2403					;	PUSH DESCRIPTOR ONTO STACK
  2404					;	LOAD Z WITH FORMAT
  2405					;	JSP	TLINK,CVTDW
  2406					;	ALTERNATE RETURN - INPUT STRING TOO LONG
  2407					;	NORMAL RETURN - Z CONTAINS CONVERTED VALUE
  2408					;
  2409					;	ON THE ALTERNATE RETURN, Z WILL CONTAIN THE 
  2410					;	CONVERTED REPRESENTATION OF AN INITIAL SUBSTRING
  2411					;	OF THE INPUT STRING.	STACK IS POPPED IN EITHER CASE
  2412
  2413	402322'	202 11 0 00 000000*	CVTDW::	MOVEM	TLINK,CDWSV	; SAVE RETURN POINT
  2414
  2415	402323'	607 00 0 00 000010 		TXNN	Z,FMT.D		;[246] IS IT D FORMAT?
  2416	402324'	254 00 0 00 402333'		JRST	CVTDW1		; NO - BRANCH
  2417
  2418	402325'	265 11 0 00 402273*		JSP	TLINK,CVTNUM	; MAKE A NUMBER OUT OF IT
  2419	402326'	003 01 0 00 000151 		ERROR.	1,105		; FORMAT-DATATYPE INCOMPATABILITY
  2420
  2421	402327'	262 01 0 00 000000 		POP	STACK,Z		; THE REAL VALUE
  2422	402330'	262 01 0 00 000012 		POP	STACK,T2	; JUNK
  2423
  2424	402331'	200 11 0 00 402322*		MOVE	TLINK,CDWSV##	; RESTORE LINK
  2425	402332'	254 00 0 11 000001 		JRST	1(TLINK)	; NORMAL RETURN
  2426
  2427						 ; HERE ON ANYTHING BUT 'D' FORMAT
  2428
  2429	402333'	265 15 0 00 403746'	CVTDW1:	JSP	QLINK,WMPROP	; SET 'BT-WORDS' FROM FORMAT
  2430
  2431	402334'	265 11 0 00 402300*		JSP	TLINK,CVTSTR##	; ENSURE A STRING
  2432	402335'	003 01 0 00 000152 		ERROR.	1,106		; BAD DATATYPE
  2433	402336'	200 11 0 00 402331*		MOVE	TLINK,CDWSV	; RESTORE TLINK
  2434
  2435	402337'	550 14 0 01 000000 		HRRZ	T4,0(STACK)	; LOAD LENGTH
  2436
  2437	402340'	265 15 0 00 401675*		JSP	QLINK,CVTPTR##	; CONVERT TO ...
  2438	402341'	000000	000000			0			; POINTER
  2439	402342'	254 00 0 00 402374'		JRST	CVTDW9		; NULL STRING EXIT
  2440
  2441	402343'	403 16 0 00 000012 		SETZB	Q2,T2		; LENGTH RECORDED IN Q2,
  2442									;  RESULT ACCUMLULATED IN T2
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 61
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- CVTDW

  2443
  2444						 ; TOP OF LOOP - WORD IS FORMED IN T3
  2445
  2446	402344'	134 13 0 00 000000 	CVTDW2:	ILDB	T3,Z		; GET 7-BIT BYTE FROM STRING
  2447	402345'	274 13 0 00 000000*		SUB	T3,BTBASE	; SUBTACT OFF BASE
  2448
  2449	402346'	335 00 0 00 000013 		SKIPGE	T3		; TOO LOW?
  2450	402347'	001 15 0 00 000077 		ERROR	13,63		; YES
  2451
  2452	402350'	315 13 0 00 000000*		CAMGE	T3,BTMAX	; TOO HIGH?
  2453	402351'	254 00 0 00 402356'		JRST	CVTDW4		; NO - 0K
  2454
  2455	402352'	200 17 0 00 000000*		MOVE	Q3,BTSIZE	; MAYBE ...
  2456	402353'	302 17 0 00 000006 		CAIE	Q3,6		; SIXBIT?
  2457	402354'	001 15 0 00 000077 		ERROR	13,63		; NO
  2458	402355'	275 13 0 00 000040 		SUBI	T3,40		; YES, LOWER-UPPER CASE
  2459
  2460	402356'	136 13 0 00 000000*	CVTDW4:	IDPB	T3,BTPTR	; INSERT BYTE
  2461
  2462	402357'	340 16 0 00 000000 		AOJ	Q2,		; INCREMENT LENGTH
  2463	402360'	311 16 0 00 000014 		CAML	Q2,T4		; GO ON IF WE HAVE NOT EXHAUSTED STR.
  2464	402361'	254 00 0 00 402366'		JRST	CVTDW3		; BRANCH IF DONE
  2465	402362'	315 16 0 00 000000*		CAMGE	Q2,BTLENG	; SKIP IF WE HAVE FILLED A WORD
  2466	402363'	254 00 0 00 402344'		JRST	CVTDW2		; OTHERWISE LOOP
  2467	402364'	200 00 0 00 000012 		MOVE	Z,T2		; VALUE TO RETURN REGISTER
  2468	402365'	254 00 0 11 000000 		JRST	0(TLINK)	; ALTERNATE RETURN
  2469
  2470						 ; INPUT STRING EXHAUSTED
  2471
  2472	402366'	200 00 0 00 000012 	CVTDW3:	MOVE	Z,T2		; MOVE VALUE TO RETURN REG.
  2473
  2474	402367'	332 00 0 00 000000*		SKIPE	BTLJFL		; TEST LEFT-JUSTIFY FLAG
  2475	402370'	254 00 0 11 000001 		JRST	1(TLINK)	; ON - JUST RETURN
  2476
  2477	402371'	220 16 0 00 402352*		IMUL	Q2,BTSIZE	; GET LENGTH OF INFO IN BITS
  2478	402372'	241 00 0 16 000000 		ROT	Z,0(Q2)		; SHIFT INFO INTO LOW ORDER
  2479
  2480	402373'	254 00 0 11 000001 		JRST	1(TLINK)	; NORMAL RETURN
  2481
  2482						 ; HERE ON NULL STRINGS
  2483
  2484	402374'	274 01 0 00 402255*	CVTDW9:	SUB	STACK,XWD22##	; POP STACK
  2485	402375'	400 00 0 00 000000 		CLEAR	Z,		; HE WANTS A 0
  2486	402376'	254 00 0 11 000001 		JRST	1(TLINK)	; NORMAL RETURN
  2487
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 62
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- CVTWD

  2488						SUBTTL	Tertiary routines -- CVTWD
  2489
  2490					;	CVTWD - CONVERT WORD TO DATA (UNDER FORMAT CONTROL).
  2491					;
  2492					; CALLING SEQUENCE:
  2493					;	LOAD Z WITH FORMAT
  2494					;	LOAD T2 WITH WORD
  2495					;	JSP	TLINK,CVTWD
  2496					;	FAIL - SPARE EXIT NOT CURRENTLY TAKEN
  2497					;	SUCCESS - DESCRIPTOR RETURNED ON STSACK
  2498
  2499	402377'	607 00 0 00 000010 	CVTWD::	TXNN	Z,FMT.D		;[246] 'D' FORMAT?
  2500	402400'	254 00 0 00 402404'		JRST	CVTWD1		; NO
  2501
  2502	402401'	261 01 0 00 404016'		PUSH	STACK,[IDT,,0]	; EASY CASE -
  2503	402402'	261 01 0 00 000012 		PUSH	STACK,T2	; MAKE INTEGER ...
  2504	402403'	254 00 0 11 000001 		JRST	1(TLINK)	; OUT OF IT
  2505
  2506						 ; HERE IF NOT 'D' FOMRAT
  2507
  2508	402404'	265 15 0 00 403746'	CVTWD1:	JSP	QLINK,WMPROP	; WORD-MODE PROPERTIES
  2509
  2510	402405'	200 00 0 00 402362*		MOVE	Z,BTLENG	; ALLOCATE STRING ...
  2511	402406'	265 15 0 00 401533*		JSP	QLINK,ASBLOK##	; OF APPROPRIATE LENGTH.
  2512	402407'	001 13 0 00 000015 		ERROR	11,13		; EXCEEDED &MAXLNGTH
  2513
  2514	402410'	200 14 0 00 402405*		MOVE	T4,BTLENG	; TRANSFER LENGTH ...
  2515	402411'	202 14 0 01 000000 		MOVEM	T4,0(STACK)	; INTO DESCR.
  2516
  2517	402412'	134 13 0 00 402356*	CVTWD2:	ILDB	T3,BTPTR	; EXTRACT BYTE FROM T2
  2518	402413'	270 13 0 00 402345*		ADD	T3,BTBASE	; ADD BYTE CORR. TO 0
  2519	402414'	136 13 0 00 000017 		IDPB	T3,Q3		; TOSS BYTE INTO STRING
  2520	402415'	367 14 0 00 402412'		SOJG	T4,CVTWD2	; LOOP ON T4
  2521
  2522	402416'	254 00 0 11 000001 		JRST	1(TLINK)	; RETURN
  2523
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 63
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- DTCH

  2524						SUBTTL	Tertiary routines -- DTCH
  2525
  2526					;	DTCH - A TYPE T ROUTINE TO DETACH ALL I/O
  2527					;	ASSOCIATIONS FOR A GIVEN VARIABLE
  2528					;
  2529					; CALLING SEQUENCE:
  2530					;	PUSH NAME OF VARIABLE ONTO STACK
  2531					;	JSP 	TLINK,DTCH
  2532					;	RETURN	(STACK UNPOPPED)
  2533
  2534	402417'	200 12 0 01 777777 	DTCH:	MOVE	T2,-1(STACK)	; GET ADDRESS ...
  2535	402420'	270 12 0 01 000000 		ADD	T2,0(STACK)	; OF VALUE DESCRIPTOR
  2536
  2537						 ; HERE AFTER DESCRIPTOR HAS BEEN REPLACED
  2538
  2539	402421'	554 14 0 12 000000 	DTCH2:	HLRZ	T4,0(T2)	; LOAD DATATYPE
  2540	402422'	302 14 0 00 034000 		CAIE	T4,TVAR		; IS IT TRAPPED
  2541	402423'	254 00 0 11 000000 		JRST	0(TLINK)	; NO - RETURN
  2542
  2543	402424'	200 14 0 12 000000 		MOVE	T4,0(T2)	; LOAD BLOK ...
  2544	402425'	554 15 0 14 000000 		HLRZ	Q1,BTCODE(T4)	; TYPE AND TEST ...
  2545	402426'	302 15 0 00 000426 		CAIE	Q1,IABLOK	; INPUT OR ...
  2546	402427'	306 15 0 00 000427 		CAIN	Q1,OABLOK	; OUTPUT
  2547	402430'	254 00 0 00 402433'		JRST	DTCH1		; YES
  2548
  2549						 ; NOT IO TRAP, MUST BE TRACE
  2550
  2551	402431'	201 12 0 14 000002 		MOVEI	T2,LHDR(T4)	; POINT TO NEW VALUE
  2552	402432'	254 00 0 00 402421'		JRST	DTCH2		; LOOP BACK
  2553
  2554						 ; HERE TO REMOVE ASSOCIATION
  2555
  2556	402433'	261 01 0 14 000002 	DTCH1:	PUSH	STACK,AVAL(T4)	; TRANSFER VALUE
  2557	402434'	261 01 0 14 000003 		PUSH	STACK,AVAL+1(T4)	; FROM ASSN BLOK
  2558	402435'	262 01 0 12 000001 		POP	STACK,1(T2)	; BACK INTO
  2559	402436'	262 01 0 12 000000 		POP	STACK,0(T2)	; THE VARIABLE
  2560	402437'	254 00 0 00 402421'		JRST	DTCH2		; AND LOOP
  2561
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 64
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- FILECH

  2562						SUBTTL	Tertiary routines -- FILECH
  2563
  2564					;	FILECH - CHECKS FOR THE EXISTENCE OF AN INPUT 
  2565					;	FILE.  IT THE EXT IS NULL AND THE FILE DOES NOT
  2566					;	EXIST, IT TRIES AN EXTENSION OF SNO.
  2567					;	IF THE FILE IS 0 THEN TTY IS SUPPLIED.
  2568					;	THESE THINGS ARE VALID ONLY DURING COMMAND STRING
  2569					;	EVALUATION
  2570					;
  2571					;	CALLING SEQUENCE:
  2572					;	PUSH IO DESCR. ONTO STACK
  2573					;	JSP	TLINK,FILECH
  2574					;	ERROR - FILE DOES NOT EXIST
  2575					;	NORMAL RETURN, STACK UNPOPPED
  2576
  2577	402440'	200 14 0 01 777777 	FILECH:	MOVE	T4,-1(STACK)	; LOAD IOBLOK
  2578	402441'	322 14 0 11 000001 		JUMPE	T4,1(TLINK)	; RETURN IF FILE IS NULL
  2579
  2580	402442'	332 00 0 14 000031 		SKIPE	IOFLGS(T4)	; CHECK IF BUFFERS EXIST
  2581	402443'	254 00 0 11 000001 		JRST	1(TLINK)	; YES - RETURN
  2582
  2583	402444'	200 00 0 01 000000 		MOVE	Z,0(STACK)	; COMPUTE ...
  2584	402445'	265 15 0 00 403701'		JSP	QLINK,MODE	; MODE
  2585
  2586	402446'	265 15 0 00 403711'		JSP	QLINK,OPN	; OPEN THE FILE
  2587	402447'	001 14 0 00 000027 		ERROR	12,23		; CAN'T OPEN
  2588
  2589	402450'	265 15 0 00 403661'	FILCH2:	JSP	QLINK,LKP	; LOOK THE FILE UP
  2590	402451'	254 00 0 00 402454'		JRST	FILCH1		; COULDN'T FIND FILE
  2591
  2592	402452'	265 15 0 00 403637'	FILCH4:	JSP	QLINK,CLS	; MIGHT AS WELL CLOSE IT
  2593
  2594	402453'	254 00 0 11 000001 		JRST	1(TLINK)	; AND RETURN
  2595
  2596						 ; HERE IF WE COULDN'T LOCATE THE FILE AS GIVEN
  2597
  2598	402454'	336 00 0 14 000006 	FILCH1:	SKIPN	IOEXT(T4)	; NULL EXTENSION
  2599	402455'	332 00 0 00 400674*		SKIPE	COMPIN##	; TRY DEFAULT ONLY IF COMPIN IS 0
  2600	402456'	364 11 0 00 402452'		SOJA	TLINK,FILCH4	; GO BACK AND FAIL
  2601
  2602	402457'	205 15 0 00 635657 		MOVSI	Q1,D$EXT	;[264] TRY USING THE DEFAULT EXTENSION
  2603	402460'	202 15 0 14 000006 		MOVEM	Q1,IOEXT(T4)	; PLACE THIS IN IOBLOK
  2604
  2605	402461'	254 00 0 00 402450'		JRST	FILCH2		; TRY AGAIN
  2606	
  2607
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 65
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- PEJECT

  2608						SUBTTL	Tertiary routines -- PEJECT
  2609
  2610					;	PEJECT - GENERAL UTILITY TO EJECT A PAGE
  2611					;
  2612					; CALLING SEQUENCE:
  2613					;	LOAD T2 WITH FILE WRD
  2614					;	LOAD T3 WITH FORMAT WORD
  2615					;	JSP 	TLINK,PEJECT
  2616					;	ERROR
  2617					;	NORMAL - STACK UNCHANGED
  2618
  2619
  2620	402462'	205 13 0 00 000200 	PEJECT::MOVX	T3,FMT.C	;[246] SINGLE CHAR. FORMAT
  2621	402463'	261 01 0 00 000000*		PUSH	STACK,$ALPHA##	; SEND ...
  2622	402464'	261 01 0 00 404017'		PUSH	STACK,[.CHFFD,,1]	; FORM-FEED ...
  2623	402465'	254 00 0 00 403411'		JRST	WRITE		; TREAT LIKE A WRITE
  2624
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 66
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2625						SUBTTL	Tertiary routines -- READ
  2626
  2627					;	READ - READS A RECORD (OR A CHARACTER, OR A WORD)
  2628					;	FROM A STREAM ACCORDING TO A FORMAT.
  2629					;
  2630					; CALLING SEQUENCE:
  2631					;	LOAD T2 WITH POINTER TO STREAM
  2632					;	LOAD T3 WITH FORMAT
  2633					;	JSP	TLINK,READ
  2634					;	ERROR
  2635					;	END-OF-FILE
  2636					;	NORMAL
  2637					;
  2638					;	ON NORMAL RETURN EITHER A 36-BIT WORD IS RETURNED IN
  2639					;	Z (WORD MODE FORMAT) OR A STRING IS RETURNED ON THE STACK.
  2640					;	IN ASCII MODE (NON C FORMAT) Z IS SET WITH FLAGS
  2641					;	F.FLG IF A FORM FEED WAS ENCOUNTERED.
  2642					;	N.FLG IF THE LINE WAS SEQUENCE NUMBERED
  2643
  2644						 ; ENTRY POINT
  2645
  2646	402466'	321 13 0 11 000001 	READ::	JUMPL	T3,1(TLINK)	; END-OF-FILE FLAG
  2647	402467'	603 13 0 00 004000 		TXNE	T3,FMT.CP	;[246] CHARACTER-PREFIX FORMAT?
  2648	402470'	400 13 0 00 000000 		CLEAR	T3,		; YES - IGNORE FORMAT ON INPUT
  2649
  2650	402471'	200 14 0 12 000003 		MOVE	T4,STCF(T2)	; CURRENT FILE OFFSET
  2651	402472'	550 15 0 12 000000 		HRRZ	Q1,BLENG(T2)	; GET LENGTH OF BLOK
  2652	402473'	311 14 0 00 000015 		CAML	T4,Q1		; IS CURRENT FILE WITHIN BOUNDS?
  2653	402474'	254 00 0 11 000001 		JRST	1(TLINK)	; NO - END-OF-FILE
  2654
  2655	402475'	271 14 0 12 000000 		ADDI	T4,0(T2)	; POINT TO POINTER
  2656	402476'	200 14 0 14 000000 		MOVE	T4,0(T4)	; LOAD IOBLOK POINTER
  2657
  2658	402477'	316 14 0 00 402106*	READ1:	CAMN	T4,TTYBLK	; IS IT TTY?
  2659	402500'	254 00 0 00 402722'		JRST	RDTTY		; YES - TRANSFER BEYOND READ6
  2660
  2661	402501'	200 15 0 14 000031 		MOVE	Q1,IOFLGS(T4)	; GET FLAGS
  2662	402502'	603 15 0 00 400000 		TLNE	Q1,IOINFL	; ALREADY OPEN FOR INPUT?
  2663	402503'	254 00 0 00 402515'		JRST	READ2		; YES
  2664
  2665						 ; PREPARE FILE FOR READING
  2666
  2667	402504'	265 15 0 00 403637'	READ1A:	JSP	QLINK,CLS	; CLOSE FILE IN CASE
  2668
  2669	402505'	200 00 0 00 000013 		MOVE	Z,T3		; FORMAT WORD
  2670	402506'	265 15 0 00 403701'		JSP	QLINK,MODE	; MODE TO REG Z
  2671
  2672	402507'	265 15 0 00 403711'		JSP	QLINK,OPN	; OPEN THE FILE
  2673	402510'	001 14 0 00 000027 		ERROR	12,23		; COULDN'T OPEN
  2674
  2675	402511'	265 15 0 00 403661'		JSP	QLINK,LKP	; LOOK UP THE FILE
  2676	402512'	001 14 0 00 000036 		ERROR	12,30		; NOT FOUND
  2677
  2678	402513'	205 00 0 00 400000 		MOVSI	Z,IOINFL	; ALLOCATE
  2679	402514'	265 15 0 00 403557'		JSP	QLINK,ALBUF	; INPUT BUFFERS
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 67
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2680						 ; ASCERTAIN MODE-FORMAT COMPATABILITY
  2681
  2682	402515'	200 00 0 00 000013 	READ2:	MOVE	Z,T3		; CONVERT FORMAT ...
  2683	402516'	265 15 0 00 403701'		JSP	QLINK,MODE	; TO MODE
  2684
  2685	402517'	312 00 0 14 000002 		CAME	Z,IOMODE(T4)	; MODES INCOMPATIBLE?
  2686	402520'	001 14 0 00 000023 		ERROR	12,19		; YES - GIVE ERROR
  2687
  2688						 ; SAVE REGISTERS
  2689
  2690	402521'	202 11 0 00 000000*		MOVEM	T1,RDLINK	; SAVE
  2691	402522'	202 12 0 00 000000*		MOVEM	T2,RDSTBL	; REGS.
  2692	402523'	402 00 0 00 000000*		CLEARM	RDFLGS		; CLEAR FLAGS
  2693
  2694			000001			N.FLG==1
  2695			000002			F.FLG==2
  2696
  2697						 ; WORD MODE READING
  2698
  2699	402524'	607 13 0 00 001000 		TXNN	T3,FMT.WM	;[246] WORD MODE?
  2700	402525'	254 00 0 00 402532'		JRST	READ3		; NO
  2701
  2702	402526'	375 00 0 14 000024 		SOSGE	IOIBHD+2(T4)	; DECREMENT WORD COUNT
  2703	402527'	265 15 0 00 403017'		JSP	QLINK,FINBUF	; FILL BUFFER IF 0
  2704	402530'	134 00 0 14 000023 		ILDB	Z,IOIBHD+1(T4)	; EXTRACT WORD
  2705
  2706	402531'	254 00 0 11 000002 		JRST	2(TLINK)	; NORMAL RETURN
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 68
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2707						 ; 'C' FORMAT
  2708
  2709	402532'	607 13 0 00 000200 	READ3:	TXNN	T3,FMT.C	;[246] 'C' FORMAT?
  2710	402533'	254 00 0 00 402554'		JRST	READ4		; NO
  2711
  2712	402534'	550 16 0 14 000030 		HRRZ	Q2,IOLAST(T4)	; GET LAST CHAR
  2713	402535'	546 16 0 14 000030 		HLRM	Q2,IOLAST(T4)	; SET TO 0
  2714	402536'	254 00 0 00 402542'		JRST	READ3B		; ENTER WITHIN
  2715
  2716	402537'	375 00 0 14 000024 	READ3A:	SOSGE	IOIBHD+2(T4)	; DECREMENT CHAR. COUNT
  2717	402540'	265 15 0 00 403017'		JSP	QLINK,FINBUF	; FILL BUFFER ON 0 COUNT
  2718	402541'	134 16 0 14 000023 		ILDB	Q2,IOIBHD+1(T4)	; GET NEXT BYTE
  2719	402542'	322 16 0 00 402537'	READ3B:	JUMPE	Q2,READ3A	; REPEAT IF 0
  2720
  2721	402543'	302 16 0 00 000032 		CAIE	Q2,.CHCNZ	; ^Z ?
  2722	402544'	254 00 0 00 402547'		JRST	READ3C		; NO - GO AROUND
  2723	402545'	335 00 0 14 000030 		SKIPGE	IOTTY(T4)	; TTY?
  2724	402546'	254 00 0 00 403032'		JRST	FINBU1		; YES - EOF
  2725
  2726						 ;	HERE FROM TTY 'C' FORMAT
  2727
  2728	402547'	204 16 0 00 000016 	READ3C:	MOVS	Q2,Q2		; CHAR TO LEFT HALF
  2729	402550'	541 16 0 00 000001 		HRRI	Q2,1		; ONE TO RIGHT HALF
  2730	402551'	261 01 0 00 402463*		PUSH	STACK,$ALPHA	; FIRST DESCRIPTOR WORD
  2731	402552'	261 01 0 00 000016 		PUSH	STACK,Q2	; SECOND WORD
  2732	402553'	254 00 0 11 000002 		JRST	2(TLINK)
  2733
  2734						 ; ALLOCATE SBLOK
  2735
  2736	402554'	603 13 0 00 010000 	READ4:	TXNE	T3,FMT.AP	;[246] Is it Append Mode?
  2737	402555'	001 14 0 00 000047 		ERROR	12,39		; That wasn't very bright.
  2738
  2739	402556'	200 00 0 14 000024 		MOVE	Z,IOIBHD+2(T4)	; SIZE OF SBLOK
  2740	402557'	340 00 0 00 000000 		AOJ	Z,		; MAKE IT AT LEAST 1
  2741	402560'	200 11 0 00 000000 		MOVE	T1,Z		; SAVE THE VALUE
  2742
  2743	402561'	265 15 0 00 402406*		JSP	QLINK,ASBLOK	; ALLOCATE ONE
  2744	402562'	001 13 0 00 000003 		ERROR	11,3
  2745
  2746	402563'	202 11 0 01 000000 		MOVEM	T1,0(STACK)	; SET LENGTH
  2747	402564'	261 01 0 01 777777 		PUSH	STACK,-1(STACK)	; DUPLICATE ...
  2748	402565'	261 01 0 01 777777 		PUSH	STACK,-1(STACK)	; VALUE
  2749
  2750	402566'	265 15 0 00 402340*		JSP	QLINK,CVTPTR	; GET POINTER
  2751	402567'	000000	000017			Q3			; BASE ON Q3
  2752	402570'	001 17 0 00 000000 		ERROR	15		; CAN'T FAIL
  2753
  2754	402571'	202 00 0 00 000000*		MOVEM	Z,DEPTR##		; SAVE POINTER
  2755	402572'	400 12 0 00 000000 		CLEAR	T2,		; DEPOSITION-CHAR COUNT
  2756
  2757	402573'	550 16 0 14 000030 		HRRZ	Q2,IOLAST(T4)	; LOAD LAST BYTE
  2758
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 69
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2759						 ; PHASE I - LOOK FOR A MARKED WORD 
  2760						 ; (INDICATING SEQUENCE NUMBERING)
  2761
  2762	402574'	254 00 0 00 402600'		JRST	READ5A		; ENTER THE FORAY
  2763
  2764						 ; PHASE I LOOP - CHECK FOR SEQUENCE NUMBERING 
  2765						 ; WITHIN FILE
  2766
  2767	402575'	375 00 0 14 000024 	READ5:	SOSGE	IOIBHD+2(T4)	; DECREMENT COUNT
  2768	402576'	265 15 0 00 402754'		JSP	QLINK,FINBF1	; FILL BUFFER IF NECESSARY
  2769	402577'	134 16 0 14 000023 		ILDB	Q2,IOIBHD+1(T4)	; GET NEXT BYTE
  2770
  2771						 ; HERE IF BYTE ALREADY EXISTS
  2772
  2773	402600'	200 15 0 14 000023 	READ5A:	MOVE	Q1,IOIBHD+1(T4)	; GET POINTER
  2774	402601'	242 15 0 00 777742 		LSH	Q1,-^D30	; BYTE POSITION TO Q1 RIGHT
  2775	402602'	306 15 0 00 000035 		CAIN	Q1,^D29		; LEFT-MOST BYTE?
  2776	402603'	254 00 0 00 402606'		JRST	READ5B		; YES
  2777	402604'	322 16 0 00 402575'		JUMPE	Q2,READ5	; IF 0 - LOOP
  2778	402605'	254 00 0 00 402623'		JRST	READ6		; OTHERWISE IT CAN'T BE NUMBERED
  2779
  2780						 ; HERE IF BYTE IS FIRST BYTE OF A WORD
  2781
  2782	402606'	200 15 0 14 000023 	READ5B:	MOVE	Q1,IOIBHD+1(T4)	; GET POINTER AGAIN
  2783	402607'	200 15 0 15 000000 		MOVE	Q1,0(Q1)	; LOAD POINTED-TO WORD
  2784
  2785	402610'	201 00 0 00 000001 		MOVEI	Z,N.FLG		; SET ...
  2786	402611'	602 15 0 00 000001 		TRNE	Q1,1		; SEQUENCE # FLAG IF ...
  2787	402612'	436 00 0 00 402523*		IORM	Z,RDFLGS##	; FILE IS SEQUENCED #ED
  2788
  2789	402613'	602 15 0 00 000001 		TRNE	Q1,1		; IF NOT SEQUENCED #'ED
  2790	402614'	603 13 0 00 000400 		TXNE	T3,FMT.N	;[246] OR IF N FORMAT
  2791	402615'	254 00 0 00 402623'		JRST	READ6		; THEN GET THE WHOLE THING
  2792
  2793						 ; FILE IS SEQUENCE NUMBERED & NOT N FORMAT
  2794						 ; IGNORE FIRST SIX CHARACTERS OF STRING
  2795
  2796	402616'	201 11 0 00 000006 		MOVEI	T1,6		; NUMBER OF CHARACTES TO OMIT
  2797	402617'	375 00 0 14 000024 	READ5C:	SOSGE	IOIBHD+2(T4)	; DEDUCT COUNT
  2798	402620'	265 15 0 00 402754'		JSP	QLINK,FINBF1	; FILL BUFF IF NECESSARY
  2799	402621'	134 16 0 14 000023 		ILDB	Q2,IOIBHD+1(T4)	; LOAD NEXT BYTE
  2800	402622'	367 11 0 00 402617'		SOJG	T1,READ5C	; KEEP LOOPING UNTIL CHARS ARE EATEN
  2801
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 70
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2802
  2803					;	READ6 - PHASE II OF THE GENERALIZED LINE INPUT.
  2804					;	CHARACTERS ARE TRANSFERED FROM THE BUFFER TO THE
  2805					;	DEPOSITION STRING. WHILE THIS IS DONE, A COUNT IS 
  2806					;	KEPT IN T2 AND THE CHARACTERS ARE EXAMINED FOR
  2807					;	AN OCCURRENCE OF A TERMINAL. Y.ALT!Y.VM!Y.CR DESCRIBES THE 
  2808					;	SET OF ALL TERMINALS WHEREAS Y.ALT!Y.VM DESCRIBES THE 
  2809					;	SUBSET OF TERMINALS CALLED BREAKS.
  2810
  2811					;	A LINE ENDS WITH ANY SUCCESSION OF BREAKS AND THE LONGEST
  2812					;	SUFFIX OF TERMINALS IS CALLED THE TCC (TERMINAL 
  2813					;	CONTROL CHARACTER) SEQUENCE.
  2814					;
  2815					;	ENTER WITH Q2 CONTAINING A CHARACTER. T1 HOLDS THE STATE
  2816					;	 STATE 0 :	NO TERMINAL YET
  2817					;	 STATE 1 :	THE LAST CHAR WAS A TERMINAL BUT NO BREAK YET
  2818					;	 STATE 2 :	THE LAST CHAR WAS A BREAK
  2819
  2820	402623'	201 11 0 00 402641'	READ6:	MOVEI	T1,RD.ST0	; INITIAL STATE IS 0
  2821	402624'	400 12 0 00 000000 		CLEAR	T2,		; BYTE COUNT
  2822	402625'	476 00 0 00 401074*		SETOM	IGNOT##		; LENGTH OF MEAT
  2823	402626'	254 00 0 00 402632'		JRST	READ6B		; JUMP INTO THE LOOP
  2824
  2825						 ; LOOP BACK HERE FOR EACH CHAR
  2826
  2827	402627'	375 00 0 14 000024 	READ6A:	SOSGE	IOIBHD+2(T4)	; BUMP COUNT
  2828	402630'	265 15 0 00 402754'		JSP	QLINK,FINBF1	; REFRESH BUFFER IF 0
  2829	402631'	134 16 0 14 000023 		ILDB	Q2,IOIBHD+1(T4)	; GET NEXT BYTE
  2830
  2831	402632'	322 16 0 00 402627'	READ6B:	JUMPE	Q2,READ6A	; IGNORE NULL CHARS
  2832	402633'	200 15 0 00 401543*		MOVE	Q1,SYSCT##	; ADDRESS OF SYSTEM CHAR TABLE
  2833	402634'	271 15 0 16 000002 		ADDI	Q1,CTBITS(Q2)	; POINT TO MASK
  2834	402635'	200 15 0 15 000000 		MOVE	Q1,0(Q1)	; LOAD MASK
  2835	402636'	254 00 1 00 000011 		JRST	@T1		; TRANSFER TO CURRENT STATE
  2836
  2837						 ; CONTROL RETURNS EITHER HERE OR AT READ6D.
  2838						 ; THE LATTER IS THE END-OF-RECORD LOCATION
  2839
  2840	402637'	136 16 0 00 402571*	READ6C:	IDPB	Q2,DEPTR	; DEPOSIT BYTE
  2841	402640'	344 12 0 00 402627'		AOJA	T2,READ6A	; BUMP COUNT AND LOOP
  2842
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 71
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2843						 ; STATE 0
  2844
  2845	402641'	606 15 0 00 034400 	RD.ST0:	TXNN	Q1,Y.ALT!Y.VM!Y.CR!Y.CZ	; A TERMINAL?
  2846	402642'	254 00 0 00 402637'		JRST	READ6C		; NO
  2847
  2848	402643'	202 12 0 00 402625*		MOVEM	T2,IGNOT	; SAVE CURRENT CURSOR
  2849	402644'	201 11 0 00 402645'		MOVEI	T1,RD.ST1	; CHANGE TO STATE 1
  2850
  2851						 ; STATE 1
  2852
  2853	402645'	201 00 0 00 000002 	RD.ST1:	MOVEI	Z,F.FLG		; LOAD FORM FEED FLAG
  2854	402646'	306 16 0 00 000014 		CAIN	Q2,14		; FORM FEED?
  2855	402647'	436 00 0 00 402612*		IORM	Z,RDFLGS	; YES - SET FORM FEED FLAG
  2856
  2857	402650'	331 00 0 14 000030 		SKIPL	IOTTY(T4)	; IS IT A TTY?
  2858	402651'	254 00 0 00 402660'		JRST	RD.S1A		; NO
  2859
  2860	402652'	306 16 0 00 000032 		CAIN	Q2,.CHCNZ		; EOF?
  2861	402653'	254 00 0 00 403031'		JRST	FINBU2		; YES
  2862
  2863	402654'	606 15 0 00 024000 		TXNN	Q1,Y.ALT!Y.VM		; BREAK CHAR?
  2864	402655'	254 00 0 00 402660'		JRST	RD.S1A		; NO - TREAT LIKE NORMAL CASE
  2865
  2866	402656'	136 16 0 00 402637*		IDPB	Q2,DEPTR	; DEPOSIT VALUE
  2867	402657'	344 12 0 00 402673'		AOJA	T2,READ6G	; INC COUNT AND JUMP TO END GAME
  2868
  2869	402660'	606 15 0 00 034000 	RD.S1A:	TXNN	Q1,Y.ALT!Y.VM!Y.CR	; SOME KIND OF TERMINAL?
  2870	402661'	201 11 0 00 402641'		MOVEI	T1,RD.ST0	; NO - BACK TO STATE 0
  2871
  2872	402662'	602 15 0 00 024000 		TXNE	Q1,Y.ALT!Y.VM		; A BREAK?
  2873	402663'	201 11 0 00 402665'		MOVEI	T1,RD.ST2	; YES - UP TO STATE 2
  2874
  2875	402664'	254 00 0 00 402637'		JRST	READ6C		; GO AND DEPOSIT BYTE
  2876
  2877						 ; STATE 2
  2878
  2879	402665'	201 00 0 00 000002 	RD.ST2:	MOVEI	Z,F.FLG		; LOAD FORM FEED FLAG
  2880	402666'	306 16 0 00 000014 		CAIN	Q2,14		; FORM FEED CHAR?
  2881	402667'	436 00 0 00 402647*		IORM	Z,RDFLGS	; YES - SET FORM FEED FLAG
  2882
  2883	402670'	602 15 0 00 024000 		TXNE	Q1,Y.ALT!Y.VM		; IS IT A BREAK?
  2884	402671'	254 00 0 00 402637'		JRST	READ6C		; YES - OK
  2885
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 72
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2886
  2887						 ; THE SEARCH FOR A LOGICAL RECORD IS COMPLETE
  2888						 ; PREPARE TO RETURN.
  2889
  2890						 ; HERE ON END-OF-FILE WITHIN FINBF1
  2891
  2892	402672'	542 16 0 14 000030 	READ6D:	HRRM	Q2,IOLAST(T4)	; SAVE CHAR.
  2893
  2894	402673'				READ6G:	 ; HERE FROM TTY END-OF-LINE
  2895
  2896	402673'	335 00 0 00 402643*		SKIPGE	IGNOT		; IGNORE MEAT LENGTH ...
  2897	402674'	254 00 0 00 402677'		JRST	READ6F		; IF NOT SET
  2898	402675'	607 13 0 00 000100 		TXNN	T3,FMT.T	;[246] 'T' FORMAT?
  2899	402676'	200 12 0 00 402673*		MOVE	T2,IGNOT	; NO - USE SHORTER LENGTH
  2900
  2901	402677'	607 13 0 00 004000 	READ6F:	TXNN	T3,FMT.CP	;[246] IF CHAR PREFIX
  2902	402700'	606 13 0 00 777777 		TRNN	T3,-1		; OR IF RIGHT SIDE 0
  2903	402701'	254 00 0 00 402704'		JRST	READ6E		; IGNORE LENGTH FORMAT
  2904
  2905	402702'	303 12 0 13 000000 		CAILE	T2,0(T3)	; IF T2 IS GREATER THAN FORMAT-RIGHT
  2906	402703'	201 12 0 13 000000 		MOVEI	T2,0(T3)	; USE FORMAT RIGHT
  2907
  2908	402704'	202 12 0 01 000000 	READ6E:	MOVEM	T2,0(STACK)	; INSERT LENGTH IN DESCRIPTOR
  2909
  2910						 ; SNIP OFF EXCESS FROM SBLOK
  2911
  2912	402705'	201 16 0 12 000016 		MOVEI	Q2,^D14(T2)	; FIND REQUIRED ...
  2913	402706'	231 16 0 00 000005 		IDIVI	Q2,5		; NEW LENGTH OF SBLOK TO Q2
  2914	402707'	200 15 0 01 777777 		MOVE	Q1,-1(STACK)	; POINT TO SBLOK
  2915	402710'	550 17 0 15 000000 		HRRZ	Q3,BLENG(Q1)	; CURRENT LENGTH
  2916	402711'	542 16 0 15 000000 		HRRM	Q2,BLENG(Q1)	; INSERT COMPUTED LENGTH
  2917	402712'	271 02 0 16 000000 		ADDI	SURF,0(Q2)	; ADJUST SURFACE ...
  2918	402713'	275 02 0 17 000000 		SUBI	SURF,0(Q3)	; POINTER
  2919
  2920	402714'	200 11 0 00 402521*		MOVE	TLINK,RDLINK##	; RESTORE LINK
  2921	402715'	200 00 0 00 402667*		MOVE	Z,RDFLGS	; LOAD FLAGS
  2922	402716'	326 12 0 11 000002 		JUMPN	T2,2(TLINK)	; AND RETURN (UNLESS NULL)
  2923
  2924	402717'	200 12 0 00 401611*		MOVE	T2,NULLST	; BUT RETURN
  2925	402720'	202 12 0 01 777777 		MOVEM	T2,-1(STACK)	; A REAL NULL STRING
  2926	402721'	254 00 0 11 000002 		JRST	2(TLINK)	; IF LENGTH WAS 0
  2927
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 73
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2928
  2929						 ; HERE TO DO READING FROM THE TTY
  2930
  2931	402722'	202 11 0 00 402714*	RDTTY:	MOVEM	T1,RDLINK	; SAVE LINK REG.
  2932	402723'	202 12 0 00 402522*		MOVEM	T2,RDSTBL##	; SAVE STREAM BLOK
  2933
  2934	402724'	603 13 0 00 001000 		TXNE	T3,FMT.WM	;[246] WORD MODE?
  2935	402725'	001 14 0 00 000024 		ERROR	12,20		; YES-INCOMPATIBLE
  2936
  2937	402726'	336 00 0 14 000031 		SKIPN	IOFLGS(T4)	; OPEN FOR OUTPUT?
  2938	402727'	254 00 0 00 402735'		JRST	RDTTY1		; NO - JUMP
  2939
  2940	402730'	200 17 0 14 000021 		MOVE	Q3,IOCHAN(T4)	; LOAD CHANNEL #
  2941	402731'	434 17 0 00 404020'		IOR	Q3,[OUT 0-0,0]	; FLUSH OUT ...
  2942	402732'	256 00 0 00 000017 		XCT	Q3		; CURRENT BUFFERS
  2943	402733'	334 00 0 00 000000 		SKIPA			; GODD FLUSH
  2944	402734'	001 14 0 00 000037 		ERROR	12,31		; BAD FLUSH
  2945
  2946	402735'	607 13 0 00 000200 	RDTTY1:	TXNN	T3,FMT.C	;[246] SINGLE CHARACTER?
  2947	402736'	254 00 0 00 402743'		JRST	RDTTYL		; NO - GET LINE
  2948
  2949						 ; 'C' FORMAT FOR TTY
  2950
  2951	402737'	051 00 0 00 000016 		INCHRW	Q2		; LOAD Q2 WITH NEXT CHAR
  2952	402740'	306 16 0 00 000032 		CAIN	Q2,32		; CHECK FOR ^Z
  2953	402741'	254 00 0 00 403032'		JRST	FINBU1		; YES-JOIN LATTER PART OF FINBUF
  2954	402742'	254 00 0 00 402547'		JRST	READ3C		; JOIN OTHER 'C' PROCESSING
  2955
  2956						 ; NON-'C' FORMATS FOR TTY
  2957
  2958	402743'	201 00 0 00 000454 	RDTTYL:	MOVEI	Z,^D300		; MAX. LINE WIDTH
  2959	402744'	265 15 0 00 402561*		JSP	QLINK,ASBLOK	; ALLOCATE BLOK
  2960	402745'	001 13 0 00 000003 		ERROR	11,3		; EXCEEDED &MAXLNGTH
  2961	402746'	202 17 0 00 402656*		MOVEM	Q3,DEPTR	; ESTABLISH DEP POINTER
  2962	402747'	402 00 0 14 000024 		CLEARM	IOIBHD+2(T4)	; SET TRAP
  2963	402750'	400 16 0 00 000000 		CLEAR	Q2,		; INITIAL CHARACTER
  2964	402751'	201 11 0 00 402641'		MOVEI	T1,RD.ST0	; INITIALIZE STATE
  2965	402752'	400 12 0 00 000000 		CLEAR	T2,		; INITIALIZE CHARACTER COUNT
  2966	402753'	254 00 0 00 402632'		JRST	READ6B		; JUMP TO ENTRY POINT
  2967									; IN GENERALIZED LINE HANDLER
  2968	
  2969
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 74
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  2970
  2971					;	FINBUF AND FINBF1 SERVE TO FILL THE NEXT INPUT
  2972					;	BUFFER IF POSSIBLE.	
  2973					;	FINBUF IS USED FOR  WORDS OR SINGLE CHARACTERS
  2974					;	FINBF1 IS USED WITH STRINGS.
  2975					; 
  2976					; CALLING SEQUENCE:
  2977					;	RETURN
  2978					;	JSP	QLINK,FINBUF [OR FINBF1]
  2979					;
  2980					;	NOTE THE NON-STANDARD CALLING SEQUENCE
  2981
  2982	402754'	312 14 0 00 402477*	FINBF1:	CAME	T4,TTYBLK	; TTY?
  2983	402755'	254 00 0 00 402762'		JRST	FINBF4		; NO
  2984	402756'	051 04 0 00 000016 		INCHWL	Q2		; GET NEXT CHAR
  2985	402757'	302 16 0 00 000032 		CAIE	Q2,32		; ^Z ?
  2986	402760'	254 00 0 00 402632'		JRST	READ6B		; NO - RETURN
  2987
  2988	402761'	254 00 0 00 403031'		JRST	FINBU2		; JOIN LATTER PART OF FINBUF
  2989
  2990	402762'	200 16 0 14 000021 	FINBF4:	MOVE	Q2,IOCHAN(T4)	; LOAD Q2 WITH ...
  2991	402763'	434 16 0 00 404021'		IOR	Q2,[IN 0-0]	; AN IN UUO
  2992	402764'	256 00 0 00 000016 		XCT	Q2		; AND GO FILL BUFFERS
  2993	402765'	254 00 0 00 403002'		JRST	FINBF2		; GOOD READ
  2994
  2995						 ; UNUSUAL CONDITIONS
  2996
  2997	402766'	200 16 0 14 000021 		MOVE	Q2,IOCHAN(T4)	; GET ...
  2998	402767'	434 16 0 00 404022'		IOR	Q2,[GETSTS 0-0,Q3] ; STATUS ...
  2999	402770'	256 00 0 00 000016 		XCT	Q2		; TO Q3
  3000
  3001	402771'	606 17 0 00 020000 		TRNN	Q3,1B22		; END-OF-FILE?
  3002	402772'	001 14 0 00 000004 		ERROR	12,4		; NO - INCORRECTIBLE
  3003
  3004	402773'	326 12 0 00 402775'		JUMPN	T2,FINBF5	; JUMP IF ANY CHAR SO FAR
  3005	402774'	254 00 0 00 403031'		JRST	FINBU2		; JOIN NEXT-FILE PROCESSING
  3006
  3007	402775'	265 15 0 00 403637'	FINBF5:	JSP	QLINK,CLS	; FIRST CLOSE OUT THE FILE
  3008	402776'	400 16 0 00 000000 		CLEAR	Q2,		; NULL CHAR
  3009	402777'	200 17 0 00 402723*		MOVE	Q3,RDSTBL	; LOAD CURRENT STREAM BLOK
  3010	403000'	350 00 0 17 000003 		AOS	STCF(Q3)	; BUMP CURRENT FILE
  3011	403001'	254 00 0 00 402672'		JRST	READ6D		; JOIN END GAME
  3012
  3013						 ; HERE IF BUFFER WAS FILLED PROPERLY
  3014
  3015						 ; WE WANT TO ALLOCATE ADDITONAL STORAGE FOR SBLOK
  3016
  3017	403002'	202 15 0 00 000000*	FINBF2:	MOVEM	QLINK,RDQLNK##	; SAVE LINK
  3018
  3019
  3020	403003'	200 16 0 14 000024 		MOVE	Q2,IOIBHD+2(T4)	; # OF CHARACTERS
  3021	403004'	231 16 0 00 000005 		IDIVI	Q2,5		; # OF WORDS TO Q2
  3022	403005'	201 00 0 16 000001 		MOVEI	Z,1(Q2)		; 1 EXTRA FOR GOOD MEASURE
  3023	403006'	265 15 0 00 000000*		JSP	QLINK,GCOLF##	; ENSURE ADDITIONAL STORAGE
  3024
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 74-1
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- READ

  3025	403007'	200 16 0 01 777777 		MOVE	Q2,-1(STACK)	; POINT TO SBLOK
  3026	403010'	272 00 0 16 000000 		ADDM	Z,BLENG(Q2)	; BUMP WORD COUNT
  3027	403011'	272 00 0 00 000002 		ADDM	Z,SURF		; ALSO BUMP SURFACE
  3028
  3029	403012'	200 16 0 14 000024 		MOVE	Q2,IOIBHD+2(T4)	; GET CHAR. COUNT AGAIN
  3030	403013'	272 16 0 01 000000 		ADDM	Q2,0(STACK)	; ADD TO STRING LENGTH
  3031	403014'	200 17 0 01 777777 		MOVE	Q3,-1(STACK)	; RENEW BASE FOR DEPTR
  3032	403015'	200 15 0 00 403002*		MOVE	QLINK,RDQLNK##	; RESTOR QLINK
  3033	403016'	254 00 0 15 777776 		JRST	-2(QLINK)	; RETURN BACKWARD
  3034
  3035					;	FINBUF - FILL INPUT BUFFER
  3036
  3037	403017'	200 16 0 14 000021 	FINBUF:	MOVE	Q2,IOCHAN(T4)	; LOAD Q2 WITH IN ...
  3038	403020'	434 16 0 00 404021'		IOR	Q2,[IN 0]	; UUO
  3039	403021'	256 00 0 00 000016 		XCT	Q2		; EXECUTE SAME
  3040	403022'	254 00 0 15 777776 		JRST	-2(QLINK)	; SUCCESSFUL FILL
  3041
  3042						 ; UNUSUAL CONDITION ENCOUNTERED
  3043
  3044	403023'	200 16 0 14 000021 		MOVE	Q2,IOCHAN(T4)	; GET
  3045	403024'	434 16 0 00 404022'		IOR	Q2,[GETSTS Q3]	; STATUS ...
  3046	403025'	256 00 0 00 000016 		XCT	Q2		; INTO Q3
  3047
  3048	403026'	606 17 0 00 020000 		TRNN	Q3,1B22		; END-OF-FILE?
  3049	403027'	001 14 0 00 000004 		ERROR	12,4		; INCORRECTIBLE
  3050
  3051						 ; HERE FROM ^Z ON TTY
  3052						 ; MOVE ON TO NEXT FILE IN STREAM
  3053
  3054	403030'	334 00 0 00 000000 		SKIPA
  3055	403031'	274 01 0 00 402374*	FINBU2:	SUB	STACK,XWD22##	; POP STRING
  3056
  3057	403032'	265 15 0 00 403637'	FINBU1:	JSP	QLINK,CLS	; CLOSE FILE
  3058	403033'	200 12 0 00 402777*		MOVE	T2,RDSTBL	; RELOAD STBLOK ADDRESS
  3059	403034'	350 00 0 12 000003 		AOS	STCF(T2)	; INCREMENT CURR FILE
  3060	403035'	200 11 0 00 402722*		MOVE	TLINK,RDLINK	; RELOAD LINK
  3061	403036'	254 00 0 00 402466'		JRST	READ		; START OVER WITH NEW FILE
  3062
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 75
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- MAKEIO

  3063						SUBTTL	Tertiary routines -- MAKEIO
  3064						SUBTTL	Tertiary routines -- STRIO
  3065
  3066					;	STRIO - STREAM FOR I/O
  3067					;
  3068					; CALLING SEQUENCE:
  3069					;	GIVEN THAT A STRING BEARING A FILE SPEC HAS
  3070					;	PREVIOUSLY BEEN PASSED TO STINIT...
  3071					;	JSP	TLINK,STRIO
  3072					;	ERROR
  3073					;	NORMAL - FILE DESCRIPTOR ON STACK AND 
  3074					;		 Z CONTAINS BREAK CHARACTER (OR 0 ON 
  3075					;		 RUNNOUT) CURSOR POSITIONED AFTER BREAK CHAR
  3076
  3077					;	MAKEIO (ALTERNATE ENTRY POINT TO STRIO)
  3078					;
  3079					; CALLING SEQUENCE:
  3080					;
  3081					;	SET FILE SPEC VARIABLES TO DESIRED STATE
  3082					;
  3083					;	JSP	TLINK,MAKEIO
  3084					;	ERROR
  3085					;	NORMAL - I/O DESCRIPTOR ON STACK, Z ZEROED
  3086
  3087						 ; ENTRY POINTS
  3088
  3089	403037'	201 12 0 00 403045'	STRIO:	MOVEI	T2,STIO1	; FIRST LOCATION
  3090	403040'	265 00 0 00 000000*		PUSHR	PST		; ELEVATE STATUS
  3091	403041'	000012	000004
  3092	403042'	254 00 0 12 000000 		JRST	0(T2)		; START
  3093
  3094
  3095	403043'	201 12 0 00 403240'	MAKEIO:	MOVEI	T2,STIO99	; ENTER BY BACK DOOR
  3096	403044'	254 00 0 00 403040'		JRST	STRIO+1		; JOIN STRIO
  3097
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 76
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3098
  3099						 ; INITIALIZE FILE-SPEC VARIABLES
  3100
  3101	403045'	265 15 0 00 403633'	STIO1:	JSP	QLINK,CLRFSV	; CLEAR FILE-SPEC VARIABLES
  3102
  3103	403046'	205 06 0 00 446353 		MOVSI	S1,'DSK'	; DEFAULT ...
  3104	403047'	202 06 0 00 401132*		MOVEM	S1,DEVICE##	; DEVICE
  3105
  3106						 ; CHECK FOR LEADING ALPHANUMERICS
  3107
  3108	403050'	200 07 0 00 402633*		MOVE	S2,SYSCT	; BASE ALL STREAMING
  3109
  3110	403051'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; ZIP ACROSS BLANKS
  3111	403052'	254 00 0 00 403404'		JRST	STIONL		; NO FILE
  3112
  3113	403053'	200 10 0 00 404023'	STIO2:	MOVX	S3,Y.UPS!Y.LOWS!Y.NUM	; DID WE FIND AN ...
  3114	403054'	265 11 0 00 000000*		JSP	TLINK,CHECK##	; ALPHANUMERIC?
  3115	403055'	254 00 0 00 403105'		JRST	STIO35		; NO
  3116
  3117	403056'	265 11 0 00 402010*		JSP	TLINK,STRMC##	; LOOK FOR END OF IT
  3118	403057'	254 00 0 00 403075'		JRST	STIO3		; RUNNOUT (WILL USE NAME)
  3119	403060'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; SKIP TO NEXT NONBLANK
  3120	403061'	254 00 0 00 403075'		JRST	STIO3		; SAME AS RUNNOUT
  3121
  3122	403062'	302 16 0 00 000072 		CAIE	Q2,":"		; COLON?
  3123	403063'	254 00 0 00 403075'		JRST	STIO3		; NO
  3124
  3125	403064'	133 00 0 00 402023*		IBP	STPTR		; INCREMENT ...
  3126	403065'	370 00 0 00 402022*		SOS	CURSOR		; CURSOR
  3127
  3128	403066'	205 00 0 00 003003 		MOVX	Z,FMT.S!FMT.WM	;[246]CONVERT
  3129	403067'	265 11 0 00 402322'		JSP	TLINK,CVTDW	; TO SIXBIT
  3130	403070'	254 00 0 00 403406'		JRST	STBOMB		; ERRONEOUS FILE SPEC
  3131	403071'	202 00 0 00 403047*		MOVEM	Z,DEVICE	; ESTABLISH AS DEVICE
  3132
  3133	403072'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; SEEK NEXT NON BLANK
  3134	403073'	254 00 0 00 403240'		JRST	STIO99		; NONE MEANS DONE
  3135	403074'	254 00 0 00 403053'		JRST	STIO2		; LOOP FOR NAME
  3136	
  3137						 ; HERE TO PROCESS NAME
  3138
  3139	403075'	205 00 0 00 003003 	STIO3:	MOVX	Z,FMT.S!FMT.WM	;[246] CONVERT TO ...
  3140	403076'	265 11 0 00 402322'		JSP	TLINK,CVTDW	; SIXBIT
  3141	403077'	255 00 0 00 000000 		JFCL			; NOOP - IGNORE LONG STRING
  3142	403100'	202 00 0 00 400745*		MOVEM	Z,FILNAM##	; ESTABLISH AS FILE NAME
  3143	403101'	336 00 0 00 000000*		SKIPN	FRSTNM##		; FIRST NAME?
  3144	403102'	202 00 0 00 403101*		MOVEM	Z,FRSTNM	; YES, SAVE IT
  3145
  3146
  3147	403103'	337 00 0 00 403065*		SKIPG	CURSOR		; AT END?
  3148	403104'	254 00 0 00 403240'		JRST	STIO99		; YES
  3149
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 77
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3150
  3151
  3152						 ; STREAM FOR AND PROCESS EXTENSION
  3153
  3154	403105'	205 10 0 00 000100 	STIO35:	MOVX	S3,Y.PER	; IS NONBLANK ...
  3155	403106'	265 11 0 00 403054*		JSP	TLINK,CHECK##	; A PERIOD?
  3156	403107'	254 00 0 00 403127'		JRST	STIO4		; NO
  3157
  3158	403110'	402 00 0 00 400734*		CLEARM	DFTEXT##		; YES, CLEAR DEFAULT EXTENSION
  3159
  3160	403111'	133 00 0 00 403064*		IBP	STPTR		; INCREMENT PAST ...
  3161	403112'	377 00 0 00 403103*		SOSG	CURSOR		; PERIOD
  3162	403113'	254 00 0 00 403240'		JRST	STIO99		; JUMP IF NO CHARS LEFT
  3163
  3164	403114'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; SKIP TO FIRST NONBLANK
  3165	403115'	254 00 0 00 403240'		JRST	STIO99		; NONE MEANS DONE
  3166
  3167	403116'	200 10 0 00 404023'		MOVX	S3,Y.UPS!Y.LOWS!Y.NUM	; ALPHA-
  3168	403117'	265 11 0 00 403106*		JSP	TLINK,CHECK	; NUMERIC?
  3169	403120'	254 00 0 00 403127'		JRST	STIO4		; NO - TRY PPN
  3170
  3171	403121'	265 11 0 00 403056*		JSP	TLINK,STRMC	; LOOK FOR END OF THEM
  3172	403122'	255 00 0 00 000000 		JFCL			; ON RUNNOUT - NOOP
  3173
  3174	403123'	205 00 0 00 003003 		MOVX	Z,FMT.S!FMT.WM	;[246] CONVERT STRING
  3175	403124'	265 11 0 00 402322'		JSP	TLINK,CVTDW	; TO SIXBIT
  3176	403125'	255 00 0 00 000000 		JFCL			; IGNORE OVERFLOW
  3177	403126'	502 00 0 00 400747*		HLLM	Z,EXT##		; ESTABLISH AS EXTENSION
  3178
  3179						 ; HERE TO PROCESS PPN
  3180
  3181	403127'	265 06 0 00 402070'	STIO4:	JSP	SLINK,NONBLK	; FIND SOMETHING?
  3182	403130'	254 00 0 00 403240'		JRST	STIO99		; NOTHING
  3183
  3184	403131'	302 16 0 00 000133 		CAIE	Q2,"["		; START OF PPN?
  3185	403132'	254 00 0 00 403225'		JRST	STIO5		; NO - TRY PRIV
  3186
  3187	403133'	133 00 0 00 403111*		IBP	STPTR		; GET PAST ...
  3188	403134'	370 00 0 00 403112*		SOS	CURSOR		; THE BRACKET
  3189
  3190	403135'	265 06 0 00 402004'		JSP	SLINK,GETOCT	; GET OCTAL
  3191	403136'	506 00 0 00 000000*		HRLM	Z,PPN##		; THIS IS PROJECT NUMBER
  3192
  3193	403137'	306 16 0 00 000054 		CAIN	Q2,","		; WAS BREAK A COMMA?
  3194	403140'	254 00 0 00 403151'		JRST	STIO40	; YES, SKIP THIS
  3195
  3196	403141'	302 16 0 00 000055 		CAIE	Q2,"-"		; WAS IT A HYPHEN?
  3197	403142'	254 00 0 00 403406'		 JRST	STBOMB		; CAN'T BE ANYTHING ELSE
  3198
  3199	403143'	402 00 0 00 403136*		CLEARM	PPN		; Use default path
  3200
  3201	403144'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; GET NEXT CHAR
  3202	403145'	254 00 0 00 403240'		 JRST	STIO99		; NOTHING ELSE
  3203
  3204	403146'	133 00 0 00 403133*		IBP	STPTR		;[210]  eat that character
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 77-1
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3205	403147'	370 00 0 00 403134*		SOS	CURSOR		;[210]   ..
  3206	403150'	254 00 0 00 403225'		JRST	STIO5		;]210]  go get rest
  3207
  3208	403151'	265 06 0 00 402004'	STIO40:	JSP	SLINK,GETOCT	; GET NEXT ...
  3209	403152'	500 00 0 00 403143*		HLL	Z,PPN		; PROGRAMMER NUMBER
  3210	403153'	047 17 0 00 000024 		GETPPN	Q3,		; GET USER'S PPN
  3211	403154'	607 00 0 00 777777 		TLNN	Z,-1		; IS THERE A PROJ. NUMBER?
  3212	403155'	500 00 0 00 000017 		 HLL	Z,Q3		;  NO - USE USER'S
  3213	403156'	606 00 0 00 777777 		TRNN	Z,-1		; IS THERE A PROG. NUMBER?
  3214	403157'	540 00 0 00 000017 		 HRR	Z,Q3		;  NO - USE HIS
  3215	403160'	202 00 0 00 403152*		MOVEM	Z,PPN
  3216
  3217
  3218						 ; START PROCESSING OF THE SFD'S
  3219
  3220	403161'	302 16 0 00 000135 		CAIE	Q2,"]"		; IS THIS THE END?
  3221	403162'	302 16 0 00 000054 		CAIE	Q2,","		; WELL IS THERE A COMMA?
  3222	403163'	254 00 0 00 403217'		JRST	STIO4B		;[210]  go see what else lurks about
  3223
  3224	403164'	201 17 0 00 000003 		MOVEI	Q3,3		; SET UP FOR SFD'S
  3225	403165'	202 17 0 00 000000*		MOVEM	Q3,PTHPTR##	; SET PONTER TO FIRST SFD
  3226	403166'	254 00 0 00 403177'		JRST	SFDFIR		; ENTER WERE IT DOESN'T COUNT
  3227
  3228						 ; HERE TO PROCESS THE SFD'S
  3229
  3230	403167'	202 17 0 00 403165*	STNSFD:	MOVEM	Q3,PTHPTR	; KEEP Q3 OUT OF TROUBLE
  3231	403170'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; GET NEXT CHAR
  3232	403171'	254 00 0 00 403215'		JRST	STIO4A		; NOTHING
  3233
  3234	403172'	302 16 0 00 000135 		CAIE	Q2,"]"		; HAS THE SFD SPEC ENDED?
  3235	403173'	302 16 0 00 000054 		CAIE	Q2,","		; IS THERE A COMMA NEXT?
  3236	403174'	254 00 0 00 403215'		JRST	STIO4A		; GO SEE WHAT ELSE AND DO OTHER THINGS
  3237
  3238	403175'	133 00 0 00 403146*		IBP	STPTR		; EAT THE ...
  3239	403176'	370 00 0 00 403147*		SOS	CURSOR		; COMMA
  3240
  3241	403177'	200 10 0 00 404023'	SFDFIR:	MOVX	S3,Y.UPS!Y.LOWS!Y.NUM	; CHECK FOR ...
  3242	403200'	265 11 0 00 403117*		JSP	TLINK,CHECK##	; A ALPHA-NUMERIC
  3243	403201'	254 00 0 00 403406'		JRST	STBOMB		; NOPE - BOMB OUT
  3244
  3245	403202'	265 11 0 00 403121*		JSP	TLINK,STRMC##	; FIND THE END
  3246	403203'	255 00 0 00 000000 		JFCL			; DON'T WORRY ABOUT IT
  3247
  3248	403204'	205 00 0 00 003003 		MOVX	Z,FMT.S!FMT.WM	;[246] CONVERT TO ...
  3249	403205'	265 11 0 00 402322'		JSP	TLINK,CVTDW	; SIXBIT
  3250	403206'	255 00 0 00 000000 		JFCL			; TOO LONG BUT WHO CARES?
  3251
  3252	403207'	200 17 0 00 403167*		MOVE	Q3,PTHPTR	; GET THE POINTER BACK
  3253	403210'	202 00 0 17 000000*		MOVEM	Z,PTH##(Q3)	; PUT SFD IN PATH
  3254
  3255	403211'	340 17 0 00 000000 		AOJ	Q3,		; INCREMENT
  3256	403212'	306 17 0 00 000000#		CAIN	Q3,PTHEND##-PTH-3	; ARE THERE TOO MANY SFD'S?
  3257	403213'	254 00 0 00 403406'		JRST	STBOMB		; WELL HE BLEW IT
  3258	403214'	254 00 0 00 403167'		JRST	STNSFD		; GO BACK FOR MORE
  3259
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 77-2
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3260	403215'	133 00 0 00 403175*	STIO4A:	IBP	STPTR		;[210]  get past
  3261	403216'	370 00 0 00 403176*		SOS	CURSOR		;[210]  character
  3262
  3263	403217'	201 15 0 00 000001 	STIO4B:	MOVEI	Q1,1		;[210]  put the path dummy arg
  3264	403220'	202 15 0 00 000000#		MOVEM	Q1,PTH+1	; TO KEEP PATH. HAPPY
  3265
  3266	403221'	200 15 0 00 403160*		MOVE	Q1,PPN		; PPN GOES A WELL
  3267	403222'	202 15 0 00 000000#		MOVEM	Q1,PTH+2	;
  3268
  3269	403223'	265 06 0 00 402070'		JSP	SLINK,NONBLK	; GET WIDGIT FOR PRIV
  3270	403224'	254 00 0 00 403240'		 JRST	STIO99		; NOTHING THERE.
  3271
  3272						 ; HERE TO PROCESS <PRIVILEGE>
  3273
  3274	403225'	302 16 0 00 000074 	STIO5:	CAIE	Q2,"<"		; ONE OF THESE?
  3275	403226'	254 00 0 00 403235'		JRST	STIO6		; NO
  3276	403227'	133 00 0 00 403215*		IBP	STPTR		; GET PAST
  3277	403230'	370 00 0 00 403216*		SOS	CURSOR		; CHARACTER
  3278
  3279	403231'	265 06 0 00 402004'		JSP	SLINK,GETOCT	; CONVERT TO OCTAL
  3280	403232'	242 00 0 00 000033 		LSH	Z,^D27		; MOVE INTO FIELD 0-8
  3281	403233'	202 00 0 00 000000*		MOVEM	Z,PRIV##		; OF PRIV
  3282
  3283	403234'	254 00 0 00 403127'		JRST	STIO4		; LOOK FOR MORE THINGS
  3284
  3285						 ; HERE WHEN STRANGE UNIDENTIFIED CHARACTER IS ENCOUNTERED
  3286
  3287	403235'	202 16 0 00 000000*	STIO6:	MOVEM	Q2,TERMCH##	; LAST CHAR PICKED UP
  3288	403236'	370 00 0 00 403230*		SOS	CURSOR		; AND STEP ...
  3289	403237'	133 00 0 00 403227*		IBP	STPTR		; PAST HIM
  3290
  3291						 ; MERGE HERE FROM RUNNOUT CONDITIONS
  3292						 ; LOOK FOR IDENTICAL FILE PREVIOUSLY INSTALLED
  3293
  3294	403240'	200 11 0 00 403071*	STIO99:	MOVE	T1,DEVICE	; LOAD ...
  3295	403241'	200 12 0 00 403100*		MOVE	T2,FILNAM	; PARAMETERS ...
  3296	403242'	200 13 0 00 403126*		MOVE	T3,EXT		; INTO ...
  3297	403243'	200 14 0 00 403221*		MOVE	T4,PPN		; REGISTERS ...
  3298	403244'	200 15 0 00 403233*		MOVE	Q1,PRIV		; FOR FAST COMPARISON
  3299
  3300						 ; CHECK FOR UFD
  3301
  3302	403245'	204 16 0 00 403242*		MOVS	Q2,EXT		; IS EXTENSION ...
  3303	403246'	306 16 0 00 654644 		CAIN	Q2,'UFD'	; UFD ?
  3304	403247'	332 00 0 00 403241*		SKIPE	FILNAM		; AND IS NAME NULL?
  3305	403250'	254 00 0 00 403260'		JRST	STIO98		; THEN AVOID THIS BRANCH
  3306
  3307	403251'	200 12 0 00 403243*		MOVE	T2,PPN		; AND SET NAME FROM PPN
  3308	403252'	201 14 0 00 000016 		MOVEI	T4,16		; AND ...
  3309	403253'	047 14 0 00 000041 		GETTAB	T4,		; RETRIEVE ...
  3310
  3311	403254'	200 14 0 00 404024'		MOVE	T4,[1,,1]	; MPD PPN
  3312	403255'	202 14 0 00 000000#		MOVEM	T4,PTH+2	; PUT IT IN PTH.
  3313
  3314	403256'	201 16 0 00 000001 		MOVEI	Q2,1		; PLACE DUMMY IN PTH ...
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 77-3
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3315	403257'	202 16 0 00 000000#		MOVEM	Q2,PTH+1	; SO IT WILL NOT LOOKUP DEFAULT.
  3316
  3317						 ; CHECK FOR NULL FILE
  3318
  3319	403260'	204 16 0 00 403240*	STIO98:	MOVS	Q2,DEVICE	; IF DEVICE IS ...
  3320	403261'	306 16 0 00 446353 		CAIN	Q2,'DSK'	; DSK AND ...
  3321	403262'	322 12 0 00 403404'		JUMPE	T2,STIONL	; NAME IS NULL, REPORT NULL FILE
  3322
  3323						 ; DEFAULT EXTENSION
  3324
  3325	403263'	306 13 0 00 000000 		CAIN	T3,0		; IS THE EXTENSION 0?
  3326	403264'	306 12 0 00 000000 		CAIN	T2,0		; AND IS THE NAME NONZERO
  3327	403265'	334 00 0 00 000000 		SKIPA			; THEN
  3328	403266'	200 13 0 00 403110*		MOVE	T3,DFTEXT	; USE THE DEFAULT
  3329
  3330						 ; If there was no path - Just clear the PTH area
  3331
  3332	403267'	200 16 0 00 000000#		MOVE	Q2,PTH+1	; FIRST LOOK IN PTH ...
  3333	403270'	326 16 0 00 403272'		JUMPN	Q2,STIO9I	; TO SEE IF IT HAS BEEN DEFINED
  3334
  3335	403271'	402 00 0 00 000000#		CLEARM	PTH+2		; Use default.
  3336
  3337	403272'	201 06 0 00 402315*	STIO9I:	MOVEI	S1,IOBLKS##	; POINT TO LIST OF IOBLOKS
  3338
  3339						 ; SPECIAL TTY TEST
  3340
  3341	403273'	200 07 0 00 402754*		MOVE	S2,TTYBLK	; LOAD TTYBLK
  3342	403274'	322 07 0 00 403277'		JUMPE	S2,STIO7	; IF STILL 0, MOVE ON
  3343	403275'	316 11 0 00 404025'		CAMN	T1,[SIXBIT /TTY/] ; IS OUR DEVICE TTY?
  3344	403276'	254 00 0 00 403366'		JRST	STIO11		; YES - AVOID SEARCH
  3345
  3346						 ; TOP OF SEARCH LOOP
  3347
  3348	403277'	336 07 0 06 000000 	STIO7:	SKIPN	S2,0(S1)	; LOAD ADDR OF NEXT IOBLOK
  3349	403300'	254 00 0 00 403344'		JRST	STIO9		; NONE LEFT
  3350
  3351	403301'	200 00 0 00 000011 		MOVE	Z,T1		; GET THE DEVICE
  3352	403302'	047 00 0 00 000064 		DEVNAM	Z,		; 'REAL' NAME
  3353	403303'	255 00 0 00 000000 		 JFCL			;[273] WILL DETECT THIS LATER.
  3354	403304'	200 16 0 07 000003 		MOVE	Q2,IODEV(S2)	; OTHER DEVICE
  3355	403305'	047 16 0 00 000064 		DEVNAM	Q2,		; OTHER 'REAL' NAME
  3356	403306'	255 00 0 00 000000 		 JFCL			;[273] DON'T CARE.
  3357	403307'	316 16 0 00 000000 		CAMN	Q2,Z		; ARE THEY THE SAME?
  3358
  3359	403310'	312 12 0 07 000005 		CAME	T2,IONAME(S2)	; NAME?
  3360	403311'	254 00 0 00 403342'		JRST	STIO8		; JUMP IF UNSAME
  3361
  3362	403312'	312 13 0 07 000006 		CAME	T3,IOEXT(S2)	; EXTENSION?
  3363	403313'	254 00 0 00 403342'		JRST	STIO8		; JUMP IF DIFF
  3364
  3365	403314'	336 00 0 00 000014 		SKIPN	T4		;[303] Is ppn zero?
  3366	403315'	336 00 0 07 000011 		SKIPN	IOSFD(S2)	;[303] ..
  3367	403316'	254 00 0 00 403327'		 JRST	STIO7A		;[260] No -- avoid this.
  3368	403317'	201 16 0 00 777777 		MOVEI	Q2,.PTFRD	;[260] Lookup default path.
  3369	403320'	202 16 0 00 403210*		MOVEM	Q2,PTH		;[260] This is an argument.
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 77-4
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3370	403321'	200 16 0 00 404026'		MOVE	Q2,[XWD PTHEND-PTH,PTH]	;[260] Argument for path.
  3371	403322'	047 16 0 00 000110 		PATH.	Q2,		;[260] Do the UUO.
  3372	403323'	001 17 0 00 000000 		 ERROR	15		;[260] Error.
  3373	403324'	200 00 0 07 000011 		MOVE	Z,IOSFD(S2)	;[260] NO USE THIS TO COMPARE
  3374	403325'	312 00 0 00 000000#		CAME	Z,PTH+2		;[260] ARE THESE THE SAME PPN?
  3375	403326'	254 00 0 00 403342'		 JRST	STIO8		;[260] NO - BRANCH
  3376	
  3377	403327'	312 15 0 07 000007 	STIO7A:	CAME	Q1,IOPRIV(S2)	;[301] Same priv?
  3378	403330'	254 00 0 00 403342'		JRST	STIO8		;[301] Jump if different.
  3379
  3380	403331'	205 16 0 00 000000#		MOVSI	Q2,-<PTHEND-PTH-3>	;[301] Set up neg count.
  3381	403332'	541 16 0 00 000001 		HRRI	Q2,1		;[301] Start looking at SFD's
  3382	403333'	550 17 0 00 000007 		HRRZ	Q3,S2		;[301] Another pointer.
  3383
  3384	403334'	200 00 0 16 000000#	STIO7B:	MOVE	Z,PTH+2(Q2)	;[301] Compare this specs PATH
  3385	403335'	271 17 0 00 000001 		ADDI	Q3,1		;[301] Increment.
  3386	403336'	312 00 0 17 000011 		CAME	Z,IOSFD(Q3)	;[301] with this previous spec.
  3387	403337'	254 00 0 00 403342'		 JRST	STIO8		;[301] They are different.
  3388	403340'	253 16 0 00 403334'		AOBJN	Q2,STIO7B	;[301] Is there more?
  3389	403341'	254 00 0 00 403366'		 JRST	STIO11		;[301] Go away - it is identical
  3390
  3391	403342'	201 06 0 07 000032 	STIO8:	MOVEI	S1,IONEXT(S2)	; POINT TO NEXT POINTER
  3392	403343'	254 00 0 00 403277'		JRST	STIO7		; AND LOOP BACK
  3393
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 78
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3394
  3395						 ; HERE IF NO MATCH WAS FOUND
  3396
  3397	403344'	201 00 0 00 000033 	STIO9:	MOVEI	Z,IOLENG	; ENSURE ...
  3398	403345'	265 15 0 00 402116*		JSP	QLINK,GCOLG##	; ENOUGH GROWING STORGE
  3399
  3400	403346'	200 07 0 00 402157*		MOVE	S2,GSURF##	; INSERT ADDRESS OF ...
  3401	403347'	202 07 0 06 000000 		MOVEM	S2,0(S1)	; FRESH BLOK
  3402	403350'	272 00 0 00 403346*		ADDM	Z,GSURF		; UPDATE GSURF
  3403
  3404	403351'	505 00 0 00 000415 		HRLI	Z,IOBLOK	; INSERT CODE
  3405	403352'	202 00 0 07 000000 		MOVEM	Z,BTCODE&BLENG(S2) ; AND LENGTH
  3406
  3407	403353'	402 00 0 07 000001 		CLEARM	GCFLD(S2)	; CLEAR ...
  3408	403354'	541 00 0 07 000002 		HRRI	Z,GCFLD+1(S2)	; ALL ...
  3409	403355'	505 00 0 07 000001 		HRLI	Z,GCFLD(S2)	; OF NEW ...
  3410	403356'	251 00 0 07 000032 		BLT	Z,IOLENG-1(S2)	; IOBLOK
  3411
  3412	403357'	202 11 0 07 000003 		MOVEM	T1,IODEV(S2)	; TRANSFER
  3413	403360'	202 12 0 07 000005 		MOVEM	T2,IONAME(S2)	; THE ...
  3414	403361'	202 13 0 07 000006 		MOVEM	T3,IOEXT(S2)	; GOODIES
  3415
  3416						 ; PUT SFD'S FROM PTH INTO IOSFD
  3417
  3418	403362'	505 16 0 00 000000#		HRLI	Q2,PTH+2	; START WERE THE PPN GOES
  3419	403363'	541 16 0 07 000011 		HRRI	Q2,IOSFD(S2)	; AND PUT THAT IN AT THE START OF IOSFD
  3420	403364'	251 16 0 07 000020 		BLT	Q2,IOSFD+7(S2)	;  FILL IT UP.
  3421
  3422	403365'	200 15 0 00 403244*	STIO9B:	MOVE	Q1,PRIV	; RELOAD PRIVILEGE
  3423
  3424						 ; HERE FROM DETECTION OF MATCH
  3425
  3426	403366'	202 15 0 07 000007 	STIO11:	MOVEM	Q1,IOPRIV(S2)	; SET PRIVILEGE
  3427
  3428	403367'	200 16 0 00 000007 		MOVE	Q2,S2		; SAVE ADDR OF IOBLOK
  3429	403370'	505 16 0 00 004015 		HRLI	Q2,IODT		; FILL DATATYPE FIELD
  3430
  3431
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 79
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- STRIO

  3432
  3433						 ; HERE FROM NULL FILE CASE
  3434
  3435	403371'	510 11 0 07 000003 	STIO12:	HLLZ	T1,IODEV(S2)	;GET THE DEVICE NAME
  3436	403372'	316 11 0 00 404025'		CAMN	T1,[SIXBIT /TTY/] ;IS IT TTY ?
  3437	403373'	254 00 0 00 403376'		  JRST	STIO13		;YES - DON'T CHECK FOR NULL FILE NAME
  3438	403374'	336 00 0 07 000005 		SKIPN	IONAME(S2)	;NOT A TTY - MUST NOT BE NULL
  3439	403375'	254 00 0 00 403406'		  JRST	STBOMB		;IT IS -- BOMB
  3440	403376'	265 00 0 00 000000*	STIO13:	POPR	PST		; RESTORE REGS
  3441	403377'	000011	000004
  3442
  3443	403400'	261 01 0 00 000016 		PUSH	STACK,Q2	; PUSH ...
  3444	403401'	261 01 0 00 404004'		PUSH	STACK,[0]	; DESCRIPTOR
  3445
  3446	403402'	200 00 0 00 403235*		MOVE	Z,TERMCH	; SET BREAK CHAR
  3447	403403'	254 00 0 11 000001 		JRST	1(TLINK)	; AND RETURN
  3448
  3449						 ; HERE IF NO CHARACTERS IN STRING AT ALL
  3450
  3451	403404'	400 16 0 00 000000 	STIONL:	CLEAR	Q2,		; RETURN 0-0
  3452	403405'	254 00 0 00 403376'		JRST	STIO13		;[210]  join common end
  3453	
  3454
  3455						 ; HERE IF THE FILE SPEC HAS POOR SYNTAX
  3456
  3457	403406'	265 00 0 00 403376*	STBOMB:	POPR	PST		; RESTORE ALL REGS.
  3458	403407'	000011	000004
  3459	403410'	254 00 0 11 000000 		JRST	0(TLINK)	; TAKE HUMBLE EXIT
  3460
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 80
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- WRITE

  3461						SUBTTL	Tertiary routines -- WRITE
  3462
  3463					;	WRITE - EXTERNAL UTILITY
  3464					;
  3465					; CALLING SEQUENCE:
  3466					;	LOAD Z WITH WORD (FOR WORD MODE)
  3467					;	PUSH STRING DESCRIPTOR ONTO STACK0(OTHERWISE)
  3468					;	LOAD T2 WITH ADDRESS OF IOBLOK
  3469					;	LOAD T3 WITH FORMAT
  3470					;	JSP	TLINK,WRITE
  3471					;	ERROR
  3472					;	NORMAL ; ARG POPPED FROM STACK
  3473
  3474						 ; ENTRY POINT
  3475
  3476	403411'	321 13 0 00 403550'	WRITE::	JUMPL	T3,WRIT99	; NO-OP FLAG
  3477	403412'	322 12 0 00 403550'		JUMPE	T2,WRIT99	; OR NO FILE - RETURN
  3478
  3479	403413'	200 14 0 00 000012 		MOVE	T4,T2		; SET UP ARG FOR Q-CALLS
  3480	403414'	202 00 0 00 402676*		MOVEM	Z,IGNOT		; SAVE WORD ARGUMENT
  3481	403415'	200 17 0 12 000031 		MOVE	Q3,IOFLGS(T2)	; GET FLAGS
  3482	403416'	607 17 0 00 200000 		TLNN	Q3,IOOUFL	; CURRENTLY OPENED OUT?
  3483	403417'	254 00 0 00 403422'		JRST	WRDONT
  3484	403420'	607 13 0 00 010000 		TXNN	T3,FMT.AP	;[246]
  3485	403421'	254 00 0 00 403435'		JRST	WRIT1
  3486
  3487						 ; CLOSE THE FILE AND OPEN IT FOR OUTPUT
  3488
  3489	403422'	265 15 0 00 403637'	WRDONT:	JSP	QLINK,CLS	; CLOSE THE FILE (IF OPENED)
  3490
  3491	403423'	200 00 0 00 000013 		MOVE	Z,T3		; DETERMINE THE ...
  3492	403424'	265 15 0 00 403701'		JSP	QLINK,MODE	; MODE
  3493
  3494	403425'	265 15 0 00 403711'		JSP	QLINK,OPN	; OPEN THE FILE ACCORDING TO THE WORD
  3495	403426'	001 14 0 00 000026 		ERROR	12,22		; COULD NOT OPEN
  3496	403427'	603 13 0 00 010000 		TXNE	T3,FMT.AP	;[246]
  3497	403430'	254 00 0 00 403433'		JRST	WRDNT		;[275]
  3498
  3499
  3500	403431'	265 15 0 00 403662'		JSP	QLINK,ENTR	; ENTER THE NAME
  3501	403432'	001 14 0 00 000026 		ERROR	12,22		; BAD OPEN
  3502
  3503	403433'	205 00 0 00 200000 	WRDNT:	MOVSI	Z,IOOUFL	;[275] ALLOCATE OUTPUT ...
  3504	403434'	265 15 0 00 403557'		JSP	QLINK,ALBUF	; BUFFERS
  3505
  3506						 ; HERE FROM ALREADY-OPEN CASE
  3507
  3508	403435'	200 00 0 00 000013 	WRIT1:	MOVE	Z,T3		; DETERMINE ...
  3509	403436'	265 15 0 00 403701'		JSP	QLINK,MODE	; MODE
  3510	403437'	430 00 0 14 000002 		XOR	Z,IOMODE(T4)	; COMPARE WITH CURRENT FOR ...
  3511	403440'	602 00 0 00 000010 		TRNE	Z,10		; WORD - CHAR INCOMPATIBILITY
  3512	403441'	001 14 0 00 000023 		ERROR	12,19		; MODE - INCOMPATIBLE
  3513
  3514	403442'	607 13 0 00 010000 		TXNN	T3,FMT.AP	;[246] APPEND MODE?
  3515	403443'	254 00 0 00 403454'		JRST	WRIT11		; NO.
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 80-1
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- WRITE

  3516
  3517	403444'	265 15 0 00 403661'		JSP	QLINK,LKP
  3518	403445'	001 14 0 00 000047 		ERROR	12,39
  3519
  3520	403446'	265 15 0 00 403662'		JSP	QLINK,ENTR
  3521	403447'	001 14 0 00 000047 		ERROR	12,39
  3522
  3523	403450'	200 17 0 14 000021 		MOVE	Q3,IOCHAN(T4)
  3524	403451'	541 17 0 00 777777 		HRRI	Q3,-1
  3525	403452'	434 17 0 00 404027'		IOR	Q3,[USETI 0-0,0]
  3526	403453'	256 00 0 00 000017 		XCT	Q3
  3527
  3528	403454'	607 13 0 00 001000 	WRIT11:	TXNN	T3,FMT.WM	;[246] WORD MODE?
  3529	403455'	254 00 0 00 403463'		JRST	WRIT2		; NO - ASCII
  3530
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 81
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- WRITE

  3531
  3532
  3533						 ; WORD MODE
  3534
  3535	403456'	200 16 0 00 403414*		MOVE	Q2,IGNOT	; LOAD WORD FOR OUTPUT
  3536
  3537	403457'	375 00 0 14 000027 	WRIT1A:	SOSGE	IOOBHD+2(T4)	; DECREMENT COUNT
  3538	403460'	265 15 0 00 403552'		JSP	QLINK,EMPBUF	; EMPTY BUFFER
  3539	403461'	136 16 0 14 000026 		IDPB	Q2,IOOBHD+1(T4)	; OUT HE GOES
  3540	403462'	254 00 0 11 000001 		JRST	1(TLINK)	; RETURN
  3541					 	 ; ASCII OUTPUT
  3542
  3543	403463'	550 12 0 01 000000 	WRIT2:	HRRZ	T2,0(STACK)	; GET LENGTH
  3544	403464'	265 15 0 00 402566*		JSP	QLINK,CVTPTR	; MAKE POINTER
  3545	403465'	000000	000000			0			; NO BASING
  3546	403466'	274 01 0 00 403031*		SUB	STACK,XWD22##	; NULL STRING
  3547
  3548	403467'	202 00 0 00 000000*		MOVEM	Z,EXPTR##	; ESTABLISH EXTRACTION PTR
  3549
  3550						 ; 'C' FORMAT
  3551
  3552	403470'	607 13 0 00 000200 	WRIT3:	TXNN	T3,FMT.C	;[246] 'C' ?
  3553	403471'	254 00 0 00 403476'		JRST	WRIT4		; NO - ON TO OTHER THINGS
  3554
  3555	403472'	322 12 0 11 000001 		JUMPE	T2,1(TLINK)	; WAS LENGTH 0?
  3556
  3557	403473'	201 12 0 00 000001 		MOVEI	T2,1		; MAKE SURE ITS ONE CHAR
  3558	403474'	661 13 0 00 000100 		TXO	T3,FMT.T	;[246] SIMULATE TERMINAL FORMAT
  3559	403475'	254 00 0 00 403531'		JRST	WRIT6		; PROCESS LIKE NORMAL WRITE
  3560
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 82
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- WRITE

  3561
  3562						 ; 
  3563						 ; 'N' FORMAT
  3564
  3565	403476'	607 13 0 00 000400 	WRIT4:	TXNN	T3,FMT.N	;[246] 'N' FORMAT?
  3566	403477'	254 00 0 00 403523'		JRST	WRIT5		; NO - MOVE ON
  3567
  3568	403500'	305 12 0 00 000006 		CAIGE	T2,6		; ENOUGH CHARACTERS?
  3569	403501'	001 14 0 00 000030 		ERROR	12,24		; MUST BE AT LEAST 6
  3570
  3571						 ; LOOP FOR BYTE AT BEGINNING OF WORD
  3572
  3573	403502'	375 00 0 14 000027 	WRIT4A:	SOSGE	IOOBHD+2(T4)	; ANOTHER LEFT?
  3574	403503'	265 15 0 00 403552'		JSP	QLINK,EMPBUF	; EMPTY IF NECESSARY
  3575	403504'	133 00 0 14 000026 		IBP	IOOBHD+1(T4)	; INCREMENT POINTER
  3576	403505'	200 17 0 14 000026 		MOVE	Q3,IOOBHD+1(T4)	; LOAD POINTER
  3577	403506'	242 17 0 00 777742 		LSH	Q3,-^D30	; POSITION OF BYTE
  3578	403507'	302 17 0 00 000035 		CAIE	Q3,^D29		; LEFT-MOST = 29
  3579	403510'	254 00 0 00 403502'		JRST	WRIT4A		; KEEP LOOPING IF NOT LEFT
  3580
  3581						 ; LEFT MOST BYTE HAS BEEN FOUND
  3582
  3583	403511'	315 12 0 14 000027 		CAMGE	T2,IOOBHD+2(T4)	; ENOUGH LEFT
  3584	403512'	254 00 0 00 403515'		JRST	WRIT4B		; YES
  3585
  3586	403513'	402 00 0 14 000027 		CLEARM	IOOBHD+2(T4)	; PRETEND WE'VE WRITTEN ALL
  3587	403514'	254 00 0 00 403502'		JRST	WRIT4A		; JUST LOOP
  3588
  3589
  3590						 ; HERE WHEN WE'RE READY TO START WRITING
  3591
  3592	403515'	200 16 0 14 000026 	WRIT4B:	MOVE	Q2,IOOBHD+1(T4)	; GET ACTUAL POINTER
  3593	403516'	201 00 0 00 000001 		MOVEI	Z,1		; RIGHT-MOST BIT
  3594	403517'	436 00 0 16 000000 		IORM	Z,0(Q2)		; SET BIT IN BUFFER
  3595
  3596	403520'	134 16 0 00 403467*		ILDB	Q2,EXPTR	; GET FIRST BYTE
  3597	403521'	137 16 0 14 000026 		DPB	Q2,IOOBHD+1(T4)	; DEPOSIT W/O INCREMENTING
  3598	403522'	364 12 0 00 403523'		SOJA	T2,WRIT5	; DECREMENT COUNT AND LEAP
  3599
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 83
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- WRITE

  3600
  3601						 ; CHARACTER PREFIX
  3602
  3603	403523'	607 13 0 00 004000 	WRIT5:	TXNN	T3,FMT.CP	;[246] PREFIX REQUIRED?
  3604	403524'	254 00 0 00 403531'		JRST	WRIT6		; NO - ONWARD
  3605
  3606	403525'	375 00 0 14 000027 		SOSGE	IOOBHD+2(T4)	; DECREMENT COUNT
  3607	403526'	265 15 0 00 403552'		JSP	QLINK,EMPBUF	; EMPTY BUFFER IF NECESSARY
  3608	403527'	136 13 0 14 000026 		IDPB	T3,IOOBHD+1(T4)	; DEPOSIT BYTE
  3609	403530'	254 00 0 00 403531'		JRST	WRIT6		; JOIN REST OF PROCESSING
  3610
  3611						 ; BASIC WRITE LOOP
  3612
  3613	403531'	361 12 0 00 403537'	WRIT6:	SOJL	T2,WRIT7	; LOOP ON STRING LENGTH
  3614	403532'	375 00 0 14 000027 		SOSGE	IOOBHD+2(T4)	; DECREMENT BUFFER LENGTH
  3615	403533'	265 15 0 00 403552'		JSP	QLINK,EMPBUF	; EMPTY BUFFER IF NECESSARY
  3616
  3617	403534'	134 16 0 00 403520*		ILDB	Q2,EXPTR	; GET NEXT CHAR
  3618	403535'	136 16 0 14 000026 		IDPB	Q2,IOOBHD+1(T4) ; DEPOSIT SAME
  3619	403536'	254 00 0 00 403531'		JRST	WRIT6		; AND LOOP
  3620
  3621						 ; FINISHING UP
  3622
  3623	403537'	663 13 0 00 000100 	WRIT7:	TXOE	T3,FMT.T	;[246] TERMINAL CHARACTERS?
  3624	403540'	254 00 0 00 403545'		JRST	WRIT9		; JUST RETURN 
  3625
  3626	403541'	200 16 0 00 404031'		MOVE	Q2,[POINT 7,[BYTE (7)15,12]] ; POINTER TO ...
  3627	403542'	202 16 0 00 403534*		MOVEM	Q2,EXPTR	; <CR> <LF>
  3628	403543'	201 12 0 00 000002 		MOVEI	T2,2		; LENGTH IS 2
  3629	403544'	254 00 0 00 403531'		JRST	WRIT6		; BACK FOR MORE WRITING
  3630
  3631						 ; HERE TO DO FINAL RETURN
  3632
  3633	403545'	331 00 0 14 000030 	WRIT9:	SKIPL	IOTTY(T4)	; TTY?
  3634	403546'	254 00 0 11 000001 		JRST	1(TLINK)	; NO - JUST RETURN
  3635	403547'	265 15 0 00 403552'		JSP	QLINK,EMPBUF	; YES, EMPTY BUFFER FIRST
  3636
  3637						 ; QUICK RETURN
  3638
  3639	403550'	274 01 0 00 403466*	WRIT99:	SUB	STACK,XWD22##	; POP ARG
  3640	403551'	254 00 0 11 000001 		JRST	1(TLINK)	; NORMAL RETURN
  3641
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 84
SNOFIO	MAC	15-Mar-69 11:20		Tertiary routines -- WRITE

  3642
  3643					; EMPBUF IS CALLED ONLY FROM WITHIN WRITE
  3644					; TO EMPTY A BUFFER (AND SWITCH TO THE NEXT)
  3645					; CALLING SEQUENCE
  3646					;	RETURN
  3647					;	JSP	QLINK,EMPBUF
  3648
  3649	403552'	200 17 0 14 000021 	EMPBUF:	MOVE	Q3,IOCHAN(T4)	; LOAD CHANNEL #
  3650	403553'	434 17 0 00 404020'		IOR	Q3,[OUT 0-0,0]	; COMPLETE THE INSTRUCTION
  3651	403554'	256 00 0 00 000017 		XCT	Q3		; ADVANCE BUFFERS
  3652	403555'	254 00 0 15 777776 		JRST	-2(QLINK)	; OK - EXIT
  3653	403556'	001 14 0 00 000005 		ERROR	12,5		; OUTPUT ERROR
  3654
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 85
SNOFIO	MAC	15-Mar-69 11:20		TYPE Q (QUATERNARY) I/O UTILITIES

  3655						SUBTTL	TYPE Q (QUATERNARY) I/O UTILITIES
  3656
  3657					;	ALBUF	ALLOCATE BUFFERS
  3658
  3659					;	CLRFSV - CLEAR FILE SPEC VARIABLES
  3660
  3661					;	CLS - CLOSE A FILE
  3662
  3663					;	ENTR - ENTER A FILE NAME
  3664
  3665					;	LKP - LOOKUP A FILE NAME
  3666
  3667					;	MODE - DETERMINE MODE FROM FORMAT
  3668
  3669					;	MSTIME - RETURN RUN TIME
  3670
  3671					;	OPN - OPEN A FILE
  3672
  3673					;	WMPROP - COMPUTE WORD MODE PROPERTIES
  3674
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 86
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- ALBUF

  3675						SUBTTL	Quaternary routines -- ALBUF
  3676
  3677					; ALBUF WILL ALLOCATE BUFFERS (2) FOR A FILE.
  3678					; THE FILE MUST NOT BE CURRENTLY BUFFERED (UNLESS TTY).
  3679					;
  3680					; CALLING SEQUENCE:
  3681					;	LOAD T4 WITH ADDRESS OF IOBLOK
  3682					;	LOAD Z LEFT WITH IOINFL OR IOOUFL
  3683					;	JSP	QLINK,ALBUF
  3684					;	RETURN
  3685
  3686	403557'	202 15 0 00 000000*	ALBUF:	MOVEM	QLINK,ALBFSV##	; SAVE LINK
  3687	403560'	312 14 0 00 403273*		CAME	T4,TTYBLK	; TTY ?
  3688	403561'	254 00 0 00 403565'		JRST	ALBUF0		; NO - JUMP
  3689
  3690	403562'	607 00 0 00 400000 		TLNN	Z,IOINFL	; IF ITS INPUT THEY WANT
  3691	403563'	332 00 0 14 000031 		SKIPE	IOFLGS(T4)	; OR IF BUFFERS ARE THERE
  3692	403564'	254 00 0 11 000000 		JRST	0(TLINK)	; RETURN IMMEDIATELY
  3693
  3694	403565'	202 00 0 14 000031 	ALBUF0:	MOVEM	Z,IOFLGS(T4)	; SET FLAGS
  3695	403566'	201 16 0 14 000002 		MOVEI	Q2,IOMODE(T4)	; POINT TO OPEN BLOCK
  3696	403567'	047 16 0 00 000101 		DEVSIZ	Q2,		; GET BUFFER SIZE
  3697	403570'	001 14 0 00 000034 		ERROR	12,28		; BAD DEVICE
  3698	403571'	242 16 0 00 000001 		LSH	Q2,1		; DOUBLE SIZE
  3699	403572'	271 16 0 00 000002 		ADDI	Q2,BUBITS	; ADD TO DETERMINE BLENG
  3700	403573'	505 16 0 00 000431 		HRLI	Q2,OBBLOK	; LOOKING FOR AN OLD BUFFER
  3701	403574'	200 17 0 00 401103*		MOVE	Q3,GRID		; POINT TO BEGINNING OF GRID
  3702
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 87
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- ALBUF

  3703
  3704
  3705						 ; SEARCH LOOP FOR OLD BUFFER
  3706
  3707	403575'	311 17 0 00 403350*	ALBUF1:	CAML	Q3,GSURF	; ARE WE STILL BELOW SURFACE
  3708	403576'	254 00 0 00 403612'		JRST	ALBUF4		; NO - MOVE ON
  3709
  3710	403577'	201 15 0 00 000007 		MOVEI	Q1,VARSIZ	; VARIABLE BLOCK SIZE
  3711	403600'	200 00 0 17 000000 		MOVE	Z,BTCODE&BLENG(Q3) ; LOAD FIRST WORD
  3712	403601'	603 00 0 00 000400 		TLNE	Z,BLOKF		; A BLOK ?
  3713	403602'	550 15 0 00 000000 		HRRZ	Q1,Z		; YES - USE BLENG
  3714	403603'	271 17 0 15 000000 		ADDI	Q3,0(Q1)	; INCREMENT POINTER
  3715	403604'	312 16 0 00 000000 		CAME	Q2,Z		; IS CURRENT BLOK USEFUL
  3716	403605'	254 00 0 00 403575'		JRST	ALBUF1		; NO - JUMP
  3717
  3718	403606'	275 17 0 15 000000 		SUBI	Q3,0(Q1)	; YES - FIND OLD ADDRESS
  3719	403607'	542 17 0 14 000031 		HRRM	Q3,IOBUBL(T4)	; ESTABLISH AS BUFFER
  3720	403610'	200 16 0 00 000017 		MOVE	Q2,Q3		; HAVE Q2 POINT TO BUBLOK
  3721	403611'	254 00 0 00 403617'		JRST	ALBUF6		; JOIN COMMON PROCESSING
  3722	
  3723						 ; COULDN'T FIND AN OLD ONE
  3724
  3725	403612'	201 00 0 16 000000 	ALBUF4:	MOVEI	Z,0(Q2)	; GET SIZE REQUIRED
  3726	403613'	265 15 0 00 403345*		JSP	QLINK,GCOLG##	; ENSURE THIS MUCH GRID
  3727
  3728	403614'	200 16 0 00 403575*		MOVE	Q2,GSURF	; POINT TO NEW AREA
  3729	403615'	542 16 0 14 000031 		HRRM	Q2,IOBUBL(T4)	; INSERT AS BUFFER
  3730	403616'	272 00 0 00 403614*		ADDM	Z,GSURF		; BUMP SURFACE POINTER
  3731
  3732	403617'	402 00 0 16 000001 	ALBUF6:	CLEARM	GCFLD(Q2)	; MAKE GC HAPPY
  3733	403620'	505 00 0 00 000430 		HRLI	Z,BUBLOK	; INSERT BTCODE
  3734	403621'	202 00 0 16 000000 		MOVEM	Z,BTCODE&BLENG(Q2) ; FILL FIRST WORD
  3735						 ; 
  3736						 ; NOW TELL THE SYSTEM ABOUT OUR BUFFER
  3737
  3738	403622'	201 17 0 16 000002 	ALBUF5:	MOVEI	Q3,BUBITS(Q2)	; POINT TO MEAT OF BUFFER
  3739	403623'	542 17 0 00 000121 		HRRM	Q3,.JBFF	; INSERT FOR SYSTEM SAKE
  3740
  3741	403624'	200 16 0 00 404032'		MOVE	Q2,[INBUF 2]	; LOAD INSTRUCTION (INPUT)
  3742	403625'	200 15 0 14 000031 		MOVE	Q1,IOFLGS(T4)	; GET FLAGS
  3743	403626'	603 15 0 00 200000 		TLNE	Q1,IOOUFL	; BUT IS IT REALLY OUTPUT
  3744	403627'	200 16 0 00 404033'		MOVE	Q2,[OUTBUF 2]	; YES
  3745
  3746	403630'	434 16 0 14 000021 		IOR	Q2,IOCHAN(T4)	; COMPLETE INSTRUCTION
  3747	403631'	256 00 0 00 000016 		XCT	Q2		; EXECUTE INSTRUCTION
  3748	403632'	254 00 1 00 403557*		JRST	@ALBFSV		; AND RETURN
  3749
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 88
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- CLRFSV

  3750						SUBTTL	Quaternary routines -- CLRFSV
  3751
  3752					;	CLRFSV - CLEAR FILE SPEC VARIABLES
  3753					;	(SEE STRIO PROLOGUE FOR DECLARATIONS)
  3754
  3755	403633'	402 00 0 00 403260*	CLRFSV:	CLEARM	DEVICE		; ZERO FIRST WORD
  3756	403634'	200 00 0 00 404034'		MOVE	Z,[DEVICE,,FILNAM] ; FROM - TO
  3757	403635'	251 00 0 00 403402*		BLT	Z,TERMCH	; BLIITT
  3758	403636'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  3759
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 89
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- CLS

  3760						SUBTTL	Quaternary routines -- CLS
  3761
  3762					;	CLS - CLOSE A FILE. RELEASE ANY BUFFERS AND ISSUE 
  3763					;	A CLOSE UUO
  3764					; CALLING SEQUENCE:
  3765					;	LOAD T4 WITH ADDRESS OF IOBLOK
  3766					;	JSP	QLINK,CLS
  3767					;	RETURN
  3768
  3769	403637'	336 17 0 14 000021 	CLS::	SKIPN	Q3,IOCHAN(T4)	; IF ALREADY CLOSED
  3770	403640'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  3771
  3772	403641'	434 17 0 00 404035'		IOR	Q3,[CLOSE 0,0]	; COMPLETE THE UUO
  3773	403642'	256 00 0 00 000017 		XCT	Q3		; AND EXECUTE IT
  3774
  3775	403643'	200 17 0 14 000021 		MOVE	Q3,IOCHAN(T4)	; CHECK
  3776	403644'	434 17 0 00 404036'		IOR	Q3,[STATZ 0-0,740000] ; FOR
  3777	403645'	256 00 0 00 000017 		XCT	Q3		; AN 
  3778	403646'	001 14 0 00 000011 		ERROR	12,9		; ERROR IN CLOSING
  3779
  3780	403647'	200 17 0 14 000021 		MOVE	Q3,IOCHAN(T4)	; NOW
  3781	403650'	434 17 0 00 404037'		IOR	Q3,[RELEAS 0-0,0] ; RELEASE
  3782	403651'	256 00 0 00 000017 		XCT	Q3		; IT
  3783
  3784	403652'	402 00 0 14 000021 		CLEARM	IOCHAN(T4)	; CLEAR CHANNEL INDICATOR
  3785
  3786						 ; RELEASE BUFFERS
  3787
  3788	403653'	336 17 0 14 000031 		SKIPN	Q3,IOBUBL(T4)	; LOAD AND TEST BUFFER
  3789	403654'	254 00 0 15 000000 		JRST	0(QLINK)	; ALREADY 0 - JUST RETURN
  3790
  3791	403655'	201 16 0 00 000431 		MOVEI	Q2,OBBLOK	; OLD BUFFER CODE
  3792	403656'	506 16 0 17 000000 		HRLM	Q2,BTCODE(Q3)	; INSERTED IN OLD BUFFER
  3793	403657'	402 00 0 14 000031 		CLEARM	IOFLGS&IOBUBL(T4) ; ZAP OUT BUFF INDICATORS
  3794
  3795	403660'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  3796
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 90
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- LKP

  3797						SUBTTL	Quaternary routines -- LKP
  3798
  3799					;	LKP - LOOKUP A FILE
  3800					;	CALLS LOOKUP UUO
  3801					;	FILE MUST HAVE PREVIOUSLY BEEN OPENED
  3802					;
  3803					; CALLING SEQUENCE:
  3804					;	LOAD T4 WITH IOBLOK ADDR
  3805					;	JSP	QLINK,LKP
  3806					;	FAIL
  3807					;	RETURN
  3808
  3809
  3810	403661'	334 17 0 00 404040'	LKP:	SKIPA	Q3,[LOOKUP 0-0,FILNAM] ; LOAD UUO
  3811					;	JRST	ENTR+1		; JOIN ENTR PROCESSING
  3812
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 91
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- ENTR

  3813						SUBTTL	Quaternary routines -- ENTR
  3814
  3815					;	ENTR - ENTER A FILE NAME IN THE DIRECTORY
  3816					;	(CALLS ENTER UUO)
  3817					;
  3818					; CALLING SEQUENCE:
  3819					;	LOAD T4 WITH IOBLOK
  3820					;	JSP	QLINK,ENTR
  3821					;	ERROR (REFLECTED ERROR)
  3822					;	RETURN
  3823					;	FILE MUST HAVE BEEN PREVIOUSLY OPENED
  3824
  3825
  3826	403662'	200 17 0 00 404041'	ENTR:	MOVE	Q3,[ENTER 0-0,FILNAM] ; LOAD UUO
  3827
  3828						 ; HERE FROM LKP
  3829
  3830	403663'	434 17 0 14 000021 		IOR	Q3,IOCHAN(T4)	; CHANNEL #
  3831
  3832	403664'	505 16 0 14 000005 	ENTR2:	HRLI	Q2,IONAME(T4)	; FROM ADDRESS
  3833	403665'	541 16 0 00 403247*		HRRI	Q2,FILNAM	; TO ADDRESS
  3834	403666'	251 16 0 00 403251*		BLT	Q2,PPN		; TRANSFER GOODIES
  3835
  3836	403667'	505 16 0 14 000011 		HRLI	Q2,IOSFD(T4)	; FILL UP PTH USING ...
  3837	403670'	541 16 0 00 000000#		HRRI	Q2,PTH+2	;  WHATS IN IOSFD
  3838	403671'	251 16 0 00 000000*		BLT	Q2,PTHEND	; TO THE END
  3839
  3840	403672'	200 16 0 00 404042'		MOVE	Q2,[XWD	0,PTH]
  3841	403673'	336 00 0 00 000000#		SKIPN	PTH+2		; Do we want the default path?
  3842	403674'	402 00 0 00 000016 		CLEARM	Q2		; YES.
  3843	403675'	202 16 0 00 403666*		MOVEM	Q2,PPN		; PATH
  3844
  3845	403676'	256 00 0 00 000017 		XCT	Q3		; EXECUTE THE UUO
  3846	403677'	254 00 0 15 000000 		JRST	0(QLINK)	; COULDN'T ENTER OR LOCATE
  3847	403700'	254 00 0 15 000001 		JRST	1(QLINK)	; OK - COULD
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 92
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- MODE

  3848						SUBTTL	Quaternary routines -- MODE
  3849
  3850					;	MODE - RETURNS THE I/O MODE GIVEN THE FORMAT WORD
  3851					;	OF AN I/O DESCRIPTOR.
  3852					;
  3853					; CALLING SEQUENCE:
  3854					;	LOAD Z WITH FORMAT WORD
  3855					;	JSP	QLINK,MODE
  3856					;	RETURN WITH MODE IN Z
  3857
  3858	403701'	201 16 0 00 000001 	MODE:	MOVEI	Q2,.IOASL	; ASCII MODE (TENTATIVELY)
  3859	403702'	603 00 0 00 001000 		TXNE	Z,FMT.WM	;[246] BUT IF WORD MODE ...
  3860	403703'	201 16 0 00 000013 		MOVEI	Q2,.IOIBN	; USE IMAGE BINARY
  3861
  3862	403704'	200 00 0 00 000016 		MOVE	Z,Q2		; PASS TO RESULT REG.
  3863	403705'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  3864
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 93
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- MSTIME

  3865						SUBTTL	Quaternary routines -- MSTIME
  3866
  3867					;	MSTIME - EXTERNAL UTILITY
  3868
  3869	403706'	400 00 0 00 000000 	MSTIME::CLEAR	Z,		; CLEAR Z TO ...
  3870	403707'	047 00 0 00 000027 		RUNTIM	Z,		; GET THE TIME
  3871	403710'	254 00 0 15 000000 		JRST	0(QLINK)	; AND RETURN IT
  3872
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 94
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- OPN

  3873						SUBTTL	Quaternary routines -- OPN
  3874
  3875					;	OPN WILL OPEN A FILE ON THE NEXT AVAILABLE
  3876					;	CHANNEL. IT SHOULD NO ALREADY BE OPEN.
  3877					;
  3878					; CALLING SEQUENCE:
  3879					;	LOAD Z WITH MODE
  3880					;	LOAD T4 WITH IOBLOK ADDRESS
  3881					;	JSP	QLINK,OPN
  3882					;	ERROR (COULDN'T OPEN)
  3883					;	NORMAL
  3884
  3885	403711'	332 00 0 14 000021 	OPN:	SKIPE	IOCHAN(T4)	; ALREADY OPEN?
  3886	403712'	254 00 0 15 000001 		JRST	1(QLINK)	; YES
  3887
  3888	403713'	202 00 0 14 000002 		MOVEM	Z,IOMODE(T4)	; SET THE MODE
  3889
  3890	403714'	201 17 0 14 000022 		MOVEI	Q3,IOIBHD(T4)	; INBUF HEADER
  3891	403715'	505 17 0 14 000025 		HRLI	Q3,IOOBHD(T4)	; OUTBUF HEADER
  3892	403716'	202 17 0 14 000004 		MOVEM	Q3,IOBUFS(T4)	; OUTBUF,,INBUF WORD
  3893
  3894	403717'	200 17 0 14 000003 		MOVE	Q3,IODEV(T4)	; DETERMINE DEVICE
  3895	403720'	047 17 0 00 000004 		DEVCHR	Q3,		; CHARACTERISTICS
  3896
  3897	403721'	606 17 0 00 200000 		TRNN	Q3,200000	; IF ITS NOT ALREADY INITED?
  3898	403722'	254 00 0 00 403725'		JRST	OPN2		; THEN LET THE OPEN OCCUR
  3899	403723'	607 17 0 00 200010 		TLNN	Q3,200010	; ALSO IF ITS DISK OR TTY LET IT OPEN
  3900	403724'	001 14 0 00 000021 		ERROR	12,17		; NO - CAN'T OPEN DEVICE AGAIN.
  3901	403725'	402 00 0 14 000030 	OPN2:	CLEARM	IOLAST(T4)	; LAST CHAR READ IS VOID
  3902
  3903	403726'	201 00 0 00 777777 		MOVEI	Z,-1		; SETUP FOR TTY FLAG
  3904	403727'	603 17 0 00 000010 		TLNE	Q3,10		; IS DEVICE TTY?
  3905	403730'	506 00 0 14 000030 		HRLM	Z,IOTTY(T4)	; YES, SET FLAG
  3906
  3907						 ; FIND THE NEXT AVAILABLE CHANNEL (EXCEPT 0)
  3908
  3909	403731'	201 17 0 00 000001 		MOVEI	Q3,1		; DENOTES CHANNEL FOUND
  3910
  3911	403732'	200 16 0 00 000017 	OPN1:	MOVE	Q2,Q3		; COPY CHANNEL
  3912	403733'	301 16 0 00 000020 		CAIL	Q2,20		; WITHIN RANGE OF CHANNEL #'S
  3913	403734'	001 14 0 00 000017 		ERROR	12,15		; NO?
  3914
  3915	403735'	047 16 0 00 000004 		DEVCHR	Q2,		; ASK MONITOR ABOUT CHANNEL
  3916	403736'	332 00 0 00 000016 		SKIPE	Q2		; SKIP IF AVAILABLE
  3917	403737'	344 17 0 00 403732'		AOJA	Q3,OPN1		; TRY NEXT
  3918
  3919	403740'	242 17 0 00 000027 		LSH	Q3,^D23		; SHIFT NO. INTO AC POSITION
  3920	403741'	202 17 0 14 000021 		MOVEM	Q3,IOCHAN(T4)	; REMEMBER CHANNEL
  3921
  3922	403742'	434 17 0 00 404043'		IOR	Q3,[OPEN IOMODE(T4)]	; COMPLETE THE UUO
  3923	403743'	256 00 0 00 000017 		XCT	Q3		; EXECUTE THE OPEN UUO
  3924	403744'	254 00 0 15 000000 		JRST	0(QLINK)	; COULDN'T OPEN
  3925	403745'	254 00 0 15 000001 		JRST	1(QLINK)	; COULD OPEN
  3926
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 95
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- WMPROP

  3927						SUBTTL	Quaternary routines -- WMPROP
  3928
  3929					;	WMPROP - WORD MODE PROPERTIES
  3930					;
  3931					;	SETS PROPERTIES FOR CONVERSION TO TAKE PLACE. IS CALLED
  3932					;	BY CVTWD AND CVTDW. IT IS ASSUMED THAT FMT.WM BIT IS ON.
  3933					;
  3934
  3935					; CALLING SEQUENCE:
  3936					;
  3937					;	LOAD Z WITH A FORMAT
  3938					;	JSP	QLINK,WMPROP
  3939					;	RETURN - Z IS UNCHANGED
  3940
  3941	403746'	402 00 0 00 402367*	WMPROP:	CLEARM	BTLJFL##		; LEFT-JUSTIFY IS OFF
  3942	403747'	603 00 0 00 002000 		TXNE	Z,FMT.LJ	;[246] UNLESS BIT IS SET
  3943	403750'	476 00 0 00 403746*		SETOM	BTLJFL		; IN WHICH CASE WE SET IT ON
  3944
  3945	403751'	554 16 0 00 000000 		HLRZ	Q2,Z		; COPY FORMAT INTO Q2 RIGHT
  3946	403752'	405 16 0 00 000007 		ANDI	Q2,7		; LOW ORDER 3 BITS
  3947	403753'	200 17 0 16 401657'		MOVE	Q3,BTTBL(Q2)	; GET BASE-SIZE WORD ...
  3948						 ;			; FROM TABLE (SEE CVTFMT)
  3949	403754'	552 17 0 00 402371*		HRRZM	Q3,BTSIZE##	; ESTABLISH SIZE OF BYTE
  3950	403755'	556 17 0 00 402413*		HLRZM	Q3,BTBASE##	; BASE (LOWEST POSSIBLE CHAR)
  3951
  3952	403756'	201 16 0 00 000001 		MOVEI	Q2,1		; COMPUTE ...
  3953	403757'	242 16 0 17 000000 		LSH	Q2,0(Q3)	; 2 ** BTSIZE
  3954	403760'	202 16 0 00 402350*		MOVEM	Q2,BTMAX##	; = MAXIMUM BYTE VALUE
  3955
  3956	403761'	242 17 0 00 000030 		LSH	Q3,^D24		; MOVE SIZE INTO BITS 6-11
  3957	403762'	434 17 0 00 404044'		IOR	Q3,[POINT 0-0,T2] ; COMPLETE THE POINTER
  3958	403763'	202 17 0 00 402412*		MOVEM	Q3,BTPTR##	; (THE WORD IS EXPECTED IN T2)
  3959
  3960	403764'	201 16 0 00 000044 		MOVEI	Q2,^D36		; COMPUTE LENGTH
  3961	403765'	230 16 0 00 403754*		IDIV	Q2,BTSIZE	; OF STRING
  3962	403766'	202 16 0 00 402410*		MOVEM	Q2,BTLENG##	; CORRESPONDING TO WORD.
  3963
  3964	403767'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN
  3965
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 96
SNOFIO	MAC	15-Mar-69 11:20		Quaternary routines -- WMPROP

  3966
  3967			400367'		END	INIT

NO ERRORS DETECTED

HI-SEG. BREAK IS 404045
PROGRAM BREAK IS 000000
CPU TIME USED 35:36.016

48P CORE USED
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page S-1
SNOFIO	MAC	15-Mar-69 11:20		SYMBOL TABLE

ABSERR		400340'	int	CAT$		400161'	int	CVTFMT		401664'	int	DTCH$		400003'	int	
ADDRN		401337'		CDWSV		402336'	ext	CVTINT		401630'	ext	DTCH1		402433'		
AFILE		000004	sin	CEIL		401305'	ext	CVTIO		401743'		DTCH2		402421'		
AID		401070'	ext	CGCOL		401267'	ext	CVTIO1		401745'		DTNAME		402301'	ext	
ALBFSV		403632'	ext	CHECK		403200'	ext	CVTIO2		401753'		DTTP		400144'	ext	
ALBUF		403557'		CKA10		400461'		CVTNAM		402041'	ext	DTTP$		400141'	int	
ALBUF0		403565'		CKI10		400460'		CVTNUM		402325'	ext	DUMP		400073'	ext	
ALBUF1		403575'		CKL10		400457'		CVTPTR		403464'	ext	DUMP$		400070'	int	
ALBUF4		403612'		CLEAR		400142'	ext	CVTSI1		401765'		DUPL		400172'	ext	
ALBUF5		403622'		CLEAR$		400137'	int	CVTSI2		401762'		DUPL$		400167'	int	
ALBUF6		403617'		CLLCT		400100'	ext	CVTSIO		401757'	int	E1$100		000000	sin	
ALENG		000006	sin	CLLCT$		400075'	int	CVTST3		401771'		E1$105		000000	sin	
ALT		400102'	ext	CLOSE	070000	000000		CVTST4		402000'		E1$106		000000	sin	
ALT$		400077'	int	CLOSIO		401011'	int	CVTSTR		402334'	ext	E1$108		000000	sin	
ANY		400114'	ext	CLOSLP		401015'		CVTVAL		402260'	ext	E1$109		000000	sin	
ANY$		400111'	int	CLRFSV		403633'		CVTWD		402377'	int	E1$59		000000	sin	
AP.POV		200000	spd	CLS		403637'	int	CVTWD1		402404'		E1$62		000000	sin	
APPLY		400056'	ext	CLSAL1		402316'		CVTWD2		402412'		E1$69		000000	sin	
APPLY$		400053'	int	CLSALL		402315'	int	D$EXT		635657	spd	E1$70		000000	sin	
APRENB	047000	000016		CM.C		401155'		D$NAME	635657	425754	spd	E1$71		000000	sin	
ARBNO		400104'	ext	CM.C1		401161'		D$PRE		635657	spd	E1$90		000000	sin	
ARBNO$		400101'	int	CM.C2		401170'		DASSC		400335'	ext	E1$91		000000	sin	
ARG		400060'	ext	CM.C3		401172'		DASSC$		400332'	int	E11$13		000000	sin	
ARG$		400055'	int	CM.C4		401202'		DATA		400047'	ext	E11$3		000000	sin	
ARRAY		400226'	ext	CMSPEC		400526'		DATA$		400044'	int	E12$		000000	sin	
ARRAY$		400223'	int	CNCT		400326'	ext	DATE	047000	000014		E12$1		000000	sin	
ASBLOK		402744'	ext	CNCT$		400323'	int	DATE$		377777'	int	E12$10		000000	sin	
ASCI.0		400162'	ext	CNVA		400110'	ext	DATEE		401205'	int	E12$11		000000	sin	
ASCII$		400157'	int	CNVA$		400105'	int	DATES		401204'	int	E12$13		000000	sin	
ASGN		400071'	ext	CNVRT		400252'	ext	DCNCT		400330'	ext	E12$14		000000	sin	
ASGN$		400066'	int	CNVRT$		400247'	int	DCNCT$		400325'	int	E12$15		000000	sin	
ASGNVL		402250'	ext	CODE		400160'	ext	DDTCMD		400331'	ext	E12$16		000000	sin	
ASSC		400333'	ext	CODE$		400155'	int	DEL		401225'		E12$17		000000	sin	
ASSC$		400330'	int	COMPIN		402455'	ext	DELET$		400001'	int	E12$19		000000	sin	
AUTOHS		400735'	ext	COPY$		400227'	int	DEPTR		402746'	ext	E12$20		000000	sin	
AVAL		000002	sin	COPY0		400232'	ext	DETCH		401237'		E12$21		000000	sin	
BLENG		000000	sin	CORE	047000	000011		DEVCHR	047000	000004		E12$22		000000	sin	
BLOK		402032'	ext	CPDP6		400456'		DEVICE		403633'	ext	E12$23		000000	sin	
BLOKF		000400	sin	CPUTYP		400462'	ext	DEVNAM	047000	000064		E12$24		000000	sin	
BREAK		400120'	ext	CRTDAT		400315'	ext	DEVSIZ	047000	000101		E12$25		000000	sin	
BREAK$		400115'	int	CRTDT$		400315'	int	DFEXTS		400731'		E12$28		000000	sin	
BRKX		400122'	ext	CTBITS		000002	sin	DFF		400063'	ext	E12$29		000000	sin	
BRKX$		400117'	int	CURS		400140'	ext	DFF$		400063'	int	E12$3		000000	sin	
BTBASE		403755'	ext	CURS$		400135'	int	DFFR		400166'	ext	E12$30		000000	sin	
BTCODE		000000	sin	CURSOR		403236'	ext	DFFR$		400163'	int	E12$31		000000	sin	
BTLENG		403766'	ext	CVTDW		402322'	int	DFN		400054'	ext	E12$39		000000	sin	
BTLJFL		403750'	ext	CVTDW1		402333'		DFN$		400051'	int	E12$4		000000	sin	
BTMAX		403760'	ext	CVTDW2		402344'		DFTEXT		403266'	ext	E12$5		000000	sin	
BTPTR		403763'	ext	CVTDW3		402366'		DIFF		400300'	ext	E12$8		000000	sin	
BTSIZE		403765'	ext	CVTDW4		402356'		DIFF$		400275'	int	E12$9		000000	sin	
BTTBL		401657'	spd	CVTDW9		402374'		DIM4		400467'	ext	E13$52		000000	sin	
BUBITS		000002	sin	CVTFM1		401672'		DIV		400304'	ext	E13$61		000000	sin	
BUBLOK		000430	sin	CVTFM2		401702'		DIV$		400301'	int	E13$62		000000	sin	
C.PAR		404000'	ext	CVTFM3		401734'		DSPTBL		400000'	int	E13$63		000000	sin	
CAT		400164'	ext	CVTFM4		401667'		DTCH		402417'		E13$64		000000	sin	
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page S-2
SNOFIO	MAC	15-Mar-69 11:20		SYMBOL TABLE

E13$69		000000	sin	FINBF2		403002'		GT		400260'	ext	INITXY		400412'		
E13$9		000000	sin	FINBF4		402762'		GT$		400255'	int	INITXZ		400444'		
E15$		000000	sin	FINBF5		402775'		HGHVER		400411'	ext	INPUT$		400013'	int	
EFCAL$		400041'	int	FINBU1		403032'		HS%		000031	spd	INPUT0		401413'		
EFCALL		400041'	ext	FINBU2		403031'		HSBASE		401114'	ext	INTGR		400272'	ext	
EM.FL		401030'		FINBUF		403017'		HSR		000003		INTGR$		400267'	int	
EM.GR		401027'		FIOASC	432231	700000	spd	HSTACK		401113'	ext	INTRPT		400433'	ext	
EM.ST		401026'		FIOEDT		000303	spd	HTEST		400351'		IO.EOF		020000	spd	
EM.VT		401025'		FIOMIN		000000	spd	IABLOK		000426	sin	IOASSN		402025'		
EMPBUF		403552'		FIOSIX	465157	000000	spd	IALVL		000310	sin	IOBLKS		403272'	ext	
EMTBL		401025'		FIOVER		000005	spd	IBP		400320'	ext	IOBLOK		000415	sin	
ENDFIL		401243'		FIOWHO		000000	spd	IBP$		400315'	int	IOBUBL		000031	sin	
ENDFL$		400005'	int	FIRE.1		401316'		IDENT$		400165'	int	IOBUFS		000004	sin	
ENTER	077000	000000		FIREUP		401315'		IDENT0		400170'	ext	IOCHAN		000021	sin	
ENTR		403662'		FLAS		402060'	ext	IDT		002001	sin	IODEV		000003	sin	
ENTR2		403664'		FLDREF		400052'	ext	IGNOP		404011'	ext	IODT		004015	sin	
EQ		400264'	ext	FLDRF$		400052'	int	IGNOQ		401350'	ext	IOEXT		000006	sin	
EQ$		400261'	int	FLOOR		401100'	ext	IGNOS		402102'	ext	IOFLGS		000031	sin	
ERR	001000	000000		FMT.AP	010000	000000	spd	IGNOT		403456'	ext	IOIBHD		000022	sin	
ERR.	003000	000000		FMT.B	000001	000000	spd	ILOC		401263'	ext	IOINFL		400000	sin	
ERRA		400074'	ext	FMT.C	000200	000000	spd	IMVA		400106'	ext	IOLAST		000030	sin	
ERRA$		400074'	int	FMT.CP	004000	000000	spd	IMVA$		400103'	int	IOLENG		000033	sin	
ERRABS		400443'	ext	FMT.D	000010	000000	spd	IN	056000	000000		IOMODE		000002	sin	
EVAL		400240'	ext	FMT.LJ	002000	000000	spd	IN.SW		400551'		IONAME		000005	sin	
EVAL$		400235'	int	FMT.N	000400	000000	spd	IN.SW1		400570'		IONEXT		000032	sin	
EXERRV		000016		FMT.O	000002	000000	spd	IN.SW2		400600'		IOOBHD		000025	sin	
EXIT	047000	000012		FMT.S	002003	000000	spd	IN.SWH		400604'		IOOUFL		200000	sin	
EXIT$		400007'	int	FMT.T	000100	000000	spd	INBUF	064000	000000		IOPRIV		000007	sin	
EXIT0		401251'		FMT.U	002004	000000	spd	INCHRW	051000	000000		IOSFD		000011	sin	
EXIT1		401265'		FMT.WM	001000	000000	spd	INCHWL	051200	000000		IOTTY		000030	sin	
EXIT2		401301'		FNDPOS		402056'	ext	IND		400246'	ext	ISTART		401010'	ext	
EXITL		401327'		FRET1		401656'	ext	IND$		400243'	int	ITEM		400230'	ext	
EXITLE		401300'		FRSTNM		403102'	ext	INFILE		401766'	ext	ITEM$		400225'	int	
EXP		400306'	ext	FSAFL		000002	sin	INIMP		400415'	ext	JOBHGH		377770'	sin	
EXP$		400303'	int	FTDDT	777777	777777	spd	INIT		400367'		JOBNO6		400743'	ext	
EXPDAT		032117	spd	FTDEBU		000000	spd	INIT	041000	000000		KEYW		400045'	ext	
EXPTR		403542'	ext	FTOPS1	777777	777777	spd	INIT.7		400614'		KEYW$		400042'	int	
EXRECO		000003		FTOPS2		000000	spd	INIT.8		400650'		LABEL		400152'	ext	
EXT		403245'	ext	FTPAV	777777	777777	spd	INIT1		400422'		LABEL$		400147'	int	
F.FLG		000002	spd	FUNCF		000003	spd	INIT1A		400515'		LCLINK		000002	sin	
FCHECK		401365'		FUNCT		400146'	ext	INIT2		400531'		LE		400256'	ext	
FEAFL		000001	sin	FUNCT$		400143'	int	INIT21		400664'		LE$		400253'	int	
FID		400412'	ext	GCFLD		000001	sin	INIT22		400667'		LEN		400126'	ext	
FIELD		400051'	ext	GCOLF		403006'	ext	INIT23		400701'		LEN$		400123'	int	
FIELD$		400046'	int	GCOLG		403613'	ext	INIT24		400712'		LEQ		400174'	ext	
FILCH1		402454'		GE		400254'	ext	INIT25		400734'		LEQ$		400171'	int	
FILCH2		402450'		GE$		400251'	int	INIT29		400754'		LGE		400176'	ext	
FILCH4		402452'		GETOCT		402004'		INIT3		400532'		LGE$		400173'	int	
FILE		401360'		GETOSV		402024'	ext	INIT4		400536'		LGT		400200'	ext	
FILE$		400011'	int	GETPPN	047000	000024		INIT5		400547'		LGT$		400175'	int	
FILE1		401411'		GETSEG	047000	000040		INIT6		400606'		LHDR		000002	sin	
FILE2		401372'		GETSTS	062000	000000		INITR		400344'		LINE.		401215'	ext	
FILECH		402440'		GETTAB	047000	000041		INITT		400406'		LISTF		402001'	ext	
FILNAM		404041'	ext	GRID		403574'	ext	INITXW		400417'		LKP		403661'		
FINBF1		402754'		GSURF		403616'	ext	INITXX		400336'		LLE		400202'	ext	
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page S-3
SNOFIO	MAC	15-Mar-69 11:20		SYMBOL TABLE

LLE$		400177'	int	OBBLOK		000431	sin	READ		402466'	int	RVRS$		400213'	int	
LLT		400204'	ext	OPEN	050000	000000		READ1		402477'		RWND		401565'		
LLT$		400201'	int	OPN		403711'		READ1A		402504'		RWND$		400025'	int	
LNE		400206'	ext	OPN1		403732'		READ2		402515'		RWND1		401577'		
LNE$		400203'	int	OPN2		403725'		READ3		402532'		S.INP		400755'	ext	
LOAD		400040'	ext	OPSYN		400154'	ext	READ3A		402537'		S.OUT		400763'	ext	
LOAD$		400035'	int	OPSYN$		400151'	int	READ3B		402542'		S.PAR		404001'	ext	
LOCAL		400062'	ext	OUT	057000	000000		READ3C		402547'		S.TTY		401003'	ext	
LOCAL$		400057'	int	OUTBUF	065000	000000		READ4		402554'		S1		000006		
LOCVAL		402222'	ext	OUTCHR	051040	000000		READ5		402575'		S2		000007		
LOOKUP	076000	000000		OUTF		401754'	ext	READ5A		402600'		S3		000010		
LOWVER		000006	spd	OUTPT$		400017'	int	READ5B		402606'		SBLOK		000403	sin	
LPAD		400210'	ext	OUTPT0		401465'		READ5C		402617'		SBSTR		400222'	ext	
LPAD$		400205'	int	P1		000004		READ6		402623'		SBSTR$		400217'	int	
LREGP		000002	spd	P2		000005		READ6A		402627'		SCHARS		000002	sin	
LREGS		000003	spd	PATH.	047000	000110		READ6B		402632'		SDT		004003	sin	
LREGT		000004	spd	PDT		004004	sin	READ6C		402637'		SEGDEV		401345'	ext	
LT		400262'	ext	PEJECT		402462'	int	READ6D		402672'		SEGNAM		400403'	ext	
LT$		400257'	int	PJOB	047000	000030		READ6E		402704'		SEGPPN		400404'	ext	
LVTBL		401122'	ext	PLINK		000004		READ6F		402677'		SETMEM		401031'		
LWVRSN		401352'	ext	PLUS		400310'	ext	READ6G		402673'		SETMM1		401067'		
MAKEIO		403043'		PLUS$		400305'	int	REENTR		400000'		SETMM2		401062'		
MARGIN		000100	spd	PORTAL	254040	000000		REGP		000004	spd	SETNAM	047000	000043		
MINUS		400312'	ext	POS		400130'	ext	RELEAS	071000	000000		SETSTK		401145'		
MINUS$		400307'	int	POS$		400125'	int	REMDR		400270'	ext	SFDFIR		403177'		
MODE		403701'		PPL		000011	spd	REMDR$		400265'	int	SIZE		400220'	ext	
MSTIME		403706'	int	PPN		403675'	ext	RENAM		401502'		SIZE$		400215'	int	
MSTIME	047000	000023		PPR		403406'	ext	RENAM$		400021'	int	SKPINC	051540	000000		
MTABLE		401456'		PRIV		403365'	ext	RENAM1		401516'		SKPINL	051600	000000		
MTAPE$		400015'	int	PROTO		400314'	ext	RENAME	055000	000000		SLINK		000006		
MTAPE0		401430'	int	PROTO$		400311'	int	RESCAN	051400	000000		SORT		400234'	ext	
MTCH		400112'	ext	PSHR		403040'	ext	RESCN		401526'		SORT$		400231'	int	
MTCH$		400107'	int	PTH		404042'	ext	RESET	047000	000000		SPAN		400124'	ext	
MUL		400302'	ext	PTHEND		403671'	ext	RETNL1		401657'	ext	SPAN$		400121'	int	
MUL$		400277'	int	PTHPTR		403207'	ext	RETNUL		401654'	ext	SS%		000074	spd	
N.FLG		000001	spd	Q1		000015		RNLENG		000021	spd	STACK		000001		
NAME		400250'	ext	Q2		000016		RPAD		400212'	ext	STATZ	063000	000000		
NAME$		400245'	int	Q3		000017		RPAD$		400207'	int	STBASE		401110'	ext	
NARGSA		000002	spd	QLINK		000015		RPLC		400214'	ext	STBLKS		402165'	ext	
NDT		004011	sin	QUEST$		400241'	int	RPLC$		400211'	int	STBLOK		000432	sin	
NE		400266'	ext	RAND		400274'	ext	RPOS		400132'	ext	STBOMB		403406'		
NE$		400263'	int	RAND$		400271'	int	RPOS$		400127'	int	STCF		000003	sin	
NEG		400242'	ext	RBP		400322'	ext	RSCN$		400023'	int	STFILS		402074'		
NEG$		400237'	int	RBP$		400317'	int	RSCNE		401554'		STFL99		402167'		
NINS		402206'	ext	RD.S1A		402660'		RSCNL		401544'		STFLAG		400405'	ext	
NONBLK		402070'		RD.ST0		402641'		RSFLAG		401301'	ext	STFLS1		402077'		
NOUTS		402313'	ext	RD.ST1		402645'		RSORT		400236'	ext	STFLS2		402113'		
NS%		000017	spd	RD.ST2		402665'		RSORT$		400233'	int	STFLS3		402130'		
NSBASE		401121'	ext	RDFLGS		402715'	ext	RTAB		400134'	ext	STFLS4		402135'		
NSTACK		401120'	ext	RDLINK		403035'	ext	RTAB$		400131'	int	STFLS5		402145'		
NTNY		400116'	ext	RDQLNK		403015'	ext	RUN	047000	000035		STFLS6		402156'		
NTNY$		400113'	int	RDSTBL		403033'	ext	RUN$		400027'	int	STFLS9		402106'		
NULLST		402717'	ext	RDTTY		402722'		RUN0		401604'		STINIT		401762'	ext	
OABLOK		000427	sin	RDTTY1		402735'		RUNTIM	047000	000027		STIO1		403045'		
OALVL		000454	sin	RDTTYL		402743'		RVRS		400216'	ext	STIO11		403366'		
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page S-4
SNOFIO	MAC	15-Mar-69 11:20		SYMBOL TABLE

STIO12		403371'		TLINK		000011		WRIT99		403550'		
STIO13		403376'		TMPCOR	047000	000044		WRITE		403411'	int	
STIO2		403053'		TMPOPN		401172'	ext	XERRF		401140'	ext	
STIO3		403075'		TOOMCH		401053'	ext	XWD22		403550'	ext	
STIO35		403105'		TRACE		400067'	ext	Y.ALT		004000	spd	
STIO4		403127'		TRACE$		400064'	int	Y.BL	200000	000000	spd	
STIO40		403151'		TRCFN3		400316'	ext	Y.CM	001000	000000	spd	
STIO4A		403215'		TRCFN4		400316'	int	Y.CR		010000	spd	
STIO4B		403217'		TRFLGS		401316'	ext	Y.CZ		000400	spd	
STIO5		403225'		TRIM		400150'	ext	Y.EQ		040000	spd	
STIO6		403235'		TRIM$		400145'	int	Y.LA	000001	000000	spd	
STIO7		403277'		TRIMT		402217'	ext	Y.LOWS		200000	spd	
STIO7A		403327'		TTY		401642'		Y.NUM	000040	000000	spd	
STIO7B		403334'		TTY$		400033'	int	Y.PER	000100	000000	spd	
STIO8		403342'		TTY1		401655'		Y.SLSH		002000	spd	
STIO9		403344'		TTYBLK		403560'	ext	Y.TAB	400000	000000	spd	
STIO98		403260'		TVAR		034000	sin	Y.UPS		400000	spd	
STIO99		403240'		TVASGN		402240'		Y.VM		020000	spd	
STIO9B		403365'		TVFTCH		402254'		Z		000000		
STIO9I		403272'		TVIN		402171'		$ALPHA		402551'	ext	
STIOBL		000004	sin	TVNAME		402231'		$DDCMD		400331'	int	
STIONL		403404'		TVOUT		402174'		$FNCLV		400341'	ext	
STNSFD		403167'		TVRD1		402216'		$JOBNO		400420'	ext	
STNXT		000002	sin	TVRD2		402220'		$OUTPT		402263'	ext	
STOPTR		400065'	ext	TVREAD		402177'		$REE		400366'		
STPTR		403237'	ext	TVWRIT		402263'		$REENT		400356'		
STPTR$		400062'	int	TVWRT1		402300'		$STCNT		000000	ext	
STR.		400654'	ext	TVWRT2		402307'		$STNO		400340'	ext	
STR.C		402071'	ext	UNDEF		400156'	ext	$TRACE		400360'	ext	
STRIO		403037'		UNDEF$		400153'	int	$TRIM		402216'	ext	
STRMC		403202'	ext	UNLD		400043'	ext	%%JOBD	043100	000450	spd	
STXT		400076'	ext	UNLD$		400040'	int	%%MACT	000200	000025	spd	
STXT$		400073'	int	USETI	074000	000000		%%SNOP	000500	000305	spd	
SUBJ		400705'	ext	V.PAR		404002'	ext	%%UUOS	001400	000457	spd	
SUM		400276'	ext	VAR		064000	sin	..0004		400456'		
SUM$		400273'	int	VARSIZ		000007	sin	.CHCNZ		000032	spd	
SURF		000002		VERSIO	000500	000305	spd	.CHFFD		000014	spd	
SYSCT		403050'	ext	VTABLE		401124'	ext	.CHLFD		000012	spd	
SYSTR		401002'	ext	WHERE$		400321'	int	.IOASL		000001	spd	
T1		000011		WHERE0		400324'	ext	.IOIBN		000013	spd	
T2		000012		WMPROP		403746'		.JB41		000041		
T3		000013		WRDNT		403433'		.JBAPR		000125		
T4		000014		WRDONT		403422'		.JBFF		000121		
TAB		400136'	ext	WRIT1		403435'		.JBHDA		000010	spd	
TAB$		400133'	int	WRIT11		403454'		.JBHGH		400000	spd	
TABLE		400224'	ext	WRIT1A		403457'		.JBHVR		000004	spd	
TABLE$		400221'	int	WRIT2		403463'		.JBOPC		000130		
TERMCH		403635'	ext	WRIT3		403470'		.JBREN		000124		
TIME$		400031'	int	WRIT4		403476'		.JBSA		000120		
TIME.C		401635'	ext	WRIT4A		403502'		.JBVER		000137		
TIME.E		401323'	ext	WRIT4B		403515'		.PTFRD	777777	777777	spd	
TIME.S		401325'	ext	WRIT5		403523'		.SGDEV		000011	spd	
TIME0		401630'		WRIT6		403531'		.SGNAM		000000	spd	
TIME1		401637'		WRIT7		403537'		.SGPPN		000007	spd	
TIME2		401640'		WRIT9		403545'		

SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

ABSERR	   426#
ADDRN	  1414	  1427#	  1450
AFILE	  2056	  2057	  2244	  2245	  2330	  2354
AID	   497	  1085
ALBFSV	  3686	  3748
ALBUF	  2679	  3504	  3686#
ALBUF0	  3688	  3694#
ALBUF1	  3707#	  3716
ALBUF4	  3708	  3725#
ALBUF5	  3738#
ALBUF6	  3721	  3732#
ALENG	  2046
ALT	   246
ALT$	   245	   245#
ANY	   256
ANY$	   255	   255#
AP.POV	   567
APPLY	   226
APPLY$	   225	   225#
ARBNO	   248
ARBNO$	   247	   247#
ARG	   228
ARG$	   227	   227#
ARRAY	   335
ARRAY$	   334	   334#
ASBLOK	  1638	  2511	  2743	  2959
ASCI.0	   299
ASCII$	   298	   298#
ASGN	   237
ASGN$	   236	   236#
ASGNVL	  2304
ASSC	   409
ASSC$	   408	   408#
AUTOHS	   733	   888
AVAL	  2091	  2095	  2271	  2287	  2299	  2315	  2316	  2556	  2557
BLENG	   754	  1669	  1670	  1688	  2158	  2182	  2183	  2206	  2651	  2915	  2916	  3026	  3405	  3711
	  3734
BLOK	  2047
BLOKF	  3712
BREAK	   260
BREAK$	   259	   259#
BRKX	   262
BRKX$	   261	   261#
BTBASE	  2447	  2518	  3950
BTCODE	   754	  2158	  2544	  3405	  3711	  3734	  3792
BTLENG	  2465	  2510	  2514	  3962
BTLJFL	  2474	  3941	  3943
BTMAX	  2452	  3954
BTPTR	  2460	  2517	  3958
BTSIZE	  2455	  2477	  3949	  3961
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

BTTBL	  1817#	  3947
BUBITS	  3699	  3738
BUBLOK	  3733
C.PAR	   691	  1055
CAT	   301
CAT$	   300	   300#
CDWSV	  2413	  2424	  2433
CEIL	  1095	  1377
CGCOL	  1349
CHECK	  3114	  3155	  3168	  3242
CKA10	   544	   555#
CKI10	   547	   554#
CKL10	   548	   553#
CLEAR	   278
CLEAR$	   277	   277#
CLLCT	   244
CLLCT$	   243	   243#
CLOSIO	   955#
CLOSLP	   959#	   966
CLRFSV	   892	  1139	  1289	  3101	  3755#
CLS	  1295	  1320	  1504	  1610	  1623	  1700	  2394	  2592	  2667	  3007	  3057	  3489	  3769#
CLSAL1	  2393#	  2396
CLSALL	   430	  1368	  1720	  2391#
CM.C	   665	   685	   709	  1189#	  1196	  1216
CM.C1	  1196#	  1209	  1224
CM.C2	  1189	  1208#
CM.C3	  1191	  1213#
CM.C4	  1214	  1223#
CMSPEC	   599	   646#
CNCT	   400
CNCT$	   399	   399#
CNVA	   252
CNVA$	   251	   251#
CNVRT	   355
CNVRT$	   354	   354#
CODE	   297
CODE$	   296	   296#
COMPIN	   829	   834	  2599
COPY$	   338	   338#
COPY0	   339
CPDP6	   542	   551#
CPUTYP	   565
CRTDAT	   390
CRTDT$	   390#
CTBITS	  1201	  1655	  2833
CURS	   276
CURS$	   275	   275#
CURSOR	   816	  2017	  3126	  3147	  3161	  3188	  3205	  3239	  3261	  3277	  3288
CVTDW	  1327	  2011	  2349	  2413#	  3129	  3140	  3175	  3249
CVTDW1	  2416	  2429#
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

CVTDW2	  2446#	  2466
CVTDW3	  2464	  2472#
CVTDW4	  2453	  2460#
CVTDW9	  2439	  2484#
CVTFM1	  1833	  1843#
CVTFM2	  1857#	  1897
CVTFM3	  1889	  1896#
CVTFM4	  1837#	  1849
CVTFMT	  1511	  1536	  1578	  1831#
CVTINT	  1331	  1346	  1540	  1708	  1740
CVTIO	  1315	  1480	  1581	  1717	  1918#
CVTIO1	  1921#
CVTIO2	  1922	  1932#
CVTNAM	  1304	  2061
CVTNUM	  2334	  2418
CVTPTR	  1644	  1764	  1847	  2437	  2750	  3544
CVTSI1	  1958	  1961#
CVTSI2	  1957#
CVTSIO	   936	  1456	  1515	  1682	  1953#
CVTST3	  1955	  1968#	  1983
CVTST4	  1970	  1980#
CVTSTR	  1575	  1761	  1843	  1918	  1954	  2342	  2431
CVTVAL	  2318
CVTWD	  2259	  2499#
CVTWD1	  2500	  2508#
CVTWD2	  2517#	  2520
D$EXT	  2602
D$NAME	   481
D$PRE	   606	   629
DASSC	   411
DASSC$	   410	   410#
DATA	   219
DATA$	   218	   218#
DATE$	   181	   181#
DATEE	  1258#
DATES	   182	  1257#
DCNCT	   402
DCNCT$	   401	   401#
DDTCMD	   403
DEL	   184	  1285#
DELET$	   183	   183#
DEPTR	  2754	  2840	  2866	  2961
DETCH	   186	  1304#
DEVICE	   894	  1141	  3104	  3131	  3294	  3319	  3755	  3756
DFEXTS	   851	   879#
DFF	   231
DFF$	   231#
DFFR	   303
DFFR$	   302	   302#
DFN	   224
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

DFN$	   223	   223#
DFTEXT	   856	   883	  3158	  3328
DIFF	   377
DIFF$	   376	   376#
DIM4	   573
DIV	   381
DIV$	   380	   380#
DSPTBL	   177	   179#
DTCH	  1307	  2065	  2534#
DTCH$	   185	   185#
DTCH1	  2547	  2556#
DTCH2	  2539#	  2552	  2560
DTNAME	  2343
DTTP	   280
DTTP$	   279	   279#
DUMP	   239
DUMP$	   238	   238#
DUPL	   307
DUPL$	   306	   306#
E1$100	  1762#
E1$105	  2419#
E1$106	  2432#
E1$108	  1919#
E1$109	  2335#
E1$59	  1332#	  1347#
E1$62	  1305#
E1$69	  2062#
E1$70	  1972#
E1$71	  1576#	  1844#
E1$90	  1709#
E1$91	  1741#
E11$13	  2512#
E11$3	  1639#	  2744#	  2960#
E12$	  1221#
E12$1	   600#
E12$10	  1088#
E12$11	   703#
E12$13	   825#	   860#	  1316#	  1516#	  1582#	  1683#
E12$14	   865#
E12$15	  3913#
E12$16	  1293#
E12$17	  3900#
E12$19	  2686#	  3512#
E12$20	  2935#
E12$21	  1660#
E12$22	  3495#	  3501#
E12$23	  2587#	  2673#
E12$24	  3569#
E12$25	  1733#
E12$28	  1494#	  3697#
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

E12$29	  1894#
E12$3	  1620#
E12$30	   826#	  2676#
E12$31	  2944#
E12$39	  2737#	  3518#	  3521#
E12$4	  2249#	  3002#	  3049#
E12$5	  2357#	  3653#
E12$8	   588#
E12$9	  3778#
E13$52	  1715#	  1718#
E13$61	  1770#
E13$62	  1905#
E13$63	  2450#	  2457#
E13$64	  2350#
E13$69	  1481#	  1486#
E13$9	  1541#	  1545#
E15$	   551#	   800#	   811#	   849#	   901#	   937#	   938#	  1144#	  1429#	  1436#	  1517#	  1646#	  1684#	  2048#
	  2260#	  2752#	  3372#
EFCAL$	   213#
EFCALL	   213
EM.FL	  1002#	  1041
EM.GR	  1001#	  1039
EM.ST	  1000#	  1035
EM.VT	   999#	  1032
EMPBUF	  3538	  3574	  3607	  3615	  3635	  3649#
EMTBL	   998#	  1076
ENDFIL	   188	  1315#
ENDFL$	   187	   187#
ENTR	  3500	  3520	  3826#
ENTR2	  3832#
EQ	   365
EQ$	   364	   364#
ERRA	   240
ERRA$	   240#	   519
ERRABS	   534
EVAL	   345
EVAL$	   344	   344#
EXERRV	   446	  1440	  1445#
EXIT$	   189	   189#
EXIT0	   190	  1326#
EXIT1	  1336	  1346#
EXIT2	  1370#
EXITL	  1386	  1413#
EXITLE	  1358	  1368#
EXP	   383
EXP$	   382	   382#
EXPDAT	   584#	   587
EXPTR	  3548	  3596	  3617	  3627
EXRECO	  1417	  1419	  1431#
EXT	   899	  3177	  3296	  3302
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

F.FLG	  2695#	  2853	  2879
FCHECK	  1286	  1474#	  1537	  1599	  1608
FEAFL	   181	   183	   185	   187	   189	   191	   193	   195	   197	   199	   201	   203	   205	   207
	   209	   211	   214	   218	   220	   223	   227	   229	   232	   234	   238	   241	   243	   245
	   247	   255	   257	   259	   261	   263	   265	   267	   269	   271	   273	   277	   279	   281
	   283	   289	   292	   296	   298	   300	   302	   304	   306	   308	   310	   312	   314	   316
	   318	   320	   322	   324	   326	   328	   330	   332	   334	   336	   338	   340	   342	   344
	   348	   350	   354	   356	   358	   360	   362	   364	   366	   368	   370	   372	   374	   376
	   378	   380	   382	   384	   386	   388	   393	   395	   397	   399	   401	   408	   410
FID	   495	   496
FIELD	   221
FIELD$	   220	   220#
FILCH1	  2590	  2598#
FILCH2	  2589#	  2605
FILCH4	  2592#	  2600
FILE	   192	  1455#
FILE$	   191	   191#
FILE1	  1497	  1504#
FILE2	  1476	  1480#
FILECH	  2138	  2577#
FILNAM	   897	  1291	  3142	  3295	  3304	  3756	  3810	  3826	  3833
FINBF1	  2768	  2798	  2828	  2982#
FINBF2	  2993	  3017#
FINBF4	  2983	  2990#
FINBF5	  3004	  3007#
FINBU1	  2724	  2953	  3057#
FINBU2	  2861	  2988	  3005	  3055#
FINBUF	  2703	  2717	  3037#
FIOASC	    32#
FIOEDT	    25#
FIOMIN	    24#
FIOSIX	    31#
FIOVER	    23#
FIOWHO	    26#
FIRE.1	  1364	  1398#
FIREUP	   526	  1396#
FLAS	  2050	  2051	  2055	  2088
FLDREF	   222
FLDRF$	   222#
FLOOR	  1097
FMT.AP	   439	  1886	  2736	  3484	  3496	  3514
FMT.B	  1874
FMT.C	  1868	  2620	  2709	  2946	  3552
FMT.CP	  1891	  1902	  2647	  2901	  3603
FMT.D	  1871	  2331	  2415	  2499
FMT.LJ	  3942
FMT.N	   833	  1865	  2790	  3565
FMT.O	  1877	  2010
FMT.S	  1326	  1880	  3128	  3139	  3174	  3248
FMT.T	  1862	  2898	  3558	  3623
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

FMT.U	  1883
FMT.WM	  1326	  1871	  1874	  1877	  1880	  1883	  1902	  2254	  2345	  2699	  2934	  3128	  3139	  3174
	  3248	  3528	  3859
FNDPOS	  2081
FRET1	  1458	  1600	  1605	  1633	  1779
FRSTNM	  3143	  3144
FSAFL	   183	   189	   191	   193	   195	   197	   199	   201	   203	   205	   207	   209	   211	   214
	   220	   223	   227	   229	   232	   236	   238	   243	   245	   249	   251	   253	   277	   289
	   292	   296	   300	   302	   304	   306	   308	   310	   312	   314	   316	   318	   324	   332
	   334	   340	   342	   356	   358	   360	   362	   364	   366	   368	   370	   372	   374	   376
	   378	   380	   382	   384	   386	   393	   395	   397	   399	   401	   408	   410
FTDDT	   285	   288	   392
FTDEBU	   586	  3090	  3440	  3457
FTOPS1	    12	    40	   475	   786	   974	  1259	  1362
FTOPS2	    13	    41	   787	   976	  1363
FTPAV	   407	  2071
FUNCF	   181#	   181	   183#	   183	   185#	   185	   187#	   187	   189#	   189	   191#	   191	   193#	   193
	   195#	   195	   197#	   197	   199#	   199	   201#	   201	   203#	   203	   205#	   205	   207#	   207
	   209#	   209	   211#	   211	   214#	   214	   216#	   216	   218#	   218	   220#	   220	   223#	   223
	   225#	   225	   227#	   227	   229#	   229	   232#	   232	   234#	   234	   236#	   236	   238#	   238
	   241#	   241	   243#	   243	   245#	   245	   247#	   247	   249#	   249	   251#	   251	   253#	   253
	   255#	   255	   257#	   257	   259#	   259	   261#	   261	   263#	   263	   265#	   265	   267#	   267
	   269#	   269	   271#	   271	   273#	   273	   275#	   275	   277#	   277	   279#	   279	   281#	   281
	   283#	   283	   289#	   289	   292#	   292	   294#	   294	   296#	   296	   298#	   298	   300#	   300
	   302#	   302	   304#	   304	   306#	   306	   308#	   308	   310#	   310	   312#	   312	   314#	   314
	   316#	   316	   318#	   318	   320#	   320	   322#	   322	   324#	   324	   326#	   326	   328#	   328
	   330#	   330	   332#	   332	   334#	   334	   336#	   336	   338#	   338	   340#	   340	   342#	   342
	   344#	   344	   346#	   346	   348#	   348	   350#	   350	   352#	   352	   354#	   354	   356#	   356
	   358#	   358	   360#	   360	   362#	   362	   364#	   364	   366#	   366	   368#	   368	   370#	   370
	   372#	   372	   374#	   374	   376#	   376	   378#	   378	   380#	   380	   382#	   382	   384#	   384
	   386#	   386	   388#	   388	   393#	   393	   395#	   395	   397#	   397	   399#	   399	   401#	   401
	   408#	   408	   410#	   410
FUNCT	   282
FUNCT$	   281	   281#
GCFLD	   750	  2159	  3407	  3408	  3409	  3732
GCOLF	  3023
GCOLG	  2154	  3398	  3726
GE	   357
GE$	   356	   356#
GETOCT	  1996#	  3190	  3208	  3279
GETOSV	  1996	  2015	  2020
GRID	   771	  1103	  3701
GSURF	  1104	  2155	  2207	  3400	  3402	  3707	  3728	  3730
GT	   361
GT$	   360	   360#
HGHVER	   442	   492
HS%	  1007#	  1113
HSBASE	  1116
HSR	  1117
HSTACK	  1115
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

HTEST	   438	   442#
IABLOK	   916	   939	  1524	  2077	  2545
IALVL	  2078
IBP	   394
IBP$	   393	   393#
IDENT$	   304	   304#
IDENT0	   305
IDT	  1273	  1275	  1277	  1832	  2502
IGNOP	   659	   670	  1263	  1267	  1273	  1275	  1354	  1355	  1401	  1474	  1491	  1601	  1616	  1722
	  1723	  1731	  1732
IGNOQ	  1070	  1077	  1433	  1437
IGNOS	   615	   619	   648	   823	  1190	  1192	  1953	  2038	  2042	  2064	  2076	  2093	  2129	  2130
	  2136	  2139	  2150	  2221
IGNOT	  1053	  1066	  1084	  1086	  1093	  2822	  2848	  2896	  2899	  3480	  3535
ILOC	  1341
IMVA	   250
IMVA$	   249	   249#
IN.SW	   667	   685#
IN.SW1	   709#	   715	   720	   734
IN.SW2	   712	   724#
IN.SWH	   700	   733#
IND	   351
IND$	   350	   350#
INFILE	   830	   913	  1520	  1962
INIMP	   499
INIT	   445	   465#	   641	   785	   972	  3967
INIT.7	   739	   744#
INIT.8	   783	   799#
INIT1	   509#	   512
INIT1A	   610	   625#
INIT2	   595	   652#
INIT21	   806	   816#
INIT22	   812	   823#
INIT23	   840#
INIT24	   855#	   875
INIT25	   844	   873	   883#
INIT29	   890	   910#
INIT3	   622	   642	   656#
INIT4	   665#	   676	   679	   729
INIT5	   678#
INIT6	   673	   738#
INITR	   436#	  1442
INITT	   473	   488#
INITXW	   489	   503#
INITXX	   418#	  1447
INITXY	   419	   431	   495#
INITXZ	   530	   535#
INPUT$	   193	   193#
INPUT0	   194	  1511#
INTGR	   371
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

INTGR$	   370	   370#
INTRPT	   522
IO.EOF	  1220
IOASSN	   917	   927	   940	   947	  1525	  1590	  2038#
IOBLKS	  1136	  2391	  3337
IOBLOK	  3404
IOBUBL	  3719	  3729	  3788	  3793
IOBUFS	  3892
IOCHAN	  1290	  1488	  1546	  1552	  1617	  2940	  2990	  2997	  3037	  3044	  3523	  3649	  3746	  3769
	  3775	  3780	  3784	  3830	  3885	  3920
IODEV	  1726	  3354	  3412	  3435	  3894
IODT	  1971	  2209	  3429
IOEXT	  2598	  2603	  3362	  3414
IOFLGS	  2580	  2661	  2937	  3481	  3691	  3694	  3742	  3793
IOIBHD	  2702	  2704	  2716	  2718	  2739	  2767	  2769	  2773	  2782	  2797	  2799	  2827	  2829	  2962
	  3020	  3029	  3890
IOINFL	  2662	  2678	  3690
IOLAST	  2712	  2713	  2757	  2892	  3901
IOLENG	  3397	  3410
IOMODE	  1152	  2685	  3510	  3695	  3888	  3922
IONAME	  1618	  1727	  1728	  3359	  3413	  3438	  3832
IONEXT	  2395	  3391
IOOBHD	  3537	  3539	  3573	  3575	  3576	  3583	  3586	  3592	  3597	  3606	  3608	  3614	  3618	  3891
IOOUFL	  3482	  3503	  3743
IOPRIV	  3377	  3426
IOSFD	  3366	  3373	  3386	  3419	  3420	  3836
IOTTY	  1154	  2723	  2857	  3633	  3905
ISTART	   949
ITEM	   337
ITEM$	   336	   336#
JOBHGH	   177#
JOBNO6	   514	   628	   895
KEYW	   217
KEYW$	   216	   216#
LABEL	   290
LABEL$	   289	   289#
LCLINK	  1342
LE	   359
LE$	   358	   358#
LEN	   266
LEN$	   265	   265#
LEQ	   309
LEQ$	   308	   308#
LGE	   311
LGE$	   310	   310#
LGT	   313
LGT$	   312	   312#
LHDR	  2551
LINE.	  1271
LISTF	   437	   440	   889	   902	   903	  1981	  1982
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

LKP	  1496	  2589	  2675	  3517	  3810#
LLE	   315
LLE$	   314	   314#
LLT	   317
LLT$	   316	   316#
LNE	   319
LNE$	   318	   318#
LOAD	   212
LOAD$	   211	   211#
LOCAL	   230
LOCAL$	   229	   229#
LOCVAL	  2272
LOWVER	  1438
LPAD	   321
LPAD$	   320	   320#
LREGP	  3090	  3440	  3457
LREGS	  3090	  3440	  3457
LREGT	  3090	  3440	  3457
LT	   363
LT$	   362	   362#
LVTBL	  1126
LWVRSN	  1439
MAKEIO	   900	  1143	  3095#
MARGIN	  1094	  1096	  1378	  1381
MINUS	   387
MINUS$	   386	   386#
MODE	  1492	  2584	  2670	  2683	  3492	  3509	  3858#
MSTIME	  1351	  1404	  1746	  3869#
MTABLE	  1551	  1563#
MTAPE$	   195	   195#
MTAPE0	   196	  1536#
MTCH	   254
MTCH$	   253	   253#
MUL	   379
MUL$	   378	   378#
N.FLG	  2694#	  2785
NAME	   353
NAME$	   352	   352#
NARGSA	   181#	   181	   183#	   183	   185#	   185	   187#	   187	   189#	   189	   191#	   191	   193#	   193
	   195#	   195	   197#	   197	   199#	   199	   201#	   201	   203#	   203	   205#	   205	   207#	   207
	   209#	   209	   211#	   211	   214#	   214	   216#	   216	   218#	   218	   220#	   220	   223#	   223
	   225#	   225	   227#	   227	   229#	   229	   232#	   232	   234#	   234	   236#	   236	   238#	   238
	   241#	   241	   243#	   243	   245#	   245	   247#	   247	   249#	   249	   251#	   251	   253#	   253
	   255#	   255	   257#	   257	   259#	   259	   261#	   261	   263#	   263	   265#	   265	   267#	   267
	   269#	   269	   271#	   271	   273#	   273	   275#	   275	   277#	   277	   279#	   279	   281#	   281
	   283#	   283	   289#	   289	   292#	   292	   294#	   294	   296#	   296	   298#	   298	   300#	   300
	   302#	   302	   304#	   304	   306#	   306	   308#	   308	   310#	   310	   312#	   312	   314#	   314
	   316#	   316	   318#	   318	   320#	   320	   322#	   322	   324#	   324	   326#	   326	   328#	   328
	   330#	   330	   332#	   332	   334#	   334	   336#	   336	   338#	   338	   340#	   340	   342#	   342
	   344#	   344	   346#	   346	   348#	   348	   350#	   350	   352#	   352	   354#	   354	   356#	   356
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

	   358#	   358	   360#	   360	   362#	   362	   364#	   364	   366#	   366	   368#	   368	   370#	   370	   372#
	   372	   374#	   374	   376#	   376	   378#	   378	   380#	   380	   382#	   382	   384#	   384	   386#
	   386	   388#	   388	   393#	   393	   395#	   395	   397#	   397	   399#	   399	   401#	   401	   408#
	   408	   410#	   410
NDT	  2285
NE	   367
NE$	   366	   366#
NEG	   347
NEG$	   346	   346#
NINS	  2252
NONBLK	  1998	  2005	  2108#	  3110	  3119	  3133	  3164	  3181	  3201	  3231	  3269
NOUTS	  2359
NS%	  1008#	  1119
NSBASE	  1122
NSTACK	   656	   744	  1121
NTNY	   258
NTNY$	   257	   257#
NULLST	   456	  1604	  1714	  2924
OABLOK	   926	   946	  1585	  2079	  2546
OALVL	  2080
OBBLOK	  3700	  3791
OPN	  1493	  2586	  2672	  3494	  3885#
OPN1	  3911#	  3917
OPN2	  3898	  3901#
OPSYN	   293
OPSYN$	   292	   292#
OUTF	   841	   843	   923	  1587	  1933	  1934
OUTPT$	   197	   197#
OUTPT0	   198	  1575#
P1	   442	   444	   467	   468	   530	   532	   533	   595	   843	   862	   864	   869	  1189	  1434
	  1435	  1438	  1439	  1445
P2	   418	   427	   428	   443	   444	   572	   573	   587	   744	   745	   750	   754	   759	   805
	   819	   844	   851	   855	   857	  1259	  1261	  1265	  1269	  1277	  1286	  1422	  1428	  1478
	  1489	  1500	  1505	  1512	  1518	  1520	  1522	  1537	  1542	  1543	  1544	  1551	  1579	  1583
	  1587	  1589	  1599	  1608	  1616	  1617	  1622	  1710	  1728	  1729
PDT	  1969
PEJECT	  2620#
PLINK	  1279	  1287	  1457	  1550	  1611	  1674	  1755	  1773
PLUS	   385
PLUS$	   384	   384#
POS	   268
POS$	   267	   267#
PPL	  3090#	  3090	  3091	  3440#	  3440	  3441	  3457#	  3457	  3458
PPN	  3191	  3199	  3209	  3215	  3266	  3297	  3307	  3834	  3843
PPR	  3440	  3457
PRIV	  3281	  3298	  3422
PROTO	   389
PROTO$	   388	   388#
PSHR	  3090
PTH	  3253	  3256	  3264	  3267	  3312	  3315	  3332	  3335	  3369	  3370	  3374	  3380	  3384	  3418
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

	  3837	  3840	  3841
PTHEND	  3256	  3370	  3380	  3838
PTHPTR	  3225	  3230	  3252
Q1	   605	   609	   614	   615	   634	   758	   759	   762	   956	   963	   964	  1041	  1052	  1096
	  1398	  1399	  1603	  1604	  1653	  1654	  1655	  1656	  1657	  1668	  1669	  1670	  1726	  1727
	  1768	  1769	  1851	  1893	  2067	  2069	  2075	  2082	  2090	  2094	  2187	  2192	  2196	  2544
	  2545	  2546	  2602	  2603	  2651	  2652	  2661	  2662	  2773	  2774	  2775	  2782	  2783	  2786
	  2789	  2832	  2833	  2834	  2845	  2863	  2869	  2872	  2883	  2914	  2915	  2916	  3263	  3264
	  3266	  3267	  3298	  3377	  3422	  3426	  3710	  3713	  3714	  3718	  3742	  3743
Q2	   617	   618	   619	   634	   760	   776	   777	   780	   958	   966	  1049	  1050	  1051	  1052
	  1053	  1062	  1067	  1072	  1076	  1079	  1080	  1084	  1085	  1086	  1087	  1093	  1094	  1095
	  1096	  1097	  1098	  1102	  1103	  1104	  1127	  1128	  1129	  1176	  1177	  1200	  1201	  1202
	  1219	  1666	  1667	  1670	  1671	  2006	  2008	  2014	  2015	  2068	  2069	  2188	  2193	  2197
	  2271	  2273	  2274	  2277	  2278	  2441	  2462	  2463	  2465	  2477	  2478	  2712	  2713	  2718
	  2719	  2721	  2728	  2729	  2731	  2757	  2769	  2777	  2799	  2829	  2831	  2833	  2840	  2854
	  2860	  2866	  2880	  2892	  2912	  2913	  2916	  2917	  2951	  2952	  2963	  2984	  2985	  2990
	  2991	  2992	  2997	  2998	  2999	  3008	  3020	  3021	  3022	  3025	  3026	  3029	  3030	  3037
	  3038	  3039	  3044	  3045	  3046	  3122	  3184	  3193	  3196	  3220	  3221	  3234	  3235	  3274
	  3287	  3302	  3303	  3314	  3315	  3319	  3320	  3332	  3333	  3354	  3355	  3357	  3368	  3369
	  3370	  3371	  3380	  3381	  3384	  3388	  3418	  3419	  3420	  3428	  3429	  3443	  3451	  3535
	  3539	  3592	  3594	  3596	  3597	  3617	  3618	  3626	  3627	  3695	  3696	  3698	  3699	  3700
	  3715	  3720	  3725	  3728	  3729	  3732	  3734	  3738	  3741	  3744	  3746	  3747	  3791	  3792
	  3832	  3833	  3834	  3836	  3837	  3838	  3840	  3842	  3843	  3858	  3860	  3862	  3911	  3912
	  3915	  3916	  3945	  3946	  3947	  3952	  3953	  3954	  3960	  3961	  3962
Q3	   454	   455	   456	   457	   567	   568	   569	   666	   675	   678	   687	   688	   690	   693
	   696	   699	   718	   957	   961	   964	  1055	  1056	  1057	  1062	  1065	  1066	  1067	  1068
	  1069	  1070	  1076	  1077	  1078	  1079	  1170	  1171	  1173	  1176	  1192	  1196	  1198	  1201
	  1208	  1218	  1223	  1290	  1291	  1292	  1669	  1671	  1672	  2141	  2143	  2455	  2456	  2519
	  2751	  2915	  2918	  2940	  2941	  2942	  2961	  2998	  3001	  3009	  3010	  3031	  3045	  3048
	  3210	  3212	  3214	  3224	  3225	  3230	  3252	  3253	  3255	  3256	  3382	  3385	  3386	  3481
	  3482	  3523	  3524	  3525	  3526	  3576	  3577	  3578	  3649	  3650	  3651	  3701	  3707	  3711
	  3714	  3718	  3719	  3720	  3738	  3739	  3769	  3772	  3773	  3775	  3776	  3777	  3780	  3781
	  3782	  3788	  3792	  3810	  3826	  3830	  3845	  3890	  3891	  3892	  3894	  3895	  3897	  3899
	  3904	  3909	  3911	  3917	  3919	  3920	  3922	  3923	  3947	  3949	  3950	  3953	  3956	  3957
	  3958
QLINK	   499	   665	   685	   709	   892	  1109	  1114	  1120	  1139	  1179	  1204	  1289	  1295	  1320
	  1351	  1404	  1492	  1493	  1496	  1504	  1610	  1623	  1638	  1644	  1700	  1746	  1764	  1847
	  2047	  2154	  2272	  2343	  2394	  2429	  2437	  2508	  2511	  2584	  2586	  2589	  2592	  2667
	  2670	  2672	  2675	  2679	  2683	  2703	  2717	  2743	  2750	  2768	  2798	  2828	  2959	  3007
	  3017	  3023	  3032	  3033	  3040	  3057	  3101	  3398	  3489	  3492	  3494	  3500	  3504	  3509
	  3517	  3520	  3538	  3544	  3574	  3607	  3615	  3635	  3652	  3686	  3726	  3758	  3770	  3789
	  3795	  3846	  3847	  3863	  3871	  3886	  3924	  3925	  3964
QUEST$	   348	   348#
RAND	   373
RAND$	   372	   372#
RBP	   396
RBP$	   395	   395#
RD.S1A	  2858	  2864	  2869#
RD.ST0	  2820	  2845#	  2870	  2964
RD.ST1	  2849	  2853#
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

RD.ST2	  2873	  2879#
RDFLGS	  2692	  2787	  2855	  2881	  2921
RDLINK	  2690	  2920	  2931	  3060
RDQLNK	  3017	  3032
RDSTBL	  2691	  2932	  3009	  3058
RDTTY	  2659	  2931#
RDTTY1	  2938	  2946#
RDTTYL	  2947	  2958#
READ	  2248	  2646#	  3061
READ1	  2658#
READ1A	  2667#
READ2	  2663	  2682#
READ3	  2700	  2709#
READ3A	  2716#	  2719
READ3B	  2714	  2719#
READ3C	  2722	  2728#	  2954
READ4	  2710	  2736#
READ5	  2767#	  2777
READ5A	  2762	  2773#
READ5B	  2776	  2782#
READ5C	  2797#	  2800
READ6	  2778	  2791	  2820#
READ6A	  2827#	  2831	  2841
READ6B	  2823	  2831#	  2966	  2986
READ6C	  2840#	  2846	  2875	  2884
READ6D	  2892#	  3011
READ6E	  2903	  2908#
READ6F	  2897	  2901#
READ6G	  2867	  2894#
REENTR	   180#	   516
REGP	  3090	  3091	  3440	  3441	  3457	  3458
REMDR	   369
REMDR$	   368	   368#
RENAM	   200	  1598#
RENAM$	   199	   199#
RENAM1	  1609	  1616#
RESCN	   202	  1631#
RETNL1	   349	  1308	  1409	  1459	  1697	  1780
RETNUL	  1297	  1322	  1527	  1557	  1592	  1625	  1774
RNLENG	  1415	  1450#
RPAD	   323
RPAD$	   322	   322#
RPLC	   325
RPLC$	   324	   324#
RPOS	   270
RPOS$	   269	   269#
RSCN$	   201	   201#
RSCNE	  1658	  1664#
RSCNL	  1653#	  1659
RSFLAG	   451	   460	   488	   525	   531	   597	   637	   784	   971	  1199	  1370
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

RSORT	   343
RSORT$	   342	   342#
RTAB	   272
RTAB$	   271	   271#
RUN$	   205	   205#
RUN0	   206	  1708#
RVRS	   327
RVRS$	   326	   326#
RWND	   204	  1681#
RWND$	   203	   203#
RWND1	  1696#	  1701
S.INP	   911
S.OUT	   921
S.PAR	   694	  1034
S.TTY	   932	   943
S1	   828	   829	   830	   833	   834	  1262	  1263	  1266	  1267	  1539	  1546	  1552	  1648	  1659
	  1664	  1666	  1713	  1714	  2008	  2014	  3103	  3104	  3337	  3348	  3391	  3401
S2	   802	   893	   894	   895	   896	   897	   898	   899	  1140	  1141	  1220	  1546	  1547	  1548
	  1549	  1551	  1552	  1553	  1554	  1555	  1556	  1649	  1655	  1968	  1969	  1971	  1974	  2128
	  2146	  2153	  2164	  2165	  2186	  2242	  2244	  2245	  2270	  2271	  2282	  2285	  2286	  2294
	  2301	  2312	  2315	  2316	  2329	  2330	  2354	  3108	  3341	  3342	  3348	  3354	  3359	  3362
	  3366	  3373	  3377	  3382	  3391	  3400	  3401	  3405	  3407	  3408	  3409	  3410	  3412	  3413
	  3414	  3419	  3420	  3426	  3428	  3435	  3438
S3	   658	   679	   751	   778	   781	   783	   803	  1691	  1692	  2001	  2055	  2056	  2057	  2091
	  2095	  2108	  2135	  2145	  2165	  2170	  2186	  2198	  2247	  2254	  2258	  2287	  2288	  2293
	  2302	  2330	  2331	  2345	  2348	  2355	  3113	  3154	  3167	  3241
SBLOK	   753
SBSTR	   331
SBSTR$	   330	   330#
SCHARS	   657	   751
SDT	   776	  1274	  1276
SEGDEV	   479	  1434
SEGNAM	   482
SEGPPN	   483
SETMEM	   501	   746	  1031#
SETMM1	  1063	  1084#
SETMM2	  1076#	  1080
SETSTK	  1109	  1114	  1120	  1169#
SFDFIR	  3226	  3241#
SIZE	   329
SIZE$	   328	   328#
SLINK	   501	   746	   824	   917	   927	   936	   940	   947	  1156	  1271	  1315	  1349	  1456	  1480
	  1511	  1515	  1525	  1536	  1578	  1581	  1590	  1682	  1717	  1839	  1904	  1925	  1927	  1928
	  1935	  1964	  1996	  1998	  2005	  2097	  2110	  2111	  2151	  2202	  2217	  2222	  2250	  2279
	  2290	  2305	  2309	  2319	  2320	  3110	  3119	  3133	  3164	  3181	  3190	  3201	  3208	  3231
	  3269	  3279
SORT	   341
SORT$	   340	   340#
SPAN	   264
SPAN$	   263	   263#
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

SS%	  1006#	  1108
STACK	   777	   778	   780	   781	   808	   809	   828	   831	   846	   847	   867	   868	   902	   903
	   910	   911	   913	   914	   920	   921	   923	   924	   931	   932	   933	   934	   942	   943
	   944	   945	  1110	  1146	  1147	  1257	  1318	  1319	  1334	  1335	  1357	  1385	  1475	  1477
	  1483	  1484	  1518	  1521	  1522	  1542	  1583	  1588	  1589	  1603	  1635	  1641	  1642	  1664
	  1668	  1686	  1710	  1711	  1713	  1723	  1725	  1732	  1743	  1754	  1831	  1837	  1838	  1846
	  1932	  1933	  1934	  1961	  1962	  1963	  1968	  1980	  1981	  1982	  2050	  2051	  2056	  2057
	  2067	  2068	  2129	  2142	  2143	  2167	  2168	  2200	  2201	  2210	  2211	  2221	  2242	  2270
	  2273	  2274	  2276	  2277	  2278	  2282	  2283	  2286	  2288	  2293	  2294	  2296	  2298	  2299
	  2301	  2302	  2307	  2312	  2313	  2315	  2316	  2326	  2327	  2329	  2336	  2337	  2421	  2422
	  2435	  2484	  2502	  2503	  2515	  2534	  2535	  2556	  2557	  2558	  2559	  2577	  2583	  2621
	  2622	  2730	  2731	  2746	  2747	  2748	  2908	  2914	  2925	  3025	  3030	  3031	  3055	  3443
	  3444	  3543	  3546	  3639
STBASE	  1111
STBLKS	  2177	  2213	  2215
STBLOK	  2157
STBOMB	  1999	  2012	  3130	  3197	  3243	  3257	  3439	  3457#
STCF	  1692	  2162	  2650	  3010	  3059
STFILS	   824	  1959	  2128#
STFL99	  2133	  2221#
STFLAG	   472	   487
STFLS1	  2132#	  2146
STFLS2	  1975	  2145	  2150#
STFLS3	  2167#	  2170
STFLS4	  2179#	  2184	  2194
STFLS5	  2192#	  2198
STFLS6	  2180	  2206#
STFLS9	  2137	  2141#
STINIT	   799	   810	   848	  1921	  1957
STIO1	  3089	  3101#
STIO11	  3344	  3389	  3426#
STIO12	  3435#
STIO13	  3437	  3440#	  3452
STIO2	  3113#	  3135
STIO3	  3118	  3120	  3123	  3139#
STIO35	  3115	  3154#
STIO4	  3156	  3169	  3181#	  3283
STIO40	  3194	  3208#
STIO4A	  3232	  3236	  3260#
STIO4B	  3222	  3263#
STIO5	  3185	  3206	  3274#
STIO6	  3275	  3287#
STIO7	  3342	  3348#	  3392
STIO7A	  3367	  3377#
STIO7B	  3384#	  3388
STIO8	  3360	  3363	  3375	  3378	  3387	  3391#
STIO9	  3349	  3397#
STIO98	  3305	  3319#
STIO99	  3095	  3134	  3148	  3162	  3165	  3182	  3202	  3270	  3294#
STIO9B	  3422#
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

STIO9I	  3333	  3337#
STIOBL	  1687	  1691	  2153	  2161	  2163	  2187	  2188
STIONL	  3111	  3321	  3451#
STNSFD	  3230#	  3258
STNXT	  2179	  2214
STOPTR	   233
STPTR	   817	  2018	  3125	  3160	  3187	  3204	  3238	  3260	  3276	  3289
STPTR$	   232	   232#
STR.	   804
STR.C	  2109
STRIO	   859	  1924	  2132	  3089#	  3096
STRMC	  2002	  3117	  3171	  3245
STXT	   242
STXT$	   241	   241#
SUBJ	   808	   809	   846	   847
SUM	   375
SUM$	   374	   374#
SURF	   446	   602	   607	   618	   758	   760	   761	   762	  1098	  1374	  1375	  1376	  1413	  1415
	  1417	  1419	  1423	  1432	  1433	  1437	  1440	  1672	  1722	  1731	  2917	  2918	  3027
SYSCT	   802	  1200	  1649	  2832	  3108
SYSTR	   910	   920	   931	   942
T1	   496	   497	   505	   506	   509	   516	   517	   519	   520	   522	   523	   543	   544	   545
	   546	   547	   605	   606	   656	   657	   678	   740	   741	   751	   752	   753	   754	   761
	   840	   841	   855	   856	   868	   869	  1334	  1336	  1341	  1342	  1377	  1378	  1381	  1382
	  1383	  1419	  1420	  1688	  1689	  1696	  1855	  1896	  1901	  1903	  2155	  2158	  2159	  2162
	  2163	  2182	  2187	  2206	  2209	  2210	  2214	  2215	  2690	  2741	  2746	  2796	  2800	  2820
	  2835	  2849	  2870	  2873	  2931	  2964	  3294	  3343	  3351	  3412	  3435	  3436
T2	   510	   511	   607	   608	  1031	  1032	  1049	  1079	  1126	  1127	  1129	  1687	  1696	  1699
	  1701	  1831	  1832	  1857	  1862	  1865	  1868	  1871	  1874	  1877	  1880	  1883	  1886	  1888
	  1891	  1892	  1896	  1903	  2075	  2082	  2161	  2162	  2163	  2164	  2168	  2169	  2177	  2179
	  2180	  2183	  2188	  2200	  2213	  2214	  2244	  2245	  2257	  2354	  2422	  2441	  2467	  2472
	  2503	  2534	  2535	  2539	  2543	  2551	  2558	  2559	  2650	  2651	  2655	  2691	  2755	  2821
	  2841	  2848	  2867	  2899	  2905	  2906	  2908	  2912	  2922	  2924	  2925	  2932	  2965	  3004
	  3058	  3059	  3089	  3092	  3095	  3295	  3307	  3321	  3326	  3359	  3413	  3477	  3479	  3481
	  3543	  3555	  3557	  3568	  3583	  3598	  3613	  3628	  3957
T3	   514	   628	   629	   636	   686	   691	   694	   697	   702	   725	   727	   766	   767	   769
	   770	   772	  1034	  1035	  1036	  1037	  1050	  1169	  1617	  1618	  1619	  1686	  1687	  1688
	  1689	  1692	  1859	  1861	  1864	  1867	  1870	  1873	  1876	  1879	  1882	  1885	  1892	  2078
	  2080	  2247	  2355	  2446	  2447	  2449	  2452	  2458	  2460	  2517	  2518	  2519	  2620	  2646
	  2647	  2648	  2669	  2682	  2699	  2709	  2736	  2790	  2898	  2901	  2902	  2905	  2906	  2934
	  2946	  3296	  3325	  3328	  3362	  3414	  3476	  3484	  3491	  3496	  3508	  3514	  3528	  3552
	  3558	  3565	  3603	  3608	  3623
T4	   508	   512	   539	   553	   554	   555	   565	   633	   707	   717	   718	   724	   725	   727
	   771	   772	  1039	  1051	  1102	  1147	  1149	  1150	  1152	  1154	  1290	  1319	  1484	  1485
	  1488	  1539	  1601	  1618	  1622	  1699	  1725	  1726	  1727	  1728	  1846	  1851	  1897	  2391
	  2393	  2395	  2435	  2463	  2514	  2515	  2520	  2539	  2540	  2543	  2544	  2551	  2556	  2557
	  2577	  2578	  2580	  2598	  2603	  2650	  2652	  2655	  2656	  2658	  2661	  2685	  2702	  2704
	  2712	  2713	  2716	  2718	  2723	  2739	  2757	  2767	  2769	  2773	  2782	  2797	  2799	  2827
	  2829	  2857	  2892	  2937	  2940	  2962	  2982	  2990	  2997	  3020	  3029	  3037	  3044	  3297
	  3308	  3309	  3311	  3312	  3365	  3479	  3510	  3523	  3537	  3539	  3573	  3575	  3576	  3583
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

	  3586	  3592	  3597	  3606	  3608	  3614	  3618	  3633	  3649	  3687	  3691	  3694	  3695	  3719	  3729
	  3742	  3746	  3769	  3775	  3780	  3784	  3788	  3793	  3830	  3832	  3836	  3885	  3888	  3890
	  3891	  3892	  3894	  3901	  3905	  3920	  3922
TAB	   274
TAB$	   273	   273#
TABLE	   333
TABLE$	   332	   332#
TEMP%%	   670	   712
TERMCH	  3287	  3446	  3757
TEST%%	   804	  3114	  3168	  3242
TIME$	   207	   207#
TIME.C	  1406	  1747
TIME.E	  1352	  1405
TIME.S	  1407
TIME0	   208	  1740#
TIME1	  1744	  1752#
TIME2	  1748	  1754#
TLINK	   430	   799	   804	   810	   848	   859	   900	  1143	  1304	  1307	  1327	  1331	  1346	  1368
	  1540	  1575	  1708	  1720	  1740	  1761	  1843	  1918	  1921	  1924	  1954	  1957	  2002	  2011
	  2061	  2065	  2081	  2109	  2132	  2138	  2248	  2259	  2266	  2304	  2318	  2334	  2342	  2349
	  2356	  2393	  2413	  2418	  2424	  2425	  2431	  2433	  2468	  2475	  2480	  2486	  2504	  2522
	  2541	  2578	  2581	  2594	  2600	  2646	  2653	  2706	  2732	  2920	  2922	  2926	  3060	  3114
	  3117	  3129	  3140	  3155	  3168	  3171	  3175	  3242	  3245	  3249	  3447	  3459	  3540	  3555
	  3634	  3640	  3692
TMPOPN	   639	   738	  1213
TOOMCH	  1065
TRACE	   235
TRACE$	   234	   234#
TRCFN3	   391
TRCFN4	   391#
TRFLGS	   568	  1398
TRIM	   284
TRIM$	   283	   283#
TRIMT	  2266
TTY	   210	  1761#
TTY$	   209	   209#
TTY1	  1766	  1778#
TTYBLK	   840	   933	   944	  1137	  1149	  2141	  2658	  2982	  3341	  3687
TVAR	  2089	  2540
TVASGN	  2232	  2293#	  2324	  2360
TVFTCH	  2234	  2312#
TVIN	   916	   939	  1524	  2230#
TVNAME	  2231	  2235	  2282#
TVOUT	   926	   946	  1585	  2234#
TVRD1	  2255	  2265#
TVRD2	  2261	  2270#
TVREAD	  2230	  2242#
TVWRIT	  2236	  2323#
TVWRT1	  2332	  2342#
TVWRT2	  2338	  2346	  2354#
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

UNDEF	   295
UNDEF$	   294	   294#
UNLD	   215
UNLD$	   214	   214#
V.PAR	   697	  1031
VAR	  2297
VARSIZ	  3710
VERSIO	    45
VTABLE	   766	  1128
WHERE$	   397	   397#
WHERE0	   398
WMPROP	  2429	  2508	  3941#
WRDNT	  3497	  3503#
WRDONT	  3483	  3489#
WRIT1	  3485	  3508#
WRIT11	  3515	  3528#
WRIT1A	  3537#
WRIT2	  3529	  3543#
WRIT3	  3552#
WRIT4	  3553	  3565#
WRIT4A	  3573#	  3579	  3587
WRIT4B	  3584	  3592#
WRIT5	  3566	  3598	  3603#
WRIT6	  3559	  3604	  3609	  3613#	  3619	  3629
WRIT7	  3613	  3623#
WRIT9	  3624	  3633#
WRIT99	  3476	  3477	  3639#
WRITE	  2356	  2623	  3476#
XERRF	   864	  1150
XWD22	   831	   867	  1257	  1477	  1635	  1711	  1838	  1932	  1961	  1980	  2276	  2283	  2307	  2313
	  2484	  3055	  3546	  3639
Y.ALT	   672	   711	  1657	  2845	  2863	  2869	  2872	  2883
Y.BL	   711	  2108
Y.CM	   711
Y.CR	  1657	  2845	  2869
Y.CZ	   672	   711	  2845
Y.EQ	   669	   711	   803
Y.LA	   669	   711	   803
Y.LOWS	  3113	  3167	  3241
Y.NUM	   714	  2001	  3113	  3167	  3241
Y.PER	  3154
Y.SLSH	   711
Y.TAB	   711	  2108
Y.UPS	  3113	  3167	  3241
Y.VM	   672	   711	  1657	  2845	  2863	  2869	  2872	  2883
Z	   439	   440	   491	   492	   519	   669	   672	   711	   714	   871	   872	   916	   926	   935
	   939	   946	   955	   960	   961	  1108	  1110	  1111	  1113	  1115	  1116	  1117	  1119	  1121
	  1122	  1146	  1153	  1154	  1169	  1170	  1173	  1174	  1177	  1202	  1285	  1318	  1326	  1329
	  1330	  1335	  1352	  1354	  1355	  1375	  1376	  1378	  1401	  1402	  1405	  1406	  1407	  1413
	  1414	  1415	  1455	  1474	  1483	  1491	  1512	  1514	  1524	  1579	  1585	  1598	  1607	  1637
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Symbol cross reference

	  1654	  1681	  1747	  1752	  1754	  1768	  1837	  1859	  1901	  1902	  1927	  1953	  2010	  2038	  2040
	  2041	  2042	  2046	  2076	  2077	  2079	  2088	  2089	  2090	  2091	  2093	  2094	  2095	  2135
	  2153	  2157	  2158	  2167	  2182	  2183	  2192	  2193	  2206	  2207	  2257	  2258	  2296	  2297
	  2298	  2336	  2348	  2415	  2421	  2446	  2467	  2472	  2478	  2485	  2499	  2510	  2583	  2669
	  2678	  2682	  2685	  2704	  2739	  2740	  2741	  2754	  2785	  2787	  2853	  2855	  2879	  2881
	  2921	  2958	  3022	  3026	  3027	  3090	  3128	  3131	  3139	  3142	  3144	  3174	  3177	  3191
	  3209	  3211	  3212	  3213	  3214	  3215	  3248	  3253	  3280	  3281	  3351	  3352	  3357	  3373
	  3374	  3384	  3386	  3397	  3402	  3404	  3405	  3408	  3409	  3410	  3440	  3446	  3457	  3480
	  3491	  3503	  3508	  3510	  3511	  3548	  3593	  3594	  3690	  3694	  3711	  3712	  3713	  3715
	  3725	  3730	  3733	  3734	  3756	  3757	  3859	  3862	  3869	  3870	  3888	  3903	  3905	  3942
	  3945
$ALPHA	  2621	  2730
$DDCMD	   403#
$FNCLV	   428
$JOBNO	   506
$OUTPT	  2323
$REE	   452	   460#
$REENT	   180	   451#
$STCNT	   454	   457
$STNO	   427
$TRACE	   453
$TRIM	  2265
..0004	   549#
.CHCNZ	  2721	  2860
.CHFFD	  2622
.CHLFD	  1223
.IOASL	  3858
.IOIBN	  3860
.JB41	   520
.JBAPR	   523
.JBFF	   602	  1383	  3739
.JBHDA	   177
.JBHGH	   443	   491
.JBHVR	   443	   491
.JBOPC	   458
.JBREN	   517
.JBSA	  1382	  1420
.JBVER	    44
.PTFRD	  3368
.SGDEV	   477	   478	   479
.SGNAM	   480	   481	   482
.SGPPN	   483
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Macro/Opdef cross reference

APRENB	   569	  1399
CLOSE	   955	  3772
CORE	  1087	  1428
DATE	  1259
DEVCHR	  1548	  3895	  3915
DEVNAM	  3352	  3355
DEVSIZ	  3696
DMOVE	  2244
ENTER	  3826
ERR	   551	   588	   600	   703	   800	   811	   825	   826	   849	   860	   865	   901	   937	   938
	  1088	  1144	  1221	  1293	  1316	  1429	  1436	  1481	  1486	  1494	  1516	  1517	  1541	  1545
	  1582	  1620	  1639	  1646	  1660	  1683	  1684	  1715	  1718	  1733	  1770	  1894	  1905	  2048
	  2249	  2260	  2350	  2357	  2450	  2457	  2512	  2587	  2673	  2676	  2686	  2737	  2744	  2752
	  2935	  2944	  2960	  3002	  3049	  3372	  3495	  3501	  3512	  3518	  3521	  3569	  3653	  3697
	  3778	  3900	  3913
ERR.	  1305	  1332	  1347	  1576	  1709	  1741	  1762	  1844	  1919	  1972	  2062	  2335	  2419	  2432
ERROR	   551	   588	   600	   703	   800	   811	   825	   826	   849	   860	   865	   901	   937	   938
	  1088	  1144	  1221	  1293	  1316	  1429	  1436	  1481	  1486	  1494	  1516	  1517	  1541	  1545
	  1582	  1620	  1639	  1646	  1660	  1683	  1684	  1715	  1718	  1733	  1770	  1894	  1905	  2048
	  2249	  2260	  2350	  2357	  2450	  2457	  2512	  2587	  2673	  2676	  2686	  2737	  2744	  2752
	  2935	  2944	  2960	  3002	  3049	  3372	  3495	  3501	  3512	  3518	  3521	  3569	  3653	  3697
	  3778	  3900	  3913
ERROR.	  1305	  1332	  1347	  1576	  1709	  1741	  1762	  1844	  1919	  1972	  2062	  2335	  2419	  2432
EXIT	   786	   974	  1362	  1390	  1430
EXPIRE	   575#	   584
FIOPTX	    50
FIOTTL	    49
FUNC	   181	   183	   185	   187	   189	   191	   193	   195	   197	   199	   201	   203	   205	   207
	   209	   211	   214	   216	   218	   220	   223	   225	   227	   229	   232	   234	   236	   238
	   241	   243	   245	   247	   249	   251	   253	   255	   257	   259	   261	   263	   265	   267
	   269	   271	   273	   275	   277	   279	   281	   283	   289	   292	   294	   296	   298	   300
	   302	   304	   306	   308	   310	   312	   314	   316	   318	   320	   322	   324	   326	   328
	   330	   332	   334	   336	   338	   340	   342	   344	   346	   348	   350	   352	   354	   356
	   358	   360	   362	   364	   366	   368	   370	   372	   374	   376	   378	   380	   382	   384
	   386	   388	   393	   395	   397	   399	   401	   408	   410
GETPPN	  3210
GETSEG	  1435
GETSTS	  1219	  2998	  3045
GETTAB	  3309
IN	  1215	  2991	  3038
INBUF	   603	  3741
INCHRW	  2951
INCHWL	  1208	  1653	  2984
JUMPPT	   540
LOOKUP	   636	  3810
MIDENT	   181	   183	   185	   187	   189	   191	   193	   195	   197	   199	   201	   203	   205	   207
	   209	   211	   214	   216	   218	   220	   223	   225	   227	   229	   232	   234	   236	   238
	   241	   243	   245	   247	   249	   251	   253	   255	   257	   259	   261	   263	   265	   267
	   269	   271	   273	   275	   277	   279	   281	   283	   289	   292	   294	   296	   298	   300
	   302	   304	   306	   308	   310	   312	   314	   316	   318	   320	   322	   324	   326	   328
SNOFIO - I/O and System Interface  %5(303)	MACRO %53B(1156)-1 21:46 14-Mar-88 Page 1
SNOFIO	MAC	15-Mar-69 11:20		MA355/JDS/DRH/MP/RCM/VB		20-AUG-76


Macro/Opdef cross reference

	   330	   332	   334	   336	   338	   340	   342	   344	   346	   348	   350	   352	   354	   356	   358
	   360	   362	   364	   366	   368	   370	   372	   374	   376	   378	   380	   382	   384	   386
	   388	   393	   395	   397	   399	   401	   408	   410	  3091	  3441	  3458
MOVX	   439	   567	   803	   833	  1223	  1326	  1862	  1865	  1868	  1871	  1874	  1877	  1880	  1883
	  1886	  1891	  2001	  2010	  2108	  2620	  3113	  3128	  3139	  3154	  3167	  3174	  3241	  3248
MSTIME	  1752
OPEN	   599	  3922
OUT	  2941	  3650
OUTBUF	  3744
OUTCHR	   652
PATH.	  3371
PJOB	   505
POPR	  3440	  3457
PORTAL	   180	   182	   184	   186	   188	   190	   192	   194	   196	   198	   200	   202	   204	   206
	   208	   210	   212	   213	   215	   217	   219	   221	   222	   224	   226	   228	   230	   231
	   233	   235	   237	   239	   240	   242	   244	   246	   248	   250	   252	   254	   256	   258
	   260	   262	   264	   266	   268	   270	   272	   274	   276	   278	   280	   282	   284	   290
	   293	   295	   297	   299	   301	   303	   305	   307	   309	   311	   313	   315	   317	   319
	   321	   323	   325	   327	   329	   331	   333	   335	   337	   339	   341	   343	   345	   347
	   349	   351	   353	   355	   357	   359	   361	   363	   365	   367	   369	   371	   373	   375
	   377	   379	   381	   383	   385	   387	   389	   390	   391	   394	   396	   398	   400	   402
	   403	   409	   411	   436	   465	   466
PPADDR	  3090#	  3091	  3440#	  3441	  3457#	  3458
PPINIT	  3090	  3440	  3457
PPLENG	  3090#	  3091	  3440#	  3441	  3457#	  3458
PUSHR	  3090
RELEAS	   621	   743	   956	  3781
RENAME	   741	  1291	  1618
RESCAN	  1631
RESET	   470	  1396	  1446
RUN	  1729
RUNTIM	  3870
SETNAM	  1330
SHOW.	    38	    39	    40	    42
SKPINC	  1772
SKPINL	  1632	  1778
STATZ	  3776
TITLE.	    30
TMPCOR	   609
TXNE	   669	   672	   711	  1657	  1902	  2647	  2736	  2790	  2872	  2883	  2934	  3496	  3859	  3942
TXNN	   714	  1220	  2254	  2331	  2345	  2415	  2499	  2699	  2709	  2845	  2863	  2869	  2898	  2901
	  2946	  3484	  3514	  3528	  3552	  3565	  3603
TXO	  3558
TXOE	  3623
USETI	  3525 @[Oa
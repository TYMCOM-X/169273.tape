SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 1
SNODFD	MAC	13-Oct-66 22:07		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76

     1						SUBTTL	Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76
     2
     3					; COPYRIGHTS 1972,1973,1976,1977  STEVENS INSTITUTE OF TECHNOLOGY
     4					; HOBOKEN, NEW JERSEY, 07030
     5					; ALL RIGHTS RESERVED.
     6
     7					  ;UNIVERSALS
     8
     9						SEARCH	JOBDAT		;JOB DATA AREA DEFINITIONS
    10						SEARCH	MACTEN		;DEC-10 COMMON MACROS
    11						SEARCH	UUOSYM		;TOPS10 UUO SYMBOL DEFINITIONS
    12						SEARCH	SNOPRM		;SITBOL PARAMETER FILE
    13
    14					  ;DIRECTIVES
    15
    16						.DIRECT	.XTABM		;EXCLUDE TABS FROM MACRO CALLS
    17						SALL			;SUPPRESS MACRO EXPANSIONS
    18	400000'					TWOSEG	400K		;TWOSEGMENT CODE
    19
    20					  ;VERSION NUMBER
    21
    22			000005			DFDVER==5		;MAJOR VERSION NUMBER
    23			000000			DFDMIN==0		;MINOR VERSION NUMBER
    24			000245			DFDEDT==245		;EDIT LEVEL
    25			000000			DFDWHO==0		;CUSTOMER ARGUMENT
    26
    27					  ;TITLE
    28
    29						TITLE.	DFD,SNODFD,<Defined Data types>
    30		444644	000000			DFDSIX==SIXBIT /DFD/	; SNODFD ABBREVIATION IN SIXBIT
    31		422150	400000			DFDASC==ASCIZ /DFD/	; SNODFD ABBREVIATION IN ASCII
    32						SALL
    33
    34
    35					  ;SHOW UNIVERSAL VERSION NUMBERS
    36
    37	400000'	043100	000450			SHOW.	%%JOBD		;VERSION NUMBER OF JOBDAT
    38	400000'	000200	000025			SHOW.	%%MACT		;VERSION NUMBER OF MACTEN
    39	400000'	001400	000457			SHOW.	%%UUOS		;VERSION NUMBER OF UUOSYM
    40	400000'	000500	000305			SHOW.	%%SNOP		;VERSION NUMBER OF SNOPRM
    41
    42						DFDTTL			; Title
    43						DFDPTX			; PASS2 assembly message
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 2
SNODFD	MAC	13-Oct-66 22:07		Table of Contents

    44						SUBTTL	Table of Contents
    45
    46					;		Table of Contents for Defined Data types
    47					;
    48					;
    49					;			   Section			      Page
    50					;   1. Table of Contents. . . . . . . . . . . . . . . . . . .    2
    51					;   2. REVISION HISTORY . . . . . . . . . . . . . . . . . . .    3
    52					;   3. DATA - PRIMARY FUNCTION. . . . . . . . . . . . . . . .    4
    53					;   4. FIELD - PRIMARY FUNCTION . . . . . . . . . . . . . . .    6
    54					;   5. CRTDAT - CREATE A DATA OBJECT. . . . . . . . . . . . .    7
    55					;   6. FLDREF - REFERENCE TO A FIELD OF A DEFINED DATA OBJECT    8
    56					;   7. LFBLOK . . . . . . . . . . . . . . . . . . . . . . . .    9
    57					;   8. IFBLOK . . . . . . . . . . . . . . . . . . . . . . . .   10
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 3
SNODFD	MAC	13-Oct-66 22:07		REVISION HISTORY

    58						SUBTTL	REVISION HISTORY
    59
    60					COMMENT	\
    61
    62					START OF VERSION 5.
    63					122	RENAME MODULES & CLEAN UP.
    64					147	Use Y.???? instead of X.????, and the correct macros for them.
    65					245	Fix missing PORTAL at CRTDAT
    66					\
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 4
SNODFD	MAC	13-Oct-66 22:07		DATA - PRIMARY FUNCTION

    67						SUBTTL	DATA - PRIMARY FUNCTION
    68
    69					;	DATA EXPECTS A ONE ARGUMENT PROTOTYPE AND
    70					;	RETURNS THE NULL STRING.
    71
    72
    73	400000'				DATA::
    74	400000'	265 11 0 00 000000*		JSP	TLINK,STINIT##	; INITIALIZE STREAMING
    75	400001'	001 15 0 00 000036 		ERROR	13,30		; NULL OR NONSTRING
    76
    77	400002'	200 07 0 00 000000*		MOVE	S2,SYSCT##	; LOAD CHAR. SET
    78	400003'	205 10 0 00 010000 		MOVX	S3,Y.LP		; FOR "("
    79	400004'	265 11 0 00 000000*		JSP	TLINK,STRM##	; STREAM FOR IT
    80	400005'	001 15 0 00 000040 		ERROR	13,32		; MISSING "(""
    81
    82	400006'	201 06 0 00 000001 		MOVEI	S1,1		; HOLDS COUNT OF THE # OF FIELDS
    83						 ; TOP OF LOOP FOR EXTRACTING FIELD NAMES.
    84	400007'	370 00 0 00 000000*	DATA1:	SOS	CURSOR##		; MOVE PAST ...
    85	400010'	133 00 0 00 000000*		IBP	STPTR##		; BREAK CHAR.
    86
    87	400011'	205 10 0 00 005000 		MOVX	S3,Y.CM!Y.RP	; Load ",)" mask
    88	400012'	265 11 0 00 400004*		JSP	TLINK,STRM	; SEARCH FOR ONE OF THESE
    89	400013'	001 15 0 00 000042 		ERROR	13,34		; DID NOT END WITH ")"
    90
    91	400014'	302 16 0 00 000051 		CAIE	Q2,")"		; SKIP IF LAST FIELD
    92	400015'	344 06 0 00 400007'		AOJA	S1,DATA1	; INCREMENT COUNT AND LOOP BACK
    93
    94						 ; ENSURE ENOUGH STORAGE
    95	400016'	201 00 0 06 000005 		MOVEI	Z,DFFLDS(S1)	; DFBLOK REQUIREMENTS
    96	400017'	265 15 0 00 000000*		JSP	QLINK,GCOLF##	; ENSURE THIS MUCH
    97
    98						 ; MOVE IN HEADER FOR DFBLOK
    99	400020'	200 00 0 00 000002 		MOVE	Z,SURF		; TO ADDRESS
   100	400021'	505 00 0 00 400071'		HRLI	Z,DF.PRO	; FROM ADDRESS
   101	400022'	251 00 0 02 000003 		BLT	Z,FCODE(SURF)	; DO THE MOVE
   102
   103						 ; ALTER FIELDS IN HEADER OF DFBLOK
   104	400023'	272 06 0 02 000000 		ADDM	S1,BLENG(SURF)	; INCREASE LENGTH BY # OF FLDS
   105	400024'	542 06 0 02 000002 		HRRM	S1,FNARGS(SURF)	; INSERT # OF ARGS
   106
   107						 ; ESTABLISH FLOATING ADDRESS TO DFBLOK
   108	400025'	200 10 0 00 000002 		MOVE	S3,SURF		; S3 POINTS TO DFBLOK
   109	400026'	271 02 0 06 000005 		ADDI	SURF,DFFLDS(S1)	; UPDATE SURF
   110	400027'	505 10 0 00 004000 		HRLI	S3,FLDC		; KEEP GARBAGE COLLECTOR HAPPY
   111	400030'	202 10 0 00 000000*		MOVEM	S3,FLAP##	; SAVE ADDR IN TENDED REGION.
   112

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 5
SNODFD	MAC	13-Oct-66 22:07		DATA - PRIMARY FUNCTION

   113						 ; TOP OF LOOP TO PROCESS A FIELD ELEMENT
   114	400031'				DATA2:
   115						 ; PLUG DFBLOK FIELD ADDRESS
   116	400031'	265 11 0 00 000000*		JSP	TLINK,INSTAL##	; INSTAL STRING INTO SYMBOL TABLE
   117	400032'	001 15 0 00 000041 		ERROR	13,33
   118	400033'	200 05 0 00 000000 		MOVE	P2,Z
   119
   120						 ; MOVE PROTOTYPE INTO FFBLOK
   121	400034'	201 00 0 00 000006 		MOVEI	Z,LFFBL		; ENSURE SPACE FOR ...
   122	400035'	265 15 0 00 400017*		JSP	QLINK,GCOLF	; ONE FFBLOK
   123	400036'	200 00 0 00 000002 		MOVE	Z,SURF		; TO ADDRESS
   124	400037'	505 00 0 00 400075'		HRLI	Z,FF.PRO	; FROM ADDRESS
   125	400040'	251 00 0 02 000003 		BLT	Z,FCODE(SURF)	; DO THE MOVE
   126
   127						 ; SPECIFY OTHER FIELDS OF FFBLOK
   128	400041'	200 10 0 00 400030*		MOVE	S3,FLAP		; LOAD ADDRESS OF DFBLOK
   129	400042'	542 10 0 02 000004 		HRRM	S3,FFDFBL(SURF)	; INSERT DFBLOK POINTER
   130	400043'	200 15 0 00 000006 		MOVE	Q1,S1		; GET NUMBER OF FIELDS
   131	400044'	240 15 0 00 000001 		ASH	Q1,1		; DOUBLE FOR DESCRIPTOR SIZE
   132	400045'	201 15 0 15 000001 		MOVEI	Q1,DFLDS-2(Q1)	; TOTAL OFFSET WITHIN DBLOK
   133	400046'	506 15 0 02 000004 		HRLM	Q1,FFOFFS(SURF)	; INSERT WITHIN FFBLOK
   134	400047'	402 00 0 02 000005 		CLEARM	FFLINK(SURF)	; CLEAR LINK FIELD
   135
   136						 ; ALSO FILL IN FIELD FOR DFBLOK
   137	400050'	271 10 0 06 000004 		ADDI	S3,DFFLDS-1(S1)	; POINT TO LOCATION WITHIN DFBLOK
   138	400051'	202 05 0 10 000000 		MOVEM	P2,0(S3)		; INSERT VARIABLE BLOCK ADDRESS.
   139
   140						 ; INSERT THIS FFBLOK AS THE CURRENT FUNCTION FOR THE VAR. BLOCK
   141	400052'	201 16 0 05 000003 		MOVEI	Q2,VFUNC(P2)	; POINT TO VFUNC FIELD
   142	400053'	335 00 0 05 000006 		SKIPGE	VFLAGS(P2)	; IF NOT OPERATOR , SKIP
   143	400054'	201 16 0 05 000002 		MOVEI	Q2,VUNARY(P2)	; OPERATOR - POINT TO VUNARY FIELD
   144	400055'	200 17 0 00 000002 		MOVE	Q3,SURF		; Q3 POINTS TO FFBLOK
   145	400056'	265 15 0 00 400220'		JSP	QLINK,IFBLOK	; DO THE INSERTION
   146
   147						 ; END OF LOOP FOR PROCESSING FFBLOK'S
   148	400057'	201 02 0 02 000006 		MOVEI	SURF,LFFBL(SURF)	; UPDATE SURFACE
   149	400060'	367 06 0 00 400031'		SOJG	S1,DATA2	; LOOP ON S1
   150
   151						 ; END OF FFBLOK PROCESSING
   152						 ; FIND VARIABLE BLOCK FOR DT NAME
   153	400061'	265 11 0 00 400031*		JSP	TLINK,INSTAL	; INSTAL STRING INTO SYMBOL TABLE
   154	400062'	001 15 0 00 000037 		ERROR	13,31		; NULL STRING
   155
   156	400063'	200 17 0 00 400041*		MOVE	Q3,FLAP		; RETRIEVE ADDRESS OF DFBLOK
   157	400064'	202 00 0 17 000004 		MOVEM	Z,DFNAME(Q3)	; INSERT VAR. BLOCK ADDRESS
   158	400065'	200 15 0 00 000000 		MOVE	Q1,Z		; PUT ADDRESS INTO INDEX REGISTER
   159	400066'	201 16 0 15 000003 		MOVEI	Q2,VFUNC(Q1)	; POINT TO VFUNC FIELD
   160	400067'	265 15 0 00 400220'		JSP	QLINK,IFBLOK	; DO THE INSERTION
   161	400070'	254 00 0 00 000000*		JRST	RETNUL##	; RETURN NULL STRING
   162
   163						 ; DFBLOK PROTOTYPE
   164	400071'	000421	000005		DF.PRO:	XWD	DFBLOK,DFFLDS
   165	400072'	000000	000000			0
   166	400073'	000003	000000			XWD	FSAFL+FEAFL,0
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 5-1
SNODFD	MAC	13-Oct-66 22:07		DATA - PRIMARY FUNCTION

   167	400074'	265 06 0 00 000000*		JSP	SLINK,CRTDT$##	;[245]
   168
   169						 ; FFBLOK PROTOTYPE
   170	400075'	000422	000006		FF.PRO:	XWD	FFBLOK,LFFBL
   171	400076'	000000	000000			0
   172	400077'	000001	000001			XWD	FEAFL,1
   173	400100'	265 06 0 00 000000*		JSP	SLINK,FLDRF$##
   174

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 6
SNODFD	MAC	13-Oct-66 22:07		FIELD - PRIMARY FUNCTION

   175						SUBTTL	FIELD - PRIMARY FUNCTION
   176
   177					;	FIELD(S,I) WILL RETURN THE NAME OF THE ITH 
   178					;	FIELD OF THE DATATYPE DESCRIBED BY S.
   179
   180	400101'				FIELD::
   181	400101'	265 11 0 00 000000*		JSP	TLINK,CVTINT##	; ENSURE 2ND ARG. INTEGER
   182	400102'	003 01 0 00 000104 		ERROR.	1,68		; BAD 2ND ARG.
   183
   184	400103'	337 05 0 01 000000 		SKIPG	P2,0(STACK)	; LOAD I INTO P2 AND TEST THE INT.
   185	400104'	254 00 0 00 000000*		JRST	FRET2##		; FAIL UNLESS POSITIVE
   186	400105'	274 01 0 00 400245'		SUB	STACK,[2,,2]	; POP INTEGER FROM STACK
   187
   188	400106'	265 11 0 00 000000*		JSP	TLINK,CVTNAM##	; MAKE FIRST ARGUMENT A NAME
   189	400107'	003 01 0 00 000103 		ERROR.	1,67		; NOT POSSIBLE
   190
   191	400110'	332 00 0 01 000000 		SKIPE	0(STACK)	; TEST FOR NATURAL VARIABLE
   192	400111'	003 01 0 00 000103 		ERROR.	1,67		; UNNATURAL
   193	400112'	262 01 0 00 000007 		POP	STACK,S2	; POP INTO ...
   194	400113'	262 01 0 00 000006 		POP	STACK,S1	; S1 & S2
   195
   196						 ; BACK TO FIELD2: FROM TFBLOK CASE
   197	400114'	550 07 0 06 000003 		HRRZ	S2,VFUNC(S1)	; PICK UP FBLOK POINTER
   198	400115'	554 10 0 07 000000 	FIELD2:	HLRZ	S3,BTCODE(S2)	; PICK UP TAYPE OF FBLOK.
   199	400116'	306 10 0 00 000421 		CAIN	S3,DFBLOK	; SHOULD BE A DFBLOK
   200	400117'	254 00 0 00 400124'		JRST	FIELD1		; IT IS! JUMP!
   201	400120'	302 10 0 00 000424 		CAIE	S3,TFBLOK	; PERHAPS ITS TRACED
   202	400121'	001 15 0 00 000073 		ERROR	13,59		; NO - GIVE MESSAGE
   203	400122'	550 07 0 07 000004 		HRRZ	S2,TFOLD(S2)	; OLD FBLOK TO S1
   204	400123'	254 00 0 00 400115'		JRST	FIELD2		; BACK TO SEEK DFBLOK
   205
   206						 ; CHECK I AGAINST THE NUMBER OF FIELDS
   207	400124'				FIELD1:
   208	400124'	550 00 0 07 000002 		HRRZ	Z,FNARGS(S2)	; PICK UP # OF FIELDS
   209	400125'	315 00 0 00 000005 		CAMGE	Z,P2		; SKIP IF I DOES NOT EXCEED THIS
   210	400126'	254 00 0 04 000000 		JRST	0(PLINK)	; FAIL IF IT DOES
   211
   212						 ; RETURN ASSOCIATED NAME
   213	400127'	271 07 0 05 000004 		ADDI	S2,DFFLDS-1(P2)	; MAKE S2 POINT TO CURRENT FIELD
   214	400130'	200 10 0 07 000000 		MOVE	S3,0(S2)	; PICK UP ADDR OF VARIABLE BLOCK
   215	400131'	505 10 0 00 004011 		HRLI	S3,NDT		; INSERT DATATYPE
   216	400132'	261 01 0 00 000010 		PUSH	STACK,S3	; RETURN
   217	400133'	261 01 0 00 400246'		PUSH	STACK,[0]	; NAME DATATYPE
   218	400134'	254 00 0 04 000001 		JRST	1(PLINK)	; SUCCESSFULLY
   219

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 7
SNODFD	MAC	13-Oct-66 22:07		CRTDAT - CREATE A DATA OBJECT

   220						SUBTTL	CRTDAT - CREATE A DATA OBJECT
   221
   222					;	CONTROL ENTERS HERE WITH A
   223					;	 JSP	SLINK,CRTDAT
   224					;	EXECUTED WITHIN A DFBLOK. THE PURPOSE BEING
   225					;	TO CREATE A DATA OBJECT OF A GIVEN TYPE.
   226
   227	400135'				CRTDAT::			;[245]
   228	400135'	201 06 0 06 777774 		MOVEI	S1,-FCODE-1(S1)	; GET TO TOP OF BLOK
   229	400136'	505 06 0 00 004000 		HRLI	S1,FLDC		; PRESERVE FLOATING ...
   230	400137'	202 06 0 00 400063*		MOVEM	S1,FLAP		; ADDRESS
   231
   232						 ; DETERMINE FLOATING STORAGE REQUIREMENTS
   233	400140'	550 10 0 06 000002 		HRRZ	S3,FNARGS(S1)	; GET NUMBER OF FIELDS
   234	400141'	240 10 0 00 000001 		ASH	S3,1		; DOUBLE IT
   235	400142'	201 05 0 10 000003 		MOVEI	P2,DFLDS(S3)	; ADD IN HEADER ROOM
   236	400143'	201 00 0 05 000000 		MOVEI	Z,0(P2)		; PLACE THE AMOUNT IN Z
   237	400144'	265 15 0 00 400035*		JSP	QLINK,GCOLF##	; ENSURE THIS MUCH FLOATING STORAGE
   238
   239						 ; START FILLING IN TOP PART OF NEW STRUCTURE
   240	400145'	505 05 0 00 000412 		HRLI	P2,DBLOK	; INSERT TYPE ALONG WITH LENGTH
   241	400146'	202 05 0 02 000000 		MOVEM	P2,BTCODE&BLENG(SURF)	; PLUG FIRST WORD
   242	400147'	402 00 0 02 000001 		CLEARM	GCFLD(SURF)	; CLEAR 2ND WORD
   243	400150'	350 07 0 00 000000*		AOS	S2,DFDID##	; LOAD NEW HASH NUMBER
   244	400151'	504 07 0 00 400137*		HRL	S2,FLAP		; GET ADDR OF DFBLOK
   245	400152'	206 07 0 02 000002 		MOVSM	S2,DHASH&ADFBLK(SURF) ; PLUG VALUES
   246						 ; NOW ROLL THE ARGUMENTS FROM THE STACK INTO THE 
   247						 ; NEWLY CREATED STRUCTURE
   248
   249	400153'	504 10 0 00 000010 		HRL	S3,S3		; PUT ARG LENGTH INTO BOTH HALVES
   250	400154'	274 01 0 00 000010 		SUB	STACK,S3	; REMOVE ARGS FROM STACK
   251	400155'	201 11 0 02 000003 		MOVEI	T1,DFLDS(SURF)	; 'TO' ADDRESS
   252	400156'	505 11 0 01 000001 		HRLI	T1,1(STACK)	; 'FROM' ADDRESS
   253	400157'	200 12 0 00 000002 		MOVE	T2,SURF		; SAVE SURFACE
   254	400160'	271 02 0 05 000000 		ADDI	SURF,0(P2)	; UPDATE SURFACE
   255	400161'	251 11 0 02 777777 		BLT	T1,-1(SURF)	; DO THE MOVE
   256
   257						 ; RETURN
   258	400162'	505 12 0 00 004012 		HRLI	T2,DDT		; INSERT DATATYPE
   259	400163'	261 01 0 00 000012 		PUSH	STACK,T2	; PUSH DESCRIPTOR
   260	400164'	261 01 0 00 400246'		PUSH	STACK,[0]	; ONTO STACK
   261	400165'	254 00 0 04 000001 		JRST	1(PLINK)	; AND RETURN
   262

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 8
SNODFD	MAC	13-Oct-66 22:07		FLDREF - REFERENCE TO A FIELD OF A DEFINED DATA OBJECT

   263						SUBTTL	FLDREF - REFERENCE TO A FIELD OF A DEFINED DATA OBJECT
   264
   265					;	CONTROL ARRIVES HERE WHEN A FIELD OF A PROGRAMMER-DEFINED
   266					;	DATA OBJECT IS BEING REFERENCED.	THE CALL IS 
   267					;		JSP	SLINK,FLDREF
   268					;	AND IS EXECUTED FROM WITHIN AN FFBLOK
   269
   270	400166'				FLDREF::
   271	400166'	201 06 0 06 777774 		MOVEI	S1,-FCODE-1(S1)	; GET TO TOP OF FFBLOK
   272						 ; FIRST CHECK DESCRIPTOR ON STACK
   273	400167'	554 05 0 01 777777 		HLRZ	P2,-1(STACK)	; GET DATATYPE
   274	400170'	302 05 0 00 004012 		CAIE	P2,DDT		; IS IT DEFINED
   275	400171'	003 01 0 00 000032 		ERROR.	1,26		; NO- GIVE ERROR
   276						 ; COMPARE DATATYPE ON STACK WITH DATA EXPECTED BY FIELD
   277	400172'	200 05 0 01 777777 		MOVE	P2,-1(STACK)	; LOAD ADDRESSOF DBLOK
   278	400173'	550 07 0 05 000002 		HRRZ	S2,ADFBLK(P2)	; LOAD ASSOCIATED DFBLOK ADDR.
   279	400174'				FLDRF2:	 ; MERGE HERE FROM OTHER FFBLOK
   280	400174'	550 10 0 06 000004 		HRRZ	S3,FFDFBL(S1)	; GET DATATYPE OF FIELD
   281	400175'	312 07 0 00 000010 		CAME	S2,S3		; ARE THESE THE SAME
   282	400176'	254 00 0 00 400204'		JRST	FLDRF1		; NO - BRANCH
   283
   284
   285						 ; FIX UP DESCRIPTOR ON STACK TO BE A VARIABLE
   286	400177'	554 11 0 06 000004 		HLRZ	T1,FFOFFS(S1)	; LOAD ASSOCIATED OFFSET
   287	400200'	202 11 0 01 000000 		MOVEM	T1,0(STACK)	; ESTABLISH AS DESCRIPTOR'S OFFSET
   288	400201'	201 11 0 00 064000 		MOVEI	T1,VAR		; INSERT VAR
   289	400202'	506 11 0 01 777777 		HRLM	T1,-1(STACK)	; AS DATATYPE INDICATOR
   290	400203'	254 00 0 04 000001 		JRST	1(PLINK)	; AND RETURN
   291
   292						 ; HERE TO TRY FOR ANOTHER FFBLOK
   293	400204'	550 06 0 06 000005 	FLDRF1:	HRRZ	S1,FFLINK(S1)	; SEE IF ANOTHER FFBLOK EXISTS
   294	400205'	327 06 0 00 400174'		JUMPG	S1,FLDRF2	; YES, TRY IT
   295	400206'	003 01 0 00 000027 		ERROR.	1,23		; INAPPROPRIATE DATATYPE
   296

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 9
SNODFD	MAC	13-Oct-66 22:07		LFBLOK

   297						SUBTTL	LFBLOK
   298
   299						 ; CALLING SEQUENCE
   300						 ;	LOAD Q2 WITH ADDRESS OF VFUNC FIELD
   301						 ;	JSP	QLINK,LFBLOK
   302						 ;	RETURN WITH Q2 CONTAINING ADDRESS OF FBLOK
   303
   304	400207'	550 16 0 16 000000 	LFBLOK::HRRZ	Q2,0(Q2)	; PICK UP ADDRESS OF FBLOK
   305	400210'	311 16 0 00 000000*		CAML	Q2,GRID##	; SKIP IF BELOW DYNAMIC AREA
   306	400211'	311 16 0 00 000000*		CAML	Q2,CEIL##	; SKIP IF WITHIN DYNAMIC AREA
   307	400212'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN Q3 IF ITS PURE
   308
   309	400213'	554 00 0 16 000000 		HLRZ	Z,BTCODE(Q2)	; GET TYPE OF BLOK
   310	400214'	302 00 0 00 000424 		CAIE	Z,TFBLOK	; SKIP IF BEING TRACED
   311	400215'	254 00 0 15 000000 		JRST	0(QLINK)	; RETURN IF NOT
   312
   313	400216'	550 16 0 16 000004 		HRRZ	Q2,TFOLD(Q2)	; PICK UP OLD FBLOK
   314	400217'	254 00 0 15 000000 		JRST	0(QLINK)	; AND RETURN IT
   315

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 10
SNODFD	MAC	13-Oct-66 22:07		IFBLOK

   316						SUBTTL	IFBLOK
   317
   318					; CALLING SEQUENCE:
   319					;	LOAD Q2 WITH ADDRESS OF VFUNC, VBINRY OR VUNARY
   320					;	FIELD OF A VARIABLE BLOCK
   321					;	LOAD Q3 WITH ADDRESS OF NEW FBLOK (TO BE INSERTED INTO 
   322					;	THE RECEPTACLE)
   323					;	JSP	QLINK,IFBLOK
   324					;	RETURN
   325					;
   326					; IN WHAT FOLLOWS:
   327					;	Q1 = OLD FBLOK
   328					;	Q2 = RECEPTACLE
   329					;	Q3 = NEW FBLOK
   330
   331	400220'				IFBLOK::
   332	400220'	202 15 0 00 000000*		MOVEM	QLINK,IGNOQ##	; SAVE RETURN
   333					 ; LOOP BACK HERE IF OLD IS TFBLOK
   334	400221 15 0 16 000000 	IFBL2:	HRRZ	Q1,0(Q2)	; GET OLD FBLOK
   335	400222'	542 17 0 16 000000 		HRRM	Q3,0(Q2)	; INSERT NEW FBLOK
   336					; IF OLD FBLOK IS OUTSIDE THE DYNAMIC AREA
   337					; IT CAN BE REPLACED WITHOUT FURTHER ADO.
   338	400223'	311 15 0 00 400210*		CAML	Q1,GRID		; SKIP IF BELOW DYN. AREA
   339	400224'	311 15 0 00 400211*		CAML	Q1,CEIL		; SKIP IF WITHIN DYN. AREA
   340	400225'	254 00 1 00 400220*		JRST	@IGNOQ		; JUST RETURN
   341
   342					; IS THE OLD FBLOK TRACED?
   343	400226'	554 00 0 15 000000 		HLRZ	Z,BTCODE(Q1)	; GET TYPE OF OLD
   344	400227'	302 00 0 00 000424 		CAIE	Z,TFBLOK	; SKIP IF BEING TRACED
   345	400230'	254 00 0 00 400236'		JRST	IFBL1		; JUMP IF NOT
   346
   347					; JUST ADVANCE RECEPTACLE FOR TFBLOK'S
   348	400231'	542 15 0 16 000000 		HRRM	Q1,0(Q2)	; INSERT OLD FBLOK
   349
   350	400232'	200 00 0 17 000002 		MOVE	Z,FFLAGS&FNARGS(Q3)  ; TRANSFER
   351	400233'	202 00 0 15 000002 		MOVEM	Z,FFLAGS&FNARGS(Q1)  ; GOODIES
   352
   353	400234'	201 16 0 15 000004 		MOVEI	Q2,TFOLD(Q1)	; POINT TO NEW SPOT
   354	400235'	254 00 0 00 400221'		JRST	IFBL2		; AND LOOP BACK
   355
   356					; IF BOTH NEW AND OLD ARE FFBLOK'S WE MUST CHAIN
   357					; THE OLD OFF THE NEW
   358	400236'	302 00 0 00 000422 	IFBL1:	CAIE	Z,FFBLOK	; SKIP IF OLD IS FFBLOK
   359	400237'	254 00 1 00 400225*		JRST	@IGNOQ		; RETURN IF NOT
   360	400240'	554 00 0 17 000000 		HLRZ	Z,BTCODE(Q3)	; PICK UP CODE FOR NEW
   361	400241'	302 00 0 00 000422 		CAIE	Z,FFBLOK	; SKIP IF FFBLOK
   362	400242'	254 00 1 00 400237*		JRST	@IGNOQ		; RETURN IF NOT
   363	400243'	542 15 0 17 000005 		HRRM	Q1,FFLINK(Q3)	; LINK THEM TOGETHER
   364	400244'	254 00 1 00 400242*		JRST	@IGNOQ		; AND RETURN.
   365

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 11
SNODFD	MAC	13-Oct-66 22:07		IFBLOK

   366						END

NO ERRORS DETECTED

HI-SEG. BREAK IS 400247
PROGRAM BREAK IS 000000
CPU TIME USED 02:48.762

42P CORE USED
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page S-1
SNODFD	MAC	13-Oct-66 22:07		SYMBOL TABLE

ADFBLK		000002	sin	FLDRF2		400174'		
BLENG		000000	sin	FNARGS		000002	sin	
BTCODE		000000	sin	FRET2		400104'	ext	
CEIL		400224'	ext	FSAFL		000002	sin	
CRTDAT		400135'	int	GCFLD		000001	sin	
CRTDT$		400074'	ext	GCOLF		400144'	ext	
CURSOR		400007'	ext	GRID		400223'	ext	
CVTINT		400101'	ext	IFBL1		400236'		
CVTNAM		400106'	ext	IFBL2		400221'		
DATA		400000'	int	IFBLOK		400220'	int	
DATA1		400007'		IGNOQ		400244'	ext	
DATA2		400031'		INSTAL		400061'	ext	
DBLOK		000412	sin	LFBLOK		400207'	int	
DDT		004012	spd	LFFBL		000006	sin	
DF.PRO		400071'		NDT		004011	sin	
DFBLOK		000421	sin	P2		000005		
DFDASC	422150	400000	spd	PLINK		000004		
DFDEDT		000245	spd	Q1		000015		
DFDID		400150'	ext	Q2		000016		
DFDMIN		000000	spd	Q3		000017		
DFDSIX	444644	000000	spd	QLINK		000015		
DFDVER		000005	spd	RETNUL		400070'	ext	
DFDWHO		000000	spd	S1		000006		
DFFLDS		000005	sin	S2		000007		
DFLDS		000003	sin	S3		000010		
DFNAME		000004	sin	SLINK		000006		
DHASH		000002	sin	STACK		000001		
E1$23		000000	sin	STINIT		400000'	ext	
E1$26		000000	sin	STPTR		400010'	ext	
E1$67		000000	sin	STRM		400012'	ext	
E1$68		000000	sin	SURF		000002		
E13$30		000000	sin	SYSCT		400002'	ext	
E13$31		000000	sin	T1		000011		
E13$32		000000	sin	T2		000012		
E13$33		000000	sin	TFBLOK		000424	sin	
E13$34		000000	sin	TFOLD		000004	sin	
E13$59		000000	sin	TLINK		000011		
ERR	001000	000000		VAR		064000	sin	
ERR.	003000	000000		VFLAGS		000006	sin	
FCODE		000003	sin	VFUNC		000003	sin	
FEAFL		000001	sin	VUNARY		000002	sin	
FF.PRO		400075'		Y.CM	001000	000000	spd	
FFBLOK		000422	sin	Y.LP	010000	000000	spd	
FFDFBL		000004	sin	Y.RP	004000	000000	spd	
FFLAGS		000002	sin	Z		000000		
FFLINK		000005	sin	%%JOBD	043100	000450	spd	
FFOFFS		000004	sin	%%MACT	000200	000025	spd	
FIELD		400101'	int	%%SNOP	000500	000305	spd	
FIELD1		400124'		%%UUOS	001400	000457	spd	
FIELD2		400115'		
FLAP		400151'	ext	
FLDC		004000	sin	
FLDREF		400166'	int	
FLDRF$		400100'	ext	
FLDRF1		400204'		

SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 1
SNODFD	MAC	13-Oct-66 22:07		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

ADFBLK	   245	   278
BLENG	   104	   241
BTCODE	   198	   241	   309	   343	   360
CEIL	   306	   339
CRTDAT	   227#
CRTDT$	   167
CURSOR	    84
CVTINT	   181
CVTNAM	   188
DATA	    73#
DATA1	    84#	    92
DATA2	   114#	   149
DBLOK	   240
DDT	   258	   274
DF.PRO	   100	   164#
DFBLOK	   164	   199
DFDASC	    31#
DFDEDT	    24#
DFDID	   243
DFDMIN	    23#
DFDSIX	    30#
DFDVER	    22#
DFDWHO	    25#
DFFLDS	    95	   109	   137	   164	   213
DFLDS	   132	   235	   251
DFNAME	   157
DHASH	   245
E1$23	   295#
E1$26	   275#
E1$67	   189#	   192#
E1$68	   182#
E13$30	    75#
E13$31	   154#
E13$32	    80#
E13$33	   117#
E13$34	    89#
E13$59	   202#
FCODE	   101	   125	   228	   271
FEAFL	   166	   172
FF.PRO	   124	   170#
FFBLOK	   170	   358	   361
FFDFBL	   129	   280
FFLAGS	   350	   351
FFLINK	   134	   293	   363
FFOFFS	   133	   286
FIELD	   180#
FIELD1	   200	   207#
FIELD2	   198#	   204
FLAP	   111	   128	   156	   230	   244
FLDC	   110	   229
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 1
SNODFD	MAC	13-Oct-66 22:07		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

FLDREF	   270#
FLDRF$	   173
FLDRF1	   282	   293#
FLDRF2	   279#	   294
FNARGS	   105	   208	   233	   350	   351
FRET2	   185
FSAFL	   166
GCFLD	   242
GCOLF	    96	   122	   237
GRID	   305	   338
IFBL1	   345	   358#
IFBL2	   334#	   354
IFBLOK	   145	   160	   331#
IGNOQ	   332	   340	   359	   362	   364
INSTAL	   116	   153
LFBLOK	   304#
LFFBL	   121	   148	   170
NDT	   215
P2	   118	   138	   141	   142	   143	   184	   209	   213	   235	   236	   240	   241	   254	   273
	   274	   277	   278
PLINK	   210	   218	   261	   290
Q1	   130	   131	   132	   133	   158	   159	   334	   338	   339	   343	   348	   351	   353	   363
Q2	    91	   141	   143	   159	   304	   305	   306	   309	   313	   334	   335	   348	   353
Q3	   144	   156	   157	   335	   350	   360	   363
QLINK	    96	   122	   145	   160	   237	   307	   311	   314	   332
RETNUL	   161
S1	    82	    92	    95	   104	   105	   109	   130	   137	   149	   194	   197	   228	   229	   230
	   233	   271	   280	   286	   293	   294
S2	    77	   193	   197	   198	   203	   208	   213	   214	   243	   244	   245	   278	   281
S3	    78	    87	   108	   110	   111	   128	   129	   137	   138	   198	   199	   201	   214	   215
	   216	   233	   234	   235	   249	   250	   280	   281
SLINK	   167	   173
STACK	   184	   186	   191	   193	   194	   216	   217	   250	   252	   259	   260	   273	   277	   287
	   289
STINIT	    74
STPTR	    85
STRM	    79	    88
SURF	    99	   101	   104	   105	   108	   109	   123	   125	   129	   133	   134	   144	   148	   241
	   242	   245	   251	   253	   254	   255
SYSCT	    77
T1	   251	   252	   255	   286	   287	   288	   289
T2	   253	   258	   259
TFBLOK	   201	   310	   344
TFOLD	   203	   313	   353
TLINK	    74	    79	    88	   116	   153	   181	   188
VAR	   288
VFLAGS	   142
VFUNC	   141	   159	   197
VUNARY	   143
Y.CM	    87
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 1
SNODFD	MAC	13-Oct-66 22:07		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Symbol cross reference

Y.LP	    78
Y.RP	    87
Z	    95	    99	   100	   101	   118	   121	   123	   124	   125	   157	   158	   208	   209	   236
	   309	   310	   343	   344	   350	   351	   358	   360	   361
SNODFD - Defined Data types  %5(245)	MACRO %53B(1156)-1 21:49 14-Mar-88 Page 1
SNODFD	MAC	13-Oct-66 22:07		Gimpel--Ma355/JDS/DRH/MP/RCM/VB		15-Jun-76


Macro/Opdef cross reference

DFDPTX	    43
DFDTTL	    42
ERR	    75	    80	    89	   117	   154	   202
ERR.	   182	   189	   192	   275	   295
ERROR	    75	    80	    89	   117	   154	   202
ERROR.	   182	   189	   192	   275	   295
MOVX	    78	    87
SHOW.	    37	    38	    39	    40
TITLE.	    29 :DTv‹
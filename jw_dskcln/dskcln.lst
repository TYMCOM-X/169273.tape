DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 1
DSKCLN	MAC	30-Feb-73 19:40	

     1					;18-Jul-84 12:39:28 Edit by WILKES - rem ill mem ref interrupt
     2					; make error msgs ready for the world.
     3					;16-Jul-84 22:15:46 Edit by WILKES - amazing, it appears to work - v 41
     4					;16-Jul-84 17:22:13 Edit by WILKES - v 40 - make pages .prrw when fixing
     5					;10-Jul-84 18:28:25 Edit by WILKES - finish up, ready for full test
     6					;14-Jun-84 12:58:10 Edit by WILKES - put in SW interrupt for ill mem ref
     7					;25-May-84 0:13:31 Edit by WILKES - blow away pre-reffed page in fndsk1
     8
     9					;[37] IFNDEF MAKSW,<MAKSW=0>
    10					IFNDEF DEBUG,<DEBUG==0>
    11					;[37] IFN MAKSW,<DEBUG==0>
    12
    13					TITLE DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT
    14
    15			000041		VRAT==41	;version number
    16
    17					;[41] 16-Jul-84/wilkes
    18					;[41] call it version 41, since it appears to function properly
    19					;[41] fix minor oops in pagwrt when VALPAGing - want virtual page, not disk
    20					;[41] also print version number at startup.
    21					;[40] call it version 40 - 16-Jul-84 - john wilkes (again!)
    22					;[40] make all pages mapped read/write in fix mode, read-only in 
    23					;[40] check mode, since monitor won't let us vcreate in ill mem ref
    24					;[40] interrupt handler.  (god only knows why not...)
    25					;[37] Version 37 21-May-84 John Wilkes
    26					;[37] teach the program about paging.  Re-do PAGRED, FNDSEK, and  PAGWRT
    27					;[37] routines, taking out old-style I/O, putting in paging.  Add interrupt 
    28					;[37] handler for software interrupt system to do the .IAERR software
    29					;[37] interrupt for catching paging I/O errors caused by flaky hardware.
    30					;[37] The philosophy is to handle the errors if they come from the file
    31					;[37] system and they are not associated with a critical file.  Primary 
    32					;[37] objective is to get the system up, and if a few user files get
    33					;[37] blown away, report them to the cty so that the operator can restore
    34					;[37] them.  If the page error is nefarious enough that it cannot be handled,
    35					;[37] abort with an appropriate message suggesting that the disk subsystem
    36					;[37] hardware be checked out.  FNDSEK no longer does seek handling, now
    37					;[37] it uses the same decision-making logic to map/prereference instead.
    38					;[37] PAGRED had to be taught to recognize an already pre-reffed file
    39					;[37] and not try to map it again, but replicate it instead.  In order to
    40					;[37] minimize impact throughout the program, keep the one page area
    41					;[37] called BUF as the place where the most recently requested disk
    42					;[37] page is kept.  When doing pre-referencing, map the pages to another
    43					;[37] area (FNDSEK) then replicate them into BUF (PAGRED).  It is initially
    44					;[37] estimated that these changes will povide a 30-35 % reduction in
    45					;[37] program runtime.
    46					;[37] It turns out that an undocumented "feature" of super-mapping is a
    47					;[37] restriction on the page protection.  super-mapped pages can be
    48					;[37] only read-only or read-write, but not copy-on-write.  so, make pages
    49					;[37] in BUF be read-only and have a software interrupt to handle the
    50					;[37] ill mem ref when we try to scribble there in preparation for doing
    51					;[37] output.  Vclear the super-mapped page and make a private page instead.
    52					;[37] Since cow protection on a super-mapped page will generate the interrupt,
    53					;[37] still do the mapping that way in case this "feature" is ever "fixed".
    54					;[37] Since I could not make much sense out of the DEBUG or MAKSW
    55					;[37] assembly switches, and they interfered greatly in the I/O
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 1-1
DSKCLN	MAC	30-Feb-73 19:40	

    56					;[37] routines, remove them.  DEBUG version now never writes (thruogh PAGWRT)
    57					;[37] on disk, nor does it do the DSKCLR UUO.  So-called "file-maker"
    58					;[37] version (MAKSW=1) no longer exists.
    59					;[37] Also, as part of initially understanding the program's logic, add 
    60					;[37] comments as necessary for clarification (mine, if nobody else's!).
    61					;[37] Comments added merely to clarify existing code are not flagged with
    62					;[37] an edit level.  All new lines of code have comments marked with an
    63					;[37] edit level.  Any lines of existing code that were removed, were commented
    64					;[37] out with the edit level that blew them away indicated.
    65					;version 36 11/15/81 DWS
    66					; 1. make sure system is super shut before running in fix mode.
    67					; 2. try to improve error messages for critical files (in/around crterr:).
    68					; 3. comment out dead code (swpprc:) from edit 35.
    69					;version 35 7/17/81 WRS
    70					; 1. continue analysis if critical file damaged while in check mode
    71					; 2. eliminate SWAP.SYS as a critical file
    72					;VERSION 34
    73					;CHECK FOR UNIT OUT OF RANGE IN FNDSK1
    74					;VERSION 33.
    75					;DSKCLN CAN NOW CONDITIONALLY PROCESS SELECTED SUBSETS OF FILE
    76					; STRUCTURES.  THE SUBSET DESIRED IS PASSED TO DSKCLN BY A TYPE
    77					; NUMBER (AN INTERER FROM 0-7) ENTERED BY THE OPER IN CHECKING
    78					; MODE OR GETTABED IF FIX MODE.  THREE TYPES ARE CURRENTLY AVAILABLE:
    79					; 0  NONE:  THIS STRUCTURE NEEDS NO ANALYSIS
    80					; 1  FAST:  EXAMINE ONLY THOSE FILES WHICH HAVE RECENTLY UNDERGONE
    81					;	    ALLOCATION.  THIS IS ACCOMPLISHED BY CHECKING THE BIT
    82					;	    UFPALC IN THE UFD ENTRY FOR EVERY FILE.  AFTER ANALYSIS,
    83					;	    IF FIXING IS BEING PERFORMED, THE DSKCLN GENERATED SATS
    84					;	    ARE ANDED WITH THE DSK SATS.
    85					; 7  FULL:  CHECK AND/OR CORRECT FILE PROBLEMS OVER ENTIRE STR.  THIS
    86					;	    WAS THE ONLY MODE PREVIOUSLY AVAILABLE.
    87					; DSKCLR CALLS WERE MODIFIED TO CONFORM TO THE NEW DSKCLR UUO FORMAT
    88					; WHICH WAS NECESSARY TO SUPPORT MODE. 0.  IDENT NOW REPORTS MODE.
    89					; OUTPUT TO TTY NO LONGER USES BUFFERED I/O.  DSKCLN IDENTIFIES
    90					; ITSELF, REPORTS KEY FACTS ON STRUCTURE UNDER ANALYSIS, AND PRINTS
    91					; TERMINATION MESSAGE ON CTY. 4/25/80 /TLC.
    92					;VERSION 32.
    93					;MERGED 2020 MODIFICATIONS WITH DSKCLN VERSION 31 USING DSKCLN V30
    94					; AS THE MASTER FILE / FEB 8,1980 ELB/ SEE BELOW DESCRIPTION FOR
    95					; 2020 CHANGES
    96					;MODIFIED 1/17/79 BY DSB TO USE DSKCHR TO GET SOME OF THE HOME FILE
    97					; STRUCTURE: ADDRESSES OF HOME, BAT PAGES AND SIZE & LENGTH OF THE
    98					; BOOTSTRAP AREA.
    99
   100			000137		JOBVER==137
   101	000137				LOC	JOBVER
   102	000137	000000	000041			VRAT
   103	000000'					RELOC
   104					INTERNAL JOBVER,JOBREN
   105
   106					;PARAMETERS FROM COMMOD.MAC
   107
   108			000000		HOMNAM==0	;"HOM" IN SIXBIT
   109			000002		HOMSNM==2	;FILE STR NAME UNIT IS IN
   110			000003		HOMNXT==3	;ID OF NEXT UNIT IN FILE STRUCTURE
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 1-2
DSKCLN	MAC	30-Feb-73 19:40	

   111			000005		HOMLOG==5	;LOGICAL NAME OF THIS UNIT IN FILE STR (DSKB5)
   112			000006		HOMLUN==6	;LOGICAL UNIT IN STR
   113			000007		HOMP4S==7	;PAGES FOR SWAPPING
   114			000013		HOMSLP==13	;FIRST LOGICAL BLOCK FOR SWAPPING
   115			000015		HOMSPU==15	;SATS ON THIS UNIT
   116			000016		HOMOVR==16	;OVERDRAW ALLOWED
   117			000017		HOMSAT==17	;LOGICAL BLOCK WITHIN STR OF 1ST RIB FOR SAT.SYS
   118			000020		HOMHMS==20	;LOGICAL BLOCK WITHIN STR OF 1ST RIB FOR HOME.SYS
   119			000021		HOMSWP==21	;LOGICAL BLOCK WITHIN STR OF 1ST RIB FOR SWAP.SYS
   120			000023		HOMSUF==23	;LOGICAL BLOCK WITHIN STR OF 1ST RIB FOR SYS UFD
   121			000025		HOMMFD==25	;LOGICAL BLOCK WITHIN STR OF 1ST MFD RIB
   122			000027		HOMHSH==27	;HASH CODE FOR DIRECTORIES STORED HERE
   123			000776		HOMCOD==776	;CONAINS UNLIKELY CODE
   124			000777		HOMSLF==777	;THIS BLOCK WITHIN UNIT
   125
   126					;CHANIO IDECIS
   127			000000		CIO.RL==0	;RELEASE
   128			000013		CIO.OP==13	;OPEN
   129			000014		CIO.IN==14	;IN
   130			000015		CIO.OT==15	;OUT
   131			000016		CIO.ST==16	;SETSTS
   132			000024		CIO.SK==24	;SEEK
   133			000031		CIO.PI==31	;PAGE USETI
   134			000032		CIO.PO==32	;PAGE USETO
   135
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 2
DSKCLN	MAC	30-Feb-73 19:40	

   136			000051		RIBPFS==51	;FIRST POINTER IN PRIME RIB
   137			000775		RIBLST==775	;LAST POINTER IN ANY RIB
   138			000004		RIBSFS==4	;FIRST POINTER IN SPARE RIB
   139			000000		RIBRIB==0	;BACK POINTER IN RIB
   140			000001		RIBRPS==1	;UP LEVEL WORD POINTER
   141			000002		RIBSZS==2	;SIZE OF A SPARE RIB POINTER IN THIS RIB
   142			000003		RIBSNM==3	;NUMBER OF SPARE RIBS IN TOP LEVEL POINTER
   143			000004		RIBPPN==4
   144			000005		RIBNAM==5
   145			000006		RIBEXT==6
   146			000007		RIBPVW==7
   147			000010		RIBSIZ==10
   148			000017		RIBLCW==17
   149			000022		RIBSTS==22
   150			000030		RIBUSD==30
   151			000027		RIBMXA==27
   152			000036		RIBALP==36	;NUMBER OF PAGES ALLOCATED
   153			000776		RIBCOD==776
   154			000777		RIBSLF==777
   155
   156			400000		RIPNUB==400000
   157			400000		RIPDIR==400000
   158			000001		RIPBDA==1		;FILE FOUND BAD BY DAMAGE ASSESMENT
   159			002000		RIPALC==(1B7)	;FILE MODIFIED RECENTLY (IN LH RIBLCW)
   160
   161			000010		PTSUNI==^D8	;UNIT FIELD IN POINTER
   162			000020		PTNUNI==^D16
   163			000023		PTSPNO==^D19
   164			000043		PTNPNO==^D35
   165			200000		RBREAL==200000	;REAL POINTER
   166			400000		RBSPAR==400000	;SPARE RIB POINTER
   167			000725		RBLVPR==RIBLST-RIBPFS+1	;NUMBER OF POINTERS IN PRIME RIB
   168			000772		RBLVSR==RIBLST-RIBSFS+1	;NUMBER OF POINTERS IN SPARE RIB
   169
   170			070717		CODHOM==070717	;UNLIKELY CODE FOR HOME BLOCK
   171			666666		CODRIB==666666	;DITTO FOR BAT BLOCK.
   172
   173			001000		BLKSIZ==1000
   174
   175					;END PARAMETERS FROM COMMOD.MAC
   176
   177					EXTERN	JOBREL,JOBFF,JOBSA
   178
   179			000124		JOBREN==124
   180	000124					LOC JOBREN
   181	000124	000000	000000'			RENADR
   182	000000'					RELOC
   183
   184	000000'	402 00 0 00 005503'	RENADR:	SETZM DETSW	;clear AUTO-RESTART flag when re-entering
   185	000001'	265 17 0 00 003275'		JSP P,CHKOPR	;make sure we have OP license
   186	000002'	254 00 0 00 000054'		JRST RENAD1	;DO NOT DO THE FIX FUNCTION, JUST DSKRAT
   187
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 3
DSKCLN	MAC	30-Feb-73 19:40	

   188					;ACS
   189
   190			000000		M=0
   191			000001		T=1		;\
   192			000002		T1=T+1		; \
   193			000003		T2=T+2		;  > temporaries, usually
   194			000004		T3=T+3		; /
   195			000005		T4=T+4		;/
   196			000006		N=6		;used for numeric output usually
   197			000007		N1=N+1		;used by numeric output routines, usually
   198			000010		CH=10		;used by character output routines, usually
   199			000011		CHAN=11		;software channel kept here
   200			000012		U=12		;the unit in use, usually
   201			000013		P1=13		;\
   202			000014		P2=P1+1		; \
   203			000015		P3=P2+1		; /
   204			000016		P4=P3+1		;/
   205			000017		P=17		;stack pointer always
   206
   207					;IO CHANNELS
   208
   209			000000		DSK==0		;FOR READING DISK
   210			000016		LPT==16		;FOR OUTPUT
   211			000016		MXCHN==16	;MAX NUMBER OF CHANNELS TO HAVE
   212			000017		FIL==17
   213
   214					;DSKCHR INDICES
   215
   216			000004		.CHSNM==4	;NAME OF STR
   217			000005		.CHCHR==5	;CHARACTERISTICS
   218			000006		.CHBPU==6	;BLOCKS ON THIS UNIT
   219			000020		.CHHA==20	;HOME PAGE 1,,HOME PAGE 2
   220			000021		.CHBA==21	;BAT PAGE 1,,BAT PAGE 2
   221			000022		.CHBSA==22	;# PAGES IN BOOTSTRAP AREA,,FIRST PAGE IN BOOTSTRAP AREA
   222
   223			000023		.CHLEN==1+.CHBSA	;WORDS IN DSKCHR ARGUMENT LIST
   224
   225		254000	000000		OPDEF PJRST [JRST]
   226
   227
   228						DEFINE ERRLEV (A)
   229					<	XCT A,[PUSHJ P,ERLSET]>
   230
   231					;FILE LOOKUP ENTER INDICES
   232
   233			000002		FLMNAM==2
   234			000003		FLMEXT==3
   235			000001		FLMPPN==1
   236			000017		FLMSTS==17
   237
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 4
DSKCLN	MAC	30-Feb-73 19:40	

   238			000000		UFDNAM==0	;NAME
   239			000001		UFDEXT==1	;EXTENSION (LEFT HALF)
   240			000001		UFDPRV==1
   241			000001		UFDUF2==1
   242			000002		UFDTMD==2
   243			000003		UFDLIC==3
   244			000003		UFDALC==3
   245			000004		UFDRBP==4	;POINTER TO RIB
   246			000005		UFDSIZ==5	;number of words in a single UFD entry
   247			000771		UFDLST=<<1000/UFDSIZ>-1>*UFDSIZ	;LAST UFD ENTRY
   248			020000		UFPALC==1B22	;FILE MODIFIED RECENTLY (IN RH UFDUF2)
   249
   250			000001		LEVMIN==1		;MINOR DAMAGE NO TROUBLE
   251			000002		LEVUSR==2		;SINGLE USER(S) DAMAGED
   252			000003		LEVCRS==3		;ERROR BAD ENOUGH TO CAUSE CRASH
   253			000004		LEVBAD==4		;ERROR IS BAD ENOUGH TO GARBAGE WORSE
   254					IF1,<
   255					IFN DEBUG,<PRINTX DEBUG VERSION>
   256					;[37] IFN MAKSW,<PRINTX FILE MAKER>>
   257
   258					;[37] IFN MAKSW!DEBUG,<FILSIZ==17777	;NUMBER OF BLOCKS PERMITTED
   259					;[37] 	FILOFS==<FILSIZ+200>/200>
   260
   261			000000		BATNAM==0	;INFO FOR BAT BLOCKS
   262			505050		CODBAT==505050
   263			000776		BATCOD==776
   264			000777		BATSLF==777
   265			000001		BATFIR==1
   266			000001		BATELB==1	;PAGE NUMBER OF ERROR WITHIN REGION
   267			000000		BATNBB==0	;LOCATION OF NUMBER OF BAD PAGES
   268			000011		BASNBB==^D9	;SIZE OF FIELD
   269			000010		BANNBB==^D8	;LOW ORDER BIT (FOR BYTE POINTER)
   270
   271					;DSKCLR MODES
   272
   273			000000		DC.CLR==0	;CLEAR IN-CORE DISK INFO
   274			000001		DC.FPC==1	;SET STTFPC FOR ALL SATS ON ALL UNITS
   275			000002		DC.NDS==2	;CLEAR SRPNDS ONLY
   276
   277			000001		JACCT==1
   278			000000		JBTSTS==0
   279			100000		LICOPR==100000
   280			040000		LICSY==(1B3)
   281			004000		LICST==(1B6)
   282			001000		LICJL==(1B8)
   283			000014		LICRA==(3B15)
   284			000003		LICWA==(3B17)
   285		777777	777760		LICTAB==-20
   286			000011		CNFTAB==11	;CONFIGURATION TABLE WITH SYSTEM NAME
   287		777777	777752		LINJOB==-26	;GETTAB FOR JOB TO LINE CONVERSION
   288
   289			000100		PDLSIZ==100	; stack size
   290					ARRAY PDL[PDLSIZ]
   291
   292			777000		buf=777000		;[37] put BUF at top of core - page 777
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 4-1
DSKCLN	MAC	30-Feb-73 19:40	

   293			000777		bufpag==buf/1000	;[37] remember the page number, too
   294			776000		pago=776000		;[37] put output page on page 776
   295			000776		pagopg==pago/1000	;[37] remember its page number
   296					array mapwd[2]		;[37] for mapping UUOs
   297			000043		.chsmp=43		;[37] CHANIO super map absolute disk pages
   298		002000	000000		.prro==1b7		;[37] Read Only page protection
   299		004000	000000		.prcw==2b7		;[37] Copy On Write (mooooo)
   300		006000	000000		.prrw==3b7		;[37] Read/Write page protection
   301		000001	000000		cnt1==1b17		;[37] count of one for paging uuos
   302		002000	000000		.addws==1b7		;[37] add flag for .WSRNG
   303			000001		.wsrng=1		;[37] WSCTL add/remove from working set
   304		002000	000000		ps.ner==1b7		;[37] PERSET ignore errors
   305			000002		ia.ree==2		;[37] (re)enable interrupt system function
   306			000012		.iaerr==12		;[37] paging i/o error interrupt cause number
   307			000002		.iailm==2		;[37] ill mem ref interrupt cause number
   308		002000	000000		vl.wat==1b7		;[37] VALPAG wait for dirty pages to be written
   309			000005		vlioe%==5		;[37] VALPAG i/o error has occurred error code
   310
   311					;[37] ARRAY IOCW[2],CHRBUF[.CHLEN],BUF[1000],LOBUF[3]
   312					;[37] BUF defined above
   313					ARRAY IOCW[2],CHRBUF[.CHLEN],LOBUF[3]
   314					ARRAY TRMBLK[^D30],CNFNAM[6],FIXREN,FIXPTR,FIXBAD[2]
   315					ARRAY CHANU,CHANUU[MXCHN],FILNAM[FLMSTS+1],UFDPCT[1000]
   316
   317			001021		ERRPPN==ERRNAM+3
   318			001017		ERREXT==ERRNAM+1
   319
   320					;[37] IFN MAKSW!DEBUG,<ARRAY TABCMD[2],BLKCNT[FILSIZ+1]>
   321
   322			000017		STAITM==17	;GETTAB ITEM AND TABLE FOR STATES WORD
   323			000011		STATAB==11
   324			000025		LOGITM==25	;GETTAB ITEM AND TABLE FOR LOGOUT NAME
   325			000011		LOGTAB==11
   326			000011		DATITM==11	;GETTAB ITEM AND TABLE FOR DATE
   327			000011		DATTAB==11
   328			000010		TIMITM==10	;GETTAB ITEM AND TABLE FOR TIME (JIFFIES)
   329			000011		TIMTAB==11
   330
   331			000005		DCNITM==5	;GETTAB ITEM AND TABLE FOR DSKCLN TYPE
   332			000015		DCNTAB==15
   333
   334			000000		SUUMSG==0	;DISPATCH CODE FOR SETUUO MESSAGE
   335			000002		SUUINI==2	;DISPATCH CODE FOR SETUUO INITIA PASS 2
   336
   337			020000		DV.TTA==(1B4)	;IS A JOBS COMMAND PORT
   338
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 5
DSKCLN	MAC	30-Feb-73 19:40	

   339					;DEFINE LOCATIONS TO GO IN THE BLOCKS TO CONTROL SCAN OF
   340					;UFD, MFD, AND FILES
   341
   342						DEFINE UUU(A,B)
   343					<	A==%%Z
   344						%%Z==%%Z+B>
   345
   346			000000		%%Z==0
   347						UUU RIBLBN,1	^;RETRIEVAL PNTR TO RIB
   348						UUU NXTPTR,1	^;BLOCK NUMBER CURRENTLY BEING READ
   349						UUU UFDPTR,1	^;POINTER TO THE UFD SLOT
   350						UUU UFDOGP,1	^;UFD ORIGIN POINTER
   351						UUU ROUTIN,1	^;ROUTINE TO CALL TO GET DOWN A LEVEL
   352						UUU SAVRIB,1000	^;MOVE THE RIB HERE
   353						UUU DEVRSU,1	^;POINTR INTO RIB INFO
   354						UUU DEVREL,1	^;LOGICAL BLOCK NUMBER
   355						UUU SAVBLK,1	^;POINTER TO PLACE TO SAVE CURRENT BLOCK
   356						UUU UFDBKF,2	^;FOR CHANGES TO UFD BLK
   357			001012			UUU UFDUSD,1^	UFDUSD==%%Z
   358				 FIXRBP,2	^;FOR CHANGS TO RIB
   359						UUU UFDLSD,1	^;THIS UFD HAS LOST DATA
   360			001016			UUU ERRNAM,1^	ERRNAM==%%Z
   361			001017			UUU ERREXT,1^	ERREXT==%%Z
   362			001020			UUU ERRPPN,1^	ERRPPN==%%Z
   363						UUU UFDHSP,1	^;POINTER TO HASH TABLE FOR UFD
   364						UUU SIZRIB,1	^;NUMBER OF LOGICAL BLOCKS TO EOF
   365						UUU ALCRIB,1	^;NUMBER OF REAL PPAGES
   366
   367					ARRAY MFDRIB,UFDRIB,FILRIB[%%Z]
   368					ARRAY MFDBUF,UFDBUF[1000]
   369
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 6
DSKCLN	MAC	30-Feb-73 19:40	

   370	000003'	200 17 0 00 014046'	STPT:	MOVE	P,[IOWD PDLSIZ,PDL]	; Set up the stack
   371
   372					IFE DEBUG,<
   373	000004'	561 01 0 00 000000 		HRROI	T,JBTSTS
   374	000005'	047 01 0 00 000041 		GETTAB	T,
   375	000006'	254 00 0 00 003205'		 JRST	NOJAL
   376	000007'	661 01 0 00 000001 		TLO	T,JACCT			;MAKE SURE WE DO NOT GET STOPPED
   377	000010'	047 01 0 00 777757 		SETJAL	T,
   378	000011'	254 00 0 00 003205'		 JRST	NOJAL
   379					>; IFE DEBUG
   380
   381	000012'	402 00 0 00 005503'		SETZM	DETSW#			; Clear AUTO RESTART flag
   382	000013'	200 01 0 00 014047'		MOVE	T,[STAITM,,STATAB]
   383	000014'	047 01 0 00 000041 		GETTAB	T,			; Check state of system
   384	000015'	201 01 0 00 000000 		 MOVEI	T,0
   385	000016'	603 01 0 00 000001 		TLNE	T,1			; Still in AUTO RESTART?
   386	000017'	476 00 0 00 005503'		 SETOM	DETSW#			; Yes, set flag.
   387
   388						MOVEI	M,[ASCIZ /
   389	000020'	201 00 0 00 014050'	     D-S-K-C-L-N     /]
   390	000021'	260 17 0 00 003173'		PUSHJ	P,TRMMES		;IDENTIFY OURSELF
   391	000022'	201 00 0 00 014055'		movei m,[asciz \version: %\]	;[41] 
   392	000023'	260 17 0 00 003173'		pushj p,trmmes			;[41] 
   393	000024'	201 06 0 00 000041 		movei n,vrat			;[41] 
   394	000025'	260 17 0 00 003512'		pushj p,octcty			;[41] tell version number
   395						movei m,[asciz \
   396	000026'	201 00 0 00 014060'	\]
   397	000027'	260 17 0 00 003173'		pushj p,trmmes
   398
   399	000030'	476 00 0 00 006557'		SETOM 	FIXFLG#			; Assume we're doing fixup
   400	000031'	332 00 0 00 005503'		SKIPE	DETSW#			; Are we in AUTO RESTART?
   401	000032'	254 00 0 00 000037'		  JRST	STPT1			; Yes, continue checking
   402	000033'	402 00 0 00 006557'		SETZM	FIXFLG			; No, only checking function - no fixup
   403						MOVEI	M,[ASCIZ/
   404					SYSTEM IS NOT IN AUTO-RESTART.
   405					ONLY CHECKING FUNCTION WILL BE PERFORMED.
   406	000034'	201 00 0 00 014061'	/]
   407	000035'	260 17 0 00 003173'		PUSHJ	P,TRMMES
   408	000036'	254 00 0 00 000045'		JRST	STPT2
   409
   410	000037'	047 00 0 00 777760 	STPT1:	ONEJOB				; Skip if we're the only job
   411	000040'	334 00 0 00 000000 		 SKIPA				; no, we're not
   412	000041'	254 00 0 00 000055'		JRST	GOFIX			; yes, continue checking
   413						MOVEI	M,[ASCIZ/
   414					NOT THE ONLY JOB.
   415					ONLY CHECKING FUNCTION WILL BE PERFORMED.
   416	000042'	201 00 0 00 014101'	/]
   417	000043'	260 17 0 00 003173'		PUSHJ	P,TRMMES
   418	000044'	402 00 0 00 006557'		SETZM	FIXFLG			; Checking function only
   419
   420	000045'	265 17 0 00 003275'	STPT2:	JSP	P,CHKOPR		; Make sure that we have license
   421	000046'	561 01 0 00 000000 		HRROI	T,JBTSTS		; No, Reset JACCT
   422	000047'	047 01 0 00 000041 		GETTAB	T,
   423	000050'	254 00 0 00 003205'		 JRST	NOJAL
   424	000051'	621 01 0 00 000001 		TLZ	T,JACCT
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 6-1
DSKCLN	MAC	30-Feb-73 19:40	

   425	000052'	047 01 0 00 777757 		SETJAL	T,
   426	000053'	254 00 0 00 003205'		 JRST	NOJAL
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 7
DSKCLN	MAC	30-Feb-73 19:40	

   427	000054'	402 00 0 00 006557'	RENAD1:	SETZM FIXFLG		;HERE FROM REENTER
   428
   429	000055'	200 17 0 00 014046'	GOFIX:	MOVE	P,[IOWD PDLSIZ,PDL]
   430	000056'	260 17 0 00 003177'		PUSHJ	P,CHKLIC	;Determine if prog has correct lic
   431	000057'	200 01 0 00 000000*		MOVE	T,JOBREL	;RECORD UPPER
   432	000060'	202 01 0 00 005407'		MOVEM	T,UPRBND	;BOUND OF CORE.
   433	000061'	201 01 0 00 777000 		movei	t,buf		;[37] addr of input buffer
   434	000062'	202 01 0 00 006567'		movem	t,hiaddr#	;[37] 1st addr in himem not available to GETCOR
   435
   436					;[37] IFN MAKSW!DEBUG,<
   437					;[37] 	MOVE T,[IOWD FILSIZ+1,BLKCNT]
   438					;[37] 	MOVEM T,TABCMD
   439					;[37] 	SETZM TABCMD+1>
   440
   441					;[37] set up software interrupt system for handling paging errors
   442	000063'	200 01 0 00 014116'		move	t,[ia.ree,,intvec]	;[37] 
   443	000064'	047 01 0 00 777745 		intadr	t,		;[37] crank up the software interrupt system
   444	000065'	254 00 0 00 003211'		 jrst	interr		;[37] 
   445	000066'	200 01 0 00 014117'		move	t,[.iaerr,,1]	;[37] page i/o errors,,SI channel 1
   446	000067'	047 01 0 00 777742 		intass	t,		;[37] 
   447	000070'	254 00 0 00 003211'		 jrst	interr		;[37] 
   448	000071'	200 01 0 00 014120'		move	t,[1B0!1B1]	;[37] enable interrupts on channel 1
   449	000072'	047 01 0 00 777744 		intenb	t,		;[37] 
   450	000073'	254 00 0 00 003211'		 jrst	interr		;[37] 
   451
   452	000074'	200 01 0 00 014121'		MOVE T,[IOWD 1000,BUF]
   453	000075'	202 01 0 00 006572'		MOVEM T,IOCW
   454	000076'	402 00 0 00 006573'		SETZM IOCW+1	;SET UP FOR DISK OPERATIONS
   455	000077'	205 01 0 00 636462 		MOVSI T,'STR'
   456	000100'	202 01 0 00 005450'		MOVEM T,CHRBUF	;NOW SEE IF STR IS THERE
   457	000101'	200 01 0 00 014122'		MOVE T,[.CHLEN,,CHRBUF]
   458	000102'	047 01 0 00 000045 		DSKCHR T,
   459	000103'	254 00 0 00 000111'		 JRST ALLSTR	;NOT THERE
   460	000104'	336 01 0 00 005454'		SKIPN T,CHRBUF+.CHSNM
   461	000105'	254 00 0 00 000111'		JRST ALLSTR	;OR NOT PART OF A STRUCTURE
   462	000106'	202 01 0 00 010752'		MOVEM T,STRNAM#	;DO THIS STRUCTURE
   463	000107'	260 17 0 00 000121'		PUSHJ P,CHKSTR
   464	000110'	254 00 0 00 003311'	FINSTR:	JRST	QUIT		;DONE
   465
   466	000111'	402 00 0 00 010752'	ALLSTR:	SETZM STRNAM
   467	000112'	200 01 0 00 010752'	ALLSTL:	MOVE T,STRNAM
   468	000113'	047 01 0 00 000046 		SYSSTR T,	;NEXT STR IN SYSTEM
   469	000114'	254 00 0 00 000110'		 JRST FINSTR
   470	000115'	322 01 0 00 000110'		JUMPE T,FINSTR	;ALL DONE
   471	000116'	202 01 0 00 010752'		MOVEM T,STRNAM
   472	000117'	260 17 0 00 000121'		PUSHJ P,CHKSTR
   473	000120'	254 00 0 00 000112'		JRST ALLSTL
   474
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 8
DSKCLN	MAC	30-Feb-73 19:40	

   475					;START OF ROUTINE TO CHECK A SINGLE STR
   476
   477	000121'	201 01 0 00 003256'	CHKSTR:	MOVEI	T,TRMSAV
   478	000122'	202 01 0 00 011021'		MOVEM	T,TYODSP
   479	000123'	403 03 0 00 006565'		SETZB	T2,FSTFLG#	;INIT FAST DSKCLN FLAG
   480					;[37] IFN MAKSW!DEBUG,<
   481					;[37] 	INIT FIL,16	;GET THE FAKE FILE OPEN
   482					;[37] 	SIXBIT /DSK/
   483					;[37] 	0
   484					;[37] 	 JRST FALFAK
   485					;[37] 	MOVE T,[SIXBIT /FAKFIL/]
   486					;[37] 	SETZB T1,T2
   487					;[37] 	MOVEI T3,0
   488					;[37] IFE MAKSW,<LOOKUP FIL,T
   489					;[37] 	 JRST FALFAK
   490					;[37] 	SETZB T2,T3>
   491					;[37] 	ENTER FIL,T
   492					;[37] 	 JRST FALFAK
   493					;[37] IFN MAKSW,<SETZM BLKCNT>
   494					;[37] IFN DEBUG,<INPUT FIL,TABCMD>>
   495	000124'	332 00 0 00 006557'		SKIPE	FIXFLG
   496	000125'	254 00 0 00 000150'		JRST	DCTFIX
   497	000126'	205 04 0 00 546064 	IFE DEBUG,<MOVSI T3,'LPT'>
   498					IFN DEBUG,<MOVSI T3,'LST'>
   499	000127'	205 05 0 00 006574'		MOVSI T4,LOBUF
   500	000130'	050 16 0 00 000003 		OPEN LPT,T2
   501	000131'	254 00 0 00 003227'		 JRST FALLPT	;CAN NOT GET IT
   502	000132'	200 02 0 00 010752'		MOVE T1,STRNAM
   503	000133'	205 03 0 00 624164 		MOVSI T2,'RAT'
   504	000134'	403 04 0 00 000005 		SETZB T3,T4
   505	000135'	077 16 0 00 000002 		ENTER LPT,T1
   506	000136'	254 00 0 00 003227'		 JRST FALLPT	;CAN NOT GET LPT
   507	000137'	200 13 0 00 014123'	DCTENT:	MOVE	P1,[POINT 7,TRMBLK]
   508	000140'	200 01 0 00 010752'		MOVE	T,STRNAM
   509	000141'	260 17 0 00 003616'		PUSHJ	P,PR6BIT
   510	000142'	260 17 0 00 003603'		PUSHJ	P,NULL		;TERMINATE STRING
   511	000143'	051 03 0 00 010762'		OUTSTR	TRMBLK
   512	000144'	051 03 0 00 014124'		OUTSTR	[ASCIZ / MODE CODE: /]	;QUERY USER FOR TYPE CODE
   513	000145'	051 00 0 00 000001 		INCHRW	T		;GET HIS RESPONSE
   514	000146'	275 01 0 00 000060 		SUBI	T,"0"		;CONVERT TO BINARY
   515	000147'	254 00 0 00 000153'		JRST	DCT1
   516	000150'	200 01 0 00 014127'	DCTFIX:	MOVE	T,[DCNITM,,DCNTAB]	;GET TYPE CODE FROM
   517	000151'	047 01 0 00 000041 		GETTAB	T,			; SYSTEM
   518	000152'	201 01 0 00 000007 		 MOVEI	T,7		;DEFAULT TO FULL
   519	000153'	612 01 0 00 014130'	DCT1:	TDNE	T,[-10]		;DOES CODE OVERFLOW ITS FIELD?
   520	000154'	254 00 0 00 000177'		JRST	DCNDEF		;YES
   521	000155'	256 00 0 01 000157'		XCT	DCNDIS(T)	;DISPATCH ON TYPE
   522	000156'	254 00 0 00 000220'		JRST	CHKST1		;CODE DEFINED
   523
   524	000157'	254 00 0 00 000610'	DCNDIS:	JRST	DONST1		;0  NONE
   525	000160'	476 00 0 00 006565'		SETOM	FSTFLG		;1  FAST
   526	000161'	254 00 0 00 000177'		JRST	DCNDEF		;2
   527	000162'	254 00 0 00 000177'		JRST	DCNDEF		;3
   528	000163'	254 00 0 00 000177'		JRST	DCNDEF		;4
   529	000164'	254 00 0 00 000177'		JRST	DCNDEF		;5
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 8-1
DSKCLN	MAC	30-Feb-73 19:40	

   530	000165'	254 00 0 00 000177'		JRST	DCNDEF		;6
   531	000166'	255 00 0 00 000000 		JFCL			;7  FULL
   532
   533	000167'	000000	000000		DCNNAM:	0		;0
   534	000170'	46 41 63 64 00 00 		SIXBIT /FAST/	;1
   535	000171'	000000	000000			0		;2
   536	000172'	000000	000000			0		;3
   537	000173'	000000	000000			0		;4
   538	000174'	000000	000000			0		;5
   539	000175'	000000	000000			0		;6
   540	000176'	46 65 54 54 00 00 		SIXBIT /FULL/	;7
   541
   542	000177'	332 00 0 00 006557'	DCNDEF:	SKIPE	FIXFLG
   543	000200'	254 00 0 00 000203'		JRST	DCT2
   544						OUTSTR	[ASCIZ /
   545					LEGAL CODES ARE: 0=NONE, 1=FAST, 7=FULL.
   546	000201'	051 03 0 00 014131'	/]
   547	000202'	254 00 0 00 000137'		JRST	DCTENT		;GIVE USER ANOTHER TRY
   548	000203'	200 13 0 00 014123'	DCT2:	MOVE	P1,[POINT 7,TRMBLK]	;MODE READ FROM MONITOR
   549	000204'	200 01 0 00 010752'		MOVE	T,STRNAM		; IS NOT DEFINED, SO
   550	000205'	260 17 0 00 003616'		PUSHJ	P,PR6BIT		; INDICATE ON CTY
   551	000206'	201 00 0 00 014142'		MOVEI	M,[ASCIZ /.  MODE: /]
   552	000207'	260 17 0 00 003566'		PUSHJ	P,MSG
   553	000210'	200 06 0 00 005502'		MOVE	N,DCN
   554	000211'	260 17 0 00 003500'		PUSHJ	P,DECPRT
   555						MOVEI	M,[ASCIZ / NOT DEFINED, DEFAULTING TO 7.
   556	000212'	201 00 0 00 014144'	/]
   557	000213'	260 17 0 00 003566'		PUSHJ	P,MSG
   558	000214'	260 17 0 00 003603'		PUSHJ	P,NULL		;TERMINATE STRING
   559	000215'	201 00 0 00 010762'		MOVEI	M,TRMBLK
   560	000216'	260 17 0 00 003173'		PUSHJ	P,TRMMES
   561	000217'	201 01 0 00 000007 		MOVEI	T,7		;DEFAULT TO FULL DSKCLN
   562	000220'	202 01 0 00 005502'	CHKST1:	MOVEM	T,DCN#		;SAVE TYPE FOR FUTURE REFERENCE
   563
   564					;[37] add some comments here to help you figure out how we teach a PDP-10
   565					;[37] to do post-indexed indirect addressing...
   566	000221'	554 01 0 00 000000*		HLRZ	T,JOBSA		;make magic pointers.. start of free core in RH
   567	000222'	505 01 0 00 000012 		HRLI T,U		;and U in LH for indexing - **REMEMBER THIS**
   568	000223'	202 01 0 00 010732'		MOVEM T,PTRPPU#		;stash at start of table of indirect pointers
   569	000224'	403 12 0 00 010754'		SETZB U,STRPPU#		;clean out U and largest blocks/unit
   570
   571									;now start loop to make blocks/unit table
   572	000225'	260 17 0 00 003777'	SETTLE:	PUSHJ P,LNAME		;stuff CHRBUF with 6bit logical name of unit
   573	000226'	200 01 0 00 014122'		MOVE T,[.CHLEN,,CHRBUF]	;set to get some info about a unit...
   574	000227'	047 01 0 00 000045 		DSKCHR T,		;do it
   575	000230'	254 00 0 00 000240'		 JRST INITL		;  must be FINALLY OUT OF UNITS
   576	000231'	201 01 1 00 010732'		MOVEI T,@PTRPPU		;get addr of blks/unit entry via magic pointer,
   577	000232'	260 17 0 00 003264'		PUSHJ	P,GETCOR	;  ..and GET MORE CORE, IF NECESSARY.
   578	000233'	200 01 0 00 005456'		MOVE T,.CHBPU+CHRBUF	;get number of pages (sic) for this unit
   579	000234'	202 01 1 00 010732'		MOVEM T,@PTRPPU		;  ..and stash it in the table via magic pntr.
   580	000235'	313 01 0 00 010754'		CAMLE T,STRPPU		;is it the largest for this structure?
   581	000236'	202 01 0 00 010754'		 MOVEM T,STRPPU		;  yes, stash it
   582	000237'	344 12 0 00 000225'		AOJA U,SETTLE		;increment indirect register and try next unit
   583
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 9
DSKCLN	MAC	30-Feb-73 19:40	

   584					;now make magic pointers (as above) to all per unit tables
   585	000240'	202 12 0 00 006570'	INITL:	MOVEM U,HIGHU#	;STASH NUMBER OF UNITS
   586	000241'	554 01 0 00 000221*		HLRZ T,JOBSA	;GET STARTING ADDR
   587	000242'	505 01 0 00 000012 		HRLI T,U	;SET TO INDEX
   588	000243'	270 01 0 00 006570'		ADD T,HIGHU	;adjust by # of units to allow for PPU table above
   589
   590	000244'	205 02 0 00 777767 		MOVSI T1,-UNTLEN	;NOW GENERATE POINTERS TO ALL PER UNIT TABLES
   591	000245'	202 01 1 02 002663'	CREUNT:	MOVEM T,@UNITAB(T1)
   592	000246'	270 01 0 00 006570'		ADD T,HIGHU
   593	000247'	253 02 0 00 000245'		AOBJN T1,CREUNT
   594
   595					;[37] set up table of per-unit "cache" pages for pre-referencing
   596	000250'	370 12 0 00 006570'		sos	u,highu		;[37] make them number of the highest unit
   597	000251'	201 02 0 00 000777 		movei	t1,bufpag	;[40] page that BUF is on
   598	000252'	370 00 0 00 000002 		 sos	t1		;[37] map/pre-ref page of highest numbered unit
   599	000253'	202 02 1 00 010740'		 movem	t1,@ptrupg	;[37] stash it in the table
   600	000254'	365 12 0 00 000252'		 sojge	u,.-2		;[37] do 'em all
   601	000255'	242 02 0 00 000011 		lsh	t1,^d9		;[37] make it an address
   602	000256'	202 02 0 00 006567'		movem	t1,hiaddr	;[37] stash so GETCOR knows how high to go
   603
   604	000257'	553 00 0 00 000001 		HRRZS T
   605	000260'	202 01 0 00 000000*		MOVEM T,JOBFF		;SAVE POINTER TO FREE CORE.
   606	000261'	260 17 0 00 003264'		PUSHJ	P,GETCOR	;GET MORE CORE, IF NECESSARY.
   607
   608					;[37] did this earlier (.-13)
   609					;[37] 	SOS HIGHU	;NOW MAKE IT NUMBER OF HIGHEST UNIT
   610
   611					;[37] now map BUFPAG (i.e., the page BUF is on) because PAGRED expects it
   612					;[37] to be there, since first thing it does is unmap BUFPAG.
   613					;[37] this is only necessary for the initial entry to PAGRED.
   614					;[37] the disk cache pages are mapped in FNDSEK, and XCHPTR in pagred blows 
   615					;[37] cache pages away.
   616	000262'	205 01 0 00 004001 		movsi	t,(.prcw!1b17)	;[37] cow protection, count=1
   617	000263'	541 01 0 00 000777 		hrri	t,bufpag	;[37] starting page
   618	000264'	047 01 0 00 777711 		vcreat	t,		;[37] ask for them privately
   619	000265'	260 17 0 00 004150'		 PUSHJ	P,PAGERR		;[37] lost, complain and die
   620
   621	000266'	201 01 0 00 000016 		MOVEI T,16	;NOW OPEN ALL I/O CHANNELS
   622	000267'	200 02 0 00 010752'		MOVE T1,STRNAM	;TO POINT TO THIS STR
   623	000270'	403 03 0 00 010761'		SETZB	T2,TRBFLG#	;THIS FLAG NON-ZERO IF MULTIPLY USED PAGES PRESENT
   624	000271'	505 04 0 00 000013 		HRLI T3,CIO.OP	;CHANIO OPEN
   625	000272'	205 13 0 00 777762 		MOVSI P1,-MXCHN	;OPEN ALL CHANNELS
   626	000273'	540 04 0 00 000013 		HRR T3,P1
   627	000274'	043 04 0 00 000001 		CHANIO T3,T
   628	000275'	254 00 0 00 003223'		 JRST OPNERR
   629	000276'	253 13 0 00 000273'		AOBJN P1,.-3
   630	000277'	336 00 0 00 006557'		SKIPN	FIXFLG
   631	000300'	065 16 0 00 000002 		OUTBUF LPT,2	;MAKE SURE ROOM FOR OUTPUT BUFFER DECLARED
   632	000301'	200 13 0 00 014153'		MOVE	P1,[POINT 7,TRMBLK+1]	;INIT OUTPUT BYTE PNTR
   633	000302'	260 17 0 00 003526'		PUSHJ	P,IDENT		;IDENTIFY ANALYSIS OF THIS STR
   634	000303'	260 17 0 00 003603'		PUSHJ	P,NULL		;TERMINATE STRING
   635	000304'	332 00 0 00 006557'		SKIPE	FIXFLG
   636	000305'	254 00 0 00 000315'		JRST	CHKST3
   637	000306'	201 01 0 00 000016 		MOVEI	T,LPT		;IS LPT ASSIGNED
   638	000307'	047 01 0 00 000004 		DEVCHR	T,		; TO THE COMMAND
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 9-1
DSKCLN	MAC	30-Feb-73 19:40	

   639	000310'	603 01 0 00 020000 		TLNE	T,DV.TTA	; PORT?
   640	000311'	254 00 0 00 000315'		JRST	CHKST3
   641	000312'	051 03 0 00 010763'		OUTSTR	TRMBLK+1		;NO
   642	000313'	201 01 0 00 003612'		MOVEI	T,TYO		;OUTPUT TO LPT IN CHECK MODE
   643	000314'	334 00 0 00 000000 		SKIPA
   644	000315'	201 01 0 00 003625'	CHKST3:	MOVEI	T,TRMOPR	;OUTPUT TO CTY IN FIX MODE
   645	000316'	202 01 0 00 011021'		MOVEM	T,TYODSP
   646	000317'	201 00 0 00 010763'		MOVEI	M,TRMBLK+1
   647	000320'	260 17 0 00 003566'		PUSHJ	P,MSG		;DUMP BUFFER
   648
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 10
DSKCLN	MAC	30-Feb-73 19:40	

   649					;NOW READ AND CHECK THE HOME BLOCKS
   650
   651	000321'	201 12 0 00 000000 		MOVEI U,0
   652	000322'	201 11 0 00 000000 		MOVEI CHAN,0
   653	000323'	260 17 0 00 004022'		PUSHJ P,HOMCHK	;READ AND DO PRELIMINARY CHECKS
   654	000324'	254 00 0 00 003233'		 JRST BADHOM	;NOT A GOOD HOME BLOCK
   655	000325'	205 13 0 00 777771 		MOVSI P1,-HOMTLN
   656	000326'	200 02 0 13 002674'	HOMMOV:	MOVE T1,HOMTAB(P1)	;GET DATA FROM FIRST HOME BLOCK
   657	000327'	200 01 0 02 777000 		MOVE T,BUF(T1)
   658	000330'	207 00 0 00 000002 		MOVSS T1
   659	000331'	202 01 0 02 000000 		MOVEM T,(T1)
   660	000332'	253 13 0 00 000326'		AOBJN P1,HOMMOV
   661	000333'	260 17 0 00 004055'		PUSHJ P,HOMCOP	;NOW COPY SOME PER/UNIT DATA
   662	000334'	336 00 0 00 777003 	NXTHOM:	SKIPN BUF+HOMNXT	;IS THERE A NEXT UNIT?
   663	000335'	254 00 0 00 000352'		JRST ENDHOM	;NO, SHOULD BE ALL DONE
   664	000336'	271 12 0 00 000001 		ADDI U,1	;YES, DO IT
   665	000337'	260 17 0 00 004022'		PUSHJ P,HOMCHK
   666	000340'	254 00 0 00 003233'		 JRST BADHOM
   667	000341'	205 13 0 00 777771 		MOVSI P1,-HOMTLN
   668	000342'	200 02 0 13 002674'	HOMSAM:	MOVE T1,HOMTAB(P1)	;THIS INFORMATION SHOULD BE THE SAME IN ALL HOME BLOCKS
   669	000343'	200 01 0 02 777000 		MOVE T,BUF(T1)
   670	000344'	207 00 0 00 000002 		MOVSS T1
   671	000345'	312 01 0 02 000000 		CAME T,(T1)
   672	000346'	254 00 0 00 003233'		JRST BADHOM	;IT IS NOT
   673	000347'	253 13 0 00 000342'		AOBJN P1,HOMSAM
   674	000350'	260 17 0 00 004055'		PUSHJ P,HOMCOP	;GET THE PER UNIT DATA
   675	000351'	254 00 0 00 000334'		JRST NXTHOM	;AND TRY FOR NEXT ONE
   676
   677	000352'	312 12 0 00 006570'	ENDHOM:	CAME U,HIGHU	;WE SHOULD HAVE JUUT DONE THE LAST UNT
   678	000353'	254 00 0 00 003231'		JRST HOMNUM	;NO. WRONG NUMBER OF UITS
   679
   680					;NOW GET CORE TO HOLD SAT TABLES
   681
   682	000354'	201 12 0 00 000000 		MOVEI U,0
   683	000355'	200 01 0 00 000260*		MOVE T,JOBFF
   684	000356'	552 01 0 00 010624'		HRRZM T,UFDHSP+MFDRIB
   685	000357'	557 00 0 00 010751'		HLRZS STRHSH	;MAKE IT BE THE CORRECT NUMBER
   686	000360'	270 01 0 00 010751'		ADD T,STRHSH	;ROOM FOR HASH TABLE
   687	000361'	552 01 0 00 014043'		HRRZM T,UFDHSP+UFDRIB
   688	000362'	270 01 0 00 010751'		ADD T,STRHSH
   689	000363'	210 02 0 00 010751'		MOVN T1,STRHSH
   690	000364'	516 02 0 00 010750'		HRLZM T1,STRHAD#
   691	000365'	542 01 1 00 010733'	SATULP:	HRRM T,@PTRSAD	;POINTERS TO SAT ADDRESSES
   692	000366'	554 02 1 00 010727'		HLRZ T1,@PTRDST	;NUMBER OF SATS ON UNIT
   693	000367'	270 01 0 00 000002 		ADD T,T1
   694	000370'	271 12 0 00 000001 		ADDI U,1
   695	000371'	317 12 0 00 006570'		CAMG U,HIGHU
   696	000372'	254 00 0 00 000365'		JRST SATULP
   697	000373'	205 16 0 00 777775 		MOVSI P4,-STBLEN	;NOW SET UP VARIOUS SAT TABLES
   698	000374'	200 12 0 00 006570'	SATFUN:	MOVE U,HIGHU	;GENERATE A SAT TABLE
   699	000375'	542 01 1 16 002703'	SATFN1:	HRRM T,@SATTAB(P4)
   700	000376'	554 02 1 00 010727'		HLRZ T1,@PTRDST
   701	000377'	221 02 0 00 000400 		IMULI T1,400
   702	000400'	270 01 0 00 000002 		ADD T,T1
   703	000401'	365 12 0 00 000375'		SOJGE U,SATFN1
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 10-1
DSKCLN	MAC	30-Feb-73 19:40	

   704	000402'	253 16 0 00 000374'		AOBJN P4,SATFUN
   705	000403'	202 01 0 00 005504'		MOVEM T,ENDSAT#
   706	000404'	550 02 0 00 000001 		HRRZ	T1,T		;SAVE FROM GETCOR.
   707	000405'	260 17 0 00 003264'		PUSHJ	P,GETCOR	;
   708	000406'	550 01 0 00 000355*		HRRZ T,JOBFF
   709	000407'	476 00 0 01 000000 		SETOM (T)
   710	000410'	507 00 0 00 000001 		HRLS T		;SET ALL TO 1'S (UNUSED)
   711	000411'	271 01 0 00 000001 		ADDI T,1
   712	000412'	251 01 0 02 777777 		BLT T,-1(T1)
   713	000413'	202 02 0 00 000406*		MOVEM T1,JOBFF
   714
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 11
DSKCLN	MAC	30-Feb-73 19:40	

   715	000414'	200 01 0 00 010745'		MOVE T,SATRIB	;READ THE RIB FOR THE SAT BLOCK
   716	000415'	260 17 0 00 004260'		PUSHJ P,RIBCHK
   717	000416'	254 00 0 00 003351'		 JRST SRBERR	;RIB ERROR
   718	000417'	200 01 0 00 014154'		MOVE T,[BUF,,MFDBUF]	;SAVE RIB HERE
   719	000420'	251 01 0 00 007601'		BLT T,MFDBUF+777
   720	000421'	200 12 0 00 006570'		MOVE U,HIGHU	;NOW READ ALL SATS
   721	000422'	510 15 1 00 010727'	NXTSTU:	HLLZ P3,@PTRDST	;NUMBER OF SATS
   722	000423'	213 00 0 00 000015 		MOVNS P3	;TURN INTO AOBJN PTR
   723	000424'	205 14 0 00 777053 		MOVSI P2,-RBLVPR	;AOBJN POINTER TO SAT RIB
   724	000425'	336 01 0 14 006653'	NXTSPT:	SKIPN T,MFDBUF+RIBPFS(P2)
   725	000426'	254 00 0 00 000454'		JRST NXTSDN		;EOF
   726	000427'	321 01 0 00 003351'		JUMPL	T,SRBERR	;SPARE PNTRS ARE ILLEGAL.
   727	000430'	607 01 0 00 200000 		TLNN	T,RBREAL	;HOLES ARE ILLEGAL.
   728	000431'	254 00 0 00 003351'		JRST	SRBERR		;
   729	000432'	135 02 0 00 014155'		LDB T1,[POINT PTSUNI,T,PTNUNI]
   730	000433'	312 02 0 00 000012 		CAME T1,U	;IS IT THIS UNIT?
   731	000434'	254 00 0 00 000453'		JRST NXTSP2	;NO, CONTINUE SEARCHING
   732	000435'	325 15 0 00 003351'		JUMPGE P3,SRBERR	;FOUND TOO MANY
   733	000436'	135 02 0 00 014156'		LDB T1,[POINT PTSPNO,T,PTNPNO]
   734	000437'	550 01 0 00 000015 		HRRZ T,P3	;THE NUMBER OF THIS SAT ON THIS UNIT
   735	000440'	270 01 1 00 010733'		ADD T,@PTRSAD
   736	000441'	202 02 0 01 000000 		MOVEM T1,(T)	;AND STORE THE ADDRESS
   737	000442'	260 17 0 00 004071'		PUSHJ P,PAGRED	;READ IT
   738	000443'	254 00 0 00 003353'		 JRST SBKERR	;ERROR
   739	000444'	550 01 0 00 000015 		HRRZ T,P3
   740	000445'	221 01 0 00 000400 		IMULI T,400
   741	000446'	270 01 1 00 010727'		ADD T,@PTRDST	;WHERE TO PUT THE BITS
   742	000447'	200 02 0 00 000001 		MOVE T1,T
   743	000450'	505 01 0 00 777000 		HRLI T,BUF
   744	000451'	251 01 0 02 000377 		BLT T,377(T1)
   745	000452'	253 15 0 00 000453'		AOBJN P3,.+1	;COUNT ONE MORE SAT
   746	000453'	253 14 0 00 000425'	NXTSP2:	AOBJN P2,NXTSPT	;SEE IF ANY MORE POINTERS TO LOOK AT
   747	000454'	321 15 0 00 003351'	NXTSDN:	JUMPL P3,SRBERR	;NOT ENOUGH SATS
   748	000455'	365 12 0 00 000422'		SOJGE U,NXTSTU	;CONTINUE FOR ALL UNITS
   749
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 12
DSKCLN	MAC	30-Feb-73 19:40	

   750	000456'	402 00 0 00 005506'		SETZM ERRSAV#	;NO ERRORS SO FAR
   751	000457'	201 01 0 00 006560'		MOVEI T,FIXPTR
   752	000460'	260 17 0 00 004635'		PUSHJ P,SETFIX		;SET UP POINTER CHAIN
   753	000461'	201 01 0 00 006555'		MOVEI T,FIXBAD
   754	000462'	260 17 0 00 004635'		PUSHJ P,SETFIX		;NO FILES TO REENTER
   755	000463'	402 00 0 00 010760'		SETZM TRBFIL#
   756	000464'	402 00 0 00 010761'		SETZM TRBFLG#		;NO MULTIPLY USED CLUSERS
   757	000465'	200 01 0 00 000413*		MOVE T,JOBFF
   758	000466'	202 01 0 00 006564'		MOVEM T,FREPTR#
   759	000467'	336 00 0 00 006557'		SKIPN	FIXFLG
   760	000470'	254 00 0 00 000476'		JRST	MGONFX
   761
   762	000471'	047 00 0 00 777756 	IFE DEBUG, <DSKCLR DC.CLR,
   763	000472'	254 00 0 00 000471'		 JRST .-1	;PCB I/O IN PROGRESS
   764	000473'	254 00 0 00 003262'		JRST	NOCLR>
   765	000474'	201 01 0 00 003625'		MOVEI T,TRMOPR
   766	000475'	202 01 0 00 011021'		MOVEM T,TYODSP
   767	000476'	260 17 0 00 004562'	MGONFX:	PUSHJ P,CHKSAT
   768	000477'	201 01 0 00 001333'		MOVEI T,MFDPRC
   769	000500'	202 01 0 00 007607'		MOVEM T,MFDRIB+ROUTIN	;SET UP ROUTINES TO CALL
   770	000501'	201 01 0 00 001461'		MOVEI T,UFDPRC
   771	000502'	202 01 0 00 013026'		MOVEM T,UFDRIB+ROUTIN
   772	000503'	201 01 0 00 006602'		MOVEI T,MFDBUF
   773	000504'	202 01 0 00 010612'		MOVEM T,MFDRIB+SAVBLK
   774	000505'	201 01 0 00 011022'		MOVEI T,UFDBUF
   775	000506'	202 01 0 00 014031'		MOVEM T,UFDRIB+SAVBLK
   776	000507'	201 16 0 00 007603'		MOVEI P4,MFDRIB
   777	000510'	200 02 0 16 000000 		MOVE T1,RIBLBN(P4)
   778	000511'	202 02 0 00 007602'		MOVEM T1,MFDRBC#	;SAVE HERE FOR SPECIAL FILE CHECK
   779	000512'	200 01 0 00 014157'		MOVE T,[1,,1]
   780	000513'	202 01 0 16 001016 		MOVEM T,ERRNAM(P4)
   781	000514'	202 01 0 16 001020 		MOVEM T,ERRPPN(P4)
   782	000515'	205 01 0 00 654644 		MOVSI T,'UFD'
   783	000516'	202 01 0 16 001017 		MOVEM T,ERREXT(P4)
   784
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 13
DSKCLN	MAC	30-Feb-73 19:40	

   785	000517'	260 17 0 00 001126'		PUSHJ P,MFDUFD	;PROCESS ALL FILES
   786	000520'	254 00 0 00 003743'		 JRST CRTERM	;SOMETHING WRONG WITH 1,1
   787	000521'	336 00 0 00 010761'		SKIPN TRBFLG	;ANY MULTIPLY USED PAGES?
   788	000522'	254 00 0 00 000554'		JRST NOTRB	;NO
   789	000523'	201 01 0 00 006560'		MOVEI T,FIXPTR	;YES, RESET FIX POINTERS
   790	000524'	260 17 0 00 004635'		PUSHJ P,SETFIX
   791	000525'	201 01 0 00 006555'		MOVEI T,FIXBAD
   792	000526'	260 17 0 00 004635'		PUSHJ P,SETFIX
   793	000527'	402 00 0 00 010760'		SETZM TRBFIL
   794	000530'	200 01 0 00 000465*		MOVE T,JOBFF
   795	000531'	202 01 0 00 006564'		MOVEM T,FREPTR
   796
   797	000532'	332 00 0 00 006557'		SKIPE FIXFLG
   798	000533'	254 00 0 00 000537'		JRST PASS2
   799
   800	000534'	067 16 0 00 000000 		OUTPUT LPT,0
   801						OUTSTR [ASCIZ /
   802					STARTING PASS 2
   803	000535'	051 03 0 00 014160'	/]		
   804	000536'	260 17 0 00 003526'		PUSHJ P,IDENT
   805
   806	000537'	200 12 0 00 006570'	PASS2:	MOVE U,HIGHU
   807	000540'	550 01 1 00 010730'		HRRZ T,@PTROST	;CLEAR RIB SAT AND OUR SAT
   808	000541'	476 00 0 01 000000 		SETOM (T)
   809	000542'	507 00 0 00 000001 		HRLS T
   810	000543'	271 01 0 00 000001 		ADDI T,1
   811	000544'	200 02 0 00 005504'		MOVE T1,ENDSAT
   812	000545'	251 01 0 02 777777 		BLT T,-1(T1)
   813	000546'	260 17 0 00 004562'		PUSHJ P,CHKSAT	;RECHECK SAT (IF FIXING SET BITS IN OUR SAT)
   814	000547'	201 16 0 00 007603'		MOVEI P4,MFDRIB
   815	000550'	200 02 0 16 000000 		MOVE T1,RIBLBN(P4)
   816	000551'	202 02 0 00 007602'		MOVEM T1,MFDRBC		;FORCE RECHECK
   817	000552'	260 17 0 00 001126'		PUSHJ P,MFDUFD
   818	000553'	254 00 0 00 003743'		 JRST CRTERM
   819	000554'	260 17 0 00 004376'	NOTRB:	PUSHJ P,CHKBAT	;CHECK BAT BLOCKS
   820	000555'	205 01 0 00 777773 		MOVSI T,-SPCLEN	;CHECK THAT ALL CRITICAL FILES FOUND
   821	000556'	332 00 0 00 006565'		SKIPE	FSTFLG	;IF IN FAST MODE ONLY CHECK TO SEE
   822	000557'	205 01 0 00 777776 		MOVSI	T,-SPUFDN	; IF CRITICAL UFDS FOUND
   823	000560'	331 00 1 01 003142'		SKIPL @SPCACT(T)
   824	000561'	254 00 0 00 003750'		JRST MISCRT
   825	000562'	253 01 0 00 000560'		AOBJN T,.-2
   826	000563'	332 00 0 00 006557'		SKIPE FIXFLG
   827	000564'	254 00 0 00 000627'		JRST FINFIX	;FINISH FIXUPS
   828	000565'	260 17 0 00 003526'		PUSHJ P,IDENT
   829	000566'	332 00 0 00 006565'		SKIPE	FSTFLG
   830	000567'	254 00 0 00 000572'		JRST	FRERPT
   831	000570'	201 16 0 00 002726'		MOVEI P4,LOSTAB
   832	000571'	260 17 0 00 004455'		PUSHJ P,CLSSRC	;PRINT LOST PAGES
   833	000572'	201 16 0 00 003003'	FRERPT:	MOVEI	P4,FRETAB
   834	000573'	260 17 0 00 004455'		PUSHJ P,CLSSRC	;FREE PAGES
   835	000574'	201 16 0 00 003062'		MOVEI P4,MLTTAB
   836	000575'	260 17 0 00 004455'		PUSHJ P,CLSSRC	;AND MULTIPLY USED PAGES
   837	000576'	200 01 0 00 005506'		MOVE T,ERRSAV
   838	000577'	070 16 0 00 000000 		CLOSE LPT,
   839	000600'	051 03 1 01 002706'		OUTSTR @ERRTAB(T)	;OUTPUT MESSAGE
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 13-1
DSKCLN	MAC	30-Feb-73 19:40	

   840	000601'	071 16 0 00 000000 	DONSTR:	RELEASE LPT,0
   841	000602'	205 01 0 00 777762 		MOVSI T,-MXCHN
   842	000603'	505 04 0 00 000000 		HRLI	T3,CIO.RL	;CHANIO RELEASE.
   843	000604'	540 04 0 00 000001 		HRR T3,T
   844	000605'	043 04 0 00 000000 		CHANIO T3,0
   845	000606'	253 01 0 00 000604'		AOBJN T,.-2
   846	000607'	263 17 0 00 000000 		POPJ P,		;FINISHED THIS STR, EXIT
   847
   848	000610'	200 13 0 00 014123'	DONST1:	MOVE	P1,[POINT 7,TRMBLK]	;INIT OUTPUT BYTE POINTER
   849						MOVEI	M,[ASCIZ /
   850
   851	000611'	201 00 0 00 014164'	NO ANALYSIS REQUIRED FOR /]
   852	000612'	260 17 0 00 003566'		PUSHJ	P,MSG		;BUFFER MSG
   853	000613'	200 01 0 00 010752'		MOVE	T,STRNAM	;GET TRANSLATE AND 
   854	000614'	260 17 0 00 003616'		PUSHJ	P,PR6BIT	; BUFFER STR NAME
   855	000615'	260 17 0 00 003601'		PUSHJ	P,PDOT
   856	000616'	260 17 0 00 003607'		PUSHJ	P,CRLF2
   857	000617'	260 17 0 00 003603'		PUSHJ	P,NULL
   858	000620'	201 00 0 00 010762'		MOVEI	M,TRMBLK	;OUTPUT TO TTY
   859	000621'	260 17 0 00 003173'		PUSHJ	P,TRMMES	; OR CTY
   860	000622'	336 00 0 00 006557'		SKIPN	FIXFLG
   861	000623'	263 17 0 00 000000 		POPJ	P,	;DONE WITH THIS STR
   862	000624'	047 02 0 00 777756 		DSKCLR	DC.NDS,	;TURN OFF NEED DSKCLN FLAG
   863	000625'	263 17 0 00 000000 		 POPJ	P,	;DONE WITH THIS STR
   864	000626'	254 00 0 00 003205'		JRST	NOJAL	;MISSING WA LIC
   865
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 14
DSKCLN	MAC	30-Feb-73 19:40	

   866					;[37] FINFIX:	IFE DEBUG!MAKSW,<DSKCLR DC.CLR,
   867	000627'	047 00 0 00 777756 	FINFIX:	IFE DEBUG,<DSKCLR DC.CLR,
   868	000630'	254 00 0 00 000627'		JRST	.-1
   869	000631'	254 00 0 00 003262'		JRST	NOCLR>
   870	000632'	200 12 0 00 006570'		MOVE U,HIGHU	;NOW WRITE OUT SAT TABLES
   871	000633'	554 15 1 00 010727'	WRTSAT:	HLRZ P3,@PTRDST	;NUMBER TO WRITE
   872	000634'	275 15 0 00 000001 		SUBI P3,1	;NOW HAVE NUMBER OF THE SAT TO WRITE
   873	000635'	200 14 1 00 010733'		MOVE P2,@PTRSAD	;POINTER TO SAT ADDRESSES TABLE
   874	000636'	505 14 0 00 000015 		HRLI P2,P3	;SET INDEX BY SAT NUMBER
   875	000637'	200 02 1 00 000014 	WRTSTU:	MOVE T1,@P2	;READ SAT IN TO KEEP CORE PAGE BITS
   876	000640'	260 17 0 00 004071'		PUSHJ P,PAGRED
   877	000641'	254 00 0 00 003353'		 JRST SBKERR
   878	000642'	200 01 0 00 000015 		MOVE T,P3
   879	000643'	221 01 0 00 000400 		IMULI T,400	;NUMBER OF WORDS/SAT
   880	000644'	200 02 0 00 000001 		MOVE	T1,T
   881	000645'	270 01 1 00 010730'		ADD T,@PTROST
   882	000646'	507 00 0 00 000001 		HRLS T
   883	000647'	541 01 0 00 777000 		HRRI T,BUF
   884	000650'	251 01 0 00 777377 		BLT T,BUF+377
   885	000651'	336 00 0 00 006565'		SKIPN	FSTFLG
   886	000652'	254 00 0 00 000662'		JRST	WRTST1
   887	000653'	201 04 0 00 000000 		MOVEI	T3,0		;INIT PNTR INTO OUR SAT BUFFER
   888	000654'	270 02 1 00 010727'		ADD	T1,@PTRDST	;SET UP AOBJN POINTER TO CURRENT
   889	000655'	505 02 0 00 777400 		HRLI	T1,-400		; DISK SAT ON CURRENT UNIT
   890	000656'	200 03 0 02 000000 	SATIOR:	MOVE	T2,(T1)		;GET DISK VALUE FOR THIS SAT WORD
   891	000657'	406 03 0 04 777000 		ANDM	T2,BUF(T3)	;OR WITH OUR SAT WORD
   892	000660'	350 00 0 00 000004 		AOS	T3		;POINT TO NEXT OUR SAT WORD
   893	000661'	253 02 0 00 000656'		AOBJN	T1,SATIOR	;CONTINUE, IF NOT DONE
   894	000662'	200 02 1 00 000014 	WRTST1:	MOVE	T1,@P2	;GET SAT ADDRESS
   895	000663'	260 17 0 00 004227'		PUSHJ P,PAGWRT	;WRITE IT OUT
   896	000664'	201 01 0 00 000000 		MOVEI T,0	;NOW COUNT BITS
   897	000665'	205 02 0 00 777400 		MOVSI T1,-400
   898
   899	000666'	200 03 0 02 777000 	STCNT3:	MOVE T2,BUF(T1)	;GET F BITS
   900	000667'	404 03 0 02 777400 		AND T2,BUF+400(T1) ;F AND M BITS MUST BE 1
   901	000670'	322 03 0 00 000705'		JUMPE T2,STCNT1	;IF NO BITS THAT ARE BOTH ONE, NO FREE PAGES
   902	000671'	200 04 0 00 000003 		MOVE T3,T2	;COPY BITS INTO T3
   903	000672'	242 04 0 00 777777 		LSH T3,-1	;RIGHT ONE
   904	000673'	404 04 0 00 014172'		AND T3,[333333,,333333] ;MASK OUT FORMER LEAST SIG. BITS IN OCTAL DIGITS
   905	000674'	274 03 0 00 000004 		SUB T2,T3	;D-[D/2]
   906	000675'	242 04 0 00 777777 		LSH T3,-1	;RIGHT ANOTHER POSITION
   907	000676'	404 04 0 00 014172'		AND T3,[333333,,333333] ;JUST HI ORDER
   908	000677'	277 03 0 00 000004 		SUBB T2,T3	;D-[D/2]-[D/4], TWO COPIES
   909	000700'	242 04 0 00 777775 		LSH T3,-3	;SHIFT RIGHT 1 OCTAL DIGIT
   910	000701'	270 03 0 00 000004 		ADD T2,T3	;ADD NUMBERS IN DIGIT PAIRS
   911	000702'	404 03 0 00 014173'		AND T2,[070707,,070707] ;NOW ITS BASE 64
   912	000703'	231 03 0 00 000077 		IDIVI T2,77	;DIVIDE BY 63, NUMBER OF BITS IS IN T3.
   913	000704'	270 01 0 00 000004 		ADD T,T3	;COUNT MORE BITS IN THIS SAT.
   914	000705'	253 02 0 00 000666'	STCNT1:	AOBJN T1,STCNT3
   915	000706'	202 01 1 00 000014 		MOVEM T,@P2	;STORE OVER SAT ADDRESS
   916	000707'	365 15 0 00 000637'		SOJGE P3,WRTSTU	;MORE SATS ON THIS UNIT
   917	000710'	365 12 0 00 000633'		SOJGE U,WRTSAT	;AND MORE UNITS IN THIS STR
   918
   919	000711'	200 12 0 00 006570'		MOVE U,HIGHU
   920	000712'	201 01 0 00 000000 		MOVEI T,0
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 14-1
DSKCLN	MAC	30-Feb-73 19:40	

   921	000713'	554 02 1 00 010727'		HLRZ T1,@PTRDST
   922	000714'	270 01 0 00 000002 		ADD T,T1	;COUNT TOTAL NUMBER OF SATS
   923	000715'	365 12 0 00 000713'		SOJGE U,.-2
   924	000716'	213 00 0 00 000001 		MOVNS T
   925	000717'	507 00 0 00 000001 		HRLS T
   926	000720'	201 12 0 00 000000 		MOVEI U,0
   927	000721'	540 01 1 00 010733'		HRR T,@PTRSAD
   928					;[37] IFE DEBUG!MAKSW,<
   929					IFE DEBUG,<
   930	000722'	047 01 0 00 777756 		DSKCLR DC.FPC,
   931	000723'	000000	000001			T
   932	000724'	255 00 0 00 000000 		 JFCL
   933					>
   934	000725'	201 01 0 00 006562'		MOVEI T,FIXREN
   935	000726'	260 17 0 00 004635'		PUSHJ P,SETFIX
   936	000727'	476 00 0 00 005412'		SETOM BLKIN#	;BLOCK IN CORE
   937	000730'	201 15 0 00 006560'		MOVEI P3,FIXPTR
   938	000731'	554 02 0 15 000000 	FIXLP:	HLRZ T1,(P3)
   939	000732'	402 00 0 15 000000 		SETZM (P3)	;CLEAR OLD LINK
   940	000733'	336 15 0 00 000002 		SKIPN P3,T1	;NOW SET FOR THIS LINK
   941	000734'	254 00 0 00 000754'		JRST FIXDON
   942	000735'	200 01 0 15 000001 		MOVE T,1(P3)	;BLOCK DESIRED
   943	000736'	316 01 0 00 005412'		CAMN T,BLKIN
   944	000737'	254 00 0 00 000747'		JRST BLKOK	;SAME ONE AS THERE NOW
   945	000740'	250 01 0 00 005412'		EXCH T,BLKIN	;GET OLD ONE
   946	000741'	321 01 0 00 000743'		JUMPL T,NOBWRT	;NOTHING REALLY
   947	000742'	260 17 0 00 004222'		PUSHJ P,PAGWTP	;WRITE IT
   948	000743'	335 01 0 00 005412'	NOBWRT:	SKIPGE T,BLKIN
   949						JRST	[TLZ T,(1B0)	;JAST WANT TO ZERO (FROM ERROR)
   950							MOVEM T,BLKIN	;DO NOT NEED TO READ FIRST
   951	000744'	254 00 0 00 014174'			JRST BLKOK]	;SINCE HAS ERROR ANYWAY
   952	000745'	260 17 0 00 004064'		PUSHJ P,PAGRDP	;GET BLOCK
   953	000746'	254 00 0 00 003260'		 JRST FRDER	;FATAL READ ERROR
   954	000747'	200 03 0 15 000002 	BLKOK:	MOVE T2,2(P3)	;HAVE BLOCK, SET ACS
   955	000750'	200 04 0 15 000003 		MOVE T3,3(P3)
   956	000751'	200 01 0 15 000000 		MOVE T,(P3)
   957	000752'	260 17 0 01 000001 		PUSHJ P,1(T)	;CALL FIXUP ROUTINE
   958	000753'	254 00 0 00 000731'		JRST FIXLP	;CONTINUE
   959
   960	000754'	331 01 0 00 005412'	FIXDON:	SKIPL T,BLKIN	;IS A BLOCK IN CORE?
   961	000755'	260 17 0 00 004222'		PUSHJ P,PAGWTP	;YES, WRITE IT OUT
   962	000756'	332 01 0 00 006562'		SKIPE T,FIXREN	;ANY FILES TO REEENTER
   963	000757'	254 00 0 00 000763'		JRST DOREN	;YES, DO IT
   964	000760'	332 00 0 00 006555'		SKIPE FIXBAD	;AND LOCKED OR LOST DATA FILES TO PRINT
   965	000761'	254 00 0 00 001014'		JRST PRNFIL	;YES
   966	000762'	254 00 0 00 000601'		JRST DONSTR	;NO, FINISHED
   967
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 15
DSKCLN	MAC	30-Feb-73 19:40	

   968	000763'	502 01 1 00 006556'	DOREN:	HLLM T,@FIXBAD+1	;PUT ON END OF LOST DATA LIST
   969	000764'	207 00 0 00 000001 		MOVSS T
   970	000765'	071 00 0 00 000000 		RELEASE DSK,0	;BECAUSE IT IS IN ABSOLUTE MODE
   971	000766'	201 02 0 00 000016 		MOVEI T1,16
   972	000767'	200 03 0 00 010752'		MOVE T2,STRNAM
   973	000770'	201 04 0 00 000000 		MOVEI T3,0
   974	000771'	050 00 0 00 000002 		OPEN DSK,T1
   975	000772'	254 00 0 00 001014'		 JRST PRNFIL		;CAN NOT REENTER THEM
   976	000773'	402 00 0 00 005510'	RENFIL:	SETZM FILNAM
   977	000774'	200 02 0 00 014177'		MOVE T1,[FILNAM,,FILNAM+1]
   978	000775'	251 02 0 00 005527'		BLT T1,FILNAM+FLMSTS	;CLEAR EXTRA ENTRIES
   979	000776'	201 02 0 00 000001 		MOVEI T1,RIPBDA
   980	000777'	202 02 0 00 005527'		MOVEM T1,FILNAM+FLMSTS	;SET FOND BAD BY DAMAGE ASSESMENT
   981	001000'	201 02 0 00 000017 		MOVEI T1,FLMSTS
   982	001001'	202 02 0 00 005510'		MOVEM T1,FILNAM		;SET SIZE OF ENTER BLOCK
   983	001002'	200 02 0 01 000001 		MOVE T1,1(T)
   984	001003'	202 02 0 00 005512'		MOVEM T1,FILNAM+FLMNAM
   985	001004'	200 02 0 01 000002 		MOVE T1,2(T)
   986	001005'	512 02 0 00 005513'		HLLZM T1,FILNAM+FLMEXT
   987	001006'	200 02 0 01 000003 		MOVE T1,3(T)
   988	001007'	202 02 0 00 005511'		MOVEM T1,FILNAM+FLMPPN
   989					;[37] IFE DEBUG,<ENTER DSK,FILNAM>
   990	001010'	255 00 0 00 000000 		JFCL
   991	001011'	070 00 0 00 000000 		CLOSE DSK,0
   992	001012'	554 01 0 01 000000 		HLRZ T,(T)	;CHECK LINK
   993	001013'	326 01 0 00 000773'		JUMPN T,RENFIL
   994	001014'	201 01 0 00 004670'	PRNFIL:	MOVEI	T,RCVBUF
   995	001015'	202 01 0 00 000530*		MOVEM T,JOBFF	;SO WE CAN SET UP BUFFERS
   996	001016'	403 01 0 00 000016 		SETZB T,P4	;P4 IS FLAG TO SAY FILE OPEN
   997	001017'	205 02 0 00 637163 	IFE DEBUG,<MOVSI T1,'SYS'>
   998					IFN DEBUG,<MOVSI T1,'DSK'>
   999	001020'	205 03 0 00 006574'		MOVSI T2,LOBUF	;OPEN ERROR RECORD FILE
  1000	001021'	050 16 0 00 000001 		OPEN LPT,T
  1001	001022'	254 00 0 00 001035'		 JRST FILOPN	;CAN NOT OPEN, P4=0 SAYS THAT
  1002	001023'	201 01 0 00 000003 		MOVEI T,3
  1003	001024'	201 02 0 00 000000 		MOVEI T1,0
  1004	001025'	200 03 0 00 014200'		MOVE T2,[SIXBIT /RECOV/]
  1005	001026'	205 04 0 00 637163 		MOVSI T3,'SYS'
  1006	001027'	076 16 0 00 000001 		LOOKUP LPT,T
  1007	001030'	255 00 0 00 000000 		 JFCL		;TRY TO GET IN UPDATE MODE
  1008	001031'	077 16 0 00 000001 		ENTER LPT,T
  1009	001032'	254 00 0 00 001035'		 JRST FILOPN	;CAN NOT GET IT
  1010	001033'	074 16 0 00 777777 		USETI LPT,-1	;GET TO END
  1011	001034'	201 16 0 00 000001 		MOVEI P4,1	;FLAG TO SAY IT IS OPEN
  1012
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 16
DSKCLN	MAC	30-Feb-73 19:40	

  1013	001035'	201 02 0 00 003254'	FILOPN:	MOVEI T1,TYOBTH	;OUTPUT TO BOTH
  1014	001036'	202 02 0 00 011021'		MOVEM T1,TYODSP
  1015	001037'	200 13 0 00 014123'		MOVE P1,[POINT 7,TRMBLK]
  1016	001040'	260 17 0 00 003526'		PUSHJ P,IDENT	;IDENTIFY
  1017	001041'	201 02 0 00 000000 		MOVEI T1,0
  1018	001042'	136 02 0 00 000013 		IDPB T1,P1
  1019	001043'	201 00 0 00 010762'		MOVEI M,TRMBLK
  1020	001044'	260 17 0 00 003173'		PUSHJ P,TRMMES	;SEND MESSAGE TO TERMINAL
  1021	001045'	336 15 0 00 006555'		SKIPN P3,FIXBAD
  1022	001046'	254 00 0 00 000601'		JRST DONSTR	;NO BAD FILES TO PRINT
  1023						MOVEI M,[ASCIZ /
  1024					THE FOLLOWING FILES HAVE LOST DATA:
  1025	001047'	201 00 0 00 014201'	/]
  1026	001050'	260 17 0 00 001052'		PUSHJ P,FILPRN
  1027	001051'	254 00 0 00 000601'		JRST DONSTR
  1028
  1029					;HERE TO PRINT A MESSAGE AND A LIST OF FILE NAMES
  1030
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 17
DSKCLN	MAC	30-Feb-73 19:40	

  1031	001052'	200 13 0 00 014123'	FILPRN:	MOVE P1,[POINT 7,TRMBLK]
  1032	001053'	260 17 0 00 003566'		PUSHJ P,MSG
  1033	001054'	201 02 0 00 000000 		MOVEI T1,0
  1034	001055'	136 02 0 00 000013 		IDPB T1,P1
  1035	001056'	201 00 0 00 010762'		MOVEI M,TRMBLK
  1036	001057'	260 17 0 00 003173'		PUSHJ P,TRMMES	;SEND MESSAGE (ALSO POSSIBLEY TO FILE)
  1037	001060'	207 00 0 00 000015 		MOVSS P3	;GET LIST POINTER
  1038	001061'	200 13 0 00 014123'	FLPLP:	MOVE P1,[POINT 7,TRMBLK]
  1039	001062'	554 01 0 15 000002 		HLRZ T,2(P3)	;GET EXTENSION
  1040	001063'	306 01 0 00 654644 		CAIN T,'UFD'	;CHECK FOR UFD
  1041	001064'	254 00 0 00 001115'		JRST FLPUFD	;POSSIBLE, MORE CHECKS
  1042	001065'	200 01 0 15 000001 	FLPNUF:	MOVE T,1(P3)
  1043	001066'	260 17 0 00 003616'		PUSHJ P,PR6BIT
  1044	001067'	510 01 0 15 000002 	FLPEXT:	HLLZ T,2(P3)	;EXTENSION
  1045	001070'	332 00 0 00 000001 		SKIPE T
  1046	001071'	260 17 0 00 003601'		PUSHJ P,PDOT
  1047	001072'	332 00 0 00 000001 		SKIPE T
  1048	001073'	260 17 0 00 003616'		PUSHJ P,PR6BIT
  1049	001074'	201 10 0 00 000133 		MOVEI CH,"["
  1050	001075'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  1051	001076'	554 06 0 15 000003 		HLRZ N,3(P3)
  1052	001077'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  1053	001100'	260 17 0 00 003577'		PUSHJ P,COMMA
  1054	001101'	550 06 0 15 000003 		HRRZ N,3(P3)
  1055	001102'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  1056	001103'	201 10 0 00 000135 		MOVEI CH,"]"
  1057	001104'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  1058	001105'	260 17 0 00 003610'		PUSHJ P,CRLF
  1059	001106'	201 02 0 00 000000 		MOVEI T1,0
  1060	001107'	136 02 0 00 000013 		IDPB T1,P1
  1061	001110'	201 00 0 00 010762'		MOVEI M,TRMBLK
  1062	001111'	260 17 0 00 003173'		PUSHJ P,TRMMES
  1063	001112'	554 15 0 15 000000 		HLRZ P3,(P3)	;NEXT LINK
  1064	001113'	326 15 0 00 001061'		JUMPN P3,FLPLP
  1065	001114'	263 17 0 00 000000 		POPJ P,		;DONE
  1066
  1067	001115'	200 01 0 15 000003 	FLPUFD:	MOVE T,3(P3)	;GET PPN
  1068	001116'	312 01 0 00 014157'		CAME T,[1,,1]	;IN MFD?
  1069	001117'	254 00 0 00 001065'		JRST FLPNUF	;NO, NOT UFD
  1070	001120'	554 06 0 15 000001 		HLRZ N,1(P3)
  1071	001121'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  1072	001122'	260 17 0 00 003577'		PUSHJ P,COMMA
  1073	001123'	550 06 0 15 000001 		HRRZ N,1(P3)
  1074	001124'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  1075	001125'	254 00 0 00 001067'		JRST FLPEXT
  1076
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 18
DSKCLN	MAC	30-Feb-73 19:40	

  1077					;THIS IS A MAIN ROUTINE.  IT EXPECTS AT LEAST P2 AND P4.
  1078	001126'	201 11 0 00 000000 	MFDUFD:	MOVEI CHAN,0	;JUST TO MAKE SURE
  1079	001127'	202 14 0 16 000002 		MOVEM P2,UFDPTR(P4)
  1080	001130'	402 00 0 16 001015 		SETZM UFDLSD(P4)	;NO DATA LOST YET
  1081	001131'	402 00 0 16 001012 		SETZM UFDUSD(P4)
  1082	001132'	200 01 0 16 000000 		MOVE T,RIBLBN(P4)
  1083	001133'	260 17 0 00 004270'		PUSHJ P,FULRBC		;GET ALL THE INFORMATION ON THIS RIB
  1084	001134'	263 17 0 00 000000 		 POPJ P,		;SOMETHING WRONG
  1085	001135'	200 01 0 16 000007 		MOVE T,SAVRIB+RIBSZS(P4)
  1086	001136'	302 01 0 00 000001 		CAIE T,1
  1087	001137'	263 17 0 00 000000 		POPJ P,		;MUST BE 1 FOR A UFD
  1088	001140'	200 01 0 00 010730'		MOVE T,PTROST
  1089	001141'	200 02 0 16 000000 		MOVE T1,RIBLBN(P4)
  1090	001142'	260 17 0 00 004352'		PUSHJ P,TSTZRO
  1091	001143'	334 00 0 00 000000 		 SKIPA
  1092	001144'	263 17 0 00 000000 		POPJ P,		;ALREADY WAS 0, SEEN BEFORE
  1093	001145'	200 02 0 16 001021 		MOVE T1,UFDHSP(P4)
  1094	001146'	500 02 0 00 010750'		HLL T1,STRHAD
  1095	001147'	201 01 0 00 000000 		MOVEI T,0	;SET ORIGINAL VALUES
  1096	001150'	202 01 0 02 000000 	UMFSLP:	MOVEM T,(T1)
  1097	001151'	271 01 0 00 000001 		ADDI T,1
  1098	001152'	253 02 0 00 001150'		AOBJN T1,UMFSLP
  1099	001153'	201 01 0 16 001013 		MOVEI T,FIXRBP(P4)
  1100	001154'	260 17 0 00 004635'		PUSHJ P,SETFIX
  1101	001155'	200 01 0 16 000000 		MOVE T,RIBLBN(P4)
  1102	001156'	260 17 0 00 002103'		PUSHJ P,FILMKC
  1103	001157'	263 17 0 00 000000 		 POPJ P,
  1104	001160'	260 17 0 00 004327'	NXUFDB:	PUSHJ P,GETBLK
  1105	001161'	254 00 0 00 001240'		 JRST UFDIGN	;BAD PAGE
  1106	001162'	322 01 0 00 001273'		JUMPE T,UFDDON	;EOF
  1107	001163'	350 00 0 16 001022 		AOS SIZRIB(P4)
  1108	001164'	607 01 0 00 200000 		TLNN T,RBREAL
  1109	001165'	254 00 0 00 001241'		JRST UFDNRL	;NOT A REAL POINTER
  1110	001166'	603 01 0 00 400000 		TLNE T,RBSPAR
  1111	001167'	254 00 0 00 001240'		JRST UFDIGN	;SPARE POINTERS NOT ALLOWED IN RIBS FOR UFD
  1112	001170'	260 17 0 00 002103'		PUSHJ P,FILMKC
  1113	001171'	254 00 0 00 001240'		 JRST UFDIGN	;CHECK FOR POINTER MUL USED ETC
  1114	001172'	260 17 0 00 004064'		PUSHJ P,PAGRDP	;READ THE BLOCK
  1115	001173'	254 00 0 00 001240'		 JRST UFDIGN	;READ ERROR, MAKE BLOCK GO AWAY
  1116	001174'	336 01 0 00 777000 		SKIPN T,BUF
  1117	001175'	254 00 0 00 001250'		JRST ANYHSH	;BLOCK SHOULD BE EMPTY
  1118	001176'	621 01 0 00 400000 		TLZ T,(1B0)
  1119	001177'	230 01 0 00 010751'		IDIV T,STRHSH
  1120	001200'	506 02 0 16 001021 		HRLM T1,UFDHSP(P4)
  1121	001201'	270 02 0 16 001021 		ADD T1,UFDHSP(P4)	;GET A POINTER TO THE HASH TABLE
  1122	001202'	200 01 0 16 001006 		MOVE T,DEVREL(P4)
  1123	001203'	312 01 0 02 000000 		CAME T,(T1)
  1124	001204'	254 00 0 00 001240'		JRST UFDIGN	;BAD HASH CODE
  1125	001205'	201 01 0 16 001010 	UFDBSZ:	MOVEI T,UFDBKF(P4)
  1126	001206'	260 17 0 00 004635'		PUSHJ P,SETFIX
  1127	001207'	261 17 0 00 000002 		PUSH P,T1
  1128	001210'	336 01 0 00 777777 		SKIPN T,BUF+777
  1129	001211'	254 00 0 00 001223'		JRST UFDESH	;END OF LINKS
  1130	001212'	313 01 0 16 001006 		CAMLE T,DEVREL(P4)
  1131	001213'	301 01 0 00 000725 		CAIL T,RBLVPR
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 18-1
DSKCLN	MAC	30-Feb-73 19:40	

  1132	001214'	254 00 0 00 001257'		JRST UFDBDH	;BAD HASH
  1133	001215'	200 03 0 16 001021 		MOVE T2,UFDHSP(P4)
  1134	001216'	500 03 0 00 010750'		HLL T2,STRHAD
  1135	001217'	316 01 0 03 000000 		CAMN T,(T2)
  1136	001220'	254 00 0 00 001257'		JRST UFDBDH	;BAD HASH IF ANYONE ELSE POINTS HERE
  1137	001221'	253 03 0 00 001217'		AOBJN T2,.-2
  1138	001222'	334 00 0 00 000000 		SKIPA
  1139	001223'	474 01 0 00 000000 	UFDESH:	SETO	T,	;END OF THE WORLD
  1140	001224'	262 17 0 00 000002 		POP P,T1
  1141	001225'	202 01 0 02 000000 		MOVEM T,(T1)	;RESET HASH LINK
  1142	001226'	350 00 0 16 001023 		AOS ALCRIB(P4)
  1143	001227'	200 01 0 16 001007 		MOVE T,SAVBLK(P4)
  1144	001230'	505 01 0 00 777000 		HRLI T,BUF
  1145	001231'	200 02 0 00 000001 		MOVE T1,T
  1146	001232'	251 01 0 02 000777 		BLT T,777(T1)
  1147	001233'	474 01 0 00 000000 		SETO	T,
  1148	001234'	260 17 1 16 000004 		PUSHJ P,@ROUTIN(P4)
  1149	001235'	201 01 0 16 001010 		MOVEI T,UFDBKF(P4)
  1150	001236'	260 17 0 00 004662'		PUSHJ P,ADDTOT
  1151	001237'	254 00 0 00 001160'		JRST NXUFDB	;CONTINUE
  1152
  1153	001240'	260 17 0 00 002220'	UFDIGN:	PUSHJ P,PTRBSB	;BAD POINTER
  1154	001241'	200 02 0 16 001021 	UFDNRL:	MOVE T1,UFDHSP(P4)
  1155	001242'	500 02 0 00 010750'		HLL T1,STRHAD	;THIS IS THE HASH ADDRESS AOBJN
  1156	001243'	200 01 0 16 001006 		MOVE T,DEVREL(P4)
  1157	001244'	316 01 0 02 000000 		CAMN T,(T1)
  1158	001245'	476 00 0 02 000000 		SETOM (T1)		;END OF THIS LINK
  1159	001246'	253 02 0 00 001244'		AOBJN T1,.-2
  1160	001247'	254 00 0 00 001160'		JRST NXUFDB	;AND GO
  1161
  1162	001250'	200 02 0 16 001021 	ANYHSH:	MOVE T1,UFDHSP(P4)
  1163	001251'	500 02 0 00 010750'		HLL T1,STRHAD
  1164	001252'	200 01 0 16 001006 		MOVE T,DEVREL(P4)
  1165	001253'	316 01 0 02 000000 		CAMN T,(T1)	;LOOK FOR ANY MATCH (EMPTY BLOCK)
  1166	001254'	254 00 0 00 001205'		JRST UFDBSZ	;FOUND IT, CONTINUE
  1167	001255'	253 02 0 00 001253'		AOBJN T1,.-2	;KEEP LOOKING
  1168	001256'	254 00 0 00 001240'		JRST UFDIGN	;COULD NOT FIND IT, CALL IT BAD
  1169
  1170	001257'	336 00 0 00 006557'	UFDBDH:	SKIPN FIXFLG
  1171	001260'	254 00 0 00 001267'		JRST UFDBHM
  1172	001261'	201 01 0 16 001010 		MOVEI T,UFDBKF(P4)
  1173	001262'	200 02 0 16 000001 		MOVE T1,NXTPTR(P4)
  1174	001263'	260 17 0 00 004640'		PUSHJ P,ADDFIX
  1175	001264'	254 00 0 00 001223'		 JRST UFDESH
  1176	001265'	402 00 0 00 777777 		SETZM BUF+777
  1177	001266'	263 17 0 00 000000 		POPJ P,
  1178
  1179	001267'	256 04 0 00 014211'	UFDBHM:	ERRLEV (LEVBAD)^	XCT LEVBAD,[PUSHJ P,ERLSET]^
  1180	001270'	205 01 0 00 014212'		MOVSI T,[ASCIZ /BAD UFD HASH/]
  1181	001271'	260 17 0 00 002451'		PUSHJ P,FLRERR
  1182	001272'	254 00 0 00 001223'		JRST UFDESH
  1183
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 19
DSKCLN	MAC	30-Feb-73 19:40	

  1184	001273'	402 00 0 00 010746'	UFDDON:	SETZM SAVSNM
  1185	001274'	201 02 0 00 002313'		MOVEI T1,PRMRB1
  1186	001275'	607 16 0 00 777777 		TLNN P4,-1
  1187	001276'	201 02 0 00 002415'		MOVEI T1,PRMRB2	;FOR THE MFD
  1188	001277'	260 17 0 02 000000 		PUSHJ P,(T1)
  1189	001300'	200 03 0 16 001012 		MOVE T2,UFDUSD(P4)
  1190	001301'	332 00 0 00 006565'		SKIPE	FSTFLG		;CANNOT DETERMINE USE ERRORS
  1191	001302'	254 00 0 00 001310'		JRST	UFDDN1		; IN FAST MODE
  1192	001303'	312 03 0 16 000035 		CAME T2,SAVRIB+RIBUSD(P4)
  1193	001304'	260 17 0 00 001313'		PUSHJ P,BADUSD
  1194	001305'	200 03 0 16 001012 		MOVE T2,UFDUSD(P4)
  1195	001306'	313 03 0 16 000034 		CAMLE T2,SAVRIB+RIBMXA(P4)
  1196	001307'	260 17 0 00 001323'		PUSHJ P,BADMXA
  1197	001310'	201 01 0 16 001013 	UFDDN1:	MOVEI T,FIXRBP(P4)
  1198	001311'	350 00 0 17 000000 		AOS (P)	;ALL IS OK NOW, SKIP RETURN
  1199	001312'	254 00 0 00 004662'		JRST ADDTOT
  1200
  1201	001313'	336 00 0 00 006557'	BADUSD:	SKIPN FIXFLG
  1202	001314'	254 00 0 00 001321'		JRST BADUSM
  1203	001315'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1204	001316'	263 17 0 00 000000 		 POPJ P,
  1205	001317'	202 03 0 00 777030 		MOVEM T2,BUF+RIBUSD
  1206	001320'	263 17 0 00 000000 		POPJ P,
  1207
  1208	001321'	515 01 0 00 014215'	BADUSM:	HRLZI T,[ASCIZ /USED COUNT INCORRECT/]
  1209	001322'	254 00 0 00 002450'		JRST FLMERR
  1210
  1211	001323'	336 00 0 00 006557'	BADMXA:	SKIPN FIXFLG
  1212	001324'	254 00 0 00 001331'		JRST BADMXM
  1213	001325'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1214	001326'	263 17 0 00 000000 		 POPJ P,
  1215	001327'	202 03 0 00 777027 		MOVEM T2,BUF+RIBMXA
  1216	001330'	263 17 0 00 000000 		POPJ P,
  1217
  1218	001331'	515 01 0 00 014222'	BADMXM:	HRLZI T,[ASCIZ /MAXIMUM USED COUNT INCORRECT/]
  1219	001332'	254 00 0 00 002450'		JRST FLMERR
  1220
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 20
DSKCLN	MAC	30-Feb-73 19:40	

  1221					;PROCESS THE MFD (ONE BLOCK OF IT)
  1222
  1223	001333'	200 14 0 16 001007 	MFDPRC:	MOVE P2,SAVBLK(P4)
  1224	001334'	505 14 0 00 777632 		HRLI P2,-1000/UFDSIZ
  1225	001335'	202 14 0 16 000003 		MOVEM P2,UFDOGP(P4)
  1226	001336'	336 01 0 14 000000 	MFDPR1:	SKIPN T,UFDNAM(P2)
  1227	001337'	263 17 0 00 000000 		POPJ	P,		;0 MEANS THE END.
  1228	001340'	621 01 0 00 400000 		TLZ T,(1B0)
  1229	001341'	230 01 0 00 010751'		IDIV T,STRHSH
  1230	001342'	554 01 0 16 001021 		HLRZ T,UFDHSP(P4)
  1231	001343'	312 01 0 00 000002 		CAME T,T1
  1232						JRST	[PUSH P,P2
  1233	001344'	254 00 0 00 014230'			JRST MFDDEL]
  1234	001345'	200 01 0 14 000000 		MOVE T,UFDNAM(P2)
  1235	001346'	554 02 0 14 000001 		HLRZ T1,UFDEXT(P2)
  1236	001347'	302 02 0 00 654644 		CAIE T1,'UFD'
  1237	001350'	254 00 0 00 001405'		JRST NOTUFD
  1238	001351'	200 03 0 14 000004 		MOVE T2,UFDRBP(P2)
  1239	001352'	316 03 0 00 007602'		CAMN T2,MFDRBC
  1240						JRST	[SETOM MFDRBC
  1241	001353'	254 00 0 00 014232'			JRST SKPENT]
  1242	001354'	200 16 0 00 014234'		MOVE P4,[MFDRIB,,UFDRIB]
  1243	001355'	516 02 0 16 001017 		HRLZM T1,ERREXT(P4)
  1244	001356'	202 01 0 16 001016 		MOVEM T,ERRNAM(P4)
  1245	001357'	200 01 0 00 014157'		MOVE T,[1,,1]
  1246	001360'	202 01 0 16 001020 		MOVEM T,ERRPPN(P4)
  1247	001361'	200 01 0 14 000004 		MOVE T,UFDRBP(P2)
  1248	001362'	261 17 0 00 000014 		PUSH P,P2
  1249	001363'	202 01 0 16 000000 		MOVEM T,RIBLBN(P4)
  1250	001364'	260 17 0 00 001126'		PUSHJ P,MFDUFD	;NOW PROCESS THIS UFD
  1251	001365'	254 00 0 00 001420'		 JRST MFDDEL	;NEEDS DELETING
  1252	001366'	332 00 0 16 001015 		SKIPE UFDLSD(P4)	;DID FILE IN UFD LOSE DATA?
  1253	001367'	336 00 0 00 006557'		SKIPN FIXFLG	;DID A FILE LOSE DATA AND FIXING
  1254	001370'	254 00 0 00 001400'		JRST MFDPR2	;NO
  1255	001371'	200 02 0 16 000000 		MOVE T1,RIBLBN(P4)
  1256	001372'	201 01 0 00 006560'		MOVEI T,FIXPTR
  1257	001373'	260 17 0 00 004640'		PUSHJ P,ADDFIX	;ADD A FIXUP ENTRY
  1258	001374'	254 00 0 00 001400'		 JRST MFDPR2
  1259	001375'	205 03 0 00 000001 		MOVSI T2,RIPBDA
  1260	001376'	436 03 0 00 777022 		IORM T2,BUF+RIBSTS	;MARK UFD
  1261	001377'	263 17 0 00 000000 		POPJ P,
  1262	001400'	262 17 0 00 000014 	MFDPR2:	POP P,P2
  1263	001401'	271 14 0 00 000004 	SKPENT:	ADDI P2,UFDSIZ-1
  1264	001402'	201 16 0 00 007603'		MOVEI P4,MFDRIB
  1265	001403'	253 14 0 00 001336'		AOBJN P2,MFDPR1
  1266	001404'	263 17 0 00 000000 		POPJ P,		;FINISHED A MFD BLOCK
  1267
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 21
DSKCLN	MAC	30-Feb-73 19:40	

  1268	001405'	200 16 0 00 014235'	NOTUFD:	MOVE P4,[MFDRIB,,FILRIB]
  1269	001406'	202 01 0 16 001016 		MOVEM T,ERRNAM(P4)
  1270	001407'	516 02 0 16 001017 		HRLZM T1,ERREXT(P4)
  1271	001410'	200 01 0 00 014157'		MOVE T,[1,,1]
  1272	001411'	202 01 0 16 001020 		MOVEM T,ERRPPN(P4)
  1273	001412'	261 17 0 00 000014 		PUSH P,P2
  1274	001413'	200 01 0 14 000004 		MOVE T,UFDRBP(P2)
  1275	001414'	202 01 0 16 000000 		MOVEM T,RIBLBN(P4)
  1276	001415'	260 17 0 00 001775'		PUSHJ P,FILPRC
  1277	001416'	254 00 0 00 001420'		 JRST MFDDEL
  1278	001417'	254 00 0 00 001400'		JRST MFDPR2
  1279
  1280	001420'	200 14 0 00 000016 	MFDDEL:	MOVE P2,P4	;SAVE FOR ERROR MESSAGE
  1281	001421'	201 16 0 00 007603'		MOVEI P4,MFDRIB
  1282	001422'	200 03 0 17 000000 		MOVE T2,(P)
  1283	001423'	274 03 0 16 000003 		SUB T2,UFDOGP(P4)
  1284	001424'	336 00 0 00 006557'		SKIPN FIXFLG
  1285	001425'	254 00 0 00 001442'		JRST MFDRBE
  1286	001426'	201 01 0 16 001010 		MOVEI T,UFDBKF(P4)
  1287	001427'	200 02 0 16 000001 		MOVE T1,NXTPTR(P4)
  1288	001430'	260 17 0 00 004640'		PUSHJ P,ADDFIX
  1289	001431'	254 00 0 00 001446'		 JRST MFDRBD
  1290	001432'	201 02 0 03 777000 		MOVEI T1,BUF(T2)
  1291	001433'	505 02 0 02 000005 		HRLI T1,UFDSIZ(T1)
  1292	001434'	251 02 0 00 777770 		BLT T1,BUF+UFDLST-1
  1293	001435'	201 02 0 00 777772 		MOVEI T1,BUF+UFDLST+1
  1294	001436'	402 00 0 02 777777 		SETZM -1(T1)
  1295	001437'	505 02 0 02 777777 		HRLI T1,-1(T1)
  1296	001440'	251 02 0 00 777776 		BLT T1,BUF+776
  1297	001441'	263 17 0 00 000000 		POPJ P,
  1298
  1299	001442'	515 01 0 00 014236'	MFDRBE:	HRLZI T,[ASCIZ /RIB ERROR/]
  1300	001443'	541 01 0 14 001016 		HRRI T,ERRNAM(P2)
  1301	001444'	260 17 0 00 003365'		PUSHJ P,PRTRBL
  1302	001445'	254 00 0 00 001400'		JRST MFDPR2
  1303
  1304	001446'	200 03 0 17 000000 	MFDRBD:	MOVE T2,(P)		;GET POINTER TO BAD UFD ENTRY
  1305	001447'	201 02 0 03 000000 		MOVEI T1,(T2)		;OVERWRITE IT WITH NEXT ENTRY
  1306	001450'	505 02 0 03 000005 		HRLI T1,UFDSIZ(T2)	;WHICH IS HERE
  1307	001451'	200 03 0 16 000003 		MOVE T2,UFDOGP(P4)	;GET BEGINNING OF MFD IN CORE
  1308	001452'	251 02 0 03 000770 		BLT T1,UFDLST-1(T2)	;MOVE EVERYTHING UP
  1309	001453'	201 02 0 03 000772 		MOVEI T1,UFDLST+1(T2)	;NOW CLEAR VACANT LAST ENTRY
  1310	001454'	402 00 0 02 777777 		SETZM -1(T1)
  1311	001455'	505 02 0 02 777777 		HRLI T1,-1(T1)
  1312	001456'	251 02 0 03 000776 		BLT T1,776(T2)		;BUT DON'T CLEAR POINTER AT THE END.
  1313	001457'	262 17 0 00 000014 		POP P,P2		;RESTORE POINTER TO MFD
  1314	001460'	254 00 0 00 001336'		JRST MFDPR1		;AND CONTINUE WHERE WE LEFT OFF.
  1315
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 22
DSKCLN	MAC	30-Feb-73 19:40	

  1316	001461'	200 02 0 16 000000 	UFDPRC:	MOVE T1,RIBLBN(P4)
  1317	001462'	316 02 0 00 010756'		CAMN T1,SYSRIB
  1318	001463'	476 00 0 00 010756'		SETOM SYSRIB
  1319	001464'	200 12 0 00 006570'		MOVE U,HIGHU
  1320	001465'	402 00 1 00 010737'		SETZM @PTRUNU	;CLEAR UNIT IN USE FLAGS
  1321	001466'	365 12 0 00 001465'		SOJGE U,.-1
  1322	001467'	402 00 0 00 005413'		SETZM CHANU
  1323	001470'	200 02 0 00 014240'		MOVE T1,[CHANU,,CHANU+1]
  1324	001471'	251 02 0 00 005430'		BLT T1,CHANU+MXCHN-1	;AND CHANNEL IN USE FLAGS
  1325	001472'	402 00 0 00 005447'		SETZM CHNCNT#		;NONE IN USE
  1326	001473'	402 00 0 00 012022'		SETZM UFDPCT		;ALSO CLEAR FILE PROCESSED FLAGS
  1327	001474'	200 02 0 00 014241'		MOVE T1,[UFDPCT,,UFDPCT+1]
  1328	001475'	251 02 0 00 013021'		BLT T1,UFDPCT+777
  1329	001476'	200 14 0 16 001007 		MOVE P2,SAVBLK(P4)
  1330	001477'	505 14 0 00 777632 		HRLI P2,-1000/UFDSIZ		;SCAN ALL ENTRIES
  1331	001500'	202 14 0 16 000003 		MOVEM P2,UFDOGP(P4)	;SAVE POINTER TO ORIGIN
  1332	001501'	200 16 0 00 014242'		MOVE P4,[UFDRIB,,FILRIB]
  1333	001502'	205 11 0 00 777762 		MOVSI CHAN,-MXCHN
  1334	001503'	260 17 0 00 001575'		PUSHJ P,FNDSEK		;START UP ALL POSSIBLE SEEKS
  1335	001504'	254 00 0 00 001506'		 JRST FINSEK
  1336	001505'	253 11 0 00 001503'		AOBJN CHAN,.-2
  1337
  1338	001506'	336 00 0 00 005447'	FINSEK:	SKIPN	CHNCNT		;ANY FILES TO PROCESS?
  1339	001507'	254 00 0 00 001546'		JRST	NEDZT		;NO
  1340	001510'	213 00 0 00 000011 		MOVNS CHAN		;GET THE MAX CHANNEL USED
  1341	001511'	516 11 0 00 005411'		HRLZM CHAN,BIGCHN#
  1342	001512'	200 11 0 00 005411'	FINSK0:	MOVE CHAN,BIGCHN	;NOW CYCLE THROUGH CHANNELS
  1343	001513'	336 14 0 11 005413'	FINSK1:	SKIPN P2,CHANU(CHAN)	;THIS ONE IN USE?
  1344	001514'	254 00 0 00 001544'		JRST CHNFRE		;NO
  1345	001515'	200 01 0 14 000000 		MOVE T,UFDNAM(P2)
  1346	001516'	202 01 0 16 001016 		MOVEM T,ERRNAM(P4)
  1347	001517'	200 01 0 14 000001 		MOVE T,UFDEXT(P2)
  1348	001520'	512 01 0 16 001017 		HLLZM T,ERREXT(P4)
  1349	001521'	200 01 0 00 014040'		MOVE T,ERRNAM+UFDRIB
  1350	001522'	202 01 0 16 001020 		MOVEM T,ERRPPN(P4)
  1351	001523'	200 01 0 14 000004 		MOVE T,UFDRBP(P2)
  1352	001524'	202 01 0 16 000000 		MOVEM T,RIBLBN(P4)
  1353	001525'	200 01 0 14 000000 		MOVE T,UFDNAM(P2)
  1354	001526'	621 01 0 00 400000 		TLZ T,(1B0)
  1355	001527'	230 01 0 00 010751'		IDIV T,STRHSH
  1356	001530'	554 01 0 00 014043'		HLRZ T,UFDHSP+UFDRIB
  1357	001531'	316 01 0 00 000002 		CAMN T,T1
  1358	001532'	260 17 0 00 001775'		PUSHJ P,FILPRC		;PROCESS FILE
  1359	001533'	260 17 0 00 001701'		 PUSHJ P,FILDEL		;RIB ERROR, MUST MARK TO DELETE
  1360	001534'	200 02 0 00 005507'		MOVE T1,FILLOS
  1361	001535'	436 02 0 00 014037'		IORM T1,UFDRIB+UFDLSD
  1362	001536'	200 02 0 16 001023 		MOVE T1,ALCRIB(P4)
  1363	001537'	272 02 0 00 014034'		ADDM T1,UFDUSD+UFDRIB
  1364	001540'	260 17 0 00 001560'		PUSHJ P,FNDSK1		;START A NEW SEEK
  1365	001541'	254 00 0 00 001544'		 JRST CHNFRE		;NOTHING NEW TO DO
  1366	001542'	253 11 0 00 001513'	NXTCHN:	AOBJN CHAN,FINSK1
  1367	001543'	254 00 0 00 001512'		JRST FINSK0
  1368
  1369	001544'	332 00 0 00 005447'	CHNFRE:	SKIPE CHNCNT	;ANY STILL ACTIVE
  1370	001545'	254 00 0 00 001542'		JRST NXTCHN	;YES, GO FIND THEM AND PROCESS
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 22-1
DSKCLN	MAC	30-Feb-73 19:40	

  1371	001546'	201 16 0 00 013022'	NEDZT:	MOVEI P4,UFDRIB
  1372	001547'	200 02 0 16 001007 		MOVE T1,SAVBLK(P4)
  1373	001550'	271 02 0 00 000777 		ADDI T1,777
  1374	001551'	274 02 0 00 000014 		SUB T1,P2
  1375	001552'	213 00 0 00 000002 		MOVNS T1
  1376	001553'	504 14 0 00 000002 		HRL P2,T1	;SET AOBJN POINTER
  1377	001554'	332 00 0 14 000000 		SKIPE (P2)
  1378	001555'	254 00 0 00 001654'		JRST NEDZRO
  1379	001556'	253 14 0 00 001554'		AOBJN P2,.-2
  1380	001557'	263 17 0 00 000000 		POPJ P,
  1381
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 23
DSKCLN	MAC	30-Feb-73 19:40	

  1382					;[37] original comment preserved for historical interest
  1383					;ROUTINE TO HANDLE SEEKS.
  1384					;
  1385					;ENTER AT FNDSEK TO FIND A UFD ENTRY IN THE PAGE POINTED TO BY
  1386					;P2, SUCH THAT THE RETRIEVAL PNTR FOR THE RIB OF THAT ENTRY
  1387					;IS ON A UNIT THAT IS NOT BUSY AND THE ENTRY HAS NOT
  1388					;BEEN PROCESSED BEFORE.  IF FOUND, START THE SEEK AND SKIP
  1389					;RETURN.  IF NONE FOUND, NON-SKIP RETURN.
  1390					;[37] enter at fndsk1 when finished processing a file.  mark 
  1391					;[37] channel and unit free, then fall into fndsek to get the next file.
  1392					;[37] 
  1393					;[37] keep the same logic, but instead of starting a seek, start a page
  1394					;[37] on the way in by mapping and pre-referencing. 
  1395					;[37] entry FNDSEK - find a UFD entry in the 
  1396
  1397
  1398	001560'	200 14 0 11 005413'	FNDSK1:	MOVE P2,CHANU(CHAN)	;HERE WHEN WE HAVE FINISHED A FILE
  1399	001561'	200 12 0 11 005431'		MOVE U,CHANUU(CHAN)	;THE UNIT WE WERE PROCESSING
  1400	001562'	402 00 0 11 005413'		SETZM CHANU(CHAN)	;CHANNEL IS NOW FREE
  1401	001563'	317 12 0 00 006570'		CAMG	U,HIGHU		;IF OUT OF RANGE, LET DISK READING ROUTINE
  1402									; GIVE ERROR
  1403	001564'	402 00 1 00 010737'		SETZM @PTRUNU		;ALSO UNIT
  1404	001565'	402 00 1 00 010731'		setzm	@ptrpge		;[37] also seen-error flag
  1405	001566'	200 03 1 00 010740'		move	t2,@ptrupg	;[37] this guy no longer needed, so 
  1406	001567'	505 03 0 00 000001 		hrli	t2,1		;[37] blow him away
  1407	001570'	047 03 0 00 777712 		vclear	t2,		;[37] goodbye
  1408	001571'	260 17 0 00 004150'		 PUSHJ	P,PAGERR	;[37] loser, go see why
  1409	001572'	370 00 0 00 005447'		SOS CHNCNT		;ONE FEWER CHANNEL
  1410	001573'	271 14 0 00 000004 	FNDSK2:	ADDI P2,UFDSIZ-1		;NEXT FILE
  1411	001574'	252 14 0 00 004030'		AOBJP P2,CPOPJ		;SET THE PLACE OF ENDING
  1412	001575'	336 00 0 14 000000 	FNDSEK:	SKIPN (P2)
  1413	001576'	263 17 0 00 000000 		POPJ P,
  1414	001577'	135 12 0 00 014243'		LDB U,[POINT PTSUNI,UFDRBP(P2),PTNUNI]
  1415	001600'	317 12 0 00 006570'		CAMG U,HIGHU		;IF OUT OF RANGE, LET DISK READING
  1416									;ROUTINE GIVE ERROR
  1417	001601'	336 00 1 00 010737'		SKIPN @PTRUNU
  1418	001602'	254 00 0 00 001604'		JRST	.+2		;OUT OF RANGE OR UNIT NOT BUSY.
  1419	001603'	254 00 0 00 001573'		JRST FNDSK2		;THAT UNIT IS BUSY
  1420	001604'	200 03 0 00 000014 		MOVE T2,P2
  1421	001605'	274 03 0 00 013025'		SUB T2,UFDOGP+UFDRIB
  1422	001606'	332 00 0 03 012022'		SKIPE UFDPCT(T2)	;HAVE WE PROCESSED THAT ONE?
  1423	001607'	254 00 0 00 001573'		JRST FNDSK2		;YES
  1424	001610'	476 00 0 03 012022'		SETOM UFDPCT(T2)	;NO, WE WILL NOW
  1425	001611'	336 00 0 00 006565'		SKIPN	FSTFLG		;running in fast mode?
  1426	001612'	254 00 0 00 001616'		 JRST	FNDSK3		;no, do all files
  1427	001613'	200 01 0 14 000001 		MOVE	T,UFDUF2(P2)	;yes, fast mode
  1428	001614'	606 01 0 00 020000 		TRNN	T,UFPALC	;HAS THIS FILE BEEN MODIFIED RECENTLY?
  1429	001615'	254 00 0 00 001573'		 JRST	FNDSK2		;NO, DON'T BOTHER TO PROCESS IT
  1430	001616'	202 14 0 11 005413'	FNDSK3:	MOVEM P2,CHANU(CHAN)
  1431	001617'	202 12 0 11 005431'		MOVEM	U,CHANUU(CHAN)	;CHANNEL IN USE
  1432	001620'	350 00 0 00 005447'		AOS CHNCNT
  1433	001621'	313 12 0 00 006570'		CAMLE	U,HIGHU		;IF UNIT NUMBER IS BAD,
  1434	001622'	254 00 0 00 004027'		JRST	CPOPJ1		;RETURN NOW.
  1435
  1436					;[37] now stash the disk page @ptrunu to say unit in use
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 23-1
DSKCLN	MAC	30-Feb-73 19:40	

  1437					;[37] 	SETOM	@PTRUNU		;AND UNIT
  1438
  1439					;[37] actually, only want RH
  1440					;[37] 	MOVE T,CHAN
  1441	001623'	550 01 0 00 000011 		hrrz	t,chan		;[37] channel number for mapping
  1442
  1443	001624'	135 02 0 00 014244'		LDB T1,[POINT PTSPNO,UFDRBP(P2),PTNPNO]
  1444
  1445					;[37] bug found here!  he was doing a page useti on a logical
  1446					;[37] page within the unit, but it was the structure that was
  1447					;[37] initted!  must make page be logical page within structure
  1448					;[37] same like PAGRED (q.v.) routine, from where the following
  1449					;[37] three lines of code were lifted
  1450	001625'	200 03 0 00 010754'		move	t2,strppu	;[37] pages per unit in str
  1451	001626'	220 03 0 00 000012 		imul	t2,u		;[37] page num of 1st page on unit
  1452	001627'	270 02 0 00 000003 		add	t1,t2		;[37] t1=logical page within str
  1453
  1454	001630'	202 02 1 00 010737'		movem	t1,@ptrunu	;[37] mark unit in use & stash disk page
  1455									;[37] replaces setom @ptrunu above
  1456
  1457					;[37] rip out the useti/seek stuff, because we want to map and 
  1458					;[37] pre-reference instead
  1459					;[37] 	HRLI	T,CIO.PI	;CHANIO PAGE USETI.
  1460					;[37] 	CHANIO T,T1
  1461					;[37] 	HRLI	T,CIO.SK	;CHANIO SEEK.
  1462					;[37] 	CHANIO T,
  1463
  1464	001631'	202 02 0 00 006601'		movem	t1,mapwd+1	;[37] stash the disk address (source)
  1465	001632'	200 02 1 00 010740'		move	t1,@ptrupg	;[37] get cache page (destination)
  1466	001633'	505 02 0 00 002001 		hrli	t1,(.prro!1b17)	;[37] cow protect and only 1, please
  1467	001634'	202 02 0 00 006600'		movem	t1,mapwd	;[37] stash it
  1468	001635'	505 01 0 00 000043 		hrli	t,.chsmp	;[37] set to super-map it
  1469	001636'	043 01 0 00 006600'		chanio	t,mapwd		;[37] ask
  1470	001637'	254 00 0 00 001652'		 jrst	prefer		;[37] a loser, handle it
  1471	001640'	515 01 0 00 002001 		hrlzi	t,(.addws!1b17)	;[37] add one page to working set
  1472	001641'	502 01 0 00 006600'		hllm	t,mapwd		;[37] page we just mapped to
  1473	001642'	201 01 0 00 006600'		movei	t,mapwd		;[37] remember where stashed
  1474	001643'	505 01 0 00 000001 		hrli	t,.wsrng	;[37] ask to ad to WS
  1475	001644'	047 01 0 00 777704 		wsctl	t,		;[37] thusly
  1476	001645'	254 00 0 00 001652'		 jrst	prefer		;[37] loser
  1477	001646'	200 02 1 00 010740'		move	t1,@ptrupg	;[37] cache page again
  1478	001647'	047 02 0 00 777703 		preref	t1,		;[37] pre-reference it to start it in
  1479	001650'	254 00 0 00 001652'		 jrst	prefer		;[37] loser, handle it
  1480
  1481	001651'	254 00 0 00 004027'		JRST CPOPJ1		;GOT IT
  1482
  1483	001652'				prefer:	movei	m,[asciz \
  1484	001652'	201 00 0 00 014245'	FATAL ERROR IN FNDSEK ROUTINE.  ABORTING...\]
  1485	001653'	254 00 0 00 003206'		jrst	faterr		;[37] complain and die
  1486
  1487
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 24
DSKCLN	MAC	30-Feb-73 19:40	

  1488	001654'	336 00 0 00 006557'	NEDZRO:	SKIPN FIXFLG
  1489	001655'	254 00 0 00 001674'		JRST NEDZER	;ERROR MESSAGE
  1490	001656'	200 04 0 00 000014 		MOVE T3,P2
  1491	001657'	274 04 0 00 013025'		SUB T3,UFDOGP+UFDRIB
  1492	001660'	553 00 0 00 000004 		HRRZS T3
  1493	001661'	200 02 0 16 000001 		MOVE T1,NXTPTR(P4)
  1494	001662'	201 01 0 16 001010 		MOVEI T,UFDBKF(P4)
  1495	001663'	260 17 0 00 004640'		PUSHJ P,ADDFIX
  1496	001664'	263 17 0 00 000000 		 POPJ P,
  1497	001665'	402 00 0 04 777000 		SETZM BUF(T3)
  1498	001666'	301 04 0 00 000776 		CAIL T3,776
  1499	001667'	263 17 0 00 000000 		POPJ P,		;DONE IF JUST 1 WORD
  1500	001670'	271 04 0 00 777001 		ADDI T3,BUF+1
  1501	001671'	505 04 0 04 777777 		HRLI T3,-1(T3)
  1502	001672'	251 04 0 00 777776 		BLT T3,BUF+776
  1503	001673'	263 17 0 00 000000 		POPJ P,
  1504
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 25
DSKCLN	MAC	30-Feb-73 19:40	

  1505	001674'	256 02 0 00 014211'	NEDZER:	ERRLEV (LEVUSR)^	XCT LEVUSR,[PUSHJ P,ERLSET]^
  1506	001675'	200 06 0 16 000001 		MOVE N,NXTPTR(P4)
  1507	001676'	515 01 0 00 014257'		HRLZI T,[ASCIZ /NEED EXTRA WORDS ZEROED/]
  1508	001677'	541 01 0 16 001016 		HRRI T,ERRNAM(P4)
  1509	001700'	254 00 0 00 003365'		JRST PRTRBL
  1510
  1511					;HERE ON RIB ERROR OR MULTIPLE ENTRY
  1512
  1513	001701'	476 00 0 00 005507'	FILDEL:	SETOM FILLOS
  1514	001702'	201 02 0 00 000001 		MOVEI T1,1
  1515	001703'	202 02 0 16 001023 		MOVEM T1,ALCRIB(P4)
  1516	001704'	336 00 0 00 006557'		SKIPN FIXFLG
  1517	001705'	254 00 0 00 001734'		JRST RIBERR	;ERROR ONLY
  1518	001706'	200 02 0 00 013023'		MOVE T1,UFDRIB+NXTPTR
  1519	001707'	200 03 0 11 005413'		MOVE T2,CHANU(CHAN)
  1520	001710'	274 03 0 00 013025'		SUB T2,UFDOGP+UFDRIB
  1521	001711'	201 01 0 00 014032'		MOVEI T,UFDBKF+UFDRIB
  1522	001712'	200 04 0 00 014040'		MOVE T3,UFDRIB+ERRNAM	;ALSO GET PPN FOR REENTRY
  1523	001713'	476 00 0 00 014037'		SETOM	UFDLSD+UFDRIB	;FILE IN UFD HAS LOST DATA
  1524	001714'	260 17 0 00 004640'		PUSHJ P,ADDFIX
  1525	001715'	254 00 0 00 001741'		 JRST RELDEL	;DIFFENCE IS IF WE WANT TO REENTER NAME
  1526	001716'	200 01 0 03 777000 		MOVE T,BUF(T2)	;GET FILE NAME
  1527	001717'	202 01 0 15 000001 		MOVEM T,1(P3)	;P3 POINTS TO THE ERROR BLOCK
  1528	001720'	200 01 0 03 777001 		MOVE T,BUF+1(T2)
  1529	001721'	202 01 0 15 000002 		MOVEM T,2(P3)	;3(P3) IS ALREADY PPN
  1530	001722'	506 15 1 00 006563'		HRLM P3,@FIXREN+1	;LINK IN
  1531	001723'	552 15 0 00 006563'		HRRZM P3,FIXREN+1	;THIS BLOCK LIKE WILL BE ZERORED LATER
  1532	001724'	271 03 0 00 777000 		ADDI	T2,BUF
  1533	001725'	505 03 0 03 000005 		HRLI T2,UFDSIZ(T2)
  1534	001726'	251 03 0 00 777770 		BLT T2,BUF+UFDLST-1
  1535	001727'	201 03 0 00 777772 		MOVEI T2,BUF+UFDLST+1
  1536	001730'	402 00 0 03 777777 		SETZM -1(T2)
  1537	001731'	505 03 0 03 777777 		HRLI T2,-1(T2)
  1538	001732'	251 03 0 00 777776 		BLT T2,BUF+776
  1539	001733'	263 17 0 00 000000 		POPJ P,
  1540
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 26
DSKCLN	MAC	30-Feb-73 19:40	

  1541	001734'	200 06 0 00 005530'	RIBERR:	MOVE N,RIBLBN+FILRIB
  1542	001735'	256 02 0 00 014211'		ERRLEV (LEVUSR)^	XCT LEVUSR,[PUSHJ P,ERLSET]^
  1543	001736'	515 01 0 00 014236'		HRLZI T,[ASCIZ /RIB ERROR/]
  1544	001737'	541 01 0 00 006546'		HRRI T,ERRNAM+FILRIB
  1545	001740'	254 00 0 00 003365'		JRST PRTRBL
  1546
  1547					;REMOVE ENTRY FROM CURRENT UFD BLOCK
  1548
  1549	001741'	200 02 0 11 005413'	RELDEL:	MOVE T1,CHANU(CHAN)	;POINTER
  1550	001742'	200 03 0 00 005411'	RELDL1:	MOVE T2,BIGCHN
  1551	001743'	312 02 0 03 005413'		CAME T1,CHANU(T2)
  1552	001744'	253 03 0 00 001743'		AOBJN T2,.-1
  1553	001745'	325 03 0 00 001750'		JUMPGE T2,RELDL2	;NOTHING WITH THAT POINTER
  1554	001746'	210 01 0 00 014264'		MOVN T,[1,,UFDSIZ]	;BACK UP POINTER
  1555	001747'	272 01 0 03 005413'		ADDM T,CHANU(T2)
  1556	001750'	271 02 0 00 000004 	RELDL2:	ADDI T1,UFDSIZ-1
  1557	001751'	253 02 0 00 001742'		AOBJN T1,RELDL1		;GET ALL POINTER SAFTER THIS
  1558	001752'	200 02 0 11 005413'		MOVE T1,CHANU(CHAN)
  1559	001753'	271 02 0 00 012027'		ADDI T1,UFDSIZ+UFDPCT	;MOVE THE UFDPCT ARRAY
  1560	001754'	274 02 0 00 013025'		SUB T1,UFDOGP+UFDRIB
  1561	001755'	505 02 0 02 000005 		HRLI T1,UFDSIZ(T1)
  1562	001756'	251 02 0 00 013012'		BLT T1,UFDPCT+UFDLST-1
  1563	001757'	201 02 0 00 013014'		MOVEI T1,UFDPCT+UFDLST+1
  1564	001760'	402 00 0 02 777777 		SETZM -1(T1)
  1565	001761'	505 02 0 02 777777 		HRLI T1,-1(T1)
  1566	001762'	251 02 0 00 013020'		BLT T1,UFDPCT+776
  1567	001763'	200 02 0 11 005413'		MOVE T1,CHANU(CHAN)
  1568	001764'	271 02 0 00 000005 		ADDI T1,UFDSIZ
  1569	001765'	505 02 0 02 000005 		HRLI T1,UFDSIZ(T1)
  1570	001766'	200 03 0 00 014031'		MOVE T2,SAVBLK+UFDRIB
  1571	001767'	251 02 0 03 000770 		BLT T1,UFDLST-1(T2)
  1572	001770'	505 02 0 03 000771 		HRLI T1,UFDLST(T2)
  1573	001771'	541 02 0 03 000772 		HRRI T1,UFDLST+1(T2)
  1574	001772'	402 00 0 03 000771 		SETZM UFDLST(T2)
  1575	001773'	251 02 0 03 000776 		BLT T1,776(T2)
  1576	001774'	263 17 0 00 000000 		POPJ P,
  1577
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 27
DSKCLN	MAC	30-Feb-73 19:40	

  1578					;PROCESS A FILE
  1579
  1580	001775'	202 14 0 16 000002 	FILPRC:	MOVEM P2,UFDPTR(P4)
  1581	001776'	201 02 0 00 004030'		MOVEI T1,CPOPJ
  1582	001777'	202 02 0 16 000004 		MOVEM	T1,ROUTIN(P4)	;SPECIAL ROUTINE FOR EACH PAGE
  1583	002000'	332 00 0 00 010760'		SKIPE TRBFIL
  1584	002001'	260 17 0 00 003610'		PUSHJ	P,CRLF		;PROBLEM ON LAST FILE, SEPARATE
  1585	002002'	402 00 0 00 010760'		SETZM TRBFIL
  1586	002003'	200 01 0 16 000000 		MOVE T,RIBLBN(P4)
  1587	002004'	260 17 0 00 004270'		PUSHJ P,FULRBC		;FULL CHECK OF RIB
  1588	002005'	254 00 0 00 004543'		 JRST ISCRIT		;CHECK FOR CRITICAL FILE
  1589	002006'	200 01 0 16 000000 		MOVE T,RIBLBN(P4)
  1590	002007'	260 17 0 00 002103'		PUSHJ P,FILMKC
  1591	002010'	254 00 0 00 004543'		 JRST ISCRIT
  1592	002011'	205 01 0 00 777773 		MOVSI T,-SPCLEN
  1593	002012'	200 02 0 16 000000 		MOVE T1,RIBLBN(P4)
  1594	002013'	312 02 1 01 003142'		CAME T1,@SPCACT(T)
  1595	002014'	253 01 0 00 002013'		AOBJN T,.-1
  1596	002015'	325 01 0 00 002031'		JUMPGE	T,NOSPEC	;SOME FILES NEED SPECIAL CHECKS.
  1597
  1598	002016'	200 02 0 01 003161'		MOVE T1,SYSNAM(T)	;CHECK NAME, EXT, PPN
  1599	002017'	312 02 0 16 001016 		CAME T1,ERRNAM(P4)
  1600	002020'	254 00 0 00 003746'		 JRST UFDERR
  1601	002021'	510 02 0 16 001017 		HLLZ T1,ERREXT(P4)
  1602	002022'	312 02 0 01 003166'		CAME T1,SYSEXT(T)
  1603	002023'	254 00 0 00 003746'		 JRST UFDERR
  1604	002024'	200 02 0 01 003154'		MOVE T1,SYSPPN(T)
  1605	002025'	312 02 0 16 001020 		CAME T1,ERRPPN(P4)
  1606	002026'	254 00 0 00 003746'		 JRST UFDERR
  1607	002027'	200 02 0 01 003147'		MOVE T1,SPACT2(T)
  1608	002030'	260 17 0 02 000000 		PUSHJ P,(T1)		;SO DO THEM
  1609	002031'	201 01 0 16 001013 	NOSPEC:	MOVEI	T,FIXRBP(P4)
  1610	002032'	260 17 0 00 004635'		PUSHJ P,SETFIX	;SET TO RECORD FIXES TO RIB
  1611	002033'	200 14 0 11 005413'		MOVE P2,CHANU(CHAN)	;POINT TO CHANNEL
  1612	002034'	402 00 0 00 010746'		SETZM SAVSNM#	;FOR RECORDING SNM IN FIRST RIB
  1613	002035'	476 00 0 00 010747'		SETOM SPAROK#		;OK TO HAVE A SPARE POINTER
  1614	002036'	402 00 0 00 005505'		SETZM EOFSEN#
  1615	002037'	402 00 0 00 005507'		SETZM FILLOS#
  1616	002040'	402 00 0 00 006554'		SETZM FILTRB#
  1617	002041'	260 17 0 00 004320'	FILRBN:	PUSHJ P,SETPTR
  1618	002042'	260 17 0 00 004327'	FILCNT:	PUSHJ P,GETBLK
  1619	002043'	254 00 0 00 002241'		 JRST PTRBAD		;NOT A GOOD POINTER
  1620	002044'	623 01 0 00 400000 		TLZE T,RBSPAR
  1621	002045'	254 00 0 00 002062'		JRST SPRPTR
  1622	002046'	322 01 0 00 002152'		JUMPE T,RIBEOF
  1623	002047'	332 00 0 00 005505'		SKIPE EOFSEN
  1624	002050'	254 00 0 00 002243'		JRST FRCEOF	;SHOULD HAVE BEEN A ZERO POINTER HERE
  1625	002051'	350 00 0 16 001022 		AOS SIZRIB(P4)	;COUNT 1
  1626	002052'	402 00 0 00 010747'		SETZM SPAROK	;NO SPARE AFTER A REAL ONE
  1627	002053'	607 01 0 00 200000 		TLNN T,RBREAL
  1628	002054'	254 00 0 00 002042'		JRST FILCNT
  1629	002055'	260 17 0 00 002103'		PUSHJ P,FILMKC	;MARK AND CHECK
  1630	002056'	254 00 0 00 002240'		 JRST PTRBD1	;ITS BAD
  1631	002057'	260 17 1 16 000004 		PUSHJ P,@ROUTIN(P4)	;CALL SPECIAL PROCESSOR
  1632	002060'	350 00 0 16 001023 		AOS ALCRIB(P4)
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 27-1
DSKCLN	MAC	30-Feb-73 19:40	

  1633	002061'	254 00 0 00 002042'		JRST FILCNT
  1634
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 28
DSKCLN	MAC	30-Feb-73 19:40	

  1635	002062'	336 00 0 00 010747'	SPRPTR:	SKIPN SPAROK
  1636	002063'	254 00 0 00 002241'		 JRST PTRBAD	;CAN NOT USE SPARE HERE
  1637	002064'	260 17 0 00 002103'		PUSHJ P,FILMKC
  1638	002065'	254 00 0 00 002241'		 JRST PTRBAD	;CAN NOT USE IF MULTIPLE ETC
  1639	002066'	260 17 0 00 004260'		PUSHJ P,RIBCHK
  1640	002067'	254 00 0 00 002241'		 JRST PTRBAD	;NOT A GOOD SPARE RIB
  1641	002070'	200 02 0 16 001005 		MOVE T1,DEVRSU(P4)
  1642	002071'	200 03 0 16 001004 		MOVE T2,SAVRIB+RIBSLF(P4)
  1643	002072'	312 03 0 00 777000 		CAME T2,BUF+RIBRIB
  1644	002073'	254 00 0 00 002241'		 JRST PTRBAD
  1645	002074'	275 02 0 16 000006 		SUBI T1,SAVRIB+1(P4)
  1646	002075'	553 00 0 00 000002 		HRRZS T1
  1647	002076'	312 02 0 00 777001 		CAME T1,BUF+RIBRPS
  1648	002077'	254 00 0 00 002241'		JRST PTRBAD
  1649	002100'	260 17 0 00 004314'		PUSHJ P,COPTR
  1650	002101'	350 00 0 16 001023 		AOS ALCRIB(P4)
  1651	002102'	254 00 0 00 002041'		JRST FILRBN	;GO
  1652
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 29
DSKCLN	MAC	30-Feb-73 19:40	

  1653					    ;SUBR TO SET THE F BIT FOR THE RETRIEVAL PNTR IN T, IN
  1654					    ;THE PTROST SATS.  FIRST CHECKS PTRTST AND PTRDST.
  1655
  1656	002103'	261 17 0 00 000001 	FILMKC:	PUSH P,T
  1657	002104'	200 02 0 00 000001 		MOVE T1,T
  1658	002105'	200 01 0 00 010736'		MOVE	T,PTRTST	;IS THIS BIT
  1659	002106'	260 17 0 00 004352'		PUSHJ	P,TSTZRO	;ALREADY KNOWN TO BE MUL USED?
  1660	002107'	254 00 0 00 002120'		JRST	MKNMLT		;NO.
  1661	002110'	476 00 0 00 006554'		SETOM	FILTRB		;YES.
  1662	002111'	476 00 0 00 010761'		SETOM	TRBFLG		;TROUBLE (MULTIPLE USED)
  1663	002112'	260 17 0 00 004543'		PUSHJ P,ISCRIT
  1664	002113'	332 00 0 00 006557'		SKIPE FIXFLG
  1665	002114'	254 00 0 00 002141'		JRST	TPOPJ		;JUST RETURN IF FIXING
  1666	002115'	256 04 0 00 014211'		ERRLEV (LEVBAD)^	XCT LEVBAD,[PUSHJ P,ERLSET]^
  1667	002116'	205 01 0 00 014265'		MOVSI T,[ASCIZ /MULTIPLY-USED CLUSTER/]
  1668	002117'	260 17 0 00 002147'		PUSHJ P,FREETR
  1669	002120'	200 02 0 17 000000 	MKNMLT:	MOVE T1,(P)
  1670	002121'	200 01 0 00 010727'		MOVE	T,PTRDST	;IS THIS BIT MARKED IN USE
  1671	002122'	260 17 0 00 004352'		PUSHJ	P,TSTZRO	;IN THE DISK SATS?
  1672	002123'	260 17 0 00 002143'		PUSHJ	P,FREE		;NO, MAYBE REPORT USED BUT NOT MARKED.
  1673	002124'	200 02 0 17 000000 		MOVE	T1,(P)		;YES.
  1674	002125'	200 01 0 00 010730'		MOVE	T,PTROST	;MARK THIS BIT IN USE
  1675	002126'	260 17 0 00 004365'		PUSHJ	P,MRKZRO	;IN OUR SATS.
  1676	002127'	334 00 0 00 000000 		SKIPA			;BAD NEWS, ALREADY IN USE.
  1677	002130'	254 00 0 00 002140'		JRST	TPOPJ1		;SUCCESS.
  1678	002131'	476 00 0 00 010761'		SETOM TRBFLG
  1679	002132'	476 00 0 00 006554'		SETOM FILTRB
  1680	002133'	200 02 0 17 000000 		MOVE T1,(P)
  1681	002134'	200 01 0 00 010736'		MOVE	T,PTRTST	;MARK THIS BIT IN THE MULTIPLY
  1682	002135'	260 17 0 00 004365'		PUSHJ	P,MRKZRO	;USED SATS.
  1683	002136'	255 00 0 00 000000 		 JFCL
  1684	002137'	334 00 0 00 000000 		SKIPA
  1685	002140'	350 00 0 17 777777 	TPOPJ1:	AOS -1(P)
  1686	002141'	262 17 0 00 000001 	TPOPJ:	POP P,T
  1687	002142'	263 17 0 00 000000 		POPJ P,
  1688
  1689
  1690	002143'	332 00 0 00 006557'	FREE:	SKIPE FIXFLG
  1691	002144'	263 17 0 00 000000 		POPJ P,		;NOTHING IF FIXING
  1692	002145'	205 01 0 00 014272'		MOVSI T,[ASCIZ /USED BUT NOT MARKED IN SAT/]
  1693	002146'	256 04 0 00 014211'		ERRLEV (LEVBAD)^	XCT LEVBAD,[PUSHJ P,ERLSET]^
  1694	002147'	541 01 0 16 001016 	FREETR:	HRRI T,ERRNAM(P4)
  1695	002150'	200 06 0 17 777777 		MOVE	N,-1(P)
  1696	002151'	254 00 0 00 003365'		JRST PRTRBL
  1697
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 30
DSKCLN	MAC	30-Feb-73 19:40	

  1698	002152'	331 03 0 16 001005 	RIBEOF:	SKIPL T2,DEVRSU(P4)
  1699	002153'	254 00 0 00 002157'		JRST RIBZEF		;OUT OF POINTERS, NONE TO ZERO
  1700	002154'	332 00 0 03 000000 		SKIPE  (T2)		;REMAINING MUST BE ZERO
  1701	002155'	254 00 0 00 002264'		JRST RIBNZF
  1702	002156'	253 03 0 00 002154'		AOBJN T2,.-2
  1703	002157'	200 02 0 16 000011 	RIBZEF:	MOVE T1,SAVRIB+RIBSFS(P4)
  1704	002160'	336 00 0 16 000005 		SKIPN SAVRIB+RIBRIB(P4)
  1705	002161'	200 02 0 16 000056 		MOVE T1,SAVRIB+RIBPFS(P4)
  1706	002162'	603 02 0 00 400000 		TLNE T1,RBSPAR
  1707	002163'	254 00 0 00 002167'		JRST RBEOF1	;FIRST IS A SPARE POINTER
  1708	002164'	201 03 0 00 000001 		MOVEI T2,1
  1709	002165'	312 03 0 16 000007 		CAME T2,SAVRIB+RIBSZS(P4)	;MUST BE 1
  1710	002166'	260 17 0 00 002252'		PUSHJ P,BADSZS
  1711	002167'	336 01 0 16 000005 	RBEOF1:	SKIPN T,SAVRIB+RIBRIB(P4)
  1712	002170'	254 00 0 00 002305'		JRST PRMRIB	;BACK TO PRIME RIB, CONTINUE
  1713	002171'	202 01 0 16 000000 		MOVEM T,RIBLBN(P4)
  1714	002172'	260 17 0 00 004260'		PUSHJ P,RIBCHK
  1715	002173'	254 00 0 00 004543'		JRST ISCRIT	;CALL IT A RIB ERROR
  1716	002174'	402 00 0 00 010747'		SETZM SPAROK	;UNLESS RESET BELOW
  1717	002175'	336 02 0 16 001002 		SKIPN T1,SAVRIB+RIBLST(P4)
  1718	002176'	476 00 0 00 005505'		SETOM EOFSEN	;EOF HAS BEEN SEEN
  1719	002177'	200 01 0 16 000007 		MOVE T,SAVRIB+RIBSZS(P4)
  1720	002200'	607 02 0 00 400000 		TLNN T1,RBSPAR
  1721	002201'	306 01 0 00 000001 		CAIN T,1
  1722	002202'	476 00 0 00 010747'		SETOM SPAROK	;SPARE POINTERS OK IN THIS CASE
  1723	002203'	200 02 0 16 000006 		MOVE T1,SAVRIB+RIBRPS(P4)
  1724	002204'	505 02 0 02 777003 		HRLI T1,-RIBLST(T1)
  1725	002205'	271 02 0 16 000006 		ADDI T1,SAVRIB+1(P4)
  1726	002206'	202 02 0 16 001005 		MOVEM T1,DEVRSU(P4)
  1727	002207'	275 02 0 16 000056 		SUBI T1,SAVRIB+RIBPFS(P4)
  1728	002210'	552 02 0 00 010746'		HRRZM T1,SAVSNM		;SAVE LAST SPARE RIB SEEN
  1729	002211'	261 17 0 16 000007 		PUSH P,SAVRIB+RIBSZS(P4)
  1730	002212'	260 17 0 00 004314'		PUSHJ P,COPTR
  1731	002213'	262 17 0 00 000003 		POP P,T2
  1732	002214'	221 03 0 00 000772 		IMULI T2,RBLVSR
  1733	002215'	312 03 0 16 000007 		CAME T2,SAVRIB+RIBSZS(P4)
  1734	002216'	260 17 0 00 002252'		PUSHJ P,BADSZS
  1735	002217'	254 00 0 00 002042'		JRST FILCNT		;AND GO
  1736
  1737	002220'	350 00 0 16 001022 	PTRBSB:	AOS SIZRIB(P4)
  1738	002221'	402 00 0 00 010747'		SETZM SPAROK
  1739	002222'	260 17 0 00 004543'		PUSHJ P,ISCRIT
  1740	002223'	336 00 0 00 006557'		SKIPN FIXFLG
  1741	002224'	254 00 0 00 002235'		JRST BDPMER
  1742	002225'	476 00 0 00 005507'		SETOM FILLOS
  1743	002226'	200 03 0 16 001005 		MOVE T2,DEVRSU(P4)
  1744	002227'	275 03 0 16 000006 		SUBI T2,1+SAVRIB(P4)
  1745	002230'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1746	002231'	263 17 0 00 000000 		 POPJ P,
  1747	002232'	201 04 0 00 000001 		MOVEI T3,1
  1748	002233'	202 04 0 03 777000 		MOVEM T3,BUF(T2)
  1749	002234'	263 17 0 00 000000 		POPJ P,
  1750
  1751	002235'	256 03 0 00 014211'	BDPMER:	ERRLEV (LEVCRS)^	XCT LEVCRS,[PUSHJ P,ERLSET]^
  1752	002236'	205 01 0 00 014300'		MOVSI T,[ASCIZ /BAD RETRIEVAL POINTER/]
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 30-1
DSKCLN	MAC	30-Feb-73 19:40	

  1753	002237'	254 00 0 00 002451'		JRST FLRERR
  1754
  1755	002240'	370 00 0 16 001022 	PTRBD1:	SOS SIZRIB(P4)
  1756	002241'	260 17 0 00 002220'	PTRBAD:	PUSHJ P,PTRBSB
  1757	002242'	254 00 0 00 002042'		JRST FILCNT
  1758
  1759	002243'	200 03 0 16 001005 	FRCEOF:	MOVE T2,DEVRSU(P4)
  1760	002244'	275 03 0 00 000001 		SUBI T2,1	;POINT AT ONE WHICH SHOULD BE ZERO
  1761	002245'	254 00 0 00 002264'		JRST RIBNZF	;AND GO ZERO THEM
  1762
  1763	002246'	256 03 0 00 014211'	EOFERM:	ERRLEV (LEVCRS)^	XCT LEVCRS,[PUSHJ P,ERLSET]^
  1764	002247'	205 01 0 00 014305'		MOVSI T,[ASCIZ /SHOULD HAVE FOUND EOF/]
  1765	002250'	260 17 0 00 002451'		PUSHJ P,FLRERR
  1766	002251'	254 00 0 00 002152'		JRST RIBEOF
  1767
  1768	002252'	202 03 0 16 000007 	BADSZS:	MOVEM T2,SAVRIB+RIBSZS(P4)
  1769	002253'	336 00 0 00 006557'		SKIPN FIXFLG
  1770	002254'	254 00 0 00 002261'		JRST SZSERM
  1771	002255'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1772	002256'	263 17 0 00 000000 		 POPJ P,
  1773	002257'	202 03 0 00 777002 		MOVEM T2,BUF+RIBSZS
  1774	002260'	263 17 0 00 000000 		POPJ P,
  1775
  1776	002261'	256 03 0 00 014211'	SZSERM:	ERRLEV (LEVCRS)^	XCT LEVCRS,[PUSHJ P,ERLSET]^
  1777	002262'	205 01 0 00 014312'		MOVSI T,[ASCIZ /BAD RIBSZS/]
  1778	002263'	254 00 0 00 002451'		JRST FLRERR
  1779
  1780	002264'	402 00 0 03 000000 	RIBNZF:	SETZM (T2)	;ZERO EXTRA POINTERS T2 IS POINTER
  1781	002265'	504 01 0 00 000003 		HRL T,T2
  1782	002266'	541 01 0 03 000001 		HRRI T,1(T2)
  1783	002267'	275 03 0 16 000005 		SUBI T2,SAVRIB(P4)
  1784	002270'	302 03 0 00 000775 		CAIE T2,RIBLST
  1785	002271'	251 01 0 16 001002 		BLT T,SAVRIB+RIBLST(P4)	;NO BLT IF AT END
  1786	002272'	336 00 0 00 006557'		SKIPN FIXFLG
  1787	002273'	254 00 0 00 002246'		JRST EOFERM
  1788	002274'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1789	002275'	254 00 0 00 002152'		 JRST RIBEOF	;WILL FIND IT ZERO NOW
  1790	002276'	402 00 0 03 777000 		SETZM BUF(T2)
  1791	002277'	306 03 0 00 000775 		CAIN T2,RIBLST
  1792	002300'	263 17 0 00 000000 		POPJ P,		;DO NOT OVERFLOW ON BLT
  1793	002301'	505 03 0 03 777000 		HRLI T2,BUF(T2)
  1794	002302'	271 03 0 00 777001 		ADDI T2,BUF+1
  1795	002303'	251 03 0 00 777775 		BLT T2,BUF+RIBLST
  1796	002304'	263 17 0 00 000000 		POPJ P,
  1797
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 31
DSKCLN	MAC	30-Feb-73 19:40	

  1798
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 32
DSKCLN	MAC	30-Feb-73 19:40	

  1799	002305'	350 00 0 17 000000 	PRMRIB:	AOS (P)
  1800	002306'	201 01 0 00 000000 		MOVEI T,0
  1801	002307'	260 17 1 16 000004 		PUSHJ P,@ROUTIN(P4)	;DONE
  1802	002310'	260 17 0 00 002313'		PUSHJ	P,PRMRB1
  1803	002311'	201 01 0 16 001013 		MOVEI T,FIXRBP(P4)
  1804	002312'	254 00 0 00 004662'		JRST ADDTOT
  1805
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 33
DSKCLN	MAC	30-Feb-73 19:40	

  1806					COMMENT #
  1807					@@SUBROUTINE PRMRB1/PRMRB2
  1808					@@PURPOSE
  1809					SUBRS TO CHECK MANY NON-RETRIEVAL PNTR THINGS ABOUT THE PRIME
  1810					RIB, SUCH AS DATE, TIME, ALP, ETC.
  1811					@@ENTRY
  1812					THERE ARE TWO ENTRY POINTS, PRMRB1 AND PRMRB2.
  1813					EXPECTS THE RIB TO BE IN SAVRIB(P4).
  1814					@@ACCUM
  1815					@@EXIT
  1816					@@ #
  1817
  1818	002313'	200 14 0 16 000002 	PRMRB1:	MOVE P2,UFDPTR(P4)	;WHERE WE SAVED IT
  1819	002314'	550 01 0 14 000003 		HRRZ T,UFDLIC(P2)
  1820	002315'	550 03 0 16 000024 		HRRZ T2,SAVRIB+RIBLCW(P4)
  1821	002316'	312 01 0 00 000003 		CAME T,T2	;LICENSE FIELDS SHOULD MATCH
  1822	002317'	260 17 0 00 002441'		PUSHJ P,BADLIC	;BUT DO NOT
  1823	002320'	135 01 0 00 014315'		LDB T,[POINT 9,UFDPRV(P2),35]
  1824	002321'	135 03 0 00 014316'		LDB T2,[POINT 9,SAVRIB+RIBPVW(P4),8]
  1825	002322'	312 01 0 00 000003 		CAME T,T2	;CHECK PROTECTION FIELD
  1826	002323'	260 17 0 00 002454'		PUSHJ P,BADPRV
  1827	002324'	135 03 0 00 014317'		LDB T2,[POINT 11,SAVRIB+RIBPVW(P4),23]	;MIN
  1828	002325'	221 03 0 00 000074 		IMULI T2,^D60
  1829	002326'	135 02 0 00 014320'		LDB T1,[POINT 6,SAVRIB+RIBLCW(P4),17]	;SEC
  1830	002327'	270 03 0 00 000002 		ADD T2,T1
  1831	002330'	135 01 0 00 014321'		LDB T,[POINT 17,UFDTMD(P2),23]	;NOW FROM UFD
  1832	002331'	312 01 0 00 000003 		CAME T,T2
  1833	002332'	260 17 0 00 002472'		PUSHJ P,BADTIM
  1834	002333'	135 01 0 00 014322'		LDB T,[POINT 12,UFDTMD(P2),35]
  1835	002334'	135 02 0 00 014323'		LDB T1,[POINT 2,UFDTMD(P2),6]	;EXTRA 2 BITS
  1836	002335'	137 02 0 00 014324'		DPB T1,[POINT 2,T,23]
  1837	002336'	135 03 0 00 014325'		LDB T2,[POINT 12,SAVRIB+RIBPVW(P4),35]
  1838	002337'	135 02 0 00 014326'		LDB T1,[POINT 2,SAVRIB+RIBEXT(P4),21]
  1839	002340'	137 02 0 00 014327'		DPB T1,[POINT 2,T2,23]
  1840	002341'	312 01 0 00 000003 		CAME T,T2	;CHECK DATE
  1841	002342'	260 17 0 00 002502'		PUSHJ P,BADDAT
  1842	002343'	200 01 0 14 000001 		MOVE	T,UFDUF2(P2)
  1843	002344'	200 05 0 16 000024 		MOVE	T4,SAVRIB+RIBLCW(P4)
  1844	002345'	336 00 0 00 006557'		SKIPN	FIXFLG		;IN CHECK MODE ONLY REPORT
  1845	002346'	254 00 0 00 002365'		JRST	MODCL1		; DIFFERENCES IN MOD BIT IN UFD AND RIB
  1846	002347'	606 01 0 00 020000 		TRNN	T,UFPALC	;IS UFD MOD BIT SET?
  1847	002350'	254 00 0 00 002356'		JRST	MODCL2		;NO
  1848	002351'	260 17 0 00 002464'		PUSHJ	P,SETUFX	;INSERT UFD FIX UP ENTRY
  1849	002352'	254 00 0 00 002356'		 JRST	MODCL2
  1850	002353'	201 03 0 00 020000 		MOVEI	T2,UFPALC	;CLEAR UFD FILE
  1851	002354'	412 03 0 04 777001 		ANDCAM	T2,BUF+UFDUF2(T3)	; RECENTLY MOD BIT
  1852	002355'	263 17 0 00 000000 		POPJ	P,
  1853	002356'	607 05 0 00 002000 	MODCL2:	TLNN	T4,RIPALC	;IS RIB FILE MODE BIT SET?
  1854	002357'	254 00 0 00 002375'		JRST	PRMRB0		;NO
  1855	002360'	260 17 0 00 002543'		PUSHJ	P,FILFIX	;INSERT FILE FIX UP ENTRY
  1856	002361'	254 00 0 00 002375'		 JRST	PRMRB0
  1857	002362'	205 03 0 00 002000 		MOVSI	T2,RIPALC	;CLEAR FILE RIB RECENTLY
  1858	002363'	412 03 0 00 777017 		ANDCAM	T2,BUF+RIBLCW	; MOD BIT
  1859	002364'	263 17 0 00 000000 		POPJ	P,
  1860	002365'	242 01 0 00 000017 	MODCL1:	LSH	T,^L<UFPALC>-<^L<RIPALC>-^D18>	;ARE BOTH
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 33-1
DSKCLN	MAC	30-Feb-73 19:40	

  1861	002366'	430 01 0 00 000005 		XOR	T,T4		; FILE RIB AND UFD FILE RECENTLY MOD
  1862	002367'	607 01 0 00 002000 		TLNN	T,RIPALC	; BITS SET OR CLEAR?
  1863	002370'	254 00 0 00 002375'		JRST	PRMRB0		;YES
  1864	002371'	515 01 0 00 014330'		HRLZI	T,[ASCIZ /ONLY UFPALC SET/]
  1865	002372'	603 05 0 00 002000 		TLNE	T4,RIPALC
  1866	002373'	515 01 0 00 014334'		HRLZI	T,[ASCIZ /ONLY RIPALC SET/]
  1867	002374'	260 17 0 00 002450'		PUSHJ	P,FLMERR	;OUTPUT ERROR MSG
  1868	002375'	135 01 0 00 014340'	PRMRB0:	LDB	T,[POINT 9,UFDPRV(P2),26]
  1869	002376'	620 01 0 00 000020 		TRZ	T,UFPALC_-<^D35-^D26>	;IGNORE UFPALC
  1870	002377'	135 03 0 00 014341'		LDB	T2,[POINT 8,SAVRIB+RIBLCW(P4),11]
  1871	002400'	620 03 0 00 000020 		TRZ	T2,RIPALC_-<^D17-^D11>	;IGNORE RIPALC
  1872	002401'	312 01 0 00 000003 		CAME T,T2
  1873	002402'	260 17 0 00 002514'		PUSHJ P,BADBT1	;WRONG BITS
  1874	002403'	135 01 0 00 014342'		LDB T,[POINT 5,UFDTMD(P2),4]
  1875	002404'	135 03 0 00 014343'		LDB T2,[POINT 4,SAVRIB+RIBLCW(P4),3]
  1876	002405'	312 01 0 00 000003 		CAME T,T2
  1877	002406'	260 17 0 00 002524'		PUSHJ P,BADBT2
  1878	002407'	200 03 0 16 001023 		MOVE T2,ALCRIB(P4)
  1879	002410'	301 03 0 00 400000 		CAIL T2,400000
  1880	002411'	201 03 0 00 400000 		MOVEI T2,400000		;THE FUNNY 18-BIT TRUNCATION
  1881	002412'	554 02 0 14 000003 		HLRZ T1,UFDALC(P2)
  1882	002413'	312 02 0 00 000003 		CAME T1,T2
  1883	002414'	260 17 0 00 002602'		PUSHJ P,BADALU
  1884	002415'	260 17 0 00 004535'	PRMRB2:	PUSHJ P,ISUFD	;SKIP IF UFD
  1885	002416'	634 01 0 00 000001 		TDZA T,T
  1886	002417'	201 01 0 00 400000 		MOVEI T,RIPDIR
  1887	002420'	430 01 0 16 000027 		XOR T,SAVRIB+RIBSTS(P4)	;MAKE SURE DIR BIT CORRECT
  1888	002421'	602 01 0 00 400000 		TRNE T,RIPDIR
  1889	002422'	260 17 0 00 002534'		PUSHJ P,BADDIR
  1890	002423'	200 03 0 16 001023 		MOVE T2,ALCRIB(P4)
  1891	002424'	312 03 0 16 000043 		CAME T2,SAVRIB+RIBALP(P4)
  1892	002425'	260 17 0 00 002560'		PUSHJ P,BADALP		;WRONG NUMBER OF PAGES ALLOCATED
  1893	002426'	200 02 0 16 000015 		MOVE T1,SAVRIB+RIBSIZ(P4)
  1894	002427'	622 02 0 00 000777 		TRZE T1,777
  1895	002430'	271 02 0 00 001000 		ADDI T1,1000	;ONLY KNOW TO PAGES
  1896	002431'	200 03 0 16 001022 		MOVE T2,SIZRIB(P4)
  1897	002432'	242 03 0 00 000011 		LSH T2,9	;CONVERT PAGES TO WORDS
  1898	002433'	315 03 0 00 000002 		CAMGE T2,T1
  1899	002434'	260 17 0 00 002571'		PUSHJ P,BADSIZ
  1900	002435'	200 03 0 00 010746'		MOVE T2,SAVSNM
  1901	002436'	312 03 0 16 000010 		CAME T2,SAVRIB+RIBSNM(P4)
  1902	002437'	260 17 0 00 002550'		PUSHJ P,BADSNM
  1903	002440'	263 17 0 00 000000 		POPJ P,		;ALL DONE
  1904
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 34
DSKCLN	MAC	30-Feb-73 19:40	

  1905					;HERE FOR THE VARIOUS ERRORS
  1906
  1907	002441'	336 00 0 00 006557'	BADLIC:	SKIPN FIXFLG
  1908	002442'	254 00 0 00 002447'		JRST LICERM
  1909	002443'	260 17 0 00 002464'		PUSHJ P,SETUFX
  1910	002444'	263 17 0 00 000000 		 POPJ P,
  1911	002445'	542 03 0 04 777003 		HRRM T2,BUF+UFDLIC(T3)	;SET LICENSE WHEN FIXING
  1912	002446'	263 17 0 00 000000 		POPJ P,
  1913
  1914	002447'	515 01 0 00 014344'	LICERM:	HRLZI T,[ASCIZ /WRONG UFD LICENSE/]
  1915	002450'	256 01 0 00 014211'	FLMERR:	ERRLEV (LEVMIN)^	XCT LEVMIN,[PUSHJ P,ERLSET]^
  1916	002451'	200 06 0 16 000000 	FLRERR:	MOVE N,RIBLBN(P4)
  1917	002452'	541 01 0 16 001016 		HRRI T,ERRNAM(P4)
  1918	002453'	254 00 0 00 003365'		JRST PRTRBL
  1919
  1920	002454'	336 00 0 00 006557'	BADPRV:	SKIPN FIXFLG
  1921	002455'	254 00 0 00 002462'		JRST PRVERM
  1922	002456'	260 17 0 00 002464'		PUSHJ P,SETUFX
  1923	002457'	263 17 0 00 000000 		 POPJ P,
  1924	002460'	137 03 0 00 014350'		DPB T2,[POINT 9,BUF+UFDPRV(T3),35]
  1925	002461'	263 17 0 00 000000 		POPJ P,
  1926
  1927	002462'	515 01 0 00 014351'	PRVERM:	HRLZI T,[ASCIZ /WRONG UFD PROTECTION/]
  1928	002463'	254 00 0 00 002450'		JRST FLMERR
  1929
  1930	002464'	554 02 0 00 000016 	SETUFX:	HLRZ T1,P4	;GET PLACE CALLED FROM
  1931	002465'	201 01 0 02 001010 		MOVEI T,UFDBKF(T1)
  1932	002466'	200 04 0 00 000014 		MOVE T3,P2
  1933	002467'	274 04 0 02 000003 		SUB T3,UFDOGP(T1)
  1934	002470'	200 02 0 02 000001 		MOVE T1,NXTPTR(T1)	;THE PLACE TO FIX
  1935	002471'	254 00 0 00 004640'		JRST ADDFIX
  1936
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 35
DSKCLN	MAC	30-Feb-73 19:40	

  1937	002472'	336 00 0 00 006557'	BADTIM:	SKIPN FIXFLG
  1938	002473'	254 00 0 00 002500'		JRST TIMERM
  1939	002474'	260 17 0 00 002464'		PUSHJ P,SETUFX
  1940	002475'	263 17 0 00 000000 		 POPJ P,
  1941	002476'	137 03 0 00 014356'		DPB T2,[POINT 17,BUF+UFDTMD(T3),23]
  1942	002477'	263 17 0 00 000000 		POPJ P,
  1943
  1944	002500'	515 01 0 00 014357'	TIMERM:	HRLZI T,[ASCIZ /WRONG UFD TIME/]
  1945	002501'	254 00 0 00 002450'		JRST FLMERR
  1946
  1947	002502'	336 00 0 00 006557'	BADDAT:	SKIPN FIXFLG
  1948	002503'	254 00 0 00 002512'		JRST DATERM
  1949	002504'	260 17 0 00 002464'		PUSHJ P,SETUFX
  1950	002505'	263 17 0 00 000000 		 POPJ P,
  1951	002506'	137 03 0 00 014362'		DPB T2,[POINT 12,BUF+UFDTMD(T3),35]
  1952	002507'	242 03 0 00 777764 		LSH T2,-^D12		;NOW HIGH ORDER 2 BITS
  1953	002510'	137 03 0 00 014363'		DPB T2,[POINT 2,BUF+UFDTMD(T3),6]
  1954	002511'	263 17 0 00 000000 		POPJ P,
  1955
  1956	002512'	515 01 0 00 014364'	DATERM:	HRLZI T,[ASCIZ /WRONG UFD DATE/]
  1957	002513'	254 00 0 00 002450'		JRST FLMERR
  1958
  1959	002514'	336 00 0 00 006557'	BADBT1:	SKIPN FIXFLG
  1960	002515'	254 00 0 00 002522'		JRST BT1ERM
  1961	002516'	260 17 0 00 002464'		PUSHJ P,SETUFX
  1962	002517'	263 17 0 00 000000 		 POPJ P,
  1963	002520'	137 03 0 00 014367'		DPB T2,[POINT 9,BUF+UFDPRV(T3),26]
  1964	002521'	263 17 0 00 000000 		POPJ P,
  1965
  1966	002522'	515 01 0 00 014370'	BT1ERM:	HRLZI T,[ASCIZ /WRONG UFD BITS1/]
  1967	002523'	254 00 0 00 002450'		JRST FLMERR
  1968
  1969	002524'	336 00 0 00 006557'	BADBT2:	SKIPN FIXFLG
  1970	002525'	254 00 0 00 002532'		JRST BT2ERM
  1971	002526'	260 17 0 00 002464'		PUSHJ P,SETUFX
  1972	002527'	263 17 0 00 000000 		 POPJ P,
  1973	002530'	137 03 0 00 014374'		DPB T2,[POINT 5,BUF+UFDTMD(T3),4]
  1974	002531'	263 17 0 00 000000 		POPJ P,
  1975
  1976	002532'	515 01 0 00 014375'	BT2ERM:	HRLZI T,[ASCIZ /WRONG UFD BITS2/]
  1977	002533'	254 00 0 00 002450'		JRST FLMERR
  1978
  1979	002534'	336 00 0 00 006557'	BADDIR:	SKIPN FIXFLG
  1980	002535'	254 00 0 00 002546'		JRST DIRERM
  1981	002536'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1982	002537'	263 17 0 00 000000 		 POPJ P,
  1983	002540'	201 03 0 00 400000 		MOVEI T2,RIPDIR
  1984	002541'	432 03 0 00 777022 		XORM T2,BUF+RIBSTS
  1985	002542'	263 17 0 00 000000 		POPJ P,
  1986
  1987	002543'	201 01 0 16 001013 	FILFIX:	MOVEI T,FIXRBP(P4)
  1988	002544'	200 02 0 16 000000 		MOVE T1,RIBLBN(P4)
  1989	002545'	254 00 0 00 004640'		JRST ADDFIX
  1990
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 36
DSKCLN	MAC	30-Feb-73 19:40	

  1991	002546'	515 01 0 00 014401'	DIRERM:	HRLZI T,[ASCIZ /RIPDIR SET WRONG/]
  1992	002547'	254 00 0 00 002450'		JRST FLMERR
  1993
  1994	002550'	336 00 0 00 006557'	BADSNM:	SKIPN FIXFLG
  1995	002551'	254 00 0 00 002556'		JRST SNMERM
  1996	002552'	260 17 0 00 002543'		PUSHJ P,FILFIX
  1997	002553'	263 17 0 00 000000 		 POPJ P,
  1998	002554'	202 03 0 00 777003 		MOVEM T2,BUF+RIBSNM
  1999	002555'	263 17 0 00 000000 		POPJ P,
  2000
  2001	002556'	205 01 0 00 014405'	SNMERM:	MOVSI T,[ASCIZ /NUMBER OF SUBRIBS WRONG/]
  2002	002557'	254 00 0 00 002450'		JRST FLMERR
  2003
  2004	002560'	336 00 0 00 006557'	BADALP:	SKIPN FIXFLG
  2005	002561'	254 00 0 00 002566'		JRST ALCERM
  2006	002562'	260 17 0 00 002543'		PUSHJ P,FILFIX
  2007	002563'	263 17 0 00 000000 		 POPJ P,
  2008	002564'	202 03 0 00 777036 		MOVEM T2,BUF+RIBALP
  2009	002565'	263 17 0 00 000000 		POPJ P,
  2010
  2011	002566'	205 01 0 00 014412'	ALCERM:	MOVSI T,[ASCIZ /ALLOCATION WRONG/]
  2012	002567'	256 03 0 00 014211'		ERRLEV (LEVCRS)^	XCT LEVCRS,[PUSHJ P,ERLSET]^
  2013	002570'	254 00 0 00 002451'		JRST FLRERR
  2014
  2015	002571'	336 00 0 00 006557'	BADSIZ:	SKIPN FIXFLG
  2016	002572'	254 00 0 00 002577'		JRST SIZERM
  2017	002573'	260 17 0 00 002543'		PUSHJ P,FILFIX
  2018	002574'	263 17 0 00 000000 		 POPJ P,
  2019	002575'	202 03 0 00 777010 		MOVEM T2,BUF+RIBSIZ
  2020	002576'	263 17 0 00 000000 		POPJ P,
  2021
  2022	002577'	205 01 0 00 014416'	SIZERM:	MOVSI T,[ASCIZ /SIZE WRITTEN WRONG/]
  2023	002600'	256 03 0 00 014211'		ERRLEV (LEVCRS)^	XCT LEVCRS,[PUSHJ P,ERLSET]^
  2024	002601'	254 00 0 00 002451'		JRST FLRERR
  2025
  2026	002602'	336 00 0 00 006557'	BADALU:	SKIPN FIXFLG
  2027	002603'	254 00 0 00 002610'		JRST ALUERM
  2028	002604'	260 17 0 00 002464'		PUSHJ P,SETUFX
  2029	002605'	263 17 0 00 000000 		 POPJ P,
  2030	002606'	506 03 0 04 777003 		HRLM T2,BUF+UFDALC(T3)
  2031	002607'	263 17 0 00 000000 		POPJ P,
  2032
  2033	002610'	205 01 0 00 014422'	ALUERM:	MOVSI T,[ASCIZ /UFD ALLOCATION MISMATCH/]
  2034	002611'	254 00 0 00 002450'		JRST FLMERR
  2035
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 37
DSKCLN	MAC	30-Feb-73 19:40	

  2036					;SPECIAL PROCESSING ROUTINES FOR CERTAIN FILES
  2037
  2038					;SYSPRC==CRTERR
  2039	002612'	201 00 0 00 014427'	SYSPRC:	MOVEI	M,[ASCIZ /RIB POINTER TO (SYS) FOUND IN MFD/]
  2040	002613'	254 00 0 00 003744'		JRST	CRTERR
  2041
  2042					;MFDPC1==CRTERR
  2043	002614'	201 00 0 00 014436'	MFDPC1:	MOVEI	M,[ASCIZ /RIB POINTER TO MFD FOUND IN MFD/]
  2044	002615'	254 00 0 00 003744'		JRST	CRTERR
  2045
  2046	002616'	476 00 0 00 010745'	SATPRC:	SETOM SATRIB
  2047	002617'	263 17 0 00 000000 		POPJ P,
  2048
  2049					;HOME.SYS FILE.  CHECK THE RIB AGAINST OUR IMPRESSION OF WHAT IT SHOULD
  2050					; BE.  ITS RIB IS CREATED BY THE CODE IN REFSTR @ INISA5+2, FF.
  2051					;THE TWO HOME PAGES ARE ALLOCATED FIRST, NEXT THE BAT PAGES,
  2052					; AND THEN THE BOOTSTRAP AREA.  IN KA,I,L SYSTEMS THE BOOTSTRAP
  2053					; AREA IS 3 PAGES LONG.  IN KS SYSTEMS IT IS 100 PAGES LONG.
  2054	002620'	201 02 0 00 002640'	HOMPRC:	MOVEI T1,HOMRTN
  2055	002621'	202 02 0 16 000004 		MOVEM T1,ROUTIN(P4)
  2056	002622'	202 01 0 00 010742'		MOVEM T,RTNIDX#		;SAVE IN CASE OF ERROR
  2057	002623'	402 00 0 00 010744'		SETZM RTNUNI#
  2058	002624'	476 00 0 00 010743'		SETOM RTNPAG#		;GET STARTED
  2059	002625'	554 02 0 00 005472'		HLRZ T1,CHRBUF+.CHBSA	;COMPUTE SIZE OF HOME FILE.
  2060	002626'	271 02 0 00 000005 		ADDI T1,HTL		;PAGE 0, HP1, HP2, BP1, BP2
  2061	002627'	202 02 0 00 006566'		MOVEM T1,HFSIZ#
  2062	002630'	263 17 0 00 000000 		POPJ P,
  2063
  2064	002631'	476 00 0 00 010743'	HOMRTU:	SETOM RTNPAG
  2065	002632'	350 12 0 00 010744'		AOS U,RTNUNI		;NEXT UNIT
  2066	002633'	317 12 0 00 006570'		CAMG U,HIGHU		;END?
  2067	002634'	254 00 0 00 002640'		 JRST HOMRTN		;NO
  2068	002635'	326 01 0 00 002654'		JUMPN T,CRTIDX		;J-NOT EOF SO ERROR.
  2069	002636'	476 00 0 00 006571'		SETOM HOMRIB
  2070	002637'	263 17 0 00 000000 		POPJ P,
  2071
  2072	002640'	350 02 0 00 010743'	HOMRTN:	AOS T1,RTNPAG
  2073	002641'	311 02 0 00 006566'		CAML T1,HFSIZ
  2074	002642'	254 00 0 00 002631'		 JRST HOMRTU		;FINISHED WITH THIS UNIT
  2075	002643'	301 02 0 00 000005 		CAIL T1,HTL
  2076						 JRST [	ADD T1,CHRBUF+.CHBSA	;HOMLTB+N -> RH(.CHBSA)+N, N>=0
  2077							SUBI T1,HTL
  2078							HRRZS T1
  2079	002644'	254 00 0 00 014445'			JRST HOMRT1]
  2080	002645'	305 02 0 00 000005 		CAIGE T1,HTL
  2081	002646'	256 00 0 02 002656'		 XCT HOMTBL(T1)
  2082	002647'	200 12 0 00 010744'	HOMRT1:	MOVE U,RTNUNI
  2083	002650'	137 12 0 00 014451'		DPB U,[POINT PTSUNI,T1,PTNUNI]
  2084	002651'	661 02 0 00 200000 		TLO T1,RBREAL
  2085	002652'	316 02 0 00 000001 		CAMN T1,T
  2086	002653'	263 17 0 00 000000 		 POPJ P,		;THIS ONE IS OK
  2087	002654'	200 01 0 00 010742'	CRTIDX:	MOVE T,RTNIDX
  2088	002655'	254 00 0 00 003744'		JRST CRTERR		;ERROR
  2089
  2090	002656'	400 02 0 00 000000 	HOMTBL:	SETZ T1,
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 37-1
DSKCLN	MAC	30-Feb-73 19:40	

  2091	002657'	554 02 0 00 005470'		HLRZ T1,CHRBUF+.CHHA
  2092	002660'	550 02 0 00 005470'		HRRZ T1,CHRBUF+.CHHA
  2093	002661'	554 02 0 00 005471'		HLRZ T1,CHRBUF+.CHBA
  2094	002662'	550 02 0 00 005471'		HRRZ T1,CHRBUF+.CHBA
  2095			000005		HTL==.-HOMTBL
  2096
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 38
DSKCLN	MAC	30-Feb-73 19:40	

  2097					repeat 0,<			; removed by edit 35
  2098					SWPPRC:	MOVEI T1,SWPRTN
  2099						MOVEM T1,ROUTIN(P4)
  2100						MOVEM T,RTNIDX
  2101						SETZM RTNCNT#
  2102						SETOM RTNUNI
  2103						POPJ P,
  2104					
  2105					SWPRTU:	AOS U,RTNUNI
  2106						CAMLE U,HIGHU
  2107						JRST SWPEOF
  2108						SKIPN T1,@PTRSWP
  2109						JRST SWPRTU	;NO SPACE ON THIS UNIT
  2110						MOVEM T1,RTNCNT
  2111						MOVE T1,@PTRSWB
  2112						MOVEM T1,RTNPAG
  2113					SWPRTN:	SOSGE RTNCNT
  2114						JRST SWPRTU
  2115						MOVE T1,RTNPAG
  2116						MOVE U,RTNUNI
  2117						DPB U,[POINT PTSUNI,T1,PTNUNI]
  2118						TLO T1,RBREAL
  2119						CAME T1,T
  2120						JRST CRTIDX
  2121						AOS RTNPAG
  2122						POPJ P,
  2123					
  2124					SWPEOF:	JUMPN T,CRTIDX
  2125						SETOM SWPRIB
  2126						POPJ P,
  2127					>; end repeat 0
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 39
DSKCLN	MAC	30-Feb-73 19:40	

  2128					;TABLES USED BY VARIOUS ROUTINES
  2129
  2130					;POINTERS TO VARIOUS PER UNIT TABLES
  2131					;[37] note that the loop at CREUNT makes all these be indexed
  2132					;[37] pointers with U as the indexing register.
  2133
  2134	002663'	000000	010727'		UNITAB:	PTRDST#		;DISK SATS
  2135	002664'	000000	010736'			PTRTST#		;TROUBLE SATS (FOR MULTIPLY USED PAGES)
  2136	002665'	000000	010730'			PTROST#		;OUR SAT (CREATED BY DSKCLN)
  2137	002666'	000000	010733'			PTRSAD#		;SAT ADDRESSES
  2138	002667'	000000	010737'			PTRUNU#		;UNIT IN USE 
  2139							;[37] PTRUNU now contains the disk page number if a
  2140							;[37] map/pre-ref has been done on this unit and the
  2141							;[37] page in question has not made it to BUF yet.
  2142							;[37] otherwise, it contains zero.
  2143	002670'	000000	010740'			ptrupg#		;[37] "disk cache" page associated with unit
  2144								;[37] for map/pre-ref
  2145	002671'	000000	010731'			ptrpge#		;[37] zero if no hardware error detected
  2146								;[37] -1 if hardware error detected during pre-ref
  2147	002672'	000000	010735'			PTRSWP#		;NUMBER OF K FOR SWAPPING ON UNIT
  2148	002673'	000000	010734'			PTRSWB#		;FIRST BLOCK FOR SWAPPING
  2149			000011		UNTLEN==.-UNITAB
  2150
  2151					;USED TO READ AND CHECK INFORMATION IN HOME BLOCKS
  2152
  2153	002674'	010753'	000016		HOMTAB:	STROVR#,,HOMOVR	;OVERDRAW
  2154	002675'	010745'	000017			SATRIB#,,HOMSAT	;SAT.SYS RIB
  2155	002676'	006571'	000020			HOMRIB#,,HOMHMS	;HOME.SYS RIB
  2156	002677'	010755'	000021			SWPRIB#,,HOMSWP	;SWAP.SYS RIB
  2157	002700'	010756'	000023			SYSRIB#,,HOMSUF	;SYS UFD RIB
  2158	002701'	007603'	000025			MFDRIB+RIBLBN,,HOMMFD	;1,1.UFD RIB
  2159	002702'	010751'	000027			STRHSH#,,HOMHSH		;HASH FOR UFD
  2160			000007		HOMTLN==.-HOMTAB
  2161
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 40
DSKCLN	MAC	30-Feb-73 19:40	

  2162					;TABLE TO USE IN SETTING UP SATS
  2163
  2164	002703'	000020	010727'		SATTAB:	@PTRDST		;DISK SAT
  2165	002704'	000020	010736'			@PTRTST		;TROUBLE SAT (MULIPLY USED PAGES)
  2166	002705'	000020	010730'			@PTROST		;OUR SAT (THE ONE WE ARE CREATING)
  2167			000003		STBLEN==.-SATTAB
  2168
  2169					;ERROR MESSAGES AFTER DSKRAT
  2170
  2171	002706'				ERRTAB:	[ASCIZ /
  2172	002706'	000000	014452'		NO DISK PROBLEMS/]
  2173						[ASCIZ /
  2174	002707'	000000	014456'		ONLY MINOR ERRORS DETECTED. OK TO BRING SYSTEM UP FOR USERS/]
  2175						[ASCIZ /
  2176					ERRORS DETECTED WHICH MAY BE SERIOUS TO INDIVIDUAL USERS.
  2177	002710'	000000	014473'		SHOULD NOT KILL SYSTEM/]
  2178						[ASCIZ /
  2179					ERRORS DETECTED WHICH MAY CAUSE SYSTEM CRASHES. SUGGEST FIXING
  2180	002711'	000000	014514'		ERRORS BEFORE BRING SYSTEM UP FOR USERS/]
  2181						[ASCIZ /
  2182					ERRORS DETECTED WHICH MAY CAUSE SEVERE DISK GARBAGING. DO NOT
  2183	002712'	000000	014542'		BRING SYSTEM UP FOR USERS UNTIL ERRORS ARE FIXED/]
  2184						REPEAT 20+ERRTAB-.,<[0]>
  2185	002713'	000000	014057'		[0]
  2186	002714'	000000	014057'		[0]
  2187	002715'	000000	014057'		[0]
  2188	002716'	000000	014057'		[0]
  2189	002717'	000000	014057'		[0]
  2190	002720'	000000	014057'		[0]
  2191	002721'	000000	014057'		[0]
  2192	002722'	000000	014057'		[0]
  2193	002723'	000000	014057'		[0]
  2194	002724'	000000	014057'		[0]
  2195	002725'	000000	014057'		[0]
  2196
  2197	002726'	000020	010727'		LOSTAB:	@PTRDST	;FIRST SAT TO USE
  2198	002727'	000020	010730'			@PTROST	;SECOND SAT TO USE
  2199	002730'	000000	002741'			NOLOS	;NO LOST PAGES MESSAGE
  2200	002731'	000000	002756'			HEDLOS	;HEADER FOR LOST PAGES
  2201	002732'	000000	002774'			TOTLOS	;TOTAL LOST MESSAGE
  2202						ERRLEV (LEVMIN)^	;PUSHJ HERE TO SET ERROR LEVEL
  2203	002733'	256 01 0 00 014211'		XCT LEVMIN,[PUSHJ P,ERLSET]
  2204	002734'	263 17 0 00 000000 		POPJ P,
  2205	002735'	612 02 0 05 000000 		TDNE T1,(T4)	;PUSHJ HERE TO TEST FOR LOST. IN OUR SAT?
  2206	002736'	612 02 0 04 000000 		TDNE T1,(T3)	;NO, IN DISK SAT?
  2207	002737'	263 17 0 00 000000 		POPJ P,	;IN OURS OR IN NEITHER
  2208	002740'	254 00 0 00 004027'		JRST CPOPJ1	;NOT IN OURS BUT IN DISK
  2209
  2210	002741'				NOLOS:	ASCIZ /
  2211	002741'	015 012 124 110 105 	THERE ARE NO LOST PAGES (MARKED IN USE, BUT IN NO FILE).
  2212	002742'	122 105 040 101 122 
  2213	002743'	105 040 116 117 040 
  2214	002744'	114 117 123 124 040 
  2215	002745'	120 101 107 105 123 
  2216	002746'	040 050 115 101 122 
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 40-1
DSKCLN	MAC	30-Feb-73 19:40	

  2217	002747'	113 105 104 040 111 
  2218	002750'	116 040 125 123 105 
  2219	002751'	054 040 102 125 124 
  2220	002752'	040 111 116 040 116 
  2221	002753'	117 040 106 111 114 
  2222	002754'	105 051 056 015 012 	/
  2223	002755'	000 000 000 000 000 
  2224	002756'				HEDLOS:	ASCIZ /
  2225	002756'	015 012 124 110 105 	THE FOLLOWING PAGES ARE LOST (MARKED IN USE, BUT IN NO FILE):
  2226	002757'	040 106 117 114 114 
  2227	002760'	117 127 111 116 107 
  2228	002761'	040 120 101 107 105 
  2229	002762'	123 040 101 122 105 
  2230	002763'	040 114 117 123 124 
  2231	002764'	040 050 115 101 122 
  2232	002765'	113 105 104 040 111 
  2233	002766'	116 040 125 123 105 
  2234	002767'	054 040 102 125 124 
  2235	002770'	040 111 116 040 116 
  2236	002771'	117 040 106 111 114 
  2237	002772'	105 051 072 015 012 	/
  2238	002773'	000 000 000 000 000 
  2239	002774'				TOTLOS:	ASCIZ /
  2240	002774'	015 012 124 117 124 	TOTAL NUMBER OF LOST PAGES = /
  2241	002775'	101 114 040 116 125 
  2242	002776'	115 102 105 122 040 
  2243	002777'	117 106 040 114 117 
  2244	003000'	123 124 040 120 101 
  2245	003001'	107 105 123 040 075 
  2246	003002'	040 000 000 000 000 
  2247
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 41
DSKCLN	MAC	30-Feb-73 19:40	

  2248	003003'	000020	010727'		FRETAB:	@PTRDST	;CHECK FOR FREE PAGES
  2249	003004'	000020	010730'			@PTROST
  2250	003005'	000000	003016'			NOFREE
  2251	003006'	000000	003034'			HEDFRE
  2252	003007'	000000	003053'			TOTFRE
  2253	003010'	256 04 0 00 014211'		ERRLEV (LEVBAD)^	XCT LEVBAD,[PUSHJ P,ERLSET]^
  2254	003011'	263 17 0 00 000000 		POPJ P,
  2255	003012'	616 02 0 05 000000 		TDNN T1,(T4)	;IN OUR SAT?
  2256	003013'	616 02 0 04 000000 		TDNN T1,(T3)	;YES, IN DISK SAT?
  2257	003014'	263 17 0 00 000000 		POPJ P,		;NOT IN OURS OR IN BOTH
  2258	003015'	254 00 0 00 004027'		JRST CPOPJ1	;IN OURS BUT NOT DISK
  2259
  2260	003016'				NOFREE:	ASCIZ /
  2261	003016'	015 012 124 110 105 	THERE ARE NO FREE PAGES (NOT MARKED IN USE, BUT IN SOME FILE).
  2262	003017'	122 105 040 101 122 
  2263	003020'	105 040 116 117 040 
  2264	003021'	106 122 105 105 040 
  2265	003022'	120 101 107 105 123 
  2266	003023'	040 050 116 117 124 
  2267	003024'	040 115 101 122 113 
  2268	003025'	105 104 040 111 116 
  2269	003026'	040 125 123 105 054 
  2270	003027'	040 102 125 124 040 
  2271	003030'	111 116 040 123 117 
  2272	003031'	115 105 040 106 111 
  2273	003032'	114 105 051 056 015 
  2274	003033'	012 000 000 000 000 	/
  2275	003034'				HEDFRE:	ASCIZ /
  2276	003034'	015 012 124 110 105 	THE FOLLOWING PAGES ARE FREE (NOT MARKED IN USE, BUT IN SOME FILE):
  2277	003035'	040 106 117 114 114 
  2278	003036'	117 127 111 116 107 
  2279	003037'	040 120 101 107 105 
  2280	003040'	123 040 101 122 105 
  2281	003041'	040 106 122 105 105 
  2282	003042'	040 050 116 117 124 
  2283	003043'	040 115 101 122 113 
  2284	003044'	105 104 040 111 116 
  2285	003045'	040 125 123 105 054 
  2286	003046'	040 102 125 124 040 
  2287	003047'	111 116 040 123 117 
  2288	003050'	115 105 040 106 111 
  2289	003051'	114 105 051 072 015 
  2290	003052'	012 000 000 000 000 	/
  2291	003053'				TOTFRE:	ASCIZ /
  2292	003053'	015 012 124 117 124 	TOTAL NUMBER OF FREE PAGES = /
  2293	003054'	101 114 040 116 125 
  2294	003055'	115 102 105 122 040 
  2295	003056'	117 106 040 106 122 
  2296	003057'	105 105 040 120 101 
  2297	003060'	107 105 123 040 075 
  2298	003061'	040 000 000 000 000 
  2299
  2300	003062'	000020	010736'		MLTTAB:	@PTRTST	;TROUBLE SAT
  2301	003063'	000020	010736'			@PTRTST	;REALLY ONLY ONE THAT MATTERS
  2302	003064'	000000	003074'			NOMULT
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 41-1
DSKCLN	MAC	30-Feb-73 19:40	

  2303	003065'	000000	003112'			HEDMLT
  2304	003066'	000000	003131'			TOTMLT
  2305	003067'	263 17 0 00 000000 		POPJ P,		;ERROR LEVEL ALREADY SET
  2306	003070'	263 17 0 00 000000 		POPJ P,
  2307	003071'	616 02 0 04 000000 		TDNN T1,(T3)
  2308	003072'	350 00 0 17 000000 		AOS (P)	;BAD IF MARKED
  2309	003073'	263 17 0 00 000000 		POPJ P,
  2310
  2311	003074'				NOMULT:	ASCIZ /
  2312	003074'	015 012 124 110 105 	THERE ARE NO MULTIPLY USED PAGES (BELONG TO MORE THAN ONE FILE).
  2313	003075'	122 105 040 101 122 
  2314	003076'	105 040 116 117 040 
  2315	003077'	115 125 114 124 111 
  2316	003100'	120 114 131 040 125 
  2317	003101'	123 105 104 040 120 
  2318	003102'	101 107 105 123 040 
  2319	003103'	050 102 105 114 117 
  2320	003104'	116 107 040 124 117 
  2321	003105'	040 115 117 122 105 
  2322	003106'	040 124 110 101 116 
  2323	003107'	040 117 116 105 040 
  2324	003110'	106 111 114 105 051 
  2325	003111'	056 015 012 000 000 	/
  2326	003112'				HEDMLT:	ASCIZ /
  2327	003112'	015 012 124 110 105 	THE FOLLOWING PAGES ARE MULTIPLY USED (BELONG TO MORE THAN ONE FILE):
  2328	003113'	040 106 117 114 114 
  2329	003114'	117 127 111 116 107 
  2330	003115'	040 120 101 107 105 
  2331	003116'	123 040 101 122 105 
  2332	003117'	040 115 125 114 124 
  2333	003120'	111 120 114 131 040 
  2334	003121'	125 123 105 104 040 
  2335	003122'	050 102 105 114 117 
  2336	003123'	116 107 040 124 117 
  2337	003124'	040 115 117 122 105 
  2338	003125'	040 124 110 101 116 
  2339	003126'	040 117 116 105 040 
  2340	003127'	106 111 114 105 051 
  2341	003130'	072 015 012 000 000 	/
  2342	003131'				TOTMLT:	ASCIZ /
  2343	003131'	015 012 124 117 124 	TOTAL NUMBER OF MULTIPLY USED PAGES = /
  2344	003132'	101 114 040 116 125 
  2345	003133'	115 102 105 122 040 
  2346	003134'	117 106 040 115 125 
  2347	003135'	114 124 111 120 114 
  2348	003136'	131 040 125 123 105 
  2349	003137'	104 040 120 101 107 
  2350	003140'	105 123 040 075 040 
  2351	003141'	000 000 000 000 000 
  2352
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 42
DSKCLN	MAC	30-Feb-73 19:40	

  2353						DEFINE SPCMAC
  2354					< IFNDEF XX,<XX:>
  2355						X <1,,1>,UFD,MFDRBC,MFDPC1
  2356						X <1,,4>,UFD,SYSRIB,SYSPRC
  2357					  IFNDEF SPUFDN,<SPUFDN==.-XX>		;;# OF UFD ENTRIES
  2358						X HOME,SYS,HOMRIB,HOMPRC
  2359						X SAT,SYS,SATRIB,SATPRC
  2360					;;	X SWAP,SYS,SWPRIB,SWPPRC	;; nobody cares anymore!
  2361						X CRASH,SAV,[-1],CPOPJ
  2362					>
  2363
  2364						DEFINE X (A,B,C,D)
  2365						<C>
  2366					;CHECK FOR SPECIAL FILE
  2367	003142'				SPCACT:	SPCMAC^ IFNDEF XX,<XX:>
  2368	003142'	000000	007602'			X <1,,1>,UFD,MFDRBC,MFDPC1^MFDRBC^
  2369	003143'	000000	010756'			X <1,,4>,UFD,SYSRIB,SYSPRC^SYSRIB^
  2370	003144'	000000	006571'			X HOME,SYS,HOMRIB,HOMPRC^HOMRIB^
  2371	003145'	000000	010745'			X SAT,SYS,SATRIB,SATPRC^SATRIB^
  2372	003146'	000000	014571'			X CRASH,SAV,[-1],CPOPJ^[-1]^
  2373
  2374						DEFINE X (A,B,C,D)
  2375						<D>
  2376					;ACTION TO TAKE FOR SPECIAL FILES
  2377	003147'				SPACT2:	SPCMAC^ IFNDEF XX,<XX:>
  2378	003147'	000000	002614'			X <1,,1>,UFD,MFDRBC,MFDPC1^MFDPC1^
  2379	003150'	000000	002612'			X <1,,4>,UFD,SYSRIB,SYSPRC^SYSPRC^
  2380	003151'	000000	002620'			X HOME,SYS,HOMRIB,HOMPRC^HOMPRC^
  2381	003152'	000000	002616'			X SAT,SYS,SATRIB,SATPRC^SATPRC^
  2382	003153'	000000	004030'			X CRASH,SAV,[-1],CPOPJ^CPOPJ^
  2383
  2384						DEFINE X (A,B,C,D)
  2385						<IFIDN <B><UFD>,<1,,1>
  2386						IFDIF <B><UFD>,<1,,4>>
  2387					;PPN FOR SPECIAL FILE
  2388	003154'				SYSPPN:	SPCMAC^ IFNDEF XX,<XX:>
  2389	003154'	000001	000001			X <1,,1>,UFD,MFDRBC,MFDPC1^IFIDN <UFD><UFD>,<1,,1>
  2390	003155'	000001	000001			X <1,,4>,UFD,SYSRIB,SYSPRC^IFIDN <UFD><UFD>,<1,,1>
  2391	003156'	000001	000004			IFDIF <SYS><UFD>,<1,,4>^
  2392	003157'	000001	000004			IFDIF <SYS><UFD>,<1,,4>^
  2393	003160'	000001	000004			IFDIF <SAV><UFD>,<1,,4>^
  2394
  2395						DEFINE X (A,B,C,D)
  2396						<IFIDN <B><UFD>,<A>
  2397						IFDIF <B><UFD>,<SIXBIT /A/>>
  2398					;NAME OF SPECIAL FILES
  2399	003161'				SYSNAM:	SPCMAC^ IFNDEF XX,<XX:>
  2400	003161'	000001	000001			X <1,,1>,UFD,MFDRBC,MFDPC1^IFIDN <UFD><UFD>,<1,,1>
  2401	003162'	000001	000004			X <1,,4>,UFD,SYSRIB,SYSPRC^IFIDN <UFD><UFD>,<1,,4>
  2402	003163'	50 57 55 45 00 00 		IFDIF <SYS><UFD>,<SIXBIT /HOME/>^
  2403	003164'	63 41 64 00 00 00 		IFDIF <SYS><UFD>,<SIXBIT /SAT/>^
  2404	003165'	43 62 41 63 50 00 		IFDIF <SAV><UFD>,<SIXBIT /CRASH/>^
  2405
  2406						DEFINE X (A,B,C,D)
  2407						<SIXBIT /B/>
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 42-1
DSKCLN	MAC	30-Feb-73 19:40	

  2408					;EXTENSION OF SPECIAL FILES
  2409	003166'				SYSEXT:	SPCMAC^ IFNDEF XX,<XX:>
  2410	003166'	65 46 44 00 00 00 		X <1,,1>,UFD,MFDRBC,MFDPC1^SIXBIT /UFD/^
  2411	003167'	65 46 44 00 00 00 		X <1,,4>,UFD,SYSRIB,SYSPRC^SIXBIT /UFD/^
  2412	003170'	63 71 63 00 00 00 		X HOME,SYS,HOMRIB,HOMPRC^SIXBIT /SYS/^
  2413	003171'	63 71 63 00 00 00 		X SAT,SYS,SATRIB,SATPRC^SIXBIT /SYS/^
  2414	003172'	63 41 66 00 00 00 		X CRASH,SAV,[-1],CPOPJ^SIXBIT /SAV/^
  2415			000005			SPCLEN==.-SYSEXT
  2416
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 43
DSKCLN	MAC	30-Feb-73 19:40	

  2417					;ERROR ROUTINES
  2418
  2419	003173'	332 00 0 00 005503'	TRMMES:	SKIPE DETSW	;MESSAGE POINTED TO BY M
  2420	003174'	254 00 0 00 003250'		JRST DETMSG	;EVENTUALLY TO CTY
  2421	003175'	051 03 1 00 000000 		OUTSTR @M
  2422	003176'	263 17 0 00 000000 		POPJ P,
  2423
  2424					;Check for SY, ST, JL, RA, and WA lic
  2425
  2426	003177'	561 01 0 00 777760 	CHKLIC:	HRROI	T,LICTAB	;Get lic word
  2427	003200'	047 01 0 00 000041 		GETTAB	T,
  2428	003201'	201 01 0 00 000000 		  MOVEI	T,0		;As if had no lic
  2429	003202'	450 01 0 00 000001 		SETCA	T,T
  2430					ife debug,<
  2431	003203'	607 01 0 00 045017 	 	TLNN	T,LICSY+LICST+LICJL+LICRA+LICWA	;Does process have required
  2432					>						; lic?
  2433					ifn debug,<
  2434						TLNN	T,LICSY+LICST+LICJL+LICRA	;[37] no WA if debug mode 
  2435					>
  2436	003204'	263 17 0 00 000000 		POPJ	P,		;Yes
  2437	003205'				NOJAL:	MOVEI	M,[ASCIZ /
  2438					SY, ST, JL, RA, AND WA LICENSE REQUIRED.  NOTIFY SQC.
  2439	003205'	201 00 0 00 014572'	/]
  2440	
  2441	003206'	070 16 0 00 000000 	FATERR:	CLOSE LPT,
  2442	003207'	260 17 0 00 003173'		PUSHJ P,TRMMES
  2443	003210'	254 00 0 00 003305'		JRST QUIT0
  2444
  2445	003211'				interr:	movei	m,[asciz \
  2446	003211'	201 00 0 00 014606'	CAN'T ACTIVAT SOFTWARE INTERRUPT SYSTEM.  ABORTING...\]
  2447	003212'	254 00 0 00 003206'		jrst	faterr		;[37] 
  2448
  2449	003213'				pioerr:	movei	m,[asciz \
  2450	003213'	201 00 0 00 014622'	FATAL HARDWARE DISK ERROR DETECTED!\]
  2451	003214'	254 00 0 00 003206'		jrst	faterr		;[37] un-recoverable hard device or data errors
  2452
  2453	003215'				nocor1:	movei 	m,[asciz \
  2454	003215'	201 00 0 00 014632'	INSUFFICIENT CORE AVAILABLE - T .GE. HIADDR IN GETCOR.\]
  2455	003216'	254 00 0 00 003206'		jrst	faterr		;[37] temporarily add slightly different 
  2456									;[37] error message if because hiaddr too low
  2457
  2458	003217'				NOCOR:	MOVEI M,[ASCIZ /
  2459	003217'	201 00 0 00 014646'	INSUFFICIENT CORE AVAILABLE/]
  2460	003220'	254 00 0 00 003206'		JRST FATERR
  2461
  2462	003221'				PVYERR:	MOVEI	M,[ASCIZ/
  2463	003221'	201 00 0 00 014654'	DSKCLN USER CORE LIMIT SET TOO LOW/]
  2464	003222'	254 00 0 00 003206'		JRST	FATERR
  2465
  2466	003223'				OPNERR:	MOVEI M,[ASCIZ /
  2467	003223'	201 00 0 00 014664'	CAN NOT OPEN AN OUTPUT FILE/]
  2468	003224'	254 00 0 00 003206'		JRST FATERR
  2469
  2470	003225'				NODSER:	MOVEI	M,[ASCIZ/
  2471					DSKCLN UUO FAILED.
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 43-1
DSKCLN	MAC	30-Feb-73 19:40	

  2472	003225'	201 00 0 00 014672'	NOTIFY OPERATING SYSTEMS/]
  2473	003226'	254 00 0 00 003206'		JRST	FATERR
  2474
  2475	003227'				FALLPT:	MOVEI M,[ASCIZ /
  2476	003227'	201 00 0 00 014704'	CAN NOT OPEN LIST OUTPUT. LPT NOT AVAILABLE?/]
  2477	003230'	254 00 0 00 003206'		JRST FATERR
  2478
  2479					;[37] IFN MAKSW!DEBUG,<
  2480					;[37] FALFAK:	OUTSTR [ASCIZ /
  2481					;[37] CAN NOT OPEN SIMULATION FILE/]
  2482					;[37] 	EXIT>
  2483
  2484	003231'				HOMNUM:	MOVEI M,[ASCIZ /
  2485					WRONG NUMBER OF HOME BLOCKS READ
  2486	003231'	201 00 0 00 014716'	NOTIFY OPERATING SYSTEMS/]
  2487	003232'	254 00 0 00 003206'		JRST FATERR
  2488
  2489	003233'				BADHOM:	MOVEI M,[ASCIZ /
  2490	003233'	201 00 0 00 014733'	BAD HOME BLOCK ON UNIT /]
  2491	003234'	260 17 0 00 003173'		PUSHJ P,TRMMES
  2492	003235'	200 13 0 00 014123'		MOVE P1,[POINT 7,TRMBLK]
  2493	003236'	200 06 0 00 000012 		MOVE N,U
  2494	003237'	201 16 0 00 003256'		MOVEI P4,TRMSAV
  2495	003240'	202 16 0 00 011021'		MOVEM P4,TYODSP#
  2496	003241'	260 17 0 00 003500'		PUSHJ P,DECPRT
  2497	003242'	201 01 0 00 000000 		MOVEI T,0
  2498	003243'	136 01 0 00 000013 		IDPB T,P1
  2499	003244'	201 00 0 00 010762'		MOVEI M,TRMBLK
  2500	003245'	260 17 0 00 003173'		PUSHJ P,TRMMES
  2501						MOVEI M,[ASCIZ /
  2502	003246'	201 00 0 00 014676'	NOTIFY OPERATING SYSTEMS/]
  2503	003247'	254 00 0 00 003206'		JRST FATERR
  2504
  2505	003250'	505 00 0 00 000000 	DETMSG:	HRLI M,SUUMSG
  2506	003251'	047 00 0 00 000075 		SETUUO M,	;SEND MSG TO OPR
  2507	003252'	051 03 1 00 000000 		 OUTSTR @M	;OUTSTR IF IT FAILS
  2508	003253'	263 17 0 00 000000 		POPJ P,
  2509
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 44
DSKCLN	MAC	30-Feb-73 19:40	

  2510					;THIS ROUTINE IS USED TO OUTPUT CHRS TO A BYTE POINTER IN P1
  2511
  2512	003254'	332 00 0 00 000016 	TYOBTH:	SKIPE P4	;POSSIBLE TO BOTH FILE AND TERMINAL
  2513	003255'	260 17 0 00 003612'		PUSHJ P,TYO	;SEND TO FILE
  2514	003256'	136 10 0 00 000013 	TRMSAV:	IDPB CH,P1
  2515	003257'	263 17 0 00 000000 		POPJ P,
  2516
  2517	003260'				FRDER:	MOVEI M,[ASCIZ /
  2518	003260'	201 00 0 00 014741'	FATAL READ ERROR WHILE FIXING DISK/]
  2519	003261'	254 00 0 00 003206'		JRST FATERR
  2520
  2521	003262'				NOCLR:	MOVEI M,[ASCIZ /
  2522					CAN NOT CLEAR DISK INFORMATION
  2523					CRASH SYSTEM, BRING IT BACK UP, RUN DSKCLN AGAIN.
  2524					IF PROBLEM PERSISTS, CALL SYSTEMS
  2525					REMEMBER TO SAVE THE CRASH.
  2526	003262'	201 00 0 00 014751'	/]
  2527	003263'	254 00 0 00 003206'		JRST FATERR
  2528
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 45
DSKCLN	MAC	30-Feb-73 19:40	

  2529					COMMENT #
  2530					@@SUBROUTINE GETCOR
  2531					@@PURPOSE
  2532					SUBR TO SEE IF WE NEED CORE, AND THEN TO GET CORE, IF
  2533					NECESSARY.
  2534					@@ENTRY
  2535					EXPECTS T/ HIGHEST DESIRED ADDRESSABLE LOCATION.
  2536					@@ACCUM
  2537					DESTROYS T.
  2538					@@EXIT
  2539					NON-SKIP RETURNS IF OKAY, NEVER RETURNS IF NOT OKAY.
  2540					ON SUCCESS, HAS SET UPRBND TO NEW VALUE.
  2541					@@ #
  2542
  2543	003264'	317 01 0 00 005407'	GETCOR:	CAMG	T,UPRBND	;NEED MORE CORE?
  2544	003265'	263 17 0 00 000000 		POPJ	P,		;NO.
  2545	003266'	435 01 0 00 001777 		IORI	T,1777		;GO BY K.
  2546	003267'	311 01 0 00 006567'		caml	t,hiaddr	;[37] too high?
  2547	003270'	254 00 0 00 003215'		 jrst	nocor1		;[37] yes, complain and die
  2548	003271'	202 01 0 00 005407'		MOVEM	T,UPRBND	;no, stash it
  2549	003272'	047 01 0 00 000011 		CORE	T,		;OLD STYLE GET CORE.
  2550	003273'	254 00 0 00 003217'		JRST	NOCOR		;
  2551	003274'	263 17 0 00 000000 		POPJ	P,
  2552
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 46
DSKCLN	MAC	30-Feb-73 19:40	

  2553					;CHECK FOR OPER LICENSE
  2554
  2555	003275'	561 01 0 00 777760 	CHKOPR:	HRROI	T,LICTAB	;GET LICENSE WORD
  2556	003276'	047 01 0 00 000041 		GETTAB	T,
  2557	003277'	201 01 0 00 000000 		  MOVEI	T,0		;AS IF HAD NO LICENSE
  2558					;[37] IFE DEBUG!MAKSW,<
  2559					IFE DEBUG,<
  2560	003300'	602 01 0 00 100000 		TRNE	T,LICOPR	;DOES JOB, NOT PROCESS, HAVE OP?
  2561	003301'	254 00 0 17 000000 		JRST	(P)		;YES, OK.
  2562						MOVEI	M,[ASCIZ/
  2563	003302'	201 00 0 00 015007'	OP LICENSE REQUIRED/]
  2564	003303'	260 17 0 00 003173'		PUSHJ	P,TRMMES
  2565	003304'	047 00 0 00 000012 		EXIT
  2566					>
  2567
  2568					;[37] IFN DEBUG!MAKSW,<
  2569					IFN DEBUG,<
  2570						TRNN	T,3		;MAKE SURE HE ISN'T DANGEROUS
  2571						JRST	(P)		;OK.
  2572						OUTSTR	[ASCIZ/
  2573					MUST NOT HAVE WP,WF, OR WA IN DEBUG OR MAKE MODE/]
  2574						EXIT
  2575					>
  2576
  2577	003305'	201 00 0 00 003337'	QUIT0:	MOVEI M,NOUP
  2578	003306'	260 17 0 00 003173'		PUSHJ P,TRMMES
  2579	003307'	260 17 0 00 003554'		PUSHJ	P,IDEND	;PRINT TERMINATION MESSAGE
  2580	003310'	047 00 0 00 000012 		EXIT		;ALWAYS EXIT IF FATEL ERROR
  2581	003311'	260 17 0 00 003554'	QUIT:	PUSHJ	P,IDEND	;PRINT TERMINATION MESSAGE
  2582					;[37] 	IFN MAKSW,<PUSHJ P,OUTDIR>
  2583	003312'	336 00 0 00 005503'		SKIPN DETSW	;SPECIAL IF AUTO-RESTART
  2584	003313'	047 00 0 00 000012 		EXIT
  2585	003314'	554 01 0 00 000241*		HLRZ T,JOBSA	;KEEP LOWSEG BELOW 256K
  2586	003315'	047 01 0 00 000011 		CORE T,		;SO LOGOUT WILL RUN UNDER P032.
  2587	003316'	255 00 0 00 000000 		JFCL			; SHOUDLD NEVER FAIL
  2588	003317'	205 01 0 00 000002 		MOVSI T,SUUINI
  2589	003320'	047 01 0 00 000075 		SETUUO T,	;START REST OF AUTO-RELOAD GOING
  2590	003321'	255 00 0 00 000000 		 JFCL
  2591	003322'	200 01 0 00 015014'		MOVE T,[LOGITM,,LOGTAB]
  2592	003323'	047 01 0 00 000041 		GETTAB T,
  2593	003324'	200 01 0 00 015015'		 MOVE T,[SIXBIT /LOGOUT/]
  2594	003325'	202 01 0 00 005511'		MOVEM T,FILNAM+1
  2595	003326'	402 00 0 00 005512'		SETZM FILNAM+2
  2596	003327'	200 01 0 00 015016'		MOVE T,[FILNAM+2,,FILNAM+3]
  2597	003330'	251 01 0 00 005515'		BLT T,FILNAM+5
  2598	003331'	205 01 0 00 637163 		MOVSI T,'SYS'
  2599	003332'	202 01 0 00 005510'		MOVEM T,FILNAM
  2600	003333'	201 01 0 00 005510'		MOVEI T,FILNAM
  2601	003334'	505 01 0 00 000001 		HRLI T,1	;NOW LOGOUT
  2602	003335'	047 01 0 00 000035 		RUN T,
  2603	003336'	254 04 0 00 003336'		HALT .		;IN CASE OF ERROR
  2604
  2605	003337'				NOUP:	ASCIZ /
  2606	003337'	015 012 104 117 040 	DO NOT ATTEMPT TO BRING SYSTEM UP FOR USERS/
  2607	003340'	116 117 124 040 101 
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 46-1
DSKCLN	MAC	30-Feb-73 19:40	

  2608	003341'	124 124 105 115 120 
  2609	003342'	124 040 124 117 040 
  2610	003343'	102 122 111 116 107 
  2611	003344'	040 123 131 123 124 
  2612	003345'	105 115 040 125 120 
  2613	003346'	040 106 117 122 040 
  2614	003347'	125 123 105 122 123 
  2615	003350'	000 000 000 000 000 
  2616
  2617	003351'				SRBERR:	MOVEI M,[ASCIZ /
  2618	003351'	201 00 0 00 015017'	ERROR IN SAT.SYS RIB/]
  2619	003352'	254 00 0 00 003206'		JRST FATERR
  2620
  2621	003353'				SBKERR:	MOVEI M,[ASCIZ /
  2622	003353'	201 00 0 00 015024'	ERROR READING A SAT BLOCK/]
  2623	003354'	254 00 0 00 003206'		JRST FATERR
  2624
  2625	003355'	261 17 0 00 000001 	ERLSET:	PUSH P,T
  2626	003356'	200 01 0 17 777777 		MOVE T,-1(P)
  2627	003357'	135 01 0 00 015032'		LDB T,[POINT 4,-1(T),12]
  2628	003360'	202 01 0 00 010757'		MOVEM T,THSERR#
  2629	003361'	313 01 0 00 005506'		CAMLE T,ERRSAV
  2630	003362'	202 01 0 00 005506'		MOVEM T,ERRSAV
  2631	003363'	262 17 0 00 000001 		POP P,T
  2632	003364'	263 17 0 00 000000 		POPJ P,
  2633
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 47
DSKCLN	MAC	30-Feb-73 19:40	

  2634					;SUBROUTINE TO PRINT ERROR MESSAGES CONCERNING PARTICULAR PAGES IN THE FORMAT:
  2635					;     FILE  FILE.EXT  [PRJ,PRG] CLSTR # (= BLK #)  RANDOM ERROR MESSAGE
  2636					; THE ARGUMENTS TO THE SUBROUTINE ARE:
  2637					;     ACC N CONTAINS THE CLUSTER NUMBER (IF NEGATIVE CLSTR # WILL NOT BE PRINTED)
  2638					;     LH OF ACC T HAS ADR OF RANDOM ASCIZ ERROR MESSAGE (CAN BE 0 IF NONE DESIRED)
  2639					;     RH OF ACC T HAS ADR OF 4-WORD LOOKUP BLOCK CONTAINING THE SIXBIT
  2640					;      FILENAME AND EXTENSION AND PRJ,PRG IN THE STANDARD PLACES
  2641
  2642	003365'	261 17 0 00 000006 	PRTRBL:	PUSH P,N
  2643	003366'	261 17 0 00 000001 		PUSH P,T
  2644	003367'	200 02 0 00 010757'		MOVE T1,THSERR
  2645	003370'	315 02 0 00 003462'		CAMGE T1,MINERR
  2646	003371'	254 00 0 00 003445'		JRST NOPRTR
  2647	003372'	476 00 0 00 010760'		SETOM TRBFIL
  2648	003373'	201 00 0 00 015033'		MOVEI M,[ASCIZ /FILE  /]
  2649	003374'	260 17 0 00 003566'		PUSHJ P,MSG
  2650	003375'	554 02 0 01 000001 		HLRZ T1,1(T)
  2651	003376'	306 02 0 00 654644 		CAIN T1,'UFD'
  2652	003377'	254 00 0 00 003450'		JRST PRTRBU
  2653	003400'	200 01 0 01 000000 	PRTBU1:	MOVE T,0(T)		;GET FILE NAME
  2654	003401'	260 17 0 00 003616'		PUSHJ P,PR6BIT
  2655	003402'	200 01 0 17 000000 	PRTRB2:	MOVE T,0(P)
  2656	003403'	510 01 0 01 000001 		HLLZ T,1(T)		;GET EXTENSION
  2657	003404'	332 00 0 00 000001 		SKIPE T
  2658	003405'	260 17 0 00 003601'		PUSHJ P,PDOT		;PRINT DOT ONLY IF NON-NULL EXT
  2659	003406'	260 17 0 00 003616'		PUSHJ P,PR6BIT
  2660	003407'	260 17 0 00 003573'		PUSHJ P,SPC
  2661	003410'	200 01 0 17 000000 		MOVE T,0(P)
  2662	003411'	336 00 0 01 000002 		SKIPN 2(T)
  2663	003412'	254 00 0 00 003425'		JRST PRTRB3
  2664	003413'	201 10 0 00 000133 		MOVEI CH,"["
  2665	003414'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  2666	003415'	554 06 0 01 000002 		HLRZ N,2(T)		;PRJ
  2667	003416'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  2668	003417'	260 17 0 00 003577'		PUSHJ P,COMMA
  2669	003420'	550 06 0 01 000002 		HRRZ N,2(T)		;PRG
  2670	003421'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  2671	003422'	201 10 0 00 000135 		MOVEI CH,"]"
  2672	003423'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  2673	003424'	260 17 0 00 003573'		PUSHJ P,SPC
  2674	003425'	335 06 0 17 777777 	PRTRB3:	SKIPGE N,-1(P)
  2675	003426'	254 00 0 00 003437'		JRST PRTRB4
  2676	003427'	201 00 0 00 015035'		MOVEI M,[ASCIZ /PAGE /]
  2677	003430'	260 17 0 00 003566'		PUSHJ P,MSG
  2678	003431'	135 06 0 00 015037'		LDB N,[POINT PTSPNO,N,PTNPNO]
  2679	003432'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  2680	003433'	201 00 0 00 015040'		MOVEI M,[ASCIZ / UNIT /]
  2681	003434'	260 17 0 00 003566'		PUSHJ P,MSG
  2682	003435'	135 06 0 00 015042'		LDB N,[POINT PTSUNI,-1(P),PTNUNI]
  2683	003436'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  2684	003437'	260 17 0 00 003573'	PRTRB4:	PUSHJ P,SPC
  2685	003440'	260 17 0 00 003573'		PUSHJ P,SPC
  2686	003441'	554 00 0 17 000000 		HLRZ M,0(P)
  2687	003442'	332 00 0 00 000000 		SKIPE M
  2688	003443'	260 17 0 00 003566'		PUSHJ P,MSG
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 47-1
DSKCLN	MAC	30-Feb-73 19:40	

  2689	003444'	260 17 0 00 003610'		PUSHJ P,CRLF
  2690	003445'	262 17 0 00 000001 	NOPRTR:	POP P,T
  2691	003446'	262 17 0 00 000006 		POP P,N
  2692	003447'	263 17 0 00 000000 		POPJ P,
  2693
  2694	003450'	332 06 0 01 000002 	PRTRBU:	SKIPE N,2(T)
  2695	003451'	316 06 0 00 014157'		CAMN N,[1,,1]
  2696	003452'	334 00 0 00 000000 		SKIPA		;REALLY A UFD
  2697	003453'	254 00 0 00 003400'		JRST PRTBU1
  2698	003454'	554 06 0 01 000000 		HLRZ N,0(T)
  2699	003455'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  2700	003456'	260 17 0 00 003577'		PUSHJ P,COMMA
  2701	003457'	550 06 0 01 000000 		HRRZ N,0(T)
  2702	003460'	260 17 0 00 003501'		PUSHJ P,OCTPRT
  2703	003461'	254 00 0 00 003402'		JRST PRTRB2
  2704
  2705	003462'	000000	000000		MINERR:	0
  2706
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 48
DSKCLN	MAC	30-Feb-73 19:40	

  2707					;ROUTINES TO PRINT RIGHT-JUSTIFIED INTEGERS
  2708					; FIELD WIDTH IN ACC T
  2709					; NUMBER IN ACC N
  2710
  2711	003463'	334 10 0 00 015043'	DECSPC:	SKIPA CH,[40]		;DECIMAL WITH LEADING SPACES
  2712	003464'	201 10 0 00 000060 	DECZRO:	MOVEI CH,"0"		;DECIMAL WITH LEADING ZEROES
  2713	003465'	201 07 0 00 000012 		MOVEI N1,^D10
  2714	003466'	254 00 0 00 003472'		JRST RJRDXP
  2715	003467'	334 10 0 00 015043'	OCTSPC:	SKIPA CH,[40]		;OCTAL WITH LEADING SPACES
  2716	003470'	201 10 0 00 000060 	OCTZRO:	MOVEI CH,"0"		;OCTAL WITH LEADING ZEROES
  2717	003471'	201 07 0 00 000010 		MOVEI N1,^D8
  2718	003472'	202 07 0 00 010741'	RJRDXP:	MOVEM N1,RADIX#
  2719	003473'	363 01 0 00 003503'	JUSTFY:	SOJLE T,RDXPRT		;RIGHT JUSTIFY
  2720	003474'	315 06 0 00 000007 		CAMGE N,N1
  2721	003475'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  2722	003476'	220 07 0 00 010741'		IMUL N1,RADIX
  2723	003477'	254 00 0 00 003473'		JRST JUSTFY
  2724
  2725	003500'	334 07 0 00 015044'	DECPRT:	SKIPA N1,[^D10]
  2726	003501'	201 07 0 00 000010 	OCTPRT:	MOVEI N1,^D8
  2727	003502'	202 07 0 00 010741'		MOVEM N1,RADIX
  2728	003503'	230 06 0 00 010741'	RDXPRT:	IDIV N,RADIX		;ANY RADIX PRINT ROUTINE
  2729	003504'	506 07 0 17 000000 		HRLM N1,0(P)
  2730	003505'	332 00 0 00 000006 		SKIPE N
  2731	003506'	260 17 0 00 003503'		PUSHJ P,RDXPRT
  2732	003507'	554 10 0 17 000000 		HLRZ CH,0(P)
  2733	003510'	271 10 0 00 000060 		ADDI CH,"0"
  2734	003511'	254 00 1 00 011021'		JRST @TYODSP
  2735
  2736					;subr to print octal number in ac N on the cty.
  2737					;make a string in chrbuf and return thru trmmsg
  2738	003512'	201 01 0 00 000014 	octcty:	movei t,^d12		;[40] set to loop
  2739	003513'	200 10 0 00 015045'		move ch,[point 7,chrbuf] ;[40] point to string area
  2740	003514'	200 07 0 00 000006 		move n1,n		;[40] put it in the right guy
  2741	003515'	400 06 0 00 000000 	octcy1:	setz n,			;[40] clean one out
  2742	003516'	246 06 0 00 000003 		lshc n,3		;[40] one octal digit into N
  2743	003517'	271 06 0 00 000060 		addi n,"0"		;[40] make it ascii
  2744	003520'	136 06 0 00 000010 		idpb n,ch		;[40] stash it
  2745	003521'	367 01 0 00 003515'		sojg t,octcy1		;[40] do 'em all
  2746	003522'	201 00 0 00 005450'		movei m,chrbuf		;[40] point to string
  2747	003523'	400 06 0 00 000000 		setz n,			;[40] tack on a null
  2748	003524'	136 06 0 00 000010 		idpb n,ch		;[40] to make asciz
  2749	003525'	254 00 0 00 003173'		jrst trmmes		;[40] and print it out
  2750
  2751					;SUBROUTINE TO IDENTIFY THIS RUN
  2752
  2753	003526'	260 17 0 00 003607'	IDENT:	PUSHJ	P,CRLF2
  2754	003527'	205 01 0 00 777772 		MOVSI T,-6		;GET SYSTEM NAME
  2755	003530'	504 00 0 00 000001 	NAMLP:	HRL M,T
  2756	003531'	541 00 0 00 000011 		HRRI M,CNFTAB
  2757	003532'	047 00 0 00 000041 		GETTAB M,
  2758	003533'	201 00 0 00 000000 		 MOVEI M,0
  2759	003534'	202 00 0 01 005473'		MOVEM M,CNFNAM(T)
  2760	003535'	253 01 0 00 003530'		AOBJN T,NAMLP
  2761	003536'	201 00 0 00 005473'		MOVEI M,CNFNAM	;NOW PRINT IT
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 48-1
DSKCLN	MAC	30-Feb-73 19:40	

  2762	003537'	260 17 0 00 003566'		PUSHJ P,MSG
  2763	003540'	260 17 0 00 003610'		PUSHJ P,CRLF
  2764	003541'	200 01 0 00 010752'		MOVE	T,STRNAM
  2765	003542'	260 17 0 00 003616'		PUSHJ	P,PR6BIT
  2766	003543'	201 00 0 00 014142'		MOVEI	M,[ASCIZ /.  MODE: /]
  2767	003544'	260 17 0 00 003566'		PUSHJ	P,MSG
  2768	003545'	200 01 0 00 005502'		MOVE	T,DCN
  2769	003546'	200 01 0 01 000167'		MOVE	T,DCNNAM(T)
  2770	003547'	260 17 0 00 003616'		PUSHJ	P,PR6BIT
  2771	003550'	201 00 0 00 015046'		MOVEI	M,[ASCIZ /.     ANALYSIS BEGUN AT /]
  2772	003551'	260 17 0 00 003566'		PUSHJ	P,MSG
  2773	003552'	260 17 0 00 003646'		PUSHJ	P,NOW
  2774	003553'	254 00 0 00 003607'		PJRST	CRLF2
  2775
  2776					;SUBROUTINE TO PRINT TERMINATION MESSAGE
  2777
  2778	003554'				IDEND:	MOVEI	M,[ASCIZ /
  2779
  2780	003554'	201 00 0 00 015053'	DSKCLN DONE AT /]
  2781	003555'	260 17 0 00 003173'		PUSHJ	P,TRMMES
  2782	003556'	200 13 0 00 014123'		MOVE	P1,[POINT 7,TRMBLK]
  2783	003557'	201 01 0 00 003256'		MOVEI	T,TRMSAV
  2784	003560'	202 01 0 00 011021'		MOVEM	T,TYODSP
  2785	003561'	260 17 0 00 003646'		PUSHJ	P,NOW
  2786	003562'	260 17 0 00 003607'		PUSHJ	P,CRLF2
  2787	003563'	260 17 0 00 003603'		PUSHJ	P,NULL
  2788	003564'	201 00 0 00 010762'		MOVEI	M,TRMBLK
  2789	003565'	254 00 0 00 003173'		PJRST	TRMMES
  2790
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 49
DSKCLN	MAC	30-Feb-73 19:40	

  2791					;THESE ARE PRINT-OUT ROUTINES LIFTED FROM DSKLST AND OCCASIONALLY
  2792					; SLIGHTLY MODIFIED  (AC USAGE, ETC.)
  2793
  2794	003566'	505 00 0 00 440700 	MSG:	HRLI M,440700		;PRINT RANDOM LENGTH (ASCIZ) MESSAGE
  2795	003567'	134 10 0 00 000000 	MSGL:	ILDB CH,M		;  ADDRESS OF MESSAGE IS IN ACC M
  2796	003570'	322 10 0 00 004030'		JUMPE CH,CPOPJ
  2797	003571'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  2798	003572'	254 00 0 00 003567'		JRST MSGL
  2799
  2800	003573'	201 10 0 00 000040 	SPC:	MOVEI CH,40		;PRINT OUT PARTICULAR CHARACTERS...
  2801	003574'	254 00 1 00 011021'		JRST @TYODSP
  2802	003575'	201 10 0 00 000014 	FORM:	MOVEI	CH,14
  2803	003576'	254 00 1 00 011021'		JRST	@TYODSP
  2804	003577'	201 10 0 00 000054 	COMMA:	MOVEI CH,","
  2805	003600'	254 00 1 00 011021'		JRST @TYODSP
  2806	003601'	201 10 0 00 000056 	PDOT:	MOVEI CH,"."
  2807	003602'	254 00 1 00 011021'		JRST @TYODSP
  2808	003603'	201 10 0 00 000000 	NULL:	MOVEI	CH,0
  2809	003604'	254 00 1 00 011021'		JRST	@TYODSP
  2810	003605'	201 10 0 00 000011 	TAB:	MOVEI CH,11
  2811
  2812	003606'	260 17 0 00 003610'	CRLF3:	PUSHJ P,CRLF
  2813	003607'	260 17 0 00 003610'	CRLF2:	PUSHJ P,CRLF
  2814	003610'	265 00 0 00 003566'	CRLF:	JSP M,MSG
  2815						ASCIZ /
  2816	003611'	015 012 000 000 000 	/
  2817
  2818
  2819	003612'	377 00 0 00 006576'	TYO:	SOSG LOBUF+2
  2820	003613'	067 16 0 00 000000 		OUTPUT LPT,0
  2821	003614'	136 10 0 00 006575'		IDPB CH,LOBUF+1
  2822	003615'	263 17 0 00 000000 		POPJ P,
  2823
  2824	003616'	201 00 0 00 000000 	PR6BIT:	MOVEI M,0
  2825	003617'	246 00 0 00 000006 		LSHC M,6	;FROM T
  2826	003620'	200 10 0 00 000000 		MOVE CH,M
  2827	003621'	271 10 0 00 000040 		ADDI CH," "
  2828	003622'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  2829	003623'	326 01 0 00 003616'		JUMPN T,PR6BIT
  2830	003624'	263 17 0 00 000000 		POPJ P,
  2831
  2832	003625'	261 17 0 00 000010 	TRMOPR:	PUSH P,CH
  2833	003626'	200 10 0 00 014123'		MOVE CH,[POINT 7,TRMBLK]
  2834	003627'	202 10 0 00 011020'		MOVEM CH,TRMPTR#
  2835	003630'	201 10 0 00 003633'		MOVEI CH,TRMOP2
  2836	003631'	202 10 0 00 011021'		MOVEM CH,TYODSP
  2837	003632'	262 17 0 00 000010 		POP P,CH
  2838	003633'	136 10 0 00 011020'	TRMOP2:	IDPB CH,TRMPTR
  2839	003634'	302 10 0 00 000012 		CAIE CH,12
  2840	003635'	263 17 0 00 000000 		POPJ P,
  2841	003636'	261 17 0 00 000000 		PUSH P,M
  2842	003637'	205 00 0 00 003625'		MOVSI M,TRMOPR
  2843	003640'	206 00 0 00 011021'		MOVSM M,TYODSP
  2844	003641'	136 00 0 00 011020'		IDPB M,TRMPTR	;SWAPPED GIVES US A ZERO TO IDPB
  2845	003642'	201 00 0 00 010762'		MOVEI M,TRMBLK
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 49-1
DSKCLN	MAC	30-Feb-73 19:40	

  2846	003643'	260 17 0 00 003173'		PUSHJ P,TRMMES
  2847	003644'	262 17 0 00 000000 		POP P,M
  2848	003645'	263 17 0 00 000000 		POPJ P,
  2849
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 50
DSKCLN	MAC	30-Feb-73 19:40	

  2850	003646'	200 02 0 00 015057'	NOW:	MOVE T1,[DATITM,,DATTAB]
  2851	003647'	047 02 0 00 000041 		GETTAB T1,
  2852	003650'	474 02 0 00 000000 		SETO	T1,
  2853	003651'	321 02 0 00 003722'		JUMPL T1,NODAT		;DATE NOT YET SET
  2854	003652'	200 03 0 00 015060'		MOVE T2,[TIMITM,,TIMTAB]
  2855	003653'	047 03 0 00 000041 		GETTAB T2,
  2856	003654'	201 03 0 00 000000 		 MOVEI T2,0
  2857	003655'	200 04 0 00 015061'		MOVE T3,[400020,,20]	;CONVERT TO DEC FMT GMT
  2858	003656'	201 05 0 00 000002 		MOVEI T4,T1
  2859	003657'	047 05 0 00 777723 		DATUUO T4,
  2860	003660'	201 05 0 00 000000 		 MOVEI T4,0	;FLAG IF NO DATUUO (TIME NOT GMT)
  2861	003661'	261 17 0 00 000005 		PUSH P,T4	;SAVE FLAG
  2862	003662'	261 17 0 00 000002 		PUSH P,T1	;AND DATE
  2863	003663'	200 02 0 00 000003 		MOVE T1,T2	;GET TIME
  2864	003664'	231 02 0 00 007020 		IDIVI T1,^D3600
  2865	003665'	200 04 0 00 000003 		MOVE T3,T2
  2866	003666'	231 04 0 00 000074 		IDIVI T3,^D60		;SECONDS IN T3
  2867	003667'	231 02 0 00 000074 		IDIVI T1,^D60		;HOURS IN T1, MINUTES IN T2
  2868	003670'	571 05 0 00 777776 		HRREI T4,-2
  2869	003671'	334 10 0 00 015043'		SKIPA CH,[40]
  2870	003672'	201 10 0 00 000072 	NOWLUP:	MOVEI CH,":"
  2871	003673'	260 17 1 00 011021'		PUSHJ P,@TYODSP
  2872	003674'	201 01 0 00 000002 		MOVEI T,2
  2873	003675'	200 06 0 05 000004 		MOVE N,T3(T4)
  2874	003676'	260 17 0 00 003464'		PUSHJ P,DECZRO
  2875	003677'	343 05 0 00 003672'		AOJLE T4,NOWLUP
  2876	003700'	260 17 0 00 003573'		PUSHJ P,SPC
  2877	003701'	260 17 0 00 003573'		PUSHJ P,SPC
  2878	003702'	262 17 0 00 000002 		POP P,T1		;RESTORE DATE
  2879
  2880	003703'	231 02 0 00 000037 	PRDATE:	IDIVI T1,^D31
  2881	003704'	201 06 0 03 000001 		MOVEI N,1(T2)
  2882	003705'	201 01 0 00 000002 		MOVEI T,2
  2883	003706'	260 17 0 00 003464'		PUSHJ P,DECZRO
  2884	003707'	231 02 0 00 000014 		IDIVI T1,^D12
  2885	003710'	200 00 0 03 003727'		MOVE M,MONTAB(T2)
  2886	003711'	201 04 0 00 000000 		MOVEI T3,0
  2887	003712'	260 17 0 00 003566'		PUSHJ P,MSG
  2888	003713'	201 06 0 02 003654 		MOVEI N,^D1964(T1)
  2889	003714'	260 17 0 00 003500'		PUSHJ P,DECPRT
  2890	003715'	262 17 0 00 000002 		POP P,T1		;GMT FLAG
  2891	003716'	336 00 0 00 000002 		SKIPN T1
  2892	003717'	263 17 0 00 000000 		POPJ P,		;NOT GMT
  2893	003720'	265 00 0 00 003566'		JSP M,MSG
  2894	003721'	040 107 115 124 000 		ASCIZ / GMT/
  2895
  2896	003722'	265 00 0 00 003566'	NODAT:	JSP M,MSG
  2897	003723'	040 104 101 124 105 		ASCIZ / DATE NOT RECEIVED/
  2898	003724'	040 116 117 124 040 
  2899	003725'	122 105 103 105 111 
  2900	003726'	126 105 104 000 000 
  2901
  2902
  2903					DEFINE MONMAC(A)<IRP A,<[ASCIZ /-A-/]>>
  2904	003727'				MONTAB: 
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 50-1
DSKCLN	MAC	30-Feb-73 19:40	

  2905					MONMAC<JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC>^IRP 
  2906	003727'	000000	015062'		[ASCIZ /-JAN-/]
  2907	003730'	000000	015064'		[ASCIZ /-FEB-/]
  2908	003731'	000000	015066'		[ASCIZ /-MAR-/]
  2909	003732'	000000	015070'		[ASCIZ /-APR-/]
  2910	003733'	000000	015072'		[ASCIZ /-MAY-/]
  2911	003734'	000000	015074'		[ASCIZ /-JUN-/]
  2912	003735'	000000	015076'		[ASCIZ /-JUL-/]
  2913	003736'	000000	015100'		[ASCIZ /-AUG-/]
  2914	003737'	000000	015102'		[ASCIZ /-SEP-/]
  2915	003740'	000000	015104'		[ASCIZ /-OCT-/]
  2916	003741'	000000	015106'		[ASCIZ /-NOV-/]
  2917	003742'	000000	015110'		[ASCIZ /-DEC-/]
  2918
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 51
DSKCLN	MAC	30-Feb-73 19:40	

  2919					; Here on a critical error.  Build a call to PRTRBL (print file and
  2920					;  error message), then die.
  2921					;
  2922					; Entered with M pointing to ASCIZ string indicating cause of death.
  2923
  2924
  2925	003743'	201 01 0 00 000000 	CRTERM:	MOVEI	T,0			;ERROR IN MFD
  2926	003744'	201 15 0 00 015112'	CRTERR:	MOVEI	P3,[ASCIZ /CRITICAL FILE DAMAGED/]
  2927	003745'	254 00 0 00 003752'		JRST	CRTER1
  2928
  2929	003746'	201 00 0 00 015117'	UFDERR:	MOVEI	M,[ASCIZ /BAD FILE SPEC IN UFD POINTING TO CRITICAL FILE/]
  2930	003747'	254 00 0 00 003752'		JRST	CRTER1
  2931
  2932	003750'	201 00 0 00 015131'	MISCRT: MOVEI	M,[ASCIZ /CRITICAL FILE MISSING/]
  2933	003751'	201 15 0 00 014057'		MOVEI	P3,[0]
  2934
  2935	003752'	201 16 0 00 005530'	CRTER1:	MOVEI	P4,FILRIB
  2936	003753'	200 02 0 01 003161'		MOVE	T1,SYSNAM(T)
  2937	003754'	202 02 0 16 001016 		MOVEM	T1,ERRNAM(P4)
  2938	003755'	200 02 0 01 003166'		MOVE	T1,SYSEXT(T)
  2939	003756'	202 02 0 16 001017 		MOVEM	T1,ERREXT(P4)
  2940	003757'	200 02 0 01 003154'		MOVE	T1,SYSPPN(T)
  2941	003760'	202 02 0 16 001020 		MOVEM	T1,ERRPPN(P4)
  2942	003761'	514 01 0 00 000000 		HRLZ	T,M			;POINTER TO CAUSE OF DEATH STRING
  2943	003762'	200 13 0 00 014123'		MOVE	P1,[POINT 7,TRMBLK]
  2944	003763'	201 02 0 00 003256'		MOVEI	T1,TRMSAV		;DAMAGE TO CRITICAL FILE
  2945	003764'	202 02 0 00 011021'		MOVEM	T1,TYODSP
  2946	003765'	474 06 0 00 000000 		SETO	N,
  2947	003766'	541 01 0 16 001016 		HRRI	T,ERRNAM(P4)
  2948	003767'	260 17 0 00 003365'		PUSHJ	P,PRTRBL
  2949	003770'	260 17 0 00 003610'		PUSHJ	P,CRLF
  2950	003771'	200 00 0 00 000015 		MOVE	M,P3			;MISSING OR DAMAGED MESSAGE
  2951	003772'	260 17 0 00 003566'		PUSHJ	P,MSG
  2952	003773'	201 01 0 00 000000 		MOVEI	T,0
  2953	003774'	136 01 0 00 000013 		IDPB	T,P1
  2954	003775'	201 00 0 00 010762'		MOVEI	M,TRMBLK
  2955	003776'	254 00 0 00 003206'		JRST	FATERR
  2956
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 52
DSKCLN	MAC	30-Feb-73 19:40	

  2957					;SUBROUTINES START HERE
  2958
  2959					;SUBROUTINE TO COMPUTE SIXBIT FOR LOGICAL UNIT WITHIN FILE STRUCTURE
  2960					;ARGS	STRNAM=SIXBIT NAME OF FILE STRUCTURE
  2961					;	U=LOGICAL UNIT IN STR
  2962					;VALUE	CHRBUF=SIXBIT LOGICAL UNIT IN STR
  2963
  2964	003777'	200 03 0 00 010752'	LNAME:	MOVE	T2,STRNAM
  2965	004000'	200 04 0 00 015136'		MOVE	T3,[POINT 6,T2]
  2966	004001'	134 05 0 00 000004 		ILDB	T4,T3
  2967	004002'	326 05 0 00 004001'		JUMPN	T4,.-1		;FIND END OF STR NAME
  2968	004003'	201 05 0 00 000003 		MOVEI	T4,T2
  2969	004004'	302 05 0 04 000000 		CAIE	T4,(T3)
  2970	004005'	254 00 0 00 004020'		JRST	STRLUX
  2971	004006'	200 01 0 00 000012 		MOVE T,U
  2972	004007'	231 01 0 00 000010 		IDIVI	T,10
  2973	004010'	322 01 0 00 004016'		JUMPE	T,STRLU1
  2974	004011'	607 04 0 00 770000 		TLNN T3,770000
  2975	004012'	254 00 0 00 004020'		JRST STRLUX
  2976	004013'	271 01 0 00 000020 		ADDI	T,20
  2977	004014'	137 01 0 00 000004 		DPB	T,T3
  2978	004015'	133 00 0 00 000004 		IBP	T3
  2979	004016'	271 02 0 00 000020 	STRLU1:	ADDI	T1,20
  2980	004017'	137 02 0 00 000004 		DPB	T1,T3
  2981	004020'	202 03 0 00 005450'	STRLUX:	MOVEM	T2,CHRBUF
  2982	004021'	263 17 0 00 000000 		POPJ	P,
  2983
  2984					;READ AND CHECK THE HOME BLOCKS. TRY FIRST BLOCK THEN SECOND
  2985					;IF FIRST IS BAD
  2986
  2987	004022'	200 13 0 00 005470'	HOMCHK:	MOVE P1,CHRBUF+.CHHA	;ADDRESS OF HOME PAGES.
  2988	004023'	260 17 0 00 004031'		PUSHJ P,HOMCK1	;READ THEM AND CHECK
  2989	004024'	254 00 0 00 004027'		 JRST CPOPJ1	;NON-SKIP RETURN SAYS GOOD
  2990	004025'	207 00 0 00 000013 		MOVSS P1	;TRY THE NEXT ONE
  2991	004026'	260 17 0 00 004031'		PUSHJ P,HOMCK1
  2992	004027'	350 00 0 17 000000 	CPOPJ1:	 AOS (P)	;GOOD, TAKE SKIP RETURN TO SAY GOOD
  2993	004030'	263 17 0 00 000000 	CPOPJ:	POPJ P,
  2994
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 53
DSKCLN	MAC	30-Feb-73 19:40	

  2995	004031'	554 02 0 00 000013 	HOMCK1:	HLRZ T1,P1	;GET BLOCK NUMBER TO READ
  2996	004032'	260 17 0 00 004071'		PUSHJ P,PAGRED
  2997	004033'	254 00 0 00 004027'		 JRST CPOPJ1	;BLOCK WAS BAD
  2998	004034'	205 01 0 00 505755 		MOVSI T,'HOM'
  2999	004035'	201 02 0 00 070717 		MOVEI T1,CODHOM
  3000	004036'	316 01 0 00 777000 		CAMN T,BUF+HOMNAM
  3001	004037'	312 02 0 00 777776 		CAME T1,BUF+HOMCOD
  3002	004040'	254 00 0 00 004027'		JRST CPOPJ1	;ONE OF THOSE WAS BAD
  3003	004041'	554 02 0 00 000013 		HLRZ T1,P1
  3004	004042'	137 12 0 00 014451'		DPB U,[POINT PTSUNI,T1,PTNUNI]
  3005	004043'	661 02 0 00 200000 		TLO T1,RBREAL	;AMKE IT A REAL POINTER
  3006	004044'	312 02 0 00 777777 		CAME T1,BUF+HOMSLF
  3007	004045'	254 00 0 00 004027'		JRST CPOPJ1	;SHOULD HAVE OWN BLOCK NUMBER
  3008	004046'	260 17 0 00 003777'		PUSHJ P,LNAME	;GET NAME FOR THIS UNIT IN STR
  3009	004047'	200 01 0 00 010752'		MOVE T,STRNAM
  3010	004050'	200 02 0 00 005450'		MOVE T1,CHRBUF	;NAME OF THIS UNIT
  3011	004051'	316 01 0 00 777002 		CAMN T,BUF+HOMSNM
  3012	004052'	312 02 0 00 777005 		CAME T1,BUF+HOMLOG	;THESE SHOULD AGREE
  3013	004053'	350 00 0 17 000000 		AOS (P)		;THEY DO NOT, SKIP RETURN
  3014	004054'	263 17 0 00 000000 		POPJ P,		;ALL GOOD, OK RETURN
  3015
  3016					;GET SOME OF THE PER UNIT DATA FROM THE HOME BLOCK
  3017
  3018	004055'	200 01 0 00 777015 	HOMCOP:	MOVE T,BUF+HOMSPU	;SATS/UNIT
  3019	004056'	516 01 1 00 010727'		HRLZM T,@PTRDST	;INTO DISK SAT POINTER TABLE
  3020	004057'	200 01 0 00 777007 		MOVE T,BUF+HOMP4S
  3021	004060'	202 01 1 00 010735'		MOVEM T,@PTRSWP	;SAVE SWAPING SPACE
  3022	004061'	200 01 0 00 777013 		MOVE T,BUF+HOMSLP
  3023	004062'	202 01 1 00 010734'		MOVEM T,@PTRSWB	;AND BLOCK TO CHECK SWAP.SYS
  3024	004063'	263 17 0 00 000000 		POPJ P,
  3025
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 54
DSKCLN	MAC	30-Feb-73 19:40	

  3026					;SUBROUTINE TO READ A PAGE
  3027					;ARGS	T1=LOGICAL PAGE WITHIN UNIT TO READ
  3028					;	U=LOGICAL UNIT NUMBER
  3029					;	IOCW=IOWD
  3030					;ENTER AT BLKRD1 IF T1=LOGICAL PAGE WITHIN STR
  3031
  3032	004064'	135 12 0 00 014155'	PAGRDP:	LDB U,[POINT PTSUNI,T,PTNUNI]
  3033	004065'	135 02 0 00 014156'		LDB T1,[POINT PTSPNO,T,PTNPNO]
  3034	004066'	317 12 0 00 006570'		CAMG U,HIGHU
  3035	004067'	311 02 1 00 010732'		CAML T1,@PTRPPU
  3036	004070'	263 17 0 00 000000 		POPJ P,
  3037	004071'	200 03 0 00 010754'	PAGRED:	MOVE	T2,STRPPU	;PAGES PER UNIT IN STR
  3038	004072'	220 03 0 00 000012 		IMUL	T2,U		;PAGE NUM OF 1ST PAGE ON UNIT
  3039	004073'	270 02 0 00 000003 		ADD	T1,T2		;T1=LOGICAL PAGE WITHIN STR
  3040
  3041					;[37] replace old-style i/o with mapping (and pre-referencing for UFDPRC)
  3042					;[37] 	HRLI	CHAN,CIO.ST	;CHANIO SETSTS.
  3043					;[37] 	CHANIO CHAN,16
  3044					;[37] 	HRLI	CHAN,CIO.PI	;CHANIO PAGE USETI.
  3045					;[37]	CHANIO CHAN,T1
  3046					;[37]	HRLI	CHAN,CIO.IN	;CHANIO IN.
  3047					;[37]	CHANIO CHAN,IOCW
  3048					;[37]IFN MAKSW,<JRST PAGOT1>
  3049					;[37]IFE MAKSW,<JRST CPOPJ1>	;GOOD
  3050					;[37]	HRLI	CHAN,CIO.ST	;CHANIO SETSTS.
  3051					;[37]	CHANIO CHAN,16
  3052					;[37]IFN MAKSW,<JRST PAGOUT>
  3053					;[37]IFE MAKSW,<POPJ	P,>		;ERROR RETURN
  3054
  3055	004074'	202 02 0 00 006577'		movem t1,lstbuf#	;[40] remember disk page now mapped to buf
  3056	004075'	201 03 0 00 000777 		movei	t2,bufpag	;[37] blow this page away
  3057	004076'	505 03 0 00 000001 		hrli	t2,1		;[37] but just this one
  3058	004077'	047 03 0 00 777712 		vclear	t2,		;[37] goodbye
  3059	004100'	260 17 0 00 004150'		 PUSHJ	P,PAGERR	;[37] oops...
  3060	004101'	505 03 0 00 006001 		hrli	t2,(.prrw!1B17)	;[37] read/write when fixing
  3061	004102'	336 00 0 00 006557'		skipn fixflg		;[40] doing fixup operation?
  3062	004103'	505 03 0 00 002001 		 hrli	t2,(.prro!1B17)	;[40] no, mapping should be read-only
  3063	004104'	202 03 0 00 006600'		movem	t2,mapwd	;[37] stash VP info
  3064	004105'	316 02 1 00 010737'		camn	t1,@ptrunu	;[37] map/pre-ref in prog for this page?
  3065	004106'	254 00 0 00 004114'		 jrst	xchptr		;[37] yes, go make BUF point there
  3066	004107'	505 11 0 00 000043 		hrli	chan,.chsmp	;[37] set to super-map to BUFPAG
  3067	004110'	202 02 0 00 006601'		movem	t1,mapwd+1	;[37] stash disk source page
  3068	004111'	043 11 0 00 006600'		chanio	chan,mapwd	;[37] ask God for it
  3069	004112'	260 17 0 00 004150'		 PUSHJ	P,PAGERR	;[37] we lost, puke
  3070	004113'	254 00 0 00 004127'		jrst	tchbuf		;[37] we won, go touch it
  3071
  3072					;[37] here to replicate a page previously mapped and pre-referenced
  3073	004114'	261 17 0 00 000002 	xchptr:	push	p,t1		;[37] somebody somewhere may depend on this
  3074	004115'	200 02 1 00 010740'		move	t1,@ptrupg	;[37] get the source addr
  3075	004116'	336 00 1 00 010731'		skipn	@ptrpge		;[37] have we seen a harware i/o error?
  3076	004117'	254 00 0 00 004122'		 jrst	pagok		;[37] no
  3077	004120'	262 17 0 00 000002 		pop	p,t1
  3078	004121'	254 00 0 00 004140'		jrst	prvbuf		;[37] go make private BUF
  3079
  3080	004122'				pagok:				;[37] here to copy page
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 54-1
DSKCLN	MAC	30-Feb-73 19:40	

  3081	004122'	202 02 0 00 006601'		movem	t1,mapwd+1	;[37] stash
  3082	004123'	201 03 0 00 006600'		movei	t2,mapwd	;[37] remember where
  3083	004124'	047 03 0 00 777714 		vreplc	t2,		;[37] ask to replicate
  3084	004125'	260 17 0 00 004150'		 PUSHJ	P,PAGERR		;[37] lost, go see why
  3085	004126'	262 17 0 00 000002 		pop	p,t1		;[37] somebody may want this
  3086	004127'	402 00 0 00 005410'	tchbuf:	setzm	bfeflg		;[37] be sure error flag not set
  3087	004130'	200 03 0 00 777000 		move	t2,buf		;[37] touch the page
  3088	004131'	336 00 0 00 005410'		skipn	bfeflg		;[37] did it cause an error?
  3089	004132'	254 00 0 00 004027'		 jrst	cpopj1		;[37] no, skip-return, all OK
  3090	004133'	402 00 0 00 005410'		setzm	bfeflg		;[37] yes, reset flag
  3091	004134'	201 01 0 00 000777 		movei	t,bufpag	;[37] blow it away
  3092	004135'	505 01 0 00 000001 		hrli	t,1		;[37] only one
  3093	004136'	047 01 0 00 777712 		vclear	t,		;[37] just to be sure
  3094	004137'	255 00 0 00 000000 		 jfcl			;[37] ignore
  3095	004140'	201 01 0 00 000777 	prvbuf:	movei	t,bufpag	;[37] get it again in case of vclear error
  3096	004141'	505 01 0 00 004001 		hrli	t,(.prcw!1b17)	;[37] make private page, cow only one
  3097	004142'	047 01 0 00 777711 		vcreat	t,		;[37] thusly
  3098	004143'	260 17 0 00 004150'		 PUSHJ	P,PAGERR		;[37] dumb programmer
  3099	004144'	505 01 0 00 002001 		hrli	t,(ps.ner!1b17)	;[37] set to ignore page errors
  3100	004145'	047 01 0 00 777706 		perset	t,		;[37] thusly
  3101	004146'	260 17 0 00 004150'		 PUSHJ	P,PAGERR		;[37] dumb programmer
  3102	004147'	263 17 0 00 000000 		popj	p,		;[37] and error return
  3103	
  3104
  3105	004150'				pagerr:	movei m,[asciz \
  3106	004150'	201 00 0 00 015137'	PC = \]
  3107	004151'	260 17 0 00 003173'		pushj p,trmmes
  3108	004152'	262 17 0 00 000006 		pop p,n		;[40] get caller's PC
  3109	004153'	260 17 0 00 003512'		pushj p,octcty
  3110						movei	m,[asciz \
  3111					??Fatal Error Return from UUO detected!!
  3112	004154'	201 00 0 00 015141'	\]
  3113	004155'	254 00 0 00 004214'		jrst	oldone		;[41] complain and try to run prev ver
  3114
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 55
DSKCLN	MAC	30-Feb-73 19:40	

  3115					;[37] interrupt handler for hardware page errors
  3116					;[37] if BUF caused the page error interrupt
  3117					;[37] 	then set flag saying BUF is bad and map a private page to BUF
  3118					;[37] 	else if a disk cache page caused the interrupt
  3119					;[37] 		then mark the page bad and map a private page there
  3120					;[37] 		else fatal paging error - probably sick hardware
  3121
  3122	004156'	261 17 0 00 000012 	errint:	push	p,u		;[37] save some ACs
  3123	004157'	261 17 0 00 000003 		push	p,t2		;[37] 
  3124	004160'	261 17 0 00 000002 		push	p,t1		;[37] 
  3125	004161'	261 17 0 00 000001 		push	p,t		;[37] 
  3126	004162'	201 01 0 00 000002 		movei	t,t1		;[37] where to stash 'em
  3127	004163'	505 01 0 00 777776 		hrli	t,-2		;[37] want both page-error status wds
  3128	004164'	047 01 0 00 777700 		pgests	t,		;[37] ask for 'em
  3129	004165'	255 00 0 00 000000 		 jfcl			;[37] ignore errors
  3130	004166'	550 01 0 00 000002 		hrrz	t,t1		;[37] offending virtual page number
  3131	004167'	306 01 0 00 000777 		cain	t,bufpag	;[37] is it BUF?
  3132	004170'	254 00 0 00 004200'		 jrst	errit1		;[37] 
  3133	004171'	200 12 0 00 006570'		move	u,highu		;[37] set to index and loop
  3134	004172'	316 01 1 00 010740'		camn	t,@ptrupg	;[37] is it from a pre-reference?
  3135	004173'	254 00 0 00 004176'		 jrst	errit2		;[37] yes, handle
  3136	004174'	365 12 0 00 004172'		sojge	u,.-2		;[37] check all units
  3137
  3138	004175'	254 00 0 00 003213'		jrst	pioerr		;[37] offending page not from BUF or the
  3139									;[37] disk cache - fatal error, probably
  3140									;[37] sick hardware.
  3141
  3142	004176'				errit2:				;[37] here to handle error from pre-ref
  3143	004176'	476 00 1 00 010731'		setom	@ptrpge		;[37] mark it bad
  3144	004177'	334 00 0 00 000000 		skipa
  3145	004200'	476 00 0 00 005410'	errit1:	setom	bfeflg#		;[37] flag error inputting to BUF
  3146	004201'	505 01 0 00 000001 		hrli	t,1		;[37] set to blow away a page
  3147	004202'	047 01 0 00 777712 		vclear	t,		;[37] just to be sure it's gone
  3148	004203'	255 00 0 00 000000 		 jfcl			;[37] ignore errors
  3149	004204'	505 01 0 00 004001 		hrli	t,(.prcw!1b17)	;[37] make a private page there
  3150	004205'	047 01 0 00 777711 		vcreat	t,		;[37] thusly
  3151	004206'	260 17 0 00 004150'		 PUSHJ	P,PAGERR		;[37] dumb programmer
  3152	004207'	262 17 0 00 000001 		pop	p,t		;[37] restore saved ACs
  3153	004210'	262 17 0 00 000002 		pop	p,t1		;[37] 
  3154	004211'	262 17 0 00 000003 		pop	p,t2		;[37] 
  3155	004212'	262 17 0 00 000012 		pop	p,u		;[37] 
  3156	004213'	047 00 0 00 777755 		dismis			;[37] and go back to whatever
  3157
  3158
  3159					;here to die with instructions to try old version of dskcln.
  3160	004214'				oldone:	movei m,[asciz \
  3161					%% Attempting to run previous version of DSKCLN...
  3162					%% Notify Operating Systems.
  3163	004214'	201 00 0 00 015152'	\]
  3164	004215'	260 17 0 00 003173'		pushj p,trmmes
  3165						movei t,[sixbit \SYS\
  3166							 sixbit \DSKCLN\
  3167							 sixbit \S36\
  3168							 z
  3169							 z
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 55-1
DSKCLN	MAC	30-Feb-73 19:40	

  3170	004216'	201 01 0 00 015173'			 z]
  3171	004217'	047 01 0 00 000035 		run t,
  3172						 movei m,[asciz \
  3173
  3174					??Can't Run Old DSKCLN. Call Tymcom-X Software Support.
  3175
  3176	004220'	201 00 0 00 015201'	\]
  3177	004221'	254 00 0 00 003206'		jrst faterr
  3178
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 56
DSKCLN	MAC	30-Feb-73 19:40	

  3179					;[37] PAGWRT - routine to force bufpag out to disk, assuming it is 
  3180					;[37] 	       already super-mapped read-write.  check to be sure
  3181					;[40] 	       that the page wanted to be written is the same one that
  3182					;[40] 	       was last mapped by pagred, otherwise things are really
  3183					;[40] 	       screwed. (the great leap of faith that every program must have)
  3184					;[37] 
  3185					;[37] entry pagwrt: enter with U/unit number  
  3186					;[37] 			       T1/ logical page on unit in U
  3187					;[37] entry pagwtp: enter with T/RIB pointer to disk page
  3188					;[37] 
  3189					;[37] returns +1 success
  3190					;[37] never returns if error - complains and dies thruogh FATERR
  3191					;[37] destroys T2 always - destroys T1 and U from pagwtp entry
  3192					;[37] 
  3193					;[40] VALPAG contents of BUF, after checking consistency with last 
  3194					;[40] pagred.  desired disk page should have been mapped by PAGRED
  3195					;[40] with read/write protection.  if we are trying to write a disk
  3196					;[40] page that is other than what was last mapped by PAGRED, then 
  3197					;[40] things are really screwed up because we just scribbled on the
  3198					;[40] wrong disk page!  when VALPAGing, wait to be sure there are no I/O
  3199					;[40] errors.  If the page is the correct one, and there are no I/O
  3200					;[40] errors, non-skip return.  If God is not on our side, and anything
  3201					;[40] smells bad, complain and die.
  3202
  3203					ife debug,<
  3204	004222'	135 12 0 00 014155'	PAGWTP:	LDB	U,[POINT PTSUNI,T,PTNUNI]
  3205	004223'	135 02 0 00 014156'		LDB	T1,[POINT PTSPNO,T,PTNPNO]
  3206	004224'	317 12 0 00 006570'		CAMG	U,HIGHU
  3207	004225'	311 02 1 00 010732'		CAML	T1,@PTRPPU
  3208	004226'	263 17 0 00 000000 		POPJ	P,
  3209	004227'				PAGWRT:
  3210					;[37] IFE MAKSW,<
  3211	004227'	200 03 0 00 010754'		MOVE	T2,STRPPU	; make it be logical page in structure
  3212	004230'	220 03 0 00 000012 		IMUL	T2,U
  3213	004231'	270 02 0 00 000003 		ADD 	T1,T2
  3214
  3215					;[37] rip out the old-style and put in pagining
  3216					;[37] 	HRLI	CHAN,CIO.ST	;CHANIO SETSTS.
  3217					;[37] 	CHANIO	CHAN,16
  3218					;[37] 	HRLI	CHAN,CIO.PO	;CHANIO PAGE USETO.
  3219					;[37] 	CHANIO	CHAN,T1
  3220					;[37] 	HRLI	CHAN,CIO.OT	;CHANIO OUT.
  3221					;[37] 	CHANIO	CHAN,IOCW
  3222					;[37] 	POPJ	P,		;ALL OK
  3223
  3224	004232'	312 02 0 00 006577'		came t1,lstbuf		;[40] want to write to same page as now mapped?
  3225	004233'	254 00 0 00 004240'		 jrst wrtfat		;[40] sad if no
  3226	004234'	200 03 0 00 015216'		move t2,[vl.wat!cnt1!bufpag]	;[40] set to validate this page only
  3227	004235'	047 03 0 00 777702 		valpag	t2,		;[37] ask for it, waiting for dirty pgs
  3228	004236'	254 00 0 00 004243'		 jrst	wrterr		;[37] check for i/o error
  3229	004237'	263 17 0 00 000000 		popj	p,		;[37] all OK, normal return
  3230
  3231	004240'				wrtfat:	movei m,[asciz \
  3232					??Fatal Error...  Aborting.
  3233					Entered PAGWRT With Output Page Not Equal To Disk Page Last Mapped!!
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 56-1
DSKCLN	MAC	30-Feb-73 19:40	

  3234					Contact Operating Systems.
  3235	004240'	201 00 0 00 015217'	\]
  3236	004241'	260 17 0 00 003173'		pushj p,trmmes		;[40] complain about it
  3237	004242'	254 00 0 00 004214'		jrst oldone		;[40] and tell 'em to run the old one.
  3238
  3239	004243'	550 01 0 00 000003 	wrterr:	hrrz	t,t2		;[37] error code
  3240	004244'	302 01 0 00 000005 		caie	t,vlioe%	;[37] i/o error occurred?
  3241						 jrst  [movei m,[asciz \VALPAG ERROR CODE = \]
  3242							pushj p,trmmes
  3243							move n,t
  3244							pushj p,octcty
  3245	004245'	254 00 0 00 015256'			PUSHJ	P,PAGERR]	;[37] no, something strange
  3246
  3247					;[37] here on an output error - complain and die through FATERR
  3248					;[37] alternate entry PG%.ER to complain and die with t1/offending page number
  3249	004246'	201 00 0 00 015263'	 	MOVEI	M,[ASCIZ /PAGE WRITE ERROR, UNIT # /]
  3250	004247'	260 17 0 00 003566'	 	PUSHJ	P,MSG
  3251	004250'	200 06 0 00 000012 	 	MOVE	N,U
  3252	004251'	260 17 0 00 003501'		PUSHJ	P,OCTPRT
  3253	004252'	201 00 0 00 015271'	pg%.er:	MOVEI	M,[ASCIZ/, PAGE # /]
  3254	004253'	260 17 0 00 003566'		PUSHJ	P,MSG
  3255					;[40] 	MOVE	N,T1
  3256	004254'	550 06 0 00 000002 		hrrz n,t1		;[40] want page num only, not paging flags
  3257	004255'	260 17 0 00 003501'		PUSHJ	P,OCTPRT
  3258	004256'	200 00 0 00 015273'		MOVE	M,[ASCIZ/ (WITHIN STR)/]
  3259	004257'	254 00 0 00 003206'		JRST	FATERR
  3260					;[37] >;END IFE MAKSW
  3261					;[37] IFN MAKSW,<JRST	PAGOUT>
  3262					>; end ife debug
  3263
  3264					ifn debug,<
  3265					pagwtp:
  3266					pagwrt:	popj	p,
  3267					>;[37] end ifn debug - if debugging, don't ever try to write
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 57
DSKCLN	MAC	30-Feb-73 19:40	

  3268					;[37] IFN MAKSW,<
  3269					;[37] PAGOT1:	AOS	(P)
  3270					;[37] PAGOUT:	PUSH	P,T
  3271					;[37] 	HRLZ T,BLKCNT
  3272					;[37] 	JUMPGE T,NEWBLK
  3273					;[37] SRBLP:	CAMN T1,BLKCNT+1(T)
  3274					;[37] 	JRST	[POP P,T
  3275					;[37] 		 POPJ P,]
  3276					;[37] 	AOBJN T,SRBLP
  3277					;[37] NEWBLK:	MOVEM T1,BLKCNT+1(T)
  3278					;[37] 	MOVE	T1,[CIO.PO,,FIL] ;CIO.PO=CHANIO PAGE USETO.
  3279					;[37] 	ADDI T,FILOFS+1
  3280					;[37] 	CHANIO T1,T
  3281					;[37] 	OUTPUT FIL,IOCW
  3282					;[37] 	STATZ FIL,760000
  3283					;[37] 	JRST BADFIL
  3284					;[37] 	SOS T,BLKCNT
  3285					;[37] 	CAMLE T,[-FILSIZ]
  3286					;[37] 	JRST	[POP P,T
  3287					;[37] 		 POPJ P,]
  3288					;[37] 	OUTSTR [ASCIZ /TOO MANY PAGES/]
  3289					;[37] 	POP	P,T
  3290					;[37] 	JRST QUIT
  3291					;[37] 
  3292					;[37] BADFIL:	OUTSTR [ASCIZ /BAD OUTPUT FILE/]
  3293					;[37] 	POP	P,T
  3294					;[37] 	JRST QUIT
  3295					;[37] 
  3296					;[37] OUTDIR:	USETO FIL,1
  3297					;[37] 	OUTPUT FIL,TABCMD
  3298					;[37] 	POPJ P,>
  3299
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 58
DSKCLN	MAC	30-Feb-73 19:40	

  3300					;[37] IFN DEBUG,<
  3301					;[37] PAGRDP:	LDB U,[POINT PTSUNI,T,PTNUNI]
  3302					;[37] 	LDB T1,[POINT PTSPNO,T,PTNPNO]
  3303					;[37] 	CAMG U,HIGHU
  3304					;[37] 	CAML T1,@PTRPPU
  3305					;[37] 	POPJ P,
  3306					;[37] PAGRED:	PUSH	P,T
  3307					;[37] 	MOVE T2,STRPPU
  3308					;[37] 	IMUL T2,U
  3309					;[37] 	ADD T1,T2
  3310					;[37] 	HRLZ T,BLKCNT
  3311					;[37] 	CAME T1,BLKCNT+1(T)
  3312					;[37] 	AOBJN T,.-1
  3313					;[37] 	JUMPGE T,NOBLK
  3314					;[37] 	MOVEI T,FILOFS+1(T)
  3315					;[37] 	MOVE	T1,[CIO.PI,,FIL] ;CIO.PI=CHANIO PAGE USETI.
  3316					;[37] 	CHANIO T1,T
  3317					;[37] 	IN FIL,IOCW
  3318					;[37] 	JRST	[POP P,T
  3319					;[37] 		 JRST CPOPJ1]
  3320					;[37] 	SETSTS FIL,16
  3321					;[37] 	POP	P,T
  3322					;[37] 	POPJ P,
  3323					;[37] 
  3324					;[37] PAGWTP:	LDB U,[POINT PTSUNI,T,PTNUNI]
  3325					;[37] 	LDB T1,[POINT PTSPNO,T,PTNPNO]
  3326					;[37] 	CAMG U,HIGHU
  3327					;[37] 	CAML T1,@PTRPPU
  3328					;[37] 	POPJ P,
  3329					;[37] PAGWRT:	PUSH	P,T
  3330					;[37] 	MOVE T2,STRPPU
  3331					;[37] 	IMUL T2,U
  3332					;[37] 	ADD T1,T2
  3333					;[37] 	HRLZ T,BLKCNT
  3334					;[37] 	CAME T1,BLKCNT+1(T)
  3335					;[37] 	AOBJN T,.-1
  3336					;[37] 	JUMPGE T,NOBLK
  3337					;[37] 	MOVEI T,FILOFS+1(T)
  3338					;[37] 	MOVE	T1,[CIO.PO,,FIL] ;CIO.PO=CHANIO PAGE USETO.
  3339					;[37] 	CHANIO T1,T
  3340					;[37] 	OUT FIL,IOCW
  3341					;[37] 	JRST	[POP P,T
  3342					;[37] 		 POPJ P,]
  3343					;[37] 	OUTSTR [ASCIZ /BLOCK WRITE ERROR/]
  3344					;[37] 	POP	P,T
  3345					;[37] 	JRST QUIT0
  3346					;[37] NOBLK:	OUTSTR [ASCIZ /BLOCK NOT IN SIMULATION/]
  3347					;[37] 	POP	P,T
  3348					;[37] 	JRST QUIT
  3349					;[37] >
  3350
  3351
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 59
DSKCLN	MAC	30-Feb-73 19:40	

  3352					;READ AND CHECK A RIB
  3353					;ARGS	T=STR BLOCK NUMBER OF FIRST RIB
  3354					;	SKIP RETURN IF OK
  3355
  3356	004260'	603 01 0 00 200000 	RIBCHK:	TLNE T,RBREAL
  3357	004261'	260 17 0 00 004064'		PUSHJ P,PAGRDP
  3358						 JRST [MOVEI M,[ASCIZ/READ ERROR FOR RIB/]
  3359	004262'	254 00 0 00 015302'			POPJ P,]
  3360	004263'	201 02 0 00 666666 		MOVEI T1,CODRIB
  3361	004264'	316 01 0 00 777777 		CAMN T,BUF+RIBSLF
  3362	004265'	312 02 0 00 777776 		 CAME T1,BUF+RIBCOD	;SIMPLE ERROR CHECKS
  3363						  JRST [MOVEI M,[ASCIZ/BAD RIBCOD/]
  3364	004266'	254 00 0 00 015307'			POPJ P,]
  3365	004267'	254 00 0 00 004027'		JRST CPOPJ1	;ALL OK
  3366
  3367					;DO A COMPLETE CHECK OF A RIB. BLOCK NUMBER IN T (
  3368
  3369	004270'	201 00 0 00 015311'	FULRBC:	MOVEI M,[ASCIZ/BAD DATA IN RIB/]	; SETUP DEFAULT ERROR TEXT
  3370	004271'	260 17 0 00 004260'		PUSHJ P,RIBCHK	;READ AND MAKE PRELIMINARY CHECKS
  3371	004272'	263 17 0 00 000000 		 POPJ P,		;BAD
  3372	004273'	200 01 0 16 001016 		MOVE T,ERRNAM(P4)
  3373	004274'	200 02 0 16 001020 		MOVE T1,ERRPPN(P4)
  3374	004275'	316 01 0 00 777005 		CAMN T,BUF+RIBNAM
  3375	004276'	312 02 0 00 777004 		CAME T1,BUF+RIBPPN	;CHECK ANME, EXT AND PPN
  3376	004277'	263 17 0 00 000000 		POPJ P,
  3377	004300'	510 01 0 16 001017 		HLLZ T,ERREXT(P4)
  3378	004301'	510 02 0 00 777006 		HLLZ T1,BUF+RIBEXT
  3379	004302'	336 00 0 00 777000 		SKIPN BUF+RIBRIB
  3380	004303'	312 01 0 00 000002 		CAME T,T1
  3381	004304'	263 17 0 00 000000 		POPJ P,
  3382	004305'	402 00 0 16 001022 		SETZM SIZRIB(P4)
  3383	004306'	402 00 0 16 001023 		SETZM ALCRIB(P4)
  3384	004307'	350 00 0 16 001023 		AOS ALCRIB(P4)
  3385	004310'	260 17 0 00 004314'		PUSHJ P,COPTR	;SAVE RIB BLOCK AND SET FULBLK
  3386	004311'	260 17 0 00 004320'		PUSHJ P,SETPTR	;SET UP POINTERS TO RET INFO
  3387	004312'	350 00 0 17 000000 		AOS (P)	;DOES, OK
  3388	004313'	263 17 0 00 000000 		POPJ P,
  3389
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 60
DSKCLN	MAC	30-Feb-73 19:40	

  3390					;SUBROUTINE TO COPY POINTERS INTO SAVE RIB SLOT
  3391					;ARG	P4=ARD OF CORE BLOCK
  3392
  3393	004314'	201 01 0 16 000005 	COPTR:	MOVEI T,SAVRIB(P4)
  3394	004315'	505 01 0 00 777000 		HRLI T,BUF
  3395	004316'	251 01 0 16 001004 		BLT T,SAVRIB+777(P4)
  3396	004317'	263 17 0 00 000000 		POPJ P,
  3397
  3398					;SUBROUTINE TO SET UP DEVRSU ETC. TO POINT TO STARTING POINT
  3399					;OF RIB POINTERS SAVED
  3400					;ARG	P4=CORE BLOCK
  3401
  3402	004320'	200 01 0 00 015315'	SETPTR:	MOVE T,[-RBLVPR,,RIBPFS]
  3403	004321'	332 00 0 16 000005 		SKIPE SAVRIB+RIBRIB(P4)
  3404	004322'	200 01 0 00 015316'		MOVE T,[-RBLVSR,,RIBSFS]
  3405	004323'	271 01 0 16 000005 		ADDI T,SAVRIB(P4)
  3406	004324'	202 01 0 16 001005 		MOVEM T,DEVRSU(P4)
  3407	004325'	476 00 0 16 001006 		SETOM DEVREL(P4)
  3408	004326'	263 17 0 00 000000 		POPJ P,
  3409
  3410					;SUBROUTINE TO RETURN NEXT POINTER FROM THE RIB
  3411					;ARG P4=ADDRESS OF CORE BLOCK
  3412					;FAIL RETURN IS TAKEN ONLY IF THE UNIT AND PAGE VALUES IN AN
  3413					;OBTAINED PNTR ARE TOO LARGE.
  3414					;ALL OTHERS(HOLES, SPARES, REAL IN BOUNDS) TAKE THE SUCCESS
  3415					;RETURN, INCLUDING T/0 ON OUT OF PNTRS.
  3416
  3417	004327'	350 00 0 16 001006 	GETBLK:	AOS DEVREL(P4)
  3418	004330'	331 02 0 16 001005 		SKIPL	T1,DEVRSU(P4)	;GET T1/ AOBJN PNTR TO RET PNTR.
  3419	004331'	254 00 0 00 004350'		JRST	NOPTR
  3420	004332'	200 01 0 02 000000 		MOVE	T,(T1)		;GET T/ POSSIBLE RET PNTR.
  3421	004333'	253 02 0 00 004334'		AOBJN	T1,.+1		;INCREMENT THE AOBJN
  3422	004334'	202 02 0 16 001005 		MOVEM	T1,DEVRSU(P4)	;PNTR IN DEVRSU.
  3423	004335'	322 02 0 00 004350'		JUMPE T1,NOPTR
  3424	004336'	202 01 0 16 000001 		MOVEM T,NXTPTR(P4)
  3425	004337'	607 01 0 00 200000 		TLNN T,RBREAL
  3426	004340'	254 00 0 00 004027'		JRST CPOPJ1
  3427	004341'	135 12 0 00 014155'		LDB U,[POINT PTSUNI,T,PTNUNI]
  3428	004342'	313 12 0 00 006570'		CAMLE U,HIGHU
  3429	004343'	263 17 0 00 000000 		POPJ P,
  3430	004344'	135 02 0 00 014156'		LDB T1,[POINT PTSPNO,T,PTNPNO]
  3431	004345'	315 02 1 00 010732'		CAMGE T1,@PTRPPU
  3432	004346'	350 00 0 17 000000 		AOS (P)
  3433	004347'	263 17 0 00 000000 		POPJ P,
  3434
  3435	004350'	201 01 0 00 000000 	NOPTR:	MOVEI T,0
  3436	004351'	254 00 0 00 004027'		JRST CPOPJ1
  3437
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 61
DSKCLN	MAC	30-Feb-73 19:40	

  3438					;CODE TO MARK BITS IN SAT BLOCKS
  3439					;RIB PTR IN T1, POINTER TO SAT TABLE IN T
  3440
  3441					;TEST BIT, SKIP RETURN IF BIT IS OFF
  3442
  3443	004352'	135 12 0 00 014451'	TSTZRO:	LDB U,[POINT PTSUNI,T1,PTNUNI]
  3444	004353'	135 02 0 00 015317'		LDB T1,[POINT PTSPNO,T1,PTNPNO]
  3445	004354'	231 02 0 00 000044 		IDIVI T1,^D36
  3446	004355'	270 02 1 00 000001 		ADD T1,@T	;NOW HAVE WORD ADDRESS
  3447	004356'	200 01 0 00 000002 		MOVE T,T1	;AND BIT NUMBER IN T2
  3448	004357'	213 00 0 00 000003 		MOVNS T2
  3449	004360'	205 02 0 00 400000 		MOVSI T1,(1B0)
  3450	004361'	242 02 0 03 000000 		LSH T1,(T2)	;NOW HAVE BIT POSITIONED
  3451	004362'	616 02 0 01 000000 		TDNN T1,(T)	;TEST BIT
  3452	004363'	350 00 0 17 000000 		AOS (P)
  3453	004364'	263 17 0 00 000000 		POPJ P,
  3454
  3455					;SET BIT 0, SKIP IF BIT WAS A 1
  3456
  3457	004365'	260 17 0 00 004352'	MRKZRO:	PUSHJ P,TSTZRO
  3458	004366'	350 00 0 17 000000 		 AOS (P)		;BIT WAS A 1, SKIP RETURN
  3459	004367'	412 02 0 01 000000 		ANDCAM T1,(T)	;MAKE SURE BIT IS OFF
  3460	004370'	263 17 0 00 000000 		POPJ P,
  3461
  3462					;SET BIT 1, SKIP IF BIT WAS A 0
  3463
  3464	004371'	260 17 0 00 004352'	MRKONE:	PUSHJ P,TSTZRO
  3465	004372'	334 00 0 00 000000 		 SKIPA
  3466	004373'	350 00 0 17 000000 		AOS (P)	;BIT WAS A 0
  3467	004374'	436 02 0 01 000000 		IORM T1,(T)	;MARK IT A 1
  3468	004375'	263 17 0 00 000000 		POPJ P,
  3469
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 62
DSKCLN	MAC	30-Feb-73 19:40	

  3470					;CHECK BAT BLOCKS
  3471
  3472	004376'	200 12 0 00 006570'	CHKBAT:	MOVE U,HIGHU
  3473	004377'	200 13 0 00 005471'	BATUNI:	MOVE P1,CHRBUF+.CHBA
  3474	004400'	260 17 0 00 004437'		PUSHJ P,CKBAT1
  3475	004401'	254 00 0 00 004406'		 JRST DOBAT	;THIS BAT BLOCK IS OK
  3476	004402'	207 00 0 00 000013 		MOVSS P1	;TRY OTHER ONE
  3477	004403'	260 17 0 00 004437'		PUSHJ P,CKBAT1
  3478	004404'	254 00 0 00 004406'		 JRST DOBAT	;OK, USE IT
  3479	004405'	254 00 0 00 004434'		JRST BATUDN	;BOTH BAD, JUST IGNORE
  3480	004406'	201 13 0 00 777000 	DOBAT:	MOVEI P1,BUF
  3481	004407'	270 13 0 13 000001 		ADD P1,BATFIR(P1)
  3482	004410'	336 00 0 13 000000 	BATUN1:	SKIPN (P1)	;ZERO AT END OF LIST
  3483	004411'	254 00 0 00 004434'		JRST BATUDN	;DONE WITH THIS UNIT
  3484	004412'	135 14 0 00 004436'		LDB P2,BAYNBB	;NUMBER BAD (-1) IN THIS REGION
  3485	004413'	200 02 0 13 000001 	NXTBBK:	MOVE T1,BATELB(P1)
  3486	004414'	271 02 0 14 000000 		ADDI T1,(P2)
  3487	004415'	311 02 1 00 010732'		CAML T1,@PTRPPU
  3488	004416'	254 00 0 00 004431'		JRST BATBK2		;IGNORE BLOCKS TOO HIGH
  3489	004417'	137 12 0 00 014451'		DPB U,[POINT PTSUNI,T1,PTNUNI]
  3490	004420'	261 17 0 00 000002 		PUSH P,T1
  3491	004421'	200 01 0 00 010730'		MOVE T,PTROST
  3492	004422'	260 17 0 00 004365'		PUSHJ P,MRKZRO	;MARK IN OUT SAT
  3493	004423'	254 00 0 00 004430'		 JRST BATBKD	;WAS MARKED, DO NOT MARK IN DSK SAT IN CASE FREE
  3494	004424'	200 02 0 17 000000 		MOVE T1,(P)	;BECAUSE THAT WOULD CAUSE LOST PAGES MSG.
  3495	004425'	200 01 0 00 010727'		MOVE T,PTRDST	;IN DISK SAT
  3496	004426'	260 17 0 00 004365'		PUSHJ P,MRKZRO
  3497	004427'	255 00 0 00 000000 		 JFCL
  3498	004430'	262 17 0 00 000002 	BATBKD:	POP P,T1
  3499	004431'	365 14 0 00 004413'	BATBK2:	SOJGE P2,NXTBBK	;DO IT FOR ALL IN THIS REGION
  3500	004432'	252 13 0 00 004434'		AOBJP P1,BATUDN	;DONE WHEN RUN OUT OF ROOM
  3501	004433'	253 13 0 00 004410'		AOBJN P1,BATUN1	;DO MORE IF MORE THERE (2 WORDS/ENTRY)
  3502	004434'	365 12 0 00 004377'	BATUDN:	SOJGE U,BATUNI	;TRY NEXT UNIT
  3503	004435'	263 17 0 00 000000 		POPJ P,
  3504
  3505	004436'	33 11 0 13 000000 	BAYNBB:	POINT BASNBB,BATNBB(P1),BANNBB	;HERE IS WHERE NUMBER OF BAD BLOCKS IN REGION LIVES
  3506
  3507	004437'	554 02 0 00 000013 	CKBAT1:	HLRZ T1,P1
  3508	004440'	260 17 0 00 004071'		PUSHJ P,PAGRED
  3509	004441'	254 00 0 00 004027'		 JRST CPOPJ1
  3510	004442'	205 01 0 00 424164 		MOVSI T,'BAT'
  3511	004443'	201 02 0 00 505050 		MOVEI T1,CODBAT
  3512	004444'	316 01 0 00 777000 		CAMN T,BUF+BATNAM	;CHECK CONSISTANCY
  3513	004445'	312 02 0 00 777776 		CAME T1,BUF+BATCOD
  3514	004446'	254 00 0 00 004027'		JRST CPOPJ1	;NO GOOD
  3515	004447'	554 02 0 00 000013 		HLRZ T1,P1
  3516	004450'	137 12 0 00 014451'		DPB U,[POINT PTSUNI,T1,PTNUNI]
  3517	004451'	661 02 0 00 200000 		TLO T1,RBREAL	;TURN IT INTO A POINTER
  3518	004452'	312 02 0 00 777777 		CAME T1,BUF+BATSLF
  3519	004453'	350 00 0 17 000000 		AOS (P)
  3520	004454'	263 17 0 00 000000 		POPJ P,
  3521
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 63
DSKCLN	MAC	30-Feb-73 19:40	

  3522					;HERE TO GO THROUGH ALL THE CLUSTER IN ORDER IN THE SAT TABLES
  3523					;P4 CONTAINS A POINTER TO A DRIVER TABLE
  3524					;	(P4) POINTER TO FIRST SAT TABLE (@ BIT ON)
  3525					;	1(P4) POINTER TO SECOND SAT TABLE
  3526					;	2(P4) NO CLUSTER BAD MESSAGE
  3527					;	3(P4) HEADER IF SOME BAD
  3528					;	4(P4) TOTAL BAD MESSAGE
  3529					;	5(P4) PUSHJ HERE IF ANY BAD
  3530					;	7(P4) PUSHJ HERE TO SEE IF BAD RETURNS CPOPJ1 IF IS
  3531
  3532	004455'	476 00 0 00 005501'	CLSSRC:	SETOM COUNT#
  3533	004456'	201 12 0 00 000000 		MOVEI U,0
  3534	004457'	200 15 1 00 010732'	SRNWUN:	MOVE P3,@PTRPPU	;GET NUMBER OF BLOCKS
  3535	004460'	200 01 0 00 000012 		MOVE T,U
  3536	004461'	220 01 0 00 010754'		IMUL T,STRPPU
  3537	004462'	370 14 0 00 000001 		SOS P2,T	;P2 WILL BE CLUSTER NUMBER (AOS'ED BEFORE CHECK)
  3538	004463'	550 04 1 16 000000 		HRRZ T3,@(P4)	;FIRST SAT POINTER
  3539	004464'	550 05 1 16 000001 		HRRZ T4,@1(P4)	;SECOND SAT POINTER
  3540	004465'	275 04 0 00 000001 		SUBI T3,1
  3541	004466'	275 05 0 00 000001 		SUBI T4,1	;DECRIMENT SINCE AOS BEFORE USE
  3542	004467'	201 02 0 00 000001 	SRNWST:	MOVEI T1,1	;START OF SAT, T1 HAS BIT TO TEST
  3543	004470'	201 03 0 00 022000 		MOVEI T2,400*^D36
  3544	004471'	271 14 0 00 000001 	SRNXCL:	ADDI P2,1	;NEXT CLUSTER
  3545	004472'	361 15 0 00 004522'		SOJL P3,SRNXUN	;SEE IF OUT OF PAGES ON THIS UNIT
  3546	004473'	361 03 0 00 004520'		SOJL T2,SRNXST	;OR POSSIBLY IN THIS SAT
  3547	004474'	241 02 0 00 777777 		ROT T1,-1	;MOVE BIT
  3548	004475'	325 02 0 00 004500'		JUMPGE T1,SRTST	;IF HIGH ORDER BIT, MUST WANT NEXT WORD
  3549	004476'	271 04 0 00 000001 		ADDI T3,1
  3550	004477'	271 05 0 00 000001 		ADDI T4,1
  3551	004500'	260 17 0 16 000007 	SRTST:	PUSHJ P,7(P4)	;TEST
  3552	004501'	254 00 0 00 004471'		 JRST SRNXCL	;ALL OK
  3553	004502'	200 00 0 16 000003 		MOVE M,3(P4)	;GET READY TO PUT OUT HEADER
  3554	004503'	357 00 0 00 005501'		AOSG COUNT
  3555	004504'	260 17 0 00 003566'		PUSHJ P,MSG	;FIRST BAD ONE
  3556	004505'	200 06 0 00 000014 		MOVE N,P2
  3557	004506'	201 01 0 00 000006 		MOVEI T,6
  3558	004507'	260 17 0 00 003470'		PUSHJ P,OCTZRO	;PRINT 6 DIGITS WITH LEADING ZEROS
  3559	004510'	260 17 0 00 003573'		PUSHJ P,SPC
  3560	004511'	260 17 0 00 003573'		PUSHJ P,SPC
  3561	004512'	200 06 0 00 005501'		MOVE N,COUNT
  3562	004513'	271 06 0 00 000001 		ADDI N,1
  3563	004514'	231 06 0 00 000017 		IDIVI N,^D15
  3564	004515'	326 07 0 00 004471'		JUMPN N1,SRNXCL	;SEE IF ENOUGH ON THIS LINE
  3565	004516'	260 17 0 00 003610'		PUSHJ P,CRLF	;YES
  3566	004517'	254 00 0 00 004471'		JRST SRNXCL
  3567
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 64
DSKCLN	MAC	30-Feb-73 19:40	

  3568	004520'	271 15 0 00 000001 	SRNXST:	ADDI P3,1
  3569	004521'	364 14 0 00 004467'		SOJA P2,SRNWST	;COMPENSATE FOR EXTRA INCS
  3570	004522'	315 12 0 00 006570'	SRNXUN:	CAMGE U,HIGHU
  3571	004523'	344 12 0 00 004457'		AOJA U,SRNWUN	;GO WITH NEXT UNIT
  3572	004524'	200 00 0 16 000002 		MOVE M,2(P4)	;GET READY WITH NO ERRORS MESSAGE
  3573	004525'	357 06 0 00 005501'		AOSG N,COUNT
  3574	004526'	254 00 0 00 003566'		JRST MSG	;THERE WERE NONE
  3575	004527'	260 17 0 16 000005 		PUSHJ P,5(P4)	;MARK ERRORS
  3576	004530'	200 00 0 16 000004 		MOVE M,4(P4)	;TOTAL ERRORS MESSAGE
  3577	004531'	260 17 0 00 003566'		PUSHJ P,MSG
  3578	004532'	260 17 0 00 003500'		PUSHJ P,DECPRT
  3579	004533'	260 17 0 00 003601'		PUSHJ P,PDOT
  3580	004534'	254 00 0 00 003606'		JRST CRLF3	;DONE
  3581
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 65
DSKCLN	MAC	30-Feb-73 19:40	

  3582					;TEST TO SEE IF FILE IS A UFD
  3583
  3584	004535'	554 01 0 16 001017 	ISUFD:	HLRZ T,ERREXT(P4)
  3585	004536'	200 02 0 16 001020 		MOVE T1,ERRPPN(P4)
  3586	004537'	306 01 0 00 654644 		CAIN T,'UFD'
  3587	004540'	312 02 0 00 014157'		CAME T1,[1,,1]
  3588	004541'	263 17 0 00 000000 		POPJ P,		;NOT UFD, NON-SKIP RETURN
  3589	004542'	254 00 0 00 004027'		JRST CPOPJ1	;IS A UFD
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 66
DSKCLN	MAC	30-Feb-73 19:40	

  3590					;TEST TO SEE IF CRITICAL FILE DAMAGED
  3591
  3592	004543'	205 01 0 00 777773 	ISCRIT:	MOVSI	T,-SPCLEN
  3593	004544'	200 02 0 16 001016 		MOVE	T1,ERRNAM(P4)
  3594	004545'	312 02 0 01 003161'		CAME	T1,SYSNAM(T)	;CHECK NAME TABLE
  3595	004546'	253 01 0 00 004545'	CRIT1:	 AOBJN	T,.-1
  3596	004547'	325 01 0 00 004030'		JUMPGE	T,CPOPJ		;NOT ON CRITICAL LIST.
  3597	004550'	200 03 0 16 001020 		MOVE	T2,ERRPPN(P4)
  3598	004551'	312 03 0 01 003154'		CAME	T2,SYSPPN(T)
  3599	004552'	254 00 0 00 004546'		 JRST	CRIT1		;NO MATCH
  3600	004553'	510 03 0 16 001017 		HLLZ	T2,ERREXT(P4)
  3601	004554'	312 03 0 01 003166'		CAME	T2,SYSEXT(T)
  3602	004555'	254 00 0 00 004546'		 JRST	CRIT1
  3603	004556'	332 00 0 00 006557'		SKIPE	FIXFLG		;DON'T DIE IF CHECKING MODE
  3604	004557'	254 00 0 00 003744'		 JRST	CRTERR
  3605						OUTSTR	[asciz "
  3606					CRITICAL FILE FOUND DAMAGED IN CHECKING MODE: (CONTINUING...)
  3607	004560'	051 03 0 00 015320'	"]
  3608	004561'	263 17 0 00 000000 		POPJ P,
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 67
DSKCLN	MAC	30-Feb-73 19:40	

  3609					;CHECK SAT FOR EXTRA (UNUSED) BITS NOT MARKED. IF FIXING,
  3610					;MARK EXTRA BITS IN OUR SAT
  3611
  3612	004562'	200 12 0 00 006570'	CHKSAT:	MOVE U,HIGHU	;NOW CHECK FOR EXTRA SAT BITS
  3613	004563'	200 13 0 00 010727'		MOVE P1,PTRDST
  3614	004564'	332 00 0 00 006557'		SKIPE FIXFLG
  3615	004565'	200 13 0 00 010730'		MOVE P1,PTROST	;FOR FIXING
  3616	004566'	200 01 1 00 010732'	CKBUNI:	MOVE T,@PTRPPU	;GET NUMBER OF PAGES
  3617	004567'	231 01 0 00 022000 		IDIVI T,400*^D36	;NUMBER OF BITS/PAGE
  3618	004570'	554 05 1 00 010727'		HLRZ T4,@PTRDST		;GET EXPECTED NUMBER
  3619						JUMPE T1,[CAME T,T4	;EVEN NUMBE OF SATS
  3620							JRST BADNST	;DOES NOT COMPARE
  3621	004571'	322 02 0 00 015336'			JRST NXTST2]
  3622	004572'	302 05 0 01 000001 		CAIE T4,1(T)	;DO NUMBERS MATCH
  3623	004573'	254 00 0 00 004633'		JRST BADNST	;NO
  3624	004574'	221 01 0 00 000400 		IMULI T,400	;WORDS IN FULL SATS
  3625	004575'	270 01 1 00 000013 		ADD T,@P1	;LOCATION
  3626	004576'	200 05 0 00 000001 		MOVE T4,T	;SAVE IT. FIRST WORD OF LAST SAT
  3627	004577'	200 01 0 00 000002 		MOVE T,T1
  3628	004600'	231 01 0 00 000044 		IDIVI T,^D36	;FULL WORD SIN LAST SAT
  3629	004601'	270 05 0 00 000001 		ADD T4,T
  3630	004602'	201 04 0 00 000400 		MOVEI T3,400
  3631	004603'	274 04 0 00 000001 		SUB T3,T	;THE NUMBER OF WORDS NOT FULL
  3632	004604'	474 01 0 00 000000 		SETO	T,
  3633	004605'	213 00 0 00 000002 		MOVNS T1
  3634	004606'	242 01 0 02 000000 		LSH T,(T1)	;T NOW HAS 1 BITS WHERE SAT SHOULD HAVE 0'S
  3635	004607'	201 06 0 00 000000 		MOVEI N,0	;ERROR FLAG
  3636	004610'	612 01 0 05 000000 		TDNE T,(T4)
  3637	004611'	201 06 0 00 000001 		MOVEI N,1	;SET ERROR FLAG
  3638	004612'	412 01 0 05 000000 		ANDCAM T,(T4)	;SET CORE BITS
  3639	004613'	363 04 0 00 004620'	CHKST2:	SOJLE T3,NXTSAT	;ARE WE DONE?
  3640	004614'	332 00 0 05 000001 		SKIPE 1(T4)	;NO REST SHOULD BE ALL ZERO
  3641	004615'	201 06 0 00 000001 		MOVEI N,1
  3642	004616'	402 00 0 05 000001 		SETZM 1(T4)
  3643	004617'	344 05 0 00 004613'		AOJA T4,CHKST2
  3644	004620'	336 00 0 00 006557'	NXTSAT:	SKIPN FIXFLG	;NO ERROR MESSAGE IF FIXING
  3645	004621'	326 06 0 00 004624'		JUMPN N,BADSAT
  3646	004622'	365 12 0 00 004566'	NXTST2:	SOJGE U,CKBUNI
  3647	004623'	263 17 0 00 000000 		POPJ P,		;FINISHED ALL SATS
  3648
  3649	004624'	256 04 0 00 014211'	BADSAT:	ERRLEV (LEVBAD)^	XCT LEVBAD,[PUSHJ P,ERLSET]^
  3650	004625'	201 00 0 00 015341'		MOVEI M,[ASCIZ /EXTRA BITS IN SAT NOT MARKED UNIT /]
  3651	004626'	260 17 0 00 003566'		PUSHJ P,MSG
  3652	004627'	200 06 0 00 000012 		MOVE N,U
  3653	004630'	260 17 0 00 003500'		PUSHJ P,DECPRT
  3654	004631'	260 17 0 00 003610'		PUSHJ P,CRLF
  3655	004632'	254 00 0 00 004622'		JRST NXTST2
  3656
  3657	004633'				BADNST:	MOVEI M,[ASCIZ /
  3658	004633'	201 00 0 00 015350'	WRONG NUMBER OF SATS/]
  3659	004634'	254 00 0 00 003206'		JRST FATERR
  3660
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 68
DSKCLN	MAC	30-Feb-73 19:40	

  3661					;SET UP AN ERROR LIST POINTER. FIRST WORD POINTS TO CHAIN
  3662					;SECOND TO END OF CHAIN FOR ADDING AT END
  3663					;POINTER TO BLOCK IN T
  3664
  3665	004635'	202 01 0 01 000001 	SETFIX:	MOVEM T,1(T)
  3666	004636'	402 00 0 01 000000 		SETZM (T)
  3667	004637'	263 17 0 00 000000 		POPJ P,
  3668
  3669					;ADD SOMETHING TO END OF CHAIN
  3670					;ADD A 4 WORD BLOCK
  3671					;	WORD 0 LH. IS LINK. RH IS ADDRESS CALLED FROM
  3672					;		WILL GO TO ADDRESS CALLED FROM+1 TO FIX
  3673					;	WORD 1 IS BLOCK NUMBER
  3674					;	WORDS 2 AND 3 ARE ROUTINE DEPENDENT ARGS
  3675
  3676	004640'	261 17 0 00 000004 	ADDFIX:	PUSH P,T3
  3677	004641'	201 04 0 00 000004 		MOVEI T3,4
  3678	004642'	273 04 0 00 006564'		ADDB T3,FREPTR	;GET SPACE
  3679	004643'	261 17 0 00 000001 		PUSH	P,T		;SAVE T
  3680	004644'	200 01 0 00 000004 		MOVE	T,T3		;
  3681	004645'	260 17 0 00 003264'		PUSHJ	P,GETCOR	;
  3682	004646'	262 17 0 00 000001 		POP	P,T		;
  3683	004647'	200 04 0 00 006564'		MOVE T3,FREPTR
  3684	004650'	275 04 0 00 000004 		SUBI T3,4
  3685	004651'	262 17 0 04 000003 		POP P,3(T3)
  3686	004652'	202 03 0 04 000002 		MOVEM T2,2(T3)
  3687	004653'	202 02 0 04 000001 		MOVEM T1,1(T3)	;BLOCK NUMBER
  3688	004654'	550 02 0 17 000000 		HRRZ T1,(P)	;LINK IS ALWAYS 0
  3689	004655'	200 03 0 01 000001 		MOVE T2,1(T)	;T POINTS TO CHAIN BLOCK
  3690	004656'	202 02 0 04 000000 		MOVEM T1,(T3)	;SAVE ADDRESS
  3691	004657'	506 04 0 03 000000 		HRLM T3,(T2)	;LINK ON END
  3692	004660'	202 04 0 01 000001 		MOVEM T3,1(T)	;AND SET NEW END
  3693	004661'	263 17 0 00 000000 		POPJ P,
  3694
  3695	004662'	336 02 0 01 000000 	ADDTOT:	SKIPN T1,(T)	;ANYTHING TO ADD?
  3696	004663'	263 17 0 00 000000 		POPJ P,		;NO
  3697	004664'	502 02 1 00 006561'		HLLM T1,@FIXPTR+1	;ADD TO END OF MASTER CHAIN
  3698	004665'	200 02 0 01 000001 		MOVE T1,1(T)
  3699	004666'	202 02 0 00 006561'		MOVEM T1,FIXPTR+1	;RESET END
  3700	004667'	263 17 0 00 000000 		POPJ P,
  3701
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page 69
DSKCLN	MAC	30-Feb-73 19:40	

  3702	004670'				RCVBUF:	BLOCK 406	;RESERVED SPACE FOR RECOV.SYS BUFFERS.
  3703
  3704	005276'				imradr:	block 3		;[37] stg for page fail words from PGFSTS UUO
  3705	005301'	000 00 0 00 000000 	intvec:	z		;[37] monitor will stash pc here on chan 1 interr
  3706	005302'	000000	004156'			errint		;[37] chan 1 interrupt handler
  3707	005303'					block ^d68	;[37] no other SI channels used
  3708
  3709	005407'	000 00 0 00 000000 	UPRBND:	Z		;HAS ADDR OF HIGHEST ADDRESSABLE WORD
  3710								;OF CORE.
  3711
  3712			000003'			END STPT

NO ERRORS DETECTED

PROGRAM BREAK IS 015355
CPU TIME USED 02:40.488

18P CORE USED
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page S-1
DSKCLN	MAC	30-Feb-73 19:40		SYMBOL TABLE

ADDFIX		004640'		CHKBAT		004376'		DCNTAB		000015	spd	FINSK0		001512'		
ADDTOT		004662'		CHKLIC		003177'		DCT1		000153'		FINSK1		001513'		
ALCERM		002566'		CHKOPR		003275'		DCT2		000203'		FINSTR		000110'		
ALCRIB		001023	spd	CHKSAT		004562'		DCTENT		000137'		FIXBAD		006555'		
ALLSTL		000112'		CHKST1		000220'		DCTFIX		000150'		FIXDON		000754'		
ALLSTR		000111'		CHKST2		004613'		DEBUG		000000	spd	FIXFLG		006557'		
ALUERM		002610'		CHKST3		000315'		DECPRT		003500'		FIXLP		000731'		
ANYHSH		001250'		CHKSTR		000121'		DECSPC		003463'		FIXPTR		006560'		
BADALP		002560'		CHNCNT		005447'		DECZRO		003464'		FIXRBP		001013	spd	
BADALU		002602'		CHNFRE		001544'		DETMSG		003250'		FIXREN		006562'		
BADBT1		002514'		CHRBUF		005450'		DETSW		005503'		FLMERR		002450'		
BADBT2		002524'		CIO.IN		000014	spd	DEVCHR	047000	000004		FLMEXT		000003	spd	
BADDAT		002502'		CIO.OP		000013	spd	DEVREL		001006	spd	FLMNAM		000002	spd	
BADDIR		002534'		CIO.OT		000015	spd	DEVRSU		001005	spd	FLMPPN		000001	spd	
BADHOM		003233'		CIO.PI		000031	spd	DIRERM		002546'		FLMSTS		000017	spd	
BADLIC		002441'		CIO.PO		000032	spd	DISMIS	047000	777755		FLPEXT		001067'		
BADMXA		001323'		CIO.RL		000000	spd	DOBAT		004406'		FLPLP		001061'		
BADMXM		001331'		CIO.SK		000024	spd	DONST1		000610'		FLPNUF		001065'		
BADNST		004633'		CIO.ST		000016	spd	DONSTR		000601'		FLPUFD		001115'		
BADPRV		002454'		CKBAT1		004437'		DOREN		000763'		FLRERR		002451'		
BADSAT		004624'		CKBUNI		004566'		DSK		000000	spd	FNDSEK		001575'		
BADSIZ		002571'		CLSSRC		004455'		DSKCHR	047000	000045		FNDSK1		001560'		
BADSNM		002550'		CNFNAM		005473'		DSKCLR	047000	777756		FNDSK2		001573'		
BADSZS		002252'		CNFTAB		000011	spd	DV.TTA		020000	spd	FNDSK3		001616'		
BADTIM		002472'		CNT1	000001	000000	spd	ENDHOM		000352'		FORM		003575'		
BADUSD		001313'		CODBAT		505050	spd	ENDSAT		005504'		FRCEOF		002243'		
BADUSM		001321'		CODHOM		070717	spd	EOFERM		002246'		FRDER		003260'		
BANNBB		000010	spd	CODRIB		666666	spd	EOFSEN		005505'		FREE		002143'		
BASNBB		000011	spd	COMMA		003577'		ERLSET		003355'		FREETR		002147'		
BATBK2		004431'		COPTR		004314'		ERREXT		001017	spd	FREPTR		006564'		
BATBKD		004430'		CORE	047000	000011		ERRINT		004156'		FRERPT		000572'		
BATCOD		000776	spd	COUNT		005501'		ERRIT1		004200'		FRETAB		003003'		
BATELB		000001	spd	CPOPJ		004030'		ERRIT2		004176'		FSTFLG		006565'		
BATFIR		000001	spd	CPOPJ1		004027'		ERRNAM		001016	spd	FULRBC		004270'		
BATNAM		000000	spd	CREUNT		000245'		ERRPPN		001020	spd	GETBLK		004327'		
BATNBB		000000	spd	CRIT1		004546'		ERRSAV		005506'		GETCOR		003264'		
BATSLF		000777	spd	CRLF		003610'		ERRTAB		002706'		GETTAB	047000	000041		
BATUDN		004434'		CRLF2		003607'		EXIT	047000	000012		GOFIX		000055'		
BATUN1		004410'		CRLF3		003606'		FALLPT		003227'		HEDFRE		003034'		
BATUNI		004377'		CRTER1		003752'		FATERR		003206'		HEDLOS		002756'		
BAYNBB		004436'		CRTERM		003743'		FIL		000017	spd	HEDMLT		003112'		
BDPMER		002235'		CRTERR		003744'		FILCNT		002042'		HFSIZ		006566'		
BFEFLG		005410'		CRTIDX		002654'		FILDEL		001701'		HIADDR		006567'		
BIGCHN		005411'		DATERM		002512'		FILFIX		002543'		HIGHU		006570'		
BLKIN		005412'		DATITM		000011	spd	FILLOS		005507'		HOMCHK		004022'		
BLKOK		000747'		DATTAB		000011	spd	FILMKC		002103'		HOMCK1		004031'		
BLKSIZ		001000	spd	DATUUO	047000	777723		FILNAM		005510'		HOMCOD		000776	spd	
BT1ERM		002522'		DC.CLR		000000	spd	FILOPN		001035'		HOMCOP		004055'		
BT2ERM		002532'		DC.FPC		000001	spd	FILPRC		001775'		HOMHMS		000020	spd	
BUF		777000		DC.NDS		000002	spd	FILPRN		001052'		HOMHSH		000027	spd	
BUFPAG		000777	spd	DCN		005502'		FILRBN		002041'		HOMLOG		000005	spd	
CH		000010		DCNDEF		000177'		FILRIB		005530'		HOMLUN		000006	spd	
CHAN		000011		DCNDIS		000157'		FILTRB		006554'		HOMMFD		000025	spd	
CHANU		005413'		DCNITM		000005	spd	FINFIX		000627'		HOMMOV		000326'		
CHANUU		005431'		DCNNAM		000167'		FINSEK		001506'		HOMNAM		000000	spd	
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page S-2
DSKCLN	MAC	30-Feb-73 19:40		SYMBOL TABLE

HOMNUM		003231'		LINJOB	777777	777752	spd	NOUP		003337'		PRTBU1		003400'		
HOMNXT		000003	spd	LNAME		003777'		NOW		003646'		PRTRB2		003402'		
HOMOVR		000016	spd	LOBUF		006574'		NOWLUP		003672'		PRTRB3		003425'		
HOMP4S		000007	spd	LOGITM		000025	spd	NULL		003603'		PRTRB4		003437'		
HOMPRC		002620'		LOGTAB		000011	spd	NXTBBK		004413'		PRTRBL		003365'		
HOMRIB		006571'		LOSTAB		002726'		NXTCHN		001542'		PRTRBU		003450'		
HOMRT1		002647'		LPT		000016	spd	NXTHOM		000334'		PRVBUF		004140'		
HOMRTN		002640'		LSTBUF		006577'		NXTPTR		000001	spd	PRVERM		002462'		
HOMRTU		002631'		M		000000		NXTSAT		004620'		PS.NER	002000	000000	spd	
HOMSAM		000342'		MAPWD		006600'		NXTSDN		000454'		PTNPNO		000043	spd	
HOMSAT		000017	spd	MFDBUF		006602'		NXTSP2		000453'		PTNUNI		000020	spd	
HOMSLF		000777	spd	MFDDEL		001420'		NXTSPT		000425'		PTRBAD		002241'		
HOMSLP		000013	spd	MFDPC1		002614'		NXTST2		004622'		PTRBD1		002240'		
HOMSNM		000002	spd	MFDPR1		001336'		NXTSTU		000422'		PTRBSB		002220'		
HOMSPU		000015	spd	MFDPR2		001400'		NXUFDB		001160'		PTRDST		010727'		
HOMSUF		000023	spd	MFDPRC		001333'		OCTCTY		003512'		PTROST		010730'		
HOMSWP		000021	spd	MFDRBC		007602'		OCTCY1		003515'		PTRPGE		010731'		
HOMTAB		002674'		MFDRBD		001446'		OCTPRT		003501'		PTRPPU		010732'		
HOMTBL		002656'		MFDRBE		001442'		OCTSPC		003467'		PTRSAD		010733'		
HOMTLN		000007	spd	MFDRIB		007603'		OCTZRO		003470'		PTRSWB		010734'		
HTL		000005	spd	MFDUFD		001126'		OLDONE		004214'		PTRSWP		010735'		
IA.REE		000002	spd	MGONFX		000476'		ONEJOB	047000	777760		PTRTST		010736'		
IDEND		003554'		MINERR		003462'		OPNERR		003223'		PTRUNU		010737'		
IDENT		003526'		MISCRT		003750'		OUTSTR	051140	000000		PTRUPG		010740'		
IMRADR		005276'		MKNMLT		002120'		P		000017		PTSPNO		000023	spd	
INCHRW	051000	000000		MLTTAB		003062'		P1		000013		PTSUNI		000010	spd	
INITL		000240'		MODCL1		002365'		P2		000014		PVYERR		003221'		
INTADR	047000	777745		MODCL2		002356'		P3		000015		QUIT		003311'		
INTASS	047000	777742		MONTAB		003727'		P4		000016		QUIT0		003305'		
INTENB	047000	777744		MRKONE		004371'		PAGERR		004150'		RADIX		010741'		
INTERR		003211'		MRKZRO		004365'		PAGO		776000		RBEOF1		002167'		
INTVEC		005301'		MSG		003566'		PAGOK		004122'		RBLVPR		000725	spd	
IOCW		006572'		MSGL		003567'		PAGOPG		000776	spd	RBLVSR		000772	spd	
ISCRIT		004543'		MXCHN		000016	spd	PAGRDP		004064'		RBREAL		200000	spd	
ISUFD		004535'		N		000006		PAGRED		004071'		RBSPAR		400000	spd	
JACCT		000001	spd	N1		000007		PAGWRT		004227'		RCVBUF		004670'		
JBTSTS		000000	spd	NAMLP		003530'		PAGWTP		004222'		RDXPRT		003503'		
JOBFF		001015'	ext	NEDZER		001674'		PASS2		000537'		RELDEL		001741'		
JOBREL		000057'	ext	NEDZRO		001654'		PDL		010627'		RELDL1		001742'		
JOBREN		000124	sin	NEDZT		001546'		PDLSIZ		000100	spd	RELDL2		001750'		
JOBSA		003314'	ext	NOBWRT		000743'		PDOT		003601'		RENAD1		000054'		
JOBVER		000137	sin	NOCLR		003262'		PERSET	047000	777706		RENADR		000000'		
JUSTFY		003473'		NOCOR		003217'		PG%.ER		004252'		RENFIL		000773'		
LEVBAD		000004	spd	NOCOR1		003215'		PGESTS	047000	777700		RIBALP		000036	spd	
LEVCRS		000003	spd	NODAT		003722'		PIOERR		003213'		RIBCHK		004260'		
LEVMIN		000001	spd	NODSER		003225'		PJRST	254000	000000		RIBCOD		000776	spd	
LEVUSR		000002	spd	NOFREE		003016'		PR6BIT		003616'		RIBEOF		002152'		
LICERM		002447'		NOJAL		003205'		PRDATE		003703'		RIBERR		001734'		
LICJL		001000	spd	NOLOS		002741'		PREFER		001652'		RIBEXT		000006	spd	
LICOPR		100000	spd	NOMULT		003074'		PREREF	047000	777703		RIBLBN		000000	spd	
LICRA		000014	spd	NOPRTR		003445'		PRMRB0		002375'		RIBLCW		000017	spd	
LICST		004000	spd	NOPTR		004350'		PRMRB1		002313'		RIBLST		000775	spd	
LICSY		040000	spd	NOSPEC		002031'		PRMRB2		002415'		RIBMXA		000027	spd	
LICTAB	777777	777760	spd	NOTRB		000554'		PRMRIB		002305'		RIBNAM		000005	spd	
LICWA		000003	spd	NOTUFD		001405'		PRNFIL		001014'		RIBNZF		002264'		
DSKCLN - DAMAGE CLEANUP AND DAMAGE ASSESMENT	MACRO %53B(1156)-1 20:20 18-Jul-84 Page S-3
DSKCLN	MAC	30-Feb-73 19:40		SYMBOL TABLE

RIBPFS		000051	spd	SRNXST		004520'		TYODSP		011021'		.CHBSA		000022	spd	
RIBPPN		000004	spd	SRNXUN		004522'		U		000012		.CHCHR		000005	spd	
RIBPVW		000007	spd	SRTST		004500'		UFDALC		000003	spd	.CHHA		000020	spd	
RIBRIB		000000	spd	STAITM		000017	spd	UFDBDH		001257'		.CHLEN		000023	spd	
RIBRPS		000001	spd	STATAB		000011	spd	UFDBHM		001267'		.CHSMP		000043		
RIBSFS		000004	spd	STBLEN		000003	spd	UFDBKF		001010	spd	.CHSNM		000004	spd	
RIBSIZ		000010	spd	STCNT1		000705'		UFDBSZ		001205'		.IAERR		000012	spd	
RIBSLF		000777	spd	STCNT3		000666'		UFDBUF		011022'		.IAILM		000002	spd	
RIBSNM		000003	spd	STPT		000003'		UFDDN1		001310'		.PRCW	004000	000000	spd	
RIBSTS		000022	spd	STPT1		000037'		UFDDON		001273'		.PRRO	002000	000000	spd	
RIBSZS		000002	spd	STPT2		000045'		UFDERR		003746'		.PRRW	006000	000000	spd	
RIBUSD		000030	spd	STRHAD		010750'		UFDESH		001223'		.WSRNG		000001		
RIBZEF		002157'		STRHSH		010751'		UFDEXT		000001	spd	
RIPALC		002000	spd	STRLU1		004016'		UFDHSP		001021	spd	
RIPBDA		000001	spd	STRLUX		004020'		UFDIGN		001240'		
RIPDIR		400000	spd	STRNAM		010752'		UFDLIC		000003	spd	
RIPNUB		400000	spd	STROVR		010753'		UFDLSD		001015	spd	
RJRDXP		003472'		STRPPU		010754'		UFDLST		000771		
ROUTIN		000004	spd	SUUINI		000002	spd	UFDNAM		000000	spd	
RTNIDX		010742'		SUUMSG		000000	spd	UFDNRL		001241'		
RTNPAG		010743'		SWPRIB		010755'		UFDOGP		000003	spd	
RTNUNI		010744'		SYSEXT		003166'		UFDPCT		012022'		
RUN	047000	000035		SYSNAM		003161'		UFDPRC		001461'		
SATFN1		000375'		SYSPPN		003154'		UFDPRV		000001	spd	
SATFUN		000374'		SYSPRC		002612'		UFDPTR		000002	spd	
SATIOR		000656'		SYSRIB		010756'		UFDRBP		000004	spd	
SATPRC		002616'		SYSSTR	047000	000046		UFDRIB		013022'		
SATRIB		010745'		SZSERM		002261'		UFDSIZ		000005	spd	
SATTAB		002703'		T		000001		UFDTMD		000002	spd	
SATULP		000365'		T1		000002		UFDUF2		000001	spd	
SAVBLK		001007	spd	T2		000003		UFDUSD		001012	spd	
SAVRIB		000005	spd	T3		000004		UFPALC		020000	spd	
SAVSNM		010746'		T4		000005		UMFSLP		001150'		
SBKERR		003353'		TAB		003605'		UNITAB		002663'		
SETFIX		004635'		TCHBUF		004127'		UNTLEN		000011	spd	
SETJAL	047000	777757		THSERR		010757'		UPRBND		005407'		
SETPTR		004320'		TIMERM		002500'		VALPAG	047000	777702		
SETTLE		000225'		TIMITM		000010	spd	VCLEAR	047000	777712		
SETUFX		002464'		TIMTAB		000011	spd	VCREAT	047000	777711		
SETUUO	047000	000075		TOTFRE		003053'		VL.WAT	002000	000000	spd	
SIZERM		002577'		TOTLOS		002774'		VLIOE%		000005	spd	
SIZRIB		001022	spd	TOTMLT		003131'		VRAT		000041	spd	
SKPENT		001401'		TPOPJ		002141'		VREPLC	047000	777714		
SNMERM		002556'		TPOPJ1		002140'		WRTERR		004243'		
SPACT2		003147'		TRBFIL		010760'		WRTFAT		004240'		
SPAROK		010747'		TRBFLG		010761'		WRTSAT		000633'		
SPC		003573'		TRMBLK		010762'		WRTST1		000662'		
SPCACT		003142'		TRMMES		003173'		WRTSTU		000637'		
SPCLEN		000005	spd	TRMOP2		003633'		WSCTL	047000	777704		
SPRPTR		002062'		TRMOPR		003625'		XCHPTR		004114'		
SPUFDN		000002	spd	TRMPTR		011020'		XX		003142'		
SRBERR		003351'		TRMSAV		003256'		%%Z		001024	spd	
SRNWST		004467'		TSTZRO		004352'		.ADDWS	002000	000000	spd	
SRNWUN		004457'		TYO		003612'		.CHBA		000021	spd	
SRNXCL		004471'		TYOBTH		003254'		.CHBPU		000006	spd	

Symbol cross reference

ADDFIX	  1174	  1257	  1288	  1495	  1524	  1935	  1989	  3676#
ADDTOT	  1150	  1199	  1804	  3695#
ALCERM	  2005	  2011#
ALCRIB	   366#	  1142	  1362	  1515	  1632	  1650	  1878	  1890	  3383	  3384
ALLSTL	   467#	   473
ALLSTR	   459	   461	   466#
ALUERM	  2027	  2033#
ANYHSH	  1117	  1162#
BADALP	  1892	  2004#
BADALU	  1883	  2026#
BADBT1	  1873	  1959#
BADBT2	  1877	  1969#
BADDAT	  1841	  1947#
BADDIR	  1889	  1979#
BADHOM	   654	   666	   672	  2489#
BADLIC	  1822	  1907#
BADMXA	  1196	  1211#
BADMXM	  1212	  1218#
BADNST	  3620	  3623	  3657#
BADPRV	  1826	  1920#
BADSAT	  3645	  3649#
BADSIZ	  1899	  2015#
BADSNM	  1902	  1994#
BADSZS	  1710	  1734	  1768#
BADTIM	  1833	  1937#
BADUSD	  1193	  1201#
BADUSM	  1202	  1208#
BANNBB	   269#	  3505
BASNBB	   268#	  3505
BATBK2	  3488	  3499#
BATBKD	  3493	  3498#
BATCOD	   263#	  3513
BATELB	   266#	  3485
BATFIR	   265#	  3481
BATNAM	   261#	  3512
BATNBB	   267#	  3505
BATSLF	   264#	  3518
BATUDN	  3479	  3483	  3500	  3502#
BATUN1	  3482#	  3501
BATUNI	  3473#	  3502
BAYNBB	  3484	  3505#
BDPMER	  1741	  1751#
BFEFLG	  3086	  3088	  3090	  3145#	  3145
BIGCHN	  1341#	  1341	  1342	  1550
BLKIN	   936#	   936	   943	   945	   948	   950	   960
BLKOK	   944	   951	   954#
BLKSIZ	   173#
BT1ERM	  1960	  1966#
BT2ERM	  1970	  1976#
BUF	   292#	   293	   433	   452	   657	   662	   669	   718	   743	   883	   884	   891	   899	   900
	  1116	  1128	  1144	  1176	  1205	  1215	  1260	  1290	  1292	  1293	  1296	  1497	  1500	  1502
	  1526	  1528	  1532	  1534	  1535	  1538	  1643	  1647	  1748	  1773	  1790	  1793	  1794	  1795
	  1851	  1858	  1911	  1924	  1941	  1951	  1953	  1963	  1973	  1984	  1998	  2008	  2019	  2030
	  3000	  3001	  3006	  3011	  3012	  3018	  3020	  3022	  3087	  3361	  3362	  3374	  3375	  3378
Symbol cross reference

	  3379	  3394	  3480	  3512	  3513	  3518
BUFPAG	   293#	   597	   617	  3056	  3091	  3095	  3131	  3226
CH	   198#	  1049	  1056	  2514	  2664	  2671	  2711	  2712	  2715	  2716	  2732	  2733	  2739	  2744
	  2748	  2795	  2796	  2800	  2802	  2804	  2806	  2808	  2810	  2821	  2826	  2827	  2832	  2833
	  2834	  2835	  2836	  2837	  2838	  2839	  2869	  2870
CHAN	   199#	   652	  1078	  1333	  1336	  1340	  1341	  1342	  1343	  1366	  1398	  1399	  1400	  1430
	  1431	  1441	  1519	  1549	  1558	  1567	  1611	  3066	  3068
CHANU	   315#	  1322	  1323	  1324	  1343	  1398	  1400	  1430	  1519	  1549	  1551	  1555	  1558	  1567
	  1611
CHANUU	   315#	  1399	  1431
CHKBAT	   819	  3472#
CHKLIC	   430	  2426#
CHKOPR	   185	   420	  2555#
CHKSAT	   767	   813	  3612#
CHKST1	   522	   562#
CHKST2	  3639#	  3643
CHKST3	   636	   640	   644#
CHKSTR	   463	   472	   477#
CHNCNT	  1325#	  1325	  1338	  1369	  1409	  1432
CHNFRE	  1344	  1365	  1369#
CHRBUF	   313#	   456	   457	   460	   573	   578	  2059	  2076	  2091	  2092	  2093	  2094	  2739	  2746
	  2981	  2987	  3010	  3473
CIO.IN	   129#
CIO.OP	   128#	   624
CIO.OT	   130#
CIO.PI	   133#
CIO.PO	   134#
CIO.RL	   127#	   842
CIO.SK	   132#
CIO.ST	   131#
CKBAT1	  3474	  3477	  3507#
CKBUNI	  3616#	  3646
CLSSRC	   832	   834	   836	  3532#
CNFNAM	   314#	  2759	  2761
CNFTAB	   286#	  2756
CNT1	   301#	  3226
CODBAT	   262#	  3511
CODHOM	   170#	  2999
CODRIB	   171#	  3360
COMMA	  1053	  1072	  2668	  2700	  2804#
COPTR	  1649	  1730	  3385	  3393#
COUNT	  3532#	  3532	  3554	  3561	  3573
CPOPJ	  1411	  1581	  2382	  2796	  2993#	  3596
CPOPJ1	  1434	  1481	  2208	  2258	  2989	  2992#	  2997	  3002	  3007	  3089	  3365	  3426	  3436	  3509
	  3514	  3589
CREUNT	   591#	   593
CRIT1	  3595#	  3599	  3602
CRLF	  1058	  1584	  2689	  2763	  2812	  2813	  2814#	  2949	  3565	  3654
CRLF2	   856	  2753	  2774	  2786	  2813#
CRLF3	  2812#	  3580
CRTER1	  2927	  2930	  2935#
CRTERM	   786	   818	  2925#
CRTERR	  2040	  2044	  2088	  2926#	  3604
CRTIDX	  2068	  2087#
Symbol cross reference

DATERM	  1948	  1956#
DATITM	   326#	  2850
DATTAB	   327#	  2850
DC.CLR	   273#	   762	   867
DC.FPC	   274#	   930
DC.NDS	   275#	   862
DCN	   553	   562#	   562	  2768
DCNDEF	   520	   526	   527	   528	   529	   530	   542#
DCNDIS	   521	   524#
DCNITM	   331#	   516
DCNNAM	   533#	  2769
DCNTAB	   332#	   516
DCT1	   515	   519#
DCT2	   543	   548#
DCTENT	   507#	   547
DCTFIX	   496	   516#
DEBUG	    10	   372	   497	   498	   762	   867	   929	   997	   998	  2430	  2433	  2559	  2569	  3203
	  3264
DECPRT	   554	  2496	  2725#	  2889	  3578	  3653
DECSPC	  2711#
DECZRO	  2712#	  2874	  2883
DETMSG	  2420	  2505#
DETSW	   184	   381#	   381	   386#	   386	   400#	   400	  2419	  2583
DEVREL	   355#	  1122	  1130	  1156	  1164	  3407	  3417
DEVRSU	   354#	  1641	  1698	  1726	  1743	  1759	  3406	  3418	  3422
DIRERM	  1980	  1991#
DOBAT	  3475	  3478	  3480#
DONST1	   524	   848#
DONSTR	   840#	   966	  1022	  1027
DOREN	   963	   968#
DSK	   209#	   970	   974	   991
DV.TTA	   337#	   639
ENDHOM	   663	   677#
ENDSAT	   705#	   705	   811
EOFERM	  1763#	  1787
EOFSEN	  1614#	  1614	  1623	  1718
ERLSET	  1179	  1505	  1542	  1666	  1693	  1751	  1763	  1776	  1915	  2012	  2023	  2203	  2253	  2625#
	  3649
ERREXT	   318#	   361#	   783	  1243	  1270	  1348	  1601	  2939	  3377	  3584	  3600
ERRINT	  3122#	  3706
ERRIT1	  3132	  3145#
ERRIT2	  3135	  3142#
ERRNAM	   317	   318	   360#	   780	  1244	  1269	  1300	  1346	  1349	  1508	  1522	  1544	  1599	  1694
	  1917	  2937	  2947	  3372	  3593
ERRPPN	   317#	   362#	   781	  1246	  1272	  1350	  1605	  2941	  3373	  3585	  3597
ERRSAV	   750#	   750	   837	  2629	  2630
ERRTAB	   839	  2171#	  2184
FALLPT	   501	   506	  2475#
FATERR	  1485	  2441#	  2447	  2451	  2455	  2460	  2464	  2468	  2473	  2477	  2487	  2503	  2519	  2527
	  2619	  2623	  2955	  3177	  3259	  3659
FIL	   212#
FILCNT	  1618#	  1628	  1633	  1735	  1757
FILDEL	  1359	  1513#
FILFIX	  1203	  1213	  1745	  1771	  1788	  1855	  1981	  1987#	  1996	  2006	  2017
Symbol cross reference

FILLOS	  1360	  1513	  1615#	  1615	  1742
FILMKC	  1102	  1112	  1590	  1629	  1637	  1656#
FILNAM	   315#	   976	   977	   978	   980	   982	   984	   986	   988	  2594	  2595	  2596	  2597	  2599
	  2600
FILOPN	  1001	  1009	  1013#
FILPRC	  1276	  1358	  1580#
FILPRN	  1026	  1031#
FILRBN	  1617#	  1651
FILRIB	   367#	  1268	  1332	  1541	  1544	  2935
FILTRB	  1616#	  1616	  1661	  1679
FINFIX	   827	   867#
FINSEK	  1335	  1338#
FINSK0	  1342#	  1367
FINSK1	  1343#	  1366
FINSTR	   464#	   469	   470
FIXBAD	   314#	   753	   791	   964	   968	  1021
FIXDON	   941	   960#
FIXFLG	   399#	   399	   402	   418	   427	   495	   542	   630	   635	   759	   797	   826	   860	  1170
	  1201	  1211	  1253	  1284	  1488	  1516	  1664	  1690	  1740	  1769	  1786	  1844	  1907	  1920
	  1937	  1947	  1959	  1969	  1979	  1994	  2004	  2015	  2026	  3061	  3603	  3614	  3644
FIXLP	   938#	   958
FIXPTR	   314#	   751	   789	   937	  1256	  3697	  3699
FIXRBP	   359#	  1099	  1197	  1609	  1803	  1987
FIXREN	   314#	   934	   962	  1530	  1531
FLMERR	  1209	  1219	  1867	  1915#	  1928	  1945	  1957	  1967	  1977	  1992	  2002	  2034
FLMEXT	   234#	   986
FLMNAM	   233#	   984
FLMPPN	   235#	   988
FLMSTS	   236#	   315	   978	   980	   981
FLPEXT	  1044#	  1075
FLPLP	  1038#	  1064
FLPNUF	  1042#	  1069
FLPUFD	  1041	  1067#
FLRERR	  1181	  1753	  1765	  1778	  1916#	  2013	  2024
FNDSEK	  1334	  1412#
FNDSK1	  1364	  1398#
FNDSK2	  1410#	  1419	  1423	  1429
FNDSK3	  1426	  1430#
FORM	  2802#
FRCEOF	  1624	  1759#
FRDER	   953	  2517#
FREE	  1672	  1690#
FREETR	  1668	  1694#
FREPTR	   758#	   758	   795	  3678	  3683
FRERPT	   830	   833#
FRETAB	   833	  2248#
FSTFLG	   479#	   479	   525	   821	   829	   885	  1190	  1425
FULRBC	  1083	  1587	  3369#
GETBLK	  1104	  1618	  3417#
GETCOR	   577	   606	   707	  2543#	  3681
GOFIX	   412	   429#
HEDFRE	  2251	  2275#
HEDLOS	  2200	  2224#
HEDMLT	  2303	  2326#
Symbol cross reference

HFSIZ	  2061#	  2061	  2073
HIADDR	   434#	   434	   602	  2546
HIGHU	   585#	   585	   588	   592	   596	   677	   695	   698	   720	   806	   870	   919	  1319	  1401
	  1415	  1433	  2066	  3034	  3133	  3206	  3428	  3472	  3570	  3612
HOMCHK	   653	   665	  2987#
HOMCK1	  2988	  2991	  2995#
HOMCOD	   123#	  3001
HOMCOP	   661	   674	  3018#
HOMHMS	   118#	  2155
HOMHSH	   122#	  2159
HOMLOG	   111#	  3012
HOMLUN	   112#
HOMMFD	   121#	  2158
HOMMOV	   656#	   660
HOMNAM	   108#	  3000
HOMNUM	   678	  2484#
HOMNXT	   110#	   662
HOMOVR	   116#	  2153
HOMP4S	   113#	  3020
HOMPRC	  2054#	  2380
HOMRIB	  2069	  2155#	  2155	  2370
HOMRT1	  2079	  2082#
HOMRTN	  2054	  2067	  2072#
HOMRTU	  2064#	  2074
HOMSAM	   668#	   673
HOMSAT	   117#	  2154
HOMSLF	   124#	  3006
HOMSLP	   114#	  3022
HOMSNM	   109#	  3011
HOMSPU	   115#	  3018
HOMSUF	   120#	  2157
HOMSWP	   119#	  2156
HOMTAB	   656	   668	  2153#	  2160
HOMTBL	  2081	  2090#	  2095
HOMTLN	   655	   667	  2160#
HTL	  2060	  2075	  2077	  2080	  2095#
IA.REE	   305#	   442
IDEND	  2579	  2581	  2778#
IDENT	   633	   804	   828	  1016	  2753#
IMRADR	  3704#
INITL	   575	   585#
INTERR	   444	   447	   450	  2445#
INTVEC	   442	  3705#
IOCW	   313#	   453	   454
ISCRIT	  1588	  1591	  1663	  1715	  1739	  3592#
ISUFD	  1884	  3584#
JACCT	   277#	   376	   424
JBTSTS	   278#	   373	   421
JOBFF	   177#	   605	   683	   708	   713	   757	   794	   995
JOBREL	   177#	   431
JOBREN	   104	   179#	   180
JOBSA	   177#	   566	   586	  2585
JOBVER	   100#	   101	   104
JUSTFY	  2719#	  2723
Symbol cross reference

LEVBAD	   253#	  1179	  1666	  1693	  2253	  3649
LEVCRS	   252#	  1751	  1763	  1776	  2012	  2023
LEVMIN	   250#	  1915	  2203
LEVUSR	   251#	  1505	  1542
LICERM	  1908	  1914#
LICJL	   282#	  2431
LICOPR	   279#	  2560
LICRA	   283#	  2431
LICST	   281#	  2431
LICSY	   280#	  2431
LICTAB	   285#	  2426	  2555
LICWA	   284#	  2431
LINJOB	   287#
LNAME	   572	  2964#	  3008
LOBUF	   313#	   499	   999	  2819	  2821
LOGITM	   324#	  2591
LOGTAB	   325#	  2591
LOSTAB	   831	  2197#
LPT	   210#	   500	   505	   631	   637	   800	   838	   840	  1000	  1006	  1008	  1010	  2441	  2820
LSTBUF	  3055#	  3055	  3224
M	   190#	   388	   391	   395	   403	   413	   551	   555	   559	   646	   849	   858	  1019	  1023
	  1035	  1061	  1483	  2039	  2043	  2421	  2437	  2445	  2449	  2453	  2458	  2462	  2466	  2470
	  2475	  2484	  2489	  2499	  2501	  2505	  2506	  2507	  2517	  2521	  2562	  2577	  2617	  2621
	  2648	  2676	  2680	  2686	  2687	  2746	  2755	  2756	  2757	  2758	  2759	  2761	  2766	  2771
	  2778	  2788	  2794	  2795	  2814	  2824	  2825	  2826	  2841	  2842	  2843	  2844	  2845	  2847
	  2885	  2893	  2896	  2929	  2932	  2942	  2950	  2954	  3105	  3110	  3160	  3172	  3231	  3241
	  3249	  3253	  3258	  3358	  3363	  3369	  3553	  3572	  3576	  3650	  3657
MAPWD	   296#	  1464	  1467	  1469	  1472	  1473	  3063	  3067	  3068	  3081	  3082
MFDBUF	   368#	   718	   719	   724	   772
MFDDEL	  1233	  1251	  1277	  1280#
MFDPC1	  2043#	  2378
MFDPR1	  1226#	  1265	  1314
MFDPR2	  1254	  1258	  1262#	  1278	  1302
MFDPRC	   768	  1223#
MFDRBC	   778#	   778	   816	  1239	  1240	  2368
MFDRBD	  1289	  1304#
MFDRBE	  1285	  1299#
MFDRIB	   367#	   684	   769	   773	   776	   814	  1242	  1264	  1268	  1281	  2158
MFDUFD	   785	   817	  1078#	  1250
MGONFX	   760	   767#
MINERR	  2645	  2705#
MISCRT	   824	  2932#
MKNMLT	  1660	  1669#
MLTTAB	   835	  2300#
MODCL1	  1845	  1860#
MODCL2	  1847	  1849	  1853#
MONTAB	  2885	  2904#
MRKONE	  3464#
MRKZRO	  1675	  1682	  3457#	  3492	  3496
MSG	   552	   557	   647	   852	  1032	  2649	  2677	  2681	  2688	  2762	  2767	  2772	  2794#	  2814
	  2887	  2893	  2896	  2951	  3250	  3254	  3555	  3574	  3577	  3651
MSGL	  2795#	  2798
MXCHN	   211#	   315	   625	   841	  1324	  1333
N	   196#	   197	   393	   553	  1051	  1054	  1070	  1073	  1506	  1541	  1695	  1916	  2493	  2642
Symbol cross reference

	  2666	  2669	  2674	  2678	  2682	  2691	  2694	  2695	  2698	  2701	  2720	  2728	  2730	  2740	  2741
	  2742	  2743	  2744	  2747	  2748	  2873	  2881	  2888	  2946	  3108	  3243	  3251	  3256	  3556
	  3561	  3562	  3563	  3573	  3635	  3637	  3641	  3645	  3652
N1	   197#	  2713	  2717	  2718	  2720	  2722	  2725	  2726	  2727	  2729	  2740	  3564
NAMLP	  2755#	  2760
NEDZER	  1489	  1505#
NEDZRO	  1378	  1488#
NEDZT	  1339	  1371#
NOBWRT	   946	   948#
NOCLR	   764	   869	  2521#
NOCOR	  2458#	  2550
NOCOR1	  2453#	  2547
NODAT	  2853	  2896#
NODSER	  2470#
NOFREE	  2250	  2260#
NOJAL	   375	   378	   423	   426	   864	  2437#
NOLOS	  2199	  2210#
NOMULT	  2302	  2311#
NOPRTR	  2646	  2690#
NOPTR	  3419	  3423	  3435#
NOSPEC	  1596	  1609#
NOTRB	   788	   819#
NOTUFD	  1237	  1268#
NOUP	  2577	  2605#
NOW	  2773	  2785	  2850#
NOWLUP	  2870#	  2875
NULL	   510	   558	   634	   857	  2787	  2808#
NXTBBK	  3485#	  3499
NXTCHN	  1366#	  1370
NXTHOM	   662#	   675
NXTPTR	   349#	  1173	  1287	  1493	  1506	  1518	  1934	  3424
NXTSAT	  3639	  3644#
NXTSDN	   725	   747#
NXTSP2	   731	   746#
NXTSPT	   724#	   746
NXTST2	  3621	  3646#	  3655
NXTSTU	   721#	   748
NXUFDB	  1104#	  1151	  1160
OCTCTY	   394	  2738#	  3109	  3244
OCTCY1	  2741#	  2745
OCTPRT	  1052	  1055	  1071	  1074	  2667	  2670	  2679	  2683	  2699	  2702	  2726#	  3252	  3257
OCTSPC	  2715#
OCTZRO	  2716#	  3558
OLDONE	  3113	  3160#	  3237
OPNERR	   628	  2466#
P	   185	   205#	   370	   390	   392	   394	   397	   407	   417	   420	   429	   430	   463	   472
	   509	   510	   550	   552	   554	   557	   558	   560	   572	   577	   606	   619	   633	   634
	   647	   653	   661	   665	   674	   707	   716	   737	   752	   754	   767	   785	   790	   792
	   804	   813	   817	   819	   828	   832	   834	   836	   846	   852	   854	   855	   856	   857
	   859	   861	   863	   876	   895	   935	   947	   952	   957	   961	  1016	  1020	  1026	  1032
	  1036	  1043	  1046	  1048	  1050	  1052	  1053	  1055	  1057	  1058	  1062	  1065	  1071	  1072
	  1074	  1083	  1084	  1087	  1090	  1092	  1100	  1102	  1103	  1104	  1112	  1114	  1126	  1127
	  1140	  1148	  1150	  1153	  1174	  1177	  1179	  1181	  1188	  1193	  1196	  1198	  1203	  1204
	  1206	  1213	  1214	  1216	  1227	  1232	  1248	  1250	  1257	  1261	  1262	  1266	  1273	  1276
Symbol cross reference

	  1282	  1288	  1297	  1301	  1304	  1313	  1334	  1358	  1359	  1364	  1380	  1408	  1413	  1495	  1496
	  1499	  1503	  1505	  1524	  1539	  1542	  1576	  1584	  1587	  1590	  1608	  1610	  1617	  1618
	  1629	  1631	  1637	  1639	  1649	  1656	  1659	  1663	  1666	  1668	  1669	  1671	  1672	  1673
	  1675	  1680	  1682	  1685	  1686	  1687	  1691	  1693	  1695	  1710	  1714	  1729	  1730	  1731
	  1734	  1739	  1745	  1746	  1749	  1751	  1756	  1763	  1765	  1771	  1772	  1774	  1776	  1788
	  1792	  1796	  1799	  1801	  1802	  1822	  1826	  1833	  1841	  1848	  1852	  1855	  1859	  1867
	  1873	  1877	  1883	  1884	  1889	  1892	  1899	  1902	  1903	  1909	  1910	  1912	  1915	  1922
	  1923	  1925	  1939	  1940	  1942	  1949	  1950	  1954	  1961	  1962	  1964	  1971	  1972	  1974
	  1981	  1982	  1985	  1996	  1997	  1999	  2006	  2007	  2009	  2012	  2017	  2018	  2020	  2023
	  2028	  2029	  2031	  2047	  2062	  2070	  2086	  2203	  2204	  2207	  2253	  2254	  2257	  2305
	  2306	  2308	  2309	  2422	  2436	  2442	  2491	  2496	  2500	  2508	  2513	  2515	  2544	  2551
	  2561	  2564	  2578	  2579	  2581	  2625	  2626	  2631	  2632	  2642	  2643	  2649	  2654	  2655
	  2658	  2659	  2660	  2661	  2665	  2667	  2668	  2670	  2672	  2673	  2674	  2677	  2679	  2681
	  2682	  2683	  2684	  2685	  2686	  2688	  2689	  2690	  2691	  2692	  2699	  2700	  2702	  2721
	  2729	  2731	  2732	  2753	  2762	  2763	  2765	  2767	  2770	  2772	  2773	  2781	  2785	  2786
	  2787	  2797	  2812	  2813	  2822	  2828	  2830	  2832	  2837	  2840	  2841	  2846	  2847	  2848
	  2861	  2862	  2871	  2874	  2876	  2877	  2878	  2883	  2887	  2889	  2890	  2892	  2948	  2949
	  2951	  2982	  2988	  2991	  2992	  2993	  2996	  3008	  3013	  3014	  3024	  3036	  3059	  3069
	  3073	  3077	  3084	  3085	  3098	  3101	  3102	  3107	  3108	  3109	  3122	  3123	  3124	  3125
	  3151	  3152	  3153	  3154	  3155	  3164	  3208	  3229	  3236	  3242	  3244	  3245	  3250	  3252
	  3254	  3257	  3357	  3359	  3364	  3370	  3371	  3376	  3381	  3385	  3386	  3387	  3388	  3396
	  3408	  3429	  3432	  3433	  3452	  3453	  3457	  3458	  3460	  3464	  3466	  3468	  3474	  3477
	  3490	  3492	  3494	  3496	  3498	  3503	  3508	  3519	  3520	  3551	  3555	  3558	  3559	  3560
	  3565	  3575	  3577	  3578	  3579	  3588	  3608	  3647	  3649	  3651	  3653	  3654	  3667	  3676
	  3679	  3681	  3682	  3685	  3688	  3693	  3696	  3700
P1	   201#	   202	   507	   548	   625	   626	   629	   632	   655	   656	   660	   667	   668	   673
	   848	  1015	  1018	  1031	  1034	  1038	  1060	  2492	  2498	  2514	  2782	  2943	  2953	  2987
	  2990	  2995	  3003	  3473	  3476	  3480	  3481	  3482	  3485	  3500	  3501	  3505	  3507	  3515
	  3613	  3615	  3625
P2	   202#	   203	   723	   724	   746	   873	   874	   875	   894	   915	  1079	  1223	  1224	  1225
	  1226	  1232	  1234	  1235	  1238	  1247	  1248	  1262	  1263	  1265	  1273	  1274	  1280	  1300
	  1313	  1329	  1330	  1331	  1343	  1345	  1347	  1351	  1353	  1374	  1376	  1377	  1379	  1398
	  1410	  1411	  1412	  1414	  1420	  1427	  1430	  1443	  1490	  1580	  1611	  1818	  1819	  1823
	  1831	  1834	  1835	  1842	  1868	  1874	  1881	  1932	  3484	  3486	  3499	  3537	  3544	  3556
	  3569
P3	   203#	   204	   721	   722	   732	   734	   739	   745	   747	   871	   872	   874	   878	   916
	   937	   938	   939	   940	   942	   954	   955	   956	  1021	  1037	  1039	  1042	  1044	  1051
	  1054	  1063	  1064	  1067	  1070	  1073	  1527	  1529	  1530	  1531	  2926	  2933	  2950	  3534
	  3545	  3568
P4	   204#	   697	   699	   704	   776	   777	   780	   781	   783	   814	   815	   831	   833	   835
	   996	  1011	  1079	  1080	  1081	  1082	  1085	  1089	  1093	  1099	  1101	  1107	  1120	  1121
	  1122	  1125	  1130	  1133	  1142	  1143	  1148	  1149	  1154	  1156	  1162	  1164	  1172	  1173
	  1186	  1189	  1192	  1194	  1195	  1197	  1223	  1225	  1230	  1242	  1243	  1244	  1246	  1249
	  1252	  1255	  1264	  1268	  1269	  1270	  1272	  1275	  1280	  1281	  1283	  1286	  1287	  1307
	  1316	  1329	  1331	  1332	  1346	  1348	  1350	  1352	  1362	  1371	  1372	  1493	  1494	  1506
	  1508	  1515	  1580	  1582	  1586	  1589	  1593	  1599	  1601	  1605	  1609	  1625	  1631	  1632
	  1641	  1642	  1645	  1650	  1694	  1698	  1703	  1704	  1705	  1709	  1711	  1713	  1717	  1719
	  1723	  1725	  1726	  1727	  1729	  1733	  1737	  1743	  1744	  1755	  1759	  1768	  1783	  1785
	  1801	  1803	  1818	  1820	  1824	  1827	  1829	  1837	  1838	  1843	  1870	  1875	  1878	  1887
	  1890	  1891	  1893	  1896	  1901	  1916	  1917	  1930	  1987	  1988	  2055	  2494	  2495	  2512
	  2935	  2937	  2939	  2941	  2947	  3372	  3373	  3377	  3382	  3383	  3384	  3393	  3395	  3403
	  3405	  3406	  3407	  3417	  3418	  3422	  3424	  3538	  3539	  3551	  3553	  3572	  3575	  3576
	  3584	  3585	  3593	  3597	  3600
PAGERR	   619	  1408	  3059	  3069	  3084	  3098	  3101	  3105#	  3151	  3245
Symbol cross reference

PAGO	   294#	   295
PAGOK	  3076	  3080#
PAGOPG	   295#
PAGRDP	   952	  1114	  3032#	  3357
PAGRED	   737	   876	  2996	  3037#	  3508
PAGWRT	   895	  3209#
PAGWTP	   947	   961	  3204#
PASS2	   798	   806#
PDL	   290#	   370	   429
PDLSIZ	   289#	   290	   370	   429
PDOT	   855	  1046	  2658	  2806#	  3579
PG%.ER	  3253#
PIOERR	  2449#	  3138
PR6BIT	   509	   550	   854	  1043	  1048	  2654	  2659	  2765	  2770	  2824#	  2829
PRDATE	  2880#
PREFER	  1470	  1476	  1479	  1483#
PRMRB0	  1854	  1856	  1863	  1868#
PRMRB1	  1185	  1802	  1818#
PRMRB2	  1187	  1884#
PRMRIB	  1712	  1799#
PRNFIL	   965	   975	   994#
PRTBU1	  2653#	  2697
PRTRB2	  2655#	  2703
PRTRB3	  2663	  2674#
PRTRB4	  2675	  2684#
PRTRBL	  1301	  1509	  1545	  1696	  1918	  2642#	  2948
PRTRBU	  2652	  2694#
PRVBUF	  3078	  3095#
PRVERM	  1921	  1927#
PS.NER	   304#	  3099
PTNPNO	   164#	   733	  1443	  2678	  3033	  3205	  3430	  3444
PTNUNI	   162#	   729	  1414	  2083	  2682	  3004	  3032	  3204	  3427	  3443	  3489	  3516
PTRBAD	  1619	  1636	  1638	  1640	  1644	  1648	  1756#
PTRBD1	  1630	  1755#
PTRBSB	  1153	  1737#	  1756
PTRDST	   692	   700	   721	   741	   871	   888	   921	  1670	  2134#	  2134	  2164	  2197	  2248	  3019
	  3495	  3613	  3618
PTROST	   807	   881	  1088	  1674	  2136#	  2136	  2166	  2198	  2249	  3491	  3615
PTRPGE	  1404	  2145#	  2145	  3075	  3143
PTRPPU	   568#	   568	   576	   579	  3035	  3207	  3431	  3487	  3534	  3616
PTRSAD	   691	   735	   873	   927	  2137#	  2137
PTRSWB	  2148#	  2148	  3023
PTRSWP	  2147#	  2147	  3021
PTRTST	  1658	  1681	  2135#	  2135	  2165	  2300	  2301
PTRUNU	  1320	  1403	  1417	  1454	  2138#	  2138	  3064
PTRUPG	   599	  1405	  1465	  1477	  2143#	  2143	  3074	  3134
PTSPNO	   163#	   733	  1443	  2678	  3033	  3205	  3430	  3444
PTSUNI	   161#	   729	  1414	  2083	  2682	  3004	  3032	  3204	  3427	  3443	  3489	  3516
PVYERR	  2462#
QUIT	   464	  2581#
QUIT0	  2443	  2577#
RADIX	  2718#	  2718	  2722	  2727	  2728
RBEOF1	  1707	  1711#
RBLVPR	   167#	   723	  1131	  3402
Symbol cross reference

RBLVSR	   168#	  1732	  3404
RBREAL	   165#	   727	  1108	  1627	  2084	  3005	  3356	  3425	  3517
RBSPAR	   166#	  1110	  1620	  1706	  1720
RCVBUF	   994	  3702#
RDXPRT	  2719	  2728#	  2731
RELDEL	  1525	  1549#
RELDL1	  1550#	  1557
RELDL2	  1553	  1556#
RENAD1	   186	   427#
RENADR	   181	   184#
RENFIL	   976#	   993
RIBALP	   152#	  1891	  2008
RIBCHK	   716	  1639	  1714	  3356#	  3370
RIBCOD	   153#	  3362
RIBEOF	  1622	  1698#	  1766	  1789
RIBERR	  1517	  1541#
RIBEXT	   145#	  1838	  3378
RIBLBN	   348#	   777	   815	  1082	  1089	  1101	  1249	  1255	  1275	  1316	  1352	  1541	  1586	  1589
	  1593	  1713	  1916	  1988	  2158
RIBLCW	   148#	  1820	  1829	  1843	  1858	  1870	  1875
RIBLST	   137#	   167	   168	  1717	  1724	  1784	  1785	  1791	  1795
RIBMXA	   151#	  1195	  1215
RIBNAM	   144#	  3374
RIBNZF	  1701	  1761	  1780#
RIBPFS	   136#	   167	   724	  1705	  1727	  3402
RIBPPN	   143#	  3375
RIBPVW	   146#	  1824	  1827	  1837
RIBRIB	   139#	  1643	  1704	  1711	  3379	  3403
RIBRPS	   140#	  1647	  1723
RIBSFS	   138#	   168	  1703	  3404
RIBSIZ	   147#	  1893	  2019
RIBSLF	   154#	  1642	  3361
RIBSNM	   142#	  1901	  1998
RIBSTS	   149#	  1260	  1887	  1984
RIBSZS	   141#	  1085	  1709	  1719	  1729	  1733	  1768	  1773
RIBUSD	   150#	  1192	  1205
RIBZEF	  1699	  1703#
RIPALC	   159#	  1853	  1857	  1860	  1862	  1865	  1871
RIPBDA	   158#	   979	  1259
RIPDIR	   157#	  1886	  1888	  1983
RIPNUB	   156#
RJRDXP	  2714	  2718#
ROUTIN	   352#	   769	   771	  1148	  1582	  1631	  1801	  2055
RTNIDX	  2056#	  2056	  2087
RTNPAG	  2058#	  2058	  2064	  2072
RTNUNI	  2057#	  2057	  2065	  2082
SATFN1	   699#	   703
SATFUN	   698#	   704
SATIOR	   890#	   893
SATPRC	  2046#	  2381
SATRIB	   715	  2046	  2154#	  2154	  2371
SATTAB	   699	  2164#	  2167
SATULP	   691#	   696
SAVBLK	   356#	   773	   775	  1143	  1223	  1329	  1372	  1570
Symbol cross reference

SAVRIB	   353#	  1085	  1192	  1195	  1642	  1645	  1703	  1704	  1705	  1709	  1711	  1717	  1719	  1723
	  1725	  1727	  1729	  1733	  1744	  1768	  1783	  1785	  1820	  1824	  1827	  1829	  1837	  1838
	  1843	  1870	  1875	  1887	  1891	  1893	  1901	  3393	  3395	  3403	  3405
SAVSNM	  1184	  1612#	  1612	  1728	  1900
SBKERR	   738	   877	  2621#
SETFIX	   752	   754	   790	   792	   935	  1100	  1126	  1610	  3665#
SETPTR	  1617	  3386	  3402#
SETTLE	   572#	   582
SETUFX	  1848	  1909	  1922	  1930#	  1939	  1949	  1961	  1971	  2028
SIZERM	  2016	  2022#
SIZRIB	   365#	  1107	  1625	  1737	  1755	  1896	  3382
SKPENT	  1241	  1263#
SNMERM	  1995	  2001#
SPACT2	  1607	  2377#
SPAROK	  1613#	  1613	  1626	  1635	  1716	  1722	  1738
SPC	  2660	  2673	  2684	  2685	  2800#	  2876	  2877	  3559	  3560
SPCACT	   823	  1594	  2367#
SPCLEN	   820	  1592	  2415#	  3592
SPRPTR	  1621	  1635#
SPUFDN	   822	  2370	  2380	  2391	  2402	  2412
SRBERR	   717	   726	   728	   732	   747	  2617#
SRNWST	  3542#	  3569
SRNWUN	  3534#	  3571
SRNXCL	  3544#	  3552	  3564	  3566
SRNXST	  3546	  3568#
SRNXUN	  3545	  3570#
SRTST	  3548	  3551#
STAITM	   322#	   382
STATAB	   323#	   382
STBLEN	   697	  2167#
STCNT1	   901	   914#
STCNT3	   899#	   914
STPT	   370#	  3712
STPT1	   401	   410#
STPT2	   408	   420#
STRHAD	   690#	   690	  1094	  1134	  1155	  1163
STRHSH	   685	   686	   688	   689	  1119	  1229	  1355	  2159#	  2159
STRLU1	  2973	  2979#
STRLUX	  2970	  2975	  2981#
STRNAM	   462#	   462	   466	   467	   471	   502	   508	   549	   622	   853	   972	  2764	  2964	  3009
STROVR	  2153#	  2153
STRPPU	   569#	   569	   580	   581	  1450	  3037	  3211	  3536
SUUINI	   335#	  2588
SUUMSG	   334#	  2505
SWPRIB	  2156#	  2156
SYSEXT	  1602	  2409#	  2415	  2938	  3601
SYSNAM	  1598	  2399#	  2936	  3594
SYSPPN	  1604	  2388#	  2940	  3598
SYSPRC	  2039#	  2379
SYSRIB	  1317	  1318	  2157#	  2157	  2369
SZSERM	  1770	  1776#
T	   191#	   192	   193	   194	   195	   373	   374	   376	   377	   382	   383	   384	   385	   421
	   422	   424	   425	   431	   432	   433	   434	   442	   443	   445	   446	   448	   449	   452
	   453	   455	   456	   457	   458	   460	   462	   467	   468	   470	   471	   477	   478	   508
Symbol cross reference

	   513	   514	   516	   517	   518	   519	   521	   549	   561	   562	   566	   567	   568	   573	   574
	   576	   578	   579	   580	   581	   586	   587	   588	   591	   592	   604	   605	   616	   617
	   618	   621	   627	   637	   638	   639	   642	   644	   645	   657	   659	   669	   671	   683
	   684	   686	   687	   688	   691	   693	   699	   702	   705	   706	   708	   709	   710	   711
	   712	   715	   718	   719	   724	   726	   727	   729	   733	   734	   735	   736	   739	   740
	   741	   742	   743	   744	   751	   753	   757	   758	   765	   766	   768	   769	   770	   771
	   772	   773	   774	   775	   779	   780	   781	   782	   783	   789	   791	   794	   795	   807
	   808	   809	   810	   812	   820	   822	   823	   825	   837	   839	   841	   843	   845	   853
	   878	   879	   880	   881	   882	   883	   884	   896	   913	   915	   920	   922	   924	   925
	   927	   931	   934	   942	   943	   945	   946	   948	   949	   950	   956	   957	   960	   962
	   968	   969	   983	   985	   987	   992	   993	   994	   995	   996	  1000	  1002	  1006	  1008
	  1039	  1040	  1042	  1044	  1045	  1047	  1067	  1068	  1082	  1085	  1086	  1088	  1095	  1096
	  1097	  1099	  1101	  1106	  1108	  1110	  1116	  1118	  1119	  1122	  1123	  1125	  1128	  1130
	  1131	  1135	  1139	  1141	  1143	  1144	  1145	  1146	  1147	  1149	  1156	  1157	  1164	  1165
	  1172	  1180	  1197	  1208	  1218	  1226	  1228	  1229	  1230	  1231	  1234	  1244	  1245	  1246
	  1247	  1249	  1256	  1269	  1271	  1272	  1274	  1275	  1286	  1299	  1300	  1345	  1346	  1347
	  1348	  1349	  1350	  1351	  1352	  1353	  1354	  1355	  1356	  1357	  1427	  1428	  1441	  1468
	  1469	  1471	  1472	  1473	  1474	  1475	  1494	  1507	  1508	  1521	  1526	  1527	  1528	  1529
	  1543	  1544	  1554	  1555	  1586	  1589	  1592	  1594	  1595	  1596	  1598	  1602	  1604	  1607
	  1609	  1620	  1622	  1627	  1656	  1657	  1658	  1667	  1670	  1674	  1681	  1686	  1692	  1694
	  1711	  1713	  1719	  1721	  1752	  1764	  1777	  1781	  1782	  1785	  1800	  1803	  1819	  1821
	  1823	  1825	  1831	  1832	  1834	  1836	  1840	  1842	  1846	  1860	  1861	  1862	  1864	  1866
	  1868	  1869	  1872	  1874	  1876	  1885	  1886	  1887	  1888	  1914	  1917	  1927	  1931	  1944
	  1956	  1966	  1976	  1987	  1991	  2001	  2011	  2022	  2033	  2056	  2068	  2085	  2087	  2426
	  2427	  2428	  2429	  2431	  2497	  2498	  2543	  2545	  2546	  2548	  2549	  2555	  2556	  2557
	  2560	  2585	  2586	  2588	  2589	  2591	  2592	  2593	  2594	  2596	  2597	  2598	  2599	  2600
	  2601	  2602	  2625	  2626	  2627	  2628	  2629	  2630	  2631	  2643	  2650	  2653	  2655	  2656
	  2657	  2661	  2662	  2666	  2669	  2690	  2694	  2698	  2701	  2719	  2738	  2745	  2754	  2755
	  2759	  2760	  2764	  2768	  2769	  2783	  2784	  2829	  2872	  2882	  2925	  2936	  2938	  2940
	  2942	  2947	  2952	  2953	  2971	  2972	  2973	  2976	  2977	  2998	  3000	  3009	  3011	  3018
	  3019	  3020	  3021	  3022	  3023	  3032	  3033	  3091	  3092	  3093	  3095	  3096	  3097	  3099
	  3100	  3125	  3126	  3127	  3128	  3130	  3131	  3134	  3146	  3147	  3149	  3150	  3152	  3165
	  3171	  3204	  3205	  3239	  3240	  3243	  3356	  3361	  3372	  3374	  3377	  3380	  3393	  3394
	  3395	  3402	  3404	  3405	  3406	  3420	  3424	  3425	  3427	  3430	  3435	  3446	  3447	  3451
	  3459	  3467	  3491	  3495	  3510	  3512	  3535	  3536	  3537	  3557	  3584	  3586	  3592	  3594
	  3595	  3596	  3598	  3601	  3616	  3617	  3619	  3622	  3624	  3625	  3626	  3627	  3628	  3629
	  3631	  3632	  3634	  3636	  3638	  3665	  3666	  3679	  3680	  3682	  3689	  3692	  3695	  3698
T1	   192#	   502	   505	   590	   591	   593	   597	   598	   599	   601	   602	   622	   656	   657
	   658	   659	   668	   669	   670	   671	   689	   690	   692	   693	   700	   701	   702	   706
	   712	   713	   729	   730	   733	   736	   742	   744	   777	   778	   811	   812	   815	   816
	   875	   880	   888	   889	   890	   893	   894	   897	   899	   900	   914	   921	   922	   938
	   940	   971	   974	   977	   978	   979	   980	   981	   982	   983	   984	   985	   986	   987
	   988	   997	  1003	  1013	  1014	  1017	  1018	  1033	  1034	  1059	  1060	  1089	  1093	  1094
	  1096	  1098	  1120	  1121	  1123	  1127	  1140	  1141	  1145	  1146	  1154	  1155	  1157	  1158
	  1159	  1162	  1163	  1165	  1167	  1173	  1185	  1187	  1188	  1231	  1235	  1236	  1243	  1255
	  1270	  1287	  1290	  1291	  1292	  1293	  1294	  1295	  1296	  1305	  1306	  1308	  1309	  1310
	  1311	  1312	  1316	  1317	  1323	  1324	  1327	  1328	  1357	  1360	  1361	  1362	  1363	  1372
	  1373	  1374	  1375	  1376	  1443	  1452	  1454	  1464	  1465	  1466	  1467	  1477	  1478	  1493
	  1514	  1515	  1518	  1549	  1551	  1556	  1557	  1558	  1559	  1560	  1561	  1562	  1563	  1564
	  1565	  1566	  1567	  1568	  1569	  1571	  1572	  1573	  1575	  1581	  1582	  1593	  1594	  1598
	  1599	  1601	  1602	  1604	  1605	  1607	  1608	  1641	  1645	  1646	  1647	  1657	  1669	  1673
	  1680	  1703	  1705	  1706	  1717	  1720	  1723	  1724	  1725	  1726	  1727	  1728	  1829	  1830
	  1835	  1836	  1838	  1839	  1881	  1882	  1893	  1894	  1895	  1898	  1930	  1931	  1933	  1934
	  1988	  2054	  2055	  2059	  2060	  2061	  2072	  2073	  2075	  2076	  2077	  2078	  2080	  2081
Symbol cross reference

	  2083	  2084	  2085	  2090	  2091	  2092	  2093	  2094	  2205	  2206	  2255	  2256	  2307	  2644	  2645
	  2650	  2651	  2850	  2851	  2852	  2853	  2858	  2862	  2863	  2864	  2867	  2878	  2880	  2884
	  2888	  2890	  2891	  2936	  2937	  2938	  2939	  2940	  2941	  2944	  2945	  2979	  2980	  2995
	  2999	  3001	  3003	  3004	  3005	  3006	  3010	  3012	  3033	  3035	  3039	  3055	  3064	  3067
	  3073	  3074	  3077	  3081	  3085	  3124	  3126	  3130	  3153	  3205	  3207	  3213	  3224	  3256
	  3360	  3362	  3373	  3375	  3378	  3380	  3418	  3420	  3421	  3422	  3423	  3430	  3431	  3443
	  3444	  3445	  3446	  3447	  3449	  3450	  3451	  3459	  3467	  3485	  3486	  3487	  3489	  3490
	  3494	  3498	  3507	  3511	  3513	  3515	  3516	  3517	  3518	  3542	  3547	  3548	  3585	  3587
	  3593	  3594	  3619	  3627	  3633	  3634	  3687	  3688	  3690	  3695	  3697	  3698	  3699
T2	   193#	   479	   500	   503	   623	   890	   891	   899	   900	   901	   902	   905	   908	   910
	   911	   912	   954	   972	   999	  1004	  1133	  1134	  1135	  1137	  1189	  1192	  1194	  1195
	  1205	  1215	  1238	  1239	  1259	  1260	  1282	  1283	  1290	  1304	  1305	  1306	  1307	  1308
	  1309	  1312	  1405	  1406	  1407	  1420	  1421	  1422	  1424	  1450	  1451	  1452	  1519	  1520
	  1526	  1528	  1532	  1533	  1534	  1535	  1536	  1537	  1538	  1550	  1551	  1552	  1553	  1555
	  1570	  1571	  1572	  1573	  1574	  1575	  1642	  1643	  1698	  1700	  1702	  1708	  1709	  1731
	  1732	  1733	  1743	  1744	  1748	  1759	  1760	  1768	  1773	  1780	  1781	  1782	  1783	  1784
	  1790	  1791	  1793	  1794	  1795	  1820	  1821	  1824	  1825	  1827	  1828	  1830	  1832	  1837
	  1839	  1840	  1850	  1851	  1857	  1858	  1870	  1871	  1872	  1875	  1876	  1878	  1879	  1880
	  1882	  1890	  1891	  1896	  1897	  1898	  1900	  1901	  1911	  1924	  1941	  1951	  1952	  1953
	  1963	  1973	  1983	  1984	  1998	  2008	  2019	  2030	  2854	  2855	  2856	  2863	  2865	  2881
	  2885	  2964	  2965	  2968	  2981	  3037	  3038	  3039	  3056	  3057	  3058	  3060	  3062	  3063
	  3082	  3083	  3087	  3123	  3154	  3211	  3212	  3213	  3226	  3227	  3239	  3448	  3450	  3543
	  3546	  3597	  3598	  3600	  3601	  3686	  3689	  3691
T3	   194#	   497	   504	   624	   626	   627	   842	   843	   844	   887	   891	   892	   902	   903
	   904	   905	   906	   907	   908	   909	   910	   913	   955	   973	  1005	  1490	  1491	  1492
	  1497	  1498	  1500	  1501	  1502	  1522	  1747	  1748	  1851	  1911	  1924	  1932	  1933	  1941
	  1951	  1953	  1963	  1973	  2030	  2206	  2256	  2307	  2857	  2865	  2866	  2873	  2886	  2965
	  2966	  2969	  2974	  2977	  2978	  2980	  3538	  3540	  3549	  3630	  3631	  3639	  3676	  3677
	  3678	  3680	  3683	  3684	  3685	  3686	  3687	  3690	  3691	  3692
T4	   195#	   499	   504	  1843	  1853	  1861	  1865	  2205	  2255	  2858	  2859	  2860	  2861	  2868
	  2873	  2875	  2966	  2967	  2968	  2969	  3539	  3541	  3550	  3618	  3619	  3622	  3626	  3629
	  3636	  3638	  3640	  3642	  3643
TAB	  2810#
TCHBUF	  3070	  3086#
THSERR	  2628#	  2628	  2644
TIMERM	  1938	  1944#
TIMITM	   328#	  2854
TIMTAB	   329#	  2854
TOTFRE	  2252	  2291#
TOTLOS	  2201	  2239#
TOTMLT	  2304	  2342#
TPOPJ	  1665	  1686#
TPOPJ1	  1677	  1685#
TRBFIL	   755#	   755	   793	  1583	  1585	  2647
TRBFLG	   623#	   623	   756#	   756	   787	  1662	  1678
TRMBLK	   314#	   507	   511	   548	   559	   632	   641	   646	   848	   858	  1015	  1019	  1031	  1035
	  1038	  1061	  2492	  2499	  2782	  2788	  2833	  2845	  2943	  2954
TRMMES	   390	   392	   397	   407	   417	   560	   859	  1020	  1036	  1062	  2419#	  2442	  2491	  2500
	  2564	  2578	  2749	  2781	  2789	  2846	  3107	  3164	  3236	  3242
TRMOP2	  2835	  2838#
TRMOPR	   644	   765	  2832#	  2842
TRMPTR	  2834#	  2834	  2838	  2844
TRMSAV	   477	  2494	  2514#	  2783	  2944
TSTZRO	  1090	  1659	  1671	  3443#	  3457	  3464
Symbol cross reference

TYO	   642	  2513	  2819#
TYOBTH	  1013	  2512#
TYODSP	   478	   645	   766	  1014	  1050	  1057	  2495#	  2495	  2665	  2672	  2721	  2734	  2784	  2797
	  2801	  2803	  2805	  2807	  2809	  2828	  2836	  2843	  2871	  2945
U	   200#	   567	   569	   582	   585	   587	   596	   600	   651	   664	   677	   682	   694	   695
	   698	   703	   720	   730	   748	   806	   870	   917	   919	   923	   926	  1319	  1321	  1399
	  1401	  1414	  1415	  1431	  1433	  1451	  2065	  2066	  2082	  2083	  2493	  2971	  3004	  3032
	  3034	  3038	  3122	  3133	  3136	  3155	  3204	  3206	  3212	  3251	  3427	  3428	  3443	  3472
	  3489	  3502	  3516	  3533	  3535	  3570	  3571	  3612	  3646	  3652
UFDALC	   244#	  1881	  2030
UFDBDH	  1132	  1136	  1170#
UFDBHM	  1171	  1179#
UFDBKF	   357#	  1125	  1149	  1172	  1286	  1494	  1521	  1931
UFDBSZ	  1125#	  1166
UFDBUF	   368#	   774
UFDDN1	  1191	  1197#
UFDDON	  1106	  1184#
UFDERR	  1600	  1603	  1606	  2929#
UFDESH	  1129	  1139#	  1175	  1182
UFDEXT	   239#	  1235	  1347
UFDHSP	   364#	   684	   687	  1093	  1120	  1121	  1133	  1154	  1162	  1230	  1356
UFDIGN	  1105	  1111	  1113	  1115	  1124	  1153#	  1168
UFDLIC	   243#	  1819	  1911
UFDLSD	   360#	  1080	  1252	  1361	  1523
UFDLST	   247#	  1292	  1293	  1308	  1309	  1534	  1535	  1562	  1563	  1571	  1572	  1573	  1574
UFDNAM	   238#	  1226	  1234	  1345	  1353
UFDNRL	  1109	  1154#
UFDOGP	   351#	  1225	  1283	  1307	  1331	  1421	  1491	  1520	  1560	  1933
UFDPCT	   315#	  1326	  1327	  1328	  1422	  1424	  1559	  1562	  1563	  1566
UFDPRC	   770	  1316#
UFDPRV	   240#	  1823	  1868	  1924	  1963
UFDPTR	   350#	  1079	  1580	  1818
UFDRBP	   245#	  1238	  1247	  1274	  1351	  1414	  1443
UFDRIB	   367#	   687	   771	   775	  1242	  1332	  1349	  1356	  1361	  1363	  1371	  1421	  1491	  1518
	  1520	  1521	  1522	  1523	  1560	  1570
UFDSIZ	   246#	   247	  1224	  1263	  1291	  1306	  1330	  1410	  1533	  1554	  1556	  1559	  1561	  1568
	  1569
UFDTMD	   242#	  1831	  1834	  1835	  1874	  1941	  1951	  1953	  1973
UFDUF2	   241#	  1427	  1842	  1851
UFDUSD	   357#	  1081	  1189	  1194	  1363
UFPALC	   248#	  1428	  1846	  1850	  1860	  1869
UMFSLP	  1096#	  1098
UNITAB	   591	  2134#	  2149
UNTLEN	   590	  2149#
UPRBND	   432	  2543	  2548	  3709#
VL.WAT	   308#	  3226
VLIOE%	   309#	  3240
VRAT	    15#	   102	   393
WRTERR	  3228	  3239#
WRTFAT	  3225	  3231#
WRTSAT	   871#	   917
WRTST1	   886	   894#
WRTSTU	   875#	   916
XCHPTR	  3065	  3073#
Symbol cross reference

XX	  2367	  2377	  2388	  2399	  2409
%%Z	   346#	   348	   348#	   349	   349#	   350	   350#	   351	   351#	   352	   352#	   353	   353#	   354
	   354#	   355	   355#	   356	   356#	   357	   357#	   358	   358#	   359	   359#	   360	   360#	   361
	   361#	   362	   362#	   363	   363#	   364	   364#	   365	   365#	   366	   366#	   367
.ADDWS	   302#	  1471
.CHBA	   220#	  2093	  2094	  3473
.CHBPU	   218#	   578
.CHBSA	   221#	   223	  2059	  2076
.CHCHR	   217#
.CHHA	   219#	  2091	  2092	  2987
.CHLEN	   223#	   313	   457	   573
.CHSMP	   297#	  1468	  3066
.CHSNM	   216#	   460
.IAERR	   306#	   445
.IAILM	   307#
.PRCW	   299#	   616	  3096	  3149
.PRRO	   298#	  1466	  3062
.PRRW	   300#	  3060
.WSRNG	   303#	  1474
Macro/Opdef cross reference

CORE	  2549	  2586
DATUUO	  2859
DEVCHR	   638
DISMIS	  3156
DSKCHR	   458	   574
DSKCLR	   762	   862	   867	   930
ERRLEV	   229#	  1179	  1505	  1542	  1666	  1693	  1751	  1763	  1776	  1915	  2012	  2023	  2202	  2253
	  3649
EXIT	  2565	  2580	  2584
GETTAB	   374	   383	   422	   517	  2427	  2556	  2592	  2757	  2851	  2855
INCHRW	   513
INTADR	   443
INTASS	   446
INTENB	   449
MONMAC	  2903#	  2905
ONEJOB	   410
OUTSTR	   511	   512	   544	   641	   801	   839	  2421	  2507	  3605
PERSET	  3100
PGESTS	  3128
PJRST	   225#	  2774	  2789
PREREF	  1478
RUN	  2602	  3171
SETJAL	   377	   425
SETUUO	  2506	  2589
SPCMAC	  2354#	  2367	  2377	  2388	  2399	  2409
SYSSTR	   468
UUU	   343#	   347	   348	   349	   350	   351	   352	   353	   354	   355	   356	   357	   358	   359
	   360	   361	   362	   363	   364	   365
VALPAG	  3227
VCLEAR	  1407	  3058	  3093	  3147
VCREAT	   618	  3097	  3150
VREPLC	  3083
WSCTL	  1475
X	  2365#	  2368	  2369	  2370	  2371	  2372	  2375#	  2378	  2379	  2380	  2381	  2382	  2385#	  2389
	  2390	  2391	  2392	  2393	  2396#	  2400	  2401	  2402	  2403	  2404	  2407#	  2410	  2411	  2412
	  2413	  2414  M-
AC ** FICHE/FRAME BREAK *****
CACC
             AC-CODED  CIRCUIT ANALYSIS PROGRAM


       AC-CODED  IS A COMPUTER PROGRAM WHICH WILL PERFORM
AC ANALYSIS OF LINEAR ELECTRICAL NETWORKS.  CIRCUITS MAY
INCORPORATE : 1) RESISTORS, 2) CONDUCTORS, 3) CAPACITORS,
4) INDUCTORS, 5) INDEPENDENT VOLTAGE SOURCES, 6) CURRENT AND
VOLTAGE DEPENDENT VOLTAGE SOURCES, 7) INDEPENDENT CURRENT SOURCES,
8) CURRENT AND VOLTAGE DEPENDENT CURRENT SOURCES, 9) OPEN CIRCUITS,
AND 10) SHORT CIRCUITS.

       THE PROGRAM PRINTS NODE VOLTAGES.  OTHER OUTPUTS WHICH
MAY BE OBTAINED ARE : 1) INPUT IMPEDANCE, 2) OUTPUT IMPEDANCE
3) BRANCH CURRENTS, 4) VOLTAGE GAIN, 5)CURRENT GAIN, 6) ADMITTANCE
GAIN,  7) IMPEDANCE GAIN, AND 8) INSERTION LOSS.

       NODE VOLTAGES MAY BE PLOTTED AS A FUNCTION OF FREQUENCY.

       THE PROGRAM CAN HANDLE 25 NODES AND 99 PARAMETERS.

       THE FOLLOWING TYPES OF ANALYSIS ARE AVAILABLE : 1)NOMINAL
SOLUTIONS ; 2) WORST CASE ; 3) PARAMETER VARIATION ; 4) DIFFERENTIAL
ANALYSIS ; 5) STATISTICAL ANALYSIS.

       THE PROGRAM IS DESIGNED TO BE USED BY A PERSON WITH NO
KNOWLEDGE OF PROGRAMMING.
AC ** FICHE/FRAME BREAK *****
CACDOC
DOCUMENTATION FOR AC-CODED VERSION 12.02 11-1-71

THE SYMBOLICS FOR AC-CODED ARE:
CACOV1         MAIN OVERLAY
CACOV2         SOLUTION OVERLAY
CACLIST        COMMAND LIST

CACM           THIS IS A COMMAND FILE FOR MAKING AC-CODED
               FROM THE ABOVE 3 FILES.

THE FOLLOWING FILES ARE TO BE PUT IN THE (@6LC) ACCOUNT.
CACH           SYMBOLIC FILE 'HELP'
CACI           SYMBOLIC FILE 'INSTRUCTIONS'
CACC           SYMBOLIC FILE 'CAPABILITY'

AC-CODED IS THE GO FILE.

                                       HARRY BOWERS

AC ** FICHE/FRAME BREAK *****
CACH
COMMAND       DESCRIPTION
-------       -----------
HELP          REPRINTS THIS LIST
?             REPRINTS THIS LIST
CAPABILITIES  DESCRIBES PROGRAM CAPABILITIES
INSTRUCTIONS  HOW TO EXECUTE THE PROGRAM
CREDITS       IMPLEMENTED BY TYMSHARE
CHARGES       YOUR REGULAR CHARGE
VERSION       LATEST UPDATE
READ FROM     READS CIRCUIT DESCRIPTION FROM A DATA FILE
WRITE ON      WRITES CIRCUIT DESCRIPTION ONTO A DATA FILE
ENTER         DELETES THE PRESENT CIRCUIT DESCRIPTION (IF ANY),
              AND READIES  AC-CODED  TO ACCEPT A NEW
              CIRCUIT DESCRIPTION
ADD           USED TO ADD NEW CIRCUIT ELEMENTS TO THOSE
              ALREADY DEFINED
CHANGE        PRINTS OUT THE OLD ELEMENT DESCRIPTION BEFORE 
              ACCEPTING A NEW ELEMENT DESCRIPTION
MODIFY        ACCEPTS A NEW ELEMENT DESCRIPTION
DELETE        DELETES ELEMENTS FROM THE CIRCUIT
PRINT         PRINTS OUT  THE ELEMENTS PRECEEDED BY A HEADING
LIST          PRINTS OUT THE ELEMENTS WITHOUT A HEADING
QUIT          RETURNS TO EXECUTIVE LEVEL  (-)
NOMINAL SOLUTION  THE NODE VOLTAGES ARE PRINTED OUT.  THE NOMINAL
              VALUES OF ALL PARAMETERS ARE USED
PARAMETER VARIATION  THE SPECIFIED PARAMETERS ARE VARIED ONE
              AT A TIME, AND NODE VOLTAGE SOLUTIONS ARE OBTAINED
              AT MAXIMUM, MINIMUM AND MEAN VALUES FOR EACH 
              SPECIFIED PARAMETER
DIFFERENTIAL ANALYSIS  SEE USER MANUAL
STATISTICAL ANALYSIS  SEE USER MANUAL
WORST CASE ANALYSIS  COMPUTES WORST CASE VOLTAGES 


ANY OF THE ABOVE COMMANDS MAY BE SHORTENED TO THE SMALLEST
SUBSET OF CHARACTERS WHICH UNIQUELY DISTINGUISH THE COMMAND 
FROM ALL OTHER COMMANDS, I.E. "CHARGES" MAY BE ABBREVIATED TO "CHAR".
AC ** FICHE/FRAME BREAK *****
CACI
CIRCUITS MAY INCORPORATE THE FOLLOWING ELEMENTS
1)  RESISTORS (R)
2)  CONDUCTORS (G)
3)  CAPACITORS (C)
4)  INDUCTORS (L)
5)  INDEPENDENT VOLTAGE SOURCES (E)
6)  CURRENT AND VOLTAGE DEPENDENT VOLTAGE SOURCES
    (DEPENDENCY: I R1, E E1)
7)  INDEPENDENT CURRENT SOURCES (I)
8)  CURRENT AND VOLTAGE DEPENDENT CURRENT SOURCES
    (DEPENDENCY: I R1, E E1)
9)  OPEN CIRCUITS (O)
10) SHORT CIRCUITS (S)


       THE FOLLOWING EXAMPLE USES (CR) TO DENOTE CARRIAGE RETURN.
EVERY RESPONSE TYPED BY THE USER IS UNDERLINED.



-AC-CODED(CR)
 ------------

AC CIRCUIT ANALYSIS PROGRAM



3/21      15:15


:ENTER(CR)
 ---------
PROBLEM:  1(CR)
          -----
# 1 E1(CR)
    ------
FROM NODE #0(CR)
          -----
TO NODE #1(CR)
         -----
NOMINAL (WITH MIN-MAX OR % TOLERANCE):  1(CR)
                                        -----
DEPENDENCY:(CR)
           ----
SIN OR COS?(CR)
           ----
#2 R1,1,2,50(CR)
   -------------
#3 C1,0,2,1E-6(CR)
   ---------------
#4 L2,2,3,1E-3(CR)
   ---------------
#5 C2,0,3,1E-6(CR)
   ---------------
#6 (CR)
   ----

:WRITE /TEST/(CR)
 ----------------
 NEW FILE(CR)
         ----


:NOM (CR)
 --------
FREQUENCY:  1E4(CR)
            -------
NODE    VOLTAGE     PHASE
----  -----------  -------
  1   1.00000E 0       .00
  2   2.33995E- 1   -64.28
  3   1.47225E-1    115.72
AC ** FICHE/FRAME BREAK *****
CACLIST
10
25
4
READ FROM
4
WRITE ON
7
ENTER
6
ADD
7
CHANGE
7
MODIFY
7
PRINT
6
LIST
7
DELETE
3
QUIT
7
NOMINAL SOLUTION
8
DIFFERENTIAL ANALYSIS
8
STATISTICAL ANALYSIS
8
PARAMETER VARIATION
8
WORST CASE ANALYSIS
7
BREAKDOWN VOLTAGE
12
INCREMENTAL PARAMETER VARIATION
4
VERSION
5
CAPABILITIES
5
INSTRUCTIONS
4
CREDITS
2
RUN
2
?
3
HELP
4
CHARGES
11
2
R
2
G
2
C
2
L
2
E
2
I
2
O
2
S
2
H
2
D
2
T
3
2
AC
2
DC
4
TRANSIENT
2
2
NO
2
YES
4
5
NO HEADING
3
PHASE
4
OPTIONS
3
FILE
4
3
FROM
2
TO
2
BY
2
IN
1
2
:
3
2
E
2
V
2
I
2
4
AMPLITUDE
3
PHASE
2
2
COS
2
SIN
AC ** FICHE/FRAME BREAK *****
CACM
F2C
I CACOV1
O CACOV1B

C
I CACOV2
O CACOV2B

C
Q
F2O
CACOV1B
*OVERLAY
*COMMAND
*FL5
*FL1
GO
CACOV2B
*OVERLAY
*FL5
*FL2

*FL1
GO
WRI
AC

Q
AC ** FICHE/FRAME BREAK *****
CACOV1
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,IXTRA,FLAG,IXTB,KFLAG
       COMMON PRO,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZERO,FREQ,OMEGA,DCPS,LFR
       COMMON IDUMMY,NI,NT,KIND,JNDX,LMN,K,LIST
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NI(99),NT(99),KIND(99),JNDX(99),LMN(99),K(99),NAME(30),IDUMMY(831),IXTRA(99),IXTB(6)
       DIMENSION LIST(250),LSTADD(10),L(4),IFLAG(10),FREQUENCIES(20),NODELIST(20),LISTPAR(20),XIJ(4)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1)),(IDUMMY(291),FREQUENCIES(1))
       EQUIVALENCE (IDUMMY(330),NAME(1)),(PRO,L(4)),(IDUMMY(360),LISTPAR(1))
       DIMENSION LO(8),IFILE(3),IFNAME(4)
CODED  -  CONTROL PROGRAM
C
C      THIS PROGRAM IS OVERLAY ZERO FOR THE CIRCUIT ANALYSIS PACKAGE AND IS RESPONSIBLE
C      FOR THE INTERFACE BETWEEN THE USER AND THE ANALYSIS PROGRAMS.
C
C      ALTHOUGH EACH OF THE OVERLAYS ALLOWS COMMON TO EXTENDED WELL INTO PAGE #4, ONLY PAGE #5
C      IS DECLARED IN THE OVERLAY PACKAGE THUS FORCING FILE BUFFER STORAGE TO BE ALLOCATED
C      IN PAGE #5.  THIS ALSO ALLOWS THE PROGRAMS TO ULTILIZE THEIR CORE ALLOCATION MORE EFFECTIVELY
C      SINCE NO LOCATIONS ARE LOST IN OVERLAY SWAPPING.  IT IS THUS VERY IMPORTANT THAT WE KNOW
C      EXACTLY WHAT IS CONTAINED IN PAGE #5.  IN THE COMMON DECLERATIONS GIVEN BELOW, "IDUMMY"
C      MUST BE ADJUSTED SO THAT ITS STARTING LOCATION IS 24000.  THE SECOND PAGE OF COMMON (PAGE #4)
C      MAY BE USED FREELY BY EACH OF THE OVERLAYS.
C
C      ON THE THE FIRST ENTRY TO THIS ROUTINE, WHEN THE OVERLAY IS FIRST PUT TOGETHER, THE COMMAND
C      LIST, WHICH IS STORED ON THE FILE CACLIST, MUST BE READ INTO THE ARRAY "LIST.
C      THUS THE PROCEDURE FOR LOADING OVERLAY ZERO IS TO USE FOS AS FOLLOWS:
C
C      @FOS
C      LOAD FROM: /PROG/
C      LOAD SUBPROGRAMS FROM: /SUBS/
C      ECT.
C      READY
C      +GO
C      STOP
C      +QUIT
C      @DUMP //
C      NEW FILE (LF)
C      STARTING LOCATION 30000
C
C      SUBSEQUENT ENTRIES TO THE PROGRAM WILL ALSO DEPEND ON THE SETTING OF THE VARIABLE
C      "FLAG".  IF "FLAG"=1, THEN THIS IS THE FIRST TIME THE USER HAS ENTERED THE PROGRAM AND AN OVERLAY
C      (ONE OF THE ANALYSIS PROGRAMS) MUST BE LOADED.  IF "FLAG"=-1, THEN AN OVERLAY HAS ALREADY
C      BEEN LOADED AND THE USER HAS RETURNED TO THE EXEC FOR SOME REASON AND IS NOW REENTERING
C      THE PROGRAM.
C
C
C
       IFNAME(1)=3H(@6
       IFNAME(2)=3HLC)
       IFNAME(3)=3HCAC
       CALL SESC
       IF(FLAG)24,13000,14000
C
C      OVERLAY IS BEING PUT TOGETHER, SO COMMON MUST BE DECLARED AND THE COMMAND LIST READ.
C
13000  CALL CSIZE(1848,3)
      OPEN(2,INPUT,SYMBOLIC,CACLIST)
      CALL RDLIST(LIST,LSTADD)
       FLAG=1                ;C     SET FLAG SO THAT WE DONT COME THROUGH THIS CODE AGAIN.
       KFLAG=-1
      CALL LOADER (3)
      CLOSE
       STOP
C
C      USER IS MAKING HIS FIRST ENTRY INTO PROGRAM.
14000  CALL DCLESC (NESC1)
       ASSIGN 24 TO NESC1
       CALL ARM
C
8      TYPE 50000
50000  FORMAT (/$AC-CIRCUIT ANALYSIS PROGRAM$//)
C
C      IF A MATCH WAS FOUND IN COMMAND LIST #3, THEN COM IS RETURNED AS 1,2, OR 3.
C      WE THEN SET "KFLAG", WHICH REPRESENTS THE TYPE OF ANALYSIS BEING PERFORMED.
C      KFLAG = -1  :"AC"
C            =  0  :"DC"
C            = +1  :"TRANSIENT"
C
24     CONTINUE
CODED  -  CONTROL PROGRAM
C
C      THIS PROGRAM IS OVERLAY ZERO FOR THE CIRCUIT ANALYSIS PACKAGE AND IS RESPONSIBLE
C      FOR THE INTERFACE BETWEEN THE USER AND THE ANALYSIS PROGRAMS.
C
C      ALTHOUGH EACH OF THE OVERLAYS ALLOWS COMMON TO EXTENDED WELL INTO PAGE #4, ONLY PAGE #5
C      IS DECLARED IN THE OVERLAY PACKAGE THUS FORCING FILE BUFFER STORAGE TO BE ALLOCATED
C      IN PAGE #5.  THIS ALSO ALLOWS THE PROGRAMS TO ULTILIZE THEIR CORE ALLOCATION MORE EFFECTIVELY
C      SINCE NO LOCATIONS ARE LOST IN OVERLAY SWAPPING.  IT IS THUS VERY IMPORTANT THAT WE KNOW
C      EXACTLY WHAT IS CONTAINED IN PAGE #5.  IN THE COMMON DECLERATIONS GIVEN BELOW, "IDUMMY"
C      MUST BE ADJUSTED SO THAT ITS STARTING LOCATION IS 24000.  THE SECOND PAGE OF COMMON (PAGE #4)
C      MAY BE USED FREELY BY EACH OF THE OVERLAYS.
C
C
C      ON THE THE FIRST ENTRY TO THIS ROUTINE, WHEN THE OVERLAY IS FIRST PUT TOGETHER, THE COMMAND
C      LIST, WHICH IS STORED ON THE FILE CACLIST, MUST BE READ INTO THE ARRAY "LIST.
C      THUS THE PROCEDURE FOR LOADING OVERLAY ZERO IS TO USE FOS AS FOLLOWS:
C
C      @FOS
C      LOAD FROM: /PROG/
C      LOAD SUBPROGRAMS FROM: /SUBS/
C      ECT.
C      READY
C      +GO
C      STOP
C      +QUIT
C      @DUMP //
C      NEW FILE (LF)
C      STARTING LOCATION 30000
C
C      SUBSEQUENT ENTRIES TO THE PROGRAM WILL ALSO DEPEND ON THE SETTING OF THE VARIABLE
C      "FLAG".  IF "FLAG"=1, THEN THIS IS THE FIRST TIME THE USER HAS ENTERED THE PROGRAM AND AN OVERLAY
C      (ONE OF THE ANALYSIS PROGRAMS) MUST BE LOADED.  IF "FLAG"=-1, THEN AN OVERLAY HAS ALREADY
C      BEEN LOADED AND THE USER HAS RETURNED TO THE EXEC FOR SOME REASON AND IS NOW REENTERING
C      THE PROGRAM.
C
C
C      OVERLAY IS BEING PUT TOGETHER, SO COMMON MUST BE DECLARED AND THE COMMAND LIST READ.
C
C
C      USER IS MAKING HIS FIRST ENTRY INTO PROGRAM.
C
       ASSIGN 5 TO NESC1
       CALL ARM
      IF(KFLAG) 6999,6998,6999
6998  TYPE 77777
77777 FORMAT($12.02$/)
       KFLAG=-1
38     CALL ARM
       CLOSE
       GO TO 1
6999  IF(FLAG)7000,5,5
7000  IF(FLAG+2) 1,7001,1
5     FLAG=-1
       ASSIGN 7001 TO NESC1
       CALL ARM
      CALL TIME(I,J,KI,KK)
      KK=KK+100;J=J+100
19    TYPE 17,I,J,KI,KK
17    FORMAT(//I2,$/$,I2,5X,I2,$:$,I2/)
7001  FLAG=-1
       CALL ARM
       ASSIGN 18 TO NESC1
       IFILE(1)=3HTEL
       IFILE(2)=3HETY
       IFILE(3)=3HPE 
1      TYPE 9
9      FORMAT (/)
15     CALL BRS(14,0,0,-1)   ;C      WAIT ON OUTPUT BUFFER EMPTY,  THIS IS TO ASSURE
C                            ;C     THAT THE ESCAPE DOES WHAT THE USER EXPECTS IT TO DO.
       CALL DCLESC(ESC1)     ;C     A PANIC AT COMMAND LEVEL WILL RETURN THE USER
       ASSIGN 18 TO ESC1
C                            ;C     TO THE EXECUTIVE.
       ASSIGN 18 TO ESC2     ;C     WE WANT A PANIC AFTER THE FIRST CHARACTER TO ABORT THE COMMAND.
C
C      GET A COMMAND FROM LIST #1.
C
       TYPE 6
6      FORMAT (/$:$)
       CALL INLINE(0,I,ESC2)
       IF(I)1,2,2
2      M=COM(LIST(LSTADD(1)),1)
       IF(M)3,1,4
3      TYPE 7
7      FORMAT ($  ?$//)
       GO TO 15
31     IFNAME(4)=1HC
       CALL COPY(IFNAME,IFILE)
       GO TO 38
32     IFNAME(4)=1HI
       CALL COPY (IFNAME,IFILE)
       GO TO 38
34     TYPE 35
35     FORMAT(/$TYMSHARE$)
       GO TO 38
36     IFNAME(4)=1HH
       CALL COPY (IFNAME,IFILE)
       GO TO 38
37     TYPE 33
33     FORMAT(/$YOUR REGULAR CHARGE$)
       GO TO 38
39     M=11
       GO TO 800
4      GO TO(100,200,300,306,450,400,500,600,950,700,800,800,800,
+      800,800,900,800,25,31,32,34,39,36,36,37),M
25     KFLAG=0
       GO TO 6998
18     CALL ARM
       CALL BRS(29,0,0,-1)   ;C     WHEN ABORTING A COMMAND, WE WANT TO CLEAR THE OUTPUT BUFFER.
       GO TO 1
C
C
C###   'READ FROM':   READS PARAMETERS FROM A FILE.
C
100    ASSIGN 105 TO ESC2    ;C     ON A COMMAND ABORT, WE WANT TO CLOSE FILES AND REINITIALIZE.
101    IF(FILE(NAME))102,102,103;C  HAS A FILE NAME BEEN INPUTED YET.
102    TYPE 111              ;C     NO.  GET ONE.
111    FORMAT ($FROM:  $)
       CALL INLINE(0,J,ESC2)
       IF(J)102,102,101
103    CALL FILEID(J,NAME)   ;C     DETERMINE FILE TYPE.
       IF(J-3)108,107,108
108    IF(J)114,114,116
114    TYPE 327
       TYPE 115
115    FORMAT($FILE DOES NOT EXIST.$//)
       GO TO 15
116    TYPE 327
       TYPE 109
109    FORMAT ($FILE NOT SYMBOLIC.$//)
       GO TO 15
107    CALL AOPEN(2,NAME,6HSYMINP)       ;C  OPEN FILE.
       READ 2,112,PRO,BLEM,LIMBS
112    FORMAT (2A,I/)
       DO 104 I=1,LIMBS
104    READ 2,113,PNAME(I),NI(I),NT(I),KIND(I),JNDX(I),LMN(I),K(I),PNOM(I),PMIN(I),PMAX(I)
113    FORMAT (A,6I3,1P3E13.4/)
106    CLOSE
       GO TO 1
105    LIMBS=0               ;C     ON PANIC, REINITIALIZE, REARM, AND CLEAR OUTPUT BUFFER.
110    CALL ARM
       CALL BRS(29,0,0,-1)
       TYPE 9
       GO TO 106             ;C     NOW CLOSE THE FILE.
C
C
C###   'WRITE ON':   WRITES PARAMETERS ON A FILE.
C
200   LXX=1
       ASSIGN 110 TO ESC2    ;C     CLOSE FILE ON PANIC.
201    IF(FILE(NAME))202,202,203;C  HAS A FILE NAME BEEN INPUTED YET.
202    TYPE 211              ;C     NO.  GET ONE.
211    FORMAT ($ON:  $)
       CALL INLINE(0,J,ESC2)
       IF(J)202,202,201
203   CALL FILEID(J,NAME)
      IF(J) 2001,2001,2003
2001  TYPE 2002
2002  FORMAT($ NEW FILE$)
      GO TO 2005
2003  TYPE 2004
2004  FORMAT($ OLD FILE$)
2005  CALL INLINE(0,J,ESC2)
      IF(J) 2006,2006,1
2006   CALL AOPEN(2,NAME,6HSYMOUT)    ;C     OPEN FILE.
       WRITE 2,112,PRO,BLEM,LIMBS
       DO 204 I=1,LIMBS
204    WRITE 2,113,PNAME(I),NI(I),NT(I),KIND(I),JNDX(I),LMN(I),K(I),PNOM(I),PMIN(I),PMAX(I)
       CLOSE
      GO TO(1,1100,1150),LXX
C
C
C###   'ENTER PARAMETERS':   READS PARAMETERS FROM THE TELETYPE.
C
300    LIMBS=0;NODES=0       ;C     INITIALIZE CIRCUIT.
301    CALL INLINE(-1,J,ESC2);C     HAS A PROBLEM NAME BEEN INPUTED YET.
       IF(J)302,303,303
302    TYPE 311              ;C     NO.  GET ONE.
311    FORMAT ($PROBLEM:  $)
       CALL INLINE(0,J,ESC2)
       IF(J)302,302,301
303    IF(COMMA(J))385,302,385;C    IGNORE LEADING SPACES.
C
C      WE PICK THE NEXT TWELVE CHARACTERS AND USE THEM AS THE PROBLEM NAME.  (THERE ARE 200 
C      CHARACTERS TO EVERY INPUT LINE.)
C
385    DO 382 I=1,4
382    L(I)=0
       DO 305 I=1,4
       M=I+2-4*(I/3)         ;C     SINCE THIS ARRAY IS EQUIVALENCED TO FLOATING POINT
C                            ;C     VARIABLES, WE MUST PACK CHARACTERS INTO THE ARRAY IN THE 
C                            ;C     FOLLOWING ORDER:  L(3),L(4),L(1),L(2).
       DO 305 MM=1,3
       IF(I+MM-2)305,305,304
304    CALL INLINE(1,J,ESC2)
       IF(J)306,305,305
305    L(M)=L(M)+J*256**(3-MM)
C
C
C###   'ADD PARAMETERS' ENTERS HERE.
C
306    ASSIGN 393 TO ESC2    ;C     IF WE RECEIVE A PANIC DURING THE INPUT OF A PARAMETER,
C                            ;C     WE WANT TO IGNORE THAT PARAMETER.
C
C      THE FOLLOWING FLAG IS SET AS FOLLOWS:
C              TFLAG = -1  :"ENTER" OR "ADD"
C                    =  0  :"MODIFY" AN UNKNOWN PARAMETER
C                    = +1  :"CHANGE" OR "MODIFY" A KNOWN PARAMETER
C
       TFLAG=-1
      TMARK=0
379    DO 392 I=LIMBS+1,100
320    IF(TFLAG)349,378,331  ;C     WE ARRIVE AT THIS STEP WITH TFLAG NON-NEGATIVE, ONLY IF THE
C                            ;C     PARAMETER INPUTED WAS INCORRECT.
331    TYPE 312,KIP          ;C     SINCE ALL PARAMETERS ARE INITIALLY ADDED ON TO THE BOTTOM OF
312    FORMAT ($#$,I2,2X)
C                            ;C     THE LIST EVEN IN THE "CHANGE" AND "MODIFY" COMMANDS,  "KIP"
C                            ;C     CONTAINS THE NUMBER OF THE PARAMETER BEING MODIFIED, IF KNOWN
       GO TO 378
349   IF(TMARK) 334,3349,334
3349   TYPE 312,I
378    IF(TFLAG)334,335,335
335    JNDX(I)=KIP
       GO TO 309
334    JNDX(I)=I
309    IF(INPAR(PNAME(I),NI(I),NT(I),KIND(I),X,LMN(I),K(I),PNOM(I),PMIN(I),PMAX(I),LIST(LSTADD(2)),
+      KFLAG,LIST(LSTADD(10)),LIST(LSTADD(8)),LIST(LSTADD(7)),ESC2,TMARK))308,320,307
307   IF(TMARK) 3000,3307,3000
3000  GO TO(392,392,3002,3001),TMARK
3001  TMARK=0
3002  JNDX(I)=I-2
      GO TO 392
3307   IF(I-1)316,316,381    ;C     ON THE FIRST PARAMETER, SKIP THE FOLLOWING CODE.
C
C      THIS CODE CHECKS FOR DUPLICATE NAMES.
C
381    DO 314,J=1,I-1
      CALL COMPAR(PNAME(I),PNAME(J),IND)
      IF(IND) 314,314,315
314    CONTINUE
       GO TO 316
315    IF(TFLAG)340,336,340  ;C     IF WE ARE DOING A MODIFY ON AN UNKNOWN PARAMETER, WE HAVE FOUND IT.
336    JNDX(I)=J
       GO TO 316
340    IF((KIP-J+1)*TFLAG-1)332,316,332;C  UNLESS THIS MATCH OCCURS DURING A "MODIFY" OR "CHANGE"
C                            ;C     OF A KNOWN PARAMETER (TFLAG=1) AND THIS IS THE PARAMETER TO BE
C                            ;C     MODIFIED (KIP=J), WE HAVE DUPLICATE NAMES.
332    TYPE 327
       TYPE 313
313    FORMAT ($DUPLICATE NAMES.$/)
       GO TO 320
316    IF(X)317,350,317      ;C     DO WE HAVE A DEPENDENCY, IF SO THE PARAMETER NAME IS STON "X".
C
C      THIS CODE ASSURES THE EXISTANCE OF THE INDEPENDENT PARAMETER.
C
317    DO 318 JX=1,I-1
      CALL COMPAR(PNAME(JX),X,IND)
      IF(IND) 318,318,397
318    CONTINUE
       TYPE 327
       TYPE 321
321    FORMAT ($NO SUCH PARAMETER.$/)
       GO TO 310
C
C      HERE WE MAY PICK UP A "THERMAL VOLTAGE", "INITIAL VOLTAGE", OR "INITIAL CURRENT"
C      FOR THE PARAMETER JUST INPUTED.
C
350    IF(KFLAG)310,360,351
351    IF(KIND(I)-3)360,353,352
352    IF(KIND(I)-4)360,355,360
C
C      CODE FOR "INITIAL VOLTAGE".
C
353    M=COM(LIST(LSTADD(7)),1);C   CHECK FOR SEMI-COLON.
       IF(M)357,357,341
341    IF(COMMA(J))342,357,3 ;C     ANYTHING FOLLOWING SEMI-COLON.
357    TYPE 322              ;C     NO. CALL FOR IT.
322    FORMAT ($INITIAL VOLTAGE$/)
       TYPE 328
358    CALL INLINE(0,J,ESC2)
342    IF(ACPNUM(X))357,357,354
354    I=I+1;Y=PRO;PRO=PNAME(I-1);L(4)=L(4)+1;PNAME(I)=PRO;PRO=Y
       NI(I)=NI(I-1);NT(I)=NT(I-1);KIND(I)=14;PNOM(I)=X;PMIN(I)=X;PMAX(I)=X;JNDX(I)=I-1;JNDX(I-1)=I
       GO TO 310             ;C     IF MIN-MAX IS DESIRED, MAKE THIS A "GO TO 384".
355    M=COM(LIST(LSTADD(7)),1);C   CHECK FOR SEMI-COLON.
       IF(M)359,359,343
343    IF(COMMA(J))344,359,3 ;C     ANYTHING FOLLOWING SEMI-COLON.
359    TYPE 323              ;C     NO  CALL FOR IT.
323    FORMAT ($INITIAL CURRENT$/)
       TYPE 328
375    CALL INLINE(0,J,ESC2)
344    IF(ACPNUM(X))359,359,356
356    I=I+1;Y=PRO;PRO=PNAME(I-1);L(4)=L(4)+1;PNAME(I)=PRO;PRO=Y
       NI(I)=NI(I-1);NT(I)=NT(I-1);KIND(I)=9;PNOM(I)=X;PMIN(I)=X;PMAX(I)=X;JNDX(I)=I-1;JNDX(I-1)=I
       GO TO 310             ;C     IF MIN-MAX IS DESIRED, MAKE THIS A "GO TO 384".
360    IF(KIND(I)-10)310,361,310
C
C      CODE FOR "THERMAL VOLTAGE".
C
361    M=COM(LIST(LSTADD(7)),1);C   CHECK FOR SEMI-COLON.
       IF(M)376,376,345
345    IF(COMMA(J))346,376,3 ;C     ANYTHING FOLLOWING SEMI-COLON.
376    TYPE 324              ;C     NO.  CALL FOR IT.
324    FORMAT ($THERMAL VOLTAGE$/)
       TYPE 328
377    CALL INLINE(0,J,ESC2)
346    IF(ACPNUM(X))376,376,362
362    I=I+1;Y=PRO;PRO=PNAME(I-1);L(4)=L(4)+1;PNAME(I)=PRO;PRO=Y
       NI(I)=NI(I-1);NT(I)=NT(I-1);KIND(I)=15;PNOM(I)=X;JNDX(I)=I-1;JNDX(I-1)=I
384    IF(COMMA(J))364,363,364
363    PMIN(I)=X;PMAX(I)=X   ;C     ONLY NOMINAL GIVEN.
       GO TO 310
364    IF(ACPNUM(X))363,363,365
365    CALL INLINE(-1,J,ESC2)
       IF(J-3H  %)367,366,367
366    X=X/100;PMIN(I)=PNOM(I)*(1-X);PMAX(I)=PNOM(I)*(1+X);C   PERCENT GIVEN.
       GO TO 310
367    PMIN(I)=X
       IF(COMMA(J))369,371,372;C    HAVE MIN, ANY MAX
369    TYPE 327              ;C     SOMETHINGS BAD.
       TYPE 325
325    FORMAT ($INVALID PARAMETER.$/)
       GO TO 320
371    TYPE 326              ;C     NO.  GET IT.
326    FORMAT ($MAXIMUM VALUE:  $)
       CALL INLINE(0,J,ESC2)
       IF(J)371,372,372
372    IF(ACPNUM(X))369,371,368
368    PMAX(I)=X
       GO TO 310
397    JNDX(I)=JX            ;C     WE HAVE A VALID DEPENDENCY.
310    IF(TFLAG)392,412,413  ;C     CONTINUE IF "ENTER" OR "ADD".
392    CONTINUE
393    CALL ARM
       CALL BRS(29,0,0,-1)
       TYPE 9
308    IF(TFLAG)333,1,1
333    LIMBS=I-1             ;C     ON PANIC, IGNORE CURRENT PARAMETER IF "ENTER" OR "ADD".
       GO TO 15
327    FORMAT ($***ERROR:  $)
328    FORMAT ($NOMINAL (WITH MIN-MAX OR % TOLERANCE):  $)
C
C
C###   'CHANGE PARAMETERS'
C
C      THE FOLLOWING FLAG IS SET AS FOLLOWS:
C              PFLAG = -1  : DO NOT TYPE OUT HEADING OR OLD PARAMETER DESCRIPTIONS.
C                    = +1  : TYPE OUT HEADING AND OLD DESCRIPTIONS.
C
450    PFLAG=1
       GO TO 411
C
C
C###   'MODIFY PARAMETERS'
C
400    PFLAG=-1
411    KI=-1                 ;C     THIS IS A NECCESSARY ARGUMENT FOR "PARLIST".
       TFLAG=1               ;C     ASSUME WE WILL HAVE A PARAMETER LIST.
       I=LIMBS+1             ;C     SET INDEX FOR "DO" IN STATEMENT 379.
       CALL PARLIST(KI,KFLAG)
       IF(KI)446,403,406     ;C     ANY PARAMETERS.
446    TYPE 327
       TYPE 498
498    FORMAT ($NOT A PARAMETER.$/)
       GO TO 1
403    IF(PFLAG)445,402,402  ;C     NO.  ANY NEEDED.
402    TYPE 499              ;C     YES.  GET THEM.
499    FORMAT ($PARAMETER:  $)
       CALL INLINE(0,J,ESC2)
       GO TO 411
445    TFLAG=0               ;C     NO.
       GO TO 378
412    KIP=J                 ;C     WE RETURN HERE AFTER INPUTING THE NEW PARAMETER DESCRIPTION.
413    CALL ESCOFF           ;C     WE DONT WANT TO BE INTERRUPTED WHILE WE ARE MOVING PARAMETERS.
C
C      SINCE THERE ARE BOTH "SINGLE" PARAMETERS (EG. VOLTAGE SOURCES) AND "DOUBLE" PARAMETERS (EG. DIODES)
C      FOUR SITUATIONS ARE POSSIBLE WHEN REPLACING ONE PARAMETER WITH AN OTHER, THEY ARE:
C              1.  REPLACING A SINGLE PARAMETER WITH A SINGLE PARAMETER.
C              2.  A SINGLE WITH A DOUBLE
C              3.  A DOUBLE WITH A DOUBLE
C              4.  A DOUBLE WITH A SINGLE
C
C      THE CODING WHICH FOLLOWS HANDLES ALL FOUR SITUATIONS.
C
       GO TO(3,420,424)I-LIMBS+1
C
C      THE FOLLOWING CODE HANDLES THE INPUT OF A SINGLE PARAMETER.
C
420    IF(KFLAG)419,421,423
421    IF(KIND(KIP)-10)419,422,419
C      WE MUST REMAOVE THE SECOND PART OF THE PARAMETER THAT WE ARE REPLACING.
422    CALL MOVE(KIP+2,-1)   ;C     REMOVE 1 LINE
       I=I-1;LIMBS=LIMBS-1   ;C     AND ADJUST NUMBER OF PARAMETERS.
       GO TO 419             ;C     NOW GO PUT THE NEW PARAMETER DESCRIPTION WHERE IT BELONGS.
423    IF((KIND(KIP)-3)*(KIND(KIP)-4))419,422,419
C
C      THE FOLLOWING CODING HANDLES THE INPUT OF A DOUBLE PARAMETER.
C
424    JNDX(I-1)=KIP+1;JNDX(I)=KIP;C   SET DEPENDENCY PROPERLY.
       IF(KFLAG)419,425,428
425    IF(KIND(KIP)-10)427,426,427
C
C      WE HAVE A DOUBLE FOR A DOUBLE.  WE START BY MOVING THE FIRST HALF.
C
426    PNAME(KIP)=PNAME(I-1);NI(KIP)=NI(I-1);NT(KIP)=NT(I-1);KIND(KIP)=KIND(I-1);K(KIP)=K(I)
       LMN(KIP)=LMN(I);JNDX(KIP)=JNDX(I-1);PNOM(KIP)=PNOM(I-1);PMIN(KIP)=PMIN(I-1);PMAX(KIP)=PMAX(I-1)
       KIP=KIP+1             ;C     WE SET UP FOR MOVING THE SECOND HALF.
       GO TO 419             ;C     NOW GO MOVE IT.
C
C      WE HAVE A DOUBLE FOR A SINGLE.  WE MUST MAKE ROOM FOR IT.
C
427    CALL MOVE(KIP+1,1)    ;C     MAKE ROOM FOR ONE LINE.
       I=I+1;LIMBS=LIMBS+1   ;C     ADJUST THE NUMBER OF PARAMETERS.
       GO TO 426             ;C     NOW GO MOVE THE NEW DESCRIPTION TO WHERE IT BELONGS.
428    IF((KIND(KIP)-3)*(KIND(KIP)-4))427,426,427
419    PNAME(KIP)=PNAME(I);NI(KIP)=NI(I);NT(KIP)=NT(I);KIND(KIP)=KIND(I);K(KIP)=K(I);LMN(KIP)=LMN(J)
       JNDX(KIP)=JNDX(I);PNOM(KIP)=PNOM(I);PMIN(KIP)=PMIN(I);PMAX(KIP)=PMAX(I)
       CALL ESCON
       IF(TFLAG)15,15,407    ;C     ANY MORE.
406    DO 407 KJ=1,KI        ;C     THIS IS THE MAIN LOOP FOR "CHANGE" AND MODIFY" - A LITTLE OUT OF PLACE.
       KIP=LISTPAR(KJ)
       IF(PFLAG)405,404,404
404    TYPE 497,PNAME(KIP),NI(KIP),NT(KIP),PNOM(KIP),PMIN(KIP),PMAX(KIP)
497    FORMAT ($NAME  FROM  TO    NOMINAL     MINIMUM     MAXIMUM$/,A5,I4,I5,1X,1P3E12.4/)
405    TYPE 312,KIP
       GO TO 378
407    CONTINUE
       GO TO 1
C
C
C###   'PRINT PARAMETERS'
C
C              PFLAG = -1  : NO HEADING
C                    = +1  : HEADING
C
500    PFLAG=1
512    IF(LIMBS)1,1,516      ;C     ARE THERE ANY PARAMETERS.
516    KL=1                  ;C     THIS IS A NECESSARY ARGUMENT FOR "PARLIST".
       CALL PARLIST(KL,KFLAG);C     GET A PARAMETER LIST.
       IF(KL)520,506,508     ;C     ANY PARAMETERS.
520    TYPE 327
       TYPE 498
       GO TO 15
506    DO 507 I=1,LIMBS      ;C     NO.  USE ALL OF THEM.
507    LISTPAR(I)=I
       KL=LIMBS              ;C     SET NUMBER OF PARAMETERS TO BE LISTED.
508    IF(PFLAG)515,515,514  ;C     DO WE WANT A HEADING.
514    TYPE 599,PRO,BLEM     ;C     YES.
599    FORMAT(//,5X,2A6,/,
+      /$ PARAMETER$,3X,$ NODES   DEPENDENCY$,3X,$NOMINAL$,6X,$MINIMUM$,
+      6X,$MAXIMUM$,/,$NO.   NAME$,3X,$FROM TO  TYPE  ON  $,4X,$VALUE$,
+      8X,$VALUE$,8X,$VALUE$,/,$---$,2X,6($-$),2X,$---- --  ---------- $,
+      11($-$),2(2X,11($-$))/)
515    KK=1                  ;C     THIS VARIABLE IS USED TO HANDLE DOUBLE PARAMETERS.
       DO 552 JJ=1,KL
       I=LISTPAR(JJ)
       GO TO(554,559,561,564)KK
C
C      IN THE FOLLOWING CODE "J" WILL CONTAIN THE TYPE OF DEPENDENCY AND "XX" WILL CONTAIN THE
C      NAME OF THE INDEPENDENT PARAMETER.
C
554    J=0;XX=0
       IF(JNDX(I)-I)555,509,555;C   ANY DEPENDENCY.
555    XX=PNAME(JNDX(I))     ;C     YES SET IT.
       GO TO(509,509,563,560,509,509,557,558,509,556,509,557,558,509,509)KIND(I)
556    KK=2;XX=0             ;C     WE HAVE A DIODE.  SET "KK" TO RETURN HERE TO PRINT "THERMAL VOLTAGE".
       GO TO 509
559    ASSIGN 553 TO FORM
       GO TO 580
553    FORMAT(6X,$THERMAL VOLTAGE$,10X)
557    J=3H I                ;C     PARAMETER IS CURRENT DEPENDENT.
       GO TO 509
558    J=3H E                ;C     PARAMETER IS VOLTAGE DEPENDENT.
       GO TO 509
560    KK=3;XX=0             ;C     WE HAVE A TRANSIENT INDUCTOR.  SET "KK" TO RETURN HERE TO PRINT
C                            ;C     "INITIAL CURRENT".
       GO TO 509
561    ASSIGN 562 TO FORM
       GO TO 580
562    FORMAT(6X,$INITIAL CURRENT$,10X)
563    KK=4;XX=0             ;C     WE HAVE A TRANSIENT CAPACITOR.  SET "KK" TO RETURN HERE TO PRINT
C                            ;C     "INITIAL VOLTAGE".
       GO TO 509
564    ASSIGN 565 TO FORM
565    FORMAT(6X,$INITIAL VOLTAGE$,10X,1P3E13.4)
580    KK=1                  ;C     RESET FLAG.
       TYPE FORM
       IF(PMIN(I)-PMAX(I)) 7523,7524,7523;C   DOES MAX=MIN.
7524   TYPE 7525,PNOM(I)     ;C     YES.  JUST PRINT NOMINAL.
7525   FORMAT(1PE13.4/)
       GO TO 552
7523   TYPE 7526,PNOM(I),PMIN(I),PMAX(I);C   NO.  PRINT ALL VALUES.
7526   FORMAT(1P3E13.4/)
       GO TO 552
509    IF(PMIN(I)-PMAX(I))7508,7509,7508;C   DOES MAX=MIN.
7509   TYPE 7598,I,PNAME(I),NI(I),NT(I),J,XX,PNOM(I)
7598   FORMAT(I2,4X,A5,3X,I2,2X,I2,3X,A3,1X,A5,1X,1PE11.4/)
       GO TO 552
7508   TYPE 598,I,PNAME(I),NI(I),NT(I),J,XX,PNOM(I),PMIN(I),PMAX(I)
598    FORMAT (I2,4X,A5,3X,I2,2X,I2,3X,A3,1X,A5,1X,1PE11.4,2E13.4/)
552    CONTINUE
       GO TO 1
C
C
C###   'LIST PARAMETERS'
C
600    PFLAG=-1
       TYPE 9
       GO TO 512
C
C
C###   'QUIT'
C
700    CALL BRS(10)          ;C     RETURNS USER TO EXEC.
C
C
C###   'ANALYSIS COMMANDS'
C
800    M=M-10                ;C     THE ANALYSIS COMMANDS START AT POSITION #11 IN COMMAND LIST #1.
       KJI=IFLAG(20)         ;C     HOLD THIS VARIABLE FOR A FEW INSTRUCTIONS.
       DO 801 I=1,20         ;C     INITIALIZE ARRAYS.
       IFLAG(I)=-1
       NODELIST(I)=0
       LISTPAR(I)=0
801    FREQUENCIES(I)=0
       IFLAG(20)=KJI;KJI=0
       DO 838 I=1,8
838    LO(I)=-1
       KJ=0;KI=M;NODET=0
       NAME(1)=3HTEL;NAME(2)=3HETY;NAME(3)=3HPE ;C  SET UP TELETYPE AS NORMAL OUTPUT FILE.
       IFLAG(KI)=1           ;C     SET THE FLAG FOR PROPER ANALYSIS.
       MTRX=0;LPRT=0;LOHI=0
       IF(KI-5)348,347,348
347    IFLAG(6)=1
348    CALL PACK(KFLAG)      ;C     PACK "KRAM" ARRAYS AND CALCULATE HIGHEST NODE NUMBER.
802    J=COMMA(J)            ;C     COMMAND MAY BE FOLLOWED BY A COMMA.
       IF(ACPNUM(X))808,808,803
803    IF(X)804,804,806
804    TYPE 327
       TYPE 805
       GO TO 15
805    FORMAT ($INVALID NODE NUMBER.$//)
806    IF(X-.5-NODES)807,804,804;C  IS IT TOO HIGH.
807    KJ=KJ+1;NODELIST(KJ)=X;C     GOT ONE.  ANY MORE.
       GO TO 802
808    IF(M-4)865,865,8081
8081   IF(KJ-1)863,865,864   ;C     IF THERE IS ONLY ONE NODE, SET NODET.
863    TYPE 8631
8631   FORMAT($SPECIFY AT LEAST 1 NODE$/)
       GO TO 15
865    NODET=NODELIST(1)
864    J=COMMA(J)            ;C     THERE MAY BE A COMMA AFTER THE NODE LIST.
       M=COM(LIST(LSTADD(5)),1);C   NOW WE START CHECKING FOR OPTIONS.
       IF(M)3,809,851        ;C     DID WE FIND ONE.
851    KJI=KJI+1;LO(KJI)=M   ;C     YES.  PUT IT AWAY.
       GO TO 864             ;C     NOW GO LOOK FOR AN OTHER ONE.
C
C      WE NOW HAVE ALL THE OPTIONS.  IN ORDER TO INSURE THAT ALL THE FLAGS ARE SET PROPERLY,
C      WE LOOK FOR THE "NO HEADING" OPTION AND DO THAT ONE FIRST IF PRESENT.
C
809    KJ=0
       DO 855 I=1,8
       IF(LO(I)-1)852,810,855
855    CONTINUE
852    KJ=KJ+1;M=LO(KJ)      ;C     PICK UP THE NEXT OPTION.  (WE DONT CARE IF WE DO "NO HEADING" AGAIN.
       IF(M)814,814,853      ;C     ANY MORE OPTIONS.
853    GO TO(852,811,812,873)M
C
C      "FILE" OPTION.
C
873    TYPE 874              ;C     GET FILE NAME.
874    FORMAT($OUTPUT FILE:  $)
       CALL INLINE(0,J,ESC2)
       IF(J)873,875,875
875    IF(FILE(NAME))873,873,8501
C
8501  CALL FILEID(J,NAME)
      IF(J) 8502,8502,8503
8502  TYPE 2002
      GO TO 8504
8503  TYPE 2004
8504  CALL INLINE(0,J,ESC2)
      IF(J) 852,852,1
C
C      "NO HEADING"  OPTION.
C
810    IFLAG(KI)=0
       IF(KI-5)852,876,852
876    IFLAG(6)=0
       GO TO 852
C
C      "PHASE" OPTION.
C
811    IFLAG(10)=1
       GO TO 852
C
C      "OPTIONS" OPTION.
C
812    IF(KI-5)852,813,852   ;C     THIS IS MEANINGFUL ONLY FOR "WORST CASE".
813    KK=IFLAG(5);IFLAG(5)=-1;IFLAG(6)=-1;C   WE SAVE THE CURRENT SETTING OF THE "WORST CASE" FLAG
C                            ;C     AND THEN RESET THEM ALL UNTIL WE INPUT THE NEW OPTIONS.
       TYPE 840              ;C     DO WE WANT HIGH EXTREME.
840    FORMAT($HI? $)
       CALL INLINE(0,J,ESC2)
       M=COM(LIST(LSTADD(4)),1);C   YES OR NO.
       IF(M)813,843,841
841    GO TO(843,842)M
842    IFLAG(5)=KK           ;C     YES.  HIGH EXTREME.
843    TYPE 844              ;C     DO WE WANT LOW EXTREME.
844    FORMAT($LOW? $)
       CALL INLINE(0,J,ESC2)
       M=COM(LIST(LSTADD(4)),1);C   YES OR NO.
       IF(M)843,847,845
845    GO TO(847,846)M
846    IFLAG(6)=KK           ;C     YES.  LOW EXTREME.
847    TYPE 848              ;C     DO WE WANT SETTINGS.
848    FORMAT($SETTINGS? $)
       CALL INLINE(0,J,ESC2)
       M=COM(LIST(LSTADD(4)),1);C   YES OR NO.
       IF(M)847,834,849
849    GO TO(834,877)M
877    IFLAG(7)=KK           ;C     YES.  SETTINGS.
834    IF(KFLAG)871,852,852  ;C     CHECK NEXT OPTION ONLY FOR "AC".
871    TYPE 835
835    FORMAT($AMPLITUDE OR PHASE?  $)
       CALL INLINE(0,J,ESC2)
       M=COM(LIST(LSTADD(9)),1);C   AMPLITUDE OR PHASE.
       IF(M)834,852,836
836    GO TO (852,839)M
839    IFLAG(8)=KK           ;C     HE WANTS PHASE.
       GO TO 852
C
C      WE HAVE NOW PROCESSED THE NODE LIST, IF ANY, AND ALL THE OPTIONS SPECIFIED.
C      NOW IF THIS IS "AC", WE MUST PROCESS A FREQUENCY SPECIFICATION.
C
814    IF(KFLAG)815,837,837
815    TYPE 829
829    FORMAT ($FREQUENCY:  $)
       CALL INLINE(0,J,ESC2)
       IF(J)815,816,816
816    DO 888 J=1,4
888    XIJ(J)=0
817    M=COM(LIST(LSTADD(6)),1);C   WE ARE LOOKING FOR THE WORDS "FROM", "TO", "BY", AND "IN".
       IF(M)866,815,818
C
C      THE FOLLOWING CODE HANDLES A FREQUENCY LIST.
C
866    KK=O;FREQ=0;OMEGA=1E30;C     SET FINAL FREQUENCY TO 1E30 TO MAKE SURE ALL FREQUENCIES ARE
C                            ;C     ABOVE THE INITIAL FREQUENCY (FREQ) AND BELOW THE FINAL FREQUENCY (OMEGA).
       IF(ACPNUM(X))3,815,867;C     ANY FREQUENCIES.
867    KK=KK+1;FREQUENCIES(KK)=X;C  GET ONE.  PUT IT AWAY.
       IF(COMMA(J))868,837,868;C    ANYTHING LEFT ON THE LINE.
868    IF(ACPNUM(X))3,837,867;C     YES.  IS IT AN OTHER FREQUENCY.
C
C      THE FOLLOWING CODE HANDLES  FREQUENCY SWEEPS.
C
818    IF(ACPNUM(X))3,3,819  ;C     WE FOUND ONE OF THE ABOVE WORDS, IS IT FOLLOWED BY A NUMBER.
819    IF(X)820,820,822      ;C     YES.  IS IT POSITIVE.
820    TYPE 327              ;C     NO.
       TYPE 821
821    FORMAT ($INVALID FREQUENCY.$//)
       GO TO 815
822    XIJ(M)=X              ;C     YES.  STORE IT IN THE PROPER ARRAY ELEMENT.
       M=COM(LIST(LSTADD(6)),1);C   ARE THERE ANYMORE.
       IF(M)815,823,818
C
C      WE NOW HAVE PICKED UP ALL THE PARAMETERS GIVEN FOR THE SWEEP,  WE MUST NOW DECIDE WHAT TO DO
C      WITH THEM.  THE POSIBILITIES AND RELATED PARAMETER SETTINGS ARE AS FOLLOW:
C              FROM A TO B       :LOG SWEEP.  SET FREQ=A, OMEGA=B, LFR=1, DCPS=0.
C              FROM A TO B BY C  :LINEAR SWEEP.  SET FREQ=A, OMEGA=B, LFR=0, DCPS=C
C              FROM A TO B IN C  :LOG SWEEP IN C STEPS.  SET FREQ=A, OMEGA=B, LFR=1, DCPS=C.
C
823    FREQ=XIJ(1);OMEGA=XIJ(2);DCPS=XIJ(3)+XIJ(4)
       IF(OMEGA)820,824,825  ;C    HE MAY HAVE ONLY TYPED A "FROM A".
824    OMEGA=FREQ
       GO TO 837
825    IF(XIJ(3))820,826,837 ;C     UNLESS HE HAS TYPED A "BY C", THIS IS A LOG SWEEP.
826    LFR=1                 ;C     SET FOR LOG SWEEP.
C
C      THE FOLLOWING CODE IS USED TO INPUT A PARAMETER LIST FOR THE COMMANDS
C              "PARAMETER VARIATION"  AND  "STATISTICAL ANALYSIS".
C
837    IF((KI-2)*(KI-4)*(KI-10))830,831,830
831    TYPE 832
       CALL INLINE(0,J,ESC2)
832    FORMAT($WITH RESPECT TO:  $)
       I=-1
       CALL PARLIST(I,KFLAG)
       IF(I)833,8300,8300
8300  IF(KI-10) 830,8305,830
8305  IF(I) 8301,831,8301
8301  TYPE 8302
8302  FORMAT($STEPS $)
      CALL INLINE(0,I,ESC2)
      IF(ACPNUM(X)) 8301,8303,8304
8303  LFR=12
      GO TO 830
8304  LFR=X
      GO TO 830
833    TYPE 327
       TYPE 325
       GO TO 831
830    H1=PRO;H2=BLEM        ;C     SAVE THE PROBLEM NAME.
       CALL COLAY(3)         ;C     GO TO THE OVERLAY.
       PRO=H1;BLEM=H2        ;C     RESTORE THE PROBLEM NAME
       GO TO 1
C
C
C###   'BREAKDOWN VOLTAGE'
C
900    IF(ACPNUM(X))3,901,903
901    TYPE 902
902    FORMAT($VALUE?  $)
       CALL INLINE(0,I,ESC2)
       IF(I)901,900,900
903    IFLAG(20)=-X          ;C     RESET BREAKDOWN VOLTAGE.
       GO TO 15
C
C
C###   'DELETE PARAMETERS'
C
950    I=1
       CALL PARLIST(I,KFLAG)
       IF(I)1,951,952
951    TYPE 499
       CALL INLINE(0,I,ESC2)
       GO TO 950
C
C      WE MUST DELETE THE HIGHEST PARAMETER NUMBER FIRST, OTHERWISE THE REMAINDER OF THE
C      PARAMETER NUMBERS MAY BE INCORRECT.  HENCE WE SORT THEM FIRST.
C
952    DO 956 J=1,I
       KK=1
       DO 955 KI=1,I
       IF(LISTPAR(KK)-LISTPAR(KI))954,955,955
954    KK=KI
955    CONTINUE
       NAME(J)=LISTPAR(KK)
956    LISTPAR(KK)=0
       DO 957 J=1,I
957    LISTPAR(J)=NAME(J)
       CALL ESCOFF
       DO 953 J=1,I
953    CALL MOVE(LISTPAR(J)+1,-1)
       LIMBS=LIMBS-I
       CALL ESCON
       GO TO 1
C
C
C###   CHANGE ANALYSIS.
C
      CALL INLINE(0,I,ESC2)
      IF(I) 1,1,1002
1002  LXX=2
      M=COM(LIST(LSTADD(1)),1)
      IF(M-2) 1003,202,1003
1003  IF(M-5) 3,1100,3
1100  KFLAG=0
      GO TO 1051
      CALL INLINE(0,I,ESC2)
      IF(I) 1,1,1202
1202  LXX=3
      M=COM(LIST(LSTADD(1)),1)
      IF(M-2) 1203,202,1203
1203  IF(M-5) 3,1150,3
1150  KFLAG=1
1051  CALL ARM
      CLOSE
      CALL RELEASE(3)
      FLAG=-2
      GO TO 1
       END
       SUBROUTINE PARLIST(I,KFLAG)
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,MUMMY
       COMMON PRO,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZERO,FREQ,OMEGA,DCPS,LFR
       COMMON IDUMMY,NI,NT,KIND,JNDX,LMN,K,LIST
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NI(99),NT(99),KIND(99),JNDX(99),LMN(99),K(99),NAME(30),IDUMMY(831),MUMMY(108)
       DIMENSION LIST(250),L(4),IFLAG(10),FREQUENCIES(20),NODELIST(20),LISTPAR(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1)),(IDUMMY(291),FREQUENCIES(1))
       EQUIVALENCE (IDUMMY(330),NAME(1)),(PRO,L(4)),(IDUMMY(360),LISTPAR(1))
       KI=0;Y=BLEM
       IF(ACPNUM(X))4,1,3
1      I=0;BLEM=Y
       RETURN
2      J=COMMA(J)
       IF(ACPNUM(X))4,12,3
3      IF(X)50,50,13
13     IF(X-LIMBS-.5)14,50,50
14     KI=KI+1;LISTPAR(KI)=X
       IF(I)2,2,21
21     GO TO(2,2,22,22,2,2,2,2,2,23,2,2,2,2,2)KIND(LISTPAR(KI))
22     IF(KFLAG)2,2,23
23     KI=KI+1;LISTPAR(KI)=X+1
       GO TO 2
4      CALL INLINE(-1,J,X)
       L(1)=J*65536;L(2)=0;N=2;NN=3
5      CALL INLINE(1,J,X)
       IF(J)9,9,20
20     IF(J-3H  ,)6,9,6
6      IF(N)8,8,7
7      L(1)=L(1)+J*256**(N-1);N=N-1
       GO TO 5
8      L(2)=L(2)+J*256**(NN-1);NN=NN-1
       GO TO 5
9      DO 10 J=1,LIMBS
      CALL COMPAR(BLEM,PNAME(J),IND)
      IF(IND) 10,10,11
10     CONTINUE
       GO TO 50
11     X=J
       GO TO 14
12     I=KI;BLEM=Y
       RETURN
50     I=-1;BLEM=Y
       RETURN
       END
       FUNCTION INPAR(PNAME,NI,NT,KIND,ZZ,LMN,K,PNOM,PMIN,PMAX,LISTAD,KFLAG,IANS,LIST,NSEMI,ESC,TMARK)
C
C   FUNCTION STORES VALUES IN ARGS.
C   INPAR IS RETURNED AS 1 IF PARAMETER IS INPUTED, AS -1 IF NOT, AND AS 0 IF SCAN FAILS.
C
       COMMON Z
       DIMENSION L(2)
       EQUIVALENCE (Z,L(2))
      IF(TMARK) 4000,1111,4000
4000  GO TO(2200,2300,2400),TMARK
1111  CONTINUE
       Y=Z
       CALL INLINE(0,J,ESC)
       IF(J)1,2,2
1      INPAR=-1
       RETURN
2      CALL INLINE(-1,J,X)
       IF(J)3,3,4
3      CALL INLINE(1,J,X)
       IF(J)1,3,4
4      K=J;M=COM(LISTAD,1)
       IF(M)5,1,7
5      TYPE 99
6      INPAR=0
       RETURN
7      IF(KFLAG)81,82,82
81     IF(M-9)82,82,5
82     L(1)=K*65536;L(2)=0;N=2;NN=3
       CALL INLINE(-1,J,X)
8      IF(J)12,12,9
9      IF(J-3H  ,)200,12,200
200    L(1)=L(1)+J*256**(N-1);N=N-1
       CALL INLINE(1,J,X)
       IF(N)10,10,8
10     IF(J)12,12,11
11     IF(J-3H  ,)201,12,201
201    L(2)=L(2)+J*256**(NN-1);NN=NN-1
       CALL INLINE(1,J,X)
       IF(NN)12,12,10
12     PNAME=Z;Z=Y
       IF(COMMA(J))16,15,16
15    IF((M-9)*(M-11)) 1015,1016,1015
1015  TYPE 98
      GO TO 1017
1016  TYPE 1098
1098  FORMAT($COLLECTOR NODE # $)
1017   CALL INLINE(0,J,ESC)
       IF(J)15,16,16
16     IF(ACPNUM(X))5,15,17
17     NI=X
      NTC=X
       IF(COMMA(J))19,18,19
18    IF((M-9)*(M-11)) 1018,1019,1018
1018  TYPE 97
      GO TO 1020
1019  TYPE 1097
1097  FORMAT($BASE NODE # $)
1020  CALL INLINE(0,J,ESC)
       IF(J)18,19,19
19     IF(ACPNUM(X))5,18,20
20     NT=X
      NTB=X
      IF((M-9)*(M-11)) 1030,1021,1030
1021  IF(COMMA(J)) 1024,1022,1024
1022  TYPE 1023
1023  FORMAT($EMITTER NODE # $)
      CALL INLINE(0,J,ESC)
      IF(J) 1022,1024,1024
1024  IF(ACPNUM(X)) 5,1022,1025
1025  NTE=X
C
C
C      TRANSISTOR MACROS
C
C
      IF(M-9) 4000,2001,4000
2001  IF(COMMA(J)) 2037,2035,2037
2035  TYPE 2036
2036  FORMAT($NODE FOR BETA: $)
      CALL INLINE(0,J,ESC)
      IF(J) 2035,2037,2037
2037  IF(ACPNUM(X)) 5,2035,2038
2038  NTS=X
C
C
C      'H' PARAMETERS
C
C
      IF(COMMA(J)) 2004,2002,2004
2002  TYPE 2003
2003  FORMAT($HI: $)
      CALL INLINE(0,J,ESC)
      IF(J) 2002,2004,2004
2004  IF(ACPNUM(X)) 5,2002,2005
2005  PHI=X
      CALL TOLMAX(PHIMAX,PHIMIN,X,ZAP)
      IF(ZAP) 5,2022,5
2022  IF(COMMA(J)) 2008,2006,2008
2006  TYPE 2007
2007  FORMAT($HO: $)
      CALL INLINE(0,J,ESC)
      IF(J) 2006,2008,2008
2008  IF(ACPNUM(X)) 5,2006,2009
2009  PHO=X
      CALL TOLMAX(PHOMAX,PHOMIN,X,ZAP)
      IF(ZAP) 5,2025,5
2025  IF(COMMA(J)) 2012,2010,2012
2010  TYPE 2011
2011  FORMAT($HF: $)
      CALL INLINE(0,J,ESC)
      IF(J) 2010,2012,2012
2012  IF(ACPNUM(X)) 5,2010,2013
2013  PHF=X
      CALL TOLMAX(PHFMAX,PHFMIN,X,ZAP)
      IF(ZAP) 5,2028,5
2028  IF(COMMA(J)) 2016,2014,2016
2014  TYPE 2015
2015  FORMAT($HR: $)
      CALL INLINE(0,J,ESC)
      IF(J) 2014,2016,2016
2016  IF(ACPNUM(X)) 5,2014,2017
2017  PHR=X
      CALL TOLMAX(PHRMAX,PHRMIN,X,ZAP)
      IF(ZAP) 5,2030,5
2030  NI=NTB;NT=NTS;KIND=1;INPAR=1;K=0;JNDX=0
      TMARK=1;PNOM=PHI;PMAX=PHIMAX;PMIN=PHIMIN;ZZ=0
      RETURN
2200  NI=NTC;NT=NTE;KIND=2;INPAR=1;TMARK=2;
      PNOM=PHO;PMAX=PHOMAX;PMIN=PHOMIN
      RETURN
2300  NI=NTC;NT=NTE;KIND=7;INPAR=1;TMARK=3
      PNOM=PHF;PMIN=PHFMIN;PMAX=PHFMAX
      RETURN
2400  NI=NTE;NT=NTS;KIND=13;INPAR=1
      TMARK=4;PNOM=PHR;PMIN=PHRMIN;PMAX=PHRMAX
      RETURN
1030   IF(COMMA(J))23,21,23
21     IF(M-7)22,40,13
13     IF(M-8)40,40,22
22    IF(M-10)122,120,122
120    TYPE 121
121    FORMAT ($SATURATION CURRENT$/)
122    TYPE 96
       CALL INLINE(0,J,ESC)
       IF(J)22,23,23
23     IF(ACPNUM(X))5,21,24
24     PNOM=X
      CALL TOLMAX(PMAX,PMIN,X,ZAP)
      IF(ZAP) 5,40,5
40     GO TO(50,50,50,50,60,90,70,70,51,51,51),M
51     M=10
50     KIND=M;JNDX=0;K=0;INPAR=1;ZZ=0
       RETURN
60     KIND=11
       GO TO 89
90     KIND=6
89     Y=Z;ZZ=0
       MX=COM(NSEMI,1)
       IF(MX) 202,202,203
203    IF(COMMA(J))61,69,69
202    TYPE 94
       Y=Z;ZZ=0
       CALL INLINE(0,J,ESC)
       IF(J)69,61,61
61     IF(COM(NSEMI,1))661,205,205
661    KK=COM(LIST,1)
       J=COMMA(J)
       CALL INLINE(-1,J,X)
       IF(KK)66,69,62
62     L(2)=0
       DO 63 I=1,2
       DO 63 K=1,3
       IF(I+K-2)63,63,77
77     CALL INLINE(1,J,X)
       IF(J-27)63,212,63
212    DO 213 J=K,3
213    L(I)=L(I)*256
       GO TO 214
63     L(I)=L(I)*256+J
214    ZZ=Z;Z=Y
       GO TO(67,67,55)KK
66     TYPE 93
       GO TO 60
67     IF(M-5)68,68,56
68     KIND=13
       GO TO 69
56     KIND=8
       GO TO 69
55     IF(M-5)57,57,58
57     KIND=12
       GO TO 69
58     KIND=7
69     IF(KFLAG)87,88,88
88     K=0;INPAR=1
       RETURN
87     K=0
       MX=COM(NSEMI,1)
       IF(MX)206,206,205
205    IF(COMMA(J))85,88,88
206    TYPE 92
       CALL INLINE(0,J,ESC)
85     M=COM(IANS,1)
       IF(M)69,88,59
59     K=M-1;INPAR=1
204    RETURN
70     IF(M-7)71,71,72
71     KIND=6
       GO TO 73
72     KIND=11
73     PNOM=0;PMIN=0;PMAX=0;JNDX=0;K=0;ZZ=0;INPAR=1
       RETURN
92     FORMAT ($SIN OR COS?  $)
93     FORMAT ($***ERROR:  DEPENDENCY IS INVALID.$/)
94     FORMAT ($DEPENDENCY:  $)
95     FORMAT ($MAXIMUM VALUE:  $)
96     FORMAT ($NOMINAL (WITH MIN-MAX OR % TOLERANCE):  $)
97     FORMAT ($TO NODE #$)
98     FORMAT ($FROM NODE #$)
99     FORMAT ($***ERROR:  NOT A VALID PARAMETER.$/)
       END
       SUBROUTINE RDLIST(I,J)
C
C   I= ARRAY INTO WHICH LIST ARE TO BE STORED.
C   J= ARRAY TO LIST ADDRESSES.
C
       DIMENSION I(250),J(10)
       L=1;LL=1
       READ 2,2,NOFLST
       DO 1 N=1,NOFLST
       READ 2,2,NOFENT
       I(L)=NOFENT;J(LL)=L;LL=LL+1
       DO 4 JJ=1,NOFENT
       READ 2,2,NOFWRD
       I(L+1)=NOFWRD
      JJJ=3*(NOFWRD-1)
       READ 2,3,(I(M),M=L+2,L+JJJ)
4      L=L+NOFWRD
1      L=L+1
2      FORMAT (I/)
3      FORMAT (250A)
       CLOSE
       RETURN
       END
       FUNCTION FILE(I)
C
C   I= ARRAY INTO WHICH FILE NAME IS TO BE STORED.
C      FILE IS RETURNED AS 1 IF A FILE NAME IS GIVEN, AS 0 IF NOT.
C
       DIMENSION I(30),II(30)
       EQUIVALENCE (I(1),II(1))
       CALL INLINE(-1,J,X)
       K=1
1      IF(J)2,15,9
15     CALL INLINE(1,J,X)
       IF(J)2,15,9
2      FILE=-1
       RETURN
9     I(K)=J
       DO 12 N=1,30
       CALL INLINE(1,J,X)
       IF(J)2,10,10
10     K=K+1
12     I(K)=J
       FILE=1
       J=0
       I(K+1)=0
       I(K+2)=0
       DO 14 N=1,K+1,3
       J=J+1
14     I(J)=I(N)*65536+I(N+1)*256+I(N+2)
       RETURN
       END
       FUNCTION COM(I,J)
C
C   I= NAME OF THE COMMAND TABLE TO BE SEARCHED.
C   J= MINIMUM NUMBER OF CHARACTERS NEEDED FOR MATCH TO BE SUCCESSFUL.
C      THE ENTRY POSITION OF THE MATCH, IF ANY, IS RETURNED IN COM.
C      IF NO MATCH IS FOUND, -1 IS RETURNED.
C      IF THERE IS NO INPUT ON WHICH TO PERFORM A SEARCH, 0 IS RETURNED.
C
       DIMENSION K(20),KK(20)
       CALL INLINE(-1,II,X)
20     IF(II)1,21,2
21     CALL INLINE(1,II,X)
       GO TO 20
1      COM=0
       RETURN
2      JJ=0
       DO 5 L=1,1000
       N=IGTCHR(1,L,I)
       IF(L)6,3,3
3      IF(N-II)5,4,5
4      JJ=JJ+1;K(JJ)=L;KK(JJ)=2
5      CONTINUE
6      IF(JJ)7,7,8
7      COM=-1
       RETURN
8      DO 19 M=2,100
       CALL INLINE(1,II,X)
22     IF(II)9,12,12
23     CALL INLINE(1,II,X)
       GO TO 22
9      IF(JJ-1)10,10,7
10     IF(M-J)7,7,11
11     COM=K(1)
       RETURN
12     MM=1
       DO 17 L=1,JJ
       KK(MM)=KK(L)
13     NN=K(L);N=IGTCHR(KK(MM),NN,I);KK(MM)=KK(MM)+1
       IF(N)14,15,15
14     IF(JJ-1)10,10,7
15     IF(II-N)17,16,17
16     K(MM)=K(L);MM=MM+1
17     CONTINUE
       IF(MM-1)18,18,19
18     IF(JJ-1)10,10,7
19     JJ=MM-1

       END
       FUNCTION COMMA(I)
       CALL INLINE(-1,J,X)
       IF(J)1,1,3
1      CALL INLINE(1,J,X)
       IF(J)2,1,3
2      COMMA=0
       RETURN
3      IF(J-3H  ,)4,5,4
4      COMMA=-1
       RETURN
5      CALL INLINE(1,J,X)
       COMMA=1;I=J
       RETURN
       END
       SUBROUTINE PACK(M)
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,MUMMY
       COMMON PRO,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZERO,FREQ,OMEGA,DCPS,LFR
       COMMON IDUMMY,NI,NT,KIND,JNDX,LMN,K,LIST
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NI(99),NT(99),KIND(99),JNDX(99),LMN(99),K(99),NAME(30),IDUMMY(831),MUMMY(108)
       DIMENSION LIST(250),L(4),IFLAG(10),FREQUENCIES(20),NODELIST(20),LISTPAR(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1)),(IDUMMY(291),FREQUENCIES(1))
       EQUIVALENCE (IDUMMY(330),NAME(1)),(PRO,L(4)),(IDUMMY(360),LISTPAR(1))
       IF(M)10,11,11
10     II=404
       GO TO 15
11     II=4
       DO 12 I=1,LIMBS
12     K(I)=0
15     NODES=0
       DO 2 I=1,LIMBS
       KRAM1(I)=(KIND(I)*100+NI(I))*100+NT(I)
       KRAM2(I)=(K(I)*100+LMN(I))*100+JNDX(I)
       KRAM4(I)=II
       IF(NI(I)-NODES)2,2,1
1      NODES=NI(I)
2      CONTINUE
       DO 4 I=1,LIMBS
       IF(NT(I)-NODES)4,4,3
3      NODES=NT(I)
4      CONTINUE
       RETURN
       END
       FUNCTION ACPNUM(X)
C
C      THE NUMBER OBTAINED WILL BE RETURNED IN X.
C      ACPNUM IS RETURNED AS 1 IF A NUMBER EXIST,  AS -1 IF NOT, AND AS 0 IF NO INPUT.
C
       I1=1;I2=-1;I3=1;I4=0
       CALL INLINE(-1,J,X)
       GO TO 32
1      CALL INLINE(1,J,X)
32     IF(J)2,1,3
2      X=0;ACPNUM=0
       RETURN
5      CALL INLINE(1,J,X)
       IF(J)34,34,7
34     X=0;ACPNUM=-1
       RETURN
3      IF(J-3H  -)6,4,6
4      I1=-1
       GO TO 1
6      IF(J-3H  +)7,5,7
7      IF(J-3H  .)9,8,9
8      I2=0
       GO TO 5
9      J=J-16
       IF(J)34,11,10
10     IF(9-J)34,11,11
11     ACPNUM=1;X=J
       IF(I2)13,12,12
12     I2=I2+1
13     CALL INLINE(1,J,X)
       IF(J)14,14,15
14     IF(I2)30,31,31
30     I2=0
31     X=(I1*X)*(10**(I3*I4-I2))
       RETURN
15     IF(I2)16,18,18
16     IF(J-3H  .)18,17,18
17     I2=0
       GO TO 13
18     IF(J-3H  E)26,19,26
19     CALL INLINE(1,J,X)
       IF(J)14,19,20
20     IF(J-3H  +)21,19,21
21     IF(J-3H  -)23,22,23
22     I3=-1
       GO TO 19
24     I4=I4*10+J
       CALL INLINE(1,J,X)
23     J=J-16
       IF(J)14,24,25
25     IF(9-J)14,24,24
26     J=J-16
       IF(J)14,28,27
27     IF(9-J)14,28,28
28     X=X*10+J
       IF(I2)13,29,29
29     I2=I2+1
       GO TO 13
       END
       SUBROUTINE INLINE(I,J,ESC)
C
C   I= -1  :  J= CURRENT CHARACTER, IF ANY     - J= -1  IF NONE
C       0  :  J= 1, IF ANY INPUT                           -   "      "
C      +1  :  J= NEXT CHARACTER, IF ANY        -   "      "
C
       DIMENSION N(200)
       IF(I)8,1,7
1      CALL ONECHR(N(1))
       IF(N(1)-109)5,2,5
2      DO 3 K=1,200
3      N(K)=0
4      IPOINT=201;J=-1
       RETURN
5      CALL DCLESC(ESC)
       J=1
       IF((N(1)-97)*(N(1)-113))66,6,66
6      J=0
66     CALL EDIT(N,200,J)
       IPOINT=1
       GO TO 9
7      IPOINT=IPOINT+1
8      IF(IPOINT-200)9,4,4
9      J=N(IPOINT)
       RETURN

       END
C
C
C
C      THE FOLLOWING FUNCTION IS USED TO RETRIEVE CHARACTERS FROM THE COMMAND LISTS.
C
C   I= NUMBER OF THE CHARACTER WANTED.
C   J= NUMBER OF THE TABLE ENTRY.  RETURNED AS -1 IF NO SUCH ENTRY.
C   K= NAME OF THE TABLE.
C      THE CHARACTER IS RETURNED IN IGTCHR, IF IT EXIST, OTHERWISE -1 IS RETURNED.
C
       FUNCTION IGTCHR(I,J,K)
       DIMENSION K(1)        ;C     WE COULD DIMENSION THIS MORE I SUPPOSE.
       IF(J-K(1))2,2,1       ;C     WE ASSUME THAT THE ENTRY NUMBER IS POSITIVE, AND ONLY CHECK
C                            ;C     TO SEE THAT IT IS NOT TOO HIGH.  K(1) CONTAINS THE NUMBER OF ENTRIES.
1      J=-1;IGTCHR=-1        ;C     ENTRY NUMBER TOO LARGE.
       RETURN
2      LL=2;II=I/3
       IF(J-2)5,3,3
3      DO 4 JJ=2,J
4      LL=LL+K(LL)
5      IF ((K(LL)-1)*3-I)1,6,6
6      KK=65536
       IF(I-II*3-1)9,7,8
7      KK=KK/256
8      KK=KK/256
       LL=LL+1
9      IGTCHR=(K(LL+II)*KK)/65536
       RETURN
       END
C
C
C
C      THE FOLLOWING SUBROUTINE IS USED TO MOVE PART OF THE PARAMETER DESCRIIPTIONE ARRAYS
C      EITHER UP OR DOWN.  THUS IF ONE WISHED TO DELETE PARAMETER NUMBER 4, ONE MOVES ALL
C      THE ARRAYS DOWN ONE (I.E. PNAME(I)=PNAME(I+1), ECT.) STARTING AT ITEM #5.  LIKEWISE IF ONE WANTED
C      TO REPLACE OPEN CIRCUIT WITH A DIODE, ONE WOULD MOVE ALL THE ARRAYS UP ONE START WITH THE
C      PARAMETER FOLLOWING THE OPEN CIRCUIT.
C
       SUBROUTINE MOVE(INITIAL,NUMBER)
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,MUMMY
       COMMON PRO,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZERO,FREQ,OMEGA,DCPS,LFR
       COMMON IDUMMY,NI,NT,KIND,JNDX,LMN,K,LIST
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NI(99),NT(99),KIND(99),JNDX(99),LMN(99),K(99),NAME(30),IDUMMY(831),MUMMY(108)
       DIMENSION LIST(250),L(4),IFLAG(10),FREQUENCIES(20),NODELIST(20),LISTPAR(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1)),(IDUMMY(291),FREQUENCIES(1))
       EQUIVALENCE (IDUMMY(330),NAME(1)),(PRO,L(4)),(IDUMMY(360),LISTPAR(1))
       CALL ESCOFF           ;C     WE DONT WANT TO BE DISTURBED WHILE WE ARE MOVING PARAMETERS AROUND.
       IF(NUMBER)1,6,2       ;C     UP OR DOWN.
C
C      WE USE THE FOLLOWING ODDLY NESTED "DO"S TO AVOID DUPLICATING CODE.
C
1     SNAME=PNAME(INITIAL+NUMBER)
       DO 5 I=INITIAL+NUMBER,99+NUMBER;C   DOWN.
       GO TO 3
2      DO 4 I=99,INITIAL+NUMBER,-1;C   UP.
3      J=I-NUMBER
       PNAME(I)=PNAME(J)
       PNOM(I)=PNOM(J)
       PMIN(I)=PMIN(J)
       PMAX(I)=PMAX(J)
       NI(I)=NI(J)
       NT(I)=NT(J)
       KIND(I)=KIND(J)
      IF(JNDX(J)-J) 103,102,103
C
C      REFERENCED TO ITSELF NO PROBLEM
C
102   JNDX(I)=I
      GO TO 9
C
103   IF(JNDX(J)-(INITIAL+NUMBER)) 104,106,105
C
C      REFERENCED TO SOMETHING UNMOVED BY CHANGE
C
104   JNDX(I)=JNDX(J)
      GO TO 9
C
C      REFERENCED TO A 'MOVEABLE' PARAMETER
C
105   JNDX(I)=JNDX(J)+NUMBER
      GO TO 9
C
C      REFERENCED TO THE CHANGING PARAMETER
C
106   IF(NUMBER) 107,6,104
C
C      THE REFERENCED PARAMETER IS BEING DELETED LET THE USER KNOW
C
107   TYPE 108,PNAME(I),SNAME
108   FORMAT(/$THE DEPENDENCY OF $,A5,$ ON $,A5,$ HAS BEEN REMOVED$/)
      GO TO 102
9      LMN(I)=LMN(J)
       K(I)=K(J)
       IF(NUMBER)5,6,4
4      CONTINUE
       GO TO 6
5      CONTINUE
6      CALL ESCON
       RETURN
       END
      SUBROUTINE TOLMAX(PMAX,PMIN,X,ZAP)
      PNOM=X
      ZAP=0.0
       IF(COMMA(J))210,25,26
210    CALL INLINE(-1,J,X)
       IF(J-27)26,25,26
25     PMIN=X;PMAX=X
       GO TO 40
26     IF(ACPNUM(X))25,25,27
27     CALL INLINE(-1,J,X)
       IF(J-3H  %)29,28,29
28     X=X/100;PMIN=PNOM*(1-X);PMAX=PNOM*(1+X)
       CALL INLINE(1,J,X)
       GO TO 40
29     PMIN=X
       IF(COMMA(J))31,30,31
30     TYPE 95
       CALL INLINE(0,J,ESC)
       IF(J)30,31,31
31     IF(ACPNUM(X))5,30,32
32     PMAX=X
40    RETURN
5     ZAP=1.0
      RETURN
95    FORMAT($MAXIMUM VALUE: $)
      END
AC ** FICHE/FRAME BREAK *****
CACOV2
C    ACAP
C      
C      *REVISED AC AUTOMATIC CIRCUIT ANALYSIS PROGRAM*
C      *25 NODES - 75 PARAMETERS*
C      *NAFI PROGRAM F -06-66-07*
C      VR IS AN ARRAY THAT CONTAINS THE REAL PART OF THE SOLUTIONS
C      VI IS AN ARRAY THAT CONTAINS THE IMAGINARY PART OF THE SOLUTIONS.
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,PHNM,NET,ICCCCC,FLAG,IDDDDD,KFLAG
       COMMON PRO,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZRO,FREQ,OMEGA,DCPS,LFR
       COMMON ITEM0,ITEM1,ITEM2,ITEM3,C2PI,C360
       COMMON C180,C90,C0,C1,K0,K2,K4,NVS,W,VMN,VMX
       COMMON I,J,B,C,DT,ANGLE,R,LK,NK,S,KIND,IM,INDX
       COMMON IO,K3,DELR,DELI,LAST,NT,D,PN,PM,NI,FPD
       COMMON FFPPD,VNOM,VMINR,VMINI,TVARI,TVARR
       COMMON IDUMMY,P,VI,VR
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NAME(30),P(99),VNOM(25),VMINR(25),VMINI(25),TVARI(25),TVARR(25)
       DIMENSION IDUMMY(517),NET(25),VR(25,26),VI(25,26),PHNM(25),ICCCCC(24),IDDDDD(6)
       DIMENSION IFLAG(20),FREQUENCIES(20),NODELIST(20),LISTPAR(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1)),(IDUMMY(360),LISTPAR(1))
       EQUIVALENCE (IDUMMY(291),FREQUENCIES(1)),(IDUMMY(330),NAME(1))
C
C      NODET=-1 MEANS PICK UP LIST OF NODES FROM NODELIST
C      NODET=0 MEANS ALL NODES HAVE BEEN SPECIFIED
C      NODET=POSITIVE INTEGER MEANS ONLY THAT NODE HAS BEEN SPECIFIED
C            AND IS ALSO CONTAINED IN NODELIST
C      IFLAG(1)=NOMINAL SOLUTION FLAG
C      IFLAG(2)=DIFFERENTIAL ANALYSIS
C      IFLAG(3)=STATISTICAL ANALYSIS
C      IFLAG(4)=PARAMETER VARIATION
C      IFLAG(5)=LOW  WORST CASE SOLUTION (PASSED AS FLAG 6)
C      IFLAG(6)=HIGH WORST CASE SOLUTION (PASSED AS FLAG 5)
C      IFLAG(7)=PARAMETER SETTINGS FOR WORST CASE SOLUTION(-1=NONE,1=YES) 
C      IFLAG(8)=1 FOR PHASE, AND -1 FOR VOLTAGE (FOR WORST CASE)
C      IFLAG(10)=1 WHEN PHASE OPTION SPECIFIED, AND -1 FOR VOLTAGE OP.
C
C      IN FLAGS 1-6, -1 MEANS NO OUTPUT
C                     0 MEANS NO HEADING
C                     1 MEANS OUTPUT WITH HEADING
       CALL LOADED(1)
       CALL DCLESC(ESC)
       ASSIGN 4440 TO ESC
       CALL ARM
       CALL SESC
      IF(KFLAG)6001,6002,6001
6002  TYPE 77777
77777 FORMAT(/$K-AC=12.00  10-10-71$)
      CLOSE
      CALL RSUB
C      REVERSE ORDER OF FLAGS 5&6
6001   I=IFLAG(6)
       IFLAG(6)=IFLAG(5)
       IFLAG(5)=I
       IF(NODELIST(2)) 333,2051,2052
2052   NODET=-1
2051   IF(FREQUENCIES(1)-1E50) 8890,8891,8891
8891   STOP
8890   CONTINUE
       TYPE 2094
       IF(IFLAG(5)+IFLAG(6)+2) 333,2003,2004
2004   IF(NODET) 2005,2005,2003
2005   TYPE 2042
2042   FORMAT($AT THE PRESENT TIME, YOU MUST SPECIFY A PARTICULAR NODE$/
+      $WHEN DOING A WORST CASE ANALYSIS$/)
       GO TO 40
2003   CALL AOPEN(2,NAME,6HSYMOUT)
       IIO=2;K2=1+1;K3=K2+1;K4=K3+1;IO=NODES
       LAST=NODES+1;C0=0.;INT=0;K0=0;NVS=0;NK=0;I=1;NEXTF=1
       IF(FREQ) 2010,2010,2009
2010   FREQ=FREQUENCIES(1)
2009   FFPPD=FREQ
       FINIT=FREQ
C      COMPUTE A LOGARITHMETIC INCREMENT IF LOG SWEEP
       IF(DCPS*LFR) 2140,2140,2141
2141   ALOGIN=EXP((ALOG(OMEGA)-ALOG(FREQ))/(DCPS-1))
C      ASSURE THAT TESTNODE=0 WHEN SPECIAL SOLUTIONS 2, 3, OR 4 SPECIFIED
2140   IF((IDTRM-1)*ABS(NODET))1101,1101,1100
1100   NODET=0
1101   DO 2 I=1,LIMBS
       ITEM0=KRAM2(I)
       CALL ITEM
       INDX=ITEM3
       IM=ITEM1
       ITEM0=KRAM1(I)
       CALL ITEM
C      IF PARAMETER IS A VOLTAGE SOURCE, TYPE = 11,12, OR 13.
       IF(11-ITEM1)1,1,2
1      NVS=NVS + 1
2      CONTINUE
C      INITIALIZE THE NET ARRAY TO ZERO.
3      DO 4 I=1, NODES
4      NET( I )=0
       IF(NVS)333,603,5
C      THE NET ARRAY IS SET UP FOR VOLTAGE SOURCES. THERE IS AN ENTRY IN
C      THE NET ARRAY FOR EACH VOLTAGE SOURCE.  THE NET ARRAY IS A CRAMMED
C      ARRAY.  IF THERE ARE NO VOLTAGE SOURCES IN THE CIRCUIT THIS
C      SECTION IS SKIPPED.  THE NET ARRAY IS USED IN THE EQU SUBROUTINE.
   5   M=0
       N=0
 57    DO 96 K=1, LIMBS
       ITEM0=KRAM1 ( K )
       CALL ITEM
C      IF PARAMETER IS A VOLTAGE SOURCE, TYPE = 11,12, OR 13.
       IF( ITEM1 - 11) 96,6,6
   6   NI=ITEM2
       IM=ITEM3
       IF ( N ) 6,9,7
   7   DO 8 I=1,N
       ITEM0=NET ( I )
       CALL ITEM
C      HAS THE SOURCE ALREADY BEEN ENTERED IN THE NET ARRAY.
       IF ( K - ITEM2 ) 8,96,8
   8   CONTINUE
   9   IJS=NI + IM
       NN=0
       I=K
       IJP=NI * IM
C      IF VOLTAGE SOURCE IS GROUNDED, IJP=0.
       IF ( IJP ) 333,11,10
  10   IF ( NK ) 333,96,11
  11   N=N + 1
  12   M=M + 1
       NET(M)=KRAM(0,I,NN)
  14   I=I + 1
       IF ( I - K ) 15,28,15
15     IF(LIMBS-I) 22,16,16
16     ITEM0=KRAM1(I)
       CALL ITEM
C      IF PARAMETER IS A VOLTAGE SOURCE, TYPE = 11,12, OR 13.
       IF(ITEM1-11) 14,17,17
17     IF(ITEM2*ITEM3-IJP) 18,26,18
18     NS=NI
639    IF(NS-ITEM2) 19,23,19
19     IF(ITEM3-NS) 1234,129,1234
1234   IF(NS-IM) 20,14,20
20     NS=IM
       GO TO 639
22     I=0
       GO TO 14
23     NN=ITEM3
       GO TO 130
24     NT=NS
C      TALLY FOR FINDING A VOLTAGE SOURCE ATTACHED TO THIS TRUNK
25     NET(N)=NET(N)+10000
       GO TO 12
C      IF A VOLTAGE SOURCE IS GROUNDED, IJP=0
26     IF(IJP) 333,14,27
27     IF(ITEM2+ITEM3-IJS) 18,333,18
28     NT=N
29     ITEM0=NET(N)
       CALL ITEM
       NS=ITEM1
       IF(NS) 333,48,44
44     NT=NT+1
       ITEM0=NET(NT)
       CALL ITEM
       NN=ITEM3
       I=ITEM2
       ITEM0=KRAM1(I)
       CALL ITEM
       IJS=ITEM2+ITEM3
       IJP=ITEM2*ITEM3
       LK=0
45     LK=LK+1
       IF(LK-LIMBS) 80,80,47
47     NS=NS-1
       IF(NS)333,69,44
48     IF(M-N) 333,96,69
69     N=N+1
       GO TO 29
80     IF(LK-I) 81,45,81
81     ITEM0=KRAM1(LK)
       CALL ITEM
C      IF PARAMETER IS A VOLTAGE SOURCE, TYPE 11, 12, OR 13.
       IF(ITEM1-11) 45,84,84
84     IF(ITEM2*ITEM3-IJP) 88,112,88
88     IF(ITEM2-NN) 97,115,97
97     IF(ITEM3-NN) 45,125,45
C      IF VOLTAGE SOURCE IS GROUNDED, IJP=0
112    IF(IJP) 333,45,114
114    IF(ITEM2+ITEM3-IJS) 88,333,88
115    IM=ITEM3
       GO TO 126
125    IM=ITEM2
126    DO 128 J=1,M
       ITEM0=NET(J)
       CALL ITEM
       IF(LK-ITEM2) 127,333,127
127    IF(IM-ITEM3) 128,333,128
128    CONTINUE
       M=M+1
       NET(M)=KRAM(0,LK,IM)
C      TALLY FOR FINDING A VOLTAGE SOURCE ATTACHED TO THIS BRANCH
       NET(NT)=NET(NT)+10000
       GO TO 45
129    NN=ITEM2
130    IF(M-N) 333,24,131
131    IF(NS-NT) 132,25,132
132    NET(N)=0
       M=N-1
       N=M
96     CONTINUE
       NK=NVS-N
       IF(NK) 333,682,683
683    LAST=LAST-NK
C      EITHER RETURN TO PICK UP FLOATING VOLTAGE SOURCE OR ABORT
       IF(LAST) 333,333,57
C      END OF THE NET ARRAY SET UP ROUTINE.
682    LAST=NODES+1
C      TYPE FREQUENCY IF NON-NOMINAL AND (FREQ(2) OR LFR OR DCPS)
C      ARE NON-ZERO
       IF(IFLAG(1)*(FREQUENCIES(2)+LFR+DCPS)) 2095,603,603
2095   WRITE IIO,2038,FREQ
603    NN=0                            ;C  ENTRY POINT
C      FPD IS STARTING FREQUENCY DECADE FOR A LOG SWEEP
C      FUNCTION AINT TAKES ONLY THE INTEGER PART OF ARGUMENT
       FPD=10**AINT(ALOG(FREQ)/ALOG(10))
403    IJK=K2                          ;C  ENTRY POINT
       FREQ=FFPPD
       IPASS=1
C      THE ,P, ARRAY IS INITIALIZED TO PNOM.
       DO 402 I=1, LIMBS
       IF(I-NODES) 404,404,402
C      INITIALIZE TVAR ARRAYS TO 0.  FOR PARAMETER SENSITIVITY COMPUTATION
404    TVARI(I)=0.
       TVARR(I)=0.
402    P(I)=PNOM(I)
91     M=0                             ;C  ENTRY POINT
       N=0
       C2PI=6.28318531
61     W=FREQ*6.28318531               ;C  ENTRY POINT
C      SUBROUTINE SETS UP THE ADMITTANCE MATRIX.
765    CALL EQU
       IF(MTRX) 140,141,141
C      SUBROUTINE SOLVES THE ADMITTANCE MATRIX.
141    CALL SOLVE
       IF(MTRX) 140,184,184
C      SUBROUTINE COMPUTES SPECIAL SOLUTIONS IF IDTRM IS NON-ZERO.
184    CALL NPG
       IF(N) 49,49,79
C      *NOMINAL LABELS*
49     IF(IFLAG(1)) 2058,2058,2007
2007   IF(NODET) 196,196,197
197    IF(NN) 333,51,2058
196    WRITE IIO,104
104    FORMAT($NODE    VOLTAGE     PHASE$/
+      $----  -----------  -------$/)
       GO TO 2058
51     WRITE IIO, 105, NODET
105    FORMAT(//4X,$TESTNODE$I3//
+      $ FREQUENCY      VOLTAGE      DBV     PHASE$/
+      $-----------   -----------  -------  -------$/)
C      *NOMINAL / EXTREMES OUTPUT*
C
2058   JTNODE=1
       DO 42 J=1, IO           ;C  ENTRY POINT
       PMN=VI(J,LAST)
       PMX=VR(J,LAST)
       PV=RMSF(PMX,PMN)
       IF(PV-1E-50) 537,537,538
537    PV=1E-50
538    ALOGPV=20*ALOG(PV)/ALOG(10)
       ANGLE=ATAN(PMN,PMX)*C360/C2PI
       IF(INT) 540, 540,542
540    VNOM(J)=PV              ;C  STORED NOMINAL MAGNITUDE SOLUTIONS
       PHNM(J)=ANGLE           ;C  STORED NOMINAL ANGLE SOLUTIONS
C      IF(NOMINAL OR WORST CASE HI OR WORST CASE LOW)
98     IF(IFLAG(1)) 42,542,542
542    IF(NODET)52,2053,50
C      IF NODET IS NON-ZERO, ONLY THE VOLTAGE FOR THE TESTNODE IS PRINTED.
50     IF(J-NODET) 42,2105,42
2105   WRITE IIO, 107, FREQ, PV, ALOGPV, ANGLE
107    FORMAT(1PE11.5,3X,E11.5,2X,0PF7.2,2X,F7.2/)
       GO TO 42
C      OUTPUT ONLY THOSE NODES IN NODELIST ARRAY
2053   JTNODE=0
52     DO 42001 JJ=1,20
       IF((J-NODELIST(JJ))*JTNODE) 42001,2008,42001
2008   JJ=20
       WRITE IIO,108,J,PV,ANGLE
108    FORMAT(I3,2X,1PE12.5,2X,0PF7.2/)
42001  CONTINUE
42     CONTINUE
       IF(INT) 520,422,426
C      GO ON TO NEXT FREQUENCY IF NOMINAL SOLUTION SPECIFIED
520    IF(IFLAG(1)) 56,85,85
85     NN=1
C      *FREQUENCY VARIATION*
C
140    CONTINUE
       IF(LFR) 362,38,39
38     IF(DCPS) 333,391,106
391    NEXTF=NEXTF+1
       FREQ=FREQUENCIES(NEXTF)
       IF(FREQ) 40,40,2000
106    FREQ=FREQ+DCPS
2000   FFPPD=FREQ
2144   IF(IFF(OMEGA,FFPPD,9)) 40,2092,2092
39     IF(DCPS) 333,360,2143
2143   FFPPD=FINIT*ALOGIN**NEXTF
       NEXTF=NEXTF+1
       IF(NEXTF-IFIX(DCPS+.5)-1) 2092,40,40
359    FPD=FPD*10.
360    FFPPD=FPD
       LFR=-1
361    IF(IFF(FREQ,FFPPD,9)) 2144,362,362
362    FFPPD=FFPPD*2.
       IF(FFPPD-10.*FPD) 361,359,359
2092   IF(IFLAG(1)) 2117,2093,2093
2093   IF(NODET) 2117,2117,403
2117   WRITE IIO,2038,FFPPD
2038   FORMAT(///$FREQUENCY =$, 1PE11.4//)
       GO TO 403
C
56     IJK=IJK-1                       ;C  ENTRY POINT FOR NON-NOMINAL
       IF(IJK) 82,82,59
C      *PARAMETER VARIATION*
58     M=N                             ;C  ENTRY POINT
       P(M)=PN
59     N=N+1
       IF(N-LIMBS) 2037,2037,92
C      IF A SENSITIVITY ANALYSIS, EXAMINE EACH PARAMETER ON LISTPAR
2037   IF(IFLAG(2)+IFLAG(4)+2) 333,78,2060
C      IF LISTPAR IS EMPTY, SOLVE FOR ALL PARAMETERS
2060   IF(LISTPAR(1)) 333,78,2056
C      ANALYZE ONLY PARAMETERS ON LISTPAR
2056   DO 2055 LPR=1,20
       IF(N-LISTPAR(LPR)) 2055,2061,2055
2055   CONTINUE
       PN=PNOM(N)
       GO TO 58
C      PARAMETER IS ON LIST, BUT DOES IT HAVE A MIN&MAX?
2061   IF(PMAX(N)-PMIN(N)) 78,2059,78
2059   WRITE IIO,2041,PNAME(N)
2041   FORMAT(/,A5,$ HAS NO MIN&MAX$//)
78     PN=PNOM(N)
       PMN=PMIN(N)
       P(N)=PMN
       PMX=PMAX(N)
       DP=PMX-PMN
       IF(IFF(PMX,PMN,9)) 60,58,60
C      SET LPRT TO -1 AND SOLVE, IF FULL PARAMETER VARIATION
C      OR IF WORST CASE ANALYSIS
60     IF(IFLAG(4)+IFLAG(5)+IFLAG(6)+3) 333,77,2050
2050   LPRT=-1
C      SET UP EQU FOR P(N)=PMIN(N) AND SOLVE.
       GO TO 61
79     IF(M-N) 62,66,333               ;C  ENTRY POINT
C      STORE THE PRESENT SOLUTIONS BEFORE SOLVING FOR P(N)=PMAX(N) OR
C      P(N) INCREASED IN ORDER TO COMPUTE THE DIFF. RATIOS OR PARTIALS.
62     DO 63 I=1, IO
       VMINR(I)=VR(I,LAST)
63     VMINI(I)=VI(I,LAST)
       M=N
       P(M)=PMX
C      SET UP EQU FOR P(N)=PMAX(N) AND SOLVE.
       IF(LPRT) 61,61,64
64     P(M)=PM+DP
C      SET UP EQU FOR P(N) INCREASED AND SOLVE.
       GO TO 61
66     IF(LPRT) 67,67,68               ;C  ENTRY POINT
67     PV=PNAME(N)
       IF(IFLAG(4)) 68,2102,2012
2012   IFLAG(4)=0
       IF(IFLAG(10)) 2011,333,2013
2011   WRITE IIO,2014
2014   FORMAT(/18X,$* N  O  D  E      V  O  L  T  A  G  E  S *$//
+      $NODE  DEL V/DEL P  AT PARAM MIN  AT PARAM NOM  AT PARAM MAX$/
+      $----  -----------$,3(2X,12($-$))/)
       GO TO 2102
2013   WRITE IIO,2015
2015   FORMAT(/18X,$*   N  O  D  E        P  H  A  S  E  S  * $//
+      $NODE  DPHASE/DPAR  AT PARAM MIN  AT PARAM NOM  AT PARAM MAX$/
+      $----  -----------$,3(2X,12($-$))/)
2102   WRITE IIO,2103,PV,PMIN(N),PNOM(N),PMAX(N)
2103   FORMAT(/A5,14X,$($1PE10.4,$)  ($,E10.4,$)  ($,E10.4,$)$/)
C      *OUTPUT OF PARAMETER VARIATIONS*
68     DO 75 I=1, IO
C      SUPPRESS OUTPUTS OF NODES NOT ON NODELIST
       JTNODE=0
       IF(NODET) 2036,2035,2036
2036   JTNODE=2
       DO 2030 LTNODES=1,20
       IF(I-NODELIST(LTNODES)) 2030,2031,2030
2031   JTNODE=0
2030   CONTINUE
2035   S=VMINI(I)
       R=VMINR(I)
       ANGLE=ATAN(S,R)*C360/C2PI
       VMN=RMSF(R,S)
       BLEM=VI(I,LAST)
       VIK=BLEM-S
       PRO=VR(I,LAST)
       VRK=PRO-R
       C=ATAN(BLEM,PRO)*C360/C2PI
       PHD=PHASEDIF(C,ANGLE)
       B=PHD/DP
       VMX=RMSF(PRO,BLEM)
       D=VMX-VMN
       R=D/DP
       IF(IFLAG(4)+IFLAG(5)+IFLAG(6)+3) 333,73,70
70     IF(I-ABS(NODET)) 874,72,874
C      *EXTREMES SEARCH*
C      J=1 INDICATES PMIN CAUSED THE LOW VOLTAGE FOR TESTNODE.
C      J=2 INDICATES PNOM CAUSED THE LOW VOLTAGE FOR TESTNODE.
C      J=3 INDICATES PMAX CAUSED THE LOW VOLTAGE FOR TESTNODE.
C      K=1 INDICATES PMIN CAUSED THE HIGH VOLTAGE FOR TESTNODE.
C      K=2 INDICATES PNOM CAUSED THE HIGH VOLTAGE FOR TESTNODE.
C      K=3 INDICATES PMAX CAUSED THE HIGH VOLTAGE FOR TESTNODE.
C      FINAL CODE IS J * 3 + K - 4, USED TO SET UP WORST CASE PARAMETERS
C      A SUCCEEDING Q INDICATES PHASE IS BEING DEALT WITH
72     J=K2
       K=K2
       JQ=K2
       KQ=K2
       S=VNOM(I)
       IF(S-VMX) 30,32,31
30     K=K3
       IF(D) 33,34,34
34     IF(S-VMN) 74,74,35
35     J=1
       GO TO 74
36     IF(S-VMN) 33,74,33
31     J=K3
32     IF(D) 36,34,35
33     K=1
74     PHS=PHNM(I)
       IF(PHS-C) 830,832,831
830    KQ=K3
       IF(PHD) 833,834,834
831    JQ=K3
832    IF(PHD) 836,834,835
833    KQ=1
76     KRAM4(N)=(K3*JQ+KQ-8)*100+(K3*J+K-8)+KRAM4(N)
       GO TO 874
834    IF(PHS-ANGLE)76,76,835
835    JQ=1
       GO TO 76
836    IF(PHS-ANGLE) 833,76,833
C      TVARR COMPUTATIONS
73     S=ABS(D)
       TVARR(I)=VRK*VRK-VIK*VIK+TVARR(I)
       PHD=ABS(PHD)
       TVARI(I)=VRK*VIK*2.+TVARI(I)
C      *PARAMETER VARIATION OUTPUTS*
C      SKIP TO END IF DIFFERENTIAL FLAG IS SET TO -1
       IF(IFLAG(2)-JTNODE) 75,2026,2026
C      CHECK FLAG 10 FOR AN AMPLITUDE OR PHASE OUTPUT
2026   IF(IFLAG(10)) 2027,333,2028
C      AMPLITUDE OUTPUT
2027   WRITE IIO,2019,I,R,VMN,VNOM(I),VMX,S
2019   FORMAT(I3,1X,4(2X,1PE11.4),3X,E11.4,/)
       GO TO 75
C      PHASE OUTPUT
2028   WRITE IIO,2020,I,B,ANGLE,PHNM(I),C,PHD
2020   FORMAT(I3,3X,1PE11.4,4X,0PF7.2,2(6X,F7.2),7X,F7.2/)
       GO TO 75
C      SKIP TO END IF PARAMETER VARIATION FLAG IS SET TO -1
874    IF(IFLAG(4)-JTNODE) 75,2029,2029
C      CHECK FLAG 10 FOR AN AMPLITUDE OR PHASE OUTPUT
2029   IF(IFLAG(10)) 2016,333,2017
C      AMPLITUDE OUTPUT
2016   WRITE IIO,117,I,R,VMN,VNOM(I),VMX
117    FORMAT(I3,3X,1PE11.4,2X,E11.4,2(3X,E11.4)/)
       GO TO 75
C      PHASE OUTPUT
2017   WRITE IIO,2032,I,B,ANGLE,PHNM(I),C
2032   FORMAT(I3,3X,1PE11.4,4X,0PF7.2,2(7X,F7.2)/)
75     CONTINUE
       GO TO 58
C      *INITIALIZATION FOR PARTIALS COMPUTATIONS*
77     LPRT=1
       M=N-1
C      DP IS ONE STANDARD DEVIATION -- SIGMA
       DP=DP/6.
       PV=PNAME(N)
       IF(IFLAG(2)) 2025,2101,2023
C      NEXT STATEMENT SUPPRESSES REPEATED HEADINGS
2023   IFLAG(2)=0
       IF(IFLAG(10)) 2021,333,2022
2021   WRITE IIO,2024
2024   FORMAT(/18X,$*       N  O  D  E     V  O  L  T  A  G  E  S$
+      7X,$*$//
+      $NODE   PARTIAL$,6X,$PARAMETER$,4X,$PARAMETER$,4X,$PARAMETER$,5X,$EXPECTED$/
+      6X,$DERIVATIVE    DECREASED$,17X,$INCREASED     DEVIATION$/
+      $REF.    DV/DP$7X$1/2 SIGMA     NOMINAL     $
+      $1/2 SIGMA   (SIGMA*DV/DP)$/
+      $----$,4(2X,11($-$)),2X,13($-$)/)
       GO TO 2101
2022   WRITE IIO,2018
2018   FORMAT(18X,$*$,6X,$N  O  D  E     P  H  A  S  E  S$15X,$*$,//
+      $NODE   PARTIAL$,6X,$PARAMETER$,4X,$PARAMETER$,4X,$PARAMETER$,5X,$EXPECTED$/
+      6X,$DERIVATIVE    DECREASED$,17X,$INCREASED     DEVIATION$/
+      $REF.   DPHA/DPAR$4X$1/2 SIGMA     NOMINAL     $
+      $1/2 SIGMA   (SIGMA*DV/DP)$/
+      $----$,4(2X,11($-$)),2X,13($-$)/)
2101   WRITE IIO,2100,PV,DP
2100   FORMAT(/A5,1X,$(SIGMA=$1PE11.4,$)$/)
2025   PM=(PMX+PMN-DP)/2.
       P(N)=PM
C      P(N) DECREASED BY SIGMA/2.  SET UP EQU AND SOLVE
       GO TO 61
82     IF(IFLAG(5)+IFLAG(6)+2) 333,140,2165
2165   DO 2160 JLOHI=0,1
       IF(IFLAG(5+JLOHI)) 2160,83,83
83     IF(IFLAG(7)) 2080,333,2081      ;C  ENTRY POINT
2081   DO 2115 I=1,LIMBS
       IF(IFF(PMIN(I),PMAX(I),9)) 2116,2115,2116
2115   CONTINUE
       GO TO 2080
2116   WRITE IIO,2079
2079   FORMAT(/$PARAMETER SETTINGS FOR $)
       IF(JLOHI) 333,2121,2091
2121   WRITE IIO,116
       GO TO 87
116    FORMAT($LOW EXTREME $)
118    FORMAT(//$PARAMETER  SETTING     VALUE$/
+      $---------  -------  -----------$/)
119    FORMAT($HIGH EXTREME $)
2091   WRITE IIO,119
87     IF(IFLAG(8)) 821,333,822
821    WRITE IIO,801
801    FORMAT($VOLTAGE$)
       GO TO 823
822    WRITE IIO,111
111    FORMAT($PHASE$)
823    WRITE IIO,118
C      *WORST CASE PARAMETER OUTPUT*
2080   DO 468 I=1,LIMBS
       ITEM0=KRAM4(I)
       CALL ITEM
       IF(IFLAG(8)) 898,333,899
898    LOHI=ITEM3
       M=ITEM2
       N=K4
       GO TO 890
899    LOHI=ITEM2
       M=K4
       N=K4
890    IF(JLOHI) 333,89,90
89     LOHI=LOHI/K3+K3
       IF(IFLAG(6)) 90,449,449
90     KRAM4(I)=KRAM(ITEM1,M,N)
C      REINITIALIZE THE R. H. ARGUMENT OF KRAM4 TO 4 (WC CODE).
C      SET UP EQU FOR WORST CASE VALUES
449    IF(LOHI)44902,44902,44901
44901  IF(LOHI-7)44903,44903,44902
44902  TYPE 44904
44904  FORMAT(/$RELIABLE SOLUTION BEYOND PROGRAM CAPABILITY$/)
       GO TO 40
44903  GO TO (462,463,461,462,463,461,462),LOHI
461    PMN=PMIN(I)
       K=3HMIN
       GO TO 464
462    PMN=PNOM(I)
       K=3HNOM
       GO TO 464
463    PMN=PMAX(I)
       K=3HMAX
464    P(I)=PMN
       IF(IFLAG(7)) 468,333,2082
C      SKIP OUTPUT IF PARAMETER ONLY HAS NOMINAL VALUE
2082   IF(IFF(PMIN(I),PMAX(I),9)) 2114,468,2114
2114   WRITE IIO,122,PNAME(I),K,PMN
122    FORMAT(3X,A5,5X,A3,4X,1PE11.4/)
468    CONTINUE
       WRITE IIO,2094
       IF(JLOHI) 333,2083,2084
2084   WRITE IIO,119
       GO TO 2085
2083   WRITE IIO,116
2085   IF(IFLAG(8)) 2087,333,2086
2086   WRITE IIO,111
       GO TO 2161
2087   WRITE IIO,801
       GO TO 2161
2161   CALL EQU
       CALL SOLVE
       PMN=VI(NODET,LAST)
       PMX=VR(NODET,LAST)
       ANGLE=ATAN(PMN,PMX)*C360/C2PI
       PV=SQRT(PMN*PMN+PMX*PMX)
2089   IF(IFLAG(8)) 2106,333,2110
2110   WRITE IIO,2107,ANGLE,PV
2107   FORMAT($ =$F7.2$ DEGREES (AT$1PE11.4$   VOLTS)$/)
       GO TO 2160
2106   WRITE IIO,2108,PV,ANGLE
2108   FORMAT($ =$1PE11.4$   VOLTS (AT$0PF7.2$ DEGREES)$/)
2160   CONTINUE
       GO TO 140
C      *** STATISTICAL ANALYSIS SECTION ***
C
92     IF(IFLAG(2)+IFLAG(4)+2) 333,2057,140
C      CHECK TO SEE IF A STATISTICAL ANALYSIS HAS BEEN SPECIFIED
2057   IF(IFLAG(3)) 82,2070,2071
2071   IFLAG(3)=0
       WRITE IIO,2072
2072   FORMAT(/$NODE   S I G M A   MEAN-3SIGMA    M E A N$
+      $    MEAN+3SIGMA    NOMINAL$/
+      $----$,5(2X,11($-$))/)
C      *SUMMARY OUTPUTS*
2070   DO 65 I=1, LIMBS
C      MEANVOLTAGE COMPUTATION.
65     P(I)=(PMIN(I) + PMAX(I))/2
       CALL EQU
       CALL SOLVE
       CALL NPG
       DO 94 I=1, IO
       DO 2077 LPR=1,20
C      IF NODELIST IS EMPTY, OUTPUT ALL NODES
       IF(NODELIST(1)) 333,2078,2096
2096   IF(I-NODELIST(LPR)) 2077,2078,2077
2077   CONTINUE
       GO TO 94
2078   S=VI(I,LAST)
       R=VR(I,LAST)
       VIK=TVARI(I)
       VRK=TVARR(I)
C
C     TOTAL DEVIATION CALCULATIONS
       PMN=SQRT(RMSF(VRK,VIK))
       PHD=ATAN(VIK,VRK)/2
C
C     NOMINAL - 3 SIGMA CALCULATIONS
       SIGMAR=R-3*PMN*COS(PHD)
       SIGMAI=S-3*PMN*SIN(PHD)
       D=RMSF(SIGMAR,SIGMAI)
       PN=ATAN(SIGMAI,SIGMAR)*C360/C2PI
C
C     NOMINAL + 3 SIGMA CALCULATIONS
       SIGMAR=R+3*PMN*COS(PHD)
       SIGMAI=S+3*PMN*SIN(PHD)
       PV=RMSF(SIGMAR,SIGMAI)
       PMX=ATAN(SIGMAI,SIGMAR)*C360/C2PI
C
C     NOMINAL SOLUTION IN POLAR FORM
       B=ATAN(S,R)*C360/C2PI
       R=RMSF(R,S)
C
C     DEVIATION IN POLAR FORM
       S=PMN
       PHD=PHD*C360/C2PI
C
       IF(IFLAG(10)) 2073,333,2074
2073   WRITE IIO,2075,I,S,D,R,PV,VNOM(I)
2075   FORMAT(I3,1X,5(2X,1PE11.4)/)
       GO TO 94
2074   WRITE IIO,2076,I,PHD,PN,B,PMX,PHNM(I)
2076   FORMAT(I3,5XF7.2,4(6XF7.2)/)
94     CONTINUE
       GO TO 140
C
123   FORMAT(I2,5(F9.3,I5)/)
C
C      *GENERAL ERROR PRINTOUT*
333    WRITE IIO,334
       GO TO 40
334    FORMAT(/$PROGRAM DATA ERROR$/
+      $ SAVE CIRCUIT & CALL DDI IF YOU NEED ASSISTANCE$//)
C      INTERMEDIATE PARAMETER VARIATION
427    P(INT)=PNOM(INT)
422    INT=INT+1                  ;C  ENTRY POINT
       IF(INT-LIMBS) 424,424,423
423    INT=-1
       GO TO 520
424    ITEM0=KRAM2(INT)
       CALL ITEM
       IF(ITEM2) 333,422,425
425    PN=PMIN(INT)
       PM=PMAX(INT)
       DP=ITEM2+1
       DP=(PM-PN)/DP
       IF(DP) 448,422,448
448    WRITE IIO, 428, INT, PNAME(INT)
429    P(INT)=PN
428    FORMAT($* * * * PARAMETER BEING INCREMENTED$,I4,1H,A6//)
       WRITE IIO, 459, PNAME(INT), PN
459    FORMAT(//A6,2H= ,1PE12.5/)
       GO TO 91
426    PN=PN+DP                   ;C  ENTRY POINT
       IF(ABS(PN)-ABS(PM)) 429,429,427
C
C
C      PROGRAM DEPARTURE POINT
40     WRITE IIO,2094                  ;C  ENTRY POINT
2094   FORMAT(/)
       LFR=0
       DCPS=0
       CLOSE
       CALL RSUB
4440   CALL ARM
       CALL BRS(29,0,0,-1)       ;C    CLEARS OUTPUT BUFFER
       GO TO 40
       END
      FUNCTION ATAN(B,A)
C      RETURNS AN ANGLE FROM -180 TO +180 DEGREES, LIKE CAL
      PI=3.1415926535897
      IF(A) 5,10,5
10    IF(B) 11,12,13
11    ATAN=-PI/2
      RETURN
12    ATAN=0
      RETURN
13    ATAN=PI/2
      RETURN
5     Z=B/A
20    IF(ABS(Z)-.41421356) 50,22,22
22    IF(ABS(Z)-2.41421356) 24,24,60
24    IF(Z) 26,30,30
26    CONST=-PI/4
      T=(A+B)/(A-B)
      GO TO 70
30    CONST=PI/4
      T=(B-A)/(B+A)
      GO TO 70
50    CONST=0
      T=Z
      GO TO 70
60    T=-1/Z
      IF(Z) 62,62,64
62    CONST=-PI/2
      GO TO 70
64    CONST=PI/2
70    T2=T*T
      IF(A) 72,90,90
72    IF(B) 76,74,74
74    CONST=CONST+PI
      GO TO 90
76    CONST=CONST-PI
90    ATAN=T*(.999999999996+T2*(-.0155853710182-.585315135072/
     +(T2+2.10055408717-.419003002283/(T2+1.62102383363))))+CONST
94    RETURN
      END
       FUNCTION PHASEDIF(A,B)
C      FUNCTION FINDS THE DIFFERENCE BETWEEN 2 ANGLES & ADDS OR
C      SUBTRACTS 360 DEGREES TO IT, TRYING TO PRODUCE THE SMALLEST
C      ANGULAR DIFFERENCE WHICH, DUE TO A DISCONTINUITY AT -180
C      DEGREES, IS PRESUMABLY THE CORRECT ANSWER.
C
C      CREATE A TEST DIFFERENCE, TDIF
       TDIF=A-B
       IF(ABS(TDIF)-ABS(TDIF-360)) 10,10,20
20     PHASEDIF=TDIF-360
       RETURN
10     IF(ABS(TDIF)-ABS(TDIF+360)) 30,30,40
30     PHASEDIF=TDIF
       RETURN
40     PHASEDIF=TDIF+360
       RETURN
       END
C
C
C
       FUNCTION RMSF(A,B)
       RMSF=SQRT(A*A+B*B)
       RETURN
       END
C
C
C
C      GAUSS-JORDAN METHOD WITH PIVOTAL CONDENSATION AND ELEMENT CHECK.
C      REAL PART OF THE SOLUTIONS RETURNED VIA THE LAST COLUMN OF YR
C      IMAGINARY PART IS RETURNED VIA THE LAST COLUMN OF YI
C      DELR AND DELI ARE THE REAL AND IMAGINARY VALUES OF THE DETERMINANT
C      CONSTANTS PLACED IN COMMON FOR MAXIMUM USE OF MEMORY
       SUBROUTINE SOLVE
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,PHNM,NET,ICCCCC,FLAG,IDDDDD,KFLAG
       COMMON RR,RI,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZRO,FREQ,OMEGA,DW,LFR
       COMMON K,M,I,J,C2PI,C360
       COMMON C180,C90,C0,C1,K0,K2,K4,NVS,W,SR,SI
       COMMON L,J PRIME,B,C,DT,ANGLE,R,LK,NK,S,KIND,IM,INDX
       COMMON IO,K3,DELR,DELI,LAST,NT,D,PN,PM,NI,FPD
       COMMON FFPPD,VNOM,VMINR,VMINI,TVARI,TVARR
       COMMON IDUMMY,P,YI,YR
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NAME(30),P(99),VNOM(25),VMINR(25),VMINI(25),TVARI(25),TVARR(25)
       DIMENSION IDUMMY(517),NET(25),YR(25,26),YI(25,26),PHNM(25),ICCCCC(24),IDDDDD(6)
       DIMENSION IFLAG(20),FREQUENCIES(20),NODELIST(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1))
       EQUIVALENCE (IDUMMY(291),FREQUENCIES(1)),(IDUMMY(330),NAME(1))
       ICONTRLF=102*256*256
       TYPE 2150, ICONTRLF
2150   FORMAT(A1)
       L=LAST
       IIO=1
       I=1
       DELR=1
       DELI=C0
1      IF(NODES-I) 22,2,2
2      J=I
       RR=YR(J,J)
       SR=RR
       RI=YI(J,J)
       SI=RI
3      PIVOT=SR*SR+SI*SI
       M=I
4      I=I+1
       IF(I-NODES) 23,23,5
5      IF(M-J) 5,8,6
6      DELR=-DELR
       DELI=-DELI
       K=LAST
7      RR=YR(M,K)
       RI=YI(M,K)
       YR(M,K)=YR(J,K)
       YI(M,K)=YI(J,K)
       YR(J,K)=RR
       YI(J,K)=RI
       K=K-1
       IF(K-J) 9,7,7
8      IF(PIVOT) 9,21,9
9      DR=RR*DELR-RI*DELI
       DELI=DELR*RI+DELI*RR
       DELR=DR
       I=J+1
10     DR=YR(J,L)
       DI=YI(J,L)
       IF(DI*DI+DR*DR) 11,12,11
11     YR(J,L)=(DR*RR+DI*RI)/PIVOT
       YI(J,L)=(RR*DI-DR*RI)/PIVOT
12     L=L-1
       IF(L-I) 13,10,10
13     L=1
14     IF(L-J) 15,20,15
15     RR=YR(L,J)
       RI=YI(L,J)
       IF(RI*RI+RR*RR) 16,20,16
16     K=J
17     K=K+1
       DR=YR(J,K)
       DI=YI(J,K)
       IF(DI*DI+DR*DR) 18,19,18
18     YR(L,K)=YR(L,K)-DR*RR+DI*RI
       YI(L,K)=YI(L,K)-RR*DI-DR*RI
19     IF(K-NODES) 17,17,20
20     L=L+1
       IF(L-NODES) 14,14,1
21     WRITE IIO,24, J
       MTRX=-J
22     RETURN
23     SR=YR(I,J)
       SI=YI(I,J)
       IF(SI*SI+SR*SR-PIVOT) 4,4,3
24     FORMAT(/50H INSOLUBLE SYSTEM, NONSEQUENTIAL NODES PERHAPS ROW,I4/)
       END
C      SUBROUTINE UNPACKS THE CRAMMED WORDS.
C      ITEM0 IS THE ARGUMENT TO THE SUBROUTINE.  ITEM1 IS THE VALUE OF
C      I.  ITEM2 IS THE VALUE OF J.  ITEM3 IS THE VALUE OF K.  WHERE
C      ITEM0=I*10000+J*100+K -- THE CRAMMED WORD.
C      ALL ARGUMENTS ARE SUPPLIED VIA COMMON STORAGE.
       SUBROUTINE ITEM
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,PHNM,NET,ICCCCC,FLAG,IDDDDD,KFLAG
       COMMON PRO,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZRO,FREQ,OMEGA,DCPS,LFR
       COMMON ITEM0,ITEM1,ITEM2,ITEM3,C2PI,C360
       COMMON C180,C90,C0,C1,K0,K2,K4,NVS,W,VMN,VMX
       COMMON I,J,B,C,DT,ANGLE,R,LK,NK,S,KIND,IM,INDX
       COMMON IO,K3,DELR,DELI,LAST,NT,D,PN,PM,NI,FPD
       COMMON FFPPD,VNOM,VMINR,VMINI,TVARI,TVARR
       COMMON IDUMMY,P,VI,VR
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NAME(30),P(99),VNOM(25),VMINR(25),VMINI(25),TVARI(25),TVARR(25)
       DIMENSION IDUMMY(517),NET(25),VR(25,26),VI(25,26),PHNM(25),ICCCCC(24),IDDDDD(6)
       DIMENSION IFLAG(20),FREQUENCIES(20),NODELIST(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1))
       EQUIVALENCE (IDUMMY(291),FREQUENCIES(1)),(IDUMMY(330),NAME(1))
       ITEM2=ITEM0/100
       ITEM3=ITEM2*100
       ITEM3=ITEM0-ITEM3
       ITEM1=ITEM2/100
       ITEM0=ITEM1*100
       ITEM2=ITEM2-ITEM0
       RETURN
       END
       FUNCTION KRAM(I,J,K)
       KRAM=(I*100+J)*100+K
       RETURN
       END
C      SETS UP THE COMPLEX ADMITTANCE MATRIX FROM THE PARAMETER DATA.
C      THE MATRIX REPRESENTS THE NODE-VOLTAGE FORM OF CIRCUIT EQUATIONS.
C      EQUATIONS FOR VOLTAGE SOURCES ARE WRITTEN LAST FROM THE
C      NET ARRAY THAT WAS SET UP IN THE MAIN PROGRAM.
C      ALL DATA NEEDED BY THIS SUBROUTINE IS SUPPLIED VIA COMMON.
C      CONSTANTS WERE PLACED IN COMMON FOR MAXIMUM USE OF MEMORY.
       SUBROUTINE EQU
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,PHNM,NET,ICCCCC,FLAG,IDDDDD,KFLAG
       COMMON S,DINDX,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZRO,FREQ,OMEGA,DW,LFR
       COMMON ITEM0,ITEM1,ITEM2,ITEM3,C2PI,C360
       COMMON C180,C90,C0,C1,K0,K2,K4,NVS,W,R,D
       COMMON I,J,TR,TI,DT,PT,THETA,IJ,NK,WT,KIND,IM,INDX
       COMMON IO,K3,DELR,DELI,LAST,NT,K,M,PN,PM,NI,FPD
       COMMON FFPPD,VNOM,VMINR,VMINI,TVARI,TVARR
       COMMON IDUMMY,P,YI,YR
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NAME(30),P(99),VNOM(25),VMINR(25),VMINI(25),TVARI(25),TVARR(25)
       DIMENSION IDUMMY(517),NET(25),YR(25,26),YI(25,26),PHNM(25),ICCCCC(24),IDDDDD(6)
       DIMENSION IFLAG(20),FREQUENCIES(20),NODELIST(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1))
       EQUIVALENCE (IDUMMY(291),FREQUENCIES(1)),(IDUMMY(330),NAME(1))
       IIO=1
       C1=1.
C      ZERO THE ADMITTANCE MATRIX
       DO 21 I=1,NODES
       DO 21 J=1,NODES+1
       YI(I,J)=0.
21     YR(I,J)=0.
       K=1
       NK=0
22     ITEM0=KRAM1(K)
       CALL ITEM
       IF(ITEM2-ITEM3) 425,424,425
424    IF(ITEM1) 333,425,333
425    IF(ITEM2-NODES) 426,426,333
426    IF(ITEM3-NODES) 427,427,333
427    KIND=ITEM1
C      IF PARAMETER IS A VOLTAGE SOURCE, TYPE = 11, 12, OR 13.
       IF(KIND-11) 31,23,23
23     K=K+1
       IF(K-LIMBS) 22,22,24
24     NK=NVS+1
26     NK=NK-1
       IF(NK) 333,57,27
27     ITEM0=NET(NK)
       CALL ITEM
       NN=ITEM3
       K=ITEM2
       ITEM0=KRAM1(K)
       CALL ITEM
C      TYPE OF VOLTAGE SOURCE (KIND).
       KIND=ITEM1
       IF(NN) 333,31,28
28     IF(NN-ITEM2) 29,31,29
29     ITEM3=ITEM2
       ITEM2=NN
       S=-C1
30     J=ITEM3
       NT=J
       I=ITEM2
C      I MUST BE IN THE NON-ZERO NODE INTERCONNECTION.
       IF(I) 333,34,35
31     S=C1
       IF(KIND) 333,23,30
3      D=D*W
60     YI(I,I)=YI(I,I)+D
C      IF PARAMETER IS GROUNDED, J=0.
       IF(J) 333,23,61
61     YI(I,J)=YI(I,J)-D
       GO TO 33
4      D=-D*W
1      IF(D) 32,333,32
32     D=C1/D
       IF(KIND-K4) 2,60,333
2      YR(I,I)=YR(I,I)+D
C      IF PARAMETER IS GROUNDED, J=0.
       IF(J) 333,23,1234
1234   YR(I,J)=YR(I,J)-D
33     IF(I-NT) 34,23,34
34     J=I
       I=NT
35     D=P(K)*S
       ITEM0=KRAM2(K)
       CALL ITEM
       IM=ITEM1
       INDX=ITEM3
C      BRANCH ACCORDING TO THE PARAMETER TYPE CODE.
       GO TO (1,2,3,4,333,678,678,678,333,333,36,36,36),KIND
C      IF PARAMETER IS GROUNDED, J=0.
36     IF(J) 333,678,37
C      ADD THE I ROW TO THE J ROW FOR UNGROUNDED VOLTAGE SOURCES.
37     DO 38 L=1, LAST
       YR(J,L)=YR(J,L)+YR(I,L)
38     YI(J,L)=YI(J,L)+YI(I,L)
678    IF(I-NT) 39,40,39
39     D=-D
40     ITEM0=KRAM1(INDX)
       CALL ITEM
       KINDA=14-KIND
       GO TO (11,11,11,333,333,8,7,6),KINDA
C      IF SOURCE IS IMAGINARY, IM=1.
6      IF(IM) 63,62,63
62     YR(I,LAST)=YR(I,LAST)+D
       GO TO 48
63     YI(I,LAST)=YI(I,LAST)+D
C      WHEN NK IS A POSITIVE INTEGER VOLTAGE SOURCES ARE BEING WRITTEN IN
48     IF(NK) 48,41,26
C      IF A PARAMETER IS GROUNDED, J=0.
41     IF(J) 333,23,33
7      DINDX=P(INDX)
       IF(ITEM1) 333,23,206
206    GO TO (51,52,53,54,333,510,510,510,333,333,333,333,333),ITEM1
510    IF(K-INDX) 701,333,701
701    D=D*DINDX
       LK=ITEM1-7
       ITEM0=KRAM2(INDX)
       CALL ITEM
       INDX=ITEM3
       IF(ITEM1) 333,88,70
70     IF(IM) 333,77,75
75     IM=-1
       D=-D
77     IM=IM+1
88     IF(LK) 6,78,78
78     ITEM0=KRAM1(INDX)
       CALL ITEM
       IF(LK) 333,7,8
53     IF(IM) 333,43,42
C      IF SOURCE IS IMAGINARY, IM=1
54     IF(IM) 333,42,43
42     DINDX=-DINDX
43     IM=1-IM
       DINDX=W*DINDX
       IF(ITEM1-K4) 52,51,333
51     IF(DINDX) 44,333,44
44     DINDX=C1/DINDX
52     D=D*DINDX
813    IF(ITEM2) 333,47,46
45     D=-D
       ITEM2=ITEM3
       ITEM3=K0
C      IF SOURCE IS IMAGINARY, IM=1.
46     IF(IM) 65,64,65
64     YR(I,ITEM2)=YR(I,ITEM2)-D
       GO TO 47
65     YI(I,ITEM2)=YI(I,ITEM2)-D
47     IF(ITEM3) 333,48,45
C      ZERO THE I ROW FOR THE VOLTAGE SOURCES
11     DO 49 L=1,LAST
       YR(I,L)=C0
49     YI(I,L)=C0
       YR(I,I)=C1
C      IF PARAMETER IS GROUNDED, J=0.
       IF(J) 333,55,69
69     YR(I,J)=-C1
55     IF(KINDA-K2) 8,7,56
8      IF(ITEM1-6) 813,400,400
400    D=-D
       GO TO 813
C      IF SOURCE IS IMAGINARY, IM=1.
56     IF(IM) 72,71,72
71     YR(I,LAST)=D
       GO TO 26
72     YI(I,LAST)=D
       GO TO 26
333    WRITE IIO,3333,K
       MTRX=-K
57     IF(MTRX) 334,58,334
C      MATRIX IS DUMPED IF AN ERROR OCCURS OR INDICATED ON THE CONTROL CR
C      *MATRIX DUMP*
334    WRITE IIO,59, ((I,J,YR(I,J),YI(I,J),J=1,LAST),I=1,NODES)
58     RETURN
59     FORMAT(2I7,1P2E20.8/)
3333   FORMAT(9HPARAMETER,I4/)
       END
C      THH SPECIAL SOLUTION SUBROUTINE. IDTRM DETERMINES THE SOLUTION.
C      IDTRM
C      -----
C        0     NORMAL NODE-VOLTAGE SOLUTION -- SUBROUTINE EXITS
C        1     SYSTEM DETERMINANT -- SUBROUTINE EXITS
C        2     NEGATIVE LOOP GAIN
C        3     PHASE MARGIN
C        4     GAIN MARGIN
C        
C      CONSTANTS WERE PLACED IN COMMON FOR MAXIMUM USE OF MEMORY.
       SUBROUTINE NPG
       COMMON PNAME,PNOM,PMIN,PMAX,KRAM1,KRAM2,KRAM4,PHNM,NET,ICCCCC,FLAG,IDDDDD,KFLAG
       COMMON TT,BLEM,LIMBS,NODES,NODET,LOHI,LPRT
       COMMON MTRX,IDTRM,IPZRO,FREQ,OMEGA,DW,LFR
       COMMON ITEM0,ITEM1,ITEM2,ITEM3,C2PI,C360
       COMMON C180,C90,C0,C1,K0,K2,K4,NVS,W,VMN,VMX
       COMMON I,J,TR,TI,DT,PT,THETA,IJ,NK,WT,KIND,IM,INDX
       COMMON IO,K3,DELR,DELI,LAST,NT,D,PN,PM,NI,FPD
       COMMON FFPPD,VNOM,VMINR,VMINI,TVARI,TVARR
       COMMON IDUMMY,P,VI,VR
       DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),KRAM1(99),KRAM2(99),KRAM4(99)
       DIMENSION NAME(30),P(99),VNOM(25),VMINR(25),VMINI(25),TVARI(25),TVARR(25)
       DIMENSION IDUMMY(517),NET(25),VR(25,26),VI(25,26),PHNM(25),ICCCCC(24),IDDDDD(6)
       DIMENSION IFLAG(20),FREQUENCIES(20),NODELIST(20)
       EQUIVALENCE (IDUMMY(250),IFLAG(1)),(IDUMMY(270),NODELIST(1))
       EQUIVALENCE (IDUMMY(291),FREQUENCIES(1)),(IDUMMY(330),NAME(1))
       IIO=1
       C90=90.
       C180=90.+C90
       C360=C180+C180
       IJ=K0
100    TR=DELR
       TI=DELI
C      STORE PREVIOUSLY COMPUTED DETERMINANT
       IF(IDTRM-1) 99,1,3
1      IO=IDTRM
2      VR(1,LAST)=TR
       VI(1,LAST)=TI
       VI(K2,LAST)=C0
99     RETURN
C      THE NEGATIVE LOOP GAIN IS COMPUTED WITH RESPECT TO IPZRO
3      ITEM0=KRAM1(IPZRO)
       CALL ITEM
       KI=ITEM2
       KT=ITEM3
       PT=P(IPZRO)
       KK=ITEM1
       IF(KK-11) 40,41,41
41     P(IPZRO)=C0
       GO TO 42
40     KRAM1(IPZRO)=KRAM(K0,KI,KT)
42     CALL EQU
       CALL SOLVE
       P(IPZRO)=PT
       KRAM1(IPZRO)=KRAM(KK,KI,KT)
       PT=DELR*DELR+DELI*DELI
       TT=(TR*DELR+TI*DELI)/PT
       TI=(TI*DELR-TR*DELI)/PT
       TR=TT-C1
       THETA=ATAN(TI,TR)
       IO=K3
       IF(THETA) 6,5,5
6      THETA=THETA+C360
5      IF(IDTRM-K3) 4,7,11
4      VR(K2,LAST)=THETA
       VR(K3,LAST)=C1-TR
       VI(K3,LAST)=TI
       GO TO 2
7      IF(IJ) 104,104,30
30     VMX=THETA-DT
       BLEM=THETA-C180
8      VMN=WT-W
       PT=BLEM*VMN/VMX
201    IF(IJ-40) 101,101,333
101    IF(ABS(PT/W)-5E-9) 102,102,97
104    PT=DW*C2PI
97     IJ=IJ+1
       IF(IDTRM-K4) 95,96,96
96     DT=TT
       GO TO 9
95     DT=THETA
9      WT=W
       W=W+PT
       CALL EQU
       CALL SOLVE
       GO TO 100
333    WRITE IIO,106
102    VR(K3,LAST)=TR
       VI(K3,LAST)=TI
       TI=C0
       VR(K2,LAST)=W/C2PI
10     IF(IDTRM-K4) 11,103,333
11     TT=C1/SQRT(TR*TR+TI*TI)
       IF(IDTRM-K4) 20,12,12
12     IF(IJ) 104,104,13
13     VMX=TT-DT
       BLEM=TT-C1
       GO TO 8
103    TR=THETA-C180
       GO TO 2
20     TR=TT
       GO TO 2
106    FORMAT(13HVOID SOLUTION/)
       END
D@

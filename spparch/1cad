1CAD ** FICHE/FRAME BREAK *****
SNCAD7
NCAD7  IDENT   7-9-76   NO TAPE VERSION



       BRU BEGIN; BRS 10
VERMSG ASC     '$1CAD VERSION 7.00$/'

MSG    POPD    101B5,2
       LDB =1; EAX* 0; COPY XA,BX; ETR =37777B; LDB =-1
       BRS 34; BRR 0
BEGIN  STA CIN; BRS 71; BRU *+2; BRU B1
       BRS 39; SKA =14B6; BRU *+2; BRU ERR
       LRSH 2; ETR =377B; SKE =0; BRU ERR1
B1     MSG VERMSG
       BRS 143; BRU NOMAP (MAP NOT SET)
       LDA =1; CAX; BRS 141 (GFD USER 1 TO FORCE NEW DIR.)
       LDX =3; BRS 141; SKG =3; BRU B2; MSG M2; BRS 10
B2     BRS 113; BRM CKMAP; BRM MFDT
S1     LDA =PBUF; STA FDP
S1B    MIN UNO; LDA UNO; SKG =417B; SKG =377B; BRU *+2; BRU S1B
       SKG =3777B; BRU *+2; BRU EOJ; BRM CKON; BRU S1
       BRM BUSY (SET GROUP BUSY)
       BRM RDIR; LDA PBUF; SKE =0; BRU S1C; BRM UNBUSY (FREE GROUP); BRU S1
S1C    LDA POFPT1
       SKE =0; BRU S1A; BRM CDIR; LDA =PBUF; STA WFDP; LDA UNO
       BRM WDIR; BRM UNBUSY (FREE GROUP); BRU S1
S1A    SKR PRMSW; BRU *-1; STA OGRP1; BRM CKPTRS; LDA =PBUF; STA FDP
       BRU *+2
S2     STA OGRP1; BRM CDIR; LDA OFPT1; SUB EFPOS; SUB =1
       STA SPCNT (NO OF WORDS LEFT FOR FILES IN THIS DIR)
S2B    LDA =OBUF; STA FDP; LDA OGRP1
S2A    BRM RDIR; LDA OFPTR; SKE UNO; BRU PTRERR (DOES NOT BELONG UNO)
       BRM CLDIR; LDA OGRP1; BRM BRS95 (RELEASE GROUP)
       MIN RELCNT; LDX FDP
S3     LDA 0,2; SKG =0; BRU S7 (NO MORE FILES THIS GRP)
       STX OBPOS; EAX 3,2; EAX 1,2; SKN 0,2; BRU *-2; EAX 1,2
       CXA; ETR =37777B; SUB OBPOS (GET ENTRY SIZE)
       SKG SPCNT; BRU *+2; BRU S5 (NO ROOM IN THIS DIR)
       STA ENTSIZ
       LDX OBPOS
S4     SKR ENTSIZ; BRU *+2; BRU S3
       LDA 0,2; LDX EFPOS; STA 0,2; SKR SPCNT; BRU *+2
       HLT 0 (SOMETHING VERY WRONG)
       EAX 1,2; STX EFPOS; LDX OBPOS; EAX 1,2; STX OBPOS; BRU S4
S5     LDX EFPOS; LDA =-1; STA 0,2; CLA; BRM BRS95 (GET GRP NO)
       MIN GETCNT
       STA NGRP; STA POFPT1; SKN PRMSW; BRU *+3; STA POFPT; BRU S6
       LDA UNO; STA POFPT
S6     LDA =PBUF; STA FDP; BRM CDIR; LDA =PBUF; STA WFDP; LDA UNO
       SKN PRMSW; LDA OGRP; BRM WDIR; LDX =-128; CLA
       STA PBUF+128,2; BRX *-1; LDA =-2; STA PBUF
       LDA =POFPT; SUB =PBUF; SUB =1; STA SPCNT; LDA NGRP; STA OGRP
       LDX =PBUF; STX EFPOS; LDX OBPOS; BRU S3

S7     LDA OFPTR1; SKG =0; BRU S8; STA OGRP1; BRU S2B

S8     LDX EFPOS; LDA =-2; STA 0,2; LDA UNO; SKN PRMSW
       BRU *+2; CLA; STA POFPT; CLA; STA POFPT1; LDA =PBUF
       STA FDP; BRM CDIR; LDA =PBUF; STA WFDP; LDA UNO; SKN PRMSW
       LDA OGRP; BRM WDIR; BRM UNBUSY (FREE GROUP); BRU S1

M1     ASC '$MAP NOT LOGGED ON - SYSTEM WILL BE CRASHED'
       ASC '$UPON COMPLETION OF PROGRAM$/'
M2     ASC '$MORE THAN 3 USERS ON SYSTEM, RESTART WITH ON SUP, MAP AND YOURSELF'
       ASC '$ONLY.$/'
M3     ASC '$MIN. OF OPERATOR STATUS REQUIRED$/'
M4     ASC '$MAP NOT SET$/'
M5     ASC ' HAS F.D. POINTER PROBLEMS, BYPASSING  CHECK WITH 1COP$/'
M6     ASC '$$OVERFLOW DIR: /'
M7     ASC '$IS IN A CHAIN STARTED BY F.D. NO.: /'
M8     ASC '$BUT POINTS TO F.D. NO.: /'
M9     ASC '$RUN 1COP "D" OPTION UPON COMPLETION FOR DETAILS$/'
M10    ASC '$PROGRAM USABLE BY OPERATIONS PERSONNEL ONLY$/'
M11    ASC '$SYSTEM CRASHING DUE TO MAP NOT BEING LOGGED ON$/'
M12    ASC '$SYSTEM NOW SHUT$/'

FILBAD ZRO; LDA 2,2; MRG =4B7; STA 2,2; BRR FILBAD
GADR   ZRO; RSH 23; DIV =64; SKG =3; BRU GADR1; SKG =35
       BRU *+3; SUB =16; BRU GADR1; SUB =4; XAB; SUB =100B; XAB
GADR1  STB T1; CLB; LSH 12; ADD T1; LSH 1; ADD =200B; ABC; BRR GADR

RDIR   ZRO; STA GRP; BRM GADR; STB RDISC (FOR POSSIBLE WRITE)
       LDA FDP; LDX =128; BRS 124; BRR RDIR
WDIR   ZRO; STA WGRP; BRM GADR; LDA WFDP; LDX =128; BRS 125
       CLA; STA PRMSW; BRR WDIR
GRP    ZRO
WGRP   ZRO
T1     ZRO
CDIR   ZRO; LDA FDP; CAX; ADD =123; STA LASPOS; ADD =1; STA OFPT1
       LDA 0,2; SKG =0; BRU CD3
CD2    LDA 2,2; SKA =2B7; BRU *+2; BRU CD1
       LDA 1,2; ETR =37777777B (TAKE OFF EXTRA CHG FLG)
       STA 1,2
       LDA 3,2; SKE =0; BRU *+2; BRM FILBAD
CD1    EAX 3,2
CD1A   EAX 1,2; SKN 0,2; BRU *+2; BRU CD1C; LDA 0,2; SKE =0; BRU CD1A
       LDA =432B5; STA 0,2 (MAKE MINUS WORD TO END FILE NAME)
       CXA; ETR =37777B; ADD =1; SKG LASPOS; BRU CD1AA
       LDA LASPOS; SUB =1; CXA; LDA =432B5; STA 0,2 (MOVE FILE NAME END BACK)
CD1AA  EAX 1,2; LDA =-2; STA 0,2 (MAKE FD END FLAG); BRU CD3
CD1C   CXA; ETR =37777B; SKE LASPOS
       BRU *+2; BRU CD3; SKG LASPOS; BRU CD1B; LDA =LASPOS; BRU CD3
CD1B   EAX 1,2; LDA 0,2; SKG =-1; SKG =-3; BRU *+2; BRU CD3
       SKE =0; BRU CD5; LDA =-2; STA 0,2 (MAKE END FLAG)
CD3    STX EFPOS
CD4    EAX 1,2; CXA; ETR =37777B; SKG LASPOS; BRU *+2; BRR CDIR
       CLA; STA 0,2; BRU CD4
CD5    CXA; ETR =37777B; SKE OFPT1; BRU CD6; LDX LASPOS; BRU CD3
CD6    SKG OFPT1; BRU CD2; BRU CD5+4
FDP    ZRO
WFDP   ZRO
OFPT1  ZRO
LASPOS ZRO
EFPOS  ZRO
OBPOS  ZRO
ERR    MSG M3; BRS 10
ERR1   MSG M10; BRS 10
NOMAP  MSG M4; BRS 10
BRS95  ZRO; BRS 95; HLT; BRR BRS95
CIN    ZRO
PBUF   BSS 128
POFPT  EQU PBUF+124
POFPT1 EQU PBUF+125
       BSS 128
UNO    ZRO
PRMSW  ZRO
OGRP1  ZRO
OGRP   ZRO
NGRP   ZRO
TEMP   ZRO
RELCNT ZRO
GETCNT ZRO
SPCNT  ZRO
OBUF   BSS 128
OFPTR  EQU OBUF+124
OFPTR1 EQU OBUF+125
       BSS 128
ENTSIZ ZRO
CLDIR  ZRO; LDA =EMPBUF; LDX =128; LDB RDISC; BRS 125; BRR CLDIR
EMPBUF BSS 128
*CHECK USERS FILE DIRECTORY POINTER STRING BEFORE PROCESSING AND
*BY PASS IF ERRORS FOUND

CKPTRS ZRO; STA NXGRP; LDA =OBUF; STA FDP; LDA NXGRP; BRM RDIR; LDA OFPTR
       SKE UNO; BRU BPTSTG; LDA OFPTR1; SKG =0; BRR CKPTRS
       SKG =5577B; SKG =3777B; BRU BPTSTG; BRU CKPTRS+1
BPTSTG TCO =155B; LDA UNO; BRM TONO; MSG M5; BRM UNBUSY (FREE GROUP); BRU S1
NXGRP  ZRO
RDISC  ZRO
TONO   ZRO; LDB =8; LDX =1; BRS 36; BRR TONO
TDNO   ZRO; LDB =10; LDX =1; BRS 36; BRR TDNO
EOJ    LDA RELCNT; SUB GETCNT; STA TEMP; SKN TEMP; BRU EOJ2
       MSG EOJM1; LDA TEMP
EOJ1   BRM TDNO; MSG EOJM3; SKN CRASW; BRU *+2; BRU EOJ3; BRS 114; BRS 10
EOJ3   MSG M11 (CRASHING); LDA =5000; BRS 81; BRS 180
EOJ2   MSG EOJM2; LDA TEMP; BRU EOJ1
EOJM1  ASC '$$NUMBER OF GROUPS LOST: /'
EOJM2  ASC '$$NUMBER OF GROUPS GAINED: /'
EOJM3  ASC '$$END OF JOB$$/'
*ERROR ROUTINE FOR BACKPOINTERS WHICH DO NOT AGREE
*SHOULD NOT HAPPEN AS POINTERS ARE CHECKED PRIOR TO PROCESSING
PTRERR MSG M6 (OVER FLOW DIR )
       LDA OGRP1; BRM TONO
       MSG M7 (IS IN CHAIN STARTED BY)
       LDA UNO; BRM TONO
       MSG M8  (BUT POINTS TO)
       LDA OFPTR; BRM TONO
       MSG M9 (RUN 1COP D OPTION UPON COMPLTION FOR DETAILS)
       BRU S8 (WRITE OUT WHAT WE HAVE DONE SO FAR)

*CHECK TO SEE IF USER MAP LOGGED ON IF NOT SET SWITCH TO CRASH
*UPON COMPLETION

CKMAP  ZRO; CLA; BRS 159; MSG M12 (SYSTEM NOW SHUT); LDX =-10; TCO =147B
       BRX *-1
       LDA =OBUF; LDX =17; BRS 7; SUB =OBUF; STA TEMP
       LDA =OBUF; STA FDP
CKMAP1 SKR TEMP; BRU *+2; BRU CKMAP2; LDA* FDP; MIN FDP
       ETR =377777B; SKE MUUN; BRU CKMAP1; BRR CKMAP
CKMAP2 SKR CRASW; BRU *-1; MSG M11 (MAP NOT ON WILL CRASH UPON COMPLETION)
       BRR CKMAP
CRASW  ZRO
MUUN   DATA 63143B;*UUN OF MAP
BUSY   ZRO; STA T1; LDX =7; BRS 141 (MAKE BUSY); LDA T1; BRR BUSY

UNBUSY ZRO; LDX =7; LDA =7777B; BRS 141 (FREE GROUP); BRR UNBUSY
CKON   ZRO; STA T1; CAX; LDA UUNBUF,2
       LDX =5; BRS 141; BRR CKON (ON SYSTEM); LDA T1; MIN CKON
       BRR CKON (NOT ON SYSTEM)

*MAKES TABLE OF FD POINTERS USED 

MFDT  ZRO; LDA 34000B (GRAP PAGE)
       CLA; STA MBLNO; BRM RPAGE
MFDT1 LDA MBLNO; SKG =895; BRU *+2; BRR MFDT
       BRM CKPAGE; BRU MFDT2
CKPAGE ZRO; LRSH 23; DIV =128; STB MTEMP; CLB; LSH 13; ADD =320200B
       ADD MTEMP; SKG EPAGE; BRU *+2; BRM RPAGE; LDX MBLX
       BRR CKPAGE
MFDT2 LDA 0,2; SKE =0; BRU *+2; BRU NBLK; SKE =-1; BRU *+2
       BRU NBLK; SKE =-2; BRU *+2; BRU MFDT3
       STX T5
       LDA 4,2; ETR =3777B; CAB; LDA 7,2; ETR =377777B; CBX; STA UUNBUF,2
       LDX T5
MFDT3  EAX 9,2; BRU MFDT2
NBLK   LDA =64; ADM MBLX; MIN MBLNO; BRU MFDT1

RPAGE  ZRO; LDA MBLNO; LRSH 23; DIV =128; STB MTEMP; CLB; LSH 13
       ADD MTEMP; ADD =320200B; CAB; LDA =LBUF
       LDX =4000B; BRS 124; CBA; ADD =37B; STA EPAGE; EAX LBUF
       STX MBLX; BRR RPAGE
UUNBUF EQU 30000B
LBUF   EQU 34000B

MBLNO  ZRO
MTEMP  ZRO
EPAGE  ZRO
MBLX   ZRO
T5     ZRO
       END
1CAD ** FICHE/FRAME BREAK *****
SNCAD7 SYMSORT

SYM.  PG.LN. IDENT.

B1      1 14 NCAD7   B2      1 18 NCAD7   BEGIN   1 11 NCAD7   
BPTSTG  4 30 NCAD7   BRS95   4  2 NCAD7   BUSY    5 28 NCAD7   CD1     3 17 NCAD7   
CD1A    3 18 NCAD7   CD1AA   3 22 NCAD7   CD1B    3 25 NCAD7   CD1C    3 23 NCAD7   
CD2     3 13 NCAD7   CD3     3 27 NCAD7   CD4     3 28 NCAD7   CD5     3 30 NCAD7   
CD6     3 31 NCAD7   CDIR    3 11 NCAD7   CIN     4  3 NCAD7   CKMAP   5 18 NCAD7   
CKMAP1  5 22 NCAD7   CKMAP2  5 24 NCAD7   CKON    5 31 NCAD7   CKPAGE  6  2 NCAD7   
CKPTRS  4 27 NCAD7   CLDIR   4 22 NCAD7   CRASW   5 26 NCAD7   EFPOS   3 36 NCAD7   
EMPBUF  4 23 NCAD7   ENTSIZ  4 21 NCAD7   EOJ     4 35 NCAD7   EOJ1    4 37 NCAD7   
EOJ2    4 39 NCAD7   EOJ3    4 38 NCAD7   EOJM1   5  1 NCAD7   EOJM2   5  2 NCAD7   
EOJM3   5  3 NCAD7   EPAGE   6 22 NCAD7   ERR     3 38 NCAD7   ERR1    3 39 NCAD7   
FDP     3 32 NCAD7   FILBAD  2 38 NCAD7   GADR    2 39 NCAD7   GADR1   3  2 NCAD7   
GETCNT  4 15 NCAD7   GRP     3  8 NCAD7   LASPOS  3 35 NCAD7   LBUF    6 18 NCAD7   
M1      2 23 NCAD7   M10     2 34 NCAD7   M11     2 35 NCAD7   M12     2 36 NCAD7   
M2      2 25 NCAD7   M3      2 27 NCAD7   M4      2 28 NCAD7   M5      2 29 NCAD7   
M6      2 30 NCAD7   M7      2 31 NCAD7   M8      2 32 NCAD7   M9      2 33 NCAD7   
MBLNO   6 20 NCAD7   MBLX    6 23 NCAD7   MFDT    5 37 NCAD7   MFDT1   5 39 NCAD7   
MFDT2   6  5 NCAD7   MFDT3   6 10 NCAD7   MSG     1  8 NCAD7   MTEMP   6 21 NCAD7   
MUUN    5 27 NCAD7   NBLK    6 11 NCAD7   NGRP    4 12 NCAD7   NOMAP   4  1 NCAD7   
NXGRP   4 31 NCAD7   OBPOS   3 37 NCAD7   OBUF    4 17 NCAD7   OFPT1   3 34 NCAD7   
OFPTR   4 18 NCAD7   OFPTR1  4 19 NCAD7   OGRP    4 11 NCAD7   OGRP1   4 10 NCAD7   
PBUF    4  4 NCAD7   POFPT   4  5 NCAD7   POFPT1  4  6 NCAD7   PRMSW   4  9 NCAD7   
PTRERR  5  6 NCAD7   RDIR    3  4 NCAD7   RDISC   4 32 NCAD7   RELCNT  4 14 NCAD7   
RPAGE   6 13 NCAD7   S1      1 19 NCAD7   S1A     1 27 NCAD7   S1B     1 20 NCAD7   
S1C     1 24 NCAD7   S2      1 29 NCAD7   S2A     1 32 NCAD7   S2B     1 31 NCAD7   
S3      1 35 NCAD7   S4      2  2 NCAD7   S5      2  6 NCAD7   S6      2 10 NCAD7   
S7      2 16 NCAD7   S8      2 18 NCAD7   SPCNT   4 16 NCAD7   T1      3 10 NCAD7   
T5      6 24 NCAD7   TDNO    4 34 NCAD7   TEMP    4 13 NCAD7   TONO    4 33 NCAD7   
UNBUSY  5 30 NCAD7   UNO     4  8 NCAD7   UUNBUF  6 17 NCAD7   VERMSG  1  6 NCAD7   
WDIR    3  6 NCAD7   WFDP    3 33 NCAD7   WGRP    3  9 NCAD7   
1CAD ** FICHE/FRAME BREAK *****
MAKECAD
NARP
SNCAD7
BNCAD7

T
RES
XDD
;TBNCAD7
%FSAV 3 TO 3061 ON GCAD

240
"
FILES AND CHECKSUMS
"
CHECKSUM
.
SNCAD7-SOURCE
GCAD-GO-FILE
MAKECAD-COMMANDS-FILE
.
COM T
  
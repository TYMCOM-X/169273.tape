EXEC ** FICHE/FRAME BREAK *****
AF
AF93   IDENT 05/09/74

*      ACCOUNTING ROUTINES

$FORMAT DATA 66600002B (FORMAT NUMBER (INCREMENT RIGHT DIGITS))

*LOG-ON ACCOUNTING
$ARON  BRS 42; STB UDMIN
       LDA X6; C ARIN        INITIAL ROUTINE
       LDA UREAL; ABC; DIV GRCH (30); STA RSREAL   SET RESOURCES INITIAL TIME
       LDA UREAL; MUL TMK; ADD TYMTIM; C ARW        RECORD DATE-TIME
       LDA AFSV6; C ARW        LUD6 WORD W/ UNIVERSAL USER NO.
       LDA AFSV7; C ARW        LUD7 WORD W/ GLOBAL ACCT. NO.
       LDA AFSV5; C ARW        NODE/PORT
       LDX JOB; LDA CPARW,2; ETR =7774B (DISTRICT NO.)
       MRG AFSV4 (IDCHAR); C ARW
*PROJECT CODE
       LDX KM4; LDA EPJ,2; MRG K200 (200B); C ARW; SKN EPJ,2; BRX *-4
ARON1  C ARC; BRU AFRET

*LOG-OFF DUE TO BAD TS PAGE
$AROFB LDA =60701000B
       C ARIN
AROFC  CLA
       C ARW (NO RESOURCES)
       BRU ARON1
NEGACT LDA GOWAY1; LDX PDP; STA -1,2 (PRETEND CAME FROM GOWAY-1)
       BRU AROFC
GOWAY1 DATA GOWAY-1
*LOG-OFF
$AROF  LDA TWO; SKG SSTIME; C ARSS6S; LDA =607B5
       SKN SWOFF; MRG K1B3
AROF1  C ARIN                  INITIAL ROUTINE
AROF2  LDA REAL; C AROFS; BRU ARON1      RECORD RESOURCES AND CLOSE
ARSB   C ARW; BRU AROF2

*RECORD RESOURCES
$ARRS  LDA =610B5; BRU AROF1

*SUB-SYSTEM LOGGING
$ARSS  LDA =602B5; C ARIN; LDA* SYSTL; BRU ARSB

*SPECIAL SUBSYSTEM LOGGING (MDSI)
       IF MDSI
$SARSS LDA =602B5; C ARIN; LDA UA; CLB; LSH 18; C ARW
       LDA REAL; C AROFS
SPRET  C ARC; LDA UA; LDB UB; LDX UX; BRS 111
       ENDF

*PUBLIC FILE LOGGING
$ARSS4 LDA =604B5; C ARIN
       LDA GRU; LDX FLX; LDB K1B4; SKB 2,2; MRG K1B4; C ARW
       LDA 4,2; C ARW; LDA 5,2; SKE KM1; BRU ARSB; CLA; BRU ARSB

*LOGS OFF TIME ONLY
$ARSS6 C ARSS6S; BRU ARON1
ARSS6S  LDA =606B5; C ARIN
*DETERMINE ADJUSTMENT BETWEEN SSTIME AND CURRENT TIME AND SAVE
       LDA SSTIME; C AROFS     RECORD RESOURCES WITH ADJ. TIME
       CLA; XMA SSTIME; ABC; DIV GRCH (30); STA RSREAL; R1

*LOG ACCOUNTING FROM PROGRAM CALL (BRS 141/10)
$ARSTG LDA =TLV22; C SRSU; XMA SRSU21; ADM SRSU21
       BRS 22
ARSTG1 GCI SRSU20; BRU ARSTG3; CLB; LSH 16
       STA XT1; GCI SRSU20; BRU ARSTG2
       LSH 8; ADM XT1; GCI SRSU20; NOP
ARSTG2 MRG XT1; C ARW; BRU ARSTG1
ARSTG3 C ARC; BRU BRS111

*LOGS SYSTEM OR OPER STATUS
$ARST  LDA =601B5; C ARIN; LDX JOB; LDA AUNN,2; C ARW
       LDB TLV4; LDA XT8; LSH 12; C ARW; LDA STATUS; C ARW
       LDA REAL; MUL TMK; ADD TYMTIM; C ARW; C ARC; BRU ABORT

*LOGS MONITOR DATA
       IF LOGM
$ARMN LDB REAL; STB LGMON; CLA; DIV K1800D; MRG =603B5; BRS 22; C ARW
       IF MDSI; LDA BADAC; STA BADACT; ENDF
       BRS 146; STA XWR4; STB XWR41; STX XWR42
       LDX KM5; CLA; STA XWR4E,2; BRX *-1
       C ARPK; BRU ARON1
       ENDF

       IF MDSI
* SPECIAL RECORD PAIR 613-614 FOR 16 WORDS OF USER MEMORY
BADAC  BRU NEGACT
$BRS187 C SUSR; STA TLV1 (ADDRESS IN WINDOW)
       LDA BRS581 (NOP); STA BADACT
       C MOVE8 (MOVE 8 WORDS OF DATA TO XWR4)
       LDA =613B5; C ARIN; C ARPK; C ARC
       C MOVE8 (NEXT 8 WORDS)
       LDA =614B5; C ARIN; C ARPK; BRU SPRET
MOVE8  LDA THREE; STA TLV11 (LOC OF XWR4)
       LDA SEVEN; STA TLV2 (WORD COUNT-1)
       LDA* TLV1; STA* TLV11; MIN TLV1; MIN TLV11; SKR TLV2; BRU *-5
       R1
       ENDF

*INITIAL ROUTINE FOR ALL STANDARD ACCOUNTING RECORDS
ARIN   MRG UTTY; BRS 22; C ARW; R1

*RECORD ALL RESOURCES (CONNECT TIME PLUS 7 OTHERS)
AROFS  ABC; DIV GRCH (30); STA XWR4  CURRENT TIME IN SECONDS
       LDA REAL; STA LGRS  (STOP SPECIAL LOGGING)
       LDA =XWR41; BRS 89      READ 5 RESOURCES FROM MONITOR
       LDA RPCHG; STA XWR46    ROYALTY PROGRAM BILLING UNITS
*MAKE ADJUSTMENTS
       LDA XWR43; ABC; DIV K50D; STA XWR43   CHAR. COUNT
       LDA XWR44; ABC; DIV GRCH (30); STA XWR44   PAGE TICKS
       LDA XWR45; ABC; DIV GRCH (30); STA XWR45   CPU TIME IN SECONDS
       CLA; STA XWR47          UNASSIGNED
       IF MDSI; LDA BADAC; STA BADACT; ENDF
*CALCULATE DIFFERENCE FROM LAST RECORDED AND SAVE CURRENT RESOURCES
       LDX KM8
AR     LDA XWR4E,2; SUB RSEND,2; SKA X4; BRU NEGACT (NEG. ILLEGAL)
       XMA XWR4E,2; STA RSEND,2; BRX AR
ARPK   LDA SEVEN; STA XT3         FOR 8 BYTES PER OUTPUT WORD
       LDA =XWR4E; STA XT2     LOC. OF OUTPUT WORD STORAGE
       LDX KM8                 NUMBER OF RESOURCES
AR0    LDB XT11; LSH 3; STB XT11       MAKE ROOM FOR NEXT BYTE COUNT
       LDB XWR4E,2             GET CURRENT RESOURCE
       SKB X4                TEST IF NEG.
$BADACT BRU NEGACT (NEGATIVE ACCOUNTING)
       SKB KM1; BRU AR2       NOT ZERO, GO PROCESS
AR5    BRX AR0                 GO TO NEXT RESOURCE
*NO MORE RESOURCES
       LDA SEVEN; SKG XT3; BRU AR5A       LAST WORD IS FULL
*FILL LAST WORD WITH ONES
       LDA XT5; LDB KM1; LSH 3; SKR XT3; BRU *-2
       STA* XT2; MIN XT2       STORE NEW LAST WORD
AR5A   CLA; STA* XT2           STORE END FLAG
       LDA XT11; C ARW         WRITE CONTROL WORD
       LDX KM8                 PREPARE TO WRITE OUT 8 RESOURCES
AR6    LDA XWR4E8,2; SKE ZERO; BRU *+2; R1  DONE ON LAST WORD ZERO
       C ARW; BRX AR6; R1
*PROCESS A RESOURCE
*      REMOVE LEADING ZERO BYTES
AR2    STX XT13; LDX KM8       BYTE COUNT
       LDA SEVEN; STA XT1         SET MAXIMUM FIELD COUNT TO 7 FOR 8 BYTES
       SKB K77B6; BRU AR4      TREAT HI 2 BYTES AS ONE
       SKB X7; BRU AR4       FOUND FIRST BYTE
       LSH 3; BRX *-3; C CR22 CAN'T BE ZERO
AR4    LDA XT5                 POSSIBLE SAVED OUTPUT WORD (OK IF NOT)
AR4A   SKR XT1; MIN XT11       BYTE COUNT UP TO 7 (7=2 BYTES FOR TOTAL 8)
       LSH 3                   MOVE BYTE FROM HI RESOURCE TO LO OUTPUT
       SKR XT3; BRU AR3        DECREMENT OUTPUT COUNT, WD NOT FULL
*      STORE FULL OUTPUT WORD IN OUTPUT STACK
       STA* XT2; MIN XT2
       LDA SEVEN; STA XT3         SET COUNTER FOR 8 BYTES
AR3    BRX AR4A                TO NEXT RESOURCE BYTE
       STA XT5                 RESOURCE EMPTY, SAVE PARTIAL OUTPUT WORD
       LDX XT13 (RESOURCE COUNT); BRU AR5   TO NEXT RESOURCE

*WRITES WORD IN ACCOUNTING AREA
$ARW   CAB; LDA ARBF; ADD ARP; COPY BA,AX,XB
       STA 0,2; MIN ARP; CBX; R1

*CLOSES ACCOUNTING RECORD
ARC    LDA =400B-10 (ALLOW UP TO TEN WORD ACCT. RCD); SKG ARP; BRU ARC2
       LDA REAL; SUB =2*3600 (2 MINS); SKG ACTIME; BRU ARC1
       LDA* ARIP; SKE ZERO; SKA THREE; BRU ARC3
       CAB; LDA ARBF; LDX K400 (256); BRS 123; BRU ARC3
*GO TO NEXT DATA BLOCK, WRITE THIS OUT
ARC2   LDA* ARIP; SKE ZERO; SKA THREE; C CR22
       MIN ARIP; CAB; LDA ARBF
       LDX K400 (256); BRS 123; LDP ARBF; XAB; STP ARBF (EXCHANGE BUFFERS)
       STA TLV1; LDX KM400; CLA; STA* TLV1; MIN TLV1; BRX *-2
       STA ARP; LDA CRACT; ADD K1400; RSH 23; DIV =255*1400B
       STB CRACT (NEXT BLOCK, MAY WRAP AROUND TO 0);
       LDA REAL; MUL TMK; ADD TYMTIM; C ARW         LOG TIME AS FIRST WORD
ARC3   LDA REAL; STA ACTIME
ARC1   BRS 23; R1
CR22   LDA REAL; STA CR16A; LDA TYMTIM; STA CR16B
       LDA =3B4; LDB =P16CR; LDX K4000; BRS 125
       BRS 131
$CR16A ZRO
$CR16B ZRO

ARBF   DATA 32400B,33000B
ARIP   DATA 33400B
ARP    ZRO



*      BRS 140 (CONVERT TIME OF DAY WITH YEAR TO STRING)
$TIMY  LDA KM1; BRU *+2
*      BRS 91 (CONVERT TIME OF DAY TO STRING
$EXRTIM CLA; STA RLV4
       LDA XWR4X3; STA XWR3; STA XWR31; LDA KM1; CLX; C CDX; STA DEL1
       LRSH 20; STA DEXP; CLA; LSH 4
       ADD ONE (SELECT THE MONTH BITS AND CORRECT )
       C EXRTM3 (PUT MONTH IN STRING); LDA K17; WCI XWR3; LDA DEL1
       ETR K1S5 (MINUTES OF MONTH PORTION); RSH 23
       DIV K1440D (DAY IN A, MINS OF DAY IN B); STB DEL1
       ADD ONE (CORRECT TO TRUE DAY); C EXRTM3 (PUT DAY IN STRING)
       SKN RLV4; BRU TIMY1 (BRS 91)); LDA K17; WCI XWR3; LDA DEXP
       ADD =72; C EXRTM3
TIMY1  CLA
       WCI XWR3 (PUT A COUPLE OF SPACES); WCI XWR3; LDA DEL1; RSH 23
       DIV K74 (HOUR IN A, MINS IN B); STB DEL1
       C EXRTM3 (PUT HOURS IN STRING); LDA COLNCH; WCI XWR3 ; LDA DEL1
       C EXRTM3; LDA =XWR3; LDB =UA; C WRSU; LDA K23; SKN RLV4
       LDA K20 (16)); ADM UB; LDX UX; LDP UA; BRU BRS111

EXRTM3 BSS 0   FN1
       RSH 23; DIV TEN (10)); STB DEL3; ADD K20 (20B)); WCI XWR3
       LDA DEL3; ADD K20 (20B)); WCI XWR3; R1 EXRTM3

*GENERAL DATE-TIME SUBROUTINES
*SEE BRS 176 SPECS.
*EXPECTS SINGLE OR DBL PREC. DATE-TIME WORD IN A,B AND
* CONTROL WORD IN X
*IF A IS -1 THEN USES CURRENT TIME
$CDX   STP GET1; STX GET3; CXA; C CDXZ; STA TUZN
       LDA GET1; SKE KM1; BRU CDX1
       LDA K20; STA TCZN; LDA REAL; MUL TMK; ADD TYMTIM; BRU GD1+1
CDX1   LDA GET3; RSH 12; C CDXZ; STA TCZN
       LDA GET3; SKA K1B6; BRU  CDX3
       SKA K2B6; BRU GPZ; LDA GET1; BRU GD0
CDX3   SKA K2B6; BRU GD3
*TAKES COMPACTED BINARY AND EXPANDS
GD1    LDA GET1; CLB; RSH 3; XAB; ADD KT+1; STA GET2
       XAB; ADC KT; STA GET1; BRU GPZ
*CHANGES 0 FORMAT (DMIN) TO FULL FIELDS
GD0    LRSH 20; ADD K14; STA ZYEAR; CLA; LSH 4; STA ZMONTH
       CLA; RSH 23-16; DIV K1440D; STA ZDAY
       CLA; LSH 1; DIV K74; STB ZMIN; STA ZHOUR
       CLAB; STP ZSEC; BRU GD3A
GD3    LDB GET1; CLA; LSH 10; STA ZYEAR
       CLA; LSH 4; STA ZMONTH
       CLA; LSH 5; STA ZDAY
       CLA; LSH 5; STA ZHOUR
       CLA; LDB GET2; LSH 6; STA ZMIN
       CLA; LSH 6; STA ZSEC
       CLA; LSH 12; STA ZMS
GD3A   MIN ZMONTH; MIN ZDAY
       LDA ZYEAR; STA TLV1; RSH 2; MUL =365*4+1; RSH 1; STB TLV11
       LDA TLV1; ETR THREE; MUL =365; LSH 23; ADM TLV11
       LDB ZMONTH; LSH 2; CBX; LDP ZAK; LCY 0,2; ETR K17; ADM TLV11
       LDA ZMONTH; MUL K30D; LSH 23; SUB K37; ADD ZDAY; ADM TLV11
       LDB THREE; LDA ZMONTH; SKG TWO; SKB ZYEAR; BRU *+2; SKR TLV11
       LDA TLV11; MUL =5273437; XAB; ADD TLV11; XAB
       ADC ZERO; LSH 9; STP GET1
       LDA ZHOUR; MUL K74; LSH 23; ADD ZMIN; MUL K74; LSH 23
       ADD ZSEC; MUL =31250; XAB
       ADD GET2; STA GET2; XAB; ADC GET1; STA GET1
       LDA ZMS; RSH 4; ADD GET2; STA GET2; CLA
       ADC ZERO; ADM GET1
*MAKE TIME-ZONE AND DAYLIGHT SAVING COR.
GPZ    LDA TCZN; SKE TUZN; BRU *+2; BRU GPZE
       SKA K40; BRU GPZ1
       LDA TUZN; SKA K40; BRU GPZ2
GPZ0   C GPZS; BRU GPZE
GPZ1   LDA TUZN; SKA K40; BRU GPZ0 (BOTH D.S.)
       C GPZD; BRU GPZ0 (NOT DURING D.S.)
       LDA KM1; STA XTE (USED BIN "IN"); C GPZC; BRU GPZ0
*MAKE ZONE CORRECTION
GPZS   LDA TCZN; ETR K37; STA TLV11; LDA TUZN; ETR K37; SUB TLV11
       SKE ZERO; C GPZC; R1
*MAKE HOURLY CORRECTION
GPZC   MUL =15322351B; LSH 5; XAB; ADD GET2; STA GET2; XAB
       ADC GET1; STA GET1; R1
*CK IF DURING D.S.
GPZD   LDA GET1; CLX
       SKG DSTBE,2; BRU *+3; EAX 1,2; BRU *-3
       SKG DSTB,2; R1 (NOT D.S.); R2
GPZ2   C GPZS; C GPZD; BRU GPZE; LDA ONE; STA XTE; C GPZC
GPZE   LDA GET3; SKA K100; BRU GPZA; SKA K200; BRU PD2; BRU PD3
GPZA   SKA K200; BRU PD3
*MAKE COMPRESSED BINARY DATE-TIME
       LDA GET2; SUB KT+1; CAB
       LDA GET1; SUC KT; LSH 3; SKB X4; ADD ONE; R1
PD3    LDP GET1; LRSH 5; DIV =[1000000/64]*[60/4]*[60/4]
* A HOLD HOURS SINCE 1960, B HOLDS PART OF HOUR IN MS/1024
       STB TLV11; RSH 23; DIV K30; STB ZHOUR; RSH 23
       DIV =365*4+1; LSH 2; STA ZYEAR; LSH 22 (DAYS IN 4 YEARS)
       SKG =59; BRU PD3B (POSSIBLE FEB 19)
       SUB ONE (CORRECT FOR 366 DAYS 1ST YR)
PD3C   RSH 23; DIV =365; ADM ZYEAR
       COPY BA,X; SKG MTB+1,2; BRU PD3A
       EAX 1,2; BRU *-3
PD3B   SKE =59; BRU PD3C (BEFORE FEB 29)
       LDX =1
PD3A   STX ZMONTH; SUB MTB,2; SUB ONE; STA ZDAY; CLB; LDA TLV11 (PART OF HOUR)
       LCY 6; EOR GET2; ETR =@77B; EOR GET2
       RCY 19; DIV =1000000; STB ZMS; RSH 23; DIV K74; STP ZMIN
       LDA GET3; SKA K100; BRU PD3E
*MAKE DMIN TIME
       LDA ZDAY; MUL K720D; CBA; ADM ZMIN; LDA ZHOUR; MUL K30D; CBA
       ADD ZMIN; RSH 20; LDA ZYEAR; SUB K14; LSH 4
       MRG ZMONTH; LSH 16; R1
PD3E   LDA ZYEAR; CLB; LSH 4; MRG ZMONTH; LSH 5; MRG ZDAY
       LSH 5; MRG ZHOUR; CAX
       LDA ZMS; LRSH 20; LDA ZSEC; RSH 6; LDA ZMIN; RSH 6; CXA; R1
PD2    LDP GET1; R1

CDXZ   ETR K77; SKE ZERO; R1
       LDA UZONE; SKE ZERO; R1
       LDA K20; R1
ZAK    DATA 10642125B,04400422B
KT     DATA 5350334B,54276000B
MTB    DATA -1,30,58,89,119,150,180,211,242,272,303,333,999
*NEXT TWO TABLES ARRIVED AT BY CONVERTING DATE TO DOUBLE PREC. BINARY
*AND USING 'A' REGISTER IN DECIMAL.  ACCURATE TO ABOUT 5 MINUTES.
*TABLE OF LAST SUN IN APR, 2AM, THRU 1985
DSTB   EQU *
       DATA 1918020 (4-25-76)
       DATA 2035179 (4-24-77)
       DATA 2154591 (4-30-78)
       DATA 2271750 (4-29-79)
       DATA 2388909 (4-27-80)
       DATA 2506068 (4-26-81)
       DATA 2623227 (4-25-82)
       DATA 2740386 (4-24-83)
       DATA 2859798 (4-29-84)
       DATA 2976956 (4-28-85)
       DATA 3777777B
*TABLE OF LAST SUN IN OCT, 2AM, THRU 1985
DSTBE  EQU *
       DATA 1978853 (10-31-76)
       DATA 2096012 (10-30-77)
       DATA 2213171 (10-29-78)
       DATA 2330330 (10-28-79)
       DATA 2447488 (10-26-80)
       DATA 2564647 (10-25-81)
       DATA 2684059 (10-31-82)
       DATA 2801218 (10-30-83)
       DATA 2918377 (10-28-84)
       DATA 3035536 (10-27-85)

$BRS176 C CDX; AXC; C CDXZ; XXA; BRU BRS111

*RENAME BRS, TAKES STRING POINTERS OF NEW NAME IN A & B
*TAKES FILE INDEX IN X (AFTER BRS 48) OF OLD FILE
$BRS37  STP TLV22; CXA; SKE FLX; BRU BRS111; SKNE ZERO; BRU BRS111
       LDA TLV23; SUB TLV22; LDB X4
       SUB THREE; SKB 4,2; BRU *+3
       EAX 1,2; BRU *-4
       SKG ZERO; SKG KM3; BRU BRS111
       C CPSU1; BRU BRS111 (NOT VALID NAME)
       C MKBUSY; BRU BRS111 (GROUP NOT IN CORE)
       LDA FLX; ADD THREE; STA TLV22; C PKC
       BRU BRS37A

       NOLIST EXT

* IMPORTANT:  THIS PACKAGE, INCLUDING LITERALS, WHEN LOADED SHOULD
*      NOT EXCEED 32377B.
       END
EXEC ** FICHE/FRAME BREAK *****
AF SYMSORT

SYM.  PG.LN. IDENT.

AR      3 38 AF93    AR0     4  4 AF93    AR2     4 22 AF93    
AR3     4 34 AF93    AR4     4 27 AF93    AR4A    4 28 AF93    AR5     4  9 AF93    
AR5A    4 15 AF93    AR6     4 18 AF93    ARBF    5 24 AF93    ARC     5  4 AF93    
ARC1    5 17 AF93    ARC2    5  9 AF93    ARC3    5 16 AF93    ARIN    3 23 AF93    
ARIP    5 25 AF93    ARMN    2 39 AF93    AROF    1 31 AF93    AROF1   1 33 AF93    
AROF2   1 34 AF93    AROFB   1 22 AF93    AROFC   1 24 AF93    AROFS   3 26 AF93    
ARON    1  8 AF93    ARON1   1 19 AF93    ARP     5 26 AF93    ARPK    4  1 AF93    
ARRS    1 38 AF93    ARSB    1 35 AF93    ARSS    2  2 AF93    ARSS4   2 12 AF93    
ARSS6   2 17 AF93    ARSS6S  2 18 AF93    ARST    2 33 AF93    ARSTG   2 24 AF93    
ARSTG1  2 26 AF93    ARSTG2  2 29 AF93    ARSTG3  2 30 AF93    ARW     4 39 AF93    
BADAC   3  9 AF93    BADACT  4  7 AF93    BRS176  9 20 AF93    BRS187  3 10 AF93    
BRS37   9 24 AF93    CDX     6 20 AF93    CDX1    6 23 AF93    CDX3    6 26 AF93    
CDXZ    8 25 AF93    CR16A   5 21 AF93    CR16B   5 22 AF93    CR22    5 18 AF93    
DSTB    8 34 AF93    DSTBE   9  8 AF93    EXRTIM  5 33 AF93    EXRTM3  6 11 AF93    
FORMAT  1  5 AF93    GD0     6 31 AF93    GD1     6 28 AF93    GD3     6 35 AF93    
GD3A    7  3 AF93    GOWAY1  1 29 AF93    GPZ     7 17 AF93    GPZ0    7 20 AF93    
GPZ1    7 21 AF93    GPZ2    7 34 AF93    GPZA    7 36 AF93    GPZC    7 28 AF93    
GPZD    7 31 AF93    GPZE    7 35 AF93    GPZS    7 25 AF93    KT      8 29 AF93    
MOVE8   3 16 AF93    MTB     8 30 AF93    NEGACT  1 27 AF93    PD2     8 23 AF93    
PD3     8  1 AF93    PD3A    8 12 AF93    PD3B    8 10 AF93    PD3C    8  7 AF93    
PD3E    8 20 AF93    SARSS   2  6 AF93    SPRET   2  8 AF93    TIMY    5 31 AF93    
TIMY1   6  4 AF93    ZAK     8 28 AF93    
EXEC ** FICHE/FRAME BREAK *****
CM
CM93   IDENT 02/01/78

$SYSTEM ASC '97E15/'
       OCT
S      MACRO D
K      NCHR D(1)
L      EQU K/3
M      EQU L*3
       IF 4-K
       ASC 'D(1)'
       DATA 4B7+136B*400B
       ELSF 1-K+M
       ASC 'D(1$1,M-3)'
A      EQU '   D(1$M-2)'
B      EQU '   D(1$M-1)'
C      EQU '   D(1$M)'
       DATA 4B7+A*2B5+B*400B+C
       ELSF 2-K+M
       ASC 'D(1$1,M)'
A      EQU '   D(1$M+1)'
       DATA 4B7+A*2B5+136B*400B
       ELSF 1
       ASC 'D(1$1,M)'
A      EQU '   D(1$M+1)'
B      EQU '   D(1$M+2)'
       DATA 4B7+A*2B5+B*400B+136B
       ENDF
       ENDM
SUBIT  MACRO D; DATA D(2).&D(4).&00.&D(5).&00B+D(3)/4000B
       DATA D(6),D(7); S D(1); ENDM
IT     MACRO D
XX     NARG
       IF 2-XX; ZRO D(1); ELSF 1; VALUE D(2); ENDF; S D(1); ENDM
VALUE  MACRO D
YY     NARG
       IF 2-YY; DATA D(1); ELSF 3-YY; D(1) D(2); ELSF 1; D(1) D(2),D(3)
       ENDF; ENDM

$SYSHT EQU *
       IF MDSI
       SUBIT NCS,1,30000B,3,0,0,4100B
       ELSE
       SUBIT DDT,1,30000B,5,0,0,4142B
       ENDF
       SUBIT XFORTRAN,3,34000B,3,5,10112627B,71727374B
       SUBIT SBASIC,4,34000B,3,1,0,607B
       IF MDSI
       SUBIT MDSI,5,30000B,3,0,0,4200B
       SUBIT NCS,6,30000B,3,1,0,0
       SUBIT NCS,7,30000B,3,1,0,0
       SUBIT NCS,10,30000B,3,1,0,0
       SUBIT NCS,11,30000B,3,1,0,0
       SUBIT NCS,12,30000B,3,1,0,0
       ELSE
       SUBIT F2C,5,30000B,3,1,0,6364B
       SUBIT FTC,6,30000B,3,1,0,3031B
       SUBIT F2OS,7,30000B,3,1,0,6500B
       SUBIT FOS,10,30000B,1,1,0,5000B
       SUBIT CAL,11,4000B,3,1,121314B,15160000B
       SUBIT NBASIC,12,34000B,3,1,0,2425B
       ENDF
       SUBIT XDDT,13,30000B,5,0,0,35363740B
       IF MDSI
       SUBIT NCS,14,30000B,3,1,0,0
       ELSE
       SUBIT SFORTRAN,14,34000B,3,1,35363740B,41424344B
       ENDF
       SUBIT EDITOR,16,24000B,3,0,0,262730B
       SUBIT BFORTRAN4,20,24000B,3,0,0,313200B
$SYSEHT ZRO
*LEVEL OF COMMANDS
*  0  ALL USERS
*  ,4  TYMSHARE PROP
*  ,1  OPERATOR
*  SKS  (40) SYSTEM
*       (20) ACCOUNT SUPERVISOR
*      (10) FORK CLASS COMMAND (CANT RETURN TO BRS)
*       (01) LOCATED IN EXECS PAGE "EX"
*       (02) LOCATED IN EXECS PAGE "MB"
*       (04) MUST GET DISC TEMP. BUFFER ADR.
*      (*)  CONFIRMATION REQUIRED
$CHT   IT SEND,(4,SNMAIL) (ALLOWS USER TO PUT LETTER IN MAILBOX)
       IT PLACE,(11,PLACE) (PLACES A "SAVE" TYPE PROGRAM IN USES MEM.)
       IT PROJECT,(1,PROJ) (WRITES ACCOUNTING,CHANGES PROJECT CODE)
       IT RENAME,(2,REN) (RENAMES A FILE)
       IT DIRECTORY,(1,FDIR) (TYPES FILE DIR. WITH ALL PARAMETERS)
       IT DATE,(0*,DATE) (TYPES DATE AND TIME)
  IT KILL,(10*,KILL) (KILLS PROGRAM RELAB. ONLY)
       IT RESET,(10*,RESET) (RETURNS ALL OF USERS MEMORY)
       IT COPY (COPIES FILE TO FILE); IT FI,(1,LFDCOM)
       IT FILES,(1,LFDCOM) (TYPES FILE DIR.)
       IT GO,(10,GOTO) (GOES TO A "GO TO" TYPE PROGRAM)
       IT SAVE,(1,SAVE) (SAVES PROG., CREATES GO TO FILE)
       IT BRANCH,(11,BRANCH) (BRANCHES INTO A PROGRAM)
       IT TIME,(1*,PT) (TYPES REAL TIME USED (AND COMP. TIME))
       IT STATUS,(1*,MA) (TYPES USERS STATUS)
       IT DUMP (DUMPS ALL PROGRAM, SAVES STATUS)
       IT RECOVER,(10,REC) (RECOVERS FROM A DUMP FILE)
       IT CONTINUE,(10*,CONT) (CONTINUES RUNNING A SUB-SYSTEM)
       IT REENTER,(10*,REEN) (CONTINUES FROM STARTING LOC. PLUS 1)
       IT RUN,(10,RUN) (DOES RECOVER FOLLOWED BY CONTINUE)
       IT WHY,(1,WHY) (TYPES ERROR MESSAGE)
       IT RELEASE,(10,REL) (RELEASES A SUBSYSTEM)
       IT LIMIT (SETS CPU TIME LIMIT)
       IT PMT,(2,PPMT) (PRINTS A USERS PSEUDO-MEM TABLE)
*      IT      ENABLE,(2,ENAB,1)     ENABLES A SUBSYSTEM GROUP
       IT EXIT,(10*,EXIT) (ALLOWS LOGOUT WITHOUT PRINTING TIME USED)
       IT MAIL,(4*,MAIL) (TYPE ALL MAIL IN A USERS MAILBOX)
       IT MEMORY,(0*,UM) (TYPES UNUSED USERS MEMORY)
       IT LOAD,(2*,LOADF) (TYPES LOADING FACTORS)
       IT COMMANDS,CFRM (COMMANDS FROM SPEC. FILE)
       IT DO,CFRM
       IT DECLARE,(2,CNTRL) (SET FILE DIR. CONTROLS)
       IT DELETE,DEL (DELETES FILE)
       IT WHO,(5,WHO) (TYPES USERS ON SYS BY TTY NO.)
       IT INIT,(1,INIT) (SETS UP INITIAL START-UP FILE)
       IT GFD,(5,GFD) (GETS ANOTHER USERS FILE DIR.)
       IT WHERE,(5,FIND,4) (GIVES TTY NO. FOR A USER)
       IT USERS,(2*,USERS,4) (TYPES NO. OF USERS ON SYS.)
       IT SMT,(2,PSMT,4) (SETS PSEUDO-MEM TBL.)
       IT SETE,(2,SEXFLG) (SETS EXEC STATUS)
       IT REMOVE,REMFIL (REMOVES FILE FROM DIRECTORY)
       IT PSP,(2*,PMTER,4) (TYPES ERROR COUNTERS, ETC.)
       IT SYSNO,(5,SYSNO) (TYPES SYSTEM NO.)
       IT SHUT,(11*,SHUT,1) (STARTS SYS. SHUT DOWN)
       IT UP,(1*,GOUP,1) (CANCELS SHUT DOWN)
       IT HANG,(1,HANG,1) (HANGS UP DSS)
       IT LETTER,(4,LETTER,1) (TYPES BROADCAST LETTERS, ETC.)
*      IT      DISABLE,(2,DISAB,1)   DISABLES A SUBSYSTEM GROUP
       IT LOOK,(1,LOOK,5) (LOOKS AT REAL CORE LOCATIONS)
       IT LOGOUT,(11*,LOGOUT) (ALLOWS USER TO LOGOUT)
       IT SLD,(11,SYSLD,1) (SYSTEM SELECTED LOAD)
       IT SDP,(1,SYSDP,1) (SYSTEM SELECTED DUMP)
       IT CRASH,(11,CRASH,1) (CRASHES SYSTEM, SAVES ACCOUNTING,ETC)
       IT DS,(2*,OPER,4) (SETS OPERATOR STATUS)
       IT FDC,(2*,FDC) (SET FILE DIR. CONTROLS)
       IT PFDC,(2,PFDC) (PRINT F.D. CONTROLS)
       IT LAST,(1,LAST) (TYPES POSITION IN F.D. OF LAST FILE)
       IT ERASE,(0,ERASE,1) (REMOVES FILE WITHOUT RELEASING STORAGE)
       IT DEINIT (REMOVES INIT FLAGS AND DUMMY NAMES)
       IT TOUT (OPENS OUTPUT FILE FOR EXEC MSGS, ETC.)
       IT LIST,(1,LIST) (LISTS FILE DIR. IN REVERSE ORDER)
       IT PRINT (PRINTS SPECIFIED FILE ON TERMINAL); IT TYPE,PRINT
       IT ERRORS,(1,ERRORS) (TOGGLES ERRSW TO FORCE ERR. MSGS. OUT)
       IT POURQUOI,(1,WHY)
       IT CFD,(5,CFD,1) (CHANGE FILE DIREC. FOR OPER.)
       IT ME,(5,ME)   (DOES WHO * FOR USER LOGGED ON - UTTY)
       IT NOM,(2*,NOM)    SETS NO EMERG. MSG.
       IT MON,(2*,MON)    SETS EMERG. MSG. ON
       IT SCHDLY,(1,SDLY,4) SETS USER SCHDLY
       IT DSC,(1*,DSC)       PRINTS BASE AND MAX STG. USED.
       IT DIAL,(15,DIAL)
$ECHT  ZRO
       FRGT S,K,L,M,A,B,C,SUBIT,IT,XX,VALUE,YY
       DEC
$PDNO  LDB TEN (10D)
PDN2   LDX COUT ; BRS 36; R1 PDNO
*   0.5
$PONO  LDB EIGHT (8); BRU PDN2
*   0.7
$RONO  LDB EIGHT (8)
RON1   LDX CIN; BRS 38; R1 RONO
*   0.6
$RDNO  LDB TEN (10D); BRU RON1
*   0.2
*GOES TO ERRET IF NEXT INPUT CHAR. NOT C.R. OR BLANK
$OKTOGO CIO CIN; SKE CRCH; SKG ZERO; R1; ER 63
$OFOKG  CBA ... (ELSE GO TO OKTOGO); SKG K200 (200B); SKG KM1; CIO CIN
       BRU OKTOGO+1
$CKCM  LDA CRCH; SKN TLV22; R1 (CMND FROM BRS); CIT CIN; R2; R1
$MSG   LDX ONE; LDB KM1; BRS 34; R1
*TYPES CHARACTER TO COUT
$MSGX  STA TLV0; LDA* 0; CIO COUT; LDA TLV0; BRR 0
*   4.3        HAND ALL OF USER'S MEMORY BACK TO MONITOR
$KILL6  LDA VNCMEM
KILL7  ADD ONE; BRS 121 (REMOVES PAGES FROM PMT); SKG K77 (77B)
       BRU KILL7; CLAB CLEAR (ALL EXEC RELABELLING REG.); STP PRGRL
       STP SSRL; LDA KM1; STA SYSTL; STA GETSTL (USED BY GOTO)
       C EXECRL (SAVE EXEC RELABELLING OF 1ST 2 PGS ONLY); R1
*              GET NAME AND OPEN O/P FILE
*      FILE LENGTH IN B, TYPE IN A
$GOFN  STB GOFNFT; LDA CIN
       C GOFNA (GET FILE NAME FROM TTY, LOOK UP IN H.T.)
       BRU GOFNE (ERROR, BAD FILE NAME); STB XT14; LDX GOFNFT
       C GOFNB (OPEN FILE, FILE TYPE IN X,LENGTH IN B); BRU GOFNE
       STA OUTFIL; LDB XT14; R1 GOFN
GOFNE  MSET M67 (OUTPUT ERROR); BRU ERRET
* OPENS /$/ FILE FOR FORCED DISCONNECT DUMP
$GOFND STB GOFNFT; LDA SWPRP; SKNE VGOTO; R1; SKNE VRUN; R1
       LDP OFNPTR (POINTERS FOR /$/); STP FNPTR; C FNLK
       R1 GOFND (NOT IN DIRECTORY); LDX GOFNFT; C GOFNB (OPEN)
       R1 GOFND (CANT OPEN); STA OUTFIL (FILE NO); R2 GOFND
*   2.4        GET NAME AND OPEN I/P FILE
$GIFN  LDA CIN; C GFN; BRU GIFNE (ERROR, NAME NOT IN DIRECTORY)
       C OKTOGO; LDA FLX; C GIFNB; BRU GIFNE; STA INFIL; R1 GIFN
GIFNE  EAX M60; C CMER; BRU GIFN
OFNPTR DATA 3**+5; DATA 3**+5
       ASC '/$/' (POINTERS AND NAME FOR FORCED OFF DUMP)
*RE-ENTRY POINT AFTER MEM. AND ILL. INSTR. TRAPS AND RUBOUT
$EXECP SBRM CKTS; SKR NAST; BRU *+2; BRU GOWAY (TRAP LOOP)
       CXA; LDX KM1
       BRS 99 (ABORT BLOCK I/O)
       BRS 29  (SEND GOBBLER)
       BRS 178 (WAIT FOR BLOCK I/O TO COMPLETE)
       SKG ZERO (CHECK TYPE OF TRAP)
       BRU ERRETZ (RUBOUT)
EXECPR SKG ONE ; BRU EXECPI (INST. TRAP); LDA =M15; C MSG; LDA =M41A
EXECPA C MSG
       LDA EXECL (GET ADR. OF I. OR M. TRAP FROM PANIC TBL.)
       LDB EIGHT (8); LDX ONE; BRS 36; BRU ERRETY
EXECPI LDA =M41                TYPE INST. TRAP
       BRU EXECPA
*GENERAL ERROR RE-ENTRY POINT
$ERRET TCO BLKCH; TCO K37 (QUESTION MARK); TCO CRCH
ERRETY LDX KM1; LDA V10000; BRS 164
ERRETZ LDX KM1; BRS 11
       LDX JOB; CLA; STA FGLIST,2 (NO GRP IN CORE); STA GBUSY,2
       C DTEMPR                (RELEASE DISC BUFFER)
$ABORT BRS 181 (RESET CIN AND COUT); BRS 17 (CLOSE ALL FILES)
ABORTB CLAB; STP INFIL; C SVBRK (SAVE OLD BRK TBL, SET STND.)
$ABORTC LDA REAL; SKN SSTIME
       BRU CR; STA SSTIME (SUBSYS. FINISH TIME); BRU CR
$RENTER BRS 23
       BRS 43 (RETURN FROM ENTER, RELEASE "EEX" PAGE); CLB; BRS 44
       BRU ABORT
*      CLOSING OUT SEQUENCE FOR COMMANDS
$CLOSE CLA;*CLOSE MAGTAPE FILE - INFIL; XMA INFIL; BRS 20
       CLA;*CLOSE  MAGTAPE O/P FILE - OUTFIL; XMA OUTFIL; SKE COUT
       BRS 20
*      COMMON RETURN POINT FOR EXEC.  UPON COMPLETION OF ALL
*      COMMANDS, EXEC RETURNS HERE.
*      A USER'S INITIAL ENTRY TAKES THE FOLLOWING PATH:
*      ENTERS AT EXECI (MB),THEN TO ABORT, THEN CR, AND THEN TO ENTER(EX)
$CR    SBRM CKTS (CHECK TS PAGE AND RESTORE PUSHDOWN STACK)
       SKN SWOFF; BRU OFINT1 (FORCED OFF (DUE TO HANGUP) STARTED)
       LDA VNPD; STA NAST (POS. => MADE IT THRU TRAP CLEANUP O.K.)
       BRS 47 (ENABLE ESCAPES/ALT MODES); BRS 114
       C EXECRL (RESTORE NORMAL EXEC RELABELLING); LDA SWPRP
       SKNE VGOTO (CK IF PROPRIETARY SW SET TO GOTO); BRU *+3; SKE VRUN
       BRU CR1; LDA CMND; SKE ZERO; BRU CR1; LDA PRGRL1; MRG PRGRL2
       SKE ZERO; C KILL6 (YES, RESET ALL MEMORY); STA SWPRP (CLEAR SW)
CR1    C DTEMPR (RELEASE DISC BUFFER); LDX UTTY; LDA WERIS,2
       SKG KM3 (CK IF IN -3 STATE. (OFF INTERUPT RECD.))
       BRS 109 (WAIT FOR OFF INTERRUPT)
       SKG KM2 (CK IF OFF INTERRUPT REC. IN SUB-SYS); BRU OFFINT (YES)
       SKN SWTM (CK IF TIME RUNOUT INTERRUPT RECD.)
       BRU XTMOT1 (TIME RUNOUT); LDA UNO (CK IF USER HAS ENTERED YET)
       SKE ZERO; BRU CRA (YES)
       BRU XENTER (GRAB 3RD PAGE AND GO TO ENTER)
CRA    C CACT (CK IF ACCT. NEEDS TO BE WRITTEN); BRS 47
       SKN MSZ2 (FORCES EXIT IF NOT NEG.); BRU EXIT
       LDA ERCODE; SKP ERRSW; SKG ZERO; BRU CRAB; C TWHY
CRAB   SKN SWLET (ARE BROADCAST LETTERS TO BE IGNORED); BRU *+2 (NO)
       BRU CRA1 (YES, DONT BOTHER TO CK FOR LETTERS); LDX JOB
       SKN AUNN,2 (CK IF BUSY ON LETTER); BRU *+2 (NO)
       BRU XTLET (YES, GO TYPE LETTER)
CRA1   LDX JOB; LDA ONE; STA SW60 (SET SW FOR NOT WORKING ON BRS 48/60)
       SKA CPARW,2 (CK IF BUSY ON MAIL); BRU MAIL (YES)
       LDA TWO (MAIL MESSAGE FLAG)
       SKA CPARW,2 (CK IF ANY MAILE IN THE MAILBOX); BRU *+2 (YES)
       BRU CRA2 (NO); LDA =M68 (YES, TYPE MAIL WAITING); C MSG;  LDX JOB
       LDA KM2; ADM CPARW,2 (REMOVE MAIL MESSAGE FLAG)
CRA2   CLA; STA OPNCN
       STA XWR4; STA SW58 (NOT DOING BRS 37 RENAME); STA CR3
       SKN FDCONT; BRU CRA2A; STA FDCONT; STA GRP
       LDA ANO; STA FDAN
       LDA UNO; STA FDUN; LDA LUDL; STA FDLUDL
CRA2A  CLA; BRS 113; XMA SWINIT
       SKE ZERO (CK FOR START-UP FILE); BRU SINIT; BRS 114; LDA REAL
       IF CEM; STA CRSW; ENDF
       STA OPTM (RESET OPER. STATUS)
       CLA; SKP CMND; BRU CRA3 (CMND FROM BRS WITH RETURN)
       STA GOREMA; STA SGOREM (CLEAR "GO" REMOTE ACCT)
       SKE CIN; BRU CRA3
       STA SREMAC (CLEAR "COMMANDS" REMOTE ACCT)
       XMA REMAC (REMOTE ACCOUNT CONTROL); SKE ZERO
       C KILL6 (REMOTE FILE USER TERM., RESET); LDA CMND; SKE ZERO
       BRU CRA3 (CMND FROM BRS); TCO CRCH; TCO K15
CRA3   LDA CMND; SKE ZERO; BRU CMND1
       LDA CIN; C FNSET; SKNE TWO; BRU QT
       C ENDUSE (WRITE END USE ACCT. IF NEC.); CLA; STA XWR4; C GTNM1
       BRU ERRET
CRA4   C LKSBS; BRU NM2; SKN CMND; BRU CRA6
CRA5   CLA; STA CMND; BRU BRS111
CRA6   C CMPR; BRU *+2; BRU CSYS
       SKN TLV1; BRU COMLIB; BRU CSYS
CMND1  SKA X4; BRU CMND3 (RETURN TO BRS CMND)
       C KILL6
       C ENDUSE; LDA KM1; STA TLV21 (NO 1ST CHAR); CLA; XMA CMND
CMND2  STA XWR4
       LDA XWR4X3; STA FNPTR; ADD THREE; STA FNPTR1; BRU CRA4
CMND3  SKE KM1; BRU CMND4; CLA; STA CMND; BRU OUT
CMND4  STA TLV21; LDA KM1; XMA CMND; EOR X4; BRU CMND2
$LKSBS LDX VSYSHT; LDA XWR4; LDB KM1
NM1    SKB 0,2; BRU *+2; R1 (END OF SUBSYS TBL)
       SKE 3,2; BRU NM1A
       CXA; ADD THREE; R2
NM1A   EAX 3,2; EAX 1,2; SKN -1,2; BRU *-2; BRU NM1
*LOOK IN COMMAND TBL
NM2    LDX VCHT; SKB 0,2; BRU *+2; BRU COMLIB
       SKE 1,2; BRU NM3; CXA; ADD ONE; C CMPR; BRU *+2; BRU CRA3A
       SKN TLV1; BRU COMLIB; BRU CRA3A
NM3    EAX 1,2; SKN 0,2; BRU *-2; EAX 1,2; BRU NM2+1
CRA3A  LDB 0,2; STB CR3; SKN CMND; BRU *+3; SKB K1B6
       BRU CRA5 (ILLEGAL CMND INSIDE BRS); SKN TLV21; BRU *+2
       BRU *+3 (COMMAND FROM BRS)
       SKB K4B4 (4B4)(WAIT FOR CONFIRMATION IF ON); C OKTOGO; C CKOPTM
       NOP; LDA TLV21; CNA; STA TLV22 (CMND SWITCHES); LDA CIN
       STA GFN1 (SEE GIN1, ALSO SET BY BRS 15 IF PUB.)
       LDA CR3 (RECOVER COMM. LOC.); CAB; ETR K3S4
       XMA CR3 (KEEP ADDRESS ONLY)
       ETR K76B6 (REMOVE ALL BUT CONTROL BITS); LDX JOB
       SKE ZERO (CK IF ANY CONTROLS)
       SKA CPARW,2 (CK IF USERS CONTROLS AGREE); BRU *+2; ER 64 (NO)
       CBX; SKB K1B5 (CK IF IN EX PAGE); C GTEX (YES, BRING IN); CXB
       SKB K2B5 (CK IF IN MB PAGE); C GTEXM (YES); CXB
       SKB K4B5 (CK IF IN TEMPORARY DISC BUFFER)
       C LDBUF (GET BUFFER ADR.); BRU* CR3
*      SET INIT AS COMMANDS FROM OR GOTO
SINIT  CLA; STA TLV4
SINIT1 MIN TLV4; LDA TLV4; C FLNUM; ER 65
       LDB ONE; SKB 2,2; BRU *+2; BRU SINIT1
       C CPFN; LDP XWR3; STP FNPTR; GCI XWR3; HLT SSL; BRU CMLB
COMLIB SKN CMND; BRU *+2; BRU CRA5 (ILLEGAL INSIDE BRS)
       LDA TLV21 (FIRST CHAR); SKE EIGHT; SKNE TWO; BRU CMLB; SKE THREE
       SKNE TEN; BRU CMLB; LDA TEN; WCD FNPTR; STA TLV21
CMLB   C FNLK; BRU ERRET; LDB VGOTO; STB CR3 (SET COMMAND SW. FOR PROP.)
       C GIFNB (OPEN FILE); BRU ERRET; STA INFIL; LDX FLX; LDA K2B4
       SKA 2,2; BRU *+2; BRS 114
       IF CEM; SKP CRSW; BRU CMLB4; ENDF
       CLA; SKNE CIN; BRU *+3; LDA CRCH
       BRU CMLB3; LDX KM1; LDA CRCH; BRS 13
CMLB3  CIT CIN; NOP 0
CMLB4  COPY BX,BA; SKNE THREE; BRU CFRM2 (GO OPEN AS COMMANDS-FROM)
       SKE FOUR; BRU CMLB1; C KILL6; LDA INFIL; C ECRECV; BRU RUN+1
CMLB1  C KILL6; LDA INFIL; LDX KM1; STX GETPL; LDB GOFNFT; BRU GET10A
*      'LOGOUT'
$EXIT  BRU LOGOUT (LOC. USED AS SW. TO SKIP "TIME")
$LOGOUT BRS 46; C KILL6
       C WRACT (WRITE ACCOUNTING); BRS 8
       LDA =60000; LDX KM1; BRS 164
       LDA CR3; SNE VEXIT; BRU LGOUT4 (DON'T PRINT TIMES)
       C GTEX (NEEDED BY TIMER); C TIMER (PRINT ELASPED TIME)
$LGOUT3 LDX KM1; LDA V10000; BRS 164 (DISMISS UNTL OUT DN OR 5 SEC)
$LGOUT4 BRS 55; BRS 22
       CLA; BRS 4 (DOES NOT RETURN)
*      BRS 112 (LET THE MONITOR CLEAN UP)
*      WRITE END OF USE ACCT. IF NECESSARY
$ENDUSE LDA SSTIME; SKG ZERO; R1 (NO SUBSYS. ACT.)
       ADD K3600D (1 MIN); SKG REAL; BRU *+2; R1 (NOT 1 MIN. YET)
ENUSE  C GTFIO; C ARSS6; C EXECRL; R1
*      CALL FOR ANY SUBSYSTEM
CSYS   ADD ZERO (REMOVE SIGN IF ON); STX XT1; SKN TLV21 (CMND FLAG)
       C OKTOGO (YES, AWAIT TERMINATING 'C.R.')
*      LDX     XT1
*      C       CKSYS
       LDX XT1; LDA K4B5
       SKA 0,2 (MUST SUBSYS COEXIST WITH USER MEMORY ?); BRU *+3 (YES)
       C KILL6; C RSYS (NO, RELEASE CURRENT SUBSYS, IF ANY); BRS 46
       LDA XT1; STA SYSTL; CAX; LDP 1,2 (YES, SET UP COMMON RELABELLING)
       STP SSRL; LDA 0,2; SKA K300; BRU CSP
CSYSA  LDA* SYSTL; CLB; LSH 11; SKA K2B6; ADD V3776B (XFO); ETR K3S4; STA GETSTL
       STA SSL; LDP SSRL; STP SSR1; LDP CIN; STP SSA
       IF CEM
       LDX KM1; LDA TWO; BRS 12
       ENDF
CSYS1  LDB* SYSTL; C CKSSAC (CK. SUB-SYS AC. AND WRITE IF NEC.)
       C ARSS (SKIPPED BY CKSSAC IF NO ACCT.); CLA
       BRS 78 (DISARM INTERRUPTS FOR EXEC); C CEXFLG (CHECK EXEC FLAGS)
       LDB* SYSTL; MRG SSL3; SKB K2B5
       MRG =EX1BIT (SET EXEC 1 STATUS FOR SUBSYS.); STA GETPL; BRS 47
$CSYS9 BRS 9; LDP SSR1
       STP SSRL (SET UP SUBSYS. RELABELING FROM PANIC TBL)
       LDX SSM (EXIT ACCORDING TO STATUS OF SUBSYS ON TERMINATION)
SUBRET LDA SSL; STA EXECL; COPY XA,B; STB GOREMA (RESET REMOTE ACCT.)
       STB SGOREM (SAVED "GO" REMOTE ACCT)
       SKG ZERO (CK IF RETURNED ON ESCAPE); BRU *+2 (YES); BRU EXECPR
       LDA GETSTL; STA SSL
       BRS 147 (CLOSE ALL FILES EXCEPT COMMANDS FROM FILE)
       BRU ABORTB (DONT CLOSE COMMAND FILE)
$SSL3  NOP SSL,3
*CHECK EXEC FLAGS FOR FORKS, PUT BITS IN A
$CEXFLG CLA; LDB EXFLAG; SKB KM1; MRG K1B6 (SUB-SYS)
       SKN EXFLAG; R1; MRG K4B5 (SYSTEM)
       SKB K2B7; MRG X4 (EXEC); R1
*CHECKS SUB-SYS ACT (SSTIME) AND WRITES ACT. IF NECESSARY
*WRITE SS. ACT. IF (SSTIME=0) OR (NOT SAME SSID)
*EXPECTS NEW SSID IN B
CKSSAC LDA KM1; XMA SSTIME; XAB; XMA SSID
       SKB KM1; SKE SSID; BRU *+2; R2
       C GTFIO; R1
*      'CONTINUE'
$CONT  LDX KM1; LDA BRKTBL; BRS 12 (RESTORE BREAK TBL); BRU CONTA
$REEN  LDA GETSTL; STA SSL
CONTA  BRS 46; SKN SYSTL       CK IF SUBSYSTEM AVAIL
       BRU CONT1; CLA; STA GETPL; BRS 78; LDA GETSTL; SKG ZERO; ER 68
       SKE SSL; BRU CONT2; ADD ONE; BRU GET8A
CONT1  LDX SYSTL; LDA GETSTL; SKE SSL; BRU *+4; LDP CIN; STP SSA
       MIN SSL
*      C       CKSYS
       C PSCN (PRINT SUB-SYS NAME); BRU CSYS1
CONT2  LDA GRU; SKE FDUN; SKNE UNO; BRU GET8B1
       LDA KM1; STA SSTIME; BRU GET8B1
*      'RELEASE'
$REL   C PSCN; SKN TLV21 (CMND FLAG); C OKTOGO; C RSYS; BRU CR (**)
*      CHANGES SMT BYTES TO PMT
CSP    ETR K300; MRG X4; STA TLV2; LDX KM8
CSP2   LDA =SSRL; C ERB; SKE ZERO; BRU *+3
CSP1   BRX CSP2; BRU CSYSA
       CLB; MRG TLV2; STX TLV1; LDX KM1; BRS 3
       LDX TLV1; LDB =SSRL; C SRB; BRU CSP1
*   0.11       EXTRACT BYTE FROM RELABELLING
$ERB   ETR K3S4; STA TLV1; LDP* TLV1; EXU ERBSH,2; ETR K77 (77B); R1 ERB
*      SHIFT TABLE TO GET BYTE
       RCY 18; RCY 12; RCY 6; NOP; LCY 6; LCY 12; LCY 18; LCY 24
ERBSH  EQU *
*      SHIFT TABLE TO RESTORE BYTE
       LCY 18; LCY 12; LCY 6; NOP; RCY 6; RCY 12; RCY 18; RCY 24
SRBSH  EQU *
*   0.12       SET RELABELLING BYTE
$SRB   ETR K77 (77B); STP TLV1; LDP* TLV11; EXU ERBSH,2; ETR KS6B2
       MRG TLV1; EXU SRBSH,2; STP* TLV11; R1 SRB
*           RELEASE CORE
$RELST COPY XB,A; LDX KM8; CBA; ETR K3S4; STA DRSW9
RRR1   STX TLV2; LDA DRSW9; C ERB; SKG VNCMEM; BRU RRR2; BRS 121
RRR2   LDX TLV2; BRX RRR1; CLAB; STP* DRSW9; R1 RELST
*              PRINT CURRENT SUBSYSTEM NAME
$PSCN  LDA SYSTL; SKA K4B7; ER 68; SUB ONE; C CPFN; LDP XWR3
       LDX COUT ; BRS 35; R1
*   3.4        RELEASE THE CURRENT SUBSYSTEM
RSYS   LDA KM1; XMA SYSTL; EAX SSRL; SKE KM1; C RELST; R1 RSYS
*      'KILL PROGRAM'
$KILL  EAX PRGRL1; C RELST; BRU CR
*      'RESET'
$RESET C KILL6 (RELEASES ALL PAGES IN PMT); BRU CR
*PRINTS FILE ON TERMINAL OR COUT
$PRINT BRU COPY
*      'COPY '
$COPY  LDA CR3; STA TLV4
       C CKCM (SEE IF 1ST CHAR TYPED WAS C.R.)
       MSET M56 (TYPE "FROM")
COPYA1  LDA CIN; C GFN (GET INPUT FILE NAME)
       BRU COPYA; STA COPY1; C GIFNB (OPEN FILE FOR INPUT); BRU COPYA
       STA INFIL; STB COPYT; LDA TLV4; SKE VPRINT; BRU COPYA2; LDA ONE
       STA FLX; LDA COUT; BRU COPYB2
COPYA2 C SEP; SKNE CRCH
       MSET M16 (TO FILE)
COPYB1  LDA CIN; C GOFNA (GET OUTPUT FILE NAME)
       BRU COPYB; LDX COPYT (GET TYPE FROM INPUT FIL); C GOFNB
       BRU COPYB
COPYB2 STA OUTFIL; TCF CRCH; LDA FLX (OUTPUT); CAX; LDB 2,2; SKE ONE
       SKB K100; BRU COPY3 (COPY BY CIO'S); LDA COPY1 (INTPUT); SKE ONE
       BRU COPYE (NOT TTY, COPY W BIO)
       CIO INFIL
       SKNE EOTCH; BRU CLOSE; CIO OUTFIL; BRU *-4
COPY3  LDA OUTFIL; SNE ONE; SKN MASTER; BRU COPY3A
       C GTXFD
       BRU BTIO
COPY3A  CIO INFIL (TRANSFER INFIL TO OUTFIL CHAR BY CHAR ...)
       SKN INFIL; BRU *+2; BRU CLOSE
       CIO OUTFIL; BRU COPY3A
COPYA  EAX M56; C CMER; BRU COPYA1
COPYB  EAX M16; C CMER; BRU COPYB1
COPYE  SKG TWO; BRU CLOSE; RSP INFIL; STA COPY1
COPYC  LDA K4000 (4B3)(COPY FILES USING BLOCK I/O); LDX K3B4 (CORE LOC.)
       BIO INFIL; NOP; LDB K2B5 (CK FOR END OF FILE BIT); SKB INFIL
       BRU COPYD (SET, GO WRITE LAST BLOCK); LDA K4000 (4B3); LDX K3B4
       BIO OUTFIL; NOP; BRU COPYC
COPYD  SUB K3B4 (COMPUTE NO. OF WORDS IN LAST PAGE); LDX K3B4; SKE ZERO
       BIO OUTFIL; NOP; LDA OUTFIL; SKG TWO; BRU COPYD1; RSP OUTFIL
       XMA COPY1; MRG X4; SCP OUTFIL; NOP; LDA COPY1; PCE OUTFIL; NOP
COPYD1 LDA K3B4; BRS 4; BRU CLOSE
*      'GO TO '
$GOTO  C CKCM; MSET M64; C KILL6 (RELEASE ALL PAGES IN PMT); LDA KM1
$GET10 STA GETPL; C GIFN (READ INPUT FILE NAME)
GET10A BRS 46; STA SSB
       BAC
       STB INFIL; SKE ONE (CHECK FILE TYPE IS CORE-IMAGE); ER 61
       LDB GAN; LDX FLX; LDA 2,2; SKA K4000; STB GOREMA; SKA K1B4
       BRU GET10C
GET10B LDA SSB; LDX VPRRL1; C GET (READ FILE INTO PRGRM MEMORY); ER 69
       SKN GETPL; BRU CR (EXIT HERE IF 'PLACE')
       LDA GETSTL (... CONTINUE IF 'GO TO')
       SKG ZERO (... UNLESS NO START LOCN. SPECIFIED); ER 70
$GET8  CLA
       BRS 78 (DISARM INTERRUPTS FOR EXEC)
       LDA GETSTL (SET PANIC TABLE FOR FORK)
GET8A  MRG =40100000B; STA SSL; SKN GETPL
       BRU GET8B (MUST BE BRANCH OR PLACE)
*CHECK IF FILE OF DIFFERENT USER (PUBLIC)
*IF SO, WRITE ACCOUNTING
       LDA GRU; SKE FDUN; SKNE UNO; BRU GET8X (SAME USER)
       LDX FLX; LDB 3,2 (I.B.P.); C CKSSAC (GO CK IF NEC. WRITE AC.)
       C ARSS4 (SKIPPED BY CKSSAC IF NO ACCT.)
GET8B  LDP CIN; STP SSA (SETUP A AND B FOR FORK); LDA GETFN
       STA SSX (FOR STARTING WITH FILE OPEN); LDP PRGRL1; STP SSR1
       IF CEM
       LDX KM1; LDA TWO; BRS 12
       ENDF
GET8B1 C CEXFLG (CHECK EXEC FLAGS); SKN GETPL; BRU GET8C
       LDX FLX (H.T. INDEX (SEE GIFN)); LDB 2,2 (STATUS BITS)
       SKB TWO (EXEC); MRG X4; SKB FOUR (SYSTEM); MRG K4B5
       SKB EIGHT (SUB-SYS); MRG K1B6
GET8C  MRG SSL3 (NOP  SSL,3); STA GETPL; BRS 47
$GET9  BRS 9 (START UP RECOVERED FILE)
       LDP SSR1 (UPDATE PRGRL AND RETURN FOR NEXT COMMAND); STP PRGRL1
       BRU SUBRET
GET8X  LDA SSTIME; SKG ZERO; BRU GET8B
       C ENUSE; BRU GET8B
GET10C LDX JOB; LDB K2B7; SKB CPARW,2; BRU GET10B; ER 62
*      'DUMP ON '
$DUMP  C CKCM; MSET M64 (TYPE "TO FILE")
XDUMP  C EXECRL (SETUP EXEC RELABELLING TO NORMAL); CLA; STA DUMP1
       LDA PMTJOB (GET ADR. OF PMT FOR THIS JOB)
       ETR K1S5 (REMOVE X BIT, KEEP 16 BIT FIELD); STA TLV11; LDA VNCMEM
DUMP10 ADD ONE; SKG K77 (77B); BRU DUMP11; LDA DUMP1; CLB; LSH 11
       LDB FOUR; SKN SWOFF (CK IF FORCED OFF DUMP STARTED)
       BRU OFINT2 (YES, GO CK IF /$/ FILE IN DIRECTORY)
       C GOFN (GET OUTPUT FILE NAME AND OPEN)
       C OFOKG (REQUIRE C.R. OR LIN. FD. CONFIRMING CHAR.)
OFINT3 LDA OUTFIL; C ECDUMP (DUMP ALL PAGES IN PMT); BRU CLOSE
DUMP11 STA TLV1; LDX TLV11; BRS 127 (READ A PMT BYTE); SKE ZERO
       MIN DUMP1 (COUNT NO. OF PMT ENTRIES TO SETUP SIZE OF DUMP)
       MIN TLV11 (GO TO NEXT PMT ENTRY); LDA TLV1; BRU DUMP10
ECDUMP STA ECDFIL; LDA SYSVER; WIO ECDFIL
       LDA SYSTL; SKE KM1; BRU ECDMP1; WIO ECDFIL; WIO ECDFIL
ECDMP2 LDA GETSTL
       WIO ECDFIL; LDX VPRGRL; LDA FOUR; BIO ECDFIL; ER 72
       LDX VSSL; LDA SEVEN; BIO ECDFIL; ER 72
       LDA VNCMEM
ECDMP4 ADD ONE; SKG K77 (77B); BRU *+2; R1
       STA ECDMP6 (SAVE POS IN PMT TBL)
       ADD PMTJOB (COMPUTE ADR OF PMT ENTRY)
       ETR K1S5 (REMOVE X BIT, KEEP 16 BIT ADR.); COPY AX,B
       BRS 127 (GET PMT ENTRY); SKE ZERO; BRU *+3
       LDA ECDMP6 (RECOVER POS IN PMT TBL); BRU ECDMP4; LDB K77B5
       SKM K12B5; BRU ECDMP5 (NOT INDIRECT); ETR K3S4; SUB AEXSMT
       SKA X4; ER 84; ADD K100 (100B); CLB; LSH 12; MRG ECDMP6
       WIO ECDFIL; BRU ECDMP7
ECDMP5 LDA ECDMP6; WIO ECDFIL (WRITE NO. OF PMT ENTRY)
        BRS 43; LCY 6; ETR KS6B2; MRG ECDMP6; RCY 6
       BRS 44; LDA K4000 (4B3); LDX K2B4 (2B4); BIO ECDFIL; ER 72
ECDMP7 LDA ECDMP6; BRU ECDMP4
ECDMP1 WIO ECDFIL; LDA* SYSTL; ETR K77B6; WIO ECDFIL; BRU ECDMP2
ECRECV STA ECRFIL; WIO ECRFIL; SKE SYSVER; ER 71
       WIO ECRFIL; STA SYSTL; SKE KM1; BRU ECRV1; WIO ECRFIL
ECRV2  WIO ECRFIL; STA GETSTL
       LDA VPRGRL; STA TLV1; C TREL; C TREL; C TREL; C TREL
       LDA SEVEN; LDX VSSL; BIO ECRFIL; ER 72
ECRV5  WIO ECRFIL; SKNE TERMWD; BRU ECRV8; STA ECRV6
       SKG K77 (77B); BRU ECRV5A; ETR K77 (77B); CAX; LDA ECRV6; LRSH 12
       MRG X4; CXB; BRS 56; BRU ECRV5
ECRV5A BRS 120; BRS 43; LCY 6; ETR KS6B2; MRG ECRV6; RCY 6; BRS 44
       LDA K4000 (4B3); LDX K2B4 (2B4); BIO ECRFIL; BRU ECRV9; BRU ECRV5
ECRV1  WIO ECRFIL; LDB K77B6; LDX VSYSHT
ECRV1B SKB 0,2; BRU *+2; ER 71 (ID IS ZERO, END OF LIST)
       SKM 0,2; BRU ECRV1A; STX SYSTL; BRU ECRV2
ECRV1A EAX 3,2; EAX 1,2; SKN -1,2; BRU *-2; BRU ECRV1B
ECRV9  LDA ECRFIL; SKA K4B4 (4B4) (ERROR BIT); ER 72
ECRV8  BRS 43; CLB; BRS 44; R1
*TEST RELABELLING BYTE
TREL   WIO ECRFIL; STA TLV11; CAB
TREL2  SKB KM1; BRU TREL1
       LDA TLV11; STA* TLV1; MIN TLV1; R1
TREL1  CLA; LSH 6; SKG K17; SKG ZERO; SKNE K43; ER 72; BRU TREL2
*      'RECOVER FROM'
$REC   C RECSR; BRU CLOSE
RECSR  C CKCM; MSET M56 (TYPE "FROM FILE")
       C KILL6 (RELEASE ALL PAGES IN PMT)
       C GIFN (GET INPUT FILE NAME AND OPEN); CBA; SKE FOUR
       ER 83 (NOT DUMP FILE); LDA INFIL
       C ECRECV (RECOVER DUMPED RELABELLING AND ALL PAGES DUMPED)
       R1 RECSR
*      RUN DOES RECOVER FOLLOWED BY CONTINUE
$RUN   C RECSR; CLA; XMA INFIL; BRS 20; BRU CONT
*      'DELETE FILE'
$DEL   C CKCM
DELA   MSET M72 (TYPE "FILE" IF COMMAND FOLLOWED BY C.R. CH.); C GTNM
       BRU DELB; C FNLB; BRU DELB; C DELFLS; BRU DELC
DELA1  BRS 47; CIO CIN
       SKE CRCH (IF NOT, GET NEXT NAME); BRU DELA+1; BRU CR
DELB   MSET M77; LDP FNPTR (GET CHARS ALREADY TYPED); LDX COUT 
       BRS 35 (TYPE FILE NAME); BRU ERRET
DELC   LDA ERCODE; SKE ONE; BRU ERRET; BRU DELA1

*      'UNUSED MEMORY IS'
$UM    BRS 70 (READ NO. OF PMT BYTES LEFT); CLB
       LSH 1 (CHANGE TO K WORDS)
       C PDNO (TYPE NO. OF K PAGES OF UNUSED MEMORY); TCF V53B
       BRU CR
*      '"'
$QT    CIO CIN; LDB CIN; CIO CIN; SKE EOTCH; SKNE TWO; BRU CR
       SKB KM1; CIO COUT (COMMAND FILE, ECHO CHARS. TO TTY); BRU QT+1
*TYPE DATE AND TIME FOR ENTER AND "DATE" COMMAND
$TDATE LDA REAL
$BDATE MUL TMK; ADD TYMTIM
$XTDAT BSS 0
$TDATE1 STA GET1; BRS 43; STB XT6; LDB KFIOPG; BRS 44
       LDA GET1; LDX K12B5; C CDX; STA GET1
       BRS 43; LDB XT6; BRS 44; LDA GET1
       ETR K3S6 (REMOVE YEAR BITS)
       LRSH 16 (TAKE OUT MONTH); ADD ONE; C PDNO (TYPE MONTH); TCF K17
       LDA GET1; ETR K1S5 (EXTRACT  OUT THE MINUTES); RSH 23; DIV K1440D
       STB GET1 (SAVE THE MINUTES OF THE DAY); ADD ONE (ADJUST THE DAY)
       C PDNO (TYPE DAY); TCF K17; LDA YEAR; ADD K100 (64); C PDNO
TDAT   MSET M19 (TYPE A COUPLE OF SPACES); LDA GET1; RSH 23
       DIV K74 (60D)(COMPUTE HOURS); STB GET1 (SAVE MINUTES)
       C PDNO (TYPE HOURS); TCF COLNCH; LDA GET1; SKG NINE
       TCF K20 (0)(LEADING ZERO); C PDNO (TYPE THE MINUTES); R1 TDATE
$PTIME RSH 23; DIV K74 (60D); RSH 23; DIV K3600D
       STB GET1 (SAVE MINUTES AND SECONDS); C PDNO (TYPE HOUR)
       TCF COLNCH; BRU TDAT+1
*OFF INTTERUPT ROUTINE. CAUSES DUMP IF VALID USER NO. AND
* THE SPECIAL DUMP FILE IN DIRECTORY.
$OFFINT  CLA; STA SWOFF (SET SW. TO FORCE OFF); STA OPNCN
 BRS 78 (CLR INT MASK); LDX JOB; STA FGLIST,2; STA GBUSY,2; LDA UNO
       SKE ZERO; BRU OFDUM (GO DUMP); BRS 8
       LDA K1000D (DELAY TO ALLOWTTY TO BE SHUT OFF); BRS 81
       BRU LGOUT4 (DONT ON CONTINUE (NO USER NO.))
OFDUM  LDA SWPRP; SKNE VGOTO
       BRU OFINT1; SKE VRUN; BRU XDUMP
$OFINT1 C KILL6 (RELEASE PROGRAM MEMORY); BRS 8 (CLOSE ALL FILES)
       C WRACT (WRITE ACCOUNTING TAPE); BRU LGOUT4
$OFINT2 C GOFND (OPEN SPECIAL OFF DUMP FILE); BRU OFINT1 (NO SUCH FILE)
       BRU OFINT3 (CONTINUE DUMP)
$WRACT C GTFIO; BRU AROF       LOGOFF ACCOUNTING
*      TYPES CURRENT DATE AND TIME
$DATE  C TDATE; BRU CR
*PARAMETER SEPARATOR, ALLOWS AND STRING OR ,
$SEP   CIO CIN
SEP2   SKNE ZERO; BRU SEP3; SKNE COMCH; R1 SEP
       SKNE LINF (EXIT ON COMMA); R1 SEP; SKE CRCH
       BRU ERRET (NO VALID SEPARATOR); R1 SEP
SEP3   CIO CIN (IGNORE LEADING SPACES); SKNE ZERO; BRU SEP3
       CIO CIN (IGNORE ALL CHARS., TERMINATE ON SPACE); SKE ZERO
       BRU *-2; R1 SEP
$XSEP  CBA
       BRU SEP2
$LETTER CIO CIN; SKG ZERO; BRU *-2 (IGNORE LEADING SPACES)
       SUB K20 (20B)(CHANGE TO TRUE BINARY NO, 1 TO 6); SKG SIX
       SKG ZERO (CK IF NUMBER WITHIN RANGE); ER 74; C TPLET; BRU CR
$TPLET SUB ONE; CLB; LSH 1 (LETTER NO. IN A, 2 DISC BITS PER NO.)
       ADD =LTMSG; CAB; LDA LDTEMP; LDX K200 (128)
       IF ZCHK; SKE ZERO; BRU *+2; HLT; ENDF
       BRS 124 (READ IN BROADCAST LETTER); LDA LDTEMP; MUL THREE; LSH 23
       SUB ONE; STA FNPTR (MAKE POINTER FOR MSG); LSH 9
       STA FNPTR1 (SET TO MAXIMUM SIZE (512 CHAR.)); BRU *+2; CIO ONE
       GCI FNPTR; BRU *+3; SKE EOTCH; BRU *-4; R1 TPLET
*TYPES NO. OF USERS
$CTUSER LDX =-NTTY; CLA; STA TLV1; LDA ONE
USER1  SKG EWERIS,2; MIN TLV1; BRX USER1; LDA TLV1; R1 RLV1
$XTLET C GTEX; C LDBUF; C TLET; BRU CR
$MAIL  C GTEXM (GET ALL OF USERS MAIL); BRU XMAIL
$SNMAIL C GTEXM (SEND MAIL ); BRU XSNML
XTMOT1 C GTEXM; BRU TMOT1
XENTER C GTEXM (GET 3RD AND 4TH PAGES); BRU ENTER
*REMOVES FILE WITHOUT RELEASING STORAGE
$ERASE BRU RMFL
*REMOVES FILE DIR. ENTRY FROM HASH TABLE BY POSITION
$REMFIL LDA UNO; SKE FDUN; ER 75; STA GRU
RMFL   LDA KM1; STA PVTSW
       C CKCM; MSET M80
        C RDNO (GET POS IN H.T.); STA TLV1
       C OFOKG (CK FOR C.R. CONFIRM); LDA TLV1; C FLNUM; ER 76; LDA CR3
       SKE =ERASE; BRU RMFL1
       STX XT10; C MKBUSY; BRU ERRET; LDX XT10; C FDEL; BRU CR
RMFL1  C DELFLS; BRU ERRET; BRU CR
$LETON BRS 22 (GET GUAN. TIME); LDX KMJOB
LETON1 CLB
       LDA ONE; SKG EAUNN,2 (CK IF ANYONE IN THIS SLOT)
       LDB X4 (SET SET MSG FLAG ON); CBA; ADM EAUNN,2; BRX LETON1; CLA
       STA SWLET; BRS 23; R1 RLV1
*COMMANDS FROM,  SETS CIN TO TAKE CONTROL FROM SPECIFIED FILE.
$CFRM  C CKCM; MSET M56; C GIFN
CFRM2  SKG ZERO; BRU CFRM3
       LDA GOFNFT; SKE THREE; ER 89 (FILE TYPE WRONG)
       LDB GAN; LDX FLX; LDA 2,2; SKA K4000; STB REMAC
CFRM3  CLA
       XMA INFIL (GET NEW INPUT FILE); XMA CIN (SET COMMAND INPUT FILE)
       SKE ZERO; BRS 20 (CLOSE OLD COMMAND FILE); BRU CR
$RKDIS C LDBUF
       LDX K100 (64); LDA LDTEMP; LDB K200 (200B); BRS 124; R1
*   1.7        GENERAL ROUTINE FOR BLOCK I/O FROM RELABELING OTHER THAN THE EXEC'S
       IF NEWGB

$GBIO  STX GBIOPT; STP GBIOFN (FILE NO->GBIOFN, NEG. FOR READ->GBIOSW)
       BRS 43; STP EXRL1
GBIO6  LDA 0,2; SKG 1,2; BRU GBIO3
GBIO6A LDP EXRL1; BRS 44; R2
GBIO3  ETR K3777; ADD =24B3; STA EXSX; LDA 0,2; ETR K34B3
       ADD K3777; STA GBIO2
       LDA 1,2; SKG GBIO2; STA GBIO2
       LDA GBIO2; SUB 0,2; ADD ONE; STA EXSA (WORD COUNT)
       ADM 0,2
       LDA GBIO2; LRSH 11; SUB EIGHT; LDB 3,2
       STP GBIOCR (SHIFT COUNT->GBIOCR, TBL ADDR->GBIOC2)
       COPY AX,BA; C ERB (RETRIEVE BYTE)
       STA EXSB (REL BYTE)
       LDP EXRL1; LCY 12; ETR KS6B2; MRG EXSB; RCY 12; BRS 44
       CLA; XMA EXSA (GET WD COUNT--CLEAR SWITCH)
       SKN GBIOFN; BRU GBIOS (USE BIO)
       LDB 24000B; LDB =24B3; LDA GBIOFN; ETR K3S7
       XAB; LDX K4000; SKN GBIOSW; BRS 125 (WRITE)
       SKP GBIOSW; BRS 124 (READ)
       LDA K40; ADM GBIOFN (UPDATE DISC ADDR)
GBIOS1 BRS 43; LCY 12; ETR K77; LDB GBIOC2; LDX GBIOCR; C SRB
       LDX GBIOPT; SKN EXSA (ERROR SWITCH)
       BRU GBIO6 
       LDX PDP; SKR -1,2; NOP; BRU GBIO6A (NON-SKIP RETURN)
GBIOS  LDX EXSX; BIO GBIOFN; SKR EXSA; NOP; BRU GBIOS1
$V53B  DATA 53B

       ELSE

$GBIO  STX GBIOPT (PRESERVE ENTRY DATA); STP GBIOFN (B GOES TO GBIOSW)
GBIO6  LDA 0,2 (INITIAL ADDRESS FOR TRANSFER)
       SKG 1,2 (TRANSFER COMPLETED ?); BRU GBIO3 (NO)
       R2 GBIO (RTN. WITH SKIP)
GBIO3  ETR K3777 (MOVE BLOCK-FOR-TRANSFER INTO PAGE 4 OF TRANSFER-FORK)
       ADD K2B4 (2B4); STA EXSX; LDA 0,2; ETR K34B3; ADD K3777
       STA GBIO2 (MAKE TRANSFER TO END OF BLOCK); LDA 1,2
       SKG GBIO2 (IS THIS PAGE THE LAST ?)
       STA GBIO2 (YES, ADJUST FINAL TRANSFER ADDR)
       LDA GBIO2 (DETERMINE RELABELLING FOR THIS PAGE); LRSH 11
       SUB EIGHT (8); LDB 3,2; STP GBIOCR; COPY AX,BA; C ERB
       STA EXSR1 (FORK MAP FOR P4 = MAP FOR PAGE-FOR-TRANSFER)
       LDB EXRL2 ("    "   OTHER PAGES = EXEC MAP); LSH 6; LDA EXSR1
       RSH 6; LDA EXRL1; STP EXSR1; LDX GBIOPT; LDA GBIO2; SUB 0,2
       ADD ONE; STA EXSA (NO. OF WORDS TO BE TRANSFERRED)
       ADM 0,2 (UPDATE TRANSFER ADDRESS FOR NEXT PAGE); LDA GBIOX-1
       SKN GBIOFN; LDA GBIOX; STA EXSL; LDA EXSL7; BRS 9; STX GBIO4
       LDX KM4 (TRANSMIT ANY MEMORY GRABBED BY TRANSFER)
       LDA =EXSR1 (... OPERATION TO TRANSFER-AREA'S RELABELLING); C ERB
       LDX GBIOCR; LDB GBIOC2; C SRB
       SKR GBIO4 (CHECK STATUS OF TRANSFER-FORK ON TERMINATION); R1 GBIO
       LDX GBIOPT (IF NORMAL EXIT (BRS 10), RTN FOR NEXT PAGE)
       BRU GBIO6
$EXSL7 NOP EXSL,6
       ZRO GBIODK
GBIOX  ZRO GBIOS
* FORK FOR GENERAL SEQUENTIAL I/O
GBIOS  BIO GBIOFN; HLT 53B; BRS 10
* KLUDGE FORK FOR DRUM INPUT
GBIODK LDB 20000B; LDB K2B4 (2B4)(GRAB A BLOCK FOR PAGE 4); LDA GBIOFN
       ETR K3S7 (GET DRUM ADDRESS); XAB; LDX K4000 (4B3)
       SKN GBIOSW (READ/WRITE SW.); BRU *+3; BRS 124 (READ); BRU *+2
       BRS 125 (WRITE); LDA K40 (40B); ADM GBIOFN (UPDATE DRUM ADDRESS)
       BRS 10
       ENDF
*   2.5        THIS SUBROUTINE READS A SAVE FILE INTO THE RELABELING ADDRESSED BY X
*      THE FILE NUMBER IS IN A. IT SKIPS IF IT IS SUCCESSFUL.
$GET   STA GETFN; STX GET5; SKG ZERO (MAGTAPE FILE ?); BRU *+2
       BRU GET20 (YES)
       STB GET2 (CONVERT DRUM 'FILE NO.' TO ACTUAL DRUM BLOCK); ETR K777
       CLB
       LSH 5
       MRG X4 (ADD "DRUM-FILE" MARKER BIT); STA GETFN
       LDA GET2 (EXTRACT INITIAL AND FINAL CORE ADDRESSES FROM GET2)
       ETR K3S4 (PACKED FORMAT USED IN SUB-SYS H.T. FOR)
       XMA GET2 (...NON-COMMON SUB-SYSTEMS); ETR K74B4; LRSH 3; SUB ONE
       ADD GET2; STA GET3
       CLA
       XMA GETFN; BRU GET21
GET20  LDA THREE ; STA GET4; WIO GETFN (READ INITIAL CORE ADDRESS)
       STA GET2
       WIO GETFN (READ FINAL CORE ADDRESS); STA GET3
       WIO GETFN (READ STARTING LOCATION); SKP SYSTL
       STA GETSTL; LDA GETFN; SKA K4B7; ER 69
GET21  CLB
       LDX =GET2; C GBIO (TRANSFER INTO SPECIFIED CORE RANGE)
       BRU GET21A; SKN GETSTL; BRU *+5; LDA GETSTL; ETR K3S4; STA GETSTL
       R2; LDA GETFN (CLOSE FILE); BRS 20; R2 GET
GET21A LDA GETFN; BRS 20; R1
$HMSG  STA TLV1; LDA =TLV1; LDB THREE; LDX COUT (FILE NO.); BRS 34
       TCF BLKCH; R1 RLV1
*      SETS CPU TIME LIMIT
LIMIT  C CKCM; MSET M81
       BRS 88; STA TLV1
       C RDNO; MUL K74 (60D); LSH 23; ADD TLV1; STA LMCPU; BRU CR
$CKCPU C GTEX; BRU CKCP
$CKCPU1 BRS 47; MSET M13; LDP EXECA; LDX EXECX; BRU* EXECL

*REMOVES INIT FLAGS AND DUMMY F.D. ENTRIES
*USER MUST BE ACCT SUPER IF BIT 22 IN FDCONT IS ONE
DEINIT C DEINT; BRU CR

$DEINT  LDA FDUN; STA GRU; CLA; STA GRCT; C GGRP; HLT 3776B
       LDX JOB; LDB CPARW,2; LDA FDCONT; SKA THREE; BRU DEIN1
DEIN0  CLA; STA TLV4
DEIN   MIN TLV4; LDA TLV4; C FLNUM; R1
       LDA 3,2; SKE ZERO; BRU DEIN2
       STX XT10; C MKBUSY; BRU ERRET; LDX XT10
       C FDEL; BRU DEIN
DEIN2  LDA 2,2; SKA =2B4+1; BRU *+2; BRU DEIN
       ETR =-1-2B4-1; STA 2,2; C WFD; BRU DEIN
DEIN1  SKA TWO; BRU DEIN4 (MUST BE ACCT SUPER)
DEIN3  ETR KM4; STA FDCONT; STA OVFP2
       C WFD; BRU DEIN0
DEIN4  SKB K2B6; BRU DEIN3; ER 82

*OPENS OUTPUT FILE FOR EXEC MESSAGES AND OTHER GENERAL OUTPUT
TOUT   C CKCM; MSET M64
       LDB THREE; C GOFN; XMA COUT; BRS 20; CLA; STA OUTFIL; BRU CR

* EXEC SUBROUTINES (BRS 141)

XST    BRU XSUB0; BRU XSUB1; BRU XSUB2; BRU XSUB3; HLT 10000; BRU XSUB5
       HLT SYSHT
       BRU XSUB7; HLT CHT; BRU XSUB9; BRU XSUB10; HLT EXIT; BRU XSUB12
EXST   EQU *-1
$EXSUB  XXA
       SKG =EXST-XST (CK IF IN RANGE OF TABLE); SKG KM1; HLT PRINT; XXA
       LDP UA; BRU XST,2
XSUB0  C LETON (TURN LETTER ON FOR ALL CURRENT USERS); BRU BRS111
XSUB1  SKNE FDUN (GETS F.D. GROUP SPEC. IN A); BRU XSUB1A; STA FDUN; CLA
       STA GRP; STA FDAN
XSUB1A LDA KM1; STA FDCONT; BRU BRS111
XSUB2  STA MSZ2 (SW. USED TO FORCE EXIT IF MINUS); BRU BRS111
XSUB3  C CTUSER (COUNTS NO. OF SYSTEM USERS); BRU BRS111
XSUB5  C CKUSER (CKS IF USER (NO IN A) ON SYS.); BRU BRS111 (YES)
       BRU BRSEX (NO)
*MAKE GROUP BUSY.  WARNING: READ GROUP FROM DISC AFTER THIS
*CALL TO GET MOST CURRENT COPY.
XSUB7  C FLA (ANY BUSY?); BRU *+3 (YES); C FLB1; BRU BRS111
       BRS 23; BRS 45; BRU XSUB7
*      CHANGES IBP FROM 'A' AND PLUGS IN ZONE NO. - DELETES STORAGE
*      FROM OLD IBP.  USED BY 1ROD.  NO CREDIT AGAINST
*      STORAGE BASE FOR DELETED FILE OR COPY THEREOF.
XSUB9  LDX FLX; BRS 22; XMA 3,2; STA RLV4
       LDA 1,2; ETR K3S7; STA 1,2
       C DELX; BRU BRS111; BRU BRS37A
*ALLOWS PROGRAM TO WRITE ACCOUNTING
XSUB10 STP TLV22; C GTFIO; BRU ARSTG
XSUB12 LDX FLX; BRU BRS6C

* MESSAGES AND SUCH

$M3    ASC 'STARTING LOCATION /'
$M5    ASC '$ON TERMINAL /'
       IF TRU
M13    ASC '$TRU LIMIT EXCEEDED WHILE IN EXEC$/'
       ELSE
M13    ASC '$CPU TIME LIMIT EXCEEDED WHILE IN EXEC$/'
       ENDF
$M15   ASC '$MEMORY/'
$M16   ASC 'TO /'
$M28   ASC '$U.M. /'
$M30   ASC '$NOT ENTERED/'
$M33   ASC ', SYS. /'
$M34   ASC ' LOC. /'
$M38   ASC 'EX /'
$M39   ASC 'RO /'
$M40   ASC ', DISC /'
$M41   ASC '$INST.'
$M41A  ASC ' TRAP AT: /'
$M56   ASC 'FROM FILE: /'
$M57   ASC 'FIRST LOC. /'
$M58   ASC 'LAST LOC. /'
$M60   ASC 'FILE /'
$M61   ASC 'CORE LOC. /'
$M62   ASC 'SH /'
$M64   ASC ' TO FILE: /'
$M65   ASC 'TOGGLE SW. 1./'
$M66   ASC 'TTY LINE NUMBERS: /'
M67    ASC '$OUTPUT ERROR$/'
M68    ASC '$MAIL WAITING.$/'
$M69    DATA 1202017B (PERCENT/$ AND /)
$M72   ASC 'FILE(S): /'
$M77   ASC 'ERROR ON NAME: /'
M80    ASC 'FILE NO.: /'; IF TRU
M81    ASC 'ENTER TRU LIMIT: /'; ELSF 1
M81    ASC 'ENTER CPU TIME LIMIT: /'; ENDF
       NOLIST EXT
       END
EXEC ** FICHE/FRAME BREAK *****
CM SYMSORT

SYM.  PG.LN. IDENT.

A       1 24 CM93    A       1 20 CM93    A       1 14 CM93    
ABORT   6 24 CM93    ABORTB  6 25 CM93    ABORTC  6 26 CM93    B       1 25 CM93    
B       1 15 CM93    BDATE  16 11 CM93    C       1 16 CM93    CEXFLG 10 32 CM93    
CFRM   18 11 CM93    CFRM2  18 12 CM93    CFRM3  18 15 CM93    CHT     3  4 CM93    
CKCM    5 14 CM93    CKCPU  20 39 CM93    CKCPU1 21  1 CM93    CKSSAC 10 38 CM93    
CLOSE   6 32 CM93    CMLB    9 15 CM93    CMLB1   9 24 CM93    CMLB3   9 21 CM93    
CMLB4   9 22 CM93    CMND1   8 14 CM93    CMND2   8 17 CM93    CMND3   8 19 CM93    
CMND4   8 20 CM93    COMLIB  9 12 CM93    CONT   11  3 CM93    CONT1  11  8 CM93    
CONT2  11 12 CM93    CONTA  11  5 CM93    COPY   12 10 CM93    COPY3  12 27 CM93    
COPY3A 12 30 CM93    COPYA  12 33 CM93    COPYA1 12 13 CM93    COPYA2 12 17 CM93    
COPYB  12 34 CM93    COPYB1 12 19 CM93    COPYB2 12 22 CM93    COPYC  12 36 CM93    
COPYD  13  1 CM93    COPYD1 13  4 CM93    COPYE  12 35 CM93    CR      6 39 CM93    
CR1     7  8 CM93    CRA     7 16 CM93    CRA1    7 23 CM93    CRA2    7 29 CM93    
CRA2A   7 34 CM93    CRA3    8  6 CM93    CRA3A   8 31 CM93    CRA4    8 10 CM93    
CRA5    8 11 CM93    CRA6    8 12 CM93    CRAB    7 19 CM93    CSP    11 17 CM93    
CSP1   11 19 CM93    CSP2   11 18 CM93    CSYS   10  2 CM93    CSYS1  10 16 CM93    
CSYS9  10 21 CM93    CSYSA  10 11 CM93    CTUSER 17 26 CM93    DATE   17  4 CM93    
DEIN   21 10 CM93    DEIN0  21  9 CM93    DEIN1  21 16 CM93    DEIN2  21 14 CM93    
DEIN3  21 17 CM93    DEIN4  21 19 CM93    DEINIT 21  5 CM93    DEINT  21  7 CM93    
DEL    15 31 CM93    DELA   15 32 CM93    DELA1  15 34 CM93    DELB   15 36 CM93    
DELC   15 38 CM93    DUMP   14  5 CM93    DUMP10 14  9 CM93    DUMP11 14 15 CM93    
ECDMP1 14 37 CM93    ECDMP2 14 20 CM93    ECDMP4 14 24 CM93    ECDMP5 14 33 CM93    
ECDMP7 14 36 CM93    ECDUMP 14 18 CM93    ECHT    4 36 CM93    ECRECV 14 38 CM93    
ECRV1  15  9 CM93    ECRV1A 15 12 CM93    ECRV1B 15 10 CM93    ECRV2  15  1 CM93    
ECRV5  15  4 CM93    ECRV5A 15  7 CM93    ECRV8  15 14 CM93    ECRV9  15 13 CM93    
ENDUSE  9 37 CM93    ENUSE   9 39 CM93    ERASE  17 34 CM93    ERB    11 23 CM93    
ERBSH  11 26 CM93    ERRET   6 19 CM93    ERRETY  6 20 CM93    ERRETZ  6 21 CM93    
EXECP   6  5 CM93    EXECPA  6 13 CM93    EXECPI  6 16 CM93    EXECPR  6 12 CM93    
EXIT    9 26 CM93    EXSL7  19 36 CM93    EXST   21 30 CM93    EXSUB  21 31 CM93    
GBIO   19 13 CM93    GBIO   18 23 CM93    GBIO3  19 17 CM93    GBIO3  18 27 CM93    
GBIO6  19 14 CM93    GBIO6  18 25 CM93    GBIO6A 18 26 CM93    GBIODK 20  3 CM93    
GBIOS  20  1 CM93    GBIOS  19  8 CM93    GBIOS1 19  4 CM93    GBIOX  19 38 CM93    
GET    20 11 CM93    GET10  13  7 CM93    GET10A 13  8 CM93    GET10B 13 13 CM93    
GET10C 14  3 CM93    GET20  20 23 CM93    GET21  20 28 CM93    GET21A 20 32 CM93    
GET8   13 17 CM93    GET8A  13 20 CM93    GET8B  13 27 CM93    GET8B1 13 32 CM93    
GET8C  13 36 CM93    GET8X  14  1 CM93    GET9   13 37 CM93    GIFN    5 38 CM93    
GIFNE   6  1 CM93    GOFN    5 26 CM93    GOFND   5 33 CM93    GOFNE   5 31 CM93    
GOTO   13  6 CM93    HMSG   20 33 CM93    IT      1 31 CM93    K       1  6 CM93    
KILL   12  4 CM93    KILL6   5 19 CM93    KILL7   5 20 CM93    L       1  7 CM93    
LETON  18  5 CM93    LETON1 18  6 CM93    LETTER 17 15 CM93    LGOUT3  9 32 CM93    
LGOUT4  9 33 CM93    LIMIT  20 36 CM93    LKSBS   8 21 CM93    LOGOUT  9 27 CM93    
M       1  8 CM93    M13    22 24 CM93    M13    22 22 CM93    M15    22 26 CM93    
M16    22 27 CM93    M28    22 28 CM93    M3     22 19 CM93    M30    22 29 CM93    
M33    22 30 CM93    M34    22 31 CM93    M38    22 32 CM93    M39    22 33 CM93    
M40    22 34 CM93    M41    22 35 CM93    M41A   22 36 CM93    M5     22 20 CM93    
M56    22 37 CM93    M57    22 38 CM93    M58    22 39 CM93    M60    23  1 CM93    
M61    23  2 CM93    M62    23  3 CM93    M64    23  4 CM93    M65    23  5 CM93    
M66    23  6 CM93    M67    23  7 CM93    M68    23  8 CM93    M69    23  9 CM93    
M72    23 10 CM93    M77    23 11 CM93    M80    23 12 CM93    M81    23 14 CM93    
M81    23 13 CM93    MAIL   17 29 CM93    MSG     5 15 CM93    MSGX    5 17 CM93    
NM1     8 22 CM93    NM1A    8 25 CM93    NM2     8 27 CM93    NM3     8 30 CM93    
OFDUM  16 35 CM93    OFFINT 16 30 CM93    OFINT1 16 37 CM93    OFINT2 16 39 CM93    
OFINT3 14 14 CM93    OFNPTR  6  2 CM93    OFOKG   5 12 CM93    OKTOGO  5 11 CM93    
PDN2    5  1 CM93    PDNO    4 39 CM93    PONO    5  3 CM93    PRINT  12  8 CM93    
PSCN   11 38 CM93    PTIME  16 25 CM93    QT     16  7 CM93    RDNO    5  8 CM93    
REC    15 21 CM93    RECSR  15 22 CM93    REEN   11  4 CM93    REL    11 15 CM93    
RELST  11 34 CM93    REMFIL 17 36 CM93    RENTER  6 28 CM93    RESET  12  6 CM93    
RKDIS  18 18 CM93    RMFL   17 37 CM93    RMFL1  18  4 CM93    RON1    5  6 CM93    
RONO    5  5 CM93    RRR1   11 35 CM93    RRR2   11 36 CM93    RSYS   12  2 CM93    
RUN    15 29 CM93    S       1  5 CM93    SEP    17  6 CM93    SEP2   17  7 CM93    
SEP3   17 10 CM93    SINIT   9  8 CM93    SINIT1  9  9 CM93    SNMAIL 17 30 CM93    
SRB    11 31 CM93    SRBSH  11 29 CM93    SSL3   10 30 CM93    SUBIT   1 29 CM93    
SUBRET 10 24 CM93    SYSEHT  2 31 CM93    SYSHT   1 39 CM93    SYSTEM  1  3 CM93    
TDAT   16 21 CM93    TDATE  16 10 CM93    TDATE1 16 13 CM93    TOUT   21 22 CM93    
TPLET  17 18 CM93    TREL   15 16 CM93    TREL1  15 19 CM93    TREL2  15 17 CM93    
UM     16  2 CM93    USER1  17 27 CM93    V53B   19  9 CM93    VALUE   1 34 CM93    
WRACT  17  2 CM93    XDUMP  14  6 CM93    XENTER 17 32 CM93    XSEP   17 13 CM93    
XST    21 27 CM93    XSUB0  21 34 CM93    XSUB1  21 35 CM93    XSUB10 22 14 CM93    
XSUB12 22 15 CM93    XSUB1A 21 37 CM93    XSUB2  21 38 CM93    XSUB3  21 39 CM93    
XSUB5  22  1 CM93    XSUB7  22  5 CM93    XSUB9  22 10 CM93    XTDAT  16 12 CM93    
XTLET  17 28 CM93    XTMOT1 17 31 CM93    XX      1 32 CM93    YY      1 35 CM93    

EXEC ** FICHE/FRAME BREAK *****
EX
EX93   IDENT 02/24/78
*      'ENTER'
$ENTER C LDBUF; LDX VXWR1; C RDEN; BRU ENTR (NOT VALID NAME)
ENTER1 C MLUDL; STA LUDL; STA FDLUDL
       LDX JOB; CLA; STA AUNN,2; STA GRCT
       LDX TLV21 (INDEX INTO LUD, SEE RDEN); LDA 4,2 (FDPTR)
       ETR K3777
       STA FDUN; STA GRU
       LDA 4,2; LRSH 13; STA BUDGET (BUDGETED CPU)
       LDA 5,2; STA LUDWD5; RSH 16; ETR K77; STA UZONE
       CLA; LSH 16; STA PJCSW
       LDA 6,2; STA AFSV6 (FOR AF)
       ETR K1S6 (ANO); STA XT8; STA ANO; STA FDAN
       LDP 7,2 (UUN); STA AFSV7; ETR K3S5; STA UNO1
       LDX JOB; STB CPARW,2
       SKB K1B4; LDB FLAGS; SKB K1B4; BRU ENTR2
       C CKUSER; BRU ENT4 (ALREADY ENTERED)
ENT3   LDA UTTY; SKG ONE; BRU ENT1A (SPEC. STARTUP LOGIN, FOR PORT 0,1)
       LDA TLV4 (TERM. CHAR - EXECI); SKE SEMIC
       MSET EM10 (PROJ CODE)
       LDX VPJ; C GPJC; LDA PJCSW
       SKE ZERO; C CKPJC; C LDBUF (NEED BUFFER AGAIN ON ERR RET)
       LDX RLV4; LDA X4; ADM 0,2 (SET END OF PRJC FLAG)
ENT1A  LDX JOB; LDA UNO1; STA AUNN,2
*KILL TIMER
       BRS 194; CLA; BRS 78; STA 205B
       LDA UTTY; SKG ONE; BRU ENT1B
       SKN DMIN; BRU ENT1B
       C GTFIO; C IE
ENT1B  LDA UREAL; SKG ZERO; LDA REAL
       STA UREAL (FIXES UP TIME FOR TTY 0); STA LGRS; CLA; STA SWINIT
       STA GRCT; LDA FDUN; STA GRU; C GGRP; BRU ENTERH; LDA ONE
       SKA FDCONTROLS
       STA SWINIT (CAUSES SEARCH OF DIR. IN CR FOR INIT FILE); LDA OVFP
       SKE ZERO; C GBG (DO GARBAGE COLLECTION IF >1 GRP))
       LDA UTTY; SKG ONE; BRU *+2; C WRACTS; BRS 22
       LDA LUDL; LDX UTTY; XMA WERIS,2 (SAVE POSSIBLE FLAG); SKNE ZERO
       BRU *+4; STA WERIS,2 (RESTORE NONE-ZERO FLAG); BRS 23; BRU ABORT
       LDA FDUN; STA UNO; BRS 93
       LDA =SCHDLY; LDB K3S4; SKM SLOMOD; STA SLOMOD; LDA SLOMOD
       LDX JOB; LDB CPARW,2; SKB K1B5; STA SCHDLY
       BRS 23; SKB K1B6
       BRU ENTER6 (BYPASS TYM.MSG)); LDA LUDWD5; ETR K6B7; SKE K2B7
       BRU *+3; MSET EM11C; BRU *+2; MSET EM11; LDA MACH; C HMSG
       LDA UREAL (TYPE DIAL-IN TIME); C BDATE (GO TYPE DATE/TIME)
ENTER6 C CKMAIL (CHECK IF ANY MAIL WAITING); BRU ENTER7 (NO MAIL)
       LDX JOB; LDA CPARW,2; MRG TWO (SET FLAGS FOR MAIL); STA CPARW,2
ENTER7 LDA =MBX (RELEASE EXTRA PAGE); BRS 4; BRS 22
       SKN SWLET (CK IF NEW LETTER BEING ADDED); BRU *+2
       BRU RENTER (YES); LDX JOB; LDA X4 (SET SW FOR BUSY ON LETTER)
       ADM AUNN,2; BRS 23; C TLET (TYPE ALL LETTERS THIS USER)
       BRU RENTER
ENTERH C TWHY; BRU LGOUT3
ENTR   LDA UTTY; SKG ONE; BRU LGOUT4
       MSET EM5; SKP BUDGET; BRU LGOUT3
* LOG INTO OPER
       LDX =OPLUD; STX TLV21; C FHASH
       C GUN2; NOP; BRU ENTER1
OPLUD  ASC 'OPER        '
       DATA 77760025B
       DATA 12B6
       DATA 40000001B
       DATA 1000021B
       DATA 662B5
ENTR2  MSET EM6; BRU LGOUT3
ENT4   MSET EM7 (ALREADY ENTERED); LDX JOB; LDA K4B5 (BIT 6)
       SKA CPARW,2; BRU LGOUT3; BRU ENT3
WRACTS C GTFIO; BRU ARON       LOG ON ACCOUNTING
*GET PROJECT CODE
$GPJC  CLAB; STP 0,2; STP 2,2; CXA
       MUL THREE; LSH 23; SUB ONE; STA TLV1; STA TLV11
       LDX KM15; CIO CIN; SKE ZERO; BRU GPJC3; BRU *-3 (IGNORE BLANKS)
GPJC1  SKG K77; WCI TLV1 (THROW AWAY ILLEGAL CHARS); CIO CIN
GPJC3  EQU *
       IF CEM; ELSE
       SKE CONTA; BRU GPJC2
       TCO K77; GCD TLV1; BRU GPJC1+2; BRU GPJC1+2
       ENDF
GPJC2  SKE CRCH; BRX GPJC1; LDA TLV11
       SKG TLV1; ADD ONE; LRSH 23; DIV THREE; STA RLV4; R1
*MAKES UP LUD LOCATER
$MLUDL CXA; ETR K3S4; SUB LDTEMP; CLB; LSH 10; MRG TLV11 (HASH LOC); R1
*CHECK FOR VALID PROJECT CODE
$CKPJC C SLUDL; LDA 4,2 (FDPT); ETR K3777; SKG ZERO; R1
       STA GRU; CLA; STA GRCT
       LDA ONE; C FLNUM; R1 (NO FILE)
       C GIFNB; R1 (CANT OPEN)
       STA INFIL; CBA; SKE TWO; R1 (WRONG TYPE)
       RSP INFIL; LRSH 23; DIV THREE; SKB KM1; R1 (BAD FILE)
       SUB K50; RSH 2; STA TLV2 (HASH DIVISOR); C LDBUF (LOST BY GIFNB)
CKPJ   LDX VPJ; LDA 0,2; RSH 2; ADD 1,2; LSH 1; ADD 2,2; LSH 1
       ADD 3,2; MUL =6065B; DIV =37777761B; CLA; DIV TLV2
       CBA; MUL K14; LSH 23; SCP INFIL; R1 (TROUBLE IN FILE)
CKPJ1  WIO INFIL; SKE ZERO; SNE TERMWD; BRU *+2; BRU CKPJ3
       TCO CRCH; EAX EM10; C CMER; LDX VPJ; C GPJC; BRU CKPJ
CKPJ3  LDX VPJ; SKE 0,2; BRU CKPJ2
       WIO INFIL; SKE 1,2; BRU CKPJ2+1
       WIO INFIL; SKE 2,2; BRU CKPJ2+2
       WIO INFIL; SKE 3,2; BRU CKPJ1; R2 (VALID CODE)
CKPJ2  WIO INFIL; WIO INFIL; WIO INFIL; BRU CKPJ1

*QUERIES PARITY PARAMETER FROM REMOTE FOR STPAR (SEE MB)
$RRPA  LDA =252B+4B7; LDB V10000; LDX KM1; BRS 172
       LDB  =376B; SKM =312B; R1 (REMOTE MUST BE IN DUBUQUE)
       ETR ONE; CLB; LSH 12; STA TLV1 (POS. IF WE SUCCEEDED)
       LDA =315B; BRS 172 (ENABLE REMOTE XON/XOFF)
       R1

*GETS USER NO. (FILE DIR. PTR.) FROM USER NAME (TTY OR STRING)
*A REG. HAS FILE NO. IF NOT STRING
*SW60 NEG. IF STRING - USES TLV22 PTRS
$GUN   SKN SW60; BRU *+2; BRU *+2 (GO PREPARE FOR STRING)
       C FNSET (IGNORE LEADING C.R., SPACES, ETC)
       LDA K14 (12 CHARS MAX); STA TLV0
       LDA XWR1X3; STA FNPTR; STA FNPTR1; CLAB; STP XWR1
       STP XWR3; BRU GUN11
GUN1   SKR TLV0; WCI FNPTR
GUN11  SKN SW60; BRU *+2; GCI TLV22; CIO FN2 (GET INPUT CHAR.)
       SKE THREE; BRU GUN12; SKN NMCHX; BRU *+2; BRU GUN11
       LDA NMCHX
GUN12  SKE CRCH; SKNE NINE; BRU GUN1A (END OF NAME IS RT PAREN OR C.R.)
       SKE LINF; BRU *+2; BRU GUN1A
       SKE K40 (AT-SIGN); BRU *+3; LDA TEN; BRU GUN1
       SKG K77; BRU GUN1; BRU GUN11 (IGNORE CONTROLS)
GUN1A  STA XT1; SKP TLV0; ER 23
       LDX VXWR1; C RDEN (READ ENTRY FROM LUD); R1 (NOT THERE)
GUN2   LDA 6,2; ETR K1S6; STA XT8 (GLOBAL ACCT. NO.)
       LDA 8,2; ETR V7774B; STA DSTRCT
       LDA 4,2 (F.D.PTR.); ETR K3777; R2
$XWR1X3 DATA XWR1*3-1
*READS ENTRY FROM LUD GIVEN PTR TO STRING IN X
*RETURNS LOCATION OF ENTRY IN X
$RDEN  STX TLV2
       C FHASH (FORM HASH LOC)
RDEN1  C RBLK (READ BLOCK FROM DISC); LDB TLV2 (LOC. OF STRING)
RDEN2  STX TLV21; LDA 0,2; SKG ZERO; BRU RDEN3 (GO TO NEXT OR END)
       SKE* TLV2; BRU RDEN4 (NO COMPARE)
       LDA 1,2; XXB; SKE 1,2; BRU RDEN5
       LDA 2,2; XXB; SKE 2,2; BRU RDEN4
       LDA 3,2; XXB; SKE 3,2; BRU RDEN5
       XXB
       R2 (NAME COMPARES, PUT LOC. IN X)
RDEN5  XXB (RESTORE REGISTERS)
RDEN4  EAX NDATA,2; BRU RDEN2
RDEN3  SKNE ZERO; R1 (NAME NOT IN LUD)
       SKE KM1; BRU *+3; MIN TLV11 (NEXT HASH LOC.); BRU RDEN1
       SKE KM2; HLT PJ (IMPOSSIBLE ERROR?); BRU RDEN4 (EMPTY SLOT)
*FINDS HASH LOC. IN LUD GIVEN PTR TO NAME IN X
FHASH  LDA 0,2; ADD 1,2; ADD 2,2; ADD 3,2; LRSH 23
       DIV =887; STB TLV11 (SAVE HASH LOC.); R1
*READS LUD BLOCK INTO DISC TEMP. BUF.
RBLK   LDA TLV11; LRSH 23; DIV K200 (ENTRIES PER DISC)
       STB TLV1; CLB; LSH 13; ADD TLV1; ADD =320200B (FIRST DISC ADR.)
       CAB; STA TLV1; LDA LDTEMP; LDX K100
       IF ZCHK; SKE ZERO; BRU *+2; HLT; ENDF
       BRS 124; LDX LDTEMP; R1
$TIMOUT ZRO RLV4; C GTEXM; BRU XTMOT
$TLET  CLA
       STA TLV1 (LETTER NO CTR.); LDA LETP; SKG KM1
       BRU TLET4 (LETTER BITS NOT BROUGHT IN); SKG ZERO
       BRU TLET3 (LAST LETTER TYPED, GO CLEAR FLAG); TCO CRCH; TCO K15
       RSH 6
TLET1  LSH 1 (GET A BIT FOR A LETTER); STB TLV11
       MIN TLV1 (COUNT MSG NO); SKG ZERO; BRU TLET2 (NO BIT IN THIS POS)
       CLA; LDX TLV1; RCY 42,2 (REMOVE BITS COUNTED FROM STORAGE)
       STA LETP; CXA; C TPLET (GO TYPE THIS LETTER); LDB TLV11
TLET2  LDA LETP; SKG ZERO (CK IF ANY LETTERS LEFT); BRU TLET3 (NO); CLA
       LDB TLV11 (YES GET NEXT BIT); BRU TLET1
TLET3  BRS 46 (INHIBIT ESCAPES); LDX JOB; LDA AUNN,2
       ETR K3S7 (REMOVE BUSY WITH LETTER FLAG); STA AUNN,2; LDA KM1
       STA LETP (SET SW FOR NO LETTERS)
       LDA FLAGS; SKA ONE; MIN MSW (SET NO EMERG. MSG.)
       BRS 47; R1
TLET4  C LETMAP; BRU TLET3
       BRU TLET (BITS IN MAP SO GO TYPE ALL LETTERS)
*GETS A USERS LETTER MAP FOR BROADCAST LETTERS
$LETMAP LDA UNO; LDB =LMAP+4; SKG K1777; LDB =LMAP; LDA LDTEMP; LDX K400
       IF ZCHK; SKE ZERO; BRU *+2; HLT; ENDF
       BRS 124; LDA UNO; ETR K1777; RSH 2
       ADD LDTEMP (FIND WORD FOR THIS USER); AXC; LSH 2; MUL SIX; RSH 1
       LDA 0,2; STX TLV1; CBX; LCY 30,2 (POSITION 6 BITS FORTHIS USER)
       STA TLV3 (SAVE BIT MAP WORD); ETR K77 (GET THIS USERS BITS)
       STA LETP (SAVE); SKE ZERO (CK IF NO LETTERS)
       BRU LETM2 (SOME LETTERS)
LETM1  BRS 47 (ENABLE ESCAPES)
       LDA LETP (RECOVER THIS USERS BITS, IF ANY); R1
LETM2  CXA SAVE (X); LDX PDP (SET HAVE LETTER EXIT); MIN -1,2; CAX
       BRS 22; C CKMUS; SKN XT1; BRU *+3 (MULTIPLE LOGON))
       SKN SWLET (CK LETTER SW FOR BUSY); BRU *+3 (NOT BUSY); BRS 23
       BRU LETM1 (BUSY SO DONT BOTHER REMOVING BITS); LDA TLV3
       ETR KS6B2 (REMOVE THIS USERS BITS FROM MAP)
       RCY 30,2 (X STILL HAS BYTE POS.); STA* TLV1 (PUT BACK IN BIT MAP)
       LDA UNO; LDB =LMAP+4; SKG K1777; LDB =LMAP
       LDA LDTEMP (WRITE BACK ON DISC); LDX K400; BRS 125; BRU LETM1
*CK FOR MULTIPLE LOGON
*SAVES X, XT1 STAYS NEG IF ONLY 1 ON WITH SAME UUN
$CKMUS STX XT2; STB XT3; LDA KM2; STA XT1
       LDA UNO1; LDX KMJOB; LDB K3S5
       SKM EAUNN,2; BRU *+2; MIN XT1; BRX *-3
       LDX XT2; LDB XT3; R1
*   "WHO IS ON?"
$WHO   C CKCM; LDA KM1 (CAR. RET. CHAR.); STA DEL2 (SET SW.)
       CLA SETUP (FOR FIRST TTY); SKN DEL2
       C SGTNO (GET FIRST PART OF RANGE)
WHO1   STA DEL1; CAX; SKNE VNTTY; BRU CR; LDA WERIS,2; SKNE KM1; BRU WHO2A
       LDA DEL1; SKE UTTY; BRU WHON
       C MESUB; BRU WHO2A
MESUB  C PDNO; TCF TEN
       TCF BLKCH; LDX DEL1; LDA WERIS,2; C FNUS; LDA FDUN; SKNE UNO
       R1; LDA FDLUDL; C FNUS; R1
WHON   LDA WERIS,2; SKG ZERO; BRU WHON1
       LDX JOB; SKN CPARW,2; BRU WHON2 (NOT TYMSHARE)
       C PLINE; C FNUS; BRU WHO2A
WHON2  LDB CPARW,2; SKB K2B6 (CK IF ACCT. SUPER); BRU *+2; BRU WHO2A (NO)
       C SLUDL; STA TLV3 (SAVE ADR.); LDA 6,2; ETR K1S6
       SKE ANO; BRU WHO2A (NOT SAME ACCT.)
       C PLINE; LDA TLV3; C FNUS+1
WHO2A  LDA DEL1; ADD ONE (GO TO NEXT POS.); SKN DEL2 (CK SW.)
       BRU WHO4 (RANGE SW. SET); BRU WHO1 (NOT SET)
WHON1  C PLINE
       SKE ZERO (TYPE SPACE IF 0); LDA K15; CIO COUT ; LDA WERIS,2; CNA
       C PONO; TCF CRCH; BRU WHO2A
WHO4   C GTNO (GET NEXT NUMBER); BRU CR (NO MORE); BRU WHO1
PLINE  LDA DEL1; C PDNO; TCF BLKCH; LDX DEL1; LDA WERIS,2; R1

*TYPES WHO ENTRY FOR LOGGED IN USER (UTTY)
$ME    LDA UTTY; STA DEL1; C MESUB; BRU CR

*FINDS AND TYPES USER NAME GIVEN LUDL (LUD LOCATER) IN A
$FNUS  C SLUDL; LDB 6,2; STB TLV11 (TO CK IF IN-HOUSE USER)
       MUL THREE; LSH 23; SUB ONE; STA TLV22 (STRING PTR)
       ADD K14 (ALLOW FOR 12 CHARS); STA TLV23
       GCD TLV22; BRU *+3; SKG ZERO; BRU *-3 (REMOVE TRAILING SPACES)
       MIN TLV23; LDP TLV22; LDX COUT; BRS 35
       SKN TLV11; BRU FNUS1
       CLA; CIO COUT; LDA K13; CIO COUT
FNUS1  LDA CRCH; CIO COUT; R1
*SETS LUD LOCATION GIVEN LUDL IN A
*PUTS HASH LOC. IN TLV11 AND RETURNS LOC. IN A AND X
       IF -1
$SLUDL STA TLV21 (LUD LOC); C LDBUF
       CAB (LDTEMP TO B)
       LDA TLV21; BRS 98; BRU *+2; R1 (FOUND)
       ETR K1777; STA TLV11 (HASH NO.)
       C RBLK (READ LUD BLOCK)
       LDA TLV21; RSH 10; XMA TLV21 (OFFSET TO TLV21)
       COPY AB,XA (LUDL TO B, LDTEMP TO A)
       ADD TLV21 (ADD OFFSET)
       COPY BA,AX (LUDL TO A, CORE ADDR TO X)
       BRS 99; NOP
       CXA
       R1
       ELSE
$SLUDL STA TLV11; ETR K1777; XMA TLV11; RSH 10; STA TLV21
       C LDBUF; C RBLK; CXA; ADD TLV21; CAX; R1
       ENDF
*GETS RANGES OF TTY NOS FOR ANSWER,HANG UP , ETC.
$SGTNO LDA CRCH; CIT CIN; BRU *+3; MSET M66 (TYPE "TTY LINE NUMBERS: ")
       BRU SGTNO+1; LDA CR3 (CK LAST COMMAND ISSUED)
       SKE =WHO (IS IT "WHO"); C CKCS (NO, CK CONSOLE SW. 1)
GTNA   LDA KM1; C GTN; R1
GTN    STA XT10 (NEXT NO ON A RANGE)
       C RDNO (GET FIRST NO, TERM CHAR IN B)
GTN0   STP RLV4; XAB; SKNE TEN; BRU GTN4
       SKE K15 (CK IF RANGE OF NOS. INDICATED); BRU GTN2 (NO)
       C RDNO (YES, GET END OF RANGE); STB TLV4; STA XT10
GTN2   LDA TLV4; LDX* GCH1T; SKNE ETCH,2; BRU *+3
       BRX *-2; ER 73
       LDA RLV4 (FIRST NO.); R1 RLV2
GTN4   CIO CIN; CAB; LDA UTTY; BRU GTN0

$GTNO  SKN XT10 (CK IF WORKING A RANGE); BRU GTN3 (YES)
GTN1   LDA TLV4 (GET TERMINATING CHARACTER); SKNE CRCH
       R1 RLV2 (ERROR EXIT FOR NO MORE NUMBERS); LDA KM1; C GTN; R2
GTN3   MIN RLV4; LDA RLV4 (GET NEW NO. OF RANGE)
       SKG XT10 (CK IF NEW NO. IS PAST END OF RANGE)
       R2 NO, (SET NORMAL EXIT); BRU GTN1 (YES, GET NEXT NO., IF ANY)
*FINS WHAT TTY NO. FOR A USER
$FIND  LDA KM1; STA XT2; LDA CIN; C GUN; ER 78; C MLUDL
       LDX VNTTY (SCAN WERIS TABLE FOR MATCHING USER NO.)
FIND1  XXA
       SKE ZERO; BRU FIND4; SKN XT2; BRU CR
FIND2  MSET M30; BRU CR (NOT ON)
FIND4  XXA
       EAX -1,2; SKE WERIS,2; BRU FIND1
       STX TLV2; STA XT1; MSET M5; LDA TLV2
       C PDNO; MIN XT2 (FOUND ONE); LDA TLV2; SKE UTTY; BRU *+2
       TCF TEN (TYPE AST. FOR THIS USER); LDX XT1; BRU FIND4
*CHANGE FILE DIR. FOR OPERATORS
$CFD   BRU GFD
*GETS DIFFERENT USERS FILE DIR. CHANGES FDUN
$GFD   LDA CIN; STA XT10; C GUN; ER 78; STA GRU; CLB; STB GRCT
       SKNE UNO; BRU GFD1
       C GGRP; BRU GFD2
       LDA CR3; SKE =GFD; BRU GFD3 (MUST BE CFD)
       LDA XT8; SKE ANO; ER 78
       LDX JOB; LDA K2B6 (ACCT.SUP.); SKA CPARW,2; BRU GFD1
       LDA K40 (SHARABLE); SKA FDCONT; BRU GFD1; ER 78
GFD1   BRS 46; LDA GRU; STA FDUN; LDA XT8; STA FDAN; STA GAN
       LDX TLV21; C MLUDL; STA FDLUDL
       CLA; STA FLPOS; BRU CR
GFD2   C TWHY; BRU ERRET
GFD3   LDX JOB; C TXP1; BRU ERRET; BRU GFD1
*CHECKS IF A USER HAS MAIL IN THE  MAIL BOX
$CKMAIL LDA MBX; LDA =MBX; LDB =LMB; LDX K4000; BRS 124
       LDB X2 (USED TO CHECK FOR END FLAG (-1)); LDX KM4B3
       LDA LUDL (SEARCH FOR THIS USER'S MAIL)
       MRG X4 (BEGINNING OF USER'S LIST FLAGGED MINUS)
MAIL3A SKN EMBX,2; BRX *-1
       SKE EMBX,2 (FOUND BEGINNING OF A LIST OR END FLAG)
       BRU MAIL4 (NOT THIS USER); LDA EMBX+1,2
       SKG ZERO (CK IF ANY MAIL IN LIST); R1; R2
MAIL4  SKB EMBX,2 (CK FOR END FLAG); R1; BRX MAIL3A; R1
EM5    ASC '$NOT VALID USER ON THIS COMPUTER$/'
EM6    ASC '$RESTRICTED$/'
EM7    ASC '$ALREADY ENTERED$/'
$EM8    ASC 'NEW NAME: /'
$EM9   ASC ' $ENTER NEW '
EM10   ASC 'PROJ CODE: /'
       IF MDSI
EM11   ASC '$MDSI /'
       ELSE
EM11   ASC '$TYMSHARE  /'
       ENDF
EM11C  ASC '$CEGI-TYMSHARE  /'
*      GETS LISTS OF NAMES, STORES STRING PTS. IN LDTEMP
*0 PTR, END OF LIST.  
* C.R. FIRST EXIT
* ALL 2ND EXIT
* L.F. THIRD EXIT
*CONFIRMING CHAR. REMOVED EXCEPT FOR ALL
$LSNM  C LDBUF; LDA LDTEMP; ADD K100; STA TLV3; STA TLV1; ADD K100; MUL THREE
       LSH 23; STA UNPTR; STA UNPTR1; CLA; STA* TLV1
LSNM1  LDA CIN; LDB KM1; C CPSU; BRU LSNM2
       LDP FNPTR; SKSE ALLPTR; BRU *+2; R2
       GCI FNPTR; BRU *+3; WCI UNPTR; BRU *-3
       LDP UNPTR; STA* TLV1; MIN TLV1; STB* TLV1; MIN TLV1
       CLA; STA* TLV1; STB UNPTR (FOR NEXT STRING)
       CIO CIN; SKNE CRCH; R1; SKE LINF; BRU LSNM1
       LDX PDP; MIN -1,2; R2
LSNM2  MSET M77; LDP XWR3; LDX COUT ; BRS 35; CIO CIN (REMOVE BAD CHAR.)
       TCF CRCH; BRU LSNM1
ALLPTR DATA 3**+5,3**+5
       ASC 'ALL'
$LFDC6 C LSNM; BRU LFDC6B (C.R. EXIT); BRU LFDC15 ("ALL" EXIT); LDA TLV4
       ETR KM9 (REMOVE POSSIBLE NO. OPT.)); STA TLV4
       SKN TLV4 (CK IF ALL OPTIONS FLAG SET); BRU LFDC6A (GET OPTIONS)
LFDC11 LDP* TLV3; SKG ZERO; BRU LFEND (END OF LIST); STP FNPTR
       GCI FNPTR; HLT 999; WCD FNPTR; C FNLB; BRU LFDC13; LDA GRU; SKNE UNO
       BRU LFDC14-1; LDA FDCONT; SKA FOUR; BRU LFDC2A; C FPRINT
LFDC14 MIN TLV3; MIN TLV3; BRU LFDC11
LFDC15 CIO CIN; SKE CRCH; BRU *+4; SKN TLV4
       BRU LFDCA (NO OPTIONS REQ. WITH ALL); BRU LFDCC; SKE LINF; ER 63
       SKN TLV4; BRU LFDCB; BRU LFDCA (DONT GET OPTIONS)
LFDC6A C LFDC5 (GET OPTIONS); C FPHD (PRINT HEADING); BRU LFDC11
LFDC6B SKN TLV4; BRU LFDC11; LDA TLV4; ETR KM9; STA TLV4; C FPHD
       BRU LFDC11
LFDC13 MSET M77; LDP* TLV3; LDX COUT ; BRS 35; BRU LFDC14
*      GET FILE DIR. PRINT-OUT OPTIONS, SETUP TLV4
$LFDC5 MSET EM76 (TYPE "NUMBER"); C YESNO; LSH 3; STA TLV4; CXA
       SKNE CRCH; R1 RLV2; MSET EM73 (SIZE); C YESNO; ADM TLV4; CXA
       SKNE CRCH; R1; MSET EM74 (CREATION DATE); C YESNO; LSH 1
       ADM TLV4; CXA; SKNE CRCH; R1 RLV2; MSET EM75 (CONTROLS); C YESNO
       LSH 2; ADM TLV4; R1 RLV2
*      PRINT FILE DIR. HEADING
$FPHD  CLA
       SKE EXFLAG; R1 DONT (PRINT HEADING IF EXFLAG SET); LDA EIGHT
       SKA TLV4; MSET EM86 (NUMBER); LDA FOUR (CK IF CONTROLS REQUESTED)
       SKA TLV4; MSET EM81; MSET EM84; LDA TWO; SKA TLV4
       MSET EM82 (CREATION DATE); LDA ONE; SKA TLV4; MSET EM83 (SIZE)
       MSET EM85 (TYPE AND NAME); R1
*PRINTS CONTROLS FOR FILE DIRECTORY
$FPRTB LDX XT3; LDB 2,2; SKB K400 (CK IF NOT PRVT. READ)
       BRU FP2 (NOT READ); LDA MRA (READ MSG); SKB K100 (APPEND)
       BRU *+4; LDA MRW (R/W MSG); SKB K200 (CK IF NOT PRVT. WRITE)
       LDA MR (READ MSG)
FP1    C HMSG (TYPES 3 CHARS AND SPACE); LDX XT3; LDB 2,2
       LDA MNO (NO MSG); SKB K40; BRU *+2; BRU *+4
       LDA MYES (YES MSG); SKB K20; LDA MPRP
       SKB ONE; LDA MINT; C HMSG
       LDX XT3; LDB 2,2; SKB K2000; BRU *+2; BRU *+3
       LDA MWT; C HMSG
       LDX XT3; LDB 2,2; SKB K4000; BRU *+2; BRU FPRT1
       LDA MREM; C HMSG; BRU FPRT1
FP2    LDA MW (WRITE MSG); SKB K100; LDA MAP; BRU FP1
* NPVRD NPVWT PVAP  MSG
*   0     0    0    R/W
*   0     0    1    R/A
*   0     1    0    R
*   1     0    0    W
*   1     0    1    A
*OTHER COMBOS. ILLEGAL
MTYPE  ASC '   GO BINSYMDUMTMPBADBAD'
MRW    ASC 'R/W'
MRA    ASC 'R/A'
MR     ASC ' R '
MW     ASC ' W '
MAP    ASC ' AP'
MPRP   ASC 'PRP'
MYES   ASC 'YES'
MNO    ASC 'NO '
MINT   ASC 'INT'
MWT    ASC ',WT'
MREM   ASC ',RM'
       IF TRU
EM20   ASC '$YOU HAVE EXCEEDED YOUR TRU LIMIT.$/'; ELSF 1
EM20   ASC '$YOU HAVE EXCEEDED YOUR CPU TIME LIMIT.$/'; ENDF
       IF MDSI; ELSE
EM21   ASC ' CHARS. WERE REMOVED FROM YOUR TTY INPUT BUFFER.$/'
       ENDF
       IF TRU
EM22   ASC 'DO YOU WISH ANOTHER INCREMENT OF TRU?/'; ELSF 1
EM22   ASC 'DO YOU WISH ANOTHER INCREMENT OF CPU TIME?/'; ENDF
EM23   ASC '$TYPE Y OR N$/'; IF TRU
EM24   ASC '$WHAT IS THE ADDITIONAL TRU DESIRED? /'; ELSF 1
EM24   ASC '$WHAT IS THE ADDITIONAL CPU TIME DESIRED? /'; ENDF
EM26   ASC '$NOT LISTABLE$/'
EM73   ASC 'SIZE? /'
EM74   ASC 'DATE? /'
EM75   ASC 'CONTROLS? /'
EM76   ASC 'NUMBER? /'
EM81   ASC 'PVT PUB /'
EM82   ASC 'DATE USE /'
EM83   ASC ' SIZE /'
EM84   ASC 'TYP  /'
EM85   ASC ' NAME/'
EM86   DATA 1400B (SPACE,SHARP,SPACE); ASC '/  '
EM87   ASC '00000/'
EM88   ASC '$TIME OVERFLOW CRASH AT: /'


*      SETS UP INITIAL COMMANDS FROM (OR START UP) FILE
*      FIRST CHARACTER *,(,#, OR " WILL CREATE A DUMMY FD
*      ENTRY WITH A ZERO MIX WHICH IS THE NAME OF THE
*      INIT OR LIBRARY FILE.  ACCOUNT SUPERS CAN SET UP
*      INIT FILES WHICH ONLY ACCT SUPERS MAY CANCEL
$INIT  C DEINT (REMOVE EXISTING INIT FILES AND INIT FLAGS); BRS 47
       LDA KM1; STA XT12; SKN TLV22; BRU INITA
       CIO CIN; SKNE LINF; STA XT12; SKE LINF; SNE CRCH
INITA MSET M60
INITAA C GTNM; BRU INITB
       SKE TEN; SKNE THREE; BRU INITA1
       SKE EIGHT; SKNE TWO; BRU INITA1
       C FNLK; BRU INITB (NOT IN DIR.)
       SKN PVTSW; ER 75; LDA 2,2
INIT2  MRG ONE; SKN XT12; MRG K2B4; STA 2,2
       LDX JOB; LDB CPARW,2
       LDA FDCONT; MRG ONE; SKB K2B6 (ARE WE ACCT SUPER)
       MRG TWO (YES); STA TLV4
       LDA GRCT; SKE ONE; BRU INIT5
INIT6  LDA TLV4; STA FDCONT; STA OVFP2
$INITE C WFD; BRU CR
INIT5  C WFD
       CLA; STA GRCT; C GGRP; HLT XWR1; BRU INIT6
INITA1 C FNLS; BRU INIT1;* BRU INITB (ALREADY THERE--HOW COULD THIS HAPPEN)
INITB  EAX M60; C CMER; BRU INITAA
INIT1  C MKBUSY; BRU ERRET
       LDA XT9; C INSFN; BRU ERRET; C DAY; STA 0,2
       LDA X6; STA 1,2; CLA; STA 3,2; BRU INIT2

*WRITES ACCOUNTING, ENTERS NEW PROJECT CODE
$PROJ  C CKCM; MSET EM9
       LDX VPJ; C GPJC; LDA PJCSW; SKE ZERO; BRU PROJ1
PROJ2  LDX RLV4; LDA X4; ADM 0,2; C WRACT; C TIMER
       LDA REAL; STA UREAL
       BRS 93; CLA; LDX KM8; STA RSEND,2; BRX *-1
       LDA X2; MRG AFSV6; STA AFSV6 (SET PROJ CODE CHANGE BIT)
       C WRACTS; BRU ABORTC
PROJ1  C CKPJC; BRU ERRET; BRU PROJ2
*      "FILE DIRECTORY"
$LFDCOM CLA
       STA TLV4 (CLEAR OPTION SW.); STA RLV4; SKN TLV22
       BRU LFDCA (CMND FROM BRS)); CIO CIN; SKNE CRCH; BRU LFDCA
       SKE LINF; BRU LFDC4 (GET NAMES ); MSET M72 (TYPE "NAMES")
       LDA CRCH (CK NEXT CHAR); CIT CIN; BRU *+2
       BRU LFDCA (TYPE ALL, NO OPTIONS); SKE LINF; BRU LFDC6 (NAMES)
       CIO CIN (REMOVE LINE FEED)
$LFDCB C LFDC5 (GET OPTIONS DESIRED)
$LFDCC C FPHD
LFDCA  C CKLIST
LFDC3  MIN RLV4; LDA RLV4; C FLNUM; BRU LFEND
       C FPRINT; BRU LFDC3
CKLIST LDA FDUN; STA GRU; CLA; STA GRP
       LDA ONE; C FLNUM; BRU LFEND (NO FILES)
       LDA GRU; SKNE UNO; R1
       CLB; LDA FDUN; SKE GRU; STB GRP; STA GRU; SKNE UNO; R1
       LDX JOB; LDB K12B6; SKB CPARW,2; R1
       LDB FDCONT; SKB FOUR; BRU LFDC2A; R1
LFDC2A MSET EM26 (NOT LISTABLE); ER 79
LFDC4  SKE COMCH; BRU LFDC6; C RDNO; SUB ONE; STA RLV4; CBA
       SKN TLV4; BRU *+4; SKE CRCH; BRU LFDCA; BRU LFDCC
       SKE CRCH; BRU LFDCB; BRU LFDCA
LFEND  TCF CRCH; BRU CR
*      FILE DIRECTORY WITH ALL OPTIONS (DIRECTORY)
$FDIR  LDA KM1; STA TLV4 (SETS ALL); CLA; STA RLV4; SKN TLV22; BRU LFDCC
       CIO CIN; SKNE CRCH; BRU LFDCC; SKE LINF; BRU LFDC4
       MSET M72 (NAMES); LDA CRCH; CIT CIN; BRU *+2
       BRU LFDCC; SKE LINF; BRU LFDC6; CIO CIN; BRU LFDCA
*TYPES POSITION OF LAST FILE
$LAST  C FLOK; BRU LAST2; SKNE FLPOS; BRU LAST2
       SKNE FLX; BRU LAST2
       LDA FLPOS; BRU LAST1
LAST2  LDA FDUN; STA GRU; CLA
LAST1  STA RLV4; MIN RLV4; LDA RLV4; C FLNUM; BRU *+2; BRU LAST1+1
       LDA RLV4; SUB ONE; C PDNO; BRU CR
*      PRINT FILE NAME AND PARAMETERS
FPRINT TCF CRCH (TYPE C.R.); LDA FLX; STA XT3; LDA EIGHT; SKA TLV4
       BRU *+2; BRU FPRTA; LDA RLV4; SKG NINE; TCF BLKCH; C PDNO
       TCF BLKCH
FPRTA  LDA FOUR (CK IF REQUEST FOR CONTROLS); SKA TLV4; BRU FPRTB (YES)
FPRT1  LDX XT3; LDA 2,2; LDB KM1; SKB EXFLAG
       BRU FPRT2B (YES, TYPE "FILE TYPE WORD" IN OCTAL); LRSH 18
       SKNE ZERO; BRU FPRT1A (TYPE 3 SPACES FOR ZERO); LDX SEVEN
       LDB =70B; SKM K20; BRU *+3; ETR SEVEN; CAX; LDA MTYPE,2
FPRT1A C HMSG (TYPE 3 CHARS. AND SPACE); BRU FPRT3
FPRT2B C PONO; TCF COMCH; LDX XT3; LDA 3,2; C PONO
FPRT3  LDA TWO (CK IF REQUEST FOR CREATION DATE); SKA TLV4
       BRU *+2 (YES); BRU FPRT4 (NO, JUST FILE DIR.); TCF BLKCH
       LDA* XT3; ETR K1S4 (YR/DATE)); STA TLV2; RSH 5; ADD ONE
       ETR K17 (MONTH)); SKG NINE; TCF BLKCH; C PDNO; TCF K15; LDA TLV2
       ETR K37; ADD ONE (DAY)); C PDNO; SKG NINE
       TCF BLKCH (TRAILING SPACE)); C DAY; SUB TLV2
       SKG K1000 (OLDER THAN YEAR)); BRU FPRT3A; TCF EIGHT; LDA TLV2
       RSH 9; ETR K17; ADD =1964; C PDNO; TCF NINE
FPRT3A TCF BLKCH; LDA* XT3; RSH 13; SKG NINE; TCF BLKCH; C PDNO (ACCESS COUNT)
FPRT4  LDA ONE (CK IF SIZE REQUESTED); SKA TLV4; BRU *+2 (YES)
       BRU FPRT4C (FILE SIZE NOT REQ.); LDX XT3; LDA 2,2
       SKA X2 (CK IF DISC FILE); BRU *+2 (YES); BRU FPRT4C; TCF BLKCH
       LDA 1,2 (GET SIZE FROM DIREC.); ETR K3S4; SKE ZERO
       BRU FPRT4A (SIZE ALREADY THERE); LDA 3,2; SKG ZERO; BRU FPRT4A+2
       LDB K41; BRS 1; BRU FPRT4D; STA TLV1; RCS TLV1; LDA TLV1; BRS 20
       CLA; DIV =256*3/2; SKG K3S4; BRU *+2; BRU FPRT4A; LDX XT3
       ADM 1,2; STA TLV11; C MFD; BRU ERRET
       LDA TLV11 (RECOVER SIZE BACK))
FPRT4A MUL K1400; LSH 23; SKG =9999; TCF BLKCH; SKG V999; TCF BLKCH
       C PDNO
FPRT4C MSET M19; LDA XT3; C CPFN; LDP XWR3; LDX COUT; BRS 35; R1 FPRINT
FPRT4D MSET EM87; BRU FPRT4C
*LISTS FILE NAMES ONLY IN REVERSE ORDER
$LIST  C CKLIST; BRS 70; SKG ZERO; ER 80
       LDA =WORK+1; STA TLV4; LDA KM1; STA WORK
       CLA; STA RLV4
LIST1  MIN RLV4; LDA RLV4; C FLNUM; BRU LIST3 (END OF DIR.)
LIST2  LDA 4,2; STA* TLV4; MIN TLV4; SKA X4; BRU LIST1
       EAX 1,2; BRU LIST2
LIST3  CLA; STA TLV2; LDA TLV4
LIST4  CAX; EAX -1,2; SKN -1,2; BRU *-2
       STX RLV4; SUB RLV4; STA TLV1
       ADD TLV1; ADD TLV1; SKG TLV2; BRU LIST5
       TCF CRCH; LDA K72D; STA TLV2
LIST5  LDB 0,2; C OCH; BRU LIST6
       C OCH; BRU LIST6
       C OCH; BRU LIST6
LIST6  EAX 1,2; SKN -1,2; BRU LIST5
       LDA RLV4; STA TLV4; SKG =WORK+1; BRU LIST7
       SKR TLV2; TCF BLKCH; BRU LIST4
LIST7  LDA =WORK; BRS 4; BRU CR
OCH    LSH 8; ETR K177; SKE K136; BRU *+2; R1
       SKG K77; CIO COUT; SKR TLV2; R2; R2
*      ASSORTED ROUTINES FOR SYSTEM DEBUGGING COMMANDS
*      GET CORE BLOCK ADDRESS
SYSGBN C RDNO; STA TLV1; CLB; LCY 11; R1 SYSGBN
SYSGDA C RONO; STB GET1; SKG =NDISCS; BRU SYSGDC
SYSGDB MRG X4 (SET DRUM/DISC FILE FLAG); STA GET1 (DISC ADDRESS)
       R1 SYSGDA
SYSGDC MUL K2B4 (COMPUTE DISC ADR.); LSH 23
       ADD =17400B (ARM POS 63 (NEXT TO LAST)); XMA GET1
       SKE K16 (CK IF A PARTICULAR PAGE REQ.); BRU SYSGDD (NO)
       C RONO (GET PAGE NO.)
       ADM TLV2 (CONTROLS DISC ADDRESSING TO 8 PAGES)
       MUL K40 (CONVERT TO REAL DISC ADR.); LSH 23; ADM GET1
SYSGDD LDA TLV2 (TEST OF OUTSIDE OF 8 PAGE BOUND); SKG SEVEN; BRU *+2
       ER 74; LDA GET1; BRU SYSGDB
*      GET CORE LIMITS AND DRUM ADDRESS
SYSGCD C SYSGBN; STA GET2; LDA TLV1; STA TLV2; MSET M16
       C SYSGBN; ADD K3777; STA GET3
       LDA TLV1; SUB TLV2; STA TLV2; MSET M34
       C SYSGDA; R1 SYSGCD
*      READ OR WRITE ON DRUM
SYSRWD LDA VPRGRL; STA GET5; LDA GET1
       LDX =GET2; C GBIO; ER 72; R1 SYSRWD
*      SYSDUMP, SYSLOAD
$SYSDP LDA EXFLAG; SKA X2; SKN EXFLAG; ER 64
       CLA; BRU SYSLD1
$SYSLD LDA KM1
SYSLD1 STA TLV4 (SET READ/WRITE SW.)
       C SYSGCD; LDB TLV4; C SYSRWD; BRU CR
*ENABLES OR DISABLES DSS'S ACCORDING TO FLAG IN A:
*ZERO = OFF, -1 = ON.
SDSS   STA TLV2; C SGTNO
SDSS1  LDB TLV2 (RECOVER ANSWER/HANG UP SWITCH)
       BRS 129 (ANSWER OR HANG UP LINE); C GTNO; BRU CR (NO MORE NOS.)
       BRU SDSS1
*CHECKS CONSOLE SW
$CKCS  LDX ONE; CLA; BRS 130 (CK CURRENT STATE OF CONSOLE SW); CXA
       STA XT1 (SAVE STATE); MSET M65 (TYPE "TOGGLE SW. 1"); LDX ONE
       CLA; BRS 130 (READ NEW STATE OF CONSOLE SW.); CXA
       SKE XT1 (CK IF SAVE AS ORIGINAL STATE); BRU *+3; BRS 45
       BRU *-6 (SAME, WAIT UNTIL SW. CHANGES STATE)
       TCF CRCH (CONFIRM WITH CAR. RET.); R1
$SHUT  C CKTIME; C CKCS (SHUTS DOWN THE SYSTEM BY FORCING); CLA
       BRS 159 (SET DOWN)); CLB; LDA VNTTY
SHUT1  SUB ONE (GO TO NEXT TTY); CAX; SKNE ZERO (CK IF LAST TTY); BRU CR
       SKN WERIS,2 (IS DSS BEING USED); BRU SHUT1 (YES, DONT HANG UP)
       BRS 129 (DISABLE DSS THATS NOT BEING USED); BRU SHUT1
*      CANCEL OUT THE SHUT COMMAND AND ALLOW NEW USERS
*      LINES MUST BE RE-ANSWERED WITH THE ANSWER COMMAND
$GOUP  C CKTIME; LDA ONE; BRS 159 (SET SYSTEM UP)); BRU CR
*HANGES UP SELECTED DSS.
$HANG  CLA
       BRU SDSS
*CHECKS REAL FOR POTENTIAL OVERFLOW
$CKTIME SKN FATIG (SET BY MON. WHEN CLOSE); BRU *+2; R1 RLV3
       MSET EM88 (TIME OVERFLOW CRASH); LDA K3S7; C BDATE
       TCF CRCH; R1
$LOOK  C RONO (LOOKS AT DESIRED LOCS IN REAL ADR.)
       STA TLV1 (STARTING ADDRESS); C RDNO
       STA TLV11 (NO. OF LOCATIONS DESIRED); CLB
LOOK1  SKR TLV11 (COUNT DOWN NO. OF LOCATIONS REQUESTED); BRU *+2
       BRU CR; LDA TLV1; C PONO; TCF BLKCH; LDX TLV1
       BRS 127 (READ CONTENTS OF REAL ADDRESS (16 BIT))
       C PONO (TYPE SAME); TCF CRCH; MIN TLV1; BRU LOOK1
*HANGS ALL USERS,WRITES ACCOUNTING AND "CRASHES" SYSTEM
$CRASH C CKCS (CHECK BP SWITCH 1); CLA; BRS 159 (SHUT)
       SKE UTTY; BRS 166 (HANG PORT 0 IF NOT ME)
       ADD ONE; SKE UTTY; BRS 129 (HANG A USER); SKG =NTTY-2
       BRU *-4
CRSH2  C CTUSER; SKG ONE; BRU *+3; BRS 45; BRU CRSH2
       SKN MASTER; BRU CRSH4
       C GTXFD; C CRSH3; C XFDRET
CRSH4  CLA; STA ACTIME; C WRACT
       C TIMER; BRS 55; BRS 180
*      'PLACE'
$PLACE C CKCM; MSET M56 (FROM FILE); CLA; BRU GET10
*      'BRANCH TO'
$BRANCH C CKCM; MSET M61 (TYPE CORE LOC.); C RONO (READ CORE LOCATION)
       XAB; SKE CRCH; ER 63; STB GETSTL; STA GETPL; BRU GET8
*      'SAVE CORE FROM '
$SAVE  C CKCM; MSET M57 (FIRST LOC.); C RONO (READ FIRST CORE LOCATION)
       STA SAVEFL; C XSEP (IGNORE SEPARATOR STRING); SKNE CRCH
       MSET M58 (LAST LOC.); C RONO (LAST CORE LOCATION); STA SAVELL
       C XSEP (IGNORE SEPARATOR STRING); SKNE CRCH
       MSET M64 (TYPE "TO FILE")
SAVEA  LDA SAVELL (READ O/P FILE NAME AND OPEN FILE OF TYPE 1 AND APPROPRIATE LENGTH)
       SUB SAVEFL; ADD ONE; LDB ONE; C GOFN; STA SAVEOR (FILE NO.); CLA
       STA SAVESL; CBA
       SKG ZERO (FILE-NAME-TERMINATING-CHAR RECEIVED ?)
       CIO CIN (NO, READ ANOTHER); SKA KM200; CIO CIN
       SKNE CRCH (YES, IS IT CAR. RET. CH.); BRU SAVE1
       SKE LINF (CK IF LINE FEED CH.); BRU SAVEB
       MSET M3 (REQUEST STARTING LOCATION)
       C RONO (... READ STARTING LOCATION); STA SAVESL; C OFOKG
SAVE1  LDA SAVEFL (WRITE OUT CORE BOUNDS AND STARTING LOCATION)
       STA GET2 (FIRST CORE LOCATION); WIO SAVEOR; LDA SAVELL
       STA GET3 (LAST CORE LOCATION); WIO SAVEOR; LDA SAVESL
       WIO SAVEOR (STARTING LOCATION)
       LDA VPRRL1 (SET UP DATA FOR GBIO, PERFORM INFORMN. TRANSFER)
       STA GET5; LDX =GET2; LDA SAVEOR; C GBIO; ER 72; BRU CLOSE
SAVEB  EAX M64; C CMER; BRU SAVEA
* PRINT ELAPSED TIME
$PT    C TIMER; BRU CR
       IF TRU
$TIMER BRS 88; ABC; DIV K30D
       ELSF MDSI
$TIMER MSET M10
 BRS 88; ABC; DIV K30D; MUL K50D; DIV THREE; ADD FIVE
 RSH 23; DIV TEN; SKG =99; TCF K20; SKG NINE; TCF K20
 C PDNO
 MSET M11
 LDA UREAL; MUL TMK; ADD TYMTIM; STA GET1 (LOGIN TIME IN CUBS)
 LDA REAL; MUL TMK; ADD TYMTIM; SUB GET1
 MUL =46604; STA GET1
 CBA; LRSH 1; ADD =25000; LSH 1; COPY AB,XA
 SKA K4B7; MIN GET1; LDA GET1; RSH 4; DIV =3125
 RSH 23; DIV K100D; STB GET1 (HUNDREDTHS)
 SKG NINE; TCF ZERO; C PDNO
 TCF K16
 LDA GET1; SKG NINE; TCF K20; C PDNO
 MSET M12
       ELSF 1
$TIMER MSET M11; BRS 88; ABC; DIV K30D
       ENDF
       IF MDSI
       ELSE
       C PDNO; MSET M12
       MSET M10; LDA REAL; SUB UREAL; C PTIME; TCF CRCH
       ENDF
       R1
       IF MDSI
M10    ASC '$USAGE$CCU:   /'
       ELSE
M10    ASC '$TERMINAL TIME: /'
       ENDF
       IF TRU
M12    ASC ' TRU/'
       ELSF MDSI
M11    ASC '$CLT:  /'
M12    ASC '  HOURS$/'
       ELSF 1
M11    ASC '$CPU TIME: /'
M12    ASC ' SECS./'
       ENDF
*      TYPES ERROR MESSAGE
$WHY   C TWHY; BRU CR
*      CHECKS CPU TIME (SEE 10003, FROM MONITOR INTERRUPT)
$CKCP  CLA; STA TLV1 (INPUT CHARACTER COUNT)
       LDX KM1; BRU *+3
       MIN TLV1; CIO ZERO; BRS 13; BRU *-3 (BUFFER NOT EMPTY)
       MSET EM20 (YOU HAVE EXCEEDED YOUR CPU LIMIT)
       IF MDSI; ELSE
       LDA TLV1; SKG ZERO; BRU CKC1; C PDNO; MSET EM21
       ENDF
CKC1   MSET EM22 (DO YOU WISH A NEW LIMIT)
       LDB TEN; CLX; BRS 38
       SKG ZERO; BRU *+2; BRU CKC1A
       CBA
       SKNE V56B; BRU CKC2
       SKE =71B; BRU CKC3; CIO ZERO; SKE CRCH; BRU *-2
       MSET EM24 (WHAT IS THE ADDITIONAL CPU TIME DESIRED)
       LDB TEN; CLX; BRS 38
CKC1A  MUL K74; LSH 23; STA LMCPU; BRS 88; ADM LMCPU
       BRU CKC2A
CKC2   CIO ZERO; SKE CRCH; BRU *-2
CKC2A  BRS 22; BRS 47; LDA GETPL
       SKN SYSTL; BRU CSYS9; BRU GET9
CKC3   LDX KM1; BRS 14; BRS 11; MSET EM23 (TYPE Y OR N); BRU CKC1
*      SETS 1 IN A FOR Y(YES) INPUT, TERM CHAR. IN X
YESNO  CIO CIN; LDX ONE; SKNE =71B; BRU YES1; CLX; SKNE V56B
       BRU YES1; SKNE CRCH; BRU YES1; SKE LINF; ER 77
YES1   SKE CRCH; BRU *+3; COPY AX,XA,B; R1; SKNE LINF; BRU *-3; CIO CIN
       BRU YES1
*      TYPE SYSTEM NO.
$SYSNO C TSYSNO; BRU CR
$TSYSNO TCF CRCH; C RKDIS; LDX LDTEMP; LDA 75B,2; SKA FOUR; MRG K100
       ETR =760B; XMA EQPT; ETR K17; ADM EQPT
       LDA 77B,2; STA MACH; C HMSG
        MSET M40; LDA DISCN (DISC NO.); C PONO; MSET M33 ("SYSTEM")
       TCF =SYSLET (SYSTEM LETTER)
       LDA =VERS (ADR. OF MONITOR VERSION NO.); LDX COUT ; LDB SIX
       BRS 34; TCF K15; LDA EQPT; C PONO; TCF K15
       MSET SYSTEM (EXEC NO.); R1
*      'STATUS'
$MA    LDA PRGRL1; MRG PRGRL2
       SKNE ZERO (TEST IF ANY PROGRAM RELABELLING TO TYPE); BRU MA2 (NO)
       MSET M25 (TYPE "PROGRAM")
       EAX PRGRL1 (SET X TO PROGRAM RELABELLING WORDS)
       C PRMA (PRINT PROGRAM MEMORY ASSIGNMENT)
MA2    SKN SYSTL (IS A SUB-SYSTEM BEING USED); BRU *+2 (YES); BRU MA1
       TCF CRCH; C PSCN (PRINT SUB-SYSTEM NAME); MSET M26
       EAX SSRL (PRINT SUB-SYSTEM MEMORY ASSIGNMENT)
       C PRMA (TYPE  "M.S.")
MA1    MSET M28 (TYPE "U.M."); BRU UM (GO PRINT UNUSED MEMORY)
*      PRINT MEMORY ASSIGNMENT
PRMA   STX DEL2; LDX KM8
PRMA5  STX DEL3; LDA DEL2; C ERB (EXTRACT BYTE OF RELABELLING WORD)
       SKG ZERO (CK IF ZERO); BRU PRMA4 (YES, SO JUST TYPE A DASH)
       C PONO (TYPE THE BYTE)
PRMA3  LDB K17; LDA DEL3
       SKE KM5 (TYPE EITHER SPACE BETWEEN DASHES OR SLASH)
       CLB ...BETWEEN (4 RELABELLING BYTES); CBA; CIO COUT ; LDX DEL3
       BRX PRMA5 (GO TO NEXT BYTE); R1 PRMA
PRMA4  TCF K15; BRU PRMA3
*PRINT BASE AND MAX STORAGED USED.  TYMSHARE PROPRIETARY.
$DSC   C GTXFD; BRU DSC1
$SDLY C CKCM; BRU SDLY1; BRS 71; BRU ERRET; CBA; SKE K6B7; BRU ERRET
       C RONO; SKG K77; SKG KM1; BRU ERRET
       CLB; LSH 15; STA SCHDLY; BRU CR
SDLY1  LDA SCHDLY; LRSH 15; C PONO; BRU CR
*DIALS PORT GIVEN.  CURRENT COMMAND PORT BECOMES AN AUXILLIARY PORT
$DIAL  LDA CIN; C GUN; ER 78; LDA XT8; SKE ANO; ER 74
       C MLUDL (FORM LUD LOCATOR IN 'A')
       LDB KM1; STB TLV1
       LDX VNTTY
DIAL1  EAX -1,2; SKE WERIS,2; BRU DIAL2; SKN TLV1; ER 74
       STX TLV1
DIAL2  CXB; SKB K3S4; BRU DIAL1
       LDA =60000; LDX KM1; BRS 164 (LET ALL OUTPUT GET OUT)
       LDX TLV1; BRS 46
       SKN TLV1; BRS 195; BRU FIND2 (NOT LEGAL); BRU OFINT1
*TOGGLES ERRSW - IF NOT -1, TYPES ERROR MSGS.
$ERRORS CLA; SKN ERRSW; LDA KM1; STA ERRSW; BRU CR
*CONSTANTS
$KM15  DATA -15B
$K50   ZRO 50B
$K72D  ZRO 72
       NOLIST EXT; END
EXEC ** FICHE/FRAME BREAK *****
EX SYMSORT

SYM.  PG.LN. IDENT.

ALLPTR  9 31 EX93    BRANCH 17 12 EX93    CFD     8 17 EX93    
CKC1   19 11 EX93    CKC1A  19 19 EX93    CKC2   19 21 EX93    CKC2A  19 22 EX93    
CKC3   19 24 EX93    CKCP   19  4 EX93    CKCS   16 10 EX93    CKLIST 13 15 EX93    
CKMAIL  8 32 EX93    CKMUS   6  2 EX93    CKPJ    3 13 EX93    CKPJ1   3 16 EX93    
CKPJ2   3 22 EX93    CKPJ3   3 18 EX93    CKPJC   3  6 EX93    CKTIME 16 28 EX93    
CRASH  16 39 EX93    CRSH2  17  4 EX93    CRSH4  17  7 EX93    DIAL   20 29 EX93    
DIAL1  20 33 EX93    DIAL2  20 35 EX93    DSC    20 23 EX93    EM10    9  7 EX93    
EM11    9 11 EX93    EM11    9  9 EX93    EM11C   9 13 EX93    EM20   11 17 EX93    
EM20   11 16 EX93    EM21   11 19 EX93    EM22   11 23 EX93    EM22   11 22 EX93    
EM23   11 24 EX93    EM24   11 26 EX93    EM24   11 25 EX93    EM26   11 27 EX93    
EM5     9  2 EX93    EM6     9  3 EX93    EM7     9  4 EX93    EM73   11 28 EX93    
EM74   11 29 EX93    EM75   11 30 EX93    EM76   11 31 EX93    EM8     9  5 EX93    
EM81   11 32 EX93    EM82   11 33 EX93    EM83   11 34 EX93    EM84   11 35 EX93    
EM85   11 36 EX93    EM86   11 37 EX93    EM87   11 38 EX93    EM88   11 39 EX93    
EM9     9  6 EX93    ENT1A   1 24 EX93    ENT1B   1 30 EX93    ENT3    1 18 EX93    
ENT4    2 27 EX93    ENTER   1  3 EX93    ENTER1  1  4 EX93    ENTER6  2  7 EX93    
ENTER7  2  9 EX93    ENTERH  2 14 EX93    ENTR    2 15 EX93    ENTR2   2 26 EX93    
ERRORS 21  1 EX93    FDIR   13 27 EX93    FHASH   4 32 EX93    FIND    8  6 EX93    
FIND1   8  8 EX93    FIND2   8 10 EX93    FIND4   8 11 EX93    FNUS    6 35 EX93    
FNUS1   7  3 EX93    FP1    10 26 EX93    FP2    10 34 EX93    FPHD   10 15 EX93    
FPRINT 13 39 EX93    FPRT1  14  4 EX93    FPRT1A 14  8 EX93    FPRT2B 14  9 EX93    
FPRT3  14 10 EX93    FPRT3A 14 18 EX93    FPRT4  14 19 EX93    FPRT4A 14 28 EX93    
FPRT4C 14 30 EX93    FPRT4D 14 31 EX93    FPRTA  14  3 EX93    FPRTB  10 22 EX93    
GFD     8 19 EX93    GFD1    8 26 EX93    GFD2    8 29 EX93    GFD3    8 30 EX93    
GOUP   16 23 EX93    GPJC    2 31 EX93    GPJC1   2 34 EX93    GPJC2   3  1 EX93    
GPJC3   2 35 EX93    GTN     7 28 EX93    GTN0    7 30 EX93    GTN1    7 39 EX93    
GTN2    7 33 EX93    GTN3    8  2 EX93    GTN4    7 36 EX93    GTNA    7 27 EX93    
GTNO    7 38 EX93    GUN     3 34 EX93    GUN1    3 39 EX93    GUN11   4  1 EX93    
GUN12   4  4 EX93    GUN1A   4  8 EX93    GUN2    4 10 EX93    HANG   16 25 EX93    
INIT   12  8 EX93    INIT1  12 28 EX93    INIT2  12 17 EX93    INIT5  12 24 EX93    
INIT6  12 22 EX93    INITA  12 11 EX93    INITA1 12 26 EX93    INITAA 12 12 EX93    
INITB  12 27 EX93    INITE  12 23 EX93    K50    21  4 EX93    K72D   21  5 EX93    
KM15   21  3 EX93    LAST   13 32 EX93    LAST1  13 36 EX93    LAST2  13 35 EX93    
LETM1   5 29 EX93    LETM2   5 31 EX93    LETMAP  5 21 EX93    LFDC11  9 36 EX93    
LFDC13 10  7 EX93    LFDC14  9 39 EX93    LFDC15 10  1 EX93    LFDC2A 13 21 EX93    
LFDC3  13 13 EX93    LFDC4  13 22 EX93    LFDC5  10  9 EX93    LFDC6   9 33 EX93    
LFDC6A 10  4 EX93    LFDC6B 10  5 EX93    LFDCA  13 12 EX93    LFDCB  13 10 EX93    
LFDCC  13 11 EX93    LFDCOM 13  3 EX93    LFEND  13 25 EX93    LIST   14 33 EX93    
LIST1  14 36 EX93    LIST2  14 37 EX93    LIST3  14 39 EX93    LIST4  15  1 EX93    
LIST5  15  5 EX93    LIST6  15  8 EX93    LIST7  15 11 EX93    LOOK   16 31 EX93    
LOOK1  16 34 EX93    LSNM    9 20 EX93    LSNM1   9 22 EX93    LSNM2   9 29 EX93    
M10    18 29 EX93    M10    18 27 EX93    M11    18 37 EX93    M11    18 34 EX93    
M12    18 38 EX93    M12    18 35 EX93    M12    18 32 EX93    MA     20  2 EX93    
MA1    20 11 EX93    MA2    20  7 EX93    MAIL3A  8 36 EX93    MAIL4   9  1 EX93    
MAP    11  8 EX93    ME      6 32 EX93    MESUB   6 13 EX93    MINT   11 12 EX93    
MLUDL   3  4 EX93    MNO    11 11 EX93    MPRP   11  9 EX93    MR     11  6 EX93    
MRA    11  5 EX93    MREM   11 14 EX93    MRW    11  4 EX93    MTYPE  11  3 EX93    
MW     11  7 EX93    MWT    11 13 EX93    MYES   11 10 EX93    OCH    15 12 EX93    
OPLUD   2 20 EX93    PLACE  17 10 EX93    PLINE   6 29 EX93    PRMA   20 13 EX93    
PRMA3  20 17 EX93    PRMA4  20 21 EX93    PRMA5  20 14 EX93    PROJ   12 33 EX93    
PROJ1  13  1 EX93    PROJ2  12 35 EX93    PT     17 37 EX93    RBLK    4 35 EX93    
RDEN    4 16 EX93    RDEN1   4 18 EX93    RDEN2   4 19 EX93    RDEN3   4 28 EX93    
RDEN4   4 27 EX93    RDEN5   4 26 EX93    RRPA    3 25 EX93    SAVE   17 15 EX93    
SAVE1  17 29 EX93    SAVEA  17 20 EX93    SAVEB  17 35 EX93    SDLY   20 24 EX93    
SDLY1  20 27 EX93    SDSS   16  5 EX93    SDSS1  16  6 EX93    SGTNO   7 24 EX93    
SHUT   16 16 EX93    SHUT1  16 18 EX93    SLUDL   7 20 EX93    SLUDL   7  7 EX93    
SYSDP  15 37 EX93    SYSGBN 15 16 EX93    SYSGCD 15 29 EX93    SYSGDA 15 17 EX93    
SYSGDB 15 18 EX93    SYSGDC 15 20 EX93    SYSGDD 15 26 EX93    SYSLD  15 39 EX93    
SYSLD1 16  1 EX93    SYSNO  19 31 EX93    SYSRWD 15 34 EX93    TIMER  18 18 EX93    
TIMER  18  2 EX93    TIMER  17 39 EX93    TIMOUT  5  1 EX93    TLET    5  2 EX93    
TLET1   5  7 EX93    TLET2   5 11 EX93    TLET3   5 13 EX93    TLET4   5 18 EX93    
TSYSNO 19 32 EX93    WHO     6  7 EX93    WHO1    6 10 EX93    WHO2A   6 23 EX93    
WHO4    6 28 EX93    WHON    6 16 EX93    WHON1   6 25 EX93    WHON2   6 19 EX93    
WHY    19  2 EX93    WRACTS  2 29 EX93    XWR1X3  4 13 EX93    YES1   19 28 EX93    
YESNO  19 26 EX93    
EXEC ** FICHE/FRAME BREAK *****
FS
FS96   IDENT 04/13/76

       NOLIST EXT

*      FILE SUBROUTINES FOR BASE/MAX STORAGE MEASUREMENT

BUGGY EQU 1


*      QUADRANT BUFFER
$FDCBFB BSS 1000B (BASE STG. FOR 512 FD NOS.)
$FDCBFM BSS 1000B (MAX STG. FOR 512 FD NOS.)

$NR22 BSS 1 (NO. OF BUFFER READS)
$NW22 BSS 1 (NO. OF BUFFER WRITES)
$NA22 BSS 1 (NO. OF ACFDCB CALLS)
$NF22 BSS 1 (NO. OF ACFDCB CALLS REQUIRING FLUSH)
$NM22 BSS 1 (NO. OF FLUSH BRS 183 CALLS FAILING)
$ACFDLY BSS 1 (NO. OF ACFDCB DELAYS)
$NFL BSS 1 (TOTAL NO. OF FLUSH CALLS)


*FLUSH ALL INCORE INFO. TO DISC.  CYCLES THRU 4 GROUPS OF FD'S:
* 0-777,1000-1777,2000-2777,3000-3777, STARTING WITH THE INCORE
* BUFFER.

$FLUSH LDA UTTY; BRS 22; XMA FI; SNE ZERO; BRU *+4
       STA FI; BRS 23; R1 (FLUSH INTERLOCK BUSY)
       MIN NFL
       BRS 46
       LDA PG22; STA FDCBT; LDB =3000B
FLUSH1 STA DP (DESIRED PAGE); LDX =-NFDCB
FLUSH2 LDA FDCBLE,2; SKA K3777; SKM DP; BRU FLUSH7 (NO UPDATE)
       SKA K4000; BRU FLUSH7 (BYPASS IF JA); STX FDCBX (SAVE INDEX)
FLUSH3 C B22B (BRING BUFFER FOR FDCBLE ENTRY WHOSE INDEX IS IN X)
       BRU FLSH10 (WAIT)
       LDX FDCBX; STX CHGFLG (NEG. FOR NO CHANGE)
FLUSH4 LDB =3000B; LDA FDCBLE,2; SKA K3777; SKM DP; BRU FLUSH6
       SKA K4000; BRU FLUSH6 (JA)
       ETR K3777; STX FDCBX; XXA; BRS 183 (FETCH FDCB DATA)
       BRU FLSH11 (?? FDCB MISSING)
       XXA; ETR K777; XXA
       XMA FDCBFB,2; SKE FDCBFB,2; STX CHGFLG
       CBA
       XMA FDCBFM,2; SKE FDCBFM,2; STX CHGFLG
       LDX FDCBX; LDA FDCBLE,2; MRG K1B5 (FLUSHED); STA FDCBLE,2
FLUSH6 BRX FLUSH4; SKN CHGFLG; C W22B; C R22B; BRU FLUSH8
FLUSH7 BRX FLUSH2
FLUSH8 LDA DP; ADD K1000; LDB =3000B; SKM FDCBT; BRU FLUSH1
*      CLEAR FLUSH INTERLOCK
       LDA REAL; STA LFLUSH (FOR 3 MIN MECHANISM)
       CLX; STX FI (ZERO)
       BRS 23; R2
FLSH10 BRS 45; BRU FLUSH3
FLSH11 LDX FDCBX; MIN NM22; BRU FLUSH6

* BRING BUFFER FOR FD POINTED AT BY NEG. FDCBLE INDEX IN 'X'
*      A,B NOT USED AND ALL REGISTERS DESTROYED.  NONSKIP
*      RETURN IF WE CANNOT DO A BRING NOW.
*              BUFFER STATES IN BITS 21-23 OF "PG22":
*               1=BEING READ
*               2=BEING WRITTEN
*               3=IN CORE
*               4=VOID

$B22B  LDB SEVEN; BRS 22; LDA PG22; SKM ONE (BEING READ, WAIT)
       BRU B22B2
B22B1  BRS 23; R1 (WAIT)
B22B2  SKM FOUR; BRU B22B5 (NOT VOID)
*      READ NECESSARY
B22B3  SKA X4; BRU B22B1 (NON ZERO USE COUNT, CANNOT READ NOW)
       LDA FDCBLE,2; ETR =3000B (BUFFER QUADRANT NO.); MRG ONE
       STA PG22 (READ STATE, QUADRANT NO., USE COUNT=0)


       RSH 5; ETR K60; ADD =FDCBP; CAB
       LDX K2000; LDA =3B4; BRS 124; MIN NR22
       BRS 22; LDA THREE; XMA PG22; ETR KS5B3; ADM PG22


*      CORRECT BUFFER IN CORE
B22B4  LDA K77B6; ADM PG22 (INCR. USE COUNT)


       R2
B22B5  LDB =3000B; SKM FDCBLE,2; BRU B22B6 (WRONG QUADRANT)
       BRU B22B4
B22B6  LDB SEVEN; SKM TWO; BRU B22B3 (TRY TO READ)
       BRU B22B1 (WAIT FOR WRITE TO COMPLETE)

*WRITE BUFFER

$W22B  LDA PG22; SKA X4; BRU *+2; BRU W22D (TROUBLE)
       ETR SEVEN; SKG THREE; SKG ONE; BRU W22E
       LDA TWO; XMA PG22; ETR KS5B3; ADM PG22


       RSH 5; ETR K60; ADD =FDCBP; CAB
       LDX K2000; LDA =3B4; BRS 125; MIN NW22
W22C   BRS 22; LDA THREE; XMA PG22; ETR KS5B3; ADM PG22


       R1
W22D   CLB; BRU *+2
W22E   LDB ONE; LDA PG22; STA W22F; STB MASTER
       LDA REAL; STA CR22A; LDA TYMTIM; STA CR22B
       LDA =3B4; LDB =P22CR; LDX K4000; BRS 125
       IF BUGGY; BRS 131; ELSE; BRU W22C; ENDF
$W22F BSS 1 (AID TO DEBUGGING)
$CR22A ZRO
$CR22B ZRO

*DECREMENT USE COUNT ON PG. 22 BUFFER

$R22B  LDA PG22; ADD K1B6; SKA X4; BRU *+2
       ETR KS6; STA PG22; BRS 23; R1

*XBRS FOR STORAGE PROGRAM.  REPLACE FDCB DATA FROM 'A' AND 'B' FOR
*      FD IN 'X'.  RETURNS OLD VALUES IN 'A' AND 'B' WITH 'X'
*      UNCHANGED.  NONSKIP FOR ILLEGAL ARGUMENT IN 'X'.
$BRS190 C CKFDN (CHECK OUT ARGS)
B190A  LDP UA; BRS 184 (REPLACE MONITOR DATA); BRU B190C
B190B  STA UA; C POPI; LDA UA; BRU BRSEX (SKIP RETURN)
B190C  C ACFDCB; LDX UX; BRU B190A

*XBRS FOR STORAGE PROGRAM AND OTHERS.  CAUSE FLUSH TO OCCUR
*      IMMEDIATELY.  NONSKIP IF FLUSH INTERLOCK IS BUSY.  NORMAL
*      RETURN IS SKIPPING WITH ALL REGISTERS PRESERVED.
$BRS191 SKN MASTER; BRU BRS111; C STKI; C FLUSH; BRU *+2; MIN UBRSRT
       C POPI; LDP UA; LDX UX; BRU BRS111

*XBRS FOR SUMMARY PROGRAM AND OTHERS.  FETCH FDCB DATA TO 'A'
*      AND 'B' FOR FD IN 'X'.  NONSKIP FOR ILLEGAL ARGUMENT IN 'X'.
$BRS192 C CKFDN
B192A  CLA; BRS 183; BRU *+2; BRU B190B
       C ACFDCB; LDX UX; BRU B192A

*CHECKOUT ARGS FOR BRS 190, 192 CALL.
$CKFDN SKN MASTER; BRU BRS111; CXA
       SKG K3777; SKG ZERO; BRU BRS111; C STKI; R1

*ACQUIRE FILE DIR. CONTROL BLOCK.  READ FROM DISC IF NECESSARY.

$ACFDCB STX FDNO
ACFD0  MIN NA22
ACFD1  BRS 189; R1 (NO PROBLEM)
       BRU ACFD2 (JUST ASSIGNED FDCBL ENTRY)
       C FLUSH (NO ENTRIES FREE, TRY FLUSH)
       BRU ACFD3 (FLUSH INTERLOCK BUSY)
       MIN NF22; LDX FDNO; BRU ACFD1 (RETRY)
ACFD2  CAX (NEG. INDEX INTO FDCBLE); C B22B; BRU ACFD3 (BRING BUSY)
       LDA FDNO; MRG K4000 (JA BIT); STA FDCBT; ETR K777; CAX
       LDA FDCBFB,2 (BASE); LDB FDCBFM,2 (MAX); LDX FDCBT
       BRS 184 (STORE DATA AND TURN OFF JA BIT); NOP
       C R22B; R1 (RETRY ORIGINAL OPERATION)
ACFD3  MIN ACFDLY; BRS 45; R1 (RETRY AFTER DELAY)

*HANDLE BRS 1 ERCODE 6.  ENTER FROM GS.

$BRS1E6 LDX FDNO; C ACFD0; LDX FDNO; BRU BRS1C (RETRY OPERATION)

*FORCE FLUSH AT SYSTEM TAKEDOWN.  ENTER FROM EX.

$CRSH3 C STKI; C FLUSH; NOP; C POPI; R1

* GET FILE SIZE BY OPENING FILE.  USED BY RENAME.
$REN6E LDA FDCBT; SKG ZERO; BRU REN6B (ZERO I.B.P.)
       LDB K41; BRS 1; BRU REN6B (CANNOT OPEN NOW)
       STA TLV21; RCS TLV21; LDA TLV21; BRS 20
       CLA; DIV =256*3/2; SKG K3S4; BRU *+2; BRU REN6B
       STA S2; BRU REN6A

* ACQUIRE FDCB FOR RENAME

$REN4C C ACFD0; LDX FDNO; BRU REN4A

* PRINT BASE AND MAX STG. USED.

$DSC1  SKN MASTER; BRU CR; LDX FDUN; CLA
       BRS 183; BRU DSC2; STP TLV1
       MSET DSC4; LDA TLV1; C DSC3
       MSET DSC5; LDA TLV11; C DSC3
       BRU CR
DSC2   C ACFDCB; BRU DSC1
DSC3   SKG =9999; TCF BLKCH
       SKG V999 (IN EX); TCF BLKCH; C PDNO
       R1
DSC4   ASC 'DISC STORAGE (BLOCKS):$BASE = /'
DSC5   ASC ', MAX = /'

* BUFFERED TERMINAL I/O  (FROM "TYPE")
CPS    EQU 384                 CHARS/SEC EXPECTED THRU NETWORK (UPPER LIMIT)
NBUF   EQU 15                  NO. OF BUFFERS
WAIT   EQU [NBUF*384]/2        ALLOW RING TO HALF-EMPTY WHEN FULL
WAIT   EQU WAIT/CPS            BEFORE FILLING IT AGAIN.
BUF    EQU WORK+200B           FIRST BUFFERLET
FREE   EQU 4B7
BUSY   EQU 2B7
$BTIO  EQU *   BUFFERED TERMINAL OUTPUT
*XT11   CHAR TO BE OUTPUT
*XT12   TERMINAL FLAGS
*XT13   MULTIPLE BLANK COUNT
       LDA WORK
       LDA =WORK
       STA LDTEMP
       LDX KM1
       BRS 40
       ETR =1B5+1B4 (LOWER CASE OUTPUT, MARGIN FLAG)
       STA XT12
* CREATE COMMAND RING
 LDA =BUF; STA TLV2 (BUFFERLET ADDR)
 LDA =NBUF-1; STA TLV23 (SET UP 15 BUFFERLETS)
 LDX =WORK (ADDRESS 1ST COMMAND)
 LDA =WORK+3
 LDB =FREE
CRING STA TLV21; STA 1,2 (THREAD COMMAND LIST)
       STB 0,2 (INITIALIZE FLAG WORD)
       LDA TLV2
       STA 2,2 (INITIALIZE BUFFERLET ADDR.)
       ADD K200; STA TLV2
       LDA THREE; ADD TLV21
 EAX 3,2; SKR TLV23; BRU CRING
 LDA =WORK; STA -2,2 (THREAD LAST COMMAND TO FIRST); STA TLV21
*NOTE TLV23 INITIALIZED TO -1
 SPB CINIT (SET UP BUFFERLET PTRS)
       LDA CWTAB+3; STA TLV11
       LDA COPYT; SKE TWO; BRU BTIO1
BTIO3  CIO INFIL; SKN INFIL; BRU BTIO4
BTIO2  C CWF
       LDX KM1; BRS 178
       SKN TLV23; SPB CKER
* FIX UP MARGIN FLAGS
       LDX KM1; BRS 40; ETR =7213B4 (BITS PERMITTED BY BRS 24)
       XMA XT12; EOR XT12; ETR K1B4; EOR XT12
       BRS 24; BRU CLOSE
       BRU CLOSE
BTIO4  SPB CW; BRU BTIO3
BTIO1  CIO INFIL; SKN INFIL; BRU *+2; BRU BTIO2
       STA XT11 (CHARACTER TO BE OUTPUT)
       LDB XT12; SKB K4B7; BRU TCO3
       ETR K177; CAX; BRU* T128,2

TON    LDA K40
       ADD XT11; MRG K200
       SPB CW
TON3   LDA K1B4; COPY AB,N; SKB XT12
TON2   ADM XT12; BRU BTIO1

TO102  SKB K1B5; BRU TON; LDA =212B; SPB CW; BRU BTIO1

TO105  SKB K1B5; BRU TON; SKB K1B4; BRU BTIO1
       LDA K1B4; ADM XT12
       LDA =215B; SPB CW; BRU BTIO1

TO135  LDA K4B7; SKA XT12; HLT; ADM XT12
       BRU TON3

TO152  LDA =212B; SPB CW
       LDB XT12; SKB K1B4; BRU BTIO1
       LDA =215B; SPB CW; LDA K377; SPB CW
TO152A LDB XT12; SKB K1B4; BRU BTIO1
       LDA K1B4; BRU TON2

TO155  SKB K1B4; BRU TO155A
       LDA =215B; SPB CW
TO155A LDA =212B; SPB CW; BRU TO152A

*      COUNTER AT 0. SET COUNTER AND OUTPUT BLANKS
TCO3   STA XT13
TCO3A  SKR XT13; BRU TCO3B
       LDA K4B7; ADM XT12; BRU BTIO1
TCO3B  LDA =240B; SPB CW; BRU TCO3A

T128   EQU *
       RPT (X=0,7); BRU TON; ENDR
       RPT (X=10,17); BRU TON; ENDR
       RPT (X=20,27); BRU TON; ENDR
       RPT (X=30,37); BRU TON; ENDR
       RPT (X=40,47); BRU TON; ENDR
       RPT (X=50,57); BRU TON; ENDR
       RPT (X=60,67); BRU TON; ENDR
       RPT (X=70,77); BRU TON; ENDR
       BRU TON (100)
       BRU TON (101)
       BRU TO102
       BRU TON (103)
       BRU TON (104)
       BRU TO105
       BRU TON (106)
       BRU TON (107)
       RPT (X=110,117); BRU TON; ENDR
       RPT (X=120,127); BRU TON; ENDR
       RPT (X=130,134); BRU TON; ENDR
       BRU TO135
       BRU TON (136)
       BRU TON (137)
       RPT (X=140,147); BRU TON; ENDR
       BRU TON (150)
       BRU TON (151)
       BRU TO152
       BRU TON (153)
       BRU TON (154)
       BRU TO155
       BRU TON (156)
       BRU TON (157)
       RPT (X=160,167); BRU TON; ENDR
       RPT (X=170,177); BRU TON; ENDR

*TLV1  WORD PTR FOR BUFFERLET
*TLV11 BRANCH INSTRUCTION EXECUTED BY CW
*TLV2    CHAR COUNT IN BUFFERLET
*TLV21   CURRENT COMMAND PTR
*TLV23  ACTIVE COMMAND COUNTER
* WRITE CHARACTER INTO BUFFERLET
CW     MIN TLV2; EXU TLV11 (BRANCH TO APPROPRIATE CODE)
CWTAB  BRU CHR0; BRU CHR1; BRU CHR2; BRU CWTAB
CHR0   CLB; LSH 16; STA* TLV1; MIN TLV11; BRR 0
CHR1   CLB; LSH 8; ADM* TLV1; MIN TLV11; BRR 0
CHR2   ADM* TLV1; MIN TLV1; LDA CWTAB+3; STA TLV11
       LDA TLV2; SKE =600B; BRR 0; LDA 0; STA TLV3
       C CWF; BRR TLV3


* INITIALIZE BUFFERLET PTRS
CINIT  LDX TLV21; LDA 2,2; ETR K3S4; AXC; STA TLV2
       STX TLV1
       BRR 0

CKER   LDX KM1; LDA =WORK; BRS 75; CAX; SKE TLV21; BRU CER
       LDA 0,2; SKE =FREE+BUSY; BRU CER
       LDA KM1; STA TLV23; BRR 0
* CER DOES NOT RETURN
CER    STX XT14
       MSET CERR
       LDA XT14; C PONO; TCF COLNCH; TCF ZERO
       LDX XT13; LDA 0,2; LDX =-11
       SKA K4B7; C CEXP; LCY 1; BRX *-3
       BRU CLOSE
CEXP   STA XT18; STX XT19
       MSET* MIE,2
       LDX XT19; LDA XT18; R1
       DATA CU,CB,CZM,CEOT,CTIM,CTER,CABO,CS1,CCER,CPER,CEND
MIE    EQU *
CU     ASC 'USE /'
CB     ASC 'BUSY/'
CZM    ASC 'CIR ZAP /'
CEOT   ASC 'EOT /'
CTIM   ASC 'TIMEOUT /'
CTER   ASC 'TERMINATE /'
CABO   ASC 'ABORT /'
CS1    ASC 'SPARE1 /'
CCER   ASC 'CHAR COUNT /'
CPER   ASC 'PAGECROSS /'
CEND   ASC 'CEND /'
CERR   ASC '$I-O ERR AT /'


* FLUSH LAST BUFFERLET
CWF    LDX TLV21; LDA 2,2; LRSH 14; LDA TLV2; SKG ZERO; R1
       LSH 14; STA 2,2 (UPDATE COUNT); BRU *+2
STIO   SPB CKER
       LDA TLV21; LDB TLV23; MIN TLV23; LDX KM1; BRS 97; BRU STIO
* ADVANCE TO NEXT BUFFERLET
       LDX TLV21; LDX 1,2; STX TLV21
* WAIT FOR BUSY BUFFERLET
CWF1   LDA 0,2; SKA =-1-FREE-BUSY; BRU CER
       SKA =FREE; BRU CWF2
       LDA =WAIT*1000; BRS 81
       BRU CWF1
* REINITIALIZE BUFFERLET PTRS
CWF2   SPB CINIT
       R1
       END
EXEC ** FICHE/FRAME BREAK *****
FS SYMSORT

SYM.  PG.LN. IDENT.

ACFD0   4 28 FS96    ACFD1   4 29 FS96    ACFD2   4 34 FS96    
ACFD3   4 39 FS96    ACFDCB  4 27 FS96    ACFDLY  1 19 FS96    B190A   4  5 FS96    
B190B   4  6 FS96    B190C   4  7 FS96    B192A   4 18 FS96    B22B    2 27 FS96    
B22B1   2 29 FS96    B22B2   2 30 FS96    B22B3   2 32 FS96    B22B4   3  4 FS96    
B22B5   3  8 FS96    B22B6   3 10 FS96    BRS190  4  4 FS96    BRS191  4 12 FS96    
BRS192  4 17 FS96    BRS1E6  5  4 FS96    BTIO    6  4 FS96    BTIO1   7  4 FS96    
BTIO2   6 34 FS96    BTIO3   6 33 FS96    BTIO4   7  3 FS96    BUF     6  1 FS96    
BUGGY   1  7 FS96    BUSY    6  3 FS96    CABO    9 38 FS96    CB      9 33 FS96    
CCER   10  1 FS96    CEND   10  3 FS96    CEOT    9 35 FS96    CER     9 21 FS96    
CERR   10  4 FS96    CEXP    9 27 FS96    CHR0    9  5 FS96    CHR1    9  6 FS96    
CHR2    9  7 FS96    CINIT   9 13 FS96    CKER    9 17 FS96    CKFDN   4 22 FS96    
CPER   10  2 FS96    CPS     5 36 FS96    CR22A   3 32 FS96    CR22B   3 33 FS96    
CRING   6 21 FS96    CRSH3   5  8 FS96    CS1     9 39 FS96    CTER    9 37 FS96    
CTIM    9 36 FS96    CU      9 32 FS96    CW      9  3 FS96    CWF    10  8 FS96    
CWF1   10 15 FS96    CWF2   10 20 FS96    CWTAB   9  4 FS96    CZM     9 34 FS96    
DSC1    5 23 FS96    DSC2    5 28 FS96    DSC3    5 29 FS96    DSC4    5 32 FS96    
DSC5    5 33 FS96    FDCBFB  1 11 FS96    FDCBFM  1 12 FS96    FLSH10  2 15 FS96    
FLSH11  2 16 FS96    FLUSH   1 27 FS96    FLUSH1  1 32 FS96    FLUSH2  1 33 FS96    
FLUSH3  1 35 FS96    FLUSH4  1 38 FS96    FLUSH6  2  8 FS96    FLUSH7  2  9 FS96    
FLUSH8  2 10 FS96    FREE    6  2 FS96    MIE     9 31 FS96    NA22    1 16 FS96    
NBUF    5 37 FS96    NF22    1 17 FS96    NFL     1 20 FS96    NM22    1 18 FS96    
NR22    1 14 FS96    NW22    1 15 FS96    R22B    3 37 FS96    REN4C   5 19 FS96    
REN6E   5 11 FS96    STIO   10 10 FS96    T128    8  1 FS96    TCO3    7 35 FS96    
TCO3A   7 36 FS96    TCO3B   7 38 FS96    TO102   7 15 FS96    TO105   7 17 FS96    
TO135   7 21 FS96    TO152   7 24 FS96    TO152A  7 27 FS96    TO155   7 30 FS96    
TO155A  7 32 FS96    TON     7  9 FS96    TON2    7 13 FS96    TON3    7 12 FS96    
W22B    3 15 FS96    W22C    3 22 FS96    W22D    3 26 FS96    W22E    3 27 FS96    
W22F    3 31 FS96    WAIT    5 39 FS96    WAIT    5 38 FS96    
EXEC ** FICHE/FRAME BREAK *****
GS
GS93   IDENT   02/01/78
*      LOADS AT 10000.   ALL ENTRY POINTS TO THE EXEC ARE BELOW.
*      THIS FILE OCCUPIES EXEC'S FIRST PAGE AND IS ALWAYS IN 
*      RELABELLING WHEN ANY OTHER PAGE OF EXEC IS BEING USED.
*      CONTAINS COMMON SUBROUTINES AND MOST EXEC BRS'S.  NOTE THAT
*      MOST EXEC BRS'S START WITH THIS PAGE ONLY, THOUGH SOME START
*      WITH CM,CM+EX, OR MB PRESENT ALSO.  A PROGRAM'S RETURN TO EXEC
*      BRINGS IN THIS PAGE AND CM.
* EXEC ENTRY TRANSFER VECTOR
       BRU EXECI (INITIAL ENTRY POINT TO EXEC, NEW USERS)
       BRU EXECP (ESCAPES AND OTHER ERROR RETURNS)
       BRU OFFINT (TTY OFF INTERRUPT ENTRY POINT)
       BRU CKCPU (CHECK CPU TIME LIMIT)
       BRU CKCPU1 (CPUTIME LIMIT RUNOUT FROM EXEC)
* BRS TRANSFER VECTOR
       BRU BRS15; BRU BRS16; BRU BRS58 (RENAME); BRU BRS18; BRU BRS19
       BRU BRS59 ; BRU BRS48; BRU BRS95; BRU BRS96; BRU BRS60
       BRU BRS142; BRU EXSUB (BE+18); BRU BRS176; BRU BRS182
       BRU FLNM (68); BRU DELFL (69); BRU BRS62 (15/16)
       BRU BRS63 (18/19); BRU BRS64 (48/16); BRU BRS65 (60/19)
       BRU BRS37 (RENAME); BRU BRS6; BRU BRS67; BRU BRS173
*NEXT 4 GO TO NIO
       BRU ISCN (ISC); BRU SICN (SIC); BRU FFI (52); BRU FFO (53)
*NEXT 4 TO PG. 22
       BRU BRS190; BRU BRS191; BRU BRS192; BRU BRS193
*NEXT 4 TO PG. 16 (NOW CALLED AF BUT USED TO BE CALLED FIO)
       BRU EXRTIM (91); BRU TIMY (140)
       IF MDSI
       BRU SARSS (171); BRU BRS187
*NEXT TO MB
       BRU BRS27 (CHANGE PROG STARTUP LOC)
       ENDF
*      TYPE MESSAGE
$MSGT  EAX* 0; CXA; ETR K3S4; SKG K777; BRU MSGT1
       LDB KM1; LDX COUT; BRS 34; BRR 0
MSGT1  LDA 0; STA TLV0; BRS 43; STP XT15
       XAB; ETR =77770077B; MRG MSGT2; XAB; BRS 44; CXA
       SBRM 30000B
MSGT2  DATA EXPG6 (MIGHT AS WELL USE DATA INSTEAD OF CIN)
       DATA COUT,XT17
       LDP XT15; BRS 44; BRR TLV0
*      CHECKS OPERATOR STATUS TIME FOR RUNOUT
$CKOPTM SKN EXFLAG; BRU *+2; R2
       SKN OPTM; BRU *+2; R1 (NOT SET)
       LDB KM1; LDA REAL; SUB K3600D (1 MIN); SKG OPTM; LDB REAL
       STB OPTM; SKG OPTM; R2; LDX JOB; LDA CPARW,2; ETR K6S7
       STA CPARW,2; R1
*   0.8        UPDATE EXRL1,EXRL2
$EXECRL BRS 43; SKB KM1; BRU XRL2 (NEED TO CLEAN RELABELLING)
XRL1   STP EXRL; STB RLSW (SEE GTXFD); R1
XRL2   CLB; BRS 44; BRU XRL1
BRS95  C GBFG; BRU BRS111; BRU BRSEX
*TAKES FILES INDEX IN A, ADR. OF BUFFER IN B
*RETURNS COMPLETE FILE DATA IN BUFFER AND NAME
BRS96  SKE FLX; ER 35
       LDA UB; C SUSR; STA TLV1 (ADR.)
       CLB; LDA GRP; LSH 12; MRG GRU; STA* TLV1; MIN TLV1
       SKR UX; LDX KM4
BRS96A SKR UX; BRU *+2; BRU BRS111
       LDA* UA; STA* TLV1; MIN UA; MIN TLV1; BRX BRS96A
BRS96B SKR UX; BRU *+2; BRU BRS111
       LDA* UA; STA* TLV1; MIN UA; MIN TLV1
       SKA X4; BRU BRS111; BRU BRS96B
*SETS FILE PARAMETERS
*PARA MASK AND CHANGE IN X
BRS6   SKN FDCONT; BRU *+2; BRU *+3
       C TXPUB; BRU BRS111 (NOT PRIVATE OR ALLOWED)
       LDA UX; SKE KM1; BRU BRS6A
       SKN EXFLAG; BRS 5; SKA FOUR; BRU *+2; BRU BRS111
       STA TLV11; LDA K1B4; STA TLV1; BRU BRS6B
BRS6A  LDB K12B6; LDX JOB; SKB CPARW,2; BRU *+3
       SKA K4000; BRU BRS111
       EOR KM1; CAB; BRS 5; EOR KM1
       SKB TWO; BRU *+3; SKA FOUR; BRU BRS111
       SKB FOUR; BRU *+3; SKA TWO; BRU BRS111
       SKB EIGHT; BRU *+3; SKA ONE; BRU BRS111
       LDA UX; LRSH 12; STA TLV1; EOR KM1; STA TLV11
       LDA UX; ETR TLV1; STA TLV1
BRS6B  LDX FLX; LDA 2,2; ETR TLV11; MRG TLV1
$BRS6C  STA 2,2; LDA UB; SKE ZERO; SKN FDCONT; BRU *+2; STA 0,2
$BRS37A C MKBUSY; BRU BRS111; C MFD3; HLT PDL; BRU BRSEX
*RETURNS FILE NAME STRING TO USER
*TAKES INDEX NO. IN X, ERROR RETURN IF NOT VALID NO.
*RETURNS IN A PARAMETER FOR BRS 16
*  IN B, 2ND STRING PTR OF NAME
*  X IS SAVED
*  A AND B ARE ZERO FOR NULL OR EMPTY ENTRY
*  ERROR RETURN IF OUTSIDE DIR. RANGE
FLNM   LDA FDUN; SKE UNO; BRU FLNM4; SKE GRU; BRU FLNM2
FLNM3  LDA KM1; STA PVTSW; CXA; C FLNUM; BRU BRS111; C CPFN;
       LDA VXWR3; LDB VBASE (SAME AS UA); C WRSU
       LDA SRSU21; SUB SRSU20; ADD UB; CAB
       LDA FLX; LDX UX; BRU BRSEX
FLNM2  STA GRU; CLA; STA GRP; STA GRCT; BRU FLNM3
FLNM4  CLB; SKN FDCONT; LDB FDCONT; SKB FOUR; HLT DBF; BRU FLNM3-2
*DELETES FILE, GIVEN F.D. INDEX IN A (USE BRS 68,15, OR 48)
DELFL  SKE FLX; BRU BRS111; CAX; C DELFLS; BRU BRS111; BRU BRSEX
*      RETURNS DATA FROM T.S. TO USER
*A - T.S. ADR (KEY)
*B - USER BUFFER ADR.
*X - NO. OF WORDS
BRS67  CBA; C SUSR; STA TLV1
       LDA VBASE; ADD UA; SKG VEBASE; BRU *+2; HLT NPD
       STA TLV11 (STARTING ADR.); ADD UX; SKG VEBASE; BRU *+2; HLT BASE
BRS67A SKR UX; BRU *+2; BRU BRS111
       LDA* TLV11; STA* TLV1; MIN TLV11; MIN TLV1; BRU BRS67A
*STARTS EXEC COMMAND FROM EXEC BRS
BRS142 STA CMND
       SKN CMND
       BRS 94 (CLEAR FORK STRUCTURE)
       C SVBRK; BRU CR
*      FILE NAME LOOK-UP, STRING PTRS FOR NAME IN A,B
BRS60  C GSFI; BRU BRS111; MIN UBRSRT; BRS 111
BRS48  C GSFN; BRU BRS111
*      RETURN FROM XBRS
$BRSEX MIN UBRSRT (SKIP RETURN)
$BRS111 STP UA; STX UX
111ENB C CACT (CHECK IF RESOURCE RECORD WRITTEN IN LAST 3 MIN)
       LDA ONE; STA RLSW
       SKA FLAGS; SKN MSW; BRU 111EN0
       C GTEM; LDA =EMSG; LDB KM1; LDX ONE; BRS 34; MIN MSW
111EN0 LDP UA; LDX UX; BRS 111
*      OPENS FILE FOR INPUT, NAME FROM FILE
BRS62  C SOPN; C GFN; BRU SOUT; C GIFNB; BRU SOUT; BRU OUT
*      OPENS FILE FOR OUTPUT
*REQUIRES FILE NO. IN A, TYPE IN X
BRS63  C SOPNCN; C GOFNA; BRU SOUT
       LDX GOFNFT; C GOFNB; BRU SOUT; LDB GOFNFT; BRU OUT
*      OPENS FILE FOR INPUT, STRING PTRS, IN A,B
BRS64  C SOPN; C GSFN; BRU BRS111; C GIFNB; BRU BRS111; BRU BRSEX
*      OPENS FILE FOR OUTPUT, STRING PTRS, IN A,B - TYPE IN X
BRS65  C SOPNCN; LDX KM1; STX XT10; C GSFI+1; BRU BRS111
       LDX GOFNFT; C GOFNB; BRU BRS111; LDB GOFNFT; BRU BRSEX
SOPNCN STX GOFNFT (SAVE FILE FORMAT)
SOPN   LRSH 16; STA OPNCN; LDP UA; ETR K1S5; R1
*      GETS FILE NAME FOR INPUT FILE
$GFN   C GFNST
$GSFN  C CPSU; R1; C FNLK; R1; R2
GFNST  ETR K7777; STA XT10; C SVBRK; C FNSET
       LDA XT10; LDB KM1; R1
$OUT1  MIN UBRSRT; C SOUTS; BRU 111EN0
$OUT   MIN UBRSRT
$SOUT   C SOUTS; BRU 111ENB
$SOUTS  STP UA; STX UX; LDA TWO; XMA BRKTBL; LDX KM1; BRS 12; R1
$SVBRK STA TLV1; LDX KM1; BRS 40; STA BRKTBL
       IF CEM; LDA K4B4; ELSE; LDA TWO; ENDF; BRS 12
       LDA TLV1; R1
*      GETS FILE NAME FOR OUTPUT FILE
$GOFNA C GFNST
$GSFI  STA XT10; STB XTE (STRING/FILE SW); C CPSU; R1
       SKE THREE
       SKNE TEN; ER 26
       SKNE TWO; ER 26; C FNLK; BRU GOFN8B
       C CK65; BRU GOFN8A; BRU GOFN9A
GOFN8A CXA; SKG TWO; BRU GOFN9B  (PHYS. DEV.)
       MSET E3 (OLD FILE)
GOFN9  SKN XTE; BRU GOFN9B; CIO XT10
GOFN9B CIO XT10; CAB; SKNE CRCH; BRU *+3
       SKE LINF; ER 25
GOFN9A LDX FLX; CXA; STB UB; R2
GOFN8B CXA; SKE TEN (10); R1
       C CK65; BRU GOFN7
GOFN4  LDA GRU; SKN FDCONT; SKE ONE; BRU *+3
       SKE UNO; ER 26
       LDA XT9; MRG X4; STA FLX; R2
GOFN7  MSET E4 (NEW FILE); C GOFN9; R1; BRU GOFN4
CK65   SKN XTE; BRU *+2; R1
       SKN XT10; R2; LDA GOFNFT; LRSH 12; SKG ZERO; R2
       XMA GOFNFT; ETR K7777; STA XT10
       LDA FLX; SKG TWO; SKG ZERO; R1; R2
*      OPENS FILE OR PHYSICAL DEVICE FOR OUTPUT
$GOFNB SKE FLX (CK FOR VALID INDEX); ER 27; COPY XA,AX,B
       ETR SEVEN (CLEAN UP FILE TYPE (3 BITS)); STA GOFNFT
       SKE FIVE; LDB GRU (FD FOR STORAGE CHARGE); STB XT4
       SNE FIVE; BRS 5; SKG ZERO; ER 55 (NOT 1-4)
       SKE FOUR; BRU *+5; BRS 5; SKE SEVEN; ER 54; LDA FOUR; XXA
       SKNE TWO (NOTHING); R2
       SKE ONE (TELETYPE); BRU GOFNB1; XXA; SKE THREE
       ER 28 (WRONG TYPE); XXA; R2
GOFNB1 SKA X4; BRU GOFNB4 (NEW FILE)
       CAX; LDA 2,2; LRSH 18; ETR SEVEN (GET OLD TYPE)
       SNE GOFNFT; BRU GOFNB4 (SAME TYPE)
       SNE FIVE; ER 56; LDA GOFNFT; SNE FIVE; ER 56
GOFNB4 C DTEMPR; C MKBUSY; R1 (CORE COPY NOT CURRENT)
       LDA FLX; SKA X4; BRU GOFN10 (NEW FILE)
       CAX; LDA 2,2; SKA ONE; BRU GOFN33
       LDA 3,2; SKNE ZERO; BRU GFN10A (NO I.B.P.)
       STA XT13; C TDEL; BRU GOFNER
*OLD FILE
       LDA 2,2; SKA K2B7 (IF IF DISC FILE); BRU *+2; BRU GOFN29
       ETR =77777760B; STA 2,2; CLB; SKA K4B6; LDB OPNCN; SKB KM1
       BRU GOFN54 (NO UPD.ON DUMP)
       LDA X6 (SET CHANGED FILE FLAG, REMOVE OLD LENGTH)
       STA 1,2
       C DAY (GET CREATION DATE); EOR 0,2; ETR K1S4; EOR 0,2; STA 0,2
       C CTAC (INCREMENT ACCESS COUNT)
       LDA 2,2; SKA K100 (CK IF PRIVATE APPEND); BRU GOFN22 (NO)
GOFNB3 LDA OPNCN; CAB; ETR K77; SKG ZERO; LDB K47
       C BRS1A; BRU BRS1E
       STA XT4; LDA X4; SCP XT4; HLT 7774B
       25B XT4,5; LDB OPNCN; SKB KM1; BRU GOFN23; PCE XT4 (ERASE); NOP
       LDX FLX; LDA 2,2; RSH 18; ETR K30; MRG GOFNFT; LSH 18; STA 2,2
       BRU GOFN18
*APPEND ONLY
GOFN22 SKN FDCONT; BRU *+2; BRU GOFNB3 (DONT TREAT LIKE APPEND ONLY)
       LDB SIX; C BRS1A; BRU BRS1E
       STA XT4; RCS XT4; MRG X4; SCP XT4; ER 9
GOFN23 LDX FLX; LDA 2,2; RSH 18; ETR THREE; STA GOFNFT
GOFN18 CLA; STA OPNCN
       C MFD; BRU GFN18B; LDA XT4 (FIL NO.)
       LDX XT13; BRS 47; R2
GFN18B LDA XT4; BRS 2; LDX K42; BRU GOFNER
*NEW FILE
GOFN10 EOR X4; C INSFN; BRU GOFNER+1
GFN10A STX FLX; CLA; LDB K47; C BRS1B; BRU BRS1E; STA XT4; STX XT13
       RCP XT4; MRG X4; SCP XT4; HLT 64B; LDA XT13; LDX FLX
       STA 3,2 (PUT IBP IN ENTRY); LDA X6 (DISC REORDER AND BACKUP BITS)
       STA 1,2 (SET CHANGED FILE FLAG); LDA GOFNFT; LCY 18; ETR K17B6
       MRG K2B7; STA 2,2 (FILE TYPE AND DISC FLAG)
       C DAY (SETUP CREATION DATE); MRG K2B4 (SET ACCESS COUNT TO 1)
       STA 0,2; BRU GOFN18
GOFN29 C RLSG; ER 29
GOFN54 C RLSG; ER 54
GOFN33 LDX K41
$GOFNER STX ERCODE
RLSG   COPY XB,A; LDX JOB; STA FGLIST,2; CBX; R1
*      BRS 16
*      OPEN FILE FOR INPUT
$GIFNB SKE FLX; ER 35
       SKNE TWO; BRU GIFN11 (NOTHING)
       SKE ONE; BRU GIFNB1
*TELETYPE
       CLA; LDB THREE
GIFN10 LDX K3S7; R2
*NOTHING
GIFN11 LDA =40200002B; LDB ONE; BRU GIFN10
GIFNB1 CAX
       XMA CR3; LDB 2,2; SKB K20; BRU *+2 (PROPRIETARY); BRU GIFND
       ETR K3S4; SKNE VGOTO; BRU *+3; SKE VRUN; ER 36
       STA SWPRP (SET PROPRIETARY MODE)
GIFND  SKN PVTSW; BRU GIFN9; SKB K400 (CK IF NOT PRVT. READ); ER 39
GIFN9  C DTEMPR; LDX FLX; LDA 3,2       IBP
       SKNE ZERO (CK IF VALID ENTRY IN H.T.)
       ER 40 (VALUE WORD ZERO, EMPTY ENTRY); LDA 2,2; RCY 18; ETR SEVEN
       STA GOFNFT (GET AND SAVE FILE TYPE); LDA 2,2
       SKA K2B7 (CK IF DISC TYPE FILE); BRU *+2; ER 41; LDA 3,2; LDB K41
       BRS 1; BRU BRS1E; STA XT4; CLA; STA OPNCN
       LDX FLX; C CTAC; C MFD; BRU GFN18B; RCS XT4
       CAX; LDA XT4; LDB GOFNFT; R2
*      CREATES FILE NAME STRING
*IF STRING PTRS IN A,B- COPIES STRING FROM USER MEMORY
*IF B NEG., TAKES CHARS. FILE NO. IN A
*PUTS COMPLETE STRING IN XWR3, FILE NAME (TO -) IN FNPTR
*TLV22 AND TLV23 HAS ORIGINAL A,B
$CPSU  STP TLV22
$CPSU1 LDA XWR4X3; STA XWR3; STA XWR31
       SKN TLV23; BRU *+4 (FROM STRING)
       LDA =MXNAM; STA XT7 (CHAR CT.); BRU CPS
       LDA =TLV22; C SRSU; XMA SRSU21; ADM SRSU21
       SKG =MXNAM; BRU *+2; ER 13
CPS    CLA; STA XWR41
       LDX KM1; STX FNPTR (BEFORE DASH SW); C GCH; ER 11
       STA TLV21; STA TLV11 (FIRST CHAR)
       SKNE K15; ER 14
       SKE TEN
       SKNE THREE; BRU CP2A
       SKNE TWO; BRU CPA
       SKE EIGHT; BRU CP2; LDA NINE (SET TERM. CHAR)
CP     STA TLV11 (PROTECTED STRING TERM.); BRU CPA
*GETS PROTECTED STRING CHARS.
CPA    SKN TLV23; BRU CPC
       IF CEM; CIO TLV22; ELSE; C GCHT; BRU *-1; ENDF
       SKR XT7; BRU CP1
CPC    GCI SRSU20; ER 15
CP1    SKNE CRCH; ER 16; SKNE LINF; ER 17
       SKA K200; ER 49
       WCI XWR3; SKE TLV11; BRU CPA (GET NEXT CHAR. OF PROT. STRING)
       SKNE TWO; BRU CP3 (END PUBLIC FILE NAME)
       SKE NINE; BRU CP2A; BRU CP3A
CP3    C GCH; BRU CP5; ER 18
CP3A   C GCH; BRU CP3B; SKE BLKCH; BRU CP2
       SKN TLV23; GCD XWR3; BRU CP3A; BRU CP3A
CP3B   SKN TLV23; ER 21; SKE BLKCH; ER 20; CIO TLV22; BRU CP3A
*      TESTS FOR VALID UNPROTECTED CHAR.
CP2    SKG K72; SKG K37; BRU *+2; BRU CP2A
       SKG ='   Z'+40B; SKG K100; BRU *+2; BRU CP2A
       SKG K31; SKG K17 (17B); BRU CP4
CP2A   C GCH; BRU CP5; BRU CP2
*CHECK-OUT INVALID CHAR.
CP4    SKE SEVEN; SKNE K17; BRU CP (START COPY OF PROT. STRING)
       SKE K15; ER 19; SKN FNPTR; BRU CP2A (- AFTER 1ST OK)
       LDP XWR3; STP FNPTR; LDA KM1; ADM FNPTR1; BRU CP2A
CP5    SKN FNPTR; BRU *+3; LDP XWR3; STP FNPTR; LDA TLV21; R2 (NORMAL EXIT)
GCH    SKN TLV23; BRU GCH3
GCH1   LDA K377; CIT TLV22 (LOOK AHEAD); NOP
*TEST FOR TERMINATING CHAR.
$GCH1T LDX =BTCH-ETCH; SKE ETCH,2; BRU *+2; R1; BRX *-3
       IF CEM; CIO TLV22; ELSE; C GCHT; BRU GCH1; ENDF
       SKR XT7; BRU GCH4; SKR PDP; MIN PDC; ER 22
GCH3   GCI SRSU20; R1
GCH4   WCI XWR3; R2
       IF CEM
       ELSE
*GET CHAR. FROM TTY
GCHT   CIO TLV22; SKE V166B; BRU *+3; CIO TLV22; R2
       CAB; LDA CONTA; CIT TLV22; BRU GCHT1
       TCO K77; R1
GCHT1  CBA; R2
       ENDF
*      FILE NAME LOOK-UP, LOOKS FIRST IN DIR.,THEN IN PHYS. DIV. TBL.
*EXPECTS FILE NAME STRING PTRS. IN FNPTR
*NORMAL RETURN: ADR. IN A AND X
*ERROR RETURN: LOC. FOR NEW FILE IN X
$FNLK  STA TLV1
       SKNE V64B; BRU FNTEL (POSSIBLE TELETYPE)
       SKE V56B; BRU FNLB1+1
*CHECK IF NOTHING
       LDP NOTPT; C CKNM; BRU FNLB1
FNLK1  LDA TWO; STA FLX; COPY AX,B; R2
*CHECK IF TELETYPE
FNTEL  LDP TELPT; C CKNM; BRU FNLB2; LDA ONE; BRU FNLK1+1
FNLB1  LDA TLV1
       CLB; STB FLX (CURRENT FILE INDEX); STB FLPOS; STB XT11
       STB PVTSW
       SKNE TEN; BRU LIB2
       SKNE THREE; BRU LIB3
       SKNE EIGHT (FIRST CHAR); BRU PUB
       SKNE TWO; BRU LIB
$FNLS  LDA KM1; STA PVTSW (SET PRIVATE)
       LDA FDUN; SKE GRU; BRU FNL3 (GET OWNERS CURRENT DIR.)
FNLA   C FLOK; BRU FNL1
       C GLK (LOOK IN IN-CORE GRP FIRST); BRU *+2; R2 (FOUND)
       LDA GRCT; SKE ONE; BRU FNL1 (GO TO FIRST GROUP)
       LDA OVFP; SKE ZERO; BRU FNL2 (MORE GROUPS)
FNLA1  LDA PVTSW; SKG K777; SKG K37; ER 10; ER 8
FNL2   C GGRP; BRU FNL2A
       C GLK; BRU FNL2; R2
FNL2A  LDA GRP; SKE ZERO; BRU FNLA1; ER 51
FNL3   LDB FDAN
FNL3A  STB XT8; STB GAN; STA GRU
FNL1   CLA; STA GRCT; STA GRP; BRU FNL2
$FNLB  SKE TEN; SKNE TWO; ER 42
       SKE THREE; BRU FNLB1+1; ER 42
FNLB2  LDP TERPT; C CKNM; BRU FNLB1; BRU FNTEL+3
LIB    GCD FNPTR; R1
LIB2   CLA; STA TLV1; MIN FNPTR; LDX FNPTR; GCI FNPTR; R1; STX FNPTR
       LDX =PFT; SKG 0,2; BRU *+3; EAX 1,2; BRU *-3
       CXA; SUB =PFT-1000B; ADD TLV1
LIB4   STA PVTSW; LDB SIX; SKG =1013B; SKG K1000; CLB
       SKE K1000 (USER NO. 1000); BRU LIB1
       LDX JOB; SKN CPARW,2; R1 (NOT TYMSHARE PROP.)
LIB1   SKE GRU; BRU FNL3A; BRU FNLA
LIB3   LDA K14; BRU LIB2+1
PFT    ZRO 40B; ASC '  B  C  E  H  L  O  P  R  S  T'
PFTK   DATA 777B (END OF TABLE FORCE)
$K42 EQU PFT+1
$K43 EQU PFT+2
$K45 EQU PFT+3
$K57 EQU PFT+6
$K60 EQU PFT+7
$K50D EQU PFT+8
*LIBRARY GROUPING
*SPC,AB,C,DE,FGH,IJKL,MNO,P,QR,S,T,UVWXYZ
*USER NO'S 1000-1013 (STAR)
*USER NO'S 1014-1027 (POUND)
PUB    C LDBUF; MIN FNPTR; LDP FNPTR; STP TLV22
       GCI FNPTR; HLT 56B; SKE NINE; BRU PUBA
       LDX JOB; SKN CPARW,2; ER 23; LDA ONE; BRU LIB4
PUBA   LDA KM1; STA SW60
       LDA XWR31; STA SXWR31
       C GTEX; C GUN; ER 23
       SKE GRU; BRU PUB4
PUBS   LDP TLV22; STP FNPTR; LDB SXWR31; STP XWR3
       LDA GRU; SKE FDUN; BRU PUBS2
PUBS1  LDA KM1; STA PVTSW; BRU PUB6
PUBS2  LDA XT8; SKE REMAC; SKNE GOREMA; BRU PUBS1
       C TXPUB; BRU PUB1; BRU PUBS1
PUB1   GCI TLV22; BRU PUB5; SKG K77; BRU *+2; BRU PUBS1+1
       SKE K40 (AT-SIGN); BRU PUB1; BRU PUBS1+1
PUB4   STA GRU; CLA; STA GRCT; STA GRP
       C GGRP; HLT LFADR; BRU PUBS
PUB5   C TXPUB; CXA; SKE K60; R1
PUB6   LDA XT8; STA GAN; BRU FNLA
*CHECK SPECIAL NAMES
CKNM   STP XWR1; LDP FNPTR; STP UNPTR
CKNM1  GCI UNPTR; R2 (VALID NAME)
       STA XT1; GCI XWR1; R1 (NAME TOO LONG)
       SKE XT1; R1 (BAD CHAR); BRU CKNM1
*TEST IF SPECIAL PUBLIC
$TXPUB LDA UNO; SKNE GRU; R2
       LDX JOB; LDA XT8; SKE ANO; BRU TXP1 (NOT SAME ACCT.)
       LDA K12B6 (OPER AND ACCT. SUPER); SKA CPARW,2; R2
       LDA K40 (SHARABLE); SKA FDCONT; R2 (YES); ER 48
$TXP1  BRS 49 (IS IT AN EXEC FORK); SKA K100; BRU *+2 (YES); BRU TXP2
       BRS 5; SKA FOUR (FK EXEC STATUS); R2
TXP2   LDA CPARW,2; SKA X1; BRU *+2; ER 47
       LDA OPDSTR; ETR V7774B; SKNE ZERO; R2 (NO DISTRICT CK IF 0)
       SKE DSTRCT; ER 47; R2 (MUST BE SAME DISTRICT)
*CKS IF FILE PARAMETERS OK
$FLOK  LDX JOB; LDA GRP; SKE FGLIST,2; R1 (NOT OK)
       CLA; SKE GRCT; SKNE GRP; R1
       SKE DBF; R2; R1
*      GETS NAME STRING FROM COMMAND FILE
$GTNM  LDA CIN; C FNSET; LDA CIN; LDB KM1; C CPSU; R1; R2
$GTNM1 EQU GTNM+2
$FNSET ETR K7777 (... CHAR OTHER THAN MUL.SP., SP., CR, IS ENCOUNTERED)
       STA FN2
       LDA XWR4X3 (ALSO CONSTRUCT STR $FNPTR WHOSE 1ST CHAR IS THE EXIT CHAR)
       STA FNPTR; STA FNPTR1
FNSET2 LDA K377; CIT FN2; NOP; SKE MBCH; BRU *+3; CIO FN2; BRU FNSET1
       SKE BLKCH; SKNE CRCH; BRU FNSET1; SKNE LINF; BRU FNSET1
       SKE COMCH; R1 FNSET
FNSET1 CIO FN2; BRU FNSET2
*GENERAL FILE NAME LOOK-UP FOR IN-CORE GROUP
*IF SWPUB 0, WILL CHECK FOR SAME ACCT, & SYSTEM STATUS BITS
*NAME IN FNPTR (SAVES PTR)
GLK    LDX VDBF
LPG2   STX XT9; LDA 0,2 (CK FOR END OF DIR OR EMPTY); SKG ZERO
       BRU LPG7 (END); CXA; ADD FOUR (BUILD STRG PTR FOR NAME); C CMPR
       BRU GCHCM1; SKN PVTSW; BRU GLK2 (NOT PVT)
GLK1   LDA XT9; CAX; STA FLX; R2
GLK2   LDA PVTSW; SKE ZERO; BRU GLK1 (PUBLIC)
       LDA K40; LDX XT9; SKA 2,2; BRU GLK4 (ACCOUNT PUBLIC)
       SKR PDP; MIN PDC; ER 24
GLK4   STA PVTSW; BRU GLK1
LPG7   SKG KM1; SKG KM3; BRU *+2; R1
       LDA GRCT; SKE ONE; BRU LPG7A
LPG7B  CLA; STA OVFP; STA OVFP1
LPG7D  LDA KM2; LDX XT9; STA 0,2; R1
LPG7A  LDA OVFP1; SKG K3777; BRU LPG7B; LDA KM1; BRU LPG7D+1
$CMPR  MUL THREE; LSH 23; SUB ONE; STA TLV1
       LSH 6 (SET FOR MAX CONCEIV. LENGTH); STA TLV11; LDP FNPTR
       STP UNPTR (SAVE INPUT STRING); BRU *+2
LPG3   C GCHCM (GET CHAR. AND COMPARE); GCI TLV1; HLT EBASE
       SKG K177 (CK FOR LAST WORD FLAG)
       BRU LPG3 (NOT SET, GO COMPARE NEXT CHAR); EOR K200 (REMOVE FLAG)
       C GCHCM; GCI TLV1; HLT 166B; SKNE K136 (CK FOR FILL CHAR.)
       BRU LPG4 (FILL SO VALID NAME); C GCHCM; GCI TLV1; HLT RUN; SKE K136
       C GCHCM
LPG4   GCI UNPTR; R2; R1
GCHCM  STA TLV2 (SAVE CHAR); GCI UNPTR (GET CHAR FROM OTHER STRING)
       BRU GCHC1 (NO MORE CHARS); SKE TLV2; BRU *+2
       R1 (COMPARES, (EXIT FOR NEXT CHAR)); SKR PDP; MIN PDC; R1
GCHC1  SKR PDP; MIN PDC; LDA TLV2; SKNE K15
       R2 NEXT (CHAR. MINCH SO COMPARE OK); LDA KM1
       STA TLV1 (COMPARE OK SO FAR, BUT INPUT SHORT SW.); R1
GCHCM1 LDX XT9; EAX 3,2 (GO TO NEXT ENTRY IN FILE DIR.)
GCHCM4 EAX 1,2; CXA; SKG VLFADR; BRU GCHCM3; LDX VDBF; LDA =432B5
       STA 122,2; LDA KM1; STA 123,2; EAX 123,2; STX XT9; R1
GCHCM3 SKN 0,2 (CK FOR END OF NAME FLAG); BRU GCHCM4 (NOT END OF NAME)
       EAX 1,2 (GO TO FIRST WORD, NEW ENTRY); BRU LPG2
*      IF GRCT 0, THEN GETS GROUP 1, OTHERWISE NEXT GROUP
*      ERROR EXIT IF NO MORE GROUPS
$GGRP  LDA GRCT; SKE ZERO; BRU GG1; LDA ONE; STA XT1; LDA GRU; STA XT2
GG     C FLA; BRU GG2 (GROUP BUSY ON WRITE)
       LDX JOB; LDA XT2; SKE FGLIST,2; BRU GGG
       SKE GRP; BRU GGG; BRU GGA
GGG    STA FGLIST,2; C XFFD; CLA; STA FLX; STA GRP
       LDA VDBF; LDX K200; BRS 124; LDA DBF; SKNE ZERO; ER 51
       LDA XT2
       C FLA; BRU GG2 (NOW BUSY)
       LDB OVFP2; LDA GRCT; SKN FDCONT; SKE ZERO; BRU *+2; STB FDCONT
GGA    LDB XT1; STB GRCT; LDA XT2; STA GRP; BRS 23; R2
GG1    LDA OVFP; SKNE ZERO; ER 52; SKE GRU; BRU *+4
       LDA OVFP1; SKNE ZERO; ER 52
       SKG K3777; HLT LFDD (NOT VALID PTR)
       STA XT2; MIN GRCT; LDB GRCT; STB XT1; BRU GG
GG2    LDA ONE; BRS 81; LDA XT2; BRU GG
*      CHECK FILE GROUP LIST ROUTINES
*CHECKS IF ANY BUSY ON WRITE.  IF BUSY, CORRECT USE IS TO WAIT
*BEFORE READING GROUP FROM DISC.
$FLA   BRS 22; MRG X4; LDX =-[NJOB1+1]*2
       SKE EFGL,2; BRU *+2; ER 53; BRX *-3; R2
*MAKE GROUP BUSY ON WRITE.  TAKE AWAY FROM OTHER USERS.  CORRECT USE
*REQUIRES WE CHECK TO SEE THAT WE STILL HAVE THE GROUP BEFORE
*BUSYING IT.
$FLB   LDA GRP; CLB; MRG X4; LDX JOB; STA FGLIST,2; EOR X4; LDX =-[NJOB1+1]*2
       SKE EFGL,2; BRU *+2; STB EFGL,2; BRX *-3; R1
$FLB1  EQU FLB+1
*CHECK GROUP FOR OUTDATED COPY.  USE BEFORE FLB.
$FLC   LDA GRP; LDB K3S7; LDX JOB; BRS 22; SKM FGLIST,2; R1; R2
*MAKE GROUP BUSY.  USE BEFORE MFD.
$MKBUSY C FLC; ER 30; C FLB; R2
*FLUSH CURRENT GROUP TO DISC.  ASSURE CURRENT COPY.
$WFD   C MKBUSY; BRU ERRET; C MFD3; BRU ERRET; R1
*      WRITES CURRENT GROUP ON DISC
*ERROR RETURN IF GRP NOT IN LIST (SOMEONE CHANGING DIR.)
$MFD   BRS 22; LDA GRP; LDB K3S7; LDX JOB; SKM FGLIST,2; BRU MFD1
MFD3   SKG =LUNO; SKG ZERO; ER 31
       C XFFD; LDA VDBF; LDX K200; BRS 123
       LDX JOB; LDA GRP; STA FGLIST,2; BRS 23; R2
MFD1   CLA; STA GRP; STA FGLIST,2; BRS 23; ER 34
*      COPIES FILE NAME TO STRING, INDEX IN X
$CPFN  ADD FOUR; STA TLV1; LDA XWR4X3; STA XWR3; STA XWR31
CPFN1  LDX* TLV1; C CPN; ER 46; C CPN; R1; C CPN; R1
       SKN* TLV1; BRU *+2; R1; MIN TLV1; BRU CPFN1
CPN    COPY XB,A; LSH 8; ETR K177; SKNE K136; R1
       CBX; WCI XWR3; R2
*DELETE FILE SUB. (REQUIRES F.D. INDEX IN X)
$DELFLS LDA 3,2; STA RLV4 (SAVE I.B.PTR); STX XT10
       LDB 2,2; SKE ZERO; SKB X4; BRU DEL4
       C TDEL; ER 24 (PROTECTED AGAINST DELETE)
DEL5   STB TLV4; C MKBUSY; R1; LDX XT10; C FDEL
        LDA TLV4; SKG K2B7; R2 (INIT DUMMY)
       LRSH 18; ETR SEVEN; LDX GRU; SNE FIVE
$DELX   CLX; LDA RLV4; LDB K57; C BRS1; BRU GOFNER
       STA RLV4; RCP RLV4; MRG X4; SCP RLV4; ER 44
       LDA RLV4; BRS 66; ER 44
       BRS 2; BRS 23; R2
DEL4   CLB; BRU DEL5 (DON'T RELEASE DBITS)
*TEST IF DELETABLE
$TDEL  SKN FDCONT; BRU *+2; R2
       LDA GRU; SKE ONE; BRU *+4
       LDA UNO; SKE ONE; ER 38
       LDB 2,2; SKB K4B4; ER 24; SKN PVTSW; BRU TDEL1
       SKB K200; ER 37; R2
TDEL1  SKB K2000; R2; ER 38
*REMOVE FILE ENTRY FROM GROUP.  GARBAGE COLLECTION.  WRITES
*UPDATED GROUP TO DISC.  GROUP SHOULD BE BUSY BEFORE FDEL.
$FDEL  STX XT10; BRS 55; BRS 46
       LDX XT10; CLA; STA FLX; XMA GRP; STA XT11
       EAX 3,2; EAX 1,2; SKN 0,2; BRU *-2
FDEL1  EAX 1,2; CXA; SKG VOVFP; BRU *+2; HLT GOTO (NO END FLAG)
       LDA 0,2; STA* XT10; MIN XT10
       SKG KM1; SKG KM3; BRU FDEL1
       LDA XT11; STA GRP; C MFD; HLT OVFP; R1
*      INSERTS NEW ENTRY IN LAST GROUP, ADR. IN A
$INSFN STA XT5; LDA FDAN
       SKN FDCONT; SKNE REMAC; BRU INS; LDA GRU; LDB FDCONT
       SKE UNO; SKB EIGHT; BRU INS; ER 43
INS    BRS 55; LDA XWR31; SUB XWR3; ADD K21 (2 CHARS PLUS 6 WORDS)
       LRSH 23; DIV THREE
       ADD XT5; SKG VOVFP; BRU INS1
*NEW ENTRY WON'T FIT, SETUP AND WRITE OLD, CREATE NEW BLOCK
       BRS 46; SKN FDCONT; BRU *+2; BRU INS5
       SKN NGRP; ER 32; MIN NGRP
INS5   LDX XT5; LDA KM1; STA 0,2
       CLA; C GB; BRS 131; STA OVFP1; ABC; XMA GRP; SKE GRU; LDB GRU
       STB OVFP (IF 1ST GRP, PTS TO 1ST OVERFLOW =OVFP1)
       LDX JOB; LDA FGLIST,2; EOR X4; C MFD+2; BRS 131; BRS 55
       BRS 22; LDA OVFP1; STA GRP; STA FGLIST,2; MIN GRCT; LDX KM200
       CLA; STA EDBF,2; BRX *-1; LDA GRU; STA OVFP; LDA KM2
       STA DBF; C MFD (WRITE IN CASE OF CRASH); BRS 131
       LDX VDBF; STX XT5 (SET ADR. TO BEGINNING OF BLOCK)
INS1   LDA XT5; ADD FOUR;  STA TLV22; GCI XWR3; HLT XWR3; STA XT6; C PKCHR
       LDA KM2; LDX TLV22; STA 1,2; LDX XT5; LDA XT6; CXB; R2
$PKC    GCI XWR3; BRU PKCA; MIN TLV22
PKCHR  CLB; LSH 16; STA* TLV22; GCI XWR3; BRU PKCB
       CLB; LSH 8; ADM* TLV22; GCI XWR3; BRU PKCC
       ADM* TLV22; BRU PKC
PKCA   LDA X4; ADM* TLV22; R1
PKCB   LDA =136B*400B; ADM* TLV22; BRU PKCA
PKCC   LDA K136; BRU PKCB+1
*      SET UP WINDOW TO USER
$SUSR  STA SUSR2; RCY 11; ETR SEVEN; MUL THREE; CBX
       LDP CMRL1; LCY 0,2; LRSH 12; STA SUSR3
       BRS 43; LCY 12; ETR KS4B4; MRG SUSR3; RCY 12; BRS 44
       LDA SUSR2; ETR K3777; ADD K2B4; CAX; R1 SUSR
*      SET UP WINDOW FOR STRING POINTER
$SRSU  CAX; LDA 1,2; SUB 0,2; STA SRSU21
SRSP   LDA 0,2; ADD ONE; MUL THRD; AXC
       LCY 2; STA SRSU20; CXA; C SUSR; MUL THREE; LSH 23; SUB ONE
       ADD SRSU20; STA SRSU20; R1 SRSU
*      WRITE STRING TO USER
$WRSU  STA SRSU3; CBX
       C SRSP; STA SRSU21; LDX SRSU3
WRSU1  GCI 0,2; R1 WRSU; WCI SRSU20; BRU WRSU1
* UPDATE PGM RELABELING
$UPDRL LDP CMRL1
       LCY 0,2
       MRG NIO1
       RCY 0,2
       STP CMRL1
       R1 UPDRL
*      GETS NEW GROUP LOC. OR RELEASES OLD GRP, ETC
*IF GBFG CALLED WITH
* 0    GETS NEW GRP, TURNS BIT ON
* GRP  RELEASE GRP BY TURNING BIT OFF
* GRP PLUS SIGN, TURNS THAT GROUP BIT ON
$GBFG  SKG =LUNO; SKG K3777; BRU GBA
       C GBS; BRU *+2; R1
GB1    EOR XT2; STA FBMAP,2; R2
GBA    SKE ZERO; BRU GBB
GB     LDA =LUNO; BRS 22
GBA1   STA XT3; C GBS; BRU GBA2; EOR XT2; STA FBMAP,2
       LDA XT3; SKG =LUNO; SKG K3777; R1; R2
GBA2   SKE KM1; BRU *+3; SKB ONE; BRU *+3; LDA KM1; BRU *+2
       LDA KM30; ADD XT3; BRU GBA1
GBB    ETR K3S7; SKG =LUNO; SKG K3777; R1
       C GBS; R1; BRU GB1
GBS    SUB =ENFD+1; LRSH 23; DIV K30; STA XT1; CBX
       LDA X4; LRSH 0,2; STA XT2; CAB; LDX XT1
       LDA FBMAP,2; SKM KM1; R2; R1
*      GETS FILE INDEX BY POS
*POS. IN A, FLPOS AND FLX HAVE CURRENT KNOWN POS-
*BOTH CLEARED BY FNLK
$FLNUM STA XT3; LDX JOB; LDA GRP
       SKE ZERO; SKE FGLIST,2; BRU FL2
       LDA FLX; CAX; SKNE ZERO; BRU FL2
       LDA FLPOS; SKNE ZERO; BRU FL2
       SKG XT3; BRU FL1
FL2    CLA; STA GRCT; STA FLPOS
FL4    C GGRP; R1; LDX VDBF
FL     LDA 0,2; SKG ZERO; BRU FL4; STX FLX; MIN FLPOS
       LDA FLPOS
FL1    SKE XT3; BRU FL5; CXA; R2
FL5    EAX 3,2; EAX 1,2; SKN 0,2; BRU *-2; EAX 1,2; BRU FL
*BRS 58 - RENAME FILE -  EXPECTS STRING POINTERS IN A,B, AND X
*OLD NAME  A AND B, NEW NAME B AND X (STRINGS CONCATENATED)
BRS58 SKR SW58
$BRS581 NOP 0 (SET SW NEG.) (SEE OLD RENAME)
       C CPSU; BRU BRS111; C FNLB; BRU BRS111; STA TLV4; C TDEL; BRU BRS111
       LDX KM200; LDA EDBF,2; STA MBX2,2; BRX *-2 (SAVE BLK)
       LDA GRU; STA S1; LDA GRP; STA RLV4
       C FLC; BRU BRS111; STA GBUSY,2; BRS 23
       LDP UB; C CPSU; BRU BRS111; STA TLV1
       C GTEM; LDA TLV1; BRU RENB2
$CKUSER LDX KMJOB; LDB K3S5; SKM EAUNN,2; BRU *+2; R1 RLV1 (ALREADY ON)
       BRX *-3; R2 RLV1
*SETS UP 9 BIT DATE FOR C.F.D. CREATION DATE
$DAY   LDA REAL; ABC; DIV K1800D; ADD UDMIN (MINUTES OF DAY)
       STA TLV1; ETR K1S5 (REMOVE MONTH BITS); ABC
       DIV K720D (CALCULATE DAY); XMA TLV1; RSH 11 (POSITION MONTH BITS)
       ETR K740 (KEEP ONLY MONTH); MRG TLV1 (MERGE IN THE DAY); RSH 9
       LDA YEAR; LSH 9; R1 DAY
*COUNT UP ACTIVITY FIELD IN FIL DIR.
$CTAC  LDA 0,2; ADD K2B4; SKG =3774B4; STA 0,2; R1
*INCREMENTS ACCESS COUNT IN HASH TABLE
*H.T.LOC IN TLV1, SAVES REGS.

*RELABELING ROUTINES

$GTEM  BRS 43; XAB; ETR K7777; MRG =EXPG34; BRU GTEX1
$GTEXM EQU GTEM
$GTEX  BRS 43; XAB; ETR KS6; MRG =EXPG3
GTEX1  XAB; BRS 44; R1
$GTFIO BRS 43; XAB; ETR =77770077B; MRG KFIOPG; BRU GTEX1
*      AF RETURN
$AFRET BRS 43; XAB; ETR =77770077B; BRU GTEX1
$GTXFD SKP RLSW; R1; BRS 43; STA RLSW; XAB
       ETR =77770077B; MRG =EXPG5; BRU GTEX1
$XFDRET SKN RLSW; R1; CLA; STA RLSW; BRU AFRET
*CK ACCT. AND WRITE IF NEC.
$CACT  C DTEMPR
       LDA UTTY; SKN DMIN; SKG ONE; BRU CACT4
CACT1  BRS 22; LDA REAL; SUB =18000
       IF LOGM
       SKG LGMON; BRU CACT2
       C GTFIO; C ARMN; BRU CACT1
       ENDF
CACT2  SKG LGRS; BRU CACT3
       CAB
       LDA ONE; SKG SSTIME; BRU CACT3A
       C GTFIO; C ARRS; BRU CACT1
CACT3A CBA
CACT3  SKN MASTER; BRU CACT4; SKG LFLUSH; BRU CACT4
       C GTXFD; C FLUSH; NOP; C XFDRET
CACT4  BRS 23; R1
*FINDS USERS FILE DIRECTORY LOCATION ON DISC
$XFFD  RSH 23; DIV K100 (64)(FIND DISC NO., 64 FILE DIR. PER DISC)
       STB TLV1; SKG THREE (USING DISC 0,1,2,3?); BRU FFD2; SKG VLFDD
       BRU FFD3; HLT BADTS (BAD F.D. PTR)
FFD2   CLB
       LSH 12 (CHANGE TO DISC ADR.); ADD TLV1; LSH 1
       ADD K200 (DISC STARTING ADR.); CAB; R1 FFD
FFD3   SKG K43; BRU FFD4; SUB K20 (16); BRU FFD2
FFD4   SUB FOUR; XAB; SUB K100; XAB; STB TLV1; BRU FFD2
*ENTRY FOR UNO IN A
*      CHANGE COMMAND FILE OR CLOSE FILES
*TYPES ERROR AND WAITS UNTIL DONE
$CMER  STX TLV1; BRS 181 (RESET CIN AND COUT)
CMER1  LDX KM1; BRS 14; BRS 11; MSET M59 (ERROR, TYPE:)
       MSET* TLV1; LDA LINF; BRS 47
       CIT CIN
       R1 CMER
       C TWHY; BRU CMER1
$TWHY  CLA; XMA ERCODE; STA XT17 (DESTROYED BY MSET POP)
       SKG K777; SKG KM1; R1; MSET* XT17; R1

*OPEN FILE (LIKE BRS 1) FOR OUTPUT.  ASSURES FDCB IN CORE.

BRS193 C BRS1; BRU BRS111; BRU BRSEX
BRS1A  LDA XT13 (IBP)
BRS1B  LDX XT4 (GRU OR ZERO)
BRS1   STP S1; C STKI; CXA; SKG K3777 (=ENFD)
$BRS1C EQU *;* RETURN FROM PG. 22 CODE
       SKN MASTER; CLX; STX FDNO
       LDP S1; BRS 1; BRU BRS1F
       SKR PDP; MIN* PDP; MIN PDP (ASSURE SKIP RETURN)
BRS1D  STA S1; C XFDRET (RELABEL BACK)
       C POPI; LDP S1; R1
BRS1F  XXA; SKE SIX; BRU BRS1G
       C GTXFD; BRU BRS1E6 (IN PG. 22)
BRS1G  XXA; BRU BRS1D
*BRS 1 ERROR RETURN
$BRS1E STA TLV11 (SAVE DISC ADDR); C GTEM; BRU BRS1ER

*STACK PROGRAM INTERMINABILITY
$STKI  LDA DNTERM; STA S4; BRS 49; LSH 2; STA S5; R1
*RECALL PROGRAM TERMINABILITY
$POPI  SKN S4; BRU POPI2; BRS 23
POPI1  SKN S5; BRS 47; R1
POPI2  LDA S4; STA DNTERM; BRU POPI1
*SETS UP DISC BUFFER
$LDBUF LDA LDTEMP; SKE ZERO; R1 PDN1; BRS 144 (GET BUFFER)
       LDA =32000B (NO BUFFER AVAILABLE); STA LDTEMP; R1 PDN1
*RELEASE BUFFER
$DTEMPR CLA; XMA LDTEMP; SKG ZERO; R1
       SKG K3777; BRS 145 (RELEASE DISC BUFFER)
       SKA KM4B3; BRS 4 (RELEASE PAGE); R1
* CHECK TS VERIFICATION WORD
       BRU CALL
$CKTS  NOP TLV0
       LDA CKTS-1; STA 102B (MAKE CERTAIN CALL IS INTACT)
       LDA VPDL; STA PDP; LDA VNPD; STA PDC
       LDA TSVER; SKE 3777B; BRU GOWAY
       LRSH 15; SKU JOB; BRR TLV0
* GET RID OF USER WITH BAD TS PAGE
$GOWAY BRS 46 (DISABLE ESCAPES)
       C KILL6 (KILL PMT)
       LDX JOB
       STB FGLIST,2 (CLB DONE IN KILL6)
       STB GBUSY,2
       LDA VBADTS
       C MSG
       C WRDUM
       MIN BTS (COUNT OF USERS OFF DUE TO BAD TS)
       BRU LGOUT3 (WAIT FOR MSG TO GET OUT)
WRDUM  C GTFIO
       BRU AROFB (WRITE DUMMY OFF RECORD)
BADTS  ASC 'BAD TS PAGE/'
*ESCAPE FROM EXEC BRS
$ESCAPE ZRO TLV1; SBRM CKTS
       CLEAR; BRS 11; STA CMND (BRS 142 SWITCH)
       STA RLSW (SEE GTXFD CODE)
       LDX JOB; STA FGLIST,2; STA GBUSY,2; BRS 115
*      PUSH DOWN ROUTINES (REPLACES SBRM)
$CALL  SKR PDC; BRU *+2; BRU ESCAPE+1 (TRY TO CLEAN UP END OF STACK)
       XMA 0; STA* PDP; XMA 0; MIN PDP; BRU* 0
$R1    SKR PDP; MIN PDC; BRR* PDP
$R2    SKR PDP; MIN* PDP; BRU R1+1
*ERROR CODE POP
$ERR   EAX* 0; XXA; ETR K3S4; STA ERCODE; SKG K74 (60D); BRU *+2; BRU ERRET
       XXA; R1
$TERMWD DATA 27657537B (TERMINATING WORD FOR MAGTAPE FILES)
$FLAG  DATA 55555555B (EMPTY FIELD FLAG)
*STANDARD RESPONSES - FOR OUTPUT TO COMMAND O/P MEDIUM
$E3    ASC ' OLD FILE/'
$E4    ASC ' NEW FILE/'
$M19   ASC '  /'
$M25   ASC '$PROGRAM: /'
$M26   ASC ': /'
M59    ASC 'ERROR, TYPE: /'
*TABLE OF CHARACTERS
$LINF  ZRO 152B
$BTCH  EQU LINF
$CRCH  ZRO 155B
$BLKCH ZRO 0
$COMCH ZRO 14B
$SEMIC ZRO 33B
$ETCH  EQU *
$GRCH  ZRO 36B
$K30D  EQU GRCH
$COLNCH ZRO 32B
$MBCH  ZRO 135B
$EOTCH ZRO 144B
$TERMCH ZRO 137B
$CONTA ZRO 141B
$KMJOB DATA -NJOB1
$KM30  DATA -30B
$K74   DATA 74B
$K31   ZRO 31B
$K41   ZRO 41B
$K47   ZRO 47B
$K136  ZRO 136B
$K740  ZRO 740B
$K720D DATA 720
$K1400 ZRO 1400B
$K1440D ZRO 1440
$K1800D ZRO 1800
$K3600D ZRO 3600D
$K1B3  DATA 1B3
$K12B6 DATA 12B6
$K17B6 DATA 17B6
$K77B4 DATA 77B4
$K77B5 DATA 77B5
$K177B5 DATA 177B5
$K44   DATA 44B
$K72   DATA 72B
$K3700 DATA 3700B
$K100D DATA 100
$K120  DATA 120B
$K76B6 DATA 76B6
$K300  DATA 300B
$K3B4  DATA 3B4
$K12B5 DATA 12B5
$K34B3 DATA 34B3
$K74B4 DATA 74B4
$THRD DATA 12525253B
$KFIOPG DATA FIOPG
TEL    ASC 'TELETYPE'
TER    ASC 'TERMINAL'
NOTH   ASC 'NOTHING'
TELPT  DATA 3*TEL-1,3*TEL-1+8
TERPT  DATA 3*TER-1,3*TER-1+8
NOTPT  DATA 3*NOTH-1,3*NOTH-1+7
$SYSVER ASC '  G'
$XWR4X3 ZRO 10B (XWR4 IN TS MUST BE AT LOC. 3)
$VNTTY DATA NTTY
$VNCMEM DATA NCMEM
$VPRGRL DATA PRGRL
$VPRRL1 DATA PRGRL1
       NOLIST EXT
       END
EXEC ** FICHE/FRAME BREAK *****
GS SYMSORT

SYM.  PG.LN. IDENT.

111EN0  4  5 GS93    111ENB  4  1 GS93    AFRET  17 15 GS93    
BADTS  19 29 GS93    BLKCH  20 17 GS93    BRS1   18 22 GS93    BRS111  3 39 GS93    
BRS142  3 30 GS93    BRS193 18 19 GS93    BRS1A  18 20 GS93    BRS1B  18 21 GS93    
BRS1C  18 23 GS93    BRS1D  18 27 GS93    BRS1E  18 33 GS93    BRS1F  18 29 GS93    
BRS1G  18 31 GS93    BRS37A  3  3 GS93    BRS48   3 36 GS93    BRS58  16 25 GS93    
BRS581 16 26 GS93    BRS6    2 27 GS93    BRS60   3 35 GS93    BRS62   4  7 GS93    
BRS63   4 10 GS93    BRS64   4 13 GS93    BRS65   4 15 GS93    BRS67   3 24 GS93    
BRS67A  3 27 GS93    BRS6A   2 32 GS93    BRS6B   3  1 GS93    BRS6C   3  2 GS93    
BRS95   2 13 GS93    BRS96   2 16 GS93    BRS96A  2 20 GS93    BRS96B  2 22 GS93    
BRSEX   3 38 GS93    BTCH   20 15 GS93    CACT   17 20 GS93    CACT1  17 22 GS93    
CACT2  17 27 GS93    CACT3  17 32 GS93    CACT3A 17 31 GS93    CACT4  17 34 GS93    
CALL   19 36 GS93    CK65    5 11 GS93    CKNM   10 34 GS93    CKNM1  10 35 GS93    
CKOPTM  2  4 GS93    CKTS   19 11 GS93    CKUSER 16 33 GS93    CMER   18  8 GS93    
CMER1  18  9 GS93    CMPR   12  2 GS93    COLNCH 20 23 GS93    COMCH  20 18 GS93    
CONTA  20 27 GS93    CP      7 35 GS93    CP1     8  2 GS93    CP2     8 12 GS93    
CP2A    8 15 GS93    CP3     8  7 GS93    CP3A    8  8 GS93    CP3B    8 10 GS93    
CP4     8 17 GS93    CP5     8 20 GS93    CPA     7 37 GS93    CPC     8  1 GS93    
CPFN   13 26 GS93    CPFN1  13 27 GS93    CPN    13 29 GS93    CPS     7 27 GS93    
CPSU    7 21 GS93    CPSU1   7 22 GS93    CRCH   20 16 GS93    CTAC   17  3 GS93    
DAY    16 36 GS93    DEL4   14  3 GS93    DEL5   13 35 GS93    DELFL   3 19 GS93    
DELFLS 13 32 GS93    DELX   13 38 GS93    DTEMPR 19  6 GS93    E3     20  7 GS93    
E4     20  8 GS93    EOTCH  20 25 GS93    ERR    20  2 GS93    ESCAPE 19 31 GS93    
ETCH   20 20 GS93    EXECRL  2 10 GS93    FDEL   14 13 GS93    FDEL1  14 16 GS93    
FFD2   17 39 GS93    FFD3   18  3 GS93    FFD4   18  4 GS93    FL     16 19 GS93    
FL1    16 21 GS93    FL2    16 17 GS93    FL4    16 18 GS93    FL5    16 22 GS93    
FLA    13  4 GS93    FLAG   20  5 GS93    FLB    13  9 GS93    FLB1   13 11 GS93    
FLC    13 13 GS93    FLNM    3 11 GS93    FLNM2   3 16 GS93    FLNM3   3 12 GS93    
FLNM4   3 17 GS93    FLNUM  16 12 GS93    FLOK   11 10 GS93    FNL1    9 29 GS93    
FNL2    9 24 GS93    FNL2A   9 26 GS93    FNL3    9 27 GS93    FNL3A   9 28 GS93    
FNLA    9 19 GS93    FNLA1   9 23 GS93    FNLB    9 30 GS93    FNLB1   9 10 GS93    
FNLB2   9 32 GS93    FNLK    9  2 GS93    FNLK1   9  7 GS93    FNLS    9 17 GS93    
FNSET  11 16 GS93    FNSET1 11 23 GS93    FNSET2 11 20 GS93    FNTEL   9  9 GS93    
GB     15 38 GS93    GB1    15 36 GS93    GBA    15 37 GS93    GBA1   15 39 GS93    
GBA2   16  2 GS93    GBB    16  4 GS93    GBFG   15 34 GS93    GBS    16  6 GS93    
GCH     8 21 GS93    GCH1    8 22 GS93    GCH1T   8 24 GS93    GCH3    8 27 GS93    
GCH4    8 28 GS93    GCHC1  12 15 GS93    GCHCM  12 12 GS93    GCHCM1 12 18 GS93    
GCHCM3 12 21 GS93    GCHCM4 12 19 GS93    GCHT    8 32 GS93    GCHT1   8 35 GS93    
GFN     4 20 GS93    GFN10A  6 20 GS93    GFN18B  6 17 GS93    GFNST   4 22 GS93    
GG     12 26 GS93    GG1    12 35 GS93    GG2    12 39 GS93    GGA    12 34 GS93    
GGG    12 29 GS93    GGRP   12 25 GS93    GIFN10  6 39 GS93    GIFN11  7  2 GS93    
GIFN9   7  8 GS93    GIFNB   6 34 GS93    GIFNB1  7  3 GS93    GIFND   7  7 GS93    
GLK    11 27 GS93    GLK1   11 31 GS93    GLK2   11 32 GS93    GLK4   11 35 GS93    
GOFN10  6 19 GS93    GOFN18  6 14 GS93    GOFN22  6 10 GS93    GOFN23  6 13 GS93    
GOFN29  6 27 GS93    GOFN33  6 29 GS93    GOFN4   5  7 GS93    GOFN54  6 28 GS93    
GOFN7   5 10 GS93    GOFN8A  4 38 GS93    GOFN8B  5  5 GS93    GOFN9   5  1 GS93    
GOFN9A  5  4 GS93    GOFN9B  5  2 GS93    GOFNA   4 32 GS93    GOFNB   5 16 GS93    
GOFNB1  5 24 GS93    GOFNB3  6  3 GS93    GOFNB4  5 28 GS93    GOFNER  6 30 GS93    
GOWAY  19 17 GS93    GRCH   20 21 GS93    GSFI    4 33 GS93    GSFN    4 21 GS93    
GTEM   17  9 GS93    GTEX   17 11 GS93    GTEX1  17 12 GS93    GTEXM  17 10 GS93    
GTFIO  17 13 GS93    GTNM   11 14 GS93    GTNM1  11 15 GS93    GTXFD  17 16 GS93    
INS    14 24 GS93    INS1   14 38 GS93    INS5   14 30 GS93    INSFN  14 21 GS93    
K100D  21 11 GS93    K120   21 12 GS93    K12B5  21 16 GS93    K12B6  21  3 GS93    
K136   20 34 GS93    K1400  20 37 GS93    K1440D 20 38 GS93    K177B5 21  7 GS93    
K17B6  21  4 GS93    K1800D 20 39 GS93    K1B3   21  2 GS93    K300   21 14 GS93    
K30D   20 22 GS93    K31    20 31 GS93    K34B3  21 17 GS93    K3600D 21  1 GS93    
K3700  21 10 GS93    K3B4   21 15 GS93    K41    20 32 GS93    K42    10  5 GS93    
K43    10  6 GS93    K44    21  8 GS93    K45    10  7 GS93    K47    20 33 GS93    
K50D   10 10 GS93    K57    10  8 GS93    K60    10  9 GS93    K72    21  9 GS93    
K720D  20 36 GS93    K74    20 30 GS93    K740   20 35 GS93    K74B4  21 18 GS93    
K76B6  21 13 GS93    K77B4  21  5 GS93    K77B5  21  6 GS93    KFIOPG 21 20 GS93    
KM30   20 29 GS93    KMJOB  20 28 GS93    LDBUF  19  3 GS93    LIB     9 33 GS93    
LIB1   10  1 GS93    LIB2    9 34 GS93    LIB3   10  2 GS93    LIB4    9 37 GS93    
LINF   20 14 GS93    LPG2   11 28 GS93    LPG3   12  5 GS93    LPG4   12 11 GS93    
LPG7   11 36 GS93    LPG7A  12  1 GS93    LPG7B  11 38 GS93    LPG7D  11 39 GS93    
M19    20  9 GS93    M25    20 10 GS93    M26    20 11 GS93    M59    20 12 GS93    
MBCH   20 24 GS93    MFD    13 20 GS93    MFD1   13 24 GS93    MFD3   13 21 GS93    
MKBUSY 13 15 GS93    MSGT    1 34 GS93    MSGT1   1 36 GS93    MSGT2   1 39 GS93    
NOTH   21 23 GS93    NOTPT  21 26 GS93    OUT     4 25 GS93    OUT1    4 24 GS93    
PFT    10  3 GS93    PFTK   10  4 GS93    PKC    15  1 GS93    PKCA   15  5 GS93    
PKCB   15  6 GS93    PKCC   15  7 GS93    PKCHR  15  2 GS93    POPI   18 38 GS93    
POPI1  18 39 GS93    POPI2  19  1 GS93    PUB    10 15 GS93    PUB1   10 27 GS93    
PUB4   10 29 GS93    PUB5   10 31 GS93    PUB6   10 32 GS93    PUBA   10 18 GS93    
PUBS   10 22 GS93    PUBS1  10 24 GS93    PUBS2  10 25 GS93    R1     19 38 GS93    
R2     19 39 GS93    RLSG    6 31 GS93    SEMIC  20 19 GS93    SOPN    4 18 GS93    
SOPNCN  4 17 GS93    SOUT    4 26 GS93    SOUTS   4 27 GS93    SRSP   15 15 GS93    
SRSU   15 14 GS93    STKI   18 36 GS93    SUSR   15  9 GS93    SVBRK   4 28 GS93    
SYSVER 21 27 GS93    TDEL   14  5 GS93    TDEL1  14 10 GS93    TEL    21 21 GS93    
TELPT  21 24 GS93    TER    21 22 GS93    TERMCH 20 26 GS93    TERMWD 20  4 GS93    
TERPT  21 25 GS93    THRD   21 19 GS93    TWHY   18 14 GS93    TXP1   11  4 GS93    
TXP2   11  6 GS93    TXPUB  10 39 GS93    UPDRL  15 23 GS93    VNCMEM 21 30 GS93    
VNTTY  21 29 GS93    VPRGRL 21 31 GS93    VPRRL1 21 32 GS93    WFD    13 17 GS93    
WRDUM  19 27 GS93    WRSU   15 19 GS93    WRSU1  15 21 GS93    XFDRET 17 18 GS93    
XFFD   17 36 GS93    XRL1    2 11 GS93    XRL2    2 12 GS93    XWR4X3 21 28 GS93    

EXEC ** FICHE/FRAME BREAK *****
IN
IN93   IDENT   08/01/76

* NOTE THIS PACKAGE IS LOADED AT 33000B (2ND ACCOUNTING BUFFER)
*      AND LOCATION 33400B MUST BE ZERO AFTER LOADING.

$EI    LDX UTTY; LDA SUPNAM,2; CLB; STP XWR1; CLA; STP XWR3
       LDA XWR1X3; STA FNPTR; ADD THREE; STA FNPTR1
       LDA KM1; SKA UTTY; BRU *+2
       STA SVST; STA XWR45; LDA TEN; C STPAR; BRU ABORT

SUPNAM ASC 'SUP'
       ASC 'MAP'

IE0    LDX KM1; BRS 11
$IE    LDA KM1; STA DMIN (SET NO DMIN SW.)
       MSET EM13 (TYPE "LAST START UP"); C RKDIS; LDX LDTEMP; LDA 60,2
       STA CZONE; LDA* LDTEMP (GET LAST START UP TIME)
       C XTDAT (TYPE LAST START UP DATE/TIME)
       C TSYSNO (TYPE SYSTEM NO.)
       MSET HWID (HARDWARE ID:); SPTR HDWID; STP TLV0
       CLA; STA HDWID; LDX KM2
       CIO CIN; SKG K72; SKG K40; BRU IE0; WCI TLV0
       CIO CIN; SNE CRCH; BRU IEEF; WCI TLV0; BRX *-4
       CIO CIN; SKE CRCH; BRU *-2
IEEF   LDX K16
IE1    BRS 127 (TRY TO GET TIME FROM NETWORK CLOCK)
       SKA X4; BRU IE2 (GOT IT)
       LDA REAL; SKG =9*60; BRU IE1 (RETRY)
IE4    MSET MM10
       C RDNO (MONTH); SKG K14 (CK FOR VALID MONTH); SKG ZERO; BRU IE0
       CLB; SUB ONE; LSH 16; STA TLV1; C RDNO (DAY); SKG K37; SKG ZERO
       BRU IE0 (NOT VALID DAY); SUB ONE; MUL K720D; COPY BA,B; ADM TLV1
       LDA YEAR; SUB EIGHT; LSH 20; ADM TLV1 (YEAR IN BITS 0-3)
       C RDNO (HOUR); XAB; SNE CRCH; SKB X4; BRU IE0
       CLA; LSH 1; DIV K100D; STB TLV0 (MINUTES)
       SKG K27; BRU *+2; BRU IE0; MUL K30D; CBA; ADM TLV1
       XMA TLV0; SKL K74; BRU IE0
       ADM TLV1 (TLV1 NOW IN DMIN FORMAT)
       LDA TLV1
       SKN DMIN; BRU IEEX; BRS 46; BRS 22; COPY AX,B; STB DMIN
IE5    STB XTE
       LDA UZONE; LSH 12; MRG K120; XXA; C CDX; STA TYMTIM; LDA REAL
       MUL TMK; CNA; ADD TYMTIM; SKN DMIN; STA TYMTIM
       LDX =1200001B; C CDX (CUBS TO ZONE 1 DMIN)
       STA DMIN; LDA XTE; STA DSTSW; CLB; LDA ZMONTH; ADD ONE; SKE K14
       BRU *+3; SUB K14; MIN ZYEAR; RSH 4; LDA ZYEAR; LSH 14
       LDX =3010001B (FIELD TO DMIN); C CDX; STA TMK2
       LDX =10101B (DMIN TO COMP.BIN.); C CDX; SUB ONE
       LDX =1010001B (COMP. TO DMIN); C CDX
       STA TMK1 (23:59 LAST DAY THIS MONTH); ADD ONE; CNA; ADM TMK2
       LDA =5*3600; STA LGMON; STA LGRS; STA LFLUSH (DONT WRITE 1ST 10 MINS)
       LDA FORMAT; C ARW (RECORD ACCOUNTING TYPE); LDA TYMTIM
       STA* LDTEMP; LDX K100; LDA LDTEMP; LDB K200
       BRS 125 (WRITE NEW START-UP BACK ON DISC)
       SKN RWD (CK. DISC WRITE PROTECT FLAG); MSET M70 (WRITE PROTECTED)
       SKN RWR (CK. RAD FOR WRITE PROTECT FLAG); BRU INSET3 (YES)
INSET4 SKN SWXMA; BRU INSET5 (XMA NOT WORKING)
INSET8 SKN SW205; BRU INSET9 (205 INT. NOT WIRED); BRU INSET1
INSET3 MSET M71 (TYPE RAD WRITE PROTECTED); MSET M70A; BRU INSET4
INSET5 MSET MM21; MSET MM22; BRU INSET8
INSET9 MSET MM24; MSET MM22
INSET1 SKN RWD; BRU INSET2; SKN RWR; BRU INSET2
       SKN SWXMA; BRU INSET2; SKN SW205; BRU INSET2
IEEX   LDA LUDL; C SLUDL; STA TLV21; BRU AFRET
INSET2 EAX 1; BRS 14; BRS 130 (TEST BPT 1); BRS 131 (CRASH IF NOT SET)
       BRU IEEX
IE2    EOR X4 (TURN OFF SIGN)
       CAB
       EAX 1,2
       BRS 127 (PICK UP 2ND WORD OF DOUBLE INTEGER CLOCK)
       XAB
* DO DOUBLE INTEGER MULTIPLY BY 62500 (SECONDS TO DPB)
       ROV
       LSH     1
       STA     NIO1
       COPY    A
       RSH     1
       STB     NIO2
       LDA     NIO1
       MUL     =62500
       LSH     22
       STB     TLV1
       STA     TLV11
       LDA     NIO2
       MUL     =62500
       RSH     1
       COPY    AB,BA
       ADD     TLV1
       COPY    AB,BA
       ADC     TLV11
       OVT
       BRU IE4
* WE MAY HAVE TO INDEX BY YEAR HERE IF NETWORK CLOCK
*      IS CHANGED TO NO. OF SECONDS SINCE BEGINNING OF CURRENT
*      YEAR.
       XAB
       ADD NET2
       XAB
       ADC NET1
* CONVERT FROM DOUBLE PREC BINARY GMT TO DMIN IN USER'S TIME ZONE
       LDX =22B5; SKN DMIN; BRU IEEX
       BRS 46; BRS 22; C CDX; STA TLV1
       LDA ZYEAR; SUB FOUR; STA YEAR
       LDA TLV1; COPY AX,B; BRU IE5
* TABLE BEGINNING WITH JAN 1 74 0:00 GMT IN DOUBLE PREC BINARY
* ORIGINAL NETWORK CLOCK SPEC CALLED FOR SUPERVISOR TO SEND
* TIME IN SECONDS SINCE JAN 1 74 0:00 GMT.  TO BEGIN WITH SOME OTHER
* YEAR INDEX INTO THIS TABLE WHICH RUNS THROUGH JAN 1 85
       BSS 256+EI-*
       DATA 0  (START OF ACCOUNTING ADDRESSES)
NET1 DATA 6216702B,6564252B,7131623B,7477676B,10045246B,10412617B
     DATA 10760170B,11326243B,11673613B,12241164B,12606535B,13154607B
NET2 DATA 1636000B,62075000B,42334000B,12066000B,72325000B,52564000B
     DATA 33023000B,2555000B,63014000B,43253000B,23512000B,73244000B
HWID   ASC '$HARDWARE ID: /'
MM10   ASC 'ENTER MONTH-DATE-TIME: /'
MM21   ASC 'XMA'
MM22   ASC ' ERROR$/'
MM24   ASC '205 INT./'
M71    ASC '$RAD /'
EM13   ASC '$LAST START UP: /'

       NOLIST EXT

       END
EXEC ** FICHE/FRAME BREAK *****
IN SYMSORT

SYM.  PG.LN. IDENT.

EI      1  6 IN93    EM13    4  4 IN93    HWID    3 37 IN93    
IE      1 15 IN93    IE0     1 14 IN93    IE1     1 26 IN93    IE2     2 28 IN93    
IE4     1 29 IN93    IE5     2  2 IN93    IEEF    1 25 IN93    IEEX    2 25 IN93    
INSET1  2 23 IN93    INSET2  2 26 IN93    INSET3  2 20 IN93    INSET4  2 18 IN93    
INSET5  2 21 IN93    INSET8  2 19 IN93    INSET9  2 22 IN93    M71     4  3 IN93    
MM10    3 38 IN93    MM21    3 39 IN93    MM22    4  1 IN93    MM24    4  2 IN93    
NET1    3 33 IN93    NET2    3 35 IN93    SUPNAM  1 11 IN93    
EXEC ** FICHE/FRAME BREAK *****
KX
KX93   IDENT   02/21/74
       NOLIST EXT,STAT
* CONSTANTS

EXEC   EQU     1               USED TO CONTROL T.S. SYMBOLS
SYSLET EQU     '   S'          SYSTEM LETTER
TRU    EQU     -1              TYPE "TRU" FOR "CPU" IF 1
LOGM   EQU -1                  LOG MONITOR RECORD IF 1
ZCHK   EQU 1 (CHECK TO BE SURE LDTEMP NON-ZERO)
NEWGB  EQU 1   ASSEMBLE NEW GBIO CODE

SPTR   OPD 514B5,2
CIT    OPD     534B5
RCS    OPD     525B5
RSP    OPD     525B5
SSP    OPD     526B5
SKU    OPD     536B5,2
SKNE   OPD     536B5,2
SPB    OPD 100B5,2
MSET   OPD     10100000B,2,0
C      OPD     10200000B,2,0
TCF    OPD     10300000B,2,0
ER     OPD     10400000B,2,0

R1     MACRO D; BRU R1; ENDM
R2     MACRO D; BRU R2; ENDM
HLT    MACRO D;X NARG; IF X=1;$V.&D(1) DATA D(1); ELSE; DATA 0; ENDF; ENDM

LMB    EQU     200200B         DISC LOCATION OF MAIL BOX LIST
LMBM   EQU     LMB+40B         LOCATION OF MAIL
MBX    EQU     30000B          MAIL BOX BUFFER ADR.
MBX2   EQU     MBX+200B
MBXOP  EQU     MBX+124
MBXOP1 EQU     MBX+125
MBXOP2 EQU     MBX+126
EMBX   EQU     MBX+4000B
WORK   EQU     34000B          WORKING AREA
EWORK  EQU     WORK+256
LETEN  EQU     EWORK+256
NDATA  EQU     9               NO. OF WORDS IN A LUD ENTRY
NDISCS EQU     32              NUMBER OF DISCS
* FOLLOWING MUST BE COORDINATED WITH MONITOR

NTTY   EQU     64              NUMBER OF TTYS

HDWE   EQU 0 (CUSTOM SYSTEM FOR HARDWARE MAINTENANCE GROUP)
DISC   EQU 3 (1=DATA PRODUCTS DISC, 3= 2314)
MDSI   EQU 1 (1 TO ASSEMBLE MDSI EXEC)
CEM    EQU 1 (ASSEMBLE COMMAND EDIT)

       IF MDSI
NJOB1  EQU 46
       ELSE
NJOB1  EQU 46
       ENDF
       IF DISC=1
NJOB1  EQU 41
       ENDF

       IF HDWE; REM ASSEMBLING EXEC FOR MAINTENANCE GROUP
       ELSF MDSI; REM ASSEMBLING EXEC FOR MDSI
       ELSF 1; REM STANDARD 940 EXEC; ENDF
       RPT 1; REM ASSEMBLING FOR DISC TYPE ($DISC); ENDR
       RPT 1; REM ASSEMBLING FOR ($NJOB1) USERS; ENDR
       IF CEM; REM FEATURES COMMAND EDIT; ENDF

NCMEM  EQU     43B
NFDCB  EQU     35+5*DISC
LUNO   EQU     5577B       LAST VALID USER NO
ENFD   EQU     3777B
LFDD   EQU     47
OD     EQU      60             NO OF SECS ALLOWED FOR LOG ON TIME
FDCBP  EQU     120200B         STORAGE TABLE FOR FDS 0-3777B (2 PAGES)
P22CR  EQU     120300B         RESERVED FOR PG. 22 CRASH
P16CR  EQU     120340B         RESERVED FOR PG. 16 CRASH
LTMSG  EQU     160210B
LMAP   EQU     160200B
EX1BIT EQU     01000000B       FORK START UP BITS
EX2BIT EQU     40000000B       
EXPG2  EQU     13B
EXPG3  EQU     14000000B
EXPG4  EQU     150000B
EXPG34 EQU     EXPG3+EXPG4
FIOPG  EQU     1600B
EXPG5  EQU     2200B
EXPG6  EQU     2400B

NPD    EQU     9               PUSH DOWN STACK SIZE
MXNAM  EQU     75              MAXIMUM FILE NAME SIZE


       FREEZE


       END
EXEC ** FICHE/FRAME BREAK *****
KX SYMSORT

SYM.  PG.LN. IDENT.

C       1 21 KX93    CEM     2 10 KX93    CIT     1 13 KX93    
DISC    2  8 KX93    EMBX    1 36 KX93    ENFD    2 31 KX93    ER      1 23 KX93    
EWORK   1 38 KX93    EX1BIT  2 39 KX93    EX2BIT  3  1 KX93    EXEC    1  5 KX93    
EXPG2   3  2 KX93    EXPG3   3  3 KX93    EXPG34  3  5 KX93    EXPG4   3  4 KX93    
EXPG5   3  7 KX93    EXPG6   3  8 KX93    FDCBP   2 34 KX93    FIOPG   3  6 KX93    
HDWE    2  7 KX93    HLT     1 27 KX93    LETEN   1 39 KX93    LFDD    2 32 KX93    
LMAP    2 38 KX93    LMB     1 29 KX93    LMBM    1 30 KX93    LOGM    1  8 KX93    
LTMSG   2 37 KX93    LUNO    2 30 KX93    MBX     1 31 KX93    MBX2    1 32 KX93    
MBXOP   1 33 KX93    MBXOP1  1 34 KX93    MBXOP2  1 35 KX93    MDSI    2  9 KX93    
MSET    1 20 KX93    MXNAM   3 11 KX93    NCMEM   2 28 KX93    NDATA   2  1 KX93    
NDISCS  2  2 KX93    NEWGB   1 10 KX93    NFDCB   2 29 KX93    NJOB1   2 18 KX93    
NJOB1   2 15 KX93    NJOB1   2 13 KX93    NPD     3 10 KX93    NTTY    2  5 KX93    
OD      2 33 KX93    P16CR   2 36 KX93    P22CR   2 35 KX93    R1      1 25 KX93    
R2      1 26 KX93    RCS     1 14 KX93    RSP     1 15 KX93    SKNE    1 18 KX93    
SKU     1 17 KX93    SPB     1 19 KX93    SPTR    1 12 KX93    SSP     1 16 KX93    
SYSLET  1  6 KX93    TCF     1 22 KX93    TRU     1  7 KX93    WORK    1 37 KX93    
ZCHK    1  9 KX93    
EXEC ** FICHE/FRAME BREAK *****
MB
MB93   IDENT 02/24/78

$SYSPS DATA 0,0
SYSPS1 EXT SYSPS+1; DATA 76653132B,64372712B (1 N. HARDY)
       DATA 62525770B,12506134B (2    A. HARDY)
       DATA 65342342B,40477117B (3. D. GARDNER)
       DATA 61171445B,73327343B (4) CHUCK YOUNGER
       DATA 0,0                (5) RESERVED FOR PARIS.
       DATA 71400305B,07241311B (6) LAROY TYMES
       DATA 0,0 (7) RESERVED
       DATA 0,0 (10) RESERVED
       DATA 66706125B,44405424B (11   G. BLOOD)
       DATA 0,0 (12
       DATA 0,0 (13 JOHN KOPF ON SYSTEM 1 AND 10 ONLY)
       DATA 40476531B,65770557B  (14   ROY ROSKILLY)
       IF MDSI
       DATA 36126443B,54707744B (15) MDSI--SUBSYSTEM STATUS.
       ELSE
       BSS 2
       ENDF
       DATA 0,0 (16 - ROGER L'HOMMEDIEU)
       DATA 74263446B,54504313B  (17 R. SALTGAVER)
       DATA 0,0 (20) RESERVED
       DATA 72571560B,11576360B  (21. JILL MARCIN)
       DATA 35312330B,74075614B  (22 B. SCHELL)
       DATA 60201651B,16103623B  (23 CHARLIE CARTER)
$EXECI BRS 43; STP EXRL1 (GET EXEC RELABELING); LDA VPDL; STA PDP
       LDA VNPD; STA PDC; STA NAST (POS.=> TRAP CLEANUP O.K.)
       LDA TV100; STA 100B
       LDP TV101 (SET POP TRANSFER VECTORS); STP 101B
       LDP TV103; STP 103B; LDA =ESCAPE; STA 201B; LDA TWO; STA BRKTBL
       LDA REAL (GET REAL SYSTEM TIME); STA UREAL (RESET ELAPSED TIME)
       LDA JOB; CLB; LSH 15; MRG K3777; STA 3777B; STA TSVER
       LDA KM1
       STA TLV1 (TEMP THRU STPAR)
       IF CEM; STA TLCNR; STA CRSW; ENDF
       STA BUDGET (USE FOR SWITCH THRU $ENTER)
       STA MSW (ALLOW EMERB. WEMERG. MSG.)
       STA SYSTL (NO SUBSYSTEM IN USE); STA OVFP
       STA LETP (SET LETTER POINTER TO NO LETTERS IN)
       STA MSZ2 (SET SW TO  DO NOT FORCE EXIT); STA SWOFF
       STA NMCHX (SET NO NAME CHANGE CHARACTER); CLAB
       STA SCHDLY
       IF CEM; STA TLBUF; STA CVSW; ENDF
       STA FIO (SWITCH FOR FIO/NIO BRS'S)
       STA SGOREM (SAVED "GO" REMOTE ACCT)
       STA SREMAC (SAVED "COMMANDS" REMOTE ACCT)
       STA UNO (USER NOT LOGGED IN); STA EXFLAG (NOT PRIVILEGED)
       LDB =OD*1000*4 (ALLOWED LOG-ON TIME FOR TIM.FORK)
       SKN DMIN (CK IF FIRST USER)
       RSH 2 (4 TIMES THE TIME FOR INITIAL STARTUP); LDA =TIMOUT
       STA 205B (SET UP INTERRUPT LOC.)
       BRS 135; LDA KM2; STA SWTM
       LDA KM6; STA NGRP (ALLOW 6 ADDITIONAL F.D.GRPS)
       LDX UTTY; LDA WERIS,2
       BRS 47; SKE ZERO (SHOULD BE ON INITIAL ENTRY)
       BRU EXECI4 (CK FOR TROUBLE); LDA KM1; STA SWTM; LDA TWO; SKA EQPT
       BRU EXECI5 (BYPASS DELAY FOR 2314)); LDA K1000D (1 SEC. DELAY)
       BRS 81
EXECI5 LDA UTTY; SKG ONE; BRU *+2; BRU EXECIS
       C GTFIO; BRU EI
EXECIS C RRPA (READ PARITY PARAM. FROM REMOTE)
       CIO CIN; C STPAR (SET PARA FOR TTY)
       CIO CIN; LSH 18; ETR K77B6; STA AFSV5 (PART NODE)
       CIO CIN; LSH 12; ETR K77B4; ADM AFSV5 (REST OF NODE)
       CIO CIN; ETR K177; ADM AFSV5 (PORT)
       LDA THREE; BRS 12 (NO ECHO AND BREAK ON ALL)
       CLAB; STP XWR1; STP XWR3; LDA XWR1X3; STA FNPTR; STA FNPTR1
       CIO CIN; STA RLV4; SKE ONE (EXCL); BRU *+3
       STA BUDGET (SET SWITCH FOR DOUBLE COLON LOGIN)
EXECI6 CIO CIN; SKE CRCH; BRU *+2; BRU EXECI7
       SKE SEMIC; BRU *+2; BRU EXECI7
       SKG K77; BRU *+2; BRU EXECI6
       SKG COLNCH; BRU CI1
       SKG K72; SKG K37; BRU CI2; BRU CI3
CI1    SKE BLKCH; BRU *+2; BRU CI3
       SKE SEVEN; BRU *+2; BRU CI3
       SKE TEN; BRU *+2; BRU CI3
       SKG K13
CI2    LDA FOUR
CI3    WCI FNPTR; BRU EXECI6
EXECI7 STA TLV4 (PROMPT CONTROL FOR PROJ. CODE); CIO ONE
       LDP XWR1; STP UNM; LDP XWR3; STP UNM2 (SAVE USER NAME)
       LDP FNPTR; STP UNMP; LDA =UNMPCF; ADM UNMP; ADM UNMP1
       BRU ABORT
EXECI4 SKG KM3 (CK IF OFFINTERRUPT RECEIVED); BRS 109 (WAIT OFFINT)
       BRS 131 (NO, SYSTEM IN TROUBLE, CRASH****)
*SETS TEL PARA.
$STPAR CAX; LSH 15; ETR K177B5; STA AFSV4 (ID CHAR)
       COPY XA,XB; ETR K17 (17); CAX; LDA IDTB-1,2
       SKN TLV1 (RRPA SWITCH); BRU STPR2
STPR1  SKB K40 (40B); MRG K400 (400B); LDX KM1; BRS 177; R1
STPR2  ETR =-1-1B4 (TURN OFF PARITY); MRG TLV1; BRU STPR1
*ID CHAR TABLE FOR SETTING TERMINAL CHARS. IN MON.
IDTB   DATA 16440000B,16444004B,16444306B,14442252B (A,C,E,G)
       DATA 16226002B,16244004B,16236002B,01540000B (B,F,J,CR/300)
       DATA 01760000B,16000000B,03321041B (CR/150,D,2780)
       DATA 15322252B (1200 BAUD)
*      POP TRANSFER VECTORS
TV100  BRU* 0
TV101  BRU MSGT; BRU CALL
TV103  BRU MSGX; BRU ERR
*MAIL BOX ROUTINES
LASTM  EQU 137B (LAST MAIL NUMBER)
*GETS ALL OF A USER'S MAIL
$XMAIL LDX JOB; LDA CPARW,2; SKA TWO; EOR TWO; STA CPARW,2 (REM.MSG FLG)
*      CHECK MAIL WAITING FLG
       SKA ONE; BRU TMBX (YES, GO TYPE); BRS 22; SKN SWMBL
       BRU MAIL1 (POSTMAN BUSY); BRS 70; SKG ZERO; BRU MAIL8 (NO); LDA UTTY
       STA SWMBL (SET MAILBOX BUSY SW); BRS 46; BRS 23; C CKMAIL
       BRU MAIL7 (NO MAIL); LDA THREE (=XWR4) (FOUND LIST, TRANSFER TO STORAGE)
       STA TLV1 (POINTER TO NEXT EMPTY SLOT IN STORAGE)
       C CKMUS (CKS FOR MULTIPLE LOGON, SETS XT1)
MAIL6  CLA (WIPE OUT LIST); XMA EMBX+1,2; SKG ZERO (CK IF VALID ENTRY)
       BRU MAIL5 (NO); STA* TLV1 (PUT IN STORAGE); MIN TLV1; LDA TLV1
       SKG VXT11 (LAST AVAIL ADR. FOR STORAGE)
       BRX MAIL6 (GET NEXT NUMBER FROM LIST)
MAIL5 STA EMBX+1,2 (PUT END FLAG BACK IN LIST (OR HOLE?)); CLA
       STA* TLV1 (FLAG END OF STORAGE); LDX JOB; LDA ONE; MRG CPARW,2
       STA CPARW,2 (SET STARTED ON LIST FLAG); LDA =MBX; LDB =LMB
       LDX K4000; SKN XT1; BRU *+2 (DON'T WRITE BACK IF MULTIPLE LOGON))
       BRS 125 (WRITE LIST BACK ON DISC); LDA KM1
       STA SWMBL (SET MAILBOX SW TO NOT BUSY); BRS 47; BRU TMBX
MAIL1  BRS 23; MSET MM9 (TYPE POSTMAN BUSY); BRU RETCR (BUSY)
MAIL7  LDA KM1; STA SWMBL (SET SW. NOT BUSY); BRS 47
       MSET MM3 (MAILBOX EMPTY); BRU RETCR1 (RETURN TO CR)
MAIL8  BRS 23; ER 80
*TYPES ALL MAIL IN STORED LIST (IN WR4)
$TMBX  LDA KM1; STA XT12 (LOW LIMIT FOR MAILE NUMBER IN 1ST PAGE)
       LDA K37 (HIGH LIMIT); STA XT13 ; C TML (TYPE MAIL IN FIRST PAGE)
       C TML (2ND PAGE); C TML (3RD PAGE); LDX JOB; LDA CPARW,2
       ETR KM2 (REMOVE BUSY WITH MAIL FLAG); STA CPARW,2
       BRU RETCR1 (RETURN TO CR)
TML    LDA THREE (=XWR4); STA TLV3 (SET POINTER TO BEGINNING OF LIST); LDA KM1
       STA XT14 (SET "PAGE NOT IN" SWITCH)
TMLA   LDA* TLV3 (GET MAIL NO. FROM LIST); SKE ZERO (CK IF END OF LIST)
       BRU TML1 (NO); LDA K40 (YES, INCREMENT PAGE RANGE TO NEXT PAGE)
       ADM XT12; ADM XT13 ; R1 RLV3
TML1   SKG XT13 (CHECK IF MSG IN THIS PAGE); SKG XT12
       BRU TML2 (NOT IN THIS PAGE); LDB KM1
       STB* TLV3 (YES, TAKE OUT OF LIST)
       SKN XT14 (CHECK IF PAGE ALREADY IN); BRU TML3 (PAGE IS IN)
       STA TLV23 (PAGE NOT IN, SAVE MAIL NO.)
       LDA XT13 (COMPUTE PAGE DISC ADR); ADD =LMB+1
       STA XT14 (SET SW THAT PAGE IS IN); CAB; LDA =MBX; LDX K4000
       BRS 124 (READ IN THE MAIL PAGE); LDA TLV23 (RECOVER MAIL NO.)
TML3   LSH 6 (CHANGE TO RELATIVE CORE ADDRESS); ETR K3700
       ADD =MBX (FIRST TWO WORDS ARE CONTROL INFO., SKIP OVER)
       STA TLV2 (ADDRESS OF THIS LETTER); MSET MM36 (FROM)); LDA* TLV2
       C FNUS; MIN TLV2; LDA* TLV2; C TDATE1; TCF CRCH; MIN TLV2
       LDA KM1; STA TLV4 (SET SW FOR NOT WORKING ON CONT. CHAR.)
TML4   LDA* TLV2; STA TLV11 (GET WORD); LDX KM4 (TYPE FOUR CHARS.)
TMXC   CLA
       LDB TLV11 (PICK UP WORD OR REMAINING CHARS.)
       LSH 6 (TAKE CHAR. OFF LEFT END); STB TLV11
       SKN TLV4 (CK SW IF WORKING ON CONTROL CHAR.); BRU TMXC1 (YES)
       SKE K37 (CK IF NEXT CHAR IS CONTROL OR "?"); BRU *+3 (NO)
       STA TLV4 (YES, SET SW); BRU *+2
TMXCA  CIO COUT (TYPE CHARACTER); BRX TMXC; MIN TLV2 (GO TO NEXT WORD)
       BRU TML4
TML2   MIN TLV3 (GO TO NEXT LETTER IN LIST); BRU TMLA
TMXC1  LDB KM1; STB TLV4 (RESTORE CONTROL CHAR. SW)
       SKE K37 (IS THIS SUPPOSED TO BE QUESTION MARK)
       ADD K100 (NO SO MAKE IT A CONTROL)
       SKE EOTCH (CK IF END OF LETTER); BRU TMXCA (GO TYPE CHAR.)
       BRU TML2
*COUNTS MAILBOX LETTERS
CMBX   LDX KM400; CLA; STA EWORK,2 (CLEAR COUNT AREA); BRX *-1; LDA =MBX
       LDB =LMB; LDX K4000; BRS 124 (READ IN MAIL LIST); LDX KM4B3
CMBX1  LDA EMBX,2; SKE ZERO; BRU *+2; BRU CMBX3
       SKN EMBX,2 (CHECK FOR END FLAG OR LUD LOC.); BRU CMBX2 (NO)
       SKE KM1 (END FLAG?)
CMBX3  BRX CMBX1 (NO, GO TO NEXT POS.); R1 RLV1 (END OF COUNT)
CMBX2  XXA
       MIN WORK,2 (COUNT FOR THIS LETTER); XXA; BRX CMBX1
       R1 RLV1 (END OF COUNT)
*FINDS EMPTY MBX MESSAGE LOC.
FMBX   C CMBX (COUNT LETTERS); CLEAR; EAX 1,2
       SKE WORK,2 (FIND EMPTY SLOT); BRU *-2; CXA
       SKG =LASTM (CK IF MAIL BOX FULL); BRU FMBX1 (NO)
FMBXA  LDA KM1; STA SWMBL; MSET MM11 (NO ROOM); BRU RETCR
FMBX1  STA TLV3 (MSG NO.); MSET MM25 (MAIL I.D. NO.); LDA TLV3; C PONO
       TCF CRCH; LDX =LETEN
       STX TLV11 (ADR. FOR START OF ADDRESSEE LIST)
FMBX2  LDA* TLV11; SKE ZERO; BRU *+2 ; BRU FMBX3 (END OF LIST)
       LDX =NTTY
FMBX2B CXB; SKB KM1; BRU *+2; BRU FMBX2A
       EAX -1,2; SKE WERIS,2; BRU FMBX2B
       STX XT1; CAB; BRS 87 (CONVERT LINE TO JOB); CAX
       LDA CPARW,2 (SET FLAGS IN CPARW); MRG TWO (SET BUSY ON MAIL FLAG)
       STA CPARW,2; CBA; LDX XT1; BRU FMBX2B
FMBX2A LDX KM4B3; MRG X4; LDB X2 (USED TO TEST FOR -1)
FMBX4  SKN EMBX,2 (SEARCH FOR THIS ADDRESSEES LIST); BRX *-1; SKE EMBX,2
       BRU FMBX5 (NOT DESIRED USER); LDA TLV3 (PUT MSG NO. IN LIST)
       BRX FMBX4A
FMBX4A XMA EMBX,2 (PUT NO. IN LIST, PUSH REST OF LIST DOWN); SKE ZERO
       BRU *+2; BRU FMBX4B (EMPTY SLOT, SO DONT NEED PUSH REST)
       SKE KM1 (CK IF AT END OF LISTS); BRX FMBX4A; BRX *+2; BRU FMBXA
       STA EMBX,2
FMBX4B MIN TLV11 (GET NEXT ADDRESSEE); BRU FMBX2
FMBX5  SKB EMBX,2 (CK FOR -1 (END FLAG)); BRU *+2; BRU FMBX6 (NO)
       STA EMBX,2 (YES); BRX *+2; BRU FMBXA
       LDA TLV3 (BUILD NEW LIST FOR THIS USER); STA EMBX,2; BRX *+2
       BRU FMBXA; LDA KM1; STA EMBX,2 (SET END FLAG); BRU FMBX4B
FMBX6  BRX FMBX4; BRU FMBXA
FMBX3  LDA =MBX (WRITE LISTS BACK); LDB =LMB; LDX K4000; BRS 125
       LDA TLV3 (WRITE MSG, FIND THIS MSGS PAGE); ETR K740; ADD =LMBM
       CAB; STB TLV11; LDA =MBX; LDX K4000
       BRS 124 (BRING PAGE FOR THIS MSG); LDA TLV3
       LSH 6 (FIND RELATIVE ADR.); ETR K3700; CAX; LDA =EWORK
       STA TLV1 (STARTING LOCATION OF NEW MSG)
FMBX3A LDA* TLV1 (MOVE MSG INTO PAGE); STA MBX,2; MIN TLV1; EAX 1,2
       SKR TLV4 (CK WORD COUNT FOR END OF MSG); BRU FMBX3A (NO)
       LDA =MBX; LDB TLV11; LDX K4000; BRS 125 (WRITE MSG PAGE BACK)
       R1 RLV2
*      SEND MAIL TO SELECTED USERS
*BUILDS LIST OF UNO'S WHO ARE ADDRESSEES OF A MSG
$XSNML BRS 70 (NO. OF PMT BYTES LEFT); SKG ONE; BRU MAIL8 (NOT ENOUGH)
       SKN TLV21 (CMND FLAG)); CIO CIN; SKG ZERO; BRU *+2; MSET M16; CLA
       STA RLV4 (DISC ADR. FOR AUD READ); LDA MBX; LDA WORK
       LDA =LETEN (LOC. FOR LIST OF ADDRESSEES); STA XT2
BLUN1  LDA K16; CIT CIN; BRU BLU1 (NOT DOT)
       LDA CIN; C GFN; BRU BLUN22; C GIFNB; BRU BLUN22 (NOT FILE NAME)
       STA FN2; LDA =LETEN; STA XT2; C LDBUF
BLU2   LDA FN2; C GUN; BRU BLU3 (NOT VALID USER)
       C BLUS; LDA TERMCH; CIT FN2; BRU BLU2; BRU BLU7AA
BLU3   MSET EM1; LDP UNPTR; LDX COUT; BRS 35; TCF CRCH
       LDA TERMCH; CIT FN2; BRU BLU2; BRU BLU7AA
BLUS   C MLUDL; STA* XT2; MIN XT2; LDA XT2; SKG =LETEN+1000; R1; HLT 41B
BLU1   LDA CIN; C GUN (GET AN USER NO. FROM ACCT/NAME)
       BRU BLUN2 (NOT VALID NAME); C BLUS (STORE USER AND TEST))
       LDA XT1 (CK TERMINATING CHAR.); SKE LINF; BRU BLU7A
       BRU BLUN1 (CONTINUE, GET NEXT UNO)
BLU7AA LDA FN2; BRS 20
BLU7A  CLA
       STA* XT2 (SET END FLAG)
GML    MSET MM1 (ASK USER TO TYPE THE LETTER)
       LDX =-240 (SET UP FOR 240 CHAR. LETTER)
GML1   CIO CIN; SKG K77 (CK FOR A CONTROL CHAR.); BRU GML2 (NO)
       IF CEM
       BRU GML3
       ELSE
       SKE CONTA; BRU GML3
       TCO K77; CXA; SKG =-240; BRU GML+1
       EAX -1,2; LDA LETEN-1,2; SKE K37
       BRU GML1; EAX -1,2; BRU GML1
       ENDF
GML2   SKE K37 (CK IF QUESTION MARK); BRU GML4 (NO, REG. CHAR)
       STA LETEN,2 (YES, STORE ANOTHER ); BRX GML5
GMLER  MSET MM2 (MAIL OVER 240 CHARS.); LDX KM1; BRS 14; BRS 11; BRU GML
BLUN22 C LDBUF
BLUN2  MSET EM1 (TYPE NOT VALID NAME); BRU BLUN1
GML5   STA LETEN,2; BRU GML6
GML3   SUB K100 (STORE CONTROL CHAR.); CAB
       LDA K37 (CONTROL CHAR. FLAG.); STA LETEN,2; BRX *+2; BRU GMLER
       STB LETEN,2; CBA; SKE K44 (CK IF CONTROL D (TERM. CHAR))
       BRU GML6 (NO); LDA KM1 (YES SET END FLAG); EAX 1,2
       STA LETEN,2 (PUT END OF LETTER FLAG AFTER CONTROL D); BRU PKML
GML4   STA LETEN,2
GML6   BRX GML1; BRU GMLER
PKML   LDA =EWORK (STARTING ADR. OF LETTER); STA TLV1; LDX UTTY
       LDA WERIS,2 (PUT LUDL IN AS FIRST WORD OF LETTER); STA* TLV1
       MIN TLV1; LDA REAL; MUL TMK; ADD TYMTIM
       STA* TLV1 (PUT DATE/TIME IN AS 2ND WORD); MIN TLV1; LDX =-240
       CLAB; STA TLV11 (STORAGE FOR PACKED WORD)
PKML1  C PKCH; C PKCH; C PKCH; C PKCH (GET AND PACK 4TH CHAR.)
       STA* TLV1 (STORE PACKED WORD); MIN TLV1; CLAB; SKE TLV11
       BRU PKML2A (END OF LETTER); BRU PKML1
PKCH   LSH 6 (GETS CHAR. AND POSITIONS IN WORD)
       SKN LETEN,2 (CK IF AT END OF LETTER); BRU *+3
       MIN TLV11 (SET FLAG FOR END OF LETTER); R1 RLV1; MRG LETEN,2
       EAX 1,2; R1 RLV1
PKML2A LDA TLV1; SUB =EWORK; STA TLV4 (MSG WORD COUNT, USED TO CPY MSG)
PKML1A BRS 22; SKN SWMBL; BRU PKML3A (BUSY); BRS 46; LDA UTTY; STA SWMBL
       BRS 23
       C FMBX (GO FIND HOLE FOR THIS LETTER AND STORE)
       LDA KM1; STA SWMBL (UNBUSY)
RETCR  LDA WORK; LDA =WORK (RELEASE WORKING STORAGE); BRS 4
RETCR1 LDA MBX; LDA =MBX; BRS 4; BRU CR
PKML3A LDA =3000; BRS 81; BRU PKML1A
MM1    ASC '$TYPE LETTER:$$/'
MM2    ASC '$LETTER OVER 240 CHARS.,RETYPE$/'
MM3    ASC '$NO MAIL.$/'
MM4    ASC '$I-0 ERROR$/'
MM5    ASC '$FILE CANNOT BE SAVED NOW.$DISK SPACE BEING RECLAIMED.'
       ASC '$PLEASE STAND BY.$/'
MM6    ASC '$TOO MANY FILES OPEN.$/'
MM7    ASC '$FILE BUSY$/'
MM9    ASC '$POSTMAN BUSY.$/'
MM11   ASC '$SORRY, NO ROOM NOW.$/'
MM14   ASC 'PRIVATE:$'
MM14A  ASC ' WRITE ACCESS? /'
MM16   ASC 'PUBLIC:$'
MM15   ASC ' READ ACCESS? /'
MM17   ASC 'PROPRIETARY? /'
MM19   ASC ' Y, A, OR N? /'
MM20   ASC ' Y OR N? /'
MM25   ASC '$MAIL I.D. NO.: /'
MM28   ASC 'SHARABLE? /'
MM29   ASC '  LISTABLE? /'
MM30   ASC '  CONTROLS? /'
MM31   ASC 'NEW FILES? /'
MM32   ASC 'REMOTE? /'
MM33   ASC ' PTS TO: /'
MM34   ASC ' EXSMT: /'
MM35   ASC ' SMT: /'
MM36   ASC '$FROM /'
$M70   ASC '$DISC '
$M70A  ASC 'WRITE PROTECTED$/'
EM1    ASC '$INVALID USER.$/'
*TYPES ERROR SYMBOLS AND CORRESPONDING COUNT
$PMTER LDX ECC; STX TLV11; LDA ECC,2; SKE ZERO; BRU *+2; BRU PMTER2
       LDA ECB,2; C HMSG; LDX TLV11; LDA ECC,2
       C PDNO; TCF CRCH; LDX TLV11
PMTER2 BRX PMTER+1; LDA DBITS; C PDNO; BRU CR
       ASC 'RC RA RU RATDC DS DF DU DXXD26BTSNDARS CPCBZ IOP'
ECB    EQU *

*BRS 1 ERROR, PRINTS ERROR MSG ACCORDING TO TABLE
$BRS1ER BRS 23; STX TLV2; CXA
       LDB OPNCN; SKB K200 (ARE WE SUPPRESSING BUSY MSG)
       SKE ONE (YES, ARE WE BUSY)
       MSET* BRS1T-1,2
       LDA TLV2; LDB OPNCN; SKB K100 (ARE WE TELLIN G WHO)
       SKE ONE (YES, ARE WE BUSY)
       BRU BS1ER1
       LDA TLV11; BRS 72 (LOOK UP I.P. IN GLOBAL FILE TBL)
       BRU BS1ER1 (NOT FOUND)
       STX TLV11 (SAVE LUD LOCATOR)
       MSET BS1ER2 (FILE IN USE BY..)
       LDA TLV11; C FNUS
BS1ER1 LDX TLV2; BRU GOFNER
BS1ER2 ASC 'FILE IN USE BY /'
BRS1T  ZRO MM7; ZRO MM6; ZRO MM5; ZRO MM4; ZRO MM5

$XTMOT BRS 46 (DISABLE ESCAPES.); LDX UTTY; LDA WERIS,2; SKE ZERO
       BRU TMOT2 (SOMETHING WRONG); LDA SWTM; SKG KM2
       BRU TMOT1 (NO CARRIER PRESENCE (SEE EXECI)); LDA UNO; SKE ZERO
       BRU GOWAY (UNO BAD, GET RID OF USER QUICK)
       STA SWTM (SET FLAG THAT TIME HAS RUNOUT)
$TMOT1 CLB
       LDA UTTY; BRS 129 (HANG UP DATASET); BRS 47
       BRS 109 (WAIT FOR OFF INTERRUPTS)
TMOT2  BRS 47; SKG KM3; BRS 109; BRS 131
*      SETS UP FILE CONTROLS
$CNTRL LDA UNO; SKE FDUN; BRU *+2; BRU CN
       LDX JOB; LDA K2B6; SKA CPARW,2; BRU CN
       LDA FDCONT; SKA K20; BRU CN; ER 81
CN     SKN TLV22; BRU CNTRL1 (CMND FROM BRS)
       CIO CIN; SKE CRCH; BRU *+2; BRU CNTRL1
       SKE LINF; BRU CN2
CNTRL1 MSET M72 (FILES) ; LDA CRCH; CIT CIN; BRU *+2; BRU CNTRL1
       SKE LINF; BRU *+2; BRU CNTRL1-1
CN2    C LSNM (GET LIST OF NAMES); BRU *+2 (C.R. FOR TERM CHAR.)
       BRU CN5 (LIST CONTAINS "ALL"); C STCTRL (GET CONTROLS)
CN1    LDP* TLV3; SKG ZERO; BRU INITE (END OF LIST); STP FNPTR
       C FNLB; BRU CN6
       C CNS; BRU CN1A (ON ERROR); C WFD
CN1A   MIN TLV3; MIN TLV3; BRU CN1
CN6    MSET M77; LDP* TLV3; LDX COUT; BRS 35; BRU CN1A
*      SET ALL OF DIRECTORY
CN5    CIO CIN; C STCTRL
       CLA; STA TLV3; STA GRCT; LDA FDUN; STA GRU; SKE UNO; BRU CN3A
CN4    MIN TLV3; LDA TLV3; C FLNUM; BRU CR
       C CNS; NOP 0 (ON ERROR); EAX 3,2
       EAX 1,2; SKN 0,2; BRU *-2; SKN 1,2; BRU CN4
       C WFD; BRU CN4
CN3A   LDA FDCONT; SKA K20; BRU CN4; ER 81
*TEST OF LEGALITY OF BITS AND SETS CONTROL
CNS    LDA 2,2; SKA X2 (DISC); BRU CNS2 (OK)
CNS1   STX TLV1; MSET M77 (ERROR ON NAME); LDA TLV1; C CPFN
       LDP XWR3; LDX COUT; BRS 35; LDX TLV1; R1
CNS2   MRG TLV4; MRG RLV4; SUB RLV4
       SKA K20 (PROPRIETARY); BRU CNS5 (YES)
       STA TLV0; LDA 2,2; SKA K20 (FORMERLY PROPRIETARY); BRU CNS6 (YES)
       LDA TLV0
CNS5   SKA K100 (APPEND ONLY); BRU CNS3 (YES)
CNS4   STA 2,2; R2
CNS3   SKA K4B6 (DUMP FILE); BRU CNS1 (ERR IF DMP AND APPEND); BRU CNS4
CNS6   LDA TLV0; ETR KM7 (TURN OFF EXEC AND SYS LICENSE); BRU CNS5
*      SETS UP CONTROL BITS, ON IN TLV4, OFF IN RLV4
STCTRL CLA; STA TLV4; STA RLV4
C1     MSET MM14 (WRITE ACCESS); C GTANY; BRU C7
       LDA K200; SKB ONE; ADM TLV4; MRG K100; SKB TWO; ADM RLV4
       C TCNFRM; SKB ONE; BRU C4 (NOT WRITE, SKIP OVER NOT READ OPT)
C3     MSET MM15 (READ ACCESS); C GTANY; BRU C8
       LDA K400; SKB ONE; ADM TLV4; SKB TWO; ADM RLV4; C TCNFRM
C4     MSET MM16 (PUBLIC); C GTANY; BRU C9
       LDA K40; SKB TWO; ADM TLV4; MRG K2000; SKB ONE; ADM RLV4
       C TCNFRM; SKB ONE; BRU C5 (NOT PUBLIC)
C6     MSET MM14A (WRITE ACCESS); C GTANY; BRU C11
       LDA K2000; SKB TWO; ADM TLV4; SKB ONE; ADM RLV4
       C TCNFRM
C5     MSET MM17 (PROPRIETARY); C GTANY; BRU C10
       LDA K20; SKB TWO; ADM TLV4; SKB ONE; ADM RLV4
       C TCNFRM
C12    LDA K12B6 (ACCT.SUP./OPER); LDX JOB; SKA CPARW,2; BRU *+2; R1
       MSET MM32 (REMOTE); C GTANY; BRU C13
       LDA K4000; SKB TWO; ADM TLV4; SKB ONE; ADM RLV4; R1
C7     SKB FOUR; BRU C7A (APPEND ONLY); MSET MM19
       BRU C1
C7A    CAX; LDA K100; ADM TLV4; C TCNFRM; BRU C3
C8     MSET MM20; BRU C3
C9     MSET MM20; BRU C4
C10    MSET MM20; BRU C5
C11    MSET MM20; BRU C6
C13    MSET MM20; BRU C12
*GETS A, N, OR Y FOLLOWED BY CARRIAGE RETURN OR LINE FEED
*ERROR RETURN ON A (WITH 4 IN B REG.), OTHER ERRORS, 0 IN B
*NORMAL RETURN WITH 1 FOR N, 2 FOR Y AND 0 FOR C.R. OR L.F.
*   AND CONFIRMING CHAR. (C.R. OR L.F.) IN X
GTANY  CLB; CIO CIN; SKE ='   Y'; BRU GTANY1
       LDB TWO
GTANY2 CIO CIN (GET CONFIRM CHAR.); SKE CRCH; BRU GTANY3
GTANY4 CAX; R2
GTANY3 SKE LINF; BRU GTANY5; BRU GTANY4
GTANY1 SKE V56B; BRU *+3; LDB ONE; BRU GTANY2
       SKE V41B; BRU GTANY2+1; LDB FOUR
GTANY5 CIO CIN; R1 RLV1
*      TEST CONFIRMING CHAR.
TCNFRM CXA; SKE LINF; BRU *+2; R1; SKR PDP; MIN PDC; R1
*      SETS UP DIR. CONTROLS
$FDC   LDA UNO; SKE FDUN; BRU *+2; BRU FDC1
       LDX JOB; LDA K2B6; SKA CPARW,2; BRU FDC1; ER 75
FDC1   LDA FDUN; STA GRU; CLA; STA RLV4; STA TLV4; STA GRCT
       C GGRP; HLT XT11; C F1
       LDA FDCONT; MRG TLV4 (ON BITS); MRG RLV4; SUB RLV4
       STA FDCONT; STA OVFP2; C WFD; BRU CR
F2     MSET MM20; BRU F1
F4     MSET MM20; BRU F3
F6     MSET MM20; BRU F5
F8     MSET MM20; BRU F7
F1     MSET MM28 (SHARABLE); C GTANY; BRU F2
       LDA K40; SKB TWO; ADM TLV4; SKB ONE; ADM RLV4 (YES IF BIT ON)
       C TCNFRM; SKB ONE; BRU F7
F3     MSET MM29 (LISTABLE); C GTANY; BRU F4
       LDA FOUR; SKB TWO; ADM RLV4; SKB ONE; ADM TLV4 (NOT IF ON)
       C TCNFRM
F5     MSET MM30 (CONTROLS); C GTANY; BRU F6
       LDA K20; SKB TWO; ADM TLV4; SKB ONE; ADM RLV4 (YES IF ON)
       C TCNFRM
F7     MSET MM31 (NEW FILES); C GTANY; BRU F8
       LDA EIGHT; SKB TWO; ADM TLV4; SKB ONE; ADM RLV4 (YES IF ON); R1
*      PRINTS FILE DIR. CONTROLS
$PFDC  LDA FDUN; STA GRU; CLA; STA GRP; STA GRCT; C GGRP; HLT FNPTR
       LDX COUT; LDA FDCONT; SKA K40; BRU *+2; BRU PFDC1
       LDA =MM28; LDB EIGHT; BRS 34; LDA FDCONT
       SKA K20; BRU *+2; BRU PFDC1
       LDA =MM30; LDB TEN; BRS 34; LDA FDCONT
PFDC1  LDA FDCONT; SKA FOUR; BRU PFDC3
       LDA =MM29; LDB TEN; BRS 34; LDA FDCONT
PFDC3  TCF CRCH; SKA EIGHT; BRU *+2; BRU CR
       LDA =MM31; LDB NINE; BRS 34; BRU CR

* PRINT PMT ENTRIES
*      DICTIONARY:  PMT BYTE NO. IN DEL1 (T1), PMT ENTRY IN XT2 (T2),
*              PMTJOB IN TLV1, STATUS FLAG IN TLV11, LENGHT OF PMT IN
*              TLV2, HEAD OF IND CHAIN IN TLV21, IND ADDR IN TLV22,
*              IND. ADDR. SWITCH IN TLV23.

$PPMT  LDA EXFLAG; SKE ZERO; LDA KM1; STA TLV11 (MAKE NOT ZERO FLAG )
       LDA =100B-NCMEM (LENGTH OF PMT); STA TLV2 (COMPUTE LENGTH OF PMT)
       C CKCM; BRU PPMT3; SKN EXFLAG; BRU PPMT3
       C RONO; CAX; LDA PMTP,2; SKG ZERO; BRU CR; BRU PPMT4
PPMT3  LDA PMTJOB; ADD VNCMEM
PPMT4  ETR K3S4 (REMOVE X BIT, KEEP 16 BIT ADR. FIELD); STA TLV1
       LDX VNCMEM; CLB; SKN TLV11; BRU PPMT2 (DONT TYPE TS BYTE)
PPMT1  SKR TLV2 (COUNT NO. OF PMT ENTRIES, CK IF AT END)
       BRU *+2 (NOT END); BRU CR; STX DEL1; LDX TLV1
       BRS 127 (READ PMT ENTRY); MIN TLV1; SKE ZERO
       C PRMTE (PRINT ENTRY IF NON-ZERO); LDX DEL1; EAX 1,2; BRU PPMT1
PPMT2  SKR TLV2; MIN TLV1; BRU *-4
* PRINT SMT ENTRIES
$PSMT  LDA EXFLAG; SKE ZERO; LDA KM1; STA TLV11
       LDA VNCMEM; STA TLV2; CLX
PSMT1  SKR TLV2; BRU *+2; BRU CR; STX DEL1; CXA
       ADD ADRSMT (COMPUTE ADR OF SMT ENTRY); CLB; CAX
       BRS 127 (READ ENTRY); SKE ZERO; C PRMTE; LDX DEL1; EAX 1,2
       BRU PSMT1
*   0.16
PRMTE STA XT2; STA TLV21; CLA; STA TLV23 (INDIRECT SWITCH)
       TCF CRCH; LDA DEL1; C PONO (PRINT POSITION IN TABLE)
       LDA XT2; ETR K77B5; SKE K12B5; BRU PRMTEA
PMTEX  LDA XT2; ETR K3S4; STA TLV22; COPY AX,B
       BRS 127; STA XT2; ETR K77B5; SKE K12B5; BRU *+2; BRU PMTEX
       SKR TLV23 (SET SW); NOP; LDA TLV21; SKA X1; BRU *+2; MSET MM63 (RDW)
       MSET MM33; LDA TLV22; SUB AEXSMT; SKA X4; BRU PMTE1
       STA TLV22; MSET MM34; LDA TLV22; ADD K100; C PONO; BRU PRMTEA
PMTE1  LDA TLV22; SUB ADRPMT; SKA X4; BRU PMTE2
       RSH 23; DIV =100B-NCMEM; STB TLV22; ADD ONE; C PONO; TCF BLKCH
       LDA TLV22; ADD VNCMEM; C PONO; BRU PRMTEA
PMTE2  MSET MM35; LDA TLV22; SUB ADRSMT; C PONO
PRMTEA TCF BLKCH; LDA XT2; SKA X2; BRU PRMTE1 (EXEC BIT ON)
PRMTE2 SKA X1; BRU PRMTE3 (READ ONLY BIT ON)
PMT1   SKA X4; BRU PMT2; R1 XT2
PMT2   MSET M62 (SHARED); R1
PRMTE3 MSET M39; LDA XT2; BRU PMT1
PRMTE1 SKN TLV23; MSET M38; SKP TLV23; MSET MM64 (US); LDA XT2; BRU PRMTE2
MM63   ASC ' RW/'
MM64   ASC 'US /'
*RENAME FILE, TAKES OLD FILE NAME FIRST,SEPARATOR,THEN NEW NAME
$REN   C CKCM
       MSET M56 (TYPE FROM FILE)
RENA1   C GTNM; BRU RENA; C FNLB; BRU RENA
       STA TLV4; C TDEL; BRU RENA; C MGRP (MOVE GROUP TO WORK. STOR.))
       LDA GRU; STA S1 (REMEMBER GRU)
       C FLC; BRU RENER; STA GBUSY,2; BRS 23
       C SEP; SKE CRCH; BRU *+2
       MSET EM8 (NEW NAME)
RENB1   C GTNM; BRU RENER
$RENB2 SKE TWO; BRU *+2; BRU RENB
       SKE TEN; BRU *+2; BRU RENB; SKE THREE; BRU *+2; BRU RENB
       C FNLK; BRU *+2; BRU RENB (OLD NAME)
       SKN FDCONT; BRU *+2; BRU RENB3
       LDA GRU; SKE ONE; BRU RENB3
       LDA UNO; SKE ONE; BRU RENB
RENB3  CXA; SKE TEN (10); BRU RENB
       LDB K3S7; LDX JOB; LDA RLV4; BRS 46; BRS 22; SKM GBUSY,2
       BRU RENER (LOST GROUP); MRG X4; STA GBUSY,2
       LDA GRP; SKM FGLIST,2; BRU RENER (LOST GROUP)
       MRG X4; STA FGLIST,2; LDX =-2*[NJOB1+1]; CLB
RENB3A LDA GRP; SKE EFGL,2; BRU *+2; STB EFGL,2
       LDA RLV4; SKE EFGL,2; BRU *+2; STB EFGL,2
       BRX RENB3A (TAKE GROUPS AWAY FROM ALL OTHERS)
       LDA XT9; C INSFN (INSERT FILE INTO SECOND GROUP OR OVERFLOW)
       BRU RENER (NOT PERMITTED OR OUT OF OVERFLOW GROUPS)
       STB TLV21 (REMEMBER NEW ADDR.)
       C MKBUSY (ENSURE GROUP WITH INSERTED NAME STAYS BUSY)
       BRU RENER (SOMEONE PINCHED IT ALREADY)
       LDA TLV4; ADD =MBX-DBF; STA TLV2 (LOC. OLD NAME)
       CAX; LDA 0,2; SKG ZERO; BRU REN7
REN7A  LDB TLV21 (NEW ADDR)
       XXB; STA 0,2; XXB
       LDA 1,2; MRG X6 (CHANGED FILE FLAGS)
       XXB; STA 1,2; ETR K3S4; STA S2 (SIZE); XXB
       LDA 2,2; XXB; ETR KM7; STA 2,2; STA FDNO (EXAMINE TYPE LATER)
       XXB; LDA 3,2; XXB; STA 3,2
       STA FDCBT (I.B.P.)
       LDA GRP; SKE RLV4; BRU REN8 (NOT SAME GROUP)
REN6   LDX TLV4; C FDEL; LDA =MBX; BRS 4
       CLA; LDX JOB; STA GBUSY,2; XMA GRU
       SNE S1; BRU REN6C (SAME HOME); XMA FDNO
       LRSH 18; ETR SEVEN; SNE FIVE; BRU REN6C (TMP FILE)
$REN6A LDA S2; SKG ZERO; BRU REN6D (GET SIZE BY OPENING FILE)
       LDX FDNO; C REN4 (ADJUST BASE)
       LDX S1; LDA S2; CNA; STA S2; C REN4
$REN6B C XFDRET
REN6C  SKN SW58; BRU CR; BRU BRSEX
REN6D  C GTXFD; BRU REN6E (RETURNS TO REN6A)

*CREDIT NEW, DEBIT OLD

REN4   CXA; SKG K3777
$REN4A SKN MASTER; CLX; STX FDNO
       LDA S2; BRS 188; BRU REN4B; R1
REN4B  C GTXFD; BRU REN4C (RETURNS TO REN4A)

REN8   C MFD; BRU RENER; BRS 55; CLA; STA GRP; LDA RLV4
       C XFFD; LDA VDBF; LDX K200
       BRS 124 (REREAD FROM DISC AS INSFN MAY HAVE CHANGED END FLAG)
       LDX JOB; CLA; BRS 22; XMA GBUSY,2; ETR K3S7; SKE RLV4; BRS 131
       STA GRP; MRG X4; STA FGLIST,2; BRU REN6
RENA   EAX M56; C CMER; BRU RENA1
RENB   SKN SW58; BRU *+2; BRU RENER
       EAX EM8; C CMER; BRU RENB1
REN7   C DAY; ADD K2B4; BRU REN7A
RENER  LDA MBX; LDA =MBX; BRS 4; CLA; STA GRU; SKN SW58; BRU ERRET
       LDX JOB; STA GBUSY,2; STA FGLIST,2; BRU BRS111
*MOVES CURRENT GROUP TO WORKING STORAGE IN MBX
MGRP   LDX KM200; LDA EDBF,2; STA MBX2,2
       SKG KM1; SKG KM3; BRX MGRP+1
       LDA GRP; STA RLV4 (SAVE GRP NO.); R1
*FILE DIR. GARBAGE COLLECTION ROUTINE
*REMOVES EMPTY BLOCKS FROM F.D.
$GBG   BRS 46
       LDA KM200; STA TLV2 (SEE MGRP AND GBG1)
       LDA ONE; STA TLV21 (CUR. GROUP NO.)
       LDA DBF; SKG ZERO; SKG KM3; BRU GBG0A (1ST NOT EMT)
GBG00  C GGRP; BRU GBG1 (ONLY 1 GRP)
       C GBGC; BRU GBG00 (ANOTHER EMT)
       C GBGM (SAVE 1ST BLK WITH DATA); R1 (BUSY, DONT BOTHER GBG)
       CLA; STA MBXOP1 (FORCE 1ST BLK SETUP)
       C GBGC1 (CLEAR OLD BLK -GBGM MADE IT BUSY); BRU GBG4
GBG0A  C GBGM; R1 (BUSY, QUIT)
GBG4   C GGRP; BRU GBG1 (NO MORE GROUPS)
       C FLA; BRU GBG2 (BUSY NOW, STOP GBG)
       C GBGC; BRU GBG4 (EMPTY)
*NEXT GRP NOT EMPTY, CK FOR GBG
       C GBGS; LDA OVFP1; SKNE ZERO; BRU GBGE (NEXT LAST, DONE)
       C GBGM; BRU GBGE (BUSY)
       LDA GRCT; STA TLV21; BRU GBG4
*NO MORE GROUPS, MAKE LAST GROUP LOOK LIKE END OF CHAIN
GBG1   LDA KM2; LDX TLV2; STA MBX2,2; CLB; C GBGS1
GBGE   LDA MBX; LDA =MBX; BRS 4; LDX JOB; CLA; STA FGLIST,2; R1
*NEXT GROUP BUSY, TERMINATE
GBG2   C GBGS; BRU GBGE
*FIXES POINTERS AND WRITES LAST GOOD GROUP
GBGS   LDA MBXOP1; SKNE GRP; R1 (NO GBG)
       LDB GRP (FOR OVFP1 TO NEXT GRP)
GBGS1  LDA TLV21; SKG ONE; BRU GBGS2
       LDA GRU; BRU GBGS3
GBGS2  LDA FDCONT; STA MBXOP2; LDA GRU; STA RLV4 (FORCE 1ST BLK); CBA
GBGS3  STP MBXOP; C GBGW; R1
*WRITE BLOCK FROM MBX
GBGW   LDA RLV4 (SET BY MGRP); C XFFD
       LDA =MBX; LDX K200; BRS 125; R1
*DOES ALL PARTS OF MOVE, ERROR EXIT IF GRP BUSY
GBGM   LDA GRP; C FLA; R1 (GROUP BUSY)
       C FLB; C MGRP (MOVE TO WORK. STOR.)
       STX TLV2 (LOC OF END FLAG); LDP OVFP; STP MBXOP; R2
*SKIPS IF GRP NOT EMT
*OTHERWISE SETS 1ST WORD 0 AND WRITES EMT GROUP,TAKES NON-SKIP RETURN
GBGC   LDA DBF; SKG ZERO; SKG KM3; R2 (NOT EMPTY)
GBGC1  CLA; STA DBF; LDA GRP; C XFFD; LDA VDBF; LDX K200; BRS 123; R1
*SETS EXEC FLAG WORD
$SEXFLG C CKAUX; LDA KM1; STA XT8; C RDNO
       SKG THREE; SKG ZERO; BRU SEXF2
       XAB; SKE COMCH; BRU SEXF
       LSH 22; STB TLV4; C RONO; SKG K27; SKG KM1; BRU SEXF3+1
       STA XT8; XAB; SKE CRCH; BRU SEXF3
       C SEXC
       LDA XT8; CLB; LSH 1; CAX
       LDA XT3; ADD XT4; SKE SYSPS+1,2; ER 74
       LDA TLV4; LRSH 1; STA RLV4
       LDA XT1; ADD XT2; LDB K1S7; SKM SYSPS,2; ER 74
       LDA SYSPS,2; LRSH 1; SUB RLV4; SKA X4; ER 74
       LDX XT8; LDA X4; LRSH 0,2; MRG STATUS; STA STATUS; LDA TLV4
SEXF1  STA EXFLAG; SKN EXFLAG; BRU SEXF4
       LDX JOB; LDA CPARW,2; MRG =77260000B; STA CPARW,2
       CLA; STA OPDSTR (ALLOW ANY DSTRICT)
SEXF4  C GTFIO; BRU ARST
SEXF2  SKE ZERO; BRU *+4; SKE EXFLAG; BRU *+2; BRU CR; CAB
SEXF   LSH 22; STB TLV4; CLA; BRU SEXF1
SEXF3  CBA; CNA; STA XT8; BRU SEXF+2
SEXC   LDX KM1; LDA THREE; BRS 12; TCO CRCH; TCO K15
       LDP TERMWD; STP XT1; STP XT3; STB XT5; CLA; STA TLV1
       LDA XT8 (ACCT. NO. (SEE DAL/FNAC)); ETR K3S7; ADM XT3
GPSWD1 LDA K24; STA TLV11
RN     LDX TLV1; LDA XT1,2; MUL =6065B; DIV =37777761B
       CBA; ADD XT2,2; CAB; ETR THREE; STA TLV1; LDA XT1,2
       XAB; STP XT1,2; LDA XT5; XMA XT1; STA XT5
       SKR TLV11; BRU RN; CIO ZERO; SKNE CRCH; R1; ADM XT1; BRU GPSWD1
*      SETS OPERATOR STATUS
$OPER  C CKAUX
       LDX JOB; LDA =14B6 (OPER, SHUT OVERRIDE); SKA CPARW,2; C CKTIME
       LDP FPTR; STP FNPTR; LDA EIGHT; C FNLK; BRU ERRET
       LDB FOUR; SKB 2,2; BRU *+2; BRU ERRET
       C GIFNB; BRU ERRET; STA INFIL
       LDA XWR4X3; STA UNPTR; STA UNPTR1
       CIO ZERO; SKNE ZERO; BRU *-2; STA XT8 (FIRST CHAR)
       WCI UNPTR; CIO ZERO; SKE CRCH; BRU *-3
       LDA UNPTR1; SUB UNPTR; STA TLV1; CLA; STA TLV2
OPER2  CIO INFIL; SKE K137; BRU *+2; ER 74
       SKE CRCH; BRU OPER2 (SKIP OVER IDENT)
       CIT INFIL; BRU *+2; ER 74
       LDA UNPTR1; STA FNPTR; STA FNPTR1
       LDA VFNPTR; LDB CRCH; LDX INFIL; BRS 33
       LDA FNPTR1; SUB FNPTR; SKG ZERO; ER 74
       MIN TLV2 (NAME COUNT); SKE TLV1; BRU OPER2
       LDP FNPTR; SKSE UNPTR; BRU OPER2
       C RONF; SKA =101B5; BRU *+2; ER 74; STA TLV3
       C SEXC
       C RONF; STA TLV11; LDA XT1; ADD XT2; SKE TLV11; ER 74
       C RONF; STA TLV11; LDA XT3; ADD XT4; SKE TLV11; ER 74
       BRS 46; LDA TLV2; STA XT8; LDA FLAG; STA TLV4
       LDA REAL; STA OPTM; LDA TLV3; SKA K1B5; BRU OPER3
       LSH 2; STA OPDSTR (DISTRICT FOR CFD)
       LDX JOB; LDA CPARW,2; MRG X1
       STA CPARW,2; BRU SEXF4
OPER3  LDA X2; STA EXFLAG; BRU SEXF4
FPTR   DATA 3**+5,3**+8
       ASC '()PSWD'
RONF   LDB EIGHT; LDX INFIL; BRS 38; R1

CKAUX  LDA AFSV5; SKA K7B7; R1; BRU ERRET

$LOADF LDA REAL (RANDOMIZE INCREMENT); ETR THREE; STA TLV11; BRS 146
       STX TLV2; CBA; ADM TLV2; C CTUSER (COUNT USERS); ADD TLV2
       STA TLV1; LDA K1000D; BRS 81 (WAIT A SECOND); BRS 146; STX TLV2
       CBA; ADM TLV2; LDA TLV1; LSH 1; ADD TLV2; RSH 18 (MULTIPLY BY 32)
       DIV LDFACT (DIVIDE BY LOAD FACTOR); ADD TLV11; C PDNO; MSET M69
       BRU CR
$USERS C CTUSER; C PDNO; TCF BLKCH; BRS 146; STB TLV1; STX TLV2; C PDNO
       TCF BLKCH; LDA TLV1; C PDNO; TCF BLKCH; LDA TLV2; C PDNO; BRU CR

*      OBSOLETE FILE BRS'S MOVED HERE FROM GS 02/21/74

*      FILE NAME LOOK-UP FOR INPUT, NAME FROM COMMANDS FILE
*      REQUIRES COMMAND FILE NO. IN A
$BRS15  C GFN; BRU SOUT; BRU OUT1 (DON'T WRITE ACCOUNTING)
*      FILE NAME LOOK-UP FOR OUTPUT, NAME FROM COMMANDS FILE
*      REQUIRES COMMAND FILE NO. IN A.  CREATES F.D. ENTRY FOR
*      NEW FILE.
$BRS18  C GOFNA; BRU SOUT; BRU OUT1 (PROTECT XWR4 ARRAY)
*      OPENS FILE FOR INPUT
*REQUIRES F.D. INDEX IN A
$BRS16  C GIFNB; BRU BRS111; BRU BRSEX
*      OPENS FILE FOR OUTPUT
*REQUIRES F.D. INDEX IN A, FILE TYPE IN X
$BRS19  CLB; STB OPNCN; C GOFNB; BRU BRS111; BRU BRSEX

       IF MDSI
*CHANGES PROG. STARTUP LOC.
$BRS27 ETR K3S4; STA GETSTL; BRU BRS111
       ENDF

*SETS USER NAME CHANGE CHARACTER
$BRS59  STA NMCHX; BRU BRS111
*      MISCELLANEOUS

$BRS182 EQU * SAVE REMOTE ACCOUNT, RESTORE IF B<0
       SKN UB; BRU B182A
       CLA; XMA GOREMA; COPY AB,A; XMA REMAC; XAB
       STP SGOREM; BRU BRS111
B182A  LDP SGOREM; STA GOREMA; STB REMAC; BRU BRS111
*      AUXILLIARY CIRCUIT XBRS'S

$BRS173 LDP UNMP; STP UNPTR; LDA UA; C BLDCH; BRU BRS111; BRU BRSEX
*BUILD AUXILIARY CHANNEL
*EXPECTS STRING POINTERS IN UNPTR AND DESIRED COMPUTER NO. IN A
$BLDCH STA TLV1; BRS 138; SKE ZERO; R1 (ERROR)
       LDP UNPTR; LDX ONE; BRS 35
       LDA COLNCH; CIO ONE
       LDA TLV1; LDB TEN (10D); BRS 36
       LDA K15; CIO ONE
       BRS 138; R2
       NOLIST EXT

$NOM   MIN MSW; BRU CR
$MON   LDA KM1; STA MSW; BRU CR
$EMSG  ASC '$$EMERGENCY, RETURN TO EXEC!$$/'

       END
EXEC ** FICHE/FRAME BREAK *****
MB SYMSORT

SYM.  PG.LN. IDENT.

B182A  19 13 MB93    BLDCH  19 19 MB93    BLU1    6 35 MB93    
BLU2    6 30 MB93    BLU3    6 32 MB93    BLU7A   7  1 MB93    BLU7AA  6 39 MB93    
BLUN1   6 27 MB93    BLUN2   7 18 MB93    BLUN22  7 17 MB93    BLUS    6 34 MB93    
BRS15  18 27 MB93    BRS16  18 34 MB93    BRS173 19 16 MB93    BRS18  18 31 MB93    
BRS182 19  9 MB93    BRS19  18 37 MB93    BRS1ER  9  8 MB93    BRS1T   9 22 MB93    
BRS27  19  2 MB93    BRS59  19  6 MB93    BS1ER1  9 20 MB93    BS1ER2  9 21 MB93    
C1     10 32 MB93    C10    11 15 MB93    C11    11 16 MB93    C12    11  7 MB93    
C13    11 17 MB93    C3     10 35 MB93    C4     10 37 MB93    C5     11  4 MB93    
C6     11  1 MB93    C7     11 10 MB93    C7A    11 12 MB93    C8     11 13 MB93    
C9     11 14 MB93    CI1     2 37 MB93    CI2     3  2 MB93    CI3     3  3 MB93    
CKAUX  18 12 MB93    CMBX    5 12 MB93    CMBX1   5 14 MB93    CMBX2   5 18 MB93    
CMBX3   5 17 MB93    CN      9 37 MB93    CN1    10  5 MB93    CN1A   10  8 MB93    
CN2    10  3 MB93    CN3A   10 17 MB93    CN4    10 13 MB93    CN5    10 11 MB93    
CN6    10  9 MB93    CNS    10 19 MB93    CNS1   10 20 MB93    CNS2   10 22 MB93    
CNS3   10 28 MB93    CNS4   10 27 MB93    CNS5   10 26 MB93    CNS6   10 29 MB93    
CNTRL   9 34 MB93    CNTRL1 10  1 MB93    ECB     9  5 MB93    EM1     8 37 MB93    
EMSG   19 29 MB93    EXECI   1 27 MB93    EXECI4  3  8 MB93    EXECI5  2 21 MB93    
EXECI6  2 32 MB93    EXECI7  3  4 MB93    EXECIS  2 23 MB93    F1     12  4 MB93    
F2     11 39 MB93    F3     12  7 MB93    F4     12  1 MB93    F5     12 10 MB93    
F6     12  2 MB93    F7     12 13 MB93    F8     12  3 MB93    FDC    11 33 MB93    
FDC1   11 35 MB93    FMBX    5 22 MB93    FMBX1   5 26 MB93    FMBX2   5 29 MB93    
FMBX2A  5 36 MB93    FMBX2B  5 31 MB93    FMBX3   6 11 MB93    FMBX3A  6 17 MB93    
FMBX4   5 37 MB93    FMBX4A  6  1 MB93    FMBX4B  6  5 MB93    FMBX5   6  6 MB93    
FMBX6   6 10 MB93    FMBXA   5 25 MB93    FPTR   18  8 MB93    GBG    15 29 MB93    
GBG00  15 33 MB93    GBG0A  15 38 MB93    GBG1   16  8 MB93    GBG2   16 11 MB93    
GBG4   15 39 MB93    GBGC   16 28 MB93    GBGC1  16 29 MB93    GBGE   16  9 MB93    
GBGM   16 23 MB93    GBGS   16 13 MB93    GBGS1  16 15 MB93    GBGS2  16 17 MB93    
GBGS3  16 18 MB93    GBGW   16 20 MB93    GML     7  3 MB93    GML1    7  5 MB93    
GML2    7 14 MB93    GML3    7 20 MB93    GML4    7 25 MB93    GML5    7 19 MB93    
GML6    7 26 MB93    GMLER   7 16 MB93    GPSWD1 17 14 MB93    GTANY  11 22 MB93    
GTANY1 11 27 MB93    GTANY2 11 24 MB93    GTANY3 11 26 MB93    GTANY4 11 25 MB93    
GTANY5 11 29 MB93    IDTB    3 17 MB93    LASTM   3 26 MB93    LOADF  18 14 MB93    
M70     8 35 MB93    M70A    8 36 MB93    MAIL1   4  7 MB93    MAIL5   4  1 MB93    
MAIL6   3 36 MB93    MAIL7   4  8 MB93    MAIL8   4 10 MB93    MGRP   15 24 MB93    
MM1     8  8 MB93    MM11    8 17 MB93    MM14    8 18 MB93    MM14A   8 19 MB93    
MM15    8 21 MB93    MM16    8 20 MB93    MM17    8 22 MB93    MM19    8 23 MB93    
MM2     8  9 MB93    MM20    8 24 MB93    MM25    8 25 MB93    MM28    8 26 MB93    
MM29    8 27 MB93    MM3     8 10 MB93    MM30    8 28 MB93    MM31    8 29 MB93    
MM32    8 30 MB93    MM33    8 31 MB93    MM34    8 32 MB93    MM35    8 33 MB93    
MM36    8 34 MB93    MM4     8 11 MB93    MM5     8 12 MB93    MM6     8 14 MB93    
MM63   13 31 MB93    MM64   13 32 MB93    MM7     8 15 MB93    MM9     8 16 MB93    
MON    19 28 MB93    NOM    19 27 MB93    OPER   17 20 MB93    OPER2  17 29 MB93    
OPER3  18  7 MB93    PFDC   12 16 MB93    PFDC1  12 21 MB93    PFDC3  12 23 MB93    
PKCH    7 35 MB93    PKML    7 27 MB93    PKML1   7 32 MB93    PKML1A  8  1 MB93    
PKML2A  7 39 MB93    PKML3A  8  7 MB93    PMT1   13 27 MB93    PMT2   13 28 MB93    
PMTE1  13 21 MB93    PMTE2  13 24 MB93    PMTER   8 39 MB93    PMTER2  9  3 MB93    
PMTEX  13 16 MB93    PPMT   12 32 MB93    PPMT1  12 39 MB93    PPMT2  13  4 MB93    
PPMT3  12 36 MB93    PPMT4  12 37 MB93    PRMTE  13 13 MB93    PRMTE1 13 30 MB93    
PRMTE2 13 26 MB93    PRMTE3 13 29 MB93    PRMTEA 13 25 MB93    PSMT   13  6 MB93    
PSMT1  13  8 MB93    REN    13 34 MB93    REN4   15  7 MB93    REN4A  15  8 MB93    
REN4B  15 10 MB93    REN6   14 33 MB93    REN6A  14 37 MB93    REN6B  15  1 MB93    
REN6C  15  2 MB93    REN6D  15  3 MB93    REN7   15 20 MB93    REN7A  14 25 MB93    
REN8   15 12 MB93    RENA   15 17 MB93    RENA1  13 36 MB93    RENB   15 18 MB93    
RENB1  14  3 MB93    RENB2  14  4 MB93    RENB3  14 10 MB93    RENB3A 14 15 MB93    
RENER  15 21 MB93    RETCR   8  5 MB93    RETCR1  8  6 MB93    RN     17 15 MB93    
RONF   18 10 MB93    SEXC   17 11 MB93    SEXF   17  9 MB93    SEXF1  17  4 MB93    
SEXF2  17  8 MB93    SEXF3  17 10 MB93    SEXF4  17  7 MB93    SEXFLG 16 31 MB93    
STCTRL 10 31 MB93    STPAR   3 11 MB93    STPR1   3 14 MB93    STPR2   3 15 MB93    
SYSPS   1  3 MB93    SYSPS1  1  4 MB93    TCNFRM 11 31 MB93    TMBX    4 12 MB93    
TML     4 17 MB93    TML1    4 22 MB93    TML2    5  5 MB93    TML3    4 30 MB93    
TML4    4 35 MB93    TMLA    4 19 MB93    TMOT1   9 29 MB93    TMOT2   9 32 MB93    
TMXC    4 36 MB93    TMXC1   5  6 MB93    TMXCA   5  3 MB93    TV100   3 22 MB93    
TV101   3 23 MB93    TV103   3 24 MB93    USERS  18 20 MB93    XMAIL   3 28 MB93    
XSNML   6 23 MB93    XTMOT   9 24 MB93    
EXEC ** FICHE/FRAME BREAK *****
NIO
NIO002 IDENT 12/06/73

* LOAD AT 30000B

* CY MODIFIED 10/16/73 TO SIMULATE TYMSHARE "FIO" . DIFFERENCES
* IN FORMATS, ERROR CODES, AND BUGS SIMULATED.  REWROTE TO RUN
* WITHOUT FLAG SYSPOPS AND WITH TYMSHARE 940 OPERATING SYSTEM.

* A BRIEF WORD ABOUT FLAGS:  FLAG CELLS ARE NEGATIVE IF RESET
* AND POS. IF SET.  THE FOLLOWING ARE USED AS FLAG CELLS:  DPFG,
* ODOTFG (USED TO PUT OUT ZERO BEFORE PERIOD),OVFLFG,SIGN,SIGNEX
* NODOTFG,MFFLAG,DPFG2,OVFL,SHRTRM (SET ON SHORT TERMINATION),
* FMT4FG (SET FOR FORMAT 4--FORMAT 0 USED),POST (LEFT JUSTIFY OUTPUT),
* FIO (SIMULATE FIO IF SET, NIO IF RESET).

* MFFLAG IS EQU TO DPFG2.


* SPECIAL TREATMENT FOR 1-CHAR/WD SIC
SIC1W  LDA 1,2
       SUB 0,2
       SKG =75
       SKA K4B7
       LDA =75
       SUB ONE
       STA NIO7 (STG LEN - 1 FOR SKR LOOP)
       LDA XWR4X3
       STA IOPTR
       STA IOPTR1
       STA NIO10
       LDA 0,2
       ADD ONE (POINTER POINTED AT WORD BEFORE STRING)
       C SUSR (RELABEL STRING PAGES)
       LDA 0,2
       WCI IOPTR (COPY STRING TO XWR4 ARRAY)
       EAX 1,2
       SKR NIO7
       BRU *-4
       SKN NIO6
       ZRO
       BRU SIC1E
* INTERNAL TO STRING CONVERSION
$ISCN   CLA
       BRU ISCSIC
* STRING TO INTERNAL CONVERSION
$SICN   LDA KM1
ISCSIC STA NIO6
       C GETFMT
       LDA UE
       C SUSR (RELABEL PG CONTAINING STG PTRS)
       LDB NIO12
       SKB K100
       BRU SIC1W (1 CHAR/WD SIC ONLY)
       LDA 0,2 (PICK UP 1ST STG PTR)
       ADD ONE
       MUL THRD (12525253B)
       STA NIO12 (SAVE FOR UPDR)
       CXA
       C SRSU (RELABEL PGS WITH STRING)
       STA NIO10
       STA IOPTR
       ADD SRSU21 (STRING LENGTH)
       STA IOPTR1
       SKN NIO6
       BRU ISCPOP
SIC1E  LDA K377
       MRG ERRNUM
       STA ERRNUM
       C SICS
       STA NIO6                (CONVERSION TYPE)
       LDA NIO11
       SKU KM2
       MIN IOPTR (FOR FIO PSEUDO DECIMAL PT)
       LDA UE
       C SUSR (RELABEL PG CONTAINING STG PTRS)
       LDA IOPTR
       SUB NIO10     (ORIGINAL VALUE OF IOPTR)
       ADM 0,2                 (ADJUST FIRST STG PTR)
EBRS52 LDA IOFMT
       CLB
       STB UB                  (CLEAR FOR INTEGERS)
       SKL THREE
       LDA TWO                  NO DIFFERENCE BETWEEN FORMAT 2 AND 3)
       LSH 2
       ADD NIO6
       SKN DPFG
       ADD K14 (=12)
       CAX
       BRU *,2
       BRU ASIS1               FORMAT 0        TYPE 1
       BRU ASIS23                      TYPE 2
       BRU C3TO2                       TYPE 3
       BRU C4TO2                       TYPE 4
       BRU ASIS1               FORMAT-1  TYPE 1
       BRU C2TO1                       TYPE 2
       BRU IOVFL                      TYPE 3
       BRU C4TO1                       TYPE 4
       BRU C1TO2               FORMAT-2,3  TYPE1
       BRU ASIS23                      TYPE 2
       BRU C3TO2                       TYPE 3
       BRU C4TO2                     TYPE 4
       BRU ASIS1               FORMAT-0  TYPE 1     DOUBLE PRECISION
       BRU ASIS23                      TYPE 2
       BRU ASIS23                      TYPE 3
       BRU ASIS4                       TYPE 4
       BRU C1TO3                       TYPE 1
       BRU C2TO3                       TYPE 2
       BRU C3TO3                       TYPE 3
       BRU C4TO3                       TYPE 4
       BRU C1TO4               FORMAT-2,3  TYPE 1
       BRU C2TO4                       TYPE 2
       BRU C3TO4                       TYPE 3
       BRU C4TO4                       TYPE 4
* CONVERT THE VALUE TO AN INTEGER  (TRUNCATE)
*  CONVERT TYPE 4 TO TYPE 1
C4TO1  BSS 0
C2TO1  LDA NIO1
       STA NIO4                (FLAG TO SHOW ORIGINAL SIGN)
       SKA K4B7
       C NIOFNA
       LDB NIO3
       SKN DPFLAG
       LDB NIO2
       STE
       LDB NIO2   A2
       LDE
       LDA NIO1    A1
       SKD K30 (24D)
       BRU IOVFL
       COPY B,E
       RSH -1,2
       SKP NIO4
       CNA
       BRU TO1OT
IOVFL  LDB K2B7                     (ERROR 2)
       SKN FIO (ARE WE SIMULATING FIO)
       LDB K3B7 (YES--POST ERROR 3)
       C ERR
       LDA K4B7
       SKN NIO4
       LDA K3S7 (=37777777B)
TO1OT  STA UA
       LDA ERRNUM
       ETR =73777777B          (ERASE D OR .. FLAG)
       STA ERRNUM
       LDA ONE
       BRU SICOUT
* CONVERT TO A SINGLE PRECISION FLOATING POINT
*  CONVERT TYPE 4 TO TYPE 2
C4TO2  LDX NIO3   A3
       C MAKSIN
       BRU TO2OT
C3TO2  LDA NIO1    A1
       LDB NIO2   A2
       LDX K57 (47D)
C3TO2A NOD 48
       SKE ZERO
       LDE
TO2OT  STA UA
       STB UB
       LDA ERRNUM              (ERASE D OR .. FLAG JUST IN CASE)
       ETR =73777777B
       STA ERRNUM
       LDA TWO
       BRU SICOUT
C1TO2  LDA NIO2   A2
       CLB
       LDX K27 (23D)
       BRU C3TO2A

*CONVERT TO DOUBLE PRECISION INTEGER
C4TO3  BSS 0
C2TO3  LDA NIO1
       STA NIO4
       SKA K4B7
       C NIOFNA
       LDB NIO3   A3
       SKN DPFLAG
       LDB NIO2
       STE
       LDB NIO2   A2
       LDE
       LDA NIO1
       SKD K57 (47D)
       BRU I3OVFL
       LDB NIO2                (MUST RESTORE IF IT WAS DOUBLE P)
       SKN     DPFLAG
       COPY B,E                (ERASE EXPONENT IF SINGLE P)
       RSH 0,2
COVTO3 SKN NIO4
       BRU TO3OT
       XAB
       EOR KM1
       ADD ONE
       XAB
       EOR KM1
       ADC ZERO
TO3OT  STA UA
       STB UB
       LDA ONE
       BRU SICOUT
C3TO3  LDA NIO1    A1
       LDB NIO2   A2
       BRU TO3OT
I3OVFL LDB K2B7                (ERR 2)
       SKN FIO (ARE WE SIMULATING FIO)
       LDB K3B7 (YES--POST ERROR 3)
       C ERR
       LDA K3S7 (=37777777B)
       LDB KM1
       BRU COVTO3
C1TO3  LDA NIO2   A2
       RSH 24
       BRU TO3OT
*  CONVERT TO D.P. FLOATING
C1TO4  LDA NIO2   A2
       CLB
       LDX K27 (23D)
       BRU C3TO4A
C3TO4  LDA NIO1    A1
       LDB NIO2   A2
       LDX K57 (47D)
C3TO4A NOD 48
TO4OT  STA NIO1    A1
       STB NIO2   A2
       CLB
       SKA KM1                 (DON'T PUT EXPONENT ON ZERO)
       LDE
       STB NIO3   A3
C4TO4  C SENDDP
       LDA TWO
       BRU SICOUT
C2TO4  LDA NIO1    A1
       LDB NIO2   A2
       STE
       BRU TO4OT
ASIS1  LDA NIO2   A2
       STA UA
       CLA
       STA UB
       BRU ASISX
ASIS23 LDA NIO1    A1
       LDB NIO2   A2
       STA UA
       STB UB
       BRU ASISX
ASIS4  C SENDDP
ASISX  LDA NIO6
SICOUT SUB ONE
       SKN FIO (ARE WE SIMULATING TYMSHARE FIO)
       BRU FSIC1 (YES)
FSIC0  ADM UBRSRT
       BRU BRSOUT

* RETURN FOR TYMSHARE SIC
FSIC1  STA NIO11
       C ERRSUB (STORE ERROR NO. IN USER'S LOC 200B)
       CLA
       SKE IOW (IS IOW=0)
       BRU FSIC2 (NO)
       LDA NIO11
       BRU FSIC0
* IOW.NE.0
FSIC2  LDA UX
       STA ERRNUM (RETURN 'X' UNCHANGED)
       BRU BRSOUT (ALWAYS NON-SKIP RETURN)

ISCPOP C ISCS
       C UPDR (UPDATE USER'S PRG REL)
       LDA UE
       C SUSR (RELABEL PG CONTAINING STG PTRS)
       LDA IOPTR1
       SUB IOPTR
       ADD 0,2
       STA 1,2
       SKN FIO (ARE WE SIMULATING FIO)
       C ERRSUB (YES--SAVE ERROR IN USER LOC. 200B)
       BRU BRSOUT
*MAIN CONVERSION ROUTINE OF SIC
*      RETURNS FOUR TYPES OF RESULTS:
*              1.  SINGLE LOC INTEGER
*              2.  DOUBLE LOC FLOATING
*              3.  DOUBLE LOC INTEGER
*              4.  TRIPLE LOC FLOATING
*      ALL RESULTS ARE IN A1,A2,NIO3   A3

SICS   LDA KM1
       STA NIO11               (EXPECTED DECIMAL POSITION)
       STA SHRTRM (CLRF)       (NOT SHORT-TERMINATION YET)
       LDA UA
       STA NIO12              (SAVE UA IN CASE IT POINTS TO HIS DP ACC)
*  FORMAT 4--G-FORMAT IS EQUAVALENT TO F FOR INPUT
       LDA THREE
       SKN FMT4FG
       STA IOFMT
* IGNOR IOD FOR FREE
       CLB
       LDA IOFMT
       SKE ZERO
       BRU *+3
       STB NIO5               (P FACTOR)
       STB IOD
* IGNOR IOD IF IOW=0
       LDA IOW
       SKNE ZERO
       BRU SET1
*  SET UP TO LOOK ONLY AT CHARS IN FORMAT WIDTH
* IGNOR IOD IF FIELD IS SHORT--EXECPT FOR INTEGER
       ADD IOPTR
       SKN FIO (ARE WE SIMULATING FIO)
       BRU FADJ (YES--USE IOW REGARDLESS OF CONSEQUENCES)
       SKG IOPTR1
       BRU SET1A               (IOW SHORTER OR EQUAL THAN STRING)
       MIN SHRTRM (SETF)      (MUST BE SHORT-TERMINATED)
       LDA IOFMT
       SKE ONE
       STB IOD
       BRU SET1
SET1A  STA IOPTR1
*  SET UP
SET1   LDB KM1
       STB SIGN (CLRF)
       STB DPFG2 (CLRF)
       STB SIGNEX (CLRF)
       STB OVFLFG (CLRF)
       STB NIO7                (SET NIO7 MINUS UNTIL WE ADD A DIGIT)
       LDA K13
       STA DGTCNT (FOR FIO)
       CLA
       STA DPFLAG
       STA DEXP
       STA IODEXP      PSUEDO
       STA NIO1    A1
       STA NIO2   A2
       STA NIO3   A3
*      FORCE D.P. IF REQUSTED
       SKP DPFG
       BRU CHAR1
       LDA IOFMT
       SKL TWO
       STA DPFG2 (SETF)
CHAR1  C GETCHR
       BRU INTES1
       SKG ZERO
       BRU CHAR1
       SKE MBCH               (MULTI BLANK)
       BRU CHAR1A
       C GETCHR             (EAT COUNT AND IGNOR THE BLANKS)
       BRU INTTES
       BRU CHAR1
CHAR1A SKNE K13               (PLUS)
       BRU CHAR2
       SKE K45                (E)(NUMBER MUST NOT START WITH E OR D)
       SKNE BD
       BRU INTTES              (IF SO,THIS IS NOT A NUMBER)
       SKE SE               (SMALL E)
       SKNE SD
       BRU INTTES
       SKE K15                (MINUS)
       BRU CHAR2A
       STA SIGN (SETF)
CHAR2  C GETCHR
       BRU INTES1
CHAR2A SKG K31
       SKG K17
       BRU CHAR2B
       SKN FIO (ARE WE SIMULATING FIO)
       SKR DGTCNT (YES, READ ONLY 11 SIG DIGITS)
       BRU *+2 (STILL OK)
       BRU CHAR2 (THROW AWAY REMAINING CHARS)
       SKN OVFLFG
       SKR IODEXP      PSUEDO              (ALWAYS SKIPS)
       C DGTADD             (ADJUST FOR NEW DIGIT)
       BRU CHAR2
CHAR2B SKE K16               DECIMAL POINT)
       BRU CHAR2C
       C GETCHR
       BRU FRCTS1
       SKE K16                (DOUBLE PERIOD FOR D.P.)
       BRU FRACT+2
       STA DPFG2 (SETF)
       LDA K4B6
       MRG ERRNUM
       STA ERRNUM
       BRU FRACT
CHAR2C SKE K45               (E)
       SKNE SE              (SMALL E)
       BRU EXPONT
       SKE BD                (D)
       SKNE SD              (SMALL D)
       BRU FRACT2             (INPUT FORCED DOUBLE PRECISION)
       BRU INTTES

*  PICK UP THE DIGETS AFTER THE DECIMAL PLACE
FRACT  C GETCHR
       BRU FRCTS1
       SKG K31
       SKG K17
       BRU FRACT1
       SKN FIO (ARE WE SIMULATING FIO)
       SKR DGTCNT (YES)
       SKN OVFLFG
       BRU FRACT
       C DGTADD
       MIN IODEXP      PSUEDO
       BRU FRACT
* NON-NUMERIC CHARACTER AFTER DECIMAL POINT
FRACT1 SKE K45                (E)
       SKNE SE              (SMALL E)
       BRU EXPONT
       SKNE SD              (SMALL D)
       BRU FRACT2
       SKE BD                (D)
       BRU FRCTST
FRACT2 STA DPFG2 (SETF)        (FORCED DOUBLE PRECISION)
       LDA K4B6
       MRG ERRNUM
       STA ERRNUM
*  FOUND E OR D
EXPONT BSS 0
*CHECK IF WE HAVE SEEN ANY DIGITS--IF NONE, GO TO INTEST AND RETURN
       SKN NIO7                (SET MINUS UNTIL FIRST DIGIT)
       BRU     *+2
       BRU     INTTES          (MUST BE -E OR -D--NOT A NUMBER)
EXPNT2 GCI IOPTR (NO NEED TO USE GETCHR SINCE WE IGNORE BLANKS HERE)
       BRU BAKUP
       SKG ZERO
       BRU EXPNT2              (ALLOW SPACE AFTER E AND BEFORE NUMBER)
       SKNE K13               (PLUS)
       BRU EXPNT1
       SKE K15                (MINUS)
       BRU EXPNT1+2
       STA SIGNEX (SETF)
EXPNT1 C GETCHR
       BRU BAKUP
       SKG K31
       SKG K17
       BRU BAKUP
       SUB K20
       STA DEXP
       C GETCHR
       BRU EXPTS1
       SKG K31
       SKG K17
       BRU EXPTST              (THIS IS THE TERM CHAR)
       SUB K20
       XMA DEXP
       MUL TEN
       LSH 23
       ADM DEXP
       C GETCHR
       BRU EXPTS1
       BRU EXPTST
*
*      BACK-UP TO THE REAL TERM CHARACTER
*      FOR THE      2.EQ.  CASE
*
BAKUP  LDA KM3
       ADM IOPTR              (BACK UP 3 CHARACTERS)(BAD,SIGN,E OR D)
BAKUP1 C GETCHR
       BRU FRCTST              (CAN'T HAPPEN)
       SKE K45                (E)
       SKNE BD               (D)
       BRU FRCTST              (MAKE E OR D THE TERM CHAR)
       SKE SD               (SMALL D)
       SKNE SE              (SMALL E)
       BRU FRCTST
       BRU BAKUP1
*
*      FINISH UP ON REALS WITHOUT E OR D
*      HANDLE P SPEC AND IW.D
*
FRCTST C SETCHR              (RECORD TERM CHAR)
FRCTS1 LDA THREE
       SKN FIO
       STA IOFMT
       LDA IOFMT
       SKE ONE
       BRU FRCTS3
       LDA IOD
FRCTS2 ADD DEXP
       BRU EXPTS2
FRCTS3 LDA NIO5               (P FACTOR)
       CNA
       BRU FRCTS2


* SIMULATE FIO FOR IOW NONZERO--CHECK FOR PRESENCE OF DECIMAL PT
* OR E ANYWHERE IN THE STRING.
FADJ SKG IOPTR1
       BRU *+2
       STA IOPTR1 (USE FIELD WIDTH IOW)
       CLA
       WCI IOPTR (ADD A BLANK)
* THE ZERO COMES AFTER THE TERMINATING CHAR, OR IF THERE IS NO
* TERM CHAR IN THE STRING, THE STRING WILL GO NULL.  IN THIS CASE
* TERM CHAR RETURNED IS 17B, BUT NOT RETURNED TO THE USER ANYWAY
* FOR IOW.NE.0.
       LDA IOFMT
       SKG ONE
       BRU SET1 (TREAT LIKE IOW=0)
       LDP IOPTR
       STP XWR3
       STP NIO1
* SEARCH FOR "." ANYWHERE IN FIELD
       GCI XWR3
       BRU *+4 (NONE FOUND)
       SKE K16
       BRU *-3
       BRU SET1 (TREAT LIKE IOW=0)
       LDA IOFMT
       SKG TWO
       BRU EFMT
FFMT   LDA IOPTR1 (CALCULATE WHERE FORMAT SAYS "." SHOULD BE)
       SUB IOD
       SUB ONE (CORRECT FOR BLANK ADDED AT FADJ+4)
       STA NIO11 (REMEMBER POSITION OF PSEUDO DECIMAL PT)
       BRU SET1 (TREAT LIKE IOW=0)
* SEARCH FOR "E" ANYWHERE IN FIELD, TREAT LIKE "F" IF NONE FOUND
EFMT   GCI NIO1
       BRU NOE 
       SKE K45 (E)
       BRU EFMT
       BRU SET1 (TREAT LIKE IOW=0)
NOE    LDB K5B7
       C ERR (POST ERROR FIVE)
       BRU FFMT

*  FINISH ON FLOATING POINT NUMBERS
EXPTST C SETCHR              (RECORD THE TERM CHAR)
       CLA; STA SHRTRM (SETF)
EXPTS1 LDA TWO
       SKN FIO
       STA IOFMT
       LDA DEXP
EXPTS2 SKN SIGNEX
       CNA
       SUB IODEXP      PSUEDO
       LDB KM1; STB SIGNEX
       SKA K4B7
       BRU *+2
       BRU *+3
       MIN SIGNEX (SETF)
       CNA
       STA DEXP
       LDX =71
       SKN DPFLAG
       LDX K57 (47D)
       C NOD72
       STX IODEXP     BINARY
       SKP DPFG2
       BRU EXPTS3
       LDA KM1
       STA DPFLAG
*CHECK FOR ZERO
EXPTS3 CLA
       SKE NIO1    A1
       BRU EXPADJ
       STA IODEXP     BINARY
       BRU EXOUT

*  ADJUST FOR THE EXPONENT
EXPADJ BSS 0
       LDB =MINTBL
       SKP SIGNEX
       LDB =PLSTBL
       LDA DEXP
       C EXPSUB
EXOUT  LDA IODEXP              BINARY
       SKG KM400 (=77777400B)
       BRU EXUNFL
       SKG K377
       BRU *+2
       BRU EXOVFL
       CAX
       SKN DPFLAG
       BRU EXOUT1
       C MAKDOU
*      ADJUST FOR SIGN
       SKN SIGN
       C NIOFNA
       LDA FOUR
       R1 SICS
EXOUT1 C MAKSIN
*      ADJUST FOR SIGN
       SKN SIGN
       C NIOFNA
       LDA TWO                  (TYPE 2)
       R1 SICS

EXOVFL LDB K3B7                (ERR 3)
       C ERR
       LDA K4B7
       SKP SIGN
       LDA K3S7 (=37777777B)
       STA NIO1    A1
       LDX K377
       CLA
       SKP SIGN
       LDA KM1
EXOVF1 CAB
       XEE
       STB NIO2   A2
       STB NIO3   A3
       LDA TWO
       SKN DPFLAG
       R1 SICS
       XEE
       STB NIO2   A2
       LDA FOUR
       R1 SICS
EXUNFL COPY A,X
       STA NIO1    A1
       BRU EXOVF1

*  HANDLE NUMBERS WHICH LOOK LIKE INTEGERS
INTTES C SETCHR              (RECORD THE TERM CHAR)
       CLA; STA SHRTRM (SETF)
INTES1 LDA ONE
       SKN FIO
       STA IOFMT
       SKP SHRTRM              (DO I2.5 IF SHORT TERMINATED)
       BRU INTES4
       LDA IOFMT               (VALUE WAS SHORT TERMINATED)
       CLB                     (TURN OFF --IGNOR IOD FOR E OR F)
       SKL TWO
       STB IOD                 (HANDLE IOD FOR I--FREE?)
       SKE ONE
       BRU INTES4
*      HANDLE IW.D FORMAT SPEC
       LDA IOD
       SKP FIO (MAKE BELIEVE IOD=0 FOR FIO)
       SKNE ZERO
       BRU INTES4
       CNA
       CAX
       LDA K20                (CHARACTER ZERO)
       C DGTADD
       BRX *-2
INTES4 LDA IOFMT               (DON'T HANDLE IOD FOR 0,HANDLE 1 DIFFRENT)
       SKG ONE
       BRU INTES2
       LDA IOD                 (REDUCE THE NUMBER BY 10**(IOD))
       ADM IODEXP      PSUEDO
       SKE ZERO
       BRU EXPTS1              (TREAT AS FLOATING IF IOD .NE. 0)
INTES2 SKN DPFLAG
       BRU *+2
*  NUMBER IS TOO LARGE TO EXPRESS EVEN AS A D.P. INTEGER
       BRU EXPTS1
       LDA NIO1                A1
       SKE ZERO
       BRU DPINT
       LDA NIO2   A2
       SKA K4B7
       BRU DPINT
       SKP SIGN
       BRU *+3
       CNA
       STA NIO2   A2
       LDA ONE                  (TYPE 1)
       R1 SICS
DPINT  SKP SIGN
       BRU DPINT1
       LDA NIO2                A2
       LDB NIO1    A1
       EOR KM1
       ADD ONE
       XAB
       EOR KM1
       ADC ZERO
       STA NIO1    A1
       STB NIO2   A2
DPINT1 LDA THREE
       R1 SICS

*
*ADJUST FOR THE EXPONENT
*      B POINTS TO EITHER MINTBL OR PLSTBL DEPENDING ON SIGN OF EXP
*      A CONTAINS ABS VALUE OF POWER OF TEN TO MULTIPLY BY
*
EXPSUB SKN FIO (ARE WE SIMULATING TYMSHARE FIO)
       BRU FEXPSUB (YES)
       STB NCONV
       STA NIO9
EXPLOP LDA NIO9
       SKG ZERO
       R1
       SKA ONE
       BRU DOMULT
EXPLP1 RSH 1
       STA NIO9
       LDA FOUR
       ADM NCONV
       BRU EXPLOP
DOMULT EAX* NCONV
       C DPMRIO
       LDA NIO9
       BRU EXPLP1

* EXPSUB FOR FIO

FEXPSUB SKG ZERO
       R1
       CNA
       COPY AX,BA
       LDB =FTEN
       ETR K3S4 (=37777B)
       SKE =PLSTBL
       LDB =TENTH
       STB NCONV
       LDP NIO1
       FMP* NCONV (MULTIPLY BY 10 OR 1/10TH)
       BRX *-1 (UNTIL ADJUSTMENT OF PWR COMPLETE)
       STP NIO1
       STE     (NOW FIX IODEXP)
       CXA
       ADD IODEXP
       STA IODEXP
       R1
*
*      GENERATE SINGLE OR DOUBLE PRECISION REALS
*      EXPONENT IS IN X
*      NUMBER IN NIO1,NIO2,NIO3
*
MAKSIN LDA NIO2
       SKN FIO (ARE WE SIMULATING FIO)
       ADD ZERO (YES, TURN OFF CARRY BIT)
       SKP FIO
       ADD K400               (ROUND IF 400B BIT IS ON)
       CLB
       STB DPFLAG
       BRU CARRY

MAKDOU LDA NIO3
       ADD K400
       LDB KM1
       STB DPFLAG
*      SINGLE OR DOUBLE PRECISION CARRY WITH CORRECTION FOR
*      1 TO -1 AND -1 TO 6 PROBLEMS
*              DPFLAG IS SET IF DOUBLE PRECISION
*              A-CONTAINS THE ADDED TO NIO2 OR NIO3
*              X-CONTAINS THE EXPONENT AND THE CARRY IF ANY
CARRY  CAB                     (SAVE LAST WORD FOR EXPONENT)
       SKN DPFLAG
       BRU CARRY1              (NOT DOUBLE PRECISION)
       LDA NIO2
       ADC ZERO
       STA NIO2
CARRY1 LDA NIO1
       SKA K4B7                (SEPERATE NEGATIVE AND POSITIVE CARES)
       BRU CARRY4              (NEGATIVE CASE--MAY GO TO 6B7)
       ADC ZERO
       SKA K4B7
       BRU CARRY3              (ROUNDED TO 4B7--NORMALIZE 1 RIGHT)
CARRY2 STA NIO1
       LDE
       SKN DPFLAG
       STB NIO2
       STB NIO3
       R1
CARRY3 LDA K2B7
       EAX 1,2
       BRU CARRY2
*      NEGATIVE CASE
CARRY4 ADC ZERO
       SKA K2B7
       BRU *+2
       BRU CARRY2
       LDA K4B7                (6B7--NORMALIZE 1 LEFT)
       EAX -1,2
       BRU CARRY2

*      SET THE CHAR IN A AS THE TERMINATING CHAR IN ERRNUM
SETCHR MRG KM400          (TURN ON ANY BITS WE MAY WANT)
       ETR ERRNUM              (CHAR WAS SET TO 377B)
       STA ERRNUM
       R1 SETCHR

*  DOES A NOD 72 ON THE NUMBER IN A1,A2,A3
NOD72  LDA NIO1    A1
       SKG ZERO
       SKG KM2
       BRU HRDWAY
       EOR NIO2   A2
       SKA K4B7
       BRU HRDWAY
       CXA
       SUB K30 (24D)
       CAX
       LDA NIO2   A2
       LDB NIO3   A3
       NOD 48
       STA NIO1    A1
       STB NIO2   A2
       CLA
       STA NIO3   A3
       R1 NOD72

HRDWAY STX FIOW   XSAV
       CLX
       LDA NIO1    A1
       LDB NIO2   A2
       NOD 24
       STA NIO1    A1
       COPY XA,XB
       ADD FIOW   XSAV
       STA FIOW   XSAV
       CBA
       CNA
       CAX
       LDA NIO2   A2
       LDB NIO3   A3
       LSH 0,2
       STA NIO2   A2
       STB NIO3   A3
       LDX FIOW   XSAV
       R1 NOD72


*  BREAK UP THE FORMAT IN X
$GETFMT LDA KM1
* CLEAR FLAGS NODOTFG,DPFG,FMT4FG,OVFL,SD,SE,BD
 LDX KM7; STA NFLAGE,2; BRX *-1
       STA POST
        LDA UX; COPY AB,A
       STA ERRNUM  (INITIALIZE WHAT WE WILL SND BACK)
       LSH 3
       SKN FIO (ARE WE SIMULATING FIO)
       BRU FIOFMT (YES)
       STB DPFLAG              (WILL SET DPFLAG NEG IF BIT 4B7 IS ON)
       SKB K4B7
       MIN DPFG (SETF)
       SKG FIVE
       BRU GTFMT1
       LDA K1B7          (ERR 1)
       STA ERRNUM
       MIN DPFG (SETF)
       CLA
GTFMT1 SKNE FOUR
       BRU GOT4
       SKE FIVE
       BRU GTFMT2
*FLOATING POINT WHICH DOES NOT FORCE A DECIMAL POINT FOR F5.0
       MIN NODOTFG (SETF)
       LDA THREE
       BRU GTFMT2
* G FORMAT PUT 4 SPACES AFTER F AND NOT AFTER E--LIKE FREE SORT OF
GOT4   MIN FMT4FG (SETF)
       CLA
GTFMT2 STA IOFMT
       CLA
       LSH 6
       SKP FIO
       ETR K37
       STA IOD
       CLA
       LSH 6
       STA IOW
       SKB K4B7
       MIN OVFL (SETF)
       LSH 9
       ETR K377
       STA IOFILE      
       STA NIO12               (SAVE BIT 17 FOR 1 CHAR/WD SIC TEST)
       LSH 18                  (ALLIGN THE LAST 6 BITS)
       RSH 18                  (PROPIGATE THE SIGN)
       SKN FIO
       CLA
       STA NIO5               (P FACTOR)
       SKN FIO (ARE WE SIMULATING TYMSHARE FIO)
       R1 GETFMT (YES)
       LDA SMALLD
       LDB SMALLE
       LDX K44
       STA SD
       STB SE
       STX BD
       R1 GETFMT
* DECIPHER FIO FORMATS
FIOFMT STA DPFLAG              POS. TO DISABLE DBL P'N
       SKU THREE
       STA NODOTFG             POS. TO SUPPRESS . IN FW.0 SPECS
       SKG THREE
       BRU GTFMT2
       SUB TWO
       SKG THREE
       BRU FPOST (LEFT JUSTIFIED FORMAT)
       LDA K1B7
       STA ERRNUM (ILL. FORMAT)
       LDA TWO (GO WITH "E")
       BRU GTFMT2
FPOST  MIN POST (SETF)
       BRU GTFMT2
SMALLD DATA 104B (USED BY NIO)
SMALLE DATA 105B (USED BY NIO)


*  ADD THE NEXT DIGIT INTO THE PRESENT SUBTOTAL
*      DPFLAG IS NEG IF THE SUB TOTAL IS THREE WORDS
*      CHECKS IF THE HIGH ORDER SIX BITS ARE 0, IF NOT
*      IT EITHER SHIFTS TO THREE WORD PRECISION OR SETS OVFLFG

DGTADD SUB K20
       STA NIO7
       LDA NIO1    A1
       LDB NIO2   A2
       LSH 2
       SKN DPFLAG
       BRU SPAD
       STA UA
       LDA NIO2   A2
       LDB NIO3   A3
       LSH 2
       XAB
       ADD NIO3   A3
       STA UB
       CBA
       ADC NIO2   A2
       CAB
       LDA UA
       ADC NIO1    A1
       LSH 1
       STA NIO1    A1
       LSH 23
       LDB UB
       LSH 1
       XAB
       ADD NIO7
       STA NIO3   A3
       CBA
       ADC ZERO
       STA NIO2   A2
       LDA NIO1    A1
       ADC ZERO
       STA NIO1    A1
       ROV
       LDA NIO1    A1
       SKA =37B6
       BRU *+2
       R1 DGTADD
       MIN OVFLFG (SETF)
       R1 DGTADD
*ONLY HAVE TO WORRY ABOUT TWO WORDS
SPAD   XAB
       ADD NIO2   A2
       XAB
       ADC NIO1    A1
       LSH 1
       XAB
       ADD NIO7
       STA NIO2   A2
       XAB
       ADC ZERO
       STA NIO1    A1
       ROV
       SKA =37B6
       BRU *+2
       R1 DGTADD
*  GO TO D.P.
       STA NIO2   A2
       STB NIO3   A3
       CLB
       STB NIO1    A1
       LDB KM1
       STB DPFLAG
       R1 DGTADD
*   MULTIPLY THE NUMBER IN A1,A2,A3 WITH EXPONENT IN IODEXP     BINARY
*      BY THE NUMBER IN THE FOUR CONTINOUS LOCATIONS POINTED TO
*      BY THE X REGISTER.
*      IF DPFLAG IS NEG, THE NUMBERS ARE TREATED AS THREE WORD F.P.
*      IF DPFG IS POS, THE NUMBERS ARE TWO WORD FP
*
DPMRIO BSS 0
*  SPREAD THE VALUE TO AVOID NEGATIVE LOOKING NUMBERS
       LDA NIO2   A2
       LDB NIO3   A3
       LRSH 1
       STA NIO2   A2
       CLA
       RSH 1
       STB NIO3   A3
       LDA NIO1    A1
       SKE ZERO
       BRU *+2
       R1 DPMRIO
       MUL 0,2                 (AH*MH)/4
       RSH 1
       STA UA
       STB UB

       LDA 1,2
       MUL NIO1    A1                  (AH*MM)/4
       STB NIO6
       ADD UB
       STA UB
       CLA
       ADC UA
       STA UA

       LDA 0,2
       MUL NIO2   A2                  (AM*MH)/4
       XAB
       ADD NIO6
       STA NIO6
       XAB
       ADC UB
       STA UB
       CLA
       ADC UA
       STA UA
       LDA 2,2
       MUL NIO1    A1                  (AH*ML)/4
       RSH 1
       STA NIO7
       SKN DPFLAG
       BRU *+2
       BRU TRPMUL
       LSH 2
       ADM NIO6                (USE COMPLETE LAST TERM FOR ROUNDING CHECK)
       LDB UA
       LDA UB
       SKN NIO6
       BRU DPMR1
       ADD ONE
       BRU *+2
DPMR1  ADC ZERO
       XAB
       ADC ZERO
       STA UA
       STB UB
       LDA 3,2
       ADD IODEXP     BINARY
       ADD ONE  (COMPENSATE FOR RIGHT SHIFTS)
       CAX
       LDA UA
       LDB UB
       NOD 48
       STA NIO1    A1
       STB NIO2   A2
       STX IODEXP     BINARY
       R1 DPMRIO
*  THREE WORD MULTIPLY

TRPMUL LDA 1,2
       MUL NIO2   A2                  (AM*MM)/4
       RSH 1
       ADD NIO7
       STA NIO7

       LDA NIO3   A3
       MUL 0,2                 (AL*MH)/4
       RSH 1
       ADD NIO7
       LRSH 22
       XAB
       ADD NIO6
       STX NIO8                (SAVE THE CARRY)
       ADD FOUR                  (TO EFFECT ROUNDING--IS IN EXPONENT PART)
       STA NIO3   A3
       CXA
       MRG NIO8
       COPY AX,BA
       ADC UB
       STA NIO2   A2
       CLA
       ADC UA
       STA NIO1    A1

       LDA 3,2
       ADD IODEXP     BINARY
       ADD ONE
       CAX
       C NOD72              (DOES A NOD 72 ON A1,A2,A3)
       STX IODEXP     BINARY
       R1 DPMRIO


* MULTIPLICATION TABLE WITH POWERS OF TEN
*  2ND WORD IS /2, 3RD WORD IS /4 4TH WORD IS EXPONENT
PLSTBL DATA 24000000B,0,0,4B,31000000B,0,0,7B
       DATA 23420000B,0,0,16B,27657020B,0,0,33B
       DATA 21606744B,33740400B,0,66B
       DATA 23561326B,32405334B,05531676B,153B
       DATA 30236017B,24477763B,35155247B,325B
MINTBL DATA 31463146B,14631463B,06314631B,-3B
       DATA 24365605B,03656050B,36560507B,-6B
       DATA 32155613B,25434206B,13122572B,-15B
       DATA 25363073B,21060430B,16357637B,-32B
       DATA 34645312B,13730423B,17025551B,-65B
       DATA 31754217B,12650516B,14513515B,-152B
       DATA 25037765B,02364516B,17232250B,-324B
* CONSTANTS USED BY FIO ONLY
$FTEN DATA 24B6,4
$TENTH DATA 31463146B,31463775B

*ROUNDING TABLE
*
RNDVAL DATA 01463146B,31463146B,31463147B

RNDTBL DATA 10000000B,0B,0B    5*10(-1)
       DATA    00631463B,14631463B,14631440B   5*10(-2)
       DATA    00050753B,41217270B,24365602B   5*10(-3)
       DATA    00004061B,11564570B,65176763B   5*10(-4)
       DATA    00000321B,55613530B,70414545B   5*10(-5)
       DATA    00000024B,76132610B,70664360B   5*10(-6)
       DATA    00000002B,06157364B,05536661B   5*10(-7)
       DATA    00000000B,15327745B,15274536B   5*10(-8)
       DATA    00000000B,01257143B,56106043B   5*10(-9)
       DATA    00000000B,00104560B,27640466B   5*10(-10)
       DATA    00000000B,00006676B,33766353B   5*10(-11)
       DATA    00000000B,00000537B,65777027B   5*10(-12)
       DATA    00000000B,00000043B,13631402B   5*10(-13)
       DATA    00000000B,00000003B,41134115B   5*10(-14)
       DATA    00000000B,00000000B,26411156B   5*10(-15)
       DATA    00000000B,00000000B,02200727B   5*10(-16)
       DATA    00000000B,00000000B,00163225B   5*10(-17)
       DATA    00000000B,00000000B,00013416B   5*10(-18)
       DATA    00000000B,00000000B,00001116B   5*10(-19)
*
*
*ISCS TEST PART

*FOR D.P. FLOATING PT --A-CONTAINS A POINTER TO THE FIRST
*  OF THREE LOCATIONS WHICH HOLD THE NUMBER.

ISCS   LDA KM1; STA MFFLAG (CLRF); STA SIGN (CLRF)
       SKP FIO (ARE WE SIMULATING TYMSHARE FIO)
       BRU NIOISC (NO)
* SAVE SIGN
       LDP UA
       SKA K4B7
       MIN SIGN (SETF) SAVE SIGN
       STP NIO1
       STP XWR3
NIOISC CLA
       STA DGTCNT   SIG FIGS
       SKE IOW
       BRU ISCS1
* IOW =0 MEANS F16.9 OR E FMT FOR FIO (TYMSHARE)
       SKN FIO
       BRU IOFREE
* IOW =0 MEANS FREE FORMAT WIDTH DELETE PRECEEDING SPACES
       MIN MFFLAG (SETF)
       LDA K23 (19D)
       SKN DPFLAG
       LDA TEN
       STA IOW
ISCS1  LDA IOFMT
       SKE ONE
       SKN DPFLAG
       BRU NTDPFL
* PICK UP DP ACCUMULATOR
       LDA UA;  C SUSR; LDP 0,2
       STP NIO1; LDA 2,2; STA NIO3
       LDA NIO12; C SUSR (GET STRING PGS BACK)
       LDB NIO3   A3
       STE
       STB NIO3                (SAVE WITHOUT EXPONENT)
       C NOD72
       LDB NIO3   A3
       LDE
       STB NIO3   A3
NTDPFL LDA IOFMT
       SKN FIO (ARE WE SIMULATING FIO)
       ADD FOUR (YES)
       CAX
       LDA IOD
       BRU *+1,2
       BRU ISCSFL (FREE--NOT ALLOWED IN FIO)
       BRU ISCSSI (INTEGER)
       BRU ISCSEF ("E")
       BRU ISCSFF ("F")
       BRU ILGFMT (FREE NOT ALLOWED IN FIO)
       BRU IOICON (INTEGER)
       BRU IOECON (E)
       BRU IOFCON (F)
* TYMSHARE FREE FORMAT
IOFREE LDA NINE
       STA IOD
       LDA K20 (16)
       STA IOW
       C RNDEXP (SCALE AND ROUND)
       LDP XWR3
       STP NIO1
       LDA IODEXP
       SKG EIGHT
       SKG KM1
       BRU IOECON (GO WITH E FMT)
       CNA
       ADM IOD
* TYMSHARE "F" FORMAT
IOFCON LDA THREE
       STA IOFMT
       C RNDFI (SCALE AND ROUND)
       LDA IOD
       BRU ISCSFF
ILGFMT LDB K1B7
       C ERR
IOECON LDA TWO
       STA IOFMT
       C RNDEXP (SCALE AND ROUND)
       LDA IOD
       MIN NIO5
       BRU ISCSEF
IOICON CLA
       STA IOD
       LDP NIO1
       BRS 51 (FLOAT IT)
       STP NIO1
       STP XWR3
       C RNDFI
       LDA KM1
       STA IOD
       BRU ISCRD
**  LOAD DGTCNT WITH DESIRED NUM OF SIGNIFICANT FIGURES--NEG IF OK
**  POS IF DEXP TO BE ADDED
*    FREE FORMAT--SINGLE PRE
ISCSEF CNA
       SKN NIO5               (P FACTOR)
       SUB NIO5               (P ADDS TO SIG FIGS TO MAINTAIN IOD AFTER PERIOD)
ISCSFF STA DGTCNT   SIG FIGS
*      SET IOD OF ZERO TO -1 IF YOU DON'T WANT A PERIOD
       SKP NODOTFG
       BRU ISCSSF
       LDB KM1
       LDA IOD
       SKG ZERO
       STB IOD
       BRU ISCSSF
* CHECK FOR AN ILLEGAL G FORMAT AND FIX BY ADJUSTING IOD=IOW-5
ISCSFL SKP FMT4FG
       BRU ISCFL2
       LDA IOW
       SUB FIVE
* TEST IF WE NEED ONE MORE FOR NEG SIGN
       SKN DPFLAG
       BRU TESTSP              (SINGLE PRECISION NUMBER IS STILL IN UA)
       SKN     NIO1            (DOUBLE PRECISION NUMBER IS IN NIO1)
       BRU ISCFLP
       BRU ISCFLN
TESTSP SKP UA
ISCFLN SUB ONE
ISCFLP SKG IOD
       STA IOD
ISCFL2 LDA IOD            (IOD TELLS NUM SIG FIGS--10 IF ZERO)
       SKE ZERO
       BRU ISCFA
       LDA K23 (19D)
       SKN DPFLAG
       LDA TEN                 (19 FOR DOUBLE PRE)
ISCFA  CNA
       STA DGTCNT   SIG FIGS
       BRU ISCSSF
*  SINGLE PRECISION INT
ISCSSI SKG ZERO ('A' CONTAINS IOD)
       LDA KM1                 (-1 TO COUNTERACT SPACE FOR DP)
       STA IOD
       SKP DPFLAG
       BRU ISCSDI
       LDX K27 (23D)
       CLB
       BRU ISCSF1
*  DOUBLE PRECISION INT
ISCSDI LDX K57 (47D)
       LDA UA
       LDB UB
       NOD 48
       STA NIO1    A1
       STB NIO2   A2
       STX NIO3   A3
       BRU ISCSA
*  SINGLE PRECISION FLOATING
ISCSSF SKN FIO (ARE WE SIMULATING FIO)
       BRU ISCRD (YES)
       SKP DPFLAG              (DOUBLE HAS NORMALIZE DONE)
       BRU ISCSA
       LDB UB
       STE
ISCSF1 LDA UA
       NOD 48                  (NORMALIZE JUST IN CASE & FOR INTEGERS)
       SKE ZERO
       LDE
       STA NIO1    A1
       STB NIO2   A2
*  GET THE ABSOLUATE VALUE AND SAVE THE SIGN
ISCSA  SKN NIO1
       BRU ISCSB               (PLUS--EASY)
       MIN SIGN (SETF)         (-)
       C NIOFNA
*  SCALE THE NUMBER AND FIND THE THE DECIMAL EXPONENT
ISCSB  CLA
       STA DEXP
       LDB NIO3   A3
       SKN DPFLAG              (GET THE EXPONENT)
       LDB NIO2   A2
       STE
       STB NIO3   A3
       SKN DPFLAG
       STB NIO2   A2
       STX IODEXP     BINARY
*TEST FOR ZERO (DON'T TRY TO SCALE A ZERO)
       LDA NIO1    A1
       SKE ZERO
       BRU SCALE
       STA NIO3   A3
       STA IODEXP     BINARY
       LDA ONE
       STA DEXP
       BRU ISCRD
*  LOOP 
SCALE  LDA IODEXP     BINARY
*      GET DECIMAL EXPONENT WHICH IS CORRECT OR ONE TOO LOW
       MUL =11504046B          (LOG OF 2 BASE 10 OVER 2)
       STA DEXP
       LDB =MINTBL
       SKA K4B7
       LDB =PLSTBL
       SKA K4B7
       CNA
       C EXPSUB
       LDA IODEXP              BINARY
       SKG ZERO
       BRU ISCSC               (WE'RE DONE)
       EAX MINTBL              (MULTIPLY BY 10^-1 )
       C DPMRIO
       MIN DEXP
*  FINISH SCALING-BINARY POINT BETWEEN BITS 1&2
ISCSC  LDA IODEXP
       CNA
       CAX
       LDA NIO2   A2
       LDB NIO3   A3
       LRSH 1,2
       STB NIO3   A3
       LDB NIO2   A2
       LDA NIO1    A1
       LRSH 1,2
       STA NIO1    A1
       STB NIO2   A2
*  GET THE RIGHT NUMBER OF SIGNIFICANT FIGURES
ISCRD  SKN DGTCNT   SIG FIGS
       BRU ISCSC3
*  REDUCE DGTCNT TO ACCOUNT FOR LEADING ZEROS IF DEXP IS ZERO OR NEG
*      ONLY IF IN FREE FORMAT AND WILL CHOOOSE  F TYPE
       LDA IOFMT
       SKP FMT4FG
       SKE ZERO
       BRU ISCRDB
       LDA DEXP
       SKG ZERO
       SKG KM2
       BRU ISCRDB
       SUB ONE
       CNA
       ADM DGTCNT
       BRU ISCRDB
ISCSC3 LDA DGTCNT   SIG FIGS
       ADD NIO5               (ACCOUNT FOR ANY P FACTOR)
       ADD DEXP
       SKG KM1
       BRU ISCSD               (NO SIGFIGS DON'T BOTHER)
       CNA
       SKN DPFLAG
       BRU *+2
       BRU ISCSC2
       LDB =-13
       SKG =-13
       CBA
ISCSC2 LDB =-20
       SKG =-20
       CBA
       STA DGTCNT   SIG FIGS
*
*      ROUND BY ADDING THE CORRECT TRIPLE WORD VALUE TO THE NORMALIZED VALUE
*
ISCRDB SKN FIO (ARE WE SIMULATING FIO)
       BRU ISCSD (YES--NUMBER ALREADY ROUNDED)
       LDA DGTCNT
       RCH 1002B               (CNA,CLB)
       SKG K22 (=18D) (MAX ENTRY IN TABLE)
       BRU *+2
       BRU ISCSD
       LSH 2
       ADD DGTCNT              (-DGTCNT*3)
       CAX
       LDA NIO3
       ADD RNDTBL+2,2
       STA NIO3
       LDA NIO2
       ADC RNDTBL+1,2
       STA NIO2
       LDA NIO1
       ADC RNDTBL,2
       STA NIO1
       SKN DPFLAG
       BRU *+2
       BRU ISCRDZ
       LDA NIO2
       ADD K200
       STA NIO2
       LDA NIO1
       ADC ZERO
       STA NIO1
ISCRDZ BSS 0
       SKA K2B7
       BRU *+2
       BRU ISCSD
*      CORRECT FOR OVERFLOW--INCREASE DECIMAL EXPONENT AND SET VALUE 
*      TO NORMALIZED .1
       MIN DEXP
       LDP RNDVAL
       STP NIO1
       LDA RNDVAL+2
       STA NIO3
*  FINISH THE NUMBER
ISCSD  LDX IOFMT
       BRU *+1,2
       BRU FMT0
       BRU FMT1
       BRU FMT2
       BRU FMT3
*  FREE FORMAT
*  FIGURE IOW AND IOD FOR FREE FORMATS
FMT0   LDA IOD
       SKE ZERO
       BRU FMT01
       LDA K23 (19D)
       SKN DPFLAG
       LDA TEN
FMT01  STA IOD
       LDA DEXP
       SKG IOD
       SKG KM2
       BRU FMT02
* USE F FORMAT
       SKN FMT4FG
       BRU FMT04
       LDA THREE
       ADD IOD
       SKG IOW
       BRU *+2
       STA IOW
       LDA DEXP
* IF DEXP IS NEG SET IOD = IOD-1 TO ACCOUNT FOR 0 BEFORE DECIMAL PT
       SKG ZERO
       LDA ONE
       CNA
       ADM IOD
       CLA
       STA NIO5               (P--SET P FACTOR TO ZERO)
       BRU FMT3
FMT04  LDA DEXP
       SKG KM1
       BRU FMT2
       SUB IOD
       CNA
       STA IOD
       LDA IOW
       SUB FOUR
       STA IOW
       CLA
       STA NIO5
       BRU FMT3
* USE E FORMAT
FMT02  LDA SIX
       ADD IOD
       SKG IOW
       BRU *+2
       STA IOW
       LDA KM1
       ADM IOD
       LDA ONE
       STA NIO5               (SET P FACTOR TO 1--1.234E 05)
       BRU FMT2
*      INTEGER FORMAT--TAKE CARE OF IW.D CASE
FMT1   LDA DEXP
       SKN IOD                 (DON'T  SUB IF IOD IS -1)
       SUB IOD
       STA DEXP
       BRU FMT3                (TREAT LIKE F)
*  E FORMAT
FMT2   LDA IOW
       SUB FIVE                  (SPACE FOR EXPONENT AND SIGN)
       ADD DGTCNT   SIG FIGS
       SKN IOD
       SUB ONE                  (SPACE FOR PERIOD)
       SKA K4B7
       BRU ERRE
       SKN MFFLAG
       CLA                     (SET NEEDED SPACES TO ZERO IF SHORT MODE)
       SKP POST (ARE WE LEFT JUSTIFYING FOR FIO)
       BRU FMT2A4 (NO)
       CLA
       SKP SIGN (YES--NEED TO LEAVE SIGN IN FOR E FORMAT ONLY)
       BRU FMT2A6 (OUTPUT BLANK =+)
       BRU FMT2A5 (OUTPUT -)
FMT2A4 SKP SIGN
       ADD ONE                  (ANOTHER SPACE FOR THE PLUS SIGN)
       C SPCOUT (OUTPUT BLANKS)
FMT2A5 LDA K15
       SKN SIGN
FMT2A6 WCI IOPTR
FMT2A1 LDA DGTCNT   SIG FIGS
       CNA
       SKL NIO5               (P)
       BRU *+2
       STA NIO5      P
       LDA NIO5     P         (SET P 0<= P <= -DGTCNT)
       SKG ZERO
       CLA
       STA NIO5    P
       SKG ZERO
       BRU FMT2A3
       CNA
       CAX
FMT2A2 C GDIGIT
* FIND NON-ZERO LEAD DIGIT FOR FIO ONLY
       SKN FIO
       SKE ZERO
       BRU FMT2A7
       SKU NIO1 (DONT GET TRAPPED)
       BRU FMT2A7
       SKR DEXP (CORRECT EXPONENT)
       NOP
       BRU FMT2A2 (LOOK AT NEXT DIGIT)
FMT2A7 ADD K20
       WCI IOPTR
       BRX FMT2A2
FMT2A3 LDA DGTCNT
       ADD NIO5               (REDUCE EXPONT TO ACCOUNT FOR DECIMAL MOVE)
       SKL ZERO
       BRU FMT2C
       CAX
       LDA K16                (DECIMAL POINT)
       WCI IOPTR
       C GDIGIT
       ADD K20
       WCI IOPTR
       BRX *-3
       SKP MFFLAG
       BRU FMT2C
*  ELIMINATE TRAILING ZEROS
FMT2B1 GCD IOPTR
       BRU DONE                (CAN'T HAPPEN)
       SKE K20
       BRU *+2
       BRU FMT2B1
       SKE K16
       MIN IOPTR1
FMT2C LDA K45                (E)
       WCI IOPTR
       LDA DEXP
       SUB NIO5               (ADJUST EXPONENT FOR P)
       STA DEXP
       SKA K4B7
       CNA
       COPY AB
       LDA K15
       SKN DEXP
       LDA K13
       WCI IOPTR                 (SIGN OF EXPONENT)
       CLA
       LSH 1
       DIV TEN
       ADD K20
       WCI IOPTR
       CBA
       ADD K20
       WCI IOPTR
       BRU DONE
*  F-FORMAT AND INTEGERS
FMT3   LDA KM1; STA ODOTFG (CLRF) (NO ZERO REQUIRED YET)
       LDA IOD
       SKL IOW
       BRU *+2
       BRU FMT3X
       LDB K2B7                (ERROR 2--FORMAT OVERFLOW)
       SKN FIO (ARE WE SIMULATING FIO)
       LDB K4B7 (YES--POST ERROR 4)
       C ERR
       SKN OVFL
       BRU ERSTAR              (FILL THE FIELD WITH STARS)
       LDA IOW
       SUB ONE
       STA IOD                 (FORCE IOD=IOW-1 SO THINGS CAN FIT)
FMT3X  LDA DEXP             (NUMBER OF DIGITS BEFORE DP)
       ADD NIO5               (ADJUST  FOR P FACTOR)
       STA DEXP
       SKL ONE
       BRU FMT3Y               (DIGITS BEFORE DECIMAL--NO SWEAT)
*  CHECK IF WE NEED A ZERO BEFORE THE PERIOD
       LDA IOW
       SUB IOD
       SKNE ONE
       BRU FMT3V               (ONLY HAVE ROOM FOR DECIMAL)
       SKG TWO                  (DO WE HAVE SPACE FOR SIGN,DECIMAL& ZERO?)
       BRU CHOOSE
       STA ODOTFG (SETF)
       LDA ONE                  (HAVE SPACE FOR ZERO)
       BRU FMT3Y
*      CHOOSE BETWEEN SIGN AND ZERO--ONLY HAVE ROOM FOR ONE
CHOOSE SKN SIGN
       BRU FMT3W               (CHOOSE IF MINUS)
       BRU FMT3Z               (CHOOSE ZERO IF PLUS)
*
FMT3W  CLA                     (ONLY HAVE ROOM FOR SIGN)
FMT3Y  CNA     (A CONTAINS THE NUMBER OF DIGITS BEFORE DECIMAL)
       ADD IOW
       SUB IOD
FMT3V  SUB TWO                  (FOR THE DECIMAL POINT AND SIGN)
       SKA K4B7
       BRU ERRF
       SKN MFFLAG
       CLA
       SKP SIGN
       ADD ONE
       C SPCOUT (OUTPUT BLANKS)
       LDA K15
       SKN SIGN
       WCI IOPTR
FMT3A1 LDA DEXP
       SKL ONE
       BRU FMT3A2
       SKP ODOTFG
       BRU FMT3Z1
       BRU FMT3Z               (ZEROS)
FMT3A2 CNA
       CAX                   (DIGITS)
FMT3C  C GDIGIT
       ADD K20
       WCI IOPTR
       BRX FMT3C
       SKN IOD
       BRU *+2
       BRU DONE                (INTEGER)
       LDA K16                (DECIMAL POINT)
       WCI IOPTR
FMT3D  LDA IOD
       SKG ZERO
       BRU FMT3E
       CNA
       CAX
       C GDIGIT
       ADD K20
       WCI IOPTR
       BRX *-3
FMT3E  SKN MFFLAG
       BRU FMT3E1
       SKP FMT4FG
       BRU DONE
       LDA FOUR
       C SPCOUT (OUTPUT BLANKS)
       BRU DONE
*  ELIMINATE TRAILING ZEROS
FMT3E1 GCD IOPTR
       BRU DONE                (CAN'T HAPPEN)
       SKE K20
       BRU *+2
       BRU FMT3E1
       SKE K16
       MIN IOPTR1
       BRU DONE
*  MUST PUT OUT SOME PRECEEDING ZEROS
FMT3Z  LDA K20
       WCI IOPTR
       SKN IOD
       BRU *+2
       BRU DONE                (INTEGER)
FMT3Z1 LDA K16
       WCI IOPTR                 (ZERO AND DECIMAL POINT)
       SKN DEXP
       BRU FMT3D
*      PUT OUT A NUMBER OF ZEROS EQUAL TO  MIN(IOD,-DEXP)
       LDA IOD
       SKG ZERO
       BRU FMT3Z2              (IOD=0   QUIT)
       CNA
       SKG DEXP
       LDA DEXP
       CAX
       LDA K20
       WCI IOPTR
       BRX *-2
FMT3Z2 LDA IOD
       ADD DEXP
       BRU FMT3D+1
DONE   SKP POST
       BRU DONE2
       LDA IOW (FIELD WIDTH DESIRED)
       ADD IOPTR
       SUB IOPTR1 (CALCULATE IOW-(IOPTR1-IOPTR))
       SKG ZERO (ALWAYS ADD AT LEAST ONE)
       LDA ONE (TO SIMULATE FIO BUG)
       C SPCO2
DONE2  LDB DEXP                (RETURN DECIMAL EXP IN B)
       STB UB
       R1 ISCS
*  FIELD OVERFLOW  FOR F FIELDS--PUT SOMTHING OUT
ERRF   SKG KM2
       BRU ERRF0
       SKP SIGN
       BRU FMT3A1              (WILL FIT WITHOUT THE PLUS SPACE)
ERRF0  CAX
       LDB K2B7
       SKN FIO (ARE WE SIMULATING FIO)
       LDB K4B7 (YES--POST ERROR 4)
       C ERR
       SKN OVFL
       BRU ERSTAR
       BRU ERRF2
ERRF1  C GDIGIT
       SKR DEXP
ERRF2  BRX ERRF1
       BRU FMT3A1
*  FIELD OVERFLOW ERROR
ERRE   SKG KM2
       BRU ERRE0
       SKP SIGN
       BRU FMT2A1
ERRE0  CAX
       LDB K2B7                (ERR 2--FIELD OVERFLOW)
       C ERR
       SKN OVFL
       BRU ERSTAR
       CXA
       SUB DGTCNT
       SKP SIGN                WE CAN USE THE SIGN SPACE IF IT IS PLUS)
       ADD ONE
       SKA K4B7
       BRU BRSOUT                 (NO HOPE --SCREW HIM)
       CNA
       STA DGTCNT
       BRU FMT2
ERSTAR LDA IOW
       CNA
       CAX
       LDA TEN
       WCI IOPTR
       BRX *-1
       R1 ISCS

** FLOATING FORMATTED INPUT(BRS 52)
$FFI     C GETFMT
       LDA K377
       MRG ERRNUM
       STA ERRNUM                  (STRING END TERM CHAR)
*      DON'T MISTAKE THE FILE NUMBER FOR P
       C SETPTR (SET UP PTRS TO XWR4)
* READ THE NUMBER
       SKN FIO (ARE WE SIMULATING TYMSHARE FIO)
       STA IOFMT (YES, SIMULATE BRS 52 BUG.. SETPTR RETURNS '0')
       SKE IOW (IS IOW=0)
       BRU FFIB (NO--READ IOW CHARACTERS)
FFIA   CIO IOFILE      
       WCI IOPTR
       SKG ZERO                  (COPY ANY INITIAL BLANKS)
       BRU FFIA
       SKE MBCH
       BRU FFIAB
       CIO IOFILE   
       WCI IOPTR
       BRU FFIA
FFIAB  SKNE K13               (SIGN)
       BRU FFIA1
       SKNE K15
       BRU FFIA1
       SKNE K16
       BRU FFIA2
FFIA11 SKG K31
       SKG K17
       BRU FFIC
FFIA1  CIO IOFILE            (NUMBER)
       WCI IOPTR
       SKNE K16
       BRU FFIA2
       SKE K45
       SKNE BD
       BRU FFIA3
       BRU FFIA11
FFIA2  CIO IOFILE            (FRACTION)
       WCI IOPTR
       SKNE K16               (DOUBLE PERIOD FOR DOUBLE PRECISION)
       BRU FFIA2
       SKE K45                (E)
       SKNE BD               (D)
       BRU FFIA3
       SKE SE               (SMALL E)
       SKNE SD              (SMALL D)
       BRU FFIA3
       SKG K31
       SKG K17
       BRU FFIC
       BRU FFIA2
FFIA3  CIO IOFILE            (EXPONENT)
       WCI IOPTR
       SKG ZERO
       BRU FFIA3               (ALLOW SPACE AFTER THE E)
       SKNE K15
       BRU  FFIA4
       SKE K13
       BRU *+3
FFIA4  CIO IOFILE      
       WCI IOPTR
       SKG K31
       SKG K17
       BRU FFIC
       BRU FFIA4
FFIC   RSH 9
       LDA IOPTR1
FFIC1  SUB IOPTR              (FIELD COUNT COMES HERE)
       SUB ONE                  (DON'T COUNT THE TERMINATING CHAR)
* (NOTE FIELD COUNT FOR FIO SET TO ZERO IN 'ERRSUB')
       LSH 9
       LDB ERRNUM
       SKB K1B7
       MRG K1B7
       STA ERRNUM
       C SICS
       STA NIO6
       BRU EBRS52
*  FORMAT GIVES CHARACTER COUNT
FFIB   CNA
       CAX
FFIB1  CIO IOFILE      
       SKE MBCH
       BRU FFIB2
       CIO IOFILE      
       STX FIOW   XSAV
       ADM FIOW   XSAV
       CNA
       COPY AX,A
       WCI IOPTR
       BRX *-1
       LDX FIOW   XSAV
       BRU FFIB1
FFIB2  WCI IOPTR
       BRX FFIB1
       LDA IOPTR1
       ADD ONE                  (TO COUNTERACT THE SUBTRACT)
       LDB =377B5              (NO TERM CHAR STRING FILLED)
       BRU FFIC1
*      FLOATING FORMATTED OUTPUT (BRS 53)
*
$FFO     C GETFMT
       C SETPTR (SET UP PTRS TO XWR4)
       LDA IOFILE
       SKG ZERO
       LDA COUT
       STA IOFILE
       C ISCS
       SKN FIO (ARE WE SIMULATING FIO)
       C ERRSUB (YES--SAVE ERR. IN USER LOC. 200B)
       LDP IOPTR
       LDX IOFILE
       BRS 35 (OUTPUT STRING)
       SKN FIO; BRU NBS111
$BRSOUT LDP UA
       LDX ERRNUM
$NBS111 BRS 111


*  GET THE NEXT DIGIT - TYMSHARE COMPATIBLE
$GDIGIT STX FIOW   XSAV
       LDX K4B7                (FAKE CARRY FOR SINGLE PRESISION NUMBERS)
       SKN DPFLAG
       BRU GDIG1
       LDB NIO2   A2
       LDA NIO3   A3
       RCY 2
       ADD NIO3   A3
       STA NIO3   A3  (CARRY IN CARRY BIT)
GDIG1  LDA NIO1    A1
       LDB NIO2   A2
       LRSH 2
       XAB
       SKN FIO
       ADD NIO2
       SKP FIO
       ADC NIO2   A2
       XAB
       ADC NIO1    A1
       STB NIO2   A2
       CAX
       ETR K1S6 (=1777777B)
       LSH 3
       STA NIO1    A1
       SKN DPFLAG
       BRU GDIG2
       LDA NIO2   A2
       LDB NIO3   A3
       LSH 3
       STB NIO3   A3
       CAB
GDIG2  STB NIO2   A2
       CXA
       LRSH 19
       LDX FIOW   XSAV
       R1 GDIGIT
* ERROR SUB --DON'T ERASE A PREVIOUS ERROR MESSAGE
$ERR    LDA ERRNUM
       SKA K7B7
       R1 ERR
       XAB
       ETR K7B7
       MRG ERRNUM
       STA ERRNUM
       R1 ERR

*FLOATING NEGATE-CHECKS DPFLAG TO DO SINGLE AND DOUBLE
NIOFNA EAX NIO3                (EXPONENT IF D.P.)
       SKN DPFLAG
       EAX NIO2                (EXPONENT IF S.P.)
       LDA 0,2
       EOR KS5B3 (=77777B3)          (DON'T TOUCH THE EXPONENT)
       ADD K1000
       STA 0,2                 (STORE IN EXPONENT WORD)
       LDA -1,2                (NIO1 IF S.P.--NIO2 IF D.P.)
       EOR KM1
       ADC ZERO
       STA -1,2
       SKN DPFLAG
       BRU NFNA1
       LDA -2,2                (NIO1--THIS IS D.P.)
       EOR KM1
       ADC ZERO
       STA NIO1    A1
NFNA1  SKA K4B7                (SPECIAL CASES-6B7 AND 4B7)
       SKA K1S7 (=17777777B)
       R1 NIOFNA               (NORMAL CASE--RETURN)
       LDB 0,2                 (EXPONENT WORD)
       SKA K2B7
       BRU 6CASE
       SKB KS5B3 (=77777B3)
       R1 NIOFNA               (LOW ORDER BITS IN 4 CASE--OK)
       SKN DPFLAG
       BRU 4CASE1
       LDA NIO2
       SKA KM1
       R1 NIOFNA               (BITS ON IN MIDDLE D.P. WORD--OK)
4CASE1 LDA K2B7
4CASE2 STA NIO1
       CXA     0               (SAVE THE EXPONENT POINTER IN A)
       STE
       XXA 0                   (EXPONENT IN A--E POINTER IN X)
       SKN NIO1    A1
       ADD TWO
       SUB ONE
       SKG =-377B
       BRU EXUNFL
       SKG K377
       BRU ALLWEL
*      GET THE MAXIMUM EITHER SP OR DP INTO A1-A3
GETMAX LDA K3S7 (=37777777B)
       STA NIO1    A1
       LDB =77777377B
       LDA KM1
       STA NIO2   A2
       STB 0,2
       R1 NIOFNA
*
ALLWEL RCH 104B                (EXPONENT PART OF A INTO EXPONENT PART OF B)
       STB     0,2
       R1 NIOFNA
*
6CASE  LDA K4B7
       BRU 4CASE2
*
* GIVE HIM THE PAGE AFTER STRING IF I HAVE GRABBED IT
*
UPDR   LDA NIO12 (CONTAINS APPROPRIATE CORE ADDR)
       RCY 11; ETR SEVEN; MUL THREE; CBX
       BRS 43
       XAB
       ETR KS4B4 (=7777B4)   (RELABELING FOR MY STRING PAGES)
       STA     NIO1            (TEMP STORAGE)
       C UPDRL (UPDATE CMRL)
       R1 UPDR
*SEND A DOUBLE PRECISION RESULT BACK TO HIM
SENDDP LDA NIO12              (I STORED HIS POINTER HERE)
       C SUSR RELABEL ACCUMULATOR PG
       LDP NIO1
       STP 0,2
       LDA NIO3
       STA 2,2
       C UPDR (MAKE CERTAIN ACCUMULATOR IN USER RELAB)
       R1
*      SET UP STRING PTRS TO XWR4
$SETPTR LDA XWR4X3
       STA IOPTR
       STA IOPTR1
       CLA
       STA NIO5 (ZERO OUT SCALING FACTOR FOR BRS 52,53)
       STA NIO12 (DISALLOW 1 CHAR/WD. SIC)
       R1
* OUTPUT NO. BLANKS GIVEN IN 'A':
SPCOUT SKP POST
       SKG ZERO
       R1
SPCO2  CNA
       COPY AX,A
       WCI IOPTR
       BRX *-1
       R1

* GET A CHAR FROM INPUT STRING, INSERT DECIMAL PT WHERE NEEDED
GETCHR LDA IOPTR
       SKE NIO11 (POSITION OF EXPECTED ".")
       BRU NODOT
       LDA KM2; STA NIO11
       LDA K16
       R2 GETCHR
NODOT  GCI IOPTR
       R1 GETCHR
       R2 GETCHR

* ERRSUB - STORES ERROR NO. IN USER'S LOC 200B FOR FIO
*      (BELIEVE IT OR NOT)
ERRSUB LDA ERRNUM
       ETR K377
       SKE K377 (REPLACE RUBOUT WITH IOPTR+1)
       BRU *+4
       LDA IOPTR
       ADD ONE
       ETR K3777
       XMA ERRNUM (ERRNUM TO CONTAIN TERM CHAR ONLY)
       LRSH 21 (RETRIEVE ERR CODE)
       SKG ZERO
       R1 ERRSUB
       STA BD (TEMP)
       LDA K200
       C SUSR (RELABEL USER PG 0)
       LDA BD
       STA 0,2
       R1 ERRSUB

*
*      ROUTINES TO SUPPORT TYMSHARE ISC
*
****** DECIMAL NORMALIZATION OF NIO1,NIO2
OUTSET BSS 0   OUTSX           OUTSET MULTIPLIES THE NUMBER IN NIO1,NIO2 BY
*                              TEN OR TENTH SUCCESSIVELY, UNTIL THE
*                              BINARY EXPONENT IS LEQ ZRO AND  GTR
*                              -4. THE DECIMAL EXPONENT OF THE NUMBER
*                              IS  OBTAINED
       LDP     NIO1
       SKE     ZERO
       BRU     OS1
       CLB
       STB     DEXP
       BRU     CNVD1
OS1    SKN     NIO1
       BRU     OS2
       BRS     21
       STP     NIO1
       STP     XWR3
OS2    LSH     39
       LDX     KM1
       SKG     ZERO              EXAMINE SIGN OF BINARY EXPONENT
       LDX     ONE
       STX     DEXP
       STX     IODEXP
       LDX     =RLIO9          ADDRESS OF FLOATING 1/10
       SKA     K4B7
       LDX     =RLIO8          ADDRESS OF FLOATING 10
       STX     NCONV
       LDP     NIO1
       STE
       NOD     48
ADJUST XXA
       LSH     3
       RSH     3
       SKG     ZERO
       SKG     KM4             BINARY EXPONENT IS NOT LEQ 0 AND GTR -4
       BRU     ADJ1
CNVDON CNA                     CONVERSION DONE
       XXA
       LRSH    1,2
CNVD1  STP     NIO1
       LDA     DEXP
       SKN     IODEXP
       CNA
       STA     IODEXP
       R1       OUTSET
ADJ1   XXA
       STX     NIO6
       LDX     NCONV
       C       FDPMRIO          MULTIPLY BY 10 OR 1/10
       MIN     DEXP
       BRU     ADJUST
****** FLOATING MULTIPLY WITH 48-BIT FRACTION
FDPMRIO BSS 0   FFL             THIS IS A MULTIPLY ROUTINE FOR 48 BIT
*                              MANTISSA WITH THE EXPONENT IN A 3RD
*                              WORD. THE MLTIER IS IN A,B  WITH THE
*                              EXPONENT IN NIO6. THE MLTCND IS IN
*                              3 WORDS POINTED TO BY X. THE PRODUCT
*                              IS RETURNED IN A,B,X
       STA     NIO7
       BAC
       RCY     2
       MUL     0,2
       STA     NIO11
       LDA     1,2
       LRSH    2
       MUL     NIO7
       ADD     NIO11
       MUL     TWO
       STB     NIO11
       XMA     NIO7
       MUL     0,2
       XAB
       ADD     NIO11
       XAB
       ADC     NIO7
       STA     NIO1
       LDA     2,2
       ADD     NIO6
       CAX
       LDA     NIO1
       NOD     48
       R1       FDPMRIO
****** ROUND NUMBER FOR OUTPUT
RNDEXP LDA KM1
       BRU ROUND
RNDFI  CLA
* NIO8<0 FOR EXP. FORM, POS. FOR F-CONV. AND INTEGER
ROUND  STA NIO8 (SWITCH)
       C       OUTSET          CALCULATE WHICH DIGIT TO EXAMINE
       LDA     KM2
       SUB     IOD
       SKN     NIO8
       SUB     IODEXP
       CAX
       C GDIGIT              GET THE DIGIT TO BE EXAMINED
       BRX     *-1
       SKG FOUR            DETERMINE IF ROUNDING IS NECESSARY
       BRU     RND6
       LDA     IODEXP          CALCULATE HOW MUCH TO ADD TO NUMBER
       SKN     NIO8
       CLA
RND5   SUB     IOD
       SKE     ZERO
       BRU     RND2
       LDP     FONE
RND1   FAD     XWR3
RNDONE STP     NIO1
       C OUTSET (SCALE)

* NIO USES DEXP TO INDICATE DIGITS TO LEFT OF DEC. PT.  FIO USES
* IODEXP.

       ADD ONE (ADD 1 TO IODEXP)
       STA DEXP (CONVERT DEXP TO NIO'S DEXP

*              NUMBER          FIO(IODEXP)  NIO(DEXP)
*              100.            2            3
*              10.             1            2
*              1.              0            1
*              0.              0            1
*              0.1             -1           0
*              0.01            -2           -1
*              ETC.

       R1      RNDEXP
RND6   LDP     XWR3
       BRU     RNDONE
RND2   SKG     ZERO
       BRU     RND3
       CNA
       CAX
       LDP     FONE
       FMP     FTEN
       BRX     *-1
       BRU     RND1
RND3   CAX
       LDP     FONE
       FMP     TENTH
       BRX     *-1
       BRU     RND1

* CONSTANTS
*
RLIO8  DATA    24000000B
       DATA    00000000B
       DATA    0004B
RLIO9  DATA    31463146B
       DATA    31463146B
       DATA    -003B
FONE   DATA    20000000B
       DATA    00000001B
       NOLIST EXT
       END
EXEC ** FICHE/FRAME BREAK *****
NIO SYMSORT

SYM.  PG.LN. IDENT.

4CASE1 50 30 NIO002  4CASE2 50 31 NIO002  6CASE  51 16 NIO002  
ADJ1   54 18 NIO002  ADJUST 54  3 NIO002  ALLWEL 51 12 NIO002  ASIS1   7  3 NIO002  
ASIS23  7  8 NIO002  ASIS4   7 13 NIO002  ASISX   7 14 NIO002  BAKUP  12 29 NIO002  
BAKUP1 12 31 NIO002  BRSOUT 48 25 NIO002  C1TO2   5 10 NIO002  C1TO3   6 17 NIO002  
C1TO4   6 21 NIO002  C2TO1   3 39 NIO002  C2TO3   5 17 NIO002  C2TO4   6 38 NIO002  
C3TO2   4 36 NIO002  C3TO2A  4 39 NIO002  C3TO3   6  7 NIO002  C3TO4   6 25 NIO002  
C3TO4A  6 28 NIO002  C4TO1   3 38 NIO002  C4TO2   4 33 NIO002  C4TO3   5 16 NIO002  
C4TO4   6 35 NIO002  CARRY  20  3 NIO002  CARRY1 20  9 NIO002  CARRY2 20 15 NIO002  
CARRY3 20 21 NIO002  CARRY4 20 25 NIO002  CHAR1   9 30 NIO002  CHAR1A  9 39 NIO002  
CHAR2  10 11 NIO002  CHAR2A 10 13 NIO002  CHAR2B 10 24 NIO002  CHAR2C 10 35 NIO002  
CHOOSE 42  4 NIO002  CNVD1  54 12 NIO002  CNVDON 54  9 NIO002  COVTO3  5 34 NIO002  
DGTADD 24  7 NIO002  DOMULT 18 33 NIO002  DONE   44 11 NIO002  DONE2  44 19 NIO002  
DPINT  17 39 NIO002  DPINT1 18 11 NIO002  DPMR1  27 13 NIO002  DPMRIO 25 38 NIO002  
EBRS52  3  1 NIO002  EFMT   14 13 NIO002  ERR    49 29 NIO002  ERRE   45  1 NIO002  
ERRE0  45  5 NIO002  ERRF   44 23 NIO002  ERRF0  44 27 NIO002  ERRF1  44 35 NIO002  
ERRF2  44 37 NIO002  ERRSUB 52 30 NIO002  ERSTAR 45 19 NIO002  EXOUT  15 23 NIO002  
EXOUT1 15 38 NIO002  EXOVF1 16 16 NIO002  EXOVFL 16  6 NIO002  EXPADJ 15 17 NIO002  
EXPLOP 18 23 NIO002  EXPLP1 18 28 NIO002  EXPNT1 12  5 NIO002  EXPNT2 11 35 NIO002  
EXPONT 11 30 NIO002  EXPSUB 18 19 NIO002  EXPTS1 14 25 NIO002  EXPTS2 14 29 NIO002  
EXPTS3 15 10 NIO002  EXPTST 14 23 NIO002  EXUNFL 16 27 NIO002  FADJ   13 22 NIO002  
FDPMRI 54 25 NIO002  FEXPSU 19  1 NIO002  FFI    45 28 NIO002  FFIA   45 39 NIO002  
FFIA1  46 18 NIO002  FFIA11 46 15 NIO002  FFIA2  46 26 NIO002  FFIA3  47  1 NIO002  
FFIA4  47  9 NIO002  FFIAB  46  9 NIO002  FFIB   47 29 NIO002  FFIB1  47 31 NIO002  
FFIB2  48  4 NIO002  FFIC   47 15 NIO002  FFIC1  47 17 NIO002  FFMT   14  7 NIO002  
FFO    48 12 NIO002  FIOFMT 23 23 NIO002  FMT0   37 21 NIO002  FMT01  37 27 NIO002  
FMT02  38 23 NIO002  FMT04  38 10 NIO002  FMT1   38 34 NIO002  FMT2   39  1 NIO002  
FMT2A1 39 22 NIO002  FMT2A2 39 35 NIO002  FMT2A3 40  9 NIO002  FMT2A4 39 16 NIO002  
FMT2A5 39 19 NIO002  FMT2A6 39 21 NIO002  FMT2A7 40  6 NIO002  FMT2B1 40 23 NIO002  
FMT2C  40 30 NIO002  FMT3   41 13 NIO002  FMT3A1 42 23 NIO002  FMT3A2 42 29 NIO002  
FMT3C  42 31 NIO002  FMT3D  43  1 NIO002  FMT3E  43 10 NIO002  FMT3E1 43 18 NIO002  
FMT3V  42 12 NIO002  FMT3W  42  8 NIO002  FMT3X  41 27 NIO002  FMT3Y  42  9 NIO002  
FMT3Z  43 27 NIO002  FMT3Z1 43 32 NIO002  FMT3Z2 44  8 NIO002  FONE   57  5 NIO002  
FPOST  23 35 NIO002  FRACT  11  5 NIO002  FRACT1 11 18 NIO002  FRACT2 11 25 NIO002  
FRCTS1 13  6 NIO002  FRCTS2 13 13 NIO002  FRCTS3 13 15 NIO002  FRCTST 13  5 NIO002  
FSIC0   7 18 NIO002  FSIC1   7 22 NIO002  FSIC2   7 30 NIO002  FTEN   29  2 NIO002  
GDIG1  49  1 NIO002  GDIG2  49 23 NIO002  GDIGIT 48 31 NIO002  GETCHR 52 18 NIO002  
GETFMT 22  3 NIO002  GETMAX 51  4 NIO002  GOT4   22 30 NIO002  GTFMT1 22 21 NIO002  
GTFMT2 22 32 NIO002  HRDWAY 21 20 NIO002  I3OVFL  6 10 NIO002  ILGFMT 31 28 NIO002  
INTES1 16 34 NIO002  INTES2 17 23 NIO002  INTES4 17 16 NIO002  INTTES 16 32 NIO002  
IOECON 31 30 NIO002  IOFCON 31 23 NIO002  IOFREE 31  9 NIO002  IOICON 31 36 NIO002  
IOVFL   4 18 NIO002  ISCFA  33  4 NIO002  ISCFL2 32 37 NIO002  ISCFLN 32 34 NIO002  
ISCFLP 32 35 NIO002  ISCN    2  4 NIO002  ISCPOP  7 34 NIO002  ISCRD  35 16 NIO002  
ISCRDB 36 12 NIO002  ISCRDZ 37  1 NIO002  ISCS   29 35 NIO002  ISCS1  30 18 NIO002  
ISCSA  33 39 NIO002  ISCSB  34  5 NIO002  ISCSC  35  3 NIO002  ISCSC2 36  5 NIO002  
ISCSC3 35 32 NIO002  ISCSD  37 13 NIO002  ISCSDI 33 17 NIO002  ISCSEF 32 10 NIO002  
ISCSF1 33 32 NIO002  ISCSFF 32 13 NIO002  ISCSFL 32 23 NIO002  ISCSIC  2  8 NIO002  
ISCSSF 33 26 NIO002  ISCSSI 33  8 NIO002  MAKDOU 19 33 NIO002  MAKSIN 19 24 NIO002  
MINTBL 28 33 NIO002  NBS111 48 27 NIO002  NFNA1  50 17 NIO002  NIOFNA 49 39 NIO002  
NIOISC 30  5 NIO002  NOD72  21  1 NIO002  NODOT  52 24 NIO002  NOE    14 18 NIO002  
NTDPFL 30 33 NIO002  OS1    53 24 NIO002  OS2    53 29 NIO002  OUTSET 53 13 NIO002  
PLSTBL 28 28 NIO002  RLIO8  56 38 NIO002  RLIO9  57  2 NIO002  RND1   55 39 NIO002  
RND2   56 22 NIO002  RND3   56 30 NIO002  RND5   55 35 NIO002  RND6   56 20 NIO002  
RNDEXP 55 17 NIO002  RNDFI  55 19 NIO002  RNDONE 56  1 NIO002  RNDTBL 29  9 NIO002  
RNDVAL 29  7 NIO002  ROUND  55 21 NIO002  SCALE  34 25 NIO002  SENDDP 51 30 NIO002  
SET1    9  9 NIO002  SET1A   9  7 NIO002  SETCHR 20 34 NIO002  SETPTR 51 39 NIO002  
SIC1E   2 27 NIO002  SIC1W   1 20 NIO002  SICN    2  7 NIO002  SICOUT  7 15 NIO002  
SICS    8 14 NIO002  SMALLD 23 37 NIO002  SMALLE 23 38 NIO002  SPAD   25  9 NIO002  
SPCO2  52 11 NIO002  SPCOUT 52  8 NIO002  TENTH  29  3 NIO002  TESTSP 32 33 NIO002  
TO1OT   4 25 NIO002  TO2OT   5  3 NIO002  TO3OT   6  3 NIO002  TO4OT   6 29 NIO002  
TRPMUL 27 31 NIO002  UPDR   51 21 NIO002  
EXEC ** FICHE/FRAME BREAK *****
TS
TS93   IDENT   09/29/76
*
* THE TS PAGE STRUCTURE IS:
*    EXEC AND MONITOR SHARED WORDS.
*    SPACE
*    FILE BUFFERS
*    TSMAPS: MISC. USER ORIENTED CELLS SUCH AS A,B,X.
* AS OF 3/14/73 THE EXEC  CELLS STOPPED AT 34606.
*               THE FIRST BUFFER WAS AT 35016.
*               TSMAPS BEGINS AT ABOUT 37676.
* THE FIRST BUFFER LOCATION MAY BE FOUND IN I AT BUF3+3.

       DELSYM
1ORG   EQU     *
LOCORG MACRO D;2ORG EQU *-1ORG; BSS D(1)-2ORG; ENDM

$X     EQU     34000B

       LOCORG  2

       IF      -EXEC

$SBRSRT ZRO
$WR4   BSS     30
$OUTNO1 ZRO
$OUTNO2 ZRO
$OUTNO3 ZRO
$OUTNO4 ZRO
$OUTNO5 ZRO
GSIN1  EXT     OUTNO1
GSIN2  EXT     OUTNO2
GSIN3  EXT     OUTNO3
STRO1  EXT     OUTNO1
STRO2  EXT     OUTNO2
STRO21 EXT     OUTNO3
STRO3  EXT     OUTNO4
GETNO1 EXT     OUTNO1
GETNO2 EXT     OUTNO2
GETNO3 EXT     OUTNO3
GETNO7 EXT     OUTNO5
$WR1   ZRO
$WR2   ZRO
$WR3   ZRO
$WR31  ZRO
$WR5   ZRO
$WR6   ZRO
$WR7   ZRO
$WR8   ZRO
$WR9   ZRO
$WR10  ZRO
$WR11  ZRO
$WR12  ZRO
$WR13  ZRO
       BSS     2               USED BY EXEC
$UPL   ZRO     0    EXEC BRS PANIC TABLE.
$UBA   ZRO
$UBB   ZRO
$UBX   ZRO
$UBRL1 ZRO
$UBRL2 ZRO
$UBE   ZRO
$UCIN  ZRO
$UCOUT ZRO
$UUNO  ZRO
       ZRO

       LOCORG  105B

$EXRL1 ZRO 0                   (FIRST HALF OF EXEC RELABELING)
$EXRL2 ZRO 0                   (2ND HALF OF " ")
$UPRRL1 ZRO 0                  (1ST HALF OF PROG. RELABELING)
$UPRRL2 ZRO 0                  (2ND HALF OF " ")
$SSRL1 ZRO 0                   (FIRST HALF OF SUBSYSTEM RELABELING)
$SSRL2 ZRO 0                   (2ND HALF OF " ")
$UREAL ZRO 0                   (NO. OF CLOCK TICS AT LOGIN)
$EXECL BSS     6    EXEC PANIC TABLE.
$UEXL6 ZRO
$EXECLM EQU    EXECL-34000B
$ERCODE ZRO

       ELSF    1

       ZRO
$XWR4  BSS     30
XWR41  EXT     XWR4+1
XWR42  EXT     XWR4+2
XWR43  EXT     XWR4+3
XWR44  EXT     XWR4+4
XWR45  EXT     XWR4+5
XWR46  EXT     XWR4+6
XWR47  EXT     XWR4+7
XWR4E  EXT     XWR47+1
XWR4E8 EXT     XWR4E+8         FOR 8 RESOURCES
       BSS     5
$XWR1  ZRO
$XWR2  ZRO
$XWR3  ZRO
$XWR31 ZRO
T1     ZRO
T2     ZRO
T3     ZRO
T4     ZRO
T5     ZRO
T6     ZRO
T7     ZRO
T8     ZRO
T9     ZRO
T10    ZRO
T11    ZRO
$UBRSRT ZRO    0               REFERENCE FOR XT1-11 SEE AF
$BASE  BSS 0
$UA    ZRO
$UB    ZRO
$UX    ZRO
$CMRL1 ZRO
$CMRL2 ZRO
$UE    ZRO
$CIN   ZRO
$COUT  ZRO
$UNO   ZRO
$MSW   ZRO

       LOCORG  105B

$EXRL1 ZRO
$EXRL2 ZRO
$PRGRL1 ZRO
$PRGRL2 ZRO
$SSRL1 ZRO
$SSRL2 ZRO
$UREAL ZRO
$EXECL ZRO
$EXECA ZRO
$EXECB ZRO
$EXECX ZRO
$EXECR BSS     2
$EXECL6 ZRO
$ERCODE ZRO


EXRL   EXT     EXRL1
PRGRL  EXT     PRGRL1
SSRL   EXT     SSRL1
$REMAC ZRO 0                   (ACCT FOR COMMANDS FILE REMOTE LICENSE)
$ANO   ZRO 0                   (ACCT NO)
$FDLUDL ZRO 0                  (FILE DIRECTORY LUD LOCATOR)
$LUDL  ZRO     0               LUD LOCATER FOR THIS USER (SAME WERIS)
$FDUN  ZRO 0                   (FILE DIRECTORY USER NO)
$GRU   ZRO 0                   (CURRENT GROUP NO)
$NGRP  ZRO 0                   (NO. OF GROUPS)
$CR3   ZRO
$LUDWD5 ZRO
$UDMIN  ZRO
$MSZ2 BSS 1 (FORCE EXIT IF NON-NEGATIVE--CHECKED AT CRA)
$LDTEMP ZRO    0               STORAGE FOR DISC. BUF. LOCATION
$SW60  ZRO     0               BRS 48/60 SW., NEG. IF 48/60
$SWPRP ZRO     0               PROPRIETARY FILE SW.
$BRKTBL ZRO    0               BRKTBL FOR EXEC BRS'S
$FDAN  ZRO     0               FILE DIR. ACCT. NO.
$SWINIT ZRO    0               INITIAL COMMANDS-FROM FILE SW.
$AFSV4 ZRO     0               (TERMINAL ID)
$UNM   BSS     2               (USER NAME AT LOGIN (ASCII--NEXT 4 LOCS))
$UNM2  BSS     2
$UNMP  ZRO
$UNMP1 ZRO
$UNMPCF EQU    3*UNM-3*XWR1
$AFSV5 ZRO
$NMCHX ZRO
$ERRSW ZRO
$SWOFF BSS 1 (POSITIVE IF USER HAS BEEN ZAPPED AND OFFINT BEING DONE)
$SWTM  ZRO
$PJ    BSS     4
$EPJ   EQU     *
$FLPOS ZRO 0                   (FILE POS. NO. IN DIRECTORY)
$FLX   ZRO 0                   (FILE DIR. INDEX PTR)
$GRCT  ZRO 0                   (GROUP NO. OF LAST FILE ACCESSED)
$CMND  ZRO 0                   (BRS 142 EXEC COMMAND - 3 CHARS)
$GRP   ZRO 0                   (CURRENT FILE DIR. GROUP NO.)
$GAN   ZRO 0                   (GAN OF LAST FILE DIR. ACCESSED)
$OPDSTR ZRO 0                  (DISTRICT SET BY DS COMMAND)
$EBASE EQU     *
T12    ZRO
T13    ZRO
T14    ZRO
$TLV0  ZRO     0               ( MAX. ADR. 177B)

       LOCORG  210B

$DBF   BSS     128
$EDBF  EQU     *
$OVFP  EQU     DBF+124
$LFADR EQU     OVFP-2
$OVFP1 EQU     OVFP+1
$OVFP2 EQU     OVFP+2
$MTIME EQU     OVFP+3

$FDCONT ZRO
$SSTIME ZRO
$SSID  ZRO
$INFIL ZRO
ECRFIL EXT     INFIL
$OUTFIL ZRO
ECDFIL EXT     OUTFIL
$PVTSW ZRO
$OPNCN ZRO
$LETP  ZRO
$LGRS  ZRO
$RSREAL ZRO    0               FIRST RESOURCE STORAGE
$RSEND BES     7



* PANIC TABLES FOR EXEC FORKS

$EXSL  ZRO     0    PANIC TABLE FOR 'FILE' FORKS.
$EXSA  ZRO     0
$EXSB  ZRO     0
$EXSX  ZRO     0
$EXSR1 ZRO     0
$EXSR2 ZRO     0
$EXSM  ZRO     0
$SSL   ZRO     0    PANIC TABLE FOR GO, DUMP.
$SSA   ZRO     0
$SSB   ZRO     0
$SSX   ZRO     0
$SSR1  ZRO     0
$SSR2  ZRO     0
$SSM   ZRO     0
$GETSTL ZRO
$SYSTL ZRO

*EXEC TEMP. STORAGE
$TLV1  ZRO
$TLV11 ZRO
$TLV2  ZRO
$TLV21 ZRO
$TLV22 ZRO
$TLV23 ZRO
$TLV3  ZRO


* WORKING SPACE FOR EXEC BRS'S


GFN1   EXT     T10
$GOFNFT ZRO
FN2    EXT     T3
$UNPTR BSS     2
UNPTR1 EXT     UNPTR+1
$FNPTR BSS     2
FNPTR1 EXT     FNPTR+1
$GETPL ZRO     0
DEL1   EXT     T1
DEL2   EXT     T2
DEL3   EXT     T3
$UNO1  ZRO     0
DUMP1  EXT     T8
ECDMP6 EXT     T12
ECRV6  EXT     T12
DRSW9  EXT     T3
$GBIOPT ZRO    0
$GBIOFN ZRO    0
$GBIOSW ZRO    0
$GBIO2 ZRO     0
$GBIOCR ZRO    0
$GBIOC2 ZRO    0

$GBIO4 ZRO     0
* DO NOT REORDER DOWN TO SUSR2 WITHOUT MODIFYING NIO EXTERNALS

$GET1  ZRO
$GET2  ZRO
$GET3  ZRO
$GET4  ZRO
ZYEAR  EXT     GET4
$GET5  ZRO
ZMONTH EXT     GET5
$GET6  ZRO
ZDAY   EXT     GET6
$GETFN ZRO
ZHOUR  EXT     GETFN
$SUSR2 ZRO
ZMIN   EXT     SUSR2

$SUSR3 ZRO
ZSEC   EXT     SUSR3
$SRSU20 ZRO
ZMS    EXT     SRSU20
$SRSU21 ZRO
$SRSU3 ZRO
$SAVELL ZRO    0
$SAVEFL ZRO    0
$SAVEOR ZRO    0
$SAVESL ZRO    0

$MFFLAG BSS 1 (USED BY NIO)
DPFG2  EXT     MFFLAG

COPY1  EXT     SAVELL
COPYT  EXT     SAVESL
$SW58  ZRO     0               DOING BRS 58 (RENAME A FILE) IF NEG.
$PJCSW ZRO     0               PJC SW IF NOT ZERO HAS LUDL FOR PJC

*FOLLOWING 5 USED CHIEFLY BY NIO.  SEE MSGT POP.

$FIOW BSS 1 (NIO TEMP)
$DGTCNT BSS 1 (COUNT OF DIGITS TO OUTPUT)
$POST BSS 1 (POS.-> LEFT JUSTIFIED NO., POST BLANKS)
$IOD BSS 1 (DIGITS AFTER DEC POINT SPEC.)
$ERRNUM BSS 1 (NIO ERROR CODE)

*      PUSHDOWN STACK
$PDP   ZRO
$PDC   ZRO
$PDL   BSS     9


$S1    BSS 5 (USED BY BRS 1 CODE)
S2     EXT S1+1
FDNO   EXT S1+2
S4     EXT S1+3
S5     EXT S1+4
$RLSW  BSS 1 (SEE GTXFD CODE)
$DP    BSS 1 (DESIRED BUFFER IN PAGE 22)
$FDCBX BSS 1 (FDCBLE INDEX)
$FDCBT BSS 1 (TEMP)
$CHGFLG BSS 1 (BUFFER CHANGED FLAG)
$RLV4  ZRO
$TLV4  ZRO
$DSTRCT ZRO 0                  DISTRICT NO. FROM LUD ON NEW FILE
$NAST  ZRO 0                   (NASTY SWITCH TO FORCE KICKOFF)
*FOLLOWING 2 LOCS. NOT NECESSARY IF LUD IS READ FOR PROJ. COM.
$AFSV6 ZRO
$AFSV7 ZRO
$SXWR31 ZRO
$GOREMA ZRO
$OPTM  ZRO     0               TIME CONTROL OF OPERATOR STATUS
$TUZN  ZRO     0               USED BY CDX IN AF FOR TEMP STOR UZONE
$TCZN  ZRO

XT1    EXT     T1
XT2    EXT     T2
XT3    EXT     T3
XT4    EXT     T4
XT5    EXT     T5
XT6    EXT     T6
XT7    EXT     T7
XT8    EXT     T8
XT9    EXT     T9
XT10   EXT     T10
XT11   EXT     T11
XT12   EXT     T12
XT13   EXT     T13
XT14   EXT     T14
XT15   EXT     FIOW
XT16   EXT     DGTCNT
XT17   EXT     POST
XT18   EXT     IOD
XT19   EXT     ERRNUM
$XTE   ZRO     0
$SGOREM BSS 1 (SAVED "GO" REMOTE ACCT)
$SREMAC BSS 1 (SAVED "COMMANDS" REMOTE ACCT)
$BUDGET BSS 1 (BUDGETED CPU SECONDS FROM LUD WORD 5)

* NIO EXTERNALS 11/14/73

OVFLFG EXT XWR4+33 (CONVERSION OVERFLOW)
IOW EXT T4 (FIELD WIDTH SPEC)
IOFMT EXT T5 (FORMAT SPECIFICATION)
DEXP EXT T6 (DECIMAL EXPONENT)
IODEXP EXT T7 (BINARY EXPONENT)
SIGN EXT T8 (FLAG FOR SIGN OF FRACTIONAL PART)
NCONV EXT T9 (TEMP)
IOFILE EXT T11 (FILE NO. FOR BRS 52,53)
NIO1 EXT T12 (1ST WORD OF D'E P'N ACCUMULATOR)
NIO2 EXT T13 (2ND  "  )
NIO3 EXT T14 (3RD  "  )
NIO4 EXT TLV1
NIO5 EXT TLV2
NIO6 EXT TLV21
NIO7 EXT TLV22
NIO8 EXT TLV23
NIO9 EXT TLV3
IOPTR EXT FNPTR
IOPTR1 EXT FNPTR1
* FLAGS CLEARED IN BRX LOOP
NODOTFG EXT GET1 (FLAG TO SUPRESS DEC. PT)
DPFG EXT GET2 (DOUBLE PREC FLAG)
FMT4FG EXT GET3 (NIO FORMAT 4 FLAG)
OVFL EXT GET4 (ASTERISK OVERFLOW ACTION FLAG)
SD EXT GET5 (SMALL D)
SE EXT GET6 (SMALL E)
BD EXT GETFN (BIG D)
NFLAGE EXT SUSR2 (END OF FLAGS CLEARED IN BRX LOOP)
NIO10 EXT SAVELL
NIO11 EXT SAVEFL
NIO12 EXT SAVEOR
DPFLAG EXT SAVESL
ODOTFG EXT GBIO2 (USED TO PUT OUT .)
SIGNEX EXT RLV4 (SIGN OF EXPONENT FLAG)
SHRTRM EXT TLV4 (FLAG USED TO SHORT TERMINATE SIC)

       ENDF

       LOCORG  600B
$LMCPU ZRO
$SVST  ZRO     0               SUPERVISOR START IF NEG.

$RPCHG ZRO
$RPMAX ZRO
$RPN   ZRO
$UZONE ZRO
$UEXFLG BSS 0
$EXFLAG ZRO
$UFIO BSS 0
$FIO BSS 1 (-1 FOR NIO, POS. FOR FIO)
$TSVER BSS 1 (SPACE FOR TS VERIFICATION WORD)
$SCHDLY BSS 1 (SCHEDULER DELAY PARAMETER)
       IF CEM
$CVSW  DATA 0 (CONTROL V SWITCH)
$CRSW  DATA -1 (NEG. UNTIL 1ST TIME THRU CR)
$TLCNR DATA -1 (LINE BUFFER CHAR COUNT)
$TLBUF DATA 0 (LINE BUFFER)
 BSS 42
 ENDF

       IF      -EXEC

       FORGET
       ENDF

       END
EXEC ** FICHE/FRAME BREAK *****
TS SYMSORT

SYM.  PG.LN. IDENT.

1ORG    1 14 TS93    AFSV4   5  5 TS93    AFSV5   5 11 TS93    
AFSV6   9 21 TS93    AFSV7   9 22 TS93    ANO     4 28 TS93    BASE    3 33 TS93    
BD     11  3 TS93    BRKTBL  5  2 TS93    BUDGET 10 12 TS93    CHGFLG  9 15 TS93    
CIN     4  1 TS93    CMND    5 21 TS93    CMRL1   3 37 TS93    CMRL2   3 38 TS93    
COPY1   8 26 TS93    COPYT   8 27 TS93    COUT    4  2 TS93    CR3     4 34 TS93    
CRSW   11 31 TS93    CVSW   11 30 TS93    DBF     5 33 TS93    DEL1    7 19 TS93    
DEL2    7 20 TS93    DEL3    7 21 TS93    DEXP   10 19 TS93    DGTCNT  8 34 TS93    
DP      9 12 TS93    DPFG   10 37 TS93    DPFG2   8 24 TS93    DPFLAG 11  8 TS93    
DRSW9   7 26 TS93    DSTRCT  9 18 TS93    DUMP1   7 23 TS93    EBASE   5 25 TS93    
ECDFIL  6  8 TS93    ECDMP6  7 24 TS93    ECRFIL  6  6 TS93    ECRV6   7 25 TS93    
EDBF    5 34 TS93    EPJ     5 17 TS93    ERCODE  4 21 TS93    ERCODE  3  1 TS93    
ERRNUM  8 37 TS93    ERRSW   5 13 TS93    EXECA   4 16 TS93    EXECB   4 17 TS93    
EXECL   4 15 TS93    EXECL   2 37 TS93    EXECL6  4 20 TS93    EXECLM  2 39 TS93    
EXECR   4 19 TS93    EXECX   4 18 TS93    EXFLAG 11 24 TS93    EXRL    4 24 TS93    
EXRL1   4  8 TS93    EXRL1   2 30 TS93    EXRL2   4  9 TS93    EXRL2   2 31 TS93    
EXSA    6 21 TS93    EXSB    6 22 TS93    EXSL    6 20 TS93    EXSM    6 26 TS93    
EXSR1   6 24 TS93    EXSR2   6 25 TS93    EXSX    6 23 TS93    FDAN    5  3 TS93    
FDCBT   9 14 TS93    FDCBX   9 13 TS93    FDCONT  6  2 TS93    FDLUDL  4 29 TS93    
FDNO    9  8 TS93    FDUN    4 31 TS93    FIO    11 26 TS93    FIOW    8 33 TS93    
FLPOS   5 18 TS93    FLX     5 19 TS93    FMT4FG 10 38 TS93    FN2     7 13 TS93    
FNPTR   7 16 TS93    FNPTR1  7 17 TS93    GAN     5 23 TS93    GBIO2   7 30 TS93    
GBIO4   7 34 TS93    GBIOC2  7 32 TS93    GBIOCR  7 31 TS93    GBIOFN  7 28 TS93    
GBIOPT  7 27 TS93    GBIOSW  7 29 TS93    GET1    7 37 TS93    GET2    7 38 TS93    
GET3    7 39 TS93    GET4    8  1 TS93    GET5    8  3 TS93    GET6    8  5 TS93    
GETFN   8  7 TS93    GETNO1  1 37 TS93    GETNO2  1 38 TS93    GETNO3  1 39 TS93    
GETNO7  2  1 TS93    GETPL   7 18 TS93    GETSTL  6 34 TS93    GFN1    7 11 TS93    
GOFNFT  7 12 TS93    GOREMA  9 24 TS93    GRCT    5 20 TS93    GRP     5 22 TS93    
GRU     4 32 TS93    GSIN1   1 30 TS93    GSIN2   1 31 TS93    GSIN3   1 32 TS93    
INFIL   6  5 TS93    IOD     8 36 TS93    IODEXP 10 20 TS93    IOFILE 10 23 TS93    
IOFMT  10 18 TS93    IOPTR  10 33 TS93    IOPTR1 10 34 TS93    IOW    10 17 TS93    
LDTEMP  4 38 TS93    LETP    6 11 TS93    LFADR   5 36 TS93    LGRS    6 12 TS93    
LMCPU  11 16 TS93    LOCORG  1 15 TS93    LUDL    4 30 TS93    LUDWD5  4 35 TS93    
MFFLAG  8 23 TS93    MSW     4  4 TS93    MSZ2    4 37 TS93    MTIME   5 39 TS93    
NAST    9 19 TS93    NCONV  10 22 TS93    NFLAGE 11  4 TS93    NGRP    4 33 TS93    
NIO1   10 24 TS93    NIO10  11  5 TS93    NIO11  11  6 TS93    NIO12  11  7 TS93    
NIO2   10 25 TS93    NIO3   10 26 TS93    NIO4   10 27 TS93    NIO5   10 28 TS93    
NIO6   10 29 TS93    NIO7   10 30 TS93    NIO8   10 31 TS93    NIO9   10 32 TS93    
NMCHX   5 12 TS93    NODOTF 10 36 TS93    ODOTFG 11  9 TS93    OPDSTR  5 24 TS93    
OPNCN   6 10 TS93    OPTM    9 25 TS93    OUTFIL  6  7 TS93    OUTNO1  1 25 TS93    
OUTNO2  1 26 TS93    OUTNO3  1 27 TS93    OUTNO4  1 28 TS93    OUTNO5  1 29 TS93    
OVFL   10 39 TS93    OVFLFG 10 16 TS93    OVFP    5 35 TS93    OVFP1   5 37 TS93    
OVFP2   5 38 TS93    PDC     9  2 TS93    PDL     9  3 TS93    PDP     9  1 TS93    
PJ      5 16 TS93    PJCSW   8 29 TS93    POST    8 35 TS93    PRGRL   4 25 TS93    
PRGRL1  4 10 TS93    PRGRL2  4 11 TS93    PVTSW   6  9 TS93    REMAC   4 27 TS93    
RLSW    9 11 TS93    RLV4    9 16 TS93    RPCHG  11 19 TS93    RPMAX  11 20 TS93    
RPN    11 21 TS93    RSEND   6 14 TS93    RSREAL  6 13 TS93    S1      9  6 TS93    
S2      9  7 TS93    S4      9  9 TS93    S5      9 10 TS93    SAVEFL  8 19 TS93    
SAVELL  8 18 TS93    SAVEOR  8 20 TS93    SAVESL  8 21 TS93    SBRSRT  1 23 TS93    
SCHDLY 11 28 TS93    SD     11  1 TS93    SE     11  2 TS93    SGOREM 10 10 TS93    
SHRTRM 11 11 TS93    SIGN   10 21 TS93    SIGNEX 11 10 TS93    SREMAC 10 11 TS93    
SRSU20  8 14 TS93    SRSU21  8 16 TS93    SRSU3   8 17 TS93    SSA     6 28 TS93    
SSB     6 29 TS93    SSID    6  4 TS93    SSL     6 27 TS93    SSM     6 33 TS93    
SSR1    6 31 TS93    SSR2    6 32 TS93    SSRL    4 26 TS93    SSRL1   4 12 TS93    
SSRL1   2 34 TS93    SSRL2   4 13 TS93    SSRL2   2 35 TS93    SSTIME  6  3 TS93    
SSX     6 30 TS93    STRO1   1 33 TS93    STRO2   1 34 TS93    STRO21  1 35 TS93    
STRO3   1 36 TS93    SUSR2   8  9 TS93    SUSR3   8 12 TS93    SVST   11 17 TS93    
SW58    8 28 TS93    SW60    4 39 TS93    SWINIT  5  4 TS93    SWOFF   5 14 TS93    
SWPRP   5  1 TS93    SWTM    5 15 TS93    SXWR31  9 23 TS93    SYSTL   6 35 TS93    
T1      3 21 TS93    T10     3 30 TS93    T11     3 31 TS93    T12     5 26 TS93    
T13     5 27 TS93    T14     5 28 TS93    T2      3 22 TS93    T3      3 23 TS93    
T4      3 24 TS93    T5      3 25 TS93    T6      3 26 TS93    T7      3 27 TS93    
T8      3 28 TS93    T9      3 29 TS93    TCZN    9 27 TS93    TLBUF  11 33 TS93    
TLCNR  11 32 TS93    TLV0    5 29 TS93    TLV1    6 38 TS93    TLV11   6 39 TS93    
TLV2    7  1 TS93    TLV21   7  2 TS93    TLV22   7  3 TS93    TLV23   7  4 TS93    
TLV3    7  5 TS93    TLV4    9 17 TS93    TSVER  11 27 TS93    TUZN    9 26 TS93    
UA      3 34 TS93    UB      3 35 TS93    UBA     2 17 TS93    UBB     2 18 TS93    
UBE     2 22 TS93    UBRL1   2 20 TS93    UBRL2   2 21 TS93    UBRSRT  3 32 TS93    
UBX     2 19 TS93    UCIN    2 23 TS93    UCOUT   2 24 TS93    UDMIN   4 36 TS93    
UE      3 39 TS93    UEXFLG 11 23 TS93    UEXL6   2 38 TS93    UFIO   11 25 TS93    
UNM     5  6 TS93    UNM2    5  7 TS93    UNMP    5  8 TS93    UNMP1   5  9 TS93    
UNMPCF  5 10 TS93    UNO     4  3 TS93    UNO1    7 22 TS93    UNPTR   7 14 TS93    
UNPTR1  7 15 TS93    UPL     2 16 TS93    UPRRL1  2 32 TS93    UPRRL2  2 33 TS93    
UREAL   4 14 TS93    UREAL   2 36 TS93    UUNO    2 25 TS93    UX      3 36 TS93    
UZONE  11 22 TS93    WR1     2  2 TS93    WR10    2 11 TS93    WR11    2 12 TS93    
WR12    2 13 TS93    WR13    2 14 TS93    WR2     2  3 TS93    WR3     2  4 TS93    
WR31    2  5 TS93    WR4     1 24 TS93    WR5     2  6 TS93    WR6     2  7 TS93    
WR7     2  8 TS93    WR8     2  9 TS93    WR9     2 10 TS93    X       1 17 TS93    
XT1     9 29 TS93    XT10    9 38 TS93    XT11    9 39 TS93    XT12   10  1 TS93    
XT13   10  2 TS93    XT14   10  3 TS93    XT15   10  4 TS93    XT16   10  5 TS93    
XT17   10  6 TS93    XT18   10  7 TS93    XT19   10  8 TS93    XT2     9 30 TS93    
XT3     9 31 TS93    XT4     9 32 TS93    XT5     9 33 TS93    XT6     9 34 TS93    
XT7     9 35 TS93    XT8     9 36 TS93    XT9     9 37 TS93    XTE    10  9 TS93    
XWR1    3 17 TS93    XWR2    3 18 TS93    XWR3    3 19 TS93    XWR31   3 20 TS93    
XWR4    3  6 TS93    XWR41   3  7 TS93    XWR42   3  8 TS93    XWR43   3  9 TS93    
XWR44   3 10 TS93    XWR45   3 11 TS93    XWR46   3 12 TS93    XWR47   3 13 TS93    
XWR4E   3 14 TS93    XWR4E8  3 15 TS93    ZDAY    8  6 TS93    ZHOUR   8  8 TS93    
ZMIN    8 10 TS93    ZMONTH  8  4 TS93    ZMS     8 15 TS93    ZSEC    8 13 TS93    
ZYEAR   8  2 TS93    
EXEC ** FICHE/FRAME BREAK *****
ASM
NARP
KX
CON
GS
G


CON
CM
C


CON
EX
X


CON
MB
BMB


CON
AF
A


CON
TS
BTS



CON
IN
INB


CON
FS
BFS


CON
NIO
BN


COM BLD
EXEC ** FICHE/FRAME BREAK *****
BLD
RES
XDDT
0;YBTS
4000;YBS
EXSMT;KPMT;K
10000;TG
;F<1P>1P\1P+1
14000;TC
;F<2P>2P\2P+1
20000;TX
;F<3P>3P\3P+1
24000;TBMB
;F<4P>4P\4P+1
30000;YBN
30000,33777;Z
30000;YBFS
30000,33777;Z
30000;TA
;F<5P>5P\5P+1
33000;TINB
;F<6P>6P\6P+1
102@<C>101@<MSET>103@<TCF>104@<ER>536@<SKNE>
%QSAV 10000 T 33777 O E

CON
30000,33777;Z
30000;YBFS
;U%QSAV 30000 TO 33777 ON EFS

CON
30000,33777;Z
30000;YBN
;U%QSAV 30000 T 33777 O NI

CON
;Z
UEXFLG;K
EXFLAG;K
%Q
DUM ES

COM TEL
   1}l3
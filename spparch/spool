SPOOL ** FICHE/FRAME BREAK *****
SPACC
ACC    IDENT   ACCOUNTING      FEB 27,1976

SLAVE  EQU     -1              1=PJ SLAVE, -1=ACCOUNTING PACKAGE
RECLEN EQU     28
DEBUG  EQU     -1              1=USE SPOOL DIR, -1 FOR *4ACCT

*      5.24 CHANGES DISTRICT FOR BELGIUM FROM 77 TO AREA 3
ASCP   MACRO   D
X      NCHR   D(1)
       DATA    [*+2]*3-1,**3+X
       ASC     D(1)
       ENDM

SKNE   OPD     536B5
SPTR   OPD     514B5

       IF      SLAVE
L240   BRU     START
       ENDF

       IF      SLAVE
       
CKBUSY EXT
ERROR  POPD    105B5
       BRU     ERROR
RET    OPD     51B5,2
DISABL POPD    176B5
       BRR     0
NNNN   POPD    110B5
       BRR     0
ENABLE POPD    177B5
       BRR     0
       ELSE
ERROR  OPD     105B5
RET    OPD     514B4,2
       ENDF
REMJOB EQU     4B4

       IF      SLAVE
START  LDX     =-1
       LDA     =42B6+400B
       BRS     12
       CLA
       LDX     =-4
       ADD     =1
       CIO     =1
       BRX     *-2
ST     CLA
       STA     T
       LDX     =-4
ST1    MIN     T
       CIO     =0
       SKE     T
       BRU     ST
       BRX     ST1
*                              END OF HANDSHAKE
CMD    CIO     =0
       SKG     =CMDTE-CMDT
       CAX
       SKG     =CMDTE-CMDT
       BRU*    CMDT,2
       BRU     CMD
ERROR  LDA     =11B
       CIO     =1
       BRS     17
       BRU     CMD
P      BRM     RWD
       STA     RQSN
       BRM     RWD
       STA     DC
       SBRM    GREC
       LDA     BRNO
       SKE     RQSN
       BRU     ERROR
       LDA     JBSTA
       SKA     =4B7
       BRU     P1
       BRM   P::ACC
       SBRM    CMPJB
P1     LDA     =10B
       CIO     =1
       BRU     CMD
Q      BRS     17
       LDA     =12B
       CIO     =1
       BRS     10

RWD    ZRO
       CIO     =0
       CLB
       LSH     16
       STA     T
       CIO     =0
       LSH     8
       ADM     T
       CIO     =0
       MRG     T
       BRR     RWD

       ELSE
ERROR  ERROR   BF
P::ACC EXT
       ENDF


*
*      THIS I
*      THIS IMPLEMENTED IN V 5.00 OF SPOOOL FOR NEW BATCH FORMAT
*

P::ACC NOP     RT7
       LDA =1; LDB JBSTA; SKB =REMJOB; LDA =9; MRG =10000B
       STA     :JBTYP
       LDP     BUSN            ; STP    :USN
       LDP     BUSN+2          ; STP    :USN+2
       LDA     GAN             ; STA    :GAN
       LDA     UUN             ; STA    :UUN
       LDA DATE; CLB; LDX =3000100B; BRS 176; STA :DE
       LDP     PJC             ; STP    :PJC
       LDP     PJC+2           ; STP    :PJC+2
       LDA     BRNO            ; STA    :JOBNO
       LDP     USN             ; STP    :RB
       LDP     USN+2           ; STP    :RB+2
       CLB; LDA CHARK; MUL =1000; RSH 1; STB :NCHR
       LDA     PAGES           ; STA    :VOL
       LDB =1; LDA PARTS; SKA =2B7; LDB =2; ETR =7777777B
       STA :NPAR; STB :NDEC
       LDA     F3
       IF      DEBUG
       ADD =9; STA SYSPTR; STA SYSPTR+1
       ADD =6; STA MONPTR; STA MONPTR+1
       ELSE
       ADD =8; STA SYSPTR; STA SYSPTR+1
       ADD =6; STA MONPTR; STA MONPTR+1
       ENDF
       LDA =BUF; LDB =200B; LDX =100B; BRS 124
       LDA BUF+75B; LRSH 12; STA :HOST
       CLB; LRSH 23; DIV =100; ADD =20B; WCI SYSPTR
       COPY BA,B; LRSH 23; DIV =10; ADD =20B; WCI SYSPTR
       COPY BA; ADD =20B; WCI SYSPTR
       LDA =-1; LDX =200020B; BRS 176; ABC; LSH 4; CLA; LSH 4; CLB; ADD =1
       LRSH 23
       DIV =10; ADD =20B; WCI MONPTR; CBA; ADD =20B; WCI MONPTR
       CLA; STA :CMPF
       LDA     JBSTA
       SKA     =1B5
       BRU     FINAL           NO POSTAGE
       SKA     =REMJOB
       BRM     POSTOT
       LDA =1; STA :CMPF
TEMP   CLA
       STA     BADFCT
       LDA     JBSTA
       SKA     =REMJOB
       BRU     *+3
       LDP     F1
       BRU     *+2
       LDP     F1R             REMOTE
       MRG     =506B5
       LDX     =2
       BRS     65
       BRU     TEMP1           COULD NOT OPEN FIRST FILE
TEMP2  STA     AF
       RSP     AF
       MRG     =4B7            MAKE IT WRITE AT END
       SCP     AF
       BRU     ERROR           ACCOUNTING FILE BAD
       LDA     =RECLEN
       LDX     =:JBTYP
       BIO     AF
       BRU     ERROR
       LDA     AF
       BRS     20
       RET     P::ACC
TEMP1  BRM     CKBUSY
       MIN     BADFCT          BAD FILE COUNT
       LDA     JBSTA
       SKA     =REMJOB
       BRU     *+3
       LDP     F2
       BRU     *+2
       LDP     F2R
       MRG     =506B5
       LDX     =2
       BRS     65
       BRU     *+2
       BRU     TEMP2
       BRM     CKBUSY
       MIN     BADFCT
       CLA
       XMA     BADFCT
       SKNE    =2
       BRU     TEMP3
       BRS     45              WAIT A SEC(OR THREE)
       BRU     TEMP
TEMP3  BRU     ERROR           ACCOUNTING FILE BAD

FINAL  BRM     POSTOT          POST TOTALS
       LDA     =2
       XMA     :CMPF           TOTALS ARE CORRECT
       SKG     =1
       BRU     *+2
       BRU     TEMP            IF .GT. 1 THEN MUST GO TO TEMP FILE
FINAL0 LDP     F3
       BRS     48
       BRU     FINAL1
       LDP     F3
       MRG     =506B5
       LDX     =2
       BRS     65
       BRU     FINAL1
       STA     AF
       RSP     AF
       MRG     =4B7
       SCP     AF
       BRU     FINAL2          CANNOT SET CURSOR POSITION
       LDA     =RECLEN
       LDX     =:JBTYP
       BIO     AF
       BRU     FINAL2          OR WRITE RECORD
       CLA; SCP AF; BRU FINAL2; LDA =RECLEN; LDX =BUF; BIO AF; BRU FINAL2
       BRM ADDMTD
       LDA =4B7; SCP AF; BRU FINAL2; LDA =RECLEN; LDX =BUF; BIO AF; BRU FINAL2
       LDA     AF
       BRS     20
       RET     P::ACC
FINAL1 BRM     CKBUSY
       BRU     TEMP
       BRU     FINAL0
FINAL2 BRU     TEMP


*
*      ADDS TO RECORD 1 OF MONTH FILE AND PUTS IT BACK
*
ADDMTD ZRO
       CLA; STA BUF+25; STA :JBTYP+25    (ZERO CURRENCY USED)
       LDX =-8; LDA :JBTYP+27,2; ADM BUF+27,2; BRX *-2; BRR ADDMTD
POSTOT ZRO
       BRR     POSTOT

*      CHECK FI FILE IS BUSY

CKBUSY ZRO
       CXA
       SKE     =1
       SKNE    =30
       MIN     CKBUSY
       SKE     =34
       SKNE    =84
       MIN     CKBUSY
       BRR     CKBUSY


:JBTYP ZRO 0                   TRANACTION CODE/ JOB TYPE
:USN   BSS     4               USER NAME (12 CHAR MAX)
:GAN   ZRO 0                   GAN
:UUN   ZRO 0                   UUN (6)
:HOST  ZRO 0                   HOST (7)
:DE    ZRO 0                   DE (8) DATE ENTERED
:PJC   BSS 4                   PROJECT CODE (9,10,11,12)
:JOBNO ZRO 0                   JOB REQ NUMBER
:RB    BSS 4                   REQUESTED BY (14,15,15,17)
*********
* THESES ARE ONLY USED IN CERTAIN AREAS

:NCHR  ZRO 0                   NUMBER OF CHARACTERS I JOB (18)
:VOL   ZRO 0                   PAGES
:NPAR  ZRO 0                   NUMBER OF PARTS
:NFIL  ZRO 0                   NUMBER OF FILES/CARDS (21)
       ZRO 0                   NUMBER OF TAPES PURCHASED
       ZRO 0                   NUMBER OF TAPES CONVERTED
:NDEC  ZRO 0                   (DECOLATE? 1=NO 2=YES)
       ZRO 0                   TYPE OF CURRENCY
       ZRO 0                   DELIV CHARGES
:CMPF  ZRO 0                   FLAG INRECREMOTE,BATCHREC NOT USED IN FINAL
*                              0=REGULAR RECORD
*                              1=SPOOL RECORD
*                              2=COMPLETED BUT NOT ABLE TO ENTER RECORD
*                              3=UNABLE TO ESTABLISH RATES
******************             END OF TEMP FILE RECORD

BADFCT ZRO 0   0               BAD FILE COUNT USED BY TEMP
TP     BSS     2               TEMP POINTER
AF     ZRO     0               ACCOUNTING FILE THAT IS OPEN
BUF    BSS     100
SYSPTR BSS     2
MONPTR BSS     2

       IF DEBUG
F1     ASCP    '(CCARTER)RECBATCH'
F1R    ASCP    '(CCARTER)RECREMOTE'
F2     ASCP    '(CCARTER)RECBATCHA'
F2R    ASCP    '(CCARTER)RECREMOTEA'
F3     ASCP    '(CCARTER)XXXBATXX'
       ELSE
F1     ASCP    '(*4ACCT)RECBATCH'
F1R    ASCP    '(SPOOL)RECREMOTE'
F2     ASCP    '(*4ACCT)RECBATCHA'
F2R    ASCP    '(SPOOL)RECREMOTEA'
F3     ASCP    '(*4ACCT)XXXBATXX'
       ENDF



:100   DATA    6553600,7
OFFSET DATA    0,50,100,150,200


*      WRITE CONTROL INFORMATION (FIXED LENGTH)


       IF      SLAVE
CMDT   ZRO
       BRU     P
CMDTE  BRU     Q
       ENDF

T      ZRO
DC     ZRO
       IF      SLAVE
IFILE  ZRO
OFILE  ZRO
YR     ZRO
MN     ZRO
       ENDF
       IF      SLAVE
$BF    BSS     0
$GTDATE BSS    0               THESE TWO ARE NEEDED BECAUSE WE LINK TO FILCTL
       ENDF
       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPACC SYMSORT

SYM.  PG.LN. IDENT.

:100    8 33 ACC     :CMPF   8  3 ACC     :DE     7 26 ACC     :GAN    7 23 ACC     
:HOST   7 25 ACC     :JBTYP  7 21 ACC     :JOBNO  7 28 ACC     :NCHR   7 33 ACC     
:NDEC   7 39 ACC     :NFIL   7 36 ACC     :NPAR   7 35 ACC     :PJC    7 27 ACC     
:RB     7 29 ACC     :USN    7 22 ACC     :UUN    7 24 ACC     :VOL    7 34 ACC     
ADDMTD  7  2 ACC     AF      8 12 ACC     ASCP    1  8 ACC     
BADFCT  8 10 ACC     BF      9 16 ACC     BUF     8 13 ACC     CKBUSY  7 10 ACC     
CKBUSY  1 23 ACC     CMD     2 18 ACC     CMDT    9  2 ACC     CMDTE   9  4 ACC     
DC      9  8 ACC     DEBUG   1  5 ACC     DISABL  1 27 ACC     ENABLE  1 31 ACC     
ERROR   3 23 ACC     ERROR   2 24 ACC     ERROR   1 34 ACC     ERROR   1 24 ACC     
F1      8 24 ACC     F1      8 18 ACC     F1R     8 25 ACC     F1R     8 19 ACC     
F2      8 26 ACC     F2      8 20 ACC     F2R     8 27 ACC     F2R     8 21 ACC     
F3      8 28 ACC     F3      8 22 ACC     FINAL   6  3 ACC     FINAL0  6  9 ACC     
FINAL1  6 32 ACC     FINAL2  6 35 ACC     GTDATE  9 17 ACC     IFILE   9 10 ACC     
L240    1 18 ACC     MN      9 13 ACC     MONPTR  8 15 ACC     NNNN    1 29 ACC     
OFFSET  8 34 ACC     OFILE   9 11 ACC     P       2 28 ACC     P1      3  2 ACC     
P::ACC  3 33 ACC     P::ACC  3 24 ACC     POSTOT  7  5 ACC     Q       3  5 ACC     
RECLEN  1  4 ACC     REMJOB  1 37 ACC     RET     1 35 ACC     RET     1 26 ACC     
RWD     3 10 ACC     SKNE    1 14 ACC     SLAVE   1  3 ACC     SPTR    1 15 ACC     
ST      2  9 ACC     ST1     2 12 ACC     START   2  1 ACC     SYSPTR  8 14 ACC     
T       9  7 ACC     TEMP    4 34 ACC     TEMP1   5 19 ACC     TEMP2   5  7 ACC     
TEMP3   6  1 ACC     TP      8 11 ACC     X       1  9 ACC     YR      9 12 ACC     

SPOOL ** FICHE/FRAME BREAK *****
SPBTIO
BTIO   IDENT   BLOCK TERMINAL IO DRIVER
       IF      BTIOSW
       RELORG  RELORG

       ENTRY   BTCOP,SETBIO,CWF,FINI

SETBIO NOP     RT9
       LDA     KBU200          BUFF+200
       LRSH    14
       LDA     K600
       LSH     14
       STA     TLV1
       LDA     K14D
       STA     TLV2
       LDX     KBUFF
       LDA     KBUFF3          BUFF+3
       LDB     K4B7
SETRNG STA     TLV11
       STA     1,2
       STB     0,2
       LDA     TLV1
       STA     2,2
       ADD     K200
       STA     TLV1
       LDA     THREE
       ADD     TLV11
       EAX     3,2
       SKR     TLV2
       BRU     SETRNG
       LDA     KBUFF
       STA     -2,2
       STA     TLV21
       LDA     KM1
       STA     TLV23
       STA     TLV3
       CALL    CINIT
       RET     SETBIO

CINIT  NOP     RT10
       CLA
       STA     TLV2
       LDX     TLV21
       LDA     2,2
       ETR     K3S4            ?????
       CAX
       SPTR    0,2
       STP     TLV1
       RET     CINIT

*      BTCO POP COMESE HERE

BTCOP  STA     SV1
       STX     SV3
       LDA*    0
       WCI     TLV1
       MIN     TLV2
       LDA     TLV2
       SKNE    K600
       CALL    CWF
       LDA     SV1
       LDX     SV3
       BRR     0

CWF    NOP     RT9
       LDX     TLV21
       LDA     2,2
       LRSH    14
       LDA     TLV2
       SKG     ZERO
       RET     CWF
       LSH     14
       STA     2,2
       BRU     *+2
STIO   CALL    CKER
       LDA     TLV21
       LDB     TLV23
       MIN     TLV23
       LDX     ONE
       BRS     97
       BRU     STIO
       LDX     TLV21
       LDA     1,2
       XMA     TLV21
       STA     TLV22
       CALL    CKBZY
       CALL    CINIT
       RET     CWF

CKBZY  NOP     RT10
       SKN*    TLV21
       BRU     *+2
       RET     CKBZY
       CALL    CKER
       BRU     CKBZY

CKER   NOP     RT11
       LDX     ONE
       LDA     KBUFF
       BRS     75
       CAX
       SKE     TLV21
       RET     CKER
       LDA     0,2
       SKE     K6B7
       RET     CKER
       LDA     KM1
       XMA     TLV23
       SKG     TLV3
       RET     CKER
       STA     TLV3
       RET     CKER

FINI   NOP     RT7
       CALL    CWF
       LDX     ONE
       BRS     178
       CALL    CKER
       LDX     ONE
       LDA     K377
       BRS     172
       RET     FINI

TLV1   ZRO
TLV11  ZRO     0               TLV1 AND TLV11 ARE POINTER FOR BUFFERLET
TLV2   ZRO     0               CHAR COUNT IN BUFFERLET
TLV21  ZRO     0               CURRENT COMMAND POINTER
TLV22  ZRO     0               PREVIOUS COMMAND POINTER
TLV23  ZRO     0               ACTIVE COMMAND POINTER
TLV3   ZRO     0               MAX TLV23
K377   DATA    377B
KBUFF  DATA    BUFF
KBUFF3 DATA    BUFF+3
KBU200 DATA    BUFF+200B
K600   DATA    600B
K6B7   DATA    6B7
K3S4   DATA    37777B
K14D   DATA    14
       ENDF
       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPBTIO SYMSORT

SYM.  PG.LN. IDENT.

BTCOP   2 13 BTIO    CINIT   1 39 BTIO    CKBZY   3 11 BTIO    
CKER    3 18 BTIO    CWF     2 25 BTIO    FINI    3 35 BTIO    K14D    4 20 BTIO    
K377    4 13 BTIO    K3S4    4 19 BTIO    K600    4 17 BTIO    K6B7    4 18 BTIO    
KBU200  4 16 BTIO    KBUFF   4 14 BTIO    KBUFF3  4 15 BTIO    SETBIO  1  7 BTIO    
SETRNG  1 18 BTIO    STIO    2 35 BTIO    TLV1    4  6 BTIO    TLV11   4  7 BTIO    
TLV2    4  8 BTIO    TLV21   4  9 BTIO    TLV22   4 10 BTIO    TLV23   4 11 BTIO    
TLV3    4 12 BTIO    
SPOOL ** FICHE/FRAME BREAK *****
SPCMD
CMD    IDENT   PRIMARY COMMAND DISPATCHER & MISC JAN 22, 1976
*
*      THIS IS THE PRIMARY COMMAND DISPATCHER FOR BATCH
*      EVERYBODY GETS STARTED FROM THIS SECTION



       ENTRY   CMDISP,CMDERR,ESCR,START1
       ENTRY   START
START  BRU     *+2
       BRU     ESCR
       SKN     SINIT
       BRM     SINIT
START1 LDP     CMDREL
       BRS     44
       LDA     =ESCR
       STA     ESCV
       LDA     K2B6
       BRS     78
       TYPE    VERS
CMDISP LDA     K4B4
       LDX     KM1
       STX     DISCT
       BRS     12              SET COMMAND EDIT MODE
       BRS     114             ESCAPES ARE ENABLED AT THIS LEVEL
       LDA     XFRCNT
       SKG     ZERO
       BRU     *+4
       TYPE    XFRM5
       PDEC    0
       TYPE    XFRM6
       CALL    SIMAP
       LDA    =STACK
       STA     SP
       LDA     CR
       CIO     COUT
       IF      DEBUG
       LDA     K40
       ELSE
       LDA     =32B
       ENDF
       CIO     COUT
       BRS     147             CLOSE ALL FILES EXCEPT COMMAND FILE
       BRS     43
       LDA     STAREL
       BRS     44
       LDA     CMCMD1
       CALL    DISP
       BRU     CMDIS1
       BRU     CMDISP
       BRU     CMDISP
CMDIS1 BRS     43
       LDA     PRIREL
       BRS     44
       LDA     CMCMD2
       CALL    REDISP
CMDERR CALL   CERR
       BRU     CMDISP
       BRU     CMDISP          THIS IS REALLY NEEDED-DO NOT DELETE

CMCMD1 CMD     (SPOOL,GUI,2),(STATUS,,3),(REPORT,,3),LIST,CANCEL,
(HOLD,HOLDJ,2),INSTRUCTIONS,(HELP,,2),QUIT,(?,HELP),(SETS,,2),
TRANSFER,WHERE
CMCMD2 CMD     PRINT,(STORE,,3),(RESTART,,3),DELETE,(HARDCOPY,HARD,2),
(MOVE,,4)

QUIT   NOP     RT1
       BRS     104
       SKA     K4B7
       BRS     10
       STX     SV3
       LDA     =SV1
       LDX     =33
       BRS     7
       LDA     SV1
       SKE     SV3
       BRS     10
       BRS     101             RELEASE ANY UNITS
       BRS     10
       BRU     ESCR
ESCR   NOP     ESCLOC
       LDA     K2B6
       BRS     78
       LDX     ONE
       BRS     99
       BRS     29
       LDX     KM1
       LDA     =3000
       BRS     164
       LDA     TERM
       LDX     KM1
       BRS     160
       CLA
       STA     ONOFF
       CALL    CLRIN
       BRU     CMDISP
HELP   NOP     RT1
       TYPE    HELPM
       LDA     CPARW
       SKA     K4B7
       TYPE    HELPM3
       SKF     OPER
       BRU     CMDISP
       TYPE    HELPM1
       SKNF    COPER
       TYPE    HELPM2
       BRU     CMDISP

*      ROUTINES THAT ARE ONLY USED IN THIS PACKAGE



INSTRU NOP     RT1
       TYPE    INSMSG
       RET     INSTRUCTIONS

SETS   NOP     CMDRT
       LDA     KM1
       CALL    VERPSW
       CALL    CLRJBS
       RET     SETS

       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPCMD SYMSORT

SYM.  PG.LN. IDENT.

CMCMD1  2 22 CMD     CMDERR  2 18 CMD     CMDIS1  2 13 CMD     
CMDISP  1 21 CMD     ESCR    2 38 CMD     HELP    3 15 CMD     INSTRU  3 31 CMD     
SETS    3 35 CMD     START   1 10 CMD     START1  1 14 CMD     ]MOVE,  2 24 CMD     
_HOLD,  2 23 CMD     
SPOOL ** FICHE/FRAME BREAK *****
SPCON
CONST  IDENT   CONSTANTS FOR THE WORLD      JAN 16,1976
*
***************************************
*
*      CONSTANTS USED IN THE WHOLE WORLD
*
**************************************
       GLOBAL

ZERO   DATA    0
ONE    DATA    1
SPIFLG EQU     ONE
TWO    DATA    2
THREE  DATA    3
FOUR   DATA    4
FIVE   DATA    5
SIX    DATA    6
SEVEN  DATA    7
NINE   DATA    9
K10    DATA    10B
TEN    DATA    10
K14    DATA    14B
K17    DATA    17B
K17B5  DATA    17B5
K13B5  DATA    13B5
K20    DATA    20B
K37    DATA    37B
K40    DATA    40B
K47    DATA    47B
K70    DATA    70B
K71    DATA    71B
K77    DATA    77B
K100   DATA    100B
K74    DATA    74B
MB     DATA    135B
K137   DATA    137B
EOFC   EQU     K137
LF     DATA    152B
TOF    DATA    154B
CR     DATA    155B
K177   DATA    177B
K200   DATA    200B
K202   DAT202B
K203   DATA    203B
K215   DATA    215B
K300   DATA    300B
K777   DATA    777B
K1777  DATA    1777B
K3777  DATA    3777B
K4B7   DATA    4B7
DONFLG EQU     K4B7
K3B7   DATA    3B7
K2B7   DATA    2B7
HLDFLG EQU     K2B7
K1B7   DATA    1B7
K2B6   DATA    2B6
OTPFLG EQU     K2B6
K1B6   DATA    1B6
CANFLG EQU     K1B6
K77B5  DATA    77B5
K7B5   DATA    7B5
K6B5   DATA    6B5
K5B5   DATA    5B5
K4B5   DATA    4B5
INPFLG EQU     K4B5
K2B4   DATA    2B4
K2B5   DATA    2B5
CUSFLG EQU     K2B5
CENFLG EQU     K2B4
K1B5   DATA    1B5
HJBFLG EQU     K1B5
K4B4   DATA    4B4
K1B4   DATA    1B4
XFRFLG EQU     K1B4
K4B3   DATA    4B3
FULFLG EQU     K4B3
K2B3   DATA    2B3
FICOPS EQU     K2B3
K1B3   DATA    1B3
XFRDED EQU     K1B3
REMFLG EQU     K4B4
KM4K   DATA    -4000B
KM1    DATA    -1
KM4    DATA    -4
KM40   DATA    -40B
K377B  DATA    377B
ADMASK DATA    37777B
OPMASK DATA    777B5
DTMASK DATA    1740B
MNMASK DATA    36B3
YRMASK DATA    7774B4

LOWNOD DATA    BOTNOD-1        ONE LESS THAN THE SMALLEST LOGIN NODE
       END
SPOOL ** FICHE/FRAME BREAK *****
SPCON SYMSORT

SYM.  PG.LN. IDENT.

ADMASK  3  9 CONST   CANFLG  2 20 CONST   CENFLG  2 30 CONST   
CR      2  1 CONST   CUSFLG  2 29 CONST   DONFLG  2 12 CONST   DTMASK  3 11 CONST   
EOFC    1 37 CONST   FICOPS  2 39 CONST   FIVE    1 16 CONST   FOUR    1 15 CONST   
FULFLG  2 37 CONST   HJBFLG  2 32 CONST   HLDFLG  2 15 CONST   INPFLG  2 26 CONST   
K10     1 20 CONST   K100    1 33 CONST   K137    1 36 CONST   K13B5   1 25 CONST   
K14     1 22 CONST   K17     1 23 CONST   K177    2  2 CONST   K1777   2  9 CONST   
K17B5   1 24 CONST   K1B3    3  1 CONST   K1B4    2 34 CONST   K1B5    2 31 CONST   
K1B6    2 19 CONST   K1B7    2 16 CONST   K20     1 26 CONST   K200    2  3 CONST   
K202    2  4 CONST   K203    2  5 CONST   K215    2  6 CONST   K2B3    2 38 CONST   
K2B4    2 27 CONST   K2B5    2 28 CONST   K2B6    2 17 CONST   K2B7    2 14 CONST   
K300    2  7 CONST   K37     1 27 CONST   K3777   2 10 CONST   K377B   3  8 CONST   
K3B7    2 13 CONST   K40     1 28 CONST   K47     1 29 CONST   K4B3    2 36 CONST   
K4B4    2 33 CONST   K4B5    2 25 CONST   K4B7    2 11 CONST   K5B5    2 24 CONST   
K6B5    2 23 CONST   K70     1 30 CONST   K71     1 31 CONST   K74     1 34 CONST   
K77     1 32 CONST   K777    2  8 CONST   K77B5   2 21 CONST   K7B5    2 22 CONST   
KM1     3  5 CONST   KM4     3  6 CONST   KM40    3  7 CONST   KM4K    3  4 CONST   
LF      1 38 CONST   LOWNOD  3 15 CONST   MB      1 35 CONST   MNMASK  3 12 CONST   
NINE    1 19 CONST   ONE     1 11 CONST   OPMASK  3 10 CONST   OTPFLG  2 18 CONST   
REMFLG  3  3 CONST   SEVEN   1 18 CONST   SIX     1 17 CONST   SPIFLG  1 12 CONST   
TEN     1 21 CONST   THREE   1 14 CONST   TOF     1 39 CONST   TWO     1 13 CONST   
XFRDED  3  2 CONST   XFRFLG  2 35 CONST   YRMASK  3 13 CONST   ZERO    1 10 CONST   

SPOOL ** FICHE/FRAME BREAK *****
SPCPY
COPY2  IDENT   COPY FILES AND COUNT PAGES   JAN 29, 1976

*********************************************
*
*      THIS ROUTINE WILL COPY A FILE FROM ONE
*      FILE TO ANOTHER COUNTING THE NUMBER OF
*      LINES AND INCREMENTING THE PAGE COUNT
*      WHEN THE LINE COUNT EXCEEDS EITHER
*      THE LINES PER PAGE (L:PG) OR THE
*      BILLABLE LINES PER PAGE (BL:PG).
*
*      THE ALGORITHM FOR SCANNING FOR THE
*      CONTROL CHARACTERS IS ADAPTED FROM 
*      THE PAPER
*
*      MULTIPLE BYTE PROCESSING WITH FULL WORD INSTRUCTIONS
*      BY LESLIE LAMPORT
*      PUBLISHED IN THE COMMUNICATIONS OF THE ACM
*      AUGUST 1975, VOLUME 18, NUMBER 8
*
************************************************

IBUFF  EQU     30000B
DB::SZ EQU     4000B
$COPY  NOP     RT6
       LDA     =CPYESC
       STA     ESCLOC
       BRS     43
       XAB
       XMA     CPYREL
       XAB
       BRS     44
       LDA     KM1
       STA     EOFSW
       LDA     L:PG
       MRG     K4B7
       STA     C1
       LDA     BL:PG
       MRG     K4B7
       STA     C3
       RSP     IFILE
       CLA
       LSH     1
       DIV     =1000
       ADM     CHARK
CP1    LDA     =DB::SZ
       LDX     =IBUFF
       BIO     IFILE
       MIN     EOFSW
       SUB     =IBUFF
       STA     WDCT
       LDX     =IBUFF
       BIO     OFILE
       HLT
       LDA     CP2I
       ADD     WDCT
       STA     CP2
       SUB     =1B5
       STA     TESTN
       LDA     WDCT
       CNA
       CAX
CP2    LDA     IBUFF+DB::SZ,2
       ETR     =@40100200B
       ADD     =5413026B
       SKA     =40100200B
       BRU     TESTN
CP3    BRX     CP2
       SKP     EOFSW
       BRU     CP1
       BRS     43
       XAB
       XMA     CPYREL
       XAB
       BRS     44
       LDA     =SPOESC
       STA     ESCLOC
       RET     COPY

TESTN  LDB     IBUFF+DB::SZ,2
TESTN1 SKB     KM1
       BRU     *+2
       BRU     CP3
       CLA
       LSH     8
       SKE     LF
       BRU     *+2
       BRU     NEWLIN
       SKE     CR
       BRU     *+2
       BRU     NEWLIN
       SKE     TOF
       BRU     TESTN1
NEWPAG LDA     L:PG
       MRG     K4B7
       STA     C1
NPG1   LDA     BL:PG
       MRG     K4B7
       STA     C3
       MIN     TPAGES
       BRU     TESTN1
NEWLIN SKR     C1
       BRU     NEWPAG
       SKR     C3
       BRU     NPG1
       SKN     DBLSW
       BRU     TESTN1
       SKR     C1
       BRU     NEWPAG
       SKR     C3
       BRU     NPG1
       BRU     TESTN1

CPYESC NOP     RT10
       DISABLE
       BRS     43
       XAB
       XMA     CPYREL
       XAB
       BRS     44
       BRU     SPOESC

CP2I   LDA     IBUFF,2
CPYREL ZRO     0

       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPCPY SYMSORT

SYM.  PG.LN. IDENT.

COPY    1 25 COPY2   CP1     2  7 COPY2   CP2     2 24 COPY2   
CP2I    4  6 COPY2   CP3     2 29 COPY2   CPYESC  3 36 COPY2   CPYREL  4  7 COPY2   
DB::SZ  1 24 COPY2   IBUFF   1 23 COPY2   NEWLIN  3 24 COPY2   NEWPAG  3 16 COPY2   
NPG1    3 19 COPY2   TESTN   3  2 COPY2   TESTN1  3  3 COPY2   
SPOOL ** FICHE/FRAME BREAK *****
SPDATA
DATA   IDENT   PHASE II        JUN 24, 1977
RECSIZ EQU     64
*
*      ALL DATA DEFINITIONS GO IN THIS PAGE.
*      IF THERE IS ENOUGH ROOM, LITERALS CAN BE DEFINED HERE ALSO
*
       GLOBAL DATA DEFINITIONS (NOTICE HOW CLEVER THIS STATEMENT IS)
       OCT
POPR   ZRO     0               POPS RETURN HERE
CIN    ZRO     0               COMMAND INPUT
COUT   ZRO     0               COMMAND OUTPUT
SP     ZRO     STACK           STACK POINTER
STACK  BES     20              STACK IS TWENTY LONG
       BSS     100-[*-:ZERO:]  MOVE TO START OF POP VECTOR
POPV   BSS     100             POP VECTOR
INTV   BSS     20              INTERUPT VECTOR
ESCV   EQU     INTV+1          ESCAPE
INTR   BSS     20              INTERUPT RETURN VECTOR
ESCLOC EQU     INTR+1          ESCAPE
*
*      THE FOLLOWING ARE SBRM LOCATIONS
*
RTPOP  ZRO     0               RETURN FOR POPS
CMDRT  ZRO     0               RETURN FOR INITIAL COMMANDS
RT1    ZRO     0
RT2    ZRO     0
RT3    ZRO     0
RT4    ZRO     0
RT5    ZRO     0
RT6    ZRO     0
RT7    ZRO     0
RT8    ZRO     0
RT9    ZRO     0
RT10   ZRO     0
RT11   ZRO     0
*
*      START OF THE CONTROL FILE BUFFER
*
PCB    EQU     *
DATE   ZRO     0               DATE REQUEST ENTERED
JBSTA  ZRO     0  1            STATUS WORD
BRNO   ZRO     0  2            REQUEST NUMBER
CPN    ZRO     0  3            COMPUTER JOB ENTERED ON
FILES  ZRO     0  4            FILES SPOOLED
PAGES  ZRO     0  5            NUMBER OF PAGES WE WILL CHARGE HIM FOR
FORMS  ZRO     0  6            SIZE OF FORMS
PARTS  ZRO     0  7            NUMBER OF PARTS, DECOLATION BIT
COPIES ZRO     0  10           HOW MANY COPIES DOES HE WANT
DIST   ZRO     0  11           DISTRICT THAT HE IS IN
GAN    ZRO     0  12           GLOBAL ACCOUNT NUMBER FOR BILLING
UUN    ZRO     0  13           UNIVERSAL USER NUMBER
USN    BSS     4  14           USER NAME
PJC    BSS     4  20           PROJECT CODE
BUSN   BSS     4  24           USER NAME TO BILL TO
STCP   ZRO     0  30           STARTING CURSOR POSITION IN STRING AREA
TELCP  ZRO     0  31           OFFSET TO TELEPHONE NUMBER
DELCP  ZRO     0  32           OFFSET TO DELIVERY INSTRUCTIONS
DADCP  ZRO     0  33           OFFSET TO DELIVERY ADDRESS
SPFCP  ZRO     0  34           OFFSET TO SPECIAL FORMS DESCRIPTION
SPICP  ZRO     0  35           OFFSET TO SPECIAL INSTRUCTIONS
EOFCP  ZRO     0  36           OFFSET TO THE END
DELVI  ZRO     0  37           MEAS OF DELIVERY
RQNCP  ZRO     0  40           OFFSET TO REQUEST NAME 
DDIST  ZRO     0  41           DELIVERY DISTRICT FOR HARDCOPY PRINTOUT
DATTIM ZRO     0  42           DMIN TIME THAT REQUEST WAS MADE
L:PG   ZRO     0  43           LINES PER PAGE
HSW    ZRO     0  44           HEADINGS SWITCH
PRILOC ZRO     0  45           PRINTER LOCATION NUMBER
CHARK  ZRO     0  46           CHARACTERS IN THOUSANDS
BL:PG  ZRO     47 47           BILLABLE LINES PER PAGE
DBLSW  ZRO     0  50           DOUBLE SPACING SWITHCH
XFRADR BSS     10 51           TRANSFER ADDRESS
LOC:PR ZRO     0  61           LOCATION THAT THE REQUEST WAS PRINTED AT
INDCNT ZRO     0  62           NUMBER OF SPACES TO INDENT FOR EACH LINE
LLTH   ZRO     0  63           LINE LENGTH
OPRLOC ZRO     0  64           LOCATION THAT THE REQUEST WAS SPOOLED TO ORIG
PCBE   BES     RECSIZ-[*-PCB]  MAKE THE RECORD RECSIZ LONG

*
*GLOBAL CELLS USED THROUGHOUT
*
CDTTIM ZRO     0               DATE AND TIME SPOOL WAS ENTERED.
CPRLOC ZRO     0               PRINTER LOCATION OF USER
CENLOC ZRO     0               PRINTER LOCATION OF CENTER FOR USER
CCPNO  ZRO     0               COMPUTER NUMBER THAT WE ARE ON
NODPRT ZRO     0               NODE/PORT OF LOGIN
CDIST  ZRO     0               DISTRICT THAT WE ARE IN.
CGAN   ZRO     0               GAN THAT WE ARE RUNNING ROM
CUUN   ZRO     0               UUN THAT WE ARE RUNNING FROM
CDATE  ZRO     0               DATE THAT WE STARTED RUNNING
SPRLOC ZRO     0               PRINTER LOCATION SET BY USER IF CHPFLG
RQSN   ZRO     0               CELL THAT TELLS THE NUMBER WE ARE GETTING
NUMBER ZRO     0               NUMBER THAT WAS IN INPUT STREAM
XUUN   ZRO     0               TEST UUN WHEN GOING BY NAME
CPARW  ZRO     0               RUNNING CPARW WORD
TERMC  ZRO     0               TERMINATING CHARACTER OF STING
EQPT   ZRO     0               EQUIPMENT CELL
APSW   ZRO     0               PRINTER ON SYSTEM ASKED (-1 IF YES)
JBPTR  ZRO     0               POINTER FOR REQUST IN PRINT
1SW    ZRO     0               FIRST TIME SWITCH
CT     ZRO     0               COUNTER
CNT    ZRO     0               COUNTER
LISTP  ZRO     0               LIST POINTER
FL     ZRO     0               FILE
PPFL   ZRO     0               FILE
REGION ZRO     0               WHAT REGION ARE WE IN. =DIST/10
OFORMS ZRO     0               LAST TYPE OF FORMS USED (FOR TAPE)
XHSW   ZRO     0               HSW USED IN ACTUALLY PRINTING FILES
XINDCT ZRO     0               INDCNT USED IN PRINTING FILES
XDBLSW ZRO     0               DBLSW USED IN ACTUALLY PRINTING FILES
       ZRO     0               SWITCH IF WE ARE PRINTING FILE OR HEAD PAGE
INFILE ZRO     0               SWITCH IF WE ARE PRINTING FILE OR HEAD PAGE
TCR    ZRO     0               TEST FOR CARRAIGE RETURN/LF CHARACTER.
XL:PG  ZRO     0               L:PG USED IN ACTUALLY PRINTING FILES
OPARTS ZRO     0               LAST TYPE OF PARTS USED
SKIPSW ZRO     0               SKIP PARTICULAT TYPE OF ROME
FILCT  ZRO     0               COUNT OF FILES IN PRINT
TCOP   ZRO     0               TEMP CELL USED FOR NUMBER OF COPIES
MBFL   ZRO     0               MULTIPLE BLANK SWITCH
MBCT   ZRO     0               MULTIPLE BLANK COUNT
LINCT  ZRO     0               COUNT OF LINES
EOLFL  ZRO     0               END OF LINE FLAG
NEWLNS ZRO     0               NEW LINE SWITCH
EXTRN  ZRO     0               EXTERNAL PRINTER OR SYSTEM PRINTER
ONOFF  ZRO     0               EXTERNAL PRINTER ON OR OFF
TERM   ZRO     0               TERMINAL CHARACTERISTICS
EPTYPE ZRO     0               TYPE OF EXTERNAL PRINTER
CHRCNT ZRO     0               CHARACTER COUNT
ATOP   ZRO     0               AT TOP OF FORM FLAG
LI     ZRO     0               COUNT OF LINES
C000   ZRO     0               COMPUTER NUMBER*1000
IFILE  ZRO     0               INPUT FILE
OFILE  ZRO     0               OUTPUT FILE
FFILE  ZRO     0               INDIRECT FILE NAMES FILE
TPAGES ZRO     0               TEMP PAGES INCR BY SPOOLING
PGCNTD ZRO     0               PAGE COUNT TO BE DECREMENTED WHILE NOT PRINTING
CHCNT  ZRO     0               TOTAL CHARACTERS FOR TYMNET CHARGE
WORD1  ZRO     0               WORD BEING DECOMPOSED BY COPY
CCT    ZRO     0               CHARACTER COUNT FOR WORD1
LCCT   ZRO     0               CHARACTER COUNT FOR LINE
EOFSW  ZRO     0               END OF FILE DETECTED
IBP    ZRO     0               INPUT BUFFER POINTER
BRNSW  ZRO     0               SET TO -1 IF A BATCH REQUEST NUMBER
*                              IS GOTTEN FOR THIS REQUEST ALREADY.
WDCT   ZRO     0               NUMBER OF WORDS READ
FNSP   BSS     2               FILE NAME STRING POINTER
RQTP   BSS     2               REQUESTOR TEL NUM POINTER
RQNP   BSS     2               REQUEST NAME POINTER
DELIP  BSS     2               DELIVERY INSTRUCTIONS POINTER
DELAP  BSS     2               DELIVERY ADDRESS POINTER
SPIP   BSS     2               SPECIAL INSTRUCTIONS POINTER
SPFP   BSS     2               SPECIAL FORMS POINTER
SPDP   BSS     2               SPOOL DIRECTORY FILE NAME POINTER
FLAG   ZRO     0               FLAG WORD
TEST   ZRO     0               TEST WORD USED FOR SKA'S
TEST1  ZRO     0               ADDITIONAL TEST WORD FOR CENTER/REMOTE
TDATE  ZRO     0               DATE USED IN TESTING IN REPORT
TV1    ZRO     0               TEMP VARIABLE 1
TV2    ZRO     0               TEMP VARIABLE 2
TV3    ZRO     0               TEMP VARIABLE 3
TV4    ZRO     0               TEMP VARIABLE 4
SV1    BSS     1               TEMP STORAGE FOR A REGISTER
SV2    BSS     1               TEMP STORAGE FOR B REGISTER
SV3    ZRO     0               TEMP STORAGE FOR X REGISTER
SSV1   ZRO     0               TEMP USED IN POPS
SSV2   ZRO     0               TEMP USED IN POPS
SVESCV ZRO     0               TEMP USED IN POPS FOR ESCV
DISCT  ZRO     0               DISABLE COUNT
ERLOC  ZRO     0               LOCATION THAT LAST ERROR POP CAME FROM
STNGC  ZRO     0               NUMBER OF CHARACTERS BEFORE END OF STNG POP
STTC   ZRO     0               TERMINATING CHARACTER FOR STNG POP
C1     ZRO     0               L:PG COUNT DOWN CELL FOR COPY
C2     ZRO     0               LLTH COUNT DOWN CELL FOR COPY
C3     ZRO     0               BL:PG COUNTDOWN CELL FOR COPY
N1     ZRO     0               1ST DIGIT OF BATCH REQUEST NUMBER
N2     ZRO     0               2ND DIGIT OF BATCH REQUEST NUMBER
N3     ZRO     0               3RD DIGIT OF BATCH REQUEST NUMBER
N4     ZRO     0               4TH DIGIT OF BATCH REQUEST NUMBER
N5     ZRO     0               5TH DIGIT OF BATCH REQUEST NUMBER
T      ZRO     0               UNIVERSAL TEMP CELL (DONT DEPEND ON IT)
T1     ZRO     0               ANOTHER OF THE SAME
T2     ZRO     0               AND ANOTHER
TPL    ZRO     0               TEMP FOR PRINTER LOCATION
XFRSW  ZRO     0               -1 IF TRANSFER REQUESTED
XFRCNT ZRO     0               NUMBER OF REQUESTS TO TRANSFER
TP     BSS     2               UNIVERSAL TEMPORARY POINTER (DONT DEPEND ON IT)
TPA    BSS     2               ANOTER TEMP POINTER
EOFLG  ZRO     0               END OF FILE FLAG
ERRCT  ZRO     0               COUNT OF ERRORS IN SPOOLING FILES
COUNT  ZRO     0               COUNT OF USED BY MANY PLACES
DY     ZRO     0               DAY
MN     ZRO     0               MONTH
YR     ZRO     0               YEAR
TMPCOU ZRO     0               TEMPORARY COUT FILE
TMPREL ZRO     0               TEMPORARY RELABELING
FP     BSS     2               FILE POINTER USED IN SPOOL
IP     BSS     2               POINTER TO INSTRUCTION LINE
LP     BSS     2               LINE POINTER ALSO USED IN DISPATCHER
DP     BSS     2               POINTER USED TO PRINT DATES
1WDP   BSS     2               POINTER USED IN GETTING A WORD FROM CMD LINE
LTH    BSS     1               LENGTH OF COMMAND
CCWP   BSS     1               POINTER TO CHANNEL CONTROL WORD
BPOS   BSS     1               POINTER INTO PRINTER BUFFER FOR NEXT WORD
WDS    BSS     1               NUMBER OF WORDS PER PRINTER RECORD
FLTH   BSS     1               LENGTH OF FILE NAME FOR RESTART
FLNP   BSS     2               POINTERS FOR FILE NAME FOR RESTART
CL     BSS     1               POINTER TO LIST OF COMMANDS IN DISPTACHER
SPOREL BSS     2               SPOOL RELABELING
CMDREL BSS     2               COMMAND DISPATCHER RELABELING
STAREL BSS     2               STATUS COMMAND RELABELING
PRIREL BSS     1               PRINT COMMAND RELABELING
ACCREL BSS     1               ACCOUNTING RELABELING
MLAB   BSS     1               MSG POP RELABELING
MSGREL BSS     1               MESSAGE PAGE RELABELING
XBUSN  BSS     4               TRIAL NAME FOR COMPARISONS
FISTAT BSS     2000
NPRN   EQU     FISTAT          NEXT LOCATION TO ENTER A REQUEST
ECP    EQU     FISTAT+1        CURSOR POS OF END OF FILE
LGCDAT EQU     ECP+1           THIS IS THE LAST GARBAGE COLLECTING DATE
UPDTTD EQU     LGCDAT+1        THIS HAS THE DATE OF THE LAST FILE DELEATING
RMAP   EQU     FISTAT+20B
RMAPE  EQU     RMAP+NJOBS
LX     ZRO     0               X REGISTER USED IN LUD ROUTINES
DADR   ZRO     0               DISK ADDRESS USED IN LUD ROUTINE
TFLNM  BSS     73/3            FILE NAME FOR RESTART
LUD    BSS     100
MAPBUF EQU     LUD
HLINE  EQU     LUD
LGAN   EQU     LUD+6
LUUN   EQU     LUD+7
LDIST  EQU     LUD+10
NUMSTG BES     4               NUMBER ASSEMBLY AREA
CMDSTN BSS     80D/3+1
STNGAR BSS     26

LINK   BSS     24D
LINKE  BSS     0
TOTPG  BSS     24D
TOTPGE BSS     0
PLIST  BSS     100
PLISTE BSS     0
SFPTR   DATA    3*SF-1,3*SF+5+3
SF      ASC     '(UN1)PSWD'
VPTR1   DATA    3*OPNAM-1,3*OPNAM-1
VPTR2   DATA    3*BUF2-1,3*BUF2-1
OPNAM  BSS     24
BUF2    BSS     24
SFBUF   BSS     24
EDPT   BSS     2
VTEST  ZRO     0               TEST WORD FOR VER
VT1     ZRO
VT2     ZRO
VXT1    ZRO
VXT2    ZRO
VXT3    ZRO
VXT4    ZRO
VXT5    ZRO
VXT8    ZRO
SFIL    ZRO
FILCOP BSS     72D

       IF      *-:ZERO:>3400
       REM     TOO MANY SYMBOLS-WARNING
       ENDF
       END
SPOOL ** FICHE/FRAME BREAK *****
SPDATA SYMSORT

SYM.  PG.LN. IDENT.

1SW     3 22 DATA    1WDP    6  5 DATA    ACCREL  6 17 DATA    
APSW    3 20 DATA    ATOP    4 12 DATA    BL:PG   2 31 DATA    BPOS    6  8 DATA    
BRNO    2  3 DATA    BRNSW   4 26 DATA    BUF2    7 13 DATA    BUSN    2 15 DATA    
C000    4 14 DATA    C1      5 16 DATA    C2      5 17 DATA    C3      5 18 DATA    
CCPNO   3  7 DATA    CCT     4 22 DATA    CCWP    6  7 DATA    CDATE   3 12 DATA    
CDIST   3  9 DATA    CDTTIM  3  4 DATA    CENLOC  3  6 DATA    CGAN    3 10 DATA    
CHARK   2 30 DATA    CHCNT   4 20 DATA    CHRCNT  4 11 DATA    CIN     1 10 DATA    
CL      6 12 DATA    CMDREL  6 14 DATA    CMDRT   1 24 DATA    CMDSTN  6 38 DATA    
CNT     3 24 DATA    COPIES  2  9 DATA    COUNT   5 34 DATA    COUT    1 11 DATA    
CPARW   3 17 DATA    CPN     2  4 DATA    CPRLOC  3  5 DATA    CT      3 23 DATA    
CUUN    3 11 DATA    DADCP   2 19 DATA    DADR    6 29 DATA    DATE    2  1 DATA    
DATTIM  2 26 DATA    DBLSW   2 32 DATA    DDIST   2 25 DATA    DELAP   4 33 DATA    
DELCP   2 18 DATA    DELIP   4 32 DATA    DELVI   2 23 DATA    DISCT   5 12 DATA    
DIST    2 10 DATA    DP      6  4 DATA    DY      5 35 DATA    ECP     6 23 DATA    
EDPT    7 15 DATA    EOFCP   2 22 DATA    EOFLG   5 32 DATA    EOFSW   4 24 DATA    
EOLFL   4  5 DATA    EPTYPE  4 10 DATA    EQPT    3 19 DATA    ERLOC   5 13 DATA    
ERRCT   5 33 DATA    ESCLOC  1 19 DATA    ESCV    1 17 DATA    EXTRN   4  7 DATA    
FFILE   4 17 DATA    FILCOP  7 26 DATA    FILCT   3 39 DATA    FILES   2  5 DATA    
FISTAT  6 21 DATA    FL      3 26 DATA    FLAG    4 37 DATA    FLNP    6 11 DATA    
FLTH    6 10 DATA    FNSP    4 29 DATA    FORMS   2  7 DATA    FP      6  1 DATA    
GAN     2 11 DATA    HLINE   6 33 DATA    HSW     2 28 DATA    IBP     4 25 DATA    
IFILE   4 15 DATA    INDCNT  2 35 DATA    INFILE  3 34 DATA    INTR    1 18 DATA    
INTV    1 16 DATA    IP      6  2 DATA    JBPTR   3 21 DATA    JBSTA   2  2 DATA    
L:PG    2 27 DATA    LCCT    4 23 DATA    LDIST   6 36 DATA    LGAN    6 34 DATA    
LGCDAT  6 24 DATA    LI      4 13 DATA    LINCT   4  4 DATA    LINK    7  2 DATA    
LINKE   7  3 DATA    LISTP   3 25 DATA    LLTH    2 36 DATA    LOC:PR  2 34 DATA    
LP      6  3 DATA    LTH     6  6 DATA    LUD     6 31 DATA    LUUN    6 35 DATA    
LX      6 28 DATA    MAPBUF  6 32 DATA    MBCT    4  3 DATA    MBFL    4  2 DATA    
MLAB    6 18 DATA    MN      5 36 DATA    MSGREL  6 19 DATA    N1      5 19 DATA    
N2      5 20 DATA    N3      5 21 DATA    N4      5 22 DATA    N5      5 23 DATA    
NEWLNS  4  6 DATA    NODPRT  3  8 DATA    NPRN    6 22 DATA    NUMBER  3 15 DATA    
NUMSTG  6 37 DATA    OFILE   4 16 DATA    OFORMS  3 29 DATA    ONOFF   4  8 DATA    
OPARTS  3 37 DATA    OPNAM   7 12 DATA    OPRLOC  2 37 DATA    PAGES   2  6 DATA    
PARTS   2  8 DATA    PCB     1 39 DATA    PCBE    2 38 DATA    PGCNTD  4 19 DATA    
PJC     2 14 DATA    PLIST   7  6 DATA    PLISTE  7  7 DATA    POPR    1  9 DATA    
POPV    1 15 DATA    PPFL    3 27 DATA    PRILOC  2 29 DATA    PRIREL  6 16 DATA    
RECSIZ  1  2 DATA    REGION  3 28 DATA    RMAP    6 26 DATA    RMAPE   6 27 DATA    
RQNCP   2 24 DATA    RQNP    4 31 DATA    RQSN    3 14 DATA    RQTP    4 30 DATA    
RT1     1 25 DATA    RT10    1 34 DATA    RT11    1 35 DATA    RT2     1 26 DATA    
RT3     1 27 DATA    RT4     1 28 DATA    RT5     1 29 DATA    RT6     1 30 DATA    
RT7     1 31 DATA    RT8     1 32 DATA    RT9     1 33 DATA    RTPOP   1 23 DATA    
SF      7  9 DATA    SFBUF   7 14 DATA    SFIL    7 25 DATA    SFPTR   7  8 DATA    
SKIPSW  3 38 DATA    SP      1 12 DATA    SPDP    4 36 DATA    SPFCP   2 20 DATA    
SPFP    4 35 DATA    SPICP   2 21 DATA    SPIP    4 34 DATA    SPOREL  6 13 DATA    
SPRLOC  3 13 DATA    SSV1    5  9 DATA    SSV2    5 10 DATA    STACK   1 13 DATA    
STAREL  6 15 DATA    STCP    2 16 DATA    STNGAR  6 39 DATA    STNGC   5 14 DATA    
STTC    5 15 DATA    SV1     5  6 DATA    SV2     5  7 DATA    SV3     5  8 DATA    
SVESCV  5 11 DATA    T       5 24 DATA    T1      5 25 DATA    T2      5 26 DATA    
TCOP    4  1 DATA    TCR     3 35 DATA    TDATE   5  1 DATA    TELCP   2 17 DATA    
TERM    4  9 DATA    TERMC   3 18 DATA    TEST    4 38 DATA    TEST1   4 39 DATA    
TFLNM   6 30 DATA    TMPCOU  5 38 DATA    TMPREL  5 39 DATA    TOTPG   7  4 DATA    
TOTPGE  7  5 DATA    TP      5 30 DATA    TPA     5 31 DATA    TPAGES  4 18 DATA    
TPL     5 27 DATA    TV1     5  2 DATA    TV2     5  3 DATA    TV3     5  4 DATA    
TV4     5  5 DATA    UPDTTD  6 25 DATA    USN     2 13 DATA    UUN     2 12 DATA    
VPTR1   7 10 DATA    VPTR2   7 11 DATA    VT1     7 17 DATA    VT2     7 18 DATA    
VTEST   7 16 DATA    VXT1    7 19 DATA    VXT2    7 20 DATA    VXT3    7 21 DATA    
VXT4    7 22 DATA    VXT5    7 23 DATA    VXT8    7 24 DATA    WDCT    4 28 DATA    
WDS     6  9 DATA    WORD1   4 21 DATA    XBUSN   6 20 DATA    XDBLSW  3 32 DATA    
XFRADR  2 33 DATA    XFRCNT  5 29 DATA    XFRSW   5 28 DATA    XHSW    3 30 DATA    
XINDCT  3 31 DATA    XL:PG   3 36 DATA    XUUN    3 16 DATA    YR      5 37 DATA    

SPOOL ** FICHE/FRAME BREAK *****
SPDVR
DVR    IDENT


       RELORG  RELORG

       ENTRY   PRCHAR,PFILE,PB34,PB35,PB36,FLUSH
*************************************************
*
*      PRINT FILE
*
**************************************************************

PFILE  NOP     RT5
       SETF    TF1             SET FLAG FOR TEST IN PJOB
PFI1   BRS     147
       SKNF    FRTAPE          FROM TAPE DOES OTHER THINGS
       BRU     PFI5
       CALL    SSPDP
       LDA     FILCT
       CALL    MFILNM
       BRS     64
       BRU     PFE1            ERROR OPENING FILE
       STA     IFILE
       IF      -1
       CLA
       CALL    GSTNG
       STP     TP
       LDA     FILCT
       STA     T
PFI1A  SKR     T
       BRU     *+2
       BRU     PFI1B
       GCI     TP
       BRU     PFI5
       SKE     CR
       BRU     *-3
       BRU     PFI1A
PFI1B  LDA     TP
       STA     T
PFI1D  GCI     TP
       BRU     PFI1C
       SKE     CR
       SKNE    K203
       BRU     *+2
       BRU     PFI1D
PFI1C  LDA     T
       LDB     TP
       STP     FNSP
       CALL    EXTOFF
       TCO     CR
       LDP     FNSP
       LDX     COUT
       BRS     35
       ENDF
PFI5   LDA     KM1

       STA     EOFLG
       STA     MBFL
       STA     MBCT
       STA     1SW
       STA     WDCT
       STA     CCT
       STA     PAGE
       CLAB
       STP     IDENT
       STA     NEWLNS
       SKNF    TOTAPE
       BRU     TPF1             GO TO TAPE ROUTINES
       LDX     FORMS
       LDA     PGPOST,2
       STA     PGPOS
       SUB     SIX
       STA     DPOS
       ADD     THREE
       STA     IDENTP
       ADD     FIVE
       STA     PNPOS
       LDA     XL:PG
       MRG     K4B7
       STA     LINCT
       LDA     TOF
       CALL    PRCHAR
       LDA     P:RQN
       CALL    PB34
       LDA     BRNO
       CALL    PB36
       LDA     P:FL
       CALL    PB34
       CLA
       CALL    GSTNG
       STP     TP
       LDA     FILCT
       STA     T
PFI2   SKR     T
       BRU     *+2
       BRU     PFI3
       GCI     TP
       BRU     PFI4
       SKE     CR
       BRU     *-3
       BRU     PFI2
PFI3   GCI     TP
       BRU     PFI4
       SKE     K203
       SKNE    CR
       BRU     PFI4
       CALL    PRCHAR
       BRU     PFI3
PFI4   LDA     P:COP
       CALL    PB34
       LDA     TCOP
       CALL    PB36
       LDA     CR
       CALL    PRCHAR

       LDA     KM1
       STA     INFILE
       LDA     TOF
       CALL    PRCHAR
PF1    CALL    GICHAR
       BRU     EOFR
       CALL    PRCHAR
       BRU     PF1
EOFR   BRS     147
       CLA
       STA     INFILE
       LDA     TOF
       LDB     PAGE
       SKB     ONE
       BRU     *+2
       CALL    PRCHAR
       IF      -BTIOSW
       SKN     EXTRN
       BRU     *+2
       CALL    EXTOFF
       ENDF
EOFRS  SKNF    FRTAPE
       RET     PFILE
EOFR1  LDA     FILCT
       CALL    MFILNM
       BRS     48
       RET     PFILE
       LDA     K21B6
       CLB
       LDX     K14
       BRS     141
       BRU     EOFR1
       LDA     FILCT
       CALL    MFILNM
       LDX     ONE
       MRG     K516B5
       BRS     65
       BRU     *+2
       BRS     20
       RET     PFILE

TPF1   LDX     KTOBDT
       LDA     K2000
       BIO     IFILE
       MIN     EOFLG
       CLB
       STB     1,2
       SUB     KTOBDT
       SKG     ZERO
       BRU     TPF2
       ADD     TWO
       STA     TOBCTL
       LDA     DREC
       STA     TOBTYP
       CALL    TWTV
       SKN     EOFLG
       BRU     TPF2
       BRU     TPF1
TPF2   CALL    TEOF
       RET     PFILE


GICHAR  NOP     RT8
       SKR     MBCT
       BRU     GMBC
       SKR     CCT
       BRU     GNC
       MIN     IBP
       SKR     WDCT
       BRU     GNW
       SKN     EOFLG
       BRU     SEOF
       SKF     FRTAPE
       BRU     GDSRC
       CALL    RTREC
       BRU     SEOF
       LDA     TIBTYP
       SKE     DREC
       BRU     SEOF
       LDA     TBUFF
       ETR     ADMASK
       SUB     THREE
       STA     WDCT
       LDA     KTIDAT
       STA     IBP
       BRU     GNW
GDSRC  LDA     KDBFSZ
       LDX     KDBUF
       STX     IBP
       BIO     IFILE
       MIN     EOFLG
       SUB     KDBUF1
       STA     WDCT
GNW    LDB*    IBP
       STB     WORD1
       LDA     TWO
       STA     CCT
GNC    CLA
       LDB     WORD1
       LSH     8
       STB     WORD1
       SKN     MBFL
       BRU     GMBC1
       SKE     MB
       SKIPRT  GICHAR
       CLA
       STA     MBFL
       BRU     GICHAR+1

SEOF   LDA     EOFC
       RET     GICHAR
GMBC   CLA
       SKIPRT  GICHAR
GMBC1  STA     MBCT
       SKR     MBFL
       BRU     *-1
       BRU     GICHAR+1

PFE1   CALL    EXTOFF
       SETF    ERFLG
       LDP     TP
       LDX     ONE
       BRS     35
       TYPE    NOFND
       RET     PFILE


PRCHAR NOP     RT7
       SKE     CR
       SKNE    LF
       BRU     CKFL
       SKNE    TOF
       BRU     CKFL
       SKE     K140
       BRU     *+2
       RET     PRCHAR
       SKN     IDCNT
       CALL    SETID
       WCH     LINE
       RET     PRCHAR

*********************************************************
*
*      SET UP THE IDENT LINE
*
*********************************************************

SETID  NOP     RT10
       SKR     IDCNT
       NOP
       WCI     IP
       SKE     ZERO
       RET     SETID
       LDA     KM1
       STA     IDCNT
       CLA
       RET     SETID


************************************************
*
*      COMES HERE WHEN THE LINE WRAPS AROUND
*
************************************************

LWRAP  STA     TCH
       CBA
       ETR     ADMASK
       STA     WCHLOC
       LDA     CR
       CALL    PRLINE
       LDA     TCH
       BRU*    WCHLOC

CKFL   CALL    PRLINE
       RET     PRCHAR

PRLINE NOP     RT8
       STA     TTCH
       SPTR    LINEA
       ADD     LLTH            CALCULATE FULL LINE POINTER FOR HEADING
       SKN     HDINPS          AND USE IT IF HEADING IS IN PROCESS
       LDA     LINE            ELSE USE LINE FOR THE SECOND POINTER
       XAB                     PUT THEM IN PROPER ORDER
       STP     TP
       MIN     HDINPS          CLEAR HEADING IN PROCESS SWITCH
       SKN     EXTRN
       BRU     SPRL            GO TO CODE TO PRINT FOR SYSTEM PRINTERS


******************************************************************
*
*      THE FOLLOWING CODE IS FOR EXTERNAL PRINTERS
*
******************************************************************

       SKN     ONOFF           TURN ON PRINTER IF NECESSARY
       CALL    EXTON
EPRL   GCI     TP              GET A CHARACTER FORM THE STRING
       BRU     EPRL1           STRING FINISHED GO TERMINATE STRING
EPRL2  SKN     BLNKCT          ARE THERE ANY BLANKS PENDING
       BRU     BLNK            YES, SEE WHAT WE NEED TO DO
       SKNE    ZERO            IS THIS A BLANK
       BRU     BLNKI           YES, GO INITILIZE BLANKS
       ETR     K177            GET RID OF SIGN BITS
       SKG     K137            CKECK FOR CONTROL CHARACTERS
       BRU     *+2
       BRU     EPRL            DONT PRINT THEM
       SKG     K100            OR LOWER CASE CHARACTERS
       BRU     *+3
       SKF     FULLSW          CHECK FOR FULL CHARACTER PRINTER
       SUB     K40             IF NOT, MAKE IT UPPER CASE
       ADD     K40
       MRG     K200            MAKE IT A 8 LEVEL CHARACTER FOR PRINTING
       STA     T               SAVE IT FOR THE TCO THAT FOLLOWS
       SKP     PGCNTD          DONT IF IN RESTART
       BTCO    T               IT SAVES ABOUT 30 CYCLES/CHAR
       BRU     EPRL

EPRL1  LDA     KM1
       STA     BLNKCT          RESET BLANKCOUNT
       LDA     TTCH            GET THE TERMINATION CHARACTER
       SKE     CR
       SKNE    LF
       BRU     EEL             GOTO END OF LINE ROUTINE


******************************
*
*      TOP OF FORM ROUTINE
*
******************************

ETOF   LDA     XL:PG
       MRG     K4B7
       STA     LINCT           RESET THE LINE COUNTER
       LDA     KM1
       STA     ATOP            SET THE AT TOP OF FORM SWITCH
       SKR     PGCNTD          DON'T PRINT IF THE RESTART PAGE IS NOT REACHED
       BRU     SETUP
       LDX     EPTYPE          GET THE TYPE OF EXTERNAL PRINTER
       BTCO    TOFC1,2         SEND THE FIRST TOF CHARACTER BY TYPE
       SKN     TOFC2,2         DON'T SEND CHARACTER IF NEGATIVE
       BTCO    TOFC2,2
       SKN     TOFC3,2
       BTCO    TOFC3,2
       SKN     TOFC4,2
       BTCO    TOFC4,2
       LDA     BL:PG
       SUB     XL:PG
       SKG     ZERO
       BRU     SETUP
       LRSH    1
       STA     T
ETOF1  SKN     INFILE
       BRU     SETUP
       SKR     T
       BRU     *+2
       BRU     SETUP
       SKN     PGCNTD
       BRU     SETUP
       BTCO    EOLC1,2
       SKN     EOLC2,2         DON'T PRINT IF NEGITIVE
       BTCO    EOLC2,2
       BRU     ETOF1


****************************************************
*
*      COME HERE WHEN FORCING A TOP OF FORM BECAUSE
*      LINE COUNT HAS BECOME EXHAUSTED
*
****************************************************

FETOF  SKN     INFILE
       BRU     FETOF2
       LDA     XL:PG
       ADD     ONE
       SKE     BL:PG           CHECK FOR PAGES BEING FULL PAGES
       BRU     ETOF            IF NOT THEN DO TOF
FETOF2 SKR     PGCNTD
       BRU     FETOF1
       LDX     EPTYPE
       BTCO    EOLC1,2
       SKN     EOLC2,2
       BTCO    EOLC2,2
FETOF1 LDA     XL:PG
       MRG     K4B7
       STA     LINCT
       LDA     KM1
       STA     ATOP
       BRU     SETUP



******************************************************
*
*      END OF LINE CODE.  COMES HERE FOR A CARRIAGE
*      RETURN.  FORCE END OF LINES LOOK LIKE CARRIAGE
*      RETURNS TO THIS ROUTINE AND ARE TAKEN CARE OF
*      ELSEWHERE
*
*******************************************************

EEL    CLA
       STA     ATOP
       SKR     LINCT
       BRU     FETOF           FORCE EXTERNAL TOP OF FORM
       SKN     PGCNTD
       BRU     SETUP
       LDX     EPTYPE
       BTCO    EOLC1,2
       SKN     EOLC2,2
       BTCO    EOLC2,2
       SKN     INFILE
       BRU     SETUP
       SKN     XDBLSW
       BRU     SETUP
       SKR     LINCT
       BRU     FETOF
       SKN     PGCNTD
       BRU     SETUP
       BTCO    EOLC1,2
       SKN     EOLC2,2
       BTCO    EOLC2,2
       BRU     SETUP


***************************************************
*
*      THE FOLLOWING CODE WILL COMPRESS MULTIPLE
*      BLANKS AND WHEN A NON-BLANK CHARACTER IS
*      RECIEVED OUTPUT THE MULTIPLE BLANKS AS 
*      NETWORK UNDERSTANDS THEM.  THE MOST
*      THAN MAY BE SENT IS 37 BLANKS WHICH IS
*      REPRESENTED BY A 47 OCTAL.
*      BLANKS LESS THAN 37 OCTAL ARE SENT BY
*      ADDING 10 OCTAL TO THEM AND SENDING THAT
*      NUMBER
*
**************************************************


BLNK   SKE     ZERO
       BRU     BLNK1
       MIN     BLNKCT
       BRU     EPRL
BLNK1  XMA     BLNKCT
BLNK2  SKG     K37
       BRU     BLNK3
       SKP     PGCNTD
       BTCO    K47
       SUB     K37
       BRU     BLNK2
BLNK3  ADD     K10
       STA     T
       SKP     PGCNTD
       BTCO    T
       LDA     KM1
       XMA     BLNKCT
       BRU     EPRL2
BLNKI  LDA     ONE
       STA     BLNKCT
       BRU     EPRL


***************************************************
*
*      PRINT THE LINE ON SYSTEM PRINTERS
*
***************************************************

SPRL   GCI     TP
       BRU     SPRL1
       ETR     K177            GET RID OF PARITY
       SKG     K137
       BRU     *+2
       BRU     SPRL            DONT PRINT CONTROL CHARACTERS
       SKG     K100            CHECK FOR LOWER CASE
       BRU     *+2
       SUB     K40             LOWER CASE, CONVERT TO UPPER
       CAX
       LDA     LPOS
       SKA     THREE
       BRU     SPRL2
       LDA     WORD
       STA*    BPOS
       MIN     BPOS
       MIN     WDS
       COPY    A,B
       BRU     *+2
SPRL2  LDA     WORD
       CLB
       LSH     6
       MRG     BCDTAB,2
       STA     WORD
       MIN     LPOS            INCREMENT THE LINE OUNTER
       BRU     SPRL


***************************************************
*
*      COME HERE TO END A LINE ON A SYSTEM PRINTER
*
***************************************************

SPRL1  CALL    FILL            FILL THE LAST WORD WITH BLANKS
       LDA     TTCH            GET THE TERMINATION CHARACTER SAVED EARLIER
       SKE     CR
       SKNE    LF
       BRU     SEOL            GO JUST END A LINE
       BRU     STOF


***************************************************
*
*      END LINE ON SYSTEM PRINTER.  ALSO HAS AN
*      ENTRY POINT FOR A FORCED TOP OF FORM BECAUSE
*      THE LINE COUNT IS EXHAUSTED
*
***************************************************

SEOL   CLA
       STA     ATOP
       CALL    SETCCW          SET UP CHANNEL CONTROL WORD
       SKR     LINCT
       BRU     FSTOF           FORCE TO NEW PAGE
SEOL1  SKN     INFILE
       BRU     SEOL2
       SKN     XDBLSW
       BRU     SEOL2
       SKR     LINCT
       BRU     FSTOF
       LDA     K21
       STA*    BPOS
       MIN     BPOS
       LDA     BCDBLK
       STA*    BPOS
       MIN     BPOS
SEOL2  LDA     ONE
       STA     TCCW
       CALL    CKFLUSH
       BRU     SETUP


*****************************************************
*
*      SET UP TOP OF FORM FOR THE NEXT LINE
*
*****************************************************

STOF   CALL    SETCCW          SET UP CHANNEL CONTROL WORD
STOF3  LDA     SB21B
       STA*    BPOS            TELL NEXT TO BE A TOP OF FORM
       MIN     BPOS
       LDA     BCDBLK          BCD BLANKS 4 TO A WORD
       STA*    BPOS            BECAUSE SOME PRINTERS CANNOT TAKE ZERO WORD COUNT
       MIN     BPOS
       LDA     BL:PG
       SUB     XL:PG
       SKA     K4B7            BE SURE IT IS NOT NEGATIVE
       CLA                     IF IT IS MAKE IT ZERO
       RSH     1               DIVIDE BY TWO
       STA     TCCW            SAVE IT TEMPORARILY, WE DON'T NEED TCCW RIGHT NOW
       LDA     BPOS            THIS IS REQUIRED BY FLUSH
       CALL    FLUSH           PRINT THE PAGE
       SKR     PGCNTD          REDUCE RESTART COUNT
       NOP     0               BUT WE DONT CARE
       LDA     K21             TWO WORDS, SKIP ONE LINE
       LDB     BCDBLK          BLANKS IN B
STOF2  SKN     INFILE
       BRU     STOF1
       SKR     TCCW
       BRU     *+2
       BRU     STOF1           GET OUT OF CODE WHEN LINE ARE COMPLETED
       STA*    BPOS
       MIN     BPOS            PUT IN SKIP A LINE
       STB*    BPOS            WITH 4 BLANKS ON IT
       MIN     BPOS
       BRU     STOF2           AND KEEP LOOPING
STOF1  CLA                     SET UP TCCW SO THAT THERE IS NO SKIP
       STA     TCCW
       LDA     KM1
       STA     ATOP            SET ATOP SWITCH, WE ARE AT TOP OF FORM
       LDA     XL:PG
       MRG     K4B7            SET UP LINE COUNTER FOR SKR'S
       STA     LINCT
       CALL    CKFLUSH         DO THIS TO GET CCWP SET PROPERLY
       BRU     SETUP           SET UP FOR THE NEXT LINE(INCLUDING HEADINGS)


************************************************
*
*      FORCE A TOP OF FORM BECAUSE LINE COUNT
*      HAS BECOME EXHAUSTED.  THIS MUST BE DONE
*      WITH DISCRETION BECAUSE WE COULD HAVE THE
*      SAME NUMBER OF LINES PER PAGE AS BILLABLE
*      LINES PER PAGE
*
*************************************************

FSTOF  SKN     INFILE
       BRU     FSTOF2
       LDA     XL:PG
       ADD     ONE
       SKE     BL:PG
       BRU     STOF3           IT IS OK TO DO A TOP OF FORM
FSTOF2 LDA     XL:PG
       MRG     K4B7            SET UP LINCT AGAIN
       STA     LINCT
       LDA     KM1
       STA     ATOP
       LDA     BPOS
       CALL    FLUSH
       SKN     PGCNTD
       BRU     *+2
       BRU     SEOL1
       SKR     PGCNTD
       BRU     SEOL1
       BRU     STOF3


********************************************************
*
*      SUBROUTINES TO FLUSH BUFFERS AND TO CHECK IF THEY
*      SHOULD BE FLUSHED
*      WHEN THE PAGE IS FLUSHED, IT IS ZEROED OUT
*
**********************************************************

CKFLUSH NOP    RT9
       LDA     BPOS
       SKG     KBEND           ARE WE INTO THE SAFETY MARGIN
       BRU     CKF1            NO, SO WE WILL RETURN
       BRU     FLUSH           YES, GO FLUSH THE BUFFER
CKF1   STA     CCWP
       RET     CKFLUSH

FLUSH  NOP     RT9
       SKN     PGCNTD          CHECK ON THE RESTART POSSIBILITY
       BRU     FLUSH1          YUP, SO DON'T PRINT THIS PAGE
       SUB     KBUF1           GET THE NUMBER OF WORDS
       SKG     ZERO            IT HAD BETTER BE, OTHERWISE WHY WORRY
       BRU     FLUSH1
       COPY    AB              SAVE THE COUNT IN B
       CALL    ASGP            WHILE WE BE SURE TO GET THE PRINTER
       COPY    BX              AND THEN KEEP IT MOVING TO X
       LDA     KBUF            POINT A TO THE START OF THE BUFFER
       BRS     98              PRINT THE PAGE
       LDA     BUFF            GET THE ERROR INFO
       SKA     OPMASK          IF ANY ARE ON, WE HAVE AN ERROR
       BRU     FLUSHE          SO GO DO THE ERROR THING
FLUSH1 LDA     KBUF1           RE SET UP THE POINTER FOR THE BUFFER
       STA     BPOS
       STA     CCWP
       BRU     ZPG             AND ZERO OUT WHAT IS OUT THERE
*
* FLUSHE MODIFIED 9/16/76 FOR TSR54302 TO ALLOW CONTINUE
*
FLUSHE TYPE    POR             PRINTER OUT OF READY, THE ONY THING I CAN GET
       LDA ZERO
       STA BUFF
       LDA     PAGE
       PDEC    0               TELL HIM WHICH PAGE
       TYPE CONMSG             CONTINUE?
       CIO CIN                 GET CHARACTER
       SKE     K71             =Y?
       ERROR NULLMG
       CALL CLRIN
       BRU CKFLUSH


****************************************************
*
*      OTHER MISCELLANEOUS SUBROUTINES.
*
****************************************************

****************************************************
*
*      ZERO THE BUFFER PAGE.  THIS USES THE SAME CODE AS
*      DOES THE MONITOR TO ZERO THE PAGE.  SAVES 1000B MACINE
*      CYCLES
*
****************************************************
ZPG    NOP     RT9
       LDX     KM1B3           NEGITIVE 1000B
       CLA
       STA     BUFF+1000B,2
       STA     BUFF+2000B,2
       STA     BUFF+3000B,2
       STA     BUFF+4000B,2
       BRX     *-4
       RET     ZPG

*********************************************************
*
*      SET UP THE CURRENT CCW
*
*********************************************************

SETCCW NOP     RT10
       LDA     WDS             NUMBER OF WORDS FOR THIS LINE
       ADD     ONE             FOR THE CCW WORD
       CLB
       STB     WDS             RESET WDS
       STB     LPOS            AND THE LINE POSITION
       LSH     3               PUT INTO POSITION
       MRG     TCCW            WHICH WAS SET UP FROM THE LAST END OF LINE
       STA*    CCWP            THROUGH THE CCW POINTER
       RET     SETCCW

***********************************************
*
*      FILL THE WORD WITH BLANKS
*
***********************************************

FILL   NOP     RT10
       LDA     WDS
       SKNE    ZERO
       BRU     *+2
       BRU     FILL1
       LDA     BCDBLK
       STA     WORD
       MIN     BPOS
       MIN     WDS
FILL1  LDA     LPOS
       ETR     THREE
       CAX
       LDA     WORD
       LDB     BCDBLK
       EXU     SHIFT,2
       STA*    BPOS
       MIN     BPOS
       RET     FILL



*****************************************************
*
*      SET UP FOR THE NEXT LINE.  UNLESS WE ARE DOING HEADINGS
*      THIS DOES NOT REQUIRE MUCH WORK.  IF WE ARE DOING HEADINGS
*      THE HEADING IS SET UP IN THE LINE FIRST, AND THEN THE
*      CHARACTERS ARE PUT INTO THE LINE.  IF THERE IS ANY
*      OVERLAP, THE HEADING IS WRITTEN OVER AND IS LOST.
*      IF WE ARE ALSO INDENTING, THE HEADING STILL REMAINS IN THE
*      SAME PLACE SO THAT PAGE N DOES NOT APPEAR AS THE SECOND
*      LINE OF THE PAGE.
*
*****************************************************

SETUP  LDX     KM44D
       CLA
       STA     LINEAE,2
       BRX     *-1             MAKE THE LINE ALL BLANKS
       LDA     KM1
       STA     IDCNT
       SKN     ATOP
       BRU     SETUPZ          NOT AT TOP OF FORM
       MIN     PAGE            AT TOP OF FORM, INCREMENT COUNT
       SKN     INFILE          CHECK IF WE ARE PRINTING A FILE
       BRU     SETUPZ          IF NOT THEN DON'T DO HEADINGS
       SKN     XHSW            CHECK THAT HEADINGS ARE REQUESTED
       BRU     SETUPZ          NO, THEN DON'T DO THEM.

       STA     HDINPS          SET HEADING IN PROCESS SWITCH
       LDP     PGST
       STP*    PGPOS
       LDP     IDENT
       STP*    IDENTP
       SPTR*   PNPOS
       STP     PGPTR
       LDA     PAGE
       CLB
       LDX     FMT2            A FORMAT
       NISC    PGPTR           PUT THE NUMBER IN A STRING
       LDA     PAGE
       SKE     ONE
       BRU     SETUPZ          DON'T NEED ANYTHING ELSE FOR PAGES > 1


**********************************************************
*
*      SET UP DATE IN HEADING.  THIS IS DONE ONLY FOR THE
*      FIST PAGE IN A FILE.
*
**********************************************************

       SPTR*   DPOS            GET A POINTER FOR THE DATE POSITION
       STP     DP              DATE POINTER
       LDA     DATTIM
       LDX     K300
       BRS     176             GET DATE AND TIME IN A REASONABLE FORMAT
       STP     TP              AND SAVE IT FOR A WHILE
       ETR     MNMASK
       LRSH    10
       ADD     ONE             GET THE PROPER MONTH
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP              TENS DIGIT OF THE DATE
       CBA
       ADD     K20
       WCI     DP              AND THE ONES DIGIT OF THE MONTH
       LDA     K17             SLASH
       WCI     DP              AND WRITE A SLASH
       LDA     TP
       ETR     DTMASK          GET THE DAY OF THE MONTH
       LRSH    5
       ADD     ONE             BECAUSE OF THE FUNNY FORMAT
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP
       LDA     K17
       WCI     DP
       LDA     TP
       ETR     YRMASK
       LRSH    14
       ADD     K74
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP
       CLA
       WCI     DP
       WCI     DP
       LDA     TP
       ETR     K37             GET THE HOURS
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP
       LDA     K32
       WCI     DP
       LDP     TP
       CLA
       LRSH    17
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP              WHICH COMPLETES THE DATE STRING.

       LDA     FIVE
       STA     IDCNT
       SPTR    IDENT
       STP     IP


********************************************************
*
*      SET UP FOR THE STRING TO BE WRITTEN
*      INTO USING WCH
*
**********************************************************

SETUPZ SPTR    LINEA           GET THE START OF THE STRING
       SKP     INFILE
       ADD     XINDCT          ADD IN THE INDENT COUNT
       STA     LINE            AND START THE LINE AT THAT POINT.
       RET     PRLINE          AND RETURN

       OCT
TOFC1  DATA    215,214,214,215
TOFC2  DATA    240,-1,-1,214
TOFC3  DATA    215,-1,-1,-1
TOFC4  DATA    200,-1,-1,-1
EOLC1  DATA    215,215,212,215
EOLC2  DATA    201,200,-1,-1
       DEC

$LINE  ZRO
       DATA    LINEAE*3
       BRU     LWRAP

PAGE   ZRO
PGST   ASC     ' PAGE '
IDENT  BSS     2
IDCNT  ZRO

TCH    ZRO
TTCH   ZRO
BLNKCT ZRO
WCHLOC ZRO
HDINPS ZRO
DPOS   ZRO
PRINDT ZRO
PNPOS  ZRO
PGPOS  ZRO
IDENTP ZRO
PGPTR  BSS     2

$LINEA BSS     44
LINEAE BSS     2



SHIFT  NOP
       LSH     18
       LSH     12
       LSH     6
       NOP
BCDTAB DATA 60B,71B,14B,17B,53B,57B,57B,14B
       DATA 74B,34B,54B,20B,73B,40B,33B,61B
       DATA 00B,01B,02B,03B,04B,05B,06B,07B
       DATA 10B,11B,15B,56B,36B,13B,16B,32B
       DATA 17B,21B,22B,23B,24B,25B,26B,27B
       DATA 30B,31B,41B,42B,43B,44B,45B,46B
       DATA 47B,50B,51B,62B,63B,64B,65B,66B
       DATA 67B,70B,71B,35B,76B,55B,57B,17B
*LOCAL VARIABLES

CHAR   ZRO     0               LAST CHARACTER RETRIEVED FROM BUFFER
TCCW   ZRO     0               TEMP FOR CCW
TWDS   ZRO     0               TEMP FOR WDS
WORD   ZRO     0               WORD BEING ASSEMBLED
TBPOS  ZRO     0               SAME AS ABOVE EXCEPT THAT IT USED BY HEADING
BLINCT ZRO     0               NUMBER OF LINES ON CURRENT BILLABLE PAGE
LPOS   ZRO     0               POSITION IN LINE

PB34   NOP     RT6
       MUL     THREE
       LSH     23
       CAB
       ADD     K200D
       XAB
       SUB     ONE
       STP     BPTR
PB34A  GCI     BPTR
       RET     PB34
       SKNE    K17            SLASH
       RET     PB34
       SKNE    FOUR
       LDA     CR
       CALL    PRCHAR
       BRU     PB34A

PB35   NOP     RT6
       STP     BPTR
       GCI     BPTR
       RET     PB35
       CALL    PRCHAR
       BRU     *-3

PB36   NOP     RT6
       STA     T
       SPTR    NUMSTG
       STP     BPTR
       LDX     K1B7
       LDA     T
       NISC    BPTR
       LDP     BPTR
       BRU     PB35
BPTR   BSS     2


***********************************************
*
*      TURN ON EXTERNAL PRINTER IN CDC MODE
*
***********************************************

EXTON  NOP     RT11
       STA     N1
       LDX     KM1
       STX     ONOFF
       LDA     TERM
       BRS     168
       BRS     85
       SYSTCO  K202
*      LDA     TERM
*      ETR     NOT:A
*      MRG     A:7
*      STA     T1
*      EOR     CLCFIX
*      BRS     160
*      SYSTCO  K202
*      LDA     T1
*      EOR     CLCFIX
       LDX     EPTYPE
       SYSTCO  EOLC1,2
       SKN     EOLC2,2
       SYSTCO  EOLC2,2
       IF      BTIOSW
       CALL    SETBIO
       ENDF
       CLX
       LDA     N1
       RET     EXTON
*NOT:A  DATA    77617777B
*CLCFIX DATA    16B4+7B3
*A:7    DATA    127B3


**************************************
*
*      HEADING MESSAGES
*
**********************************************************

P:FL   ASCS    '$FILE NAME: /'
P:RQN  ASCS    '$REQUEST NUMBER: /'
P:COP  ASCS    '$COPY /'


******************************************************
*
*      LOCAL VALUES WHICH SHOULD NOT BE CHANGED
*      BUT ARE NOT NEEDED IN CONSTANT PACKAGE
*
******************************************************

DREC   DATA    22222222B

BCDBLK DATA    60606060B
KDBUF  DATA    DBUFF
KDBUF1 DATA    DBUFF+1
KDBFSZ DATA    DBUFSZ
KBEND  DATA    BUFF-34+3777B
KBUF   DATA    BUFF
KBUF1  DATA    BUFF+1
KTIDAT DATA    TIBDAT
KTOBDT DATA    TOBDAT
K21    DATA    21B
K32    DATA    32B
KM44D  DATA    -44
K140   DATA    140B
K200D  DATA    200
K2000  DATA    2000B
KM1B3  DATA    -1000B

FMT2   DATA    10003B3

PRITER DATA    2127000B        TERMINAL CHARACTERISTICS FOR PRINT
SB21B  DATA    21B+4B7
K776B5 DATA    776B5
K21B6  DATA    21B6
K516B5 DATA    516B5


****************************************************
*
*      TABLE FOR HEADINGS
*
*****************************************************

PGPOST ZRO
       DATA    LINEA+32
       DATA    LINEA+40
       DATA    LINEA+23
       DATA    LINEA+40
       DATA    LINEA+32
       DATA    LINEA+40

$LLTHTB DATA   132
       DATA    108
       DATA    132
       DATA    80
       DATA    132
       DATA    108

       NOLIST EXT
RELORG EQU     *
       END
SPOOL ** FICHE/FRAME BREAK *****
SPDVR SYMSORT

SYM.  PG.LN. IDENT.

BCDBLK 26  8 DVR     BCDTAB 23 23 DVR     BLINCT 23 38 DVR     
BLNK   12 11 DVR     BLNK1  12 15 DVR     BLNK2  12 16 DVR     BLNK3  12 22 DVR     
BLNKCT 23  3 DVR     BLNKI  12 29 DVR     BPTR   24 35 DVR     CHAR   23 33 DVR     
CKF1   16 29 DVR     CKFL    8 14 DVR     CKFLUS 16 24 DVR     DPOS   23  6 DVR     
DREC   26  6 DVR     EEL    11 14 DVR     EOFR    4  7 DVR     EOFR1   4 22 DVR     
EOFRS   4 20 DVR     EOLC1  22 27 DVR     EOLC2  22 28 DVR     EPRL    8 35 DVR     
EPRL1   9 17 DVR     EPRL2   8 37 DVR     ETOF    9 28 DVR     ETOF1  10 10 DVR     
EXTON  25  2 DVR     FETOF  10 27 DVR     FETOF1 10 39 DVR     FETOF2 10 33 DVR     
FILL   18 31 DVR     FILL1  19  1 DVR     FLUSH  16 32 DVR     FLUSH1 17  7 DVR     
FLUSHE 17 14 DVR     FMT2   26 25 DVR     FSTOF  15 37 DVR     FSTOF2 16  4 DVR     
GDSRC   6  7 DVR     GICHAR  5 22 DVR     GMBC    6 32 DVR     GMBC1   6 34 DVR     
GNC     6 18 DVR     GNW     6 14 DVR     HDINPS 23  5 DVR     IDCNT  22 38 DVR     
IDENT  22 37 DVR     IDENTP 23 10 DVR     K140   26 20 DVR     K2000  26 22 DVR     
K200D  26 21 DVR     K21    26 17 DVR     K21B6  26 30 DVR     K32    26 18 DVR     
K516B5 26 31 DVR     K776B5 26 29 DVR     KBEND  26 12 DVR     KBUF   26 13 DVR     
KBUF1  26 14 DVR     KDBFSZ 26 11 DVR     KDBUF  26  9 DVR     KDBUF1 26 10 DVR     
KM1B3  26 23 DVR     KM44D  26 19 DVR     KTIDAT 26 15 DVR     KTOBDT 26 16 DVR     
LINE   22 31 DVR     LINEA  23 13 DVR     LINEAE 23 14 DVR     LLTHTB 27  9 DVR     
LPOS   23 39 DVR     LWRAP   8  5 DVR     OM**** 25 33 DVR     OM**** 24 37 DVR     
OM**** 22 11 DVR     OM**** 20 13 DVR     OM**** 19 12 DVR     OM**** 17 26 DVR     
OM**** 16 18 DVR     OM**** 15 29 DVR     OM**** 14 25 DVR     OM**** 13 36 DVR     
OM**** 13 25 DVR     OM**** 12 33 DVR     OM**** 11 37 DVR     OM**** 10 22 DVR     
OM****  9 24 DVR     OM****  8 29 DVR     OM****  8  1 DVR     OMM*** 26  1 DVR     
OMM*** 11  7 DVR     P:COP  25 39 DVR     P:FL   25 37 DVR     P:RQN  25 38 DVR     
PAGE   22 35 DVR     PB34   24  2 DVR     PB34A  24 10 DVR     PB35   24 19 DVR     
PB36   24 26 DVR     PF1     4  3 DVR     PFE1    6 39 DVR     PFI1    1 15 DVR     
PFI1A   1 30 DVR     PFI1B   1 38 DVR     PFI1C   2  7 DVR     PFI1D   2  1 DVR     
PFI2    3 16 DVR     PFI3    3 24 DVR     PFI4    3 31 DVR     PFI5    2 16 DVR     
PFILE   1 13 DVR     PGPOS  23  9 DVR     PGPOST 27  1 DVR     PGPTR  23 11 DVR     
PGST   22 36 DVR     PNPOS  23  8 DVR     PRCHAR  7  9 DVR     PRINDT 23  7 DVR     
PRITER 26 27 DVR     PRLINE  8 17 DVR     RELORG 27 17 DVR     SB21B  26 28 DVR     
SEOF    6 30 DVR     SEOL   14  3 DVR     SEOL1  14  8 DVR     SEOL2  14 20 DVR     
SETCCW 18 14 DVR     SETID   7 29 DVR     SETUP  19 23 DVR     SETUPZ 22 16 DVR     
SHIFT  23 18 DVR     SPRL   12 37 DVR     SPRL1  13 29 DVR     SPRL2  13 17 DVR     
STOF   14 29 DVR     STOF1  15 19 DVR     STOF2  15  9 DVR     STOF3  14 30 DVR     
TBPOS  23 37 DVR     TCCW   23 34 DVR     TCH    23  1 DVR     TOFC1  22 23 DVR     
TOFC2  22 24 DVR     TOFC3  22 25 DVR     TOFC4  22 26 DVR     TPF1    5  1 DVR     
TPF2    5 18 DVR     TTCH   23  2 DVR     TWDS   23 35 DVR     WCHLOC 23  4 DVR     
WORD   23 36 DVR     ZPG    17 37 DVR     
SPOOL ** FICHE/FRAME BREAK *****
SPFIL
FIL    IDENT                   SEP 08, 1975
*
*      THIS PACKAGE DEFINES THE ACCESS METHODS TO THE CONTROL
*      FILE FOR THE ENTIRE BATCH/SPOOLING SYSTEM.  ALL READING
*      AND WRITING OF THE FILE WILL BE CONTROLLED IN THIS MANNER.
*      
*      THIS SHOULD ALLOW THE SYSTEM SOME CONTROL OVER HOW
*      THE FILE IS HANDLED.  THE CONTROL IS FURTHER
*      ENHANCED BY NOT ALLOWING THE FILE TO BE OPEN OUTSIDE OF THIS
*      PACKAGE.
*
*      THE CURRENT ROUTINES THAT ARE AVAILABLE OUTSIDE THIS PACKAGE
*      ARE

*
*

*      THE FOLLOWING ROUTINES WERE ADDED 3/14/75
*      THEY REPLACE THE EXISTING ROUTINES.

       ENTRY   ADDJB,GNJOB,G1JOB,GLCJB,CMPJB,GSTARA
       ENTRY   GREC,WREC,GSTNG,CTSTNG,MUPD,INIT
       ENTRY   GDREC,SIMAP,RNP,GRECN,UPDATE
*      TROUTINE UPDATE ADDED 8/26/76 TO UPDATE MAP

*      ADD JOB TO LIST

ADDJB  NOP     RT8
       CALL    OPCFO
       CALL    GMAP
       CALL    WVLR
       LDA     NPRN
       STA     MINDEX
       CALL    WCLR
       LDA     BRNO
       LDX     MINDEX
       STA     RMAP,2
       MIN     NPRN
       CALL    UPDR0
       CALL    CLCF
       RET     ADDJB

*      GET NEXT JOB FROM LIST

GNJOB  NOP     RT6
       LDX     MINDEX
       CLA
       STA     RMAP,2
       MIN     MINDEX
       LDA     MINDEX
       SKNE    NPRN
       BRU     GNJ1
       CAX
       LDA     RMAP,2
       ETR     =777777B
       STA     RQSN
       SKNE    =0
       BRU     GNJ2
       CALL    GREC
       SKN     BRNO
       SKIPRT  GNJOB
       BRU     GNJOB
GNJ2   CXA
       SKG     NPRN
       BRU     GNJOB+1
GNJ1   CLA
       STA     RMAPSW
       RET     GNJOB

G1JOB  NOP     RT8
       CALL    OPCFI
       CALL    GMAP
       CALL    CLCF            GET CURRENT INFO IN
       CLX
       STX     MINDEX
       LDA     RMAP
       ETR     =777777B
       STA     RQSN
       RET     G1JOB

CMPJB  NOP     RT8
       LDA     JBSTA
       MRG     =DONE
       STA     JBSTA
       CALL    OPCFO
       CALL    WCLR
       CALL    GMAP
       LDX     MINDEX
       LDA     RMAP,2
       MRG     =DONE
       STA     RMAP,2
       CALL    UPDR0
       CALL    CLCF
       RET     CMPJB

GLCJB  NOP     RT8             GET LAST COMPLETED JOB
       CALL    OPCFI
       CALL    GMAP
       CALL    CLCF            GET LATEST INFO
       CLX
       LDA     =-1
       LDB     =4B7
GLCJ   SKA     RMAP,2
       BRU     *+2
       BRU     GLCJB1
       SKB     RMAP,2
       BRU     *+2
       BRU     GLCJB2
       EAX     1,2
       BRU     GLCJ
GLCJB2 MIN*    GLCJB
       LDA     RMAP,2
       STA     RQSN
GLCJB1 STX     MINDEX
       RET     GLCJB



WVLR   NOP     RT9
       CLA
       STA     EOFCP
       LDA     ECP             CURSOR POSITION FOR END OF FILE
       STA     STCP
       MRG     =4B7
       SCP     CF              SET TO WRITE MODE AT END
       HLT
       LDP     FNSP            FILE NAMES
       CALL    WSTNG
       LDA     EOFCP
       STA     TELCP
       LDP     RQTP
       CALL    WSTNG           WRITE REQUESTORS TELEPHONE NUMBER
       LDA     EOFCP
       STA     DELCP
       LDP     DELIP
       CALL    WSTNG           WRITE DELIVERY INSTRUCTIONS
       LDA     EOFCP
       STA     DADCP
       LDP     DELAP           
       CALL    WSTNG           WRITE DELIVERY ADDRESS
       LDA     EOFCP
       STA     SPFCP
       LDP     SPFP
       CALL    WSTNG
       LDA     EOFCP
       STA     SPICP
       LDP     SPIP
       CALL    WSTNG
       LDA     EOFCP
       STA     RQNCP
       LDP     RQNP
       CALL    WSTNG
       LDA     EOFCP
       LRSH    23
       DIV     =3
       CBA
       SUB     =3
       CAX
       LDA     =164B           DC4, CONTROL T
       CIO     CF              PAD WITH DC4 TO AID IN GARBAGE COLLECTION
       MIN     EOFCP           INCREMENT END
       BRX     *-2
       LDA     EOFCP
       ADM     ECP
       RET     WVLR

*      WRITE CONTROL INFORMATION (FIXED LENGTH)

WCLR   NOP     RT10
       LDA     =-1
       STA     STNGSW
       STA     DPIC
       LDA     MINDEX
       MUL     =3*RECSIZ
       LSH     23
       ADD     =1024*3
       MRG     =4B7
       MRG     =4B7
       SCP     CF
       HLT
       LDA     =RECSIZ
       LDX     =PCB            
       BIO     CF              WRITE OUT THE RECORD
       HLT
       RET     WCLR

*      UPDATE RECORD ZERO

UPDR0  NOP     RT10
       LDA     =4B7
       SCP     CF
       HLT
       LDA     =1024
       LDX     =FISTAT
       BIO     CF              REWRITE THE RECORD
       HLT
       RET     UPDR0

*      WRITE STRING

WSTNG  NOP     RT10
       SKNE    =0
       BRU     WSTNG1
       STP     TP
       LDA     TP+1
       SUB     TP
       ADM     EOFCP
       GCI     TP
       BRU     WSTNG1
       CIO     CF
       BRU     *-3
WSTNG1 LDA     =163B           DC3
       CIO     CF
       MIN     EOFCP
       RET     WSTNG



*      OPEN CONTROL FILE FOR OUTPUT

OPCFO  NOP     RT9
       DISABLE
       LDP     CFNP
       MRG     =516B5
       LDX     =2
       BRS     65
       BRU     OPCFOE
       STA     CF
       RET     OPCFO
OPCFOE ENABLE
       CALL    CKBUSY
       ERROR   BF              (CANNOT FIND FILE)
       BRS     45              WAIT 3 SEC
       BRU     OPCFO+1         AND TRY AGAIN

*      OPEN CONTROL FILE FOR INPUT

OPCFI  NOP     RT9
       DISABLE
       LDP     CFNP
       MRG     =502B5
       BRS     64
       BRU     OPCFIE
       STA     CF
       SKN     RMAPSW
       CALL    GMAP
       RET     OPCFI
OPCFIE ENABLE
       CALL    CKBUSY
       ERROR   BF
       BRS     45
       BRU     OPCFI+1

*      GET THE MAP IN
GMAP   NOP     RT10
       CLA
       SCP     CF
       NOP
       LDA     =1024
       LDX     =FISTAT
       BIO     CF
       ERROR   BF
       LDA     =-1
       STA     RMAPSW
       RET     GMAP


*      MAKE IT SO I GET A NEW MAP

SIMAP  NOP     RT10
       CLA
       STA     RMAPSW
       RET     SIMAP
*      GET A (POSSIBLE) DUPLICATE RECORD FROM THE FILE

GDREC  NOP     RT6
       LDX     MINDEX
       CLA
       STA     RMAP,2
       CALL    GREC
       LDA     BRNO
       SKNE    ZERO
       RET     GDREC
       SKE     KM1
       SKIPRT  GDREC
       BRU     GDREC
       RET     GDREC
       SKIPRT  GDREC

*      GET A RECORD FROM THE CONTROL FILE

GREC   NOP     RT7
       SKN     RMAPSW          IS IT IN
       BRU     *+2             NO
       BRU     *+3
       CALL    OPCFI
       CALL    CLCF
       LDA     =-1
       STA     STNGSW
       STA     RMAPSW
       CALL    SLAB
       LDA     RQSN
       LDB     =777777B
       LDX     =RMAP-RMAPE
       SKM     RMAPE,2
       BRU     *+2
       BRU     GREC1
       BRX     *-3
       CLA
       STA     BRNO
       CALL    SLAB            RESET THE RELABELING
       RET     GREC
GREC1  CXA
       ADD     =RMAPE-RMAP
       STA     MINDEX
       LRSH    11-RECEXP       GET THE PAGE IN A
       SKE     DPIC
       CALL    GPAGE
       LDA     MINDEX
       ETR     =2^[11-RECEXP]-1        SET UP WHICH RECORD
       CLB
       LSH     RECEXP          AND THEN THE INDEX
       ADD     =TPAGE
       ADD     =RECSIZ
       MRG     =2B7
       STA     DBE
       LDX     =-RECSIZ
       LDA*    DBE
       STA     PCBE,2
       BRX     *-2
       CALL    SLAB
       SKNF    COPER
       RET     GREC
       LDA     UUN
       SKNE    CUUN
       RET     GREC
       LDB     CPARW
       SKB     K2B6
       BRU     *+2
       BRU     CKREC1
       LDA     CGAN
       SKNE    GAN
       RET     GREC
CKREC1 SKB     K4B7
       BRU     *+2
       BRU     CKREC2
       LDA     CDIST
       SKNE    DIST
       RET     GREC
       SKF     ROPER
       BRU     CKREC2
       LDA     CPRLOC
       SKE     PRILOC
       BRU     CKREC2
       LDB     JBSTA
       SKB     REMFLG
       RET     GREC
CKREC2 LDA     KM1
       STA     BRNO
       RET     GREC

GRECN  NOP     RT6
       CALL    GREC
       LDA     BRNO
       SKNE    ZERO
       RET     GRECN
       SKE     KM1
       SKIPRT  GRECN
       LDX     MINDEX
       CLA
       STA     RMAP,2
       BRU     GREC


*      SET RELABLELING

SLAB   NOP     RT10
       BRS     43
       XAB
       XMA     DLAB
       XAB
       BRS     44
       RET     SLAB

*      GET DISC PAGE

GPAGE  NOP     RT8
       STA     DPIC
       MUL     =3*2048
       LSH    23
       ADD     =1024*3
       STA     T
       CALL    OPCFI
       LDA     T
       SCP     CF
       ERROR   BF
       LDA     =4000B
       LDX     =TPAGE
       BIO     CF
       ERROR   BF
       CALL    CLCF
       RET     GPAGE



*      CLOSE CONTROL FILE

CLCF   NOP     RT10
       LDA     CF
       BRS     20
       ENABLE
       RET     CLCF



*      WRITE RECORD

WREC   NOP     RT8
       CALL    OPCFO
       CALL    WCLR
       CALL    CLCF
       RET     WREC

GSTARA NOP     RT8             GET STRING AREA
       CALL    OPCFI
       LDA     STCP
       SCP     CF
       ERROR   BF
       SPTR    TOBDAT+RECSIZ
       STP     TP
       LDA     =TP
       LDB     =164B           DC4 RECORD TERMINATING CHAR
       LDX     CF
       BRS     33
       CALL    CLCF
       RET     GSTARA


*      READ STRING FROM CURSOR POSITION

GSTNG  NOP     RT7
       STA     T1
       CALL    GSTPG
       SPTR    STPG
       ADD     T1
       STA     TP
       STA     T
       ADD     =14000B         A WHOLE BUNCH OF CHARACTERS
       STA     TP+1
       GCI     TP
       HLT     0               "THIS SHOULD NEVER HAPPEN"
       SKE     =163B
       BRU     *-3
       LDA     T
       SKR     TP              GET RID OF THE LAST CHAR
       LDB     TP
       RET     GSTNG

GSTPG  NOP     RT8
       SKN     STNGSW
       RET     GSTPG
       CALL    OPCFI
       LDA     STCP
       SCP     CF
       NOP
       SPTR    STPG
       STP     TP
       LDA     =TP
       LDB     =164B
       LDX     CF
       BRS     33
       CALL    CLCF
       CLA
       STA     STNGSW
       RET     GSTPG

CTSTNG NOP     RT10
       LDX     =RECSIZ-2000B
       LDA     TIBDAT+2000B,2
       STA     STPG+2000B-RECSIZ,2
       BRX     *-2
       CLA
       STA     STNGSW
       RET     CTSTNG



*      MONTHLY UPDATE OF FILE
*      THIS GUY BELONGS IN FILCTL BECAUSE OF THE
*      INTERACTION THAT IS REQUIRED.

MUPD   NOP     RT8
       CALL    GTDATE
       STA     TDATE
       CALL    OPCFI
       CALL    CLCF
       LDA     TDATE
       SKG     LGCDAT
       RET     MUPD
       LDP     RNP
       LDX     RNPX
       BRS     58
       RET     MUPD
       DISABLE
*      FROM HERE ON OUT DO NOT TRAP, BUT PUT OUT ERROR
*      MESSAGE AND RENAME THE FILE BACK AT MUPDER

       LDP     CFNP
       MRG     =316B5
       LDX     =2
       BRS     65              OPEN THE NEW FILE
       CALL    MUPDER
       STA     OFILE
       LDA     =3*[RECSIZ*NJOBS+1024]+4B7
       SCP     OFILE           SET TO STRING AREA
       CALL    MUPDER
       LDP     CFNP2           OLD FILE
       MRG     =316B5
       BRS     64              OPEN IT
       CALL    MUPDER
       STA     IFILE
       LDA     =3*1024
       SCP     IFILE
       CALL    MUPDER
       LDX     =-NJOBS
       CLA
       STA     RMAPE,2
       BRX     *-1
MUPD1  LDX     =PCB
       LDA     =RECSIZ
       BIO     IFILE
       CALL    MUPDER
       LDA     DATE
       SKNE    =0
       CALL    MUPDER          NO REQUESTS FOR THE PAST MONTH?
       SKG     TDATE
       BRU     MUPD1

*      I HAVE IN HAND THE 1ST RECORD FOR THE
*      NEW FILE, I WILL TAKE CARE OF IT LATER

       RCP     IFILE
       STA     T               NEED TO KEEP THIS AROUND

*      WE NEXT TAKE THE ENTRIE STRING AREA THAT IS VALID
*      AND MOVE IT IN MASS

       LDA     STCP            STARTING CURSOR POSITION
       SCP     IFILE
       CALL    MUPDER
       LDA     =-1
       STA     EOFLG
MUPD2  LDX     =IBUFF
       LDA     =400B
       BIO     IFILE
       NOP
       SUB     =IBUFF
       SKE     =400B
       MIN     EOFLG
       LDX     =IBUFF
       BIO     OFILE
       CALL    MUPDER
       SKP     EOFLG
       BRU     MUPD2
       RCP     OFILE
       ETR     =@4B7
       STA     ECP
*
*      STRING AREA IS WRITTEN, NOW FOR THE RECORDS
*
       LDA     =3*1024+4B7
       SCP     OFILE
       CALL    MUPDER
       LDA     T
       SCP     IFILE
       CALL    MUPDER
       LDA     STCP
       SUB     =3*[RECSIZ*NJOBS+1024]
       STA     DIF
       LDA     =RMAP
       STA     RMAPP
MUPD3  LDA     BRNO
       SKNE    =0
       BRU     MUPDND          DONE
       LDB     JBSTA
       SKB     =DONE
       MRG     =DONE
       STA*    RMAPP
       LDA     STCP
       SUB     DIF
       STA     STCP
       LDA     =RECSIZ
       LDX     =PCB
       BIO     OFILE
       CALL    MUPDER
       MIN     RMAPP
       LDA     =RECSIZ
       LDX     =PCB
       BIO     IFILE
       CALL    MUPDER
       BRU     MUPD3

*      END OF MONTHLY UPDATE

MUPDND LDA     RMAPP
       SUB     =RMAP
       SKG     =-1
       CLA
       STA     NPRN
       LDA     TDATE
       STA     LGCDAT
       LDA     =4B7
       SCP     OFILE
       CALL    MUPDER
       LDA     =1024
       LDX     =FISTAT
       BIO     OFILE
       CALL    MUPDER
       BRS     147             THE WORLD IS UPDATED MUPDER IS NOT NEEDED
       LDP     CFNP2
       BRS     48
       NOP
       BRS     69
       NOP
       ENABLE
       RET     MUPD

*      ERROR IN UPDATE, MUST TRY TO RESTORE THINS THE WAY THEY WERE

MUPDER NOP
       BRS     147             CLOSE THE WORLD, I WANT TO GET OFF
       LDP     CFNP
       BRS     48
       NOP
       BRS     69              DELETE THE NEW FILE
       NOP
       LDP     RRNP
       LDX     RRNPX
       BRS     58
       BRU     MUPER1
       TYPE    MUPEM           ERROR MESSAGE
       ENABLE
       RET     MUPD            BUT CONTINUE
MUPER1 TYPE    MUPEM1
       ENABLE
       BRS     10

*      INITLIZE  FILE (REQUIRES EXEC STATUS)

INIT   DATA    52525252B
       BRS     71
       HLT     0
       SKB     =2B7
       BRU     *+2             YES
       HLT     0               NOPE
       LDP     CFNP
       BRS     48
       BRU     *+2             IT'S NOT THERE - GOOD
       RET     INIT
       LDP     CFNP
       LDX     =2
       MRG     =716B5          TURN ON EVERYTHING
       BRS     65
       HLT     0               MIGHT AS WELL IT'LL TELL INSTALLER
       STA     T
       CLA
       WIO     T
       LDA     =3*RECSIZ*NJOBS+3072
       WIO     T
       LDA     =-1
       LDX     =300B
       BRS     176
       WIO     T
       LDA     =3*RECSIZ*NJOBS+3072+4B7
       SCP     T
       HLT
       BRS     17
       RET     INIT

*      LOCAL VARIABLES FOR THE FILE MANIPULATION FILE

DPIC   DATA    -1              DISC PAGE IN CORE
DLAB   ZRO     0               RELABELING OF DISC PAGE
DBE    ZRO     0               DISC BUFFER ADDRESS
T      ZRO     0
T1     ZRO     0
STNGSW ZRO     0
RMAPSW ZRO     0
DIF    ZRO     0               DIFFERENCE FOR GARBAGE COLLECTION
RMAPP  ZRO     0               POINTER INTO RMAP
TP     BSS     2               TEMP FOR POINTERS
MINDEX ZRO    0
CF     ZRO     0               FOR THE FILE NUMBER

*      CONTROL FILE NAME


       IF      FTSW
RFN    ASC     '(SSPRINT)CTLSP(SSPRINT)CTLSO(SSPRINT)CTLSP'
RNP    DATA    3*RFN-1
RRNP   DATA    3*RFN+13
RNPX   DATA    3*RFN+27
RRNPX  DATA    3*RFN+41
       ELSF    DEBUG
RFN    ASC     '(CCARTER)CTLSP(CCARTER)CTLSO(CCARTER)CTLSP'
RNP    DATA    3*RFN-1
RRNP   DATA    3*RFN+14-1
RNPX   DATA    3*RFN+29
RRNPX  DATA    3*RFN+44
       ELSE
RFN    ASC     '(SPOOL)CTLSP(SPOOL)CTLSO(SPOOL)CTLSP'
RNP    DATA    3*RFN-1
RRNP   DATA    3*RFN+11
RNPX   DATA    3*RFN+23
RRNPX  DATA    3+RFN+35
       ENDF
CFNP   EQU     RNP
CFNP2  EQU     RRNP


*
*      THIS ROUTINE WILL OPEN CONTROL FILE FOR OUTPUT
*         READ MAP
*         SET UPDTTD TO CDATE
*         WRITE MAP
*         CLOSE CONTROL FILE
UPDATE NOP     RT8
       CALL    OPCFO           OPEN CONTROL FILE FOR OUTPUT
       CALL    GMAP            GET THE MAP
       LDA     CDATE           CURRENT DATE
       STA     UPDTTD          STORE THE DATE
       CALL    UPDR0           UPDATE MAP
       CALL    CLCF            CLOSE THE FILE TURKEY
       RET     UPDATE
       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPFIL SYMSORT

SYM.  PG.LN. IDENT.

ADDJB   1 28 FIL     CF     18 30 FIL     CFNP   19 15 FIL     
CFNP2  19 16 FIL     CKREC1  9 32 FIL     CKREC2 10  7 FIL     CLCF   11 18 FIL     
CMPJB   3  3 FIL     CTSTNG 13  9 FIL     DBE    18 21 FIL     DIF    18 26 FIL     
DLAB   18 20 FIL     DPIC   18 19 FIL     G1JOB   2 31 FIL     GDREC   8  3 FIL     
GLCJ    3 25 FIL     GLCJB   3 18 FIL     GLCJB1  3 36 FIL     GLCJB2  3 33 FIL     
GMAP    7 21 FIL     GNJ1    2 27 FIL     GNJ2    2 24 FIL     GNJOB   2  6 FIL     
GPAGE  10 36 FIL     GREC    8 19 FIL     GREC1   9  1 FIL     GRECN  10 11 FIL     
GSTARA 11 34 FIL     GSTNG  12 12 FIL     GSTPG  12 30 FIL     INIT   17 26 FIL     
LM*M*  19 18 FIL     MINDEX 18 29 FIL     MUPD   13 24 FIL     MUPD1  14 22 FIL     
MUPD2  15  7 FIL     MUPD3  15 36 FIL     MUPDER 17  6 FIL     MUPDND 16 20 FIL     
MUPER1 17 20 FIL     OPCFI   7  4 FIL     OPCFIE  7 14 FIL     OPCFO   6 26 FIL     
OPCFOE  6 35 FIL     RFN    19  9 FIL     RFN    19  3 FIL     RFN    18 36 FIL     
RMAPP  18 27 FIL     RMAPSW 18 25 FIL     RNP    19 10 FIL     RNP    19  4 FIL     
RNP    18 37 FIL     RNPX   19 12 FIL     RNPX   19  6 FIL     RNPX   18 39 FIL     
RRNP   19 11 FIL     RRNP   19  5 FIL     RRNP   18 38 FIL     RRNPX  19 13 FIL     
RRNPX  19  7 FIL     RRNPX  19  1 FIL     SIMAP   7 36 FIL     SLAB   10 26 FIL     
STNGSW 18 24 FIL     T      18 22 FIL     T1     18 23 FIL     TP     18 28 FIL     
UPDATE 19 23 FIL     UPDR0   5 33 FIL     WCLR    5 13 FIL     WREC   11 28 FIL     
WSTNG   6  6 FIL     WSTNG1  6 17 FIL     WVLR    4  2 FIL     
SPOOL ** FICHE/FRAME BREAK *****
SPINIT
INIT   IDENT   ONCE ONLY CODE TO SET PARAMETERS  JAN 22, 1975
$SINIT ZRO
       STP     CIN
       LDA     KM1
       STA     INIT
       BRS     39
       STA     CPARW
       STB     CUUN
       LRSH    2
       ETR     =1777B
       SKG     NINE
       SETF    CORPFL
       LDA     CPARW
       SKA     K1B7
       BRU     *+2
       BRU     I1
       LDA     =69
       LDB     =CDIST
       LDX     =1
       BRS     67
       BRS     71
       BRU     SI1
       SETF    OPER
       SETF    COPER
       SETF    STAFLG
       SETF    ROPER
       BRU     I1
SI1    LDA     CDIST
       SKA     K2B6
       SETF    ROPER
       SKA     K2B6
       SETF    OPER
       SKA     K3777
       BRU     I1
       SKA     K4B7
       SETF    COPER
       SKA     K4B7
       SETF    OPER
I1     LRSH    2
       ETR     =1777B
       STA     CDIST
       LDX     KM1
       BRS     132
       STA     TERM
       LDA     =31
       LDB     =CGAN
       LDX     =1
       BRS     67
       LDA     KM1
       LDX     K300
       BRS     176
       STA     CDATE
       LDA     KM1
       CLX
       BRS     176
       STA     CDTTIM
       IF      DEBUG
       LDA     =11
       ELSE
       LDA     =LUD
       LDB     =200B
       LDX     =100B
       BRS     124
       LDA     LUD+75B
       LRSH    12
       ENDF
       STA     CCPNO
       MUL     =1000
       LSH     23
       STA     C000
       LDA     =CENLOC
       LDX     =11
       BRS     7
       CLA
       LDB     CENLOC
       LSH     8
       SKA     KM1
       BRU     *+2
       BRU     *-3
       CLB
       SKNE    =43B            CUPERTINO
       LDB     ONE
       SKNE    =66B            VALLEY FORGE
       LDB     TWO
       SKNE    =50B            HOUSTON
       LDB     THREE
       SKNE    =60B            PARIS
       LDB     FOUR
       STB     CENLOC
       LDA     =54
       LDB     =NODPRT
       LDX     ONE
       BRS     67
I1B    LDP     NODPRI
       BRS     64
       BRU     I1A
       STA     IFILE
       LDA     NODPRT
       LRSH    12
       MUL     THREE
       LSH     23
       SKNF    CORPFL
       ADD     =14000B
       SCP     IFILE
       BRU     I1A
       WIO     IFILE
       LRSH    12
       ETR     =3777B
       STA     CPRLOC
       SKF     CORPFL
       BRU     I1A
       SKE     ZERO
       BRU     I1A
       CLRF    CORPFL
       BRU     I1B
I1A    BRS     147
I2     BRS     71
       BRU     I2A
       BRU     I3              STATUS DOES NOT DO THE CLEAR
I2A    SKF     OPER            NOR DOES A USER
       BRU     I3              NOR DOES A USER
       CALL    CLRJBS
       BRU     I3

COPOP  DATA    3B7             THIS IS A COPER/OPER
$CLRJBS NOP     RT1
       CLA
       STA     XFRCNT
       CALL    G1JOB           GET 1ST JOB, READ MAP
       LDA     CDATE           TODAY'S DATE
       SKNE    UPDTTD          IF NOT TODAY DO IT
       RET     CLRJBS          WE DONE IT TODAY  SO LEAVE
       LDA     K3B7 
       XFA                     LETS MAKE HIM A COPER/OPER
       STA     COPOP           SAVE OLD FLAG
       TYPE UPDM1
       CALL    GREC
CLDA1  LDA     JBSTA
       SKA     XFRFLG
       BRU     TSTXFR
CLDA1A SKA     =DELFLG
       BRU     *+2
       BRU     CLDA3
CLDA2  CALL    GNJOB
       BRU     CLDA5
       BRU     CLDA1
CLDA3  SKA     =DONE
       BRU     *+2
       BRU     CLDA2
       CALL    SSPDP
       LDA     =41B
       WCI     SPDP
       LDP     SPDP
       BRS     48
       BRU     CLDA4           OG SET IT DELETED
       LDB     =LUD
       LDX     =3
       BRS     96
       LDA     LUD+2
       SKA     K2B7
       BRU     CLDA2
       CALL    DALLF
CLDA4  LDA     =DELFLG
       MRG     JBSTA
       STA     JBSTA
       CALL    WREC
       BRU     CLDA2
CLDA5  CALL    MUPD
       CALL    UPDATE          UPDATE THE MAP WITH CDATE
       LDA     COPOP           GET OLD FLAG
       XFA                     CHANGE FLAG AGAIN
       TYPE    UPDM2           UPDATING COMPLETE
       RET     CLRJBS
TSTXFR SKF     COPER
       BRU     *+4
       SKA     CENFLG
       MIN     XFRCNT
       BRU     CLDA1A
       SKF     ROPER
       BRU     CLDA1A
       SKA     REMFLG
       MIN     XFRCNT
       BRU     CLDA1A

**************************************************
*
*      SET UP PROGRAM RELABELING
*      SO THAT THE RELABELING
*      HAS AS LITTLE AS POOSIBLE IN IT
*
*      PAGE    USE             RUNTIME LOCATION
*      0       DATA            0
*      1       SUBS,POPS       1
*              CMD,FIL,CON
*      2       STA,SPO         2
*      3       PRINT           2
*      4       PRINT           3
*      5       (UNUSED)        
*      6       ACC             6       ACCOUNTING
*      7       MSG             7
*
********************************************************************
I3     CLRF    CHPFLG
       BRS     43
       STP     SPOREL
       ETR     =7777B4
       STA     CMDREL
       XAB
       ETR     =7777B
       STA     ACCREL
       XAB
       STP     MLAB
       LDP     SPOREL
       LSH     6
       ETR     =7777B
       MRG     CMDREL
       CLB
       STA     PRIREL
       LDP     SPOREL
       CLB
       ETR     =@77B
       STA     STAREL
       CALL    VCTLSP
       BRU     START1
ABEND  LDA     K100
       BRS     28              SET ERCODE
       TCO     CR
       TCO     ZERO
       TCO     K37
       TCO     CR
       BRS     10

VCTLSP NOP     RT1
       LDP     RNP
       BRS     64
       BRU     VCTLE
       STA     IFILE
       RSP     IFILE
       SKG     =3*RECSIZ*NJOBS+3071
       BRU     VCTLE
       WIO     IFILE
       SKG     KM1
       BRU     VCTLE
       WIO     IFILE
       SKG     =3*RECSIZ*NJOBS+3071
       BRU     VCTLE
       BRS     147
       RET     VCTLSP
VCTLE  TYPE    BF
       BRS     10
UPDM1  T       '$UPDATING CONTROL FILE$/'
UPDM2  T       '$CONTROL FILE UPDATED$/'
       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPINIT SYMSORT

SYM.  PG.LN. IDENT.

ABEND   6 27 INIT    CLDA1   4 21 INIT    CLDA1A  4 24 INIT    
CLDA2   4 27 INIT    CLDA3   4 30 INIT    CLDA4   5  7 INIT    CLDA5   5 12 INIT    
CLRJBS  4  9 INIT    COPOP   4  8 INIT    I1      1 39 INIT    I1A     3 38 INIT    
I1B     3 16 INIT    I2      3 39 INIT    I2A     4  3 INIT    I3      6  5 INIT    
OM****  5 28 INIT    SI1     1 28 INIT    SINIT   1  2 INIT    TSTXFR  5 18 INIT    
UPDM1   7 14 INIT    UPDM2   7 15 INIT    VCTLE   7 12 INIT    VCTLSP  6 35 INIT    

SPOOL ** FICHE/FRAME BREAK *****
SPMSG
MSG    IDENT   ALL MESSAGES    MAR 05, 1976
*      MESSAGES FROM THROUGHOUT THE ENTIRE PROGRAM, ALL TOGETHER AND
       GLOBAL
*      THIS PAGE WILL NOT NORMALLY BE IN THE RELABELLING, AS IT IS
*      TOO BIG.  THE TYPE POP WILL BE RESPONSIBLE FOR
*      BRINGING IT IN, AND GETTING IT BACK OUT.

*****************************************
*
*      CHANGES                 DATE
*      -------                 -----
*      55467                   03/05/76
*
*****************************************

HELPM  T       '$VALID COMMANDS ARE'
       T       '$HELP     - REPRINTS THIS LIST'
       T       '$INSTRUCTIONS - HOW TO RUN THIS PROGRAM'
       T       '$QUIT     - EXIT THIS PROGRAM'
       T       '$SPOOL    - SPOOL FILES FOR PRINTING'
       T       '$STATUS   - GIVE STATUS FOR JOBS PENDING'
       T       '$REPORT   - GIVE STATUS FOR JOBS SINCE A DATE'
       T       '$LIST     - LIST ALL THE FILES FOR A JOB'
       T       '$WHERE    - DETERMINE PRINT LOCATION FOR COMPLETED REQUEST'
       T       '$CANCEL   - CANCEL A JOB$/'
HELPM1 T       'PRINT    - PRINT A JOB OR SET OF JOBS'
       T       '$HOLD     - HOLD JOB FOR PAPER'
       T       '$TRANSFER - TRANSFER REQUEST TO ANOTHER NODE'
       T       '$DELETE   - DELETE ONE FILE FROM A REQUEST'
       T       '$RESTART  - RESTART PRINTING A JOB'
       T       '$MOVE     - MOVE A REQUEST TO THE CENTER$/'
HELPM2 T       'STORE    - STORE JOBS ON TAPE FOR TRANSFER$/'
HELPM3 T       'SET      - SET REMOTE PRINTER LICENSE$/'
STHM   T       '$VALID COMMANDS ARE:'
       T       '$USER       BY USER NAME'
       T       '$ALL        ALL JOBS (DEFAULT)'
       T       '$CENTER     ALL CENTER REQUESTS'
       T       '$REMOTE     ALL REMOTE REQUESTS'
       T       '$NUMBER     FOR ONE NUMBER$/'
RQTH   T       'YOUR TELEPHONE NUMBER$/'
RQNH   T       'YOUR NAME$/'
DHM    T       '$MAIL        - BY MAIL, FIRST CLASS'
       T       '$AIR EXPRESS - BY AIR COURIER SERVICE'
       T       '$COURIER     - BY COURIER SERVICE'
       T       '$SPECIAL     - BY MAIL, SPECIAL DELIVERY'
       T       '$PICKUP      - HOLD FOR PICKUP$/'
DHM1   T       'OFFICE      - BY INTER OFFICE MAIL$/'
GSPCH  T       '$ANY INSTRUCTIONS NOT COVERED BY THE OTHER QUESTIONS$/'
FRMHM  T       '$AVAILABLE FORMS ARE (WIDTH BY LENGTH)'
       T       '$$SMALL  - 11 BY 9'
       T       '$BIG    - 14 BY 11'
       T       '$LARGE  - 14 BY 11'
       T       '$TTY    - 8 1-2 BY 11'
       T       '$SPECIAL- FOR SPECIAL FORMS'
       T '$WHITE MAY ALSO BE SPECIFIED AFTER SMALL, BIG AND LARGE'
       T '$TO INDICATE THE REVERSE SIDE OF THAT TYPE OF PAPER.$/'
PRTEM  T       '$PARTS ARE 1,2,3, OR 4$/'
NOREMT T       '$?$$NO REMOTE PRINTER ASSOCIATED WITH THIS NODE$/'
OPTHM  T       'VALID OPTIONS ARE'
       T       '$$HEAD          - PROVIDES HEADING AND PAGE NUMBERS'
       T       '$COPIES =      - NUMBER OF TIMES TO COPY ALL FILES'
       T       '$LINES =       - NUMBER OF LINES PER PAGE'
       T       '$DOUBLE        - DOUBLE SPACE LISTINGS'
       T       '$CENTER        - PRINT LISTING AT CENTER'
       T       '$REMOTE        - PRINT LISTING AT REMOTE IF POSSIBLE'
       T       '$TRANSFER      - TRANSFER REQUEST TO A DIFFERENT PRINT SITE'
       T       '$NODE=         - ASSUME NODE AS LOGIN NODE FOR THIS REQUEST'
       T       '$INDENT=       - INDENT THE LINES THE NUMBER OF SPACES SPECIFIED'
       T       '$FULLCH        - PRINT THIS REQUEST ON A FULL CHARACTER PRINTER'
       T       '$CR            - CARRIAGE RETURN SPECIFIES NONE$/'
FLHM   T       '$ENTER FILENAMES SEPARATED BY COMMAS, SPACES, OR LINE FEEDS'
       T       '$TERMINATES WITH A CARRIAGE RETURN.'
       T       '$ADDITIONAL COMMANDS ARE'
       T       '$ .FILENAME       ALLOWS HAVING FILE NAMES IN SEPARATE FILE$/'
STOHM  T       '$VALID COMMANDS ARE ALL, FORM, OR JOBNUMBER$/'
       RPT     1
       IF      FTSW
VERS   T       '$FIELD TEST VERSION FT($VERSION).($PATCHNO)$/'
       ELSF    DEBUG
VERS   T       '$VERSION D($VERSION).($PATCHNO)$/'
       ELSE
VERS   T       '$VERSION ($VERSION).($PATCHNO)$/'
       ENDF
       ENDR
FAKEIT T       '$ ?$/'
SPTPLM T       '$SPOOLED TO PRINTER LOCATION    /'
FTRTOM T       '$FOR TRANSFER TO        /'
OPM    T       '$OPTIONS: /'
FILM   T       '$OUTPUT TO: /'
FSM    T       '$FILES SPOOLED:$/'
SMM    T       '  SMALL-/'
LAM    T       '  LARGE-/'
TTM    T       '    TTY-/'
SFM    T       '  SPECIAL/'
SWM    T       '  S WHI-/'
LWM    T       '  L WHI-/'
FULLMG T       '-FC/'
CANMSG T       '  CANC /'
PNDMSG T       '  PEND /'
CMPMSG T       '  COMP /'
XFRSM  T       '  TRAN /'
INPMSG T       '  PROC /'
HLDMSG T       '  HOLD /'
OTPMSG T       '  TAPE /'
CENMSG T       '  CEN  /'
REMMSG T       '  REM  /'
RMMSG1 T       '  REM* /'
RMMSG2 T       '  R/'


FULERM T       '$FULLCH IS NOT VALID FOR CENTER REQUESTS$/'
FULWRN T       '$THIS REQUEST IS FOR FULL CHARACTER PRINTER'
       T       '$DO YOU WANT TO TRANSFER THIS REQUEST? /'
PH1    T       '$REQUEST  DATE    STAT   LOC  USERNAME     FILES/'
PH2    T       '  PAGES  PAPER-PTS/'
PH3    T       '  REQUESTED BY/'
NJMSG  T       '$NO REQUESTS /'
NJMSG1 T       'PENDING/'
SINCEM T       '$SINCE: /'
NVJ    T       '$NOT VALID JOB NUMBER$/'
NVT    T       '$NOT A VALID REMOTE PRINTER TYPE$/'
NOFSP  T       '$NO FILES SPOOLED$/'
BILLM  T       '$BILL TO CUSTOMER? /'
UNAMSG T       'USER NAME: /'
PJCMSG T       'PROJECT CODE: /'
RQTM   T       'TELEPHONE NUMBER: /'
RQNM   T       'REQUESTED BY: /'
GMM1   T       'DELIVER BY: /'
AMEMSG T       '$MUST BE AIR EXPRESS$/'
DELAM  T       '$TYPE ADDRESS TO CONTROL D$/'
SPIM   T       '$ADDITIONAL DELIVERY INSTRUCTIONS: /'
TOCTLD T       '(TO CONTROL D)$/'
FORMSG T       'FORMS: /'
UNREC  T       '$UNRECOGINZED KEYWORD$/'
SPFMSG T       'DESCRIBE SPECIAL FORM$/'
SPFMS1 T       'NUMBER OF LINES PER PAGE: /'
SPFMS2 T       'LENGTH OF LINE IN CHARACTERS: /'
DECQ   T       'DECOLATE? /'
PARTQ  T       ' PARTS: /'
OPTMG  T       'OPTIONS: /'
FILMSG  T      '$FILES: /'
NOFNDM T       '  CANNOT BE FOUND$/'
NOOPM  T       '$CANNOT OPEN INPUT FILE /'
SYNERR T       '$SYNTAX ERROR INPUT FILE: /'
WTMSG  T       '  WRONG TYPE$/'
DFERR  T       ' MUST BE DISC FILE$/'
TOOBIG T       '$FILENAMES FILE TOO BIG$/'
PGM1   T       '  PAGES  /'
PAGEM  EQU     PGM1
BRNMSG T       '$SPOOL REQUEST NUMBER: /'
NUMBM  EQU     BRNMSG
FLM    T       ' FILES SPOOLED$/'
PGM    T       ' PAGES$/'
NVU    T       '$NOT VALID USER$/'
BF     T       'SYSTEM PROBLEM-CONTACT YOUR REPRESENTATIVE$/'
TL     T       'TOO LONG/'
SQA    T       'SEE SYSTEM QA/'
NT     T       'NOT VALID ON THIS SYSTEM/'
ND     T       'NOT IN YOUR DISTRICT/'
TWMSG  T       '$TAPE WRITTEN$/'
EOT    T       '$END OF TAPE ENCOUNTERED$/'
UNKTER T       '$TAPE ERROR$/'
WPRO   T       '$TAPE WRITE PROTECTED$/'
NSPTAP T       '$THIS IS NOT A SPOOL TAPE$/'
OLNWMG T       '$NEW TAPE? /'
NOFND  T       ' WAS UNABLE TO BE FOUND$/'
M1     T       '$CAN YOU MOUNT /'
NOTRDY T       '$TAPE DRIVE NOT READY$/'
PFFM   T       '$FILE PRINTED/'
FNF    T       '$FILE NOT FOUND$/'
POR    T       '$PRINTER OUT OF READY AT APPROX PAGE /'
CONMSG T       ' CONTINUE? /'
BRNM   T       '$$$----------------------------------------------$$$$$'
       T       '$REQUEST NUMBER        /'
DATMSG T       '$DATE & TIME           /'             55467
EBM    T       '$ENTERED BY            /'
RBM    T       '$REQUESTED BY          /'
FUM    T       '$FOR USER              /'
PJCM   T       '$PROJECT CODE          /'
TELENM T       '$TELEPHONE NUMBER      /'
DISTMG T       '$DISTRICT              /'
DSCWM  T       '$DESCRIPTION OF WORK$'
       T       '$PRINT ON /'
SMALLM T       'SMALL PAPER /'
BIGM   T       'LARGE PAPER /'
TTYM   T       'TTY PAPER /'
SMALLW T       'SMALL WHITE PAPER /'
LARGEW T       'LARGE WHITE PAPER /'
PARTM  T       ' PART /'
SFBM   T       ' SPECIAL FORMS AS DESCRIBED BELOW$$/'
TFFM   T       '$THE FOLLOWING FILES$/'
DELIM  T       '$DELIVERY INSTRUCTIONS$/'
MAILM  T       '$SEND BY FIRST CLASS MAIL$/'
AMAILM T       '$SEND BY AIR MAIL$/'
AEXM   T       '$SEND BY AIR EXPRESS$/'
COURM  T       '$SEND BY COURIER$/'
HOLDM  T       '$HOLD FOR PICKUP$/'
SPDM   T       '$SEND BY SPECIAL DELIVERY$/'
OMM    T       '$SEND BY INTER-OFFICE MAIL$/'
DADM   T       '$DELIVERY ADDRESS$/'
TRQM   T       '$TOTAL REQUIREMENTS ARE:$/'
CMPBYM T       '$$COMPLETED BY--------------------------------------$$$$/'
POSTBM T       '$POSTAGE CHARGE---------------------------------'
       T       '$$$$$ENTERED BY--------------------------------'
       T       '$THIS MUST BE ENTERED USING /'
POSTB2 T       '1RCHARGE$/'
POSTB3 T       '1BCHARGE$/'
DECM   T       ' DECOLATED/'
REDOM  T       '$THIS JOB IS IN PROCESS OR COMPLETED, '
       T       '$DO YOU WANT TO REDO THIS JOB? /'
EXTMSG T       '$THIS REQUEST IS FOR A REMOTE PRINTER'
       T       '$DO YOU WANT TO DO THIS REQUEST? /'
NFLMSG T       '$THIS REQUEST REQUIRES A FULL CHARACTER SET PRINTER'
       T       '$DO YOU WANT TO DO THIS REQUEST? /'
MOUNTM T       '$PLEASE MOUNT  /'
CNFM   T       '$CONFIRM BY TYPING YOUR NAME: /'
NOPRI  T       '$PRINTER NOT ON THIS SYSTEM$USE STORE COMMAND$/'
NOPRIA T       '$DEVICE ASSIGNED TO ANOTHER USER$/'
APM    T       '$IS THERE A PRINTER ON THIS SYSTEM? /'
ATPM   T       '$REMOTE PRINTER TYPE: /'
UPLOWM T       '$DOES THIS PRINTER HAVE A FULL CHARACTER SET? /'
NTOTP  T       '$JOB NOT ON THIS TAPE$/'
WFW    T       '$WHAT FORM DO YOU WANT? /'
BESURE T       '$IS PAPER ON PRINTER /'
JNM    T       '$JOB NUMBER: /'
FNM    T       '$FILE NAME: /'
NDAT   T       'DATE: '
PG     T       'PAGES: '
MUPEM  T       '$UNABLE TO GARBAGE COLLECT FILE, CONTACT SQA$/'
MUPEM1 T       '$CONTROL FILE BAD - CONTACT SQA$/'
AFB    T       '$ACCOUNTING FILE BAD$/'
INSMSG T       '$FOR INSTRUCTIONS SEE (*6NEWS)@RUSER$/'
YORN   T       '$YES OR NO$/'
RENTR  T       '$$DO YOU WANT TO RE-ENTER FILES NOT SPOOLED? /'
PUA    T       '$PICKUP AT/'
NMI    T       '$COMMAND NOT IMPLEMENTED$/'
NOREQT T       '$REQUEST NOT ON TAPE$/'
EMRGTN T       '$FOR ANY QUESTIONS CONCERNING THIS REQUEST$PLEASE CALL /'
WGPORT T       '$MUST BE ON PORT 0 OR 1$/'
VME1    T       '$NO PASSWORD FILE/'
VME     T       '$NOTIFY DIVISION OPNS MGR AND SYS. GROUP TECH DIV/'
VME2    T       '$PASSWORD FILE STATUS LOST/'
VME3    T       '$PASSWORD FILE BUSY-TRY LATER$/'
VME4    T       '$UNVALIDATED NAME/'
VM1     T       '$YOUR NAME: /'
VM2     T       '$PASSWORD: /'
VME6    T       '$NAME DOES NOT APPEAR IN PASSWORD FILE$/'
DUPHAR T       '$***********DUPLICATE HARDCOPY**********$$$/'
JBCNLD T       '$REQUEST CANCELED$/'
CANM1  T       '$CANCELING REQUEST$/'
FROMMG T       ' FROM /'
LINESM T       ', LINES =/'
INDTMG T       ', INDENT=/'
COPIMG T       'COPIES =/'
HDMSG  T       'HEAD, /'
DBLMSG T       ', DOUBLE/'
SGLMSG T       ', SINGLE/'
CMDFER T       '$COMMAND FILE ERROR-ABORTED$/'
EREMER T       '$THIS REQUEST IS NOT FOR YOUR PRINTER LOCATION$/'
REMRQM T       '$THIS REQUEST IS SPOOLED FOR A REMOTE PRINTER$'
       T       '$DO YOU WANT TO DO THIS REQUEST? /'
ECENER T       '$THIS REQUEST WAS SPOOLED FOR CENTER PRINTING$/'
EIPMSG T       '$THERE WAS AT LEAST ONE FILE NOT PRINTED,'
       T       '$THE PAGES IN THE ACCOUNTING WILL NOT BE CORRECT$/'
NOREQP T       '$NO REQUESTS FOR THIS TYPE OF PAPER PENDING$/'
NUMMSG T       '$NUMBER: /'
OKMSG  T       '$OKAY? /'
NVNUM  T       '$NOT ABLE TO ACCESS DATA FILE$/'
NORPRI T       '$NO REMOTE PRINTER FOR THIS NODE$/'
USNM   T       '$USER: /'
CPYMSG T       '$COPY: /'
PAGMSG T       '$PAGE: /'
CMDM   T       '$COMMAND: /'
NULLMG T       '$/'
XFRM1  T       '$TRANSFER TO: /'
XFRM2  T       '$$TRANSFER NODE NUMBER: /'
XFRM3  T       '$TRANSFER COMPLETED$/'
XFRM4  T       '$FOR PICKUP ADDRESS USE THE WHERE COMMAND WHEN THE REQUEST IS COMPLETED$/'
XFRM5  T       '$THERE ARE /'
XFRM6  T       ' REQUESTS WAITING TO BE TRANSFERED$/'
XFRHAR T       '$$************ AWAITING TRANSFER *************$$/'
TYMMSG T       '$TYMSHARE INC.$/'
NADDR  T       '$NO ADDRESS GIVEN$/'
QAMSG  T       '     CONTROL # ------  QA BY:-------/'
       IF      *-:ZERO:>4000B
       REM     TOO MANY MESSAGES
       ENDF
 END
SPOOL ** FICHE/FRAME BREAK *****
SPMSG SYMSORT

SYM.  PG.LN. IDENT.

AEXM    5 39 MSG     AFB     6 36 MSG     AMAILM  5 38 MSG     
AMEMSG  4 12 MSG     APM     6 24 MSG     ATPM    6 25 MSG     BESURE  6 29 MSG     
BF      4 38 MSG     BIGM    5 29 MSG     BILLM   4  6 MSG     BRNM    5 17 MSG     
BRNMSG  4 33 MSG     CANM1   7 16 MSG     CANMSG  3 20 MSG     CENMSG  3 27 MSG     
CMDFER  7 24 MSG     CMDM    7 39 MSG     CMPBYM  6  7 MSG     CMPMSG  3 22 MSG     
CNFM    6 21 MSG     CONMSG  5 16 MSG     COPIMG  7 20 MSG     COURM   6  1 MSG     
CPYMSG  7 37 MSG     DADM    6  5 MSG     DATMSG  5 19 MSG     DBLMSG  7 22 MSG     
DECM    6 13 MSG     DECQ    4 21 MSG     DELAM   4 13 MSG     DELIM   5 36 MSG     
DFERR   4 29 MSG     DHM     2  3 MSG     DHM1    2  8 MSG     DISTMG  5 25 MSG     
DSCWM   5 26 MSG     DUPHAR  7 14 MSG     EBM     5 20 MSG     ECENER  7 28 MSG     
EIPMSG  7 29 MSG     EMRGTN  7  4 MSG     EOT     5  5 MSG     EREMER  7 25 MSG     
EXTMSG  6 16 MSG     FAKEIT  3  7 MSG     FILM    3 11 MSG     FILMSG  4 24 MSG     
FLHM    2 32 MSG     FLM     4 35 MSG     FNF     5 14 MSG     FNM     6 31 MSG     
FORMSG  4 16 MSG     FRMHM   2 10 MSG     FROMMG  7 17 MSG     FSM     3 12 MSG     
FTRTOM  3  9 MSG     FULERM  3 33 MSG     FULLMG  3 19 MSG     FULWRN  3 34 MSG     
FUM     5 22 MSG     GMM1    4 11 MSG     GSPCH   2  9 MSG     HDMSG   7 21 MSG     
HELPM   1 16 MSG     HELPM1  1 26 MSG     HELPM2  1 32 MSG     HELPM3  1 33 MSG     
HLDMSG  3 25 MSG     HOLDM   6  2 MSG     INDTMG  7 19 MSG     INPMSG  3 24 MSG     
INSMSG  6 37 MSG     JBCNLD  7 15 MSG     JNM     6 30 MSG     LAM     3 14 MSG     
LARGEW  5 32 MSG     LINESM  7 18 MSG     LWM     3 18 MSG     M1      5 11 MSG     
MAILM   5 37 MSG     MOUNTM  6 20 MSG     MUPEM   6 34 MSG     MUPEM1  6 35 MSG     
NADDR   8 10 MSG     ND      5  3 MSG     NDAT    6 32 MSG     NFLMSG  6 18 MSG     
NJMSG   3 39 MSG     NJMSG1  4  1 MSG     NMI     7  2 MSG     NOFND   5 10 MSG     
NOFNDM  4 25 MSG     NOFSP   4  5 MSG     NOOPM   4 26 MSG     NOPRI   6 22 MSG     
NOPRIA  6 23 MSG     NOREMT  2 19 MSG     NOREQP  7 31 MSG     NOREQT  7  3 MSG     
NORPRI  7 35 MSG     NOTRDY  5 12 MSG     NSPTAP  5  8 MSG     NT      5  2 MSG     
NTOTP   6 27 MSG     NULLMG  8  1 MSG     NUMBM   4 34 MSG     NUMMSG  7 32 MSG     
NVJ     4  3 MSG     NVNUM   7 34 MSG     NVT     4  4 MSG     NVU     4 37 MSG     
OKMSG   7 33 MSG     OLNWMG  5  9 MSG     OMM     6  4 MSG     OPM     3 10 MSG     
OPTHM   2 20 MSG     OPTMG   4 23 MSG     OTPMSG  3 26 MSG     PAGEM   4 32 MSG     
PAGMSG  7 38 MSG     PARTM   5 33 MSG     PARTQ   4 22 MSG     PFFM    5 13 MSG     
PG      6 33 MSG     PGM     4 36 MSG     PGM1    4 31 MSG     PH1     3 36 MSG     
PH2     3 37 MSG     PH3     3 38 MSG     PJCM    5 23 MSG     PJCMSG  4  8 MSG     
PNDMSG  3 21 MSG     POR     5 15 MSG     POSTB2  6 11 MSG     POSTB3  6 12 MSG     
POSTBM  6  8 MSG     PRTEM   2 18 MSG     PUA     7  1 MSG     QAMSG   8 11 MSG     
RBM     5 21 MSG     REDOM   6 14 MSG     REMMSG  3 28 MSG     REMRQM  7 26 MSG     
RENTR   6 39 MSG     RMMSG1  3 29 MSG     RMMSG2  3 30 MSG     RQNH    2  2 MSG     
RQNM    4 10 MSG     RQTH    2  1 MSG     RQTM    4  9 MSG     SFBM    5 34 MSG     
SFM     3 16 MSG     SGLMSG  7 23 MSG     SINCEM  4  2 MSG     SMALLM  5 28 MSG     
SMALLW  5 31 MSG     SMM     3 13 MSG     SPDM    6  3 MSG     SPFMS1  4 19 MSG     
SPFMS2  4 20 MSG     SPFMSG  4 18 MSG     SPIM    4 14 MSG     SPTPLM  3  8 MSG     
SQA     5  1 MSG     STHM    1 34 MSG     STOHM   2 36 MSG     SWM     3 17 MSG     
SYNERR  4 27 MSG     TELENM  5 24 MSG     TFFM    5 35 MSG     TL      4 39 MSG     
TOCTLD  4 15 MSG     TOOBIG  4 30 MSG     TRQM    6  6 MSG     TTM     3 15 MSG     
TTYM    5 30 MSG     TWMSG   5  4 MSG     TYMMSG  8  9 MSG     UNAMSG  4  7 MSG     
UNKTER  5  6 MSG     UNREC   4 17 MSG     UPLOWM  6 26 MSG     USNM    7 36 MSG     
VERS    3  4 MSG     VERS    3  2 MSG     VERS    2 39 MSG     VM1     7 11 MSG     
VM2     7 12 MSG     VME     7  7 MSG     VME1    7  6 MSG     VME2    7  8 MSG     
VME3    7  9 MSG     VME4    7 10 MSG     VME6    7 13 MSG     WFW     6 28 MSG     
WGPORT  7  5 MSG     WPRO    5  7 MSG     WTMSG   4 28 MSG     XFRHAR  8  8 MSG     
XFRM1   8  2 MSG     XFRM2   8  3 MSG     XFRM3   8  4 MSG     XFRM4   8  5 MSG     
XFRM5   8  6 MSG     XFRM6   8  7 MSG     XFRSM   3 23 MSG     YORN    6 38 MSG     

SPOOL ** FICHE/FRAME BREAK *****
SPPOP
POP    IDENT   SPOOL POPS      DEC 16, 1975

SPTR   OPD     514B5,2
SKNE   OPD     536B5,2
RET    OPD     514B4,2
CALL   OPD     570B5,2
POPDEB EQU     -1
       FRGT    POPDEB

LOAD   MACRO; LDP SV1; LDX SV3; ENDM
STORE  MACRO; STP SV1; STX SV3; ENDM


SKIPRT POPD    1014B4,2
POP101 MIN* 0; BRR* 0

TYPE   POPD    100B5,2
POP100 STORE
P100C  EAX*    0
       BRS     43
       STP     SSV1
       LDB     MSGREL
       BRS     44
       LDA     =MSGESC
       XMA     ESCV
       STA     SVESCV
POP00L LDB     0,2
       CLA
       LSH     6
       SBRM    PCHAR
       LSH     6
       SBRM    PCHAR
       LSH     6
       SBRM    PCHAR
       LSH     6
       SBRM    PCHAR
       EAX     1,2
       BRU     POP00L
POP00E LDP     SSV1
       BRS     44
       LDA     SVESCV
       STA     ESCV
       BRU     POPX

PCHAR  NOP     RTPOP
       SKNE    FOUR
       LDA     CR
       SKNE    K17
       BRU     POP00E
       CIO     COUT
       CLA
       RET     PCHAR

MSGESC ZRO     ESCLOC
       LDP     SSV1
       BRS     44
       BRU     ESCR
*

*
*MOVSTG POP WILL MVE STRING WITH POINTERS IN (A) AND (B)
*TO AREA IN ADDR (M) FIELD OF INSTRUCTION
*
MOVSTG POPD    102B5,2
POP102 ETR     =177777B
       STP     SV1
       SPTR*   0
       STP     SSV1
MVS2   GCI     SV1
       BRU     MVS1
       WCI     SSV1
       BRU     MVS2
MVS1   LDP     SSV1
       BRR     0

CIL    POPD    103B5,2
POP103 LDA =377B; CIT* 0; BRR 0; BRU POP103

*
*STNG POP WILL READ A STRIN FROM AN INPUT FILE
*TERMINATES WITH FINAL CHARACTER OR COUNT EXCEEDED
*INPUT         (A) COUNT
*              (B) TERMINATING CHARACTER
*              (X) INPUT FILE
*RETURN        (AB) POINTER TO STRING
*      SKIP ENDED ON TERMINATING CHAR
*      NONSKIP ENDED ON COUNT EXCEEDED
*
STNG   POPD    104B5,2
POP104 STA     SSV1
       STB     SSV2
       STX     SV3
       SPTR*   0
       STP     SV1
ST2    SKR     SSV1
       BRU     *+2
       BRU     ST3
       CIO     SV3
       SKNE    SSV2
       BRU     ST1A
       WCI     SV1
       BRU     ST2
ST3    LDA     =377B
       CIT     SV3
       BRU     *+2
       POT     1
       SKE     SSV2
       BRU     ST1
       CIO     SV3
ST1A   MIN     0
ST1    LDP     SV1
       BRR     0

*      ERROR POP, TYPES THE ERROR MESSAGE AND GOES BACK TO COMMAND

ERROR  POPD    105B5,2
POP105 LDA     0
       STA     ERLOC
       SBRM    EXTOFF
       TYPE*   ERLOC
       SBRM    CLRIN
       LDX     KM1
       BRS     11
       BRS     17              CLOSE ANY AND ALL FILES
       BRS     114             ENABLE ESCAPES UNCONDITIONALLY
       LDA     KM1             AND RESET THE DISABLE COUNTER
       STA     DISCT
       BRU     CMDISP

*      DISABLE ESCAPES, MAINTAINS COUNTA OF NUMBER OF TIMES

DISABLE POPD   176B5
POP176 BRS     113
       MIN     DISCT
       SKN     DISCT
       BRR     0
       BRU     *-3

*      ENABLE ESCAPES, MAINTAINS COUNT AND ENABLES ONLY WHEN COUNT = -1

ENABLE POPD    177B5
POP177 SKR     DISCT
       BRR     0
       BRS     114
       BRR     0


TCO    POPD    106B5,2
POP106 STORE
       EAX*    0
       LDA     0,2
       CIO     COUT
       BRU     POPX

SETF   OPD     11004000B,2
CLRF   OPD     11010000B,2
SKF    OPD     11014000B,2
SKNF   OPD     11020000B,2
XFA    POPD    110B5,2

*      FLAG POP

9FLG   STA     SV1
        STB     SV2
        STX     SV3
        EAX*    0
 COPY XA,XB,X
        EAX     FLAG
        ETR     =377B
    SKB     =34000B
        BRU     *+4
        LDA     SV1
        XMA     0,2
        BRU     APOP
        XAB
        ETR     =34000B
        SKG    K2B5            (B10)
        BRU     *+2
       ZRO
        STX     SSV1
        STB     SSV2
        RSH     11
        AXC
        LDB    K4B7
        RSH*    SSV2
        BRU     *,2
        BRU     SETFL
        BRU     CLFL
        BRU     SKFL
        SKB*    SSV1
        BRU     POPX
        MIN     0
        BRU     POPX
SKFL    SKB*    SSV1
        MIN     0
        BRU     POPX
SETFL   CBA
        MRG*    SSV1
        STA*    SSV1
        BRU     POPX
CLFL    CBA
        EOR     KM1
        ETR*    SSV1
        STA*    SSV1
POPX   LDA SV1
APOP   LDB SV2
       LDX SV3
       BRR 0

PDEC   POPD    107B5

DECPOP STA     SV1
       STB     SV2
       STX     SV3
       CLX
       EAX*    0
       COPY    AB,XA
       SKG     ZERO
       BRU     PDECF
       CNA
       COPY    AX
       SPTR    NUMSTG
       STP     SSV1
       LDB     SV1
PDECA  CLA
       LSH     1
       DIV     TEN
       XAB
       ADD     K20
       WCD     SSV1
       BRX     PDECA
       LDP     SSV1
       LDX     COUT
       BRS     35
       BRU     POPX
PDECF  CBA
       LDB     TEN
       LDX     COUT
       BRS     36
       BRU     POPX
       NOLIST  EXT
       IF      POPDEB
TRCALL POPD    140B5,2
CALPOP STORE
       LDA     0
       ETR     ADMASK
       LDB     K10
       LDX     ONE
       BRS     36
       EAX*    0
       CLA
       CIO     ONE
       CIO     ONE
       LDA     0,2
       ETR     ADMASK
       SUB     =RT1
       ADD     K20
       CIO     ONE
       LDA     0
       STA*    0,2
       STX     0
       LDA     CR
       CIO     COUT
       BRU     POPX
TRRET  POPD    141B5,2
RETPOP STORE
       LDA     ='R'
       CIO     COUT
       LDA*    0
       ETR     ADMASK
       STA     0
       SUB     =RT1
       ADD     K20
       CIO     COUT
       LDA     CR
       CIO     COUT
       LOAD
       BRR*    0
       ENDF
CTYPE  POPD    111B5,2
POP111 STORE
       LDA     CIN
       SKE     ZERO
       BRU     POPX
       BRU     P100C

       IF      POPDEB
TRSKIP POPD    1424B4,2
POP142 STORE
       LDA*    0
       ETR     ADMASK
       LDB     K10
       LDX     COUT
       BRS     36
       LDA     ='S'
       CIO     COUT
       LDA     CR
       CIO     COUT
       LOAD
       MIN*    0
       BRR*    0
       ENDF
BCIO   POPD    161B5,2
       BRU     BCIO1
BTCO   POPD    160B5,2
       BRU     BTCOP

       END
SPOOL ** FICHE/FRAME BREAK *****
SPPOP SYMSORT

SYM.  PG.LN. IDENT.

9FLG    5  7 POP     APOP    6 11 POP     BCIO    8 30 POP     
BTCO    8 32 POP     CALL    1  6 POP     CALPOP  7 10 POP     CIL     2 37 POP     
CLFL    6  6 POP     CLRF    4 39 POP     CTYPE   8  7 POP     DECPOP  6 17 POP     
DISABL  4 15 POP     ENABLE  4 24 POP     ERROR   3 38 POP     LOAD    1 10 POP     
MOVSTG  2 25 POP     MSGESC  2 15 POP     MVS1    2 34 POP     MVS2    2 30 POP     
P100C   1 19 POP     PCHAR   2  6 POP     PDEC    6 15 POP     PDECA   6 30 POP     
PDECF   7  2 POP     POP00E  1 39 POP     POP00L  1 27 POP     POP100  1 18 POP     
POP101  1 15 POP     POP102  2 26 POP     POP103  2 38 POP     POP104  3 12 POP     
POP105  3 39 POP     POP106  4 32 POP     POP111  8  8 POP     POP142  8 16 POP     
POP176  4 16 POP     POP177  4 25 POP     POPDEB  1  7 POP     POPX    6 10 POP     
RET     1  5 POP     RETPOP  7 32 POP     SETF    4 38 POP     SETFL   6  2 POP     
SKF     5  1 POP     SKFL    5 38 POP     SKIPRT  1 14 POP     SKNE    1  4 POP     
SKNF    5  2 POP     SPTR    1  3 POP     ST1     3 33 POP     ST1A    3 32 POP     
ST2     3 17 POP     ST3     3 25 POP     STNG    3 11 POP     STORE   1 11 POP     
TCO     4 31 POP     TRCALL  7  9 POP     TRRET   7 31 POP     TRSKIP  8 15 POP     
TYPE    1 17 POP     XFA     5  3 POP     
SPOOL ** FICHE/FRAME BREAK *****
SPPRI
PRINT  IDENT   JUL 11, 1976    PRINT ROUTINES
DEBUG  EQU     -1              1=NO PRINT -1=PRINT

**********************************
*
*      THESE ROUTINES ARE USED FOR ALL
*      MEDIA CHANGES WHICH ARE AVAILABLE
*      TO THE OPERATOR.  THESE ARE
*      1. PRINT FROM DISK
*      2. PRINT FROM TAPE
*      3. STORE OF TAPE FOR INTER-SYSTEM MOVEMENT
*      4. PRINT ON REMOTE PRINTERS FROM DISK
*        A. CDC PRINTERS
*        B. VOGUE PRINTERS
*        C. DP (DATA PRODUCTS) PRINTERS
*        D. 2780 TYPE PRINTERS
*
***********************************

**********************************
*
*      THREE MAJOR COMMAND ARE
*      1. PRINT
*      2. STORE
*      3. RESTART
*
****************************************

       ENTRY   PRINT,RESTART,STORE,HARD,DELETE,HARDCS
       ENTRY   TEOF,RTREC,TWTV,ASGP
       ENTRY   BCIO1,MOVE
       RELORG  10000B

STORE  NOP     RT1
       SKF     COPER           MUST BE A SYSTEM OPERATOR
       BRU     CMDERR
       CALL    GTAPE           BE SURE I CAN GET TAPE UNIT
       SETF    TOTAPE
       CLRF    FRTAPE          INSIST FROM DISK
       CLRF    RESFLG          NOT A RESTART
       BRU     PCMD

PRINT  NOP     RT1
       LDA     KM1
       SKF     OPER            LET DON'E ASK HIM IF SET
       CALL    VERPSW          VERIFY THAT HE HAS ENOUGH CLASS (OPER/ECT
       SKF     OPER            DID HE MAKE IT?
       RET     PRINT
       CLRF    TOTAPE          NOT TO TAPE
       CLRF    2780FL          CLEAR 2780 FLAG
       CLRF    FRTAPE          INITIALIZE FORM DISK
       CLRF    RESFLG          NOT A RESTART
PCMDA  CLA
       SKF     COPER
       LDA     KM1
       STA     EXTRN
       SKN     EXTRN
       BRU     PCMD
       LDA     NODPRT
       ETR     K3777
       SKG     ONE
       BRU     PCMD
       BRM     CK2780          CHECK IF HE IS 2780
       LDX     KM1
       BRS     132
       MRG     A:CHAR
       BRS     160
       BRU     PCMD

RESTART NOP    RT1
       SKF     OPER
       BRU     CMDERR
       CLRF    TOTAPE
       CLRF    FRTAPE
       SETF    RESFLG
       CLRF    2780FL          CLEAR 2780 FLAG
       BRU     PCMDA

PCMD   LDA     KM1
       STA     PGCNTD
       LDA     PCMDL
       CLRF    ERFLG
       CALL    DIS
       BRU     PCMD2
       BRU     PCMD1
       SKNF    TOTAPE
       CALL    CLTAPE
       RET     STORE

*      DEFAULT

PCMD1  SKNF    RESFLG
       BRU     RNUM
       CALL    PA
       SKNF    TOTAPE
       CALL    CLTAPE
       RET     STORE

RNUM   TYPE    JNM             JOB NUMBER:
       LDB     TEN
       LDX     CIN
       BRS     38
       STA     NUMBER
       BRU     PCMD2A


**********************************
*
*      PRINT/STORE BY NUMBER
*
************************************

PCMD2  CALL    CVNUM
PCMD2A CALL    SIMAP           CLEAR THE INPUT REQUEST MAP
       LDA     NUMBER
       STA     RQSN
       CALL    GRECN
       ERROR   NVJ
       LDA     BRNO
       SKE     RQSN            BE SURE THE NUMBERS MATCH
       ERROR   NVJ             THEY DON'T
       SKNF    TOTAPE
       BRU     SNT1
       SKNF    RESFLG
       BRU     RN1
       LDA     TERMC
       SKE     CR
       BRU     PNF
       CALL    GPRI
SNT2   CALL    NAMCNF          CONFIRM THAT THE NAME IS CORRECT
PN3    LDA     JBSTA
       SKA     XCANFL          BE SURE REQUEST IS NOT CANCELED
       BRU     PN1             THIS ONE IS CANCELED, CHECK ELSEWHERE
       SKA     REDOFL          DONE+INPROC+ONTAPE
       BRU     *+2
       BRU     PN2
       TYPE    REDOM
       CALL    YESNO
       BRU     PN1             TRY FOR ANOTHER REQUEST
PN2    SKN     EXTRN
       CALL    CKEXRN
       LDA     JBSTA
       SKA     FULFLG
       SKNF    FULLSW
       BRU     PN4
       TYPE    NFLMSG
       CALL    YESNO
       BRU     PN1
PN4    TYPE    MOUNTM
       CALL    TPFORM
       LDA     PAGES
       ADD     FIVE
       ADD     FILES
       ADD     FILES
       ADD     FILES
       CAB
       LDA     COUT
       MRG     FMT1
       COPY    AX,BA
       BRS     165
       TYPE    PAGEM
       CALL    CONFRM
       SKA     SPFLAG
       CALL    PSPI
       CALL    GPOPT
       CALL    PJOB
       SKNF    TOTAPE
       CALL    CLTAPE
       RET     STORE

PN1    CALL    GDREC           GET A DUPLICATE REQUEST
       ERROR   NVJ             NOT VALID NUMBER
       BRU     PN3

CKEXRN NOP     RT4
       LDA     JBSTA
       SKA     CENFLG
       RET     CKEXRN
       TYPE    EXTMSG
       CALL    YESNO
       BRU     PN1
       RET     CKEXRN

SNT1   CALL    GTAPE
       CALL    OLDNEW          OLD TAPE
       BRU     SNT2

PNF    SKNF    FRTAPE
       BRU     CMDERR
       CALL    1WD
       CALL    GRFLM1
       CALL    GPRI
       CALL    GPOPT
       IF DEBUG
       ELSE
       CALL    PFILE
       ENDF
       RET     PRINT


**************************************************
*
*      RESTART BY NUMBER
*
**************************************************

RN1    CLA
       STA     TCOP
       LDA     KM1
       STA     PGCNTD
       LDA     TERMC
       SKE     CR
       BRU     RN2
       CALL    NAMCNF
       CALL    GPRI
       TYPE    FNM
       CALL    GRFLNM
       CALL    GCPYN
       CALL    GPAGN
       BRU     RNEL
RN2    CALL    1WD
       MOVSTG  TFLNM
       STP     FLNP
       LDA     TERMC
       SKE     CR
       BRU     RN3
       CALL    NAMCNF
       CALL    GPRI
       LDP     FLNP
       CALL    GRFLM1
       CALL    GCPYN
       CALL    GPAGN
       BRU     RNEL
RN3    CALL    1NUM
       SKG     ZERO
       BRU     CMDERR
       SUB     ONE
       CNA
       STA     TCOP
       LDA     TERMC
       SKE     CR
       BRU     RN4
       CALL    NAMCNF
       CALL    GPRI
       LDP     FLNP
       CALL    GRFLM1
       CALL    GPAGN
       BRU     RNEL
RN4    CALL    1NUM
       SKG     KM1
       BRU     CMDERR
       STA     PGCNTD
       CALL    NAMCNF
       LDP     FLNP
       CALL    GRFLM1
RNEL   CALL    GPOPT
       CALL    RJOB
       RET     RESTART


GRFLNM NOP     RT5
       CLA
       STA     FILCT
       CIL     CIN
       SKNE    CR
       BRU     GRFLM3
       LDB     CR
       LDX     CIN
       LDA     K72D
       STNG    TFLNM
GRFLM1 NOP     RT5
       STP     FLNP
       XAB
       SUB     FLNP
       STA     FLTH
       CLA
       STA     FILCT
       CALL    GSTNG
       STP     TP
GRFLM2 CAB
       ADD     FLTH
       XAB
       SKSE    FLNP
       BRU     *+2
       BRU     GRFLM4
GRFLM5 GCI     TP
       ERROR   FNF
       SKE     CR
       BRU     *-3
       MIN     FILCT
       LDA     TP
       BRU     GRFLM2
GRFLM3 CIO     CIN
       RET     GRFLNM

GRFLM4 LDA     TP
       ADD     FLTH
       STA     TP
       GCI     TP
       SKE     CR
       SKNE    K203
       RET     GRFLNM
       BRU     GRFLM5
GPAGN  NOP     RT5
       TYPE    PAGMSG
       CIL     CIN
       SKNE    CR
       BRU     GPAGN1
       LDB     TEN
       LDX     CIN
       BRS     38
       XAB
       SKE     CR
       BRU     GPAGN
       STB     PGCNTD
       RET     GPAGN
GPAGN1 CIO     CIN
       RET     GPAGN

GCPYN  NOP     RT5
       LDA     JBSTA
       SKA     FICOPS
       BRU     GCPYN1
       LDA     COPIES
       SKG     ONE
       RET     GCPYN
GCPYN1 TYPE    CPYMSG
       CIL     CIN
       SKNE    CR
       BRU     GCPYN
       LDB     TEN
       LDX     CIN
       BRS     38
       XAB
       SKE     CR
       BRU     GCPYN
       XAB
       SUB     ONE
       CNA
       STA     TCOP
       RET     GCPYN

******************************************************
*
*      PRINT OR STORE BY FORMS
*      THIS RELIES ON THE SORT TO TELL
*      WHAT TYPE OF FORM TO ACCESS
*
************************************************

PFORM  NOP     RT3
       SKNF    RESFLG
       BRU     CMDERR          CANNOT 'RESTART FORMS'
       LDA     TERMC
       SKNE    CR
       BRU     PFORM2          HAVE TO ASK WHAT TYPE FORM
       LDA     GCC
       CALL    DIS
       RET     PFORM
       RET     PFORM
PFORM5 SKF     TOTAPE
       BRU     *+3
       CALL    OLDNEW
       BRU     *+2
       CALL    GPRI
       CALL    SORTJ
       LDX     OFFSET
       CLA
       XMA     LINK,2
       STA     JBPTR
       LDA     JBPTR
       SKNE    ZERO
       ERROR   NOREQP          NO REQUESTS FOR THIS TYPE OF PAPER
       LDX     OFFSET
       TYPE    MOUNTM
       LDA     TOTPG,2
       PDEC    0
       TYPE    PAGEM
       CALL    CONFRM
PFORM1 NOP     RT3
       LDA     JBPTR
       SKNE    ZERO
       RET     PFORM
       CAX
       LDA     1,2
       STA     RQSN
       CALL    GRECN
       BRU     PFORM1
       LDA     JBSTA
       SKA     HLDFLG
       BRU     PFONXT
PFORM4 LDA     BRNO
       SKE     RQSN
       ERROR   NVJ             DON'T MATCH
       LDA     JBSTA
       SKA     NPEND
       BRU     PFORM3
       LDA     HSW
       STA     XHSW
       LDA     DBLSW
       STA     XDBLSW
       LDA     L:PG
       SUB     ONE
       STA     XL:PG
       LDA     INDCNT
       STA     XINDCT
       CALL    PJOB
PFONXT LDA*    JBPTR
       STA     JBPTR           TO NEXT ADDRESS
       BRU     PFORM1

PFORM2 TYPE    WFW             WHTAT TYPE OF FORM DO YOU WANT
       LDA     GCC
       CALL    DISP
       RET     PFORM
       RET     PFORM
       BRU     PFORM5


PFORM3 CALL    GDREC
       BRU     PFORM1
       BRU     PFORM4

*****************************************
*
*      PRITN OR STORE ALL REQUESTS IN ORDER
*      THAT IS REQUESTED BY OPERATOR
*      IF ONE ONE TYPE OF REQUEST IS OUTSTANDING
*      THEN THE OPERATOR IS TOLD WHAT FORM TO
*      USE.   RESTART IS AN ILLEGAL MAJOR COMMAND
*
*********************************************

PA     NOP     RT2
       SKF     TOTAPE
       BRU     *+3
       CALL    OLDNEW
       BRU     *+2
       CALL    GPRI
       CALL    SORTJ
PA1    CALL    GCHOICE         GET THE OPER'S CHAOICE
       BRU     PA3             NO CHOICE RETURNS - PRINT ERROR MSG
*      SETF    1SW             ??????
PA2    CALL    PFORM1          GO PRINT THE FORM
       BRU     PA1             AND KEEP LOOPING UNTIL DONE
PA3    TYPE NJMSG              IF HERE NO FORMS TO BE PRINTED
       ERROR   NJMSG1

******************************************
*
*      TAPE SUBCOMMAND.  CAN BE USED FROM
*      EITHER PRINT OR RESTART COMMANDS. 
*      IT MAY ONLY BE USED BY CENTER OPERATORS.
*      IT MAY NOT BE USED FROM STORE.
*
*********************************************

PTAPE  NOP     RT3
       SKNF    TOTAPE
       BRU     CMDERR
       SKF     COPER
       BRU     CMDERR
       SETF    FRTAPE
       SKNF    RESFLG
       BRU     RTAPE
       CALL    GPRI
       CALL    GTAPE
       LDA     KM1
       STA     SKIPSW
PT1    CALL    RTIREC
       RET     PTAPE           NO INITIAL RECORDS
       LDA     FORMS
       XMA     OFORMS
       SKE     OFORMS
       BRU     PTNEWF
       LDA     PARTS
       ETR     SEVEN
       XMA     OPARTS
       SKE     OPARTS
       BRU     PTNEWP
       SKN     SKIPSW
       BRU     PT1
PT3    LDA     L:PG
       SUB     ONE
       STA     XL:PG
       LDA     INDCNT
       STA     XINDCT
       LDA     HSW
       STA     XHSW
       CALL    GPOPT
       CALL    PJOB
       BRU     PT1
PTNEWF LDA     PARTS
       ETR     SEVEN
       STA     OPARTS
PTNEWP TYPE    M1
       CALL    TPFORM
       CALL    YESNO
       BRU     PTFN
       LDA     KM1
       STA     SKIPSW
       BRU     PT3
PTFN   CLA
       STA     SKIPSW
       BRU     PT1


***********************************************
*
*      RESTART TAPE
*
************************************************

RTAPE  LDA     TERMC
       SKE     CR
       BRU     RST1
       TYPE    JNM
       LDB     TEN
       LDX     CIN
       BRS     38
       STA     RQSN
RST1A  CALL    GPRI
       CALL    GTAPE
RST2   CALL    RTIREC
       ERROR   NOREQT          NO REQUEST ON TAPE
       LDA     BRNO
       SKE     RQSN
       BRU     RST2
       TYPE    FNM
       CALL    GRFLNM          GET RESTART FILE NAME
       CALL    GCPYN
       CALL    GPAGN
       CALL    GPOPT
       CALL    GPRI
       LDA     TCOP
       CNA
       STA     T1
       CLA
       STA     T
RST4   SKR     T1
       BRU     *+2
       BRU     RST6
       CLA
       STA     T2
RST5   LDA     T2
       SKNE    FILES
       BRU     RST4
       CAX
       SKR     FILCOP,2
       MIN     T
       MIN     T2
       BRU     RST5
RST6   LDA     T
       ADD     FILCT
       STA     T
RST2A  SKR     T
       BRU     *+2
       BRU     RST3
       CALL    SKIPFL
       BRU     RST2A
RST3   CALL    RJOB
       BRU     PT1
RST1   CALL    1NUM
       STA     RQSN
       BRU     RST1A


***************************
*
*      REMOTE ALLOWS A CENTER OPERATOR TO PRINT
*      ON REMOTE PRINTERS
*
********************************************

PRMT   NOP     RT3
       LDA     NODPRT
       ETR     K3777
*      SKG     ONE             REMOTE PRINTERS CAN NOW BE ANYWHERE
       BRU     *+2
       BRU     PRMT1           NOT ON PORT 0 OR ONE
       LDA     KM1
       STA     EXTRN
       SKR     SP
       BRU     PCMD
PRMT1  BRM     CK2780          CHECK FOR 2780 TYPE
       LDA     KM1
       STA     EXTRN
       SKR     SP
       BRU     PCMD



*************************************************
*
*      PRINT A REQUEST FOR THE REQUEST THAT
*      IS AAREADY IN CORE
*
*************************************************

PJOB   NOP     RT4
       LDA     INPFLG
       SKNF    TOTAPE
       LDA     OTPFLG
       SKNF    FRTAPE
       BRU     PJ1
       MRG     JBSTA
       STA     JBSTA
PJ1    SKF     FRTAPE
       CALL    WREC
       LDA     XL:PG
       ADD     ONE
       SKNF    TOTAPE
       STA     L:PG
       TYPE    JNM
       LDA     BRNO
       PDEC    5
       TCO     CR
       CLA
       STA     FILCT
       STA     TCOP
RJOB   NOP     RT4
       CALL    SETCOP
       LDA     LLTH
       LDX     FORMS
       SKG     ZERO
       LDA     LLTHTB,2
       STA     LLTH
       SPTR    LINEA
       ADD     K132D
       XAB
       STP     LINE
       LDA     KBUF1
       STA     CCWP
       STA     BPOS
       CLA
       STA     WDS
       STA     INFILE
       LDA     TCOP
       CNA
       STA     TCOP
       SKNF    TOTAPE
       BRU     SJT1
       SKNF    RESFLG
       BRU     PJ2B                                   V 4.9
       CALL    PRJHD
       CALL    PRJHD
PJ2B   SPTR    LINEA                                  V 4.9
       ADD     LLTH
       ADD     ONE
       XAB
       STP     LINE
PJ2A   CLRF    TF1
       MIN     TCOP
PJ2    LDA     FILCT
       SKNE    FILES
       BRU     PJOBD
       CAX
       SKR     FILCOP,2
       IF DEBUG; NOP; ELSE; CALL PFILE; ENDF
       MIN     FILCT
       BRU     PJ2
PJOBD  CLA
       STA     FILCT
       SKNF    TF1             IS SET BY PFILE WHEN CALLED
       BRU     PJ2A
       CALL    PRJBTL
       SKNF    TOTAPE
       BRU     PJOBD2
       SKN     EXTRN
       BRU     *+3
       IF      BTIOSW
       CALL    FINI
       ENDF
       CALL    EXTOFF
       IF      BTIOSW
*      BRU     *+2
       ELSE
       BRU     *+2
       ENDF
*      CALL    FLUSH
       NOP     0               I DONT THINK THE FLUSH IS NECESSART
       SKF     FRTAPE
       BRU     *+3
       CALL    POSTPT
       BRU     PJOBD1
       CALL    PSTACC
PJOBD2 LDA     JBSTA
       LDB     PRILOC
       SKA     CENFLG
       CLB
       LDA     KM1
       CALL    AREMCT
       SKF     TOTAPE
PJOBD1 CALL    HARDCO
       RET     PJOB
SJT1   CALL    WTIREC
       BRU     PJ2

PSPI   NOP     RT5
       LDA     SPICP
       CALL    GSTNG
       LDX     COUT
       BRS     35
       CALL    CONFRM
       RET     PSPI


************************************************************
*
*      SET UP NUMBER OF COPIES
*      FOR EACH FILE
*
************************************************************

SETCOP NOP     RT5
       CLA
       CALL    GSTNG
       STP     TP
       LDA     KM1
       STA     T
SETCP1 MIN     T
SETCP8 GCI     TP
       BRU     SETCP4
       SNE     K203            NUMBER OF COPIES
       BRU     SETCP3
       SKE     CR              FOR THE OLD STYLE
       BRU     SETCP8
SETCP2 LDX     T
       LDA     COPIES
       STA     FILCOP,2
       BRU     SETCP1
SETCP3 GCI     TP              GET THE COUNT
       BRU     SETCP2          NONE PLAY LIKE IT BELONGS
       LDX     T
       STA     FILCOP,2
       GCI     TP
       BRU     SETCP4
       BRU     SETCP1
SETCP4 LDA     FILCT
       SKNE    ZERO            
       BRU     SETCP6          DONT BOTHER IF STARTING AT FIRST FILE
       STA     T
SETCP5 SKR     T
       BRU     *+2
       BRU     SETCP6          DONE
       LDX     T
       SKR     FILCOP,2        REDUCE IT SO WE DON'T DO IT AGAIN
       NOP
       BRU     SETCP5
SETCP6 LDA     TCOP
       SKNE    ZERO
       RET     SETCOP          OK, LETS GO
       LDB     FILES
       STB     T
SETCP7 SKR     T
       BRU     *+2
       RET     SETCOP
       LDX     T
       ADM     FILCOP,2
       BRU     SETCP7

*********************************************************
*
*      PRINT REQUEST HEADER
*
*      IF REQUEST IS GOING TO TAPE,
*      IMMEDIATE RETURN
*
********************************************

PRJHD  NOP     RT5
       IF DEBUG
       RET PRJHD
       ENDF
       SKNF    TOTAPE
       RET     PRJHD
       LDA     TOF
       CALL    PRCHAR
       LDA     BRNO
       LRSH    23
       DIV     TEN
       STB     N5
       LRSH    23
       DIV     TEN
       STB     N4
       LRSH    23
       DIV     TEN
       STB     N3
       LRSH    23
       DIV     TEN
       STB     N2
       STA     N1
       LDA     K11D
       STA     C1
       CLA
       STA     LCCT
PRJH3  LDA     N1
       CALL    PRBNUM
       LDA     N2
       CALL    PRBNUM
       LDA     N3
       CALL    PRBNUM
       LDA     N4
       CALL    PRBNUM
       LDA     N5
       CALL    PRBNUM
       LDA     CR
       CALL    PRCHAR
       MIN     LCCT
       SKR     C1
       BRU     PRJH3
       LDA     P:DAT
       CALL    PB34
       SPTR    HLIN
       STP     DP
       LDA     DATE
       ETR     MNMASK           MONTH MASK
       LRSH    10
       ADD     ONE
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP
       LDA     K17
       WCI     DP
       LDA     DATE            
       ETR     DTMASK          DATE MASK
       LRSH    5
       ADD     ONE
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP
       LDA     K17
       WCI     DP
       LDA     DATE
       ETR     YRMASK
       LRSH    14
       ADD     K74
       LRSH    23
       DIV     TEN
       ADD     K20
       WCI     DP
       CBA
       ADD     K20
       WCI     DP
       LDP     DP
       CALL    PB35
*
*      DATE PRINTED
*
*      PRINT 'REQUESTED BY' NAME
*
       LDA     P:RQB
       CALL    PB34
       SPTR    BUSN
       ADD     K14
       XAB
       CALL    PB35
       LDA     P:BLNK
       CALL    PB34
       LDA     RQNCP
       CALL    GSTNG
       CALL    PB35            PRINT THE ABOVE STRING
       LDA     P:FI
       CALL    PB34
       LDA     FILES
       CALL    PB36            PRINT THE NUMBER
       LDA     P:PG
       CALL    PB34
       LDA     PAGES
       CALL    PB36            PRINT THE NUMBER OF PAGES
       LDA     P:DIST
       CALL    PB34
       LDA     DDIST
       CALL    PB36
       LDA     P:TEL
       CALL    PB34
       LDA     TELCP
       CALL    GSTNG
       CALL    PB35            PRINT THE TELEPHONE NUMBER
       LDA     CR
       CALL    PRCHAR
       CALL    PPFORM          PRINT TYPE OF FORM
       LDA     P:OP            OPTIONS TO A
       CALL    PB34            PRINT THE ABOVE LINE
       LDA     PO:HD           HEADING
       SKN     XHSW
       BRU     *+2
       CALL    PB34            PRINT THE FACT WE HAVE A HEAD SWITCH
       LDA     PO:CO           COPIES=
       CALL    PB34
       LDA     COPIES
       CALL    PB36
       LDA     XL:PG
       ADD     ONE
       SKE     K39D
       SKNE    K54D
       BRU     PRJH3B
       LDA     PO:LM
       CALL    PB34
       LDA     XL:PG
       ADD     ONE
       CALL    PB36
PRJH3B LDA     PO:DB           DOUBLE
       SKN     XDBLSW
       BRU     *+3
       CALL    PB34
       BRU     *+3
       LDA     PO:SN           SINGLE
       CALL    PB34
       LDA     XINDCT
       SKG     ZERO
       BRU     PRJH3A
       LDA     PO:IN
       CALL    PB34
       LDA     XINDCT
       CALL    PB36
PRJH3A LDA     P:DI
       CALL    PB34            PRINT THE DELIVERY INSTRUCTIONS
       LDA     DELVI
       SKNE    ZERO
       BRU     PRJH4
       CAX
       LDA     P:PTR,2
       CALL    PB34
       BRU     PRJH5
PRJH4  LDA     DELCP
       CALL    GSTNG
       CALL    PB35
PRJH5  LDA     JBSTA
       SKA     HLDFLG
       BRU     PRJH6
*      LDA     DADCP
*      CALL    GSTNG
*      STP     TP
*      STP     DELAP
PRMA   LDX     FORMS           GET TYPE OF FORM
       LDA     P:PTR1,2        GET NUMBER OF LINES TO SKIP
       STA     C1              STORE FOR SKR
PRMA1  LDA     P:BLNK
       CALL    PB34
       LDA     CR
       CALL PRCHAR
       SKR     C1
       BRU     PRMA1
       LDX     P:40BL                  LETS PRINT 40 BLANKS
       LDA     FORMS
       SKNE    THREE                   IF 3 THEN TTY=> ONLY 6 BLANKS
CLC1   LDX     P:6BL           ALL FORMS PRINT 40 BLNKS FOR ADDR EXCEPT TTY
       COPY    XA
       STA     C1
       CALL    PB34
       LDA     DADCP
       CALL    GSTNG
       STP     TP
       STP     DELAP
       LDA     K10
       STA     T2
PRJH5A GCI     DELAP
       BRU     PRJH5Z
       SKE     CR
       BRU     *-3
       LDA     TP
       LDB     DELAP
       CALL    PB35
       LDA     C1
       CALL    PB34
       LDA     DELAP
       STA     TP
       SKR     T2
       NOP     0
       BRU     PRJH5A
PRJH5Z LDA     TP
       SKNE    DELAP
       BRU     PRJH5Y
       LDB     DELAP
       CALL    PB35
PRJH5Y SKR     T2
       BRU     *+2
       BRU     PRJH6
       LDA     CR
       CALL    PRCHAR
       BRU     PRJH5Y
PRJH6  LDA     JBSTA
       SKA     SPIFLG
       BRU     *+2
       BRU     PRJH7
       LDX     FORMS
       LDA     P:PTR3,2
       STA     C1
PRMA2  LDA      P:BLNK
       CALL    PB34
       LDA     CR
       CALL    PRCHAR
       SKR     C1
       BRU     PRMA2
       LDA     P:SP
       CALL    PB34
       LDA     SPICP
       CALL    GSTNG
       CALL    PB35
PRJH7  NOP
       RET     PRJHD

*******************************************
*
*      PRINT REQUEST TRAILER
*
**********************************************

PRJBTL NOP     RT5; IF DEBUG; RET PRJBTL; ENDF
       SKNF    TOTAPE
       RET     PRJBTL
       LDA     TOF
       CALL    PRCHAR
       LDA     FIVE
       STA     C1
       LDA     CR
       CALL    PRCHAR
       SKR     C1
       BRU     *-3
       LDA     BRNO
       LRSH    23
       DIV     TEN
       STB     N5
       LRSH    23
       DIV     TEN
       STB     N4
       LRSH    23
       DIV     TEN
       STB     N3
       LRSH    23
       DIV     TEN
       STB     N2
       STA     N1
       LDA     K11D
       STA     C1
       CLA
       STA     LCCT
PRJBT1 LDA     N1
       CALL    PRBNUM
       LDA     N2
       CALL    PRBNUM
       LDA     N3
       CALL    PRBNUM
       LDA     N4
       CALL    PRBNUM
       LDA     N5
       CALL    PRBNUM
       LDA     CR
       CALL    PRCHAR
       MIN     LCCT
       SKR     C1
       BRU     PRJBT1
       LDA     P:END
       CALL    PB34
       LDA     TOF
       CALL    PRCHAR
       RET     PRJBTL
HLIN   BSS     44
HLINE  BSS     10
IDENP  BSS     2
IDENT  BSS     2
LPTR   BSS     2
PGCPOS DATA    HLIN*3+128
PRBNUM NOP     RT6
       STA     N
       ADD     K20
       XMA     N
       MUL     K14
       LSH     23
       ADD     LCCT
       CAX
       LDA     BIGTAB,2
       LSH     12
       STA     LX
       LDA     SB12
       STA     COUNT1
PRBNU1 SKR     COUNT1
       BRU     PRBNU2
       LDB     LX
       CLA
       LSH     1
       STB     LX
       SKA     ONE
       LDA     N
       CALL    PRCHAR
       BRU     PRBNU1
PRBNU2 CLA
       CALL    PRCHAR
       CLA
       CALL    PRCHAR
       RET     PRBNUM
       OCT
BIGTAB DATA    1774,3776,6003,6003,6003,6003,6003,6003,6003,6003,3776,1774
       DATA    0140,0340,0740,0140,0140,0140,0140,0140,0140,0140,3776,3776
       DATA    3776,7777,6003,0003,0003,0006,0030,0140,0600,3000,7777,7777
       DATA    3776,7777,6003,0003,0003,0036,0036,0003,0003,6003,7777,3776
       DATA    0070,0170,0330,0630,1430,3777,7777,0030,0030,0030,0030,0030
       DATA    7777,7777,6000,6000,6000,7770,7774,0006,0003,0003,7777,7776
       DATA    3776,7777,6003,6000,6000,7776,7777,6003,6003,6003,7777,3776
       DATA    7777,7776,6014,0030,0060,0140,0140,0140,0140,0140,0140,0140
       DATA    3776,7777,6003,6003,3006,1774,1774,3006,6003,6003,7777,3776
       DATA    3776,7777,6003,6003,6003,7777,7777,0003,0003,6003,7777,3776
       DATA    1774,3776,6003,6003,6003,6003,6003,6003,6003,6003,3776,1774

       DEC
COUNT1 ZRO
OFFSET ZRO
N      ZRO

*      ENDF    0               99999999

*********************************************************
*
*      GET OPTIONS FOR SINGLE REQUESTS
*
*********************************************************

GPOPT  NOP     RT5
GPOPT1 LDA     HSW
       STA     XHSW
       LDA     DBLSW
       STA     XDBLSW
       LDA     L:PG
       SUB     ONE
       STA     XL:PG
       LDA     INDCNT
       STA     XINDCT
       CALL    HCOPTS
       TYPE    OPTMG
       CIL     CIN
       SKE     CR
       BRU     *+3
       CIO     CIN
       RET     GPOPT
       LDA     OPTCTL
       CALL    DISP
       BRU     OPTERR
       RET     GPOPT
       LDA     OPTCTL
       CALL    DIS
       BRU     OPTERR
       RET     GPOPT
       BRU     *-4

*
*      ERROR IN OPTIONS
*
OPTERR TYPE    UNREC
       BRU     GPOPT1
GPHOPT NOP     RT4
       LDA     KM1
       STA     XHSW
       RET     GPHOPT

GPLOPT NOP     RT4
       LDA     TERMC
       SKE     K35
       BRU     GPLOP1
GPLOP2 CALL    1NUM
       SKNE    ZERO
       BRU     GPLOPE
       SUB     ONE
       STA     XL:PG
       RET     GPLOPT

GPLOP1 CALL    1WD
       LDA     TERMC
       SKNE    K35
       BRU     GPLOP2
GPLOPE SKR     SP
       ERROR   UNREC

GPNHOP NOP     RT4
       CLA
       STA     XHSW
       RET     GPNHOP
GPDOPT NOP     RT4
       LDA     KM1
       STA     XDBLSW
       RET     GPDOPT

GPSOPT NOP     RT4
       CLA
       STA     XDBLSW
       RET     GPSOPT
GPIOPT NOP     RT4
       LDA     TERMC
       SKE     K35
       BRU     GPIOP1
GPIOP2 CALL    1NUM
       STA     XINDCT
       RET     GPIOPT
GPIOP1 CALL    1WD
       LDA     TERMC
       SKNE    K35
       BRU     GPIOP2
       ERROR   UNREC



OPTCTL CMD     (HEAD,GPHOPT),(LINES=,GPLOPT),(NOHEAD,GPNHOP),(DOUBLE,GPDOPT),
(SINGLE,GPSOPT),(INDENT=,GPIOPT)


**************************************
*
*      HEADING MESSAGES
*
**********************************************************

P:DAT  ASCS    '$DATE: /'
P:PG   ASCS    '   PAGES: /'
P:FI   ASCS    '$FILES: /'
P:SP   ASCS    '$***ADDITIONAL DELIVERY INSTRUCTIONS******$/'
P:DI   ASCS    '$$DELIVERY INSTRUCTIONS$/'
P:RQB  ASCS    '         USER NAME: /'
P:40BL ASCS    '                                        /'
P:6BL  ASCS    '                 /'
P:BLNK ASCS    '    /'
P:TEL  ASCS    '   PHONE: /'
P:DIST ASCS    '   DISTRICT:  /'
P:END  ASCS    '$$END OF REQUEST$/'
P:PTR  DATA    0,P:D1,P:D2,P:D3,P:D4,P:D5,P:D6,P:D7
P:PTR1 DATA    0,9,5,13,5,9,5  NUMBER OF LINES TO SKIP AT TOP OF ADDR
P:PTR2 DATA    0,P:F1,P:F2,P:F3,P:F4,P:F5,P:F6
P:PTR3 DATA    0,5,10,12,10,5,10 NUMBER OF LINES TO SKIP AT BOT OF ADDR
P:D1   ASC     'REGULAR MAIL/'
P:D2   ASC     'AIR MAIL/'
P:D3   ASC     'AIR EXPRESS/'
P:D4   ASC     'COURIER SERVICE/'
P:D5   ASC     'HOLD FOR PICKUP/'
P:D6   ASC     'SPECIAL DELIVERY/'
P:D7   ASC     'INTER-OFFICE MAIL/'
P:OP   ASCS    '$OPTIONS: /'
PO:HD  ASCS    'HEAD,/'
PO:CO  ASCS    'COPIES=/'
PO:LM  ASCS    ',LINES=/'
PO:DB  ASCS    ',DOUBLE/'
PO:SN  ASCS    ',SINGLE/'
PO:IN  ASCS    ',INDENT=/'
P:PART ASCS    ' PART /'
P:F1   ASC     ' SMALL PAPER/'
P:F2   ASC     ' LARGE PAPER/'
P:F3   ASC     ' TTY PAPER/'
P:F4   ASC     ' SPECIAL FORMS/'
P:F5   ASC     ' SMALL WHITE PAPER/'
P:F6   ASC     ' LARGE WHITE PAPER/'
P:DECM ASCS    ' DECOLATED/'
TO:MSG T       ' TO: /'

*************************************
*
*      COMMAND LISTS
*
*************************************
GCC    CMD     (SPECIAL,GCSP,2),(BIG,GCB),(LARGE,GCB),(TTY,GCT),(SMALL,GCS,2)
PCMDL  CMD (FORMS,PFORM),(ALL,PA),(TAPE,PTAPE),(REMOTE,PRMT),(TEST,PBARPL)
TPTRC  CMD     (CDC,GPCDC),(VOUGE,GPVOU),(DP,GPDP),(2780,GP278)
IWC    CMD     (WHITE,GCWH)

******************************************************
*
*      LOCAL VALUES WHICH SHOULD NOT BE CHANGED
*      BUT ARE NOT NEEDED IN CONSTANT PACKAGE
*
******************************************************

IREC   DATA    11111111B
DREC   DATA    22222222B
EOTREC DATA    33333333B

REDOFL DATA    DONE+INPROC+ONTAPE
NPEND  DATA    DONE+INPROC+ONTAPE+CANCLD+XFERED
NPEND1 DATA    DONE+CANCLD+HELD
NPEND2 DATA    INPROC+ONTAPE+XFERED
XCANFL DATA    CANCLD+XFERED
KBUF1  DATA    BUFF+1
KMAPBU DATA    MAPBUF
MRECSZ DATA    -RECSIZ
KTBUFF DATA    TBUFF
KPLST  DATA    PLIST
KPLSTE DATA    PLISTE
KEQPT  DATA    EQPT

K130D  DATA    130
K66D   DATA    66
K11D   DATA    11
K13D   DATA    13D
K24D   DATA    24
K17D   DATA    17
K20D   DATA    20
K32    DATA    32B
K35    DATA    35B
K33D   DATA    33
K39D   DATA    39D
K54D   DATA    54
K72D   DATA    72
K132D  DATA    132
KM24D  DATA    -24
KM12D  DATA    -12
KM100  DATA    -100B
K2002  DATA    2002B
A:CHAR DATA    7000B

FMT1   DATA    10005B3

SB132  DATA    132+4B7
SB12   DATA    12+4B7
K11B5  DATA    11B5
K21B6  DATA    21B6
K516B5 DATA    516B5
BIGPOS DATA    3777777B
K47D   DATA    47
I:ID   DATA    1320441B
IS2780 ZRO
AFSV4  DATA    IS2780

*****************************************
*
*      FILES USED FOR STORE ACCOUNTING
*
********************************************

       IF      DEBUG
MAPFP  ASCP    '(CCARTER)MOVEMAP'
MFPTR  ASCP    '(CCARTER)COMPMOVE'
       ELSE
MAPFP  ASCP    '(SPOOL)MOVEMAP'
MFPTR  ASCP    '(SPOOL)COMPMOVE'
       ENDF


****************************************************
*
*      TABLE FOR HEADINGS
*
*****************************************************


*
*      THIS ROUTINE PRINTS THE BARBER POLE
*
PBARPL NOP     RT4
       SKNF    TOTAPE          IF TO TAPE RETURN IMMED
       RET     PBARPL
       CALL GPRI               GET THE PRINTER
       LDA     EXTRN           LET'S INIT THE SYST PRI IF WE GO TO IT
       SKE     ZERO            SYSTEM PRI?
       BRU     PBAR0           NO THEN GO PRINT
       LDA     K132D           
       STA     LLTH            LINE LENGTH
       SPTR    LINEA
       ADD     K132D
       XAB
       STP     LINE
       LDA     KBUF1
       STA     BPOS
       STA     CCWP
       CLA
       STA     WDS
       STA     INFILE
       CNA
       STA     TCOP
PBAR0  LDA     TOF
       CALL    PRCHAR
       LDA     K130D           130 CHARACTERS
       STA     C1
       LDA     K66D
       STA     C2
       LDA     THREE           4 PAGES
       STA     C3
PBAR1  LDA     SCHAR           GET STARTING CHARACTER
       SKNE    K77             GREATER THAN 77B SET TO 1
       LDA     ONE
       STA     SCHAR
       STA     BCHAR
PBAR2  LDA     BCHAR           GET THE CHARACTER TO PRINT
       CALL    PRCHAR
       MIN     BCHAR
       LDA     BCHAR
       SKNE    K77
       LDA     ONE
       STA     BCHAR
       SKR     C1
       BRU     PBAR2
       LDA     K130D
       STA     C1
       LDA     CR
       CALL    PRCHAR
       MIN     SCHAR           INCR LINE STARTING CHAR
       SKR     C2              PAGE YET?
       BRU     PBAR1           NO
       LDA     K66D
       STA     C2
       SKR     C3              4 PAGES YET?
       BRU     PBAR1           NO
       SKN     EXTRN
       BRU     *+3
       IF      BTIOSW
       CALL FINI
       ENDF
       CALL EXTOFF
       NOP
       NOP
       RET     STORE
SCHAR  DATA    1
BCHAR  DATA    0

GPRI   NOP     RT5
       SKN     APSW
       BRU     *+2
       RET     GPRI
       CLRF    FULLSW
       SKN     EXTRN
       BRU     GSPRI
       TYPE    ATPM
       LDA     TPTRC
       CALL    DISP
       ERROR   NVT
       ERROR   NVT
       TYPE    UPLOWM
       CALL    YESNO
       BRU     *+2
       SETF    FULLSW
       SKR     APSW
       BRU     *-1
       RET     GPRI
GSPRI  TYPE    APM
       CALL    YESNO
       ERROR   NOPRIA
       SKR     APSW
       BRU     *-1
GTAPE  NOP     RT5
       IF      DEBUG
       RET     GTAPE
       ELSE
       BRS     104
       SKA     K4B7
       RET     GTAPE
       STX     T
       LDA     KEQPT
       LDX     K33D
       BRS     7
       LDA     EQPT
       SKE     T
       ERROR   NOPRIA
       RET     GTAPE
       ENDF

GPCDC  NOP     RT10
       CLA
       STA     EPTYPE
       RET     GPCDC
GPVOU  NOP     RT10
       LDA     ONE
       STA     EPTYPE
       RET     GPVOU
GPDP   NOP     RT10
       LDA     TWO
       STA     EPTYPE
       RET     GPDP
GP278  NOP     RT10
       LDA     THREE
       STA     EPTYPE
       RET     GP278


OLDNEW NOP     RT7
       TYPE    OLNWMG          NEW TAPE?
       CALL    YESNO
       BRU     OLDT
       CALL    ERASE
       RET     OLDNEW
OLDT   CALL    RTREC
       NOP     0
       LDA     TIBTYP
       SKNE    EOTREC
       BRU     OLDT2
       SKE     IREC
       SKNE    DREC
       BRU     OLDT1
       ERROR   NSPTAP          NOT A SPOOL TPPE
OLDT1  CALL    SKIPFL
       BRU     OLDT
OLDT2  LDA     TWO
       BRS     105
*      LDA     FIVE
*      BRS     105             ERASE THREE INCHES
       SKA     OPMASK
       BRU     *+2
       RET     OLDNEW
       SKNE    K11B5
       ERROR   WPRO
       ERROR   UNKTER

ERASE  NOP     RT8
       CALL     REWIND
       LDA     FIVE
       IF      DEBUG
       CLA
       ELSE
       BRS     105
       ENDF
       SKA     OPMASK
       BRU     *+2
       RET     ERASE
       SKNE    K11B5
       ERROR   WPRO
       ERROR   UNKTER
REWIND NOP     RT9
       IF      -DEBUG
       CALL    ASGT
       LDA     SIX
       BRS     105
       ENDF
       RET     REWIND

SKIPFL NOP     RT9
       IF      -DEBUG
       CALL    ASGT
       LDA     THREE
       BRS     105
       ENDF
       RET     SKIPFL


*
*SUBROUTINES
*
WTIREC NOP     RT7
       LDX     MRECSZ
       LDA     PCBE,2
       STA     TOBDAT+RECSIZ,2
       BRX     *-2
       CALL     GSTARA          GET ALL STRINGS ALSO
       LDA     IREC
       STA     TOBTYP
       CALL     TWT             TATP WRITE
       CALL     TEOF            END OF FILE
       RET     WTIREC

WTDREC NOP     RT8
       LDA     DREC
       STA     TOBTYP
       CALL     TWT
       RET     WTDREC

CLTAPE NOP     RT8             CLOSE TAPE
       SKF     TOTAPE
       BRU     CLTP1           NOT A STORE
       LDA     EOTREC
       STA     TOBTYP
       CALL     TWT
       CALL     TEOF
       CALL     TEOF
CLTP1  CALL     REWIND
       BRS     101             RELEASE THE UNIT
       RET     CLTAPE

TWT    NOP     RT9             WRITE A TAPE RECORD
       LDA     K2002
       STA     TOBCTL
       CLA
       STA     TOBR2
TWTV   NOP     RT9
       CALL    ASGT
       LDA     KTBUFF
       IF      DEBUG
       CLA
       STA     TBUFF
       ELSE
       BRS     103             WRITE
       ENDF
       CLA
       XMA     TBUFF
       LDB     OPMASK
       SKB     TBUFF
       BRU     *+2
       RET     TWT
       SKM     K5B5
       BRU     *+2
       RET     TWT
       SKM     K6B5
       BRU     *+2
       ERROR   EOT
       SKM     K7B5
       ERROR   UNKTER
       ERROR   NOTRDY

TEOF   NOP     RT10            WRITE AND END OF FILE
       IF      -DEBUG
       LDA     SEVEN
       BRS     105
       ENDF
       RET     TEOF

RTIREC NOP     RT8             FIND AN IREC
       CALL     RTREC
       BRU     *-1
       LDA     TIBTYP
       SKNE    IREC
       BRU     RTIR1
       SKNE    EOTREC
       RET     RTIREC
       SKE     DREC
       ERROR   UNKTER            DOES NOT EXIST
       LDA     THREE
       BRS     105
       BRU     RTIREC+1        AFTER SKIP NEXT FILE TRY AGAIN.
RTIR1  LDX     MRECSZ
       LDA     TIBDAT+RECSIZ,2
       STA     PCBE,2
       BRX     *-2
       CALL     CTSTNG
       LDA     THREE
       BRS     105
       SKIPRT  RTIREC


RTREC  NOP     RT9
       CALL     ASGT
       LDX     ONE
       LDB     K3777
       LDA     KTBUFF
       BRS     102
       LDA     TBUFF
       LDB     K77B5
       SKM     K5B5
       BRU     *+2
       SKIPRT  RTREC
       SKM     K2B5
       BRU     *+2
       RET     RTREC           END OF FILE
       SKM     K6B5
       BRU     *+2
       ERROR   EOT             END OF TAPE
       SKM     K7B5
       ERROR   UNKTER            SOME TYPE OF TAPE ERROR
       ERROR   NOTRDY          TAPE OUT OF READY.

POSTPT NOP     RT9
       LDP     MFPTR
       MRG     K516B5
       LDX     TWO
       BRS     65
       BRU     PSTP1
       STA     PPFL
       LDP     MAPFP
       BRS     48
       BRU     PSTP3
       LDP     MAPFP
       LDX     TWO
       MRG     K516B5
       BRS     65
       BRU     PSTP1
       STA     OFILE
       CLA
       SCP     OFILE
       NOP
       LDA     K100
       LDX     KMAPBUF
       BIO     OFILE
       NOP
PSTP2  LDX     CPN
       LDA     KM1
       STA     MAPBUF,2
       LDA     K4B7
       SCP     OFILE
       NOP
       LDA     K100
       LDX     KMAPBUF
       BIO     OFILE
       NOP
       RSP     PPFL
       MRG     K4B7
       SCP     PPFL
       NOP
       LDA     CPN
       WIO     PPFL
       LDA     BRNO
       WIO     PPFL
       LDA     KM1
       LDX     K100
       BRS     176
       WIO     PPFL
       LDA     PPFL
       BRS     20
       LDA     OFILE
       BRS     20
       RET     POSTPT
PSTP1  CALL     CKBUSY
       ERROR   BF
       BRU     POSTPT+1

PSTP3  LDX     KM100
       CLA
       STA     MAPBUF+100B,2
       BRX     *-1
       LDP     MAPFP
       LDX     TWO
       MRG     K516B5
       BRS     65
       BRU     PSTP1
       STA     OFILE
       BRU     PSTP2

*      ASSIGN DEVICES UNCONDITIONALLY, ASSUME RIGHT TO THEM

ASGT   NOP     RT10
       CLA
       LDX     KM1
       BRS     100
       ERROR   NOPRIA
       RET     ASGT

ASGP   NOP     RT10            PRINTER
       LDA     TWO
       LDX     KM1
       BRS     100
       ERROR   NOPRIA
       RET     ASGP

PSTACC NOP     RT5
       LDA     JBSTA
       SKA     DONFLG
       BRU     *+2
       BRU     *+3
       CLRF    ERFLG
       RET     PSTACC
       CALL     POSTAC
       LDA     CPRLOC
       SKN     EXTRN
       LDA     KM1
       STA     LOC:PR
       CALL     CMPJB
       RET     PSTACC

*      CONFIRM THAT PAPER IS READY BY ASKING FOR NAME

CONFRM NOP     RT9
       LDA     CIN
       CAX
       SKNE    ZERO
       BRU     *+2
       BRU     *+3
       SKF     2780FL
       BRS     11
       TYPE    CNFM
       CLA
       XMA     CIN
       CAB
       CIL     CIN
       SKE     CR
       BRU     *+3
       CIO     CIN
       BRU     *-4
       CALL     FLCR
       STB     CIN
       RET     CONFRM

HARDCS NOP     RT6
       TYPE    BRNM            BATCH REQUEST NUMBER MESSAGE
       LDA     BRNO
       PDEC    5

       TYPE QAMSG              QA BY ECT.
       TYPE    DATMSG          DATE AND TIME          55467
       LDA     DATTIM                                 55467
       LDX     K300                                   55467
       BRS     176                                    55467
       STP     TP                                     55467
       ETR     MNMASK                                 55467
       LRSH    10              GET THE MONTH          55467
       ADD     ONE             THO MAKE IT RIGHT      55467
       PDEC    2                                      55467
       TCO     K17             SLASH                  55467
       LDA     TP                                     55467
       ETR     DTMASK                                  55467
       LRSH    5                                      55467
       ADD     ONE                                    55467
       PDEC    2               PRINT DAY OF MONTH     55467
       TCO     K17             SLASH                  55467
       LDA     TP                                     55467
       ETR     YRMASK                                 55467
       LRSH    14                                     55467
       ADD     K74             GET THE RIGHT YEAR     55467
       PDEC    2                                      55467
       LDX     KM4                                    55467
       TCO     ZERO                                   55467
       BRX     *-1                                    55467
       LDA     TP                                     55467
       ETR     K37                                    55467
       PDEC    2               THE HOUR               55467
       TCO     K32             COLON                  55467
       LDP     TP                                     55467
       CLA     0                                      55467
       LSH     6                                      55467
       PDEC    2               THE HOUR               55467

       TYPE    RBM
       LDA     RQNCP
       CALL    GSTNG
       LDX     COUT
       BRS     35

       TYPE    EBM             ENTERED BY MESSAGE
       SPTR    USN
       ADD     K14
       XAB
       LDX     COUT
       BRS     35              TYPE OUT USER NAME

       LDA     JBSTA
       SKA     CUSFLG         FOR A CUSTOMER
       BRU     *+2
       BRU     HC1
       TYPE    FUM             FOR USER MESSAGE
       SPTR    BUSN
       ADD     K14
       XAB
       LDX     COUT
       BRS     35              CUSTOMER USER NAME

HC1    TYPE    PJCM            PROJECT CODE MESSAGE
       SPTR    PJC
       ADD     K14
       XAB     
       LDX     COUT
       BRS     35

       TYPE    TELENM          NOW FOR THE TELEPHONE
       LDA     TELCP
       CALL     GSTNG           GET THE TELEPHONE STRING
       LDX     COUT
       BRS     35              TYPE IT OUT
       TYPE    DISTMG
       LDA     DDIST
       PDEC    0
       LDB     JBSTA
       SKB     XFRDED          IS THE REQUEST TRANSFERED
       BRU     *+2
       BRU     HC11A
       TYPE    SPTPLM
       LDA     OPRLOC
       PDEC    0
       BRU     *+2             WANT TO PRINT THE FOR TRANS MSG ALSO
HC11A  SKB     XFRFLG          TO BE TRANSFERED
       BRU     *+2
       BRU     HC1A           
       TYPE    FTRTOM
       SPTR    XFRADR
       ADD     K10
       ADD     K20
       XAB
       LDX     COUT
       BRS     35
HC1A   CALL    HCOPTS
       BRU     HC2
HCOPTS NOP     RT7
       TYPE    OPM
       SKN     XHSW
       BRU     *+2
       TYPE    HDMSG
       TYPE    COPIMG
       LDA     COPIES
       PDEC    0
       LDA     XL:PG
       ADD     ONE
       SKE     K39D
       SKNE    K54D
       BRU     *+3
       TYPE    LINESM
       PDEC    0
       SKN     XDBLSW
       BRU     *+3
       TYPE    DBLMSG
       BRU     *+2
       TYPE    SGLMSG
       LDA     XINDCT
       SKG     ZERO
       BRU     *+3
       TYPE    INDTMG
       PDEC    0
       TCO     CR
       RET     HCOPTS

HC2    TYPE    DSCWM           DESCRIPTION OF WORK MESSAGE
       CALL     TPFORM
       LDA PAGES; ADD FILES; ADD FILES; ADD FILES; ADD FIVE
       PDEC 0; TYPE PGM1 (LETS PRINT TOTTAL PAGES)
HC3    TYPE    TFFM            THE FOLLOWING FILES
       CLA
       CALL     GSTNG
       STP     TP
HC3L   GCI     TP
       BRU     HC3E
       CIO     COUT
       SKE     K203
       BRU     HC3L
       GCI     TP
       BRU     HC3E
       PDEC    0
       BRU     HC3L

HC3E   TYPE    DELIM           DELIVERY INSTRUCTIONS
       LDA     DELVI
       SKNE    ZERO
       BRU     HC3A
       CAX
       TYPE*   *,2
       NOP     MAILM           MAIL
       NOP     AMAILM          AIR MAIL
       NOP     AEXM
       NOP     COURM
       NOP     HOLDM           HOLD
       NOP     SPDM            SPECIAL DELIVERY
       NOP     OMM             OFFICE MAIL
       BRU     HC3B
HC3A   LDA     DELCP
       CALL     GSTNG
       LDX     COUT
       BRS     35

HC3B   LDA     JBSTA
       SKA     HJBFLG
       BRU     HC4
       TYPE    DADM
       LDA     DADCP
       CALL     GSTNG
       LDX     COUT
       BRS     35

HC4    LDA     JBSTA
       SKA     SPIFLG
       BRU     *+2
       BRU     HC5
       TYPE    SPIM
       TCO     CR
       LDA     SPICP
       CALL     GSTNG
       LDX     COUT
       BRS     35
HC5    LDX KM12D; TCO CR; BRX *-1
       RET     HARDCS

HARD   NOP     RT1
       CLRF    ERFLG
       SKF     OPER
       BRU     CMDERR
       CALL    SIMAP
       CLAB
       STP     XBUSN
       STP     XBUSN+2
       LDA     TERMC
       SKE     CR
       BRU     HARD1
       TYPE    BRNMSG
       LDB     TEN
       LDX     CIN
       BRS     38
       STA     RQSN
HARD1A CALL    GBNAM
       LDP     BUSN
       STP     XBUSN
       LDP     BUSN+2
       STP     XBUSN+2
HARD2  CALL    GRECN
       ERROR   NVJ
       LDA     BRNO
       SKE     RQSN
       BRU     HARDE1
HARD2A LDP     BUSN
       SKE     XBUSN
       BRU     HARDE1
       XAB
       SKE     XBUSN+1
       BRU     HARDE1
       LDP     BUSN+2
       SKE     XBUSN+2
       BRU     HARDE1
       XAB
       SKE     XBUSN+3
       BRU     HARDE1
       LDA     HSW
       STA     XHSW
       LDA     DBLSW
       STA     XDBLSW
       LDA     L:PG
       SUB     ONE
       STA     XL:PG
       LDA     INDCNT
       STA     XINDCT
       TYPE    DUPHAR
       CALL    HARDCS
       TYPE    DUPHAR
       RET     HARD

HARD1  CALL    1NUM
       STA     RQSN
       LDA     TERMC
       SKNE    CR
       BRU     HARD1A
       CALL    1WD
       MOVSTG  XBUSN
       BRU     HARD2

HARDE1 CALL    GDREC
       ERROR   NVJ
       BRU     HARD2A


HARDCO NOP     RT5
       CALL     HARDCS
       LDA     CR
       CIO     COUT
       CIO     COUT
       CIO     COUT
       CIO     COUT
       LDA     PAGES
       PDEC    0
       TYPE    PAGEM
       LDA     CR
       CIO     COUT
       SKNF    ERFLG
       TYPE    EIPMSG          ERROR IN PRINTING MESSAGE

       SPTR    HLIN
       BRS     91
       XAB
       SUB     FOUR
       XAB
       LDX     COUT
       BRS     35
       TYPE    CMPBYM
       LDA     JBSTA
       SKA     HJBFLG
       BRU     HARDC1
       TYPE    POSTBM
       SKA     CENFLG
       BRU     *+3
       TYPE    POSTB2
       BRU     *+2
       TYPE    POSTB3
HARDC1 SKNF    2780FL
       TCO     TOF
       RET     HARDCO
       ZRO
PPFORM NOP     *-1
       LDA     PARTS
       ETR     SEVEN           GET RID OF POSSIBLE DECOLATE BIT
       CALL    PB36
       LDA     P:PART
       CALL    PB34
       LDX     FORMS
       LDA     P:PTR2,2
       CALL    PB34
       LDA     PARTS
       SKA     K2B7
       BRU     *+2
       RET     PPFORM
       LDA     P:DECM
       CALL    PB34
       RET     PPFORM


       ZRO
TPFORM NOP     *-1
       LDA     FORMS
       SKNE    FOUR
       BRU     TPFRM1            SPECIAL FORMS
       LDA     PARTS
       ETR     SEVEN           GET RID OF POSSIBLE DECOLATE BIT
       PDEC    0
       TYPE    PARTM
       LDX     FORMS
       TYPE*   TTAB,2
       LDA     PARTS
       SKA     K2B7
       TYPE    DECM
       RET     TPFORM
TPFRM1 TYPE    SFBM
       LDA     SPFCP
       CALL     GSTNG
       LDX     COUT
       BRS     35
       RET     TPFORM

TTAB   ZRO
       ZRO     SMALLM
       ZRO     BIGM
       ZRO     TTYM
       ZRO
       ZRO     SMALLW
       ZRO     LARGEW


*      TYPE OUT CHOICES, IF MORE THAN ONE THEN GIVES CHOICE, ELSE
*      TELLS THE OP WHAT TO DO

*      IF NONE THEN NON SKIP RETURN

PCHOICE NOP    RT4
       LDA     KM1
       STA     FL
       LDA     K24D
       STA     CT
       CLX
GC1    CLA
       SKR     CT
       BRU     *+2
       RET     PCHOICE
       SKE     LINK,2
       BRU     GC3
GC2    EAX     1,2
       BRU     GC1
GC3    STX     T
       SKN     FL
       BRU     *+2
       TYPE    TRQM
       MIN     FL
       LDB     TOTPG,2
       LDA     COUT
       MRG     FMT1
       COPY    AX,BA
       BRS     165
       TYPE    PAGEM
       LDX     T
       CALL    TYPPJM
       LDA     CR
       CIO     COUT
       BRU     GC2
GCHOICE NOP    RT3
       CALL     PCHOICE
       SKN     FL
       BRU     *+2
       RET     GCHOICE
       SKNE    FL
       BRU     GC5
       TYPE    WFW             WHAT FORM WANTED
       LDA     GCC
       CALL     DISP
       RET     GCHOICE
       RET     GCHOICE
       CALL    CONFRM
       SKIPRT  GCHOICE
GC5    TYPE    MOUNTM
       LDX     T
       CALL    TYPPJM
       CALL    CONFRM
       LDX     T
       CLA
       XMA     LINK,2
       STA     JBPTR
       SKIPRT  GCHOICE


TYPPJM NOP     RT5
       STX     T
       CXA
       SUB     ONE
       LRSH    23
       DIV     FOUR
       ADD     ONE
       STA     FORMS
       STB     PARTS
       MIN     PARTS
       CALL    TPFORM
       LDX     T
       RET     TYPPJM


GCS    NOP     RT4
       SETF    TF2
       LDA     IWC
       CALL    DIS
       BRU     GCS1
       BRU GCS0
       BRU     GCS2
GCS0   CLRF TF2
GCS1   CALL     GCSP
GCS2   STA     T
       STA     OFFSET
       CAX
       CLA
       XMA     LINK,2
       STA     JBPTR
       RET     GCS

GCB    NOP     RT4
       SETF    TF2
       LDA     IWC
       CALL    DIS
       BRU     GCB1
       BRU GCB0
       BRU     GCB2
GCB0   CLRF    TF2
GCB1   CALL     GCSP
GCB2   ADD     FOUR
       STA     T
       STA     OFFSET
       CAX
       CLA
       XMA     LINK,2
       STA     JBPTR
GCBR   RET     GCB

GCT    NOP     RT4
       CALL     GCSP
       ADD     K10
       STA     T
       STA     OFFSET
       CAX
       CLA
       XMA     LINK,2
       STA     JBPTR
       RET     GCT

GCSF   NOP     RT4
       LDX     K13D
       STX     T
       STX     OFFSET
       CLA
       XMA     LINK,2
       STA     JBPTR
       RET     GCSF

GCSP   NOP     RT5
       SKNF    TF2
       BRU     GCSP3
       LDA     TERMC
       SKE     CR
       BRU     GCSP1
       TYPE    PARTM
       LDB     TEN
       LDX     CIN
       BRS     38
GCSP2  SKG     FOUR
       SKG     ZERO
       BRU     CMDERR
       RET     GCSP
GCSP1  CALL    1NUM
       BRU     GCSP2
GCSP3  CALL    CVNUM
       BRU     GCSP2

GCWH   NOP     RT5
       CLRF    TF2
       LDA     K17D
       RET     GCWH

*      SORT JOBS BY FORMS
SORTJ  NOP     RT4
       LDA     KPLST
       STA     LISTP
       CLA
       STA     CNT
       LDX     KM24D
       STA     LINKE,2
       STA     TOTPGE,2
       BRX     *-2
       CALL     GLCJB
       RET     SORTJ
       CALL     GREC
SJ2    LDB     JBSTA
       SKB     NPEND1
       BRU     SJ1
       SKN     EXTRN
       BRU     SJ3
       SKB     CENFLG
       BRU     SJ1
       LDA     PRILOC
       SKE     CPRLOC
       BRU     SJ1
       BRU     SJ3A
SJ3    SKB     REMFLG
       BRU     SJ1
SJ3A   MIN     CNT
       SKB     NPEND2
       BRU     SJ1
*      THE FOLLOWING ALLOWS PRINTING ACCORDING TO THE FOLLOWING TRUTH TABLE
*
*      REQUIRES FULLCASE       FULLCASE PRINTER
*              0                       0              1
*              0                       1              1
*              1                       0              0
*              1                       1              1
*
       SKB     FULFLG
       SKNF    FULLSW
       BRU     *+2
       BRU     SJ1
       LDX     LISTP
       LDA     BRNO
       STA     1,2
       CLAB
       STA     0,2
       LDA     FORMS
       SUB     ONE
       LSH     2
       ADD     PARTS
       COPY    AX,E
       LDA     LISTP
       CAB
       ADD     TWO             RCSIZE
       SKG     KPLSTE
       BRU     *+2
       RET     SORTJ           ERROR OF SORTS OVERFLOW TABLE
       STA     LISTP
       LDA     PAGES
       ADM     TOTPG,2
       LDA     FILES
       ADM     TOTPG,2
       ADM     TOTPG,2
       ADM     TOTPG,2
       LDA     FIVE
       ADM     TOTPG,2
       CALL     INSERT
SJ1    CALL     GNJOB
       BRU     *+2
       BRU     SJ2
       LDA     CNT
       SKN     EXTRN
       BRU     *+3
       CALL    UREMCT
       BRU     *+2
       CALL     UPDCNT
       CALL    SIMAP
       RET     SORTJ

*      INSERTS LINKS FOR TABLE

INSERT NOP     RT5
       LDA     LINK,2
       SKE     ZERO
       BRU     *+3
       STB     LINK,2
       RET     INSERT
       CAX
       LDA     0,2
       SKE     ZERO
       BRU     *-3
       STB     0,2
       RET     INSERT
CKJD   NOP     RT7
       LDA     JBSTA
       SKA     REDOFL
       BRU     *+2
       RET     CKJD
       CALL     GDREC
       NOP
       BRU     CKJD+1

NAMCNF NOP     RT5
       TYPE    USNM
       SPTR    BUSN
       ADD     K14
       XAB
       LDX     COUT
       BRS     35
*      LDA     K37
*      CIO     COUT
       BRU     *+2
       BRU     NAMCNF+1
*
*      MOD TO PRINT DATE ALSO
*
       LDA     DATE
       LRSH    10
       ETR     K17
       ADD     ONE
       PDEC    2
       TCO     K17
       LDA     DATE
       LRSH    5
       ETR     K37
       ADD     ONE
       PDEC    2
       TCO     K17             /
       LDA     DATE
       LRSH    14
       ADD     K74
       PDEC    2
       TCO     ZERO
       LDA     K37
       CIO     COUT
       CALL     YESNO
       BRU     *+2
       RET     NAMCNF
       CALL     GDREC
       ERROR   NVJ
       LDA     BRNO
       SKE     RQSN
       ERROR   NVJ
       BRU     NAMCNF+1

****************************************************
*                                                  *
*      DELETE ONE FILE FROM A REQUEST              *
*      IT IS RECOGNISED THAT THIS WILL             *
*      THROW OFF THE NUMBER OF PAGES               *
*      AND CHARACTER COUNT FOR ACCOUNTING          *
*      BUT IT DOES SEEM TO BE A REQUIREMENT        *
*      FOR THE SYSTEM.  IT REQURES OPERATOR        *
*      STATUS AT LEAST AND THE REQUEST NUMBER     *
*      AS WELL AS THE FILE NAME                   *
*                                                 *
***************************************************

DELETE NOP     RT1
       SKF     OPER
       BRU     CMDERR
       CALL    SIMAP
       LDA     TERMC
       SKNE    CR
       BRU     DEL1A
       CALL    1NUM
       SKG     ZERO
       ERROR   NVJ
       STA     RQSN
       CALL    GRECN
       ERROR   NVJ
       LDA     TERMC
       SKNE    CR
       BRU     DEL1B
       CALL    1WD
DEL1   STP     FLNP
       XAB
       SUB     FLNP
       STA     FLTH
       CLA
       STA     FILCT
       CALL    GSTNG
       STP     TP
DEL2   CAB
       ADD     FLTH
       XAB
       SKSE    FLNP
       BRU     *+2
       BRU     DEL3            DELETE THE FILE
DEL2A  GCI     TP              COMES BACK HERE AFTER DELETE ALSO
       RET     DELETE          ALL FINISHED
       SKE     CR
       BRU     *-3
       MIN     FILCT
       LDA     TP
       BRU     DEL2

DEL3   CALL    SSPDP           SET UP STRING POINTERS
       LDA     FILCT
       CALL    MFILNM          MAKE FILE NAME
       BRS     48              LOOK UP FILE
       BRU     DEL2A           CANNOT ACCESS THE FILE
       STA     TV1             SAVE IT FOR LATER
       LDA     K21B6           TURN OFF DELETE PROOF BIT
       CLB
       LDX     K14
       BRS     141
       BRU     DEL3            TRY AGAIN
       LDA     TV1
       BRS     69              DELETE THE FILE
       NOP     0
       BRU     DEL2A           AND KEEP GOING UNTIL THE END

DEL1A  TYPE    BRNMSG
       LDB     TEN
       LDX     CIN
       BRS     38
       STA     RQSN
       CALL    GRECN
       ERROR   NVJ
DEL1B  TYPE    FNM
       LDA     K72D
       LDB     CR
       LDX     CIN
       STNG    TFLNM
       BRU     DEL1
       BRU     DEL1
**********************************************
*
*      MOVE WILL MOVE A BATCH REQUEST TO CENTER OR OTHER REMOTE P LOC (EXEC SET)
*
***********************************************

MOVE   NOP     RT1
       CALL    SIMAP
       SKF     ROPER
       BRU     CMDERR
       TYPE    BRNMSG
       LDB TEN; LDX CIN; BRS 38; STA RQSN
       CALL    GRECN
       ERROR   NVJ
MOVE1  CALL    NAMCNF
       BRS     71D
       BRU     MOVE2
       TYPE    TO:MSG
       LDB     TEN
       LDX     CIN
       BRS     38
       BRU     MOVE3
MOVE2  LDA JBSTA; EOR K4B4; MRG K2B4; STA JBSTA
MOVE3  STA     TPL
       DISABLE
       LDB     PRILOC
       STB     OPRLOC
       LDA     KM1
       CALL    AREMCT          UPDATE THE COUNT
       LDB     TPL
       LDA     ONE
       STB     PRILOC
       CALL    AREMCT          AND ADD TO THE NEW COUNT
       CALL    WREC            REWRITE THE RECORD
       SKR     XFRCNT
       NOP     0
       CALL    OPHARD
       ENABLE
       RET     MOVE

**********************************************
*
*       CK2780 CHECKS FOR 2780,ONLY WORKS ON BIO SYSTEM ONLY
*
***********************************************

CK2780 ZRO
       CLRF    2780FL
       IF      BTIOSW
       LDA     K47D
       LDB     AFSV4
       LDX     ONE
       BRS     67
       LDA     IS2780
*      LDB     K10
*      LDX     ONE
*      BRS 36
       ETR     K17B5
       SKE     K13B5
       ERROR   WGPORT
       SETF    2780FL
       ELSE
       LDA     TERM
       LDB     BIGPOS
       SKM     I:ID
       ERROR   WGPORT
       SETF    2780FL
       ENDF
       BRR     CK2780

       NOLIST  EXT
       IF      BTIOSW
BTCO1  BRR     0
       ELSE
$BTCOP BRR     0
       ENDF
BCIO1  BRR     0
RELORG EQU     *
       END
SPOOL ** FICHE/FRAME BREAK *****
SPPRI SYMSORT

SYM.  PG.LN. IDENT.

A:CHAR 33 20 PRINT   AFSV4  33 33 PRINT   ASGP   43 38 PRINT   
ASGT   43 31 PRINT   BCHAR  36  4 PRINT   BCIO1  65 12 PRINT   BIGPOS 33 29 PRINT   
BIGTAB 28 16 PRINT   BTCO1  65  8 PRINT   BTCOP  65 10 PRINT   CK2780 64 21 PRINT   
CKEXRN  5 16 PRINT   CKJD   60  3 PRINT   CLC1   24 29 PRINT   CLTAPE 39 26 PRINT   
CLTP1  39 34 PRINT   CONFRM 44 23 PRINT   COUNT1 28 29 PRINT   DEBUG   1  2 PRINT   
DEL1   62  5 PRINT   DEL1A  63  4 PRINT   DEL1B  63 11 PRINT   DEL2   62 13 PRINT   
DEL2A  62 19 PRINT   DEL3   62 27 PRINT   DELETE 61 27 PRINT   DREC   32 25 PRINT   
EOTREC 32 26 PRINT   FMT1   33 22 PRINT   GC1    54  1 PRINT   GC2    54  7 PRINT   
GC3    54  9 PRINT   GC5    54 39 PRINT   GCB    56  4 PRINT   GCB0   56 11 PRINT   
GCB1   56 12 PRINT   GCB2   56 13 PRINT   GCBR   56 20 PRINT   GCC    32 12 PRINT   
GCHOIC 54 25 PRINT   GCPYN   9  2 PRINT   GCPYN1  9  9 PRINT   GCS    55 26 PRINT   
GCS0   55 33 PRINT   GCS1   55 34 PRINT   GCS2   55 35 PRINT   GCSF   56 33 PRINT   
GCSP   57  3 PRINT   GCSP1  57 17 PRINT   GCSP2  57 13 PRINT   GCSP3  57 19 PRINT   
GCT    56 22 PRINT   GCWH   57 22 PRINT   GP278  37 19 PRINT   GPAGN   8 25 PRINT   
GPAGN1  8 38 PRINT   GPCDC  37  7 PRINT   GPDOPT 30 19 PRINT   GPDP   37 15 PRINT   
GPHOPT 29 31 PRINT   GPIOP1 30 35 PRINT   GPIOP2 30 32 PRINT   GPIOPT 30 28 PRINT   
GPLOP1 30  8 PRINT   GPLOP2 30  1 PRINT   GPLOPE 30 12 PRINT   GPLOPT 29 36 PRINT   
GPNHOP 30 15 PRINT   GPOPT  28 38 PRINT   GPOPT1 28 39 PRINT   GPSOPT 30 24 PRINT   
GPVOU  37 11 PRINT   GRFLM1  7 31 PRINT   GRFLM2  8  1 PRINT   GRFLM3  8 14 PRINT   
GRFLM4  8 17 PRINT   GRFLM5  8  7 PRINT   GRFLNM  7 21 PRINT   GSPRI  36 24 PRINT   
GTAPE  36 29 PRINT   HARD   49 34 PRINT   HARD1  51  8 PRINT   HARD1A 50 11 PRINT   
HARD2  50 16 PRINT   HARD2A 50 21 PRINT   HARDC1 52 15 PRINT   HARDCO 51 22 PRINT   
HARDCS 45  5 PRINT   HARDE1 51 17 PRINT   HC1    46 29 PRINT   HC11A  47 13 PRINT   
HC1A   47 23 PRINT   HC2    48 14 PRINT   HC3    48 18 PRINT   HC3A   49  7 PRINT   
HC3B   49 12 PRINT   HC3E   48 32 PRINT   HC3L   48 22 PRINT   HC4    49 21 PRINT   
HC5    49 31 PRINT   HCOPTS 47 25 PRINT   HLIN   27 20 PRINT   HLINE  27 21 PRINT   
I:ID   33 31 PRINT   IDENP  27 22 PRINT   IDENT  27 23 PRINT   INSERT 59 30 PRINT   
IREC   32 24 PRINT   IS2780 33 32 PRINT   IWC    32 15 PRINT   K11B5  33 26 PRINT   
K11D   33  4 PRINT   K130D  33  2 PRINT   K132D  33 15 PRINT   K13D   33  5 PRINT   
K17D   33  7 PRINT   K2002  33 19 PRINT   K20D   33  8 PRINT   K21B6  33 27 PRINT   
K24D   33  6 PRINT   K32    33  9 PRINT   K33D   33 11 PRINT   K35    33 10 PRINT   
K39D   33 12 PRINT   K47D   33 30 PRINT   K516B5 33 28 PRINT   K54D   33 13 PRINT   
K66D   33  3 PRINT   K72D   33 14 PRINT   KBUF1  32 33 PRINT   KEQPT  32 39 PRINT   
KM100  33 18 PRINT   KM12D  33 17 PRINT   KM24D  33 16 PRINT   KMAPBU 32 34 PRINT   
KPLST  32 37 PRINT   KPLSTE 32 38 PRINT   KTBUFF 32 36 PRINT   LMERAS 38 13 PRINT   
LMGPRI 36  5 PRINT   LMM*M* 34 16 PRINT   LPTR   27 24 PRINT   MAPFP  34  6 PRINT   
MAPFP  34  3 PRINT   MFPTR  34  7 PRINT   MFPTR  34  4 PRINT   MOVE   63 22 PRINT   
MOVE1  63 30 PRINT   MOVE2  63 38 PRINT   MOVE3  63 39 PRINT   MRECSZ 32 35 PRINT   
N      28 31 PRINT   NAMCNF 60 12 PRINT   NPEND  32 29 PRINT   NPEND1 32 30 PRINT   
NPEND2 32 31 PRINT   O***** 64 17 PRINT   O***** 63 18 PRINT   OFFSET 28 30 PRINT   
OLDNEW 37 25 PRINT   OLDT   37 31 PRINT   OLDT1  38  1 PRINT   OLDT2  38  3 PRINT   
OM**** 61 15 PRINT   OM**** 32  9 PRINT   OM**** 28 34 PRINT   OM**** 26  6 PRINT   
OM**** 19 32 PRINT   OM**** 18 20 PRINT   OM**** 15 25 PRINT   OM**** 15  3 PRINT   
OM**** 13 24 PRINT   OM**** 12  7 PRINT   OM**** 11 24 PRINT   OM****  9 24 PRINT   
OM****  6  2 PRINT   OM****  3 28 PRINT   OPTCTL 31  4 PRINT   OPTERR 29 29 PRINT   
P:40BL 31 15 PRINT   P:6BL  31 16 PRINT   P:BLNK 31 17 PRINT   P:D1   31 25 PRINT   
P:D2   31 26 PRINT   P:D3   31 27 PRINT   P:D4   31 28 PRINT   P:D5   31 29 PRINT   
P:D6   31 30 PRINT   P:D7   31 31 PRINT   P:DAT  31  9 PRINT   P:DECM 32  7 PRINT   
P:DI   31 13 PRINT   P:DIST 31 19 PRINT   P:END  31 20 PRINT   P:F1   32  1 PRINT   
P:F2   32  2 PRINT   P:F3   32  3 PRINT   P:F4   32  4 PRINT   P:F5   32  5 PRINT   
P:F6   32  6 PRINT   P:FI   31 11 PRINT   P:OP   31 32 PRINT   P:PART 31 39 PRINT   
P:PG   31 10 PRINT   P:PTR  31 21 PRINT   P:PTR1 31 22 PRINT   P:PTR2 31 23 PRINT   
P:PTR3 31 24 PRINT   P:RQB  31 14 PRINT   P:SP   31 12 PRINT   P:TEL  31 18 PRINT   
PA     11 32 PRINT   PA1    11 39 PRINT   PA2    12  3 PRINT   PA3    12  5 PRINT   
PBAR0  34 39 PRINT   PBAR1  35  8 PRINT   PBAR2  35 13 PRINT   PBARPL 34 18 PRINT   
PCHOIC 53 34 PRINT   PCMD    3  1 PRINT   PCMD1   3 14 PRINT   PCMD2   3 32 PRINT   
PCMD2A  3 33 PRINT   PCMDA   2 14 PRINT   PCMDL  32 13 PRINT   PFONXT 11  9 PRINT   
PFORM   9 30 PRINT   PFORM1 10 20 PRINT   PFORM2 11 13 PRINT   PFORM3 11 21 PRINT   
PFORM4 10 32 PRINT   PFORM5 10  1 PRINT   PGCPOS 27 25 PRINT   PJ1    15 38 PRINT   
PJ2    17  6 PRINT   PJ2A   17  4 PRINT   PJ2B   16 38 PRINT   PJOB   15 30 PRINT   
PJOBD  17 14 PRINT   PJOBD1 18  7 PRINT   PJOBD2 17 39 PRINT   PN1     5 12 PRINT   
PN2     4 20 PRINT   PN3     4 11 PRINT   PN4     4 29 PRINT   PNF     5 29 PRINT   
PO:CO  31 34 PRINT   PO:DB  31 36 PRINT   PO:HD  31 33 PRINT   PO:IN  31 38 PRINT   
PO:LM  31 35 PRINT   PO:SN  31 37 PRINT   POSTPT 42  2 PRINT   PPFORM 52 19 PRINT   
PRBNU1 27 39 PRINT   PRBNU2 28 10 PRINT   PRBNUM 27 26 PRINT   PRINT   2  4 PRINT   
PRJBT1 26 39 PRINT   PRJBTL 26 10 PRINT   PRJH3  20 26 PRINT   PRJH3A 23 37 PRINT   
PRJH3B 23 23 PRINT   PRJH4  24  7 PRINT   PRJH5  24 10 PRINT   PRJH5A 24 39 PRINT   
PRJH5Y 25 19 PRINT   PRJH5Z 25 14 PRINT   PRJH6  25 25 PRINT   PRJH7  26  4 PRINT   
PRJHD  19 39 PRINT   PRMA   24 17 PRINT   PRMA1  24 20 PRINT   PRMA2  25 32 PRINT   
PRMT   15  8 PRINT   PRMT1  15 18 PRINT   PSPI   18 12 PRINT   PSTACC 44  6 PRINT   
PSTP1  43 13 PRINT   PSTP2  42 25 PRINT   PSTP3  43 17 PRINT   PT1    12 26 PRINT   
PT3    12 39 PRINT   PTAPE  12 14 PRINT   PTFN   13 20 PRINT   PTNEWF 13 10 PRINT   
PTNEWP 13 13 PRINT   REDOFL 32 28 PRINT   RELORG 65 13 PRINT   RESTAR  2 31 PRINT   
REWIND 38 27 PRINT   RJOB   16 12 PRINT   RN1     6  6 PRINT   RN2     6 20 PRINT   
RN3     6 33 PRINT   RN4     7  9 PRINT   RNEL    7 16 PRINT   RNUM    3 21 PRINT   
RST1   14 38 PRINT   RST1A  13 36 PRINT   RST2   13 38 PRINT   RST2A  14 31 PRINT   
RST3   14 36 PRINT   RST4   14 15 PRINT   RST5   14 20 PRINT   RST6   14 28 PRINT   
RTAPE  13 28 PRINT   RTIR1  41 10 PRINT   RTIREC 40 36 PRINT   RTREC  41 20 PRINT   
SB12   33 25 PRINT   SB132  33 24 PRINT   SCHAR  36  3 PRINT   SETCOP 18 25 PRINT   
SETCP1 18 31 PRINT   SETCP2 18 38 PRINT   SETCP3 19  3 PRINT   SETCP4 19 10 PRINT   
SETCP5 19 14 PRINT   SETCP6 19 21 PRINT   SETCP7 19 26 PRINT   SETCP8 18 32 PRINT   
SJ1    59 16 PRINT   SJ2    58  1 PRINT   SJ3    58 12 PRINT   SJ3A   58 14 PRINT   
SJT1   18  9 PRINT   SKIPFL 38 35 PRINT   SNT1    5 25 PRINT   SNT2    4 10 PRINT   
SORTJ  57 28 PRINT   STORE   1 34 PRINT   TEOF   40 29 PRINT   TO:MSG 32  8 PRINT   
TPFORM 52 38 PRINT   TPFRM1 53 13 PRINT   TPTRC  32 14 PRINT   TTAB   53 20 PRINT   
TWT    39 38 PRINT   TWTV   40  4 PRINT   TYPPJM 55 11 PRINT   WTDREC 39 20 PRINT   
WTIREC 39  8 PRINT   XCANFL 32 32 PRINT   _SINGL 31  5 PRINT   
SPOOL ** FICHE/FRAME BREAK *****
SPPRO
       NOLIST  EXT
*
*      ASSEMBLY SWITCHES
*
DEBUG  EQU     -1              =1 DEBUG MODE, =-1 PRODUCTION MODE
ALLSW  EQU     -1              =1 ALL FILES CODE INCLUDED
FTSW   EQU     -1              =1 USE SSPRINT DIRECTORY,=-1 USE PROPER DIR
BTIOSW EQU      1              =1 USE BLOCK TIO, =-1 USE OLD PRINT IO
*
*      VERSION AND PATCH NUMBERS
VERSION EQU    5
PATCHNO EQU    1
       IF      BTIOSW
VERSION EQU    VERSION+1
       ENDF

*      TYPE OUT SOME REMARKS WHILE ASSEMBLING

       RPT     1
       REM     VERSION REMOTE ($VERSION).($PATCHNO)
       ENDR
       IF      DEBUG
       REM     DEBUG VERSION
       ELSE
       REM     PRODUCTION VERSION
       ENDF
       IF      FTSW
       REM     USING THE DIRECTORY OF SSPRINT
       ENDF
       IF      ALLSW
       REM     ALLOW ALL FILES
       ENDF
       IF      BTIOSW
       REM     FEATURING BLOCK TERMINAL OUTPUT
       ENDF

****************************************************
*
*      POP DEFINITIONS
*
*************************************************
TYPE   OPD     100B5,2
SKIPRT OPD     1014B4,2
MOVSTG OPD     102B5,2
CIL    OPD     103B5,2
STNG   OPD     104B5,2
ERROR  OPD     105B5,2
TCO    OPD     106B5,2
PDEC   OPD     107B5
SETF   OPD     11004000B,2
CLRF   OPD     11010000B,2
SKF    OPD     11014000B,2
SKNF   OPD     11020000B,2
XFA    OPD     11000000B,1
CTYPE  OPD     111B5,2
DISABLE OPD    176B5
ENABLE OPD     177B5

************************************************************************
*
*      SYSPOP DEFINITIONS
*
*******************************************************

SKNE   OPD     536B5,2
NISC   OPD     550B5,2
NSIC   OPD     551B5,2
SPTR   OPD     514B5,2
CALL   OPD     570B5,2
SYSTCO OPD     575B5,2
RET    OPD     514B4,2
BCIO   OPD     561B5,2
       IF      BTIOSW
BTCO   OPD     160B5,2
       ELSE
BTCO   OPD     575B5,2
       ENDF

******************************************************
*
*      MACRO DEFINITIONS
*
*****************************************************

LOAD   MACRO; LDP A:; LDX X:; ENDM
STORE  MACRO; STP A:; STX X:; ENDM
T      MACRO   D
       TEXT    D(1)
       ENDM
ASCP   MACRO   D
X      NCHR   D(1)
       DATA    [*+2]*3-1+516B5,**3+X
       ASC     D(1)
       ENDM
ASCPT  MACRO   D
X      NCHR    D(1)
       DATA    [*+2]*3-1,**3+X
       ASC     D(1)
       ENDM
ASCS   MACRO   D
       DATA    *+1
       ASC     D(1)
       ENDM
CMD    MACRO   D
X      NARG
       DATA    *+1
       DATA    X
       RPT     X,(I=1)
       DC      D(I)
       ENDR
       RPT     X,(I=1)
       C       D(I)
       ENDR
       FRGT    X
       ENDM

DC     MACRO   D,G,1
Y      NARG
       DATA    G(1)*3-1
       IF      Y=1
       DATA    D(1)
       ELSE
YY     NCHR    D(2)
       IF      YY=0
       DATA    D(1)
       ELSE
       DATA    D(2)
       ENDF
       ENDF
       IF      Y#3
YY     EQU     0
       ELSE
YY     EQU     D(3)-1
       ENDF
       DATA    YY
       FRGT    YY
       FRGT    Y
       ENDM

C      MACRO   D,G,1
G(1)   ASC     'D(1)'
       FRGT    G(1)
       ENDM

ENTRY  MACRO   D
X      NARG
       RPT     X,(I=1)
D(I)   EXT
       ENDR
       FRGT    I
       FRGT    X
       ENDM
FLAG   LMACRO  D
D(0)   EQU     :FLAG:
:FLAG: EQU     :FLAG:-1
       FRGT    :FLAG:
       ENDM
:FLAG: EQU     23D

*
*      FIXED LOCATIONS IN MEMORY
*

RELORG EQU     10000B
TBUFF  EQU     24000B
TPAGE  EQU     24000B
TIBTYP EQU     TBUFF+1
TIBDAT EQU     TBUFF+2
TOBCTL EQU     TBUFF+1
TOBTYP EQU     TBUFF+2
TOBDAT EQU     TBUFF+3
TOBR2  EQU     TBUFF+2004B
IFNS   EQU     27000B
FNS    EQU     30000B
FNSE   EQU     30400B          400 WORDS FOR FILE NAMES
RQN    EQU     FNSE
RQNE   EQU     RQN+15
RQT    EQU     RQNE
RQTE   EQU     RQT+10
DELI   EQU     RQTE
DELA   EQU     DELI+40
SPF    EQU     DELA+100
SPI    EQU     SPF+20
SPIE   EQU     SPI+256
STPG   EQU     32000B
STBFSZ EQU     1000B           1000 WORDS FOR STRIG BUFFER
IBUFF  EQU     33000B
DBUFF  EQU     IBUFF
DBUFSZ EQU     1000B
BUFF   EQU     34000B
PRBUFF EQU     34000B
EOFWD  EQU     27657537B

*******************************************************
*
*      FLAG DEFINITIONS FOR JBSTA WORD
*
*******************************************************************

SPFLAG EQU     1
HEAD   EQU     2
DONE   EQU     4B7
HELD   EQU     2B7
DELFLG EQU     1B7
POSTD  EQU     4B6
ONTAPE EQU     2B6
CANCLD EQU     1B6
INPROC EQU     4B5
FORCUS EQU     2B5             FOR CUSTOMER FLAG
HOLDJB EQU     1B5             JOB IS TO BE HELD FOR PICKUP
*CENTER EQU    2B4             TO BE PRINTED AT THE CENTER
*REMOTE EQU    4B4             TO BE PRINTED AT A REMOTE SITE
XFERED EQU     1B4             TO BE TRANSFERED
*FULLCH EQU    4B3             REQUIRES FULL CHARACTER SET
*FICOPS EQU    2B3             SWITCH USED IN SPECIFING FILES
*XFRDED EQU    1B3             THIS REQUEST HAS BEEN TRANSFERED

************************************************
*
*      FLAG DEFINITIONS FOR FLAG WORD
*
************************************************


OPER   EQU     1
COPER  EQU     2
ROPER  EQU     3
STAFLG EQU     4
CHPFLG EQU     5
CORPFL EQU     6

TF1    EQU     7
TF2    EQU     8
USERFL EQU     9
STAFLAG EQU     10             EXEC STATUS FLAG
TSTFLG EQU     11
TOTAPE EQU     12
FRTAPE EQU     13
RESFLG EQU     14
ERFLG  EQU     15
2780FL EQU     16
FULLSW EQU     17
NODFLG EQU     18              IF SET, HAVE DONE NODE= OPTION.
**********************************************************
*
*      VARIOUS PARAMETERS USED THROUGHOUT
*
*************************************************

RECEXP EQU     6               RECORD SIZE IS 64
RECSIZ EQU     2^RECEXP
NJOBS  EQU     950
BOTNOD EQU     1000B           SMALLEST NODE TO LOGIN FROM

       FREEZE
       END
SPOOL ** FICHE/FRAME BREAK *****
SPPRO SYMSORT

SYM.  PG.LN. IDENT.

2780FL  7  7         :FLAG:  5  2         :FLAG:  4 38         
ALLSW   1  6         ASCP    3 12         ASCPT   3 17         ASCS    3 22         
BCIO    2 33         BOTNOD  7 19         BTCO    2 37         BTCO    2 35         
BTIOSW  1  8         BUFF    5 34         C       4 23         CALL    2 30         
CANCLD  6 12         CHPFLG  6 34         CIL     2  6         CLRF    2 12         
CMD     3 26         COPER   6 31         CORPFL  6 35         CTYPE   2 16         
D(0)    4 37         D(I)    4 31         DBUFF   5 32         DBUFSZ  5 33         
DC      3 39         DEBUG   1  5         DELA    5 25         DELFLG  6  9         
DELI    5 24         DISABL  2 17         DONE    6  7         ENABLE  2 18         
ENTRY   4 28         EOFWD   5 36         ERFLG   7  6         ERROR   2  8         
FLAG    4 36         FNS     5 18         FNSE    5 19         FORCUS  6 14         
FRTAPE  7  4         FTSW    1  7         FULLSW  7  8         G(1)    4 24         
HEAD    6  6         HELD    6  8         HOLDJB  6 15         IBUFF   5 31         
IFNS    5 17         INPROC  6 13         LOAD    3  7         MOVSTG  2  5         
NISC    2 27         NJOBS   7 18         NODFLG  7  9         NSIC    2 28         
ONTAPE  6 11         OPER    6 30         PATCHN  1 12         PDEC    2 10         
POSTD   6 10         PRBUFF  5 35         RECEXP  7 16         RECSIZ  7 17         
RELORG  5  8         RESFLG  7  5         RET     2 32         ROPER   6 32         
RQN     5 20         RQNE    5 21         RQT     5 22         RQTE    5 23         
SETF    2 11         SKF     2 13         SKIPRT  2  4         SKNE    2 26         
SKNF    2 14         SPF     5 26         SPFLAG  6  5         SPI     5 27         
SPIE    5 28         SPTR    2 29         STAFLA  7  1         STAFLG  6 33         
STBFSZ  5 30         STNG    2  7         STORE   3  8         STPG    5 29         
SYSTCO  2 31         T       3  9         TBUFF   5  9         TCO     2  9         
TF1     6 37         TF2     6 38         TIBDAT  5 12         TIBTYP  5 11         
TOBCTL  5 13         TOBDAT  5 15         TOBR2   5 16         TOBTYP  5 14         
TOTAPE  7  3         TPAGE   5 10         TSTFLG  7  2         TYPE    2  3         
USERFL  6 39         VERSIO  1 14         VERSIO  1 11         X       4 29         
X       3 27         X       3 18         X       3 13         XFA     2 15         
XFERED  6 18         Y       4  1         YY      4 16         YY      4 14         
YY      4  6         
SPOOL ** FICHE/FRAME BREAK *****
SPSPO
SPO    IDENT   SPOOL COMMAND   AUGUST 24,1976

*************************************************************
*
*      CHANGE                  DATE
*      ------                  ----
*
*      55467                   03/05/76
*
*************************************************************

       ENTRY   GUI,SPOESC

*GET USER INFORMATION

GUI    NOP     RT1
       CLRF    NODFLG          CLEAR NODE FLAGE IE OPT:NODE=
       CLA
       LDX     =-RECSIZ
       STA     PCBE,2
       BRX     *-1
       CAB
       STP     FNSP
       STP     RQNP
       STP     RQTP
       STP     DELIP
       STP     DELAP
       STP     SPIP
       STP     SPFP
       STP     SPDP
       LDA     CDATE
       STA     DATE
       LDA     CCPNO
       STA     CPN
       LDA     CUUN
       STA     UUN
       LDA     CDIST
       STA     DIST
       BRS     39
       LRSH    2
       ETR     K1777
       STA     DDIST
       LDB     CPRLOC
       SKNF    CHPFLG
       LDB     SPRLOC
       STB     PRILOC
       LDA     CGAN
       STA     GAN
       CLX                                                 55467
       LDA     KM1                                         55467
       BRS     176                                         55467
       STA     DATTIM
       LDA     CPARW
       SKA     K4B7            INHOUSE
       BRU     GUI1            YSE
       CALL     GBINFO          GET INFO FOR BILLING
       BRU     *+2
GUI1   CALL     GBNMPC          GET INFO CONCERNING INHOUSE BILLING
       CALL     GRQN            GET REQUESTORS NAME
       CALL    GBPJC           GET BILLABLE PROJECT CODE
       CALL     GRQT            GET REQUESTORS TELEPHONE NUMBER
       CALL     GFORM           GET INFO ABOUT FORMS
       CALL     GOPT            GET OPTIONS
       CALL     GMAIL           GET DELIVERY INSTRUCTIONS
       CALL     GSPCI           GET SPECIAL INSTRUCTIONS
       CALL     GFIL            GET FILES AND SPOOL THEM
       LDA     FILES
       SKNE    ZERO
       ERROR   NOFSP           NO FILES SPOOLED
       DISABLE
GUI2   CALL    ADDJB           INSERT REQUEST INTO LIST
       LDA     JBSTA
       LDB     PRILOC
       SKA     CENFLG
       CLB
       LDA     ONE
       CALL    AREMCT
       CALL    OPHARD
       LDA     =ESCR
       STA     ESCV
       ENABLE
       CALL     PSTAT           PRINT JOB STATISTICS
       RET     GUI



*GET BILLABLE NAME AND PROJECT CODE FOR USE BY INHOUSE USER

GBNMPC NOP     RT2
       CALL     BILLQ           BILL TO CUSTOMER
       BRU     GBNM1           NO, GET INFO FROM TS PAGE
       LDA     JBSTA
       MRG     =FORCUS         FOR CUSTOMER FLAG
       STA     JBSTA
       CALL     GBNAM           HAVE HIM TYPE THE BILLABLE NAME
       CALL     CKBNAM          IS IT VALID, AND IN HIS DISTRICT
       CALL     GUSNMT          GET THE NAME OF THE PERSON ENTERING THE JOB
       RET     GBNMPC
GBNM1  CALL     GBINFO          GET INFO FROM TS PAGE
       RET     GBNMPC

*GET BILLABLE INFO FROM TS PAGE-NO TYPING REQUIRED

GBINFO NOP     RT3
       CALL     GUSNMT          USER NAME
       CALL     CUNMB           COPY THE USER NAME TO BILLABLE
       RET     GBINFO


*GET USER NAME FROM TS PAGE

GUSNMT NOP     RT4
       LDA =48
       LDB     =USN
       LDX     FOUR
       BRS     67
       RET     GUSNMT


*ASK INHOUSE USER IF IT IS TO BE BILLED TO CUSTOMER

BILLQ  NOP     RT3
       CTYPE   BILLM
       CALL     YESNO
       RET     BILLQ
       SKIPRT  BILLQ


*GET BILLABLE PROJECT CODE FROM INPUT

GBPJC  NOP     RT3
       CLA
       LDX     KM4
       STA     PJC+4,2
       BRX     *-1
       CTYPE   PJCMSG
       LDA     =12
       LDB     CR
       LDX     CIN
       STNG    PJC
       ERROR   TL              TOO LONG
       RET     GBPJC

*GET REQUESTORS TELEPHONE NUMBER

GRQT   NOP     RT2
       CTYPE   RQTM
       CALL     CKCR
       SKNE    =37B
       BRU     GRQTH
       LDA     =3*[RQTE-RQT]
       LDB     CR
       LDX     CIN
       STNG    RQT
       CALL     FLCR            SINCE ITS TOO LONG FLUSH THE REST
       STP     RQTP
       RET     GRQT
GRQTH  TYPE    RQTH
       CALL    FLCR
       BRU     GRQT+1

*GET REQUESTORS NAME

GRQN   NOP     RT2
       CTYPE   RQNM
       CALL     CKCR
       SKNE    =37B
       BRU     GRQNH
       LDA     =3*[RQNE-RQN]
       LDB     CR
       LDX     CIN
       STNG    RQN
       CALL     FLCR            FLUSH TO CARRAIGE RETRUN
       STP     RQNP
       RET     GRQN
GRQNH  TYPE    RQNH
       BRU     GRQN+1

CKCR   NOP     RT5
       CIL     CIN
       SKE     CR
       RET     CKCR
       CALL     CERR
       LDA     =-2
       ADM*    CKCR
       RET     CKCR

**********************************************
*
*      GET MAILING OR DELIVER INSTRUCTIONS
*
*      PLACES A CODE INTO DELVI AS FOLLOWS
*              0 - HELD IN STRING
*              1 - MAIL
*              2 - AIR MAIL
*              3 - AIR EXPRESS
*              4 - COURIER
*              5 - HOLD
*              6 - SPECIAL DELIVERY
*              7 - OFFICE MAIL
*
*******************************************************************

GMAIL  NOP     RT2
       CTYPE   GMM1
       LDA     DCMD
       CALL     DISP
       NOP     0
       BRU     *+2
       RET     GMAIL
GMAILE CALL     CERR
       BRU     GMAIL+1
DCMD   CMD     (MAIL,MDEV),(AIR,ADEV),(SPECIAL,SPDEV),(PICKUP,HDEV),
(COURIER,CDEV),(?,DEVH),(EXPRESS,CDEV),(HOLD,HDEV),
(OFFICE,ODEV)

*      AIR MAIL OR AIR EXPRESS

ADEV   NOP     RT3
       LDA     TERMC
       SKE     ZERO
       BRU     ADEVE           MUST BE AIR MAIL OR AIR EXPRESS
       CALL     1WD
       SKSE    EXPMP           EXPRESS
       BRU     ADEVE
       LDA     TERMC
       SKNE    ZERO
       BRU     ADEVX
PDEV   LDP     LP
       MOVSTG  DELI
       STP     DELIP
       CLA
       STA     DELVI
       CALL     GADR
       RET     ADEV


ADEVX  LDA     THREE
       STA     DELVI
       CALL     GADR
       RET     ADEV

ADEVE  TYPE    AMEMSG
       CALL     CLRIN
       SKR     SP
       BRU     GMAIL+1

MDEV   NOP     RT3
       LDA     ONE
       STA     DELVI
       CALL     GADR
       RET     MDEV

SPDEV  NOP     RT3
       LDA     =6
       STA     DELVI
       CALL     GADR
       RET     SPDEV

HDEV   NOP     RT3
       SKNF    NODFLG          SKIP IF WE HAVE NOT BEEN THOUGH NODE
       RET     HDEV            RETURN CAUSE WE DONE PRINTED
HDEV1  LDA     JBSTA
       MRG     =HOLDJB
       STA     JBSTA
       LDA     TERMC
       SKNE    ZERO
       BRU     PDEV
       LDA     FIVE
       STA     DELVI
       SKN     XFRSW
       BRU     *+3
       TYPE    XFRM4
       RET     HDEV
       LDA     PRILOC
       SKF     NODFLG          SKIP IF NOD FLAG IS SET
       TYPE    PUA
       CALL    TYPPL
       RET     HDEV


CDEV   NOP     RT3
       LDA     TERMC
       SKNE    ZERO
       BRU     PDEV
       LDA     FOUR
       STA     DELVI
       CALL    GADR
       RET     CDEV

ODEV   NOP     RT3
       LDA     CPARW
       SKA     K4B7
       BRU     *+2
       BRU     GMAILE
       LDA     JBSTA
       MRG     =HOLDJB
       STA     JBSTA
       LDA     TERMC
       SKNE    ZERO
       BRU     PDEV
       LDA     =7
       STA     DELVI
       RET     ODEV

DEVH   NOP     RT3
       TYPE    DHM
       LDA     CPARW
       SKA     K4B7
       TYPE    DHM1
       SKR     SP
       BRU     GMAIL+1


EXPMP  ASCPT   'EXPRESS'
MSTGP  ASCP    'MAIL'


*      GET DELIVERY ADDRESS

GADR   NOP     RT4
       CTYPE   DELAM
       CIL     CIN
       SKNE    =16B
       BRU     GADRF
       LDA     CIN
       STA     IFILE
       BRU     GADR1
GADRF  CIO     CIN
       CLEAR
       BRS     62
       BRU     GADRFE
       STA     IFILE
       LDA     CR
       CIT     CIN
       NOP
GADR1  LDA     SIX
       STA     T1
       SPTR    DELA
       STP     DELAP
GADR1A LDA     =41
       STA     T
GADRF1 SKR     T
       BRU     *+2
       BRU     GADRL
       CIO     IFILE
       SKNE    EOFC
       BRU     GADRF2
       SKNE    CR
       BRU     GADRF3
       SKNE    =144B
       BRU     GADRF4
       WCI     DELAP
       BRU     GADRF1
GADRF2 NOP
GADRF4 LDA     IFILE
       SKE     CIN
       BRS     20
       LDA     T
       SKG     =320
       RET     GADR
GADRF3 WCI     DELAP
       SKR     T1
       BRU     GADR1A
GADRL  LDA     IFILE
       SKE     CIN
       BRS     20
       TYPE    TL
       CALL    CLRIN
       BRU     GADR
GADRFE TYPE    NOOPM
       BRU     GADR

*GET SPECIAL INSTRUCTION

GSPCI  NOP     RT2
       CTYPE   SPIM
       CTYPE   TOCTLD
       CIL     CIN
       SKNE    =37B
       BRU     GSPCIH
       SKE     =144B
       SKNE    CR
       BRU     GSPCIN
       LDA     =3*[SPIE-SPI]   SINCE WE DONT HAVE A CR WE WILL ASSUME SOMETHING
       LDB     =144B           ENDING WITH A CONTROL D
       LDX     CIN
       STNG    SPI
       ERROR   TL              STRING TOO LONG
       STP     SPIP
       LDA     JBSTA
       MRG     =SPFLAG         TURN ON SPECIAL INSTRUCTION FLAG
       STA     JBSTA
       LDA     CR
       CIO     COUT
       RET     GSPCI
GSPCIH TYPE    GSPCH
       CIO     CIN
       CIO     CIN
       SKE     CR
       BRU     *-2
       BRU     GSPCI+1

GSPCIN CIO     CIN
       RET     GSPCI

*      GET FORMS
*
*      GETS THE TYPE OF FORMS TO USE
*
*      1 - SMALL
*      2 - BIG
*      3 - TTY
*      4 - SPECIAL FORMS

GFORM  NOP     RT2
       CTYPE   FORMSG
       LDA     FCMD
       CALL     DISP
       NOP     0               ERROR
       BRU     FRMERR          CARRIAGE RETURN
       RET     GFORM
FRMERR CALL     CERR
       BRU     GFORM+1
FCMD   CMD     (SPECIAL,SPFORM,2),(BIG,BFORM),(LARGE,BFORM),(TTY,TFORM),
(SMALL,SFORM,1),(?,FORMH),(HELP,FORMH)

SFORM  NOP     RT3
       LDA     ONE
       STA     FORMS
       LDA     =39
       STA     L:PG
       LDA     =108
       STA     LLTH
       LDA     =51
       STA     BL:PG
       LDA     WCMD; CALL DIS; NOP 0
       BRU     GPART
       RET     SFORM

BFORM  NOP     RT3
       LDA     TWO
       STA     FORMS
       LDA     =54
       STA     L:PG
       LDA     =132
       STA     LLTH
       LDA     =66
       STA     BL:PG
       LDA     WCMD; CALL DIS; NOP 0; BRU GPART; RET BFORM


WCMD   CMD     (WHITE,WFORM)

WFORM  NOP     RT4
       LDA     FORMS
       ADD     FOUR
       STA     FORMS
       LDA ONE; STA PARTS
       RET     WFORM

TFORM  NOP     RT3
       LDA     THREE
       STA     FORMS
       LDA     =54
       STA     L:PG
       LDA     =80
       STA     LLTH
       LDA     =66
       STA     BL:PG
       BRU     GPART
       RET     TFORM

SPFORM NOP     RT3
       CTYPE   SPFMS1
       LDA     FOUR
       STA     FORMS
       LDA     ONE
       STA     PARTS
       LDB     TEN
       LDX     CIN
       BRS     38
       STA     L:PG
       CTYPE   SPFMS2
       SKL     =67
       LDA     =66
       STA     BL:PG
       LDB     TEN
       LDX     CIN
       BRS     38
       SKG     =132
       BRU     *+2
       LDA     =132
       STA     LLTH
       CTYPE   SPFMSG
       LDA     =51
       LDB     CR
       LDX     CIN
       STNG    SPF
       BRU     SPFERR
       STP     SPFP
       RET     SPFORM
SPFERR TYPE    TL
       CALL     CLRIN
       BRU     SPFORM+1

FORMH  NOP     RT3
       TYPE    FRMHM
       SKR     SP
       BRU     GFORM+1

GPART  NOP     RT3
       LDA     ONE
       STA     PARTS           SET UP DEFAULT
       CTYPE   PARTQ
       CALL     CKCR
       LDX     CIN
       LDB     TEN
       BRS     38
       XAB
       SKE     CR
       CALL     FLCR
       XAB
       SKNE    ONE
       RET     GPART
       SKG     FOUR
       SKG     ZERO
       BRU     *+2
       BRU     MPART
       TYPE    PRTEM
       CALL     CLRIN
       BRU     GPART+1
MPART  STA     PARTS
       CTYPE   DECQ
       CALL     YESNO
       RET     GPART
       LDA     PARTS
       MRG     K2B7
       STA     PARTS
       RET     GPART




*      GET OPTIONS

GOPT   NOP     RT2
       LDB     PRILOC
       LDA     CENFLG
       SKB     KM1
       LDA     REMFLG
       MRG     JBSTA
       STA     JBSTA
       LDA     ONE
       STA     COPIES          SET UP DEFAULT
       CLA
       STA     XFRSW
       STA     HSW
       STA     DBLSW
       CTYPE   OPTMG
       LDA     OCMD
       CALL     DISP
       BRU     GOPTE
       BRU     GOPTND
GOPTL  LDA     OCMD
       CALL     DIS
       BRU     GOPTE
       BRU     GOPTND          CR
       BRU     GOPTL           KEEP LOOPING
GOPTND SKN     XFRSW
       RET     GOPT
       CTYPE   XFRM1
GOPTNE LDA     =24
       LDB     CR
       LDX     CIN
       STNG    XFRADR
       CALL    FLCR            FLUSH TO CR IF IT IS TOO LONG
       STB     T
       SKE     T
       RET     GOPT
       BRU     GOPTNE
GOPTE  TYPE    UNREC
       CALL     CLRIN
       BRU     GOPT+1

OCMD   CMD     (HEAD,HOPT,3),(LINES=,LOPT),(COPIES=,COPOPT,2),(?,OPTH),
(HELP,OPTH,3),(REMOTE,ROPT),(CENTER,COPT,2),(DOUBLE,DOPT),(NODE=,NOPT),
(TRANSFER,XOPT),(INDENT=,INDOPT),(FULLCH,FOPT)

HOPT   NOP     RT3
       LDA     KM1
       STA     HSW
       RET     HOPT

COPOPT NOP     RT3
       CALL    GOPNUM
       SKNE    ZERO
       BRU     COPOE
       STA     COPIES
       RET     COPOPT
COPOE  SKR     SP
       BRU     GOPTE

LOPT   NOP     RT3
       CALL    GOPNUM
       SKNE    ZERO
       BRU     LOPTE
       STA     L:PG
       RET     LOPT
LOPTE  SKR     SP
       BRU     GOPTE
ROPT   NOP     RT3
       LDA     CPRLOC
       SKNE    ZERO
       BRU     ROPTE
       STA     PRILOC
       LDA     JBSTA
       SKA     CENFLG
       EOR     CENFLG
       MRG     REMFLG
       STA     JBSTA
       RET     ROPT
ROPTE  TYPE    NOREMT
       CALL    CLRIN
       SKR     SP
       BRU     GOPT
COPT   NOP     RT3
       LDA     JBSTA
       SKA     FULFLG
       BRU     FOPTE
       SKA     REMFLG
       EOR     REMFLG
       MRG     CENFLG
       STA     JBSTA
       CLA
       STA     PRILOC
       RET     COPT
DOPT   NOP     RT3
       LDA     KM1
       STA     DBLSW
       RET     DOPT


XOPT   NOP     RT3
       LDA     KM1
       STA     XFRSW
       LDA     JBSTA
       MRG     XFRFLG
       STA     JBSTA
       RET     LOPT

NOPT   NOP     RT3
       LDA     TERMC
       SKE     =35B
       BRU     NOPT1
NOPT2  CALL    1ONUM
       SKG     =7777B
       SKG     ZERO
       BRU     LOPTE
       STA     TV1
       LDA     TERMC
       CLB
       SKNE    =13B
       LDB     =4000B
       CBA
       ADD     TV1
       CALL    GETPL
       SKG     SEVEN
       CLA
       STA     PRILOC
       SKG     ZERO
       BRU     NOPT3
       LDA     JBSTA
       SKA     CENFLG
       EOR     CENFLG
       MRG     REMFLG
       STA     JBSTA
NOPT4  SETF    NODFLG          SET NODE FLAG
       TYPE    XFRM1
       BRU     HDEV1           LETS GO PRINT THE ADDR OF THE NODE TO PICKUP
NOPT3  LDA     JBSTA
       SKA     REMFLG
       EOR     REMFLG
       MRG     CENFLG
       STA     JBSTA
       BRU     NOPT4
NOPT1  CALL    1WD
       LDA     TERMC
       SKNE    =35B
       BRU     NOPT2
       SKR     SP
       BRU     GOPTE



INDOPT NOP     RT3
       CALL    GOPNUM
       STA     INDCNT
       RET     INDOPT
GOPNUM NOP     RT4
       LDA     TERMC
       SKE     =35B
       BRU     GOPNU1
GOPNU2 CALL    1NUM
       RET     GOPNUM
GOPNU1 CALL    1WD
       LDA     TERMC
       SKNE    =35B
       BRU     GOPNU2
       SKR     SP
       BRU     GOPTE

FOPT   NOP     RT3
       LDA     JBSTA
       SKA     CENFLG
       BRU     FOPTE
       MRG     FULFLG
       STA     JBSTA
       RET     FOPT
FOPTE  TYPE    FULERM
       BRU     COPOE

OPTH   NOP     RT3
       TYPE    OPTHM
       SKR     SP
       BRU     GOPT+1




*******************************************
*
*      THIS ROUTINE REQUESTS THE FILES TO BE SPOOLED
*      UNTIL TERMINATED BY A CARRIAGE RETURN WHICH
*      IS NOT PRECEEDED BY A TERMINATION CHARACTER.
*
*      THE REUSLTING LIST OF FILE NAMES IS IN AL
*      STRING WITH POINTERS AT FNSP
*
*******************************************

GFIL   NOP     RT2
       CTYPE   FILMSG          (FILES:)
GFIL1  SPTR    FNS
       STP     FNSP
       CLA
       STA     FILES
       STA     FNS
       STA     BRNSW
GFIL1A LDA     KM1
       STA     ERRCT
       SPTR    IFNS
       STP     FP
GFIL2  LDA     =FP
       LDB     CR
       LDX     CIN
       BRS     33              GET THE FILES IN
       STP     FP
       GCD     FP
       BRU     GFIL1           ENPTY STRING
       WCI     FP              PUT IT BACK
       CALL    CKTERM          CHECK FOR TERMINATION CHAR
       BRU     GFIL2           IF SO, THEN GET REMAINDER OF STRING
       GCI     FP
       NOP
       WCD     FP
       SKNE    K37
       BRU     FILHLP          TWAS A QUESTIN MARK
       SKN     BRNSW
       CALL    GBRN
       SKR     BRNSW
       BRU     *-1
       CALL    SSPDP
       LDA     =SPOESC
       STA     ESCV
FIL1   SPTR    IFN
       STP     IFNP
       LDA     FILES
       CALL    MFILNM
       STP     TP
       LDA     =15B
       WCI     TP
       GCI     FP
       BRU     FILEND
       CALL    CKTERM
       BRU     FIL1
       SKNE    =16B
       BRU     FFIL1
       SKE     =10B
       BRU     FIL2
       WCI     IFNP
       WCI     FNSP
FIL1A  GCI     FP
       BRU     ERFIL1
       WCI     IFNP
       WCI     FNSP
       SKE     NINE
       BRU     FIL1A
       GCI     FP
       BRU     ERFIL1          NO FILE NAME SPECIFIED
       CALL    CKTERM
       BRU     ERFIL1          NO FILE NAME SPECIFIED
FIL2   SKE     TWO
       SKNE    SEVEN
       BRU     FIL2A
       SKNE    K17
       BRU     FIL2A           PROTECTED STRING
FIL2C  WCI     TP
       WCI     IFNP
       WCI     FNSP
       GCI     FP
       BRU     FIL3            ASSUME FILE NAME IS COMPLETE
       CALL    CKTERM
       BRU     FIL3            NAME IS COMPLETE ON TERMINATION CHAR
       BRU     FIL2
FIL2A  STA     PSCH            PROTECTED STRING CHARACTER
       WCI     TP
       WCI     IFNP
       WCI     FNSP
FIL2B  GCI     FP
       BRU     ERFIL1          ERROR FILE NAME NOT PROPERLY SPECIFIED
       SKNE    PSCH
       BRU     FIL2C           BACK TO REGULAR MODE
       WCI     IFNP
       SKG     EOFC           CHECK FOR CONTROL CHAR
       BRU     *+2
       BRU     FIL2B           CONTROL CHARACTER
       WCI     TP
       WCI     FNSP
       BRU     FIL2B

FIL3   XAB
       LDA     K203
       WCI     FNSP
       XAB
       SNE     THREE           # FOR NUMBER OF CHARACTERS
       CALL    GTCPY           GET THE NUMBER OF COPIES
       LDA     COPIES          IF HE DOESN'T SPECIFY USE DEFAULT
       STA     COUNT          SAVE IT FOR COUNTING PAGES
       WCI     FNSP            WRITE IT INTO THE STRING
       LDA     CR
       WCI     FNSP
       LDP     TP
       STP     OFNP
       CALL    OPIF
       BRU     FIL1
       CALL    OPOF
       CALL    COPY
       CALL    CLOSE
       CALL    PFSTAT
       CALL    DELPRF
       BRU     FIL1

ERFIL1 TYPE    NOOPM
ERFIL  MIN     ERRCT           INCREMENT THE ERROR COUNTER
       LDP     IFNP
       LDX     COUT
       BRS     35
       TCO     CR
       GCD     FNSP
       BRU     FIL1
       SKE     CR
       BRU     *-3
       WCI     FNSP
       BRU     FIL1


ERFIL2 TYPE    SYNERR          SYNTAX ERROR
       BRU     ERFIL

****************************************************
*
*      FILE NAMES COMING FROM A FILE. SYSTEM RESTRICTION
*      ON NUMBER OF FILES OPEN REQUIRES THAT A CIN AND TOUT
*      CANNOT BOTH BE SPECIFIED AS DISK FILES.
*
*******************************************************

FFIL1  LDA     FP
       STA     IFNP
FFIL1A GCI     FP
       BRU     FFIL2A
       SKE     TWO
       SKNE    SEVEN
       BRU     FFIL1B
       SKNE    =17B
       BRU     FFIL1B
       CALL    CKTERM
       BRU     FFIL2
       BRU     FFIL1A
FFIL1B STA     PSCH            PROTECTED STRING CHARACTER
       GCI     FP
       BRU     ERRF1
       SKNE    PSCH
       BRU     FFIL1A
       BRU     *-4
FFIL2  WCD     FP
FFIL2A LDA     FP
       STA     IFNP+1           IFNP+1
       CALL    OPIF
       BRU     FIL1
       LDA     IFILE
       STA     FFILE

FFIL3  SPTR    IFN
       STP     IFNP
       LDA     FILES
       CALL    MFILNM
       STP     TP
       LDA     =15B
       WCI     TP
FFIL3A CIO     FFILE
       SKNE    EOFC
       BRU     FFILND
       CALL    CKTERM
       BRU     FFIL3A
       SKE     =10B
       BRU     FFIL4
       WCI     IFNP
       WCI     FNSP
FFIL3B CIO     FFILE
       SKNE    EOFC
       BRU     ERRF1
       WCI     IFNP
       WCI     FNSP
       SKE     NINE
       BRU     FFIL3B
       CIO     FFILE
       SKNE    EOFC
       BRU     ERRF1
       CALL    CKTERM
       BRU     ERRF1
FFIL4  SKE     TWO
       SKNE    SEVEN
       BRU     FFIL4A
       SKNE    K17
       BRU     FFIL4A
       SKG     EOFC
       BRU     FFIL4C
       BRU     FFIL4D
FFIL4C WCI     TP
       WCI     FNSP
FFIL4D WCI     IFNP
       CIO     FFILE
       SKNE    EOFC
       BRU     FFIL5
       CALL    CKTERM
       BRU     FFIL5
       BRU     FFIL4
FFIL4A STA     PSCH
       WCI     TP
       WCI     IFNP
       WCI     FNSP
FFIL4B CIO     FFILE
       SKNE    EOFC
       BRU     ERRF1
       SKNE    PSCH
       BRU     FFIL4C
       WCI     IFNP
       SKG     EOFC
       BRU     *+2
       BRU     FFIL4B
       WCI     TP
       WCI     FNSP
       BRU     FFIL4B
FFIL5  XAB
       LDA     K203
       WCI     FNSP
       XAB
       SNE     THREE           # FOR NUMBER OF COPIES
       CALL    GTFCPY          GET NUMBER OF COPIES FROM A FILE (FFILE)
       LDA     COPIES          IF HE DOESN'T SPECIFY, SUE DEFAULT
       STA     COUNT          SAVE IT FOR COUNTING PAGES
       WCI     FNSP
       LDA     CR
       WCI     FNSP
       LDP     TP
       STP     OFNP
       CALL    OPIF
       BRU     FFIL3
       CALL    OPOF
       CALL    COPY
       CALL    CLOSE
       CALL    PFSTAT
       CALL    DELPRF
       BRU     FFIL3
FFILND LDA     FFILE
       BRS     20
       BRU     FIL1
FILEND SKN     ERRCT
       BRU     *+2
       BRU     GFIL3
       TYPE    RENTR
       CALL    YESNO
       BRU     GFIL3
       TYPE    FILMSG
       BRU     GFIL1A
GFIL3  RET     GFIL

FILHLP TYPE    FLHM
       BRU     GFIL

ERRF1  TYPE    NOOPM
ERRFI  MIN     ERRCT
       LDP     IFNP
       LDX     COUT
       BRS     35
       TCO     CR
       GCD     FNSP
       BRU     FFIL3
       SKE     CR
       BRU     *-3
       WCI     FNSP
       BRU     FFIL3

ERRF2  TYPE    SYNERR          SYNTAX ERROR
       BRU     ERRFI

GTFCPY NOP     RT10            GET THE COPY COUNT FROM A FILE
       LDA     JBSTA
       MRG     FICOPS
       STA     JBSTA
       LDX     FFILE
       LDB     =10
       BRS     38
       SKG     =63
       SKG     ZERO
       BRU     ERRF2
       SKIPRT  GTFCPY

GTCPY  NOP     RT10            GET THE COPY COUNT FROM A FILE
       LDA     JBSTA
       MRG     FICOPS
       STA     JBSTA
       CLA
       STA     T
GTCPY1 GCI     FP
       BRU     GTCPY2          AT TEN OF STRING
       SKG     =31B
       SKG     =17B            CHECK FOR NUMBER
       BRU     GTCPY2          NO, WERE DONE
       SUB     K20
       XMA     T
       MUL     =10
       LSH     23
       ADM     T
       BRU     GTCPY1
GTCPY2 LDA     T
       SKG     =63
       SKG     ZERO
       BRU     ERFIL2
       SKIPRT  GTCPY

CKTERM NOP     RT10
       SKE     ZERO
       SNE     K14
       RET     CKTERM
       SKE     LF
       SNE     CR
       RET     CKTERM
       SNE     THREE           CHECKING FOR COPIES SWITCH
       RET     CKTERM
       SKIPRT  CKTERM

PFSTAT NOP     RT3
       CLA; MIN TPAGES; XMA TPAGES;
       MUL COUNT; LSH 23; ADM PAGES
       CAB
       LDA     =10005000B
       MRG     COUT
       COPY    AX,BA,B
       BRS     165
       TYPE PGM1
       LDP     IFNP
       LDX     COUT
       BRS     35
       LDA CR; CIO COUT; RET PFSTAT




OPIF   NOP     RT3             OPENS A FILE UNDER A FORK WITH NO STATUS
       LDP IFNP; STP FTA; LDA =BRS64; STA FTPC
       BRS 43; STP FTRL1
       LDA =FTPC+34B6
       BRS 9; LDA FTPC; ETR ADMASK
       SKE =BRS64F; BRU OPIFG
       TYPE    NOOPM
       LDP     IFNP
       LDX     COUT
       BRS     35
       TCO     CR
FILER  MIN     ERRCT
       GCD     FNSP
       RET     OPIF
       GCD     FNSP
       RET     OPIF
       SKE     CR
       BRU     *-3
       WCI     FNSP
       RET     OPIF
OPIFG  SKE =BRS64S; ERROR 2; LDP FTA; STA IFILE
       SKG     TWO
       BRU     NOTDIS
       CBA
       SKE     THREE
       BRU     WRNGTYPE
       STB FILTYP; SKIPRT OPIF
NOTDIS CALL    CLOSE
       LDP     IFNP
       LDX     COUT
       BRS     35
       TYPE    DFERR
       BRU     FILER
WRNGTYPE CALL  CLOSE
       LDP     IFNP
       LDX     COUT
       BRS     35
       TYPE    WTMSG
       BRU     FILER


**************   DO NOT REORDER FORK TABLE    *************

FTPC   ZRO     0               FORK PROGRAM COUNTER
FTA    ZRO     0               A REGISTER
FTB    ZRO     0               B REGISTER
FTX    ZRO     0               X REGISTER
FTRL1  ZRO     0               RELABELING REGISTER 1
FTRL2  ZRO     0               RELABELING REGISTER 2
FTEC   ZRO     0               REASON FOR RET

*********    DO NOT REORDER NEXT THREE WORDS ***********
BRS64  BRS     64              OPEN FILE FOR INPUT
BRS64F ZRO     0               FAIL (NON-SKIP) RET
BRS64S ZRO     0               SUCCESS (SKIP) RET
       BRS     10              TO TERMINATE THE FORK


*      OPEN AN OUTPUT FILE IN THE SPOOL DIRECTORY FROM THE
*      FROM THE POINTER OFNP THAT SHOULD BE SET UP PRIOR TO
*      ARRIVING AT THIS ROUTINE
*
OPOF   NOP     RT3
       LDP OFNP
       IF DEBUG
       LDX ONE; BRS 35; TCO CR; LDA TWO ; STA OFILE
       LDP     OFNP
       ENDF
       LDX TWO; BRS 65; BRU OPOFE; STA OFILE
       LDA     =2B7-1
       SSP     OFILE
       NOP
       MIN FILES; RET OPOF
OPOFE  LDA     BRNO
       CALL     DALLF           DELETE ALL THE FILES
       LDA     ="WHY"
       BRS     142             TELL HIM WHY AND STOP THE PROGRAM.

PSCH   ZRO     0               PROTECTED STRING DELIMITER

       IF ALLSW
GFILFD NOP     RT4
       SPTR IFN; STP IFNP
       LDP SPDP; STP TP
       LDA FILES
       SKG =25; BRU GFDI
       LRSH 23; DIV =26; ADD =40B; WCI TP; XAB
GFDI   ADD =41B; WCI TP; LDA =15B; WCI TP

*      ALL SET UP FOR THE FILE NAME

       LDX FDX; LDP IFNP; BRS 68
       RET GFILFD
       STB IFNP+1
       LDX FDX; LDB TP+1; CBA; BRS 68
       RET GFILFD
       STB TP+1
       LDX FDX; LDB FNSP+1; CBA; BRS 68; RET GFILFD
       STB FNSP+1; LDA CR; WCI FNSP
       LDP TP; STP OFNP; SKIPRT GFILFD

       ENDF

CLOSE  NOP     RT10            CLOSES IFILE AND OFILE IF THE ARE OPEN
       LDA     IFILE
       BRS     20
       LDA     OFILE
       BRS     20
       RET     CLOSE

FDX    ZRO     0               FILE DIRECTORY INDEX
FILTYP EQU     FTB            TYPE OF INPUT FILE
IFNP   BSS     2               INPUT FILE NAME POINTER
OFNP   BSS     2               OUTPUT FILE NAME POINTER
IFN    BSS     30              INPUT FILE NAME

*      DELETE PROOF FILE

DELPRF NOP     RT3
       IF      -DEBUG
       LDP     OFNP
       BRS     48
       ERROR   BF
       LDA     =2204B4
       LDX     =12
       BRS     141
       BRU     DELPRF+1
       ENDF
       RET     DELPRF

*COPY USER NAME TO BILLABLE

CUNMB  NOP     RT4
       LDP     USN
       STP     BUSN
       LDP     USN+2
       STP     BUSN+2
       RET     CUNMB



PSTAT  NOP     RT2
       LDP     PRIADR
       BRS     64
       BRU     PSTAT2
       STA     IFILE
       LDA     PRILOC
       SKNE    ZERO
       LDA     CENLOC
       MUL     =128*3
       LSH     23
       ADD     =243
       SCP     IFILE
       BRU     PSTAT1
       LDA     =20
       LDX     =HLINE
       BIO     IFILE
       BRU     PSTAT1
       SPTR    HLINE
       ADD     =60
       XAB
       STP     TP
       GCD     TP
       BRU     PSTAT2
       SKNE    ZERO
       BRU     *-3
       WCI     TP
       TYPE    EMRGTN          EMERGENCY TELEPHONE NUMBER
       LDP     TP
       LDX     COUT
       BRS     35
PSTAT1 LDA     IFILE
       BRS     20
PSTAT2 TCO     CR
       SPTR    HLINE
       BRS     91              GET DATE AND TIME IN STRING
       XAB
       SUB     FOUR
       XAB
       LDX     COUT
       BRS     35
       TCO     CR
       LDA     FILES
       PDEC    0
       TYPE    FLM
       LDA     PAGES
       PDEC    0
       TYPE    PGM
       TYPE    BRNMSG
       LDA     BRNO
       PDEC    5
       RET     PSTAT
SPOESC NOP     ESCLOC
       DISABLE
       TYPE    CANM1
       CALL    DALLF
       TYPE    JBCNLD
       LDA     =ESCR
       STA     ESCV
       CLX
       BRS     164
       ENABLE
       BRU     ESCR
       NOLIST EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPSPO SYMSORT

SYM.  PG.LN. IDENT.

ADEV    6 21 SPO     ADEVE   7  6 SPO     ADEVX   7  1 SPO     
BFORM  12  7 SPO     BILLQ   4  5 SPO     BRS64  29 26 SPO     BRS64F 29 27 SPO     
BRS64S 29 28 SPO     CDEV    8  6 SPO     CKCR    5 23 SPO     CKTERM 27 24 SPO     
CLOSE  30 38 SPO     COPOE  16  7 SPO     COPOPT 16  1 SPO     COPT   16 33 SPO     
CUNMB  31 28 SPO     DCMD    6 18 SPO     DELPRF 31 14 SPO     DEVH    8 30 SPO     
DOPT   17  5 SPO     ERFIL  22 23 SPO     ERFIL1 22 22 SPO     ERFIL2 22 36 SPO     
ERRF1  26 12 SPO     ERRF2  26 25 SPO     ERRFI  26 13 SPO     EXPMP   8 39 SPO     
FCMD   11 32 SPO     FDX    31  6 SPO     FFIL1  23  5 SPO     FFIL1A 23  7 SPO     
FFIL1B 23 17 SPO     FFIL2  23 23 SPO     FFIL2A 23 24 SPO     FFIL3  23 31 SPO     
FFIL3A 23 38 SPO     FFIL3B 24  8 SPO     FFIL4  24 20 SPO     FFIL4A 24 37 SPO     
FFIL4B 25  2 SPO     FFIL4C 24 28 SPO     FFIL4D 24 30 SPO     FFIL5  25 14 SPO     
FFILND 25 35 SPO     FIL1   20 22 SPO     FIL1A  20 39 SPO     FIL2   21 10 SPO     
FIL2A  21 23 SPO     FIL2B  21 27 SPO     FIL2C  21 15 SPO     FIL3   21 39 SPO     
FILEND 25 38 SPO     FILER  28 24 SPO     FILHLP 26  9 SPO     FILTYP 31  7 SPO     
FOPT   19  2 SPO     FOPTE  19  9 SPO     FORMH  13 34 SPO     FRMERR 11 30 SPO     
FTA    29 18 SPO     FTB    29 19 SPO     FTEC   29 23 SPO     FTPC   29 17 SPO     
FTRL1  29 21 SPO     FTRL2  29 22 SPO     FTX    29 20 SPO     GADR    9  6 SPO     
GADR1   9 22 SPO     GADR1A  9 26 SPO     GADRF   9 14 SPO     GADRF1  9 28 SPO     
GADRF2 10  1 SPO     GADRF3 10  8 SPO     GADRF4 10  2 SPO     GADRFE 10 17 SPO     
GADRL  10 11 SPO     GBINFO  3 26 SPO     GBNM1   3 21 SPO     GBNMPC  3 11 SPO     
GBPJC   4 14 SPO     GFDI   30 22 SPO     GFIL   19 27 SPO     GFIL1  19 29 SPO     
GFIL1A 19 35 SPO     GFIL2  19 39 SPO     GFIL3  26  7 SPO     GFILFD 30 16 SPO     
GFORM  11 23 SPO     GMAIL   6  9 SPO     GMAILE  6 16 SPO     GOPNU1 18 34 SPO     
GOPNU2 18 32 SPO     GOPNUM 18 28 SPO     GOPT   14 34 SPO     GOPTE  15 30 SPO     
GOPTL  15 13 SPO     GOPTND 15 18 SPO     GOPTNE 15 21 SPO     GPART  13 39 SPO     
GRQN    5  8 SPO     GRQNH   5 20 SPO     GRQT    4 29 SPO     GRQTH   5  2 SPO     
GSPCI  10 22 SPO     GSPCIH 11  4 SPO     GSPCIN 11 11 SPO     GTCPY  27  1 SPO     
GTCPY1 27  7 SPO     GTCPY2 27 18 SPO     GTFCPY 26 28 SPO     GUI     1 16 SPO     
GUI1    2 19 SPO     GUI2    2 32 SPO     GUSNMT  3 34 SPO     HDEV    7 23 SPO     
HDEV1   7 26 SPO     IFN    31 10 SPO     IFNP   31  8 SPO     INDOPT 18 24 SPO     
LM*    14 32 SPO     LOPT   16 10 SPO     LOPTE  16 16 SPO     MDEV    7 11 SPO     
MPART  14 21 SPO     MSTGP   9  1 SPO     NOPT   17 19 SPO     NOPT1  18 15 SPO     
NOPT2  17 23 SPO     NOPT3  18  9 SPO     NOPT4  18  6 SPO     NOTDIS 29  1 SPO     
OCMD   15 34 SPO     ODEV    8 15 SPO     OFNP   31  9 SPO     OM**** 22 38 SPO     
OMM*** 19 18 SPO     OPIF   28 13 SPO     OPIFG  28 33 SPO     OPOF   29 36 SPO     
OPOFE  30  8 SPO     OPTH   19 12 SPO     PDEV    6 31 SPO     PFSTAT 27 35 SPO     
PSCH   30 13 SPO     PSTAT  31 37 SPO     PSTAT1 32 28 SPO     PSTAT2 32 30 SPO     
ROPT   16 18 SPO     ROPTE  16 29 SPO     SPDEV   7 17 SPO     SPFERR 13 30 SPO     
SPFORM 13  1 SPO     SPOESC 33 10 SPO     TFORM  12 28 SPO     WCMD   12 19 SPO     
WFORM  12 21 SPO     WRNGTY 29  7 SPO     XOPT   17 11 SPO     _COURI  6 19 SPO     
_LUNV^ 15 35 SPO     _SMALL 11 33 SPO     
SPOOL ** FICHE/FRAME BREAK *****
SPSTA
STA    IDENT   STATUS COMMANDS JAN 22, 1976
*
*      NEW IMPROVED VERSION OF THE STATUS COMMANDS
*      THIS SHOULD MAKE LIFE EASIER FOR ALL THOSE INVOLVED.
*
**********************************************************
*
*      THSI VERSION IS ONLY VALID FOR USE WITH GENERATION B OF SPOOL
*      BECAUSE OF THE EXTENDED USE OF THE FLAG SYSPOPS AND
*      THE CALL (SBRM) POP.
*
**********************************************************
*
*      REMEMBER!  SPOOL MEANS SUPER POOL

*
***************************************************************

       ENTRY   STATUS,REPORT,LIST,CANCEL,HOLDJ,TRANSF,WHERE

************************************************
*
*
*********************************************************************


**********************************************************
*
*      THE STATUS COMMAND AND THE REPORT COMMAND SHARE THE
*      SAME CODE.  FLAGS ARE ALL THAT KEEPS US TOGETHER
*
**********************************************************

STATUS NOP     RT1
       SETF    STAFLG          SET THE STATUS FLAG
       BRU     STAT
REPORT NOP     RT1
       CLRF    STAFLG          CLEAR STATUS FLAG
STAT   SETF    TF1             SET 1ST TIME SWITCH
       CLRF    TSTFLG          NO SECONDARY TEST UNLESS HE ASKS FOR IT
       CLRF    USERFL
       CLA
       STA     TEST            WORD THAT IS USED TO DETERMINE PRINTING
       LDA     STCMD
       CALL    DIS             GO GET SUB COMMANDS
       BRU     STAT1           INVALID COMMAND, GO CHECK FOR NUMBER
       BRU     *+2
       RET     STATUS          OR REPORT, SAME DIFFERENCE
       BRS     71
       BRU     *+3
       CALL    STALL
       RET     STATUS
       SKF     COPER
       BRU     *+3
       CALL    STCEN
       RET     STATUS
       SKF     ROPER
       BRU     *+3
       CALL    STREM
       RET     STATUS
       CALL    STALL
       RET     STATUS
STAT1  CALL    CVNUM           GO GET THE NUMBER
       LDA     NUMBER
       SKNE    ZERO
       BRU     CMDERR
       STA     RQSN
       CALL    GRECN
       ERROR   NVJ
       CALL    PSTA            PRINT STATUS LINE
       CALL    GDREC
       RET     STATUS
       BRU     *-3
STALL  NOP     RT2
       SKF     STAFLG
       CALL    RDATE           GET THE DATE FOR REPORT
       LDA     STTST1
       SKF     STAFLG
       CLA     0               REPORT SEES EVERYTHIN
       STA     TEST            SAVE TEST INFORMATION
       SKF     STAFLG
       BRU     REPTS           REPORT NEEDS ADDITIONAL SETTING UP
       CALL    GLCJB           GET LAST COMPLETED JOB
       ERROR   NJMSG           NO JOBS ON LIST
       BRU     PALLS
REPTS  CALL    G1JOB           GET THE FIRST JOB IN LIST
       CALL    GREC            GET THE ASSOCIATED RECORD
REPT1  LDA     DATE
       SKG     TDATE           NEED TO FIND A UP TO DATE REQUEST
       BRU     *+2
       BRU     PALLS           AFTER THE DATE SPECIFIED
       CALL    GNJOB           KEEP LOOKING THROUGH THE LIST
       ERROR   NJMSG           END OF THE LIST
       BRU     REPT1           KEEP TRYING

STUSR  NOP     RT2
       LDA     TERMC
       SKE     CR
       CALL    GBNAMS
       CALL    GBNAM
       CALL    CKUNAM          CHECK THAT THE USER NAME IS GOOD
       ERROR   NVU             NOT VALID USER - COULD ALSO BE NOT IN DIST
       SETF    USERFL          FLAG FOR ONLY ONE USER
       BRU     STALL

STREM  NOP     RT2
       LDA     REMFLG          FLAG FOR REMOTE
       STA     TEST1
       SETF    TSTFLG
       BRU     STALL

STCEN  NOP     RT2
       LDA     CENFLG          PRINT CENTER REQUESTS
       STA     TEST1
       SETF    TSTFLG
       BRU     STALL

PALLS  CALL    GREC            GET THE RECORD, EVEN IF I HAVE IT
       LDA     BRNO
       SKE     RQSN
       BRU     PSTL2
PSTL1  LDA     JBSTA
       SKA     TEST            CHECK IF IT MEETS REQUIREMENTS
       BRU     PSTL2           DONT PRINT THIS ONE
       SKF     TSTFLG          CENTER OR REMOTE TEST
       BRU     *+4
       SKA     TEST1
       BRU     *+2
       BRU     PSTL2           DON'T PRINT UNLESS FLAG IS REALLY ON
       SKF     USERFL
       BRU     *+3
       CALL    CKUUN           IF USER, CHECK USER NUMBER
       BRU     PSTL2           DOES NOT MATCH
       CALL    PSTA            AFTER ALL THAT, PRINT THE REQUEST
PSTL2  CALL    GNJOB           GET THE NEXT REQUEST
       BRU     *+2
       BRU     PSTL1           KEEP GOING
       SKF     TF1             END OF LIST, CHECK FOR ANY PRINTED
       RET     STALL
       TYPE    NJMSG           NO JOBS IN LIST
       SKNF    STAFLG
       TYPE    NJMSG1
       TCO     CR
       RET     STALL

PSTA   NOP     RT3
       SKNF    TF1
       CALL    PSHD            PRINT HEAD SINCE IT IS NOT PRINTED
       TCO     CR           TYPE A CARRIAGE RETURN
       LDA     BRNO
       PDEC    5               PRINT IT AS 5 DIGIT NUMBER
       TCO     ZERO              PRINT 2 BLANKS
       TCO     ZERO
       LDA     DATE
       LDA     DATE
       LRSH    10
       ETR     K17
       ADD     ONE
       PDEC    2               PRINT AS 2 DECIMAL DIGITS
       TCO     K17            SLASH
       LDA     DATE
       LRSH    5
       ETR     K37
       ADD     ONE
       PDEC    2
       TCO     K17
       LDA     DATE
       LRSH    14
       ADD     K74
       PDEC    2
       LDA     JBSTA
       CLX
       SKA     CANFLG
       BRU     PSTAC
       SKA     DONFLG
       BRU     PSTACP
       SKA     INPFLG          INPROCESS
       BRU     PSTAIP
       SKA     HLDFLG
       BRU     PSTAH
       SKA     OTPFLG
       BRU     PSTATP
       SKA     XFRFLG
       BRU     PSTXFR
PSTAPN TYPE    PNDMSG          'PENDING'
       BRU     PSTA1
PSTAC  TYPE    CANMSG          'CANC'
       BRU     PSTA1
PSTAIP TYPE    INPMSG          'PROC'
       BRU     PSTA1
PSTACP TYPE    CMPMSG          'DONE'
       BRU     PSTA1
PSTXFR SKF     OPER
       BRU     PSTAPN
       TYPE    XFRSM
       BRU     PSTA1
PSTAH  SKF     OPER
       BRU     PSTAPN
       TYPE    HLDMSG          'HOLD'
       BRU     PSTA1
PSTATP SKF     OPER
       BRU     PSTAIP          'PROC'
       TYPE    OTPMSG          'TAPE'
       BRU     PSTA1

PSTA1  SKA     REMFLG
       BRU     *+3
       TYPE    CENMSG          'CEN'
       BRU     PSTA2
       SKF     OPER
       BRU     PSTA1A
       LDA     PRILOC
       SKF     COPER
       BRU     PSTA1B
       TYPE    RMMSG2
       PDEC    3
       TCO     ZERO
       BRU     PSTA2
PSTA1B SKE     CPRLOC
       BRU     PSTA1A
       TYPE    RMMSG1
       BRU     PSTA2
PSTA1A TYPE    REMMSG          'REM'
PSTA2  SPTR    BUSN
       ADD     K14
       XAB
       LDX     COUT
       BRS     35
       TCO     ZERO
       LDA     COUT
       MRG     NFMT3
       CAX
       LDA     FILES
       BRS     165             TYPE NUMBER OF FILES, RIGHT JUSTIFIED
       SKF     OPER
       BRU     PSTA2A
       LDA     COUT
       MRG     NFMT11
       CAX
       LDA     PAGES
       ADD     FILES
       ADD     FILES
       ADD     FILES
       ADD     FIVE            KLUDGE FOR HEADERS, ECT.
       BRS     165
       LDX     FORMS
       TYPE*   PSTAT,2
       CXA
       SKNE    FOUR
       BRU     PSTA2B          DON'T TYPE PARTS FOR SPECIAL FORMS
       LDA     PARTS
       ETR     SEVEN
       PDEC    1               ONLY ONE CHARACTER
PSTA2B LDB     JBSTA
       SKB     FULFLG
       TYPE    FULLMG
       RET     PSTA
PSTA2A LDA     RQNCP
       CALL    GSTNG
       TCO     ZERO
       TCO     ZERO
       TCO     ZERO
       TCO     ZERO
       LDX     COUT
       BRS     35
       RET     PSTA

CKUUN  NOP     RT10
       LDA     XUUN
       SKE     UUN
       RET     CKUUN
       SKIPRT  CKUUN

GBNAMS NOP     RT9
       CLA
       LDX     KM4
       STA     BUSN+4,2
       BRX     *-1
       CALL    1WD
       MOVSTG  BUSN
       SKIPRT  GBNAMS

PSHD   NOP     RT10
       TYPE    PH1
       SKNF    OPER
       TYPE    PH2
       SKF     OPER
       TYPE    PH3
       TCO     CR
       CLRF    TF1
       RET     PSHD

CKDJOB NOP     RT10
       CALL    GDREC
       ERROR   NVJ
       RET     CKDJOB

RDATE  NOP     RT9
       TYPE    SINCEM
       CIL     CIN
       SKNE    CR
       BRU     RDATE5
       LDX     CIN
       LDB     TEN
       BRS     38
       SKG     K14
       SKG     ZERO
       BRU     CMDERR
       SUB     ONE
       STA     MN
       LDB     TEN
       LDX     CIN
       BRS     38
       SKG     K37             31 DECIMAL
       SKG     ZERO
       BRU     CMDERR
       SUB     ONE
       STA     DY
       CBA
       SKNE    CR
       BRU     RDATE1
       LDX     CIN
       LDB     TEN
       BRS     38
       SKG     KD1900
       BRU     *+2
       SUB     KD1900
       SUB     K74
       STA     YR
       CALL    BDATE
       STA     TDATE
       RET     RDATE
RDATE1 LDA     CDATE
       ETR     KM40
       STA     TDATE
       ETR     KM4K            -4000B OR 7774B4
       LRSH    14
       STA     YR
RDATE3 CALL    BDATE
       SKG     TDATE
       BRU     RDATE2
       SKR     YR
       BRU     RDATE3
RDATE2 STA     TDATE
       RET     RDATE
RDATE5 CIO     CIN
       CALL    GTDATE
       STA     TDATE
       RET     RDATE
BDATE  NOP     RT10
       CLAB
       LDA     YR
       LSH     4
       MRG     MN
       LSH     5
       MRG     DY
       LSH     5
       RET     BDATE



***********************************************
*
*      CANCEL COMMAND
*
*      THIS COMMAND WILL CANCEL A REQUEST.  IN ORDER TO CANCEL
*      THE REQUEST, THE USER MUST BE THE ONE WHO IS BEING BILLED
*      OR MANAGER LICENSE (OR BETTER) ON THE DS PASSWORD
*
************************************************

CANCEL NOP     RT1
       CALL    SIMAP           REINITALIZE MAP
       CALL    GNUMBR          GET THE REQUEST NUMBER
       CALL    GRECN           GET THE RECORD INTO CORE
CAN1   LDA     RQSN            GOTTEN BY GNUMBR
       SKE     BRNO            COMPARE WITH RECORD FOR SAFETY
       ERROR   NVJ             NOT VALID REQUEST NUMBER
       LDA     JBSTA
       SKA     STTST1          TEST AGAINST DONE OR CANCELED
       BRU     CAN4            IT IS, CHECK FOR DUPLICATE
       SKA     STTST3          CHECK FOR IN PROCESS OR XFER
       BRU     CAN3            REQUIRES A PASSWORD TO CANCEL
       LDA     UUN             CHECK UUN AGAINST THE UUN
       SKE     CUUN            THAT THE USER IS LOGGED IN UNDER
       BRU     CAN3            IF NOT, CHECK FOR MANAGER LICENSE
CAN2   TCO     CR
       SPTR    BUSN
       ADD     K14
       XAB
       LDX     COUT
       BRS     35
       CALL    CKDT
       BRU     CMDISP          DOES NOT CONFIRM & I CANNOT HAVE DUPLICATES
       DISABLE 0               GO AHEAD AND CANCEL, BUT ESCAPES ARE DISABLED
       LDA     JBSTA           FOR SAFETY SAKE SO I CAN BE SURE OF EVERYTHING
       ETR     REMCON          RETAIN REMOTE CENTER INFO
       MRG     CANFLG
       STA     JBSTA           SET STATUS TO CANCELED
       CALL    WREC            WRITE THE RECORD OUT
       LDA     JBSTA
       LDB     PRILOC
       SKA     CENFLG
       CLB
       LDA     KM1
       CALL    AREMCT
       CALL    DALLF           DELETE ALL FILES
       ENABLE
       TYPE    JBCNLD          REQUEST CANCELED
       RET     CANCEL
CAN3   SKN     CPARW
       ERROR   NVJ             NOT VALID REQUEST NUMBER (NO ACCESS)
       LDA     JBSTA
       SKA     XFRFLG          CANNOT CANCEL A TRANSFER REQUEST
       ERROR   NVJ             UNLESS YOU ARE THE ORIGINATOR
       LDA     K1B7
       CALL    VERPSW          NO, GET A PASSWORD AND SET IT
       LDP     OPNAM
       STP     USN
       LDP     OPNAM+2
       STP     USN+2
       BRU     CAN2
CAN4   CALL    GDREC           GET A DUPLICATE RECORD
       ERROR   NVJ             NOT VALID REQUEST NUMBER
       BRU     CAN1            TRY, TRY, AGAIN

CKDT   NOP     RT5
       TYPE    FROMMG          FROM
       LDA     DATE            WE HAVE TO PRINT OUT DATE FOR CONFIRMATION
       LRSH    10
       ETR     K17
       ADD     ONE
       PDEC    2
       TCO     K17
       LDA     DATE
       LRSH    5
       ETR     K37
       ADD     ONE
       PDEC    2
       TCO     ZERO            BLANKS
       TCO     K37             QUESTION MARK
       CALL    YESNO
       RET     CKDT
       SKIPRT  CKDT



*************************************
*
*      LIST REQUEST
*
*      GIVE THE STATUS OF THE REQUEST, AND THE ADDITIONAL
*      INFORMATION AS TO FILE NAMES SPOOLED
*
*************************************

LIST   NOP     RT1
       CALL    SIMAP
       LDA     KM1
       SETF    TF1
       CALL    GNUMBR
       CALL    GREC
       LDA     BRNO
       SKE     RQSN
       ERROR   NVJ
LIST3  CALL    PSTA
       LDA     JBSTA
       SKA     CANFLG
       BRU     LIST4
       TYPE    FSM
       CLA
       CALL    GSTNG
       STP     TP
LIST2  GCI     TP
       BRU     LIST4
       CIO     COUT
       SKE     K203
       BRU     LIST2
       GCI     TP
       BRU     LIST4
       PDEC    0
       BRU     LIST2
LIST4  CALL    GDREC           ANY DUPLICATES
       RET     LIST
       BRU     LIST3


*********************************************
*
*      WHERE COMMAND TELLS WHERE A COMPLETED
*      REQUEST WAS PRINTED
*
*********************************************

WHERE  NOP     RT1
       CALL    SIMAP
       CALL    GNUMBR
       CALL    GRECN
       ERROR   NVJ
WHERE2 LDA     JBSTA
       SKA     DONFLG
       BRU     *+2
       BRU     WHERE1
       CALL    CKDT
       BRU     WHERE1
       TCO     CR
       LDA     PRILOC
       CALL    TYPPL
       TCO     CR
       RET     WHERE
WHERE1 CALL    GDREC
       ERROR   NVJ
       BRU     WHERE2


*****************************************
*
*      HOLD REQUEST
*
*      CAUSES REQUEST TO NOT BE INCLUDED IN PRINT AND STORE
*      COMMANDS BY GENERIC SUBCOMMAND
*
*****************************************
HOLDJ  NOP     RT1
       CALL    SIMAP
       SKF     OPER
       BRU     CMDERR
       CALL    GNUMBR
HOLDJ1 CALL    GRECN
       ERROR   NVJ
       LDA     JBSTA
       SKA     STTST3
       BRU     HOLDJ2
       MRG     HLDFLG
       STA     JBSTA
       CALL    WREC
       RET     HOLDJ
HOLDJ2 CALL    GDREC
       ERROR   NVJ
       BRU     HOLDJ1

GNUMBR NOP     RT8
       LDA     TERMC
       SKE     ZERO
       BRU     GNMB1
       CALL    1NUM
       BRU     GNMB2
GNMB1  TYPE    NUMBM
       LDB     TEN
       LDX     CIN
       BRS     38
GNMB2  SKG     ZERO
       ERROR   NVJ
       STA     RQSN
       RET     GNUMBR


*****************************************
*
*      TRANSFER REQUEST TO ANOTHER PRINT LOCATION
*
******************************************

TRANSF NOP     RT1
       CALL    SIMAP
       SKF     OPER
       BRU     CMDERR
       CALL    GNUMBR
       CALL    GRECN
       ERROR   NVJ
TRAN1  LDA     JBSTA
       SKA     XFRFLG          TRANSFER FLAG
       BRU     TRAN2           TRY TO TRANSFER IT
       CALL    GDREC           GET DUPLICATE RECORD
       ERROR   NVJ             NONE, SO CANNOT DO IT
       BRU     TRAN1
TRAN2  EOR     XFRFLG          TURN OFF FLAG
       STA     JBSTA           AND WAIT TO REWRITE IT
TRAN3  SPTR    XFRADR
       ADD     =20
       XAB
       STP     TP
       GCD     TP
       BRU     TRANE1          NO TRANSFER ADDRESS
       SKNE    ZERO
       BRU     *-3
       WCI     TP
       TYPE    XFRM1           TRANSFER TO
       LDP     TP
       LDX     COUT
       BRS     35
       TYPE    XFRM2           GET THE NODE NUMBER
       CIL     CIN
       SKNE    =43B
       BRU     TRAN4
       LDB     K10
       LDX     CIN
       BRS     38
       STA     T
       COPY    BA,B
       SKNE    =13B
       LDB     =4000B
       SKNE    CR
       BRU     *+3
       CIO     CIN
       BRU     *-3
       CBA
       ADD     T
       CALL    GETPL           GET THE PRINTER LOCATION
       SKG     SEVEN
       CLA
TRAN5  STA     TPL             SAVE IT
       SKE     ZERO
       BRU     TRAN6
       LDA     JBSTA
       SKA     FULFLG
       BRU     TRAN5B
TRAN5A SKA     REMFLG
       EOR     REMFLG
       MRG     CENFLG
       MRG     XFRDED
       STA     JBSTA
       BRU     TRAN7
TRAN5B TYPE    FULWRN
       CALL    YESNO
       BRU     TRAN3
       LDA     JBSTA
       BRU     TRAN5A
TRAN6  LDA     JBSTA
       SKA     CENFLG
       EOR     CENFLG
       MRG     REMFLG
       MRG     XFRDED
       STA     JBSTA
TRAN7  LDA     TPL
       TYPE    XFRM1
       CALL    TYPPL           TYPE THE PRINTER LOCATION
       TYPE    OKMSG
       CALL    YESNO           VERIFY IT
       BRU     TRAN3           NO, TRY AGAIN
       DISABLE
       LDB     PRILOC
       STB     OPRLOC
       LDA     KM1
       CALL    AREMCT          UPDATE THE COUNT
       LDB     TPL
       LDA     ONE
       STB     PRILOC
       CALL    AREMCT          AND ADD TO THE NEW COUNT
       CALL    WREC            REWRITE THE RECORD
       SKR     XFRCNT
       NOP     0
       CALL    OPHARD
       ENABLE
       TYPE    XFRM3           TRANSFER COMPLETED
       RET     TRANSF
TRAN4  CIO     CIN
       SKE     CR
       BRU     *-2
       CLA
       BRU     TRAN5

TRANE1 ERROR   NADDR           NO ADDRESS GIVEN


STCMD  CMD     (REMOTE,STREM),(CENTER,STCEN),(USER,STUSR),(ALL,STALL)
PSTAT  ZRO
       ZRO     SMM
       ZRO     LAM
       ZRO     TTM
       ZRO     SFM
       ZRO     SWM
       ZRO     LWM

***************************
*
*      LOCAL CONSTANTS
*
********************************************************

NFMT3  DATA    10003B3
NFMT11 DATA    10011B3
KD1900 DATA    1900
STTST1 DATA    CANCLD+DONE
STTST3 DATA    CANCLD+DONE+INPROC+ONTAPE+XFERED
REMCON DATA    6B4+1B3

       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPSTA SYMSORT

SYM.  PG.LN. IDENT.

BDATE   9 38 STA     CAN1   10 22 STA     CAN2   10 33 STA     
CAN3   11 18 STA     CAN4   11 30 STA     CANCEL 10 18 STA     CKDJOB  8 20 STA     
CKDT   11 34 STA     CKUUN   7 34 STA     GBNAMS  8  1 STA     GNMB1  14 28 STA     
GNMB2  14 32 STA     GNUMBR 14 22 STA     HOLDJ  14  4 STA     HOLDJ1 14  9 STA     
HOLDJ2 14 18 STA     KD1900 18  3 STA     LIST   12 21 STA     LIST2  12 38 STA     
LIST3  12 30 STA     LIST4  13  8 STA     LMSTCM 17 25 STA     NFMT11 18  2 STA     
NFMT3  18  1 STA     OM**** 14 37 STA     OM**** 13 37 STA     OM**** 13 12 STA     
OM**** 10 10 STA     OMM*** 12 14 STA     PALLS   4  1 STA     PSHD    8 10 STA     
PSTA    4 29 STA     PSTA1   6 11 STA     PSTA1A  6 28 STA     PSTA1B  6 24 STA     
PSTA2   6 29 STA     PSTA2A  7 24 STA     PSTA2B  7 20 STA     PSTAC   5 31 STA     
PSTACP  5 35 STA     PSTAH   6  2 STA     PSTAIP  5 33 STA     PSTAPN  5 29 STA     
PSTAT  17 26 STA     PSTATP  6  6 STA     PSTL1   4  5 STA     PSTL2   4 18 STA     
PSTXFR  5 37 STA     RDATE   8 25 STA     RDATE1  9 21 STA     RDATE2  9 32 STA     
RDATE3  9 27 STA     RDATE5  9 34 STA     REMCON 18  6 STA     REPORT  1 37 STA     
REPT1   3 10 STA     REPTS   3  8 STA     STALL   2 35 STA     STAT    1 39 STA     
STAT1   2 24 STA     STATUS  1 34 STA     STCEN   3 34 STA     STREM   3 28 STA     
STTST1 18  4 STA     STTST3 18  5 STA     STUSR   3 18 STA     TRAN1  15  9 STA     
TRAN2  15 15 STA     TRAN3  15 17 STA     TRAN4  17 17 STA     TRAN5  16 11 STA     
TRAN5A 16 17 STA     TRAN5B 16 23 STA     TRAN6  16 28 STA     TRAN7  16 34 STA     
TRANE1 17 23 STA     TRANSF 15  2 STA     WHERE  13 17 STA     WHERE1 13 33 STA     
WHERE2 13 22 STA     
SPOOL ** FICHE/FRAME BREAK *****
SPSUB
SUB    IDENT   COMMON SUBROUTINES      APR 26, 1976

       ENTRY   CKBUSY,GBRN,CLRIN,1WD,GBNAM,1NUM,CVNUM
       ENTRY   MFILNM,YESNO,SSPDP,DALLF,GTDATE
       ENTRY   UPDCNT,ADDCNT,POSTAC,UREMCT,AREMCT,EXTOFF
       ENTRY   VERPSW,FLCR,DISP,DIS,CKUNAM,CKBNAM,CERR
       ENTRY   TYPPL,GETPL,1ONUM,REDISP,OPHARD

CKBUSY NOP     RT10
       CXA
       SKE     ONE
       SKNE    =30
       SKIPRT  CKBUSY
       SKE     =34
       SKNE    =84
       SKIPRT  CKBUSY
       RET     CKBUSY

*      SETS UP BATCHR REQUEST NUMBER

GBRN   NOP     RT9
       IF      DEBUG
       LDA     ONE
       ADD     C000
       STA     BRNO
       RET     GBRN
       ENDF
       LDP     BNFIL
       LDX     TWO
       BRS     65
       BRU     GBRN1
       STA     IFILE
       CLA
       SCP     IFILE
       ERROR   BF
       WIO     IFILE
       SKE     =EOFWD
       SKNE    ZERO
       BRU     GBRN2
       STA     BRNO
GBRN3  LDA     BRNO
       ADD     ONE
       SKG     =999
       BRU     *+2
       LDA     ONE
       CAB
       LDA     K4B7
       SCP     IFILE
       ERROR   BF
       CBA
       WIO     IFILE
       LDA     IFILE
       BRS     20
       LDA     C000
       ADM     BRNO
       RET     GBRN
GBRN1  CALL     CKBUSY
       ERROR   BF
       BRS     45
       BRU     GBRN+1
GBRN2  BRS     42
       LRSH    23
       DIV     =1000
       STB     BRNO
       BRU     GBRN3
       IF      FTSW
BNFIL  ASCP    '(*1BATCH)@BATCHNUM1'
SPLCNT ASCP    '(SSPRINT)SPLCNT'
REMCNT ASCP    '(SSPRINT)REMCNT'
       ELSF    DEBUG
BNFIL  ASCP    '(CCARTER)@BATCHNUM1'
SPLCNT ASCP    '(CCARTER)SPLCNT'
REMCNT ASCP    '(CCARTER)REMCNT'
       ELSE
SPLCNT ASCP    '(SPOOL)SPLCNT'
REMCNT ASCP    '(SPOOL)REMCNT'
BNFIL  ASCP    '(*1BATCH)@BATCHNUM1'
       ENDF


MFILNM NOP     RT10
       STA     T
       LDP     SPDP
       STP     TP
       LDA     T
       SKG     =25
       BRU     MFIL1
       LRSH    23
       DIV     =26
       ADD     K40
       WCI     TP
       CBA
MFIL1  ADD     =41B
       WCI     TP
       LDP     TP
       RET     MFILNM

*REQUESTS A YES OR NO ANSWER

YESNO  NOP     RT8
       LDA     YNCMD
       CALL     DISP
       NOP
       TYPE    YORN            (YES OR NO)
       LDA     =-2
       ADM*    YESNO
       CALL    CLRIN
       RET     YESNO
YNCMD  CMD     (YES,YC),(NO,NC)

YC     NOP     RT10
       MIN*    YESNO
       SKR     SP
       RET     YESNO

NC     NOP     RT10
       SKR     SP
       RET     YESNO

*SET UP SPOOL DIRECTORY POINTERS

SSPDP  NOP     RT10
       LDP     SPDPTR
       MOVSTG  STNGAR          MOVE TO STRING AREA
       STP     SPDP
       LDA     BRNO
       LRSH    23
       DIV     =10000
       ADD     K20
       WCI     SPDP
       LSH     1
       CLA
       DIV     =1000
       ADD     K20
       WCI     SPDP
       LSH     1
       CLA
       DIV     =100
       ADD     K20
       WCI     SPDP
       LSH     1
       CLA
       DIV     TEN
       ADD     K20
       WCI     SPDP
       CBA
       ADD     K20
       WCI     SPDP
       RET     SSPDP

DALLF  NOP     RT9
       IF DEBUG
       RET     DALLF
       ELSE
       CLA
       STA     T
       CALL     SSPDP           SET UP FOR FILE NAME
DAF0   LDA     T
       SKNE    FILES
       RET     DALLF
       CALL     MFILNM
       BRS     48
       BRU     DAF2
       STA     TV1
       LDA     =23B6
       LDX     K14
       CLB
       BRS     141
       BRU     DAF0            IN CASE I LOST THE FILE GROUP
       LDA     TV1
       BRS     69              DELETE THE FILE
       NOP     0               I DON'T SEE HOW THIS COULD HAPPEN
DAF2   MIN     T
       BRU     DAF0
       ENDF

GTDATE NOP     RT10
       LDA     CDATE
       LDB     =36B3
       SUB     =2B3
       SKM     KM1
       BRU     *+2
       SUB     K1B4
       ETR     =@1777B
       RET     GTDATE

UPDCNT NOP     RT10
       STA     T
       LDP     SPLCNT
       LDX     TWO
       BRS     65
       RET     UPDCNT
       STA     IFILE
       LDA     T
       WIO     IFILE
       LDA     IFILE
       BRS     20
       RET     UPDCNT

ADDCNT NOP     RT10
       STA     T
       LDP     SPLCNT
       LDX     TWO
       BRS     65
       RET     ADDCNT          CAN'T GET TO IT
       STA     IFILE
       CLA
       SCP     IFILE
       NOP
       WIO     IFILE
       SKNE    =EOFWD
       CLA
       ADM     T
       LDA     K4B7
       SCP     IFILE
       NOP
       LDA     T
       SKG     KM1
       CLA     
       WIO     IFILE
       LDA     IFILE
       BRS     20
       RET     ADDCNT

UREMCT NOP     RT10
       STA     T
       LDP     REMCNT
       LDX     TWO
       BRS     65
       RET     UREMCT
       STA     IFILE
       LDA     CPRLOC
       MUL     THREE
       LSH     23
       MRG     K4B7
       SCP     IFILE
       BRU     UR1
       LDA     T
       MRG     K4B7
       WIO     IFILE
UR1    LDA     IFILE
       BRS     20
       RET     UREMCT

AREMCT NOP     RT10
       STA     T
       SKB     KM1
       BRU     *+2
       BRU     ADDCNT
       STB     TV1
       LDP     REMCNT
       LDX     TWO
       BRS     65
       RET     AREMCT
       STA     IFILE
       LDA     PRILOC
       MUL     THREE
       LSH     23
       STA     T1
       SCP     IFILE
       BRU     AR1
       WIO     IFILE
       ETR     =@4B7
       ADD     T
       SKG     KM1
       CLA
       MRG     K4B7
       STA     T
       LDA     T1
       MRG     K4B7
       SCP     IFILE
       BRU     AR1
       LDA     T
       WIO     IFILE
AR1    LDA     IFILE
       BRS     20
       RET     AREMCT


*FLUSH TO CARRAIGE RETURN

FLCR  NOP     RT10
       STA     SV1
       CIO     CIN
       SKE     CR
       BRU     *-2
       LDA     SV1
       RET     FLCR

*      THIS IS A GENERAL COMMAND DISPATCHER
*      IT WILL READ IN A LINE AND DECODE THE FIRST WORD
*      AND ATTEMPT TO FIND IT IN THE COMMAD LIST
*
*      THE COMMAND LIST IS GENERATED BY THE CMD MACRO.  THE FORMAT
*      OF THE LIST IS AS FOLLOWS
*
*              NUMBER OF ENTRIES FOLLOWING
*              POINTER TO START OF 1ST COMMAND
*              ADDRESS OF ROUTINE TO CALL TO
*
*      WITH THE SECOND AND THIRD ENTRIES BEING REPEATED N TIMES
*
*      CALLED WITH A CONTAINING THE ADDRESS TO THE COMMAND TABLE
*
DISP  NOP     RT9
       STA     CL
       LDA     =80
       LDB     CR
       LDX     CIN
       STNG    CMDSTN
       NOP     0
       STP     IP
       STP     LP
       BRU     DISEN
REDISP NOP     RT9
       STA     CL
       LDP     LP
       STP     IP
       BRU     DISEN
DIS   NOP     RT9
       STA     CL
DISEN  CALL     1WD             GET THE FIRST WORD OF THE LINE
       STP     1WDP
       SUB     1WDP+1
       CNA
       STA     LTH
       SKNE    ZERO
       BRU     DISP1           IF ZERO THEN IT WAS A CR
       LDA*    CL
       STA     COUNT
       LDA     CL
       ADD     ONE
       CAX
DISPL  SKR     COUNT
       BRU     *+2
       RET     DISP
       LDA     0,2
       CAB
       ADD     LTH
       XAB
       SKSE    1WDP
       BRU     *+2
       BRU     DISPG
DISPL1 EAX     3,2
       BRU     DISPL
DISPG  LDA     LTH             CHECK FOR LENGTH CONGRUITY
       SKG     2,2
       BRU     DISPL1
       EAX     1,2             POINT TO ADDR
       LDA*    DISP
       STA*    SP
       MIN     SP
       CALL*    0,2
       SKR     SP
       BRU     *+2
       ERROR   SQA
       MIN*    SP
       MIN*    SP
       BRR*    SP
DISP1  SKIPRT  DISP

CKUNAM NOP    RT9
       CALL     GLUD
       ERROR   NT
       SKNF    OPER
       BRU     CKU3
       LDA     CPARW
       SKA     K4B7
       BRU     CKU2            TYMSHARE
       SKA     K2B6
       BRU     CKU1            ACCOUNT SUPE
       LDX     LX
       LDA     LUUN,2
       ETR     =377777B
       SKE     CUUN
       ERROR   NVU
       STA     XUUN
       SKIPRT  CKUNAM
CKU1   LDX     LX
       LDA     LGAN,2
       ETR     =1777777B
       SKE     CGAN
       ERROR   NVU
       BRU     CKU3
CKU2   LDX     LX
       LDA     LDIST,2
       LRSH    2
       ETR     K1777
       SKE     CDIST
       ERROR   NVU
CKU3   LDX     LX
       LDA     LUUN,2
       ETR     =377777B
       STA     XUUN
       SKIPRT  CKUNAM

*CHECK FOR USER NAME IN LUD, STORE UUN & GAN, DISTRICT THE SME

CKBNAM NOP    RT9
       CALL     GLUD
       ERROR   NT              NOT IN LUD
       LDX     LX
       BRS     71
       BRU     *+2
       BRU     CKBNM1
       LDA     CDIST
       SKNE    ZERO
       BRU     CKBNM1
       LSH     2
       LDB     =7774B
       SKM     LDIST,2
       ERROR   ND              NOT IN DISTRICT
CKBNM1 LDA     LUUN,2
       ETR     =377777B
       STA     UUN
       LDA     LGAN,2
       ETR     =1777777B
       STA     GAN
       RET     CKBNAM

*GET LUD-- LOOKS UP USER IN LUD, SKIP RETURN IF FOUND
*LX HAS INDEX INTO LUD IF FOUND

GLUD   NOP     RT10
       LDX =BUSN
       LDA     0,2
       ADD     1,2
       ADD     2,2
       ADD     3,2
       LRSH    23
       DIV     =887
       STB     DADR
GLUD1  LDA     DADR
       LRSH    23
       DIV     K200
       STB     T1
       CLB
       LSH     13
       ADD     T1
       ADD     =320200B
       CAB
       LDA     =LUD
       LDX     K100
       BRS     124
       CLX
GLUD2  LDA LUD,2; SKG ZERO; BRU GLUD3
       SKE BUSN; BRU GLUD4
       LDA LUD+1,2; SKE BUSN+1; BRU GLUD4
       LDA LUD+2,2; SKE BUSN+2; BRU GLUD4
       LDA LUD+3,2; SKE BUSN+3; BRU GLUD4
       STX LX; SKIPRT GLUD
GLUD4  EAX 9,2; BRU GLUD2
GLUD3  SKNE ZERO; RET GLUD
       SKE KM1; BRU GLUD4; MIN DADR; BRU GLUD1



*ON ERROR TYPES A CR AND QUESTION MARK AND CR CLEARS INPUT

CERR  NOP     RT10
       TCO     CR
       TCO     K37
       TCO     CR
       BRU     CLRIN

*CLEARS INPUT BUFFER IF FROM TTY, CLOSES FILE AND CHANGES CIN TO TTY

CLRIN NOP     RT10
       BRS     181
       STB     COUT
       XMA     CIN
       SKG     ZERO
       BRU     *+2
       TYPE    CMDFER
       LDX     KM1
       BRS     11
       RET     CLRIN

*      SET UP POINTERS TO FIRST WORD IN LINE

1WD   NOP     RT10
       GCI     IP
       BRU     1WDR2
       SKNE    ZERO
       BRU     *-3
       SKR     IP
       LDA     IP
       STA     T
1WDL   GCI     IP
       BRU     1WDR1
       SKE     ZERO
       SKNE    CR
       BRU     1WDR
       SKE     LF
       SKNE    =144B
       BRU     1WDR
       SKE     =35B
       SKNE    K14
       BRU     1WDR
       SKNE    =13B
       BRU     1WDR
       BRU     1WDL
1WDR1  LDA     CR
       STA     TERMC
       LDB     IP
       LDA     T
       RET     1WD
1WDR2  LDA     CR
       STA     TERMC
       LDP     IP
       RET     1WD
1WDR   STA     TERMC
       LDA     IP
       SUB     ONE
       CAB
       LDA     T
       RET     1WD
*GET BILLABLE USER NAME FROM INPUT STREAM

GBNAM NOP     RT10
       TYPE    UNAMSG
       CLA
       LDX     KM4
       STA     BUSN+4,2
       BRX     *-1
       LDA     K14
       LDB     CR
       LDX     CIN
       STNG    BUSN
       ERROR   TL
       RET     GBNAM
*      GET A NUMBER FROM INSTRUCTION STRING

1NUM  NOP     RT9
       CALL     1WD
       STP     TP
       LDX     K1B7
       NSIC    TP
       RET     1NUM
1ONUM  NOP     RT9
       CALL    1WD
       STP     TP
       CLA
       STA     T
1ONUMA GCI     TP
       BRU     1ONUM1
       SKG     =27B
       SKG     K17
       BRU     1ONUM2
       LRSH    3
       LDA     T
       LSH     3
       STA     T
       BRU     1ONUMA
1ONUM1 LDA     T
       RET     1ONUM
1ONUM2 CLA
       RET     1ONUM

CVNUM NOP     RT10
       LDX     K1B7
       NSIC    1WDP
       STA     NUMBER
       RET     CVNUM
       IF      FTSW
SPDPTR ASCP    '(SSPRINT)'
       ELSF    DEBUG
SPDPTR ASCP    '(CCARTER)'
       ELSE
SPDPTR ASCP    '(SPOOL)'
       ENDF


POSTAC NOP     RT6
       DISABLE
       BRS     43
       XAB
       XMA     ACCREL
       XAB
       BRS     44
       CALL    P::ACC
       BRS     43
       XAB
       XMA     ACCREL
       XAB
       BRS     44
       ENABLE
       RET     POSTAC

EXTOFF NOP     RT8
       SKN     EXTRN
       RET     EXTOFF          OFF IF NOT EXTERNAL
       SKN     ONOFF
       RET     EXTOFF          NOT ON
       CLA
       STA     ONOFF
       TCO     K215
       TCO     K203            TURN OFF PRINTER
       TCO     K215
       LDX     KM1
       LDA     TERM
       BRS     160
       BRS     86
       LDX     KM1
       BRS     169
       LDA     K3777
       BRS     164
       TCO     CR
       RET     EXTOFF



VERPSW  NOP     RT9
       STA     VTEST
        BRS     71
       BRU     *+3
       SETF    STAFLAG
       BRU     VER1B
VER1A   LDP     SFPTR
        BRS     48
        BRU     ERV1
        LDB     =SFBUF
        LDX     FOUR
        BRS     96
        LDA     FOUR
        SKA     SFBUF+3
        BRU     *+2
        BRU     ERV2
        LDP     SFPTR
        BRS     64
        BRU     OPFER
        STA     SFIL
        CLA
        SCP     SFIL
        HLT     0
VER1B   TYPE    VM1             (ENTER NAME)
       CLA
       LDX     =-20
       STA     OPNAM+20,2
       BRX     *-1
       SPTR    OPNAM
       STP      VPTR1
        LDA     =VPTR1
        LDB     CR
        CLX
        BRS     33
       SKNF    STAFLAG
       RET     VERPSW
        LDA     VPTR1+1
        SUB     VPTR1
        STA     VT1
VER1    CIO     SFIL
        SKE     EOFC
        BRU     *+2
        BRU     NONAME
        SKE     CR
        BRU     VER1
        CIT     SFIL
        BRU     *+2
        BRU     NONAME
       SPTR    BUF2
        STP     VPTR2
        LDA     =VPTR2
        LDB     CR
        LDX     SFIL
        BRS     33
        LDA     VPTR2+1
        SUB     VPTR2
        SKG     ZERO
        BRU     NONAME
        SKE     VT1
        BRU     VER1
        LDP     VPTR2
        SKSE    VPTR1
        BRU     VER1
        GCI     VPTR1
        HLT     0
        SKR     VPTR1
        NOP
        STA     VXT8
        CALL    FONO
        SKA     K4B4
        BRU     *+2
        BRU     ERV3
        SKA     K1B7
        BRU     *+2
        BRU     ERV3
        SKA     VTEST
        BRU     *+2
        BRU     ERV3
        STA     VTEST
        CALL    FONO
        STA     VT1
        CALL    FONO
        STA     VT2
        LDA     SFIL
        BRS     20
        LDX     KM1
        LDA     THREE
        BRS     12
        TYPE    VM2             (ENTER YOUR PASSWORD PLEASE)
SGPS    LDP     TERMWD
        STP     VXT1
        STP     VXT3
        STB     VXT5
        CLA
        STA     TLV1
        LDA     VXT8
        ADM     VXT3
GPS     LDA     =20
        STA     TLV11
GPS1    LDX     TLV1
        LDA     VXT1,2
        MUL     =6065B
        DIV     =37777761B
        CBA
        ADD     VXT2,2
        CAB
        ETR     THREE
        STA     TLV1
        LDA     VXT1,2
        XAB
        STP     VXT1,2
        LDA     VXT5
        XMA     VXT1
        STA     VXT5
        SKR     TLV11
        BRU     GPS1
        CIO     ZERO
        SKE     CR
        BRU     *+2
        BRU     *+3
        ADM     VXT1
        BRU     GPS
        LDX     KM1
        LDA     K4B4
        BRS     12
        LDA     VXT1
        ADD     VXT2
        SKE     VT1
        BRU     VERRET
        LDA     VXT3
        ADD     VXT4
        SKE     VT2
        BRU     VERRET
        LDP     VPTR1
        STP     EDPT
EDLIN2  GCD     EDPT
        BRU     EDLIN1
        SKE     K200
        BRU     *+2
        BRU     EDLIN2
        SKE     =377B
        BRU     *+2
        BRU     EDLIN2
        SKG     ZERO
        BRU     EDLIN2
        MIN     EDPT+1
EDLIN1  LDP     EDPT
        STP     VPTR1
        LDA     VTEST          GET STATUS 
        SKA     K4B5           ARE WE A ROPER?
       SETF    ROPER           YES
       SKA     K4B5            ROPER?
       SETF    OPER            YES, THEN MAKE AN OPER
       SKA     K377B           DIST 0?
       RET     VERPSW          NO RETURN
       SETF    OPER            MAKE OPER ALSO
       SETF    COPER
       RET     VERPSW          RETURN NOW FINALLY

FONO    NOP     RT10
        LDB     K10
        LDX     SFIL
        BRS     38
        RET     FONO

TLV1    ZRO
TLV11   ZRO

DIST    ZRO

NONAME  TYPE    VME6
        BRU     VERRET


TERMWD  DATA    27657537B,55555555B

ERV1    TYPE    VME1
ERV     TYPE    VME
        BRU     VERRET
ERV2    TYPE    VME2
        BRU     ERV
OPFER   TYPE    VME3
        BRU     VERRET
ERV3    TYPE    VME4
        BRU     VERRET
VERRET  LDX     =-20
        CLA
        STA     OPNAM+20,2
        STA     BUF2+20,2
        STA     SFBUF+20,2
        BRX     *-3
        BRU     CMDERR

GETPL  NOP     RT10
       STA     T
       LDP     NODPRI
       BRS     64
       BRU     GETPL1
       STA     IFILE
       LDA     T
       CLB
       LSH     1
       ADD     T
       SCP     IFILE
       BRU     GETPL2
       WIO     IFILE
       LRSH    12
       ETR     K3777
       BRS     147
       RET     GETPL
$NODPRI ASCP   '(SPOOL)NODPRI'
$PRIADR ASCP   '(SPOOL)PRIADR'

GETPL1 CALL    CKBUSY
       ERROR   BF
       BRU     GETPL+2
GETPL2 ERROR   BF

TYPPL  NOP     RT10
       STA     TV1
       TYPE    TYMMSG
       LDP     PRIADR
       BRS     64
       BRU     TYPP1
       STA     IFILE
       LDA     TV1
       SKNE    ZERO
       LDA     CENLOC
       MUL     =128*3
       LSH     23
       ADD     THREE
       SCP     IFILE
       BRU     TYPP2
       LDA     FOUR
       STA     COUNT
TYPP3  SKR     COUNT
       BRU     *+2
       BRU     TYPP4
       LDA     =20
       LDX     =HLINE
       BIO     IFILE
       BRU     TYPP4
       SPTR    HLINE
       ADD     K74
       XAB
       STP     TP
       GCD     TP
       BRU     TYPP3
       SKNE    ZERO
       BRU     *-3
       MIN     TP+1
       LDP     TP
       LDX     COUT
       BRS     35
       TCO     CR
       BRU     TYPP3
TYPP4  BRS     147
       RET     TYPPL
TYPP1  CALL    CKBUSY
       ERROR   BF
       BRU     TYPPL+2
TYPP2  ERROR   BF


OPHARD NOP     RT5
       IF      FTSW                    FIELD TEST?
       RET     OPHARD                  JUST RETURN
       ENDF                            THAT'S ALL
       LDA     JBSTA
       SKA     CENFLG
       BRU     *+2
       RET     OPHARD
       LDP     OPHDFP
       LDX     THREE
       BRS     65
       BRU     OPHAR1
       XMA     COUT
       STA     TMPCOU
       RSP     COUT
       MRG     K4B7            SET TO END OF FILE
       SCP     COUT
       ERROR   BF
       BRS     43
       STA     TMPREL
       LDA     PRIREL
       BRS     44
       LDA     HSW
       STA     XHSW
       LDA     DBLSW
       STA     XDBLSW
       LDA     L:PG
       SUB     ONE
       STA     XL:PG
       LDA     INDCNT
       STA     XINDCT
       CALL    HARDCS
       LDA     JBSTA
       SKA     XFRFLG
       TYPE    XFRHAR
       BRS     43
       LDA     TMPREL
       BRS     44
       LDA     TMPCOU
       XMA     COUT
       BRS     20
       RET     OPHARD

OPHAR1 CALL    CKBUSY
       RET     OPHARD
       BRU     OPHARD

OPHDFP ASCP    '(SPOOL)@SPLHRD'

       NOLIST  EXT
       END
SPOOL ** FICHE/FRAME BREAK *****
SPSUB SYMSORT

SYM.  PG.LN. IDENT.

1NUM   14 27 SUB     1ONUM  14 33 SUB     1ONUM1 15  9 SUB     1ONUM2 15 11 SUB     
1ONUMA 14 38 SUB     1WD    13 13 SUB     1WDL   13 21 SUB     1WDR   14  5 SUB     
1WDR1  13 35 SUB     1WDR2  14  1 SUB     ADDCNT  6  5 SUB     
AR1     8  2 SUB     AREMCT  7 11 SUB     BNFIL   2 38 SUB     BNFIL   2 32 SUB     
BNFIL   2 28 SUB     CERR   12 31 SUB     CKBNAM 11  9 SUB     CKBNM1 11 23 SUB     
CKBUSY  1  9 SUB     CKU1   10 28 SUB     CKU2   10 34 SUB     CKU3   11  1 SUB     
CKUNAM 10 11 SUB     CLRIN  12 39 SUB     CVNUM  15 14 SUB     DAF0    5  2 SUB     
DAF2    5 17 SUB     DALLF   4 34 SUB     DIS     9  8 SUB     DISEN   9 10 SUB     
DISP    8 32 SUB     DISP1  10  9 SUB     DISPG   9 34 SUB     DISPL   9 22 SUB     
DISPL1  9 32 SUB     DIST   21  1 SUB     EDLIN1 20 18 SUB     EDLIN2 20  7 SUB     
ERV    21 10 SUB     ERV1   21  9 SUB     ERV2   21 12 SUB     ERV3   21 16 SUB     
EXTOFF 16  5 SUB     FLCR    8  9 SUB     FONO   20 31 SUB     GBNAM  14 13 SUB     
GBRN    1 21 SUB     GBRN1   2 18 SUB     GBRN2   2 22 SUB     GBRN3   2  2 SUB     
GETPL  21 26 SUB     GETPL1 22  7 SUB     GETPL2 22 10 SUB     GLUD   11 34 SUB     
GLUD1  12  4 SUB     GLUD2  12 17 SUB     GLUD3  12 24 SUB     GLUD4  12 23 SUB     
GPS    19  8 SUB     GPS1   19 10 SUB     GTDATE  5 21 SUB     MFIL1   3 15 SUB     
MFILNM  3  3 SUB     NC      3 38 SUB     NODPRI 22  4 SUB     NONAME 21  3 SUB     
OPFER  21 14 SUB     OPHAR1 24 23 SUB     OPHARD 23 19 SUB     OPHDFP 24 27 SUB     
POSTAC 15 28 SUB     PRIADR 22  5 SUB     REDISP  9  3 SUB     REMCNT  2 37 SUB     
REMCNT  2 34 SUB     REMCNT  2 30 SUB     SGPS   18 39 SUB     SPDPTR 15 24 SUB     
SPDPTR 15 22 SUB     SPDPTR 15 20 SUB     SPLCNT  2 36 SUB     SPLCNT  2 33 SUB     
SPLCNT  2 29 SUB     SSPDP   4  5 SUB     TERMWD 21  7 SUB     TLV1   20 37 SUB     
TLV11  20 38 SUB     TYPP1  23 13 SUB     TYPP2  23 16 SUB     TYPP3  22 29 SUB     
TYPP4  23 11 SUB     TYPPL  22 12 SUB     UPDCNT  5 31 SUB     UR1     7  7 SUB     
UREMCT  6 30 SUB     VER1   17 28 SUB     VER1A  16 34 SUB     VER1B  17 12 SUB     
VERPSW 16 28 SUB     VERRET 21 18 SUB     YC      3 33 SUB     YESNO   3 22 SUB     
YNCMD   3 31 SUB     
SPOOL ** FICHE/FRAME BREAK *****
SPBUILD
RES
XDD
0;TBDATA
3340;TB1
4000;TBCMD
;TBCON
;TBPOP
;TBSUB
;TBFIL
34000;TBMSG
10000;TBSPO
;TBCPY
;TBSTA
14000;TBPRI
;TBDVR
;TBTIO
30000;TBACC
;U%F

SAV 0,37777 O SPOOL

4000
CON
NOP<BRS 78D%WPOP176\NOP
%FDUM DSPOOL

"

CHECKSUMS


"
TOUT N
NARP
SPPRO
N
T
TOUT T
CHECKSUM
.SPOOL
SPPRO
SPINIT
SPCMD
SPCON
SPPOP
SPSUB
SPFIL
SPMSG
SPSPO
SPCPY
SPSTA
SPPRI
SPDVR
SPBTIO
SPACC
SPDATA
SPMAKE
SPBUILD
SPMAKEBIO
SPMAKENOBIO
.
COM T
SPOOL ** FICHE/FRAME BREAK *****
SPMAKE
NARP
SPPRO

DUM NARP

TOUT N
CON
SPSUB
BSUB

T
CON
SPCMD
BCMD

T
CON
SPFIL
BFIL

T
CON
SPCPY
BCPY

T
CON
SPSPO
BSPO

T
CON
SPSTA
BSTA

T
CON
SPPRI
BPRI

T
CON
SPDVR
BDVR

T
CON
SPBTIO
BTIO

T
CON
SPCON
BCON

T
CON
SPDATA
BDATA

T
CON
SPMSG
BMSG

T
CON
SPINIT
B1

T
NARP
SPACC
BACC

T
NARP
SPPOP
BPOP

T
COM SPBUILD
SPOOL ** FICHE/FRAME BREAK *****
SPMAKEBIO
EDI
R SPPRO
<BTIOSW>E
 1W SPPRO

QUIT
COM SPMAKE
SPOOL ** FICHE/FRAME BREAK *****
SPMAKENOBIO
EDI
R SPPRO
<BTIOSW>E
-1W SPPRO

QUIT
COM SPMAKE
J:%
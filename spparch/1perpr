1PERPRAY ** FICH/FRAME BREAK *****
PERPRAY29
29PERL IDENT   19 FEB 1979 MCH
DEBUG  EQU     -1              -1=> PROD 1=>DEBUG
SKNE   OPD     536B5,2
SPTR   OPD     514B5,2
START  STP     CIN             SAVE FILE NUMBERS FOR PRIMARY INPUT AND OUTPUT
       LDA     =M14            VERSION
       BRM     MSG
       LDX     =-1             INITIALIZE FLAGS
       STX     INTSW           SET TO 0 IF INTERNAL (I.E. TYMSHARE) USER
       STX     FORSW           SET TO 0 IF FOREIGN (I.E. EUROPEAN) USER
       STX     MDSISW          SET TO 0 IF MDSI USER (940'S ONLY)
       BRS     40              READ TERMINAL MODE FOR COMMAND PORT
       MRG     =4B4            MAKE SURE COMMAND EDIT MODE IS SET
       LDX     =-1
       BRS     12              SET TERMINAL MODE FOR COMMAND PORT
       BRM     VER             GET OPER NAME AND VERIFY IT
ST0    LDA     =155B           A CARRIAGE-RETURN
       CIO     COUT            PRINT IT TO PRIMARY OUTPUT FILE
       BRM     ARMESC          ARM ESCAPE
ST     BRS     156             ZAP ALL AUX CIRCUITS
       LDA     =26             A 26 IS A COLON
       CIO     COUT            PRINT THE PROMPT
       BRS     147             CLOSE ALL FILES (EXCEPT PRIMARY IN/OUT)
       LDX     =-1
       STX     RDFIL
       STX     NOOPEN
       BRS     162             ENABLE ESCAPES 
*
* THIS IS THE COMMAND SCANNER
*    NOTE:  SUB-COMMANDS ARE PROCESSED INSIDE THE MAIN COMMANDS IN A SLIGHTLY
*           KLUDGY WAY.  EACH ONE CHECKS FOR A CERTAIN LETTER IN THE
*           COMMAND STRING.  IF IT DOESN'T FIND IT, IT CALLS ANOTHER ROUTINE
*           EXCEPT FOR THE LAST ONE WHICH WILL CALL AN ERROR ROUTINE.  SO BE
*           CAREFUL WHEN ADDING OR REMOVING SUBCOMMANDS!!
*
       CIO     CIN             GET A CHARACTER FOR INPUT
       SKE     ='L'
       BRU     *+2
       BRU     LISTIT
       SKE     ='C'
       BRU     *+2
       BRU     CHANGE
       SKE     ='H'
       BRU     *+2
       BRU     HELP
       SKE     ='Q'
       BRU     ERROR           OOPS--COMMAND NOT RECOGNIZED
       BRU     QUIT
QUIT   BRS     156             ZAP ANY AUX CIRCUITS WE MAY HAVE BUILT
       BRS     10              RETURN TO EXEC
ERROR  BRM     CLCR            FLUSH ALL CHARS IN INPUT BUFFER UP TO A CR
ERR1   LDA     =M1             INVALID COMMAND
       BRM     MSG
       BRU     ST              LET'S GO TRY AGAIN
*
* HELP COMMAND -- JUST PRINTS THE HELP MESSAGE
*
HELP   LDA     =HELPM
       BRM     MSG
       BRM     CLCR            FLUSH INPUT BUFFER TO NEXT CR
       BRU     ST              GO GET ANOTHER COMMAND
*
* CHANGE USER COMMAND (USED TO MOVE A PERP JOB FROM ONE SYSTEM TO ANOTHER)
*
CHANGE BRM     GNCH            GET NEXT NON-BLANK CHARACTER FROM INPUT BUF
       BRU     ERR1            OOPS--NO CHARACTER FOUND
       SKE     ='U'            SEE IF THE SUBCOMMAND WAS A U
       BRU     CHASCH          SUBCOMMAND NOT A U, KEEP LOOKING
       BRM     CLCR            SUBCOMMAND WAS A U, CLEAR INPUT BUFFER TO A CR
       LDA     =-1
       STA     CHAFLG          INDICATE THAT WE ARE MAKING A CHANGE
       BRM     RDTO            ASK FOR THE OLD AND NEW SYSTEMS
       BRM     RDNAME          GET USER NAME TO CHANGE
       LDX     =-1
       BRS     161             DISABLE PANICS (NO ESCAPES ONCE WE START THIS)
       BRU     V1              NOW GO MAKE THE CHANGE
*
* LIST USER COMMAND
*
LISTIT BRM     GNCH            GET FIRST CHAR OF THE SUBCOMMAND
       BRU     ERR1            NO SUBCOMMAND GIVEN
       SKE     ='U'            SEE IF SUBCOMMAND WAS 'USER'
       BRU     LSC             NOPE--SEE IF IT WAS 'SCHEDULE'
       BRM     CLCR            YES--FLUSH REST OF INPUT LINE TO NEXT CR
       LDA     =M2             ASK FOR COMPUTER NUMBER
       BRM     MSG
       BRM     RDNO            READ A (DECIMAL) NUMBER FROM THE INPUT BUFFER
       STA     CPNO            SAVE THE CPU NUMBER
       CLA
       STA     CHAFLG          THIS IS NOT A CHANGE
       BRM     RDNAME          ASK FOR USERNAME (A '.' MEANS USE FILE INSTEAD)
       BRU     V1
V1     BRM     WHERE           VALIDATE CPNO AND SET BUICPN TO MASTER PERP NO.
       BRM     OPCH            BUILD CIRCUIT TO MASTER PERP AND HANDSHAKE SLAVE
       LDP     OP
       STP     CHAN1           COPY MASTER PERP IN/OUT PORT NUMBERS TO CHAN1
V1C    LDP     PTR
       STP     P               COPY POINTER TO USERNAME TO P
       BRM     XDOL            GET JOB LIST (I THINK /MCH) FROM 1GPERP
       LDA     COUNT           COUNT WILL HAVE NO. OF WORDS SENT BY 1GPERP
       SKE     =0
       BRU     V1A             WE GOT SOMETHING FROM 1GPERP SO KEEP GOING
       BRU     CHANG2          DIDN'T GET ANYTHING FROM 1GPERP
V1B    LDA     =M7             END OF JOB
       BRM     MSG
       BRU     ST              GO GET ANOTHER COMMAND
V1A    SKN     CHAFLG          SKIP IF WE ARE NOT MAKING A CHANGE
       BRU     LIST1
       LDX     CPNO
       LDA     TABLE,2         LOOK UP NUMBER OF MASTER PERP SYS FOR THIS CPNO
       LDX     TOCPNO
       SKNE    TABLE,2         SKIP IF DIFFERENT MASTER PERPS FOR OLD/NEW SYS
       BRU     CHANG1          MASTER PERP SYS STAYS THE SAME
       LDA     TABLE,2         LOOK UP NUMBER OF NEW MASTER PERP SYSTEM
* THIS LOOKS JUST A BIT SILLY--SHOULD CHECK FOR INTERNAL, FOREIGN, ETC. 1ST
* THEN CHECK TO SEE IF THE MASTER PERP SYSTEMS STAY THE SAME  /MCH
       SKN     INTSW           INTERNAL?
       BRU     CHANG1          YES
       SKN     FORSW           NOT FOREIGN IF NEG
       BRU     CHANG1         SAME CPTR IF FOR (14)
       SKN     MDSISW          MDSI?
       BRU     CHANG1         YES GO TO 20
       SKN     NOOPEN
       BRU     CHANG3          COMING FROM A FILE NO NEED TO REOPEN
* THIS NEXT SECTION OF CODE LOOKS VERY KLUDGY  /MCH
       LDA     BUICPN
       SKG     =3
       SKG     =1
       HLT 0                   BETTER BE 2 OR 3
       LDA     BUICPN
       SKE     =2
       LDB     =2
       SKE     =3
       LDB     =3
       STB     BUICPN
       BRM     OPCH
       LDP     OP
       STP     CHAN2
       CLA
       STA NOOPEN
CHANG3 LDA     =BUF
       STA     XPOS
CHANG0 BRM     GET1            GET 1 ENTRY SO WE CAN DEL AND INS
       BRU     CHANG2          THATS IT FOLKS NO MORE
       LDP     CHAN2
       STP     OP
       LDA     ="INS"
       BRM     SWD
       BRM     GWD
       SKE     ="INS"
       HLT
       LDA     =LIST
       BRM     SLIST           SEND LIST.
       CLA
       BRM     SWD
       BRM     GWD
       SKE     ="EJB"
       HLT
       LDP     CHAN1
       STP     OP
       LDA     ="DEL"
       BRM     SWD
       BRM     GWD
       SKE     ="DEL"
       HLT
       LDA     XCPU
       RSH 12
       CLB
       LSH 12
       MRG CPNO
       STA XCPU
       LDA     =XCPU
       BRM     MVSUB
       BRM     GWD
       SKNE    ="NJB"
       BRU     V1B
       SKE     ="EJB"
       HLT
       BRU     CHANG0
CHANG2 SKN     RDFIL
       BRU     *+2
       BRU ST
       BRM RDNAME
       BRU     V1C
*
*      THIS IS FOR THE CHANGE CODE FOR THE SAME COMPUTER
*
CHANG1 LDP     CHAN1
       STP     CHAN2
       BRU     CHANG3
       BRM     SWD
       BRM     GWD
       SKE     ="CHA"
       HLT
       LDA     CPNO
       CIO     OP
       LDA     TOCPNO
       CIO     OP
       BRM     SUSNM
       BRM     GWD
       SKE     ="EJB"
       HLT
       BRU     ST
LIST1  BRM     XDOLR
       BRU     CHANG2
*
*      CHANGE SCHEDULE
*
CHASCH SKE ='S'
       BRU CHAEXC
       BRM CLCR
       BRM GETTZ
CHASC1 LDA =M2
       BRM MSG (COMPUTER)
       BRM RDNO
       STA CPNO
       BRM CKCPN
       BRU CHASC1
*
*
* MAYBE EVER PST CST ECT
*
CHASC2 LDA =M15
       BRM MSG
       BRM RDNO
       STA HRDN
       BRM CKHR
       BRU CHASC2
       STA HRDN
CHASC3 LDA =M16
       BRM MSG
       BRM RDNO
       STA HRUP
       BRM CKHR
       BRU CHASC3
       STA HRUP
       SKE HRDN
       BRU CHASC4
       CLA
       STA HRDN
       STA HRUP
CHASC4 BRM OPCH
       LDA ="CSC"
       BRM SWD
       BRM GWD
       SKE ="CSC"
       HLT
       LDA CPNO
       CIO OP
       LDA HRDN
       CIO OP
       LDA HRUP
       CIO OP
       BRM GWD
       SKE ="EJB"
       HLT
       BRU ST
*
*LIST SCHEDULE
*
LSC    SKE ='S'
       BRU LEX
       BRM GNCH
       BRU *+2
       BRU LALL
       BRM GETTZ
LSC2  LDA =M2
       BRM MSG
       BRM RDNO
       STA CPNO
       BRM CKCPN
       BRU LSC2
       CLA
       STA ALLFLG
       BRM OPCH
LSC1   BRM GETSCH
       BRM LISSCH
       SKN ALLFLG
       BRU ST
       MIN CPNO
       BRU ALL1
LALL   SKE ='A'
       BRU ERR1
       BRM CLCR
       LDA =-1
       STA ALLFLG
       BRM GETTZ
       LDA 1
       STA CPNO
       BRM OPCH
ALL1   LDX CPNO
       LDA TABLE,2
       SKNE =-1
       BRU ST
       SKE =0
       BRU LSC1
       MIN CPNO
       BRU ALL1
*
*      LIST EXCEPTIONS
*
LEX    SKE ='E'
       BRU ERROR
       BRM CLCR
       CLA
       STA XPOS
       BRM GETTZ
       BRM OPCH
LEX1   MIN XPOS
       LDX XPOS
       LDA TABLE,2
       SKNE =0
       BRU LEX1
       SKNE =-1
       BRU ST
       STX CPNO
       BRM GETSCH
       LDA WD1
       SKA =4B7
       BRM LISSCH
       BRU LEX1
*
*      CHANGE EXCEPTIONS
*
CHAEXC SKE ='E'
       BRU ERROR
       BRM CLCR
CHAEX1 BRM GETTZ
       LDA =M2
       BRM MSG
       BRM RDNO
       STA CPNO
       BRM CKCPN
       BRU CHAEX1
       BRM OPCH
       LDA =M19
       BRM MSG
       BRM YESNO
       BRU CHAEX2
       LDA ="DEX"
       BRM SWD
       BRM GWD
       SKE ="DEX"
       HLT
       LDA CPNO
       CIO OP
       BRM GWD
       SKE ="EJB"
       HLT
       BRU ST
CHAEX2 LDA ="CEX"
       BRM SWD
       BRM GWD
       SKE ="CEX"
       HLT
CHAEX3 LDA =M20
       LDB =45
       BRM MSG1
       BRM GEXC
       BRU CHAEX3
       STA WD1
CHAEX4 LDA =M21
       LDB =43
       BRM MSG1
       BRM GEXC
       BRU CHAEX4
       STA WD2
      LDA CPNO
       CIO OP
       LDA WD1
       LDX =200320B
       BRS 176
       STB T1
       BRM SWD
       LDA T1
       BRM SWD
       LDA WD2
       LDX =200320B
       BRS 176
       STB T1
       BRM SWD
       LDA T1
       BRM SWD
       BRM GWD
       SKE ="EJB"
       HLT
       BRU ST

*
*      ROUTINE TO GET EXCEPTION TIME MM/DD/YY HR:MIN
*
GEXC   ZRO
       BRM RDNO
       STA MO
       SKG =12
       SKG =0
       BRU GEXC1
       CBA
       SKE ='/'
       BRU GEXC1
       BRM RDNO
       STA DA
       SKG =31
       SKG =0
       BRU GEXC1
       CBA
       SKE ='/'
       BRU GEXC1
       BRM RDNO
       STA YR
       SKG =82
       SKG =76
       BRU GEXC1
       CBA
       SKE =' '
       BRU GEXC1
       BRM RDNO
       STA HR
       SKG =23
       SKG =-1
       BRU GEXC1
       CBA
       SKE =':'
       BRU GEXC1
       BRM RDNO
       STA MIN
       SKG =59
       SKG =-1
       BRU GEXC1
       CBA
       SKE =155B
       BRU GEXC1
       LDA UZ
       CLB
       LSH 12
       MRG =20B
       STA T3
       CLB
       LDA MIN
       RSH 6
       LDA HR
       RSH 5
       LDA DA
       SUB =1
       RSH 5
       LDA MO
       SUB =1
       RSH 4
       LDA YR
       SUB =60
       LSH 14 
       LDX T3
       BRS 176
       MIN GEXC
       BRR GEXC
GEXC1  BRM CLCR
       LDA =M22
       LDB =31
       BRM MSG1
       BRR GEXC

*
*      GET NEXT CHAR AFTER BLANK
*
GNCH   ZRO
GNCHL  CIO CIN
       SKNE =155B
       BRR GNCH
       SKE =' '
       BRU GNCHL
       CIO CIN
GNCHL1 SKNE =155B
       BRR GNCH
       SKE =' '
       BRU GNCH1
        BRU GNCHL1
GNCH1  MIN     GNCH
       BRR GNCH
*
*      GETSCH GETS CPNO FROM GPERP 3 WDS
*
WD1    ZRO
WD2    ZRO
WD3    ZRO
HRDN   ZRO
HRUP   ZRO
GETSCH ZRO
       LDA ="LSC"
       BRM SWD
       BRM GWD
       SKE ="LSC"
       HLT
       LDA CPNO
       CIO OP (SEND CPNO)
       BRM GWD
       STA WD1 (GET AND STORE WD1)
       BRM GWD
       STA WD2 (GET AND STORE WD2)
       BRM GWD
       STA WD3 (GET AND STORE WD3)
       BRM GWD
       SKE ="EJB"
       HLT
       BRR GETSCH
*
*              THIS ROUTINE LIST WD1,WD2,WD3 IF NEEDED
*
LISSCH ZRO
       LDA WD1
       SKNE =0
       BRR LISSCH
       LDA =LENM1
       BRM MSG
       LDA CPNO
       BRM PDNO
       LDA WD1
       SKNE =4B7
       BRU LISS1
       LDA =M15
       BRM MSG
       CLA
       LDB WD1
       LSH 1
       CLA
       LSH 11
       STA T1
       BRM FIXHR
       BRM PDNO
       LDA =M16
       BRM MSG
       CLA
       LDB WD1
       LSH 12
       CLA
       LSH 12
       STA T1
       BRM FIXHR
       BRM PDNO
LISS1  LDA =155B
       CIO COUT
       SKN WD1
       BRR LISSCH
       LDA =M17
       BRM MSG
       LDA =M15
       BRM MSG 
       LDA WD2
       BRM PEXC
       LDA =M16
       BRM MSG 
       LDA WD3
       BRM PEXC
       LDA =155B 
       CIO COUT
       BRR LISSCH
*
*      GETTZ GETS THE TIME ZONE THAT WE ARE TO COMNVERT TO /FROM
*      TZTAB HAS ASCII INPUTS 
*      TZTAB1 HAS  DAYLIGHT TZ, TZ
*
TZTAB  ZRO
       ASC "TDP"
       ASC "TDC"
       ASC "TDE"
       ASC "TSP"
       ASC "TSC"
       ASC "TSE"
       ASC "RAP"
       ASC "TSB"
TZEND  ZRO
TZTAB1 ZRO
       DATA  351B
       DATA  353B
       DATA  354B
       DATA  350B
       DATA  352B
       DATA  353B
       DATA  361B
       DATA  362B
TA1END ZRO
TZSIZE DATA    -8
TZASC  ZRO
DST    ZRO
GETTZ  ZRO
       LDA =3
       STA BUICPN
       LDA =-1
       BRS 176
       CXA
       MRG =300B
       STA UZ
       BRR GETTZ
GETTZ1 LDA =M18
       BRM MSG
       CIO CIN
       SKNE =155B
       BRU GETTZ3
       CLB
       RSH 8
       CIO CIN
       SKNE =155B
       BRU GETTZ3
       RSH 8
       CIO CIN
       SKNE =155B
       BRU GETTZ3
       RSH 8
       STB TZASC
       BRM CLCR
       LDX TZSIZE
       LDA TZASC
       SKNE ="HEL"
       BRU GETTZ3
       SKNE TZEND,2
       BRU GETTZ2
       BRX *-2
       BRU GETTZ3
GETTZ2 LDA TA1END,2
       STA UZ
       BRR GETTZ
GETTZ3 LDA =M23
       BRM MSG
       BRU GETTZ1
*
*      CHECK HOUR IN A REGISTER FOR  VALID HOUR 
*
CKHR   ZRO
       STA T1
       SKG =-1
       BRR CKHR
       SKG =23
       BRU *+2
       BRR CKHR
       LDX =300B
       LDA =-1
       BRS 176
       ETR =77777740B
       MRG T1
       STP T1
       COPY B,XA
       LSH 12
       MRG =3000320B (GMT)
       CAX
       LDP T1
       BRS 176
       ETR =37B
       MIN CKHR
       BRR CKHR

*
*      FIXHR TAKES HR (GMT) AND CONVERTS TO HR (UZ)
*

FIXHR  ZRO
       LDA =-1
       LDX =300B
       BRS 176
       ETR =77777740B
       MRG T1
       STP T1
       COPY B,XA
       MRG =3200300B
       CAX
       LDP T1
       BRS 176
       ETR =37B
       BRR FIXHR
*
*      CHECK TABLE FOR VALID COMPUTER NUMBER
*      CPNO MUST CORRESPOND TO A 940 OR TO A PDP-10.
*      THIS MEANS THAT CPNO MUST LIE BETWEEN 1 AND 39 (INCLUSIVE) OR
*      BETWEEN 71 AND 99 (AGAIN, INCLUSIVE).
*
LOWCP  DATA    0               LOWEST VALID COMPUTER NUMBER-1
TOP940 DATA    22              HIGHEST NUMBERED 940+1
LOWTOP DATA    39              HIGHEST VALID COMP. NUMBER IN THE LOW RANGE
MAXBOT DATA    69              LOWEST VALID COMP. NUMBER-1 IN THE HIGH RANGE
MAXCP  DATA    99              HIGHEST VALID COMPUTER NUMBER

*
* CKCPN FIRST CHECKS THE VARIABLE CPNO TO SEE IF IT IS A VAILD COMPUTER NUMBER
*       (SEE ABOVE).  IF SO, CPNO IS USED AS AN INDEX INTO TABLE (DEFINED BELOW).
*       IF THE ENTRY IS NON-ZERO TAKE THE SKIP RETURN.
*       IN OTHER WORDS, IF (A) CPNO IS A VALID NUMBER FOR A 940 OR FOR A PDP-10
*       AND (B) THERE IS A NON-ZERO ENTRY IN TABLE FOR THIS CPU, TAKE A SKIP
*       RETURN.  OTHERWISE TAKE THE NORMAL (I.E. ERROR) RETURN.
*
CKCPN  ZRO
       LDA     CPNO
       SKG     LOWCP
       BRR     CKCPN           BAD NUMBER SO STOP
       SKG     LOWTOP          SKIP IF TOO BIG FOR THE LOW RANGE
       BRU     CKCP1           GO TO CKCP1 SINCE NUMBER IS IN THE LOW RANGE
       SKG     MAXCP           SKIP IF NUMBER IS TOO BIG
       SKG     MAXBOT          SKIP IF NUMBER IS SOMEWHERE IN THE HIGH RANGE
       BRR     CKCPN           RETURN--NUMBER WAS BAD
CKCP1  CAX                     IF WE GET HERE, CPNO IS GOOD SO USE AS AN INDEX
       LDA     TABLE,2         GET THE TABLE ENTRY FOR THIS CPU
       SKG     =0              SKIP IF ENTRY IS OK
       BRR     CKCPN           OOPS--THIS CPU DOESN'T REALLY EXIST FOR PERP
       MIN     CKCPN           GOOD ENTRY, SO SET UP FOR SKIP RETURN TO CALLER
       BRR     CKCPN           AND RETURN
*
*      THIS ROUTINE PRINTS EXCEPTION TIMES AFTER CHANGING
*         FROM GMT TO UZ
*
PEXC   ZRO
       STA T1
       LDA =2B5
       MRG UZ
       CAX   (SET UP Z REG)
       LDA T1
       BRS 176
       STB T1
       RSH 14
       ADD =60
       STA YR
       CLA
       LSH 4
       ADD =1
       STA MO
       CLA
       LSH 5
       ADD =1
       STA DA
       CLA
       LSH 5
       STA HR
       CLA
       LDB T1
       LSH 6
       STA MIN;
       LDA =" "
       CIO COUT
       LDA MO
       BRM PDNO
       LDA ="/"
       CIO COUT
       LDA DA
       BRM PDNO
       LDA ="/"
       CIO COUT
       LDA YR
       BRM PDNO
       LDA =" "
       CIO COUT
       LDA HR
       BRM PDNO
       LDA =":"
       CIO COUT
       LDA MIN
       SKG =9
       BRU *+2
       BRU PEXC1
       LDA =0
       BRM PDNO
       LDA MIN
PEXC1  BRM PDNO
       BRR PEXC
*
* SWD    EXPECTS A 3-CHARACTER STRING IN THE A REG.  SENDS THIS STRING TO
*        1GPERP ON THE MASTER PERP SYSTEM WE LOGGED INTO IN OPCH.
*
SWD    ZRO
       ABC                     COPY THE 3-CHAR STRING IN A TO B AND CLEAR A
       LSH     8               PUT 1ST CHAR OF STRING IN A
       CIO     OP              SEND IT TO THE SLAVE ON THE MASTER PERP SYSTEM
       CLA
       LSH     8          PUT 2ND CHAR INTO A
       CIO     OP              AND SEND IT
       CLA
       LSH     8
       CIO     OP              SEND 3RD CHAR
       BRR     SWD
*
* GWD    GETS A 3-CHAR STRING FROM 1GPERP ON THE MASTER PERP SYSTEM WE'VE
*        LOGGED INTO IN OPCH.  LEAVES IT IN THE A REGISTER.
*
GWD    ZRO
       CIO     IP              GET A CHAR FROM SLAVE
       CLB
       LSH     16              LEFT-JUSTIFY IT IN THE A REGISTER
       STA     T1              AND SAVE IN THE TEMP T1
       CIO     IP              GET 2ND CHAR
       CLB
       LSH     8               AND PUT IT IN THE MIDDLE OF THE A REG
       ADM     T1              ADD IT TO THE FIRST CHAR
       CIO     IP              GET 3RD CHAR FROM SLAVE
       MRG     T1              AND ADD THE 1ST 2 CHARS WE GOT
       BRR     GWD
*
*      ARM ESCAPES TO ST0
*
ARMESC ZRO
       LDA     =ESC
       STA     201B
       LDA     =2B6
       BRS 78
       BRR ARMESC
*
*      ESCAPE COMES HERE
*
ESCPC  ZRO
ESC    ZRO ESCPC
       BRU ST0
*
* OPCH   CREATES A PRIVILEGED AUX CIRCUIT TO THE MASTER PERP SYSTEM SAVED IN
*        BUICPN.  LOGS IN AS DUPJOB ON THAT SYSTEM, STARTS UP 1GPERP, AND
*        SHAKES HANDS WITH IT.  THE BRS 138 REQUIRES SYSTEM STATUS OR BETTER.
*        THE INPUT AND OUTPUT PORT NUMBERS FOR THE CIRCUIT ARE SAVED IN IP AND
*        OP (RESPECTIVELY).
*
OPCH   ZRO
       LDA     =M13            BUILDING CIRCUIT TO MASTER PERP SYSTEM
       BRM     MSG
       BRS     138             REQUEST A CIRCUIT TO THE SUPERVISOR
       SKE     =0              SKIP IF WE GOT IT
       HLT     0               REQUEST FAILED SO JUST STOP
       LDX     BUICPN          GET THE NUMBER OF THE MASTER PERP SYSTEM
       LDA     LOGS,2          GET THE LOGIN STRING FOR OUR MASTER PERP SYS
       IF      DEBUG
       REM    DEBUG MODE
OPX   LDA     =LOGST           IF DEBUGGING, USE SYSTEM 1 INSTEAD
       ELSE
       REM    PRODUCTION MODE
       ENDF
       LDB     =-1
       LDX     =1
       BRS     34              SEND THE LOGIN STRING TO THE SUPERVISOR
       BRS     138             ASK SUPER TO LOG US IN
       SKE     =0              SKIP IF SUPER DID THE LOGIN
       HLT     0               SUPER FAILED, SO GO BELLY UP
       CXA
       SKG     =1              SKIP IF INPUT PORT NO. IS GOOD
       HLT     0               BAD PORT NUMBER, LEAVE USER IN THE DARK
       STA     IP              SAVE THE INPUT PORT NO. FOR THE AUX CIRCUIT
       ADD     =1              CALCULATE OUTPUT PORT NUMBER
       STA     OP              AND SAVE IT
       LDA     =155B
       CIO     OP
       CIO     OP              SEND 2 CR'S TO MASTER PERP SYSTEM
       LDA     =ISTR           1GPERP
       LDB     =-1
       LDX     OP
       BRS     34              SEND THE STRING TO RUN THE PERP SLAVE
       LDX     OP
       BRS     85              SET 8-LEVEL MODE ON THE OTHER END
       CLA
       STA     T               INITIALIZE T FOR USE IN HANDSHAKE
       LDX     =-5             SET UP LOOP COUNTER FOR THE BRX BELOW
       MIN     T
       LDA     T
       CIO     OP
       BRX     *-3             SEND A '1234' TO THE SLAVE
* NOW LOOK FOR A '2345' FROM THE SLAVE--KEEP TRYING UNTIL IT ARRIVES
       CIO     IP              GET A CHARACTER FROM THE SLAVE
OPCH1  SKE     =2
       BRU     *-2             WE DID NOT GET A 2 FROM THE SLAVE, SO TRY AGAIN
       CIO     IP
       SKE     =3
       BRU     OPCH1           NOT A 3 SENT BY SLAVE, GO SEE IF IT WAS A 2
       CIO     IP
       SKE     =4
       BRU     OPCH1           DIDN'T GET A 4 FROM SLAVE, START OVER
       CIO     IP
       SKE     =5
       BRU     OPCH1           DIDN'T GET A 5 FROM SLAVE, START OVER
       BRR     OPCH            RETURN TO CALLER NOW THAT WE SHOOK HANDS
SPACES ASC     '    /'
LOGST  ASC     'DUPJOB:1-/'
ISTR   ASC     '1GPERP$/'
OP     ZRO     1
IP     ZRO
OF             DATA            1
IF     ZRO
CCP    ZRO
CPN    ZRO
T      ZRO
NCP    ZRO
TCOUNT ZRO
COUNT  ZRO
NOOPEN DATA    -1
CHAN1  BSS     2
CHAN2  BSS     2
MDSISW BSS     1
INTSW  BSS     1
FORSW  BSS     1
*
*      THIS TABLE TELLS WHICH COMPUTER THE CUST GOES TO IF ON THIS MACHINE
*      A -1 IS USED TO INDICATE THE END OF THE TABLE.
*      A 0 MEANS THAT THE SYSTEM IS NOT CURRENTLY AVAILABLE FOR PERP USE.
*      ALL OTHER ENTRIES SHOULD BE EITHER 8 OR 10.
*
TABLE  ZRO
       DATA    10              1
       DATA    10              2
       DATA    10              3
       DATA    10              4
       DATA    10              5
       DATA    10              6
       DATA    10              7
       DATA    10              8
       DATA    10              9
       DATA    10              10
       DATA    10              11
       DATA    10              12
       DATA    10              13
       DATA    10              14
       DATA    10              15
       DATA    10              16
       DATA    10              17
       DATA    10              18
       DATA    10              19
       DATA    10              20
       DATA    10              21
       DATA    10              22
       DATA    10              23
       DATA    10              24
       DATA    10              25
       DATA    10              26
       DATA    10              27
       DATA    10              28
       DATA    10              29
       DATA     8              30
       DATA    8               31
       DATA    8               32
       DATA    8               33
       DATA    8               34
       DATA    10              35
       DATA    10              36
       DATA    8               37
       DATA    8               38
       DATA    8               39
       DATA    0               40
       DATA    0               41
       DATA    0               42
       DATA    0               43
       DATA    0               44
       DATA    0               45
       DATA    0               46
       DATA    0               47
       DATA    0               48
       DATA    0               49
       DATA    0               50
       DATA    0               51
       DATA    0               52
       DATA    0               53
       DATA    0               54
       DATA    0               55
       DATA    0               56
       DATA    0               57
       DATA    0               58
       DATA    0               59
       DATA    0               60
       DATA    0               61
       DATA    0               62
       DATA    0               63
       DATA    0               64
       DATA    0               65
       DATA    0               66
       DATA    0               67
       DATA    0               68
       DATA    0               69
       DATA    0               70
       DATA    0               71
       DATA    0               72
       DATA    0               73
       DATA    0               74
       DATA    0               75
       DATA    0               76
       DATA    0               77
       DATA    0               78
       DATA    0               79
       DATA    0               80
       DATA    0               81
       DATA    0               82
       DATA    0               83
       DATA    0               84
       DATA    0               85
       DATA    0               86
       DATA    0               87
       DATA    0               88
       DATA    0               89
       DATA    8               90
       DATA    0               91
       DATA    0               92
       DATA    0               93
       DATA    0               94
       DATA    0               95
       DATA    0               96
       DATA    0               97
       DATA    0               98
       DATA    0               99
       DATA    -1              ENTRY INDICATING END OF TABLE
LOGS   DATA    0,LOG1,LOG2,LOG3,LOG4,LOG5
LOG1   ASC     'DUPJOB:2-/'
LOG2   ASC     'DUPJOB:8-/'
LOG3   ASC     'DUPJOB:10-/'
LOG4   ASC     'DUPJOB:14-/'
LOG5   ASC     'DUPJOB:20-/'
*
* XDOL   SENDS CPNO AND USERNAME TO 1GPERP AND GETS A REPLY.
*        THE REPLY IS STORED IN BUF AND T1 WILL HAVE THE LOCATION OF THE
*        END OF THE REPLY+1.
*
XDOL   ZRO
       LDA     ="XXL"
       BRM     SWD             SEND ABOVE COMMAND TO 1GPERP
       BRM     GWD             GET 1GPERP'S REPLY
       SKE     ="XXL"
       HLT     0               OOPS--WE DIDN'T GET THE ANSWER WE EXPECTED
       LDA     CPNO
       CIO     OP              SEND THE SYSTEM NUMBER TO 1GPERP
       BRM     SUSNM           AND SEND THE USER NAME AND ITS LENGTH TOO
       LDA     =BUF
       STA     T2              COPY LOCATION OF BUF TO T2
       BRM     GWD             GET COUNT FROM THE SLAVE
       STA     COUNT
       SKNE    =0
       BRU     XDOL2           COUNT WAS 0 SO WE'RE DONE
       CLA
       STA     TCOUNT          INITIALIZE NUMBER OF WORDS STORED IN BUF
XDOL1  BRM     GWD             GET NEXT WORD FROM 1GPERP
       STA*    T2              AND SAVE IT IN BUF
       MIN     TCOUNT          ADD TO COUNT OF NUMBER OF ENTRIES IN BUF
       LDA     COUNT
       SKE     TCOUNT          SKIP IF WE'VE GOTTEN EVERYTHING FROM THE SLAVE
       BRU     *+2             OTHERWISE KEEP GOING
       BRU     XDOL2           FINISH UP WHEN WE HAVE EVERYTHING
       MIN     T2              POINT TO NEXT FREE WORD IN BUF
       BRU     XDOL1           AND GO BACK FOR NEXT WORD FROM SLAVE
* COME HERE TO FINISH UP AFTER GETTING LIST FROM THE SLAVE
XDOL2  LDA     T2
       STA     T1              SAVE LOCATION OF NEXT FREE WORD IN BUF IN T1
       BRM     GWD             GET NEXT RESPONSE FROM SLAVE
       SKE ="EJB"
       HLT     0               SLAVE DIDN'T TELL US WHAT WE EXPECTED TO HEAR
       BRR     XDOL            WE GOT THE LIST OK
*
* SUSNM   CALCULATES LENGTH OF USERNAME, AND SENDS THE LENGTH AND
*         NAME TO 1GPERP
*
SUSNM  ZRO
       LDA     P1
       SUB     P               CALCULATE LENGTH OF THE USERNAME
       CIO     OP              SEND TO SLAVE
       GCI     P               GET CHAR FROM USERNAME
       BRR     SUSNM           NO CHAR TO SEND, SO WE'RE DONE
       BRU     *-3             OTHERWISE SEND THE CHAR
XDOLR  ZRO
       LDA =BUF
       SKE T1
       BRU LEN1
       LDA     =M6
       BRM MSG
       BRR XDOLR
LEN1   STA XPOS
       LDA     XPOS
       SUB     =BUF
       SKE     COUNT
       BRU     LEN2
       BRR XDOLR
LEN2   LDA =LENM1
       BRM  MSG
       MIN XPOS
       LDA* XPOS
       MIN XPOS
       ETR =777B
       BRM PDNO (COMP. NO.)
       LDA ='   ,'
       CIO COUT
       CLA
       CIO COUT
       MIN     XPOS
       LDA* XPOS
       MIN XPOS
       BRM PWD
       BRU *-3
LEN2L  LDA*    XPOS
       MIN     XPOS
       SKA     =4B7
       BRU     LEN1+1
       BRU     LEN2L           LOOP
LENM1  ASC '$CPN: /'
SYSER  ZRO
       LDA     =M8
       BRM MSG
       BRR XDOLR
$UZ    ZRO
CT     ZRO
CRP    ZRO
FL     ZRO
LSZ    ZRO
PPOS   ZRO
NPOS   ZRO
XPOS   ZRO
$PDNO  ZRO
       LDX COUT
       LDB =10
       BRS 36
       BRR PDNO
PWD    ZRO
       ABC
       BRM PCH
       BRM PCH
       BRM PCH
       BRR PWD
PCH    ZRO
       LSH 8
       ETR =177B
       CIO COUT
       SKE =155B
       BRR PCH
       MIN     PWD
       BRR     PWD
MSG1   ZRO
       CAX
       LDA =155B
       CIO COUT
       CXA
        LDX COUT
       BRS 34
       BRR MSG1
MSG    ZRO
       LDB     =-1
       LDX     COUT
       BRS     34
       BRR     MSG

CLCR   ZRO
       CIO     CIN
       SKE     =155B
       BRU     *-2
       BRR     CLCR

RDNO   ZRO
       LDB     =10
       LDX     CIN
       BRS     38
       BRR     RDNO
*
*      MVSUB MOVES FROM ADDR IN A TO REMOTE ENDS ON 0
*
MVSUB  ZRO
       STA     T1
MVS1   LDA*    T1
       ETR     =37777777B
       SKNE    =0
       BRU     MVS2
       BRM     SWD
       MIN     T1
       BRU     MVS1
MVS2   BRM     SWD
       BRR     MVSUB
*
* THIS ROUTINE GETS ONE USER FROM BUF AREA AND MOVES TO LIST
*
GET1   ZRO
       LDA     =LIST
       STA     T2
       LDA     XPOS
       SUB     =BUF
       SKG     COUNT
       SKNE    COUNT
       BRR     GET1            DONE
       LDA*    XPOS
       STA     NXD
       MIN     XPOS
       MIN     T2
       LDA*    XPOS
       RSH     12
       CLB
       LSH 12
       MRG TOCPNO
       STA     XCPU
       MIN     XPOS
       MIN     T2
       LDA*    XPOS
       STA     TMWD
       MIN     XPOS
       MIN     T2
GET1L  LDA*    XPOS
       STA*    T2
       MIN     XPOS
       MIN     T2
       SKA     =4B7
       BRU     *+2
       BRU     GET1L           NOW LOOP 
       CLA
       STA* T2
       MIN T2 (SEPARATE BY 0)
GET1LA LDA*    XPOS
       STA*    T2
       MIN     XPOS
       MIN     T2
       SKA     =4B7
       BRU     GE1
       BRU     GET1LA          LOOP
GE1    LDA     =-1
       STA*    T2
       MIN     GET1
       BRR     GET1
*
*      THIS ROUTINE SENDS A LIST TO THE REMOTE, UNTIL IT FINDS A =1
*
SLIST  ZRO
       LDA     =LIST
       STA     T2
SLISTL LDA*    T2
       SKNE    =-1
       BRR     SLIST
       BRM     SWD
       MIN     T2
       BRU     SLISTL          AND LOOP


*
*      THIS ROUTINE FIGURES OUT WHERE TO BUILD CIRCUIT
*      IT CLOBBERS BOTH X AND A
*
WHERE  ZRO
       BRM     CKCPN           SEE IF CPNO IS VALID
       BRU     BADCPN          BAD NUMBER
       LDA     =M9             INTERNAL (I.E. TYMSHARE) USER?
       BRM     MSG
       BRM     YESNO
       BRU     *+2             NOPE, NOT INTERNAL
       BRU     INT             YES IS INTERNAL
       LDA     =M10            FOREIGN?
       BRM     MSG
       BRM     YESNO
       BRU     *+2             NO
       BRU     FOR             YES--FOREIGN USER
* CHECK TO SEE IF CPNO IS A 940--IF SO ASK IF THIS AN MDSI USER
       LDA     CPNO
       SKL     TOP940          SKIP IF CPNO IS A 940
       BRU     NOMDSI          DON'T ASK IF USER IS MDSI
       LDA     =M11            MDSI?
       BRM     MSG
       BRM     YESNO
       BRU     NOMDSI          NOT MDSI
       BRU     MDSI            IS MDSI
NOMDSI LDX     CPNO            USE CPNO AS INDEX INTO TABLE
       LDA     TABLE,2         GET THE MASTER PERP SYSTEM FOR THIS CUSTOMER
       SKNE    =10             IS THE TABLE ENTRY SYSTEM 10?
       BRU     SYS10           TABLE ENTRY WAS 10
* SYS8 IS THE DEFAULT IN CASE THE USER IS NOT INTERNAL, FOREIGN, MDSI, AND
*      WHEN THE TABLE ENTRY FOR CPNO IS NOT 10
SYS8   LDA     =2              LOG2 STRING USED
       STA     BUICPN
       BRR     WHERE
INT    LDA     =1              LOG1 USED
       STA     BUICPN
       CLA
       STA INTSW
       BRR     WHERE
MDSI   LDA     =5              LOG5 USED
       STA     BUICPN
       CLA
       STA     MDSISW
       BRR     WHERE
SYS10  LDA     =3              LOG 3 USED
       STA     BUICPN
       BRR     WHERE
FOR    LDA     =4              LOG4 USED
       STA     BUICPN
       CLA
       STA     FORSW
       BRR     WHERE
BADCPN LDA     =M12
       BRM     MSG
       BRU     ST
BUICPN        ZRO              ;*SET TO SYS NO. OF MASTER PERP SYSTEM BY RDNAME
*
*      YES NO ROUTINE SKIP RET IF YES
*
YESNO  ZRO
       CIO     CIN
       SKE     ="  Y"
       BRU     NO
YES    MIN     YESNO
NO     BRM     CLCR
       BRR     YESNO
RDFIL  DATA    -1              IS 0 IF RDNAME IS GETTING USERNAMES FROM A FILE
*
* RDNAME ASKS FOR A USERNAME FROM THE PRIMARY INPUT FILE.  THIS IS STORED
*        IN NAME AND PTR WILL BE A VALID STRING POINTER TO IT.  HOWEVER, IF
*        THE FIRST CHAR OF THE USER NAME IS A '.', THE REST OF THE USERNAME IS
*        TAKEN AS A FILE NAME (WHICH HAD BEST CONSIST OF A LIST OF USERNAMES,
*        ONE PER LINE).  IN THIS CASE, THE FILE NUMBER IS SAVED IN CIN1 AND
*        RDFIL IS SET TO 0 TO INDICATE THAT WE ARE READING FROM A FILE.  A LINE
*        IS READ FROM THE FILE AND STORED IN NAME JUST AS WHEN THE INPUT IS
*        COMING FROM THE PRIMARY INPUT FILE.
*
RDNAME ZRO
       SKN     RDFIL           SKIP IF NOT READING FROM A FILE
       BRU     RDNAM1          OTHERWISE GET NEXT NAME FROM FILE
       LDA     =M3             USERNAME
       BRM     MSG
       SPTR    NAME            MAKE STRING PTR TO NAME BUFFER
       STP     PTR             AND COPY IT TO PTR
       LDB     =155B
       LDX     CIN
       LDA     =PTR
       BRS     33              READ A LINE FROM PRIMARY INPUT FILE
       STP     T1              COPY POINTER TO A TEMP
       GCI     T1              AND COPY 1ST CHAR OF NAME INTO A
       HLT     0               COULDN'T DO IT FOR SOME REASON SO DIE
       SKE     ='.'            SKIP IF THE CHAR WAS A PERIOD
       BRR     RDNAME          THIS IS A USERNAME NOT A FILE, SO WE'RE DONE HERE
       LDP     T1              GET THE STRING POINTER TO THE FILE NAME
       BRS     64              OPEN THE FILE FOR READ
       HLT     0               OPEN FAILED, BUT JUST DIE--DON'T TELL USER
       STA     CIN1            OPENED FILE OK, SO SAVE THE NUMBER
       CLA
       STA     RDFIL           SAY THAT WE ARE NOW READING FROM A FILE
RDNAM1 SPTR    NAME            MAKE A NULL POINTER TO NAME
       STP     PTR             AND COPY IT TO PTR
       LDA     =137B           END OF FILE INDICATOR
       CIT     CIN1            SEE IF NEXT CHAR IN FILE IS END OF FILE
       BRU     *+2             NOT AT END, SO KEEP GOING
       BRU     ST              FOUND END OF FILE, SO ALL DONE.  GET NEW COMMAND
       LDB     =155B
       LDX     CIN1
       LDA     =PTR
       BRS     33              READ A LINE FROM THE FILE
       BRR     RDNAME          RETURN EVEN IF THE READ FAILS
       BRR     RDNAME
*
* RDTO   ASKS FOR THE OLD AND NEW SYSTEMS WHEN MOVING A USER'S PERP JOBS
*        THE OLD SYSTEM IS SAVED IN CPNO AND THE NEW ONE IN TOCPNO
*
RDTO   ZRO
       LDA     =M4             FROM
       BRM     MSG
       BRM     RDNO            GET A DECIMAL NUMBER FROM PRIMARY INPUT FILE
       STA     CPNO            AND SAVE IN CPNO
       LDA     =M5             TO
       BRM     MSG
       BRM     RDNO
       STA     TOCPNO          AND NOW SAVE THE NEW SYSTEM NUMBER
       BRR     RDTO
*
*
*
*GET PASSWORD NAME AND VERIFY

VER     ZRO
        SKN     VERSW
        BRR     VER
        BRS     71
        BRU     VER1A
        SKR     STASW
        BRU     *-1
        BRU     VER1B
VER1A   LDP     SFPTR
        BRS     48
        BRU     ERV1
        LDB     =SFBUF
        LDX     =4
        BRS     96
        LDA     =4
        SKA     SFBUF+3
        BRU     *+2
        BRU     ERV2
        LDP     SFPTR
        BRS     64
        BRU     OPFER
        STA     SFIL
        CLA
        SCP     SFIL
        HLT     0
VER1B   LDA     =VM1
       BRM MSG    (ENTER NAME)
        LDA     VPTR1
        STA     VPTR1+1
        LDA     =VPTR1
        LDB     =155B
        CLX
        BRS     33
        SKN     STASW
        BRU     VER1B1
        BRM     EDVER
        MIN     VERSW
        BRR     VER
VER1B1  LDA     VPTR1+1
        SUB     VPTR1
        STA     VT1
VER1    CIO     SFIL
        SKE     =137B
        BRU     *+2
        BRU     NONAME
        SKE     =155B
        BRU     VER1
        CIT     SFIL
        BRU     *+2
        BRU     NONAME
        LDA     VPTR2
        STA     VPTR2+1
        LDA     =VPTR2
        LDB     =155B
        LDX     SFIL
        BRS     33
        LDA     VPTR2+1
        SUB     VPTR2
        SKG     =0
        BRU     NONAME
        SKE     VT1
        BRU     VER1
        LDP     VPTR2
        SKSE    VPTR1
        BRU     VER1
        GCI     VPTR1
        HLT     0
        SKR     VPTR1
        NOP
        STA     VXT8
        BRM     FONO
       STA     STATUS
        SKA     =40000B
        BRU     *+2
        BRU     ERV3
        SKA     =4B6
        BRU     *+2
        BRU     ERV3
        ETR     =377B
        STA     DIST
        BRM     FONO
        STA     VT1
        BRM     FONO
        STA     VT2
        LDA     SFIL
        BRS     20
        LDX     =-1
        LDA     =3
        BRS     12
        LDA     =VM2
       BRM MSG    (ENTER YOUR PASSWORD PLEASE)
SGPS    LDP     TERMWD
        STP     VXT1
        STP     VXT3
        STB     VXT5
        CLA
        STA     TLV1
        LDA     VXT8
        ADM     VXT3
GPS     LDA     =20
        STA     TLV11
GPS1    LDX     TLV1
        LDA     VXT1,2
        MUL     =6065B
        DIV     =37777761B
        CBA
        ADD     VXT2,2
        CAB
        ETR     =3
        STA     TLV1
        LDA     VXT1,2
        XAB
        STP     VXT1,2
        LDA     VXT5
        XMA     VXT1
        STA     VXT5
        SKR     TLV11
        BRU     GPS1
        CIO     =0
        SKE     =155B
        BRU     *+2
        BRU     *+3
        ADM     VXT1
        BRU     GPS
        LDX     =-1
        LDA     =4B4
        BRS     12
        LDA     VXT1
        ADD     VXT2
        SKE     VT1
        BRU     NOPASS
        LDA     VXT3
        ADD     VXT4
        SKE     VT2
        BRU     NOPASS
        BRM     EDVER
        MIN     VERSW
        BRR     VER

FONO    ZRO
        LDB     =8
        LDX     SFIL
        BRS     38
        BRR     FONO

TLV1    ZRO
TLV11   ZRO

VERSW   DATA    -1
STASW  DATA    0
STATUS ZRO
DIST    ZRO
NOPASS  LDA     =VME5
       BRM MSG
        LDX     =-1
        LDA     =3
        BRS     12
        BRU     SGPS

NONAME LDA      =VME6
       BRM MSG
        BRU     VERRET


TERMWD  DATA    27657537B,55555555B

SFPTR   DATA    3*SF-1,3*SF+5
SF      ASC     '()PSWD'
VPTR1   DATA    3*OPNAM-1,3*OPNAM-1
OPNAM   BSS     20
VPTR2   DATA    3*BUF2-1,3*BUF2-1
BUF2    BSS     20
SFBUF   BSS     20
VT1     ZRO
VT2     ZRO
VXT1    ZRO
VXT2    ZRO
VXT3    ZRO
VXT4    ZRO
VXT5    ZRO
VXT8    ZRO
SFIL    ZRO
ERV1    LDA     =VME1
       BRM MSG
ERV     LDA     =VME
       BRM MSG
        BRU     VERRET
ERV2    LDA     =VME2
       BRM MSG
        BRU     ERV
OPFER   LDA     =VME3
       BRM MSG
        BRU     VERRET
ERV3    LDA     =VME4
       BRM MSG
        BRU     VERRET
VERRET  LDX     =-20
        CLA
        STA     OPNAM+20,2
        STA     BUF2+20,2
        STA     SFBUF+20,2
        BRX     *-3
        BRU     QUIT

EDVER   ZRO
        LDP     VPTR1
        BRM     EDLIN
        STP     VPTR1
        BRR     EDVER
EDLIN   ZRO
        STP     EDPT
EDLIN2  GCD     EDPT
        BRU     EDLIN1
        SKE     =200B
        BRU     *+2
        BRU     EDLIN2
        SKE     =377B
        BRU     *+2
        BRU     EDLIN2
        SKG     =0
        BRU     EDLIN2
        MIN     EDPT+1
EDLIN1  LDP     EDPT
        BRR     EDLIN
EDPT    BSS     2
VME1    ASC     '$NO PASSWORD FILE/'
VME     ASC     '$NOTIFY DIVISION OPNS MGR AND SYS. GROUP TECH DIV/'
VME2    ASC     '$PASSWORD FILE STATUS LOST/'
VME3    ASC     '$PASSWORD FILE BUSY-TRY LATER$/'
VME4    ASC     '$UNVALIDATED NAME/'
VM1     ASC     '$YOUR NAME: /'
VM2     ASC     '$YOUR PASSWORD: /'
VME5    ASC     '$ERROR, TYPE PASSWORD /'
VME6    ASC     '$NAME DOES NOT APPEAR IN PASSWORD FILE$/'

M1     ASC     '$INVALID COMMAND$/'
M2     ASC     '$COMPUTER: /'
M3     ASC     '$USERNAME: /'
M4     ASC     '$FROM: /'
M5     ASC     '$TO: /'
M6     ASC     '$JOB LIST EMPTY$/'
M7     ASC     '$END OF JOB$/'
M8     ASC     '$UNEXPECTED NAME COMPARISON ERROR$/'
M9     ASC     '$INTERNAL? /'
M10    ASC     '$FOREIGN? /'
M11    ASC     '$MDSI? /'
M12    ASC     '$BAD COMPUTER NUMBER$/'
M13    ASC     '$BUILDING CIRCUIT TO MASTER PERP SYSTEM$/'
M14    ASC     '$1PERPRAY VERSION 2.9$/'
M15    ASC     '$HOUR DOWN: /'
M16    ASC     '$HOUR UP: /'
M17    ASC     'EXCEPTION: /'
M18    ASC     '$TIME ZONE: /'
M19    ASC     '$DELETE? /'
M20    ASC     'ENTER EXCEPTION DOWN TIME  MM/DD/YY HR:MIN : /'
M21    ASC     'ENTER EXCEPTION UP TIME  MM/DD/YY HR:MIN : /'
M22    ASC     'MUST BE OF FORM MM/DD/YY HR:MIN/'
M23    ASC     '$VALID TIME ZONES ARE:'
       ASC     '$PST           PACIFIC STANDARD TIME'
       ASC     '$CST           CENTRAL STANDARD TIME'
       ASC     '$EST           EASTERN STANDARD TIME'
       ASC     '$PDT           PACIFIC DAYLIGHT TIME'
       ASC     '$CDT           CENTRAL DAYLIGHT TIME'
       ASC     '$EDT           EASTERN DAYLIGHT TIME'
       ASC     '$PAR           PARIS STANDARD TIME'
       ASC     '$BST           BRITISH SUMMER TIME$/'
M24    ASC     ' DOES NOT HAVE SUCH A PERP JOB$/'
HELPM  ASC     '$VALID COMMANDS ARE:'
       ASC     '$HELP                  PRINTS THIS LIST'
       ASC     '$LIST USER             LIST PERP JOBS FOR A SPECIFIC USER AND COMPUTER'
       ASC     '$LIST SCHEDULE         LIST SCHEDULE FOR A SPECIFIC COMPUTER'
       ASC     '$LIST SCHEDULE ALL     LIST SCHEDULE FOR ALL COMPUTERS'
       ASC     '$LIST EXCEPTION        LIST ALL COMPUTERS WITH  EXCEPTION TIMES'
       ASC     '$CHANGE USER           CHANGE A PERP JOB FROM ONE SYSTEM TO ANOTHER'
       ASC     '$CHANGE SCHEDULE       CHANGE SCHEDULE FOR A COMPUTER'
       ASC     '$CHANGE EXCEPTION      CHANGE EXCEPTION TIME FOR A COMPUTER'
       ASC     '$QUIT                  RETURN TO THE EXECUTIVE$/'
CIN1   ZRO
CIN    ZRO
COUT   ZRO
FNP1   ASC     '(SSPERP)//PPLIST'
FNP    DATA    3*FNP1-1,3*FNP1+16
PTR    BSS     2
P      BSS     1
P1     BSS     1
NAME   BSS     4
MIN    BSS     1
DA     BSS     1
HR     BSS     1
MO     BSS     1
YR     BSS     1
TOCPNO BSS     1
PTR1   BSS     2
NAME1  BSS     4
ALLFLG BSS     1
FLG1   BSS     1
T1     ZRO
T2     ZRO     0
T3     ZRO     0
FLAG   DATA    0
CPNO   ZRO     0
CHAPOS ZRO
CHAFLG ZRO
DISCPN ZRO     0               DISTRICT NO/CPNO TO RUN JOB
BUF    EQU     20000B
LIST   BSS     100
TMWD   EQU     LIST
NXD    EQU     LIST+1
XCPU   EQU     LIST+2
DLIST  BSS     100
DLISTE BSS     0
       END
1PERPRAY ** FICH/FRAME BREAK *****
PERPRAY29 SYMSORT

SYM.  PG.LN. IDENT.

ALL1    8 18 29PERL  ALLFLG 43  4 29PERL  ARMESC 21 14 29PERL  
BADCPN 33 22 29PERL  BUF    43 14 29PERL  BUF2   39 37 29PERL  BUICPN 33 25 29PERL  
CCP    23 18 29PERL  CHAEX1  9 16 29PERL  CHAEX2  9 39 29PERL  CHAEX3 10  5 29PERL  
CHAEX4 10 11 29PERL  CHAEXC  9 13 29PERL  CHAFLG 43 12 29PERL  CHAN1  23 25 29PERL  
CHAN2  23 26 29PERL  CHANG0  4 26 29PERL  CHANG1  5 32 29PERL  CHANG2  5 24 29PERL  
CHANG3  4 24 29PERL  CHANGE  2 26 29PERL  CHAPOS 43 11 29PERL  CHASC1  6 18 29PERL  
CHASC2  6 28 29PERL  CHASC3  6 35 29PERL  CHASC4  7  8 29PERL  CHASCH  6 14 29PERL  
CIN    42 27 29PERL  CIN1   42 26 29PERL  CKCP1  18 34 29PERL  CKCPN  18 25 29PERL  
CKHR   17  3 29PERL  CLCR   29 38 29PERL  COUNT  23 23 29PERL  COUT   42 28 29PERL  
CPN    23 19 29PERL  CPNO   43 10 29PERL  CRP    28 38 29PERL  CT     28 37 29PERL  
DA     42 36 29PERL  DEBUG   1  2 29PERL  DISCPN 43 13 29PERL  DIST   39 17 29PERL  
DLIST  43 19 29PERL  DLISTE 43 20 29PERL  DST    15 37 29PERL  EDLIN  40 36 29PERL  
EDLIN1 41 10 29PERL  EDLIN2 40 38 29PERL  EDPT   41 12 29PERL  EDVER  40 31 29PERL  
ERR1    2 13 29PERL  ERROR   2 12 29PERL  ERV    40 11 29PERL  ERV1   40  9 29PERL  
ERV2   40 14 29PERL  ERV3   40 20 29PERL  ESC    21 24 29PERL  ESCPC  21 23 29PERL  
FIXHR  17 30 29PERL  FL     28 39 29PERL  FLAG   43  9 29PERL  FLG1   43  5 29PERL  
FNP    42 30 29PERL  FNP1   42 29 29PERL  FONO   39  5 29PERL  FOR    33 17 29PERL  
FORSW  23 29 29PERL  GE1    31 29 29PERL  GET1   30 27 29PERL  GET1L  31 12 29PERL  
GET1LA 31 22 29PERL  GETSCH 13 19 29PERL  GETTZ  15 38 29PERL  GETTZ1 16  8 29PERL  
GETTZ2 16 33 29PERL  GETTZ3 16 36 29PERL  GEXC   11  2 29PERL  GEXC1  12 27 29PERL  
GNCH   12 36 29PERL  GNCH1  13  9 29PERL  GNCHL  12 37 29PERL  GNCHL1 13  4 29PERL  
GPS    38  4 29PERL  GPS1   38  6 29PERL  GWD    20 38 29PERL  HELP    2 19 29PERL  
HELPM  42 16 29PERL  HR     42 37 29PERL  HRDN   13 17 29PERL  HRUP   13 18 29PERL  
IF     23 17 29PERL  INT    33  4 29PERL  INTSW  23 28 29PERL  IP     23 15 29PERL  
ISTR   23 13 29PERL  LALL    8  9 29PERL  LEN1   28  4 29PERL  LEN2   28 10 29PERL  
LEN2L  28 26 29PERL  LENM1  28 31 29PERL  LEX     8 29 29PERL  LEX1    8 36 29PERL  
LISS1  14 32 29PERL  LISSCH 14  1 29PERL  LIST   43 15 29PERL  LIST1   6  9 29PERL  
LISTIT  3  2 29PERL  LOG1   26 21 29PERL  LOG2   26 22 29PERL  LOG3   26 23 29PERL  
LOG4   26 24 29PERL  LOG5   26 25 29PERL  LOGS   26 20 29PERL  LOGST  23 12 29PERL  
LOWCP  18 11 29PERL  LOWTOP 18 13 29PERL  LSC     7 27 29PERL  LSC1    8  3 29PERL  
LSC2    7 33 29PERL  LSZ    29  1 29PERL  M1     41 23 29PERL  M10    41 32 29PERL  
M11    41 33 29PERL  M12    41 34 29PERL  M13    41 35 29PERL  M14    41 36 29PERL  
M15    41 37 29PERL  M16    41 38 29PERL  M17    41 39 29PERL  M18    42  1 29PERL  
M19    42  2 29PERL  M2     41 24 29PERL  M20    42  3 29PERL  M21    42  4 29PERL  
M22    42  5 29PERL  M23    42  6 29PERL  M24    42 15 29PERL  M3     41 25 29PERL  
M4     41 26 29PERL  M5     41 27 29PERL  M6     41 28 29PERL  M7     41 29 29PERL  
M8     41 30 29PERL  M9     41 31 29PERL  MAXBOT 18 14 29PERL  MAXCP  18 15 29PERL  
MDSI   33  9 29PERL  MDSISW 23 27 29PERL  MIN    42 35 29PERL  MO     42 38 29PERL  
MSG    29 32 29PERL  MSG1   29 24 29PERL  MVS1   30 15 29PERL  MVS2   30 22 29PERL  
MVSUB  30 13 29PERL  NAME   42 34 29PERL  NAME1  43  3 29PERL  NCP    23 21 29PERL  
NO     33 34 29PERL  NOMDSI 32 34 29PERL  NONAME 39 25 29PERL  NOOPEN 23 24 29PERL  
NOPASS 39 18 29PERL  NPOS   29  3 29PERL  NXD    43 17 29PERL  OF     23 16 29PERL  
OP     23 14 29PERL  OPCH   21 33 29PERL  OPCH1  22 38 29PERL  OPFER  40 17 29PERL  
OPNAM  39 35 29PERL  OPX    22  4 29PERL  P      42 32 29PERL  P1     42 33 29PERL  
PCH    29 16 29PERL  PDNO   29  5 29PERL  PEXC   19  5 29PERL  PEXC1  20 17 29PERL  
PPOS   29  2 29PERL  PTR    42 31 29PERL  PTR1   43  2 29PERL  PWD    29 10 29PERL  
QUIT    2 10 29PERL  RDFIL  33 36 29PERL  RDNAM1 34 30 29PERL  RDNAME 34  8 29PERL  
RDNO   30  5 29PERL  RDTO   35  7 29PERL  SF     39 33 29PERL  SFBUF  39 38 29PERL  
SFIL   40  8 29PERL  SFPTR  39 32 29PERL  SGPS   37 35 29PERL  SKNE    1  3 29PERL  
SLIST  31 36 29PERL  SLISTL 31 39 29PERL  SPACES 23 11 29PERL  SPTR    1  4 29PERL  
ST      1 20 29PERL  ST0     1 17 29PERL  START   1  5 29PERL  STASW  39 15 29PERL  
STATUS 39 16 29PERL  SUSNM  27 29 29PERL  SWD    20 23 29PERL  SYS10  33 14 29PERL  
SYS8   33  1 29PERL  SYSER  28 32 29PERL  T      23 20 29PERL  T1     43  6 29PERL  
T2     43  7 29PERL  T3     43  8 29PERL  TA1END 15 34 29PERL  TABLE  23 36 29PERL  
TCOUNT 23 22 29PERL  TERMWD 39 30 29PERL  TLV1   39 11 29PERL  TLV11  39 12 29PERL  
TMWD   43 16 29PERL  TOCPNO 43  1 29PERL  TOP940 18 12 29PERL  TZASC  15 36 29PERL  
TZEND  15 24 29PERL  TZSIZE 15 35 29PERL  TZTAB  15 15 29PERL  TZTAB1 15 25 29PERL  
UZ     28 36 29PERL  V1      3 15 29PERL  V1A     3 29 29PERL  V1B     3 26 29PERL  
V1C     3 19 29PERL  VER    35 22 29PERL  VER1   36 24 29PERL  VER1A  35 30 29PERL  
VER1B  36  8 29PERL  VER1B1 36 21 29PERL  VERRET 40 23 29PERL  VERSW  39 14 29PERL  
VM1    41 18 29PERL  VM2    41 19 29PERL  VME    41 14 29PERL  VME1   41 13 29PERL  
VME2   41 15 29PERL  VME3   41 16 29PERL  VME4   41 17 29PERL  VME5   41 20 29PERL  
VME6   41 21 29PERL  VPTR1  39 34 29PERL  VPTR2  39 36 29PERL  VT1    39 39 29PERL  
VT2    40  1 29PERL  VXT1   40  2 29PERL  VXT2   40  3 29PERL  VXT3   40  4 29PERL  
VXT4   40  5 29PERL  VXT5   40  6 29PERL  VXT8   40  7 29PERL  WD1    13 14 29PERL  
WD2    13 15 29PERL  WD3    13 16 29PERL  WHERE  32 12 29PERL  XCPU   43 18 29PERL  
XDOL   26 31 29PERL  XDOL1  27  9 29PERL  XDOL2  27 19 29PERL  XDOLR  27 36 29PERL  
XPOS   29  4 29PERL  YES    33 33 29PERL  YESNO  33 29 29PERL  YR     42 39 29PERL  

1PERPRAY ** FICH/FRAME BREAK *****
PERPRAYDOC



       VERSION 2.0 OF 1PERPRAY


       VERSION 2.0 HAS SEVERAL NEW COMMANDS IMPLEMENTED FOR INFORMING
1PERP OF COMPUTER SYSTEM SCHEDULES. EACH SCHEDULE COMMAND WILL ASK FOR
THE TIME ZONE. AN INVALID TIME ZONE OR HELP WILL GIVE A VALID LIST OF
TIME ZONES.

       THE CURRENT COMMANDS AVAILABLE IN 1PERPRAY ARE:

       COMMAND                 FUNCTION

       LIST USER               LIST PERPJOBS FOR A SPECIFIC USER
       CHANGE USER             MOVE A PERPJOB FROM ONE SYSTEM TO ANOTHER
       LIST SCHEDULE           LIST SCHEDULE FOR A SPECIFIC COMPUTER
       LIST SCHEDULE ALL       LIST SCHEDULE FOR ALL COMPUTERS
       LIST EXCEPTIONS         LIST ALL SCHEDULES WITH EXCEPTION TIMES
       CHANGE EXCEPTION        CHANGE EXCEPTION TIME FOR A COMPUTER
       CHANGE SCHEDULE         CHANGE REGULAR SCHEDULE FOR A COMPUTER
       QUIT                    RETURN TO EXEC
       HELP                    LIST VALID COMMANDS

ALL COMMANDS MAY BE ABREVIATED TO ONE CHARACTER FOR EACH WORD IN THE 
COMMAND (E.G. LIST SCHEDULE ALL MAY BE SHORTENED TO L S A).


       VERSION 1.0 OF 1PERPRAY


       1PERPRAY CURRENTLY ALLOWS TWO COMMANDS, ONE FOR LISTING ALL PERPJOBS
FOR A CUSTOMER ON A SPECIFIC MACHINE (LIST), AND THE OTHER FOR CHANGING
THE COMPUTER NUMBER THAT A PERP JOB RUNS ON (CHANGE).
       1PERPRAY MUST KNOW SPECIFIC INFORMATION ABOUT THE USER SO THAT
IT CAN DECIDE WHICH MASTER PERP SYSTEM TO BUILD A CIRCUIT TO. IT
THEREFORE ASKS THE FOLLOWING QUESTIONS AND NEEDS EITHER A YES OR A NO ANSWER.
       
       QUESTION                MEANING

       INTERNAL?               IS THIS A NON-BILLABLE USER?
       FOREIGN?                IS THIS USER IN A FOREIGN DISTRICT?
       MDSI?                   IS THIS AN MDSI USER? (ONLY ASKED IF A 940)

       THERE IS ALSO A HELP COMMAND AND A QUIT COMMAND.
1PERPRAY ** FICH/FRAME BREAK *****
MAKFDMPERPRAY29
FDM
CRUNCH PERPRAY29
MASTER FDMPERPRAY29

CRUNCH BUILDPERPRAY29
MASTER
CRUNCH MAKSYMPERPRAY29
MASTER
CRUNCH MAKFDMPERPRAY29
MASTER
CRUNCH CHECKPERPRAY29
MASTER
CRUNCH DIFFPERPRAY28/29/
MASTER
CRUNCH PERPRAYDOC
MASTER
CRUNCH 1PERPRAY
MASTER
CRUNCH DPERPRAY29
MASTER
CRUNCH BPERPRAY29
MASTER
Q
COM T

1PERPRAY ** FICH/FRAME BREAK *****
MAKSYMPERPRAY29
SYMSORT
PERPRAY29

SYMPERPRAY29

SPOOL
SPOOL
N
MIKE HINCKLEY
1PERPRAY
X7219
SM
1
HEAD,CEN
O
VIA VALLEY GREEN COURIER.

PERPRAY29,SYMPERPRAY29,MAKSYMPERPRAY29,MAKFDMPERPRAY29,BUILDPERPRAY29
QUIT
COM T
1PERPRAY ** FICH/FRAME BREAK *****
BUILDPERPRAY29
NARP
PERPRAY29
BPERPRAY29



RES
XDDT
;TBPERPRAY29
%FSAVE 3,7777 O 1PERPRAY-29

240
DUMP DPERPRAY29

TOUT CHECKPERPRAY29


DATE
"   CHECKSUMS FOR 1PERPRAY29:


"
CHECKSUM
.PERPRAY29
DPERPRAY29
1PERPRAY
BPERPRAY29
BUILDPERPRAY29
MAKSYMPERPRAY29
MAKFDMPERPRAY29
DIFFPERPRAY28/29/
PERPRAYDOC
.
TOUT T
COM T
1PERPRAY ** FICH/FRAME BREAK *****
DIFFPERPRAY28/29/
02/19/79  17:47
1)=PERPRAY28
2)=PERPRAY29

1) 26PERL IDENT   23 JAN 1979 MCH
1) DEBUG  EQU     -1              -1=> PROD 1=>DEBUG
****1
2) 29PERL IDENT   19 FEB 1979 MCH
2) DEBUG  EQU     -1              -1=> PROD 1=>DEBUG
********1
1) TOP940 DATA    21              HIGHEST NUMBERED 940
1) LOWTOP DATA    39              HIGHEST VALID COMP. NUMBER IN THE LOW RANGE
1) MAXBOT DATA    70              LOWEST VALID COMP. NUMBER-1 IN THE HIGH RANGE
1) MAXCP  DATA    99              HIGHEST VALID COMPUTER NUMBER
1) 
****675
2) TOP940 DATA    22              HIGHEST NUMBERED 940+1
2) LOWTOP DATA    39              HIGHEST VALID COMP. NUMBER IN THE LOW RANGE
2) MAXBOT DATA    69              LOWEST VALID COMP. NUMBER-1 IN THE HIGH RANGE
2) MAXCP  DATA    99              HIGHEST VALID COMPUTER NUMBER
2) 
********675
1)        DATA    8               15
1)        DATA    10              16
****909
2)        DATA    10              15
2)        DATA    10              16
********909
1)        DATA    10              90
1)        DATA    0               91
****984
2)        DATA    8               90
2)        DATA    0               91
********984
1)        SKL     TOP940+1        SKIP IF CPNO IS A 940
1)        BRU     NOMDSI          DON'T ASK IF USER IS MDSI
****1236
2)        SKL     TOP940          SKIP IF CPNO IS A 940
2)        BRU     NOMDSI          DON'T ASK IF USER IS MDSI
********1236
1) M14    ASC     '$1PERPRAY VERSION 2.8$/'
1) M15    ASC     '$HOUR DOWN: /'
****1596
2) M14    ASC     '$1PERPRAY VERSION 2.9$/'
2) M15    ASC     '$HOUR DOWN: /'
********1596
    ( _
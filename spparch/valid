VALID ** FICHE/FRAME BREAK *****
SPJC7
SPJC7  IDENT   2-9-76

NDATA  EQU     9

       BRU BEGIN; BRS 10
       ASC '7.00'; ASC 'VEV AND GBB'

MSG    POPD 100B5,2
       EAX* 0; CXA; ETR =37777B; LDB =-1; LDX TOUT; BRS 34; BRR 0
SECSW  ZRO
BEGIN  STP CIN; BRS 39; SKA =2B6; BRU BEGIN1; MSG ERR5; BRS 10
BEGIN1 LDA =10B; LDB =BUF; LDX =1; BRS 67; LDX =1; BRS 141
       SKE =-1; HLT
RESET  CLA
       STA ERFLG; STA SECSW
GLTCH  LDA =155B; CIO TOUT; LDA =32B; CIO TOUT
GLTCH1 CIO CIN
       SKG =77B  IF CR ONLY, PRINT COLON AGAIN
       BRU *+2
       BRU GLTCH1
       LRSH 8
       CIO CIN
       SKG =77B
       BRU *+2
       BRU CHK  1 CHAR. SEE IF IT IS Q OR ?
       LRSH 8
       CIO CIN
       SKG =77B
       BRU *+2
       BRU ERR  2 CHARS
       LRSH 8
       CIO CIN
       SKG =77B
       BRU *-2
       LDX =CTBL-CTBLND
       CBA  MOVE COMMAND INTO 'A' REGISTER
       SKE CTBLND,2  SEARCH FOR COMMAND
       BRX *-1
       BRU* BTBLND,2  FALL THRU BRX MEANS COMMAND NOT FOUND
CHK    CLA
       LSH 8
       SKE =61B  (Q)
       BRU *+2
       BRS 10  QUIT
       SKE =37B  (QUESTION MARK)
       BRU ERR  NOT Q OR ?
       BRU HEL
ERR    LDA ERFLG
       SKE =0
       BRU ERR1A
       MIN ERFLG
       MSG ERMSG  PRINT ? AND CR
       BRU GLTCH
ERR1A   MSG ERMSG1
       BRU RESET
CTBL   ASC 'PACSNIREVAHCERCIUQLEHIDELAV'
CTBLND DATA 0,CAP,INS,VER,CHA,CRE,QUI,HEL,EDI,VAL
BTBLND DATA ERR
CAP    MSG MSG1
       BRU RESET
INS    MSG MSG2
       BRU RESET
VER    MSG MSG3
       BRU RESET
CHA    MSG MSG4
       BRU RESET
CRE    MSG MSG5
       BRU RESET
QUI    BRS 10
HEL    MSG MSG6
       BRU RESET
EDI    BRU START
VAL    BRU S2
ERMSG  ASC '$ ?$/'
ERMSG1 ASC '$FOR ASSISTANCE, TYPE  HELP.$/'
MSG1   ASC '$CAPABILITIES:'
       ASC '$$THE EDIT OPTION ALLOWS AN ACCOUNT SUPERVISOR TO CREATE'
       ASC '$A BINARY FILE CONTAINING VALID PROJECT CODES FROM A SYMBOLIC'
       ASC '$FILE HE HAS PREPARED.  THE VALIDATE OPTION ALLOWS AN '
       ASC '$ACCOUNT SUPERVISOR TO SET CONTROLS WHICH WILL REQUIRE'
       ASC '$USERS IN HIS ACCOUNT TO USE ONE OF THE VALID PROJECT CODES'
       ASC '$WHEN LOGGING INTO THE SYSTEM$/'
MSG2   ASC '$INSTRUCTIONS:'
       ASC '$$EDIT OPTION:'
       ASC '$$THE ACCOUNT SUPERVISOR MUST PREPARE A SYMBOLIC FILE CON-'
       ASC '$TAINING THE CURRENTLY VALID PROJECT CODES.  PROJECT CODES MAY'
       ASC '$BE ANY LENGTH; HOWEVER, ONLY THE FIRST TWELVE CHARACTERS'
       ASC '$WILL BE COMPARED.  PROJECT CODES MAY CONTAIN ANY CHARACTER'
       ASC '$IN THE ASCII SET EXCEPT A CARRIAGE RETURN OR A SEMICOLON;'
       ASC '$HOWEVER, THEY MAY NOT BEGIN WITH AN ASTERISK OR A DASH.'
       ASC '$A COMMENT MAY BE PLACED IN THE SYMBOLIC FILE BY BEGINNING'
       ASC '$THE LINE WITH AN ASTERISK.  THE COMMENT IS ASSUMED TO END'
       ASC '$WITH THE NEXT CARRIAGE RETURN.  PROJECT CODE STRINGS MUST END'
       ASC '$WITH EITHER A SEMICOLON OR A CARRIAGE RETURN.'
       ASC '$$THE PROGRAM WILL REQUEST THE NAME OF THE SYMBOLIC FILE'
       ASC '$AND WILL CREATE A BINARY, WORD ORIENTED, FILE.  THIS FILE'
       ASC '$WILL REPLACE THE FIRST FILE IN HIS FILE DIRECTORY, PLACING'
       ASC '$THE LATTER FILE AT THE END OF THE DIRECTORY.  THE FILE'
       ASC '$WILL BE NAMED WITH A RANDOM STRING OF PRINTING CHARACTERS'
       ASC '$OF THE SAME LENGTH AS THE REPLACED FILE.  IF THIS FILE IS'
       ASC '$DELETED NO PROJECT CODE VALIDATION WILL TAKE PLACE.  THE'
       ASC '$PROGRAM WILL PRINT AN END OF JOB MESSAGE AND RETURN TO THE'
       ASC '$COMMAND DISPATCHER.'
       ASC '$$VALIDATE OPTION:'
       ASC '$$THE PROGRAM WILL ASK THE QUESTION:'
       ASC '$$FORCE VALIDATION? (Y OR N)'
       ASC '$$A YES ANSWER WILL PLACE CONTROLS IN THE SYSTEM, FOR EACH'
       ASC '$USER ENTERED, WHICH WILL FORCE HIM TO USE ONE OF THE'
       ASC '$PROJECT CODES CONTAINED IN THE FILE DESCRIBED ABOVE.'
       ASC '$$A NO ANSWER WILL REMOVE THE CONTROLS FROM EACH USER ENTERED.'
       ASC '$$THE PROGRAM WILL THEN REQUEST THE USER NAMES, AND CONTINUE'
       ASC '$TO TAKE THEM UNTIL A CONTROL D IS ENCOUNTERED, AT WHICH TIME'
       ASC '$IT WILL TYPE AN END OF JOB MESSAGE AND RETURN TO THE COMMAND'
       ASC '$DISPATCHER.  IF A USER NAME IS BEGUN WITH A PERIOD, IT WILL'
       ASC '$BE ASSUMED BY THE PROGRAM THAT THE FOLLOWING CHARACTERS UP'
       ASC '$TO THE NEXT CARRIAGE RETURN WILL BE THE NAME OF A FILE THAT'
       ASC '$CONTAINS USER NAMES.  WHEN THE END OF THIS FILE IS REACHED,'
       ASC '$THE PROGRAM WILL REVERT TO TAKING NAMES FROM THE TELETYPE.'
       ASC '$$IN THE CASE OF AN INVALID NAME, THE PROGRAM WILL TYPE'
       ASC '$"INVALID NAME" AND THE INVALID NAME STRING.$/'
MSG3   ASC '$VERSION S6    JANUARY 1975$/'
MSG4   ASC '$NO PREMIUM CHARGE$/'
MSG5   ASC '$WRITTEN BY TYMSHARE$/'
MSG6   ASC '$$LEGAL COMMANDS:'
       ASC '$$     EDIT           BEGINS EXECUTION OF THE EDIT OPTION'
       ASC '$     VALIDATE       BEGINS EXECUTION OF THE VALIDATE OPTION'
       ASC '$     CAPABILITIES   DESCRIBES PROGRAM CAPABILITIES'
       ASC '$     INSTRUCTIONS   HOW TO EXECUTE THE PROGRAM'
       ASC '$     CREDITS        THOSE RESPONSIBLE FOR THIS PROGRAM'
       ASC '$     CHARGES        ADDITIONAL COST (IF ANY)'
       ASC '$     VERSION        LATEST UPDATE'
       ASC '$     QUIT  (OR) Q   QUITS TO EXEC'
       ASC '$     HELP  (OR) ?   REPRINTS THIS LIST'
       ASC '$$     ANY OF THESE COMMANDS MAY BE SHORTENED TO THE'
       ASC '$     FIRST THREE LETTERS$/'
ERFLG  BSS 1



START  BRM     OPIF
       BRM     OPOF
S1     BRM     GPJC
       BRU     S1A
       BRM     WPJC
       BRU     S1
S1A    BRM OPOF
S1B    BRM GPJC
       BRU EJ
       BRM WPJC
       BRU S1B

S2     BRM GLUDL (GET ACCT. NO. AND LUDL)
       MSG M1
       CIO CIN; SKE =155B; BRU *+2; BRU *-3
       STA T1; CIO CIN; SKE =155B; BRU *-2
       LDA T1; SKE ='   Y'; BRU NV
S3     MSG M2
S2A    BRM     GUNM            GET USER NAME
       BRU     EJ              NO MORE
       BRM     STLUD           SET LUD ENTRY
       BRU     S2A
NV     SKE ='   N'; BRU S2; CLA; STA LUDL; BRU S3

GLUDL  ZRO; LDA =31; LDB =ANO; LDX =3; BRS 67; BRR GLUDL

*GETS NEXT USER NAME FROM TELETYPE OR FILE
GUNM   ZRO
GN     CIO IF; SKN IF; BRU GN1; CLA; XMA IF; BRS 20; BRU GN
GN1    SKE ='   D'+100B; BRU *+2; BRR GUNM (NO MORE)
       SKE ='   .'; BRU GN2
       LDA IF; BRS 62; BRU GNE1
       XMA IF; BRS 20; BRU GN
GN2    SKE =155B; BRU *+2; BRU GN
       STA T1; CLAB; STP PJ; STP PJ+2; LDA NP; STA PJP; STA PJP+1
       LDA T1; LDX =-13; BRU *+2
GN3    CIO IF; SKE =155B; BRU GN4
       MIN GUNM; BRR GUNM (END OF USER NAME
GN4    WCI PJP; BRX GN3
       MSG ERR1; LDP PJP; LDX TOUT; BRS 35
       TCO =155B; BRU GN
GNE1   MSG ERR2; BRU GN

*SETS LUDL INTO LUD FOR SPECIFIED USER
STLUD  ZRO; LDX =PJ; BRM REN; BRU STLER
       LDA 6,2; ETR =1777777B; SKE ANO; BRU STLER (NOT SAME ACCT.)
       LDA 5,2; ETR =@177777B; MRG LUDL; STA 5,2; BRM WBLK; BRR STLUD
STLER  MSG ERR3; LDP PJP; LDX TOUT
       BRS 35; TCO =155B; BRR STLUD
*FINDS HASH LOC - EXPECTS PTR TO NAME IN X
FHASH  ZRO; LDA 0,2; ADD 1,2; ADD 2,2; ADD 3,2; LRSH 23
       DIV =887; STB HLOC; BRR FHASH


*FINDS ENTRY IN LUD - GIVEN LOCATION OF NAME IN X
REN    ZRO; STX P1; BRM FHASH
REN1   BRM RBLK; LDB P1
REN2   STX LOC; LDA 0,2; SKG =0; BRU REN3
       SKE* P1; BRU REN4
       LDA 1,2; XXB; SKE 1,2; BRU REN5
       LDA 2,2; XXB; SKE 2,2; BRU REN4
       LDA 3,2; XXB; SKE 3,2; BRU REN5
       XXB; MIN REN; BRR REN (FOUND MATCH)
REN5   XXB (RESTORE INDEX TO ORIGINAL REG.)
REN4   EAX NDATA,2; BRU REN2
REN3   SKE =0; BRU *+3; LDX =5; BRR REN (ERROR EXIT, NO FIND)
       SKE =-1; BRU *+3; MIN HLOC; BRU REN1
       SKE =-2; HLT; BRU REN4

RBLK   ZRO; LDA HLOC; LRSH 23; DIV =128 (NO. ENTRIES PER DISC)
       STB T1; CLB; LSH 13; ADD T1; ADD =320200B (FIRST DISC. ADR)
       CAB; STB DISC; LDA =BUF; LDX =64; BRS 124; LDX =BUF; BRR RBLK

WBLK   ZRO; LDB DISC; LDA =BUF; LDX =64; BRS 125; BRR WBLK

OPIF   ZRO; MSG M3
       CLA; BRS 62D; BRU OPIF+1; STA IF; BRR OPIF

OPOF   ZRO; SKN SECSW; BRU *+2; BRU OP4
       LDP ONP; LDX =1; BRS 68; BRU NFL
       STA FLX; STB ONP1; LDA ONP; STP TP
       BRS 42; STB T1; EOR T1; STA T1
       GCI TP; HLT; BRM GCH; WCI NNP; BRM GCH; WCI NNP
       BRM GCH; WCI NNP; GCI TP; BRU OP2
       GCI TP; BRU OP2
OP1    GCI TP; BRU OP2; BRM GCH; WCI NNP; BRU OP1
OP2    LDP ONP; BRS 48; HLT; STA FLX
       LDX FLX; LDP NNP; BRS 37 (CHANGE NAME); HLT
       LDP NNP; BRS 64; BRU OPER
       CBX; STA INFIL; LDP ONP; BRS 65; BRU OPER
       STA OUTFIL; RSP INFIL; STA C1
CC     LDA =4000B; LDX =30000B; BIO INFIL; NOP
       LDB =2B5; SKB INFIL; BRU CD
       LDA =4000B; LDX =30000B; BIO OUTFIL; NOP; BRU CC
CD     SUB =30000B; LDX =30000B; SKE =0; BIO OUTFIL; NOP
       RSP OUTFIL; XMA C1; MRG =4B7; SCP OUTFIL; NOP
       LDA C1; PCE OUTFIL; NOP
       LDA INFIL; BRS 20; LDA OUTFIL; BRS 20
OP3    RSP IF; LRSH 4; MUL =5; LSH 23; MRG =1; STA HDIV
       LSH 2; ADD =40; STA NWORDS
OP4    LDP NNP; LDX =2
       BRS 65; HLT; STA OF; CLA
OP5    SKR NWORDS; BRU *+2; BRR OPOF; WIO OF; BRU OP5

NFL    LDP NMSP; STP NNP; BRU OP3

OPER   MSG ERR4; BRS 10
EJ     MSG EOJ; BRU RESET
GCH    ZRO; LDA T1; SKG =0; BRS 42
       LRSH 23; DIV =26; STA T1; CBA; ADD =41B; BRR GCH

GPJC   ZRO; LDA NP; STA PJP; STA PJP+1; CLAB; STP PJ; STP PJ+2
GP     CIO IF; SKN IF; BRU *+2; BRU GP4  (END OF FILE)
       SKE ='   *'; BRU GP1
GP2    CIO IF; SKE =155B; BRU *-2; BRU GP
GP1    SKE ='   -'; BRU *+2; BRU GP2
       SKE =155B; BRU *+2; BRU GP
       LDX =-12
GP3    WCI PJP; CIO IF; SKE =155B; BRX GP3
       MIN GPJC; BRR GPJC
GP4    SKN SECSW; BRU *+2; BRR GPJC (END PASS TWO)
       SKR SECSW; BRU *-1; RSP OF; CLB; LRSH 4; MUL =5; LSH 23
       MRG =1; STA HDIV; LSH 2; ADD =40; STA NWORDS
       LDA OF; BRS 20; CLA; SCP IF; HLT 0; BRR GPJC

WPJC   ZRO; LDA PJ; RSH 2; ADD PJ+1; LSH 1; ADD PJ+2; LSH 1; ADD PJ+3
       MUL =6065B; DIV =37777761B; CLA
       DIV HDIV; CBA; STA HASHL; MUL =12; LSH 23
       STA CPOS; SCP OF; NOP
WP     WIO OF; SKE =0; BRU WP1 (NOT EMPTY SLOT)
       LDA CPOS; MRG =4B7; SCP OF; NOP
       LDA PJ; WIO OF; LDA PJ+1; WIO OF
       LDA PJ+2; WIO OF; LDA PJ+3; WIO OF
       RCP OF; ETR =@4B7; STA CURSOR; RSP OF; SKE CURSOR; BRR WPJC
       CLA; WIO OF; WIO OF; WIO OF; WIO OF
       BRR WPJC
WP1    LDA =12; ADM CPOS; WIO OF; WIO OF; WIO OF; BRU WP

NMS    DATA    3600007B,1600017B
NMSP   DATA 3*NMS-1,3*NMS-1+6
PJ     BSS     4
NP     DATA    3*PJ-1
PJP    BSS     2
CPOS   ZRO
OBF    BSS     20
ONP    DATA    3*OBF-1
ONP1   DATA    3*OBF-1
NBF    BSS     20
NNP    DATA    3*NBF-1,3*NBF-1
T1     ZRO
C1     ZRO
FLX    ZRO
TP     BSS     2
IF     ZRO
OF     ZRO
INFIL  ZRO
OUTFIL ZRO
HASHL  ZRO
HDIV   ZRO
NWORDS ZRO
DISC   ZRO
ANO    ZRO
MLUDL  ZRO
LUDL   ZRO
LOC    ZRO
HLOC   ZRO
BUF    BSS     64
P1     ZRO

CIN    ZRO
TOUT   DATA 1
M1     ASC '$FORCE VALIDATION? (Y OR N) /'
M2     ASC '$FOR USERS: /'
M3     ASC '$PROJECT CODE FILE: /'
ERR1   ASC '$BAD NAME: /'
ERR2   ASC '$UNABLE LOCATE A FILE BY THAT NAME$/'
ERR3   ASC '$INVALID NAME: /'
ERR4   ASC '$FILE OPENING ERROR$/'
ERR5   ASC '$PROGRAM USABLE BY ACCOUNT SUPERVISORS ONLY$/'
EOJ    ASC '$END OF JOB/'
CURSOR ZRO
       END
VALID ** FICHE/FRAME BREAK *****
SPJC7 SYMSORT

SYM.  PG.LN. IDENT.

ANO     8 28 SPJC7   BEGIN   1 11 SPJC7   BEGIN1  1 12 SPJC7   
BTBLND  2 19 SPJC7   BUF     8 33 SPJC7   C1      8 17 SPJC7   CAP     2 20 SPJC7   
CC      6 36 SPJC7   CD      6 39 SPJC7   CHA     2 26 SPJC7   CHK     2  1 SPJC7   
CIN     8 36 SPJC7   CPOS    8 10 SPJC7   CRE     2 28 SPJC7   CTBL    2 17 SPJC7   
CTBLND  2 18 SPJC7   CURSOR  9  8 SPJC7   DISC    8 27 SPJC7   EDI     2 33 SPJC7   
EJ      7 13 SPJC7   EOJ     9  7 SPJC7   ERFLG   4 19 SPJC7   ERMSG   2 35 SPJC7   
ERMSG1  2 36 SPJC7   ERR     2  9 SPJC7   ERR1    9  2 SPJC7   ERR1A   2 15 SPJC7   
ERR2    9  3 SPJC7   ERR3    9  4 SPJC7   ERR4    9  5 SPJC7   ERR5    9  6 SPJC7   
FHASH   5 34 SPJC7   FLX     8 18 SPJC7   GCH     7 14 SPJC7   GLTCH   1 16 SPJC7   
GLTCH1  1 17 SPJC7   GLUDL   5  8 SPJC7   GN      5 12 SPJC7   GN1     5 13 SPJC7   
GN2     5 17 SPJC7   GN3     5 20 SPJC7   GN4     5 22 SPJC7   GNE1    5 25 SPJC7   
GP      7 18 SPJC7   GP1     7 21 SPJC7   GP2     7 20 SPJC7   GP3     7 24 SPJC7   
GP4     7 26 SPJC7   GPJC    7 17 SPJC7   GUNM    5 11 SPJC7   HASHL   8 24 SPJC7   
HDIV    8 25 SPJC7   HEL     2 31 SPJC7   HLOC    8 32 SPJC7   IF      8 20 SPJC7   
INFIL   8 22 SPJC7   INS     2 22 SPJC7   LOC     8 31 SPJC7   LUDL    8 30 SPJC7   
M1      8 38 SPJC7   M2      8 39 SPJC7   M3      9  1 SPJC7   MLUDL   8 29 SPJC7   
MSG     1  8 SPJC7   MSG1    2 37 SPJC7   MSG2    3  5 SPJC7   MSG3    4  4 SPJC7   
MSG4    4  5 SPJC7   MSG5    4  6 SPJC7   MSG6    4  7 SPJC7   NBF     8 14 SPJC7   
NDATA   1  3 SPJC7   NFL     7 10 SPJC7   NMS     8  5 SPJC7   NMSP    8  6 SPJC7   
NNP     8 15 SPJC7   NP      8  8 SPJC7   NV      5  6 SPJC7   NWORDS  8 26 SPJC7   
OBF     8 11 SPJC7   OF      8 21 SPJC7   ONP     8 12 SPJC7   ONP1    8 13 SPJC7   
OP1     6 30 SPJC7   OP2     6 31 SPJC7   OP3     7  4 SPJC7   OP4     7  6 SPJC7   
OP5     7  8 SPJC7   OPER    7 12 SPJC7   OPIF    6 20 SPJC7   OPOF    6 23 SPJC7   
OUTFIL  8 23 SPJC7   P1      8 34 SPJC7   PJ      8  7 SPJC7   PJP     8  9 SPJC7   
QUI     2 30 SPJC7   RBLK    6 14 SPJC7   REN     5 39 SPJC7   REN1    6  1 SPJC7   
REN2    6  2 SPJC7   REN3    6 10 SPJC7   REN4    6  9 SPJC7   REN5    6  8 SPJC7   
RESET   1 14 SPJC7   S1      4 25 SPJC7   S1A     4 29 SPJC7   S1B     4 30 SPJC7   
S2      4 35 SPJC7   S2A     5  2 SPJC7   S3      5  1 SPJC7   SECSW   1 10 SPJC7   
START   4 23 SPJC7   STLER   5 31 SPJC7   STLUD   5 28 SPJC7   T1      8 16 SPJC7   
TOUT    8 37 SPJC7   TP      8 19 SPJC7   VAL     2 34 SPJC7   VER     2 24 SPJC7   
WBLK    6 18 SPJC7   WP      7 35 SPJC7   WP1     8  3 SPJC7   WPJC    7 31 SPJC7   

VALID ** FICHE/FRAME BREAK *****
MAKEVALID7
NARP
SPJC7
BSPJC7


RES
XDDT
;TBSPJC7
;U%F
SAVE 3 T 3777 ON GVALID

240
"

        VALID   VERSION 7

"
CHECKSUM
.
(SS940UTIL)SPJC7-SYMBOLICS
(SS940UTIL)GVALID-GO-FILE
(SS940UTIL)MAKEVALID7-BUILD-FILE
.
"

"
COM TEL
   
TR ** FICHE/FRAME BREAK *****
TRSZKTR1701
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,NET,NOUT,JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      COMMON FACTOR,NDIODE,A,V,Y,P,C,T,NFORM,CODE,X,IDIODE,ITR8,LAST,V1,V2,JTR8,CURI,VOLI
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99),CURI(20),VOLI(20)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),YOLD(20)
C
      DIMENSION NPLIST(40)
      DIMENSION NET(99),P(99),Y(40,41),X(20,2)
      DIMENSION IDIODE(20),A(40),C(40),V(40)
C      CONTROL PROGRAM FOR TRANSIENT ANALYSIS
C
C
C      THE GENERAL IDEA OF THIS PROGRAM IS ,
C      THE CONTROL PROGRAM (CODED) ASSIGNS ALL VALUES TO THE
C      ARRAYS CONNECTED WITH THE PARAMETERS I.E PNOM PMIN,NI,IREF
C      ETC. AND SETS UP THE FLAGS ITYPE (TYPE OF ANALYSIS)
C      IHEAD (HEADINGS)   AND WORST CASE FLAGS ISET (SETTINGS)
C      LOHI( LOW OR/AND HIGH WORST CASE REQUIRED) AND FILLS
C      THE ARRAYS NODELIST (NODET OF THEM) , AND LISTPAR
C      (NPAR OF THEM) WHICH CONTAIN THE LIST OF TESTNODES AND
C      EITHER THE LIST OF ALL VARYING PARAMETERS OR SOME SUBSET
C      OF SAME. ALSO PASSES CONSTANTS SUCH AS THE NUMBER OF
C      NODES (NODES) AND THE NUMBER OF PARAMETERS (LIMBS)
C
C      THIS SUBPROGRAM ASSIGNS VALUES TO THE ARRAY P(LIMBS)
C      WHICH IN TURN IS PASSED TO CONTRL WHICH RETURNS WITH THE
C      ARRAY V(NODES) WHICH CONTAINS THE VOLTAGES OF ALL NODES
C      ASSUMING THE PARAMETER  VALUES P.
C
C
C
      CALL LDDONE
      CALL DCLESC(ESC)
      ASSIGN 900 TO ESC
        CALL ARM
      CALL SETESC
      IF(KFLAG)6998,6999,6999
6998  TYPE 77777
77777 FORMAT(/$K-TR=17.01  6-17-70$)
      GO TO 950
6999  CALL NETSET
      LAST=NODES+1
      NOUT=0
      FACTOR=1.
      CODE=6HJPSTR
C
      IF(TS) 1,6,6
C
C      DUMP FOR LATER RESTART
C
1      IF(T) 2,2,4
2     TYPE 3
3     FORMAT($** OPTION NOT APPLICABLE UNTIL AFTER ANALYSIS **$/)
      GO TO 5
4     CALL AOPEN(3,NAME,6HBINOUT)
      WRITE BINARY 3,CODE,LIMBS,NODES,(NPLIST(I),I=1,NODES)
      WRITE BINARY 3,TF
      WRITE BINARY 3,(V(I),I=1,NODES),(A(I),I=1,NODES),(P(I),I=1,LIMBS)
5      CONTINUE
      CALL ARM
      CALL TERMOV
C
C     RESTART  
C
6     IF(IREST)8,50,8
C
C
8     ON END FILE NOTHERE ,XI
      ASSIGN 25 TO NOTHERE
       CALL AOPEN (4,JAME,6HBININP)
      READ BINARY 4,ACODE,LIMBS,NODES,(NPLIST(I),I=1,NODES)
9     READ BINARY 4,TS
      READ BINARY 4,(V(I),I=1,NODES),(A(I),I=1,NODES),(P(I),I=1,LIMBS)
      IF(IREST) 10,50,7
7     IF(TS-TR+TR*.0001) 9,10,10
10    CONTINUE
      GO TO 100
25    TYPE 26
26    FORMAT($** INFO. FOR THIS TIME/RESTART IS NOT ON FILE **$/)
      GO TO 5
C
C
C       ORDINARY STARTING POINT
C
C
50    DO 51 I=1,LIMBS
51    P(I)=PNOM(I)
      JTR8=0
C
       DO 52 I=1,NODES
       A(I)=0.
52    V(I)=0.
      T=TS-DT/2.
      GO TO 99
100   T=TS
      JTR8=1
C
99    IF(ISAVE) 102,102,101
101   CONTINUE
      WRITE BINARY 5,CODE,LIMBS,NODES,(NPLIST(I),I=1,NODES)
102    CONTINUE
C
C
C      2 IS THE NORMAL OUTPUT FILE
C      5 IS THE SAVE FILE (BINARY)
C      ITEL MAY HAVE BEEN SET TO 1 THEREFORE BOTH  FILE AND TELETYPE
C      ARE REQUIRED FOR OUTPUT.
C
1040   IF(NODET-4) 1060,1060,107
1060   NFORM=1
      GO TO 110
107   NFORM=2
108    GO TO(150,200),IHEAD
110   WRITE 2,111
      IF(ITEL) 112,112,113
113   TYPE 111
111   FORMAT(////$VOLTAGES FOR:$//)
112   DO 114 I=1,NODET
      WRITE 2,115, NODELIST(I)
115   FORMAT($   NODE $,I3,2X)
      IF(ITEL) 114,114,116
116   TYPE 115,NODELIST(I)
114   CONTINUE
C
      WRITE 2,117
117   FORMAT($     TIME$/)
       IF(ITEL) 118,118,119
119   TYPE 117
118   DO 120 I=1,NODET+1
      WRITE 2,121
121   FORMAT($   --------  $)
      IF(ITEL) 120,120,122
122   TYPE 121
120   CONTINUE
      WRITE 2,123
123   FORMAT(/)
      IF(ITEL) 200,200,125
125   TYPE 123
      GO TO 200
C
C
150   WRITE 2,8102
      IF(ITEL) 200,200,152
152   TYPE 8102
C
C
200   CALL CONTRL
C
C
      NOUT=NOUT+1
      GOTO(300,400),NFORM
C
C
300   DO 301 I=1,NODET
      CALL SYMB(NIMI,NTMT,NT,NI,NODELIST(I),NEQU)
      WRITE 2,302,V(NEQU)
302   FORMAT(1X,1PE11.4,1X)
      IF(ITEL) 301,301,303
303   TYPE 302,V(NEQU)
301   CONTINUE
C
      WRITE 2,302,T
      IF(ITEL) 304,304,305
305   TYPE 302,T
      TYPE 123
304   WRITE 2,123
      GO TO 500
C
C
C
400   WRITE 2,106,T
106   FORMAT(///$(TIME = $1PE10.4$)$)
      IF(ITEL) 103,103,109
109   TYPE 106,T
103   DO 104 I=1,NODET
      CALL SYMB(NIMI,NTMT,NT,NI,NODELIST(I),NEQU)
      WRITE 2, 8104,NODELIST(I),V(NEQU)
      IF(ITEL) 104,104,105
105   TYPE 8104,NODELIST(I),V(NEQU)
104   CONTINUE
C
C
C
500   IF(ISAVE) 600,600,501
501   WRITE BINARY 5,T
      WRITE BINARY 5,(V(I),I=1,NODES),(A(I),I=1,NODES),(P(I),I=1,LIMBS)
C
600   IF(TF-T-DT*.25) 950,950,200
C
C
900    CALL ARM
      IF(ISAVE) 950,950,901
901   WRITE BINARY 5,T
      WRITE BINARY 5,(V(I),I=1,NODES),(A(I),I=1,NODES),(P(I),I=1,LIMBS)
      TYPE 902,T
902   FORMAT(//$YOU MAY RESTART FROM TIME = $1PE10.4////)
C
C
C
950   CALL ARM
       CLOSE(4)
      CALL TERMOV
C
C
C
C
C
8102  FORMAT(////$NODE   VOLTAGE$/$---- $,11($-$)/)
8104  FORMAT(/I3,2X,1PE11.4)
C
C
      END
      SUBROUTINE CONTRL
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,NET,NOUT,JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      COMMON FACTOR,NDIODE,A,V,Y,P,C,T,NFORM,CODE,X,IDIODE,ITR8,LAST,V1,V2,JTR8,CURI,VOLI
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99),CURI(20),VOLI(20)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),YOLD(20)
C
      DIMENSION NPLIST(40)
      DIMENSION NET(99),P(99),Y(40,41),X(20,2)
      DIMENSION IDIODE(20),A(40),C(40),V(40)
      DIMENSION ZIT(40)
C
       IFL=1
C
      ITR8=0
C
C
4      CALL ESCOFF
      DO 5 I=1,NODES
      ZIT(I)=0.0
5      C(I)=A(I)
      DO 7 I=1,20
      DO 7 J=1,2
7     X(I,J)=0.0
8     T=T+DT/2.
      ITR8=0
10    CALL MTRXTR
      CALL SOLVE
      IF(SENSE SWITCH 1) 991,992
991   DO 993 I=1,NODES
993   WRITE 2,994,I,Y(I,LAST)
994   FORMAT(/$V($,I2,$)= $,1PE13.6)
992   CONTINUE
C
      DO 35I=1,NODES
35    V(I)=Y(I,LAST)
C
      IF(NDIODE) 71,800,71
71    DO 100 I=1,NODES
      IF(V(I)-ZIT(I)) 80,100,80
80    IF(V(I)) 85,100,85
85    V1=V(I)*1000000.0
      V2=ZIT(I)*1000000.0
      IF(ABS(V1-V2)-ABS(V(I))) 100,100,120
100   CONTINUE
102    DO 101 I=1,NDIODE
       DJF=(ABS(X(I,1)-X(I,2))*10.-ABS(X(I,1)))
       IF(DJF) 101,101,120
101    CONTINUE
      IF(ITR8-3)120,800,800
C
C
120   DO 130 I=1,NODES
130   ZIT(I)=V(I)
       DO 131 I=1,NDIODE
131    X(I,2)=X(I,1)
      GO TO 10
C
800    IF(T*IFL)801,801,122
122    IFL=0
       GO TO 4
801    CALL ESCON
      IF(TS+NOUT*TO-T-DT*0.25) 900,900,4
C
900    IF(T-TS-DT/2.)901,4,901
901   RETURN
      END
      SUBROUTINE SOLVE
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,NET,NOUT,JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      COMMON FACTOR,NDIODE,A,V,Y,P,C,T,NFORM,CODE,X,IDIODE,ITR8,LAST,V1,V2,JTR8,CURI,VOLI
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99),CURI(20),VOLI(20)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),YOLD(20)
C
      DIMENSION NPLIST(40)
      DIMENSION NET(99),P(99),Y(40,41),X(20,2)
      DIMENSION IDIODE(20),A(40),C(40),V(40)
C     GAUSS-JORDAN METHOD WITH PIVOTAL CONDENSATION AND ELEMENT CHECK. 
      L=LAST
      I=1
1     IF(NODES - I) 14, 2, 2
2     J=I 
      R=Y(J, J)
      S=R
20    D=ABS(S) 
      M=I  
11    I=I + 1  
      IF(I - NODES) 15, 15, 18
18    IF(M - J) 18, 19, 16
16    K=LAST
17    R=Y(M, K)  
      Y(M, K)=Y(J, K)  
      Y(J, K)=R
      K=K - 1  
52    IF(K - J) 3, 17, 17  
19    IF(R) 3, 12, 3 
3     I=J + 1  
4     D=Y(J, L) 
      IF(D) 23, 24, 23  
23    Y(J, L)=D/R 
24    L=L - 1  
      IF(L - I) 5, 4, 4 
5     L=1 
6     IF(L - J)7,10,7
7     R=Y(L, J) 
53    IF(R) 8, 10, 8 
8     K=J 
9     K=K + 1
      D= Y(J, K)  
      IF(D) 21, 22, 21  
21    Y(L, K)=Y(L, K) - D*R
22    IF(K - NODES) 9, 9, 10  
10    L=L + 1  
      IF(L - NODES) 6, 6, 1
12    ASSIGN 9960 TO V1
      CALL SYMB(NI,NT,NTMT,NIMI,J,NEQU)
      CALL ERROR(J)
C
C
9960  FORMAT($CHECK PARAMETERS AT NODE,$,I3/)
C
14    RETURN
15    S=Y(I, J)
      IF(ABS(S) - D) 11, 11, 20  
      END
      SUBROUTINE ERROR(KERROR)
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,NET,NOUT,JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      COMMON FACTOR,NDIODE,A,V,Y,P,C,T,NFORM,CODE,X,IDIODE,ITR8,LAST,V1,V2,JTR8,CURI,VOLI
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99),CURI(20),VOLI(20)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),YOLD(20)
C
      DIMENSION NPLIST(40)
      DIMENSION NET(99),P(99),Y(40,41),X(20,2)
      DIMENSION IDIODE(20),A(40),C(40),V(40)
      TYPE 10
10    FORMAT(/$*** ERROR *** , $)
      TYPE V1,KERROR
C
C     AND NOW GO TO CODED DO NOT PASS DCMAIN DO NOT COLLECT ANY MORE
C      CPU TIME.
C
      CALL TERMOV
C
C
C
      END
      SUBROUTINE MTRXTR
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,NET,NOUT,JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      COMMON FACTOR,NDIODE,A,V,Y,P,C,T,NFORM,CODE,X,IDIODE,ITR8,LAST,V1,V2,JTR8,CURI,VOLI
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99),CURI(20),VOLI(20)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),YOLD(20)
C
      DIMENSION NPLIST(40)
      DIMENSION NET(99),P(99),Y(40,41),X(20,2)
      DIMENSION IDIODE(20),A(40),C(40),V(40),P1(49),P2(49)
C
C
C
       IF(T-DT/4)2,3,3
2      DO 4 I=1,49
       P2(I)=0.
4      P1(I)=0.
3     DO 5 I=1,NODES
      DO 5 J=1,LAST
5      Y(I,J)=0.0
      NDIODE=0
      NVS=0
C
       NVC=0
       NIC=0
       I1=T*(1.+1.E-6)/DT
       I2=10*I1
7      I3=10.*T*(1.+1.E-6)/DT
       FX=I1+1
       IF(I3-I2)9,8,9
8      FX=I1
C      IF FIRST TIME THRU THEN SKIP THE DIODE LOOP
C
C
9     IF(ITR8) 6,6,2001
C
C
2001  DO 400  K=1,LIMBS
      IF(KIND(K)-15) 400,201,400
C
C      THERMAL VOLTAGE LINE NUMBER=K
C
201   NDIODE=NDIODE+1
      IDIODE(NDIODE)=K
      XY=X(NDIODE,1)
      IF(NI(K)*NT(K)) 210,220,210
C
210   J=NT(K)
      I=NI(K)
      D=V(I)-V(J)
      GO TO 250
C
220   J=0
      I=NI(K)+NT(K)
      IF(NI(K))225,225,230
C
225   D=-V(I)
      GO TO 250
C
230   D=V(I)
C
250   IF(D) 251,2500,252
2500  X(NDIODE,1)=P(K-1)/P(K)
      GO TO 254
C
251   V3=D
      C3=P(K-1)*(EXP(V3/P(K))-1)
      X(NDIODE,1)=C3/D
252   CURRENT=XY*D
      IF(D) 253,253,2521
2521    V3=P(K)*(ALOG(CURRENT/P(K-1)+1))
      C3=CURRENT
      X(NDIODE,1)=CURRENT/V3
253   I8=ITR8/(NDIT+1)
      IF((NDIT+1)*I8-ITR8) 2542,2543,2542
2542  CURI(NDIODE)=CURRENT
      VOLI(NDIODE)=D
      GO TO 254
2543  KTR8=1
       DENC=CURRENT-CURI(NDIODE)
       DEND=ABS(DENC/CURRENT)
       IF(DEND-1E-10)254,254,2560
2560  E=(CURRENT*VOLI(NDIODE)-CURI(NDIODE)*D)/DENC
      RL=-(D-VOLI(NDIODE))/DENC
      IF(RL) 2532,2532,2546
2532   IF(D)2533,254,254
2533  V4=D
      GO TO 2557
2546  KTR8=KTR8+1
      IF(SENSE SWITCH 4) 22222,33333
22222 TYPE 33222,KTR8,CURRENT,V3,X(NDIODE,1),E,RL,EX,C2,V4,VDIF
33222 FORMAT(/I3,5(2X,1PE10.4)/6(1PE10.4,2X)/)
33333 CONTINUE
      IF(D) 2548,2548,2547
2547  FUDGE=-V3/P(K)
      IF(FUDGE-175) 2553,2553,2554
2554  FUDGE=175
2553  EX=P(K)*EXP(FUDGE)
      C2=(E-V3+P(K)-EX)/(RL+EX/P(K-1))
       FUDGE=C2/P(K-1)+1
       IF(FUDGE)2601,2601,2602
2601   FUDGE=1E-25
2602   V4=P(K)*ALOG(FUDGE)
      GO TO 2549
2548  FUDGE=V3/P(K)
      IF(FUDGE-175) 2555,2555,2556
2556  FUDGE=175
2555  EX=P(K-1)*EXP(FUDGE)
      V4=(E/RL+P(K-1)+EX*(V3/P(K)-1))/(EX/P(K)+1./RL)
2557  FUDGE=V4/P(K)
      IF(FUDGE-175)2550,2550,2552
2552  FUDGE=175
2550  C2=P(K-1)*(EXP(FUDGE)-1)
      VDIF=ABS(C3-C2)*1E6-ABS(C2)
      GO TO 2540
2549  VDIF=ABS(V4-V3)*1E6-ABS(V4)
2540  IF(VDIF) 2544,2544,2545
2545  V3=V4
      C3=C2
      IF(RL) 2544,2544,2551
2551  IF(KTR8-100) 2546,2544,2544
2544  X(NDIODE,1)=C2/V4
2534   IF(SENSE SWITCH 1)2531,254
2531   TYPE 2541, CURRENT,V3
2541   FORMAT(2E21.12/)
254   R=X(NDIODE,1)
       YOLD(NDIODE)=R
C
C
C
C
C
      IF(SENSE SWITCH 3) 359,361
359   TYPE 360 ,R,ITR8
360   FORMAT(/1PE13.6,I5/)
C
361   Y(I,I)=Y(I,I)+R
      IF(J) 351,400,351
351   Y(J,J)=Y(J,J)+R
      Y(I,J)=Y(I,J)-R
      Y(J,I)=Y(J,I)-R
C
C
400   CONTINUE
C
C
6     DO 200 K=1,LIMBS
      KERROR=K
10    D=P(K)
      IF(NI(K)*NT(K)) 15,12,15
12    I=NI(K)+NT(K)
      J=0
      GO TO 20
15    I=NI(K)
      J=NT(K)
20    GO TO(25,30,200,200,50,621,621,621,40,200,199,199,199,199, 21),KIND(K)
C
C      COUNT NO. OF DIODES
C
21    D=P(K-1)/P(K)
C
C      IF FIRST ITERATION , LET INITIAL GUESS BE D IE  IS/VT
C
      IF(ITR8)200,22,200
22    NDIODE=NDIODE+1
       X(NDIODE,1)=D
      GO TO 30
C
C      RESISTANCE AND CONDUCTANCE
C
25    IF(KXXX(K))200,2558,2558
2558  D=1.0/D
30    Y(I,I)=Y(I,I)+D
      IF(J) 32,200,32
32    Y(J,J)=Y(J,J)+D
      Y(I,J)=Y(I,J)-D
      Y(J,I)=Y(J,I)-D
      GO TO 200
C
C      INDUCTANCE
C
40     IF(ITR8) 47,43,47
43     NIC=NIC+1
       DL=P2(NIC)
       P2(NIC)=P(K)
       DX1=0.
       D1=0.
       DX=0.
       FL=1
       IF(J)401,449,401
401    D1=V(J)
449    IF(T-DT/4.)49,42,42
49     IF(NI(K))451,44,451
44     FL=-1
       GO TO 451
42     DX=((V(I)-D1)/P(K-1))*DT
       DX1=DX/2
       IF(T+.25*DT-FX*DT)451,452,452
452    D=DX+DL
       GO TO 46
451    D=(DX1+P(K))*FL
46     P(K)=D
47     Y(I,LAST)=Y(I,LAST)-P(K)
       IF(J) 41,200,41
41     Y(J,LAST)=Y(J,LAST)+P(K)
       GO TO 200
C
C
C      SWITCHES
C
C
50    IF(JTR8) 51,51,54
51     IF(PMIN(K)) 52,52,53
52    D=PNOM(K+1)
      GO TO 2558
53    D=PMAX(K)
      GO TO 2558
54    LL=IREF(K)
      IF(NI(LL)*NT(LL)) 58,55,58
55    IF(NI(LL)) 57,56,57
56    IF(-V(NT(LL))-P(K)) 52,53,53
57    IF(V(NI(LL))-P(K))52,53,53
58    IF(V(NI(LL))-V(NT(LL))-P(K)) 52,53,53
C
C
C
C
C
C      CONSTANT CURRENT SOURCE
C
621   IF(KXXX(K)-1) 60,60,622
622   IF(T-PMIN(K)) 632,623,623
C
C ----------------------------------------
C
C      WAVE FORMS
C
C      AMPLITUDE IN PNOM(K)
C      START TIME IN PMIN(K)
C      PERIOD IN PMAX(K)
C      PULSE WIDTH IN PNOM(K+1)
C
C
C      KXXX=5 COS
C          =2 SIN
C          =3 SQUARE
C          =4 SAW
C
C          =0 OR 1 ZERO START TIME STEP
C          =-1 NEXT ONE FOR CONTINUATION
C
C-----------------------------------------
C
C
623   GO TO (60,625,626,626,624),KXXX(K)
624   D=PNOM(K)*COS(6.2831853/PMAX(K)*(T-PMIN(K)))
      GO TO 60
625   D=PNOM(K)*SIN(6.2831853/PMAX(K)*(T-PMIN(K)))
      GO TO 60
626    LMNOP=0
627   LMNOP=LMNOP+1
      XTX=PMIN(K)+PMAX(K)*(LMNOP-1)
      IF(T-XTX-PNOM(K+1)) 628,628,627
628   IF(T-XTX) 632,629,629
629   IF(KXXX(K)-3) 630,630,631
630   D=PNOM(K)
      GO TO 60
631   D=(T-XTX)/PNOM(K+1)*PNOM(K)
      GO TO 60
632   D=0.0
C
C
C
60    P(K)=D
      IF((KIND(K)-7)*(KIND(K)-8)) 601,70,601
601   IF(NI(K)) 61,64,61
61    Y(I,LAST)=Y(I,LAST)-D
62    IF(NT(K)) 63,200,63
63    Y(J,LAST)=Y(J,LAST)+D
      GO TO 200
64    Y(I,LAST)=Y(I,LAST)+D
      GO TO 200
C
C      DEPENDENT CURRENT SOURCES
C      -------------------------
C
70    L=K
71    M=0
      IF(KIND(L)-8)75,76,76
75    GO TO(81,82,802,802,802,97,100,100,802,110,802,802,802,802,802),KIND(IREF(L))
76    GO TO(83,83,802,83,802,83,83,83,83,83,83,83,83,83,83),KIND(IREF(L))
C
C      RESISTANCE AND CONDUCTANCE (ET AL FOR VOLTAGE DEPENDENCY)
C
81    D=-D/P(IREF(L))
      GO TO 84
82    D=-D*P(IREF(L))
      GO TO 84
83    D=-D
84    L=IREF(L)
      IF(J) 8811,8810,8811
8811  D=-D
      GO TO 8888
8810  IF(NT(K))8888,8811,8888
C
8888  IF(NI(K)) 85,90,85
85    IF(NI(L)) 86,87,86
86    Y(I,NI(L))=Y(I,NI(L))+D
87    IF(NT(L)) 88,90,88
88    Y(I,NT(L))=Y(I,NT(L))-D
90    IF(NT(K)) 91,200,91
91    IF(M-1) 92,200,200
92    M=1
      IF(J) 93,85,93
93    D=-D
      I=J
      GO TO 85
C
C      CONSTANT CURRENT SOURCE (CURRENT DEPENDENCY ONLY)
C
97    L=IREF(L)
      D=-D*P(L)
      GO TO 60
C
C      OTHER DEPENDENT CURRENT SOURCES (CURRENT DEPENDENCY ONLY)
C
100   L=IREF(L)
      D=D*P(L)
      GO TO 71
C
C
C    DEPENDENT ON DIODE SATURATION CURRENT.
C
C
C      FIND WHICH DIODE FROM IDIODE
C
110   IF(ITR8) 115,115,120
C
C      INITIAL GUESS
CC
115   D=-D*(P(IREF(L))/P(IREF(IREF(L))))
      GO TO 160
120   DO 150 KL=1,NDIODE
      IF(IREF(L)+1-IDIODE(KL)) 150,130,150
130   D=-D*X(KL,1)
160   MI=NI(IREF(K))
      MT=NT(IREF(K))
      IF(NI(K))169,168,169
168   D=-D
169   D=-D
1691  IF(MI*I) 161,162,161
161   Y(I,MI)=Y(I,MI)+D
      IF(MT)162,163,162
162   Y(I,MT)=Y(I,MT)-D
163   IF(J) 164,200,164
164   IF(MI) 165,166,165
165   Y(J,MI)=Y(J,MI)-D
166   IF(MT) 167,200,167
167   Y(J,MT)=Y(J,MT)+D
      GO TO 200
150   CONTINUE
199   NVS=NVS+1
200   CONTINUE
       NDIT=NDIODE
C
       DO =1,NODES
499    A(I)=Y(I,LAST)
C
C
C
C
C        SECOND PASS ======= VOLTAGE SOURCES
C      ========================================
C
C
C
C
501    IF(NDIODE-20)1501,1501,803
1501  IF(NVS) 900,900,502
C
C
C
502   DO 800 N=1,NVS
      KK=NET(N)
      K=ABS(KK)
      IF(KIND(K)-14) 5000,5021,5000
5000  IF(KXXX(K)-1) 5021,5021,5622
5622  IF(T-PMIN(K)) 5632,5623,5623
5623  GO TO(5021,5625,5626,5626,5624),KXXX(K)
5624  P(K)=PNOM(K)*COS(6.2831853/PMAX(K)*(T-PMIN(K)))
      GO TO 5021
5625  P(K)=PNOM(K)*SIN(6.2831853/PMAX(K)*(T-PMIN(K)))
      GO TO 5021
5626  LMNOP=0
5627  LMNOP=LMNOP+1
      XTX=PMIN(K)+PMAX(K)*(LMNOP-1)
      IF(T-XTX-PNOM(K+1)) 5628,5628,5627
5628  IF(T-XTX) 5632,5629,5629
5629  IF(KXXX(K)-3) 5630,5630,5631
5630  P(K)=PNOM(K)
      GO TO 5021
5631  P(K)=(T-XTX)/PNOM(K+1)*PNOM(K)
      GO TO 5021
5632  P(K)=0.0
C
5021  KERROR=K
      IF(KK) 510,505,505
C
C     VOLTAGE SOURCES
C
505   J=NI(K)
      I=NT(K)
      IF(KIND(K)-14) 5001,5002,5001
5001  IF(NI(K)) 5003,5002,5003
5003  D=-P(K)
      GO TO 520
5002  D=P(K)
      GO TO 520
510   D=P(K)
      IF(NI(K)*NT(K)) 511,512,511
511   I=NI(K)
      J=NT(K)
      GO TO 520
512   I=NI(K)+NT(K)
      J=0
520   IF(KIND(K)-14) 521,544,800
521   IF(J) 522,526,522
522   DO 524 L=1,LAST
524   Y(J,L)=Y(J,L)+Y(I,L)
526   DO 528 L=1,LAST
528   Y(I,L)=0.0
      Y(I,I)=1.0
C
C
532   IF(J) 534,536,534
534   Y(I,J)=-1.0
536   GO TO(800,800,800,800,800,800,800,800,800,800,538,570,570,538,800),KIND(K)
538   IF(J)540,541,540
540   D=-D

      GO TO 542
541   IF(NI(K)) 540,542,540
542   Y(I,LAST)=D
      GO TO 800
C
C      CAPACITANCE
C
544    DX=0
       IF(ITR8)550,545,550
545    DX=C(I)
       NVC=NVC+1
       D1=P1(NVC)
       P1(NVC)=P(K)
      DO 546 L=1,NODES
       ADUM2=Y(I,L)
5445   XDIOD=0
       DO 5444 K1=1,LIMBS
       IF (KIND(K1)-15)5444,5441,5444
5441   XDIOD=XDIOD+1
       IF((NI(K1)-I)*(NT(K1)-I)+(NI(K1)-L)*(NT(K1)-L))5444,5442,5444
5442   DUM=1
       IF(I-L)5446,5447,5446
5446   DUM=-1
5447   ADUM2=ADUM2+DUM*(YOLD(XDIOD)-X(XDIOD,1))
5444  CONTINUE
546   DX=DX-V(L)*ADUM2
5462   FLG=1
       FLH=1
       IF(T-DT/4.)553,5463,5463
553    IF (KK) 550,550,554
554    D=-D
       GO TO 549
5463   IF((NI(K)*KK))548,547,543
543    FLH=-1
       GO TO 547
548    FLG=-1
547    D=D+FLG*(DT*DX/(2.*P(K-1)))*FLH
       D1=D1+FLG*(DT*DX/P(K-1))*FLH
       IF(T+.25*DT-FX*DT)549,552,552
552    D=D1
549    P(K)=D
550    IF(SENSE SWITCH 1)551,521
551    WRITE 2,555,D
555    FORMAT($V(CAP) = $,E21.12/)
      GO TO 521
C
C
C
C      DEPENDENT VOLTAGE SOURCES
C
C
570   L=K
      IF(NI(K)) 573,572,573
572   D=-D
573   M=0
571   IF(KIND(L)-13) 575,576,575
575   GO TO(581,582,802,802,802,597,610,610,802,802,802,802,802,802,802),KIND(IREF(L))
576   GO TO(584,584,802,584,802,583,583,583,583,583,583,583,583,583,583),KIND(IREF(L))
C
C
C      RESISTANCE AND CONDUCTANCE (ET AL FOR VOLTAGE DEPENDENCY)
C
581   D=-D/P(IREF(L))
      GO TO 583
582   D=-D*P(IREF(L))
583   D=-D
584   L=IREF(L)
585   IF(NI(L)) 586,587,586
586   Y(I,NI(L))=Y(I,NI(L))+D
587   IF(NT(L)) 588,800,588
588   Y(I,NT(L))=Y(I,NT(L))-D
      GO TO 800
C
C      CONSTANT CURRENT SOURCE (CURRENT DEPENDENCY ONLY)
C
597   L=IREF(L)
      D=D*P(L)
598   Y(I,LAST)=Y(I,LAST)+D
      IF(J) 800,800,600
600   Y(J,LAST)=Y(J,LAST)-D
      GO TO 800
C
C      DEPENDENT CURRENT SOURCES  (CURRENT DEPENDENCY ONLY)
C
610   L=IREF(L)
      D=D*P(L)
      GO TO 571
C
C
C
800   CONTINUE
C
C
      GO TO 900
C
C
C
C
C
C
C
802   ASSIGN 9930 TO V1
      CALL ERROR(KERROR)
803    KERROR=NDIODE
       ASSIGN 9940 TO V1
       CALL ERROR(KERROR)
C
C
900   ITR8=ITR8+1
      JTR8=JTR8+1
C
      KJ8=JTR8/5
      IF(JTR8-KJ8*5) 911,912,911
912    KJ8= 6684672
      TYPE 913 , KJ8
913   FORMAT(A1)
C
911   IF(ITR8-400) 999,901,901
901   TYPE 9990
       CALL TERMOV
C
999   IF(SENSE SWITCH 2) 991,992
991   DO 993 I=1,NODES
      DO 993 J=1,LAST
993   WRITE 2,994,I,J,Y(I,J)
994   FORMAT(/$Y($,I2,$,$,I2,$)= $,1PE13.6)
992   CONTINUE
C
C
C
C
C
     RETURN
C
C
9930  FORMAT($DEPENDENCY ON PROHIBITED PARAMETER...NO.$,I3/)
9990  FORMAT(/$ CIRCUIT NONCONVERGING , CALL TYMSHARE REPRESENTATIVE$)
9940   FORMAT(I2,$ DIODES , LIMIT = 20$/)
C
C
      END
      SUBROUTINE NETSET
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,NET,NOUT,JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      COMMON FACTOR,NDIODE,A,V,Y,P,C,T,NFORM,CODE,X,IDIODE,ITR8,LAST,V1,V2,JTR8,CURI,VOLI
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      EQUIVALENCE(P(2),INODE(1)),(P(52),NOW(1)),(Y(1),NZIP(1))
      DIMENSION NOW(99),NZIP(99),INODE(99)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99),CURI(20),VOLI(20)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),YOLD(20)
C
      DIMENSION NPLIST(40)
      DIMENSION NET(99),P(99),Y(40,41),X(20,2)
      DIMENSION IDIODE(20),A(40),C(40),V(40)
C
C
      NVS=0
      DO 5 I=1,LIMBS
      GO TO (4,4,5000,4,4,4,4,4,4,4,3,3,3,3,4),KIND(I)
5000  IF(I-LIMBS) 5001,5,5
5001  DO 5002 J=I+1,LIMBS
      IF(KIND(J)-3) 5002,5003,5002
5003  IF(NI(I)) 5103,5004,5103
5103  IF((NI(I)-NI(J))*(NI(I)-NT(J))) 5004,5100,5004
5100  KERROR=NIMI(I)
      GO TO 5200
5004  IF(NT(I)) 5104,5002,5104
5104  IF((NT(I)-NI(J))*(NT(I)-NT(J))) 5002,5005,5002
5005  KERROR=NTMT(I)
5200  ASSIGN 9920 TO V1
      CALL ERROR(KERROR)
5002  CONTINUE
      GO TO 5
3     NVS=NVS+1
      NOW(NVS)=I
4     INODE(I)=0
5     NZIP(I)=1
C
C
      KVS=NVS
C
C
      DO 100 I=1,NVS
      IVS=NOW(I)
      IF(NI(IVS)*NT(IVS)) 100,10,100
10    NET(KVS)=-IVS
      KVS=KVS-1
      NZIP(IVS)=0
      INODE(IVS)=NI(IVS)+NT(IVS)
      CALL CONNECT(IVS,INODE,NI,NT,KVS,NVS,NET,NZIP,I,V1,NOW)
100   CONTINUE
C
C
C
101   DO 200 I=1,NVS
      IVS=NOW(I)
      IF(NZIP(IVS)) 110,200,200
110   CALL CONNECT(IVS,INODE,NI,NT,KVS,NVS,NET,NZIP,I,V1,NOW)
      NZIP(IVS)=0
200   CONTINUE
C
C
      DO 250 I=1,LIMBS
      IF(NZIP(I)) 101,250,250
250   CONTINUE
C
C
C
      DO 300 I=1,NVS
      NTEND=0
      NIEND=0
      IVS=NOW(I)
      IF(NZIP(IVS)) 300,300,260
260   DO 270 J=1,NVS
      IF(I-J) 261,270,261
261   JVS=NOW(J)
      IF(NI(IVS)-NI(JVS)) 262,263,262
262   IF(NI(IVS)-NT(JVS)) 264,263,264
263   NIEND=1
      GO TO 270
264   IF(NT(IVS)-NI(JVS)) 265,266,265
265   IF(NT(IVS)-NT(JVS)) 270,266,270
266   NTEND=1
270   CONTINUE
      IF(NTEND+NIEND-1) 274,275,300
274   NZIP(IVS)=0
      NET(KVS)=-IVS
      KVS=KVS-1
      GO TO 300
275   NZIP(IVS)=-1
      NET(KVS)=-IVS
      KVS=KVS-1
      IF(NIEND) 277,277,276
276   INODE(IVS)=NI(IVS)
      GO TO 101
277   INODE(IVS)=NT(IVS)
      GO TO 101
300   CONTINUE
C
9920  FORMAT($TWO OR MORE CAPACITORS TO SAME NODE.. NO.$,I3/)
C
C
      RETURN
C
C
C
      END
      SUBROUTINE CONNECT(IVS,INODE,NI,NT,KVS,NVS,NET,NZIP,I,V1,NOW)
      DIMENSION NI(99),NT(99),INODE(99),NET(99),NZIP(99),NOW(99)
C
C
      DO 50 J=1,NVS
      IF(I-J) 15,50,15
15    JVS=NOW(J)
      IF(INODE(IVS)-NI(JVS)) 20,16,20
16    NET(KVS)=JVS
      KVS=KVS-1
      INODE(JVS)=NT(JVS)
      GO TO 25
20    IF(INODE(IVS)-NT(JVS)) 50,21,50
21    NET(KVS)=-JVS
      KVS=KVS-1
      INODE(JVS)=NI(JVS)
25    IF(NZIP(JVS)) 28,28,26
26    NZIP(JVS)=-1
      GO TO 50
28    ASSIGN 9950 TO V1
      CALL SYMB(NI,NT,NTMT,NIMI,INODE(IVS),NEQU)
      CALL ERROR (INODE(IVS))
50    CONTINUE
C
9950  FORMAT($VOLTAGE SOURCE LOOP AT NODE,$,I3/)
C
      RETURN
      END
      SUBROUTINE SYMB(I,L,M,J,NODE,LL)
      DIMENSION I(99),J(99),L(99),M(99)
      DO 100 K=1,99
      KK=K
      IF(I(K)-NODE) 99,101,99
99    IF(L(K)-NODE) 100,102,100
100   CONTINUE
101   LL=J(KK)
      GO TO 900
102   LL=M(KK)
900   RETURN
      END
TR ** FICHE/FRAME BREAK *****
TRSZKTR1701 SYMSORT

SYM.  PG.LN. IDENT.

1       7  4         10     21 11         10     11 33         10      8 20         
10      7 36         10      5 32         10      2 26         100    23 11         
100    21 16         100     6  9         100     3  1         101    23 12         
101     6 13         101     3  4         102    23 14         102     6 10         
102     3  6         103     4 25         104     4 30         105     4 29         
106     4 22         1060    3 12         107     3 14         108     3 15         
109     4 24         11      7 10         110    21 20         110     3 16         
111     3 19         112     3 20         113     3 18         114     3 25         
115     3 22         116     3 24         117     3 27         118     3 30         
119     3 29         12     11 35         12      7 38         120    15 24         
120     3 35         121     3 32         122     6 21         122     3 34         
123     3 37         125     3 39         130    15 26         130     6 16         
131     6 18         15     22 24         15     11 38         15      8  4         
150    16  3         1501   16 12         152     4  4         16     22 26         
16      7 13         160    15 27         161    15 33         162    15 35         
163    15 36         164    15 37         165    15 38         166    15 39         
167    16  1         168    15 30         169    15 31         1691   15 32         
17      7 14         18      7 12         19      7 19         199    16  4         
2       8 39         2       7  5         2       2  6         20     22 30         
20     12  1         20      7  8         200    21 22         200    16  5         
21     22 31         21      7 34         22     12  6         22      7 35         
22222  10 24         23      7 23         24      7 24         25     22 34         
25      2 28         250    21 25         2500    9 36         252    10  2         
2521   10  4         253    10  7         2531   11 18         2532   10 19         
2533   10 20         2534   11 17         254    11 20         2540   11 11         
2541   11 19         2542   10  9         2543   10 12         2544   11 16         
2545   11 12         2546   10 22         2547   10 28         2548   10 38         
2549   11 10         2550   11  7         2551   11 15         2552   11  6         
2553   10 31         2554   10 30         2555   11  2         2556   11  1         
2557   11  4         2558   12 11         2560   10 16         26     22 35         
26      2 29         260    21 31         2601   10 35         2602   10 36         
261    21 33         262    21 35         263    21 36         264    21 38         
265    21 39         266    22  1         270    22  2         274    22  4         
275    22  8         276    22 12         277    22 14         28     22 37         
3      21  3         3       9  3         3       7 20         3       2  7         
30     12 12         300    22 16         301     4 14         302     4 11         
303     4 13         304     4 19         305     4 17         32     12 14         
33222  10 25         33333  10 26         35      6  1         351    11 27         
359    11 23         360    11 24         4      21  5         4       9  2         
4       7 21         4       2  9         401    12 28         41     13  3         
42     12 33         43     12 20         44     12 31         449    12 29         
451    12 38         452    12 36         46     12 39         47     13  1         
49     12 30         499    16  8         5      21  6         5       9  5         
5       7 26         5       5 26         5       2 13         50     23  1         
5000   20 28         5000   16 17         5001   20 29         5001   17  2         
5002   21  1         5002   17  5         5003   20 31         5003   17  3         
5004   20 35         5005   20 37         501     4 32         51     13  7         
51      2 33         510    17  7         5100   20 33         5103   20 32         
5104   20 36         511    17  9         512    17 12         52     13  8         
52      7 18         52      2 37         520    17 14         5200   20 38         
521    17 15         522    17 16         524    17 17         526    17 18         
528    17 19         53     13 10         53      7 29         534    17 22         
536    17 23         538    17 24         54     13 12         540    17 25         
541    17 28         542    17 29         543    18 19         5441   18  4         
5442   18  6         5444   18 10         5445   18  1         5446   18  8         
5447   18  9         545    17 34         546    18 11         5462   18 12         
5463   18 18         547    18 22         548    18 21         549    18 26         
55     13 14         550    18 27         551    18 28         552    18 25         
553    18 15         554    18 16         555    18 29         56     13 15         
5622   16 18         5623   16 19         5624   16 20         5625   16 22         
5626   16 24         5627   16 25         5628   16 28         5629   16 29         
5630   16 30         5631   16 32         5632   16 34         57     13 16         
571    18 36         572    18 34         573    18 35         575    18 37         
576    18 38         58     13 17         582    19  3         583    19  4         
584    19  5         585    19  6         586    19  7         587    19  8         
588    19  9         598    19 14         6       7 27         600    19 16         
601    14 12         61     14 13         62     14 14         622    13 20         
624    13 34         625    13 36         626    13 38         627    13 39         
628    14  3         629    14  4         63     14 15         630    14  5         
631    14  7         632    14  9         64     14 17         6998    1 34         
6999    1 37         7       9 12         7       7 28         7       5 29         
7       2 25         71     14 22         71      6  3         75     14 24         
76     14 25         77777   1 35         8       9 15         8       7 30         
8       5 30         80      6  5         801     6 23         803    19 26         
8104    5  6         82     14 29         83     14 31         84     14 32         
85     14 38         85      6  6         86     14 39         87     15  1         
88     15  2         8810   14 36         8811   14 34         9       7 31         
9       2 22         90     15  3         900    23 15         901    19 37         
901     6 26         901     4 37         902     5  1         91     15  4         
912    19 33         913    19 35         92     15  5         93     15  7         
99     23 10         991    20  1         991     5 35         992    20  5         
992     5 38         993    20  3         993     5 36         994    20  4         
994     5 37         9940   20  9         9990   20  8         
C      16 10         C      14 20         C      13 32         C      13 30         
C      13 29         C      13 28         C      13 26         C      13 25         
C      13 24         C       9 16         C       8 23         C       7  1         
C       3 10         C       3  9         C       3  8         C       1 27         
C       1 26         C       1 25         C       1 23         C       1 22         
C       1 21         C       1 20         C       1 19         C       1 18         
C       1 17         C       1 16         C       1 15         C       1 14         
C       1 12         CCM115 15 22         CM     23  3         CM     20 22         
CM     19 31         CM     16  7         CM     12  5         CM      9  8         
CM      8 35         CM      8 24         CM      8 16         CM      6 37         
CM      6  2         CM      5 39         CM      5 22         CM      5 21         
CM      5 17         CM      4 15         CM      3 26         CM      2 35         
CM      2  3         CM      1  9         CM1     2  5         CM100  15 15         
CM1040  3 11         CM110  15 20         CM14    8  3         CM201   9 21         
CM21   12  3         CM210   9 25         CM220   9 29         CM225   9 32         
CM230   9 34         CM25   12 10         CM250   9 35         CM251   9 38         
CM361  11 25         CM40   12 19         CM5021 16 35         CM505  16 38         
CM544  17 32         CM581  19  1         CM597  19 12         CM6     2 17         
CM600   4 34         CM610  19 19         CM621  13 19         CM70   14 21         
CM800   6 20         CM81   14 27         CM8888 14 37         CM900   6 25         
CM911  19 36         CM97   15 11         CM99    3  3         CM9920 22 17         
CM9950 23  2         CM999  19 39         CMC    19 18         CMC    19 11         
CMC    17 31         CMC    16 37         CMC    15 21         CMC    15 14         
CMC    15 10         CMC    14 26         CMC    14 19         CMC    13 31         
CMC    13 23         CMC    13 22         CMC    13 21         CMC    12 18         
CMC    12  9         CMC    12  4         CMC    12  2         CMC     9 20         
CMC     8 22         CMC     2 16         CMC     2  4         CMC     1 24         
CMCM   22 22         CMCM   22 18         CMCM   21 23         CMCM   21  8         
CMCM   21  7         CMCM   20 25         CMCM   20 10         CMCM   19 23         
CMCM    5  7         CMCM    4  6         CMCM12  6 15         CMCM15  4  2         
CMCM20  9 18         CMCM20  4  5         CMCM30  4  8         CMCM4   5 23         
CMCM40 11 30         CMCM50 13  6         CMCM50  2 32         CMCM53 17 21         
CMCM57 18 32         CMCM6  11 31         CMCM8   2 18         CMCM9   9 17         
CMCM90 19 29         CMCM90  4 35         CMCM99 20  7         CMCM99  8  2         
CMCMC  18 39         CMCMC  15 19         CMCMC  15 18         CMCMC  13 27         
CMCMC  13  5         CMCMC   3  7         CMCMC   2 31         CMCMC   1 13         
CMCMCM 22 19         CMCMCM 21 26         CMCMCM 18 31         CMCMCM 16  9         
CMCMCM 14 10         CMCMCM  8 38         CMCMCM  8 25         CMCMCM  1 28         
OMCMCM 20  6         OMCMCM 13 18         OMCMCM 11 22         SMCMCM 21 17         
SMCMCM 19 22         SMCMCM 16 13         SMCMCM  5  2         SMCMCM  4 31         
SMCMCM  4 21         WMCMCM 16 11         _MC--- 13 33         _MCMCM 19 24         
_MCMCM  5  5         
TR ** FICHE/FRAME BREAK *****
TRSZTRC1701
      COMMON PNAME,PNOM,PMIN,PMAX,NI,NT,KIND,K,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,JNDX,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NIMI,NTMT,IIDUM
       COMMON JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY,LIST,I1T,I2T,T
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),JNDX(99),K(99),NTN(9),T(7,10),NPLIST(40),NAME(30)
      DIMENSION LIST(365),LSTADD(10),LISTPAR(79),NODELIST(40)
      DIMENSION IDUMMY(199),NIMI(99),NTMT(99),IIDUM(100)
      EQUIVALENCE (PMAX(1),XXXX(1)),(K(1),IXXX(1))
      DIMENSION XXXX(99,4),IXXX(99,4)
      DIMENSION JAME(20),LAME(20),IFILE(3),IFNAME(4)
CODED  -  CONTROL PROGRAM
C
C      THIS PROGRAM IS OVERLAY ZERO FOR THE CIRCUIT ANALYSIS PACKAGE AND IS RESPONSIBLE
C      FOR THE INTERFACE BETWEEN THE USER AND THE ANALYSIS PROGRAMS.
C
C      ALTHOUGH EACH OF THE OVERLAYS ALLOWS COMMON TO EXTENDED WELL INTO PAGE #4, ONLY PAGE #5
C      IS DECLARED IN THE OVERLAY PACKAGE THUS FORCING FILE BUFFER STORAGE TO BE ALLOCATED
C      IN PAGE #5.  THIS ALSO ALLOWS THE PROGRAMS TO ULTILIZE THEIR CORE ALLOCATION MORE EFFECTIVELY
C      SINCE NO LOCATIONS ARE LOST IN OVERLAY SWAPPING.  IT IS THUS VERY IMPORTANT THAT WE KNOW
C      EXACTLY WHAT IS CONTAINED IN PAGE #5.  IN THE COMMON DECLERATIONS GIVEN BELOW, "IDUMMY"
C      MUST BE ADJUSTED SO THAT ITS STARTING LOCATION IS 24000.  THE SECOND PAGE OF COMMON (PAGE #4)
C      MAY BE USED FREELY BY EACH OF THE OVERLAYS.
C
C      ON THE THE FIRST ENTRY TO THIS ROUTINE, WHEN THE OVERLAY IS FIRST PUT TOGETHER, THE COMMAND
C      LIST, WHICH IS STORED ON THE FILE /LIST/, MUST BE READ INTO THE ARRAY "LIST.
C      THUS THE PROCEDURE FOR LOADING OVERLAY ZERO IS TO USE FOS AS FOLLOWS:
C
C      @FOS
C      LOAD FROM: /PROG/
C      LOAD SUBPROGRAMS FROM: /SUBS/
C      ECT.
C      READY
C      +GO
C      STOP
C      +QUIT
C      @DUMP //
C      NEW FILE (LF)
C      STARTING LOCATION 30000
C
C      SUBSEQUENT ENTRIES TO THE PROGRAM WILL ALSO DEPEND ON THE SETTING OF THE VARIABLE
C      "FLAG".  IF "FLAG"=1, THEN THIS IS THE FIRST TIME THE USER HAS ENTERED THE PROGRAM AND AN OVERLAY
C      (ONE OF THE ANALYSIS PROGRAMS) MUST BE LOADED.  IF "FLAG"=-1, THEN AN OVERLAY HAS ALREADY
C      BEEN LOADED AND THE USER HAS RETURNED TO THE EXEC FOR SOME REASON AND IS NOW REENTERING
C      THE PROGRAM.
C
       IFNAME(1)=3H(@6
       IFNAME(2)=3HLT)
       IFNAME(4)=3H   
       IDUM1=1
       INPUT=1
       I1T=5
       I2T=2
       I3T=3
       IF(FLAG)24,13000,14
C
C      OVERLAY IS BEING PUT TOGETHER, SO COMMON MUST BE DECLARED AND THE COMMAND LIST READ.
C
13000  CALL TOVER(1)
      OPEN(2,INPUT,SYMBOLIC,/LIST/)
      CALL RDLIST(LIST,LSTADD,2)
       CALL FOSLD(3)         ;CK-TR
       CALL FOSLD(4)         ;CPLOT
       CALL CALLOV(4)        ;C READ COMMAND LIST FOR PLOTTER
       FLAG=1                ;C     SET FLAG SO THAT WE DONT COME THROUGH THIS CODE AGAIN.
       STOP
C
C      USER IS MAKING HIS FIRST ENTRY INTO PROGRAM
C
14     CALL DCLESC(NESC1)
       CALL ARM
       FLAG=-1
       NTRANS=0
       MAPP=0
       ASSIGN 24 TO NESC1
       TYPE 50000
50000  FORMAT (/$TRANSIENT CIRCUIT ANALYSIS PROGRAM$//)
      CALL TIME(I,J,KI,KK)
      KK=KK+100
      J=J+100
      TYPE 5,I,J,KI,KK
5     FORMAT(//I2,$/$,I2,5X,I2,$:$,I2/)
24    CONTINUE
C
C
      CALL SETESC
       IFILE(1)=3HTEL
       IFILE(2)=3HETY
       IFILE(3)=3HPE 
       IF(FLAG)1,9031,9031
9031  MAPP=0
1      GO TO (2,2,2,8),INPUT
2     TYPE 9
      CALL DCLESC(NESC1)
      ASSIGN 50 TO NESC1
      CALL ARM
      CLOSE
      CALL ESCON
9     FORMAT(/)
      CALL BRS(14,0,0,-1)
      CALL DCLESC(NESC1)
      ASSIGN 50 TO NESC2
8      IDUM4=1
      TYPE 10
10    FORMAT(/$:$)
      IF(LINGET(INPUT,IFN,NESC2)) 11,8,13
11    TYPE 12
12    FORMAT(/$ ?$/)
       INPUT=1
       CLOSE(IDUM2)
      GO TO 1
31     IFNAME(3)=3HTRC
       CALL COPY (IFNAME,IFILE)
       GO TO 1
32     IFNAME(3)=3HDCI
       CALL COPY (IFNAME,IFILE)
       GO TO 1
34     TYPE 35
35     FORMAT(/$TYMSHARE$)
       GO TO 1
36     IFNAME(3)=3HDCH
       CALL COPY (IFNAME,IFILE)
       GO TO 1
38     TYPE 39
39     FORMAT (/$YOUR REGULAR CHARGES$)
       GO TO 1
C
C      TAKE FROM
C
40     IDUM1=2
       IDUM2=9
       GO TO 101
42     IDUM1=1
       INPUT=4
       IFN=9
       I1T=-5
       I2T=-2
       I3T=-3
41     GO TO 8
13    CALL EDIT SAVE
      GO TO(11,8,100,200,300,400,500,600,700,800,900,9000,1100,11,11,
+     11,11,199,11,1500,6998,31,32,34,1100,36,36,38,40),KOMMAND(1,1)+2
6998  TYPE 77777
      KFLAG=-1
77777  FORMAT(/$MAIN=17.01  6-17-70$)
       CALL CALLOV(3)
       CALL CALLOV(4)
       KFLAG=0
       GO TO 1
50    CALL ARM
       INPUT=1
       CLOSE
      CALL BRS(29,0,0,-1)
      GO TO 1
C
C      READ FROM
C
C
100    IDUM2=3
      CALL EDIT RESTORE
      IF(KOMMAND(1,4)-1) 11,1011,11
1011  MAPP=0
      ASSIGN 150 TO NESC2
106   IF(NOWCHR(0)) 102,102,101
101   IF(FILE(NAME,-1,IDUM2,J,6HSYMINP))102,102,105
102   TYPE 103
103   FORMAT($FROM: $)
      IF(LINGET(INPUT,IFN,NESC2)) 102,102,101
105   IF(J-3) 109,120,109
109   TYPE 110
110   FORMAT($** WRONG FILE NAME **$/)
       CLOSE(IDUM2)
       GO TO (106,111)IDUM1
111    TYPE 103
       GO TO 106
120    GO TO (122,42)IDUM1
122   READ 3,121,PRO,BLEM,LIMBS
121   FORMAT(2A,I/)
       I=1
       J=0
       IKIN1=0
130   READ 3,131,XPNAME,INI,INT,IKIND,IJNDX,ILLLL,IK,
+      XPNOM,XPMIN,XPMAX
131   FORMAT(A,6I3,1P3E13.6/)
       IF(IKIN1-15)141,137,141
137    IF(IK+1)141,134,141
134    IF(J-1)138,132,138
138    TYPE 135
135    FORMAT($***NOTE***$/
+$     BREAKDOWN VOLTAGES ARE NOT ALLOWED IN   TR-CODED   . ALL$/
+$BREAKDOWN VOLTAGE INFORMATION ON DIODES READ INTO   TR-CODED$/
+$FROM A FILE WILL BE LOST.$/
+$     $/
+$     THEREFORE, IF YOU WRITE THIS FILE IN   TR-CODED   ON THE$/
+$SAME FILE NAME, ALL BREAKDOWN INFORMATION WILL BE LOST. YOUR$/
+$OLD FILE WILL NOT BE ALTERED IF YOU DO NOT WRITE ON IT FROM$/
+$WITHIN   TR-CODED.$/)
132    J=J+1
       GO TO 133
141    PNAME(I)=XPNAME
       NI(I)   =INI
       NT(I)   =INT
       KIND(I) =IKIND
       JNDX(I) =IJNDX
       LLLLL   =ILLLL
       K(I)    =IK
       PNOM(I) =XPNOM
       PMIN(I) =XPMIN
       PMAX(I) =XPMAX
133    IF(I-LIMBS)144,142,142
144    IKIN1=IKIND
       I=I+1
136    GO TO 130
142    LIMBS=LIMBS-J
140   MAPP=1
      GO TO 1
150   LIMBS=0
151   CLOSE
      GO TO 50
C
C
C      WRITE ON
C
C
199   NREST=1
200   LXX=0
      IF(MAPP) 11,11,2111
2111  ASSIGN 151 TO NESC2
201   IF(FILE(NAME,-1,3,J,6HSYMOUT)) 2021,2021,2531
2021  TYPE 203
203   FORMAT($TO: $)
2031  IF(LINGET(INPUT,IFN,NESC2)) 2021,1,201
2531  IF(NREST) 253,253,2533
2533  NREST=0
      TS=-1.0
      IF(NREL)2534,11,11
2534  CALL CALLOV(3)
      GO TO 1
253   WRITE 3,121,PRO,BLEM,LIMBS
      DO 255 I=1,LIMBS
      LLLLL=0
255   WRITE 3,131,PNAME(I),NI(I),NT(I),KIND(I),JNDX(I),LLLLL,K(I),
+     PNOM(I),PMIN(I),PMAX(I)
      WRITE 3,256,NTRANS
256   FORMAT(I/)
260   GO TO 1
C
C
C      ENTER PARAMETERS
C
C
300    CALL EDIT RESTORE
      IF(KOMMAND(1,3)-3) 11,3000,11
3000  MAPP=0
      MKOM1=0
      LIMBS=0
      LEMON=0
      NODES=0
      CALL NOWCHR(0)
      CALL PACKF(PRO,6,0)
      CALL PACKF(BLEM,6,0)
      JPIN=0
      IPIN=1
      DO 3001 I=1,99
3001  JNDX(I)=0
3021  MOD=0
      LEMON=0
301   IF(MOD) 3011,3011,609
3011  ASSIGN 3996 TO NESC2
      CALL ESCON
      JPIN=IPIN
       K(IPIN)=0
      CALL EDIT EMPTY
      TYPE 302,IPIN
302   FORMAT($#$,I2,$ $)
303   IF(LINGET(INPUT,IFN,NESC2)) 3995,3995,305
305   ASSIGN 390 TO NESC2
      CALL EDIT SAVE
      K(IPIN)=1
C
C
C      NOW SET UP SCALAR KTYPE
C        KTYPE=0 , ONE LINE PARAMETER (RESISTANCE ETC)
C        KTYPE=1 ,         "          ASSUME PNOM (OPEN-SHORT)
C        KTYPE=2 , TWO LINE PARAMETER (CAPACITOR,INDUCT.,ASSUME 2ND. LINE)
C        KTYPE=3 , VOLTAGE SOURCE
C        KTYPE=4 , CURRENT SOURCE
C        KTYPE=5 , DIODE
C        KTYPE=6 , SWITCH
C
C
      KTYPE=0
      GO TO(306,306,3125,311,314,315,316,317,312,313,306,318,306,320),KOMMAND(2,-1)+2
C
306   TYPE 307
307   FORMAT($** INVALID PARAMETER **$/)
      GO TO 301
C
C
311    KIND(IPIN)=2
      GO TO 3126
C
C
312   XUM=1E25
      GO TO 3123
C
C
313   XUM=1E-25
3123  DO 3122 JJJ=1,3
3122  XXXX(IPIN,JJJ)=XUM
3124  KTYPE=1
3125  KIND(IPIN)=1
3126  LINE=1
       JNDX(IPIN)=IPIN
      GO TO 330
C
C
314   KIND(IPIN)=3
      KIND(IPIN+1)=14
      GO TO 3152
C
C 
315   KIND(IPIN)=4
      KIND(IPIN+1)=9
3152  KTYPE=2
3153  LINE=2
      JNDX(IPIN)=IPIN+1
      JNDX(IPIN+1)=IPIN
      GO TO 330
C
C
316   KTYPE=3
      GO TO 3126
C
C
317   KTYPE=4
      GO TO 3126
C
C
318   KIND(IPIN)=10
      KIND(IPIN+1)=15
      KTYPE=5
      GO TO 3153
C
C      SWITCH
C
320   KIND(IPIN)=5
      KTYPE=6
      LINE=2
      K(IPIN+1)=-1
      JNDX(IPIN)=IPIN+1
      JNDX(IPIN+1)=IPIN
      KIND(IPIN+1)=1
C
C
330   IF(MOD) 3301,3301,3350
3301   CALL EDIT RESTORE
      CALL SYNCHRO(J,IPIN-1,PNAME(IPIN),M)
      IF(J) 335,335,333
333   TYPE 334
334   FORMAT($** DUPLICATE NAMES **$/)
      IF(LEMON) 301,301,1
3350  CALL EDIT RESTORE
      CALL SYNCHRO(J,IPIN-1,PNAME(IPIN),M)
335   PNAME(IPIN+1)=PNAME(IPIN)
      IF(LEMON) 3361,337,3361
3361  IF(LINE-MMX) 656,3362,656
3362  IF((KTYPE-3)*(KTYPE-4)*(KTYPE-6)) 3607,3363,3607
3363  GO TO(656,656,656,656,3607,3607,3607,3607,656,656,3607,3607,3607,656,656),KIND(JJX)
C
C      
337   CALL KOMMA(0)
3371   IF(JUMBER(X,1)) 338,338,340
338   TYPE 339
339   FORMAT($FROM: $)
      IF(LINGET(INPUT,IFN,NESC2)) 338,338,3371
340   NI(IPIN)=X
      NI(IPIN+1)=X
341   CALL KOMMA(0)
3411  IF(JUMBER(X,1)) 342,342,344
342   TYPE 343
343   FORMAT($TO: $)
      IF(LINGET(INPUT,IFN,NESC2)) 342,342,3411
344   NT(IPIN)=X
      NT(IPIN+1)=X
      IF(NI(IPIN)-NT(IPIN)) 3440,3442,3440
3442  TYPE 12
      GO TO 338
3440  IF(LEMON)3441,3441,690
C
C
C
3441  IF(KTYPE-1) 346,345,346
345   IPIN=IPIN+KTYPE
      GO TO 301
C
346   CALL KOMMA(0)
3461  IF(KTYPE-6) 3471,3472,3471
3472  IF(JUMBER(X,1)) 3473,3473,349
3473  TYPE 3474
3474  FORMAT($BREAKPOINT VOLTAGE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3473,3473,3472
3471  IF(JUMBER(X,0)) 347,347,349
347   TYPE 348
348   FORMAT($NOMINAL VALUE: $)
3481  IF(LINGET(INPUT,IFN,NESC2)) 347,347,3461
349   IF(LEMON) 3480,3490,3482
3482  IF(MKOM2) 3483,3483,3480
3483  IF((MKOM1-11)*(MKOM1-12)) 3480,3490,3480
3480  PNOM(IPIN)=X
      GO TO 690
3490  PNOM(IPIN)=X
      IF(LEMON) 3495,3495,690
C
C

3495  IF(KOMMAND(7,-1)) 3801,3801,3492
3492  IF(KTYPE-5)3209,388,3780
3209  IF(KTYPE-2) 361,3210,361
C
357   TYPE 363
      GO TO 3631
3601  IF((KTYPE-3)*(KTYPE-4))3631,368,3631
3607  IF((KTYPE-3)*(KTYPE-4)) 690,3608,690
3608  GO TO(368,368,368,368,368,368,374,371,368,368,368,374,371,368,368),KIND(JJX)
C
C
C      DEPENDENCIES
C
C
361   IF((KTYPE-3)*(KTYPE-4)) 357,3651,357
362   TYPE 363
363   FORMAT($** INVALID DEPENDENCY**$/)
3631  IF(KTYPE) 380,364,380
364   IPIN=IPIN+1
      GO TO 301
365   IF(NEXTCHR(0)) 368,368,3651
3651  CALL EDIT SAVE
      GO TO(3660,368,371,371,374,366,366),KOMMAND(8,-1)+2
3660  CALL EDIT RESTORE
      CALL EDIT SAVE
      IF(KOMMAND(7,-1)) 366,366,3683
3683  CALL EDIT RESTORE
      GO TO 368
366   TYPE 363
3661  TYPE 367
367   FORMAT($DEPENDENCY: $)
      IF(LINGET(INPUT,IFN,NESC2)) 368,368,3681
3681  IF(KTYPE-6) 3651,3772,3651
368   IF(KTYPE-6) 3682,3701,3682
3701  JNDX(IPIN)=IPIN
      GO TO 3810
3682  IF(KTYPE-3) 370,369,370
369    KIND(IPIN)=11
      IF(LEMON)3200,3200,690
370   KIND(IPIN)=6
      IF(LEMON) 3200,3200,690
371   IF(KTYPE-3) 373,372,373
372   KIND(IPIN)=13
      GO TO 377
373   KIND(IPIN)=8
      GO TO 377
374   IF(KTYPE-3) 376,375,376
375   KIND(IPIN)=12
      GO TO 377
376   KIND(IPIN)=7
377   IF(NAMOD)3771,3771,690
3780  CALL EDIT SAVE
      IF(KOMMAND(7,-1)) 3772,3772,3781
3781  CALL EDIT RESTORE
      GO TO 3701
3771  CALL KOMMA(0)
3772  CALL SYNCHRO(LL,IPIN-1,Z,M)
      IF(LL) 378,368,379
378   TYPE 3971
3971  FORMAT($** NO SUCH PARAMETER **$/)
      GO TO 3661
379   IF(LEMON) 3791,3791,3792
3792  IF(LL-JJX)3791,656,656
3791  JNDX(IPIN)=LL
3793  IF(LEMON)3797,3797,690
3797  IF(KTYPE-6) 3200,3810,3200
C
C
3810  IF(KOMMAND(7,-1)) 3815,3815,3811
C
3817  IF(LINGET(INPUT,IFN,NESC2)) 3815,3815,3811
3811  GO TO (3815,3815,3815,3815,3815,3812,3813),KOMMAND(8,1)+2
3812  PMIN(IPIN)=-1.0
      GO TO 3814
3813  PMIN(IPIN)=1.0
3814  CONTINUE
      IF(KOMMAND(7,-1)) 3521,3521,3533
3533  IF(JUMBER(X,0)) 3521,3534,3523
3534  PMAX(IPIN)=.01
      PNOM(IPIN+1)=1E15
      GO TO 3532
3521  TYPE 3522
3522  FORMAT($CLOSED RESISTANCE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3521,3525,3523
3523  IF(JUMBER(X,0)) 3521,3525,3524
3524  PMAX(IPIN)=X
      GO TO 3526
3525  PMAX(IPIN)=.01
3526  IF(KOMMAND(7,-1)) 3527,3527,3529
3527  TYPE 3528
3528  FORMAT($OPEN RESISTANCE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3527,3531,3529
3529  IF(JUMBER(X,0)) 3527,3531,3530
3530  PNOM(IPIN+1)=X
      GO TO 3532
3531  PNOM(IPIN+1)=1E15
3532  IPIN=IPIN+2
      GO TO 301
3815  TYPE 3816
3816  FORMAT($INITIAL STATUS: $)
      GO TO 3817
C
C
3200  IF(KOMMAND(7,-1)) 3201,3201,3202
3201  TYPE 3503
3503  FORMAT($START TIME: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3201,3201,3202
3202  IF(JUMBER(X,1)) 3201,3201,3203
3203  PMIN(IPIN)=X
      IF(KOMMAND(7,-1)) 3204,3204,3206
3204  TYPE 3205
3205  FORMAT($TYPE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3204,3207,3206
3206  MKM=KOMMAND(10,1)
      IF(MKM) 3204,3207,3208
3207  K(IPIN)=1
      GO TO 3228
3208  IF(MKM-2) 3509,3510,3511
3509  K(IPIN)=5
      GO TO 3217
3510  K(IPIN)=2
      GO TO 3217
3511  MKM=MKM-29
      IF(MKM) 3204,3204,3512
3512  IF(MKM-2) 3513,3514,3204
3513  K(IPIN)=3
      GO TO 3217
3514  K(IPIN)=4
3217  IF(KOMMAND(7,-1)) 3218,3218,3220
3218  TYPE 3219
3219  FORMAT($PERIOD: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3218,3218,3220
3220  IF(JUMBER(X,0)) 3218,3218,3221
3221  PMAX(IPIN)=X
      GO TO (3228,3228,3228,3228,3516,3516,3228),K(IPIN)+2
3516  JNDX(IPIN+1)=IPIN
      KIND(IPIN+1)=1
      K(IPIN+1)=-1
      LINE=2
      NI(IPIN+1)=NI(IPIN)
      NT(IPIN+1)=NT(IPIN)
      IF(KOMMAND(7,-1)) 3222,3222,3224
3222  TYPE 3223
3223  FORMAT($PULSE-WIDTH: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3222,3222,3224
3224  IF(JUMBER(X,0)) 3222,3222,3225
3225  PNOM(IPIN+1)=X
      IF(PMAX(IPIN)-PNOM(IPIN+1)) 3226,3227,3227
3226  TYPE 12
      GO TO 3218
3227  IPIN=IPIN+1
3228  IPIN=IPIN+1
      GO TO 301
C
C
C
C
3801  IF((KTYPE-3)*(KTYPE-4)) 380,3661,380
380   IF(KTYPE-5)3800,384,3661
3800  IF(KTYPE-2) 381,3211,381
3211  IF(KIND(IPIN)-3) 3214,3212,3214
3212  TYPE 3213
3213  FORMAT($INITIAL VOLTAGE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3212,3212,3517
3517  IF(JUMBER(X,1)) 3212,389,389
3214  TYPE 3215
3215  FORMAT($INITIAL CURRENT: $)
      IF(LINGET(INPUT,IFN,NESC2)) 3214,3214,3216
3216  IF(JUMBER(X,1)) 3214,389,389
3210  IF(KIND(IPIN)-3) 3216,3517,3216
381   IF(KTYPE) 383,382,383
382   IPIN=IPIN+1
      GO TO 301
383   IPIN=IPIN+2
      GO TO 301
C
384   IF(KOMMAND(7,-1)) 385,385,388
385   TYPE 386
386   FORMAT($THERMAL VOLTAGE: $)
      IF(LINGET(INPUT,IFN,NESC2))385,385,388
388   IF(JUMBER(X,0)) 385,385,389
389   IPIN=IPIN+1
      KTYPE=0
      GO TO 349
C
C
390   IPIN=JPIN
      CALL ARM
      TYPE 9
       IF(MOD)301,301,1
C
C
656   TYPE 3980
3980  FORMAT($** INVALID REQUEST **$/)
      GO TO 1
C
C
3996  CALL ARM
      CALL BRS(29,0,0,-1)
3995  DO 3997 I=1,JPIN-1
      IF(JNDX(I)) 3997,3998,3997
3998  JNDX(I)=I
3997   CONTINUE
      LIMBS=JPIN-1
      IF(LIMBS)1,1,3999
3999  MAPP=1
      GO TO 1
C
C
C           ADD PARAMETERS
C
C
400   IF(MAPP) 11,11,4001
4001  IPIN=LIMBS+1
      JNDX(IPIN)=0
      JNDX(IPIN+1)=0
      GO TO 3021
C
C
C       CHANGE PARAMETERS
C
C
500   NTP=1
      GO TO 601
C
C
C      MODIFY PARAMETERS
C
C
600   NTP=0
601   DEL=0
      NAMOD=0
      MOD=1
      MKOM1=0
      MKOM2=0
      IF(MAPP) 11,11,6011
6011  LEMON=0
      CALL KOMMA(0)
      IF(NOWCHR(0)) 602,602,603
602   TYPE 3962
3962  FORMAT($PARAMETER: $)
      IF(LINGET(INPUT,IFN,NESC2)) 602,602,603
603   CALL SYNCHRO(JJX,LIMBS,OLDNM,MMX)
      IF(JJX) 604,602,605
604   TYPE 3971
      GO TO 602
605   IF(NTP) 607,607,606
606   CALL PRINTP(JJX,1,JZ)
607   JJZ=JJX-1
      DO 6522 IJX=1,MMX
      CALL IXJON(XXXX,IXXX,LIMBS+IJX,JJZ+IJX)
6522  CALL DEPEND(JNDX,PNAME,KIND,LIMBS+IJX,JJX,JJZ+IJX,LIMBS-JJZ,1)
      IF(NEXTCHR(0)) 608,608,650
608   TYPE 302,JJX
      IPIN=LIMBS+1
      JPIN=IPIN
      GO TO 303
C
C      WE HAVE NOW INPUT A PARAM
C
609   CALL ESCOFF
      IF(LINE-MMX) 620,610,630
620   DEL=1
610   JJZ=JJX-1
      DO 618 I=1,LINE
      CALL IXJON(XXXX,IXXX,JJZ+I,LIMBS+I)
      IF(JNDX(LIMBS+I)) 613,613,618
613   JNDX(LIMBS+I)=LIMBS+I
618   CALL DEPEND(JNDX,PNAME,KIND,JJZ+I,JJX,LIMBS+I,LIMBS+1-JJX,-1)
      IF(DEL)6181,6181,622
622   CALL DELETE(JJX+LINE,MMX-LINE,LIMBS)
6181  IF(MMX-8) 1,653,653
C
630   NN=LINE-MMX
      DO 632 J=LIMBS+LINE+NN,JJX+MMX+NN,-1
      CALL IXJON(XXXX,IXXX,J,J-NN)
C
632   CALL DEPEND(JNDX,PNAME,KIND,J,JJX,J-NN,NN,1)
      LIMBS=LIMBS+NN
      GO TO 610
C
650   LEMON=1
      LINE=MMX
      IPIN=LIMBS+1
      JPIN=LIMBS+1
       MKOM1=KOMMAND(10,2)+2
      MKOM2=KOMMAND(10,2)+2
      IF(MMX-8) 665,653,653
C
C      TRANSISTOR
C
653   TYPE 307
      GO TO 1

C      NON-TRANSISTORS
C
665   IF(MKOM1-15) 666,656,656
666   GO TO(656,656,656,656,338,347,656,656,656,674,677,677,656,685),MKOM1
674   GO TO(656,656,656,656,6761,675,675,675,656,656,676,676,676,656,656),KIND(JJX)
6761  KTYPE=6
      GO TO 3661
675   KTYPE=4
      GO TO 3661
676   KTYPE=3
      GO TO 3661
677   IF(KIND(JJX)-10) 656,678,656
678   IF(MKOM2-2) 656,679,682
679   IF(MKOM1-11) 680,680,385
680   TYPE 681
681   FORMAT($SATURATION CURRENT: $)
      GO TO 3481
C
682   IF(MKOM2-6) 656,683,683
683   IF(MKOM2-9) 684,684,656
684   IPIN=IPIN+MKOM1-11
      GO TO(347,656,656,656),MKOM2-5
C
685   TYPE 302,JJX
      NAMOD=1
      GO TO 303
C
690   DEL=0
      GO TO 610
C
C
C
C      PRINT PARAMETERS
C
C
700   NO=1
      GO TO 801
C
C      LIST PARAMS
C
800   NO=0
801   IF(MAPP) 11,11,8011
8011  CALL SYNCHRO(J,LIMBS,Z,M)
      IF(J) 802,803,804
802   TYPE 3971
      GO TO 807
803   CALL PRINTP(-1,NO,II)
      GO TO 1
804   CALL PRINTP(J,NO,II)
807   IF(NEXTCHR(0)) 1,1,805
805   CALL SYNCHRO(J,LIMBS,Z,M)
      IF(J) 802,1,806
806   NO=O
      GO TO 804
C
C
C      DELETE PARAMS
C
C
900   IF(MAPP) 11,11,9001
9001  CALL SYNCHRO(LL,LIMBS,OLDNM,M)
      IF(LL) 901,1,902
901   TYPE 3971
      GO TO 1
902   CALL DELETE(LL,M,LIMBS)
903   IF(NEXTCHR(0)) 9032,9032,9001
9032  IF(LIMBS) 9031,9031,1
C
C
C      NOMINAL
C
C
1100  ITYPE=1
      CALL INCOM(J,MAPP)
      IF(J) 1,1,5000
C
C
C       PLOTTER
C
1500   CLOSE(5)
      CALL CALLOV(4)
       GO TO 1
C
C      CHANGE TO AC
C
C
C
C
C      GO TO X-TR
C
5000  CALL CALLOV(3)
      GO TO 1
C
C
C      EXIT FROM CODED
C
C
9000  CALL BRS(10)
      END
      SUBROUTINE PRINTP(I,NO,JJ)
      COMMON PNAME,PNOM,PMIN,PMAX,NI,NT,KIND,K,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,JNDX,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NIMI,NTMT,IIDUM
       COMMON JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY,LIST,I1T,I2T,T
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),JNDX(99),K(99),NTN(9),T(7,10),NPLIST(40),NAME(30)
      DIMENSION LIST(365),LISTPAR(79),NODELIST(40)
      DIMENSION IDUMMY(199),NIMI(99),NTMT(99),IIDUM(100),JAME(20),LAME(20)
      EQUIVALENCE (PMAX(1),XXXX(1)),(K(1),IXXX(1))
      DIMENSION XXXX(99,4),IXXX(99,4)
C
C
C      THIS S-R HANDLES ALL PRINTING OF CIRCUITS
C
C      NO = A MARKER FOR HEADINGS
C
C      I = THE NUMBER OF THE PRESENT PARAMETER,OR
C        = -1 WE REQUIRE ALL OF THIS CIRCUIT TO BE LISTED
C
C      JJ RETURNS WITH THE NEXT LINE NUMBER AFTER THIS PARAMETER
C
C
      TYPE 23
      IF(NO) 6,6,1
1     TYPE 5
5     FORMAT(/$  PARAMETER    NODES   DEPENDENCY   NOMINAL$/
+     $ NO.   NAME   FROM TO  TYPE  ON$,6X,$VALUE$
+     5X,$START-TIME   PULSE-WIDTH$/
+     $ ---  -----   ---  ---  -  -----$,3(2X,11($-$))/)
C
C
6     IF(I)7,7,8
7     JJ=1
      GO TO 9
8     JJ=I
9     GO TO(10,10,10,10,10,10,10,10,40,30,10,10,10,42,900),KIND(JJ)
C
C
C         ALL ONE LINE PARAMETERS
C
C
C
10    IF(JNDX(JJ)-JJ) 13,16,13
13    GO TO(16,16,16,16,15,16,14,15,16,16,16,14,15,16,16),KIND(JJ)
14    II=3H  I
      GO TO 151
15    II=3H  E
151   AI=PNAME(JNDX(JJ))
      GO TO 17
16    II=3H   
      AI=6H          
17    TYPE 19,JJ,PNAME(JJ),NI(JJ),NT(JJ),II,AI,PNOM(JJ)
19    FORMAT(1X,I3,2X,A5,3X,I3,2X,I3,A3,2X,A5,3X,1PE10.4)
22    TYPE 23
23    FORMAT(/)
      IF(KIND(JJ)-5)900,24,200
24    IF(PMIN(JJ)) 25,25,26
25    AI=6HOPEN
      GO TO 27
26    AI=6HCLOSED
27    TYPE 28,AI,PMAX(JJ),PNOM(JJ+1)
28    FORMAT(5X,$INITIAL STATUS = $,A6,$ (RC)= $,1PE10.4,10X,$(RO)= $
+     ,1PE10.4/)
      JJ=JJ+1
      GO TO 900
C
C
C      DIODES (ONLY TRUE MULTI LINE)
C
C       THIS DIODE COULD ALSO BE THE FIRST LINE OF A TRANSISTOR MACRO
C
C
30    CONTINUE
31    TYPE 33,JJ,PNAME(JJ),NI(JJ),NT(JJ)
33    FORMAT(2X,I2,2X,A5,3X,I3,2X,I3/)
      TYPE 34,PNOM(JJ)
34    FORMAT(13X,$SATURATION CURRENT:$,3X,1PE10.4/)
      JJ=JJ+1
      TYPE 37,PNOM(JJ)
37    FORMAT(16X,$THERMAL VOLTAGE:$,3X,1PE10.4)
39    TYPE 23
      GO TO 900
C
40    TYPE 41,PNOM(JJ)
41    FORMAT(16X,$INITIAL CURRENT:$,3X,1PE10.4/)
      GO TO 900
C
42    TYPE 43,PNOM(JJ)
43    FORMAT(16X,$INITIAL VOLTAGE:$,3X,1PE10.4/)
C
C
200   GO TO (900,900,900,900,900,201,201,201,900,900,201,201,201,900,900),KIND(JJ)
201   IF(K(JJ)-1) 203,203,204
202   AI=6HCOSINE
      GO TO 210
203   AI=6HSTEP
      LJJ=0
      PMIN(JJ)=0
      PMAX(JJ)=1E50
      PW=1E50
      GO TO 220
204   IF(K(JJ)-3) 205,206,207
205   AI=6HSINE
      GO TO 210
206   AI=6HSQUARE
      GO TO 208
207   IF(K(JJ)-4) 2071,2071,202
2071  AI=6HSAWTTH
208   PW=PNOM(JJ+1)
      LJJ=1
      GO TO 220
210   TYPE 211,AI,PMAX(JJ),PMIN(JJ)
211   FORMAT(16X,A6,$ - PERIOD:$,2(3X,1PE10.4)/)
      GO TO 900
220   TYPE 221,AI,PMAX(JJ),PMIN(JJ),PW
221   FORMAT(16X,A6,$ - PERIOD:$,3(3X,1PE10.4)/)
      JJ=JJ+LJJ
      GO TO 900
C
C
900   JJ=JJ+1
      IF(LIMBS-JJ) 902,903,903
903   IF((KIND(JJ)-9)*(KIND(JJ)-14)) 902,9,902
902   IF(I)901,999,999
901   IF(LIMBS-JJ) 999,9,9
999   RETURN
      END
      SUBROUTINE DELETE (I,M,NUM)
      COMMON PNAME,PNOM,PMIN,PMAX,NI,NT,KIND,K,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,JNDX,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NIMI,NTMT,IIDUM
       COMMON JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY,LIST,I1T,I2T,T
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),JNDX(99),K(99),NTN(9),T(7,10),NPLIST(40),NAME(30)
      DIMENSION LIST(365),LISTPAR(79),NODELIST(40)
      DIMENSION IDUMMY(199),NIMI(99),NTMT(99),IIDUM(100),JAME(20),LAME(20)
      EQUIVALENCE (PMAX(1),XXXX(1)),(K(1),IXXX(1))
      DIMENSION XXXX(99,4),IXXX(99,4)
C     I= FIRST LINE TO BE DELETED
C     M= NUMBER OF LINES
C     NUM= THE TOTAL NUMBER OF LINES BEFORE DELETION
C
C
      CALL ESCOFF
      IF(I+(M-1)-NUM) 2,3,2
3     NUM=NUM-M
      GO TO 11
2     NUM=NUM-M
      DO 10 J=I,NUM
      L=J+M
      CALL IXJON(XXXX,IXXX,J,L)
      CALL DEPEND(JNDX,PNAME,KIND,J,I,L,M,0)
10    CONTINUE
11    CALL ESCON
      RETURN
      END
      SUBROUTINE INCOM(J,NNN)
      COMMON PNAME,PNOM,PMIN,PMAX,NI,NT,KIND,K,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,JNDX,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NIMI,NTMT,IIDUM
       COMMON JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY,LIST,I1T,I2T,T
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),JNDX(99),K(99),NTN(9),T(7,10),NPLIST(40),NAME(30)
      DIMENSION LIST(365),LISTPAR(79),NODELIST(40)
      DIMENSION IDUMMY(199),NIMI(99),NTMT(99),IIDUM(100),JAME(20),LAME(20)
      EQUIVALENCE (PMAX(1),XXXX(1)),(K(1),IXXX(1))
      DIMENSION XXXX(99,4),IXXX(99,4),NP(40)
C
C
      ASSIGN 221 TO NESC2
C
      IF(NNN) 222,222,1111
222   TYPE 223
223   FORMAT($** NO CIRCUIT YET **$/)
      GO TO 221
1111  NODES=0
      IREST=0
      ITEL=0
      IHEAD=1
      IFILE=0
      ISAVE=0
      NODET=0
      NPAR=0
C
C     SET UP NIMI AND NTMT WHICH CONTAIN THE SEQUENTIAL NODE NUMBERS
C
      DO 5100 I=1,LIMBS
      IF(NI(I)) 5001,5001,5002
5001  NIMI(I)=0
      GO TO 5010
5002  IF(NODES) 5003,5003,5004
5003   NODES=NODES+1
      NIMI(I)=NODES
      NODELIST(NODES)=NI(I)
      NPLIST(NODES)=NI(I)
      GO TO 5010
5004  IF(I-1) 6004,5003,6004
6004  DO 5006 II=1,I-1
      IJ=II
      IF(NI(I)-NI(II)) 5005,5007,5005
5005  IF(NI(I)-NT(II)) 5006,5008,5006
5006  CONTINUE
      GO TO 5003
5007  NIMI(I)=NIMI(IJ)
      GO TO 5010
5008  NIMI(I)=NTMT(IJ)
5010  IF(NT(I)) 5011,5011,5012
5011  NTMT(I)=0
      GO TO 5100
5012  IF(NODES) 5013,5013,5014
5013  NODES=NODES+1
      NTMT(I)=NODES
      NPLIST(NODES)=NT(I)
      NODELIST(NODES)=NT(I)
      GO TO 5100
5014  IF(I-1) 6014,5013,6014
6014  DO 5016 II=1,I-1
      IJ=II
      IF(NT(I)-NI(II)) 5015,5017,5015
5015  IF(NT(I)-NT(II)) 5016,5018,5016
5016  CONTINUE
      GO TO 5013
5017  NTMT(I)=NIMI(IJ)
      GO TO 5100
5018  NTMT(I)=NTMT(IJ)
5100  CONTINUE
C
C
13    CALL KOMMA(0)
14    CALL EDIT EMPTY
      CALL EDIT SAVE
      IF(NUMBER(X)) 20,101,15
15    IF(X) 1511,1511,1500
1500  NODET=NODET+1
      NODELIST(NODET)=X
      DO 151 KLM=1,LIMBS
      IF(NI(KLM)-NODELIST(NODET)) 152,13,152
152   IF(NT(KLM)-NODELIST(NODET)) 151,13,151
151   CONTINUE
1511  TYPE 153,NODELIST(NODET)
153   FORMAT(/$**$,I5,$ IS NOT A NODE **$/)
      GO TO 221
C
C
20    CALL EDIT RESTORE
      GO TO(21,21,23,21,21,26,30,31,32),KOMMAND(5,1)+2
21    TYPE 22
22    FORMAT(/$ ?$/)
221   J=-1
      CALL ARM
      RETURN
C
C
23    IHEAD=2
      GO TO 13
C
C
26    IFILE=1
      GO TO 13
C
C
C
C
C
30    IREST=1
      GO TO 13
C
31    ISAVE=1
      GO TO 13
C
32    ITEL=1
      GO TO 13
C
101   IF(NODET) 102,102,105
102   NODET=NODES
105   NPAR=LIMBS
900   J=1
      IF(IREST) 915,915,901
901   TYPE 902
902   FORMAT($RESTART FROM FILE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 901,901,903
903   IF(FILE(JAME,-1,4,JJ,6HBININP)) 901,901,904
904   IF(JJ) 905,905,9071
9071  CODE=6HJPSTR
      READ BINARY 4,ACODE,LI,NO
      CALL COMPAR(CODE,ACODE,IND)
      IF(IND) 905,905,907
905   TYPE 906
906   FORMAT(/$** NOT A RESTART FILE **$/)
      CLOSE
      GO TO 901
907   READ BINARY 4,(NP(IIII),IIII=1,NO)
      TYPE 908
908   FORMAT($FROM TIME: $)
      IF(LINGET(INPUT,IFN,NESC2)) 907,907,909
909   IF(JUMBER(X,1)) 907,911,910
911   X=0.
      IREST=-1
910   TR=X
      TS=TR
       CLOSE(4)
915   IF(ISAVE) 1915,1915,1916
1916  TYPE 1917
1917  FORMAT($SAVE FILE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 1916,1916,1918
1918  IF(FILE(LAME,-1,I1T,JJ,6HBINOUT))1916,1916,1926
1926   CONTINUE
1915  IF(IFILE) 997,997,916
916   TYPE 917
917   FORMAT($OUTPUT FILE: $)
      IF(LINGET(INPUT,IFN,NESC2)) 916,916,918
918   IF(FILE(NAME,-1,I2T,JJ,6HSYMOUT)) 916,916,919
997   NAME(1)=3HTEL
      NAME(2)=3HETY
      NAME(3)=3HPE
       GO TO 999
919    CONTINUE
999   IF(IHEAD-2) 1000,1001,1000
1000  IHEAD=1
1001  IF(IREST)1006,1002,1006
1002  TS=0.0
1006  TYPE 1007
1007  FORMAT($FINISH TIME: $)
      IF(LINGET(INPUT,IFN,NESC2)) 1006,1006,1008
1008  IF(JUMBER(X,0)) 1006,1006,1009
1009  TF=X
      IF(TF-TS) 1010,2111,2111
1010  TYPE 22
      GO TO 1001
2111  IF(KOMMAND(7,-1)) 2112,2112,2114
2112  TYPE 2113
2113  FORMAT($OUTPUT INTERVAL: $)
      IF(LINGET(INPUT,IFN,NESC2)) 2112,2112,2114
2114  IF(JUMBER(X,0))2112,2112,2115
2115  TO=X
      IF(TF-TO) 1010,2116,2116
2116  IF(KOMMAND(7,-1)) 2117,2117,2119
2117  TYPE 2118
2118  FORMAT($NUMBER OF INTEGRATION STEPS PER OUTPUT INTERVAL: $)
      IF(LINGET(INPUT,IFN,NESC2)) 2117,2121,2119
2119  IF(JUMBER(X,0))2121,2121,2120
2120  DT=TO/X
      GO TO 2130
2121  DT=TO/20.0
2130  RETURN
      END
      SUBROUTINE SYNCHRO(J,NUM,PAR,M)
      COMMON PNAME,PNOM,PMIN,PMAX,NI,NT,KIND,K,FLAG,IHEAD,NODET,LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,JNDX,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NIMI,NTMT,IIDUM
       COMMON JAME,NPLIST,INPUT,IFN,I3T,I4T,IDUMMY,LIST,I1T,I2T,T
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),JNDX(99),K(99),NTN(9),T(7,10),NPLIST(40),NAME(30)
      DIMENSION LIST(365),LISTPAR(79),NODELIST(40)
      DIMENSION IDUMMY(199),NIMI(99),NTMT(99),IIDUM(100),JAME(20),LAME(20)
      EQUIVALENCE (PMAX(1),XXXX(1)),(K(1),IXXX(1))
      DIMENSION XXXX(99,4),IXXX(99,4)
C
C      CHECKS OUT PARAMETER INPUTS
C
C      FOR PARAMETERS AFTER A COMMAND
C
C      IE LIST,DELETE,=,MODIFY
C
C
C      J RETURNS AS
C      -1  IF THE PARAMETER WASNT THERE
C      0    IF NO PARAMETER WAS INPUT
C      OR THE LINE NUMBER OF THE PARAMETER
C
C
      CALL KOMMA(0)
      IF(NOWCHR(0)) 1,1,2
1      J=0
      RETURN
2      CALL EDIT EMPTY
      CALL EDIT SAVE
      IF(NUMBER(X)) 4,1,3
3     LL=X
      IF(LL) 10,10,31
31    IF(LL-NUM) 11,11,10
4     CALL EDIT RESTORE
      CALL PACKF(PAR,5,1)
      IF(NUM) 1,1,5
5     DO 9 I=1,NUM
      LL=I
      CALL COMPAR(PNAME(I),PAR,IND)
      IF(IND)9,9,11
9     CONTINUE
10    J=-1
      RETURN
11    J=LL
      GO TO (150,15,16,16,16,151,151,151,20,16,151,151,151,20,20),KIND(LL)
150   IF(K(LL)) 20,15,15
151   IF(K(LL+1)) 16,15,15
15    M=1
      GO TO 17
16    M=2
17    RETURN
C
C      HE HAS GIVEN SECOND PART OF TWO LINE PARAMETER
C
20    LL=LL-1
      TYPE 21,LL
21    FORMAT(/$** INVALID REQUEST - MAYBE NO.$,I3/)
      M=2
      J=LL
      RETURN
C
C      TRANSISTOR
C
      END
      SUBROUTINE DEPEND(JNDX,PNAME,KIND,J,I,L,M,NOT)
      DIMENSION JNDX(99),PNAME(99),KIND(99)
C       J=TO
C       L=FROM
C       I=FIRST LINE MOVING
C       M=DISTANCE TO BE MOVED
C       NOT=1 UP
C       NOT=0 DELETING
C       NOT=-1 DOWN
C
C
      IF(JNDX(L)-L) 3,1,3
1     JNDX(J)=J
2     RETURN
3     IF(JNDX(L)-I) 4,5,12
12    IF(NOT) 11,11,10
4     JNDX(J)=JNDX(L)
      GO TO 2
5     IF(NOT) 11,6,10
6     TYPE 7,PNAME(L)
7     FORMAT(/$THE DEPENDENCY OF $,A,$HAS BEEN DELETED$/)
      JNDX(J)=J
      IF(KIND(J)-8)81,8,9
81    IF(KIND(J)-5) 2,2,8
8     KIND(J)=6
      GO TO 2
9     KIND(J)=11
      GO TO 2
10    JNDX(J)=JNDX(L)+M
      GO TO 2
11    JNDX(J)=JNDX(L)-M
      RETURN
      END
      FUNCTION JUMBER(X,I)
      IF(NUMBER(X)) 4,1,2
1      JUMBER=0
      RETURN
2     IF(I) 3,3,5
3     IF(X) 4,4,10
4     JUMBER=-1
      RETURN
5     IF(X) 4,10,10
10    JUMBER=1
      RETURN
      END
      SUBROUTINE IXJON(X,K,I,J)
      DIMENSION X(99,4),K(99,4)
      DO 1 L=1,4
      X(I,L)=X(J,L)
1     K(I,L)=K(J,L)
      RETURN
      END
      FUNCTION LINGET(INPUT,IFN,IESCAPE)
C
C    THIS FUNCTION GETS A NEW LINE OF INPUT, EITHER FROM THE USERS
C    TERMINAL OR FROM A FILE.  LINGET IS RETURNED AS THE NUMBER OF
C    CHARACTERS IN THE INPUT LINE OR -1 IF AN END OF FILE WAS
C    ENCOUNTERED.  THE ARGUMENT 'INPUT' DETERMINES HOW THE LINE IS TO
C    BE TAKEN IN.  IN FILE INPUT, 'IFN' IS THE FILE BEING READ
C
C     INPUT             MEANING
C    -------   -------------------------------------------------------
C       1       GET A NEW LINE FROM USER TERMINAL
C       2       SAME AS 1, BUT RESET ESCAPE TO 'IESCAPE' AFTER FIRST CHAR.
C       3       GET A NEW LINE FROM FILE IFN, BUT DON'T ECHO IT
C       4       SAME AS 3, BUT ECHO THE LINE
C
C    THE ARGUMENT 'IESCAPE' IS USED WHEN 'INPUT' IS 2.  CONTROL IS THEN
C    TRANSFERRED TO THE MAIN PROGRAM LOCATION DECLARED BY THE
C    ARGUMENT 'IESCAPE'.
C
C      GET A LINE OF INPUT
35    GO TO (100,200,300,400) INPUT
100   CALL ESCNEW(NCH,IESCAPE)
      GO TO 500
C
200   CALL ESC NEW(NCH,IESCAPE)
      GO TO 500
C
300   CALL READ FILE(NCH,IFN)
      GO TO 500
C
400   CALL ECHO FILE(NCH,IFN)
500   LINGET=NCH
C
C    SET SAVED POINTER POSITION TO FIRST CHARACTER IN INPUT LINE
      CALL EDIT SAVE
570   IF(NCH) 700,600,600
600   RETURN
C
700   INPUT=1
       I1T=5
       I2T=2
       CLOSE
      RETURN
      END
TR ** FICHE/FRAME BREAK *****
TRSZTRC1701 SYMSORT

SYM.  PG.LN. IDENT.

+      19 28         +      19  1         +      18 39         +      18 38         
+       6 27         +       5 10         +       4 11         +$      5 21         
+$      5 20         +$      5 17         +$FROM  5 19         +$OLD   5 23         
+$SAME  5 22         +$WITH  5 24         1      28 29         1      28 15         
1      27 31         1      26 25         1      18 36         1       3  2         
10     28 22         10     28  8         10     27  2         10     21 27         
10      3 15         100    29 10         1000   25 16         1001   25 17         
1002   25 18         1006   25 19         1007   25 20         1008   25 22         
1009   25 23         101     4 31         1010   25 25         1011    4 28         
102    24 11         102     4 32         103     4 33         105    24 12         
105     4 35         106     4 30         109     4 36         11     28 10         
11     27  4         11     21 28         11      3 17         110     4 37         
111     5  1         1111   22  8         12     27 34         12      3 18         
120     5  3         121     5  5         122     5  4         13     19  9         
13      4  9         130     5  9         131     5 11         132     5 25         
133     5 37         134     5 14         135     5 16         136     6  1         
137     5 13         138     5 15         14     23 19         14     19 10         
140     6  3         141     5 27         142     6  2         144     5 38         
15     27  8         15     23 22         15     19 12         150    27  6         
150     6  5         1500   23 23         151    27  7         151    23 28         
151    19 13         151     6  6         1511   23 29         152    23 27         
153    23 30         16     27 10         16     19 15         17     27 11         
17     19 17         19     19 18         1915   25  5         1916   24 39         
1917   25  1         1918   25  3         1926   25  4         2      28 17         
2      27 32         2      26 27         2      21 22         2       3  3         
200     6 10         201    20 10         201     6 13         202    20 11         
2021    6 14         203    20 13         203     6 15         2031    6 16         
204    20 19         205    20 20         206    20 22         207    20 24         
2071   20 25         208    20 26         21     27 15         21     23 34         
210    20 29         211    20 30         2111   25 27         2111    6 12         
2112   25 28         2113   25 29         2114   25 31         2115   25 32         
2116   25 34         2117   25 35         2118   25 36         2119   25 38         
2120   25 39         2121   26  2         2130   26  3         22     23 35         
22     19 19         220    20 32         221    23 36         221    20 33         
222    22  5         223    22  6         23     19 20         24     19 22         
24      2 34         25     19 23         253     6 23         2531    6 17         
2533    6 18         2534    6 21         255     6 26         256     6 29         
26     19 25         260     6 30         27     19 26         28     19 27         
3      28 18         3      27 33         3      26 30         3      21 20         
3000    6 34         3001    7  6         301     7  9         3011    7 10         
302     7 16         3021    7  7         303     7 17         305     7 18         
307     7 32         31     26 32         31     19 34         31      3 22         
3122    8  1         3123    7 39         3124    8  2         3125    8  3         
3126    8  4         315     8 11         3152    8 13         3153    8 14         
32      3 25         3201   12 25         3202   12 28         3203   12 29         
3204   12 31         3205   12 32         3206   12 34         3207   12 36         
3208   12 38         3209   10 11         3210   14  8         3211   13 38         
3212   13 39         3213   14  1         3214   14  4         3215   14  5         
3216   14  7         3217   13 10         3218   13 11         3219   13 12         
3220   13 14         3221   13 15         3222   13 24         3223   13 25         
3224   13 27         3225   13 28         3226   13 30         3227   13 32         
3228   13 33         33     19 35         3301    8 35         333     8 38         
334     8 39         335     9  4         3350    9  2         3361    9  6         
3362    9  7         3363    9  8         337     9 10         3371    9 11         
338     9 12         339     9 13         34     19 37         34      3 28         
340     9 15         341     9 17         3411    9 18         342     9 19         
343     9 20         344     9 22         3440    9 27         3442    9 25         
345     9 29         3461    9 32         347     9 38         3471    9 37         
3472    9 33         3473    9 34         3474    9 35         348     9 39         
3480   10  5         3481   10  1         3482   10  3         3483   10  4         
349    10  2         3490   10  7         3492   10 10         35     29  9         
35      3 29         3503   12 26         3509   12 39         3510   13  2         
3511   13  4         3512   13  6         3513   13  7         3514   13  9         
3516   13 17         3517   14  3         3521   12  4         3522   12  5         
3523   12  7         3524   12  8         3525   12 10         3526   12 11         
3527   12 12         3528   12 13         3529   12 15         3530   12 16         
3531   12 18         3532   12 19         3533   11 39         3534   12  1         
36      3 31         3601   10 14         3607   10 15         3608   10 16         
362    10 19         363    10 20         3631   10 21         364    10 22         
365    10 24         3651   10 25         366    10 32         3660   10 27         
3661   10 33         367    10 34         368    10 37         3681   10 36         
3682   11  1         3683   10 30         369    11  2         37     20  1         
370    11  4         3701   10 38         371    11  6         372    11  7         
373    11  9         374    11 11         375    11 12         376    11 14         
377    11 15         3771   11 20         3772   11 21         378    11 23         
3780   11 16         3781   11 18         379    11 26         3791   11 28         
3792   11 27         3793   11 29         3797   11 30         38      3 34         
380    13 36         3800   13 37         381    14  9         3811   11 33         
3812   11 34         3813   11 36         3814   11 37         3815   12 21         
3816   12 22         382    14 10         383    14 12         385    14 15         
386    14 16         388    14 18         389    14 19         39     20  2         
39      3 35         3962   15 21         3971   11 24         3980   14 27         
3995   14 31         3997   14 34         3998   14 33         3999   14 37         
4      28 19         4      27 35         4      26 33         4001   15  2         
41     20  5         41      4  8         42      4  2         43     20  8         
5      28 21         5      27 37         5      26 36         5      18 37         
5       2 33         50      4 19         500    29 17         50000   2 28         
5001   22 19         5002   22 21         5003   22 22         5004   22 27         
5005   22 31         5006   22 32         5007   22 34         5008   22 36         
5010   22 37         5011   22 38         5012   23  1         5013   23  2         
5014   23  7         5015   23 11         5016   23 12         5017   23 14         
5018   23 16         5100   23 17         570    29 20         6      27 38         
600    29 21         6004   22 28         601    15 11         6011   15 17         
6014   23  8         602    15 20         603    15 23         604    15 25         
605    15 27         606    15 28         607    15 29         608    15 34         
610    16  3         613    16  7         618    16  8         6181   16 11         
620    16  2         622    16 10         6522   15 32         666    16 31         
674    16 32         675    16 35         676    16 37         6761   16 33         
677    16 39         678    17  1         679    17  2         680    17  3         
681    17  4         683    17  7         684    17  8         6998    4 12         
7      27 39         7      19  3         77777   4 14         8      28  4         
8      19  5         8       3 13         801    17 20         8011   17 21         
802    17 23         803    17 25         804    17 27         805    17 29         
806    17 31         807    17 28         81     28  3         9      28  6         
9      27  1         9      19  6         9       3  9         900    24 13         
9001   17 35         901    24 15         901    21  1         901    17 37         
902    24 16         902    20 39         902    17 39         903    24 18         
903    20 38         903    18  1         9031    3  1         9032   18  2         
904    24 19         905    24 24         906    24 25         907    24 28         
9071   24 20         908    24 30         909    24 32         910    24 35         
911    24 33         915    24 38         916    25  6         917    25  7         
918    25  9         919    25 14         997    25 10         999    25 15         
999    21  2         C      29  7         C      29  6         
C      29  4         C      29  3         C      29  2         C      29  1         
C      28 39         C      28 37         C      28 36         C      28 35         
C      28 34         C      27 29         C      27 28         C      27 27         
C      27 26         C      27 25         C      27 24         C      27 23         
C      26 22         C      26 21         C      26 20         C      21 17         
C      21 16         C      21 15         C      18 32         C      16 29         
C       7 28         C       7 27         C       7 26         C       7 25         
C       7 24         C       7 23         C       7 22         C       2  1         
C       1 39         C       1 38         C       1 37         C       1 35         
C       1 34         C       1 33         C       1 32         C       1 31         
C       1 30         C       1 29         C       1 28         C       1 27         
C       1 26         C       1 24         C       1 23         C       1 21         
C       1 20         C       1 19         C       1 18         C       1 17         
C       1 16         C       1 14         CM     27 20         CM     22 17         
CM     22  4         CM      2  2         CM101  24 10         CM1300  2 12         
CM14    2 21         CM1500 18  8         CM20   27 13         CM200  29 12         
CM300  29 14         CM306   7 31         CM31   24  6         CM32   24  8         
CM320   8 27         CM346   9 31         CM357  10 12         CM3817 11 32         
CM384  14 14         CM40   20  4         CM40    3 38         CM400  29 16         
CM42   20  7         CM5000 18 13         CM609  15 39         CM630  16 12         
CM632  16 15         CM650  16 18         CM653  16 26         CM665  16 30         
CM682  17  6         CM685  17 10         CM690  17 13         CM700  29 22         
CM800  17 19         CMC    29 18         CMC    29  8         CMC    29  5         
CMC    28 38         CMC    28 33         CMC    27 19         CMC    27 12         
CMC    26 18         CMC    26 17         CMC    26 16         CMC    22 16         
CMC    19 32         CMC    18 33         CMC    18 31         CMC    18 30         
CMC    18 11         CMC    17 18         CMC    16 25         CMC    15 38         
CMC     9  9         CMC     8 26         CMC     8 10         CMC     4 24         
CMC     3 37         CMC     2 20         CMC     2 11         CMC     1 36         
CMC     1 25         CMC     1 22         CMC     1 15         CMC     1 13         
CMCM   27 30         CMCM   26 23         CMCM   22  3         CMCM   21 18         
CMCM   18 34         CMCM    7 29         CMCM    2 35         CMCM10  4 25         
CMCM11 18  4         CMCM13 23 18         CMCM19  6  9         CMCM20 23 32         
CMCM20 20  9         CMCM23 23 39         CMCM26 24  2         CMCM30 19 33         
CMCM30  6 32         CMCM31  8 22         CMCM31  8 20         CMCM31  8 18         
CMCM31  8  7         CMCM31  7 38         CMCM31  7 36         CMCM31  7 34         
CMCM32 12 24         CMCM33  8 34         CMCM36 10 18         CMCM38 11 31         
CMCM39 14 29         CMCM39 14 22         CMCM40 15  1         CMCM50 15  7         
CMCM6  19  2         CMCM60 15 10         CMCM65 14 26         CMCM70 17 16         
CMCM90 20 36         CMCM90 18 16         CMCM90 17 34         CMCMC  26 19         
CMCMC  19 31         CMCMC  19  7         CMCMC  18 29         CMCMC  18 15         
CMCMC  18  7         CMCMC  18  3         CMCMC  17 33         CMCMC  15  9         
CMCMC  15  6         CMCMC  14 39         CMCMC  10 17         CMCMC   7 21         
CMCMC   6 31         CMCMC   6  8         CMCMCM 19  8         CMCMCM 18 12         
CMCMCM 17 15         CODED   1 12         L      28 32         WMCMCM  9 28         
WMCMM3 10  9         [MCMCM 13 35         _$BREA  5 18         _MCMCM 24  4         

TR ** FICHE/FRAME BREAK *****
TRSZTRPLOT1701
      COMMON PNAME,PNOM,PMIN,PMAX,NIMI,NTMT,KIND,KXXX,FLAG,IHEAD,NODET
       COMMON LIMBS
      COMMON NODES,TR,KFLAG,ITEL,ISAVE,NTN,IREF,LISTPAR,LAME
      COMMON NODELIST,NAME,ISTEPS,IREST,TS,TF,TO,DT,NI,NT,TTXXX,JAME
       COMMON NPLIST,INPUT,IFN,I3T,I4T,IDUMMY
      DIMENSION PNAME(99),PNOM(99),PMIN(99),PMAX(99),NI(99),NT(99)
      DIMENSION KIND(99),IREF(99),KXXX(99),NTN(9),NAME(30)
      DIMENSION LISTPAR(79),NODELIST(40),NTMT(99),NIMI(99)
      DIMENSION IDUMMY(199),LAME(20),JAME(20),XXMIN(4),XXMAX(4),DDINC(4)
C
       COMMON B,LP,NNN,II,LINEC,LSTADD
      DIMENSION TTXXX(50),NPLIST(40)
      DIMENSION LP(10),NNN(4),A(40),V(40),P(99),B(300,4),II(4),LINEC(4)
      DIMENSION T(300),LSTADD(11),LIST(360),FMIN(4),FMAX(4),SCALE(4)
       DIMENSION ISCAL(4)
       CALL LDDONE
      IF(FLAG)2001,2000,2001
2000  OPEN(2,INPUT,/LIST/,6HSYMINP)
      CALL RDLIST(LIST,LSTADD,2)
      CLOSE
2001   CALL LDDONE
      CALL DCLESC(ESC)
      ASSIGN 900 TO ESC
      CALL ARM
      CALL SETESC
      IF(KFLAG)6998,6999,6999
6998  TYPE 77777
77777 FORMAT(/$PLOT=17.01  6-17-70$)
      GO TO 900
6999  ASSIGN 900 TO NESC2
C
1     TYPE 5000
5000  FORMAT($OPTIONS: $)
      INODES=0
      INORM=1
      ITEL=0
      IFILE=0
      IOPS=0
       LOPS=0
      NODESWR=0
       ISC=1
C
C
      IF(LINGET(INPUT,IFN,NESC2))1,101,2
2     CALL EDIT EMPTY
      CALL EDIT SAVE
      IF(NUMBER(X)) 20,101,5
5     IF(X) 6,6,8
6     TYPE 7,X
7     FORMAT($**$,I4,$ IS NOT A NODE **$/)
      NODESWR=1
      GO TO 10
C
8      INODES=INODES+1
      LP(INODES)=X
10    CALL KOMMA(0)
      GO TO 2
C
20    LOPS=LOPS+1
      CALL EDIT RESTORE
      GO TO (21,21,21,21,23,24,21,21,25,26),KOMMAND(5,1)+2
21    TYPE 22,LOPS
22    FORMAT($** OPTION NO.$,I2,$ IS INVALID AND IS IGNORED **$/)
      GO TO 10
C
23    IOPS=1
      GO TO 10
C
24    IFILE=1
      GO TO 10
C
25    ITEL=1
      GO TO 10
C
26    ISC=2
      GO TO 10
C
C
101   TYPE 102
102   FORMAT($FROM FILE: $)
      CALL ARM
      IF(LINGET(INPUT,IFN,NESC2)) 101,101,103
103   IF(FILE(JAME,-1,5,JJ,6HBININP)) 101,101,104
104   IF(JJ) 105,105,107
105   TYPE 106
106   FORMAT($** NOT A PLOT FILE **$/)
      CONTINUE
      GO TO 101
C
107   CODE=6HJPSTR
      READ BINARY 5,ACODE,LIMBS,NODES,(NPLIST(I),I=1,NODES)
      CALL COMPAR(CODE,ACODE,IND)
      IF(IND) 105,105,108
C
108   IF(NODES-4) 112,112,109
109   IF(INODES) 110,110,112
110   TYPE 111,NODES
111   FORMAT($**$,I3,$ NODES ON FILE - PLEASE SPECIFY 4 OR LESS **$/)
      GO TO 120
112   IF(INODES-4) 150,150,113
113   TYPE 114
114   FORMAT($** UP TO 4 NODES CAN BE PLOTTED - WHICH ? **$/)
120   CALL ARM
      TYPE 121
121   FORMAT($NODES: $)
C
      INODES=0
1221  IF(LINGET(INPUT,IFN,NESC2)) 120,120,122
122   IF(JUMBER(X,0)) 120,150,123
123   INODES=INODES+1
      LP(INODES)=X
      CALL KOMMA(0)
      GO TO 122
C
C
130   INODES=0
      DO 131 I=1,NODES
      INODES=INODES+1
      LP(INODES)=NPLIST(I)
131   NNN(INODES)=I
      GO TO 160
C
C
150   IF(INODES) 130,130,1500
1500  KERROR=0
      DO 155 J=1,INODES
      DO 151 I=1,NODES
      IL=I
      IF(LP(J)-NPLIST(I)) 151,154,151
151   CONTINUE
      TYPE 152,LP(J)
152   FORMAT($**$,I5,$ IS NOT A NODE **$/)
      KERROR=1
      GO TO 155
154   NNN(J)=IL
155   CONTINUE
      IF(KERROR) 160,160,120
C
C
160   IF(IFILE) 161,161,162
161   ITEL=0
      NAME(1)=3HTEL
      NAME(2)=3HETY
      NAME(3)=3HPE
      GO TO 170
C
C
162   TYPE 163
163   FORMAT($TO FILE: $)
      CALL ARM
      IF(LINGET(INPUT,IFN,NESC2)) 162,162,164
164   IF(FILE(NAME,-1,I3T,JJ,6HSYMOUT)) 162,162,170
C
C
170   IF(IOPS) 180,180,171
171   TYPE 172
172   FORMAT($FROM TIME: $)
      IF(LINGET(INPUT,IFN,NESC2)) 171,171,173
173   IF(JUMBER(X,1)) 172,172,174
174   TS=X
      CALL KOMMA(0)
1741  IF(JUMBER(X,0)) 175,175,177
175   TYPE 176
176   FORMAT($TO TIME: $)
      IF(LINGET(INPUT,IFN,NESC2)) 175,175,1741
177   TF=X
C
C
180   ON END FILE NDONE,XI
      ASSIGN 200 TO NDONE
      IF(IOPS) 181,181,190
181   IKL=0
      DO 185 I=1,300
      READ BINARY 5,T(I)
      READ BINARY 5,(V(J),J=1,NODES),(A(J),J=1,NODES),(P(J),J=1,LIMBS)
      IKL=IKL+1
      DO 185 JJJ=1,INODES
185   B(I,JJJ)=V(NNN(JJJ))
1851  CONTINUE
      TYPE 186
186   FORMAT($** MORE THAN 300 ENTRIES ON FILE **$/)
      TYPE 187,T(300)
187   FORMAT($ TIME (300) = $,1PE11.4/)
      IOPS=1
      READ BINARY 5,ACODE,LIMBS,NODES,(NPLIST(I),I=1,NODES)
      GO TO 171
C
C
190   IKL=0
      DO 195 I=1,1000
      READ BINARY 5,TEEPEE
      IF(TEEPEE-TS) 194,191,191
191   IF(TEEPEE-TF) 192,192,200
192   IKL=IKL+1
      IF(IKL-300) 1921,1921,1851
1921  T(IKL)=TEEPEE
      READ BINARY 5,(V(J),J=1,NODES),(A(J),J=1,NODES),(P(J),J=1,LIMBS)
      DO 193 JJJ=1,INODES
193   B(IKL,JJJ)=V(NNN(JJJ))
      GO TO 195
194   READ BINARY 5,(V(J),J=1,NODES),(A(J),J=1,NODES),(P(J),J=1,LIMBS)
195   CONTINUE
C
C
200   CONTINUE
      IF(IKL) 8057,8057,8058
8057  TYPE 8069
8069  FORMAT($** TIMES/INFO. REQUIRED NOT ON THIS FILE **$/)
      GO TO 900
8058  IF(INORM) 8059,8059,8100
8100  DO 8102 I=1,INODES
      XXMIN(I)=1E50
8102  XXMAX(I)=-1E50
      DO 8101 I=1,IKL
      DO 8101 J=1,INODES
      BBB=B(I,J)
      IF(XXMIN(J)-BBB) 8302,8101,8301
8301  XXMIN(J)=BBB
8302  IF(XXMAX(J)-BBB) 8303,8101,8101
8303  XXMAX(J)=BBB
8101  CONTINUE
C      DO 8103 I=1,INODES
C      8103    DDINC(I)=(XXMAX(I)-XXMIN(I))/59.
      GO TO 1201
8059  XXXMIN=1E50
      XXXMAX=-1E50
      DO 201 I=1,IKL
      DO 201  J=1,INODES
      BBB=B(I,J)
      IF(XXXMIN-BBB) 8402,201,8401
8401  XXXMIN=BBB
8402  IF(XXXMAX-BBB) 8403,201,201
8403  XXXMAX=BBB
201   CONTINUE
C
1201  IIA=1H'
      IIB=1H
      II(1)=1H*
      II(2)=1H+
      II(3)=1H#
      II(4)=1H@
500    DO 539 I=1,INODES
       FMIN(I)=XXMIN(I)
       GO TO (520,502)ISC
502    TYPE 505,LP(I)
505    FORMAT(/$V$,I3,$  MIN:$)
       IF(LINGET(INPUT,IFN,NESC2))502,520,510
510    XXXX=NUMBER(X)
515    XXMIN(I)=X
520    CONTINUE
       FMAX(I)=XXMAX(I)
       GO TO (535,522)ISC
522    TYPE 525,LP(I)
525    FORMAT($V$,I3,$  MAX:$)
       IF(LINGET(INPUT,IFN,NESC2))520,535,526
526    XXXX=NUMBER(X)
530    IF(X-XXMIN(I))522,528,528
528    XXMAX(I)=X
535    CONTINUE
       ISCAL(I)=59
       GO TO(539,540)ISC
540    TYPE 536,LP(I)
536    FORMAT($V$,I3,$  PLOT WIDTH (60 FOR FULL SCALE TEL):$)
       IF(LINGET(INPUT,IFN,NESC2))536,539,537
537    IF(JUMBER(X,1))536,536,538
538    ISCAL(I)=ABS(X)
539    CONTINUE
       DO 572 J=1,INODES
572    DDINC(J)=(XXMAX(J)-XXMIN(J))/ISCAL(J)
C
C
      WRITE 3,202
202   FORMAT(////$KEY$/$---$//)
      IF(ITEL)2031,2031,203
203   TYPE 202
C
C
2031  IF(INORM) 2032,2032,8104
8104  DO 8105 I=1,INODES
      WRITE 3,8106,LP(I),II(I),XXMIN(I),XXMAX(I),DDINC(I)
8106  FORMAT($NODE$,I4,$ = $,A,$  MIN = $,1PE11.4,$  MAX = $,1PE11.4,
+     4X,1PE10.4,$ VPS$/)
      IF(ITEL) 8105,8105,8107
8107  TYPE 8106,LP(I),II(I),XXMIN(I),XXMAX(I),DDINC(I)
8105  CONTINUE
      WRITE 3,8202
8202  FORMAT(70($'$))
      IF(ITEL) 210,210,8203
8203  TYPE 8202
      GO TO 210
2032  DO 206 I=1,INODES
      WRITE 3,204,LP(I),II(I)
204   FORMAT($NODE$,I4,$ = $,A/)
      IF(ITEL) 206,206,205
205   TYPE 204,NNN(I),II(I)
206   CONTINUE
C
C
      DINC=(XXXMAX-XXXMIN)/59.0
      XXXNOM=(XXXMAX-XXXMIN)/2.0+XXXMIN
C
C
      WRITE 3,209,DINC,XXXMIN,XXXNOM,XXXMAX
209   FORMAT(/1PE11.4,$ VOLTS PER SPACE$//$   TIME    $,1PE11.4,
+     2(14X,1PE11.4)/70($'$))
      IF(ITEL) 210,210,211
211   TYPE 209,DINC,XXXMIN,XXXNOM,XXXMAX
C
C
210   DO 400 J=1,IKL
       IDUM=IDUM+1
C
      WRITE 3,301,T(J)
301   FORMAT(/1PE11.4)
      IF(ITEL) 303,303,302
302   TYPE 301,T(J)
303   DO 305 I=1,INODES
      IF(INORM) 3032,3032,8109
8109  BX=B(J,I)-XXMIN(I)
       IF(DDINC(I)-1E-50)31,30,30
31     BXD=0.
       GO TO  8200
30    BXD=BX/DDINC(I)
      GO TO 8200
3032  BX=B(J,I)-XXXMIN
       IF(DINC-1E-50)32,33,33
32     DINC=0.
       GO TO 8200
33    BXD=BX/DINC
8200  LINEC(I)=BXD+12.5
      IF(LINEC(I)-12) 3031,305,304
3031   LINEC(I)=12
      GO TO 305
304   IF(LINEC(I)-(ISCAL(I)+12)) 305,305,306
306   LINEC(I)=ISCAL(I)+12
305   CONTINUE
C
C
      DO 350 I=12,150
      DO 310 LL=1,INODES
      KL=LL
      IF(LINEC(LL)-I) 310,320,310
310   CONTINUE
      IF(I-41) 314,311,316
311    WRITE 3,312,IIA
312   FORMAT(A1)
      IF(ITEL) 350,350,313
313    TYPE 312,IIA
      GO TO 350
314   WRITE 3,312,IIB
      IF(ITEL) 350,350,315
315   TYPE 312,IIB
      GO TO 350
316   DO 317 LLI=1,INODES
      IF(I-LINEC(LLI))314,317,317
317   CONTINUE
      GO TO 400
320   WRITE 3,312,II(KL)
      IF(ITEL) 350,350,321
321   TYPE 312,II(KL)
350   CONTINUE
400   CONTINUE
900   CONTINUE
      CALL ARM
      CALL TERMOV
      END
      FUNCTION JUMBER(X,I)
      IF(NUMBER(X)) 4,1,2
1      JUMBER=0
      RETURN
2     IF(I) 3,3,5
3     IF(X) 4,4,10
4     JUMBER=-1
      RETURN
5     IF(X) 4,10,6
6     IF(X-999) 10,10,7
7     TYPE 8
8     FORMAT(/$** NODE NUMBERS MUST BE INTEGERS IN THE RANGE 0-999 **$/)
      GO TO 4
10    JUMBER=1
      RETURN
      END
      FUNCTION LINGET(INPUT,IFN,IESCAPE)
C
C    THIS FUNCTION GETS A NEW LINE OF INPUT, EITHER FROM THE USERS
C    TERMINAL OR FROM A FILE.  LINGET IS RETURNED AS THE NUMBER OF
C    CHARACTERS IN THE INPUT LINE OR -1 IF AN END OF FILE WAS
C    ENCOUNTERED.  THE ARGUMENT 'INPUT' DETERMINES HOW THE LINE IS TO
C    BE TAKEN IN.  IN FILE INPUT, 'IFN' IS THE FILE BEING READ
C
C     INPUT             MEANING
C    -------   -------------------------------------------------------
C       1       GET A NEW LINE FROM USER TERMINAL
C       2       SAME AS 1, BUT RESET ESCAPE TO 'IESCAPE' AFTER FIRST CHAR.
C       3       GET A NEW LINE FROM FILE IFN, BUT DON'T ECHO IT
C       4       SAME AS 3, BUT ECHO THE LINE
C
C    THE ARGUMENT 'IESCAPE' IS USED WHEN 'INPUT' IS 2.  CONTROL IS THEN
C    TRANSFERRED TO THE MAIN PROGRAM LOCATION DECLARED BY THE
C    ARGUMENT 'IESCAPE'.
C
C      GET A LINE OF INPUT
35    GO TO (100,200,300,400) INPUT
100   CALL NEW LINE(NCH)
      GO TO 500
C
200   CALL ESC NEW(NCH,IESCAPE)
      GO TO 500
C
300   CALL READ FILE(NCH,IFN)
      GO TO 500
C
400   CALL ECHO FILE(NCH,IFN)
500   LINGET=NCH
C
C    SET SAVED POINTER POSITION TO FIRST CHARACTER IN INPUT LINE
      CALL EDIT SAVE
570   IF(NCH) 700,600,600
600   RETURN
C
700   INPUT=1
       CLOSE
      RETURN
      END
TR ** FICHE/FRAME BREAK *****
TRSZTRPLOT1701 SYMSORT

SYM.  PG.LN. IDENT.

+       7 31         +       7 12         1       9 12         10      9 23         
10      2 12         100    10  4         102     2 29         103     2 32         
104     2 33         105     2 34         106     2 35         109     3  4         
110     3  5         111     3  6         112     3  8         113     3  9         
114     3 10         120     3 11         121     3 13         122     3 16         
1221    3 15         123     3 17         131     3 25         1500    3 28         
151     3 33         152     3 35         154     3 38         155     3 39         
161     4  3         163     4  9         164     4 12         171     4 14         
172     4 15         173     4 17         174     4 18         1741    4 20         
175     4 21         176     4 22         177     4 24         181     4 28         
185     4 34         1851    4 35         186     4 37         187     4 39         
191     5  8         192     5  9         1921    5 11         193     5 14         
194     5 16         195     5 17         2       9 14         2       2  2         
2000    1 17         2001    1 20         201     6  8         202     7  5         
203     7  7         2032    7 21         204     7 23         205     7 25         
206     7 26         209     7 30         21      2 17         211     7 33         
22      2 18         3       9 15         30      8  7         301     7 37         
302     7 39         303     8  1         3031    8 16         3032    8  9         
304     8 18         305     8 20         306     8 19         31      8  5         
310     8 25         311     8 27         312     8 28         313     8 30         
314     8 32         315     8 34         316     8 36         317     8 38         
32      8 11         320     9  1         321     9  3         33      8 13         
35     10  3         350     9  4         4       9 16         400     9  5         
5       9 18         5       2  5         500    10 11         500     6 15         
5000    1 31         502     6 18         505     6 19         510     6 21         
515     6 22         520     6 23         522     6 26         525     6 27         
526     6 29         528     6 31         530     6 30         535     6 32         
536     6 36         537     6 38         538     6 39         539     7  1         
540     6 35         570    10 14         572     7  3         6       9 19         
6       2  6         600    10 15         6998    1 26         6999    1 29         
7       9 20         7       2  7         77777   1 27         8       9 21         
8057    5 20         8058    5 23         8059    5 38         8069    5 21         
8100    5 24         8101    5 34         8102    5 26         8104    7  9         
8105    7 15         8106    7 11         8107    7 14         8109    8  3         
8200    8 14         8202    7 17         8203    7 19         8301    5 31         
8302    5 32         8303    5 33         8401    6  5         8402    6  6         
8403    6  7         900     9  6         C      10  1         
C       9 39         C       9 37         C       9 36         C       9 35         
C       9 34         C       9 33         C       9 31         C       9 30         
C       9 29         C       9 28         C       5 36         C       5 35         
CM      7 36         CM      3 14         CM      1 10         CM1     1 30         
CM107   2 38         CM108   3  3         CM1201  6  9         CM20    2 14         
CM200  10  6         CM23    2 20         CM24    2 22         CM25    2 24         
CM26    2 26         CM300  10  8         CM400  10 10         CM700  10 16         
CM8     2 10         CMC    10 12         CMC    10  2         CMC     9 38         
CMC     9 32         CMC     9 27         CMCM    8 21         CMCM    7 29         
CMCM    7 27         CMCM    7  4         CMCM    2  1         CMCM10  2 28         
CMCM13  3 21         CMCM15  3 27         CMCM16  4  8         CMCM16  4  2         
CMCM17  4 13         CMCM18  4 25         CMCM19  5  4         CMCM20  7  8         
CMCM20  5 18         CMCM21  7 34         L       9 26         
TR ** FICHE/FRAME BREAK *****
TRC
             TR-CODED  CIRCUIT ANALYSIS PROGRAM


       TR-CODED  IS A COMPUTER PROGRAM WHICH WILL PERFORM
TRANSIENT ANALYSIS OF LINEAR AND NONLINEAR CIRCUITS.  CIRCUITS MAY
INCORPORATE : 1) RESISTORS, 2) CONDUCTORS, 3) CAPACITORS,
4) INDUCTORS, 5) INDEPENDENT VOLTAGE SOURCES, 6) CURRENT AND
VOLTAGE DEPENDENT VOLTAGE SOURCES, 7) INDEPENDENT CURRENT SOURCES,
8) CURRENT AND VOLTAGE DEPENDENT CURRENT SOURCES, 9) OPEN CIRCUITS,
10) SHORT CIRCUITS, 11) DIODES OBEYING THE EXPONENTIAL (NONLINEAR)
LAW, 12) TRANSISTORS (EBERS-MOLL MODEL) AND 13) SWITCHES.

       SOURCES MAY BE CONSTANT (BATTERIES), SINE, COSINE, SQUARE,
OR SAWTOOTH.  ALL WAVESHAPES HAVE A USER SPECIFIED START TIME.
ALSO THE  PERIOD AND PULSEWIDTH OF EACH SOURCE IS USER DEFINED.
COMBINATIONS OF THE ABOVE SOURCES WILL YIELD MANY COMMONLY USED
WAVESHAPES.  IN ADDITION INITIAL CONDITIONS MAY BE SPECIFIED FOR
CAPACITORS AND INDUCTORS.

       THE PROGRAM CAN HANDLE 40 NODES AND 99 PARAMETERS.

       THE PROGRAM PRINTS NODE VOLTAGES.  BRANCH CURRENTS MAY BE
OBTAINED.

       NODE VOLTAGES MAY BE PLOTTED AS A FUNCTION OF TIME.

       THE PROGRAM IS DESIGNED TO BE USED BY A PERSON WITH NO
KNOWLEDGE OF PROGRAMMING.
TR ** FICHE/FRAME BREAK *****
TRH
COMMAND       DESCRIPTION
-------       -----------
HELP          REPRINTS THIS LIST
?             REPRINTS THIS LIST
CAPABILITIES  DESCRIBES PROGRAM CAPABILITIES
INSTRUCTIONS  HOW TO EXECUTE THE PROGRAM
CREDITS       IMPLEMENTED BY TYMSHARE
CHARGES       YOUR REGULAR CHARGE
VERSION       LATEST UPDATE
TAKE FROM     TO TAKE ALL THE FOLLOWING COMMANDS FROM A FILE
READ FROM     READS CIRCUIT DESCRIPTION FROM A DATA FILE
WRITE ON      WRITES CIRCUIT DESCRIPTION ONTO A DATA FILE
ENTER         DELETES THE PRESENT CIRCUIT DESCRIPTION (IF ANY),
              AND READIES  TR-CODED  TO ACCEPT A NEW
              CIRCUIT DESCRIPTION
ADD           USED TO ADD NEW CIRCUIT ELEMENTS TO THOSE
              ALREADY DEFINED
CHANGE        PRINTS OUT THE OLD ELEMENT DESCRIPTION BEFORE 
              ACCEPTING A NEW ELEMENT DESCRIPTION
MODIFY        ACCEPTS A NEW ELEMENT DESCRIPTION
DELETE        DELETES ELEMENTS FROM THE CIRCUIT
PRINT         PRINTS OUT  THE ELEMENTS PRECEEDED BY A HEADING
LIST          PRINTS OUT THE ELEMENTS WITHOUT A HEADING
QUIT          RETURNS TO EXECUTIVE LEVEL  (-)
NOMINAL SOLUTION  THE NODE VOLTAGES ARE PRINTED OUT.  THE NOMINAL
              VALUES OF ALL PARAMETERS ARE USED
PLOT          PLOTS NODE VOLTAGE SOLUTIONS AS A FUNCTION OF TIME
SCALE         ENABLES THE USER TO SCALE HIS PLOTTED OUTPUT.


ANY OF THE ABOVE COMMANDS MAY BE SHORTENED TO THE SMALLEST
SUBSET OF CHARACTERS WHICH UNIQUELY DISTINGUISH THE COMMAND 
FROM ALL OTHER COMMANDS, I.E. "CHARGES" MAY BE ABBREVIATED TO "CHAR".
TR ** FICHE/FRAME BREAK *****
TRI
CIRCUITS MAY INCORPORATE THE FOLLOWING ELEMENTS
1)  RESISTORS (R)
2)  CONDUCTORS (G)
3)  CAPACITORS (C)
4)  INDUCTORS (L)
5)  INDEPENDENT VOLTAGE SOURCES (E)
6)  CURRENT AND VOLTAGE DEPENDENT VOLTAGE SOURCES
    (DEPENDENCY: I R1, E E1)
7)  INDEPENDENT CURRENT SOURCES (I)
8)  CURRENT AND VOLTAGE DEPENDENT CURRENT SOURCES
    (DEPENDENCY: I R1, E E1)
9)  OPEN CIRCUITS (O)
10) SHORT CIRCUITS (S)
11) DIODES OBEYING THE EXPONENTIAL (NONLINEAR) LAW (D)
12) TRANSISTORS (EBERS-MOLL MODEL) (T)
13) SWITCHES (X) (DEPENDENCY: R1)


       THE FOLLOWING EXAMPLE USES (CR) TO DENOTE CARRIAGE RETURN.
EVERY RESPONSE TYPED BY THE USER IS UNDERLINED.



-TR-CODED(CR)
 ------------

TRANSIENT CIRCUIT ANALYSIS PROGRAM



3/21      15:15


:ENTER(CR)
 ---------
# 1 E1(CR)
    ------
FROM: 0(CR)
      -----
TO: 1(CR)
    -----
NOMINAL VALUE: 1(CR)
               -----
DEPENDENCY:(CR)
           ----
START TIME: 0(CR)
            -----
TYPE:(CR)
     ----
#2 R1,1,2,1000
   -----------
#3 C1,0,2,1E-6(CR)
   ---------------
INITIAL VOLTAGE: 0(CR)
                 -----
#5 (CR)
   ----
:WRITE /TEST/
 ------------
 NEW FILE(CR)
         ----


:NOM 2(CR)
 ---------
FINISH TIME: 1E-3(CR)
             --------
OUTPUT INTERVAL: .1E-3(CR)
                 ---------
NUMBER OF INTEGRATION STEPS PER OUTPUT INTERVAL: 1(CR)
                                                 -----




VOLTAGES FOR:


   NODE   2     TIME
   --------    -------
   .0000E 0   .0000E 0
  9.5000E-2  1.0000E-4
  1.8098E-1  2.0000E-4
  2.5878E-1  3.0000E-4
  3.2920E-1  4.0000E-4
  3.9292E-1  5.0000E-4
  4.5060E-1  6.0000E-4
  5.0279E-1  7.0000E-4
  5.5002E-1  8.0000E-4
  5.9277E-1  9.0000E-4
  6.3146E-1  1.0000E-3
TR ** FICHE/FRAME BREAK *****
TRLIST1701
10
27
4
READ FROM
4
WRITE ON
7
ENTER PARAMETERS
6
ADD PARAMETERS
7
CHANGE PARAMETERS
7
MODIFY PARAMETERS
7
PRINT PARAMETERS
6
LIST PARAMETERS
7
DELETE PARAMETERS
3
QUIT
7
NOMINAL 
2
DIF
2
STA
2
PAR
8
WORST CASE ANALYSIS
7
SET UP FOR RESTART
2
INC
3
PLOT
4
VERSION
5
CAPABILITIES
5
INSTRUCTIONS
4
CREDITS
2
RUN
2
?
3
HELP
4
CHARGES
5
TAKE FROM
12
2
R
2
G
2
C
2
L
2
E
2
I
2
O
2
S
2
H
2
D
2
T
2
X
3
2
AC
2
DC
4
TRANSIENT
2
2
NO
2
YES
8
5
NO HEADING
3
PHASE
4
OPTIONS
3
FILE
4
RESTART
3
SAVE
4
TELETYPE
3
SCALE
4
3
FROM
2
TO
2
BY
2
IN
1
2
;
5
2
E
2
V
2
I
3
OPEN
3
CLOSED
2
4
AMPLITUDE
3
PHASE
35
3
COSINE
3
SINE
3
NODES
4
NOMINAL
4
MAXIMUM
4
MINIMUM
4
TOLERANCE
5
DEPENDENCY
7
SATURATION CURRENT
6
THERMAL VOLTAGE
4
INITIAL
3
NAME
2
HI
2
HO
2
HR
2
HF
2
ICS
2
IBS
2
IEA
2
VBE
2
VST
2
BN
2
BI
2
ICB
2
VT
6
PULSE DURATION
4
CURRENT
4
VOLTAGE
3
TIME
3
SQUARE
4
SAWTOOTH
3
VALUE
3
TYPE
2
NPN
2
PNP
TR ** FICHE/FRAME BREAK *****
TRMASTERSTATUS

06/01   10:03     RICHARD E. ROY
STF #1078
PACKAGE: TR-CODED-17.01
FILE NAMES OR DIRECTORY FILE NUMBERS:
TR,TRLIST1701,SZTRC1701,SZKTR1701,SZTRPLOT1701,BTC,BTK,BTP,TRC,TRI,TRI,TRNEWS
TR-CODED-17.01  12 FILES LAST 4 TRC,TRI,TRH,TRNEWS
TR ** FICHE/FRAME BREAK *****
TRNEWS
AN IMPROVEMENT IN THE ITERATION PROCEDURE HAS BEEN IMPLEMENTED
ON THE NEW  TR-CODED  VERSION 17.01.  AS A RESULT, CIRCUITS THAT
FAILED TO CONVERGE WILL NOW CONVERGE.  IF YOU HAVE HAD CIRCUITS
THAT HAVE FAILED TO CONVERGE, PLEASE TRY THEM ON THE NEW VERSION.

THE NEW VERSION OF  TR-CODED  HAS A NEW COMMAND CALLED:  TAKE FROM  .
THIS COMMAND CAN BE USED TO TAKE COMMANDS FROM A FILE.  THE INPUT
MAY BE PREPARED OFF LINE ,READ ONTO A FILE, AND ACCESSED THROUGH
THE  TAKE FROM  COMMAND. THE COMMAND IS NOT DOCUMENTED IN THE
NEW  TR-CODED  MANUAL,  HOWEVER IT IS DOCUMENTED IN THE NEW AND OLD
MICAP  AND  ANALOG  MANUALS.


A NEW OPTION HAS BEEN ADDED TO THE  TR-CODED  PLOT CAPABILITY.
IF THE USER TYPES  SCALE  IN RESPONSE TO THE REQUEST FOR OPTIONS:
THE PROGRAM WILL REQUEST INDIVIDUAL SCALE MINIMUM, MAXIMUM, AND
PLOT FIELD WIDTHS.
  iic
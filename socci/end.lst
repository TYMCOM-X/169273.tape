F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1
F3SIM.MAC	13-MAR-81 18:58	

				TITLE F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE
				;TRANSFORM ALL [] TO ()
				;TRANSFORM ALL OBUS-0 TO OBUS-0
				LALL

				DEFINE D(ARG) <
					MOVE	D,<ARG>
				>
				DEFINE DEST(ARG) <
					MOVEM	D,<ARG>
				>
				DEFINE CYLEN(ARG)<>
				DEFINE CONST(ARG)<ARG>
		241000	000000	ROTI=241000000000
				DEFINE ROT(ARG)<ROTI D,<ARG>>
				DEFINE ACSEL(ARG)<>
				DEFINE $ <>
				DEFINE MASK(ARG)<AND D,[<1_<ARG+1>>-1]>
				DEFINE SPEC(ARG)<>
				DEFINE NORM <>
				DEFINE C550 <>
				DEFINE FIXM1 <>
				DEFINE SHORT <>
				DEFINE JUMP(ARG) <AOJE COND,<ARG>>
		260000	000000	PUSHJI=260000000000
				DEFINE PUSHJ(ARG) <AOSN COND
							PUSHJI P,<ARG>>

				DEFINE COND(ARG) <
				IFIDN <ARG> <OBUS-0> <SKIPGE D>
				IFIDN <ARG> <-OBUS-0> <SKIPL D>
				IFIDN <ARG> <OBUS=0> <SKIPN D>
				IFIDN <ARG> <-OBUS=0> <SKIPE D>
					SETO	COND,
				>


				DEFINE ALU(ARG) <
				INST=0
				IFIDN <ARG> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
				IFIDN <ARG> <D#Q> <INST==XOR D,Q>
				IFIDN <ARG> <D-1> <INST==SUBI D,1>
				IFIDN <ARG> <Q-1> <INST==SUBI Q,1>
				IFIDN <ARG> <Q-D> <INST==SUBM Q,D>
				IFIDN <ARG> <Q> <INST==MOVE D,Q>
				IFIDN <ARG> <D+AC> <INST==ADD D,AC>
				IFIDN <ARG> <AC-D> <INST==SUBM AC,D>
				IFIDN <ARG> <D-Q> <INST==SUB D,Q>
				IFIDN <ARG> <DORQ> <INST==IOR D,Q>
				IF2,<IFE INST,<PRINTX ALU ARG NOT DEFINED>>
					INST
				>

F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-2
F3SIM.MAC	13-MAR-81 18:58	

			000001		HOLD=1
			000001		MEM=HOLD
			000002		AR=2
			000003		Q=3
			000004		D=4
			000005		AC=5
			000006		COND=6
			000017		P=17
	000000'	000000	000000	RTRAIL:	0
	000001'	000000	000000	ADJ.AC:	0
	000002'	000000	000000	ADJ.ARG:	0
	000003'	000000	000000	ADJ.PTR:	0
	000004'	000000	000000	BYTE.S:	0
	000005'	000000	000000	BYTE.P:	0
	000006'	000000	000000	DEVADR:	0
			000000	ADR=0
			000006'	DEV=DEVADR
				00010	;ADJBP INSTRUCTION

	000007'			00030	ADJBP:	FIXM1 ^^$^^
				00040		D(CONST 11)^
	000007'	200200	000011			MOVE	D,<CONST 11>^11>^
					^ DEST(DEV-ADR)^
	000010'	202200	000006'			MOVEM	D,<DEV-ADR>
					^ CYLEN(FIXM)^^ $^^
				00050			;SETUP DEV-ADR FOR SCRATCH REGISTERS
				00060		D(MEM)^
	000011'	200200	000001			MOVE	D,<MEM>
					^ ROT(11. + 1)^ROTI D,<11. + 1>^ MASK(6) DEST(BYTE.SIZE Q) SPEC(DEST-A-MEM) COND(OBUS=0) C550 J
Q	000012'	241200	000001		UMP(ADJSIZ0) $
				00070			;IF SIZE IS ZERO, JUST GO AND STORE POINTER.
				00080			;ALSO SAVE SIZE IN AMEM AND Q FOR LATER.
				00090		D(CONST 44)^
	000013'	200200	000044			MOVE	D,<CONST 44>^44>^
					^ ALU(D#Q)^
			000000		INST=0
					IFIDN <D#Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
		430200	000003		IFIDN <D#Q> <D#Q> <INST==XOR D,Q>
					IFIDN <D#Q> <D-1> <INST==SUBI D,1>
					IFIDN <D#Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <D#Q> <Q-D> <INST==SUBM Q,D>
					IFIDN <D#Q> <Q> <INST==MOVE D,Q>
					IFIDN <D#Q> <D+AC> <INST==ADD D,AC>
					IFIDN <D#Q> <AC-D> <INST==SUBM AC,D>
					IFIDN <D#Q> <D-Q> <INST==SUB D,Q>
					IFIDN <D#Q> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU D#Q NOT DEFINED>>
	000014'	430200	000003			INST
					^ COND(-OBUS=0)^
					IFIDN <-OBUS=0> <OBUS-0> <SKIPGE D>
					IFIDN <-OBUS=0> <-OBUS-0> <SKIPL D>
					IFIDN <-OBUS=0> <OBUS=0> <SKIPN D>
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1
FOO.SLO	13-MAR-81 18:51	

	000015'	332000	000004		IFIDN <-OBUS=0> <-OBUS=0> <SKIPE D>
	000016'	474300	000000			SETO	COND,
Q	000017'	342300	000022'		^ C550 ^^JUMP(ADJN36)^AOJE COND,<ADJN36>^ $
				00100			;JUMP IF SIZE NOT 36.
				00110		D(MEM)^
	000020'	200200	000001			MOVE	D,<MEM>
					^ MASK(30.)^AND D,[<1_<30.+1>>-1]^ ALU(D-1) DEST(BYTE.PTR) SPEC(DEST-A-MEM) JUMP(ADJW36) NORM $
Q	000021'	404200	000152'
				00120			;SUBTRACT 1 FROM POINTER
				00130			;CLEAR OUT P FIELD, SUBTRACT 1 FROM Y IN POINTER
	000022'			00140	ADJN36:	D(MEM)^
	000022'	200200	000001			MOVE	D,<MEM>
					^ DEST(BYTE.PTR)^
	000023'	202200	000005'			MOVEM	D,<BYTE.PTR>
					^ SPEC(DEST-A-MEM)^^ NORM ^^$^^
				00150			;STORE POINTER INTO AMEM 1 BECAUSE NEED MEM FOR DIVISOR
	000024'			00160	ADJW36:	ALU(Q)^
			000000		INST=0
					IFIDN <Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q> <D#Q> <INST==XOR D,Q>
					IFIDN <Q> <D-1> <INST==SUBI D,1>
					IFIDN <Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <Q> <Q-D> <INST==SUBM Q,D>
		200200	000003		IFIDN <Q> <Q> <INST==MOVE D,Q>
					IFIDN <Q> <D+AC> <INST==ADD D,AC>
					IFIDN <Q> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q> <D-Q> <INST==SUB D,Q>
					IFIDN <Q> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q NOT DEFINED>>
	000024'	200200	000003			INST
					^ DEST(HOLD)^
	000025'	202200	000001			MOVEM	D,<HOLD>
					^ NORM ^^$^^
				00170			;GOING TO DIVIDE BY SIZE, PUT IN MEM.
				00180		D(BYTE.PTR)^
	000026'	200200	000005'			MOVE	D,<BYTE.PTR>
Q	000027'	241200	000006		^ ROT(6)^ROTI D,<6>^ MASK(6) DEST(Q) NORM $
				00190			;PUT P INTO Q FOR DIVIDE.
				00200		ACSEL(AC)^^ ALU(AC)^
			000000		INST=0
					IFIDN <AC> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <AC> <D#Q> <INST==XOR D,Q>
					IFIDN <AC> <D-1> <INST==SUBI D,1>
					IFIDN <AC> <Q-1> <INST==SUBI Q,1>
					IFIDN <AC> <Q-D> <INST==SUBM Q,D>
					IFIDN <AC> <Q> <INST==MOVE D,Q>
					IFIDN <AC> <D+AC> <INST==ADD D,AC>
					IFIDN <AC> <AC-D> <INST==SUBM AC,D>
					IFIDN <AC> <D-Q> <INST==SUB D,Q>
					IFIDN <AC> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU AC NOT DEFINED>>
	000030'	000000	000000			INST
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-2
FOO.SLO	13-MAR-81 18:51	

					^ DEST(ADJ.ARG)^
	000031'	202200	000002'			MOVEM	D,<ADJ.ARG>
					^ SPEC(DEST-A-MEM)^^ NORM ^^$^^
				00210			;MUST CLEAR OUT AC, SO STORE ARG IN AMEM 2
				00220		ALU(0)^
			000000		INST=0
		400000	000004		IFIDN <0> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <0> <D#Q> <INST==XOR D,Q>
					IFIDN <0> <D-1> <INST==SUBI D,1>
					IFIDN <0> <Q-1> <INST==SUBI Q,1>
					IFIDN <0> <Q-D> <INST==SUBM Q,D>
					IFIDN <0> <Q> <INST==MOVE D,Q>
					IFIDN <0> <D+AC> <INST==ADD D,AC>
					IFIDN <0> <AC-D> <INST==SUBM AC,D>
					IFIDN <0> <D-Q> <INST==SUB D,Q>
					IFIDN <0> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU 0 NOT DEFINED>>
	000032'	400000	000004			INST
					^ ACSEL(AC)^^ DEST(AC)^
	000033'	202200	000005			MOVEM	D,<AC>
	000034'	356000	000006		^ PUSHJ(SH6DIV)^AOSN COND
U	000035'	260740	000000*					PUSHJI P,<SH6DIV>^ SHORT $
				00230			;CLEAR OUT HI ORDER DIVIDEND, DIVIDE. REMAINDER
				00240			; COMES BACK IN AC, QUOTIENT IN Q
				00250			;QUOTIENT IS NUMBER OF BYTES IN PART OF WORD TO RIGHT
				00260			;OF CURRENT BYTE, REMAINDER IS NUMBER OF WASTED TRAILING
				00270			;BITS.
				00280		ACSEL(AC)^^ ALU(AC)^
			000000		INST=0
					IFIDN <AC> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <AC> <D#Q> <INST==XOR D,Q>
					IFIDN <AC> <D-1> <INST==SUBI D,1>
					IFIDN <AC> <Q-1> <INST==SUBI Q,1>
					IFIDN <AC> <Q-D> <INST==SUBM Q,D>
					IFIDN <AC> <Q> <INST==MOVE D,Q>
					IFIDN <AC> <D+AC> <INST==ADD D,AC>
					IFIDN <AC> <AC-D> <INST==SUBM AC,D>
					IFIDN <AC> <D-Q> <INST==SUB D,Q>
					IFIDN <AC> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU AC NOT DEFINED>>
	000036'	000000	000000			INST
					^ DEST(RTRAIL)^
	000037'	202200	000000'			MOVEM	D,<RTRAIL>
					^ SPEC(DEST-A-MEM)^^ NORM ^^$^^
				00290			;SAVE NUMBER OF TRAILING BITS IN AMEM FOR LATER.
				00300		D(ADJ.AC)^
	000040'	200200	000001'			MOVE	D,<ADJ.AC>
					^ ALU(Q-D)^
			000000		INST=0
					IFIDN <Q-D> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q-D> <D#Q> <INST==XOR D,Q>
					IFIDN <Q-D> <D-1> <INST==SUBI D,1>
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-3
FOO.SLO	13-MAR-81 18:51	

					IFIDN <Q-D> <Q-1> <INST==SUBI Q,1>
		276140	000004		IFIDN <Q-D> <Q-D> <INST==SUBM Q,D>
					IFIDN <Q-D> <Q> <INST==MOVE D,Q>
					IFIDN <Q-D> <D+AC> <INST==ADD D,AC>
					IFIDN <Q-D> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q-D> <D-Q> <INST==SUB D,Q>
					IFIDN <Q-D> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q-D NOT DEFINED>>
	000041'	276140	000004			INST
					^ DEST(Q)^
	000042'	202200	000003			MOVEM	D,<Q>
					^ NORM ^^$^^
				00310			;GET NEGATIVE OF NUMBER OF BYTES PAST LAST BYTE OF WORD
				00320			; THAT RESULTANT BYTE SHOULD BE.
				00330		ALU(Q)^
			000000		INST=0
					IFIDN <Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q> <D#Q> <INST==XOR D,Q>
					IFIDN <Q> <D-1> <INST==SUBI D,1>
					IFIDN <Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <Q> <Q-D> <INST==SUBM Q,D>
		200200	000003		IFIDN <Q> <Q> <INST==MOVE D,Q>
					IFIDN <Q> <D+AC> <INST==ADD D,AC>
					IFIDN <Q> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q> <D-Q> <INST==SUB D,Q>
					IFIDN <Q> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q NOT DEFINED>>
	000043'	200200	000003			INST
					^ DEST(ADJ.ARG)^
	000044'	202200	000002'			MOVEM	D,<ADJ.ARG>
					^ SPEC(DEST-A-MEM)^^ NORM ^^$^^
				00340			;STORE IN AMEM FOR MUCH LATER.
				00350		D(CONST 44)^
	000045'	200200	000044			MOVE	D,<CONST 44>^44>^
					^ DEST(Q)^
	000046'	202200	000003			MOVEM	D,<Q>
					^ SHORT ^^$^^
				00360			;MUST DIVIDE INTO 36
				00370		D(BYTE.SIZ)^
	000047'	200200	000004'			MOVE	D,<BYTE.SIZ>
					^ DEST(HOLD)^
	000050'	202200	000001			MOVEM	D,<HOLD>
					^ NORM ^^$^^
				00380			;GET 36/S
				00390		ALU(0)^
			000000		INST=0
		400000	000004		IFIDN <0> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <0> <D#Q> <INST==XOR D,Q>
					IFIDN <0> <D-1> <INST==SUBI D,1>
					IFIDN <0> <Q-1> <INST==SUBI Q,1>
					IFIDN <0> <Q-D> <INST==SUBM Q,D>
					IFIDN <0> <Q> <INST==MOVE D,Q>
					IFIDN <0> <D+AC> <INST==ADD D,AC>
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-4
FOO.SLO	13-MAR-81 18:51	

					IFIDN <0> <AC-D> <INST==SUBM AC,D>
					IFIDN <0> <D-Q> <INST==SUB D,Q>
					IFIDN <0> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU 0 NOT DEFINED>>
	000051'	400000	000004			INST
					^ ACSEL(AC)^^ DEST(AC)^
	000052'	202200	000005			MOVEM	D,<AC>
	000053'	356000	000006		^ PUSHJ(SH6DIV)^AOSN COND
U	000054'	260740	000035*					PUSHJI P,<SH6DIV>^ SHORT $
				00400			;DO QUICKY DIVIDE. RESULTS:
				00410			;Q/BYTES PER WORD IF THESE BYTES ARE LEFT OR RIGHT ALIGNED.
				00420			;AC/TOTAL NUMBER OF WASTED BITS.

				00440		D(RTRAIL)^
	000055'	200200	000000'			MOVE	D,<RTRAIL>
					^ ALU(D#AC)^
			000000		INST=0
					IFIDN <D#AC> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <D#AC> <D#Q> <INST==XOR D,Q>
					IFIDN <D#AC> <D-1> <INST==SUBI D,1>
					IFIDN <D#AC> <Q-1> <INST==SUBI Q,1>
					IFIDN <D#AC> <Q-D> <INST==SUBM Q,D>
					IFIDN <D#AC> <Q> <INST==MOVE D,Q>
					IFIDN <D#AC> <D+AC> <INST==ADD D,AC>
					IFIDN <D#AC> <AC-D> <INST==SUBM AC,D>
					IFIDN <D#AC> <D-Q> <INST==SUB D,Q>
					IFIDN <D#AC> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU D#AC NOT DEFINED>>
	000056'	000000	000000			INST
					^ COND(OBUS=0)^
					IFIDN <OBUS=0> <OBUS-0> <SKIPGE D>
					IFIDN <OBUS=0> <-OBUS-0> <SKIPL D>
	000057'	336000	000004		IFIDN <OBUS=0> <OBUS=0> <SKIPN D>
					IFIDN <OBUS=0> <-OBUS=0> <SKIPE D>
	000060'	474300	000000			SETO	COND,
Q	000061'	342300	000115'		^ C550 ^^JUMP(ALIGNED)^AOJE COND,<ALIGNED>^ $
				00450			;JUMP IF ALL WASTED BYTES ARE RIGHT HAND ONES (LEFT ALIGNED.)
				00460		D(RTRAIL)^
	000062'	200200	000000'			MOVE	D,<RTRAIL>
					^ COND(OBUS=0)^
					IFIDN <OBUS=0> <OBUS-0> <SKIPGE D>
					IFIDN <OBUS=0> <-OBUS-0> <SKIPL D>
	000063'	336000	000004		IFIDN <OBUS=0> <OBUS=0> <SKIPN D>
					IFIDN <OBUS=0> <-OBUS=0> <SKIPE D>
	000064'	474300	000000			SETO	COND,
Q	000065'	342300	000115'		^ C550 ^^JUMP(ALIGNED)^AOJE COND,<ALIGNED>^ $
				00470			;JUMP IF BYTES ARE RIGHT ALINGED.

				00490	;THERE ARE WASTED BITS ON BOTH SIDES OF WORD FOR THESE BYTES.
				00500	; MAY HAVE TO DECREMENT BYTES PER WORD BY 1 IF WASTED A WHOLE BYTE WORTH.

				00520		ALU(Q)^
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-5
FOO.SLO	13-MAR-81 18:51	

			000000		INST=0
					IFIDN <Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q> <D#Q> <INST==XOR D,Q>
					IFIDN <Q> <D-1> <INST==SUBI D,1>
					IFIDN <Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <Q> <Q-D> <INST==SUBM Q,D>
		200200	000003		IFIDN <Q> <Q> <INST==MOVE D,Q>
					IFIDN <Q> <D+AC> <INST==ADD D,AC>
					IFIDN <Q> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q> <D-Q> <INST==SUB D,Q>
					IFIDN <Q> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q NOT DEFINED>>
	000066'	200200	000003			INST
					^ DEST(AR)^
	000067'	202200	000002			MOVEM	D,<AR>
					^ NORM ^^$^^
				00530			;SAVE CURRENT BYTES PER WORD
				00540		D(CONST 44)^
	000070'	200200	000044			MOVE	D,<CONST 44>^44>^
					^ DEST(Q)^
	000071'	202200	000003			MOVEM	D,<Q>
					^ SHORT ^^$^^
				00550			;36
				00560		D(BYTE.PTR)^
	000072'	200200	000005'			MOVE	D,<BYTE.PTR>
					^ ALU(Q-D)^
			000000		INST=0
					IFIDN <Q-D> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q-D> <D#Q> <INST==XOR D,Q>
					IFIDN <Q-D> <D-1> <INST==SUBI D,1>
					IFIDN <Q-D> <Q-1> <INST==SUBI Q,1>
		276140	000004		IFIDN <Q-D> <Q-D> <INST==SUBM Q,D>
					IFIDN <Q-D> <Q> <INST==MOVE D,Q>
					IFIDN <Q-D> <D+AC> <INST==ADD D,AC>
					IFIDN <Q-D> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q-D> <D-Q> <INST==SUB D,Q>
					IFIDN <Q-D> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q-D NOT DEFINED>>
	000073'	276140	000004			INST
					^ DEST(Q)^
	000074'	202200	000003			MOVEM	D,<Q>
					^ NORM ^^$^^
				00570			;Q/36-P
				00580		D(BYTE.SIZ)^
	000075'	200200	000004'			MOVE	D,<BYTE.SIZ>
					^ DEST(HOLD)^
	000076'	202200	000001			MOVEM	D,<HOLD>
	000077'	356000	000006		^ PUSHJ(SH6DIV)^AOSN COND
U	000100'	260740	000054*					PUSHJI P,<SH6DIV>^ NORM $
				00590			;GET INTO HOLD SO CAN DIVIDE BY S.
				00600			;Q/DONT NEED (NUMBER OF BYTES IN LH PART OF WORD INCLUDING CURRENT)
				00610			;AC/NUMBER OF LEADING WASTED BITS
				00620		D(RTRAIL)^
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-6
FOO.SLO	13-MAR-81 18:51	

	000101'	200200	000000'			MOVE	D,<RTRAIL>
					^ ALU(D+AC)^
			000000		INST=0
					IFIDN <D+AC> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <D+AC> <D#Q> <INST==XOR D,Q>
					IFIDN <D+AC> <D-1> <INST==SUBI D,1>
					IFIDN <D+AC> <Q-1> <INST==SUBI Q,1>
					IFIDN <D+AC> <Q-D> <INST==SUBM Q,D>
					IFIDN <D+AC> <Q> <INST==MOVE D,Q>
		270200	000005		IFIDN <D+AC> <D+AC> <INST==ADD D,AC>
					IFIDN <D+AC> <AC-D> <INST==SUBM AC,D>
					IFIDN <D+AC> <D-Q> <INST==SUB D,Q>
					IFIDN <D+AC> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU D+AC NOT DEFINED>>
	000102'	270200	000005			INST
					^ DEST(AC)^
	000103'	202200	000005			MOVEM	D,<AC>
					^ NORM ^^$^^
				00630			;AC/TOTAL NUMBER OF WASTED BITS
				00640		D(BYTE.SIZ)^
	000104'	200200	000004'			MOVE	D,<BYTE.SIZ>
					^ ALU(AC-D)^
			000000		INST=0
					IFIDN <AC-D> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <AC-D> <D#Q> <INST==XOR D,Q>
					IFIDN <AC-D> <D-1> <INST==SUBI D,1>
					IFIDN <AC-D> <Q-1> <INST==SUBI Q,1>
					IFIDN <AC-D> <Q-D> <INST==SUBM Q,D>
					IFIDN <AC-D> <Q> <INST==MOVE D,Q>
					IFIDN <AC-D> <D+AC> <INST==ADD D,AC>
		276240	000004		IFIDN <AC-D> <AC-D> <INST==SUBM AC,D>
					IFIDN <AC-D> <D-Q> <INST==SUB D,Q>
					IFIDN <AC-D> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU AC-D NOT DEFINED>>
	000105'	276240	000004			INST
					^ COND(OBUS-0)^
	000106'	335000	000004		IFIDN <OBUS-0> <OBUS-0> <SKIPGE D>
					IFIDN <OBUS-0> <-OBUS-0> <SKIPL D>
					IFIDN <OBUS-0> <OBUS=0> <SKIPN D>
					IFIDN <OBUS-0> <-OBUS=0> <SKIPE D>
	000107'	474300	000000			SETO	COND,
Q	000110'	342300	000115'		^ C550 ^^JUMP(ALIGNED)^AOJE COND,<ALIGNED>^ $
				00650			;IF TOTAL WASTED < SIZE, THEN DON'T HAVE TO ADJUST
				00660		D(AR)^
	000111'	200200	000002			MOVE	D,<AR>
					^ ALU(D-1)^
			000000		INST=0
					IFIDN <D-1> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <D-1> <D#Q> <INST==XOR D,Q>
		275200	000001		IFIDN <D-1> <D-1> <INST==SUBI D,1>
					IFIDN <D-1> <Q-1> <INST==SUBI Q,1>
					IFIDN <D-1> <Q-D> <INST==SUBM Q,D>
					IFIDN <D-1> <Q> <INST==MOVE D,Q>
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-7
FOO.SLO	13-MAR-81 18:51	

					IFIDN <D-1> <D+AC> <INST==ADD D,AC>
					IFIDN <D-1> <AC-D> <INST==SUBM AC,D>
					IFIDN <D-1> <D-Q> <INST==SUB D,Q>
					IFIDN <D-1> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU D-1 NOT DEFINED>>
	000112'	275200	000001			INST
					^ DEST(HOLD)^
	000113'	202200	000001			MOVEM	D,<HOLD>
Q	000114'	342300	000115'		^ JUMP(ALIGNED1)^AOJE COND,<ALIGNED1>^ $
				00670			;ELSE NUMBER OF BYTES PER WORD IS LESS.
	000115'			00680	ALIGNED:
				00690		D(AR)^
	000115'	200200	000002			MOVE	D,<AR>
					^ DEST(HOLD)^
	000116'	202200	000001			MOVEM	D,<HOLD>
					^ NORM ^^$^^
				00700			;MUST DIVIDE BY BYTES/WORD
	000117'			00710	ALINGED1:
				00720		D(ADJ.ARG)^
	000117'	200200	000002'			MOVE	D,<ADJ.ARG>
					^ DEST(Q)^
	000120'	202200	000003			MOVEM	D,<Q>
	000121'	356000	000006		^ PUSHJ(DIVSUB)^AOSN COND
U	000122'	260740	000000*					PUSHJI P,<DIVSUB>^ NORM $
				00730			;DIVIDE THIS BY BYTES/WORD
				00740			;Q/-NUMBER OF WORDS TO ADJUST BY
				00750			;AC/-BYTES TO ADJUST BY.
				00760		ALU(AC)^
			000000		INST=0
					IFIDN <AC> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <AC> <D#Q> <INST==XOR D,Q>
					IFIDN <AC> <D-1> <INST==SUBI D,1>
					IFIDN <AC> <Q-1> <INST==SUBI Q,1>
					IFIDN <AC> <Q-D> <INST==SUBM Q,D>
					IFIDN <AC> <Q> <INST==MOVE D,Q>
					IFIDN <AC> <D+AC> <INST==ADD D,AC>
					IFIDN <AC> <AC-D> <INST==SUBM AC,D>
					IFIDN <AC> <D-Q> <INST==SUB D,Q>
					IFIDN <AC> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU AC NOT DEFINED>>
	000123000	000000			INST
					^ COND(-OBUS-0)^
					IFIDN <-OBUS-0> <OBUS-0> <SKIPGE D>
	000124'	331000	000004		IFIDN <-OBUS-0> <-OBUS-0> <SKIPL D>
					IFIDN <-OBUS-0> <OBUS=0> <SKIPN D>
					IFIDN <-OBUS-0> <-OBUS=0> <SKIPE D>
	000125'	474300	000000			SETO	COND,
Q	000126'	342300	000134'		^ C550 ^^JUMP(REMNOTNEG)^AOJE COND,<REMNOTNEG>^ $
				00770			;JUMP IF REMAINDER NOT NEGATIVE
				00780		D(AR)^
	000127'	200200	000002			MOVE	D,<AR>
					^ ALU(D+AC)^
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-8
FOO.SLO	13-MAR-81 18:51	

			000000		INST=0
					IFIDN <D+AC> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <D+AC> <D#Q> <INST==XOR D,Q>
					IFIDN <D+AC> <D-1> <INST==SUBI D,1>
					IFIDN <D+AC> <Q-1> <INST==SUBI Q,1>
					IFIDN <D+AC> <Q-D> <INST==SUBM Q,D>
					IFIDN <D+AC> <Q> <INST==MOVE D,Q>
		270200	000005		IFIDN <D+AC> <D+AC> <INST==ADD D,AC>
					IFIDN <D+AC> <AC-D> <INST==SUBM AC,D>
					IFIDN <D+AC> <D-Q> <INST==SUB D,Q>
					IFIDN <D+AC> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU D+AC NOT DEFINED>>
	000130'	270200	000005			INST
					^ DEST(AC)^
	000131'	202200	000005			MOVEM	D,<AC>
					^ NORM ^^$^^
				00790			;NEG REMAINDER MEANS NEXT WORD.
				00800		ALU(Q-1)^
			000000		INST=0
					IFIDN <Q-1> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q-1> <D#Q> <INST==XOR D,Q>
					IFIDN <Q-1> <D-1> <INST==SUBI D,1>
		275140	000001		IFIDN <Q-1> <Q-1> <INST==SUBI Q,1>
					IFIDN <Q-1> <Q-D> <INST==SUBM Q,D>
					IFIDN <Q-1> <Q> <INST==MOVE D,Q>
					IFIDN <Q-1> <D+AC> <INST==ADD D,AC>
					IFIDN <Q-1> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q-1> <D-Q> <INST==SUB D,Q>
					IFIDN <Q-1> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q-1 NOT DEFINED>>
	000132'	275140	000001			INST
					^ DEST(Q)^
	000133'	202200	000003			MOVEM	D,<Q>
					^ SHORT ^^$^^

				00820	;BYTES/WORD IN AR STILL . . .
				00830	; AC/-BYTES TO ADJUST BY
				00840	; Q/-WORDS TO ADJUST BY
	000134'			00850	REMNOTNEG:
				00860		D(ADJ.PTR)^
	000134'	200200	000003'			MOVE	D,<ADJ.PTR>
					^ ALU(D-Q)^
			000000		INST=0
					IFIDN <D-Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <D-Q> <D#Q> <INST==XOR D,Q>
					IFIDN <D-Q> <D-1> <INST==SUBI D,1>
					IFIDN <D-Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <D-Q> <Q-D> <INST==SUBM Q,D>
					IFIDN <D-Q> <Q> <INST==MOVE D,Q>
					IFIDN <D-Q> <D+AC> <INST==ADD D,AC>
					IFIDN <D-Q> <AC-D> <INST==SUBM AC,D>
		274200	000003		IFIDN <D-Q> <D-Q> <INST==SUB D,Q>
					IFIDN <D-Q> <DORQ> <INST==IOR D,Q>
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-9
FOO.SLO	13-MAR-81 18:51	

					IF2,<IFE INST,<PRINTX ALU D-Q NOT DEFINED>>
	000135'	274200	000003			INST
					^ DEST(Q)^
	000136'	202200	000003			MOVEM	D,<Q>
					^ NORM ^^$^^
				00870			;ADJUST Y PART OF POINTER
				00880		ALU(Q)^
			000000		INST=0
					IFIDN <Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <Q> <D#Q> <INST==XOR D,Q>
					IFIDN <Q> <D-1> <INST==SUBI D,1>
					IFIDN <Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <Q> <Q-D> <INST==SUBM Q,D>
		200200	000003		IFIDN <Q> <Q> <INST==MOVE D,Q>
					IFIDN <Q> <D+AC> <INST==ADD D,AC>
					IFIDN <Q> <AC-D> <INST==SUBM AC,D>
					IFIDN <Q> <D-Q> <INST==SUB D,Q>
					IFIDN <Q> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU Q NOT DEFINED>>
	000137'	200200	000003			INST
					^ DEST(ADJ.PTR)^
	000140'	202200	000003'			MOVEM	D,<ADJ.PTR>
	000141'	356000	000006		^ SPEC(DEST-A-MEM)^^ PUSHJ(MULSUB)^AOSN COND
U	000142'	260740	000000*					PUSHJI P,<MULSUB>^ NORM $
				00890			;STORE IT BACK
				00900			;GET C(AC) * C(AR) INTO Q
				00910			;WHICH IS ALMOST WHAT P SHOULD BE
				00920		D(RTRAIL)^
	000143'	200200	000000'			MOVE	D,<RTRAIL>
					^ ALU(D+Q)^
			000000		INST=0
					IFIDN <D+Q> <0> <INST==SETZ D>	;DATA PATH GETS SET TO ZERO
					IFIDN <D+Q> <D#Q> <INST==XOR D,Q>
					IFIDN <D+Q> <D-1> <INST==SUBI D,1>
					IFIDN <D+Q> <Q-1> <INST==SUBI Q,1>
					IFIDN <D+Q> <Q-D> <INST==SUBM Q,D>
					IFIDN <D+Q> <Q> <INST==MOVE D,Q>
					IFIDN <D+Q> <D+AC> <INST==ADD D,AC>
					IFIDN <D+Q> <AC-D> <INST==SUBM AC,D>
					IFIDN <D+Q> <D-Q> <INST==SUB D,Q>
					IFIDN <D+Q> <DORQ> <INST==IOR D,Q>
					IF2,<IFE INST,<PRINTX ALU D+Q NOT DEFINED>>
	000144'	000000	000000			INST
					^ DEST(AR)^
	000145'	202200	000002			MOVEM	D,<AR>
					^ NORM ^^$^^
				00930			;NOW WE HAVE P
				00940		D(ADJ.PTR)^
	000146'	200200	000003'			MOVE	D,<ADJ.PTR>
Q	000147'	404200	000152'		^ MASK(30.)^AND D,[<1_<30.+1>>-1]^ DEST(Q) NORM $
				00950			;GET POINTER WITHOUT P FIELD
				00960		D(AR)^
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 1-10
FOO.SLO	13-MAR-81 18:51	

	000150'	200200	000002			MOVE	D,<AR>
Q	000151'	241200	000000		^ ROT(35. - 5.)^ROTI D,<35. - 5.>^ ALU(DORQ) DEST(AC) JUMP(MAIN) NORM $
				00970			;STORE IT BACK INTO AC WITH P FIELD AND RETURN.
				00100		END

DIVSUB	UNDEFINED 
MULSUB	UNDEFINED 
SH6DIV	UNDEFINED 
?16 ERRORS DETECTED
PROGRAM BREAK IS 000153
3K CORE USED
F3SIM MACRO PACKAGE TO SIMULATE SOME F3 MICROCODE	MACRO 12.5-46.0 18:58 13-MAR-81 PAGE 2
END.MAC	15-MAR-79 21:41		SYMBOL TABLE

AC		000005		
ADJ.AC		000001'		
ADJ.AR		000002'		
ADJ.PT		000003'		
ADJBP		000007'		
ADJN36		000022'		
ADJW36		000024'		
ADR		000000		
ALIGNE		000115'		
ALINGE		000117'		
AR		000002		
BYTE.P		000005'		
BYTE.S		000004'		
COND		000006		
D		000004		
DEV		000006'		
DEVADR		000006'		
DIVSUB		000122'	UXT	
HOLD		000001		
INST		000000	SPD	
MEM		000001		
MULSUB		000142'	UXT	
P		000017		
PUSHJI	260000	000000		
Q		000003		
REMNOT		000134'		
ROTI	241000	000000		
RTRAIL		000000'		
SH6DIV		000100'	UXT	
    , Ý
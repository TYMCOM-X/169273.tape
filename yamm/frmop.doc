FRMOP UUO
----- ---

P034 CONTAINS A NEW UUO - FRMOP [044000,,0].
THE GENERAL FORMAT OF THIS UUO IS

	MOVE	AC,[FN,,FD]
	FRMOP	AC,E
	  <ERROR RETURN>
	<SUCCESS RETURN>

WHERE FN IS THE FRMOP FUNCTION CODE (.FO???), FD IS A FRAME DESCRIPTOR
(DEFINED LATER IN THIS DOCUMENT) AND E IS THE ADDRESS OF AN ARGUMENT
BLOCK OF SOME TYPE.

THE FOLLOWING FRMOP FUNCTIONS EXIST AS OF THE WRITING OF THIS DOCUMENT:

.FOCLF	0	CALL FRAME (ZERO FOR FAST DISPATCH)
.FOCFM	1	CREATE FRAME
.FORVA	2	READ A VIRTUAL ADDRESS
.FOWVA	3	WRITE A VIRTUAL ADDRESS
.FOSAA	4	START AT ABSOLUTE ADDRESS
.FOHLT	5	HALT FRAME
.FORPC	6	READ PC (USER MODE PC)
.FOREP	7	REPLICATE TO/FROM FRAME
.FOVRM	10	VREMOV FOR ANOTHER FRAME
.FOVCL	11	VCLEAR FOR ANOTHER FRAME
.FOCFH	12	CREATE HANDLE
.FODFH	13	DESTROY HANDLE
.FOCLR	14	CLEAR A STOPPED FRAME
.FORSI	15	RETURN STANDARD ACCESS RIGHT INFO
.FORAR	16	READ A HANDLE'S ACCESS RIGHTS
.FORER	17	READ HANDLE'S EFFECTIVE RIGHTS
.FOSMF	20	SET MAX FRAME RIGHTS
.FOCHR	21	CHANGE RIGHTS IN A HANDLE
.FOSVA	22	START FRAME AT START VECTOR ADDRESS
.FOHST	23	READ HALT STATUS BLOCK FOR FRAME
.FOGFT	24	GRAFT A FRAME
.FOCON	25	CONTINUE A FRAME
CREATE FRAME:
		MOVSI	AC,.FOCFM
		FRMOP	AC,[-COUNT,,BLOCK]
		  <ERROR RETURN>
		<SUCCESS RETURN>
BLOCK:	 PPN
	JBTPRV WORD
	AUN
	USER NAME WORD 1
	USER NAME WORD 2

IF SUCCESSFUL, RETURNS A CHILD FD IN AC. THE NEWLY CREATED FRAME
IS NOW THE CALLER'S CHILD. ANY UNSPECIFIED ARGUMENTS (COUNT LESS THAN
MAXIMUM) WILL ASSUME A VALUE WHICH CORRESPONDS TO THE MATCHING
PARAMETER OF THE CALLER. JL LICENSE IS NEEDED IN ORDER TO CREATE
A FRAME WITH DIFFERENT LOGIN PARAMETERS THAN THOSE OF THE CALLER.


ERROR RETURNS ARE DIFFERENT THAN THOSE FOR OTHER FRMOPS.
IF ERROR RETURN IS GIVEN, ERROR CODE IS FOUND IN RH OF AC.
ERROR CODES ARE DIFFERENT THAN THE COMMON FRMOP ERROR CODES.

ERROR CODES ARE AS FOLLOWS:

0	NO DISK ROOM
1	FRAME CAPACITY EXCEEDED
2	BAD ARG NO LICENSE AND DOESN'T MATCH CALLERS PARAMETER	
3	CANNOT CREATE COMMAND PORT DDB	
START AT ABSOLUTE ADDRESS:
	MOVE	AC,[.FOSAA,,FD]
	FRMOP	AC,ADDR
	  <ERROR>
	<SUCCESS>

ADDR:	STARDI,,ADDRESS.

IF STARDI IS SET, THE ADDRESS IS THE ACTUAL ADDRESS TO
START THE FRAME AT.
IF STARDI (=400000) IS ZERO, THE ADDRESS IS THE ADDRESS OF THE ADDRESS I
THE TARGET FRAME WHERE THE ADDRESS IS TO BE FOUND.
(USEFUL FOR STARTING AT START ADDRESS IN .JBSA, .JBDDT, .JBREN, ETC.
OF TARGET FRAME.)

START AT VECTOR ADDRESS:

	MOVE	AC,[.FOSVA,,FD]
	FRMOP	AC,[START VECTOR INDEX]
	  <ERROR RETURN>
	<SUCCESS RETURN>

POSITIVE START VECTOR INDICES SPECIFY THE CORRESPONDING
OFFSETS INTO A TABLE IN THE TARGET FRAME'S ADDRESS SPACE
WHICH MAY OR MAY NOT BE SETUP.

NEGATIVE START VECTOR INDICES SPECIFY SYSTEM STANDARD START
LOCATIONS AS FOLLOWS:

-1	NORMAL START ADDRESS (RH C(.JBSA))
-2	CCL START ADDRESS (RH C(.JBSA) + 1)
-3	REENTER ADDRESS (RH C(.JBREN))
-4	DDT START ADDRESS (RH C(.JBDDT))

HALT FRAME:

	MOVE	AC,[.FOHLT,,FD]
	FRMOP	AC,
	  <ERROR RETURN>
	<SUCCESS RETURN>

THIS FUNCTION WILL STOP THE FRAME, REGARDLESS OF WHETHER OR NOT
JACCT2 IS ON, AND WHETHER OR NOT THE FRAME WAS TRAPPING
CONTROL-C. IF JACCT IS ON, THE ERROR RETURN WILL BE TAKEN.
THE EFFECT OF THIS FUNCTION IS NOT NECESSARILY IMMEDIATE - THE CALLER
MUST WAIT FOR THE TARGET FRAME TO HALT AFTER GETTING THE SUCCESS RETURN
FROM THIS UUO.

CONTINUE FRAME:

	MOVE	AC,[.FOCON,,FD]
	FRMOP	AC,
	  <ERROR RETURN>	;IF JERR ON OR ALREADY RUNNING
	<SUCCESS RETURN>

THIS FUNCTION IS PROVIDED AS A CONVENIENCE. IT IS EQUIVALENT TO
READ PC (.FORPC) AND START THERE (.FOSAA).
SET START VECTOR ADDRESS:

	MOVE	AC,[COUNT,,ADDRESS]
	SETSTV	AC,		;OR CALLI -137
	  <ERROR RETURN>	;NEVER GET TO IT
	<SUCCESS RETURN>

ADDRESS SPECIFIED CONTAINS A TABLE OF LENGTH <COUNT> WITH BITS 18-35
CONTAINING THE ADDRESSES IN THE START VECTOR. RESET UUO DOES NOT CLEAR
OUT START VECTOR - ONLY IS CLEARED WHEN NEW PROGRAM IS SETUP IN FRAME.
READ PC:
	MOVE	AC,[.FORPC,,FD]
	FRMOP	AC,<ADDR>
	  <ERROR>
	<SUCCESS>		;PC IN <ADDR>

IF NO USER MODE PC IS KNOWN FOR THE FRAME (E.G. JUST FINISHED A RUN)
THEN ZERO IS RETURNED IN <ADDR> AND THE SUCCESS RETURN IS GIVEN.
IF THE FRAME IS IN THE MIDDLE OF A UUO, THE PC POINTS TO THE UUO.
THIS IS SO THE CONTROLLING FRAME CAN READ THE PC AND RESTART THE
FRAME PROPERLY.

REPLICATE TO/FROM FRAME'S ADDRESS SPACE:

	MOVE	AC,[FD,,.FOREP]
	FRMOP	AC,ADDR
	  <ERROR RETURN>	;USES VREPLC ERROR CODES, SUB CODE IN 0-5
	<SUCCESS RETURN>

ADDR:	OTFFLG+PROT+COUNT,,DEST VP
	OTFFLG,,SOURCE VP

OTFFLG = 200000, IF 1 INDICATES FRAME SPECIFIED BY FD, IF 0 INDICATES
CURRENT FRAME.

VREMOV/VCLEAR FOR ANOTHER FRAME:

	MOVE	AC,[FN,,FD]	;FN = .FOVRM, .FOVCL
	FRMOP	AC,[BITS+COUNT,,VP]
	  <ERROR RETURN>	;RETURNS SUBCODE + VP,,VREMOV ERROR CODE
	<SUCCESS RETURN>


READ/WRITE VIRTUAL ADDRESS:
	MOVE	AC,[FN,,FD]	;FN = .FORVA,.FOWVA
	FRMOP	AC,<BLOCK>
	  <ERROR RETURN> 	;CODE IN AC
	<SUCCESS RETURN>

BLOCK:	<ADDRESS>
	<DATA>

SET "OTHER" FRAME:

	MOVEI	AC,FD
	SETOTF	AC,		;OR CALLI AC,-126
	  <ERROR RETURN>
	<SUCCESS RETURN>

VCREAT,VREMOV,VCLEAR,MAP AND REPLICATE CHANIO FUNCTIONS, VPROT,
VPGSTS, VALPAG, PREREF UUOS WILL OPERATE ON THE "OTHER" FRAME
IF OTFFLG (=200000) IS SET IN THEIR ARGUMENT WORD.

SETOTF RETURNS PREVIOUS SETTING OF "OTHER" FRAME IN AC ON SUCCESS.

FAILURE WILL RESULT IF WISE GUY TRYS TO SET THE "OTHER" FRAME
TO THE "OTHER" FRAME DESCRIPTOR.
CREATE HANDLE:
	MOVE	AC,[.FOCFH,,FD]	;FD FOR TARGET FRAME
	FRMOP	AC,<ADDR>
	  <ERROR>
	<SUCCESS>

<ADDR>:	BITS,,FD FOR NEW HANDLE (INDEX FIELD 77777 TO FIND FIRST FREE SL
	COUNT,,ADDR OF ACCESS BITS (0 FOR DEFAULT-MAX)
	<N WORDS OF ACCESS BITS>

	CURRENT BITS:
	  15-17 - HANDLE TYPE (FRAME, PROCESS, CLUB)
		0 - FRAME HANDLE
		1 - PROCESS HANDLE
		2 - LICENSE HANDLE
ON SUCCESS, RH OF AC IS SET TO FD OF NEW HANDLE

A FRAME DESCRIPTOR ALWAYS DESCRIBES A MEANS OF ACCESSING OR CHANGING
DATA ASSOCIATED WITH A FRAME. THIS MEANS IS CALLED A "HANDLE".
SOME FRAME DESCRIPTORS DESCRIBE HANDLES THAT AUTOMATICALLY EXIST
AS A RESULT OF THE CALLER'S RELATIONSHIP TO THE TARGET FRAME
(CHILD, PARENT, ABSOLUTE), AND
ONE TYPE OF FRAME DESCRIPTOR DENOTES A "CREATED HANDLE".

ALL HANDLES HAVE A FRAME NUMBER, HANDLE TYPE, AND ACCESS RIGHTS.
THE FRAME NUMBER TELLS THE SYSTEM WHICH FRAME THE OWNER OF THE
HANDLE IS TRYING TO ACCESS. THERE ARE CURRENTLY THREE HANDLE TYPES:
FRAME, PROCESS AND LICENSED.

A LICENSED HANDLE IS DESCRIBED BY EITHER AN ABSOLUTE FRAME DESCRIPTOR
OR A "CREATED HANDLE" FRAME DESCRIPTOR. THE ACCESS A LICENSED HANDLE
HAS OVER ITS TARGET FRAME IS ALWAYS EQUAL TO THE LICENSE STORED IN
THE HANDLE. (FOR ABSOLUTE FRAME DESCRIPTORS, THE LICENSE "STORED"
IN THE HANDLE IS INSTANTANEOUSLY DETERMINED BY THE CURRENTLY SET
LICENSE BITS FOR THE PROCESS).

A FRAME HANDLE IS VALID FOR AS LONG AS THE UNIVERSAL FRAME ID
(UID) STORED IN IT MATCHES THAT OF THE TARGET FRAME.
THE RIGHTS THAT A FRAME HANDLE ALLOWS OVER THE TARGET ARE THE
RIGHTS IN THE HANDLE ANDED WITH THE TARGET FRAME'S MAXIMUM FRAME
RIGHTS SETTING AT THE TIME THE ATTEMPTED FUNCTION IS EXECUTED.
MAXIMUM FRAME RIGHTS ARE SET ACCORDING TO THE PROTECTION OF
THE FILE FROM WHICH THE CURRENTLY RUNNING PROCESS CAME
WITH RESPECT TO THE FRAME'S PPN. THIS IS THE MECHANISM THAT PROTECTS
A PROGRAM/PROCESS AGAINST THE OWNER OF THE FRAME IT RUNS IT.

A PROCESS HANDLE IS ONLY VALID AS LONG AS THE PROGRAM NUMBER
(PNO), WHICH IS INCREMENTED EVERY TIME A NEW PROGRAM IS SETUP IN
A FRAME, MATCHES THE PNO IN THE TARGET FRAME. PROCESS HANDLES
ARE USEFUL FOR OCCASIONS WHERE A PROGRAM WANTS TO GIVE OUT ACCESS
OVER ITSELF, BUT NOT TO THE FRAME THAT IT IS RUNNING IN.
NOTE THAT THE "SELF" FRAME DESCRIPTOR DESCRIBES A PROCESS HANDLE.
THIS IS SO THE OCCUPANT OF A FRAME CANNOT GIVE OUT FRAME HANDLES
TO THAT FRAME, WHICH WOULD ALLOW CONTROL OVER FUTURE PROGRAMS THAT
RAN IN THE FRAME.
RULES FOR HANDLE CONVERSION, RESULTANT RIGHTS:

SOURCE		CREATE		MAX RIGHTS SETTING
--------------------------------------------------
LIC		LIC		HANDLE
		FRAME		HANDLE
		PROCESS		HANDLE,PNO FROM CURRENT
FRAME		LIC		FROM PROCESS LICENSE
		FRAME		HANDLE
		PROCESS		HANDLE .AND. MFR, PNO FROM CURRENT
PROCESS		LIC		FROM PROCESS LICENSE
		FRAME		(ILLEGAL)
		PROCESS		HANDLE, PNO FROM HANDLE
ABS FRAME	LIC		FROM PROCESS LICENSE
		FRAME		FROM PROCESS LICENSE
		PROCESS		FROM PROCESS LICENSE,PNO FROM CURRENT

SOURCE FD OF "CHILD" IS TREATED LIKE FRAME HANDLE.
SOURCE FD OF "PARENT" IS TREATED LIKE PROCESS HANDLE.
SOURCE FD OF "SELF" IS TREATED LIKE PROCESS HANDLE.
"SELF" PROCESS HANDLE BEHAVES AS IF ALL RIGHTS BITS WERE SET.

NOTE THAT A HANDLE OTHER THAN A LICENSED ONE IS NEEDED TO
CREATE A NEW LICENSED HANDLE WITH MAX RIGHTS BASED ON PROCESS LICENSE
RATHER THAN THE LICENSE IN THE HANDLE. THIS IS TO MAKE COPYING
AND PASSING HANDLES EASIER.
DESTROY HANDLE:

	MOVE	AC,[.FODFH,,FD OF HANDLE]
	FRMOP	AC,
	  <ERROR RETURN>
	<SUCCESS RETURN>

CLEAR A FRAME:

	MOVE	AC,[.FOCLR,,FD]
	FRMOP	AC,
	  <ERROR RETURN>
	<SUCCESS RETURN>

TARGET FRAME MUST BE STOPPED.
ON SUCCESSFUL RETURN, THE TARGET FRAME IS SET TO RUN A PROGRAM
WHICH WILL HAVE THE SAME EFFECT AS A "CORE 0" COMMAND WOULD HAVE
HAD ON IT, THAT IS, ALL DEVICES ARE RELEASED AND ALL PAGES ARE
REMOVED FROM THE FRAME'S VIRTUAL ADDRESS SPACE. (EVEN PAGE 0 IS
REMOVED - WHEREAS CORE 0 DOES NOT REMOVE PAGE 0.)
THE CALLER CANNOT ASSUME THAT THE FRAME HAS SUCCESSFULLY CLEARED
AFTER GETTING THE SUCCESS RETURN - THE CALLER MUST WAIT FOR THE
FRAME TO HALT.

RETURN STANDARD ACCESS RIGHTS INFORMATION:

	MOVE	AC,[.FORSI,,<ITEM NUMBER>]
	FRMOP	AC,[COUNT,,ADDR]
	  <ERROR RETURN>
	<NORMAL RETURN>

ADDR:	<COUNT> WORDS OF ACCESS BITS

ITEMS:

0	MAX FRAME RIGHTS FOR EXECUTE ONLY PROCESSES
	(INCLUDES READ PROTECTED OR LICENSED SWR FILES)
1	MAX FRAME ACCESS RIGHTS IF PROCESS HAS MORE LICENSE THAN FRAME
2	ALL RIGHTS BITS CURRENTLY DEFINED
3	RIGHTS THAT RC LICENSE GIVES
4	RIGHTS THAT SY LICENSE GIVES
5	TYMSHARE PROPRIETARY RIGHTS
6	RIGHTS THAT SAME AUN OR ACC SUPER GIVES
7	RIGHTS THAT JL LICENSE GIVES
10	RIGHTS THAT WC LICENSE GIVES
READ HANDLE'S ACCESS RIGHTS, READ HANDLE'S EFFECTIVE RIGHTS:


	MOVE	AC,[.FORAR OR .FORER,,FRAME DESCRIPTOR]
	FRMOP	AC,ADDR
	  <ERROR RETURN>
	<SUCCESS RETURN>
ADDR:	COUNT,,ADDR OF BLOCK TO RETURN RIGHTS IN.

FORMAT OF BLOCK:

0/ BITS+TYPE,,FRAME NUMBER	SEE CREATE HANDLE FRMOP FOR TYPE DEFINITIONS
1/ 36 BIT UID
2/ PNO (ONLY VALID IF TYPE IS PROCESS HANDLE)
3-N/ ACCESS BITS

THESE TWO FRMOPS RETURN ACCESS RIGHTS ASSOCIATED WITH
THE GIVEN FRAME DESCRIPTOR. READING ACCESS RIGHTS
READS THE RIGHTS THAT ARE ASSOCIATED WITH THE HANDLE
ITSELF. READING EFFECTIVE RIGHTS RETURNS WHICH RIGHTS
THE HANDLE IS CURRENTLY GOOD FOR, WHICH MAY OR MAY
NOT BE THE SAME AS THE RIGHTS ASSOCIATED WITH THE HANDLE.

FOR ABSOLUTE FRAME DESCRIPTORS, THE UID FIELD AND PNO FIELD
ARE RETURNED AS ZERO.
SET MAX FRAME RIGHTS:

	MOVE	AC,[.FOSMF,,FD]
	FRMOP	AC,[COUNT,,ADDR]
	  <ERROR RETURN>
	<SUCCESS RETURN>
ADDR:	BLOCK	COUNT	;ACCESS RIGHTS BITS

MAX FRAME RIGHTS FOR A TARGET FRAME ARE THE MAXIMUM RIGHTS
THAT ANY FRAME HANDLE CAN HAVE OVER THE TARGET FRAME.
THEY ARE INITIALLY SET TO ALL RIGHTS WHEN A FRAME IS CREATED.
WHEN A PROGRAM IS RUN IN A FRAME, THE MAX FRAME RIGHTS ARE SET ACCORDING
TO THE FILE PROTECTION CODE WHICH APPLIES AGAINST THE FRAME (E.G.
IF FRAME'S PPN HAS SAME GAN AS FILE CAME FROM, PROJECT FIELD APPLIES).
NOTE THAT THE PPN USED FOR CHECKING FILE PROTECTION IS THAT OF
FRAME IN WHICH PROGRAM IS RUN, NOT PPN OF FRAME WHICH CAUSED
PROGRAM TO RUN IN THE OTHER FRAME.

IF THE PROCESS IS EXECUTE ONLY (FORCED IF RUNNING A SWR FILE
WHICH EITHER HAS LICENSE OR IS NOT WRITABLE BY THE FRAME) THE MAX
FRAME RIGHTS ARE SET ACCORDING TO THAT CONDITION, WHICH
ALLOW VERY LITTLE TO BE DONE TO THE FRAME.

IF THE PROCESS HAS MORE LICENSE THAN THE FRAME, THE MAX FRAME RIGHTS
ARE SET TO THOSE RIGHTS WHICH ALLOW OTHER FRAME HANDLES TO
FIND OUT ANY INFORMATION ABOUT THE TARGET FRAME, BUT DO NOT ALLOW
THE TARGET FRAME TO BE EFFECTED BY HOLDERS OF ANY FRAME HANDLE
IN A WAY WHICH WOULD ALLOW EXPLOITATION OF THE LICENSE.

IF NONE OF THE ABOVE CONDITIONS APPLY, THE MAX FRAME RIGHTS
ARE SET TO ALL CURRENTLY DEFINED RIGHTS.

THE READ STANDARD ACCESS RIGHT INFORMATION FRMOP RETURNS A SET OF
RIGHTS CORRESPONDING TO EACH OF THE CATEGORIES LISTED ABOVE.
SEE THE ACCESS RIGHTS TABLE BELOW TO SEE WHICH RIGHTS ARE INCLUDED
IN WHICH CATEGORIES.

CHANGE RIGHTS IN A HANDLE:

	MOVE	AC,[.FOCHR,,FD]
	FRMOP	AC,[COUNT,,ADDR OF RIGHTS BIT TABLE]
	  <ERROR RETURN>
	<SUCCESS RETURN>

THIS FRMOP CANNOT CHANGE THE RIGHTS FOR ABSOLUTE FRAME FDS
OR SELF FDS. THE RIGHTS IN A "FRAME" HANDLE CAN ONLY BE DECREASED.
THE RIGHTS FOR A "PROCESS" HANDLE CAN BE EITHER INCREASED OR DECREASED,
BUT IF INCREASED THE HANDLE BECOMES INVALID.
READ HALT/EXIT STATUS BLOCK FOR FRAME:

	MOVE	AC,[.FOHST,,FD]
	FRMOP	AC,ADDR
	  <ERROR>
	<SUCCESS>

ADDR:	COUNT			;NUMBER OF WORDS TO RETURN
				;WORDS RETURNED STARTING AT ADDR+1
ADDR+1/ HALT CLASS,,HALT TYPE
ADDR+2/ HALT COUNT
ADDR+3/ PC OF HALT OR EXIT
ADDR+4/ PC OF LAST UUO
ADDR+5/ SIXBIT DEVICE NAME IF RELEVANT
ADDR+6/ 36 BIT DATA DEPENDENT ON HALT CLASS AND TYPE (E.G. LOCATION OF I
ADDR+7/ ANOTHER TYPE DEPENDENT DATA LOCATION

SEE TABLE BELOW FOR LIST OF ERROR CLASS/TYPES.

ENABLING FOR HALT IN CHILD:

CURRENTLY, ONLY A FRAME'S PARENT CAN GET INTERRUPTED
WHEN ITS CHILD FRAME HALTS. IN THE FUTURE, EACH FRAME WILL HAVE
A TRAPHANDLER SLOT FOR EACH HALT CLASS WHICH POINTS TO A FRAME
THAT WILL GET THE HALT INTERRUPT INSTEAD OF THE FRAME'S PARENT.

TO ENABLE INTERRUPTS FOR ANY CHILD THAT HALTS, A PROGRAM CALLS

	MOVE	[14,,<CHANNEL>]
	INTASS	AC,
	  <ERROR RETURN>
	<SUCCESS RETURN>

THE RECOMMENDED PROCEDURE FOR DETERMINING THE CAUSE OF THE INTERRUPT
IS AS FOLLOWS: THE PARENT MAINTAINS A FLAG FOR EACH CHILD FRAME
INDICATING WHETHER OR NOT AN OPERATION HAS BEEN PERFORMED WHICH
WILL START THE FRAME RUNNING. (.FOCLR, .FOSAA, .FOSVA ARE THE
FUNCTIONS WHICH CURRENTLY DO THIS). WHEN AN INTERRUPT
OCCURS, THE PARENT SCANS JBTSTS FOR ALL CHILD FRAMES FOR A FRAME
WHOSE RUN BIT DOES NOT MATCH THE "STARTED" FLAG. THIS WILL YIELD
A LIST OF FRAMES WHOSE STATE HAS CHANGED. THE HALT BLOCK CAN THEN
BE READ WITH .FOHST TO DETERMINE THE CAUSE OF THE HALT.
A HALT COMMAND OR A CONTROL-C TO THE FRAME WILL NOT CHANGE THE
HALT STATUS BLOCK - ONLY AN INTERRUPT WILL BE GENERATED, AND
IF THE PARENT KEEPS A COPY OF THE LAST HALT COUNT READ FROM
EACH FRAME'S HALT STATUS BLOCK, IT CAN BE DETERMINED WHETHER OR
NOT NEW HALT DATA IS IN THE BLOCK. IF NOT, A HALT COMMAND OR CONTROL-C
HAS PROBABLY CAUSED THE INTERRUPT.
AS THE PARENT PROCESSES EACH CHILD FRAME, IT CAUSES THE
"STARTED" FLAG TO CORRESPOND WITH THE NEWLY READ VALUE OF THE
CHILD FRAME'S RUN BIT.

In addition to the interrupt, a parent frame may enable for wakeup
on its child frames by setting bit 9 (400 octal) in HIBER calls.
GRAFT SUBTREE:

	MOVE	AC,[.FOGFT,,FD OF SUBTREE ROOT]
	FRMOP	AC,[FD OF DEST FRAME OR 0 IF NONE]
	  <ERROR RETURN>
	<SUCCESS RETURN>

THIS FUNCTION FIRST CHECKS TO SEE IF THERE IS A DESTINATION FRAME.
IF THERE IS, THE ACCESS THAT THE CALLER HAS TO THE DESTINATION FRAME
THROUGH THE FRAME DESCRIPTOR IS CHECKED TO SEE IF THAT HANDLE
HAS THE ACCESS BIT NEEDED TO ADD A CHILD TO THAT FRAME. IF NOT,
AN ERROR RETURN IS GIVEN.

THE FD OF THE ROOT OF THE SUBTREE TO BE MOVED IS THEN CHECKED TO
SEE IF THE CALLER HAS THE ACCESS BIT ON IN THAT HANDLE THAT ALLOWS
A NEW PARENT TO BE GIVEN TO THE FRAME. IF NOT, ERROR IS GIVEN.

A CHECK IS THEN PERFORMED TO MAKE SURE THE DESTINATION FRAME IS
NOT A MEMBER OF THE SUBTREE ROOT'S SUBTREE. AN ERROR RETURN IS GIVEN
IF DESTINATION FRAME IS A MEMBER.

AFTER THESE CHECKS, THE FD FOR THE SUBTREE ROOT TO BE MOVED IS
CHECKED TO SEE IF THE ACCESS BIT IS ON IN THAT HANDLE WHICH ALLOWS
A PARENT TO BE TAKEN AWAY, IF THERE IS A PARENT FOR THE SUBTREE ROOT.
IF THERE IS A PARENT AND THE ACCESS BIT IS OFF, AN ERROR IS GIVEN.

THE SUBTREE ROOT FRAME'S PROCESS HANDLE TO ITS PARENT IS THEN INVALIDATE
AND THE REQUESTED TRANSFER OF THE SUBTREE IS PERFORMED.

NOTE THAT THE CHILD'S MAX FRAME RIGHTS ARE NOT CHANGED AS A RESULT
OF THE TRANSFER. THEREFORE, IT IS POSSIBLE TO SET THE MFR DOWN
AND TRANSFER THE FRAME TO ANOTHER PARENT, THUS LIMITING THE
ACCESS THAT PARENT HAS OVER THE FRAME UNTIL THE CURRENT PROCESS EXITS.
GETTAB CHANGES:

GETTAB UUO WILL NOW TAKE FRAME DESCRIPTORS INSTEAD OF JOB NUMBERS.
EXISTING PROGRAMS WILL CONTINUE TO WORK, AS THE ACCESS CHECKING
ALGORITHM FOR ABSOLUTE FRAME NUMBERS IS DOWNWARDS COMPATIBLE WITH
THE OLD ONE.

NEW GETTAB TABLES:

.GTPNO	-52	PROGRAM NUMBER, INDEXED BY FRAME.
		INCREMENTED EACH TIME NEW RUN IS DONE IN A FRAME.
		USED TO DETERMINE WHEN A PROCESS HANDLE IS GOOD OR NOT.
		REQUIRES .ARRPI (READ PROCESS INFO) ACCESS OR EQUIVALENT.

.GTUID	-53	UNIVERSAL FRAME ID. INDEXED BY FRAME.
		36 BIT QUANTITY GUARANTEED TO BE
		UNIQUE TO CURRENT INSTANTIATION OF THE FRAME FOR
		AS LONG AS THE CURRENT MONITOR DOES NOT CRASH.
		REQUIRES .ARRFI (READ FRAME INFO) ACCESS OR EQUIVALENT.

.GTFTR	-54	FRAME TREE INFORMATION. INDEXED BY FRAME.
		CONTAINS BYTE (12)PARENT,BROTHER,CHILD FRAME NUMBERS.
		REQUIRES .ARRFI (READ FRAME INFO) ACCESS OR EQUIVALENT.

ACCESS RIGHTS REQUIRED FOR EXISTING GETTAB TABLES:

ALL TRU COMPONENTS AVAILABLE VIA GETTAB REQUIRE .ARRAD
(READ ACCOUNTING DATA) ACCESS OR EQUIVALENT.

.GTUNM, .GTUN1, .GTSTS (USERNAME 1 AND 2, JOB STATUS WORD) REQUIRE
.ARRUN (READ USER NAME) ACCESS OR EQUIVALENT. (JOB STATUS INCLUDED IN
THIS SO THAT READERS KNOW WHICH FRAMES ARE LOGGED IN).
.GTPNO (READ PROGRAM NUMBER), .GTFPN (READ JBTFPN),
.GTPRG (PROGRAM NAME) , .GTLIC (LICENSE), .GTPRV (FRAME PRIV WORD) ALL R
.ARRPI (READ PROCESS INFO) OR THE EQUIVALENT.

.GTAUN (JBTAUN) , .GTUID (UNIVERSAL FRAME ID), .GTFTR (FRAME TREE INFO)
.GTPPN (JBTPPN) REQUIRE .ARRFI (READ FRAME INFO) OR EQUIVALENT.

.GTSLF (NUMTAB) WILL NOW WORK WITH NEGATIVE INDICES (TO FIND ADDRESSES
OF TYMSHARE GETTAB TABLES).

FORMERLY, A GETTAB ON A NON-EXISTENT TABLE WOULD RETURN A ZERO
ENTRY 0 AND NON-SKIP WITH AC UNCHANGED FOR ALL OTHER INDICES.
GETTABS FOR NON-EXISTENT TABLES WILL NOW ALWAYS RETURN NON-SKIP WITH
AC UNCHANGED REGARDLESS OF INDEX GIVEN.
LICENSE, PIDS, MAXIMUM FRAME RIGHTS:

LICENSES:

PASSED LICENSE = PASSED LICENSE ARG .AND. FRAME'S CURRENT PROCESS LICENS

NEW PROGRAM IN THE FRAME GETS MAX(PASSED LICENSE,(MAX(FRAME LIC,FILE LIC

NOTE: FOR PROGRAMS WITH BOTH LOWSEG AND HISEG FILES, THE LICENSE
GIVEN TO THE NEW PROCESS IS THE .AND. OF THE LICENSES ON THE .LOW
AND .HGH OR .SHR FILES.

PIDS:

THE PID FOR A PROCESS IS SET FROM THE PID OF THE FILE OR FILES
THAT THE PROGRAM CAME FROM. IF THE PROCESS CAME FROM TWO FILES
(.LOW, .SHR-.HGH) THE PIDS MUST BE IDENTICAL OR NO PID AT ALL IS
GIVEN TO THE PROCESS.

EXECUTE ONLY:

PROGRAM IN FRAME IS CONSIDERED EXECUTE ONLY IF:

1) FILE PROGRAM CAME FROM IS PROTECTED EXECUTE ONLY

2) FILE IS A .SWR FILE AND HAS LICENSE

3) FILE IS A .SWR FILE AND AUN OF FRAME DOES NOT HAVE AT LEAST UPDATE
   ACCESS TO THE .SWR FILE.

4) PROGRAM ISSUING A RUN OR RUNSEG UUO IS EXECUTE ONLY, REGARDLESS
OF THE PROTECTION ON THE NEW FILE.

NOTE: FOR RUN AND GET OF .SWR FILES, MAX WRITE BIT IS ALWAYS SET IN
ORDER TO ALLOW THE PROGRAM TO WRITE ENABLE ITSELF WITH SETUWP.
THUS MONITOR HAS TO MAKE THE FRAME EXECUTE ONLY TO PROTECT AGAINST
DAMAGE TO THE .SWR FILE.

MAXIMUM FRAME RIGHTS:

IF THE PROGRAM IS EXECUTE ONLY (AS DESCRIBED ABOVE) THE MFR ARE SET
TO EXECUTE ONLY, WHICH ONLY ALLOWS A VERY LIMITED SET OF CONTROL ONLY
FUNCTIONS. (THE MFR WILL NOT ALLOW READ OF ADDRESS SPACE, FOR EXAMPLE.)

IF THE PROGRAM IS NOT EXECUTE ONLY BUT HAS SOME CAPABILITY
THAT THE FRAME DOES NOT HAVE (HAS A LICENSE THE FRAME DOES NOT HAVE,
HAS HOME FILES AND FPN IS DIFFERENT FROM AUN OR PPN, HAS A PID)
AN MFR IS SETUP TO ONLY ALLOW
READ TYPE OPERATIONS AND THE LIMITED SET OF CONTROL OPERATIONS
THAT EXECUTE ONLY WILL ALLOW. THIS IS TO PREVENT ANOTHER FRAME
WITH A FRAME HANDLE TO THE FRAME IN WHICH SAID PROGRAM IS RUN FROM
CAUSING THE PROGRAM TO USE ITS SPECIAL CAPABILITIES TO THE CONTROLLING F

NOTE THAT THE PROGRAM HAS THE OPTION OF SETTING THE MFR DOWN FROM
THE ORIGINAL VALUE IN ORDER TO PROTECT ANY INFORMATION IT WISHES TO
KEEP TO ITSELF.
BENEFIT.

IF THE PROGRAM IS NOT EXECUTE ONLY AND DOES NOT HAVE CAPABILITIES
WHICH THE FRAME DOES NOT HAVE, THEN MFR IS SET TO ALL RIGHTS.
SINCE THE PROGRAM FILE IS NOT EXECUTE ONLY, IT HAS TO BE AT LEAST READ
ACCESS TO THE FRAME, SO ALLOWING ALL ACCESS TO THE FRAME IS NOT
DANGEROUS, SINCE THE FRAME COULD MAKE A COPY OF THE PROGRAM FOR ITSELF.
HALT STATUS CLASS/TYPE TABLE

ADDR+5 IS ALWAYS A SIXBIT DEVICE NAME IF RELEVANT.
ADDR+6 IS USED AS THE PRIMARY 36 BIT VALUE TO BE RETURNED
(LOCATION OF ILL MEM REF TYPE HALTS, FILENAME, "X" PAGES NEEDED)
ADDR+7 IS USED AS THE SECONDARY 36 BIT VALUE TO BE RETURNED
(EXTENSIONS IN ERRORS THAT RETURN FILENAMES AND EXTENSIONS)

CLASS 0, MEMORY VIOLATIONS

0	PC OUT OF BOUNDS
1	ILL MEM REF
2	WRITE VIOLATION
3	ADDRESS CHECK FOR DEVICE "X"
4	ILL MEM REF IN UUO
5	ILLEGAL INTERRUPT ADDRESS
6	ADDRESS BREAK
7	PDL OV

CLASS 1, SYSTEM RELATED ERRORS

0	PAGE I/O ERROR
1	DISK FULL DURING C-O-W
2	PAGING HARDWARE ERROR
3	TOO MANY PAGES LOCKED, CAN'T HANDLE FAULT
4	CONTEXT PAGE I/O ERROR
5	PARITY ERROR(S). ALL CORE REMOVED

CLASS 2, DEVICE RELATED ERRORS

0	OUTPUT DEVICE "X" CANNOT DO INPUT
1	INPUT DEVICE "X" CANNOT DO OUTPUT
2	ILLEGAL DATA MODE FOR DEVICE "X"
3	IO TO UNASSIGNED CHANNEL
4	HUNG DEVICE "X"
5	DEVICE "X" OPR ACTION REQUESTED

CLASS 3, ILLEGAL INSTRUCTION TRAPS

0	ILLEGAL UUO
1	UUO ERROR
2	ILL INST
3	HALT

CLASS 4, FRAME EXITS

0	EXIT
1	EXIT 1,
2	FAIL EXIT
3	TIME LIMIT EXCEEDED
4	<FILENAME> SETUP
5	<FILENAME> SAVED
6	FRAME CLEARED

CLASS 5, RUN, RUNSEG, GETSEG UUO ERRORS

0	TRANSMISSION ERROR
1	"N" PAGES NEEDED
2	DEVICE "X" NOT AVAILABLE
3	<FILENAME.EXT> NOT FOUND
4	NOT A SAVE FILE
5	<FILENAME.EXT> ATTEMPTED ENTER UUO FAILED
6	CORE ARGUMENT MUST BE SPECIFIED
7	MAG TAPE HISEG FORMAT BAD OR SYSTEM ERRORS
10	FATAL ERROR DURING REMAP UUO
11	MAGTAPE GET FAILURE
12	NO START ADDR
ACCESS RIGHTS:

OCT	COD F,LIC		TEXT
---	--- -----		----
MAP MANIPULATION

0	RDM R,RC	RIGHT TO FIND OUT THINGS ABOUT A FRAME'S MAP
			 (VPGSTS, WSCTL TO READ WS, ETC.)
1	CHM W,WC	RIGHT TO CHANGE MAP (REMOVE, MAP, VCREAT)
			 (ALSO REPLICATE TO OTHER FRAME)

VIRTUAL ADDRESS SPACE DATA MANIPULATION

2	RAC R,RC	READ ACS
3	WAC W,WC	WRITE ACS
4	VAR R,RC	READ VIRTUAL ADDRESS SPACE DATA (REPLICATE READ ONLY, ETC)
5	VAW W,WC	WRITE VIRTUAL ADDRESS SPACE DATA (REPLICATE MAX WRITE, ETC.)
			(MUST BE SEPERATE FROM CHANGE MAP BECAUSE TARGET FRAME
			MIGHT HAVE FILE ACCESS THAT CALLER DOES NOT).

CONTROL

6	HLT W,WC	HALT
7	STP X,WC	STOP (LIKE CONTROL-C, TRAPPABLE BY SUBJECT FRAME)
10	HNG W,WC	HANG
11	CLR X,WC	CLEAR (MUST BE STOPPED FIRST)
12	SVA X,WC	START AT ENTRY VECTOR ADDRESS
13	SAA W,WC	START ANYWHERE
14	RVA W,WC	RESTART AT ENTRY VECTOR ADDRESS
15	RAA W,WC	RESTART AT ARBITRARY ADDRESS

READING FRAME STATUS

16	RUN X,<TP,SY,AUN>	READ USERNAME (AND JBTSTS TO SEE IF LOGGED IN)
17	RDS R,<SY,AUN>	READ FRAME STATE (PC, HALT BLOCK)
20	RAD R,<SY,AUN>	READ ACCOUNTING DATA
21	RFI R,<SY,AUN>	READ FRAME INFORMATION (AUN, PPN, UINFORMATION, ETC.)
22	RPI R,<SY,AUN>	READ PROCESS INFORMATION (FPN, PROCESS NAME, PNO)

ACCESS RIGHTS

23	SMF W,WC		SET MAX FRAME RIGHTS. NEED TO HAVE WRITE ACCESS
			 TO FILE, OR ELSE CAN OVERRIDE THE FRAME'S OWN SETTING.

WAKEUP

24	WAK W,WC		DO WAKE UUO FOR FRAME

TTY ATTACHING AND DETACHING

25	ATT W,<AUN,JL>	ATTACH A PORT TO TARGET FRAME IF IT HAS NONE
26	DET W,<WC>,F	TAKE PORT AWAY FROM TARGET FRAME

FIELD EXPLANATIONS:

OCT - OCTAL ACCESS RIGHT NUMBER
COD - .AR<COD> IS OFFICIAL SYMBOL NAME FOR ACCESS RIGHT NUMBER
F   - X INDICATES ACCESS BIT IS ON FOR EXECUTE ONLY AND ABOVE
      R INDICATES ACCESS BIT IS ON FOR PROCESS LIC > FRAME LIC
	(BUT NOT FOR EXECUTE ONLY)
      W INDICATES ACCESS BIT IS ON ONLY IF NOT EXECUTE ONLY AND
	PROCESS LIC <= FRAME LIC
LIC - INDICATES LICENSES THAT MUST BE SET FOR PROCESS IN FRAME
	TO GET THAT ACCESS BIT. "AUN" MEANS SAME AUN OR ACCT SUPERVISOR
	AND SAME GAN.
FRAME DESCRIPTORS:

A FRAME DESCRIPTOR IS AN 18 BIT QUANTITY WHICH TAKES THE PLACE OF
A JOB NUMBER. IT CONSISTS OF A SIX BIT TYPE/SUBTYPE FIELD AND
A TWELVE BIT INDEX FIELD. THE TYPES ARE CHOSEN SUCH THAT TYPE 0
REPRESENTS AN ABSOLUTE FRAME NUMBER (VERY SIMILAR TO THE OLD JOB
NUMBERS) AND TYPE 7 REPRESENTS SELF (SO THAT -1 STILL GIVES
SELF IN UUOS THAT TAKE FRAME DESCRIPTORS). FRAME NUMBERS ARE
EQUIVALENT TO JOB NUMBERS, THAT IS, FOR UUOS THAT STILL TAKE
JOB NUMBERS, THE JOB NUMBER OF A FRAME WILL ALWAYS BE THE
SAME AS ITS FRAME NUMBER.

THE GENERAL FORMAT OF A FRAME DESCRIPTOR IS TSDDDD WHERE
T REPRESENTS A 3 BIT TYPE FIELD, S REPRESENTS A 3 BIT SUBTYPE
FIELD (IGNORED IF TYPE HAS NO SUBTYPES) AND DDDD IS THE DATA
FIELD.

THE TYPES ARE:
0	.FDABS		ABSOLUTE FRAME NUMBER
1	.FDFAM		FAMILY DESCRIPTOR, 21-23 HAVE SUBTYPE
  0	.FMCHL		  CHILD, DDDD IS FRAME NUMBER
  1	.FMPAR		  PARENT, DDDD IS FRAME NUMBER

2	.FDOTF		"OTHER" FRAME SET BY SETOTF UUO
3	.FDFRH		CREATED HANDLE. DDDD IS INDEX
7	.FDSLF		CALLING FRAME. DATA IS USUALLY 77777

THE ABSOLUTE FRAME DESCRIPTOR WILL ONLY WORK IF THE CALLER WHO
USES IT HAS EITHER TP (TYMSHARE PROPRIETARY), SY (SYSTAT LICENSE)
RC (READ CORE) OR WC (WRITE CORE) OR IF THE TARGET FRAME IS IN SOME
WAY RELATED TO THE CALLING FRAME. EACH MORE POWERFUL LICENSE
IMPLIES THE EXISTENCE OF ALL THE LESSER ONES. THE RIGHTS ASSOCIATED
WITH AN ABSOLUTE FRAME DESCRIPTOR DEPEND ONLY ON THE HIGHEST
ONE OF THESE LICENSES THAT THE CALLING PROCESS CURRENTLY HAS.
THE TARGET FRAME'S MAXIMUM FRAME RIGHTS ARE NOT INVOLVED IN
THE COMPUTATION OF ACCESS RIGHTS FOR AN ABSOLUTE FRAME DESCRIPTOR.
A CALLING FRAME IS GIVEN ACCESS TO A TARGET FRAME EQUIVALENT
TO "SY" LICENSE IF 1) IT HAS THE SAME AUN AS THE TARGET
2) IT HAS THE SAME GAN AS THE TARGET AND THE CALLER HAS
ACCOUNT SUPERVISOR STATUS.

THE EFFECT OF USING THE "OTHER" FRAME DESCRIPTOR IS EXACTLY THE SAME
AS IF THE CALLER HAD SPECIFIED THE LAST VALUE GIVEN TO THE SETOTF
UUO DIRECTLY.
FRMOP ERROR CODES

THESE ERROR CODES APPEAR IN THE RIGHT HALF OF AC FOR FRMOPS, EXCEPT
FOR REPLICATE, VCLEAR, AND VREMOV FRMOPS, IN WHICH THE CODES BELOW
APPEAR IN 0-5, VP APPEARS IN 8-17, AND THE VREPLC, VCLEAR OR VREMOV
ERROR CODE APPEARS IN 18-35.
THE CREATE FRAME FUNCTION (.FOCFM) HAS ITS OWN ERROR CODES.

.FENOH	1	NO HANDLE IN SLOT
.FEBDI	2	UNMATCHING UNIVERSAL ID NUMBER
.FENRT	3	NO RIGHTS TO DO OPERATION
.FEBDF	4	BAD FRAME NUMBER
.FENLC	5	NOT ENOUGH LICENSE
.FEUND	6	UNDEFINED FRAME DESCRIPTOR TYPE
.FENCH	7	FD SAID CHILD BUT GAVE NON-CHILD FRAME NUMBER.
.FECLP	10	CAN'T LOCK CONTEXT PAGES (FD2UPX)
.FEBAR	11	BAD ACCESS RIGHTS CODE
.FENPR	12	ORPHAN ASKED FOR ITS PARENT
.FEBFD	13	BAD FAMILY DISPATCH TYPE
.FEBDH	14	BAD HANDLE INDEX NUMBER IN FD
.FEBFN	15	BAD FUNCTION CODE TO FRMOP
.FEADB	16	ADDRESS FOUND BAD (REPLICATE FAILED) IN .FO?VA
.FEIOE	17	PAGE I/O ERROR IN FRMRVM/FRMWVM
.FEALR	20	ATTEMPT TO START A RUNNING FRAME
.FEALH	21	ATTEMPT TO HALT NON-RUNNING FRAME
.FECSJ	22	ATTEMPT TO HALT FRAME WITH JACCT ON
.FEFHE	23	HANDLE DESCRIPTOR EXPECTED, NOT GIVEN
.FEFHU	24	HANDLE (INDEX ALREADY) USED
.FENFH	25	NO HANDLE INDICES LEFT.
.FEBCN	26	BAD COUNT
.FEBTN	27	BAD TABLE NUMBER
.FEBHT	30	BAD HANDLE TYPE
.FECCH	31	CAN'T CREATE HANDLE (ACCESS FAILURE)
.FEBSV	32	BAD START VECTOR OFFSET
.FECII	33	ATTEMPT TO MAKE A CHILD ITS OWN INFERIOR IN FRAME TREE
.FECCF	34	CAN'T CONTINUE FRAME
  %+7P€